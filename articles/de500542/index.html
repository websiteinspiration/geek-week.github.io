<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👉🏽 👨🏾‍🔧 🐢 Hack Age of Empires III, um die Einstellungen für die Shader-Qualität zu ändern 👩🏾‍🤝‍👨🏽 ⏪ 🤜🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anfang Mai 2020 - Wenn Sie wie ich sind, haben Sie durch Quarantäne Spiele wiederholt, die seit vielen Jahren nicht mehr gestartet wurden. 
 
 Und wen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hack Age of Empires III, um die Einstellungen für die Shader-Qualität zu ändern</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500542/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfang Mai 2020 - Wenn Sie wie ich sind, haben Sie durch Quarantäne Spiele wiederholt, die seit vielen Jahren nicht mehr gestartet wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn Sie mir noch ähnlicher sind, liegt vielleicht irgendwo eine Diskette mit Age of Empires 3 herum. Vielleicht spielen Sie auf einem Mac, vielleicht haben Sie noch kein Upgrade auf Catalina durchgeführt und möchten Morgan Black befehlen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie starten das Spiel, rufen das Hauptmenü auf und bemerken sofort, dass etwas nicht stimmt ... Das Menü sieht </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ekelhaft aus</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5be/dfa/a66/5bedfaa660037faa86c176d9586f9d1a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie sich fragen, was genau „ekelhaft“ ist, achten Sie auf das Wasser. </font><font style="vertical-align: inherit;">Alles andere ist auch schrecklich, aber es ist weniger offensichtlich.</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/578/2d3/34f/5782d334f3be69385a0b69072ef6b7ed.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, Sie gehen in die Optionen, erhöhen alle Parameter auf das Maximum ... Aber das Spiel ist immer noch hässlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie bemerken, dass die Optionen " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader-Qualität</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " verdächtig auf " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Niedrig</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">gesperrt </font><font style="vertical-align: inherit;">sind </font><font style="vertical-align: inherit;">.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versuch Nr. 1 - Hack-Parameter</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An diesem Punkt beginnen Sie mit der Suche nach dem Ordner des Spiels, der angeblich irgendwo im Ordner "Dokumente" erstellt wurde, da das Spiel im Jahr 2005 war, und dann haben es alle getan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was suchen wir? Natürlich die Datei, in der die Parameter gespeichert sind. Die Menüoberfläche erlaubt es uns nicht, die Einstellungen zu ändern, aber wir sind schwierig, oder? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir finden das erforderliche XML, da das Spiel 2005 ist und es natürlich XML ist, wo wir auf die Option " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optiongrfxshaderquality</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><em><font style="vertical-align: inherit;">stoßen</font></em><font style="vertical-align: inherit;"> , die auf 0 gesetzt ist. Es scheint, dass wir danach gesucht haben, also erhöhen wir den Wert auf 100, weil es nicht viel Qualität gibt. Hier stimme ich Ihnen zu.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/61d/de5/d85/61dde5d85e5442f781fe9c4eaeb46a55.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Möglicherweise stellen Sie auch fest, dass dies eine schreckliche Verwendung von XML ist. Zum Glück hat er keine guten Verwendungsmöglichkeiten.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mit uns zufrieden starten wir das Spiel. Leider hat sich nichts geändert. Wenn wir uns die XML-Datei noch einmal ansehen, sehen wir, dass der Parameter wieder auf 0 gesetzt ist. Ensemble Studios (möge es in Ruhe ruhen) sieht Ihren Einfallsreichtum mit Verachtung an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">könnten</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir </font><em><font style="vertical-align: inherit;">aufgeben</font></em><font style="vertical-align: inherit;"> . Dies ist ein Mac, daher ist es unwahrscheinlich, dass die von Benutzern geschriebenen Patches gefunden werden (tatsächlich habe ich überprüft - es gibt alle möglichen zweifelhaften Lösungen, die möglicherweise funktionieren). Es dreht sich alles um die Grafik. Es scheint schwierig zu sein, das Problem zu beheben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber wir werden nicht aufgeben. </font><font style="vertical-align: inherit;">Weil wir uns daran erinnern, wie Alter 3 aussehen sollte. Wir erinnern uns, wie wir dieses schöne gewellte Wasser bewunderten. </font><font style="vertical-align: inherit;">Diese Partikeleffekte. </font><font style="vertical-align: inherit;">Diese riesigen Schiffe, die einfach nicht in den Rahmen passen. </font><font style="vertical-align: inherit;">Und es ist nur so, dass die Kamera vergrößert wurde. Was habe ich gerade gedacht?</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versuch Nr. 1 - Daten hacken</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ganz am Anfang des Ordners in Dokumente befindet sich eine Protokolldatei. Das Spiel schrieb dort eine Grafikkarte und berichtete, dass es die Einstellung „generisches dx7“ gewählt hatte. Es heißt, dass Sie Intel GMA 950 installiert haben, das wirklich auf dem vorherigen Computer war. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber hier haben Sie Intel Iris Graphics 6100. Irgendwas stimmt wirklich nicht. Sie gehen davon aus, dass das Spiel die Grafikfunktionen des Computers ermittelt und diese mit einer Datenbank mit Grafikkarten vergleicht, anstatt die Funktionen der Karte selbst zu überprüfen. Denn genau das tun AAA-Entwickler, und wenn Sie an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open-Source-RTS gearbeitet haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wissen Sie, wie dies geschieht.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b6e/8b3/fb2/b6e8b3fb28030917e8300cdce5653fac.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Inhalt der Protokolldatei. Wenn Sie es lustig finden, dass Intel als 0x8086 bezeichnet wird, haben Sie den entsprechenden Artikel ausgewählt.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Durch Zufall finden Sie alte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patchnotizen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die Ihre Bedenken bestätigen. Sie schauen in den GameData-Ordner, aber es gibt nur </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bar-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.xmb-Dateien</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die größtenteils nicht lesbar sind. </font><em><font style="vertical-align: inherit;">Sie suchen</font></em><font style="vertical-align: inherit;"> nach grep " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " und " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx7</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Es passiert nichts. Mehrere Dateien löschen ... Es passiert nichts. Aber Sie wissen, dass AAA-Spiele einige Ressourcen an seltsamen Orten speichern können, und dies ist der Port von Windows-Spielen auf dem Mac, sodass hier alles sehr bizarr sein kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Letztendlich finden Sie die Datei "render.bar". Wenn Sie sie verschieben, stürzt das Spiel beim Start ab. Es ist nicht sehr klar, aber nicht schlecht. Wir öffnen die Datei in </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hex Fiend</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , da Sie mit diesem Programm normalerweise etwas über Binärdateien lernen können. Und so stellt sich heraus. Ein Teil dieser Daten ist lesbarer Text. Einige von ihnen sind Shader. Aber die meisten Daten sind seltsamerweise durch Leerzeichen unterteilt ...</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d1/3a2/6f5/9d13a26f5dfff14c2b44f59dbc69b673.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hex Fiend-Schnittstelle Es ist minimalistisch, aber es funktioniert. Die ersten Bytes sind die Buchstaben "ESPN", bei denen es sich höchstwahrscheinlich um den .bar-Header handelt.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sie rufen aus: "Offensichtlich ist dies UTF-16!" Das Spiel wurde für Windows erstellt, daher ist es logisch, dass es Text in UTF-16 speichert und fast die Hälfte einer 30-Megabyte-Datendatei verschwendet. Immerhin liebte Windows UTF-16 (obwohl </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dies nicht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der Fall sein </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">sollte</font></a><font style="vertical-align: inherit;"> ). Warum also nicht diese Codierung und ASCII-Shader in einer Datei verwenden? Es ist eine logische Idee! </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Eigentlich habe ich ungefähr einen Tag gebraucht, um es herauszufinden.)</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hex Fiend hat die Möglichkeit, Bytes wie UTF-16 zu analysieren, also suchen wir wieder nach dem Grep-String dx7. Es gibt mehrere Einträge. Wir ersetzen sie durch die dx9-Zeile, die auch in den Daten enthalten ist, speichern die Datei und starten das Spiel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja Protokolle zeigen wieder nicht "dx9" an. Dies ist wahrscheinlich woanders eingestellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir etwas anderes. Angenommen, das Spiel erkennt Grafikkarten und ihre hexadezimalen Kennungen werden in den Protokollen gespeichert (in meinem Fall ist 0x8086 Intel und auch 0x2773). Wir suchen in Hex Fiend nach „8086“, wir finden etwas und ein Teil des Textes sieht vielversprechend aus. Die Intel 9-Serie ist die GMA 950-Serie, und Age 3 hat wahrscheinlich nicht sehr gut daran funktioniert.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af6/b22/f44/af6b22f4473691b673cb5dba2fd197f0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einige Nummern sind wie Kartenkennungen (2582, 2592); Wenn Sie sie ersetzen, ändert sich möglicherweise etwas. Wir haben trotzdem eine Kopie der Datei erstellt, damit Sie es versuchen können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider ist dies auch eine Sackgasse. Tatsächlich untersuchen wir die falsche Datei. Zum Glück kann ich Ihnen das sagen, weil ich viel Zeit damit verbracht und </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zu</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> viel </font><font style="vertical-align: inherit;">versucht </font><em><font style="vertical-align: inherit;">habe</font></em><font style="vertical-align: inherit;"> . Dieses verdammte Ding hat ungefähr 20 Stunden gedauert. Und dies zählt nicht die Zeit für alle Screenshots ... Die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gewünschte Datei heißt "DataP.bar", und wenn wir die ID mit Bedacht ersetzen, sehen wir etwas völlig Neues in den Protokollen:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/445/e79/6a2/445e796a2ca507e1f1a056da1cbd30a3.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich verstehe nicht ganz, warum dieses "generische dx7" nicht dasselbe ist wie im obigen Screenshot. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich sind wir im Spiel immer noch durch die "Niedrig" -Einstellungen eingeschränkt, das heißt, die Protokolle lügen nicht. </font><font style="vertical-align: inherit;">Wir hatten auf ein Medium gehofft, aber </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leider</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass mehr aus dem Hacken von Daten nicht erreicht werden kann. </font><font style="vertical-align: inherit;">Es ist Zeit, die Werkzeuge ernst zu nehmen.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versuch Nr. 2 - Hacken</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn also nichts gelingt, haben wir noch eine letzte Sache: die ausführbare Datei selbst zu ändern (das heißt, wie sie 2005 sagten, sie zu „knacken“). </font><font style="vertical-align: inherit;">Es scheint, dass es heute einfach als Hacking bezeichnet wird, aber dieser Begriff wurde im Bereich der Wildpiraterie beibehalten (natürlich habe ich das persönlich </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nie</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> getan). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir kommen zum interessantesten Teil des Artikels (ja, Sie haben bereits tausend Wörter gelesen, aber war es nicht neugierig?).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disassembler Hopper</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu diesem Zeitpunkt wird unser Tool ein Disassembler sein: eine Anwendung, die den Binärcode der ausführbaren Datei empfängt und in lesbaren (ha ha) Assembler-Code umwandelt. Das beliebteste davon ist IDA Pro, aber es ist wahnsinnig teuer und ich bin mir nicht sicher, ob es auf einem Mac funktioniert, also werde ich </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopper verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Es ist nicht kostenlos (kostet 90 US-Dollar), kann aber mit fast allen erforderlichen Funktionen 30 Minuten lang frei verwendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde die Benutzeroberfläche nicht im Detail erklären, da im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopper-Tutorial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alles gut beschrieben ist, aber ich werde Ihnen sagen, was ich tun werde, und versuchen, genügend Screenshots zu machen, damit Sie etwas lernen können.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst müssen Sie sagen: Ich habe fünf Tage gebraucht, um das Problem zu lösen, und es wurden viele erfolglose Versuche unternommen. Grundsätzlich werde ich über erfolgreiche Schritte sprechen, also wird es magisch erscheinen. Aber es war </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">schwierig</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Machen Sie sich keine Sorgen, wenn Sie Probleme haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und noch ein Hinweis: „Cracken“ ist meistens illegal und / oder wird für illegale Zwecke durchgeführt. Ich zeige ein eher seltenes Beispiel für eine ziemlich legitime Verwendung, die gleichzeitig völlig „weißer Hut“ ist, also ist hier alles in Ordnung. Ich gehe davon aus, dass dies streng genommen illegal ist / gegen die Endbenutzervereinbarung verstößt, aber offensichtlich ein Fall </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">höherer Gewalt ist</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wie auch immer, zahlen Sie für das, was Sie mögen, und nur dafür, denn Anti-Konsumismus ist cool.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a04/597/b6a/a04597b6a9ad1979e14216547ecf61d6.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db3/dfb/1e3/db3dfb1e3ec50890530001d69a22cdd2.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/605/66d/e69/60566de69653b745f83d196f56679263.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ziehen Sie die Age 3-App, um sie zu öffnen. </font><font style="vertical-align: inherit;">Wählen Sie einfach "x86" anstelle von powerPC, denn das Spiel ist etwas 2005.</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stufe 1 - Suche nach dem gewünschten Fragment</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überraschenderweise kann dies am schwierigsten sein. </font><font style="vertical-align: inherit;">Wir haben einen zerlegten Code, aber wir haben keine Ahnung, wo wir suchen sollen. </font><font style="vertical-align: inherit;">Ja, einige Spiele haben Debugging-Symbole, sodass Sie die Funktionsnamen lesen können, in unserem Fall jedoch nicht. </font><font style="vertical-align: inherit;">Hopper gibt uns Namen wie "sub_a8cbb6", mit denen wir uns selbst befassen müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Glück haben wir einen Vorsprung: unsere </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protokolldatei</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es ist sehr wahrscheinlich, dass beim Schreiben in das Protokoll </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Zeichenfolgenliterale</font></a><font style="vertical-align: inherit;"> verwendet werden</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das heißt, ASCII werden in der ausführbaren Datei geflasht. </font><font style="vertical-align: inherit;">Wir können sie mit grep suchen, da wir sie durch keine Kompilierung entfernen können (sie können jedoch durch Verschleierung des Codes ausgeblendet werden. Glücklicherweise ist dies nicht geschehen.) </font><font style="vertical-align: inherit;">Das Auffinden von Grep-String-Literalen ist normalerweise das erste, was sie tun, wenn sie ein Programm zerlegen. </font><font style="vertical-align: inherit;">Geben Sie also "gefundener Anbieter" in das Suchfeld "Hopper" ein und es wird etwas gefunden:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da7/114/b61/da7114b61ecba23df73633ad41ab338f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh ja, String-Literale, ich verehre sie. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies an sich hat uns nicht so sehr vorangebracht. </font><font style="vertical-align: inherit;">Da die Adresse dieser "Zeichenfolge von Literalen" fest codiert ist, können wir Links dazu finden. </font><font style="vertical-align: inherit;">Hopper hat sie rechts grün hervorgehoben: "DATA XREF = sub_1d5908 + 1252." </font><font style="vertical-align: inherit;">Durch Doppelklicken auf die Zeile gelangen wir zu unserer Helden- </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sub_1d5908-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prozedur </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6d/d6a/e8b/d6dd6ae8bbe346215273e7beb930b0a7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier finden wir den Assembler-Code. </font><font style="vertical-align: inherit;">Es wird angenommen, dass es schwer zu lesen ist, aber es ist nicht. </font><font style="vertical-align: inherit;">Das Schwierigste ist, es zu verstehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Standardmäßig verwendet Hopper die "Intel-Syntax", dh der erste Operand ist der Empfänger und der zweite die Quelle. </font><font style="vertical-align: inherit;">In der hervorgehobenen Zeile sehen wir </font></font><code>mov dword [esp+0x1DC8+var_1DC4], aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lass es uns ausmachen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unsere erste Zeile im Assembler</font></font></h2><br>
<code>mov</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ist ein MOV - </font><font style="vertical-align: inherit;">Team für seinen auf x86 bekannt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turing-complete</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Es verschiebt (tatsächlich kopiert) die Daten von A nach B, was im Wesentlichen bedeutet, A zu lesen und in B zu schreiben. Basierend auf dem Vorstehenden ist </font></font><code>aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dies A und </font></font><code>dword [esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dies ist B, der Empfänger. Schauen wir uns das genauer an. </font></font><br>
<br>
<code>aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- das ist der Wert, den Hopper uns hilft. Dies ist eigentlich ein Alias ​​für die Speicheradresse des String-Literal, auf das wir vor einigen Sekunden geklickt haben. Wenn Sie das Fenster teilen und den Code im Hex-Modus (der </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bevorzugte</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modus für Hacker) betrachten, werden wir dort sehen </font></font><code>88 18 83 00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d3/d74/31d/0d3d7431d27f6a03c2af6142f27c9a9b.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopper hebt bequem die gleichen ausgewählten Fragmente in beiden Fenstern hervor.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wenn der Flip-Wert korrekt ist, erhalten wir 0x00831888 - die Speicheradresse des String-Literal (in einem der oben gezeigten Screenshots wird sie sogar gelb hervorgehoben). Ein Rätsel ist also gelöst: Der Code führt MOV aus, dh er schreibt die Adresse 0x00831888. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum ist es so geschrieben </font></font><code>88 18 83 00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nicht wie </font></font><code>00 83 18 88</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Dies geschah aufgrund der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bytereihenfolge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ein ziemlich verwirrendes Thema, das normalerweise wenig Einfluss hat. Dies ist eines der Dinge, die die Leute dazu bringen zu sagen, dass „Computer nicht funktionieren“. Für uns bedeutet dies, dass dieses Problem in allen Zahlen auftritt, mit denen wir heute arbeiten werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie haben vielleicht bemerkt, dass ich "Adresse aufschreiben" gesagt habe, und das stimmt: Wir kümmern uns nicht wirklich um den Inhalt, der sich als String-Literal mit einem Null-Byte am Ende herausstellte. Wir schreiben die Adresse auf, da sich der Code später auf diese Adresse bezieht. Dies ist ein Zeiger. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist mit </font></font><code>dword [esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Hier ist alles komplizierter. </font></font><code>dword</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bedeutet, dass wir mit "Doppelwörtern (Doppelwörtern)" arbeiten, dh mit 16 * 2 Bits. Das heißt, wir kopieren 32 Bit. Rückruf: Unsere Adresse ist</font></font><code>0x00831888</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das heißt, 8 Hexadezimalzeichen, und jedes Hexadezimalzeichen kann 16 Werte haben, d. h. 4 Datenbits. Wir erhalten also 8 * 4 = 32. Von hier stammt übrigens die Notation „32-Bit“ für Computersysteme. Wenn wir 64 Bit verwenden würden, würde die Speicheradresse als 0x001122334455667788 geschrieben, wäre doppelt so lang und 2 ^ 32 mal größer, und wir müssten 16 Bytes kopieren. Wir hätten also viel mehr Speicher, aber das Kopieren des Zeigers würde doppelt so viel Arbeit erfordern, und daher sind 64 Bit tatsächlich nicht doppelt so schnell wie 32 Bit. Eine ausführlichere Erklärung des Begriffs „Wort“ finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Weil es natürlich komplizierter ist als meine Erklärung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist also mit dem Teil in eckigen Klammern? Die Klammern bedeuten, dass wir berechnen, was sich darin befindet, und es als Zeiger betrachten. Daher schreibt der MOV-Befehl in die aus den Berechnungen erhaltene Speicheradresse. Schauen wir uns das noch einmal genauer an (und keine Sorge, wenn Sie damit fertig sind, wissen Sie im Wesentlichen, wie man Assembler-Code mit Intel-Syntax liest). </font></font><br>
<br>
<code>esp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist ein </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Register</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das im Assembler einer Variablen am nächsten kommt. In der x86-Architektur gibt es viele Register, und verschiedene Register haben unterschiedliche Anwendungsmöglichkeiten, aber das ist uns eigentlich egal. Erfahren Sie hier mehr darüber </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Beachten Sie jedoch, dass es spezielle Register für Gleitkommazahlen sowie „Flags“ gibt, die für Vergleiche und ähnliche Operationen verwendet werden. Alles andere sind nur Hexadezimalzahlen, die Hopper ein wenig überarbeitet hat, um uns zu helfen. </font></font><code>var_1DC4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dies </font></font><code>-0x1DC4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">können wir zu Beginn des Verfahrens oder im rechten Bereich sehen. Dies bedeutet , </font><font style="vertical-align: inherit;">dass das Ergebnis der Berechnung </font></font><code>[esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird </font></font><code>[esp + 0x1DC8 — 0x1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das entspricht </font></font><code>[esp + 4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Im Wesentlichen bedeutet dies "Nehmen Sie den 32-Bit-Wert des ESP-Registers, addieren Sie 4 und interpretieren Sie das Ergebnis als Speicheradresse." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also wiederholen wir: Wir schreiben die Adresse des String-Literal in „esp + 4“. Dies sind korrekte Informationen, aber sie sind völlig nutzlos. Was bedeutet das?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist die Schwierigkeit beim Lesen von Assembler-Code: beim Parsen, was er tun soll. </font><font style="vertical-align: inherit;">Hier haben wir einen Vorsprung: Wir wissen, dass er höchstwahrscheinlich etwas in das Protokoll schreibt. </font><font style="vertical-align: inherit;">Daher können wir einen Aufruf einer Funktion erwarten, die in das Protokoll schreibt. </font><font style="vertical-align: inherit;">Lass uns nach ihr suchen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c57/7f8/827/c577f8827feb59247a7c69ed0467fef2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im obigen Screenshot gibt es mehrere ähnliche Aufrufe sowie den Befehl </font></font><code>call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, der die Prozedur aufruft. </font><font style="vertical-align: inherit;">Hopper spricht normalerweise darüber (ich weiß nicht, warum er es hier nicht getan hat), aber im Wesentlichen geben wir Argumente für den Aufruf der Funktion. </font><font style="vertical-align: inherit;">Wenn Sie auf verschiedene Unterprogrammaufrufe klicken, finden wir etwas namens imp___jump_table___Z22StringVPrintfExWorkerAPcmmPS_PmmPKcS_. </font><font style="vertical-align: inherit;">Dies ist der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dekodierte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Name der Funktion, und der Teil „Printf“ reicht aus, um zu verstehen, dass er wirklich etwas ausgibt. </font><font style="vertical-align: inherit;">Es ist uns egal, wie sie das macht.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geh einen Schritt zurück</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu diesem Zeitpunkt haben wir uns völlig von dem entfernt, was wir getan haben: Wir haben versucht, das Spiel davon zu überzeugen, dass unsere Grafikkarte von 2015 leistungsstark genug ist, um das Spiel von 2005 zu starten. Fassen wir zusammen. Wir haben den Ort gefunden, an dem das Protokoll aufgezeichnet wird. Wenn wir Glück haben, finden Sie hier den Code, der die Parameter und Funktionen von Grafikkarten überprüft. Zum Glück hatten wir wirklich Glück (es besteht eine hohe Wahrscheinlichkeit, dass dieser Artikel sonst nicht gewesen wäre). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das Gesamtbild zu erhalten, verwenden wir die Hopper Control Flow Graph-Funktion, die den Code in kleine Blöcke aufteilt und Pfeile zeichnet, die verschiedene Übergänge anzeigen. Dies ist viel einfacher zu verstehen als bei gewöhnlichen Assemblern, bei denen oft alles durcheinander ist.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3a/4bd/1b1/e3a4bd1b1528d0344f4f1174b16be79c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Aufruf des Protokolleintrags befindet sich mitten in einer furchtbar langen Funktion, da dies wiederum normalerweise in AAA-Spielen geschieht. </font><font style="vertical-align: inherit;">Hier sollten wir nach anderen Hopper-String-Literalen und "Hinweisen" suchen, in der Hoffnung, etwas zu finden. </font><font style="vertical-align: inherit;">Zu Beginn des Vorgangs befindet sich der Rest der Protokollierung. Im Folgenden finden Sie interessante Abschnitte zum Erzwingen der Parameter "dx7" und "Sehr hoch" sowie ein Problem mit der Version der Pixel-Shader, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die wir haben.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Protokoll unserer "gehackten" Daten ergab, dass wir Pixel-Shader der Version 0.0 hatten und diese nicht mit den "High" -Parametern kompatibel sind. </font><font style="vertical-align: inherit;">Dieser Code befindet sich in der unteren linken Ecke unserer Funktion. Wenn Sie genau hinschauen, können Sie etwas Merkwürdiges sehen (hervorgehoben von Ihrem bescheidenen Diener): Dies ist derselbe Code, der viermal für die Parameter "Sehr hoch", "Hoch", "Mittel" und "Niedrig" wiederholt wird. </font><font style="vertical-align: inherit;">Und ja, ich habe mehrere Stunden gebraucht, um das zu finden.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/27b/132/603/27b13260328e5da3cbef4323e840563f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe den Block, in dem "Pixel Shader Version 0.0 High" im Protokoll angezeigt wird, blau hervorgehoben. Ich habe ähnliche Teile mit anderen schönen Farben hervorgehoben.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Die einzigen Unterschiede sind, dass wir an verschiedenen Stellen „0x0“, „0x1“, „0x2“ und „0x3“ schreiben. Dies ähnelt verdächtig der oben untersuchten Parameterdatei und dem Parameter </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optiongrfxshaderquality</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Sie verstehen dies möglicherweise noch nicht. Aber glauben Sie mir). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Stadium können wir versuchen, auf verschiedene Arten vorzugehen, was ich auch getan habe. Aber ich werde mich kurz fassen - wir werden das Notwendigste tun: Finden Sie heraus, warum die Pixel-Shader-Überprüfung fehlschlägt. Suchen wir nach einem Zweig. Der Ausgabeblock für das Protokoll ist linear, was bedeutet, dass er irgendwo darüber liegen sollte.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/724/d53/3a7/724d533a7f9af2353f611c6bea4f15b7.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEMVER-Fans sehen ein erweitertes Versionsformat: Gleitkommazahlen.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Und tatsächlich gibt es direkt darüber </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen Übergangsbefehl (denken Sie an „goto“). Dies ist ein " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bedingter Sprung</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " und die Bedingung ist " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn weniger</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Assembler-Ifs arbeiten mit </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registerflags</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , über die ich oben kurz gesprochen habe. Es reicht aus, nur zu wissen, dass wir uns den obigen Befehl ansehen müssen: Wahrscheinlich setzt er das Flag. Oft ist dies ein Befehl </font></font><code>cmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aber hier verwendet </font></font><code>ucomiss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Das ist Barbarei. Aber sie googelt leicht: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ucomiss</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies ist ein Gleitkomma-Vergleichsbefehl, und dies erklärt, warum der Code hat</font></font><code>xmm0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Dies ist ein Register von Gleitkommazahlen. Dies ist logisch: Die Protokolle geben an, dass unsere Version der Pixel-Shader "0.0" ist, was ein Gleitkommawert ist. Was befindet sich dann unter der Speicheradresse 0x89034c? Hexadezimaldaten sehen aus </font></font><code>00 00 00 40</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und können verwirrend sein. Aber wir wissen, dass wir Gleitkommazahlen erwarten sollten, also lassen Sie uns die Daten so interpretieren: das heißt </font></font><code>2.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies ist ein logischer Gleitkommawert für die Version von Pixel-Shadern, die Microsoft tatsächlich in seiner </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">High-Level-Shading-Sprache verwendet hat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf denen DirectX-Shader geschrieben sind. </font><font style="vertical-align: inherit;">Und Age 3 ist ein DirectX-Spiel, obwohl der Port auf dem Mac OpenGL verwendet. </font><font style="vertical-align: inherit;">Es ist auch logisch, dass 2005 Pixel-Shader der Version 2.0 erforderlich sind, um den High-Parameter zu aktivieren, sodass wir uns in die richtige Richtung bewegen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie beheben wir das? </font><font style="vertical-align: inherit;">Diese Vergleichsanweisung führt einen Vergleich mit dem Wert durch, </font></font><code>xmm0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der in der obigen Zeile angegeben ist : </font></font><code>movss xmm0, dword [eax+0xA2A8]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">MOVSS ist ein spezieller "Verschieben" -Befehl für Gleitkommaregister, und wir schreiben 32 Bit aus der Adresse, was das Ergebnis der Auswertung von eax + 0xA2A8 ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vermutlich ist dieser Wert nicht 2,0, sondern 0,0. </font><font style="vertical-align: inherit;">Lass es uns reparieren.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Echtes Hacken</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Endlich sind wir bereit, zu den Parametern des High-Spiels zu gelangen. Wir wollen den „roten“ Pfad gehen und die gesamte Logik mit der „falschen Version von Pixel-Shadern“ überspringen. Dies kann erreicht werden, indem der Vergleich erfolgreich bestanden wird, dh indem die Übergangsbedingung umgekehrt wird. Wir haben jedoch noch einen Trick: Der Code ist so zusammengesetzt, dass wir beim Löschen des Übergangs den „roten“ Weg gehen. Ersetzen wir einfach den Übergang durch </font></font><code>nop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine Operation, die nichts bewirkt (es ist unmöglich, Daten einfach zu löschen oder zur ausführbaren Datei hinzuzufügen, da ein Offset auftritt und alles kaputt geht). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich empfehle, aus CFG auszusteigen, da sonst Hopper verrückt wird. Wenn alles richtig gemacht ist, sehen wir im Hex-Fenster rote Linien.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/903/09d/db2/90309ddb2fecf42031e8bf9d4a6abe88.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/010/d39/b35/010d39b355b0cb7e5b55fc83007e17ae.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rot zeigt die Änderungen an, die wir vorgenommen haben. </font><font style="vertical-align: inherit;">Wenn Sie zu diesem Zeitpunkt für Hopper bezahlt haben, können Sie die Datei einfach speichern. </font><font style="vertical-align: inherit;">Da ich jedoch nicht bezahlt habe, öffne ich die ausführbare Datei in Hex Fiend, suche den gewünschten Bereich (indem ich den Bereich von Hopper auf die Registerkarte Suchen in Hex Fiend kopiere) und ändere ihn manuell. </font><font style="vertical-align: inherit;">Seien Sie hier vorsichtig, Sie können alles kaputt machen, daher empfehle ich, die ausführbare Quelldatei irgendwo zu kopieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie dies getan haben, starten Sie das Spiel, gehen Sie zu den Optionen ... Und Prost - wir können "Hoch" auswählen. </font><font style="vertical-align: inherit;">Aber wir können nicht "mittel" wählen. </font><font style="vertical-align: inherit;">Und wir können die hohen Parameter der Schatten nicht verwenden. </font><font style="vertical-align: inherit;">Trotzdem machen wir Fortschritte!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3df/3a2/bba/3df3a2bbaa02e57ce2997e53137bdb56.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schauen Sie sich diese großartigen Reflexionen im Wasser an!</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbesserungen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Tat können Sie dies am besten beheben. Unsere Lösung hat funktioniert, aber wir können es so machen, dass die Bedingung korrekt erfüllt ist: Das Spiel denkt, dass unsere Grafikkarte tatsächlich Shader der Version 2.0 hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie wir uns erinnern, lädt das Spiel den Wert an die Adresse </font></font><code>eax+0xA2A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mit Hopper können Sie herausfinden, was ursprünglich dort aufgenommen wurde. Wir müssen einen Befehl finden, in dem 0xA2A8 als Empfängeroperand verwendet wird (ich habe 0xA2A8 gewählt, da es sich um einen ziemlich spezifischen Wert handelt und wir nicht sicher sein können, dass dasselbe Register nicht anderweitig verwendet wird). Hier ist die Hopper-Hintergrundbeleuchtung für uns sehr nützlich, da wir einfach auf 0xA2A8 klicken und nach den gelben Teilen in CFG suchen können.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/5ed/75b/bbd5ed75b7b712a39861769efc3f63cd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser Sieg ist etwas höher: Wie erwartet schreiben wir den Wert einer Art Gleitkommaregister. Ich gebe zu, dass ich nicht wirklich verstehe, was vorher passiert (meine beste Vermutung: Das Spiel prüft die Möglichkeit der Texturkomprimierung), aber das ist nicht besonders wichtig. Schreiben wir „2.0“ und setzen die Arbeit fort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu verwenden wir die "Assemble-Anweisung" der Hopper-Anwendung und führen dann die gleichen Manipulationen in Hex Fiend durch.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92d/3d1/637/92d3d1637e2c46321c9983f68ffda742.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/784/a8f/f5b/784a8ff5bb2755f378143d4740d4201f.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9b6/fed/ff0/9b6fedff0d7cbbeb9713c34513776468.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir verwenden MOV anstelle von MOVSS, weil wir den üblichen Wert und nicht den speziellen Wert des Gleitkommaregisters schreiben. Außerdem ist es in direkter Bytereihenfolge, dh invertiert.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sie werden feststellen, dass etwas Seltsames passiert: Wir haben das Team „gegessen“ </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies geschah, weil der neue Befehl mehr Bytes benötigt als der vorherige, und wie gesagt, wir können keine Daten zur ausführbaren Datei hinzufügen oder daraus entfernen, um Offsets zu speichern. Daher hat Hopper keine andere Wahl, als das Team zu zerstören </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies kann zu einem Problem werden, und wir können es beseitigen, indem wir den Befehl nach oben verschieben (schließlich müssen wir den xmm3-Wert nicht mehr schreiben). Dies wird hier funktionieren, da wir auf jeden Fall die Verzweigung auf dem richtigen Weg durchführen. Glücklich.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie das Spiel starten ... wird sich nicht viel ändern. </font><font style="vertical-align: inherit;">Ich schlug vor, dass die Intel 9-Serie nicht schnell genug ist, also beschwert sich das Spiel. </font><font style="vertical-align: inherit;">Dies ist kein Problem, denn in Wirklichkeit streben wir nach „Sehr hoch“. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was war die mächtigste Karte um 2004? </font><font style="vertical-align: inherit;">NVIDIA GeforceFX 6800. Lassen Sie uns das Spiel davon überzeugen, dass wir es installiert haben.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Den Hasenbau hinunter</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, dies ist ein völlig neuer Abschnitt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir wissen, dass das Spiel Hex-Codes verwendet, um auf Grafikkarten zu verweisen, und dass es Informationen aus Datendateien empfängt. Wir wissen, dass dies in der Funktion geschehen sollte, die wir studieren (zumindest wäre es seltsam, wenn es nicht so wäre). So können wir den Code finden, der dies tut. Aber es kann immer noch schwierig sein, weil wir nicht genau wissen, wonach wir suchen sollen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben einen Hinweis: Optionen verhalten sich seltsam, es gibt Niedrig / Hoch, aber kein Mittel. Vielleicht gibt es einen anderen Code, der all diese "Sehr hoch", "Hoch", "Mittel" und "Niedrig" behandelt. Und er ist tatsächlich in der gleichen Funktion. Er ist viel früher bei CFG und scheint interessant zu sein.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e73/73a/ea1/e7373aea138358b603c609d8704cfed0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir können davon ausgehen, dass die Rohdaten in einer Art XML gespeichert sind, da dies sehr wahrscheinlich ist, da es mehrere andere XML-Datendateien gibt. Und XML besteht im Wesentlichen aus einer Reihe von Zeigern und Attributen. Daher sucht der Code hier höchstwahrscheinlich nach einigen XML-Attributen (und in der Tat wird im Folgenden "eine der IDs, Sehr hoch ..." erwartet, was der Überprüfung der Richtigkeit der Datei sehr ähnlich ist). Wir können uns eine ähnliche XML-Struktur vorstellen, in der Boolesche Werte die Qualität von Shadern bestimmen:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e8/bf7/411/4e8bf7411dd677f1415ae71c887cbef5.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist zu bedenken, dass dies eine sehr willkürliche Vermutung ist. </font><font style="vertical-align: inherit;">Alles kann ein bisschen anders aussehen. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein sehr interessanter Teil wird auf der linken Seite des CFG angezeigt (für Sie kann es rechts sein, aber im Screenshot links): Wir sehen denselben </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, der im Code verwendet wird, der die Geräte-ID in das Protokoll schreibt. </font><font style="vertical-align: inherit;">Das heißt </font></font><code>ebp+var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, bezieht sich wahrscheinlich auf die ID unseres Geräts, 0x2773. </font><font style="vertical-align: inherit;">Das Seltsame ist, dass es beim ersten "Check" kein String-Literal gibt, aber dies ist ein Hopper-Fehler: Die Adresse 0x0089da8e enthält hexadezimale Daten 69006400, die in UTF-16 für "id" stehen (tatsächlich konnte Hopper dies wahrscheinlich nicht verstehen UTF16). </font><font style="vertical-align: inherit;">Und wir </font><font style="vertical-align: inherit;">suchen </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nur</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nach einem Ausweis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weißt du was? </font><font style="vertical-align: inherit;">Lassen Sie uns den Debugger ausführen und alles in der Realität überprüfen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spiel-Debugging</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Öffnen Sie ein Terminalfenster und führen Sie lldb aus (geben Sie einfach lldb ein und drücken Sie die Eingabetaste). Zuerst müssen wir LLDB anweisen, Alter 3 zu folgen, und dann können wir das Spiel durch einen Anruf starten </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Das Spiel beginnt und wir bekommen nichts Nützliches.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47b/0f2/279/47b0f227957a0414bc739002abafb432.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen wir einen Haltepunkt hinzufügen: Um unsere Annahmen zu bestätigen, möchten wir die Ausführung stoppen, wenn wir zu dem oben gezeigten Code gelangen. Wir haben keinen Quellcode, aber das spielt keine Rolle: Wir können einen Haltepunkt an der Speicheradresse festlegen. Und wir haben die Adresse im Code. Fügen wir einem MOV-Aufruf, der eine "ID" empfängt, einen Stopp hinzu. Die Adresse lautet 0x001d5e68. Um einen Haltepunkt hinzuzufügen, geben Sie einfach ein </font></font><code>br set -a 001D5E68</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Nach dem Start des Spiels wird es gestoppt und LLDB zeigt den zerlegten Code an (in der AT &amp; T-Syntax nicht Intel, daher werden alle Operanden invertiert, aber wir sehen, dass dies der gleiche Code ist). Möglicherweise stellen Sie fest, dass LLDB in diesem Fall tatsächlich intelligenter als Hopper ist. Er sagt uns, dass wir Operationen ausführen, die sich auf die XML- und Printf-Ausgabe beziehen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd0/2fa/07c/cd02fa07c9a2dbd13ed07558f0983595.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95d/fa6/710/95dfa671088f1c7097b439851f586b24.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lust auf einen Hacker? </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um fortzufahren, nehmen wir eine „Schrittanweisung“. </font><font style="vertical-align: inherit;">Ein kurzer Befehl dafür </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ist </font></font><code>ni</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wenn wir uns mehrmals wiederholen, bemerken wir, dass wir wieder da sind, wo wir angefangen haben. </font><font style="vertical-align: inherit;">Dies ist ein Zyklus! </font><font style="vertical-align: inherit;">Und das ist völlig logisch: Wir iterieren wahrscheinlich um eine Art XML. </font><font style="vertical-align: inherit;">Tatsächlich hat uns Hopper dies gezeigt - wenn wir der CFG folgen, werden wir einen (möglichen) Zyklus sehen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70f/63f/fdd/70f63ffddb8c3c073dcc257af70581d8.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies bedeutet:</font></font><code>if (*(ebp+var_CC) == *(ebp+var_28)) { *(ebp+var_1D84)=edi }</code></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Die Ausgangsbedingung ist, dass der Wert </font></font><code>ebp+var_1D84</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ungleich Null ist. </font><font style="vertical-align: inherit;">Und wir sehen einen interessanten Code-Parameter in dem von mir hervorgehobenen </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen </font></font><code>cmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir </font><font style="vertical-align: inherit;">diesem einen Haltepunkt hinzu </font><font style="vertical-align: inherit;">und wir werden es herausfinden.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a3/c32/d3a/9a3c32d3a01dd202e192648f5ef6609c.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/593/bc4/34d/593bc434d505cb29799846d61cb177bb.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links: Setzen Sie einen Haltepunkt auf dem CMP und setzen Sie die Ausführung fort. Rechts überwachen wir die Register und den Speicher.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wir betrachten Register mit </font></font><code>reg r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und den Wert des Gedächtnisses mit </font></font><code>mem read $ebp-0x28</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und enthält tatsächlich 0x2773, und der Wert im Speicher ist jetzt 0x00A0. Wenn Sie </font></font><code>thread c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es </font><font style="vertical-align: inherit;">mehrmals ausführen </font><font style="vertical-align: inherit;">, werden wir feststellen, dass bei der Suche nach Übereinstimmungen eine Iteration über verschiedene IDs erfolgt. Irgendwann stimmen die Werte überein, die Schleife wird beendet und das Spiel beginnt. Jetzt wissen wir, wie es geht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rufen Sie die Protokolldatei auf: Sie identifizierte sowohl das Gerät als auch den Hersteller. Wahrscheinlich gibt es irgendwo einen ähnlichen Zyklus für die Namen der Hersteller. Tatsächlich ist es sehr ähnlich und befindet sich in der CFG direkt über unserem Zyklus. Diese Schleife ist etwas einfacher und wir suchen nach der Zeichenfolge "Vendor". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diesmal ist der Vergleich mit</font></font><code>var_D0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Diese Variable wird tatsächlich als Hersteller-ID verwendet. </font><font style="vertical-align: inherit;">Wenn wir hier einen Haltepunkt setzen und alles überprüfen, sehen wir den bekannten 0x8086 bei </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und gleichzeitig findet ein Vergleich mit 0x10DE statt. </font><font style="vertical-align: inherit;">Schreiben wir es ein </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und sehen, was passiert.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4a/014/fd5/e4a014fd58bcc6408f48de1411db83b8.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/03b/9ce/7d0/03b9ce7d056048ecdf69987c3e8d774a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beeindruckend. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das heißt, 0x10DE ist NVIDIA. </font><font style="vertical-align: inherit;">Tatsächlich könnte man dies verstehen, wenn man eine Datendatei studiert, aber es ist nicht sehr interessant. </font><font style="vertical-align: inherit;">Die Frage ist nun: Wie lautet die Kennung des GeforceFX 6800? </font><font style="vertical-align: inherit;">Wir können LLDB verwenden und einfach jede Kennung überprüfen, aber es wird einige Zeit dauern (es gibt viele davon, ich habe versucht, die richtige zu finden). </font><font style="vertical-align: inherit;">Schauen wir uns diesmal also render.bar an.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbc/605/7f4/cbc6057f454e5ee95865324fea40e271.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angenommen, dies ist "XMB", die in Age 3 verwendete binäre Darstellung von XML.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Diese Datei ist ziemlich chaotisch. Nach den Geforce FX 6800-Tags werden jedoch mehrere Bezeichner angezeigt. Höchstwahrscheinlich brauchen wir einen von ihnen. Versuchen wir es mit 00F1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der einfachste Weg, dies zu testen, besteht darin, LLDB zu verwenden und die gewünschten Haltepunkte festzulegen. Ich werde diesen Schritt überspringen, aber ich werde sagen, dass 00F1 (zum Glück) aufgetaucht ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dieser Phase müssen wir die Frage beantworten: "Wie kann diese Änderung dauerhaft gemacht werden?" Es scheint, dass es einfacher sein wird, die Werte </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>var_D0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf 0X00F1 und 0X10DE </font><font style="vertical-align: inherit;">zu ändern </font><font style="vertical-align: inherit;">. Dazu müssen wir nur Platz für den Code schaffen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine einfache Lösung wäre, einen der Protokolldatensatzaufrufe durch einen NOP zu ersetzen, beispielsweise einen Subsystemaufruf. </font><font style="vertical-align: inherit;">Dies gibt uns mehrere zehn Bytes frei, und dies ist sogar mehr als nötig. </font><font style="vertical-align: inherit;">Lassen Sie uns all dies auswählen und durch NOP ersetzen. </font><font style="vertical-align: inherit;">Dann müssen wir nur noch Informationen mit den MOV-Variablen Assembler </font></font><code>mov dword [ebp+var_CC], 0xF1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">schreiben </font></font><code>mov dword [ebp+var_D0], 0x10DE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6f/eb6/d19/e6feb6d1903ca8305714594fe1911413.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/79c/096/783/79c096783f59920be40a85fdac85f44f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorher und nachher</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lassen Sie uns das Spiel starten. </font><font style="vertical-align: inherit;">Schließlich haben wir etwas erreicht: Sie können zwischen Niedrig, Mittel oder Hoch wählen und Hohe Parameter für Schatten aktivieren.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/370/8b5/7cb/3708b57cb8d0d5e405e54e4c5ee99eb8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber wir können Very High immer noch nicht aktivieren, und das ist traurig. </font><font style="vertical-align: inherit;">Was ist los?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e16/2e6/732/e162e673279757ba3cac035fa5f9b0f6.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ah, verstanden.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wie sich herausstellte, sollte der Geforce FX 6800 Pixel-Shader der Version 3.0 unterstützen, und wir stellen nur die Version 2.0 ein. Jetzt ist es für uns einfach, das Problem zu beheben: Schreiben Sie einfach 3.0-Gleitkommazahlen ein </font></font><code>ebp+0xA2A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dieser Wert ist 0x40400000. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schließlich ist das Spiel nicht mehr launisch und wir können sehr hohe Einstellungen genießen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3c/24e/2c1/f3c24e2c156feb16f1d34bf67aa33d5a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seltsam, aber es sieht ganz anders aus. Die Farben sind viel weniger lebendig und es ist ein bereichsabhängiger Nebel aufgetreten. Es gibt auch ein kleines Problem mit Schattenkonflikten (es ist auch in den obigen Screenshots zu sehen, dies liegt an den Parametern für hohe Schatten, nicht an der Qualität der Shader), die ich noch nicht lösen konnte.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Und dies ist das Ende unserer Reise, danke fürs Lesen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem werde ich Beispiele geben, wie jeder der Parameter im Spiel aussieht, da alle online gefundenen Screenshots schrecklich oder unvollständig sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Grafiken auf Medium sind durchaus akzeptabel, leiden jedoch unter einem Mangel an Schatten. Soweit ich das beurteilen kann, fügt Very High größtenteils eine völlig andere LUT hinzu (eine gute Erklärung für diesen Begriff finden Sie im Abschnitt Farbkorrektur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dieses Artikels.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), Nebel in der Ferne und vielleicht sogar ein ganz anderes Beleuchtungsmodell? </font><font style="vertical-align: inherit;">Das Bild ist sehr unterschiedlich und ziemlich seltsam.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5a/ed3/00d/b5aed300d967d53f67bf3e8798615525.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c8/0b8/bd7/1c80b8bd77a9cdfb4fdbd1da13146035.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45a/73b/776/45a73b7760497a9424b4e92984071e2c.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/817/12a/54c/81712a54ca17e71925eea886f628db3f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Von oben nach unten: Sehr hoch, Hoch (mit Optionen für hohen Schatten), Mittel (nur mit aktiviertem Schatten), Niedrig (mit deaktiviertem Schatten).</font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andere nützliche Links</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Blog, auf den ich oben verlinkt habe, enthält eine wunderbare Analyse moderner Rendering-Pipelines: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.adriancourreges.com/blog/</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Rate 0 AD ist ein Open-Source-RTS-Spiel des gleichen Genres: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://play0ad.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sie braucht Entwickler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie mehr über das XMB-Format erfahren möchten, können Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dessen Code in 0 AD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lesen </font><font style="vertical-align: inherit;">. Ich habe es nicht überprüft, bin mir aber ziemlich sicher, dass dies das gleiche Format ist, da die Person, die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den XMB-Decoder für Age 3 in Age of Empires Heaven geschrieben hat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , diese Dateien 2004 auch im 0 AD-Quellcode implementiert hat. Dies wird also eine unterhaltsame Lektion in Code-Paläontologie sein. Vielen Dank für die ganze Arbeit, Ykkrosh.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich erinnere mich genau, dass ich ein ausgezeichnetes Tutorial über die Verwendung von Hopper gelesen habe, aber jetzt kann ich den Link nicht finden. </font><font style="vertical-align: inherit;">Wenn jemand weiß, wovon ich spreche, dann lass den Link fallen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende möchte ich das Cosmic Frontier-Projekt erwähnen: ein Remake der klassischen Escape Velocity-Serie (mehr von Override, aber es ist auch mit Nova kompatibel). </font><font style="vertical-align: inherit;">Dies ist ein erstaunliches Spiel, und es ist sehr traurig, dass nur wenige Leute es wissen. </font><font style="vertical-align: inherit;">Jetzt haben die Entwickler eine Kampagne auf Kickstarter gestartet, und der Hauptentwickler hat einen sehr interessanten Entwickler- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in dem über die Verwendung von Hex Fiend zum Reverse Engineering von Datenformaten des Originalspiels gesprochen wird. </font><font style="vertical-align: inherit;">Dies ist eine großartige Lektüre. </font><font style="vertical-align: inherit;">Wenn Sie meinen, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mein Artikel</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> war verrückt. </font><font style="vertical-align: inherit;">dann in einem der Beiträge sie:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben den klassischen Mac-Emulator gestartet, um mithilfe der längst veralteten APIs eine verschlüsselte Datendatei zu lesen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reverse Engineering-Verschlüsselung aus dem Spielcode</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie verwendeten einen Dateisystem-Hack, um auf dieselben Daten auf einem modernen Mac zuzugreifen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, das sind wirklich leidenschaftliche Menschen, und ich hoffe, dass ihr Projekt erfolgreich abgeschlossen wird, denn EV Nova ist mein Lieblingsspiel.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de500516/index.html">Schnelle Übertragung von Instant Messenger - QIWI Android Wallet</a></li>
<li><a href="../de500518/index.html">Iterationen der Einführung von Scrum in einem Unternehmen</a></li>
<li><a href="../de500520/index.html">So verwenden Sie Ihre Anwendungen weltweit: 10 Tipps von CEO Wachanga</a></li>
<li><a href="../de500528/index.html">Über die Übersetzung von "Praxis" / "Praktikabilität" ohne Praxis / Praxis</a></li>
<li><a href="../de500530/index.html">Canvas API Memo</a></li>
<li><a href="../de500546/index.html">Erstellen Sie mit dem ODF Toolkit ein einfaches Tabellendokument</a></li>
<li><a href="../de500552/index.html">So beschleunigen Sie die Codeüberprüfung</a></li>
<li><a href="../de500554/index.html">Golang Backend Server Vorlage - Teil 2 (REST API)</a></li>
<li><a href="../de500556/index.html">Zwei Jahre digitale Transformation in zwei Monaten</a></li>
<li><a href="../de500558/index.html">Eine Auswahl von Artikeln zum maschinellen Lernen: Fallstudien, Leitfäden und Forschungsergebnisse für April 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>