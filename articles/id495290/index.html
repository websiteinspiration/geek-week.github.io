<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍽️ 🖕🏽 🦏 Menjelajahi kualitas kode sistem operasi Zephyr 🐏 😧 🤱🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami baru-baru ini mengatakan bahwa penganalisa kode PVS-Studio mulai berintegrasi dengan PlatformIO. Secara alami, tim pengembangan PVS-Studio berkom...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Menjelajahi kualitas kode sistem operasi Zephyr</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/495290/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ee/aeb/25b/4eeaeb25b1ec54a9016cec031ae97451.png" alt="PVS-Studio dan Zephyr"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami baru-baru ini mengatakan bahwa penganalisa kode PVS-Studio mulai berintegrasi dengan PlatformIO. </font><font style="vertical-align: inherit;">Secara alami, tim pengembangan PVS-Studio berkomunikasi dengan tim PlatformIO dan mereka menyarankan, demi kepentingan, memeriksa kode sistem operasi waktu-nyata Zephyr. </font><font style="vertical-align: inherit;">Kenapa tidak, kami pikir, dan di sini ada artikel tentang penelitian semacam itu.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlatformIO</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum memulai bagian utama artikel, saya ingin merekomendasikan proyek </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlatformIO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kepada pengembang sistem embedded </font><font style="vertical-align: inherit;">, yang dapat membuat hidup mereka lebih mudah. </font><font style="vertical-align: inherit;">Ini adalah alat pemrograman mikrokontroler lintas-platform. </font><font style="vertical-align: inherit;">Inti dari PlatformIO adalah alat baris perintah, tetapi disarankan untuk menggunakannya sebagai plug-in untuk Visual Studio Code. </font><font style="vertical-align: inherit;">Sejumlah besar chip dan motherboard modern yang didukungnya didukung. </font><font style="vertical-align: inherit;">Itu dapat secara otomatis mengunduh sistem perakitan yang sesuai, dan situs ini memiliki banyak koleksi perpustakaan untuk mengelola komponen elektronik plug-in.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio masih sedikit dikenal di dunia sistem embedded, jadi untuk berjaga-jaga, saya akan membuat pengantar untuk pembaca baru yang belum terbiasa dengan alat ini. </font><font style="vertical-align: inherit;">Pembaca reguler kami dapat langsung beralih ke bagian selanjutnya. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah penganalisa kode statis yang memungkinkan mendeteksi kesalahan dan potensi kerentanan dalam kode program yang ditulis dalam C, C ++, C # dan Java. </font><font style="vertical-align: inherit;">Jika kita hanya berbicara tentang C dan C ++, maka kompiler berikut ini didukung:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows </font><font style="vertical-align: inherit;">Visual Studio 2010-2019 C, C ++, C ++ / CLI, C ++ / CX (WinRT)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows </font><font style="vertical-align: inherit;">IAR Embedded Workbench, C / C ++ Compiler untuk ARM C, C ++</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows </font><font style="vertical-align: inherit;">QNX Momentics, QCC C, C ++</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows / Linux </font><font style="vertical-align: inherit;">Keil μVision, DS-MDK, ARM Compiler 5/6 C, C ++</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows / Linux </font><font style="vertical-align: inherit;">Studio Komposer Kode Texas Instruments, Alat Pembuatan Kode ARM C, C ++</font></font></li>
<li>Windows/Linux/macOS. GNU Arm Embedded Toolchain, Arm Embedded GCC compiler, C, C++</li>
<li>Windows/Linux/macOS. Clang C, C++</li>
<li>Linux/macOS. GCC C, C++</li>
<li>Windows. MinGW C, C++</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alat analisis memiliki </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> klasifikasi </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">peringatan</font></a><font style="vertical-align: inherit;"> sendiri </font><font style="vertical-align: inherit;">, tetapi jika perlu, Anda dapat mengaktifkan tampilan peringatan sesuai dengan standar pengkodean </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEI CERT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MISRA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat dengan cepat mulai secara teratur menggunakan PVS-Studio bahkan dalam proyek warisan besar. Mekanisme khusus untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">penindasan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> massal </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">peringatan</font></a><font style="vertical-align: inherit;"> diberikan untuk ini </font><font style="vertical-align: inherit;">. Semua peringatan saat ini dianggap sebagai hutang teknis dan disembunyikan, yang memungkinkan Anda untuk fokus pada peringatan yang hanya berlaku untuk kode yang baru atau yang dimodifikasi. Ini memungkinkan tim untuk segera mulai menggunakan alat analisa setiap hari dalam pekerjaan mereka, dan Anda dapat kembali ke tugas teknis dari waktu ke waktu dan meningkatkan kode.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada banyak skenario lain untuk menggunakan PVS-Studio. </font><font style="vertical-align: inherit;">Misalnya, Anda dapat menggunakannya sebagai plugin untuk SonarQube. </font><font style="vertical-align: inherit;">Integrasi dengan sistem seperti Travis CI, CircleCI, GitLab CI / CD, dll. Adalah mungkin. </font><font style="vertical-align: inherit;">Penjelasan lebih rinci tentang PVS-Studio berada di luar cakupan artikel ini. </font><font style="vertical-align: inherit;">Oleh karena itu, saya mengusulkan untuk membiasakan diri dengan artikel tersebut, yang memiliki banyak tautan bermanfaat, dan yang menjawab banyak pertanyaan: " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alasan untuk memperkenalkan penganalisa kode statis PVS-Studio ke dalam proses pengembangan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angin barat</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bekerja pada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">integrasi PVS-Studio ke dalam PlatformIO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tim kami berbicara dan diminta untuk memeriksa proyek dari dunia yang disematkan, yaitu Zephyr. </font><font style="vertical-align: inherit;">Kami menyukai ide itu, yang merupakan alasan untuk menulis artikel ini. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zephyr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah sistem operasi real-time ringan yang dirancang untuk bekerja pada perangkat dengan sumber daya terbatas dari berbagai arsitektur. </font><font style="vertical-align: inherit;">Kode didistribusikan di bawah lisensi open source Apache 2.0. </font><font style="vertical-align: inherit;">Bekerja pada platform berikut: ARM (Cortex-M0, Cortex-M3, Cortex-M4, Cortex-M23, Cortex-M33, Cortex-R4, Cortex-R5, Cortex-A53), x86, x86-64, ARC, RISC- V, Nios II, Xtensa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa fitur:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruang alamat terpadu. </font><font style="vertical-align: inherit;">Kode aplikasi spesifik dalam kombinasi dengan kernel kustom membuat gambar monolitik yang dijalankan pada perangkat.</font></font></li>
<li>  .     ,        .</li>
<li>    .       .</li>
<li>  .     .           .</li>
<li>    : ,  ,  ,     ,     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari momen-momen menarik bagi kami, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synopsys</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terlibat dalam pengembangan sistem operasi </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pada 2014, Synopsys mengakuisisi Coverity, yang menghasilkan penganalisa kode statis dengan nama yang sama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wajar jika sejak awal, pengembang Zephyr menggunakan penganalisa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coverity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Penganalisa adalah pemimpin pasar dan ini tidak bisa tidak mempengaruhi kualitas kode sistem operasi menjadi lebih baik.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kualitas Kode Zephyr</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut pendapat saya, kode sistem operasi Zephyr adalah kualitas. </font><font style="vertical-align: inherit;">Inilah yang memberi saya alasan untuk berpikir demikian:</font></font><br>
<br>
<ul>
<li> PVS-Studio  122     High  367   Medium.  , ,    560 C/C++ .     .       7810 C/C++   10075  . ,     . ,      ,          .</li>
<li>       .    «» ,   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilitas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SourceMonitor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , setelah menganalisis kode sumber, memberikan statistik bahwa 48% dari kode adalah komentar. </font><font style="vertical-align: inherit;">Ini banyak dan dalam pengalaman saya menunjukkan perhatian yang tinggi terhadap kualitas kode, kelengkapannya untuk pengembang lain.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat mengembangkan proyek, penganalisa kode statis Coverity digunakan. </font><font style="vertical-align: inherit;">Kemungkinan besar, karena fakta ini, penganalisa PVS-Studio, meskipun menemukan kesalahan dalam proyek, tidak dapat menunjukkan dirinya dengan jelas, seperti yang kadang-kadang terjadi ketika menganalisis proyek lain.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berdasarkan ini, saya percaya bahwa penulis proyek peduli tentang kualitas dan keandalan kode. </font><font style="vertical-align: inherit;">Mari sekarang kita lihat beberapa peringatan yang dikeluarkan oleh alat analisa PVS-Studio (versi 7.06).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan semi-salah</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode proyek, karena tingkatannya yang rendah, ditulis dengan sangat spesifik dan dengan banyak kompilasi bersyarat (#ifdef). Ini menghasilkan sejumlah besar peringatan yang tidak menunjukkan kesalahan nyata, tetapi mereka tidak bisa disebut hanya salah. Akan lebih mudah untuk mengklarifikasi ini dengan beberapa contoh. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh aktuasi “semi-salah” N1</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">char_framebuffer</span> <span class="hljs-title">char_fb</span>;</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cfb_framebuffer_invert</span><span class="hljs-params">(struct device *dev)</span>
</span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">char_framebuffer</span> *<span class="hljs-title">fb</span> = &amp;<span class="hljs-title">char_fb</span>;</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!fb || !fb-&gt;buf) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  fb-&gt;inverted = !fb-&gt;inverted;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagian dari ekspresi kondisional selalu salah </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">:! Fb</font></a><font style="vertical-align: inherit;"> . cfb.c 188 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat mengambil alamat variabel statis, selalu ada pointer non-nol. Oleh karena itu, pointer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selalu non-nol dan verifikasi tidak masuk akal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, jelas bahwa ini bukan kesalahan sama sekali, tetapi hanya pemeriksaan berlebihan, yang tidak membahayakan. Selain itu, ketika membangun versi Rilis, kompiler akan membuangnya, jadi ini bahkan tidak akan menyebabkan perlambatan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kasus serupa, dalam pemahaman saya, berada di bawah konsep operasi analisa "semi-false". Secara formal, alat analisa itu benar sekali. Dan lebih baik untuk menghapus cek tambahan yang tidak berguna dari kode. Namun, semua ini sepele dan peringatan semacam itu bahkan tidak menarik untuk dipertimbangkan dalam kerangka artikel.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh aktuasi "semi-potong" dari N2</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">hex2char</span><span class="hljs-params">(<span class="hljs-keyword">u8_t</span> x, <span class="hljs-keyword">char</span> *c)</span>
</span>{
  <span class="hljs-keyword">if</span> (x &lt;= <span class="hljs-number">9</span>) {<font></font>
    *c = x + <span class="hljs-string">'0'</span>;<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &gt;= <span class="hljs-number">10</span> &amp;&amp; x &lt;= <span class="hljs-number">15</span>) {<font></font>
    *c = x - <span class="hljs-number">10</span> + <span class="hljs-string">'a'</span>;<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> -EINVAL;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagian dari ekspresi kondisional selalu benar: x&gt; = 10. hex.c 31 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analiser lagi benar secara formal dalam menyatakan bahwa bagian dari kondisi selalu benar. </font><font style="vertical-align: inherit;">Jika variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak kurang dari / sama dengan 9, maka ternyata selalu lebih besar dari / sama dengan 10. Dan kode dapat disederhanakan:</font></font><br>
<br>
<pre><code class="cpp hljs">} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &lt;= <span class="hljs-number">15</span>) {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekali lagi, jelas bahwa tidak ada kesalahan berbahaya yang nyata di sini, dan perbandingan tambahan ditulis hanya untuk keindahan kode. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang mari kita lihat contoh N3 yang lebih kompleks.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pertama, mari kita lihat bagaimana makro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHECKIF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat diimplementasikan </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(CONFIG_ASSERT_ON_ERRORS)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHECKIF(expr) \
  __ASSERT_NO_MSG(!(expr));   \
  <span class="hljs-meta-keyword">if</span> (0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">elif</span> defined(CONFIG_NO_RUNTIME_CHECKS)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHECKIF(...) \
  <span class="hljs-meta-keyword">if</span> (0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHECKIF(expr) \
  <span class="hljs-meta-keyword">if</span> (expr)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bergantung pada mode kompilasi proyek, pemeriksaan dapat dilakukan atau dilewati. </font><font style="vertical-align: inherit;">Dalam kasus kami, ketika memeriksa kode menggunakan PVS-Studio, implementasi makro ini dipilih:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHECKIF(expr) \
  <span class="hljs-meta-keyword">if</span> (expr)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat apa yang menyebabkan hal ini.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">k_queue_append_list</span><span class="hljs-params">(struct k_queue *<span class="hljs-built_in">queue</span>, <span class="hljs-keyword">void</span> *head, <span class="hljs-keyword">void</span> *tail)</span>
</span>{<font></font>
  CHECKIF(head == <span class="hljs-literal">NULL</span> || tail == <span class="hljs-literal">NULL</span>) {
    <span class="hljs-keyword">return</span> -EINVAL;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">k_spinlock_key_t</span> key = k_spin_lock(&amp;<span class="hljs-built_in">queue</span>-&gt;lock);
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">k_thread</span> *<span class="hljs-title">thread</span> = <span class="hljs-title">NULL</span>;</span>
  <span class="hljs-keyword">if</span> (head != <span class="hljs-literal">NULL</span>) {<font></font>
    thread = z_unpend_first_thread(&amp;<span class="hljs-built_in">queue</span>-&gt;wait_q);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;"> [CWE-571] Ekspresi 'head! = NULL' selalu benar. </font><font style="vertical-align: inherit;">queue.c 244 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penganalisa menganggap bahwa memeriksa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(head! = NULL)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selalu memberikan true. </font><font style="vertical-align: inherit;">Dan memang benar. </font><font style="vertical-align: inherit;">Jika penunjuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kepala</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NULL, maka fungsi akan berhenti bekerja karena centang di awal fungsi:</font></font><br>
<br>
<pre><code class="cpp hljs">CHECKIF(head == <span class="hljs-literal">NULL</span> || tail == <span class="hljs-literal">NULL</span>) {
  <span class="hljs-keyword">return</span> -EINVAL;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingatlah bahwa di sini makro diperluas sebagai berikut:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (head == <span class="hljs-literal">NULL</span> || tail == <span class="hljs-literal">NULL</span>) {
  <span class="hljs-keyword">return</span> -EINVAL;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, analisa PVS-Studio tepat dari sudut pandangnya dan mengeluarkan peringatan yang benar. </font><font style="vertical-align: inherit;">Namun, pemeriksaan ini tidak dapat dihapus. </font><font style="vertical-align: inherit;">Dia dibutuhkan. </font><font style="vertical-align: inherit;">Dalam skenario lain, makro akan terbuka seperti ini:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (<span class="hljs-number">0</span>) {
  <span class="hljs-keyword">return</span> -EINVAL;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kemudian memeriksa kembali pointer diperlukan. </font><font style="vertical-align: inherit;">Tentu saja, penganalisa tidak akan menghasilkan peringatan dalam versi kompilasi kode ini. </font><font style="vertical-align: inherit;">Namun, itu memberikan peringatan untuk versi debug kompilasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harap sekarang jelas bagi pembaca dari mana peringatan "semi-salah" berasal. </font><font style="vertical-align: inherit;">Namun, tidak ada yang salah dengan mereka. </font><font style="vertical-align: inherit;">Alat analisis PVS-Studio menyediakan berbagai mekanisme untuk menekan peringatan palsu, yang dapat ditemukan dalam dokumentasi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Kasus</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi apakah Anda menemukan sesuatu yang menarik? </font><font style="vertical-align: inherit;">Itu sukses, dan sekarang kita akan melihat berbagai kesalahan. </font><font style="vertical-align: inherit;">Dalam hal ini, saya ingin segera mencatat dua poin:</font></font><br>
<br>
<ol>
<li>       .  :   , , ,      Coverity. ,     PVS-Studio  -  ,               . </li>
<li>            . ,             «»      .      ,          .         GitHub,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a> PVS-Studio.</li>
</ol><br>
<b> N1, </b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">gen_prov_ack</span><span class="hljs-params">(struct prov_rx *rx, struct net_buf_simple *buf)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (link.tx.cb &amp;&amp; link.tx.cb) {<font></font>
    link.tx.cb(<span class="hljs-number">0</span>, link.tx.cb_data);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-571] Ada sub-ekspresi yang identik di sebelah kiri dan di sebelah kanan operator '&amp;&amp;': link.tx.cb &amp;&amp; link.tx.cb pb_adv.c 377 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu diperiksa dua kali </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link.tx.cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variabel yang sama </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Rupanya, ini adalah salah ketik, dan variabel kedua yang akan diperiksa adalah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link.tx.cb_data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N2, </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">meluap </font></i><b><font style="vertical-align: inherit;">buffer</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pertimbangkan fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net_hostname_get</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang akan digunakan nanti.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(CONFIG_NET_HOSTNAME_ENABLE)</span>
<span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">net_hostname_get</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">net_hostname_get</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">"zephyr"</span>;<font></font>
}<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus saya, saat preprocessing, opsi yang terkait dengan cabang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#else dipilih</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Artinya, dalam file yang telah diproses, fungsi diimplementasikan seperti ini:</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">net_hostname_get</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">"zephyr"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi mengembalikan pointer ke array 7 byte (kami memperhitungkan terminal nol di akhir baris). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang perhatikan kode yang mengarah ke keluar dari batas array.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">do_net_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  ....<font></font>
  (<span class="hljs-keyword">void</span>)<span class="hljs-built_in">memcpy</span>(hostname, net_hostname_get(), MAX_HOSTNAME_LEN);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V512</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-119] Panggilan fungsi 'memcpy' akan menyebabkan buffer 'net_hostname_get ()' menjadi di luar jangkauan. </font><font style="vertical-align: inherit;">log_backend_net.c 114 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah preprocessing, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_HOSTNAME_LEN</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diperluas sebagai berikut:</font></font><br>
<br>
<pre><code class="cpp hljs">(<span class="hljs-keyword">void</span>)<span class="hljs-built_in">memcpy</span>(hostname, net_hostname_get(),
    <span class="hljs-keyword">sizeof</span>(<span class="hljs-string">"xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx"</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karenanya, saat menyalin data, string literal di luar batas terjadi. </font><font style="vertical-align: inherit;">Sulit untuk memprediksi bagaimana ini akan mempengaruhi pelaksanaan program, karena ini mengarah pada perilaku yang tidak terdefinisi. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N3, buffer overrun potensial</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">do_write_op_json</span><span class="hljs-params">(struct lwm2m_message *msg)</span>
</span>{
  <span class="hljs-keyword">u8_t</span> value[TOKEN_BUF_LEN];
  <span class="hljs-keyword">u8_t</span> base_name[MAX_RESOURCE_LEN];
  <span class="hljs-keyword">u8_t</span> full_name[MAX_RESOURCE_LEN];<font></font>
  ....<font></font>
  <span class="hljs-comment">/* combine base_name + name */</span>
  <span class="hljs-built_in">snprintf</span>(full_name, TOKEN_BUF_LEN, <span class="hljs-string">"%s%s"</span>, base_name, value);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V512</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-119] Panggilan fungsi 'snprintf' akan menyebabkan meluapnya buffer 'full_name'. lwm2m_rw_json.c 826 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita mengganti nilai makro, gambar dari apa yang terjadi terlihat seperti ini:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">u8_t</span> value[<span class="hljs-number">64</span>];
<span class="hljs-keyword">u8_t</span> base_name[<span class="hljs-number">20</span>];
<span class="hljs-keyword">u8_t</span> full_name[<span class="hljs-number">20</span>];<font></font>
....<font></font>
<span class="hljs-built_in">snprintf</span>(full_name, <span class="hljs-number">64</span>, <span class="hljs-string">"%s%s"</span>, base_name, value);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hanya 20 byte yang dialokasikan di </font><font style="vertical-align: inherit;">
bawah buffer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">full_name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di mana string terbentuk. Dalam hal ini, bagian-bagian dari mana string terbentuk disimpan dalam buffer berukuran 20 dan 64 byte. Selain itu, konstanta 64, diteruskan ke fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snprintf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan dirancang untuk mencegah array pergi ke luar negeri, jelas terlalu besar! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode ini tidak selalu mengarah ke buffer overflow. Mungkin selalu beruntung, dan substring selalu sangat kecil. Namun, secara umum, kode ini tidak dilindungi dari meluap dengan cara apa pun dan mengandung cacat keamanan klasik </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-119</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N4, ekspresi selalu benar</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">keys_set</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name, <span class="hljs-keyword">size_t</span> len_rd, settings_read_cb read_cb,
                    <span class="hljs-keyword">void</span> *cb_arg)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">size_t</span> len;<font></font>
  ....<font></font>
  len = read_cb(cb_arg, val, <span class="hljs-keyword">sizeof</span>(val));
  <span class="hljs-keyword">if</span> (len &lt; <span class="hljs-number">0</span>) {<font></font>
    BT_ERR(<span class="hljs-string">"Failed to read value (err %zu)"</span>, len);
    <span class="hljs-keyword">return</span> -EINVAL;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;"> [CWE-570] Ekspresi 'len &lt;0' selalu salah. </font><font style="vertical-align: inherit;">Nilai tipe yang tidak ditandatangani tidak pernah &lt;0. Keys.c 312 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memiliki tipe yang tidak ditandatangani dan, oleh karena itu, tidak boleh kurang dari 0. Dengan demikian, status kesalahan tidak diproses dengan cara apa pun. </font><font style="vertical-align: inherit;">Di tempat lain </font><font style="vertical-align: inherit;">, tipe </font><i><font style="vertical-align: inherit;">int</font></i><font style="vertical-align: inherit;"> atau </font><i><font style="vertical-align: inherit;">ssize_t</font></i><font style="vertical-align: inherit;"> digunakan </font><font style="vertical-align: inherit;">untuk menyimpan hasil fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">read_cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Contoh:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">mesh_x_set</span><span class="hljs-params">(....)</span>
</span>{
 <span class="hljs-keyword">ssize_t</span> len;<font></font>
 len = read_cb(cb_arg, out, read_len);<font></font>
 <span class="hljs-keyword">if</span> (len &lt; <span class="hljs-number">0</span>) {<font></font>
 ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semuanya </font><font style="vertical-align: inherit;">tampak </font><font style="vertical-align: inherit;">buruk </font><font style="vertical-align: inherit;">dengan fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">read_cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Faktanya adalah dinyatakan seperti ini:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">u8_t</span> <span class="hljs-title">read_cb</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct bt_gatt_attr *attr, <span class="hljs-keyword">void</span> *user_data)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jenis </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u8_t</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">karakter yang tidak ditandai. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi selalu mengembalikan hanya angka positif dari tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jika Anda meletakkan nilai ini dalam variabel bertanda tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssize_t</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , semuanya sama, nilainya akan selalu positif. </font><font style="vertical-align: inherit;">Karenanya, di tempat lain, memeriksa status kesalahan juga tidak berfungsi. </font><font style="vertical-align: inherit;">Tapi saya tidak mempelajari studi masalah ini. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N5, sesuatu yang sangat aneh</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">mntpt_prepare</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *mntpt)</span>
</span>{
  <span class="hljs-keyword">char</span> *cpy_mntpt;<font></font>
<font></font>
  cpy_mntpt = k_malloc(<span class="hljs-built_in">strlen</span>(mntpt) + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">if</span> (cpy_mntpt) {<font></font>
    ((<span class="hljs-keyword">u8_t</span> *)mntpt)[<span class="hljs-built_in">strlen</span>(mntpt)] = <span class="hljs-string">'\0'</span>;
    <span class="hljs-built_in">memcpy</span>(cpy_mntpt, mntpt, <span class="hljs-built_in">strlen</span>(mntpt));<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> cpy_mntpt;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V575</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-628] Fungsi 'memcpy' tidak menyalin seluruh string. </font><font style="vertical-align: inherit;">Gunakan fungsi 'strcpy / strcpy_s' untuk mempertahankan terminal null. </font><font style="vertical-align: inherit;">shell.c 427</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/11e/bb5/367/11ebb53676d77d0d9418b626de856106.png" alt="Kode aneh"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seseorang mencoba membuat analog dari fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strdup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi ia tidak berhasil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan peringatan penganalisa. </font><font style="vertical-align: inherit;">Ini melaporkan bahwa fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menyalin baris, tetapi tidak menyalin terminal nol, dan ini sangat mencurigakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya terminal 0 ini disalin di sini:</font></font><br>
<br>
<pre><code class="cpp hljs">((<span class="hljs-keyword">u8_t</span> *)mntpt)[<span class="hljs-built_in">strlen</span>(mntpt)] = <span class="hljs-string">'\0'</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi tidak! </font><font style="vertical-align: inherit;">Ini salah ketik, karena terminal nol disalin ke dirinya sendiri! </font><font style="vertical-align: inherit;">Perhatikan bahwa menulis ke array </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mntpt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , bukan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpy_mntpt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Akibatnya, fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mntpt_prepare</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengembalikan string yang tidak lengkap dengan nol terminal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahkan, programmer ingin menulis seperti ini:</font></font><br>
<br>
<pre><code class="cpp hljs">((<span class="hljs-keyword">u8_t</span> *)cpy_mntpt)[<span class="hljs-built_in">strlen</span>(mntpt)] = <span class="hljs-string">'\0'</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, masih belum jelas mengapa begitu rumit! </font><font style="vertical-align: inherit;">Kode ini dapat disederhanakan ke opsi berikut:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">mntpt_prepare</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *mntpt)</span>
</span>{
  <span class="hljs-keyword">char</span> *cpy_mntpt;<font></font>
<font></font>
  cpy_mntpt = k_malloc(<span class="hljs-built_in">strlen</span>(mntpt) + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">if</span> (cpy_mntpt) {
    <span class="hljs-built_in">strcpy</span>(cpy_mntpt, mntpt);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> cpy_mntpt;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N6, mendereferensi pointer sebelum validasi</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bt_mesh_model_publish</span><span class="hljs-params">(struct bt_mesh_model *model)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_mesh_model_pub</span> *<span class="hljs-title">pub</span> = <span class="hljs-title">model</span>-&gt;<span class="hljs-title">pub</span>;</span><font></font>
  ....<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_mesh_msg_ctx</span> <span class="hljs-title">ctx</span> = {</span><font></font>
    .send_rel = pub-&gt;send_rel,<font></font>
  };<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (!pub) {
    <span class="hljs-keyword">return</span> -ENOTSUP;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-476] Pointer 'pub' digunakan sebelum diverifikasi terhadap nullptr. </font><font style="vertical-align: inherit;">Periksa baris: 708, 719. access.c 708 </font><font style="vertical-align: inherit;">Pola kesalahan yang </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sangat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">umum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pertama, pointer direferensikan untuk menginisialisasi anggota struktur:</font></font><br>
<br>
<pre><code class="cpp hljs">.send_rel = pub-&gt;send_rel,</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan hanya kemudian mengikuti cek bahwa pointer ini bisa menjadi nol. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N7-N9, pointer dereferencing sebelum validasi</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">net_tcp_accept</span><span class="hljs-params">(struct net_context *context, <span class="hljs-keyword">net_tcp_accept_cb_t</span> cb,
                   <span class="hljs-keyword">void</span> *user_data)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcp</span> *<span class="hljs-title">conn</span> = <span class="hljs-title">context</span>-&gt;<span class="hljs-title">tcp</span>;</span><font></font>
  ....<font></font>
  conn-&gt;accept_cb = cb;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!conn || conn-&gt;state != TCP_LISTEN) {
    <span class="hljs-keyword">return</span> -EINVAL;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-476] Pointer 'conn' digunakan sebelum diverifikasi terhadap nullptr. </font><font style="vertical-align: inherit;">Periksa baris: 1071, 1073. tcp2.c 1071 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sama seperti pada kasus sebelumnya. </font><font style="vertical-align: inherit;">Penjelasan tidak diperlukan di sini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dua kesalahan serupa dapat dilihat di sini:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595 [CWE-476] Pointer 'context-&gt; tcp' digunakan sebelum diverifikasi terhadap nullptr. </font><font style="vertical-align: inherit;">Periksa baris: 1512, 1518. tcp.c 1512</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595 [CWE-476] Pointer 'fsm' digunakan sebelum diverifikasi terhadap nullptr. </font><font style="vertical-align: inherit;">Periksa baris: 365, 382. fsm.c 365</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N10, periksa salah</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">x509_get_subject_alt_name</span><span class="hljs-params">( <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> **p,
                                      <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *end,
                                      mbedtls_x509_sequence *subject_alt_name)</span>
</span>{<font></font>
  ....<font></font>
    <span class="hljs-keyword">while</span>( *p &lt; end )<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span>( ( end - *p ) &lt; <span class="hljs-number">1</span> )
            <span class="hljs-keyword">return</span>( MBEDTLS_ERR_X509_INVALID_EXTENSIONS +<font></font>
                    MBEDTLS_ERR_ASN1_OUT_OF_DATA );<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;"> [CWE-570] Ekspresi '(akhir - * p) &lt;1' ​​selalu salah. </font><font style="vertical-align: inherit;">x509_crt.c 635 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lihatlah dengan </font><font style="vertical-align: inherit;">seksama </font><font style="vertical-align: inherit;">kondisi:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* p &lt;end</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(akhir - * p) &lt;1</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mereka saling bertentangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika (* p &lt;end), maka (end - * p) akan selalu memberikan nilai 1 atau lebih. </font><font style="vertical-align: inherit;">Secara umum, ada sesuatu yang salah di sini, tapi saya tidak tahu cara mengejanya dengan benar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N11, kode tidak terjangkau</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">lv_disp_get_inactive_time</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">lv_disp_t</span> * disp)</span>
</span>{
    <span class="hljs-keyword">if</span>(!disp) disp = lv_disp_get_default();
    <span class="hljs-keyword">if</span>(!disp) {<font></font>
        LV_LOG_WARN(<span class="hljs-string">"lv_disp_get_inactive_time: no display registered"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(disp) <span class="hljs-keyword">return</span> lv_tick_elaps(disp-&gt;last_activity_time);<font></font>
<font></font>
    <span class="hljs-keyword">lv_disp_t</span> * d;
    <span class="hljs-keyword">uint32_t</span> t = UINT32_MAX;<font></font>
    d          = lv_disp_get_next(<span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">while</span>(d) {<font></font>
        t = LV_MATH_MIN(t, lv_tick_elaps(d-&gt;last_activity_time));<font></font>
        d = lv_disp_get_next(d);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> t;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V547</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-571] Ekspresi 'disp' selalu benar. lv_disp.c 148 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi berakhir jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah null pointer. Kemudian, sebaliknya, diperiksa bahwa pointer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bukan null (dan ini selalu terjadi), dan fungsinya kembali menyelesaikan pekerjaannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, bagian dari kode dalam suatu fungsi tidak akan pernah mendapatkan kontrol sama sekali. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N12, nilai balik yang aneh</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">size_t</span> <span class="hljs-title">put_end_tlv</span><span class="hljs-params">(struct lwm2m_output_context *out, <span class="hljs-keyword">u16_t</span> mark_pos,
        <span class="hljs-keyword">u8_t</span> *writer_flags, <span class="hljs-keyword">u8_t</span> writer_flag,
        <span class="hljs-keyword">int</span> tlv_type, <span class="hljs-keyword">int</span> tlv_id)</span>
</span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tlv_out_formatter_data</span> *<span class="hljs-title">fd</span>;</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">oma_tlv</span> <span class="hljs-title">tlv</span>;</span>
  <span class="hljs-keyword">u32_t</span> len = <span class="hljs-number">0U</span>;<font></font>
<font></font>
  fd = engine_get_out_user_data(out);<font></font>
  <span class="hljs-keyword">if</span> (!fd) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
  }<font></font>
<font></font>
  *writer_flags &amp;= ~writer_flag;<font></font>
<font></font>
  len = out-&gt;out_cpkt-&gt;offset - mark_pos;<font></font>
<font></font>
  <span class="hljs-comment">/* use stored location */</span><font></font>
  fd-&gt;mark_pos = mark_pos;<font></font>
<font></font>
  <span class="hljs-comment">/* set instance length */</span><font></font>
  tlv_setup(&amp;tlv, tlv_type, tlv_id, len);<font></font>
  len = oma_tlv_put(&amp;tlv, out, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">true</span>) - tlv.length;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warning: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1001 Variabel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'len' diberikan tetapi tidak digunakan pada akhir fungsi. </font><font style="vertical-align: inherit;">lwm2m_rw_oma_tlv.c 338 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi ini berisi dua </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pernyataan pengembalian</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang keduanya mengembalikan 0. Aneh bahwa fungsi selalu mengembalikan 0. Juga aneh bahwa variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak lagi digunakan setelah penugasan. </font><font style="vertical-align: inherit;">Saya memiliki kecurigaan besar bahwa itu seharusnya ditulis seperti ini:</font></font><br>
<br>
<pre><code class="cpp hljs">  len = oma_tlv_put(&amp;tlv, out, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">true</span>) - tlv.length;
  <span class="hljs-keyword">return</span> len;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen N13-N16, kesalahan sinkronisasi</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">nvs_startup</span><span class="hljs-params">(struct nvs_fs *fs)</span>
</span>{<font></font>
  ....<font></font>
  k_mutex_lock(&amp;fs-&gt;nvs_lock, K_FOREVER);<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (fs-&gt;ate_wra == fs-&gt;data_wra &amp;&amp; last_ate.len) {
    <span class="hljs-keyword">return</span> -ESPIPE;<font></font>
  }<font></font>
  ....<font></font>
end:<font></font>
  k_mutex_unlock(&amp;fs-&gt;nvs_lock);<font></font>
  <span class="hljs-keyword">return</span> rc;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fungsi keluar tanpa memanggil fungsi 'k_mutex_unlock'. </font><font style="vertical-align: inherit;">Periksa baris: 620, 549. nvs.c 620 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada situasi ketika fungsi menyelesaikan tugasnya tanpa membuka kunci mutex. </font><font style="vertical-align: inherit;">Seperti yang saya pahami, itu akan benar untuk menulis seperti ini:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">nvs_startup</span><span class="hljs-params">(struct nvs_fs *fs)</span>
</span>{<font></font>
  ....<font></font>
  k_mutex_lock(&amp;fs-&gt;nvs_lock, K_FOREVER);<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (fs-&gt;ate_wra == fs-&gt;data_wra &amp;&amp; last_ate.len) {<font></font>
    rc = -ESPIPE;<font></font>
    <span class="hljs-keyword">goto</span> end;<font></font>
  }<font></font>
  ....<font></font>
end:<font></font>
  k_mutex_unlock(&amp;fs-&gt;nvs_lock);<font></font>
  <span class="hljs-keyword">return</span> rc;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tiga kesalahan lainnya:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1020 Fungsi keluar tanpa memanggil fungsi 'k_mutex_unlock'. </font><font style="vertical-align: inherit;">Periksa baris: 574, 549. nvs.c 574</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1020 Fungsi keluar tanpa memanggil fungsi 'k_mutex_unlock'. </font><font style="vertical-align: inherit;">Periksa baris: 908, 890. net_context.c 908</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1020 Fungsi keluar tanpa memanggil fungsi 'k_mutex_unlock'. </font><font style="vertical-align: inherit;">Periksa baris: 1194, 1189. shell.c 1194</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harap Anda menikmatinya. Kunjungi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami </font><font style="vertical-align: inherit;">untuk membaca tentang pemeriksaan pada proyek lain dan publikasi menarik lainnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gunakan analisis statis dalam pekerjaan Anda untuk mengurangi jumlah kesalahan dan kerentanan potensial bahkan pada tahap penulisan kode. Terutama deteksi kesalahan dini adalah relevan untuk sistem embedded, memperbarui program yang seringkali memakan waktu dan proses yang mahal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya juga menyarankan untuk tidak menunda dan mencoba memeriksa proyek Anda menggunakan penganalisa PVS-Studio. Lihat artikel: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara cepat melihat peringatan menarik yang dihasilkan oleh alat analisa PVS-Studio untuk kode C dan C ++?</font></font></a><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Andrey Karpov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memeriksa Kode Sistem Operasi Zephyr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495274/index.html">Cara memperbaiki kebocoran rute</a></li>
<li><a href="../id495276/index.html">Dan tunjukkan, atau Bagaimana kami melewati audit Keberlanjutan Operasional di Uptime Institute</a></li>
<li><a href="../id495278/index.html">Database, kartu, daftar periksa, atau Mengapa manajer pengetahuan bisnis</a></li>
<li><a href="../id495280/index.html">Max Patrol SIEM. Keamanan Informasi Ikhtisar Sistem Manajemen Kejadian</a></li>
<li><a href="../id495282/index.html">Validasi XML menggunakan XSD, JAXB, dan Spring Framework</a></li>
<li><a href="../id495292/index.html">InterSystems IRIS 2020.1 Rilis</a></li>
<li><a href="../id495294/index.html">Macro untuk pythonist. Laporan Yandex</a></li>
<li><a href="../id495296/index.html">Forensik, injeksi SQL, dan kucing yang lama menderita: analisis tugas No. 3 dari panggung online NeoQUEST-2020</a></li>
<li><a href="../id495298/index.html">Evaluasi Pilihan Monte Carlo Clojure</a></li>
<li><a href="../id495302/index.html">Cara meningkatkan penjualan 2,5 kali dalam 4 bulan di toko online - sebuah kasus untuk promosi SEO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>