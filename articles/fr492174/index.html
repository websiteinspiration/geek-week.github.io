<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🏭 👩‍🔬 🙋 Moniteur sans fil d'humidité du sol 💱 👼🏾 🗯️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salutations à tous les lecteurs de Habr! Aujourd'hui, je veux partager avec vous mon nouveau projet - un capteur d'humidité du sol sans fil, qui est c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Moniteur sans fil d'humidité du sol</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492174/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salutations à tous les lecteurs de Habr! Aujourd'hui, je veux partager avec vous mon nouveau projet - un capteur d'humidité du sol sans fil, qui est construit sur la base du module d'humidité du sol bien connu avec aliexpress. Le nouveau capteur est une suite logique de mon premier projet DIY sur ce sujet. Mais dans la nouvelle implémentation, ce n'est plus un module Arduino, mais un appareil complet avec son propre boîtier. Alors, bouillie de la hache, deuxième partie! :)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k9/ea/gd/k9eagdijc2lxr-garqi6eooxuxm.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module chinois de mesure de l'humidité du sol est construit sur une minuterie 555. La méthode de mesure est capacitive. Pour mon projet, j'avais besoin d'une version du module avec le régulateur de tension XC6206P332 installé à 3,3 V, qui à l'avenir devra être retiré de la carte du module. Le fait est que dans de telles versions, nous utilisons une modification de la minuterie TLC555 avec un seuil inférieur pour une alimentation de 2V. Dans les versions sans stabilisateur, les minuteries NE555 sont utilisées avec un seuil de puissance inférieur de 5V. Mais en tout cas, ce qui est plus facile à acheter pour répéter ce projet, c'est l'affaire d'un répéteur. Dans la première option, nous soudons le régulateur de tension, dans la seconde, nous changeons la minuterie, par exemple en une comme celle-ci - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LMC555</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) fonctionnant même à partir de 1,5 V. Pour le module sans fil au capteur d'humidité du sol chinois, j'ai choisi un module radio d'EBYTE E73C sur lequel la puce nRF52840 est installée. L'argument était le prix du module et le montant disponible de ces modules dans mes réserves. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e4/c4/3t/e4c43tfn22ihs1-ywelmsoikjwq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module sans fil s'est avéré être très simple, une LED RVB, quelques boutons, un transistor à effet de champ, une batterie. Même la soudure débutante la plus inexpérimentée peut assembler un tel appareil. Sur le capteur d'humidité, en plus de retirer le stabilisateur de tension, il est également nécessaire de dessouder le connecteur et de souder la fiche mâle 3P à sa place, pas 2,54 mm. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les dimensions de la carte se sont avérées être légèrement plus petites que dans le premier projet - 42x29 mm, déterminées par la taille du support de batterie.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tw/oq/sj/twoqsjaebwgnyxb9xl1lzao174m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le boîtier a été imprimé sur mon imprimante SLA ANYCUBIC. Le temps d'impression des pièces est de l'ordre de quelques heures. Le post-traitement ultérieur a pris environ une demi-heure. Le coût de la résine polymère usée est de ~ 100r. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consommation en mode veille - 4,7 mA, en mode transmission 8 mA. L'intervalle de mesure est variable, étape 1 minute. Temps de mesure 50 ms (5 mesures dans le programme de test), consommation pendant la mesure ~ 1 mA. Il mesure également la température de la puce, mesure le niveau de la batterie. Transfert de données vers le contrôleur UD via le réseau Mysensors, transfert de données vers le contrôleur UD via le réseau Zigbee. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code des programmes de test est sur mon Github. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple de travail dans le réseau Mysensors et Mazhordomo UD. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4t/cx/xc/4tcxxc4zmsos7jw_bpb0k_rojc4.png"><br>
<br>
<img src="https://habrastorage.org/webt/lg/ni/c8/lgnic80mcvhmva1ifxmjr_afluy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple de travail sur le réseau ZigBee et Mazhordomo UD</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ev/-q/bv/ev-qbvfynpoemmo0w5l7iijqnvw.png"><br>
<br>
<img src="https://habrastorage.org/webt/dh/m6/yh/dhm6yhm6l7o6btdqyfhq2onmlpo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code de configuration du convertisseur dans le module zigbee2mqtt pour le capteur d'humidité (pas encore sûr si c'est la bonne solution). </font></font><br>
<br>
<pre><code class="javascript hljs">{
        <span class="hljs-attr">zigbeeModel</span>: [<span class="hljs-string">'nrf52840.ru_PWS'</span>],
        <span class="hljs-attr">model</span>: <span class="hljs-string">'nrf52840.ru_PWS'</span>,
        <span class="hljs-attr">vendor</span>: <span class="hljs-string">'nrf52840.ru'</span>,
        <span class="hljs-attr">description</span>: <span class="hljs-string">'Plant watering sensor'</span>,
        <span class="hljs-attr">supports</span>: <span class="hljs-string">'humidity'</span>,
		<span class="hljs-attr">fromZigbee</span>: [fz.humidity2, fz.battery_PWS],
        <span class="hljs-attr">toZigbee</span>: [],
		<span class="hljs-attr">meta</span>: {<span class="hljs-attr">configureKey</span>: <span class="hljs-number">1</span>},
        <span class="hljs-attr">configure</span>: <span class="hljs-keyword">async</span> (device, coordinatorEndpoint) =&gt; {
            <span class="hljs-keyword">const</span> endpoint = device.getEndpoint(<span class="hljs-number">10</span>);
			<span class="hljs-keyword">await</span> bind(endpoint, coordinatorEndpoint, [<span class="hljs-string">'msRelativeHumidity'</span>, <span class="hljs-string">'genPowerCfg'</span>]);
            <span class="hljs-keyword">await</span> configureReporting.humidity(endpoint);
			<span class="hljs-keyword">await</span> configureReporting.batteryVoltage(endpoint);<font></font>
        },<font></font>
    },<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/vs/iv/6f/vsiv6fyhbwc0ns9spmifwe1a5g8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le firmware du test a été écrit par l'un des participants de notre communauté DIY - Lenz, voici son </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GIthub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le coût des composants qui devaient être ajoutés à l'humidimètre chinois était d'environ 400 à 500 roubles. </font><font style="vertical-align: inherit;">À mon avis, ce n'est pas mal du tout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vidéo de fonctionnement du capteur</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/LTzc0X-ESm4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photo du capteur</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/pw/is/l2/pwisl2sjbuwgpytlnqtttmikphc.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/oq/12/oi/oq12oihawzfhxgkf9topgaaohgq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/da/sk/h7/daskh7kfgzsgkqsgytolve37ixg.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yo/nu/34/yonu34vue48s2vdub5vlil9fdne.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/rv/kd/va/rvkdvaawgrkepxu2tb5ho5dmw4c.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/z2/ez/pg/z2ezpg7vbscf6w68ucainaan0b0.jpeg"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'autres plans pour ce projet. Je voudrais remplacer le MK par quelque chose de plus simple, par exemple, avec nRF52810 ou nRF52811, mais tout dépendra du prix, vous devrez probablement abandonner les modules radio et simplement le faire sur une puce. Je vais peut-être penser à ajouter un buzzer, c'est très probablement le stabilisateur de puissance, car maintenant vous devez prendre en compte la tension d'alimentation lors de la mesure. Mettez la version Zigbee à un état stable, faites la version BLE, faites une application d'affichage mobile. En général, il y aura certainement autre chose. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github de ce projet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si vous êtes intéressé par ce projet, je vous propose d'aller au groupe des télégrammes, il y aura toujours de l'aide pour maîtriser les protocoles Maysensors, Zigbee, BLE sur nRF5, ils aideront à maîtriser la programmation nRF52 dans Arduino IDE et pas seulement dedans. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cart Cart - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@DIY Devices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cart Cart - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@MySensors</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492162/index.html">Interfaces oculaires. Signaler dans Yandex</a></li>
<li><a href="../fr492164/index.html">Passerelle vers le ciel ou la ville du futur</a></li>
<li><a href="../fr492166/index.html">Widgets sur Android. Une caractéristique rare à comprendre</a></li>
<li><a href="../fr492168/index.html">Travail de front sur le développement back-end des plus grands portails sur les logiciels open source: partage d'expérience</a></li>
<li><a href="../fr492172/index.html">Sauvegarde fine des systèmes de fichiers Linux. Comment créer des copies de travail d'un SGBD MySQL de trois téraoctets en 20 secondes</a></li>
<li><a href="../fr492178/index.html">Un chemin de sept mille pixels: évolution des résolutions d'écran et de nos exigences</a></li>
<li><a href="../fr492182/index.html">Fondements de la sécurité de l'information chez Microsoft Teams</a></li>
<li><a href="../fr492184/index.html">Forbes a discuté avec les représentants du marché de la préinstallation obligatoire des logiciels russes. Nous avons sélectionné les points principaux</a></li>
<li><a href="../fr492186/index.html">Populaire sur les articles en anglais</a></li>
<li><a href="../fr492190/index.html">Russian SaaS 2019 - résultats</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>