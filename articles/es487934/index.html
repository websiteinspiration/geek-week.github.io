<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍁 👆🏿 👨🏾‍🔬 Cómo optimizamos nuestro servidor DNS usando las herramientas GO ⚡️ 🕳️ 👩🏽‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En previsión del inicio de una nueva transmisión en el curso "Developer Golang" preparó una traducción de material interesante.
 
 
 
 Nuestro servido...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cómo optimizamos nuestro servidor DNS usando las herramientas GO</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/487934/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En previsión del inicio de una nueva transmisión en el curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Developer Golang"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> preparó una traducción de material interesante.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/_m/nk/zf/_mnkzfy1x9apnfm5u3hikc54-7w.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor DNS autorizado es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilizado por decenas de miles de sitios web. </font><font style="vertical-align: inherit;">Respondemos a millones de consultas diarias. </font><font style="vertical-align: inherit;">Hoy en día, los ataques de DNS se están volviendo cada vez más comunes, el DNS es una parte importante de nuestro sistema, y ​​debemos asegurarnos de que podamos trabajar bien bajo una gran carga. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnsflood</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una pequeña herramienta que puede generar una gran cantidad de solicitudes de udp.</font></font><br>
<br>
<pre><code class="go hljs"># timeout <span class="hljs-number">20</span>s ./dnsflood example.com <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> -p <span class="hljs-number">2053</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El monitoreo del sistema mostró que el uso de memoria de nuestro servicio creció tan rápido que tuvimos que detenerlo, de lo contrario nos encontraríamos con errores OOM. </font><font style="vertical-align: inherit;">Fue como un problema de pérdida de memoria; </font><font style="vertical-align: inherit;">Hay varias razones para la pérdida de memoria "similar" y "real":</font></font><a name="habracut"></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colgando gorutinas</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mal uso del aplazamiento y finalizador</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subcadenas y subcortes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variables globales</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta publicación</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proporciona una explicación detallada de varias fugas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de sacar conclusiones, primero realicemos un perfil.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Godebug</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se pueden habilitar varias herramientas de depuración utilizando una variable de entorno </font></font><code>GODEBUG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pasando una lista de pares separados por comas </font></font><code>name=value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Planificador de seguimiento</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El seguimiento del planificador puede proporcionar información sobre el comportamiento de la rutina en tiempo de ejecución. </font><font style="vertical-align: inherit;">Para habilitar el seguimiento del planificador, ejecute el programa con </font></font><code>GODEBUG=schedtrace=100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, el valor determina el período de salida en ms.</font></font><br>
 <br>
<pre><code class="go hljs">$ GODEBUG=schedtrace=<span class="hljs-number">100</span> ./redins -c config.json<font></font>
SCHED <span class="hljs-number">2952</span>ms: ... runqueue=<span class="hljs-number">3</span> [<span class="hljs-number">26</span> <span class="hljs-number">11</span> <span class="hljs-number">7</span> <span class="hljs-number">18</span> <span class="hljs-number">13</span> <span class="hljs-number">30</span> <span class="hljs-number">6</span> <span class="hljs-number">3</span> <span class="hljs-number">24</span> <span class="hljs-number">25</span> <span class="hljs-number">11</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">3053</span>ms: ... runqueue=<span class="hljs-number">3</span> [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">3154</span>ms: ... runqueue=<span class="hljs-number">0</span> [<span class="hljs-number">0</span> <span class="hljs-number">6</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">30</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">11</span> <span class="hljs-number">2</span> <span class="hljs-number">5</span>]<font></font>
SCHED <span class="hljs-number">3255</span>ms: ... runqueue=<span class="hljs-number">1</span> [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">3355</span>ms: ... runqueue=<span class="hljs-number">0</span> [<span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">3456</span>ms: ... runqueue=<span class="hljs-number">0</span> [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">3557</span>ms: ... runqueue=<span class="hljs-number">0</span> [<span class="hljs-number">13</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">33</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">10</span> <span class="hljs-number">8</span> <span class="hljs-number">10</span> <span class="hljs-number">14</span>]<font></font>
SCHED <span class="hljs-number">3657</span>ms: ...runqueue=<span class="hljs-number">3</span> [<span class="hljs-number">14</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">19</span> <span class="hljs-number">54</span> <span class="hljs-number">9</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">29</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">3758</span>ms: ... runqueue=<span class="hljs-number">0</span> [<span class="hljs-number">67</span> <span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">87</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">3859</span>ms: ... runqueue=<span class="hljs-number">6</span> [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">2</span> <span class="hljs-number">19</span>]<font></font>
SCHED <span class="hljs-number">3960</span>ms: ... runqueue=<span class="hljs-number">0</span> [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">4060</span>ms: ... runqueue=<span class="hljs-number">5</span> [<span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">4161</span>ms: ... runqueue=<span class="hljs-number">0</span> [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">4262</span>ms: ... runqueue=<span class="hljs-number">4</span> [<span class="hljs-number">0</span> <span class="hljs-number">128</span> <span class="hljs-number">21</span> <span class="hljs-number">172</span> <span class="hljs-number">1</span> <span class="hljs-number">19</span> <span class="hljs-number">8</span> <span class="hljs-number">2</span> <span class="hljs-number">43</span> <span class="hljs-number">5</span> <span class="hljs-number">139</span> <span class="hljs-number">37</span>]<font></font>
SCHED <span class="hljs-number">4362</span>ms: ... runqueue=<span class="hljs-number">0</span> [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">4463</span>ms: ... runqueue=<span class="hljs-number">6</span> [<span class="hljs-number">0</span> <span class="hljs-number">28</span> <span class="hljs-number">23</span> <span class="hljs-number">39</span> <span class="hljs-number">4</span> <span class="hljs-number">11</span> <span class="hljs-number">4</span> <span class="hljs-number">11</span> <span class="hljs-number">25</span> <span class="hljs-number">0</span> <span class="hljs-number">25</span> <span class="hljs-number">0</span>]<font></font>
SCHED <span class="hljs-number">4564</span>ms: ... runqueue=<span class="hljs-number">354</span> [<span class="hljs-number">51</span> <span class="hljs-number">45</span> <span class="hljs-number">33</span> <span class="hljs-number">32</span> <span class="hljs-number">15</span> <span class="hljs-number">20</span> <span class="hljs-number">8</span> <span class="hljs-number">7</span> <span class="hljs-number">5</span> <span class="hljs-number">42</span> <span class="hljs-number">6</span> <span class="hljs-number">0</span>]</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runqueue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es la longitud de la cola global de goroutines para ejecutar. </font><font style="vertical-align: inherit;">Los números entre paréntesis son la longitud de la cola del proceso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La situación ideal es cuando todos los procesos están ocupados ejecutando goroutines, y la longitud moderada de la cola de ejecución se distribuye uniformemente entre todos los procesos:</font></font><br>
<br>
<pre><code class="go hljs">SCHED <span class="hljs-number">2449</span>ms: gomaxprocs=<span class="hljs-number">12</span> idleprocs=<span class="hljs-number">0</span> threads=<span class="hljs-number">40</span> spinningthreads=<span class="hljs-number">1</span> idlethreads=<span class="hljs-number">1</span> runqueue=<span class="hljs-number">20</span> [<span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span> <span class="hljs-number">20</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">observar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la salida de </font><i><font style="vertical-align: inherit;">schedtrace</font></i><font style="vertical-align: inherit;"> , podemos ver períodos de tiempo en que casi todos los procesos están inactivos. </font><font style="vertical-align: inherit;">Esto significa que no estamos utilizando el procesador a plena capacidad.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rastro de recolector de basura</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para habilitar el rastreo de recolección de basura (GC), ejecute el programa con una variable de entorno </font></font><code>GODEBUG=gctrace=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
 <br>
<pre><code class="go hljs">GODEBUG=gctrace=<span class="hljs-number">1</span> ./redins -c config1.json<font></font>
.<font></font>
.<font></font>
.<font></font>
gc <span class="hljs-number">30</span> @<span class="hljs-number">3.727</span>s <span class="hljs-number">1</span>%: <span class="hljs-number">0.066</span>+<span class="hljs-number">21</span>+<span class="hljs-number">0.093</span> ms clock, <span class="hljs-number">0.79</span>+<span class="hljs-number">128</span>/<span class="hljs-number">59</span>/<span class="hljs-number">0</span>+<span class="hljs-number">1.1</span> ms cpu, <span class="hljs-number">67</span>-&gt;<span class="hljs-number">71</span>-&gt;<span class="hljs-number">45</span> MB, <span class="hljs-number">76</span> MB goal, <span class="hljs-number">12</span> P<font></font>
gc <span class="hljs-number">31</span> @<span class="hljs-number">3.784</span>s <span class="hljs-number">2</span>%: <span class="hljs-number">0.030</span>+<span class="hljs-number">27</span>+<span class="hljs-number">0.053</span> ms clock, <span class="hljs-number">0.36</span>+<span class="hljs-number">177</span>/<span class="hljs-number">81</span>/<span class="hljs-number">7.8</span>+<span class="hljs-number">0.63</span> ms cpu, <span class="hljs-number">79</span>-&gt;<span class="hljs-number">84</span>-&gt;<span class="hljs-number">55</span> MB, <span class="hljs-number">90</span> MB goal, <span class="hljs-number">12</span> P<font></font>
gc <span class="hljs-number">32</span> @<span class="hljs-number">3.858</span>s <span class="hljs-number">3</span>%: <span class="hljs-number">0.026</span>+<span class="hljs-number">34</span>+<span class="hljs-number">0.024</span> ms clock, <span class="hljs-number">0.32</span>+<span class="hljs-number">234</span>/<span class="hljs-number">104</span>/<span class="hljs-number">0</span>+<span class="hljs-number">0.29</span> ms cpu, <span class="hljs-number">96</span>-&gt;<span class="hljs-number">100</span>-&gt;<span class="hljs-number">65</span> MB, <span class="hljs-number">110</span> MB goal, <span class="hljs-number">12</span> P<font></font>
gc <span class="hljs-number">33</span> @<span class="hljs-number">3.954</span>s <span class="hljs-number">3</span>%: <span class="hljs-number">0.026</span>+<span class="hljs-number">44</span>+<span class="hljs-number">0.13</span> ms clock, <span class="hljs-number">0.32</span>+<span class="hljs-number">191</span>/<span class="hljs-number">131</span>/<span class="hljs-number">57</span>+<span class="hljs-number">1.6</span> ms cpu, <span class="hljs-number">117</span>-&gt;<span class="hljs-number">123</span>-&gt;<span class="hljs-number">79</span> MB, <span class="hljs-number">131</span> MB goal, <span class="hljs-number">12</span> P<font></font>
gc <span class="hljs-number">34</span> @<span class="hljs-number">4.077</span>s <span class="hljs-number">4</span>%: <span class="hljs-number">0.010</span>+<span class="hljs-number">53</span>+<span class="hljs-number">0.024</span> ms clock, <span class="hljs-number">0.12</span>+<span class="hljs-number">241</span>/<span class="hljs-number">159</span>/<span class="hljs-number">69</span>+<span class="hljs-number">0.29</span> ms cpu, <span class="hljs-number">142</span>-&gt;<span class="hljs-number">147</span>-&gt;<span class="hljs-number">91</span> MB, <span class="hljs-number">158</span> MB goal, <span class="hljs-number">12</span> P<font></font>
gc <span class="hljs-number">35</span> @<span class="hljs-number">4.228</span>s <span class="hljs-number">5</span>%: <span class="hljs-number">0.017</span>+<span class="hljs-number">61</span>+<span class="hljs-number">0.12</span> ms clock, <span class="hljs-number">0.20</span>+<span class="hljs-number">296</span>/<span class="hljs-number">179</span>/<span class="hljs-number">94</span>+<span class="hljs-number">1.5</span> ms cpu, <span class="hljs-number">166</span>-&gt;<span class="hljs-number">174</span>-&gt;<span class="hljs-number">105</span> MB, <span class="hljs-number">182</span> MB goal, <span class="hljs-number">12</span> P<font></font>
gc <span class="hljs-number">36</span> @<span class="hljs-number">4.391</span>s <span class="hljs-number">6</span>%: <span class="hljs-number">0.017</span>+<span class="hljs-number">73</span>+<span class="hljs-number">0.086</span> ms clock, <span class="hljs-number">0.21</span>+<span class="hljs-number">492</span>/<span class="hljs-number">216</span>/<span class="hljs-number">4.0</span>+<span class="hljs-number">1.0</span> ms cpu, <span class="hljs-number">191</span>-&gt;<span class="hljs-number">198</span>-&gt;<span class="hljs-number">122</span> MB, <span class="hljs-number">210</span> MB goal, <span class="hljs-number">12</span> P<font></font>
gc <span class="hljs-number">37</span> @<span class="hljs-number">4.590</span>s <span class="hljs-number">7</span>%: <span class="hljs-number">0.049</span>+<span class="hljs-number">85</span>+<span class="hljs-number">0.095</span> ms clock, <span class="hljs-number">0.59</span>+<span class="hljs-number">618</span>/<span class="hljs-number">253</span>/<span class="hljs-number">0</span>+<span class="hljs-number">1.1</span> ms cpu, <span class="hljs-number">222</span>-&gt;<span class="hljs-number">230</span>-&gt;<span class="hljs-number">140</span> MB, <span class="hljs-number">244</span> MB goal, <span class="hljs-number">12</span> P<font></font>
.<font></font>
.<font></font>
.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como vemos aquí, la cantidad de memoria utilizada aumenta, y la cantidad de tiempo que gc tarda en completar su trabajo también aumenta. </font><font style="vertical-align: inherit;">Esto significa que consumimos más memoria de la que puede manejar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede </font></font><code>GODEBUG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtener </font><font style="vertical-align: inherit;">más información </font><font style="vertical-align: inherit;">y algunas otras variables de entorno de golang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habilitar Profiler</font></font></h4><br>
<code>go tool pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Una herramienta para analizar y perfilar datos. </font><font style="vertical-align: inherit;">Hay dos formas de configurar </font></font><code>pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: llamar directamente a funciones </font></font><code>runtime/pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en su código, por ejemplo </font></font><code>pprof.StartCPUProfile()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o instalar un </font></font><code>net/http/pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listado de http y obtener datos de allí, lo cual hicimos. </font><font style="vertical-align: inherit;">Tiene un </font></font><code>pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consumo de recursos muy pequeño, por lo que se puede usar de forma segura en el desarrollo, pero el punto final del perfil no debe estar disponible públicamente, ya que se pueden divulgar datos confidenciales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo lo que necesitamos hacer para la segunda opción es importar el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paquete "net / http / pprof"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
 <br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> (<font></font>
  _ <span class="hljs-string">"net/http/pprof"</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
luego agregue un http listner:</font></font><br>
 <br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<font></font>
  log.Println(http.ListenAndServe(<span class="hljs-string">"localhost:6060"</span>, <span class="hljs-literal">nil</span>))<font></font>
}()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pprof tiene varios perfiles predeterminados:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allocs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : busca todas las asignaciones de memoria pasadas</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : seguimiento de pila que condujo al bloqueo de primitivas de sincronización</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">goroutine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : seguimiento de la pila de todas las goroutines actuales</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">heap</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : busca asignaciones de memoria de objetos vivos.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mutex</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : seguimiento de pila de titulares de mutex en conflicto</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perfil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">perfil del</font></b><font style="vertical-align: inherit;"> procesador.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threadcreate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un seguimiento de pila que condujo a la creación de nuevos hilos en el sistema operativo</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trace</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : rastrea la ejecución del programa actual.</font></font></li>
</ul><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: el punto final de seguimiento, a diferencia de todos los demás puntos finales, es un perfil de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguimiento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pprof</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en su lugar puede verlo con la herramienta go trace </font></font><code>go tool pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora que todo está listo, podemos ver las herramientas disponibles.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfilador de procesador</font></font></h4><br>
<pre><code class="go hljs">‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍$ <span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:6060/debug/pprof/profile?seconds=10</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El generador de perfiles del procesador por defecto funciona durante 30 segundos (podemos cambiar esto configurando el parámetro </font></font><code>seconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) y recoge muestras cada 100 milisegundos, después de lo cual pasa al modo interactivo. </font><font style="vertical-align: inherit;">Los comandos más comunes están disponibles </font></font><code>top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>web</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use </font></font><code>top n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para ver las entradas más populares en formato de texto, también hay dos opciones para ordenar la salida, </font></font><code>-cum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por orden acumulativo y </font></font><code>-flat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
 <br>
<pre><code class="go hljs">(pprof) top <span class="hljs-number">10</span> -cum<font></font>
Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">1.50</span>s, <span class="hljs-number">6.19</span>% of <span class="hljs-number">24.23</span>s total<font></font>
Dropped <span class="hljs-number">347</span> nodes (cum &lt;= <span class="hljs-number">0.12</span>s)<font></font>
Showing top <span class="hljs-number">10</span> nodes out of <span class="hljs-number">186</span><font></font>
flat  flat%   sum%  cum   cum%<font></font>
<span class="hljs-number">0.03</span>s <span class="hljs-number">0.12</span>% <span class="hljs-number">0.12</span>% <span class="hljs-number">16.7</span>s <span class="hljs-number">69.13</span>% (*Server).serveUDPPacket
<span class="hljs-number">0.05</span>s <span class="hljs-number">0.21</span>% <span class="hljs-number">0.33</span>% <span class="hljs-number">15.6</span>s <span class="hljs-number">64.51</span>% (*Server).serveDNS
<span class="hljs-number">0</span>     <span class="hljs-number">0</span>%    <span class="hljs-number">0.33</span>% <span class="hljs-number">14.3</span>s <span class="hljs-number">59.10</span>% (*ServeMux).ServeDNS
<span class="hljs-number">0</span>     <span class="hljs-number">0</span>%    <span class="hljs-number">0.33</span>% <span class="hljs-number">14.2</span>s <span class="hljs-number">58.73</span>% HandlerFunc.ServeDNS
<span class="hljs-number">0.01</span>s <span class="hljs-number">0.04</span>% <span class="hljs-number">0.37</span>% <span class="hljs-number">14.2</span>s <span class="hljs-number">58.73</span>% main.handleRequest
<span class="hljs-number">0.07</span>s <span class="hljs-number">0.29</span>% <span class="hljs-number">0.66</span>% <span class="hljs-number">13.5</span>s <span class="hljs-number">56.00</span>% (*DnsRequestHandler).HandleRequest
<span class="hljs-number">0.99</span>s <span class="hljs-number">4.09</span>% <span class="hljs-number">4.75</span>% <span class="hljs-number">7.56</span>s <span class="hljs-number">31.20</span>% runtime.gentraceback
<span class="hljs-number">0.02</span>s <span class="hljs-number">0.08</span>% <span class="hljs-number">4.83</span>% <span class="hljs-number">7.02</span>s <span class="hljs-number">28.97</span>% runtime.systemstack
<span class="hljs-number">0.31</span>s <span class="hljs-number">1.28</span>% <span class="hljs-number">6.11</span>% <span class="hljs-number">6.62</span>s <span class="hljs-number">27.32</span>% runtime.mallocgc
<span class="hljs-number">0.02</span>s <span class="hljs-number">0.08</span>% <span class="hljs-number">6.19</span>% <span class="hljs-number">6.35</span>s <span class="hljs-number">26.21</span>% (*DnsRequestHandler).FindANAME<font></font>
(pprof)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
utilizar </font></font><code>list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para explorar la función.</font></font><br>
<br>
<pre><code class="go hljs">(pprof) list handleRequest<font></font>
Total: <span class="hljs-number">24.23</span>s<font></font>
ROUTINE ======================== main.handleRequest in /home/arash/<span class="hljs-keyword">go</span>/src/arvancloud/redins/redins.<span class="hljs-keyword">go</span>
     <span class="hljs-number">10</span>ms     <span class="hljs-number">14.23</span>s (flat, cum) <span class="hljs-number">58.73</span>% of Total<font></font>
        .          .     <span class="hljs-number">35</span>: l          *handler.RateLimiter<font></font>
        .          .     <span class="hljs-number">36</span>: configFile <span class="hljs-keyword">string</span>
        .          .     <span class="hljs-number">37</span>:)<font></font>
        .          .     <span class="hljs-number">38</span>:<font></font>
        .          .     <span class="hljs-number">39</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleRequest</span><span class="hljs-params">(w dns.ResponseWriter, r *dns.Msg)</span></span> {
     <span class="hljs-number">10</span>ms      <span class="hljs-number">610</span>ms     <span class="hljs-number">40</span>: context := handler.NewRequestContext(w, r)<font></font>
        .       <span class="hljs-number">50</span>ms     <span class="hljs-number">41</span>: logger.Default.Debugf(<span class="hljs-string">"handle request: [%d] %s %s"</span>, r.Id, context.RawName(), context.Type())<font></font>
        .          .     <span class="hljs-number">42</span>:<font></font>
        .          .     <span class="hljs-number">43</span>: <span class="hljs-keyword">if</span> l.CanHandle(context.IP()) {<font></font>
        .     <span class="hljs-number">13.57</span>s     <span class="hljs-number">44</span>:  h.HandleRequest(context)<font></font>
        .          .     <span class="hljs-number">45</span>: } <span class="hljs-keyword">else</span> {<font></font>
        .          .     <span class="hljs-number">46</span>:  context.Response(dns.RcodeRefused)<font></font>
        .          .     <span class="hljs-number">47</span>: }<font></font>
        .          .     <span class="hljs-number">48</span>:}<font></font>
        .          .     <span class="hljs-number">49</span>:<font></font>
(pprof)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El equipo </font></font><code>web</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">genera un gráfico SVG de áreas críticas y lo abre en el navegador. </font></font><br>
<br>
<code>(pprof)web handleReques</code><br>
<br>
<img src="https://habrastorage.org/webt/bt/hi/di/bthidimalsguoeg_obuzzmzy7ro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una gran cantidad de tiempo dedicado a las funciones de GC, como </font></font><code>runtime.mallocgc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a menudo resulta en una asignación de memoria significativa, lo que puede agregar carga al recolector de basura y aumentar la latencia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una gran cantidad de tiempo dedicado a los mecanismos de sincronización, como </font></font><code>runtime.chansend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font><code>runtime.lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puede ser un signo de conflicto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una gran cantidad de tiempo dedicado </font></font><code>syscall.Read/Write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa el uso excesivo de las operaciones de E / S.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfilador de memoria</font></font></h4><br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:6060/debug/pprof/allocs</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por defecto, muestra la vida útil de la memoria asignada. </font><font style="vertical-align: inherit;">Podemos ver la cantidad de objetos seleccionados usando </font></font><code>-alloc_objects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">otras opciones útiles: </font></font><code>-iuse_objects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>-inuse_space</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para verificar la </font><font style="vertical-align: inherit;">memoria en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vivo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo general, si desea reducir el consumo de memoria, debe tener en cuenta </font></font><code>-inuse_space</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero si desea reducir la latencia, tenga en cuenta el </font></font><code>-alloc_objects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiempo suficiente de ejecución / carga.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identificación de un cuello de botella.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es importante determinar primero el tipo de cuello de botella (procesador, E / S, memoria) con el que estamos tratando. </font><font style="vertical-align: inherit;">Además de los perfiladores, hay otro tipo de herramienta. </font></font><br>
<br>
<code>go tool trace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede mostrar lo que hacen las gorutinas en detalle. </font><font style="vertical-align: inherit;">Para recopilar un ejemplo de rastreo, debemos enviar una solicitud http al punto final de rastreo:</font></font><br>
<br>
<pre><code class="go hljs">$ curl http:<span class="hljs-comment">//localhost:6060/debug/pprof/trace?seconds=5 --output trace.out</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El archivo generado se puede ver con la herramienta de seguimiento:</font></font><br>
 <br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> tool trace trace.out
<span class="hljs-number">2019</span>/<span class="hljs-number">12</span>/<span class="hljs-number">25</span> <span class="hljs-number">15</span>:<span class="hljs-number">30</span>:<span class="hljs-number">50</span> Parsing trace...
<span class="hljs-number">2019</span>/<span class="hljs-number">12</span>/<span class="hljs-number">25</span> <span class="hljs-number">15</span>:<span class="hljs-number">30</span>:<span class="hljs-number">59</span> Splitting trace...
<span class="hljs-number">2019</span>/<span class="hljs-number">12</span>/<span class="hljs-number">25</span> <span class="hljs-number">15</span>:<span class="hljs-number">31</span>:<span class="hljs-number">10</span> Opening browser. Trace viewer is listening on http:<span class="hljs-comment">//127.0.0.1:42703</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go tool trace es una aplicación web que utiliza el protocolo Chrome DevTools y es compatible solo con los navegadores Chrome. La página principal se ve así: </font></font><br>
 <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (0s-409.575266ms) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (411.075559ms-747.252311ms) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (747.252311ms-1.234968945s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (1.234968945s-1.774245108s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (1.774245484s-2.111339514s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (2.111339514s-2.674030898s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (2.674031362s-3.044145798s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (3.044145798s-3.458795252s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (3.43953778s-4.075080634s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver seguimiento (4.075081098s-4.439271287s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver35 4.439 -4.814869651s) </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver traza (4.814869651s-5.253597835s) </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Análisis de Goroutine </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil de bloqueo de red ()</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El bloqueo de la sincronización de perfiles () </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SYSCALL perfil de bloqueo () </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programador de latencia del perfil () </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las tareas definidas por el usuario </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las regiones definidas por el usuario para RentAircraft </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al mínimo la utilización mutador</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
traza divide la traza de modo que su navegador puede manejarlo </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xx/xa/pf/xxxapfdolkivu1jce6axclwsmqg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una gran variedad de datos, lo que los hace casi ilegibles si No sabemos lo que estamos buscando. Dejémoslo por ahora. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente enlace en la página principal es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"análisis de gorutina"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que muestra los diferentes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipos de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gorutinas </font><i><font style="vertical-align: inherit;">de</font></i><font style="vertical-align: inherit;"> trabajo en el programa durante el período de rastreo:</font></font><br>
 <br>
<pre><code class="go hljs">Goroutines:<font></font>
github.com/miekg/dns.(*Server).serveUDPPacket N=<span class="hljs-number">441703</span>
runtime.gcBgMarkWorker N=<span class="hljs-number">12</span>
github.com/karlseguin/ccache.(*Cache).worker N=<span class="hljs-number">2</span>
main.Start.func1 N=<span class="hljs-number">1</span>
runtime.bgsweep N=<span class="hljs-number">1</span>
arvancloud/redins/handler.NewHandler.func2 N=<span class="hljs-number">1</span>
runtime/trace.Start.func1 N=<span class="hljs-number">1</span>
net/http.(*conn).serve N=<span class="hljs-number">1</span>
runtime.timerproc N=<span class="hljs-number">3</span>
net/http.(*connReader).backgroundRead N=<span class="hljs-number">1</span>
N=<span class="hljs-number">40</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Haga clic en el primer elemento con </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N = 441703</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , esto es lo que obtenemos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dh/lt/qy/dhltqyepbyyuk_i7tcadrdyx_gs.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">análisis de goroutina</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esto es muy interesante. </font><font style="vertical-align: inherit;">La mayoría de las operaciones no tardan casi en completarse, y la mayor parte del tiempo se gasta en el bloque de sincronización. </font><font style="vertical-align: inherit;">Echemos un vistazo más de cerca a uno de ellos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tu/bs/vt/tubsvt8trkqhgjrfpjijolibof4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patrón de trazas de rutina</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Parece que nuestro programa casi siempre está inactivo. </font><font style="vertical-align: inherit;">Desde aquí podemos ir directamente a la herramienta de bloqueo; </font><font style="vertical-align: inherit;">el perfil de bloqueo está deshabilitado de forma predeterminada, primero debemos habilitarlo en nuestro código:</font></font><br>
<br>
<pre><code class="go hljs">runtime.SetBlockProfileRate(<span class="hljs-number">1</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora podemos obtener una selección de cerraduras:</font></font><br>
 <br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:6060/debug/pprof/block</span><font></font>
(pprof) top<font></font>
Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">16.03</span>wks, <span class="hljs-number">99.75</span>% of <span class="hljs-number">16.07</span>wks total<font></font>
Dropped <span class="hljs-number">87</span> nodes (cum &lt;= <span class="hljs-number">0.08</span>wks)<font></font>
Showing top <span class="hljs-number">10</span> nodes out of <span class="hljs-number">27</span><font></font>
     flat  flat%   sum%        cum   cum%<font></font>
 <span class="hljs-number">10.78</span>wks <span class="hljs-number">67.08</span>% <span class="hljs-number">67.08</span>%   <span class="hljs-number">10.78</span>wks <span class="hljs-number">67.08</span>%  internal/poll.(*fdMutex).rwlock
  <span class="hljs-number">5.25</span>wks <span class="hljs-number">32.67</span>% <span class="hljs-number">99.75</span>%    <span class="hljs-number">5.25</span>wks <span class="hljs-number">32.67</span>%  sync.(*Mutex).Lock
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">99.75</span>%    <span class="hljs-number">5.25</span>wks <span class="hljs-number">32.67</span>%  arvancloud/redins/handler.(*DnsRequestHandler).Filter
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">99.75</span>%    <span class="hljs-number">5.25</span>wks <span class="hljs-number">32.68</span>%  arvancloud/redins/handler.(*DnsRequestHandler).FindANAME
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">99.75</span>%   <span class="hljs-number">16.04</span>wks <span class="hljs-number">99.81</span>%  arvancloud/redins/handler.(*DnsRequestHandler).HandleRequest
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">99.75</span>%   <span class="hljs-number">10.78</span>wks <span class="hljs-number">67.08</span>%  arvancloud/redins/handler.(*DnsRequestHandler).Response
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">99.75</span>%   <span class="hljs-number">10.78</span>wks <span class="hljs-number">67.08</span>%  arvancloud/redins/handler.(*RequestContext).Response
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">99.75</span>%    <span class="hljs-number">5.25</span>wks <span class="hljs-number">32.67</span>%  arvancloud/redins/handler.ChooseIp
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">99.75</span>%   <span class="hljs-number">16.04</span>wks <span class="hljs-number">99.81</span>%  github.com/miekg/dns.(*ServeMux).ServeDNS
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">99.75</span>%   <span class="hljs-number">16.04</span>wks <span class="hljs-number">99.81</span>%  github.com/miekg/dns.(*Server).serveDNS<font></font>
(pprof)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí tenemos dos bloqueos diferentes ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poll.fdMutex y sync.Mutex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), responsables de casi el 100% de los bloqueos. </font><font style="vertical-align: inherit;">Esto confirma nuestra suposición sobre un conflicto de bloqueo, ahora solo necesitamos encontrar dónde sucede esto:</font></font><br>
<br>
<pre><code class="go hljs">(pprof) svg lock</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este comando crea un gráfico vectorial de todos los nodos que tiene en cuenta los conflictos, con énfasis en las funciones de bloqueo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/in/m4/zu/inm4zuykw5uum0vydotfudr48d0.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">svg-graph del punto final de bloqueo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
podemos obtener el mismo resultado del punto final goroutine:</font></font><br>
<br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:6060/debug/pprof/goroutine</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y entonces:</font></font><br>
 <br>
<pre><code class="go hljs">(pprof) top<font></font>
Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">294412</span>, <span class="hljs-number">100</span>% of <span class="hljs-number">294424</span> total<font></font>
Dropped <span class="hljs-number">84</span> nodes (cum &lt;= <span class="hljs-number">1472</span>)<font></font>
Showing top <span class="hljs-number">10</span> nodes out of <span class="hljs-number">32</span><font></font>
     flat  flat%   sum%        cum   cum%<font></font>
   <span class="hljs-number">294404</span>   <span class="hljs-number">100</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">294404</span>   <span class="hljs-number">100</span>%  runtime.gopark
        <span class="hljs-number">8</span> <span class="hljs-number">0.0027</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">294405</span>   <span class="hljs-number">100</span>%  github.com/miekg/dns.(*Server).serveUDPPacket
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%      <span class="hljs-number">58257</span> <span class="hljs-number">19.79</span>%  arvancloud/redins/handler.(*DnsRequestHandler).Filter
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%      <span class="hljs-number">58259</span> <span class="hljs-number">19.79</span>%  arvancloud/redins/handler.(*DnsRequestHandler).FindANAME
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">293852</span> <span class="hljs-number">99.81</span>%  arvancloud/redins/handler.(*DnsRequestHandler).HandleRequest
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">235406</span> <span class="hljs-number">79.95</span>%  arvancloud/redins/handler.(*DnsRequestHandler).Response
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">235406</span> <span class="hljs-number">79.95</span>%  arvancloud/redins/handler.(*RequestContext).Response
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%      <span class="hljs-number">58140</span> <span class="hljs-number">19.75</span>%  arvancloud/redins/handler.ChooseIp
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">293852</span> <span class="hljs-number">99.81</span>%  github.com/miekg/dns.(*ServeMux).ServeDNS
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%   <span class="hljs-number">100</span>%     <span class="hljs-number">293900</span> <span class="hljs-number">99.82</span>%  github.com/miekg/dns.(*Server).serveDNS<font></font>
(pprof)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Casi todos nuestros programas están ubicados en runtime.gopark, es un planificador de go que tiene capacidad para goroutines; </font><font style="vertical-align: inherit;">Una razón muy común para esto es un conflicto de bloqueo</font></font><br>
<br>
<pre><code class="go hljs">(pprof) svg gopark</code></pre><br>
<img src="https://habrastorage.org/webt/-r/r6/pe/-rr6peofee7fshmvot6rb3usrjs.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">svg-graph del punto final goroutin</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aquí vemos dos fuentes de conflicto:</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDPConn.WriteMsg ()</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que todas las respuestas terminan escribiendo en el mismo FD (de ahí el bloqueo), esto tiene sentido, ya que todos tienen la misma dirección de origen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Realizamos un pequeño experimento con varias soluciones, y al final decidimos usar varios oyentes para equilibrar la carga. </font><font style="vertical-align: inherit;">Por lo tanto, permitimos que el sistema operativo equilibre las solicitudes entrantes entre diferentes conexiones y reduzca los conflictos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rand ()</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que hay un bloqueo en las funciones regulares de matemáticas / rand (más sobre esto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Esto se puede solucionar fácilmente con la ayuda de </font></font><code>Rand.New()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un generador de números aleatorios que crea un contenedor sin bloqueo.</font></font><br>
<br>
<pre><code class="go hljs">rg := rand.New(rand.NewSource(<span class="hljs-keyword">int64</span>(time.Now().Nanosecond())))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es un poco mejor, pero crear una nueva fuente es caro cada vez. ¿Es posible hacerlo aún mejor? En nuestro caso, realmente no necesitamos un número aleatorio. Solo necesitamos una distribución uniforme para equilibrar la carga, y resulta que </font></font><code>Time.Nanoseconds()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede ser adecuado para nosotros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que hemos eliminado todos los bloqueos innecesarios, echemos un vistazo a los resultados: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oq/aw/76/oqaw76gy7k0jxwro9moeo8e374s.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">análisis de goroutin Se</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ve mejor, pero aún así, la mayor parte del tiempo lleva bloquear la sincronización. Echemos un vistazo al perfil de bloqueo de sincronización desde la página principal de la interfaz de usuario de seguimiento: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k4/1y/ky/k41yky-okraevi6-huriop7-g2i.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">línea de tiempo de bloqueo de sincronización</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Echemos un vistazo a la función de impulso </font></font><code>ccache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desde el punto final de bloqueo </font></font><code>pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
 <br>
<pre><code class="go hljs">(pprof) list promote<font></font>
ROUTINE ======================== github.com/karlseguin/ccache.(*Cache).promote in ...<font></font>
        <span class="hljs-number">0</span>   <span class="hljs-number">9.66</span>days (flat, cum) <span class="hljs-number">99.70</span>% of Total<font></font>
        .          .    <span class="hljs-number">155</span>: h.Write([]<span class="hljs-keyword">byte</span>(key))<font></font>
        .          .    <span class="hljs-number">156</span>: <span class="hljs-keyword">return</span> c.buckets[h.Sum32()&amp;c.bucketMask]<font></font>
        .          .    <span class="hljs-number">157</span>:}<font></font>
        .          .    <span class="hljs-number">158</span>:<font></font>
        .          .    <span class="hljs-number">159</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cache)</span> <span class="hljs-title">promote</span><span class="hljs-params">(item *Item)</span></span> {<font></font>
        .   <span class="hljs-number">9.66</span>days    <span class="hljs-number">160</span>: c.promotables &lt;- item<font></font>
        .          .    <span class="hljs-number">161</span>:}<font></font>
        .          .    <span class="hljs-number">162</span>:<font></font>
        .          .    <span class="hljs-number">163</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cache)</span> <span class="hljs-title">worker</span><span class="hljs-params">()</span></span> {<font></font>
        .          .    <span class="hljs-number">164</span>: <span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(c.donec)<font></font>
        .          .    <span class="hljs-number">165</span>:</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas las llamadas </font></font><code>ccache.Get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terminan en un canal </font></font><code>c.promotables</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El almacenamiento en caché es una parte importante de nuestro servicio, debemos considerar otras opciones; En </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dgraph</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene un excelente artículo sobre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el estado de caché! Go</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , también tienen un excelente módulo de almacenamiento en caché llamado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ristretto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Desafortunadamente, ristretto aún no es compatible con la versión basada en Ttl, podríamos solucionar este problema usando uno muy grande </font></font><code>MaxCost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y manteniendo el valor de tiempo de espera en nuestra estructura de caché (queremos mantener los datos obsoletos en la caché). Veamos el resultado al usar ristretto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ho/k2/ay/hok2ay6emv_agqfuv-y65sxkius.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">análisis de goroutin</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¡Genial!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pudimos reducir el tiempo de ejecución máximo de gorutina de 5000 ms a 22 ms. </font><font style="vertical-align: inherit;">Sin embargo, la mayor parte del tiempo de ejecución se divide entre "bloqueo de sincronización" y "esperando el planificador". </font><font style="vertical-align: inherit;">Veamos si podemos hacer algo al respecto: la </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/s3/8u/qh/s38uqh-knc7gmandd1erhgelmrs.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">línea de tiempo del bloqueo de sincronización.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Podemos hacer poco con eso </font></font><code>fdMutex.rwlock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ahora centrémonos en otro: gcMarkDone, que es responsable del 53% del tiempo de bloqueo. </font><font style="vertical-align: inherit;">Esta característica es parte del proceso de recolección de basura. </font><font style="vertical-align: inherit;">Su presencia en la sección crítica es a menudo una señal de que estamos sobrecargando gc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimización de asignación </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este punto, puede ser útil ver cómo funciona la recolección de basura; </font><font style="vertical-align: inherit;">Go utiliza un selector de marca y barrido. </font><font style="vertical-align: inherit;">Realiza un seguimiento de todo lo que está seleccionado, y tan pronto como alcanza el doble del tamaño (o cualquier otro valor que GOGC esté configurado) del tamaño del tamaño anterior, comienza la limpieza del GC. </font><font style="vertical-align: inherit;">La evaluación se lleva a cabo en tres etapas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuración de marcador (STW)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marcado (paralelo)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fin de etiquetado (STW)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las fases Stop The World (STW) detienen todo el proceso, aunque generalmente son muy cortos, los ciclos continuos pueden aumentar la duración. Esto se debe a que en la actualidad (vaya a v1.13) las goroutinas se suplantan solo en los puntos de la llamada a la función, por lo tanto, para un ciclo continuo, es posible un tiempo de pausa arbitrariamente largo, ya que el GC espera que todas las goroutinas se detengan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante el marcado, gc usa alrededor del 25% </font></font><code>GOMAXPROCS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero se pueden agregar a la fuerza funciones auxiliares adicionales para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marcar la asistencia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , esto sucede cuando la gorutina de movimiento rápido supera el marcador de fondo para reducir el retraso causado por gc, debemos minimizar el uso del montón. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos cosas a tener en cuenta:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el número de asignaciones es más importante que el tamaño (por ejemplo, 1000 asignaciones de memoria de una estructura de 20 bytes crean mucha más carga en el montón que una única asignación de 20,000 bytes);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a diferencia de lenguajes como C / C ++, no todas las asignaciones de memoria terminan en el montón. </font><font style="vertical-align: inherit;">El compilador go decide si la variable se moverá al montón o si se puede colocar dentro del marco de la pila. </font><font style="vertical-align: inherit;">A diferencia de las variables asignadas en el montón, las variables asignadas en la pila no cargan gc.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obtener más información sobre el modelo de memoria Go y la arquitectura GC, consulte esta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">presentación</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para optimizar la asignación de memoria, utilizamos el kit de herramientas go:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generador de perfiles de procesador para encontrar distribuciones en caliente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generador de perfiles de memoria para rastrear asignaciones;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trazador de patrones; </font><font style="vertical-align: inherit;">Gc</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">análisis de escape para descubrir por qué ocurre la asignación.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos con el perfilador del procesador:</font></font><br>
 <br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> tool pprof http:<span class="hljs-comment">//localhost:6060/debug/pprof/profile?seconds=20</span>
(pprof) top <span class="hljs-number">20</span> -cum<font></font>
Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">7.27</span>s, <span class="hljs-number">29.10</span>% of <span class="hljs-number">24.98</span>s total<font></font>
Dropped <span class="hljs-number">315</span> nodes (cum &lt;= <span class="hljs-number">0.12</span>s)<font></font>
Showing top <span class="hljs-number">20</span> nodes out of <span class="hljs-number">201</span><font></font>
     flat  flat%   sum%        cum   cum%<font></font>
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%     <span class="hljs-number">0</span>%     <span class="hljs-number">16.42</span>s <span class="hljs-number">65.73</span>%  github.com/miekg/dns.(*Server).serveUDPPacket
    <span class="hljs-number">0.02</span>s  <span class="hljs-number">0.08</span>%  <span class="hljs-number">0.08</span>%     <span class="hljs-number">16.02</span>s <span class="hljs-number">64.13</span>%  github.com/miekg/dns.(*Server).serveDNS
    <span class="hljs-number">0.02</span>s  <span class="hljs-number">0.08</span>%  <span class="hljs-number">0.16</span>%     <span class="hljs-number">13.69</span>s <span class="hljs-number">54.80</span>%  github.com/miekg/dns.(*ServeMux).ServeDNS
    <span class="hljs-number">0.01</span>s  <span class="hljs-number">0.04</span>%   <span class="hljs-number">0.2</span>%     <span class="hljs-number">13.48</span>s <span class="hljs-number">53.96</span>%  github.com/miekg/dns.HandlerFunc.ServeDNS
    <span class="hljs-number">0.02</span>s  <span class="hljs-number">0.08</span>%  <span class="hljs-number">0.28</span>%     <span class="hljs-number">13.47</span>s <span class="hljs-number">53.92</span>%  main.handleRequest
    <span class="hljs-number">0.24</span>s  <span class="hljs-number">0.96</span>%  <span class="hljs-number">1.24</span>%     <span class="hljs-number">12.50</span>s <span class="hljs-number">50.04</span>%  arvancloud/redins/handler.(*DnsRequestHandler).HandleRequest
    <span class="hljs-number">0.81</span>s  <span class="hljs-number">3.24</span>%  <span class="hljs-number">4.48</span>%      <span class="hljs-number">6.91</span>s <span class="hljs-number">27.66</span>%  runtime.gentraceback
    <span class="hljs-number">3.82</span>s <span class="hljs-number">15.29</span>% <span class="hljs-number">19.78</span>%      <span class="hljs-number">5.48</span>s <span class="hljs-number">21.94</span>%  syscall.Syscall
    <span class="hljs-number">0.02</span>s  <span class="hljs-number">0.08</span>% <span class="hljs-number">19.86</span>%      <span class="hljs-number">5.44</span>s <span class="hljs-number">21.78</span>%  arvancloud/redins/handler.(*DnsRequestHandler).Response
    <span class="hljs-number">0.06</span>s  <span class="hljs-number">0.24</span>% <span class="hljs-number">20.10</span>%      <span class="hljs-number">5.25</span>s <span class="hljs-number">21.02</span>%  arvancloud/redins/handler.(*RequestContext).Response
    <span class="hljs-number">0.03</span>s  <span class="hljs-number">0.12</span>% <span class="hljs-number">20.22</span>%      <span class="hljs-number">4.97</span>s <span class="hljs-number">19.90</span>%  arvancloud/redins/handler.(*DnsRequestHandler).FindANAME
    <span class="hljs-number">0.56</span>s  <span class="hljs-number">2.24</span>% <span class="hljs-number">22.46</span>%      <span class="hljs-number">4.92</span>s <span class="hljs-number">19.70</span>%  runtime.mallocgc
    <span class="hljs-number">0.07</span>s  <span class="hljs-number">0.28</span>% <span class="hljs-number">22.74</span>%      <span class="hljs-number">4.90</span>s <span class="hljs-number">19.62</span>%  github.com/miekg/dns.(*response).WriteMsg
    <span class="hljs-number">0.04</span>s  <span class="hljs-number">0.16</span>% <span class="hljs-number">22.90</span>%      <span class="hljs-number">4.40</span>s <span class="hljs-number">17.61</span>%  github.com/miekg/dns.(*response).Write
    <span class="hljs-number">0.01</span>s  <span class="hljs-number">0.04</span>% <span class="hljs-number">22.94</span>%      <span class="hljs-number">4.36</span>s <span class="hljs-number">17.45</span>%  github.com/miekg/dns.WriteToSessionUDP
    <span class="hljs-number">1.43</span>s  <span class="hljs-number">5.72</span>% <span class="hljs-number">28.66</span>%      <span class="hljs-number">4.30</span>s <span class="hljs-number">17.21</span>%  runtime.pcvalue
    <span class="hljs-number">0.01</span>s  <span class="hljs-number">0.04</span>% <span class="hljs-number">28.70</span>%      <span class="hljs-number">4.15</span>s <span class="hljs-number">16.61</span>%  runtime.newstack
    <span class="hljs-number">0.06</span>s  <span class="hljs-number">0.24</span>% <span class="hljs-number">28.94</span>%      <span class="hljs-number">4.09</span>s <span class="hljs-number">16.37</span>%  runtime.copystack
    <span class="hljs-number">0.01</span>s  <span class="hljs-number">0.04</span>% <span class="hljs-number">28.98</span>%      <span class="hljs-number">4.05</span>s <span class="hljs-number">16.21</span>%  net.(*UDPConn).WriteMsgUDP
    <span class="hljs-number">0.03</span>s  <span class="hljs-number">0.12</span>% <span class="hljs-number">29.10</span>%      <span class="hljs-number">4.04</span>s <span class="hljs-number">16.17</span>%  net.(*UDPConn).writeMsg</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos particularmente interesados ​​en funciones relacionadas, </font></font><code>mallocgc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí es donde ayudamos con las etiquetas</font></font><br>
 <br>
<pre><code class="go hljs">(pprof) svg mallocgc</code></pre><br>
<img src="https://habrastorage.org/webt/kz/yw/mb/kzywmb1pzaiw3x2h4aprdtzvl9c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos rastrear la distribución usando el punto final </font></font><code>alloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la opción </font></font><code>alloc_object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa el número total de asignaciones, hay otras opciones para usar la memoria y el espacio de asignación.</font></font><br>
 <br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> tool pprof -alloc_objects http:<span class="hljs-comment">//localhost:6060/debug/pprof/allocs</span><font></font>
(pprof) top -cum<font></font>
Active filters:<font></font>
  show=handler<font></font>
Showing nodes accounting <span class="hljs-keyword">for</span> <span class="hljs-number">58464353</span>, <span class="hljs-number">59.78</span>% of <span class="hljs-number">97803168</span> total<font></font>
Dropped <span class="hljs-number">1</span> node (cum &lt;= <span class="hljs-number">489015</span>)<font></font>
Showing top <span class="hljs-number">10</span> nodes out of <span class="hljs-number">19</span><font></font>
     flat  flat%   sum%        cum   cum%<font></font>
 <span class="hljs-number">15401215</span> <span class="hljs-number">15.75</span>% <span class="hljs-number">15.75</span>%   <span class="hljs-number">70279955</span> <span class="hljs-number">71.86</span>%  arvancloud/redins/handler.(*DnsRequestHandler).HandleRequest
  <span class="hljs-number">2392100</span>  <span class="hljs-number">2.45</span>% <span class="hljs-number">18.19</span>%   <span class="hljs-number">27198697</span> <span class="hljs-number">27.81</span>%  arvancloud/redins/handler.(*DnsRequestHandler).FindANAME
   <span class="hljs-number">711174</span>  <span class="hljs-number">0.73</span>% <span class="hljs-number">18.92</span>%   <span class="hljs-number">14936976</span> <span class="hljs-number">15.27</span>%  arvancloud/redins/handler.(*DnsRequestHandler).Filter
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">18.92</span>%   <span class="hljs-number">14161410</span> <span class="hljs-number">14.48</span>%  arvancloud/redins/handler.(*DnsRequestHandler).Response
 <span class="hljs-number">14161410</span> <span class="hljs-number">14.48</span>% <span class="hljs-number">33.40</span>%   <span class="hljs-number">14161410</span> <span class="hljs-number">14.48</span>%  arvancloud/redins/handler.(*RequestContext).Response
  <span class="hljs-number">7284487</span>  <span class="hljs-number">7.45</span>% <span class="hljs-number">40.85</span>%   <span class="hljs-number">11118401</span> <span class="hljs-number">11.37</span>%  arvancloud/redins/handler.NewRequestContext
 <span class="hljs-number">10439697</span> <span class="hljs-number">10.67</span>% <span class="hljs-number">51.52</span>%   <span class="hljs-number">10439697</span> <span class="hljs-number">10.67</span>%  arvancloud/redins/handler.reverseZone
        <span class="hljs-number">0</span>     <span class="hljs-number">0</span>% <span class="hljs-number">51.52</span>%   <span class="hljs-number">10371430</span> <span class="hljs-number">10.60</span>%  arvancloud/redins/handler.(*DnsRequestHandler).FindZone
  <span class="hljs-number">2680723</span>  <span class="hljs-number">2.74</span>% <span class="hljs-number">54.26</span>%    <span class="hljs-number">8022046</span>  <span class="hljs-number">8.20</span>%  arvancloud/redins/handler.(*GeoIp).GetSameCountry
  <span class="hljs-number">5393547</span>  <span class="hljs-number">5.51</span>% <span class="hljs-number">59.78</span>%    <span class="hljs-number">5393547</span>  <span class="hljs-number">5.51</span>%  arvancloud/redins/handler.(*DnsRequestHandler).LoadLocation</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De ahora en adelante, podemos usar la lista para cada función y ver si podemos reducir la asignación de memoria. </font><font style="vertical-align: inherit;">Vamos a ver: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciones tipo printf</font></font></b><br>
<br>
<pre><code class="go hljs">(pprof) list handleRequest<font></font>
Total: <span class="hljs-number">97803168</span>
ROUTINE ======================== main.handleRequest in /home/arash/<span class="hljs-keyword">go</span>/src/arvancloud/redins/redins.<span class="hljs-keyword">go</span>
  <span class="hljs-number">2555943</span>   <span class="hljs-number">83954299</span> (flat, cum) <span class="hljs-number">85.84</span>% of Total<font></font>
        .          .     <span class="hljs-number">35</span>: l          *handler.RateLimiter<font></font>
        .          .     <span class="hljs-number">36</span>: configFile <span class="hljs-keyword">string</span>
        .          .     <span class="hljs-number">37</span>:)<font></font>
        .          .     <span class="hljs-number">38</span>:<font></font>
        .          .     <span class="hljs-number">39</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleRequest</span><span class="hljs-params">(w dns.ResponseWriter, r *dns.Msg)</span></span> {<font></font>
        .   <span class="hljs-number">11118401</span>     <span class="hljs-number">40</span>: context := handler.NewRequestContext(w, r)
  <span class="hljs-number">2555943</span>    <span class="hljs-number">2555943</span>     <span class="hljs-number">41</span>: logger.Default.Debugf(<span class="hljs-string">"handle request: [%d] %s %s"</span>, r.Id, context.RawName(), context.Type())<font></font>
        .          .     <span class="hljs-number">42</span>:<font></font>
        .          .     <span class="hljs-number">43</span>: <span class="hljs-keyword">if</span> l.CanHandle(context.IP()) {<font></font>
        .   <span class="hljs-number">70279955</span>     <span class="hljs-number">44</span>:  h.HandleRequest(context)<font></font>
        .          .     <span class="hljs-number">45</span>: } <span class="hljs-keyword">else</span> {<font></font>
        .          .     <span class="hljs-number">46</span>:  context.Response(dns.RcodeRefused)<font></font>
        .          .     <span class="hljs-number">47</span>: }<font></font>
        .          .     <span class="hljs-number">48</span>:}<font></font>
        .          .     <span class="hljs-number">49</span>:</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La línea 41 es especialmente interesante, incluso cuando la depuración está deshabilitada, la memoria todavía está asignada allí, podemos usar el análisis de escape para examinarlo con más detalle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go Escape Analysis Tool es en realidad una bandera compiladora</font></font><br>
<br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> build -gcflags <span class="hljs-string">'-m'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede agregar otro -m para obtener más información.</font></font><br>
<br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> build -gcflags <span class="hljs-string">'-m '</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
para una interfaz más conveniente, use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">view-annotated-file</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="go hljs">$ <span class="hljs-keyword">go</span> build -gcflags <span class="hljs-string">'-m'</span><font></font>
.<font></font>
.<font></font>
.<font></font>
../redins.<span class="hljs-keyword">go</span>:<span class="hljs-number">39</span>:<span class="hljs-number">20</span>: leaking param: w<font></font>
./redins.<span class="hljs-keyword">go</span>:<span class="hljs-number">39</span>:<span class="hljs-number">42</span>: leaking param: r<font></font>
./redins.<span class="hljs-keyword">go</span>:<span class="hljs-number">41</span>:<span class="hljs-number">55</span>: r.MsgHdr.Id escapes to heap<font></font>
./redins.<span class="hljs-keyword">go</span>:<span class="hljs-number">41</span>:<span class="hljs-number">75</span>: context.RawName() escapes to heap<font></font>
./redins.<span class="hljs-keyword">go</span>:<span class="hljs-number">41</span>:<span class="hljs-number">91</span>: context.Request.Type() escapes to heap<font></font>
./redins.<span class="hljs-keyword">go</span>:<span class="hljs-number">41</span>:<span class="hljs-number">23</span>: handleRequest []<span class="hljs-keyword">interface</span> {} literal does not escape<font></font>
./redins.<span class="hljs-keyword">go</span>:<span class="hljs-number">219</span>:<span class="hljs-number">17</span>: leaking param: path<font></font>
.<font></font>
.<font></font>
.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí todos los parámetros </font></font><code>Debugf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">van al montón. </font><font style="vertical-align: inherit;">Esto se debe a la forma de determinar </font></font><code>Debugf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *EventLogger)</span> <span class="hljs-title">Debugf</span><span class="hljs-params">(format <span class="hljs-keyword">string</span>, args ...<span class="hljs-keyword">interface</span>{})</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los parámetros se </font></font><code>args</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convierten a un tipo </font></font><code>interface{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que siempre se descarga al montón. </font><font style="vertical-align: inherit;">Podemos eliminar los registros de depuración o usar una biblioteca de registros con una distribución cero, por ejemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zerolog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obtener más información sobre el análisis de escape, consulte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"eficiencia de asignación en golang"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajar con cuerdas</font></font></b><br>
<br>
<pre><code class="go hljs">(pprof) list reverseZone<font></font>
Total: <span class="hljs-number">100817064</span>
ROUTINE ======================== arvancloud/redins/handler.reverseZone in /home/arash/<span class="hljs-keyword">go</span>/src/arvancloud/redins/handler/handler.<span class="hljs-keyword">go</span>
  <span class="hljs-number">6127746</span>   <span class="hljs-number">10379086</span> (flat, cum) <span class="hljs-number">10.29</span>% of Total<font></font>
        .          .    <span class="hljs-number">396</span>:  logger.Default.Warning(<span class="hljs-string">"log queue is full"</span>)<font></font>
        .          .    <span class="hljs-number">397</span>: }<font></font>
        .          .    <span class="hljs-number">398</span>:}<font></font>
        .          .    <span class="hljs-number">399</span>:<font></font>
        .          .    <span class="hljs-number">400</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reverseZone</span><span class="hljs-params">(zone <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> {<font></font>
        .    <span class="hljs-number">4251340</span>    <span class="hljs-number">401</span>: x := strings.Split(zone, <span class="hljs-string">"."</span>)<font></font>
        .          .    <span class="hljs-number">402</span>: <span class="hljs-keyword">var</span> y <span class="hljs-keyword">string</span>
        .          .    <span class="hljs-number">403</span>: <span class="hljs-keyword">for</span> i := <span class="hljs-built_in">len</span>(x) - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- {
  <span class="hljs-number">6127746</span>    <span class="hljs-number">6127746</span>    <span class="hljs-number">404</span>:  y += x[i] + <span class="hljs-string">"."</span>
        .          .    <span class="hljs-number">405</span>: }<font></font>
        .          .    <span class="hljs-number">406</span>: <span class="hljs-keyword">return</span> y<font></font>
        .          .    <span class="hljs-number">407</span>:}<font></font>
        .          .    <span class="hljs-number">408</span>:<font></font>
        .          .    <span class="hljs-number">409</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *DnsRequestHandler)</span> <span class="hljs-title">LoadZones</span><span class="hljs-params">()</span></span> {<font></font>
(pprof)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como una línea en Go es inmutable, la creación de una línea temporal provoca la asignación de memoria. </font><font style="vertical-align: inherit;">Comenzando con Go 1.10, puede usarlo </font></font><code>strings.Builder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para crear una cadena.</font></font><br>
 <br>
<pre><code class="go hljs">(pprof) list reverseZone<font></font>
Total: <span class="hljs-number">93437002</span>
ROUTINE ======================== arvancloud/redins/handler.reverseZone in /home/arash/<span class="hljs-keyword">go</span>/src/arvancloud/redins/handler/handler.<span class="hljs-keyword">go</span>
        <span class="hljs-number">0</span>    <span class="hljs-number">7580611</span> (flat, cum)  <span class="hljs-number">8.11</span>% of Total<font></font>
        .          .    <span class="hljs-number">396</span>:  logger.Default.Warning(<span class="hljs-string">"log queue is full"</span>)<font></font>
        .          .    <span class="hljs-number">397</span>: }<font></font>
        .          .    <span class="hljs-number">398</span>:}<font></font>
        .          .    <span class="hljs-number">399</span>:<font></font>
        .          .    <span class="hljs-number">400</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reverseZone</span><span class="hljs-params">(zone <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> {<font></font>
        .    <span class="hljs-number">3681140</span>    <span class="hljs-number">401</span>: x := strings.Split(zone, <span class="hljs-string">"."</span>)<font></font>
        .          .    <span class="hljs-number">402</span>: <span class="hljs-keyword">var</span> sb strings.Builder<font></font>
        .    <span class="hljs-number">3899471</span>    <span class="hljs-number">403</span>: sb.Grow(<span class="hljs-built_in">len</span>(zone)+<span class="hljs-number">1</span>)<font></font>
        .          .    <span class="hljs-number">404</span>: <span class="hljs-keyword">for</span> i := <span class="hljs-built_in">len</span>(x) - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- {<font></font>
        .          .    <span class="hljs-number">405</span>:  sb.WriteString(x[i])<font></font>
        .          .    <span class="hljs-number">406</span>:  sb.WriteByte(<span class="hljs-string">'.'</span>)<font></font>
        .          .    <span class="hljs-number">407</span>: }<font></font>
        .          .    <span class="hljs-number">408</span>: <span class="hljs-keyword">return</span> sb.String()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como no nos importa el valor de la línea invertida, podemos eliminarla </font></font><code>Split()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplemente volteando toda la línea.</font></font><br>
 <br>
<pre><code class="go hljs">(pprof) list reverseZone<font></font>
Total: <span class="hljs-number">89094296</span>
ROUTINE ======================== arvancloud/redins/handler.reverseZone in /home/arash/<span class="hljs-keyword">go</span>/src/arvancloud/redins/handler/handler.<span class="hljs-keyword">go</span>
  <span class="hljs-number">3801168</span>    <span class="hljs-number">3801168</span> (flat, cum)  <span class="hljs-number">4.27</span>% of Total<font></font>
        .          .    <span class="hljs-number">400</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reverseZone</span><span class="hljs-params">(zone <span class="hljs-keyword">string</span>)</span> []<span class="hljs-title">byte</span></span> {<font></font>
        .          .    <span class="hljs-number">401</span>: runes := []<span class="hljs-keyword">rune</span>(<span class="hljs-string">"."</span> + zone)<font></font>
        .          .    <span class="hljs-number">402</span>: <span class="hljs-keyword">for</span> i, j := <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(runes)<span class="hljs-number">-1</span>; i &lt; j; i, j = i+<span class="hljs-number">1</span>, j<span class="hljs-number">-1</span> {<font></font>
        .          .    <span class="hljs-number">403</span>:  runes[i], runes[j] = runes[j], runes[i]<font></font>
        .          .    <span class="hljs-number">404</span>: }
  <span class="hljs-number">3801168</span>    <span class="hljs-number">3801168</span>    <span class="hljs-number">405</span>: <span class="hljs-keyword">return</span> []<span class="hljs-keyword">byte</span>(<span class="hljs-keyword">string</span>(runes))<font></font>
        .          .    <span class="hljs-number">406</span>:}<font></font>
        .          .    <span class="hljs-number">407</span>:<font></font>
        .          .    <span class="hljs-number">408</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *DnsRequestHandler)</span> <span class="hljs-title">LoadZones</span><span class="hljs-params">()</span></span> {<font></font>
        .          .    <span class="hljs-number">409</span>: h.LastZoneUpdate = time.Now()<font></font>
        .          .    <span class="hljs-number">410</span>: zones, err := h.Redis.SMembers(<span class="hljs-string">"redins:zones"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lea más sobre cómo trabajar con cadenas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sync.Pool</font></font></h3><br>
<pre><code class="go hljs">(pprof) list GetASN<font></font>
Total: <span class="hljs-number">69005282</span>
ROUTINE ======================== arvancloud/redins/handler.(*GeoIp).GetASN in /home/arash/<span class="hljs-keyword">go</span>/src/arvancloud/redins/handler/geoip.<span class="hljs-keyword">go</span>
  <span class="hljs-number">1146897</span>    <span class="hljs-number">1146897</span> (flat, cum)  <span class="hljs-number">1.66</span>% of Total<font></font>
        .          .    <span class="hljs-number">231</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g *GeoIp)</span> <span class="hljs-title">GetASN</span><span class="hljs-params">(ip net.IP)</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>, error)</span></span> {
  <span class="hljs-number">1146897</span>    <span class="hljs-number">1146897</span>    <span class="hljs-number">232</span>: <span class="hljs-keyword">var</span> record <span class="hljs-keyword">struct</span> {<font></font>
        .          .    <span class="hljs-number">233</span>:  AutonomousSystemNumber <span class="hljs-keyword">uint</span> <span class="hljs-string">`maxminddb:"autonomous_system_number"`</span>
        .          .    <span class="hljs-number">234</span>: }<font></font>
        .          .    <span class="hljs-number">235</span>: err := g.ASNDB.Lookup(ip, &amp;record)<font></font>
        .          .    <span class="hljs-number">236</span>: <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
        .          .    <span class="hljs-number">237</span>:  logger.Default.Errorf(<span class="hljs-string">"lookup failed : %s"</span>, err)<font></font>
(pprof) list GetGeoLocation<font></font>
Total: <span class="hljs-number">69005282</span>
ROUTINE ======================== arvancloud/redins/handler.(*GeoIp).GetGeoLocation in /home/arash/<span class="hljs-keyword">go</span>/src/arvancloud/redins/handler/geoip.<span class="hljs-keyword">go</span>
  <span class="hljs-number">1376298</span>    <span class="hljs-number">3604572</span> (flat, cum)  <span class="hljs-number">5.22</span>% of Total<font></font>
        .          .    <span class="hljs-number">207</span>:<font></font>
        .          .    <span class="hljs-number">208</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g *GeoIp)</span> <span class="hljs-title">GetGeoLocation</span><span class="hljs-params">(ip net.IP)</span> <span class="hljs-params">(latitude <span class="hljs-keyword">float64</span>, longitude <span class="hljs-keyword">float64</span>, country <span class="hljs-keyword">string</span>, err error)</span></span> {<font></font>
        .          .    <span class="hljs-number">209</span>: <span class="hljs-keyword">if</span> !g.Enable || g.CountryDB == <span class="hljs-literal">nil</span> {<font></font>
        .          .    <span class="hljs-number">210</span>:  <span class="hljs-keyword">return</span>
        .          .    <span class="hljs-number">211</span>: }
  <span class="hljs-number">1376298</span>    <span class="hljs-number">1376298</span>    <span class="hljs-number">212</span>: <span class="hljs-keyword">var</span> record <span class="hljs-keyword">struct</span> {<font></font>
        .          .    <span class="hljs-number">213</span>:  Location <span class="hljs-keyword">struct</span> {<font></font>
        .          .    <span class="hljs-number">214</span>:   Latitude        <span class="hljs-keyword">float64</span> <span class="hljs-string">`maxminddb:"latitude"`</span>
        .          .    <span class="hljs-number">215</span>:   LongitudeOffset <span class="hljs-keyword">uintptr</span> <span class="hljs-string">`maxminddb:"longitude"`</span>
        .          .    <span class="hljs-number">216</span>:  } <span class="hljs-string">`maxminddb:"location"`</span>
        .          .    <span class="hljs-number">217</span>:  Country <span class="hljs-keyword">struct</span> {<font></font>
        .          .    <span class="hljs-number">218</span>:   ISOCode <span class="hljs-keyword">string</span> <span class="hljs-string">`maxminddb:"iso_code"`</span>
        .          .    <span class="hljs-number">219</span>:  } <span class="hljs-string">`maxminddb:"country"`</span>
        .          .    <span class="hljs-number">220</span>: }<font></font>
        .          .    <span class="hljs-number">221</span>: <span class="hljs-comment">// logger.Default.Debugf("ip : %s", ip)</span>
        .          .    <span class="hljs-number">222</span>: <span class="hljs-keyword">if</span> err := g.CountryDB.Lookup(ip, &amp;record); err != <span class="hljs-literal">nil</span> {<font></font>
        .          .    <span class="hljs-number">223</span>:  logger.Default.Errorf(<span class="hljs-string">"lookup failed : %s"</span>, err)<font></font>
        .          .    <span class="hljs-number">224</span>:  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">""</span>, err<font></font>
        .          .    <span class="hljs-number">225</span>: }<font></font>
        .    <span class="hljs-number">2228274</span>    <span class="hljs-number">226</span>: _ = g.CountryDB.Decode(record.Location.LongitudeOffset, &amp;longitude)<font></font>
        .          .    <span class="hljs-number">227</span>: <span class="hljs-comment">// logger.Default.Debug("lat = ", record.Location.Latitude, " lang = ", longitude, " country = ", record.Country.ISOCode)</span>
        .          .    <span class="hljs-number">228</span>: <span class="hljs-keyword">return</span> record.Location.Latitude, longitude, record.Country.ISOCode, <span class="hljs-literal">nil</span>
        .          .    <span class="hljs-number">229</span>:}<font></font>
        .          .    <span class="hljs-number">230</span>:<font></font>
        .          .    <span class="hljs-number">231</span>:<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g *GeoIp)</span> <span class="hljs-title">GetASN</span><span class="hljs-params">(ip net.IP)</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>, error)</span></span> {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizamos las funciones </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxmiddb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obtener datos de geolocalización. </font><font style="vertical-align: inherit;">Estas funciones se toman </font></font><code>interface{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como parámetros que, como vimos anteriormente, pueden causar brotes de almacenamiento dinámico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
podemos usar </font></font><code>sync.Pool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para almacenar en caché elementos seleccionados pero no utilizados para su posterior reutilización.</font></font><br>
 <br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> MMDBGeoLocation <span class="hljs-keyword">struct</span> {<font></font>
  Coordinations <span class="hljs-keyword">struct</span> {<font></font>
     Latitude        <span class="hljs-keyword">float64</span> <span class="hljs-string">`maxminddb:"latitude"`</span>
     Longitude       <span class="hljs-keyword">float64</span>
     LongitudeOffset <span class="hljs-keyword">uintptr</span> <span class="hljs-string">`maxminddb:"longitude"`</span>
  } <span class="hljs-string">`maxminddb:"location"`</span>
  Country <span class="hljs-keyword">struct</span> {<font></font>
     ISOCode <span class="hljs-keyword">string</span> <span class="hljs-string">`maxminddb:"iso_code"`</span>
  } <span class="hljs-string">`maxminddb:"country"`</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> MMDBASN <span class="hljs-keyword">struct</span> {<font></font>
  AutonomousSystemNumber <span class="hljs-keyword">uint</span> <span class="hljs-string">`maxminddb:"autonomous_system_number"`</span><font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g *GeoIp)</span> <span class="hljs-title">GetGeoLocation</span><span class="hljs-params">(ip net.IP)</span> <span class="hljs-params">(*MMDBGeoLocation, error)</span></span> {
  <span class="hljs-keyword">if</span> !g.Enable || g.CountryDB == <span class="hljs-literal">nil</span> {
     <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, EMMDBNotAvailable<font></font>
  }<font></font>
  <span class="hljs-keyword">var</span> record *MMDBGeoLocation = g.LocationPool.Get().(*MMDBGeoLocation)<font></font>
  logger.Default.Debugf(<span class="hljs-string">"ip : %s"</span>, ip)
  <span class="hljs-keyword">if</span> err := g.CountryDB.Lookup(ip, &amp;record); err != <span class="hljs-literal">nil</span> {<font></font>
     logger.Default.Errorf(<span class="hljs-string">"lookup failed : %s"</span>, err)
     <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<font></font>
  }<font></font>
  _ = g.CountryDB.Decode(record.Coordinations.LongitudeOffset, &amp;record.Coordinations.Longitude)<font></font>
  logger.Default.Debug(<span class="hljs-string">"lat = "</span>, record.Coordinations.Latitude, <span class="hljs-string">" lang = "</span>, record.Coordinations.Longitude, <span class="hljs-string">" country = "</span>, record.Country.ISOCode)
  <span class="hljs-keyword">return</span> record, <span class="hljs-literal">nil</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g *GeoIp)</span> <span class="hljs-title">GetASN</span><span class="hljs-params">(ip net.IP)</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>, error)</span></span> {
  <span class="hljs-keyword">var</span> record *MMDBASN = g.AsnPool.Get().(*MMDBASN)<font></font>
  err := g.ASNDB.Lookup(ip, record)<font></font>
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     logger.Default.Errorf(<span class="hljs-string">"lookup failed : %s"</span>, err)
     <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, err<font></font>
  }<font></font>
  logger.Default.Debug(<span class="hljs-string">"asn = "</span>, record.AutonomousSystemNumber)
  <span class="hljs-keyword">return</span> record.AutonomousSystemNumber, <span class="hljs-literal">nil</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Más información sobre la sincronización </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Piscina </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchas otras optimizaciones posibles, pero por el momento, parece que ya hemos hecho lo suficiente. </font><font style="vertical-align: inherit;">Para obtener más información sobre las técnicas de optimización de memoria, puede leer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eficiencia de asignación en los servicios Go de alto rendimiento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resultados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para visualizar los resultados de la optimización de la memoria, usamos un diagrama </font></font><code>go tool trace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">titulado "Utilización mínima del mutador", aquí Mutador significa no gc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de la optimización: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k5/og/yd/k5ogydpov-6tpkxmulro0f8tkic.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aquí tenemos una ventana de aproximadamente 500 milisegundos sin un uso eficiente (gc consume todos los recursos), y nunca obtendremos un 80% de uso efectivo a largo plazo. </font><font style="vertical-align: inherit;">Queremos que la ventana de uso efectivo cero sea lo más pequeña posible y lo más rápido posible para lograr un uso del 100%, algo así: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
después de la optimización:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6e/bt/5k/6ebt5k70pm7ufao23uln7b5dcgq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusión</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mediante el uso de herramientas go, pudimos optimizar nuestro servicio para manejar una gran cantidad de solicitudes y un mejor uso de los recursos del sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedes ver nuestro código fuente en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquí hay una</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> versión no optimizada y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí hay una</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> versión </font><font style="vertical-align: inherit;">optimizada.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">También será útil</font></font></h3><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ir perfbook</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ir efectivo</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entonces quieres ir rápido</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escritura de alto rendimiento ir</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo. </font><font style="vertical-align: inherit;">¡Nos vemos en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curso</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es487922/index.html">Aprendiendo a implementar microservicios. Parte 1. Spring Boot y Docker</a></li>
<li><a href="../es487924/index.html">Kim Dotcom: Atrapado, la persona más buscada en línea. Parte 3</a></li>
<li><a href="../es487926/index.html">En busca de educación física</a></li>
<li><a href="../es487930/index.html">Noche de conferencias quiero gamedev</a></li>
<li><a href="../es487932/index.html">Mapas normales ideales para Unity (y otros programas)</a></li>
<li><a href="../es487938/index.html">Presentación de efector-dom usando la lista de tareas de ejemplo</a></li>
<li><a href="../es487940/index.html">Computación reproducible en R. ¿Cómo separar el código y los datos?</a></li>
<li><a href="../es487944/index.html">Aprendizaje automático en el sector energético, o no solo todos pueden ver el mañana</a></li>
<li><a href="../es487948/index.html">Autenticación de dos factores en OpenVPN con Telegram bot</a></li>
<li><a href="../fr486176/index.html">Mémo de correspondance par e-mail d'entreprise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>