<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßí üïµüèø ü§üüèø REPL inutile. Rapport Yandex üí™üèº ‚ôêÔ∏è üëã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="REPL (boucle read-eval-print) est inutile en Python, m√™me s'il s'agit d'un IPython magique. Aujourd'hui, je proposerai l'une des solutions possibles √†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>REPL inutile. Rapport Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/490788/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REPL (boucle read-eval-print) est inutile en Python, m√™me s'il s'agit d'un IPython magique. </font><font style="vertical-align: inherit;">Aujourd'hui, je proposerai l'une des solutions possibles √† ce probl√®me. </font><font style="vertical-align: inherit;">Tout d'abord, le rapport et mon extension TheREPL seront utiles √† ceux qui sont int√©ress√©s par un d√©veloppement plus rapide et plus efficace, ainsi qu'√† ceux qui √©crivent des syst√®mes avec √©tat.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/w4zabj_GAhg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Je m'appelle Alexander, je travaille comme programmeur chez Yandex. Nous √©crivons dans mon √©quipe en Python, nous ne sommes pas encore pass√©s √† Go. Mais pendant mon temps libre, je programme assez curieusement et je le fais dans un langage tr√®s dynamique - Common Lisp. Il est peut-√™tre encore plus dynamique que Python. Sa particularit√© r√©side dans le fait que le processus de d√©veloppement lui-m√™me est organis√© quelque peu diff√©remment. Il est plus interactif et it√©ratif, car dans REPL sur Lisp, vous pouvez tout faire: cr√©er de nouveaux modules et les supprimer, ajouter des m√©thodes, des classes et les supprimer, red√©finir des classes, etc.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/0p/ld/xo/0pldxop8ymqyuvlwarowoynh_44.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Python, c'est d'autant plus difficile. Il a IPython. Bien s√ªr, IPython am√©liore REPL d'une certaine mani√®re, ajoute la saisie semi-automatique et permet d'utiliser diff√©rentes extensions. Mais pour le d√©veloppement it√©ratif, cela ne convient pas tr√®s bien. Vous pouvez y t√©l√©charger le code, le tester un peu et c'est tout. Et parfois, il veut plus d'interactivit√© pour que vous puissiez vraiment utiliser ce REPL dans le d√©veloppement, basculer entre les modules, changer les fonctions et les classes √† l'int√©rieur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela m'arrive - vous ex√©cutez, par exemple, IPython REPL dans l'environnement de production et vous commencez √† ex√©cuter des commandes l√†-bas, √† enqu√™ter sur quelque chose, puis il s'av√®re qu'il y a une erreur dans le module et que vous souhaitez la corriger rapidement. Mais cela ne fonctionne pas, car vous devez cr√©er une nouvelle image Docker, la rouler en production, recommencer dans ce REPL, atteindre √† nouveau l'√©tat souhait√©, red√©marrer tout ce qui est tomb√© dessus. Et id√©alement, je devrais corriger la fonction, l'ex√©cuter imm√©diatement et obtenir instantan√©ment le r√©sultat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que peut-on faire √† ce sujet? </font><font style="vertical-align: inherit;">Comment puis-je recharger du code dans IPython? </font><font style="vertical-align: inherit;">J'ai essay√© d'utiliser le chargement automatique et je ne l'aimais pas pour plusieurs raisons. </font><font style="vertical-align: inherit;">Tout d'abord, lorsque le module est red√©marr√©, il perd l'√©tat qui √©tait dans les variables globales √† l'int√©rieur de ce module. </font><font style="vertical-align: inherit;">Et il peut y avoir une valeur en cache avec les r√©sultats de certaines fonctions. </font><font style="vertical-align: inherit;">Ou je pourrais, par exemple, y charger des donn√©es sur le r√©seau, afin que plus tard, je puisse travailler avec elles plus rapidement. </font><font style="vertical-align: inherit;">Autrement dit, le chargement automatique perd son √©tat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, √† titre exp√©rimental, j'ai cr√©√© mon extension simple pour IPython et l'ai nomm√©e TheREPL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je suis venu vers vous avec ce rapport comme une id√©e de ce qui peut √™tre fait avec REPL en Python. </font><font style="vertical-align: inherit;">Et j'esp√®re vraiment que vous aimerez cette id√©e, que vous la r√©aliserez dans votre t√™te et que vous continuerez √† proposer des choses qui rendront Python encore plus efficace et pratique.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qu'est-ce que TheREPL? Il s'agit de l'extension que vous t√©l√©chargez, apr√®s laquelle un concept tel que l'espace de noms appara√Æt dans IPython, et vous pouvez prendre et basculer vers n'importe quel module Python, voir quelles variables, fonctions, etc. sont l√†. Et plus important encore, vous pouvez √©crire directement def, le nom de la fonction, red√©finir la fonction ou la classe, et cela changera dans tous les modules o√π elle a √©t√© import√©e. Mais en m√™me temps, le module lui-m√™me ne red√©marre pas, donc l'√©tat est enregistr√©. De plus, TheREPL vous permet d'√©viter d'autres artefacts qui sont en chargement automatique et que nous allons maintenant examiner.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h0/ob/lo/h0obloylvllg9wciqqyvg3yhqam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, en chargement automatique, la mise √† niveau du code ne se produit que lorsque le fichier est enregistr√©. Mais en m√™me temps, vous devez entrer quelque chose dans le REPL lui-m√™me, et ce n'est qu'alors que le chargement automatique reprendra ces modifications. C'est le probl√®me num√©ro 1. Autrement dit, si vous avez une sorte de processus d'arri√®re-plan dans un thread s√©par√© (par exemple, le serveur est en cours d'ex√©cution), vous ne pouvez pas simplement prendre et corriger le code. Le chargement automatique n'appliquera pas ces modifications tant que vous n'aurez pas entr√© quelque chose dans IPython REPL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cas de mon extension, vous appuyez sur le raccourci droit dans l'√©diteur, et la fonction qui se trouve sous le curseur est imm√©diatement appliqu√©e et commence √† fonctionner. Autrement dit, en utilisant TheREPL, vous pouvez modifier le code de mani√®re plus granulaire. Vous pouvez √©galement √©crire def dans IPython.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8c/gf/5h/8cgf5hocolkvqgirby2kq730eus.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dit, passer d'un module √† l'autre, le chargement automatique ne prend aucunement en charge. Vous pouvez uniquement trouver le fichier dans le syst√®me de fichiers, le changer et esp√©rer que le chargement automatique r√©soudra tout l√†-bas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h-/4t/sr/h-4tsrp2ncyufazpguvh0qmjxum.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus loin. Le chargement automatique perd les variables globales, TheREPL enregistre et vous permet de continuer √† rechercher le fonctionnement de votre application, changer son code interne et ainsi le d√©velopper rapidement.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tb/md/o_/tbmdo_pag196om9zw0heb1rtvy4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le chargement automatique a toujours cette fonctionnalit√©. Il applique tr√®s astucieusement les modifications au module qui se recharge. En particulier, il y fait un tour tr√®s int√©ressant. Si la fonction dans ce module a √©t√© mise √† jour, alors pour la changer o√π qu'elle soit import√©e, il utilise le garbage collector pour la trouver et toutes ces instances de fonctions et changer le code qu'elles contiennent. De plus, nous examinerons des exemples de la fa√ßon dont cela se produit. Pour cette raison, le code de fonction change, m√™me s'il entre dans la fermeture.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Savez-vous ce qu'est une fermeture? C'est une chose tr√®s utile. Les d√©veloppeurs JavaScript l'utilisent tout le temps. Vous, tr√®s probablement, n'avez tout simplement jamais pr√™t√© attention. Mais comme le chargement automatique fait ce que j'ai d√©crit ci-dessus, vous pouvez vous retrouver dans une situation o√π l'ancien code utilise un nouveau code qui peut fonctionner diff√©remment. Par exemple, une fonction peut renvoyer non pas une valeur, mais deux, tuple au lieu de cha√Æne, etc. L'ancien code se cassera √† ce sujet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le REPL ne fait pas une chose aussi d√©licate sp√©cifiquement pour s'assurer que tout est plus coh√©rent. En d'autres termes, il modifie la fonction ou la classe du module dans lequel il est d√©fini. Recherche cette classe dans tous les autres modules et la modifie √©galement l√†-bas. Apr√®s cela, tout fonctionne d'une mani√®re nouvelle.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-j/fv/xo/-jfvxo93yhfdk69oyhb9xsybvom.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment fonctionne le remplacement de la fonction de chargement automatique? Nous avons deux fonctions, une et deux. Chaque fonction poss√®de un ensemble d'attributs: documentation, code, arguments, etc. Ici sur la diapositive est un exemple de remplacement des attributs dans lesquels le bytecode est stock√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois le chargement automatique modifi√©, la fonction appel√©e commence √† fonctionner diff√©remment. Mais c'est un exemple synth√©tique que je viens de reproduire avec mes mains pour que vous compreniez ce qui se passe. La fonction est appel√©e dans un sens, mais le code est en fait diff√©rent. Et si vous d√©montez, cela montre √©galement qu'il retourne un diable. √Ä quoi cela m√®ne-t-il? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/u7/qt/btu7qtygtpvagsnxat-tngwtvle.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple de fermeture. Sur la deuxi√®me ligne, nous cr√©ons une fermeture dans laquelle nous capturons la fonction foo. La fermeture elle-m√™me attend que cette fonction que nous avons pass√©e retourne une ligne, elle l'encode en utf-8 et tout fonctionne.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tu/mx/b8/tumxb8ifcxw_yh5o2veg8sfrtbw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais supposons que vous modifiez le module dans lequel foo est d√©fini et que le chargement automatique reprend le changement. Et vous le modifiez pour qu'il ne renvoie pas une cha√Æne, mais un nombre. Ensuite, la fermeture fonctionnera d√©j√† incorrectement, car la fonction qu'elle contient a chang√© √† l'int√©rieur, mais la fermeture ne s'y attend pas, elle n'a pas chang√©. Et de tels probl√®mes avec le chargement automatique peuvent "tirer" dans des endroits inattendus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/eq/k0/mseqk0r8rxsiji38ypx3drsloaw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment le chargement automatique met-il √† jour les classes? Tr√®s simple. Il met √† jour toutes les m√©thodes de la classe de la m√™me mani√®re que les fonctions, et il met √©galement √† jour l'attribut __class__ pour toutes les instances afin que la r√©solution des m√©thodes (d√©terminant la m√©thode √† appeler) commence √† fonctionner d'une nouvelle mani√®re.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout est un peu plus compliqu√© dans TheREPL, car lorsque vous mettez √† jour _class_, il peut s'av√©rer qu'il a des descendants, des classes enfants, qui doivent √©galement √™tre mises √† jour, car quelque chose a chang√© dans la liste des classes de base. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©soudre ce probl√®me, vous pouvez reconstruire la classe. Mais voyons d'abord ce qui se passe avec le chargement automatique lorsqu'il recharge un module. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p-/xc/jg/p-xcjggcwk7h30knymqvqsl9_ue.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un bon exemple. Il y a deux modules - a et b. Dans le module a, une classe parent est d√©finie, dans le module b une classe enfant, et nous cr√©ons une instance de la classe enfant. Et la ligne 10 montre que oui, c'est une instance de la classe Foo, le parent. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nm/aj/gu/nmajgupfumnuw-igpxdk-_fbvlw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous prenons et modifions simplement le module a. Par exemple, ajoutez de la documentation √† la classe Foo. Le chargement automatique reprend ensuite ces modifications. Que pensez-vous que dans ce cas, il reviendra de Bar?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3t/kz/iw/3tkziw2mnozaraudax0vm4ndzii.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et il renvoie false, car le chargement automatique a chang√© la classe Foo, et maintenant c'est une classe compl√®tement diff√©rente, pas celle dont la classe Bar est h√©rit√©e. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/o5/mt/jyo5mtiwfcsw1vuvuegmz-ynxbm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et une surprise! Dans les deux modules a et b, la classe Foo est une classe diff√©rente et Bar h√©rite de l'un d'eux. En raison de ces montants, il est tr√®s difficile de pr√©dire comment votre code fonctionnera apr√®s que le chargement automatique aura corrig√© quelque chose. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g3/cj/3e/g3cj3enddiaxo02tzn5zr3jqaa8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelque chose comme √ßa, il met √† jour les classes. Je commenterai la photo. Initialement, la classe Foo est import√©e dans le module b, et elle y reste donc. Lors du remplacement du chargement automatique, ce module a est d√©plac√© et une nouvelle classe y appara√Æt, et dans le module b, il n'est pas mis √† jour.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ja/mg/pk/jamgpkvsohlnphdstlwz9_dbyig.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TheREPL fait un peu diff√©rent. Il injecte une classe modifi√©e dans chaque module o√π il a √©t√© import√©. Par cons√©quent, tout fonctionne correctement l√†-bas. De plus, s'il y avait des objets dans la classe, ils seront conserv√©s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/72/hk/cq/72hkcql64u5ap4p0dzhiwyoxicc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et c'est ainsi que TheREPL r√©sout le probl√®me des classes enfants. Autrement dit, lorsque la classe parente a chang√©, elle d√©finit la liste des classes de base via l'attribut magique mro (ordre de r√©solution de la m√©thode). Cet attribut contient une liste de classes dans l'ordre dans lequel vous souhaitez rechercher des m√©thodes ou des attributs dans celles-ci. Et chaque fois que vous appelez la m√©thode get_name sur votre objet, par exemple, Python le v√©rifiera d'abord dans la classe Bar, puis dans la classe Foo, puis dans la classe objet, s'il ne le trouve pas. Il agit selon la proc√©dure d'ordre de r√©solution de la m√©thode.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TheREPL utilise cette puce. </font><font style="vertical-align: inherit;">Il prend une liste de classes de base, y change la classe que vous venez de changer en une nouvelle. </font><font style="vertical-align: inherit;">Cr√©e un nouveau type enfant, c'est la deuxi√®me √©tape. </font><font style="vertical-align: inherit;">Avec la fonction type, vous pouvez r√©ellement cr√©er des classes. </font><font style="vertical-align: inherit;">Si vous ne l'avez jamais utilis√© - essayez-le, c'est amusant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous dites simplement le nom de la classe, dites quelle est sa classe de base. </font><font style="vertical-align: inherit;">Dans le cas le plus simple, par exemple, objet. </font><font style="vertical-align: inherit;">Et - un dictionnaire avec des m√©thodes et des attributs de classe. </font><font style="vertical-align: inherit;">Tout, vous avez une nouvelle classe que vous pouvez instancier, comme d'habitude. </font><font style="vertical-align: inherit;">TheREPL profite de cette puce. </font><font style="vertical-align: inherit;">Il g√©n√®re une classe enfant et y change des pointeurs dans tous les objets de l'ancienne classe Bar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai encore une d√©mo, regardons comment √ßa marche. </font><font style="vertical-align: inherit;">Tout d'abord, regardons une chose aussi simple.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Premi√®re d√©mo</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/w4zabj_GAhg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai dit que vous pouvez changer le code √† l'int√©rieur du module. Supposons que nous ayons un serveur. Je vais l'ex√©cuter maintenant. √Ä un moment donn√©, nous constatons que pour une raison quelconque, il cr√©e des r√©pertoires temporaires. Ou il a commenc√© √† cr√©er, mais avant cela, il n'a pas cr√©√©. Ensuite, nous pouvons nous connecter √† ce serveur et, en supposant qu'il cr√©e probablement ces r√©pertoires en utilisant la fonction mkdtemp du module de fichiers, vous pouvez acc√©der directement √† ce module Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voir - dans le coin le nom du module actuel a chang√©. Maintenant, il dit tempfile. Et je peux voir quelles sont les fonctionnalit√©s. Nous les voyons et nous pouvons, surtout, les red√©finir. J'ai pr√©par√© un wrapper sp√©cial qui vous permet de d√©corer n'importe quelle fonction afin que, avec tous ses appels, vous puissiez voir la trace d'o√π elle est appel√©e. Nous allons maintenant les importer et les appliquer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, j'encapsule la fonction Python standard, sans m√™me avoir acc√®s au code source de ce module. </font><font style="vertical-align: inherit;">Je peux le prendre et l'envelopper. </font><font style="vertical-align: inherit;">Et √† la sortie suivante, nous verrons Traceback et trouver d'o√π il est appel√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De la m√™me mani√®re, ces modifications peuvent √™tre annul√©es afin qu'elles ne nous spamment pas. </font><font style="vertical-align: inherit;">Autrement dit, nous voyons que ce serveur √† l'int√©rieur du travailleur sur la huiti√®me ligne appelle mkdtemp et continue de produire des r√©pertoires temporaires pour nous, encombrant le syst√®me de fichiers. </font><font style="vertical-align: inherit;">Ceci est une application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons un autre exemple de la raison pour laquelle le chargement automatique ne fonctionne parfois pas tr√®s bien du tout. </font><font style="vertical-align: inherit;">J'ai un bot de t√©l√©gramme pr√©par√©:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxi√®me d√©mo</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/w4zabj_GAhg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous activons le chargement automatique et voyons comment cela nous aide. Voil√†, maintenant vous pouvez d√©marrer le bot et lui parler. Pour que vous puissiez mieux voir, nous entamerons un dialogue avec lui. Apprenez √† conna√Ætre le bot. Donc. Il y a une sorte d'erreur. Une erreur compl√®tement diff√©rente a √©t√© con√ßue et j'ai d√©cid√© de faire des changements au dernier moment. Mais cela n'a pas d'importance. Maintenant, nous allons le corriger, le chargement automatique nous aidera avec cela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous passons au bot. Et maintenant, je vais commenter temporairement cela, si c'est le cas. J'enregistre le fichier. le chargement automatique, en th√©orie, devait intercepter ces changements. Red√©marrez le bot. Le bot m'a reconnu. Parlons-lui.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une erreur. Elle est d√©j√† con√ßue. Allons le r√©parer. Je vais quitter le bot, cela fonctionnera en arri√®re-plan, je passerai √† l'√©diteur, et dans l'√©diteur, nous trouverons cette erreur. C'est juste une faute de frappe, et j'ai oubli√© que ma variable s'appelle nom_utilisateur. J'ai enregistr√© le fichier. le chargement automatique √©tait cens√© l'attraper, et maintenant nous le verrons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le chargement automatique, comme je l'ai d√©j√† mentionn√©, ne sait rien du fait que le fichier a chang√© jusqu'√† ce que vous y entriez quelque chose. Avec un processus aussi long ... Il doit √™tre interrompu, red√©marr√©. Termin√©. Retournez √† notre robot, √©crivez-lui. Eh bien, vous voyez, le bot a oubli√© que je m'appelle Sasha. Pourquoi? autoreload l'a recr√©√© √† nouveau car il recharge compl√®tement le module entier. Et j'ai besoin d'√©crire √† nouveau au bot pour restaurer son √©tat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si vous d√©boguez une sorte d'erreur qui se produit dans un certain √©tat, alors l'√©tat ne peut pas √™tre perdu, car sinon vous passerez encore beaucoup de temps pour atteindre cet √©tat. TheREPL aide dans de tels cas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment le bot sera mis √† jour en cas d'utilisation de TheREPL. Pour la puret√© de l'exp√©rience, je red√©marrerai IPython et nous le r√©p√©terons encore une fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant je t√©l√©charge TheREPL. Il commence imm√©diatement √† √©couter sur un port sp√©cifique afin que vous puissiez envoyer un code √† l'int√©rieur. Soit dit en passant, cela peut √™tre fait m√™me si IPython s'ex√©cute quelque part sur le serveur et que l'√©diteur s'ex√©cute localement, ce qui peut √©galement vous aider dans certains cas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous importons le bot, le d√©marrons, √©crivons √† nouveau. C'est clair ici - nous avons red√©marr√© Python, donc il ne se souvient plus de qui je suis. V√©rifiez qu'il y a une erreur √† l'int√©rieur. Oui, il y a une erreur. Eh bien, faisons-le. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je reviens √† l'√©diteur, corrige l'erreur. Nous n'avons m√™me pas besoin d'enregistrer le fichier, j'appuie sur Ctrl-C, Ctrl-C, c'est un raccourci par lequel Emacs prend la description actuelle de la fonction qui se trouve juste sous le curseur et l'envoie au processus Python auquel il est connect√©. C'est tout, maintenant nous pouvons passer en revue et v√©rifier comment notre bot r√©pond √† mes messages l√†-bas. Maintenant, il se souvient que je suis Sasha et r√©pond honn√™tement qu'il ne sait pas comment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons d'y ajouter directement de nouvelles fonctionnalit√©s. Pour ce faire, revenez √† l'√©diteur. Par exemple, ajoutez la commande help. Pour l'instant, laissez-le r√©pondre qu'il ne sait rien de l'aide. Encore une fois, appuyez sur Ctrl-C, Ctrl-C, le code est appliqu√©. Nous allons au bot. Voyez s'il comprend cette commande. Oui, l'√©quipe a postul√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, il a encore une telle chose, maintenant nous allons voir comment la classe va changer. Il a une commande d'√©tat, une commande de d√©bogage sp√©ciale pour afficher l'√©tat du bot. Donc, certains Oleg connect√©s. Int√©ressant.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le bot ex√©cute cette commande, il appelle la r√©ponse pour afficher la repr√©sentation du bot. Nous pouvons aller corriger, par exemple, cette r√©ponse avec autre chose. Par exemple, faites en sorte que seuls les noms soient entr√©s. Vous pouvez le faire. Nous retournons √† notre messager, ex√©cutons √† nouveau l'√©tat. Et c'est tout. Maintenant, la r√©ponse fonctionne d'une mani√®re nouvelle, mais l'objet est le m√™me, il a conserv√© son √©tat, car il se souvient de nous tous - Oleg, Sasha, kek et ¬´DROP TABLE Users, Alex¬ª! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, vous pouvez √©crire et d√©boguer du code directement √† la vol√©e, sans passer √† ce cycle, lorsque vous devez collecter un package, le faire rouler quelque part. Vous pouvez rapidement tester quelque chose, changer tout ce dont vous avez besoin, et alors seulement toutes ces modifications doivent √™tre correctement packag√©es et d√©ploy√©es.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturellement, vous ne devriez pas faire cela en production r√©elle, car avec cette approche, quel type de probl√®me peut √™tre. Vous pouvez oublier que le code que vous venez de d√©marrer sur le serveur doit √™tre enregistr√© puis d√©ploy√© comme il se doit. Cette approche n√©cessite de la discipline. Mais dans le processus de d√©veloppement et de d√©bogage d'une sorte de test, c'est juste une bonne chose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assurez-vous de cr√©er un plugin pour PyCharm. S'il y a un volontaire qui m'aidera avec Kotlin et le plugin PyCharm, je serai heureux de parler. √âcrivez-moi </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par la poste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©l√©gramme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* * * </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se connecter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au d√©veloppement de TheREPL. </font><font style="vertical-align: inherit;">Il y a beaucoup plus de puces auxquelles vous pouvez penser. </font><font style="vertical-align: inherit;">Par exemple, vous pouvez trouver un moyen de mettre √† jour les instances de classe lors de leur mise √† niveau, d'y ajouter de nouveaux attributs ou de mettre √† niveau leur √©tat d'une mani√®re ou d'une autre. </font><font style="vertical-align: inherit;">De m√™me, nous mettrons √† niveau la base de donn√©es. </font><font style="vertical-align: inherit;">Maintenant ce n'est pas le cas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez trouver un code de rechargement √† chaud pour la production afin que lorsque de nouvelles modifications vous parviennent, vous n'avez pas √† red√©marrer le serveur. </font><font style="vertical-align: inherit;">Vous pouvez trouver beaucoup plus. </font><font style="vertical-align: inherit;">Ce n'est qu'une id√©e, et je veux que vous la retiriez d'ici. </font><font style="vertical-align: inherit;">Nous devons tout r√©gler pour nous-m√™mes et le rendre pratique. </font><font style="vertical-align: inherit;">C'est tout pour moi.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490778/index.html">Les gens qui comprennent le travail d'un programmeur peuvent √™tre trouv√©s n'importe o√π</a></li>
<li><a href="../fr490780/index.html">Intel Xeon Scalable Gen2: grande vente de c≈ìurs</a></li>
<li><a href="../fr490782/index.html">Conf√©rence AnalogBytes: Roskomnadzor, media, highload et all-all-all</a></li>
<li><a href="../fr490784/index.html">Je suis d√©veloppeur Android et je n'aimais pas faire de travail manuel.</a></li>
<li><a href="../fr490786/index.html">Analyse de fuite de second ordre: quand elle fuit de ceux qui volent des donn√©es d'une banque</a></li>
<li><a href="../fr490790/index.html">Fichiers Zip: historique, explication et impl√©mentation</a></li>
<li><a href="../fr490792/index.html">VXLAN dans NSX-V - Sous-couche en difficult√©</a></li>
<li><a href="../fr490796/index.html">Comment automatiser la s√©curit√© des conteneurs dans le style de la strat√©gie en tant que code √† l'aide de CRD</a></li>
<li><a href="../fr490804/index.html">Comment la m√®re d'un pirate est entr√©e en prison et a infect√© l'ordinateur du patron</a></li>
<li><a href="../fr490808/index.html">Math√©matiques en astronautique: moteur de d√©tonation rotationnelle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>