<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¶üèø üí∏ ‚úçÔ∏è Jeux 3D sur Instagram Javascript, ou trajectoire de vol de saucisse üì∞ üå°Ô∏è üìß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apr√®s le premier article sur la programmation de jeux en masques sur Instagram, un client m'a demand√© de cr√©er un jeu sur Instagram pour sa pizzeria. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Jeux 3D sur Instagram Javascript, ou trajectoire de vol de saucisse</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499974/"><img src="https://habrastorage.org/webt/gl/zq/2a/glzq2aogs8xde9o1cauyy8qc838.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s le premier article sur la programmation de jeux en masques sur Instagram, un client m'a demand√© de cr√©er un jeu sur Instagram pour sa pizzeria. Ce jeu devait √™tre utilis√© √† des fins de promotion commerciale. Bien s√ªr, je comprends que, √† en juger par le nombre de vues du premier article, le th√®me Instagram n'est pas particuli√®rement int√©ressant pour la communaut√© Habr. Apparemment, ce service est toujours consid√©r√© comme une sorte de divertissement frivole pour les blondes, et un article √† ce sujet ne convient que comme lecture du vendredi pour un cocktail en soir√©e. Cependant, aujourd'hui, juste vendredi. Obtenez un cocktail. Et n'oubliez pas d'inviter des blondes. Cependant, il est probable qu'√† l'avenir la technologie atteindra des sommets tels que nous commencerons √† jouer sur Instagram dans GTA-5. Ou 10.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article abordera deux jeux √† la fois. </font><font style="vertical-align: inherit;">J'en ai fait un sur commande, puis le second pour moi. </font><font style="vertical-align: inherit;">A chaque nouveau jeu, j'ai √©t√© confront√© √† de nouvelles t√¢ches dont la recherche de solutions m'a fait conna√Ætre les nouvelles nuances du d√©veloppement. </font><font style="vertical-align: inherit;">Peut-√™tre que cette histoire sera utile √† d'autres d√©veloppeurs d'√©l√©ments de r√©alit√© augment√©e. </font><font style="vertical-align: inherit;">Les jeux sont √©crits en Javascript pur sans l'utilisation de biblioth√®ques suppl√©mentaires. </font><font style="vertical-align: inherit;">Pour afficher des graphiques 3D, les outils Instagram int√©gr√©s sont utilis√©s.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeu 1. Pizza</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, quelle est l'essence du premier match. Filature de pizza. Les composants s'envolent de sa surface - morceaux de saucisse, tomates, etc. Deux joueurs doivent attraper leur bouche. Le gagnant est celui qui, comme vous pouvez le deviner, en attrapera plus. Au fil du temps, la vitesse de rotation augmente. La chose la plus dr√¥le dans ce jeu pour moi √©tait de programmer les trajectoires de vol de ces √©l√©ments comestibles. Imaginez la programmation d'un vol de saucisses. Non, d√©finitivement, je n'ai jamais eu autant de programmation amusante. Je ris encore maintenant en √©crivant cet article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le client a vu le prototype fonctionnel, il m'a envoy√© ceci: ¬´:))¬ª. Un probl√®me est survenu lors du test du r√©sultat final. Cela consistait dans le fait que les sujets ne pouvaient pas jouer au jeu: ils √©clataient simplement de rire - c'√©tait tellement amusant.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vous rappelle que le d√©veloppement des masques et des jeux se fait dans Spark AR Studio. Et √† partir de l√†, vous pouvez t√©l√©charger votre travail sur Instagram pour que tout le monde puisse le voir. Il est √† noter que les technologies Web brouillent les fronti√®res entre les syst√®mes d'exploitation pour un d√©veloppeur. Vous √©crivez un code, qui fonctionne ensuite dans l'application Instagram pour iOS et Android, sans aucune modification ou changement. Bien s√ªr, le paiement pour cela devient une vitesse de script fondamentalement faible.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le calendrier du jeu a √©t√© fourni par le client. Il y a eu quelques difficult√©s avec les mod√®les 3D. En particulier, lors de l'utilisation du moteur d'animation int√©gr√© Spark AR Studio, il s'est av√©r√© que si l'objet en mouvement est mis √† l'√©chelle, ses coordonn√©es sont incorrectement d√©termin√©es dans le jeu. Mais cet effet g√™nant n'est pas observ√© si vous ne redimensionnez pas compl√®tement l'objet entier, mais chacun de son maillage s√©par√©ment. J'ai d√ª quitter l'√©chelle de la pizza 1: 1, et prescrire un certain coefficient pour chaque √©l√©ment qui en fait. Il y avait aussi des probl√®mes avec le format FBX dans lequel vous devez exporter des mod√®les pour un jeu Instagram. Le graphiste a envoy√© des mod√®les avec des textures int√©gr√©es, qui, de plus, ont √©t√© plac√©s le long d'un chemin relatif. L'√©diteur 3D les a vus, mais pas Spark AR. J'ai d√ª reconditionner les mod√®les afin que les fichiers de texture soient s√©par√©s des mod√®les et le long d'un chemin avec eux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et un autre petit probl√®me que j'ai rencontr√© √©tait que l'objet api Saprk AR responsable de l'affichage du texte √† l'√©cran refusait d'accepter la valeur comme une valeur - un score de jeu, par exemple. </font><font style="vertical-align: inherit;">Pendant longtemps, je n'ai pas pu comprendre pourquoi rien ne s'affiche. </font><font style="vertical-align: inherit;">Qu'est-ce que je fais mal? </font><font style="vertical-align: inherit;">Il s'est av√©r√© que vous devez d'abord convertir les nombres en cha√Ænes (.toString ()). </font><font style="vertical-align: inherit;">Cela va sans dire pour les autres langues, mais plut√¥t atypique pour le javascript, qui l'a toujours fait lui-m√™me.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation simple</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une des nouveaut√©s pour moi dans ce jeu a √©t√© la programmation de l'animation d'objets 3D. (Dans mon pr√©c√©dent jeu Instagram ¬´Tic-Tac-Toe¬ª, il n'y avait aucune animation.) Le moteur d'animation de Spark AR Studio est tr√®s sp√©cifique. Il prend certains param√®tres d'entr√©e, puis connecte de mani√®re r√©active la variable √† l'objet dans lequel vous souhaitez modifier quelque chose. Par exemple, cela changera la coordonn√©e y (startValue, endValue - ses valeurs initiales et finales) d'un objet 3D au cours du temps t:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> driverParameters = {
    <span class="hljs-attr">durationMilliseconds</span>: t,
    <span class="hljs-attr">loopCount</span>: <span class="hljs-literal">Infinity</span>,
    <span class="hljs-attr">mirror</span>: <span class="hljs-literal">false</span><font></font>
};<font></font>
<span class="hljs-keyword">var</span> driver = Animation.timeDriver(driverParameters);
<span class="hljs-keyword">var</span> sampler = Animation.samplers.linear(startValue, endValue);<font></font>
sceneObject.transform.y = Animation.animate(driver, sampler);<font></font>
driver.start();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour d√©placer les ingr√©dients de la pizza dans l'espace, j'ai d√©cid√© de simplement ex√©cuter trois de ces animations en parall√®le pour chaque coordonn√©e. Il suffisait d'indiquer la coordonn√©e initiale (startValue) et la coordonn√©e finale calcul√©e par l'angle de rotation de la pizza (endValue), pour que ce soit quelque part loin au cas o√π le joueur n'attraperait pas cette ¬´coquille¬ª avec sa bouche. S'il est pris - alors le mouvement s'arr√™te. L'√©v√©nement d'ouverture de la bouche que j'ai d√©j√† d√©crit dans un article pr√©c√©dent. Seulement voici un jeu pour deux et, par cons√©quent, il y aura d√©j√† deux visages et deux bouches:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});<font></font>
<font></font>
FaceTracking.face(<span class="hljs-number">1</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point cl√© de ce jeu est d'attraper des ingr√©dients volants avec votre bouche, en d'autres termes, de trouver un objet volant dans une petite zone donn√©e autour du centre de la bouche d'une personne. </font><font style="vertical-align: inherit;">Au d√©but, ce calcul ne voulait pas √™tre fait correctement pour moi, mais une solution au probl√®me a √©t√© trouv√©e apr√®s l'introduction d'un objet cach√© li√© aux coordonn√©es de la bouche, et cela a fonctionn√©. </font><font style="vertical-align: inherit;">Pour une raison quelconque, les coordonn√©es directes de la bouche ne sont pas revenues. </font><font style="vertical-align: inherit;">Ici cameraTransform.applyTo est la r√©duction des coordonn√©es des points de face aux coordonn√©es dans le monde 3D (la m√©thode est tir√©e de la documentation).</font></font><br>
<br>
<pre><code class="javascript hljs">move: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//   (   )</span><font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> object = Scene.root.find(<span class="hljs-string">'pizzafly'</span>);
    <span class="hljs-keyword">var</span> olast = {
        <span class="hljs-attr">x</span>: object.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: object.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: object.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   ,       </span>
    <span class="hljs-keyword">var</span> objectHidden = Scene.root.find(<span class="hljs-string">'nullObject'</span>);<font></font>
    objectHidden.transform.x = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).x;<font></font>
    objectHidden.transform.y = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).y;<font></font>
    objectHidden.transform.z = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).z;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> mouth = {
        <span class="hljs-attr">x</span>: objectHidden.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: objectHidden.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: objectHidden.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> d = {
        <span class="hljs-attr">x</span>: <span class="hljs-built_in">Math</span>.abs(olast.x - mouth.x),
        <span class="hljs-attr">y</span>: <span class="hljs-built_in">Math</span>.abs(olast.y - mouth.y),
        <span class="hljs-attr">z</span>: <span class="hljs-built_in">Math</span>.abs(olast.z - mouth.z)<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> ((d.x &gt; <span class="hljs-number">0.03</span>) || (d.y &gt; <span class="hljs-number">0.03</span>) || (d.z &gt; <span class="hljs-number">0.03</span>)) {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    };<font></font>
<font></font>
},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par la suite, j'ai r√©alis√© que vous devriez supprimer la v√©rification de la profondeur (coordonn√©e z), car dans ce jeu particulier, il est visuellement difficile d'estimer la profondeur. </font><font style="vertical-align: inherit;">Autrement dit, il est d√©sormais possible d'attraper l'ingr√©dient en ouvrant la bouche √† tout moment pendant le vol. </font><font style="vertical-align: inherit;">L'essentiel est la combinaison de x et y.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nw/v9/dw/nwv9dwt-p5wip4yhnnhtirudgoe.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, le dernier probl√®me que j'ai rencontr√© lors de l'√©criture de ce jeu √©tait de limiter la taille de la version finale √† 4 Mo. De plus, selon la recommandation de Facebook, pour que le jeu soit affich√© sur autant d'appareils mobiles que possible, il est souhaitable de contenir m√™me 2 Mo. Et les mod√©lisateurs 3D sont des gens cr√©atifs et veulent faire des mod√®les lourds avec une grille dense et des textures √©normes, sans se soucier compl√®tement de nous, des programmeurs, ou plut√¥t de la performance finale dans les jeux. J'ai √©galement en quelque sorte r√©duit la taille des textures et compress√© en jpg (au lieu de png), mais le mod√®le de pizza lui-m√™me a d√ª √™tre envoy√© pour r√©vision (r√©topologie). En cons√©quence, n√©anmoins, il a √©t√© possible de s'int√©grer dans le volume de 2 Mo avec tous les mod√®les, textures et script. Et le jeu a continu√© avec mod√©ration.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et apr√®s un certain temps, elle est revenue avec la formulation que "l'effet contient trop de texte statique". </font><font style="vertical-align: inherit;">J'ai d√ª supprimer les chiffres du compte √† rebours et au lieu d'eux, j'ai mis l'animation sur la fl√®che du chronom√®tre, qui a maintenant commenc√© √† compter le temps √† leur place. </font><font style="vertical-align: inherit;">Apr√®s cela, le jeu a √©t√© approuv√©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeu 2. √Ä propos du papillon (ButterFlap)</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wd/dt/63/wddt63fejsxelpizwyffhzw5zig.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais maintenant parler de la cr√©ation d'un deuxi√®me jeu. Je ne peux pas m'emp√™cher de faire des jeux, c'est mon hobby. Quelques jours avant le 8 mars, j'ai d√©cid√© de cr√©er un jeu Instagram pour cette f√™te. Quelque chose au sujet des fleurs, des papillons et des bonbons. Mais je ne pouvais pas penser √† ce que pourrait √™tre l'essence du jeu. La pens√©e tournait dans ma t√™te. Peut-√™tre que le papillon collectera des bonbons et les mettra dans un panier? Ou peut-√™tre que les papillons ramasseront des bonbons en l'air et les jetteront, et le joueur devra les attraper avec sa bouche? En g√©n√©ral, j'ai arnaqu√© pendant quelques jours et, n'ayant pas trouv√© de solution, j'ai r√©alis√© que le 8 mars, mon jeu n'aurait toujours pas le temps de passer par la mod√©ration, car cette derni√®re prend 3-4 jours. Je voulais d√©j√† quitter cette aventure, quand soudain l'id√©e est venue d'elle-m√™me, tout d'un coup. Je n'ai plus li√© le match √† la Journ√©e de la femme, maintenant c'√©tait juste un match.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scroller. </font><font style="vertical-align: inherit;">De gauche √† droite, le paysage et divers obstacles se d√©placent. </font><font style="vertical-align: inherit;">Le joueur doit contr√¥ler un papillon qui peut se d√©placer librement dans l'√©cran et collecter des diamants suspendus dans les airs. </font><font style="vertical-align: inherit;">De plus, de droite √† gauche un peu plus vite que le reste de l'image, les nuages ‚Äã‚Äãse d√©placent, d'o√π la pluie tombe. </font><font style="vertical-align: inherit;">Vous devez vous cacher de la pluie sous les fleurs. </font><font style="vertical-align: inherit;">Si un papillon tombe sous l'eau, ses ailes se mouillent et il tombe, c'est la fin du jeu. </font><font style="vertical-align: inherit;">J'ai appel√© le jeu simplement: ButterFlap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, tout cela sonne bien. </font><font style="vertical-align: inherit;">Je voulais directement jouer moi-m√™me. </font><font style="vertical-align: inherit;">Mais je me suis souvenu que je n'√©tais pas du tout un artiste. </font><font style="vertical-align: inherit;">Cependant, je suis capable de cr√©er des mod√®les 3D, et c'est plus facile que de dessiner. </font><font style="vertical-align: inherit;">Donc, il a √©t√© d√©cid√©, qu'il y ait un scroller 3D.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arts graphiques</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai trouv√© des mod√®les libres de droits en ligne que j'ai d√ª affiner. Il a tir√© des textures sur celles qui √©taient sans textures, apr√®s avoir plac√© celles-ci dans un atlas de texture: les artefacts sous forme d '¬´√©chelles¬ª sont visibles sur les mod√®les non textur√©s, et le lissage peut √™tre d√©fini pour les textures dans le jeu, ce qui rend l'apparence des objets plus pr√©sentable et moins plate. Ces mod√®les qui contenaient des textures avaient √©galement leurs d√©fauts qui devaient √™tre corrig√©s. Premi√®rement, la taille des textures n'√©tait pas un multiple de deux en puissance. Autrement dit, il pourrait √™tre √©gal √† 1200x1200. J'ai d√ª compresser en 1024x1024. Les processeurs vid√©o peuvent mettre √† l'√©chelle ou remplir des textures inappropri√©es avec un espace vide, c'est-√†-dire celles qui ne sont pas 1024x1024, 512x512, 256x256, etc. Dans tous les cas, ces actions sont une charge suppl√©mentaire pendant le travail du jeu et une consommation de m√©moire sans signification,par cons√©quent, il est pr√©f√©rable de pr√©parer d'abord les images correctes manuellement. La situation a √©galement √©t√© sauv√©e par le fait que j'ai distribu√© toutes les textures par des atlas de texture, donc si, par exemple, la texture d'origine √©tait de 400x200 pixels, je pourrais simplement la mettre dans l'atlas 1024x1024, telle quelle, √† c√¥t√© d'autres similaires. Apr√®s cela, il est naturellement n√©cessaire de mettre √† l'√©chelle le scan UV √©galement, mais cela se fait en quelques secondes. Je suis toujours tomb√© sur des variantes de mod√®les o√π, pour une raison quelconque, les textures √©taient li√©es le long d'un chemin absolu tel que ¬´C: \ Work \ Vasya \ Map.jpg¬ª. Eh bien, il n'y a pas un tel dossier sur mon ordinateur! J'ai d√ª sp√©cifier les chemins d'acc√®s aux textures manuellement ... Mais pourquoi vous est venue l'id√©e que je devrais garder tous mes projets sur le lecteur "C:"!? Oh, ces mod√©listes, artistes libres ... Au fait, de cette fa√ßon, par les noms des dossiers dans des chemins laiss√©s au hasard, vous pouvez en apprendre plus par inadvertance sur l'identit√© du mod√©lisateur,par exemple, son nom. Ravi de vous rencontrer!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus difficile a √©t√© de trouver un mod√®le papillon adapt√© avec animation. Spark AR utilise une animation qui peut √™tre export√©e de n'importe quel √©diteur 3D au format FBX. Les ailes d'une paire de mod√®les de papillons que j'ai t√©l√©charg√©es √©taient √©trangement en miroir - une aile a √©t√© mod√©lis√©e, et la seconde s'est refl√©t√©e d'une mani√®re que je ne comprenais pas, et, par cons√©quent, deux d'entre elles se sont r√©v√©l√©es. Avec cette approche de la mod√©lisation, au final, dans le jeu, une des ailes (copi√©e) ne voulait pas recevoir de lumi√®re de la source et restait toujours sombre. Je ne risquais pas de changer radicalement le mod√®le, car alors l'animation aurait vol√©. Et en animation, je suis un noob encore plus grand qu'en mod√©lisation 3D. Peut-√™tre que le probl√®me √©tait autre chose: j'ai essay√©, par exemple, d'√©largir les normales, mais cela n'a pas aid√©. En bref, les mod√®les 3D gratuits sont p√©nibles. En cons√©quence, apr√®s avoir lav√© toute la soir√©e,par essais et erreurs, j'ai trouv√© un mod√®le appropri√© qui, apr√®s quelques ajustements avec un fichier, a commenc√© √† avoir l'air satisfaisant. Quelque chose que je n‚Äôaimais pas, mais c‚Äô√©tait de petites choses: j‚Äôai refait la texture, chang√© la g√©om√©trie √† certains endroits et ajust√© les param√®tres du mat√©riau. Enfin, le papillon a d√©coll√©. Hourra. Mais maintenant, je suis √©puis√©. J'ai donc d√©cid√© d'aller me coucher et de continuer le lendemain. Oui, j'ai pass√© 7 √† 8 jours √† cr√©er le jeu. Mais c'√©tait un travail plut√¥t tranquille le soir, en lisant la documentation, les articles et en trouvant les r√©ponses aux questions.J'ai donc d√©cid√© d'aller me coucher et de continuer le lendemain. Oui, j'ai pass√© 7 √† 8 jours √† cr√©er le jeu. Mais c'√©tait un travail plut√¥t tranquille le soir, en lisant la documentation, les articles et en trouvant les r√©ponses aux questions.J'ai donc d√©cid√© d'aller me coucher et de continuer le lendemain. Oui, j'ai pass√© 7 √† 8 jours √† cr√©er le jeu. Mais c'√©tait un travail plut√¥t tranquille le soir, en lisant la documentation, les articles et en trouvant les r√©ponses aux questions.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/zb/iy/rrzbiyezloccrjo_egas613ltry.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toute la soir√©e du lendemain, j'ai travaill√© sur le graphisme. La sp√©cificit√© des masques de jeu pour Instagram, comme je l'ai d√©j√† mentionn√©, est qu'il est conseill√© de ne pas d√©passer le volume de 2 Mo pour l'ensemble du jeu (maximum 4 Mo). Je ne m'inqui√©tais pas du script: sa taille ne devrait pas d√©passer 50 Ko. Mais plus de mod√®les 3D de plantes devaient √™tre assez conjur√©s. Par exemple, la partie du tournesol o√π se trouvent les graines a √©t√© r√©alis√©e par g√©om√©trie. Des centaines de polygones ... Remplacez-le par un fragment d'une sph√®re de quelques dizaines de triangles et √©tirez la texture t√©l√©charg√©e, en fait, de cette partie. Le nombre de feuilles peut √©galement √™tre r√©duit. Nous faisons de l'herbe au bas de la sc√®ne avec un plan de deux triangles avec une texture superpos√©e avec un canal alpha. Nous atteignons le volume avec des ombres et des fragments de copie de l'image √† l'int√©rieur de la texture elle-m√™me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, il est souhaitable de minimiser le nombre de textures, ainsi que leur taille en octets. </font><font style="vertical-align: inherit;">Ce sont les textures qui cr√©ent l'essentiel du jeu. </font><font style="vertical-align: inherit;">J'ai l'habitude des textures o√π la transparence est n√©cessaire, plac√©es dans un atlas de texture - en png 32 bits, et les textures qui n'utilisent pas le canal alpha, emball√©es dans un autre atlas, en l'enregistrant en jpg. </font><font style="vertical-align: inherit;">Jpg peut √™tre r√©duit plus fort que png. </font><font style="vertical-align: inherit;">Les √©l√©ments Grass et UI qui ont besoin de transparence sont pass√©s √† l'atlas png et tout le reste √† jpg.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le volume total. </font><font style="vertical-align: inherit;">Au total, j'ai obtenu 4 types de plantes, un rocher, un papillon, que le joueur contr√¥lera, et un nuage. </font><font style="vertical-align: inherit;">Les textures de tous ces mod√®les sous forme compress√©e ont pris 2 atlas 1024x1024 jpg et png avec un volume total de 500 Kb. </font><font style="vertical-align: inherit;">Les mod√®les eux-m√™mes prenaient environ 200 Ko. </font><font style="vertical-align: inherit;">Plus un script. </font><font style="vertical-align: inherit;">Sons - 31 Ko. </font><font style="vertical-align: inherit;">Total: environ 1 Mo. </font><font style="vertical-align: inherit;">En vert, la taille de la build est juste affich√©e (c'est ce qui devrait tenir dans 2 Mo).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/7r/c1/ak7rc1e09ycyaee13ypwnokgeqm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soudain, j'ai rencontr√© un probl√®me compl√®tement inattendu. </font><font style="vertical-align: inherit;">J'ai supprim√© plusieurs mod√®les inutilis√©s, mais pas via Spark AR Studio, mais du syst√®me de fichiers. </font><font style="vertical-align: inherit;">Par la suite, lors de l'assemblage de la construction, j'ai constat√© qu'ils avaient disparu de la sc√®ne Spark AR Studio, mais qu'ils √©taient toujours dans l'assemblage. </font><font style="vertical-align: inherit;">Et il est impossible de vider le projet des ressources inutilis√©es. </font><font style="vertical-align: inherit;">Les liens vers eux √† partir du ¬´R√©sum√© des actifs¬ª ne m√®nent nulle part. </font><font style="vertical-align: inherit;">Apparemment, c'est un d√©faut dans Spark AR Studio. </font><font style="vertical-align: inherit;">J'ai d√ª recr√©er le projet √† nouveau, en y ajoutant toutes les ressources n√©cessaires d√®s le d√©but.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sc√®ne</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je r√©fl√©chis depuis longtemps √† la fa√ßon d'impl√©menter le d√©filement de tous les objets sur l'√©cran. </font><font style="vertical-align: inherit;">Parmi les outils pour cela, il n'y a que javascript et le moteur d'animation int√©gr√© le plus simple dans Spark AR Studio, qui peut simplement changer les coordonn√©es de l'objet de la valeur initiale √† la finale dans un temps donn√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, il y avait encore un dilemme avant cela: cr√©er le niveau entier du jeu, une sc√®ne dans l'√©diteur 3D, en dupliquant les plantes r√©p√©titives le nombre de fois requis et en les pla√ßant dans les bonnes positions, afin de faire d√©filer la sc√®ne enti√®re dans le jeu, ou de charger une seule copie de chaque 3D objet et les substituer dans la direction du joueur juste √† l'ext√©rieur de l'√©cran. La r√©ponse √©tait √©vidente. Notre choix est la deuxi√®me option. Sinon, il ne sera certainement pas possible de tenir dans 2 Mo: tr√®s probablement, la sc√®ne selon la premi√®re option sera lourde. Mais alors vous avez besoin d'une disposition des objets. Et j'ai, sans h√©sitation, d√©cid√© d'utiliser l'√©diteur 3D comme √©diteur de niveau. Ouais, il s'av√®re que j'ai fait les deux. Plantes pour le jeu, je les ai sauvegard√©es en une seule copie. Et de l'√©diteur, je n'avais besoin que des coordonn√©es. Apr√®s avoir termin√© le travail,J'ai √©crit les coordonn√©es de tous les objets et fait un tableau avec les donn√©es du jeu.</font></font><br>
<br>
<pre><code class="javascript hljs">lv:[<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">8.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-6.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'cloud'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">0.1</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'rain'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">6.6</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">14</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-2.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'diamond_red'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">20</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">2.0</span>},<font></font>
	...<font></font>
],</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et pourtant - un tableau associatif distinct, selon les types d'objets, o√π sont stock√©es les tailles des collisionneurs et leurs d√©placements par rapport aux centres des objets 3D, ainsi qu'un drapeau (col) qui d√©termine si l'objet est un obstacle (sinon le joueur le traverse). </font><font style="vertical-align: inherit;">Pour certains types d'objets, un indicateur (d√©truire) est d√©fini, qui d√©termine si l'objet doit √™tre masqu√© apr√®s interaction, ainsi que le param√®tre (v), qui d√©termine un certain degr√© d'interaction, par exemple, le nombre de points qu'un joueur gagne ou perd.</font></font><br>
<br>
<pre><code class="javascript hljs">colld:{
    <span class="hljs-string">'flower1'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">5</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">2.3</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1.4</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_green'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">destroy</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_red'</span>:{<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">-2</span>},<font></font>
<font></font>
    ...<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une petite nuance. </font><font style="vertical-align: inherit;">L'herbe au bas de la sc√®ne doit d√©filer en continu. </font><font style="vertical-align: inherit;">Vous devez donc utiliser deux copies de cet objet et les remplacer l'une apr√®s l'autre au fur et √† mesure que vous vous d√©placez. </font><font style="vertical-align: inherit;">Les fleurs n'appara√Ætront sur un √©cran que dans une copie chacune.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compte tenu du probl√®me d'√©chelle que j'ai rencontr√© lors du d√©veloppement du premier jeu, j'ai r√©initialis√© l'√©chelle de tous les mod√®les dans l'√©diteur 3D. Ainsi, dans les mod√®les Saprk AR imm√©diatement charg√©s dans des tailles normales. Certes, dans le sc√©nario de toute fa√ßon, il ne pouvait se passer du ¬´nombre magique¬ª, du coefficient global, du code universel, qui contient l'essence de l'univers. Un univers virtuel, bien s√ªr. Et je suis pr√™t √† vous r√©v√©ler ce num√©ro. Utilisez-le, les gens! Cela ne me d√©range pas! Ce nombre est 0,023423. En bref, malgr√© la r√©initialisation de toutes les √©chelles, un m√®tre dans l'√©diteur 3D s'est av√©r√© √™tre √©gal √† ce nombre dans Spark AR Studio. Tr√®s probablement, je ne comprends cependant pas pleinement toutes les subtilit√©s du travail avec les graphiques 3D, d'o√π le coefficient. Les coordonn√©es (mais pas la taille) de tous les objets export√©s depuis l'√©diteur sont multipli√©es par lui, vous l'aurez devin√©.O√π ajuster l'√©chelle de la sc√®ne dans Spark AR, je n'ai pas trouv√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me suivant que j'ai rencontr√© √©tait la perte de l'ordre de tri des objets lors de l'exportation √† partir d'un √©diteur 3D. </font><font style="vertical-align: inherit;">Des objets complexes constitu√©s de plusieurs mailles pouvaient appara√Ætre de mani√®re impr√©visible sur la sc√®ne du jeu de telle mani√®re que, par exemple, une maille qui se trouvait derri√®re une autre sautait soudainement en avant. </font><font style="vertical-align: inherit;">Et, si vous regardez l'ordre des objets apr√®s l'exportation vers Spark AR Studio, alors, en effet, on peut voir que ce maillage est pour une raison quelconque plus haut dans la liste, bien qu'il soit plus bas dans l'√©diteur. </font><font style="vertical-align: inherit;">J'ai r√©solu ce probl√®me en divisant la sc√®ne en couches et en les enregistrant dans diff√©rents fichiers.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation complexe</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant trois autres soir√©es, je tripotais la programmation. Si j'ai utilis√© le moteur standard Spark AR Studio pour animer les ailes d'un papillon, la t√¢che de d√©placer l'arri√®re-plan n'√©tait pas si simple. Je ne comprenais toujours pas comment attacher non seulement un param√®tre variable aux it√©rations du cycle de mouvement, mais une fonction de rappel √† part enti√®re. En tout cas, je n'ai pas pu le faire, les param√®tres d'animation actuels ne voulaient pas y √™tre transf√©r√©s. Et une telle fonction est tout simplement n√©cessaire, car si dans le premier jeu (avec pizza) j'ai v√©rifi√© la collision par le fait d'ouvrir la bouche en y souscrivant, alors il n'y avait pas un tel √©v√©nement ici. Et il fallait juste v√©rifier les collisions avec les objets environnementaux au fur et √† mesure que le personnage se d√©place, selon ses coordonn√©es actuelles. Et pour cela, les coordonn√©es doivent √™tre compar√©es √† chaque it√©ration. Et puis j'ai pens√©. Apr√®s tout, j'ai d√©j√† √©crit des jeux en javascript.Et pourquoi ne pas utiliser votre moteur d'animation que j'ai √©crit plus t√¥t pour ces jeux? Son principe de fonctionnement est sensiblement le m√™me: √† un instant donn√©, le ou les param√®tres changent entre les valeurs initiales et finales donn√©es. Et la valeur actuelle est transmise en tant que param√®tre - vous ne le croirez pas - dans la fonction de rappel donn√©e, dans laquelle, par exemple, vous pouvez d√©finir un objet 3D sur la sc√®ne √† des coordonn√©es √©gales √† ces valeurs actuelles, ou v√©rifier les collisions sur elles. Merci, Cap. J'ai d√ª adapter l√©g√®rement mon moteur √† l '¬´√©cosyst√®me¬ª local: supprimer les r√©f√©rences √† l'objet fen√™tre de l√†, car il n'est pas l√†, et d'autres petites choses.Et la valeur actuelle est transmise en tant que param√®tre - vous ne le croirez pas - dans la fonction de rappel donn√©e, dans laquelle, par exemple, vous pouvez d√©finir un objet 3D sur la sc√®ne √† des coordonn√©es √©gales √† ces valeurs actuelles, ou v√©rifier les collisions sur elles. Merci, Cap. J'ai d√ª adapter l√©g√®rement mon moteur √† l '¬´√©cosyst√®me¬ª local: supprimer les r√©f√©rences √† l'objet fen√™tre de l√†, car il n'est pas l√†, et d'autres petites choses.Et la valeur actuelle est transmise en tant que param√®tre - vous ne le croirez pas - dans la fonction de rappel donn√©e, dans laquelle, par exemple, vous pouvez d√©finir un objet 3D sur la sc√®ne √† des coordonn√©es √©gales √† ces valeurs actuelles, ou v√©rifier les collisions sur elles. Merci, Cap. J'ai d√ª adapter l√©g√®rement mon moteur √† l '¬´√©cosyst√®me¬ª local: supprimer les r√©f√©rences √† l'objet fen√™tre de l√†, car il n'est pas l√†, et d'autres petites choses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, encore - sur le d√©filement du paysage et des objets de l'environnement. J'ai d√©cid√© de mettre le monde entier dans un NullObject, c'est-√†-dire dans un objet 3D vide, un conteneur, et de le d√©placer en utilisant un seul param√®tre pour l'animation - sa coordonn√©e x. √Ä l'int√©rieur du conteneur, tous les mod√®les ont les m√™mes coordonn√©es que s'ils √©taient √† l'ext√©rieur, seulement maintenant pour eux, le syst√®me de r√©f√©rence est li√© √† cet objet vide. Les roches et les fleurs seront r√©p√©t√©es (en outre, √† diff√©rentes hauteurs du sol, conform√©ment au diagramme de niveau), vous pouvez donc r√©utiliser ces objets lorsque vous vous d√©placez, en leur donnant la position horizontale et verticale souhait√©e √† l'int√©rieur du "conteneur". J'ai √©crit un syst√®me de recherche d'objets tombant dans le cadre (au d√©calage du conteneur actuel), qui d√©finit l'objet qui laisse le cadre √† une nouvelle position plus loin s'il devait y appara√Ætre. Tu peux voir,comment cela fonctionne sur l'exemple de trois objets. (Il y en aura plus dans le jeu, donc vous ne verrez plus un tel effet de "r√©arrangement" des objets de l'environnement.)</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/f3i72svxLHM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction de mise √† jour des coordonn√©es des objets ressemble √† ceci:</font></font><br>
<br>
<pre><code class="javascript hljs">oCoordSet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-comment">//  :    </span>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> camx = -ap.oWorld.transform.x.pinLastValue();
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> x1 = camx - ap.game.scro.w2;
    <span class="hljs-keyword">var</span> x2 = camx + ap.game.scro.w2;
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {
        <span class="hljs-comment">//    </span>
        <span class="hljs-keyword">if</span> ((ap.d.lv[i].x &gt;= x1) &amp; (ap.d.lv[i].x &lt;= x2)) {
            <span class="hljs-comment">//   </span><font></font>
            ap.d.lv[i].o = Scene.root.find(ap.d.lv[i].n);<font></font>
            <span class="hljs-comment">//  -  </span><font></font>
            ap.d.lv[i].o.transform.y = ap.d.lv[i].y;<font></font>
            <span class="hljs-keyword">if</span> ((ap.d.lv[i].n == <span class="hljs-string">'cloud'</span>) || (ap.d.lv[i].n == <span class="hljs-string">'rain'</span>)) {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//  </span>
                <span class="hljs-comment">//   2.3,</span>
                <span class="hljs-comment">//     </span>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x - (x2 - ap.d.lv[i].x) * <span class="hljs-number">2.3</span> + <span class="hljs-number">0.2</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//      </span><font></font>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x;<font></font>
            };<font></font>
        };<font></font>
    };<font></font>
    <span class="hljs-comment">//        </span>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">if</span> (camx &gt; ap.game.grassPosLast) {<font></font>
        ap.game.grassPosLast += ap.game.grassd;<font></font>
        ap.game.grassi = <span class="hljs-number">1</span> - ap.game.grassi;<font></font>
        ap[ap.game.grassNm[ap.game.grassi]].transform.x = ap.game.grassPosLast;<font></font>
    };<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le personnage principal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le personnage principal du jeu est un papillon insubmersible, qui vole hardiment en avant, surmontant les obstacles. </font><font style="vertical-align: inherit;">J'ai d√©cid√© de faire la gestion en fixant un marqueur, ou curseur (point lumineux), en tournant et en inclinant la t√™te. </font><font style="vertical-align: inherit;">Et dans la direction de ce point, un papillon volera lentement (en fait, ce n'est pas un combattant, il ne peut pas non plus se t√©l√©porter). </font><font style="vertical-align: inherit;">Par exemple, si vous vous abonnez √† l'√©v√©nement d'inclinaison de la t√™te, vous pouvez impl√©menter un contr√¥le vertical comme ceci:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).cameraTransform.rotationX.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> v = event.newValue;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> scrH2 = ap.game.scr.h2;
    <span class="hljs-comment">//</span>
    <span class="hljs-keyword">var</span> p = -v * <span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">if</span> (p &lt; -scrH2) {<font></font>
        p = -scrH2;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p &gt; scrH2) {<font></font>
        p = scrH2;<font></font>
    };<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> d = <span class="hljs-number">0.006</span>;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> cur = ap.oPers.transform.y.pinLastValue();
    <span class="hljs-keyword">if</span> (p &lt; cur) {<font></font>
        cur -= d;<font></font>
        <span class="hljs-keyword">if</span> (cur &lt; p) {cur = p;};<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        cur += d;<font></font>
        <span class="hljs-keyword">if</span> (cur &gt; p) {cur = p;};<font></font>
    };<font></font>
    <span class="hljs-comment">//    ()</span><font></font>
    ap.oPointer1.transform.y = p;<font></font>
    <span class="hljs-comment">//   ,</span>
    <span class="hljs-comment">// ,    </span><font></font>
    ap.game.pers.dy + = cur - ap.game.pers.y;<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De m√™me pour l'horizontale. </font><font style="vertical-align: inherit;">Seulement l√†, il est n√©cessaire de souscrire √† l'√©v√©nement non pas d'une inclinaison, mais d'une rotation de la t√™te (rotationY), et au lieu de la hauteur de l'√©cran, consid√©rez sa largeur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colliders</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela est merveilleux, le monde bouge et le personnage du jeu peut se d√©placer librement sur l'√©cran. Mais maintenant, vous avez besoin d'un gestionnaire de collision, sinon aucun jeu ne fonctionnera. Il y a trois √©v√©nements dans le jeu, selon lesquels la position du personnage peut changer. Il s'agit de la rotation et de l'inclinaison de la t√™te, ainsi que du mouvement du monde, dans lequel la coordonn√©e horizontale du joueur (x) augmente automatiquement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que je ne sais pas comment les it√©rations du gestionnaire de visage fonctionnent dans Spark AR - qu'elles soient appel√©es avec une certaine fr√©quence ou d√©finies sur la fr√©quence d'horloge maximale possible, et dans mon moteur d'animation, je peux contr√¥ler ce param√®tre, j'ai d√©cid√© de d√©finir des collisions dans ma fonction le mouvement du monde, qui est appel√© √† une fr√©quence que je fixe (60 images par seconde). Dans les √©v√©nements de traitement de visage, nous n'accumulerons que les mouvements.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principe sera comme √ßa. Dans les √©v√©nements d'inclinaison et de rotation de la t√™te, un d√©calage le long des axes x et y est accumul√©. De plus, dans la fonction de d√©filement du monde, un d√©placement horizontal s'ajoute √©galement √† la ¬´tirelire¬ª. Et puis il est v√©rifi√©, si le d√©placement accumul√© est ajout√© aux coordonn√©es d'origine, alors il y aura une collision avec l'un des objets du monde. Sinon, les coordonn√©es originales du joueur plus le d√©calage sont faites par les coordonn√©es actuelles. Et puis nous mettons √† jour les sources vers les actuelles (r√©initialiser) et r√©initialisons les d√©calages. Si c'est le cas, ramenez les coordonn√©es √† l'original. De plus, nous devons d√©terminer quel axe serait la collision, car les deux coordonn√©es ne peuvent pas √™tre annul√©es. Sinon, le joueur ¬´colle¬ª simplement √† un point dans l'espace et ne peut plus se d√©placer nulle part. Il faut lui donner une libert√© de mouvement le long de l'axe le long duquel la collision ne se produit pas.Vous pouvez donc lui donner une chance de contourner un obstacle.</font></font><br>
<br>
<pre><code class="javascript hljs">setPersPos: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">camx, camdx</span>) </span>{
    <span class="hljs-comment">//   </span>
    <span class="hljs-comment">//       (camx,camdx)</span><font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">var</span> persx = ap.game.pers.x;
    <span class="hljs-keyword">var</span> persy = ap.game.pers.y;
    <span class="hljs-keyword">var</span> dx = ap.game.pers.dx;
    <span class="hljs-keyword">var</span> dy = ap.game.pers.dy;<font></font>
<font></font>
    <span class="hljs-comment">// ,     </span>
    <span class="hljs-keyword">var</span> col = ap.collisionDetect(<font></font>
        {<span class="hljs-attr">x</span>: persx, <span class="hljs-attr">y</span>: persy, <span class="hljs-attr">dx</span>: dx, <span class="hljs-attr">dy</span>: dy},<font></font>
        {<span class="hljs-attr">x</span>: camx, <span class="hljs-attr">dx</span>: camdx, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>}<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (col.f == <span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// </span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.colx == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//(    ,    )</span><font></font>
            ap.game.pers.x = col.x;<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span><font></font>
            ap.game.pers.x = persx + dx;<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.coly == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// -  </span><font></font>
            ap.game.pers.y = col.y;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            ap.game.pers.y = persy + dy;<font></font>
        };<font></font>
<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//  ,   </span><font></font>
        ap.game.pers.x = persx + dx;<font></font>
        ap.game.pers.y = persy + dy;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// </span>
    ap.game.pers.dx = <span class="hljs-number">0</span>;<font></font>
    ap.game.pers.dy = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">//     </span><font></font>
    ap.oPers.transform.x = ap.game.pers.x;<font></font>
    ap.oPers.transform.y = ap.game.pers.y;<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction de d√©tection de collision elle-m√™me:</font></font><br>
<br>
<pre><code class="javascript hljs">collisionDetect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opers, ow</span>) </span>{
    <span class="hljs-comment">// , opers -   , ow -  </span><font></font>
<font></font>
    <span class="hljs-keyword">var</span> res = {<span class="hljs-attr">f</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">colx</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">coly</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>};<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ocoll, x, y, w, h, persx, persy, persx0, persy0, od, colx1, coly1, colx2, coly2;
    <span class="hljs-keyword">var</span> collw = <span class="hljs-literal">false</span>, collh = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-comment">//(  ,  "" )</span><font></font>
    persx0 = opers.x + ow.x - ow.dx;<font></font>
    persy0 = opers.y + ow.y;<font></font>
<font></font>
    <span class="hljs-comment">//       </span><font></font>
    persx = persx0 + opers.dx;<font></font>
    persy = persy0 + opers.dy;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {<font></font>
        od = ap.d.lv[i]; <span class="hljs-comment">//obj data</span><font></font>
<font></font>
        <span class="hljs-comment">//    (   ),</span>
        <span class="hljs-comment">//     </span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ap.d.colld[od.n] !== <span class="hljs-string">"undefined"</span>) {<font></font>
<font></font>
            <span class="hljs-comment">//       </span><font></font>
            ocoll = ap.d.colld[od.n];<font></font>
            colx1 = od.x + ocoll.x1;<font></font>
            colx2 = od.x + ocoll.x2;<font></font>
            coly1 = od.y + ocoll.y1;<font></font>
            coly2 = od.y + ocoll.y2;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> ((persx &lt; colx1) || (persx &gt; colx2) || (persy &lt; coly1) || (persy &gt; coly2)) {} <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//   </span>
                res.f = <span class="hljs-literal">true</span>;<font></font>
<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persx0 &lt; colx1) || (persx0 &gt; colx2)) {<font></font>
                    collw = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persy0 &lt; coly1) || (persy0 &gt; coly2)) {<font></font>
                    collh = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
<font></font>
            };<font></font>
        };<font></font>
<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   </span><font></font>
<font></font>
    <span class="hljs-comment">//  ,     ,</span>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (collw == <span class="hljs-literal">true</span>) {<font></font>
        res.colx = <span class="hljs-literal">true</span>;<font></font>
        res.x = persx0 - ow.x;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.x = opers.x;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">if</span> (collh == <span class="hljs-literal">true</span>) {<font></font>
        res.coly = <span class="hljs-literal">true</span>;<font></font>
        res.y = persy0 + ow.y;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.y = opers.y;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">return</span> res;<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pluie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai utilis√© le moteur de particules standard Spark AR Studio pour animer la pluie. </font><font style="vertical-align: inherit;">Il n'y a rien de sp√©cial ici. </font><font style="vertical-align: inherit;">Nous ajoutons un objet Emtter √† la sc√®ne, sans oublier de lui demander Emitter -&gt; Space -&gt; Local (au lieu de World). </font><font style="vertical-align: inherit;">Il s'agit de s'assurer que les gouttes ne tra√Ænent pas dynamiquement derri√®re les nuages ‚Äã‚Äãpendant le mouvement, mais tombent toujours directement. </font><font style="vertical-align: inherit;">Cette m√©thode est plus pratique pour d√©terminer plus facilement le moment o√π le papillon tombe sous la pluie - pas besoin de faire une correction pour la hauteur. </font><font style="vertical-align: inherit;">Pour les gouttes elles-m√™mes, j'ai pr√©par√© la texture appropri√©e. </font><font style="vertical-align: inherit;">Et bien s√ªr, l'objet pluie se d√©placera avec l'objet nuage. </font><font style="vertical-align: inherit;">J'ai ensuite ajout√© une condition d'acc√®s au nuage au code de gestion des collisions. </font><font style="vertical-align: inherit;">Et, s'il n'y a pas d'obstacle au-dessus du joueur en ce moment, alors le papillon tombe et le jeu se termine.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mod√©ration</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour une mod√©ration r√©ussie, la vid√©o obligatoire du jeu ne doit pas contenir de texte statique non li√© √† des objets. </font><font style="vertical-align: inherit;">Sinon, le robot arr√™te instantan√©ment la mod√©ration. </font><font style="vertical-align: inherit;">Cependant, apr√®s cela, une personne v√©rifie le jeu pendant plusieurs jours. </font><font style="vertical-align: inherit;">Et il n'aimait pas l'abondance de texte avant le match, ainsi qu'√† la fin. </font><font style="vertical-align: inherit;">J'ai d√ª r√©duire la quantit√© de texte. </font><font style="vertical-align: inherit;">Apr√®s cela, le jeu a √©t√© approuv√©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Non pas que mon jeu ait √©t√© particuli√®rement excitant. </font><font style="vertical-align: inherit;">Elle manque probablement de dynamique et de m√©canique suppl√©mentaire. </font><font style="vertical-align: inherit;">Je publierai une mise √† jour. </font><font style="vertical-align: inherit;">Mais j'ai r√©alis√© que faire des jeux sur Instagram est int√©ressant. </font><font style="vertical-align: inherit;">C'est une sorte de d√©fi. </font><font style="vertical-align: inherit;">J'ai vraiment appr√©ci√© le processus de programmation et de r√©solution de toutes sortes de t√¢ches sous le minimalisme en termes d'outils et de quantit√© de m√©moire allou√©e. </font><font style="vertical-align: inherit;">Je me souviens que quelqu'un a dit que 640 Ko suffisaient √† tout le monde. </font><font style="vertical-align: inherit;">Essayez maintenant d'adapter un jeu 3D de 2 Mo. </font><font style="vertical-align: inherit;">Je ne dirai peut-√™tre pas qu'ils sont suffisants pour tout le monde ... Mais essayez-le!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7f/g7/kr/7fg7kra8uhidburs19pognju5vc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusion, je voudrais rassembler dans une liste tous les moments non √©vidents que j'ai rencontr√©s. </font><font style="vertical-align: inherit;">Peut-√™tre que cela est utile √† quelqu'un en tant que triche lors de la cr√©ation de jeux pour Instagram.</font></font><br>
<br>
<i><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âchelle. </font><font style="vertical-align: inherit;">Ajustez l'√©chelle de tous les mod√®les 3D dans l'√©diteur 3D afin qu'il soit imm√©diatement 1: 1 sur la sc√®ne du jeu.</font></font></li>
<li>       .              .   ,            .</li>
<li>.          FBX,     .        -.           ,    .</li>
<li>  .  JPG   ,     ,   ,       -,    JPG,    PNG.</li>
<li>   . , ,        .   Spark AR  ,         . , , ,   3D-.</li>
<li>   3D ,    :     ,    .       .             .</li>
<li>,    ,      .   javascript   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le contexte de Spark AR, il n'y a pas d'objet fen√™tre et toutes sortes d'objets sp√©cifiques au navigateur comme webkitRequestAnimationFrame, mozRequestAnimationFrame, etc. </font><font style="vertical-align: inherit;">C'est un destin lors de la programmation en animation javascript.</font></font></li>
</ul></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr499962/index.html">Quelques faits sur les classificateurs en cascade, qui sont rarement s√©rieusement pris en compte dans les articles scientifiques.</a></li>
<li><a href="../fr499964/index.html">La NASA a s√©lectionn√© trois entreprises qui participeront au programme de cr√©ation d'un navire pour l'atterrissage sur la lune</a></li>
<li><a href="../fr499968/index.html">Liste des mitaps en ligne les plus persistants qui ont lieu m√™me en mai</a></li>
<li><a href="../fr499970/index.html">Nous √©tudions le moteur VoIP Mediastreamer2. Partie 12</a></li>
<li><a href="../fr499972/index.html">Les √©v√©nements en ligne de mai r√©sument</a></li>
<li><a href="../fr499978/index.html">Traduction du livre d'Andrew Un, Passion for Machine Learning, chapitres 36 et 37</a></li>
<li><a href="../fr499982/index.html">Plan de testeur d√©butant: de "Enter IT" √† "I Am an Engineer!"</a></li>
<li><a href="../fr499986/index.html">Et encore une fois sur l'embarqu√©: la recherche de bugs dans le projet Embox</a></li>
<li><a href="../fr499988/index.html">Sucre et COVID-19</a></li>
<li><a href="../fr499990/index.html">G√©ocodage Comment lier 250 mille adresses √† des coordonn√©es en 10 minutes?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>