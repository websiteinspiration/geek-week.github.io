<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💃🏿 👨‍👩‍👦 🤝 キャンバスにテキストを描画する方法 👵🏾 🤽🏿 🤲🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="視覚的なコラボレーションのためのプラットフォームを開発しています。コンテンツを表示するには、Canvasを使用します。テキストを含め、すべてがキャンバスに描画されます。CanvasでテキストをHTMLのように1対1で表示するための既製のソリューションはありません。テキストレンダリングを扱う数年間、私...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>キャンバスにテキストを描画する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/miro/blog/458624/"><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">視覚的なコラボレーションのため</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">プラットフォームを</font></a><font style="vertical-align: inherit;">開発してい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">コンテンツを表示するには、Canvasを使用します。テキストを含め、すべてがキャンバスに描画されます。</font><font style="vertical-align: inherit;">CanvasでテキストをHTMLのように1対1で表示するための既製のソリューションはありません。</font><font style="vertical-align: inherit;">テキストレンダリングを扱う数年間、私たちはさまざまな実装オプションを調査し、多くのバンプを埋め、そして良い解決策を見つけたようです。</font><font style="vertical-align: inherit;">FlashからCanvasに移行した経緯と、SVGのforeignObjectを放棄した理由については、記事で説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/x3/vm/jfx3vm1-ffhat8wfv1jwvc5vf6i.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flashでの移動</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2015年にFlashで製品を作成しました。 Flashの内部には、テキストを適切に処理する方法を知っているテキストエディターがあり、テキストを処理するために特別なことをする必要はありませんでした。しかし、その当時、Flashはすでに衰退していたため、HTMLからCanvasに移行しました。そして、私たちの前では、HTMLエディターのようにキャンバスにテキストを表示し、移動時にFlashバージョンで作成されたテキストを壊さないようにする必要がありました。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーが編集モードとレンダリングモードの間の遷移に気付かずに、製品で直接テキストを編集できるようにしたかったのです。解決策は次のとおりです。テキストのある領域をクリックすると、テキストエディターが開き、テキストを変更できます。カーソルをテキスト領域から離すと、エディターを閉じることができます。この場合、キャンバス上のテキストの表示は、エディタでのテキストの表示に1対1で対応している必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エディターとして、オープンライブラリを使用しましたが、htmlからCanvasへのレンダリング用の既製のライブラリーは、作業の速度と不十分な機能に適していませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはいくつかの解決策を検討しました：</font></font><br>
<br>
<ul>
<li><b> Canvas.fillText.</b>      html,  ,    .        html-     .   ,     ;</li>
<li><b> DOM  Canvas.</b>    , ..           z-index  canvas.     DOM z-index  .</li>
<li><b> html  svg.</b>    html     foreignObject.    html  svg       .     .</li>
</ul><br>
<h2>  SVG foreignObject</h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVG foreignObjectのしくみ：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エディターからHTMLを取得します→HTMLをforeignObjectに配置します→何らかの魔法→画像を取得→キャンバスに画像を追加</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/ht/gp/hjhtgpn56gwrvg1vuoeqqxpbssi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">魔法について</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほとんどのブラウザーがforeignObjectタグをサポートしているという事実にもかかわらず、それぞれがcanvasで結果を使用するための独自の特性を持っています。 FireFoxはBlobオブジェクトで動作します。Edgeでは、画像に対してBase64を実行し、data-urlを返す必要があります。IE11では、タグはまったく機能しません。</font></font><br>
<br>
<pre><code class="javascript hljs">getImageUrl(svg: string, <span class="hljs-attr">browser</span>: string): string {
  <span class="hljs-keyword">let</span> dataUrl = <span class="hljs-string">''</span><font></font>
<font></font>
  <span class="hljs-keyword">switch</span> (browser) {
     <span class="hljs-keyword">case</span> browsers.FIREFOX:
        <span class="hljs-keyword">let</span> domUrl = <span class="hljs-built_in">window</span>.URL || <span class="hljs-built_in">window</span>.webkitURL || <span class="hljs-built_in">window</span>
        <span class="hljs-keyword">let</span> blob = <span class="hljs-keyword">new</span> Blob([svg], {<span class="hljs-attr">type</span>: <span class="hljs-string">'image/svg+xml;charset=utf-8'</span>})<font></font>
        dataUrl = domUrl.createObjectURL(blob)<font></font>
        <span class="hljs-keyword">break</span>
     <span class="hljs-keyword">case</span> browsers.EDGE:
        <span class="hljs-keyword">let</span> encodedSvg = <span class="hljs-built_in">encodeURIComponent</span>(svg)<font></font>
        dataUrl = <span class="hljs-string">'data:image/svg+xml;base64,'</span> + btoa(<span class="hljs-built_in">window</span>.unescape(encodedSvg))
        <span class="hljs-keyword">break</span>
     <span class="hljs-attr">default</span>:<font></font>
        dataUrl = <span class="hljs-string">'data:image/svg+xml,'</span> + <span class="hljs-built_in">encodeURIComponent</span>(svg)<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> dataUrl<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SVGを使用した後、Flashでは気付かなかった興味深いバグが発生しました。</font><font style="vertical-align: inherit;">異なるブラウザで同じサイズとフォントのテキストが異なる方法で表示されました。</font><font style="vertical-align: inherit;">たとえば、行の最後の単語を折り返し、以下のテキストに実行できます。</font><font style="vertical-align: inherit;">私たちにとって、ユーザーが使用しているブラウザーに関係なく、ユーザーが同じ種類のウィジェットを取得することが重要でした。</font><font style="vertical-align: inherit;">これに関しては、Flashに問題はありませんでした。</font><font style="vertical-align: inherit;">彼はどこでも同じです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mb/63/fv/mb63fvrwyib4m-tnl_1xre8j55w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を解決しました。</font><font style="vertical-align: inherit;">まず、すべての単一行テキストについて、ブラウザやサーバーからのデータに関係なく、常に幅を考慮し始めました。</font><font style="vertical-align: inherit;">高さについては、違いは残りますが、私たちの場合、ユーザーを悩ませることはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ブラウザ間の表示の違いを減らすために、エディタとsvgに珍しいcssスタイルを追加する必要があるという実験的な結論に達しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">font-kerning：auto; </font><font style="vertical-align: inherit;">フォントのカーニングを制御します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もっと詳しく</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">webkit-font-smoothing：アンチエイリアス; </font><font style="vertical-align: inherit;">スムージングを担当します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詳細</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局、SVG &lt;foreignObject&gt;のおかげで何が得られましたか。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意のhtmlを描画できます：テキスト、表、グラフィック</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タグはベクター画像を返します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このタグは、IE11を除くすべての最新ブラウザーで機能します</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foreignObjectを放棄した理由</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてがうまくいきましたが、デザイナーが私たちのところに来て、モックアップを作成するためにフォントサポートを追加するように頼まれました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/90/ha/ud90haadatev9z1dvo2qjnu5tle.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、foreignObjectでこれを実行できるかどうか疑問に思いました。この問題を解決すると致命的な欠陥になるという特徴があることがわかりました。自身の内部ではHTMLを表示できますが、外部リソースにはアクセスできないため、動作するすべてのリソースをbase64に変換し、svg内に追加する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bj/eb/-g/bjeb-gztne3x_o8tefz7701bgs0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、OpenSansによって4つのテキストが記述されている場合、このフォントをユーザーに4回ダウンロードする必要があります。このオプションは私たちには合いませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはCanvas Textを...優れたパフォーマンス、ベクター画像のサポート、IE 11を忘れないで書くことにしました</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ベクター画像がなぜ私たちにとって重要なのですか？</font><font style="vertical-align: inherit;">私たちの製品では、ボード上の任意のオブジェクトをズームできます。ベクトル画像を使用すると、一度だけ作成して、ズームに関係なく再利用できます。</font><font style="vertical-align: inherit;">Canvas.fillTextはビットマップを描画します。この場合、ズームごとに画像を再描画する必要があります。これは、思ったとおり、パフォーマンスに大きな影響を与えます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトタイプを作成する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、パフォーマンスをテストするための簡単なプロトタイプを作成しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/kt/wh/dcktwh05pk52qdr6jiipfyna-lo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトタイプの動作原理：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数「text」に与えます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これから、テキストのすべての単語が含まれるオブジェクトを取得し、座標とレンダリング用のスタイルを取得します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトをCanvasに渡します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャンバスはテキストを描画します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトタイプにはいくつかのタスクがありました。スケーリングを伴うCanvasの再描画が遅延なく行われること、およびhtmlをオブジェクトに変換するための時間がsvg画像の作成に過ぎないことを確認することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトタイプは最初のタスクに対処しました。スケーリングは、テキストを描画するときのパフォーマンスにほとんど影響しませんでした。 2番目のタスクには問題がありました。大量のテキストの処理には十分な時間がかかり、パフォーマンスの最初の測定では結果が不十分でした。 1K文字からテキストを描画するために、新しいアプローチはsvgのほぼ2倍の時間を要しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zi/xt/cv/zixtcvj3c0sn-pcbfq77glwuhhe.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはコードを最適化するために最も信頼できる方法を使用することを決定しました-「テストを必要なものに置き換える」;-)。</font><font style="vertical-align: inherit;">しかし真剣に、私たちはアナリストのところに行き、テキストがユーザーによって最も頻繁に作成される期間を尋ねました。</font><font style="vertical-align: inherit;">テキストの平均サイズは14文字であることがわかりました。</font><font style="vertical-align: inherit;">そのような短いテキストの場合、私たちのプロトタイプは次のように大幅に優れたパフォーマンス結果を示しました </font><font style="vertical-align: inherit;">テキストのボリュームに対する速度の依存性は線形であり、svgのラッパーは、テキストの長さに関係なく、ほとんど常に同時に実行されます。</font><font style="vertical-align: inherit;">長いテキストではパフォーマンスが低下する可能性がありますが、ほとんどの場合、速度はsvgよりも優れています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0o/kx/4s/0okx4sbw1txhov2dipas8dpysji.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Canvas Textの更新の作業を数回繰り返した後、次のアルゴリズムを得ました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ1.論理ブロックに分割します。</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テキストをブロックに分けます：段落、リスト;</font></font></li>
<li>      ;</li>
<li>   .</li>
</ol><br>
<b> 2.        </b><br>
<br>
<ol>
<li>       px;</li>
<li>  ,    2     ;</li>
<li>   ,      ,    ;</li>
<li>   ;</li>
<li> x,y   ;</li>
<li>    .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチの利点は、単体テストでHTMLからテキストオブジェクトまでのすべてのコードをカバーできることです。</font><font style="vertical-align: inherit;">これにより、レンダリングと解析自体を個別に確認できるため、開発を大幅にスピードアップできました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、フォントとIE 11をサポートし、すべてを単体テストでカバーしました。ほとんどの場合、レンダリング速度はforeignObjectよりも高速になりました。</font><font style="vertical-align: inherit;">ベータ版ユーザーにチェックインしてリリースしました。</font><font style="vertical-align: inherit;">成功のようです！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功は30分続いた</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、右利きの書記体系を持っている人は、テクニカルサポートを書いていません。そのような言語の存在を忘れていたことがわかりました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/av/gq/ik/avgqikn29xgk7fx5xajj171rh5g.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸いにも、標準のCanvas.fillTextがすでにサポートしているので、右側の書記体系のサポートを追加することは難しくありませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これに対処している間に、fillTextがサポートできなくなったさらに興味深いケースに遭遇しました。テキストの一部が右から左、次に左から右、そして再び右から左に書かれている双方向テキストに出くわしました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/ob/gr/ixobgrf-sffclz5p2rbsikodizo.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが知っていた唯一の解決策は、ブラウザーのW3C仕様に進み、Canvas Text内でこれを繰り返すことでした。それは困難で苦痛でしたが、基本的なサポートを追加することができました。 ：双方向の詳細</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちが自分のために行った簡単な結論</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像にHTMLを表示するには、SVG foreignObjectを使用します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常に意思決定のために製品を分析します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトタイプを作成します。</font><font style="vertical-align: inherit;">彼らは、複雑な決定は一見それだけに見えるかもしれないことを示すことができます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストでカバーできるように、すぐにコードを書きます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国際的な製品では、双方向を含む多くの異なる言語があることを忘れないことが重要です。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような問題を解決した経験がある場合は、コメント欄で共有してください。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458608/index.html">Node.js開発者ツール ジョブキュー</a></li>
<li><a href="../ja458612/index.html">宇宙。7年間</a></li>
<li><a href="../ja458614/index.html">ブラウザ座標を取得および追跡するためのReactive UsePosition（）フックの作成</a></li>
<li><a href="../ja458620/index.html">ソイレント-人生を延ばす最初の飲み物</a></li>
<li><a href="../ja458622/index.html">最小のオートメーション。パート1（ゼロの後）。ネットワーク仮想化</a></li>
<li><a href="../ja458626/index.html">StealthWatch：基本的な概念と最小要件。パート1</a></li>
<li><a href="../ja458630/index.html">16年間で純粋なWindowsフォーム+ Cでゲームを開発した小さな歴史</a></li>
<li><a href="../ja458634/index.html">「D̶o̶n̶'̶tbe evil」またはFacebookが私たちから隠しているもの</a></li>
<li><a href="../ja458636/index.html">Tutu.ruオフィスのmitla DevLeadsのビデオ</a></li>
<li><a href="../ja458638/index.html">Intel oneAPIプロジェクト：多くのアーキテクチャ、1つのAPI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>