<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛀🏻 👩🏾‍💻 👩‍🎤 Go 1.13のバグへの対処 🤛🏾 🔫 🏙️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="過去10年間、Goはエラーを値として処理するという事実をうまく利用してきました。標準ライブラリはエラーに対する最小限のサポートを備えerrors.Newてfmt.Errorfいましたが、関数のみであり、メッセージのみを含むエラーを生成します-組み込みのインターフェイスにより、Goプログラマーは情報を...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Go 1.13のバグへの対処</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/473658/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/9f/wo/zl/9fwozl-z2zhf7bg5l_i8lfvdxdw.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
過去10年間、Goは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーを値として</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">する</font></a><font style="vertical-align: inherit;">という事実をうまく利用してきました</font><font style="vertical-align: inherit;">。標準ライブラリはエラーに対する最小限のサポートを備え</font></font><code>errors.New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て</font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いましたが、</font><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">のみであり、メッセージのみを含むエラーを生成します-組み込みのインターフェイスにより、Goプログラマーは情報を追加できます。必要なのは、メソッドを実装するタイプだけです</font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> QueryError <span class="hljs-keyword">struct</span> {<font></font>
    Query <span class="hljs-keyword">string</span><font></font>
    Err   error<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *QueryError)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> { <span class="hljs-keyword">return</span> e.Query + <span class="hljs-string">": "</span> + e.Err.Error() }</code></pre><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのタイプのエラーはすべての言語で見つかり、タイムスタンプからファイル名、サーバーアドレスまで、さまざまな情報を保存します。</font><font style="vertical-align: inherit;">追加のコンテキストを提供する低レベルのエラーがよく言及されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goで1つのエラーに別のエラーが含まれるパターンは非常に一般的であるため</font><font style="vertical-align: inherit;">、Go 1.13での激しい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">議論の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">後、</font><font style="vertical-align: inherit;">明示的なサポートが追加されました。</font><font style="vertical-align: inherit;">この記事では、前述のサポートを提供する標準ライブラリへの追加について検討し</font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">エラーパッケージの3つの新しい関数との新しいフォーマットコマンドです</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更について詳細に説明する前に、以前のバージョンの言語でエラーがどのように調査および構築されたかについて説明しましょう。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go 1.13以前のエラー</font></font></h1><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー調査</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goのエラーは意味です。</font><font style="vertical-align: inherit;">プログラムは、さまざまな方法でこれらの値に基づいて決定を行います。</font><font style="vertical-align: inherit;">ほとんどの場合、エラーはnilと比較され、操作が失敗したかどうかが確認されます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-comment">// something went wrong</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーを比較して、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントロール</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を見つけ</font><font style="vertical-align: inherit;">、特定のエラーが発生したかどうかを理解することがあります。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> ErrNotFound = errors.New(<span class="hljs-string">"not found"</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> err == ErrNotFound {
    <span class="hljs-comment">// something wasn't found</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラー値は、言語で定義されたエラーインターフェイスを満たす任意の型にすることができます。</font><font style="vertical-align: inherit;">プログラムは、typeステートメントまたはtypeスイッチを使用して、より具体的なタイプのエラー値を表示できます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> NotFoundError <span class="hljs-keyword">struct</span> {<font></font>
    Name <span class="hljs-keyword">string</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *NotFoundError)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> { <span class="hljs-keyword">return</span> e.Name + <span class="hljs-string">": not found"</span> }<font></font>
<font></font>
<span class="hljs-keyword">if</span> e, ok := err.(*NotFoundError); ok {
    <span class="hljs-comment">// e.Name wasn't found</span><font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情報を追加する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの場合、関数は呼び出しスタックにエラーを渡し、エラーが発生したときに何が起こったかの簡単な説明などの情報を追加します。</font><font style="vertical-align: inherit;">これは簡単で、前のエラーのテキストを含む新しいエラーを作成するだけです。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"decompress %v: %v"</span>, name, err)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を使用して新しいエラーを作成する</font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、テキストを除いて、元のエラーからすべてがスローされます。</font><font style="vertical-align: inherit;">例c </font></font><code>QueryError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">見たように</font><font style="vertical-align: inherit;">、コードを使用して分析用に保存するために、元のエラーを含む新しいタイプのエラーを定義する必要がある場合があります。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> QueryError <span class="hljs-keyword">struct</span> {<font></font>
    Query <span class="hljs-keyword">string</span><font></font>
    Err   error<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムは値の内部を調べ</font></font><code>*QueryError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、元のエラーに基づいて決定を行う</font><font style="vertical-align: inherit;">ことができ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これは、エラーの「アンラップ」と呼ばれることもあります。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">if</span> e, ok := err.(*QueryError); ok &amp;&amp; e.Err == ErrPermission {
    <span class="hljs-comment">// query failed because of a permission problem</span>
}</code></pre><br><font style="vertical-align: inherit;"></font><code>os.PathError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準ライブラリの</font><font style="vertical-align: inherit;">
タイプ</font><font style="vertical-align: inherit;">は、1つのエラーに別のエラーが含まれていることを示すもう1つの例です。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go 1.13のエラー</font></font></h1><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unwrapメソッド</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゴー1.13は、標準ライブラリ内のパッケージを持っている</font></font><code>errors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font></font><code>fmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のエラーを含むエラーの処理を簡素化。</font><font style="vertical-align: inherit;">最も重要なのは変更ではなく規則です。別のエラーを含むエラー</font></font><code>Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、元のエラーを返す</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実装でき</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それは場合に</font></font><code>e1.Unwrap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返され</font></font><code>e2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、その後、我々はそれがあると言う</font></font><code>e1</code> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パック</font></font></i> <code>e2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とすることができ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンパック</font></font></i> <code>e1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受信します</font></font><code>e2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この規則に従って、上記のタイプを</font><font style="vertical-align: inherit;">、それに含まれるエラーを返す</font></font><code>QueryError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドに</font><font style="vertical-align: inherit;">与えることができ</font></font><code>Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *QueryError)</span> <span class="hljs-title">Unwrap</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> { <span class="hljs-keyword">return</span> e.Err }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーのアンパックの結果には、メソッドも含まれる場合があります</font></font><code>Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">アンパックを繰り返して取得した一連のエラーを、エラーの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェーンと</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼びます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsおよびAsを使用したエラーの調査</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゴー1.13で、パッケージは</font></font><code>errors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バグを調査するための2つの新機能が含まれています</font></font><code>Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数</font></font><code>errors.Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はエラーと値を比較します。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Similar to:</span>
<span class="hljs-comment">//   if err == ErrNotFound { … }</span>
<span class="hljs-keyword">if</span> errors.Is(err, ErrNotFound) {
    <span class="hljs-comment">// something wasn't found</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数</font></font><code>As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、エラーが特定のタイプであるかどうかをチェックします。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Similar to:</span>
<span class="hljs-comment">//   if e, ok := err.(*QueryError); ok { … }</span>
<span class="hljs-keyword">var</span> e *QueryError
<span class="hljs-keyword">if</span> errors.As(err, &amp;e) {
    <span class="hljs-comment">// err is a *QueryError, and e is set to the error's value</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なケースでは、関数</font></font><code>errors.Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は制御エラーとの比較のように動作し、関数</font></font><code>errors.As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はtypeステートメントのように動作します。</font><font style="vertical-align: inherit;">ただし、パックされたエラーを処理する場合、これらの関数はチェーン内のすべてのエラーを評価します。</font><font style="vertical-align: inherit;">上記の解凍例</font></font><code>QueryError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">見て</font><font style="vertical-align: inherit;">、元のエラーを調べて</font><font style="vertical-align: inherit;">みましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">if</span> e, ok := err.(*QueryError); ok &amp;&amp; e.Err == ErrPermission {
    <span class="hljs-comment">// query failed because of a permission problem</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数を使用して、</font></font><code>errors.Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これを書くことができます：</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">if</span> errors.Is(err, ErrPermission) {
    <span class="hljs-comment">// err, or some error that it wraps, is a permission problem</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージ</font></font><code>errors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には</font></font><code>Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー</font><font style="vertical-align: inherit;">メソッドの呼び出し結果を返す</font><font style="vertical-align: inherit;">新しい関数も含まれて</font><font style="vertical-align: inherit;">います。</font><font style="vertical-align: inherit;">エラーに</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">がない場合はnilが返されます</font></font><code>Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>errors.Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font><font style="vertical-align: inherit;">を使用</font></font><code>errors.As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すると、チェーン全体を1回の呼び出しで探索できるため、</font><font style="vertical-align: inherit;">通常は</font><font style="vertical-align: inherit;">or </font><font style="vertical-align: inherit;">を使用</font><font style="vertical-align: inherit;">することをお勧めします。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％wでのパッケージ化エラー</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたよう</font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、エラーに追加情報を追加</font><font style="vertical-align: inherit;">する関数</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用することは通常の慣行</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"decompress %v: %v"</span>, name, err)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go 1.13では、この関数</font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は新しいコマンドをサポートしてい</font></font><code>%w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">そうである場合、返さ</font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れる</font><font style="vertical-align: inherit;">エラーに</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、エラー</font><font style="vertical-align: inherit;">であるはずの</font></font><code>Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引数を返す</font><font style="vertical-align: inherit;">メソッドが含まれ</font></font><code>%w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">他のすべての場合、</font></font><code>%w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同一</font></font><code>%v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-comment">// Return an error which unwraps to err.</span>
    <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"decompress %v: %w"</span>, name, err)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーパッケージ</font></font><code>%w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する</font></font><code>errors.Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、と</font><font style="vertical-align: inherit;">で使用できるように</font><font style="vertical-align: inherit;">なり</font></font><code>errors.As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="go hljs">err := fmt.Errorf(<span class="hljs-string">"access denied: %w"</span>, ErrPermission)<font></font>
...<font></font>
<span class="hljs-keyword">if</span> errors.Is(err, ErrPermission) ...
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いつパックするの？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラー使用</font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはカスタムタイプの実装に</font><font style="vertical-align: inherit;">追加のコンテキストを追加する場合</font><font style="vertical-align: inherit;">、新しいエラーに元のエラーが含まれるかどうかを決定する必要があります。これに対する単一の答えはありません。それはすべて、新しいエラーが作成されたコンテキストに依存します。彼女の発信者を表示するパック。実装の詳細の開示につながる場合は、エラーをパッケージ化しないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば</font></font><code>Parse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>io.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複雑なデータ構造</font><font style="vertical-align: inherit;">から読み取る</font><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">想像してみてください</font><font style="vertical-align: inherit;">。エラーが発生した場合は、エラーが発生した行と列の番号を確認する必要があります。からの読み取り中にエラーが発生した場合は、</font></font><code>io.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージ化して理由を調べる必要があります。呼び出し元は関数に提供されて</font></font><code>io.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いるため、生成されたエラーを示すことは理にかなっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のケース：複数のデータベース呼び出しを行う関数は、おそらくこれらの呼び出しのいずれかの結果がパックされたエラーを返すべきではありません。この関数で使用されるデータベースが実装の一部である場合、これらのエラーの開示は抽象化に違反します。たとえば</font></font><code>LookupUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、パッケージの</font><font style="vertical-align: inherit;">関数</font></font><code>pkg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がGoパッケージを使用して</font></font><code>database/sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いる場合、エラーが発生する可能性があります</font></font><code>sql.ErrNoRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。でエラーを返すと</font></font><code>fmt.Errorf("accessing DB: %v", err)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、呼び出し元は内部を調べて見つけることができません</font></font><code>sql.ErrNoRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。しかし、関数がを返す場合、</font></font><code>fmt.Errorf("accessing DB: %w", err)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出し元は次のように書くことができます。</font></font><br>
<br>
<pre><code class="go hljs">err := pkg.LookupUser(...)
<span class="hljs-keyword">if</span> errors.Is(err, sql.ErrNoRows) …</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、</font></font><code>sql.ErrNoRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のデータベースのパッケージに切り替えた場合でも、クライアントを中断したくない</font><font style="vertical-align: inherit;">場合は、関数が常に戻る</font><font style="vertical-align: inherit;">必要があります。</font><font style="vertical-align: inherit;">つまり、パッケージ化はエラーをAPIの一部にします。</font><font style="vertical-align: inherit;">今後このエラーのサポートをAPIの一部としてコミットしない場合は、パッケージ化しないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パックするかどうかに関係なく、エラーは変化しないことに注意してください。</font><font style="vertical-align: inherit;">それを理解</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する人</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は同じ情報を持っています。</font><font style="vertical-align: inherit;">パッケージングに関する決定は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラム</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がより多くの情報に基づいた決定を行うことができるように</font><i><font style="vertical-align: inherit;">プログラムに</font></i><font style="vertical-align: inherit;">追加情報が必要かどうかによって異なり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">または、抽象化のレベルを維持するためにこの情報を非表示にする場合。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsおよびAsメソッドを使用したエラーテストの設定</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この関数</font></font><code>errors.Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、チェーン内の各エラーをチェックして、ターゲット値に準拠しているかどうかを確認します。</font><font style="vertical-align: inherit;">デフォルトでは、同等の場合、エラーはこの値と一致します。</font><font style="vertical-align: inherit;">さらに、チェーンのエラーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装を使用して、ターゲット値への準拠を宣言でき</font></font><code>Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">エラーをテンプレートと比較し、ゼロ以外のフィールドのみを評価</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">するUpspinパッケージによって</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
引き起こさ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たエラーを考え</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Error <span class="hljs-keyword">struct</span> {<font></font>
    Path <span class="hljs-keyword">string</span>
    User <span class="hljs-keyword">string</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *Error)</span> <span class="hljs-title">Is</span><span class="hljs-params">(target error)</span> <span class="hljs-title">bool</span></span> {<font></font>
    t, ok := target.(*Error)<font></font>
    <span class="hljs-keyword">if</span> !ok {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> (e.Path == t.Path || t.Path == <span class="hljs-string">""</span>) &amp;&amp;<font></font>
           (e.User == t.User || t.User == <span class="hljs-string">""</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span> errors.Is(err, &amp;Error{User: <span class="hljs-string">"someuser"</span>}) {
    <span class="hljs-comment">// err's User field is "someuser".</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数</font></font><code>errors.As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><code>As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能であれば</font><font style="vertical-align: inherit;">メソッドにもアドバイスし</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーとパッケージAPI</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーを返すパッケージ（およびほとんどのパッケージがこれを行う）は、プログラマーが信頼できるこれらのエラーのプロパティを記述する必要があります。適切に設計されたパッケージは、信頼できないプロパティのエラーを返すことも回避します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なことは、操作が成功したかどうかをそれぞれ示し、それぞれ値nilまたはnon-nilを返すことです。多くの場合、他の情報は必要ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「要素が見つかりません」など、識別可能なエラー状態を返す関数が必要な場合は、信号値がパックされたエラーを返すことができます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> ErrNotFound = errors.New(<span class="hljs-string">"not found"</span>)<font></font>
<font></font>
<span class="hljs-comment">// FetchItem returns the named item.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// If no item with the name exists, FetchItem returns an error</span>
<span class="hljs-comment">// wrapping ErrNotFound.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">FetchItem</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(*Item, error)</span></span> {
    <span class="hljs-keyword">if</span> itemNotFound(name) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"%q: %w"</span>, name, ErrNotFound)<font></font>
    }<font></font>
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
発信者が意味的に調べることができるエラーを提供する他のパターンがあります。</font><font style="vertical-align: inherit;">たとえば、制御値、特定のタイプ、または述語関数を使用して分析できる値を直接返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれの場合も、内部の詳細をユーザーに開示しないでください。</font><font style="vertical-align: inherit;">「パッケージ化する価値があるのはいつですか？」の章で述べたように、別のパッケージからエラーを返す場合は、将来この特定のエラーを返すようにコミットするつもりがない限り、元のエラーが表示されないように変換してください。</font></font><br>
<br>
<pre><code class="go hljs">f, err := os.Open(filename)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-comment">// The *os.PathError returned by os.Open is an internal detail.</span>
    <span class="hljs-comment">// To avoid exposing it to the caller, repackage it as a new</span>
    <span class="hljs-comment">// error with the same text. We use the %v formatting verb, since</span>
    <span class="hljs-comment">// %w would permit the caller to unwrap the original *os.PathError.</span>
    <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"%v"</span>, err)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数がパックされた信号の値または型のエラーを返す場合、元のエラーを直接返さないでください。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> ErrPermission = errors.New(<span class="hljs-string">"permission denied"</span>)<font></font>
<font></font>
<span class="hljs-comment">// DoSomething returns an error wrapping ErrPermission if the user</span>
<span class="hljs-comment">// does not have permission to do something.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DoSomething</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">if</span> !userHasPermission() {
        <span class="hljs-comment">// If we return ErrPermission directly, callers might come</span>
        <span class="hljs-comment">// to depend on the exact error value, writing code like this:</span>
        <span class="hljs-comment">//</span>
        <span class="hljs-comment">//     if err := pkg.DoSomething(); err == pkg.ErrPermission { … }</span>
        <span class="hljs-comment">//</span>
        <span class="hljs-comment">// This will cause problems if we want to add additional</span>
        <span class="hljs-comment">// context to the error in the future. To avoid this, we</span>
        <span class="hljs-comment">// return an error wrapping the sentinel so that users must</span>
        <span class="hljs-comment">// always unwrap it:</span>
        <span class="hljs-comment">//</span>
        <span class="hljs-comment">//     if err := pkg.DoSomething(); errors.Is(err, pkg.ErrPermission) { ... }</span>
        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"%w"</span>, ErrPermission)<font></font>
    }<font></font>
    <span class="hljs-comment">// ...</span><font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの関数とフォーマットコマンドについてのみ説明しましたが、Goプログラムでのエラー処理の大幅な改善に役立つことを願っています。</font><font style="vertical-align: inherit;">追加のコンテキストを提供するためのパッケージ化が通常のプラクティスになり、プログラマーがより良い決定を行い、バグをより早く見つけるのに役立つことを願っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラスコックスが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GopherCon 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">での</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">スピーチで述べ</font></a><font style="vertical-align: inherit;">たように、Go 2に向かう途中で、実験、簡略化、および出荷を行います。</font><font style="vertical-align: inherit;">そして今、これらの変更を出荷して、私たちは新しい実験に着手しています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja473646/index.html">小さな会社でのハッカソン：一連のリソースを捨てずに配置する方法</a></li>
<li><a href="../ja473648/index.html">馬は死んだ-叫び：tslintからeslintへの移行</a></li>
<li><a href="../ja473652/index.html">Node.jsとOracleデータベースを使用したREST APIの作成。パート5</a></li>
<li><a href="../ja473654/index.html">PHP Composer：苦労せずに依存関係を修正</a></li>
<li><a href="../ja473656/index.html">Hugo Static Site Generatorエクスペリエンス</a></li>
<li><a href="../ja473660/index.html">アーケードリバースエンジニアリング：NBAジャムでマイケルジョーダンを記録する</a></li>
<li><a href="../ja473664/index.html">直接の学習経験。Yandex.Practicum-データアナリスト</a></li>
<li><a href="../ja473666/index.html">サイエンスフィクションのライターとして、アーサークラークはジャーナルTech-Youthをほぼ閉じました</a></li>
<li><a href="../ja473668/index.html">なぜBitrix-Bitrix</a></li>
<li><a href="../ja473670/index.html">Stoloto：宝くじにモバイルを導入する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>