<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèæ üèµÔ∏è ü§∑üèΩ Ableton wird nicht ben√∂tigt: Verbinden Sie Ableton Push 2 mit dem VCV-Rack üò∞ üõåüèΩ üìØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Erstellen von Musik verl√§uft in letzter Zeit √§hnlich wie ein Foto vor 10 Jahren: Jedes hat seinen eigenen DSLR- und Instagram-Account. Die Musikin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ableton wird nicht ben√∂tigt: Verbinden Sie Ableton Push 2 mit dem VCV-Rack</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491244/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/vm/8j/qkvm8jnnid3kb_8kybxztptlbfu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Erstellen von Musik verl√§uft in letzter Zeit √§hnlich wie ein Foto vor 10 Jahren: Jedes hat seinen eigenen DSLR- und Instagram-Account. Die Musikindustrie freut sich sehr dar√ºber, denn ein solches Interesse bringt viel Geld. Jeden Tag erscheinen neue VST-Plugins und analoge Ger√§te, die Anzahl der Themenkurse w√§chst rasant, Blogs, die sich der Musikproduktion widmen, sind auf dem Top-Youtube zu finden. Vor diesem Hintergrund sehen Open-Source-Projekte sehr interessant aus und erm√∂glichen es jedem, der sich als Produzent versuchen m√∂chte, ohne viel Geld daf√ºr auszugeben. Ein solches Projekt ist VCV Rack, mit dem die teuerste Klasse von Musikinstrumenten - analoge modulare Synthesizer - f√ºr jedermann zug√§nglich gemacht werden soll. Als ich k√ºrzlich auf die Idee f√ºr einen Track kam,und zur Hand gab es nur einen Linux-Laptop, ich wollte den ganzen Track in VCV machen. Unterwegs bestand der Wunsch, die Synthesizer mithilfe des MIDI-Controllers so zu steuern, dass die Verwendung der verf√ºgbaren Module nicht funktioniert. Am Ende habe ich beschlossen, ein Plugin zu schreiben, um Ableton Push 2 mit VCV Rack zu verbinden. In diesem Artikel werden wir dar√ºber sprechen, was daraus wurde und wie wir unsere eigenen Module f√ºr VCV schreiben.</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz√ºbersicht</font></font></b><div class="spoiler_text">VCV Rack ‚Äî open source ,   .  VCV  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">  </a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    </a>.<br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/videoseries" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
Ableton Push 2 ‚Äî    midi-  Ableton,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> DAW</a>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">API    </a>.<br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/0CdMvkBOUgs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VCV-Rack-API</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jedes Modul in VCV besteht aus zwei Teilen - Audio und Grafik. </font><font style="vertical-align: inherit;">Der Audioteil erbt von der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modulklasse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prozessmethode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die f√ºr jedes Sample aufgerufen wird, dh mit einer Sampling-Frequenz. </font><font style="vertical-align: inherit;">√úbrigens kann die Abtastfrequenz in VCV von Standard 44,1 kHz bis zu 768 kHz variieren, was eine genauere Emulation modularer Synthesizer bei ausreichender Rechenleistung erm√∂glicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Objekte des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModuleWidget</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Typs sind verantwortlich f√ºr die Grafik </font><font style="vertical-align: inherit;">, die die erben </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ziehverfahren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">VCV verwendet die Nanovg-Vektorgrafikbibliothek. </font><font style="vertical-align: inherit;">Zeichnung im </font><font style="vertical-align: inherit;">Inneren des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ziehverfahren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies kann sowohl innerhalb der Modulgrenzen (der √úberschuss wird von der Engine abgeschnitten) als auch beispielsweise im Framebuffer auftreten, den wir noch verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was braucht es also, um Ihr Modul f√ºr VCV zu schreiben?</font></font><br>
<br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einrichten der Umgebung und Installieren des Rack SDK</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erste Schritt ist </font><font style="vertical-align: inherit;">in der Dokumentation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gut beschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und verursacht keine Schwierigkeiten (zumindest unter Linux), daher werden wir nicht weiter darauf eingehen.</font></font><br>
<br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generieren Sie eine Plugin-Vorlage</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daf√ºr gibt es im Rack SDK ein helper.py-Skript. </font><font style="vertical-align: inherit;">Er muss createplugin sagen und dann den Namen des Plugins und optional Informationen dar√ºber angeben.</font></font><br>
<br>
<pre><code class="bash hljs">&lt;Rack SDK folder&gt;/helper.py createplugin MyPlugin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Plugin-Vorlage erstellt wird, kann sie mit dem Befehl kompiliert und installiert werden</font></font><br>
<br>
<pre><code class="bash hljs">RACK_DIR=&lt;Rack SDK folder&gt; make install</code></pre><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeichnen Sie das Frontend des Moduls</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jedes Plugin kann mehrere Module enthalten, und f√ºr jedes der Module m√ºssen Sie ein Hauptfenster zeichnen. Zu diesem Zweck bietet uns die VCV-Dokumentation die Verwendung von Inkscape oder einem anderen Vektoreditor. Da die Module in VCV auf einem virtuellen Eurorack-St√§nder montiert sind, betr√§gt ihre H√∂he immer 128,5 mm und die Breite sollte ein Vielfaches von 5,08 mm betragen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grundlegende Schnittstellenelemente wie CV / Gate-Sockel, Tasten und Gl√ºhbirnen k√∂nnen in Vektorform markiert werden. Zeichnen Sie dazu an ihrer Stelle Kreise der entsprechenden Farben ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weitere Details hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), damit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">helper.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dann </font><font style="vertical-align: inherit;">Code f√ºr dieses Markup </font><i><font style="vertical-align: inherit;">generiert</font></i><font style="vertical-align: inherit;"> . Pers√∂nlich schien es mir, dass dies keine sehr praktische Funktion ist und es einfacher ist, Elemente direkt aus dem Code zu platzieren. Wenn das Bild und das Layout fertig sind, m√ºssen Sie </font><i><font style="vertical-align: inherit;">helper.py</font></i><font style="vertical-align: inherit;"> erneut </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausf√ºhren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um eine Modulvorlage zu erstellen und sie der Frontplatte zuzuordnen.</font></font><br>
<br>
<pre><code class="bash hljs">helper.py createmodule MyModule res/MyModule.svg src/MyModule.cpp</code></pre><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir verbinden Kn√∂pfe und Drehungen</font></font></b></h2><br>
<img src="https://habrastorage.org/webt/oz/wq/z_/ozwqz_ss4sqqdci_q7dxbarbfve.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abgesehen von der Anzeige wird Ableton Push 2 vom Computer als normales USB-MIDI-Ger√§t angesehen, wodurch es einfach ist, eine Verbindung zwischen ihm und dem VCV-Rack herzustellen. </font><font style="vertical-align: inherit;">Erstellen Sie dazu eine Eingabe-MIDI-Warteschlange und einen Ausgabe-MIDI-Port innerhalb der Klasse des Moduls.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialisierungscode</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AbletonPush2</span> :</span> Module {<font></font>
    midi::Output midiOutput;<font></font>
    midi::InputQueue midiInput;<font></font>
<font></font>
    <span class="hljs-keyword">bool</span> inputConnected;
    <span class="hljs-keyword">bool</span> outputConnected;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, Ableton Push unter den angeschlossenen MIDI-Ger√§ten zu finden und eine Verbindung herzustellen. </font><font style="vertical-align: inherit;">Da das Modul ausschlie√ülich f√ºr die Verwendung mit Ableton Push ausgelegt ist, m√ºssen wir den Benutzer nicht mit einer Auswahl an Ger√§ten belasten, sondern Sie k√∂nnen es einfach anhand des Namens finden.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controller-Verbindungscode</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">connectPush</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> in_devs = midiInput.getDeviceIds();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; in_devs.size(); i++){
        <span class="hljs-keyword">if</span> (midiInput.getDeviceName(in_devs[i]).find(<span class="hljs-string">"Ableton"</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) {<font></font>
            midiInput.setDeviceId(in_devs[i]);<font></font>
            inputConnected = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
		<font></font>
    <span class="hljs-keyword">auto</span> out_devs = midiOutput.getDeviceIds();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; out_devs.size(); i++){
        <span class="hljs-keyword">if</span> (midiOutput.getDeviceName(out_devs[i]).find(<span class="hljs-string">"Ableton"</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) {<font></font>
            midiOutput.setDeviceId(out_devs[i]);<font></font>
            outputConnected = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt k√∂nnen Sie in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prozessmethode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regelm√§√üig √ºberpr√ºfen, ob der Controller angeschlossen ist, und die Midi-Warteschlange fragen, ob Nachrichten eingegangen sind. </font><font style="vertical-align: inherit;">Hier ist zu erw√§hnen, was und wie im Midi-Standard generell codiert ist. </font><font style="vertical-align: inherit;">Tats√§chlich gibt es zwei Haupttypen von Nachrichten: Note ON / OFF, die die Notennummer und die Druckkraft √ºbertr√§gt, und CC - Command Control, die den numerischen Wert einiger variabler Parameter √ºbertr√§gt. </font><font style="vertical-align: inherit;">Weitere Informationen zu Midi finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIDI Queue Polling Code</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ProcessArgs &amp;args)</span> <span class="hljs-keyword">override</span> </span>{
    <span class="hljs-keyword">if</span> (sampleCounter &gt; args.sampleRate / updateFrequency) {<font></font>
<font></font>
        <span class="hljs-keyword">if</span> ((!inputConnected) &amp;&amp; (!outputConnected)) {<font></font>
            connectPush();<font></font>
        }<font></font>
<font></font>
	midi::Message msg;<font></font>
	<span class="hljs-keyword">while</span> (midiInput.shift(&amp;msg)) {<font></font>
	    processMidi(msg);<font></font>
	}<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt m√∂chte ich den Controller-Pads beibringen, in verschiedenen Farben zu leuchten, damit sie bequemer navigiert werden k√∂nnen. Dazu m√ºssen wir ihm den entsprechenden Midi-Befehl senden. Betrachten Sie zum Beispiel Pad Nummer 36 (dies ist das Pad unten links). Wenn Sie darauf klicken, sendet der Controller den Befehl 0x90 (Note on), gefolgt von der Note Nummer (36) und einer Nummer von 0 bis 127, was die St√§rke der Presse bedeutet. Wenn der Computer im Gegenteil den gleichen Befehl 0x90 und die gleiche Notennummer 36 an den Controller sendet, gibt die dritte Nummer die Farbe an, mit der das untere linke Pad leuchten soll. Die Nummern der Tasten und Pads sind in der obigen Abbildung dargestellt. Push bietet zahlreiche M√∂glichkeiten zum Arbeiten mit Farben, Paletten, Animationen und anderen Hintergrundbeleuchtungsparametern. Ich ging nicht auf Details ein und brachte einfach alle m√∂glichen Farben der Standardpalette auf die Pads und w√§hlte die aus, die mir gefielen.Im allgemeinen Fall sieht die Konvertierung von Midi-Befehlen in PWM-Werte auf LEDs laut Dokumentation jedoch folgenderma√üen aus:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/at/zq/8oatzqvwy_gwqvgu4cmjgjpbknm.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steuercode f√ºr die Hintergrundbeleuchtung</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lightOn</span><span class="hljs-params">(<span class="hljs-keyword">int</span> note, <span class="hljs-keyword">int</span> color)</span></span>{<font></font>
    midi::Message msg;<font></font>
    msg.setNote(note);<font></font>
    msg.setValue(color);<font></font>
    msg.setChannel(<span class="hljs-number">1</span>);<font></font>
    msg.setStatus(<span class="hljs-number">0x9</span>);<font></font>
    midiOutput.sendMessage(msg);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lightOff</span><span class="hljs-params">(<span class="hljs-keyword">int</span> note)</span></span>{<font></font>
    midi::Message msg;<font></font>
    msg.setNote(note);<font></font>
    msg.setValue(<span class="hljs-number">0</span>);<font></font>
    msg.setChannel(<span class="hljs-number">1</span>);<font></font>
    msg.setStatus(<span class="hljs-number">0x8</span>);<font></font>
    midiOutput.sendMessage(msg);<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir verbinden das Display</font></font></b></h2><br>
<img src="https://habrastorage.org/webt/os/yl/kv/osylkvou5ba8_aoa3rwhst94uiu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das Display anzuschlie√üen, m√ºssen Sie mit USB arbeiten. </font><font style="vertical-align: inherit;">Der Controller selbst kann nichts zeichnen und wei√ü nichts √ºber Grafiken. </font><font style="vertical-align: inherit;">Er m√∂chte lediglich mindestens alle 2 Sekunden einen Frame mit einer Gr√∂√üe von 160 x 960 Pixel senden. </font><font style="vertical-align: inherit;">Das gesamte Rendern erfolgt auf der Seite des Computers. </font><font style="vertical-align: inherit;">Schlie√üen Sie das USB-Ger√§t an und √∂ffnen Sie es, wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der Dokumentation beschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbindungscode anzeigen</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> _MSC_VER</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> _WIN32</span><font></font>
<font></font>
<span class="hljs-comment">// see following link for a discussion of the</span>
<span class="hljs-comment">// warning suppression:</span>
<span class="hljs-comment">// http://sourceforge.net/mailarchive/forum.php?</span>
<span class="hljs-comment">// thread_name=50F6011C.2020000%40akeo.ie&amp;forum_name=libusbx-devel</span><font></font>
<font></font>
<span class="hljs-comment">// Disable: warning C4200: nonstandard extension used:</span>
<span class="hljs-comment">// zero-sized array in struct/union</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> <span class="hljs-meta-keyword">warning</span>(disable:4200)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __linux__</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libusb-1.0/libusb.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"libusb.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ABLETON_VENDOR_ID 0x2982</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH2_PRODUCT_ID  0x1967</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> libusb_device_handle* <span class="hljs-title">open_push2_device</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">int</span> result;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ((result = libusb_init(<span class="hljs-literal">NULL</span>)) &lt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error: [%d] could not initilialize usblib\n"</span>, result);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
  }<font></font>
<font></font>
  libusb_set_debug(<span class="hljs-literal">NULL</span>, LIBUSB_LOG_LEVEL_ERROR);<font></font>
<font></font>
  libusb_device** devices;<font></font>
  <span class="hljs-keyword">ssize_t</span> count;<font></font>
  count = libusb_get_device_list(<span class="hljs-literal">NULL</span>, &amp;devices);
  <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error: [%ld] could not get usb device list\n"</span>, count);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
  }<font></font>
<font></font>
  libusb_device* device;<font></font>
  libusb_device_handle* device_handle = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
  <span class="hljs-keyword">char</span> ErrorMsg[<span class="hljs-number">128</span>];<font></font>
<font></font>
  <span class="hljs-comment">// set message in case we get to the end of the list w/o finding a device</span>
  <span class="hljs-built_in">sprintf</span>(ErrorMsg, <span class="hljs-string">"error: Ableton Push 2 device not found\n"</span>);<font></font>
<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; (device = devices[i]) != <span class="hljs-literal">NULL</span>; i++)<font></font>
  {<font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">libusb_device_descriptor</span> <span class="hljs-title">descriptor</span>;</span>
    <span class="hljs-keyword">if</span> ((result = libusb_get_device_descriptor(device, &amp;descriptor)) &lt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-built_in">sprintf</span>(ErrorMsg,
        <span class="hljs-string">"error: [%d] could not get usb device descriptor\n"</span>, result);
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (descriptor.bDeviceClass == LIBUSB_CLASS_PER_INTERFACE<font></font>
      &amp;&amp; descriptor.idVendor == ABLETON_VENDOR_ID<font></font>
      &amp;&amp; descriptor.idProduct == PUSH2_PRODUCT_ID)<font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> ((result = libusb_open(device, &amp;device_handle)) &lt; <span class="hljs-number">0</span>)<font></font>
      {<font></font>
        <span class="hljs-built_in">sprintf</span>(ErrorMsg,
          <span class="hljs-string">"error: [%d] could not open Ableton Push 2 device\n"</span>, result);<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((result = libusb_claim_interface(device_handle, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>)<font></font>
      {<font></font>
        <span class="hljs-built_in">sprintf</span>(ErrorMsg,
          <span class="hljs-string">"error: [%d] could not claim interface 0 of Push 2 device\n"</span>, result);<font></font>
        libusb_close(device_handle);<font></font>
        device_handle = <span class="hljs-literal">NULL</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span><font></font>
      {<font></font>
        <span class="hljs-keyword">break</span>; <span class="hljs-comment">// successfully opened</span><font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (device_handle == <span class="hljs-literal">NULL</span>)<font></font>
  {<font></font>
    <span class="hljs-built_in">printf</span>(ErrorMsg);<font></font>
  }<font></font>
<font></font>
  libusb_free_device_list(devices, <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> device_handle;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close_push2_device</span><span class="hljs-params">(libusb_device_handle* device_handle)</span>
</span>{<font></font>
  libusb_release_interface(device_handle, <span class="hljs-number">0</span>);<font></font>
  libusb_close(device_handle);<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um einen Frame zu √ºbertragen, m√ºssen Sie zuerst einen 16-Byte-Header und dann 160 Zeilen mit jeweils 960 16-Bit-Nummern senden. </font><font style="vertical-align: inherit;">Gleichzeitig sollten Zeichenfolgen laut Dokumentation nicht in 1920 Bytes √ºbertragen werden, sondern in Paketen von 2048 Bytes, erg√§nzt durch Nullen.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frame Transfer Code</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Push2Display</span> :</span> FramebufferWidget {<font></font>
<font></font>
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> frame_header[<span class="hljs-number">16</span>] = {
          <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x88</span>,
          <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>,
          <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>,
          <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span> <font></font>
    };<font></font>
<font></font>
    libusb_device_handle* device_handle;<font></font>
<font></font>
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>* image;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendDisplay</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> * image)</span> </span>{
        <span class="hljs-keyword">int</span> actual_length;<font></font>
     <font></font>
        libusb_bulk_transfer(device_handle, PUSH2_BULK_EP_OUT, frame_header, <span class="hljs-keyword">sizeof</span>(frame_header), &amp;actual_length, TRANSFER_TIMEOUT);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">160</span>; i++)<font></font>
            libusb_bulk_transfer(device_handle, PUSH2_BULK_EP_OUT, &amp;image[(<span class="hljs-number">159</span> - i)*<span class="hljs-number">1920</span>], <span class="hljs-number">2048</span>, &amp;actual_length, TRANSFER_TIMEOUT);<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt muss nur noch ein Frame gezeichnet und in den Puffer geschrieben werden. </font><font style="vertical-align: inherit;">Verwenden Sie dazu die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FramebufferWidget-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">, die die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drawFramebuffer-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode implementiert </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sofort einsatzbereite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VCV-Rack verwendet die </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Nanovg-</font></a><font style="vertical-align: inherit;"> Bibliothek </font><font style="vertical-align: inherit;">, daher ist es ziemlich einfach, hier Grafiken zu schreiben. </font><font style="vertical-align: inherit;">Wir lernen den aktuellen grafischen Kontext aus der globalen Variablen APP und speichern ihren Status. </font><font style="vertical-align: inherit;">Als n√§chstes wird eine leere 160x960 Rahmen erstellen und mit den DRAW - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ziehverfahren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kopieren Sie anschlie√üend den Framebuffer in das Array, das √ºber USB gesendet wird, und geben Sie den Status des Kontexts zur√ºck. </font><font style="vertical-align: inherit;">Setzen Sie am Ende das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dirty-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Flag, </font><font style="vertical-align: inherit;">damit die VCV-Engine bei der n√§chsten Iteration des Renderings nicht vergisst, unser Widget zu aktualisieren.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frame-Rendering-Code</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">drawFramebuffer</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{<font></font>
<font></font>
    NVGcontext* vg = APP-&gt;window-&gt;vg;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (display_connected) {<font></font>
        nvgSave(vg);<font></font>
	glViewport(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">960</span>, <span class="hljs-number">160</span>);<font></font>
        glClearColor(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
        glClear(GL_COLOR_BUFFER_BIT|GL_STENCIL_BUFFER_BIT);<font></font>
<font></font>
	nvgBeginFrame(vg, <span class="hljs-number">960</span>,  <span class="hljs-number">160</span>, <span class="hljs-number">1</span>);<font></font>
        draw(vg);<font></font>
        nvgEndFrame(vg);<font></font>
<font></font>
        glReadPixels(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">960</span>, <span class="hljs-number">160</span>, GL_RGB, GL_UNSIGNED_SHORT_5_6_5, image); <font></font>
<font></font>
        <span class="hljs-comment">//  XOR   ,  </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">80</span>*<span class="hljs-number">960</span>; i ++){<font></font>
            image[i * <span class="hljs-number">4</span>] ^= <span class="hljs-number">0xE7</span>;<font></font>
	    image[i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>] ^= <span class="hljs-number">0xF3</span>;<font></font>
            image[i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>] ^= <span class="hljs-number">0xE7</span>;<font></font>
	    image[i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>] ^= <span class="hljs-number">0xFF</span>;<font></font>
        }<font></font>
	    	<font></font>
	sendDisplay(image);<font></font>
<font></font>
	nvgRestore(vg);<font></font>
    }<font></font>
<font></font>
    dirty = <span class="hljs-literal">true</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logik der Interaktion und Zuordnung von Parametern</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr meine Aufgabe wollte ich in der Lage sein, in Sequenzern aufgezeichnete Muster zu wechseln und gleichzeitig einen bestimmten Satz von Parametern zu steuern, meinen eigenen f√ºr jede Gruppe von Mustern. </font><font style="vertical-align: inherit;">Unter Mapping verstehe ich die Bindung des Parameters eines Moduls an den Parameter eines anderen Moduls oder MIDI-Controllers. </font><font style="vertical-align: inherit;">Ich habe nur sehr wenige Informationen dar√ºber gefunden, wie man Mapping sch√∂n macht, deshalb habe ich den gr√∂√üten Teil des Codes, der es implementiert, aus dem in VCV integrierten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIDI Map-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modul √ºbernommen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kurz gesagt, f√ºr jede Reihe von Parametern wird dort ein spezielles </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParamHandle-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Objekt </font><i><font style="vertical-align: inherit;">erstellt</font></i><font style="vertical-align: inherit;"> , das </font><font style="vertical-align: inherit;">der Engine </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºber Kr√ºcken</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mitteilt, was mit was verbunden ist.</font></font><br>
<br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein Modul, das ich am Ende bekommen habe. </font><font style="vertical-align: inherit;">Zus√§tzlich zur Standardkonvertierung von Midi in CV k√∂nnen Sie Pads gruppieren, ihnen Farben zuweisen und Push-Encodern beliebige Parameter von Modulen zuordnen, deren Namen und Werte auf dem Controller-Display angezeigt werden. </font><font style="vertical-align: inherit;">Im Video unten sehen Sie seine √úbersicht und in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem Video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> k√∂nnen Sie in Aktion sehen.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OhdxXv6uHF0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Den vollst√§ndigen Code finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben es nur unter Linux (Ubuntu 18.04) getestet, unter MacOS konnte das Display aufgrund der Besonderheiten von libusb keine Verbindung herstellen und es gab merkw√ºrdige Verz√∂gerungen in der MIDI-Oberfl√§che. </font><font style="vertical-align: inherit;">Trotzdem hat VCV Rack sowohl als Framework als auch als modulare DAW einen sehr guten Eindruck hinterlassen. Ich hoffe, dass sich VCV weiterentwickelt und dieser Artikel jemand anderem hilft, seine eigenen Module daf√ºr zu schreiben.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de491232/index.html">RPA + Maschinelles Lernen = Intelligente Automatisierung</a></li>
<li><a href="../de491234/index.html">Drei Tricks f√ºr die Arbeit mit SOLIDWORKS zum Modellieren von Teilen f√ºr den 3D-Druck</a></li>
<li><a href="../de491236/index.html">Asynchrone Programmierung in .NET: Best Practices</a></li>
<li><a href="../de491238/index.html">Genetische Code-Analyse II</a></li>
<li><a href="../de491240/index.html">Der Weg zu den Wolken: gestern und heute Adobe</a></li>
<li><a href="../de491246/index.html">DEFCON-Konferenz 27. Ihr Auto ist mein Auto. Teil 2</a></li>
<li><a href="../de491250/index.html">LED-Lampen Gauss Basic</a></li>
<li><a href="../de491252/index.html">5 wenig bekannte Funktionen von JSON.stringify ()</a></li>
<li><a href="../de491256/index.html">Entwicklung des Moduls auf iMX8 von NXP. Funktionen der DDR-Trace√ºbertragung</a></li>
<li><a href="../de491258/index.html">IT-M√§dchen, woher kommst du? Lassen Sie uns eine Karte erstellen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>