<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèóÔ∏è üë©üèø‚Äçüè≠ üóæ Develop software for decentralized scooter rental. Who said it would be easy? ‚õé üë©‚Äçüë¶‚Äçüë¶ üå§Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will talk about how we tried to build a decentralized scooter rental on smart contracts and why we still needed a centralized servic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Develop software for decentralized scooter rental. Who said it would be easy?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tsystems/blog/490100/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article I will talk about how we tried to build a decentralized scooter rental on smart contracts and why we still needed a centralized service.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/ry/kh/z5/rykhz5ioko9sidydvizts5ytasu.jpeg"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How it all began</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In November 2018, we took part in a hackathon dedicated to the Internet of things and blockchain. </font><font style="vertical-align: inherit;">Our team chose scooter sharing as an idea, since we had a scooter from the sponsor of this hackathon. </font><font style="vertical-align: inherit;">The prototype looked like a mobile application that allows you to run a scooter via NFC. </font><font style="vertical-align: inherit;">From a marketing point of view, the idea was reinforced by a story about a ‚Äúbright future‚Äù with an open ecosystem where everyone can become a tenant or landlord, all based on smart contracts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our stakeholders liked this idea very much, and they decided to turn it into a prototype for demonstration at exhibitions. </font><font style="vertical-align: inherit;">After several successful shows at Mobile World Congress and Bosch Connected World in 2019, it was decided to test scooter rental on real users, employees of Deutsche Telekom. </font><font style="vertical-align: inherit;">So we started developing a full-fledged MVP.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crutch Blockchain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I think it‚Äôs not worth explaining what is the difference between a project for showing on stage and the one that real people will use. </font><font style="vertical-align: inherit;">For six months we had to turn the crude prototype into something suitable for the pilot. </font><font style="vertical-align: inherit;">And then we realized what ‚Äúpain‚Äù means. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to make our system decentralized and open, we decided to use Ethereum smart contracts. </font><font style="vertical-align: inherit;">The choice fell on this platform of decentralized online services because of its popularity and the ability to build a serverless application. </font><font style="vertical-align: inherit;">We planned to implement our project as follows.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/b6/yx/wl/b6yxwlzn-ajira5tnsiepupfwgk.png" width="300"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But, unfortunately, a smart contract is a code executed by a virtual machine at the time of a transaction, and it cannot replace a full-fledged server. For example, a smart contract cannot perform pending or scheduled activities. In our project, this did not allow us to implement the per-minute rental service, as most modern car sharing do. Therefore, we deducted cryptocurrency from the user after the operation was completed without the certainty that he has enough money. This approach is acceptable only for the internal pilot and, of course, adds to the problems when designing a full-fledged production project.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To all of the above, the dampness of the platform itself is added. For example, writing a smart contract with logic other than ERC-20 tokens will lead to an error handling problem. Usually, with an incorrect input or incorrect operation of our methods, we get an error code in response. In the case of Ethereum, we can not get anything but the amount of gas spent to perform this function. Gas is the currency you need to pay for transactions and calculations: the more transactions in your code, the more you pay. Therefore, to understand why the code does not work, you first test it, simulating all possible errors, and hardcode the spent gas as an error code. But if you change your code, this error handling will break.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, it is almost impossible to create a mobile application that works with the blockchain honestly, without using a key stored somewhere in the cloud. Although honest wallets do exist, they do not provide interfaces for signing external transactions. This means that you will not be able to see the native application if it does not have a crypto-wallet built in, to which users will have little trust (I would not trust). As a result, here we also had to cut a corner. Smart contracts were delivered to the Ethereum private network, and the wallet was cloudy. But despite this, our users felt all the ‚Äúcharms‚Äù of decentralized services in the form of a long wait for transactions several times per rental session. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this leads us to this architecture. Agree, it is very different from what we planned.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eh/e0/eg/ehe0egtt1jpdk8siidr7ykabelm.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ace up your sleeve: Self-Sovereign Identity </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You cannot build a fully decentralized system without decentralized identification. </font><font style="vertical-align: inherit;">Self-Sovereign Identity (SSI) is responsible for this part, the essence of which is that you throw out a centralized identity provider (IDP) and distribute to the people all the data and responsibility for them. </font><font style="vertical-align: inherit;">Now the user decides what data he needs and with whom he will share it. </font><font style="vertical-align: inherit;">All this information is on the user's device. </font><font style="vertical-align: inherit;">But for sharing, we need a decentralized cryptographic evidence storage system. </font><font style="vertical-align: inherit;">All modern implementations of the SSI concept use blockchain as storage.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúWhat has the ace up my sleeve?‚Äù - you ask. We launched the service for an internal test on our own employees in Berlin and Bonn, and we faced difficulties in the face of German unions. In Germany, companies are prohibited from monitoring employee movements, and unions control this. These restrictions put an end to the centralized storage of user identity data, since in this case we would have known the location of the employees. At the same time, we could not check them because of the possibility of hijacking scooters. But thanks to Self-Sovereign Identity, our users used the system anonymously, and the scooter himself checked the availability of a driver‚Äôs license before starting the rental. As a result, we kept anonymized user metrics, we did not have any documents or personal data: all of them were stored on the devices of the drivers themselves.Thus, thanks to SSI, the solution to the problem in our project was ready even before it appeared.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The device threw problems</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We did not implement Self-Sovereign Identity on our own, as this requires expertise in cryptography and a lot of time. </font><font style="vertical-align: inherit;">Instead, we took advantage of the product of our partners Jolocom and integrated their mobile wallet and services into our platform. </font><font style="vertical-align: inherit;">Unfortunately, this product has one significant drawback: the main development language is Node.js. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Such a technological stack very much limits us in the choice of iron built into a scooter. </font><font style="vertical-align: inherit;">Fortunately, at the very beginning of the project, our choice fell on the Raspberry Pi Zero, and we took advantage of the full-fledged microcomputer. </font><font style="vertical-align: inherit;">This allowed us to run the bulky Node.js on a scooter. </font><font style="vertical-align: inherit;">In addition, we got monitoring and remote access via vpn using ready-made tools.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite all the ‚Äúpain‚Äù and problems, the project was launched. </font><font style="vertical-align: inherit;">Not everything worked as we planned, but it was really possible to ride scooters by renting them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, we made a number of mistakes in the design of the architecture, which did not allow us to make the service completely decentralized, but even without these errors we would hardly have managed to create a serverless platform. </font><font style="vertical-align: inherit;">It's one thing to write another crypto pyramid and quite another is a full-fledged service in which you need to handle errors, solve border cases and perform pending tasks. </font><font style="vertical-align: inherit;">Let's hope that recently appeared new platforms will be more flexible and functional.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490086/index.html">Beginner Surf Guide or Programmer's Life in Portugal</a></li>
<li><a href="../en490088/index.html">How to continue to create a map in UE4</a></li>
<li><a href="../en490092/index.html">Andrei Zaretsky, Alexander Trukhanov: ‚ÄúThe fee was enough to drink coffee‚Äù</a></li>
<li><a href="../en490094/index.html">Back to the roots: we drive a computer directly from the MBR</a></li>
<li><a href="../en490096/index.html">Easy way to make a tiny USB hub for Raspberry Pi</a></li>
<li><a href="../en490102/index.html">wc to D: 712 characters without a single branch</a></li>
<li><a href="../en490104/index.html">Smart sun visor from Bosch. Prototype test</a></li>
<li><a href="../en490110/index.html">From developer to managers and vice versa</a></li>
<li><a href="../en490112/index.html">Monads as a code reuse pattern</a></li>
<li><a href="../en490114/index.html">Yandex.Practicum - Data Analyst. Graduation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>