<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßû ‚ô®Ô∏è ‚Ü™Ô∏è Surveillance Prom√©th√©e d'applications de microservices. Vitaly Levchenko üêÖ üëâ üìØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D√©codage du rapport 2016 par Vitaliy Levchenko "Surveillance Prometheus des applications de microservices"
 

Prometheus, contrairement aux syst√®mes c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Surveillance Prom√©th√©e d'applications de microservices. Vitaly Levchenko</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502472/"><p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©codage du rapport 2016 par Vitaliy Levchenko "Surveillance Prometheus des applications de microservices"</font></font></strong></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus, contrairement aux syst√®mes classiques, facilite la mont√©e en puissance et le maintien de la surveillance de syst√®mes en √©volution rapide et organis√©s de mani√®re complexe. Je vais parler de l'exp√©rience de mise en ≈ìuvre, des pi√®ges et des comportements inattendus, montrer comment configurer rapidement l'ensemble du syst√®me, y compris les notifications et les tableaux de bord.</font></font></p><br>
<p><img src="https://habrastorage.org/webt/yl/ui/t5/yluit5prdugaofv9yuzme5xhbgm.png"></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En plus des probl√®mes classiques de surveillance d'une application monolithique, les microservices cr√©ent une multitude de nouveaux maux de t√™te pour la surveillance. L'emplacement des services change constamment, de nouveaux services apparaissent souvent, les d√©pendances changent entre eux, les emplois temporaires sont lanc√©s √† un endroit al√©atoire - le concept d'une configuration stable dispara√Æt. Le concept de production dispara√Æt: dans un m√™me environnement, de nombreuses versions d'un service sont lanc√©es - lors du d√©ploiement, pour diff√©rents segments de l'audience, pour les tests, etc. √Ä la vue d'un tel bonheur, les d√©veloppeurs ont tendance √† am√©liorer rapidement l'application, √† cr√©er de nombreuses nouvelles mesures, √† tuer constamment les anciennes et, malgr√© cela, √† s'attendre √† une surveillance de travail et √† des r√©actions √† de nouveaux probl√®mes.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus est construit autour de Google Borgmon et r√©sout parfaitement ces probl√®mes en fournissant des outils pour les mises √† jour manuelles automatiques et rapides de la configuration. </font><font style="vertical-align: inherit;">Un nouveau serveur, un nouveau service, une nouvelle version d√©marr√©e, et ils sont d√©j√† connect√©s √† la surveillance. </font><font style="vertical-align: inherit;">Nous nous sommes arr√™t√©s - ils ne sont pas l√†, sinon n√©cessaires. </font><font style="vertical-align: inherit;">La m√©trique non pertinente a disparu - l'alerte sait comment vivre avec.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s ce rapport, vous comprendrez comment Prometheus peut √™tre utilis√© sur vos syst√®mes.</font></font></p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/FGtMYsN-BNU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p><img src="https://habrastorage.org/webt/re/3e/pc/re3epcz0h2ank1nhg9-erq83_g0.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le rapport selon lequel le monde change et les syst√®mes de surveillance que nous avons utilis√©s en grand nombre auparavant ne sont plus adapt√©s. </font><font style="vertical-align: inherit;">Il y a des probl√®mes que la surveillance ne r√©sout pas. </font><font style="vertical-align: inherit;">Prom√©th√©e les r√©sout, nous les utilisons donc. </font><font style="vertical-align: inherit;">Comme √ßa:</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il a soulev√© des probl√®mes li√©s aux besoins de l'entreprise.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ils ne ma√Ætrisaient pas du tout la surveillance. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impl√©ment√© Prometheus.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela fonctionne d'une mani√®re ou d'une autre.</font></font></li>
</ul><br>
<p><img src="https://habrastorage.org/webt/9t/p1/rv/9tp1rvnysgwgaaozvxhe2lecywc.png"></p><br>
<p>      .   .      .      .</p><br>
<p> ,    ,  developer.     .    .    . </p><br>
<p><img src="https://habrastorage.org/webt/ng/zi/up/ngziuppetd3loguftimzvbxvqxs.png"></p><br>
<p>  ,     ,    ,    . </p><br>
<p><img src="https://habrastorage.org/webt/02/oy/nl/02oynl9_itxf3v2bvv_jfrn3chu.png"></p><br>
<p>  ?   .     .   docker.  ,            ,      ,     .</p><br>
<p><img src="https://habrastorage.org/webt/nw/7j/de/nw7jdelh3owc3msmomycbsw9eg4.png"></p><br>
<p>  ,     .    .        ,    .       ,     ,         ‚Äì   .      ? ,         ‚Äì    .  ,     production  . </p><br>
<p><img src="https://habrastorage.org/webt/gc/gk/ja/gcgkja1gmokkpbtoqcbewj63uui.png"></p><br>
<p>     ‚Äì    production  .    production  10     .     ,    continuous delivery.     stages.     .        .      . </p><br>
<p><img src="https://habrastorage.org/webt/sk/5k/td/sk5ktde7iufbjkdqoj587mc_t9m.png"></p><br>
<p> ,  .    .   . </p><br>
<p>    ,        .     ,       ,  . </p><br>
<p>   . ,    ‚Äì   . ,   - environments ‚Äì   .   stage environment,      environment,   production.</p><br>
<p> ,   ,   .     .      ,      20 ,      . </p><br>
<p><img src="https://habrastorage.org/webt/ur/0o/cd/ur0ocdcdyq3a8ltumukaznwyaic.png"></p><br>
<p>    . The twelve factor app ‚Äì      Production.  ,  ,     .   ‚Äì   . </p><br>
<p><img src="https://habrastorage.org/webt/y0/54/nq/y054nqmgwaqa6jpmmjhbsijlpbs.png"></p><br>
<p>         ,    . </p><br>
<p>       . . .  ,  ,   ,  .  ‚Äì  .   .   .            .       , . .      ,    .  .      . </p><br>
<p>     ‚Äì     .     .          , , , Graphite,    StatsD.   ,    ,   push based,      .   . </p><br>
<p>   ‚Äì  ,     , . .    ,    ,       . </p><br>
<p><img src="https://habrastorage.org/webt/yr/qe/mj/yrqemjuzyhgwajv4aap6vfywpjg.png"></p><br>
<p>     ,    ,   .    ,  .      Graphite,     .    . , 100 000    ‚Äì  .   ‚Äì  ,     100 000  .    ‚Äì   .   ,     21  . , ,  ,     . </p><br>
<p><img src="https://habrastorage.org/webt/sh/yb/ou/shybouejvgjip5mw2h541ujjqog.png"></p><br>
<p>  production Zabbix  - ? .    ‚Äì   . . . Zabbix ‚Äì   ,       .    .    ,  . </p><br>
<p>  ,      . ,     ,  Zabbix   .  Nagios       .   ,   ,    . . .   ,    ,     - . </p><br>
<p>   ,    ,     ,      . Zabbix      .    , ,  Redis.   . </p><br>
<p><img src="https://habrastorage.org/webt/so/6j/eb/so6jebkuz-ilzcdvvh0klxcgk90.png"></p><br>
<p> ,   ,    .  InfluxDB   .  .    Graphite, InfluxDB    ,          ,     . </p><br>
<p><strong>  InfluxDB  ,        .      .         production. . .       ,       .     .       .</strong> </p><br>
<p><strong>  ,   .    ,     , .  .      .       (?) .  .  .</strong> </p><br>
<p>     , ,         ,     . . .       ,     .   .   ,    ‚Äì  .  . </p><br>
<p>  Riemann    .     : ¬´    CPU  ¬ª.     CPU ‚Äì  100 %,  0 %.      .</p><br>
<p>      ‚Äì  ,  CollectD .    ,   .       InfluxDB.   - , -  , -   ,  CollectD   ,   .      ,     ,   . </p><br>
<p><strong>    InfluxDB  ,         time-series ,    .</strong></p><br>
<p><img src="https://habrastorage.org/webt/7r/ye/sa/7ryesagxun8rycojo42x3le7mey.png"></p><br>
<p>      Prometheus.    ?</p><br>
<p>     Google,  ,    ,    Google Borgmom,        ,    Facebook.    ,   ,  ,        .   .      .</p><br>
<p>  , . .    production (   ,    ,    ,      )    ,    .     .    Prometheus  . </p><br>
<p> .   .  Prometheus   ,   .     . </p><br>
<p>   ,    .  deprecate-  .  Grafana.   Grafana ,  . </p><br>
<p>  ,  Prometheus   .       . . . ,   20 000      ‚Äì  .   24-   400 000      .  3 ,  1 200 000.   . </p><br>
<p>     production .   - . ,       .   .     ,    -   .</p><br>
<p><img src="https://habrastorage.org/webt/03/2g/as/032gasmg852cvhsskkz-hpqaixk.png"></p><br>
<p>   ,     ,    , . .       .  environment.  server,    .  handler       .       .    .  Prometheus   .   ,   . </p><br>
<p>   ,      ,       .     ,  ,   ,   .    .    ,     .     . </p><br>
<p>  ?        .   : ¬´      environment   ,       ¬ª.    . </p><br>
<p>           .  - ,         ,    .  ,    ,            ,       ‚Äì   .</p><br>
<p><img src="https://habrastorage.org/webt/nr/31/h6/nr31h6exrcvssnejmp-amakxvi0.png"></p><br>
<p> Prometheus   , . . ,    . </p><br>
<p>    .      .  ,   4     .       .    ,       .     Zookeeper,           ,    ‚Ä¶ 95 %  ,  20     100 %.   .    ‚Äì   .    .     .   ,  . </p><br>
<p><img src="https://habrastorage.org/webt/af/rd/m0/afrdm0tt9toeetxr25oibn39cve.png"></p><br>
<p>-    pull metrics  push metrics.      ,     pull metrics . </p><br>
<p><img src="https://habrastorage.org/webt/a2/fq/35/a2fq35t9s18slpcg1fteosxvmpq.png"></p><br>
<p>StatsD ‚Äì        Graphite, . StatsD   ,     .   .   . </p><br>
<p>     ,  exporter  .   , , 50 000   .        .  ,  ,    production,        . </p><br>
<p>StatsD exporter Prometheus .        StatsD,    StatsD,     gauge etc,     .</p><br>
<p>      push gateway      push‚Äô.    Prometheus.    StatsD,    push gateway   . </p><br>
<p><img src="https://habrastorage.org/webt/zf/sd/wf/zfsdwftrem9uanlcuuto-g9rynm.png"></p><br>
<p>   .       ,   Prometheus,    ,   . . .  ,         ,  .    .           Amazon,   Kubernetes,   Mesos,   Consul   . . .   ,      . </p><br>
<p> ,    Ansible,       . . .  -  ,   , ,         .  ,       Prometheus.  reload   ,    .</p><br>
<p>      ,     .        ,     ,     .   javascript  .   ,        .  . </p><br>
<p><img src="https://habrastorage.org/webt/el/bm/-c/elbm-ciyxpvuvffurpi0mudwh5g.png"></p><br>
<p>         .    -   .</p><br>
<p> Prometheus   .    .   open source. , Postgres exporter ‚Äì   ,     .  Node exporter,     .</p><br>
<p>  ,     .     ,       .       ,    .   . </p><br>
<p>        systemd.    . </p><br>
<p><img src="https://habrastorage.org/webt/-j/ig/lo/-jiglog_3-g12okswzs1vwg46p0.png"></p><br>
<p> ,     .       ,       . </p><br>
<p>      . ,          .   . ,     ,   .   ,   ,    .   Prometheus . . .      Influx,    . </p><br>
<p>       .  .</p><br>
<p><img src="https://habrastorage.org/webt/mf/m3/xi/mfm3xizjmwswg0poxpeqsbzcibg.png"></p><br>
<p>   .   ,     -   ,    .    ,  ,    .    ‚Äì     ‚Äì<code>rm ‚Äì r &lt;storage path/*</code>.  .      .  , , production.  ,  ,   . </p><br>
<p>       federation,       ,  federation   ,   . </p><br>
<p>       . . .     Prometheus        .    .</p><br>
<p>   openTSDB     .       ,     .   openTSDB   ,   ,        ,  ,   Hadoop.</p><br>
<p><img src="https://habrastorage.org/webt/bw/aq/xb/bwaqxbxiokunqutnrc4uvm1nmbw.png"></p><br>
<p> ,    ,  ,   ,   histogram  summary.  ,      . </p><br>
<p>  ,   ,   100  ‚Äì  .  100  300 ‚Äì  .  ,   300 ‚Äì   .   histogram.  ,     ‚Ä¶ , , ,   .  .   .    ,     histogram  ,    .     10 ,     10  .     -  .       ,      recording rules.  ,  ,   . ,    .</p><br>
<p>Summary ‚Äì   . Summary   . Summary    ,   .    ,    ,     ,    .   .     ,   . ,     99- ,      , . .    ,   .  .</p><br>
<p>   summary      . . .         ,   .</p><br>
<p>     -.    .            .</p><br>
<p><img src="https://habrastorage.org/webt/vf/tg/vb/vftgvb5qhtjxzwnurnoikbxbxr8.png"></p><br>
<p>  ?     ?    ,   ,   , :</p><br>
<ul>
<li>    .     ,   , . .  , latency ,  ,        .     99 % .         ,   ,  -  .      .      . </li>
<li>     .</li>
<li>. </li>
<li> .</li>
<li>  + .</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/al/ab/do/alabdob5bmkqwszfy4z6gjb0xf8.png"></p><br>
<p>  ? </p><br>
<ul>
<li>  . , .      .      10 ,    10 ,    10  ,    . (  Service Discovery)</li>
<li>      ,     . Grafana    .      ,       .   : ¬´     ¬ª.    10      . ,    .     .  ,         ,           .</li>
<li>   ‚Äì      ,  .    . . .   , ,    ,   ,  .</li>
<li>  ‚Äì  ,    ,  ,  , .</li>
<li>    ,  Prometheus     .   .     ,  Prometheus   docker.   .  .    ‚Äì  .   .     . </li>
</ul><br>
<p></p><br>
<p><em> !   !     Zabbix.   ,   .    ,   .     ,          ,      Zabbix.      environment,         ?</em></p><br>
<p> .   ‚Äì   environment,  . (    Kubernetes  Service Discovery)</p><br>
<p><em>. .,   ,   developer,        ? . .     environment?</em></p><br>
<p> . </p><br>
<p><em>   environment?</em></p><br>
<p>   environment.         environment.          environment.    ,    environment,    stable ‚Äì  environment. (    Kubernetes  Service Discovery)</p><br>
<p><em>,      . . .   - ,      , . ,       - . . .  ,     -   , ,    .       ,      ?</em></p><br>
<p>    Zabbix   production,        ,   .   ,    ,      ,     -.   full time  ,     .     Zabbix,  ,   ,    3-4- .     3-4-   ,  Zabbix ‚Äì   .   .</p><br>
<p><em>  ,  3    Zabbix?</em></p><br>
<p>. </p><br>
<p><em>.   .      developers     Prometheus?</em></p><br>
<p>. </p><br>
<p><em> ?         ?</em></p><br>
<p>    . </p><br>
<p><em>.      environment,        -   sender,    Prometheus .</em></p><br>
<p>  sender. Prometheus   .      API http‚Äô,   .     Consul,    Prometheus    ,   .       . </p><br>
<p><em>  .   ,      ,   -         Prometheus?</em></p><br>
<p>,         .   . </p><br>
<p><em>.      docker‚Äô,  ,    ,    ,        - ,      .    overhead,  . . .   ,    ?</em></p><br>
<p>?</p><br>
<p><em>   .</em></p><br>
<p>   health handler,    .   , ,  .   , ,   . </p><br>
<p><em> !   !     4 .       StatsD, ,   ,      .     StatsD,    Influx‚Äô Telegraf?</em></p><br>
<p>,     StatsD,    Influx.</p><br>
<p><em>Ok.    ,    Grafana  . ,      .             Go,       .  ,         .</em> </p><br>
<p>   open source,    . </p><br>
<p><em>  GitHub ,    .  .   federation, ?</em></p><br>
<p>  , .    .</p><br>
<p><em>Ok.    -?</em></p><br>
<p>,    . </p><br>
<p><em>     ,         .   ?    ?</em></p><br>
<p>        .  ,   .   100 000 . , 200 000-300 000. , , , ,    .         Zabbix,   . <strong> Influx     , . .   ,    queries .</strong></p><br>
<p><em>   ?</em></p><br>
<p>    ?</p><br>
<p><em>,    - ,     , .</em></p><br>
<p> ,     -    .        , . .  .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502454/index.html">MVVM et s√©lection d'√©l√©ments dans l'adaptateur - LiveData</a></li>
<li><a href="../fr502460/index.html">√Ä quoi s'attendre sur la sc√®ne des startups ukrainiennes en 2020?</a></li>
<li><a href="../fr502462/index.html">√âv√©nements num√©riques √† Moscou du 18 au 24 mai</a></li>
<li><a href="../fr502464/index.html">√âv√©nements num√©riques √† Saint-P√©tersbourg du 18 au 24 mai</a></li>
<li><a href="../fr502466/index.html">Nouveau RIT ++ dans les nouvelles conditions</a></li>
<li><a href="../fr502480/index.html">Qu'est-ce que DHCP Snooping et comment √ßa marche?</a></li>
<li><a href="../fr502486/index.html">Le livre "Race with the epidemic. Antibiotiques contre les superbact√©ries "</a></li>
<li><a href="../fr502490/index.html">Clignotant des croyances restrictives. Pour quoi et qu'est-ce que √ßa donne</a></li>
<li><a href="../fr502492/index.html">Innovations dans Zextras Suite et Zimbra OSE</a></li>
<li><a href="../fr502494/index.html">7 erreurs d'un Black Friday et comment fonctionne Magento Cloud - vid√©o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>