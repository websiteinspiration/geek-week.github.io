<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕥 🎇 💌 CI TeamCity-自动化Android和UI测试的构建过程 🏵️ ⏏️ 👨🏽‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，我提醒您注意有关安装和配置TeamCity的说明，以在Windows下自动组装和测试Android项目。
 
 我还将关注为Android项目（在研究过程中发现的）设置环境的功能，以及可以帮助新手测试人员和开发人员简化生活的各种事情。
 
 目标：
 更新项目代码时，应发生以下情况：
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CI TeamCity-自动化Android和UI测试的构建过程</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502436/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本文中，我提醒您注意有关安装和配置TeamCity的说明，以在Windows下自动组装和测试Android项目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我还将关注为Android项目（在研究过程中发现的）设置环境的功能，以及可以帮助新手测试人员和开发人员简化生活的各种事情。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标：</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新项目代码时，应发生以下情况：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动建立专案</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 运行UI自动测试</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导出调试并释放APK文件以进行后续手动测试</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知所有开发团队成员结果</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 计划：</font></font></h4><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和配置Java JDK</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和配置Android SDK</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为调试设置单独的gradle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备一个Android项目</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装TeamCity Server和Build Agent</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置TeamCity Project→为项目构建进行构建并获取安装APK</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用UI自动测试配置构建步骤</font></font></li>
</ol><a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 主要部分 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和配置Java JDK</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
相反，有关安装最新版本的Java普遍的信仰，在其官方网站发布JetBrains公司在Java SDK的建议版本：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
安装推荐的版本：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
也安装环境变量：</font></font><br>
<br>
<ul>
<li><code>JAVA_HOME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-使用CI的SKD Java文件夹的路径。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><br>
<br>
<code>C:\Java\jdk1.8.0_181</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最好放入系统变量。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径-带有Java SKD的文件夹的路径，可从命令行使用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><br>
<br>
<code>C:\Java\jdk1.8.0_181\bin</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最好放入用户变量。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们检查安装情况：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在CMD的任何目录中，我们输入：</font></font><code> java -version </code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Java应该回答为：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jr/sr/6f/jrsr6flrr8_x5nphn3pyeh4spwk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和配置Android SDK</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
我们不会单独安装Android SDK工具。 Android禁止从命令行创建项目。如果我们立即安装Android Studio，调试可能的错误也将更加方便。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装最新版本：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
还安装环境变量：</font></font><br>
<br>
<code>ANDROID_HOME</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><code>C:\Users\1\AppData\Local\Android\Sdk</code><br>
<br>
<code>ANDROID_AVD_HOME</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><code>C:\Users\1\.android\avd</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
路径：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><code>C:\Users\1\AppData\Local\Android\Sdk\platform-tools\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-由我们和CI从控制台启动实用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
检查：键入CMD：</font></font><code>adb --help</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
获取有关当前版本和可用命令的信息：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dh/ax/nl/dhaxnlpo3zycmxk39upb7vdmht4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
路径：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><code> C:\Users\1\AppData\Local\Android\Sdk\emulator\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-由我们和CI从控制台启动仿真器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
检查：输入CMD，</font></font><code>emulator -version</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们获取有关当前版本的信息：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qn/dn/jt/qndnjtqddivhsoab-x4thjvng1c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle安装Gradle</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
包含在Android Studio中，但是我们将在控制台中放置另一个进行调试。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
版本并不重要，因为假设该项目将通过Gradle包装器启动。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我建议安装与项目中使用的版本类似的版本，例如Gradle 3.3。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连结</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们还安装了环境变量：</font></font><br>
<br>
<code>GRADLE_HOME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-不需要，因为CI将使用Gradle Android Studio。</font></font><br>
<br>
<code>GRADLE_USER_HOME</code> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><code>c:/gradle-cache</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于Windows Server，实际为没有它，在项目组装期间，所有下载的Gradle库都将存储在</font></font><code>C:\Windows\System32\config\systemprofile\.gradle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进一步的CI将无法访问这些文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
路径：</font></font><br>
<br>
<code>C:\Gradle\gradle-3.3\bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-从命令行方便使用的Gradle文件夹的路径。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
检查：我们键入CMD </font></font><code>gradle -v</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们收到有关当前版本的信息：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5d/oz/sz/5dozszxuoyliwdu4cc7kbsqks5m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Android项目</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
4.1的</font><b><font style="vertical-align: inherit;">准备</font></b><font style="vertical-align: inherit;">。在Android Studio中创建一个测试项目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
键入活动-底部导航活动。稍后将在创建UI测试时派上用场。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2。持续禁用Gradle Daemon，以使Gradle Daemon不会在CI中生成：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在文件</font></font><code>gradle.properties:</code><br>
<code>add org.gradle.daemon=false</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.3中</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">。我们还会</font></font><code>.gitignore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据您的喜好</font><font style="vertical-align: inherit;">添加文件</font><font style="vertical-align: inherit;">，以</font><font style="vertical-align: inherit;">
使多余的文件不会留在VCS中。</font><font style="vertical-align: inherit;">
4.4。在项目文件夹中创建一个密钥库（或使用现有的密钥库）。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">连结</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<code>.gradle<br>
.idea<br>
/build/<br>
local.properties</code><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.5。将指向密钥库的链接添加到Gradle，以便我们构建完整的APK。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br>
<br>
<pre><code class="plaintext hljs">android{  <font></font>
    ... //  <font></font>
    signingConfigs {<font></font>
        release {<font></font>
            storeFile file("keystorefile.jks") //        <font></font>
            storePassword "Password" //  <font></font>
            keyAlias "android" // keyAlias,     <font></font>
            keyPassword "Password" //  APK<font></font>
        }<font></font>
    }<font></font>
<font></font>
    ... //  <font></font>
     buildTypes {<font></font>
        release {<font></font>
            ... //  <font></font>
            signingConfig signingConfigs.release //  APK<font></font>
        }<font></font>
    }<font></font>
} </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.6。为了测试系统的运行状况，我们将从命令行组装一个新项目。输入CMD：</font></font><br>
<br>
<code>cd &lt;  &gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如：</font></font><code>C:\Users\1\Documents\GitHub\Command2</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
转到项目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入：我们正在</font></font><br>
<br>
<code>gradlew assembleDebug</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
等待组装完成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果一切顺利，那么我们将获得结果BUILD SUCCESSFUL。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uf/dr/x7/ufdrx77tmdj5e1xlin8depxema0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们转到项目文件夹：</font></font><code>app\build\outputs\apk\debug</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它包含一个新的APK文件，可以将其安装在设备上，并检查是否一切正常。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7。我们还将检查是否已启动SDK工具和AVD管理器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.1。启动Android Studio并创建一个模拟器。您当然可以在命令行上创建它，但是我们已经安装了UI Shell，不使用它是一个罪过。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
工具→AVD管理器：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ib/k7/k5/ibk7k5w33zp2jh4rxcts51ioifu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建的模拟器的SDK版本必须至少与我们的SDK项目一样大。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.2。创建了一个模拟器。让我们从控制台检查其启动。我们在命令行输入：</font></font><br>
<br>
<code>start /min emulator -avd &lt; &gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><br>
<br>
<code>start /min emulator -avd Pixel_2_API_25</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，我们使用一个函数</font></font><code>/min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在后台启动仿真器。否则，他将不允许在CMD中输入新命令。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设备正在运行：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/go/ia/wjgoiap9s77ujejq-pn_fahputw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.3。我们检查收集的APK的安装。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们输入CMD：</font></font><br>
<br>
<code>adb install &lt;path_to_apk&gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><br>
<br>
<code>adb install C:\Users\1\Documents\GitHub\Command2\app\release\app-release.apk</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
成功：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-l/gf/ze/-lgfze9zuuhlvlzlecbgp9clwue.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.4。我们检查已安装APK的启动。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们输入CMD：</font></font><br>
<br>
<code>adb shell monkey -p &lt;     &gt; -c android.intent.category.LAUNCHER 1</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><br>
<br>
<code>adb shell monkey -p com.panarik.command -c android.intent.category.LAUNCHER 1</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序启动：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kc/dl/pu/kcdlpuz9f0bc16c5dulf14rsyd4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.5。我们将项目上载到远程存储库，例如GitHub。检查是否将下载项目：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装Git BASH（如果我们使用Git VCS）。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连结</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们从远程仓库中克隆项目。在控制台中输入Git BASH：</font></font><br>
<br>
<code>git clone &lt;  .git&gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><br>
<br>
<code>git clone https://github.com/panarik/Command2.git</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们看到了结果。项目已复制到本地文件夹：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2m/mc/3u/2mmc3upb1vs0_rurcfes7yeyrai.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切就绪，可以安装和配置TeamCity。我们为什么要在命令行中进行练习，而不是立即安装TeamCity。提前确定项目正在运行将更加方便，以便将来在TeamCity的构建阶段中更轻松地定位可能的错误。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装TeamCity Server和Build Agent</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
我将不详细描述安装过程。他在官方指南和许多其他资料中。我建议将TeamCity服务器端口设置为非标准端口，以便计算端口扫描更为困难。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置TeamCity项目→构建</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在常规设置中，您只需要设置APK输出的路径即可：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><br>
<br>
<code>app\build\outputs\apk\release\app-release.apk</code><br>
<br>
<img src="https://habrastorage.org/webt/4o/ca/_0/4oca_0ess7vbx4awyid4q7ldv3a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.1。设置TeamCity VCS根目录</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切都是标准的。在我们的项目中，我们使用Git，因此我们输入了它以及指向远程仓库的链接。示例：</font></font><br>
<br>
<code>https://github.com/panarik/Command2.git</code><br>
<br>
<img src="https://habrastorage.org/webt/ko/p9/d1/kop9d17wvkt7gwcgxxpuaoglio0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.2。 TeamCity构建配置</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
添加一个构建步骤，该步骤将编译项目并显示APK。在我们的项目中，我们使用Gradle。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在[Gradle任务]字段中输入：</font></font><br>
<br>
<code>clean build assembleDebug --no-daemon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（-以防万一，以防万一，这应该作为我们在第4.2节中所做的文件的下标）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/wt/cm/zawtcmqdtqqsvpwjzpn_4e0bwvc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
单击运行，我们将获得APK。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用UI自动测试配置构建步骤我们</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
到了最有趣的部分，即UI测试的自动启动。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将使用.BAT文件启动步骤。编写代码，即时更改代码而无需进入TeamCity UI等更加方便。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.1。首先，在仿真器运行的情况下创建一个构建步骤。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以完全创建BATnik的URL，为方便起见，我在TeamCity中创建了环境，</font></font><code>BAT_FILES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用BATniks指向文件夹的路径：我们</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/mz/hx/hmmzhx2i5rdyb3eafa3gyczn1ue.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在文件中写入了仿真器启动代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例：</font></font><br>
<br>
<code>start /min "emulator" /D "C:\Users\1\AppData\Local\Android\Sdk\emulator" emulator.exe -avd Pixel_2_API_25 -no-snapshot-save -no-boot-anim</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
异地命令和参数的列表：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.2。在仿真器加载时创建带有暂停的构建步骤。您可以立即在.BAT中注册第一步，但是它将更加清晰。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在Internet上进行监视的此类团队的一个示例：</font></font><br>
<br>
<code>adb wait-for-device shell 'while [[ -z $(getprop sys.boot_completed) ]]; do sleep 1; done; input keyevent 82'</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从UI看起来将如下所示：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/uh/0r/pouh0rl3u3g9kfwxyu1h5dcpbxy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
场外所有团队的列表：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.3。</font><font style="vertical-align: inherit;">运行测试。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同样从命令行。</font><font style="vertical-align: inherit;">这里的一切都是个人的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例命令：</font></font><br>
<br>
<code>gradlew connectedDebugAndroidTest</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.4。</font><font style="vertical-align: inherit;">我们停止模拟器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
示例命令：</font></font><br>
<br>
<code>adb -s emulator-5554 emu kill</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
处理完成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您还可以在单​​独的步骤中上载报告。</font><font style="vertical-align: inherit;">默认情况下，它保存在项目文件夹中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常感谢您的关注！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果有人对改进步骤代码有任何建议，以及对改进的建议，我将不胜感激。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN502418/index.html">3D影像监控器</a></li>
<li><a href="../zh-CN502420/index.html">Twitter设计中有趣的CSS发现</a></li>
<li><a href="../zh-CN502422/index.html">只需几个简单的步骤即可将React Native应用程序大小减少60％</a></li>
<li><a href="../zh-CN502424/index.html">停止导入整个JavaScript包</a></li>
<li><a href="../zh-CN502432/index.html">415上周（2020年5月11日至17日）从前端世界中摘录的新鲜材料</a></li>
<li><a href="../zh-CN502438/index.html">材质Python。具有OpenGL效果的自定义卡</a></li>
<li><a href="../zh-CN502440/index.html">使用Mediapipe构建应用程序</a></li>
<li><a href="../zh-CN502442/index.html">PHP文摘第180号（2020年5月4日至18日）</a></li>
<li><a href="../zh-CN502448/index.html">IBM每周研讨会-2020年5月</a></li>
<li><a href="../zh-CN502450/index.html">审核意见2.但是，我们可以信任用户吗？（继续）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>