<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤°ğŸ¾ ğŸ‘¨ğŸ¼â€âœˆï¸ ğŸˆ·ï¸ 2å¹´é–“ã€ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã—ã¦ãã¾ã—ãŸã€‚ã‚¯ãƒªãƒƒã‚¯ã—ã¦... ğŸ‘ ğŸ‘¨ğŸ½â€ğŸš’ ğŸ‘¨ğŸ½â€ğŸš€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã¿ãªã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ 
 

ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹æˆã€ãŠã‚ˆã³é«˜è² è·ã§ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®Graphite + Whisperã‹ã‚‰Graphite + ClickHouseã¸ã®ç§»è¡Œã«ã¤ã„ã¦ã™ã§ã«èª¬æ˜ã—ã¾ã—ãŸã€‚ãã®å¾Œã€ç§ã®åŒåƒšã§ã‚ã‚‹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>2å¹´é–“ã€ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã—ã¦ãã¾ã—ãŸã€‚ã‚¯ãƒªãƒƒã‚¯ã—ã¦...</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/467995/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¿ãªã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã€</font><font style="vertical-align: inherit;">ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç”¨ã®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹æˆ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãŠã‚ˆã³</font><font style="vertical-align: inherit;">é«˜è² è·ã§</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®Graphite + Whisperã‹ã‚‰Graphite + ClickHouseã¸</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ç§»è¡Œ</font></a><font style="vertical-align: inherit;">ã«ã¤ã„ã¦</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã™ã§ã«èª¬æ˜ã—ã¾ã—ãŸ</font></a><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãã®å¾Œã€ç§ã®åŒåƒšã§ã‚ã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey </font></font></a> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Noskov</font></a><font style="vertical-align: inherit;">ãŒã€ç§ãŸã¡ã®ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®æœ€åˆã®ãƒªãƒ³ã‚¯ã§</font><font style="vertical-align: inherit;">ã‚ã‚‹åˆ†æ•£ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚¿ãƒ¼ã§ã‚ã‚‹</font><font style="vertical-align: inherit;">ç§ãŸã¡ãŒé–‹ç™ºã—ãŸ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Bioyino</font></a><font style="vertical-align: inherit;">ã«ã¤ã„ã¦</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›¸ã</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avitoã§ã®ç›£è¦–ã®æº–å‚™æ–¹æ³•ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™ã€‚å‰å›ã®è¨˜äº‹ã¯ã™ã§ã«2018å¹´ã«æˆ»ã£ã¦ãŠã‚Šã€ã“ã®é–“ã«ç›£è¦–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ãƒˆãƒªã‚¬ãƒ¼ã¨é€šçŸ¥ã®ç®¡ç†ã€ClickHouseã®ã•ã¾ã–ã¾ãªãƒ‡ãƒ¼ã‚¿ã®æœ€é©åŒ–ã€ãã®ä»–ã®ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã«èˆˆå‘³æ·±ã„å¤‰æ›´ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã—ãŸã€‚ãã‚Œã«ã¤ã„ã¦ãŠè©±ã—ãŸã„ã ã‘ã§ã™</font></font></p><br>
<p><img src="https://habrastorage.org/webt/wy/zd/u6/wyzdu6fyb-3ehjdbzwi8jgxhvec.png"></p><a name="habracut"></a><br>
<p>    . </p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  2017</a>     ,    ,       ,         .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/4e9/d52/d3e/4e9d52d3e19df15d928d29d2394095fa.jpg"></a></p><br>
<p>    .</p><br>
<ul>
<li><p>    Graphite   3  6.<br>
(<code>56 CPU 2.60GHz, 384GB RAM, 10 SSD SAS 745GB, Raid 6, 10GBit/s Net</code>).</p><br>
</li>
<li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">brubeck</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">bioyino</a> â€”    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">StatsD</a>  Rust,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>. ,          (Graphite)  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Raft</a>   .</p><br>
</li>
<li><p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">bioyino</a>   StatsD-        ,   ,      k8s.</p><br>
</li>
<li><p> -      Munin (     ,       ).</p><br>
</li>
<li><p>    Kubernetes    Prometheus/Federations,   Heapster    Kubernetes  .</p><br>
</li>
</ul><br>
<h1 id="monitoring"></h1><br>
<p>            9 .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/r2/yu/zm/r2yuzm1rt5ok64zh2utwrpdtzbk.png"></a></p><br>
<p>        ,        .     . </p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/s2/uj/ml/s2ujmlqnrsoo0yb0kgtxkdcf4ek.png"></a></p><br>
<p>   ? </p><br>
<ul>
<li>        .<br>
<pre><code class="sql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> graphite.data <span class="hljs-keyword">MODIFY</span> <span class="hljs-keyword">COLUMN</span> <span class="hljs-built_in">Time</span> UInt32 CODEC(Delta, ZSTD)</code></pre></li>
<li>          .       cron,      ()  :</li>
</ul><br>
<pre><code class="bash hljs">10 10 10 * * clickhouse-client -q <span class="hljs-string">"select distinct partition from system.parts where active=1 and database='graphite' and table='data' and max_date between today()-55 AND today()-35;"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> PART; <span class="hljs-keyword">do</span> clickhouse-client -u systemXXX --password XXXXXXX -q <span class="hljs-string">"OPTIMIZE TABLE graphite.data PARTITION ('"</span><span class="hljs-variable">$PART</span><span class="hljs-string">"') FINAL"</span>;<span class="hljs-keyword">done</span></code></pre><br>
<ul>
<li>    .                  .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">rollup </a>,            ,        .</li>
</ul><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Distributed </a>   . </p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> graphite.data_all (
<span class="hljs-string">`Path`</span> <span class="hljs-keyword">String</span>, 
<span class="hljs-string">`Value`</span> Float64, 
<span class="hljs-string">`Time`</span> UInt32, 
<span class="hljs-string">`Date`</span> <span class="hljs-built_in">Date</span>, 
<span class="hljs-string">`Timestamp`</span> UInt32<font></font>
) <font></font>
<span class="hljs-keyword">ENGINE</span> = <span class="hljs-keyword">Distributed</span> (
<span class="hljs-string">'graphite_cluster'</span>,
<span class="hljs-string">'graphite'</span>,
<span class="hljs-string">'data'</span>, <font></font>
jumpConsistentHash(cityHash64(<span class="hljs-keyword">Path</span>), <span class="hljs-number">3</span>)<font></font>
) </code></pre><br>
<p>    "default" readonly-           <code>systemXXX</code>.</p><br>
<p>  Graphite  ClickHouse   .</p><br>
<pre><code class="xml hljs">    <span class="hljs-tag">&lt;<span class="hljs-name">remote_servers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">graphite_cluster</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">shard</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">internal_replication</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">internal_replication</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">replica</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>graphite-clickhouse01<span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>9000<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>systemXXX<span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>XXXXXX<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">replica</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">replica</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>graphite-clickhouse04<span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>9000<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>systemXXX<span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>XXXXXX<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">replica</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">shard</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">shard</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">internal_replication</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">internal_replication</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">replica</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>graphite-clickhouse02<span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>9000<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>systemXXX<span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>XXXXXX<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">replica</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">replica</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>graphite-clickhouse05<span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>9000<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>systemXXX<span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>XXXXXX<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">replica</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">shard</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">shard</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">internal_replication</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">internal_replication</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">replica</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>graphite-clickhouse03<span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>9000<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>systemXXX<span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>XXXXXX<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">replica</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">replica</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>graphite-clickhouse06<span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>9000<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>systemXXX<span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>XXXXXX<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">replica</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">shard</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">graphite_cluster</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">remote_servers</span>&gt;</span></code></pre><br>
<p>   ,        Graphite.    : </p><br>
<ul>
<li>    ; </li>
<li>              . </li>
</ul><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/ch/rb/wh/chrbwhdiyl3x3cxjqmwgtohph6y.png"></a></p><br>
<p>      ,     :          Â«Â» ,           ,      .     Â«Â»       ,              . C     .</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> graphite.data_reverse (
<span class="hljs-string">`Path`</span> <span class="hljs-keyword">String</span>, 
<span class="hljs-string">`Value`</span> Float64, 
<span class="hljs-string">`Time`</span> UInt32 CODEC(Delta(<span class="hljs-number">4</span>), ZSTD(<span class="hljs-number">1</span>)),
 <span class="hljs-string">`Date`</span> <span class="hljs-built_in">Date</span>, 
<span class="hljs-string">`Timestamp`</span> UInt32<font></font>
) <font></font>
<span class="hljs-keyword">ENGINE</span> = ReplicatedGraphiteMergeTree (
<span class="hljs-string">'/clickhouse/tables/{cluster}/data_reverse'</span>, 
<span class="hljs-string">'{replica}'</span>, 
<span class="hljs-string">'graphite_rollup'</span>
) <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">Date</span> 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> (<span class="hljs-keyword">Path</span>, <span class="hljs-built_in">Time</span>) 
<span class="hljs-keyword">SETTINGS</span> index_granularity = <span class="hljs-number">4096</span></code></pre><br>
<p>    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">carbon-clickhouse</a>  . </p><br>
<pre><code class="plaintext hljs">[upload.graphite_reverse]<font></font>
type = "points-reverse"<font></font>
table = "graphite.data_reverse"<font></font>
threads = 2<font></font>
url = "http://systemXXX:XXXXXXX@localhost:8123/"<font></font>
timeout = "60s"<font></font>
cache-ttl = "6h0m0s"<font></font>
zero-timestamp = true</code></pre><br>
<p>     ,    cron.    . </p><br>
<pre><code class="bash hljs">1 12 * * * clickhouse-client -q <span class="hljs-string">"select distinct partition from system.parts where active=1 and database='graphite' and table='data_reverse' and max_date&lt;today()-2;"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> PART; <span class="hljs-keyword">do</span> clickhouse-client -u systemXXX --password XXXXXXX -q <span class="hljs-string">"ALTER TABLE graphite.data_reverse DROP PARTITION ('"</span><span class="hljs-variable">$PART</span><span class="hljs-string">"')"</span>;<span class="hljs-keyword">done</span></code></pre><br>
<p>    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">graphite-clickhouse</a>  :</p><br>
<pre><code class="plaintext hljs">[[data-table]]<font></font>
table = "graphite.data_reverse"<font></font>
max-age = "48h"<font></font>
reverse = true</code></pre><br>
<p>      100% ,     ,             (    95%).        1/3    ,     .      ,     .</p><br>
<p>    CPU?!           Graphite,    CPU-  .    .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/_u/mg/m3/_umgm3dd9lgetkopu45jjrqqodw.png"></a></p><br>
<p>     :  CPU         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">carbon-c-relay</a> (v3.2  2018-09-05,    ),       .    ,        .</p><br>
<h1 id="alerting"></h1><br>
<p>      - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Moira</a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">moira-client</a>.    ,   ,    ,   alert.yaml.        PaaS (         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Â«    Â»</a>)     .    alert.yaml     moira-client    alert-autoconf ( ).     TeamCity         Moira  alert-autoconf.     alert.yaml  ,    yaml-,      Graphite         .</p><br>
<p>  ,   PaaS,       Alerting.     : //alert.yaml.   alert.yaml      TeamCity,       alert.yaml  Moira.</p><br>
<p>        ,   ,   .</p><br>
<p>       ,   GUI,        yaml.   yaml-    alert.yaml    ,      .    alert-autoconf ,             Redis.</p><br>
<p>          247.  ,      ,    alert.yaml    Â« ,    Â»,   [24x7]     .   alert.yaml'            247.  â€” ! !</p><br>
<h1 id="sbor-biznes-metrik"> -</h1><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>     -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">bioyino</a>   . </p><br>
<ol>
<li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Consul</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Raft</a>. </li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   Graphite</a>. </li>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">bioyino</a> (StatsD-server)   .</li>
<li>      "set".</li>
<li>       . </li>
<li>    Graphite     .</li>
<li>   . </li>
</ol><br>
<p>   . </p><br>
<p>    StatsD-       :     ,   k8s   ,       . .<br>
Statsd-    .           UDP,       (     Linux).   ,     (  )      StatsD (bioyino0[1-3])   Capâ€™n Proto.</p><br>
<p>    ,    StatsD-      Graphite   .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>.</p><br>
<p>   ,   . </p><br>
<p><em>  StatsD-</em><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/m2/td/56/m2td56sycgexhmsupyp7nfmp2hw.png"></a><br>
<img src="https://habrastorage.org/webt/np/5m/hi/np5mhi_4z6pfwpdpbvzfamn7fws.png"></p><br>
<p><em> ,   StatsD  Graphite</em><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/m2/td/56/m2td56sycgexhmsupyp7nfmp2hw.png"></a></p><br>
<h1 id="itogo"></h1><br>
<p>         . </p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/n6/ym/-b/n6ym-bcuyt3a3ctoda93lassduo.png"></a></p><br>
<p>   : 2 189 484 898 474.<br>
   : 3 .<br>
   : 6 585 413 171.<br>
 : 1053,    1  15k .</p><br>
<p><strong>   :</strong></p><br>
<ul>
<li>        ;</li>
<li>   Graphite   ;</li>
<li> Moira  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>      . </li>
</ul><br>
<p>      â€” .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 7   Highload++</a>,   ,  .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja467981/index.html">Cisco UCS C240 M5ãƒ©ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã®ãƒœãƒƒã‚¯ã‚¹åŒ–</a></li>
<li><a href="../ja467983/index.html">MVPã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æ¨ã¦ã‚‹ç†ç”±</a></li>
<li><a href="../ja467987/index.html">é®®ã‚„ã‹ãªãƒãƒ«ãƒã‚«ãƒ©ãƒ¼ã‚¼ãƒªãƒ¼ï¼šCPUã‚’ä½¿ç”¨ã—ãªã„ãƒãƒ†ãƒªã‚¢ãƒ«ãƒ¬ãƒ™ãƒ«ã®æ„æ€æ±ºå®š</a></li>
<li><a href="../ja467989/index.html">è»Šã®ã‚µã‚¹ãƒšãƒ³ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ¦ãƒ‹ãƒƒãƒˆã®è¨­è¨ˆæ–¹æ³•</a></li>
<li><a href="../ja467991/index.html">ç”Ÿæ´»è²»ã‚’è€ƒãˆã‚‹ã¨ã€é–‹ç™ºè€…ã®åœ°åŸŸçµ¦ä¸ã¯ãƒ¢ã‚¹ã‚¯ãƒ¯ã¨ã©ã‚Œãã‚‰ã„é•ã„ã¾ã™ã‹</a></li>
<li><a href="../ja467997/index.html">ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯éå¤§è©•ä¾¡ã•ã‚Œã€å˜ç´”ãªè¨­è¨ˆã¯éå°è©•ä¾¡ã•ã‚Œã¦ã„ã‚‹</a></li>
<li><a href="../ja467999/index.html">VNAã‚„æ—¥ä¸­æ©Ÿå™¨ã®è³ªå•ã¸</a></li>
<li><a href="../ja468001/index.html">ã‚ãªãŸã¯æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯æœ¬å½“ã«ã‚ˆã‚Šé«˜ä¾¡ã«ãªã‚Šã¾ã—ãŸ</a></li>
<li><a href="../ja468003/index.html">5 GHzã®é‰„ï¼šè¶…é«˜é€ŸVDSã®æ§‹ç¯‰æ–¹æ³•ã«é–¢ã™ã‚‹ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</a></li>
<li><a href="../ja468005/index.html">æ „å…‰ã®ã‚µãƒãƒ¼ãƒˆã«ã¤ã„ã¦ä¸€è¨€ï¼ˆ9æœˆ24æ—¥ã€ãƒ¢ã‚¹ã‚¯ãƒ¯ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>