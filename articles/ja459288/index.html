<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚰️ 🔔 🎭 ECSライブラリのネイティブ実装 👨🏿‍🚒 👕 🤲🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今週、私はVagabondゲームエンジンに取り組み始め、entity-component-systemテンプレートを実装し始めました。
 
 この記事では、GitHubから無料で入手できる実装について説明します。しかし、単にコードにコメントするのではなく、その構造がどのように設計されたかを説明したい...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ECSライブラリのネイティブ実装</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459288/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c9/fc6/23e/4c9fc623e0787518bde7823317b0e6af.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今週、私はVagabondゲームエンジンに取り組み始め、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entity-component-system</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テンプレートを実装し始めました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubから</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無料で入手できる実装について説明し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、単にコードにコメントするのではなく、その構造がどのように設計されたかを説明したいと思います。</font><font style="vertical-align: inherit;">したがって、最初に作成した実装から始めて、その長所と短所を分析し、それをどのように改善したかを示します。</font><font style="vertical-align: inherit;">最後に、改善できる側面のリストを示します。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動機</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の前の多くの人々がこれをうまくやってきたので、オブジェクト指向アプローチに対するECSの利点については触れません。</font><font style="vertical-align: inherit;">Scott Bilasは</font><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20101011021902/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GDC 2002</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で最初にECSについて話しました</font><font style="vertical-align: inherit;">。トピックへの他の注目すべき導入には、</font><font style="vertical-align: inherit;">マイクウェストの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">進化する階層</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、</font><font style="vertical-align: inherit;">ロバートニストロム</font><font style="vertical-align: inherit;">の素晴らしい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ゲームプログラミングパターン</font></a><font style="vertical-align: inherit;">ブック</font><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">章が含ま</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">
要するに、ECSのタスクは、ゲームエンティティへのデータ指向のアプローチを作成し、データとロジックを便利に分離することです。エンティティは、データを含むコンポーネントで構成されています。そして、ロジックを含むシステムはこれらのコンポーネントを処理します。</font><font style="vertical-align: inherit;">
詳細に入ると、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">継承</font></a><font style="vertical-align: inherit;">ではなく</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECSは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポジションを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">さらに、このデータ指向のアプローチはキャッシュをより有効に活用するため、優れたパフォーマンスを実現します。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードを詳しく説明する前に、これから何を設計するかを説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンポーネントの割り当ては非常に簡単です：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Position</span> :</span> <span class="hljs-keyword">public</span> Component&lt;Position&gt;<font></font>
{<font></font>
    <span class="hljs-keyword">float</span> x;
    <span class="hljs-keyword">float</span> y;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Velocity</span> :</span> <span class="hljs-keyword">public</span> Component&lt;Velocity&gt;<font></font>
{<font></font>
    <span class="hljs-keyword">float</span> x;
    <span class="hljs-keyword">float</span> y;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テンプレートを使用し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、後で説明する技術的な理由から、コンポーネントの数とシステムの数を修正する必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> ComponentCount = <span class="hljs-number">32</span>;
<span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> SystemCount = <span class="hljs-number">8</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、両方のコンポーネントを持つすべてのエンティティを取得し、それらの位置を更新するシステムを指定できます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhysicsSystem</span> :</span> <span class="hljs-keyword">public</span> System&lt;ComponentCount, SystemCount&gt;<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:<font></font>
    PhysicsSystem(EntityManager&lt;ComponentCount, SystemCount&gt;&amp; entityManager) : mEntityManager(entityManager)<font></font>
    {<font></font>
        setRequirements&lt;Position, Velocity&gt;();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">float</span> dt)</span>
    </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; entity : getManagedEntities())<font></font>
        {<font></font>
            <span class="hljs-keyword">auto</span> [position, velocity] = mEntityManager.getComponents&lt;Position, Velocity&gt;(entity);<font></font>
            position.x += velocity.x * dt;<font></font>
            position.y += velocity.y * dt;<font></font>
        }<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
    EntityManager&lt;ComponentCount, SystemCount&gt;&amp; mEntityManager;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムはメソッドを使用して、対象のコンポーネントを宣言します</font></font><code>setRequirements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、この方法では、</font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それが呼び出すことができる</font></font><code>getManagedEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要件を満たすすべてのエンティティの反復トラバーサルのために。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、エンティティマネージャーを作成し、コンポーネントを登録し、システムといくつかのエンティティを作成して、システムを使用してそれらの位置を更新します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">auto</span> manager = EntityManager&lt;ComponentCount, SystemCount&gt;();<font></font>
manager.registerComponent&lt;Position&gt;();<font></font>
manager.registerComponent&lt;Velocity&gt;();<font></font>
<span class="hljs-keyword">auto</span> system = manager.createSystem&lt;PhysicsSystem&gt;(manager);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i)<font></font>
{<font></font>
    <span class="hljs-keyword">auto</span> entity = manager.createEntity();<font></font>
    manager.addComponent&lt;Position&gt;(entity);<font></font>
    manager.addComponent&lt;Velocity&gt;(entity);<font></font>
}<font></font>
<span class="hljs-keyword">auto</span> dt = <span class="hljs-number">1.0f</span> / <span class="hljs-number">60.0f</span>;
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<font></font>
    system-&gt;update(dt);</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベンチマーク</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最高のECSライブラリを作成するふりはしません。</font><font style="vertical-align: inherit;">自分で書きたかっただけです。</font><font style="vertical-align: inherit;">さらに、私はそれを一週間だけ作業しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これがまったく効果のないものを作成する理由にはなりません。</font><font style="vertical-align: inherit;">ベンチマークをインストールしましょう：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初はエンティティを作成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つ目は、システムを使用してエンティティを繰り返しトラバースします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">後者はエンティティを作成および破棄します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてのベンチマークのパラメータは、エンティティの数、各エンティティのコンポーネントの数、コンポーネントの最大数、システムの最大数です。</font><font style="vertical-align: inherit;">このようにして、実装がどれほど適切に拡張できるかを確認できます。</font><font style="vertical-align: inherit;">特に、3つの異なるプロファイルの結果を示します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロファイルA：32のコンポーネントと16のシステム。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAプロファイル：128のコンポーネントと32のシステム。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAAプロファイル：512コンポーネントおよび64システム。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのベンチマークは実装の品質についてのアイデアを提供するという事実にもかかわらず、それらは非常に単純です。</font><font style="vertical-align: inherit;">たとえば、これらのベンチマークでは同種のエンティティのみを使用し、それらのコンポーネントは小さいです。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エッセンス</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の実装では、エンティティは単なるidです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">using</span> Entity = <span class="hljs-keyword">uint32_t</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entity.h</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">後で役立つ</font></a><font style="vertical-align: inherit;">エイリアスも定義します</font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">using</span> Index = <span class="hljs-keyword">uint32_t</span>;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> InvalidIndex = <span class="hljs-built_in">std</span>::numeric_limits&lt;Index&gt;::max();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
64ビットタイプを使用する代わりに、</font><font style="vertical-align: inherit;">スペースを節約し、キャッシュの最適化を改善するため</font><font style="vertical-align: inherit;">に</font></font><code>std::size_t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用する</font></font><code>uint32_t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことにしました。</font><font style="vertical-align: inherit;">私たちはそれほど失うことはありません。誰かが何十億ものエンティティを持つことはまずありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成分</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、コンポーネントの基本クラスを定義します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">auto</span> Type&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Component</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> type = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span>&gt;(Type);<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テンプレートクラスは非常にシンプルで、タイプIDを格納するだけです。これは、後でコンポーネントのタイプによってデータ構造にインデックスを付けるために使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のテンプレートパラメータはコンポーネントのタイプです。</font><font style="vertical-align: inherit;">2番目はに変換された値</font></font><code>std::size_t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、コンポーネントタイプのIDとして機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、</font></font><code>Position</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のように</font><font style="vertical-align: inherit;">コンポーネント</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">定義できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Positon</span> :</span> Component&lt;Position, <span class="hljs-number">0</span>&gt;<font></font>
{<font></font>
    <span class="hljs-keyword">float</span> x;
    <span class="hljs-keyword">float</span> y;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、列挙型を使用する方が便利な場合があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">enum</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ComponentType</span>
{</span><font></font>
    Position<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Positon</span> :</span> Component&lt;Position, ComponentType::Position&gt;<font></font>
{<font></font>
    <span class="hljs-keyword">float</span> x;
    <span class="hljs-keyword">float</span> y;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
導入例では、テンプレートパラメータは1つだけです。タイプIDを手動で指定する必要はありません。</font><font style="vertical-align: inherit;">後で、構造を改善し、タイプ識別子を自動的に生成する方法について説明します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EntityContainer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス</font></font><code>EntityContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、エンティティとそれぞれのストレージの管理を担当します</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>std::bitset</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このビットのセットは、エンティティが所有するコンポーネントを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンティティを使用してコンテナ、特にのインデックスを作成</font></font><code>std::vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">するため、IDをできるだけ小さくして、メモリの使用量を少なくする必要があります。</font><font style="vertical-align: inherit;">したがって、破棄されたエンティティのIDを再利用します。</font><font style="vertical-align: inherit;">これを行うには、無料のIDがというコンテナに格納され</font></font><code>mFreeEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに発表があり</font></font><code>EntityContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> ComponentCount, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> SystemCount&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntityContainer</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reserve</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> size)</span></span>;
    <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&gt;&amp; <span class="hljs-title">getEntityToBitset</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&amp; <span class="hljs-title">getBitset</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span></span>;
    <span class="hljs-function">Entity <span class="hljs-title">create</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(Entity entity)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&gt; mEntityToBitset;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Entity&gt; mFreeEntities;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドの実装方法を見てみましょう。</font></font><br>
<br>
<code>getEntityToBitset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font></font><code>getBitset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-これらは普通の小さなゲッターです：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&gt;&amp; <span class="hljs-title">getEntityToBitset</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> mEntityToBitset;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&amp; <span class="hljs-title">getBitset</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span>
</span>{
    <span class="hljs-keyword">return</span> mEntityToBitset[entity];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法は</font></font><code>create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より興味深いものです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">Entity <span class="hljs-title">create</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">auto</span> entity = Entity();
    <span class="hljs-keyword">if</span> (mFreeEntities.empty())<font></font>
    {<font></font>
        entity = <span class="hljs-keyword">static_cast</span>&lt;Entity&gt;(mEntityToBitset.size());<font></font>
        mEntityToBitset.emplace_back();<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        entity = mFreeEntities.back();<font></font>
        mFreeEntities.pop_back();<font></font>
        mEntityToBitset[entity].reset();<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> entity;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空きエンティティがある場合、彼はそれを再利用します。</font><font style="vertical-align: inherit;">それ以外の場合、メソッドは新しいエンティティを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font></font><code>remove</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、削除するエンティティを追加するだけです</font></font><code>mFreeEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(Entity entity)</span>
</span>{<font></font>
    mFreeEntities.push_back(entity);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の方法はこれ</font></font><code>reserve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">そのタスクは、さまざまなコンテナ用にメモリを予約することです。</font><font style="vertical-align: inherit;">ご存知かもしれませんが、メモリの割り当てはコストのかかる操作であるため、ゲーム内の将来のエンティティの数がほぼわかっている場合は、メモリを予約すると作業が高速化されます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reserve</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> size)</span>
</span>{<font></font>
    mFreeEntities.resize(size);<font></font>
    <span class="hljs-built_in">std</span>::iota(<span class="hljs-built_in">std</span>::begin(mFreeEntities), <span class="hljs-built_in">std</span>::end(mFreeEntities), <span class="hljs-number">0</span>);<font></font>
    mEntityToBitset.resize(size);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メモリの単純なバックアップに加えて、それもいっぱいになり</font></font><code>mFreeEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ComponentContainer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス</font></font><code>ComponentContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、特定のタイプのすべてのコンポーネントを格納する責任があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のアーキテクチャでは、特定のタイプのすべてのコンポーネントが一緒に格納されています。</font><font style="vertical-align: inherit;">つまり、と呼ばれるコンポーネントのタイプごとに1つの大きな配列があります</font></font><code>mComponents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、エンティティからコンポーネントを一定の時間で追加、受信、または削除できるようにするには、エンティティからコンポーネントへ、およびコンポーネントからエンティティへ遷移する方法が必要です。</font><font style="vertical-align: inherit;">これを行うには、</font></font><code>mComponentToEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">およびと</font><font style="vertical-align: inherit;">呼ばれるさらに2つのデータ構造が必要</font></font><code>mEntityToComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに発表があり</font></font><code>ComponentContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> ComponentCount, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> SystemCount&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ComponentContainer</span> :</span> <span class="hljs-keyword">public</span> BaseComponentContainer<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:<font></font>
    ComponentContainer(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&gt;&amp; entityToBitset);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reserve</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> size)</span> <span class="hljs-keyword">override</span></span>;<font></font>
<font></font>
    <span class="hljs-function">T&amp; <span class="hljs-title">get</span><span class="hljs-params">(Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">const</span> T&amp; <span class="hljs-title">get</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(Entity entity, Args&amp;&amp;... args)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">tryRemove</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function">Entity <span class="hljs-title">getOwner</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T&amp; component)</span> <span class="hljs-keyword">const</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;T&gt; mComponents;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Entity&gt; mComponentToEntity;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unordered_map</span>&lt;Entity, Index&gt; mEntityToComponent;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&gt;&amp; mEntityToBitset;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の</font></font><code>BaseComponentContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ように設定されている</font><font style="vertical-align: inherit;">から継承されていることがわかります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseComponentContainer</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~BaseComponentContainer() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reserve</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> size)</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">tryRemove</span><span class="hljs-params">(Entity entity)</span> </span>= <span class="hljs-number">0</span>;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この基本クラスの唯一の目的は、すべてのインスタンス</font></font><code>ComponentContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をコンテナ</font><font style="vertical-align: inherit;">に格納できるようにすること</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、メソッドの定義を見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、コンストラクターについて考えてみましょう。エンティティービットのセットを含むコンテナーへの参照を取得します。</font><font style="vertical-align: inherit;">このクラスはそれを使用して、エンティティにコンポーネントがあるかどうかを確認し、コンポーネントを追加または削除するときにエンティティのビットのセットを更新します。</font></font><br>
<br>
<pre><code class="cpp hljs">ComponentContainer(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&gt;&amp; entityToBitset) :<font></font>
    mEntityToBitset(entityToBitset)<font></font>
{<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法では</font></font><code>get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、我々はそれを使用し、シンプルで</font></font><code>mEntityToComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンティティコンポーネントのインデックスを見つけるために</font></font><code>entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では</font></font><code>mComponents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">T&amp; <span class="hljs-title">get</span><span class="hljs-params">(Entity entity)</span>
</span>{
    <span class="hljs-keyword">return</span> mComponents[mEntityToComponent[entity]];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font></font><code>add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、引数を使用して末尾に新しいコンポーネントを挿入</font></font><code>mComponents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、エンティティからコンポーネントへ、およびコンポーネントからエンティティへ移動するためのリンクを準備します。</font><font style="vertical-align: inherit;">最後</font></font><code>entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、コンポーネントに対応する</font><font style="vertical-align: inherit;">ビットセットのビット</font><font style="vertical-align: inherit;">、値を</font><font style="vertical-align: inherit;">割り当て</font><font style="vertical-align: inherit;">ます</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(Entity entity, Args&amp;&amp;... args)</span>
</span>{
    <span class="hljs-keyword">auto</span> index = <span class="hljs-keyword">static_cast</span>&lt;Index&gt;(mComponents.size());<font></font>
    mComponents.emplace_back(<span class="hljs-built_in">std</span>::forward&lt;Args&gt;(args)...);<font></font>
    mComponentToEntity.emplace_back(entity);<font></font>
    mEntityToComponent[entity] = index;<font></font>
    mEntityToBitset[entity][T::type] = <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font></font><code>remove</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ビットの対応するコンポーネントに値を割り当て</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最後のコンポーネント</font></font><code>mComponents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を、削除する</font><font style="vertical-align: inherit;">コンポーネント</font><font style="vertical-align: inherit;">のインデックスに</font><font style="vertical-align: inherit;">移動し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">移動したコンポーネントへのリンクを更新し、破棄するコンポーネントの1つを削除します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(Entity entity)</span>
</span>{<font></font>
    mEntityToBitset[entity][T::type] = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">auto</span> index = mEntityToComponent[entity];
    <span class="hljs-comment">// Update mComponents</span>
    mComponents[index] = <span class="hljs-built_in">std</span>::move(mComponents.back());<font></font>
    mComponents.pop_back();<font></font>
    <span class="hljs-comment">// Update mEntityToComponent</span><font></font>
    mEntityToComponent[mComponentToEntity.back()] = index;<font></font>
    mEntityToComponent.erase(entity);<font></font>
    <span class="hljs-comment">// Update mComponentToEntity</span><font></font>
    mComponentToEntity[index] = mComponentToEntity.back();<font></font>
    mComponentToEntity.pop_back();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
破壊したいインデックスの最後のコンポーネントを移動することにより、一定時間の移動を実行できます。</font><font style="vertical-align: inherit;">そして実際には、最後のコンポーネントを削除するだけで済みます。これは</font></font><code>std::vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一定の時間で</font><font style="vertical-align: inherit;">実行できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font></font><code>tryRemove</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、エンティティを削除する前に、エンティティにコンポーネントがあるかどうかを確認します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">tryRemove</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">override</span>
</span>{
    <span class="hljs-keyword">if</span> (mEntityToBitset[entity][T::type])<font></font>
    {<font></font>
        remove(entity);<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font></font><code>getOwner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、コンポーネントを所有するエンティティを返します。このために、ポインター演算と</font></font><code>mComponentToEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">Entity <span class="hljs-title">getOwner</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T&amp; component)</span> <span class="hljs-keyword">const</span>
</span>{
    <span class="hljs-keyword">auto</span> begin = mComponents.data();
    <span class="hljs-keyword">auto</span> index = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span>&gt;(&amp;component - begin);
    <span class="hljs-keyword">return</span> mComponentToEntity[index];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のメソッドはthisです</font></font><code>reserve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これには、の類似したメソッドと同じような目的があります</font></font><code>EntityContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reserve</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> size)</span> <span class="hljs-keyword">override</span>
</span>{<font></font>
    mComponents.reserve(size);<font></font>
    mComponentToEntity.reserve(size);<font></font>
    mEntityToComponent.reserve(size);<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システム</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、クラスを見てみましょう</font></font><code>System</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各システムには、</font></font><code>mRequirements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なコンポーネントを記述する</font><font style="vertical-align: inherit;">ビットのセットがあり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">さらに、</font></font><code>mManagedEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの要件を満たす</font><font style="vertical-align: inherit;">エンティティのセットを格納し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">繰り返しますが、すべての操作を一定の時間で実装できるようにするために、エンティティからのエンティティに移動する方法が必要</font></font><code>mManagedEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これには、</font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font><font style="vertical-align: inherit;">を使用し</font><font style="vertical-align: inherit;">ます</font></font><code>mEntityToManagedEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
広告は次のようになります</font></font><code>System</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> ComponentCount, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> SystemCount&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">System</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~System() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
    <span class="hljs-keyword">void</span> <span class="hljs-title">setRequirements</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Entity&gt;&amp; <span class="hljs-title">getManagedEntities</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onManagedEntityAdded</span><span class="hljs-params">([[maybe_unused]] Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onManagedEntityRemoved</span><span class="hljs-params">([[maybe_unused]] Entity entity)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">friend</span> EntityManager&lt;ComponentCount, SystemCount&gt;;<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt; mRequirements;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> mType;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Entity&gt; mManagedEntities;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unordered_map</span>&lt;Entity, Index&gt; mEntityToManagedEntity;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> type)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onEntityUpdated</span><span class="hljs-params">(Entity entity, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&amp; components)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onEntityRemoved</span><span class="hljs-params">(Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addEntity</span><span class="hljs-params">(Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removeEntity</span><span class="hljs-params">(Entity entity)</span></span>;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビット値を設定するに</font></font><code>setRequirements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">畳み込み式を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">setRequirements</span><span class="hljs-params">()</span>
</span>{<font></font>
    (mRequirements.<span class="hljs-built_in">set</span>(Ts::type), ...);<font></font>
}</code></pre><br>
<code>getManagedEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 生成されたクラスが処理されたエンティティにアクセスするために使用するゲッターです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Entity&gt;&amp; <span class="hljs-title">getManagedEntities</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
    <span class="hljs-keyword">return</span> mManagedEntities;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成されたクラスが変更を試みないように、定数参照を返します</font></font><code>mManagedEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<code>onManagedEntityAdded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>onManagedEntityRemoved</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空です。それらは後で再定義されます。これらのメソッドは、エンティティを追加</font></font><code>mManagedEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または削除する</font><font style="vertical-align: inherit;">ときに呼び出され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のメソッドはプライベートであり</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Friendlyクラスとして宣言されている</font><font style="vertical-align: inherit;">メソッドからのみアクセスできます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<code>setUp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンティティーマネージャーによって呼び出され、システムにIDを割り当てます。次に、それを使用して配列のインデックスを作成できます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> type)</span>
</span>{<font></font>
    mType = type;<font></font>
}</code></pre><br>
<code>onEntityUpdated</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンティティが変更されたとき、つまり </font><font style="vertical-align: inherit;">コンポーネントを追加または削除するとき。</font><font style="vertical-align: inherit;">システムは、要件が満たされているかどうか、およびエンティティーがすでに処理されているかどうかをチェックします。</font><font style="vertical-align: inherit;">要件を満たし、まだ処理されていない場合は、システムによって追加されます。</font><font style="vertical-align: inherit;">ただし、エンティティが要件を満たしておらず、すでに処理されている場合は、システムによって削除されます。</font><font style="vertical-align: inherit;">その他の場合はすべて、システムは何もしません。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onEntityUpdated</span><span class="hljs-params">(Entity entity, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;&amp; components)</span>
</span>{
    <span class="hljs-keyword">auto</span> satisfied = (mRequirements &amp; components) == mRequirements;
    <span class="hljs-keyword">auto</span> managed = mEntityToManagedEntity.find(entity) != <span class="hljs-built_in">std</span>::end(mEntityToManagedEntity);
    <span class="hljs-keyword">if</span> (satisfied &amp;&amp; !managed)<font></font>
        addEntity(entity);<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!satisfied &amp;&amp; managed)<font></font>
        removeEntity(entity);<font></font>
}</code></pre><br>
<code>onEntityRemoved</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンティティが削除されたときにエンティティマネージャによって呼び出されます。</font><font style="vertical-align: inherit;">エンティティがシステムによって処理された場合は、それを削除します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onEntityRemoved</span><span class="hljs-params">(Entity entity)</span>
</span>{
    <span class="hljs-keyword">if</span> (mEntityToManagedEntity.find(entity) != <span class="hljs-built_in">std</span>::end(mEntityToManagedEntity))<font></font>
        removeEntity(entity);<font></font>
}</code></pre><br>
<code>addEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font></font><code>removeEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-これらは単なるヘルパーメソッドです。</font></font><br>
<br>
<code>addEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加されたエンティティからそのインデックスでリンクするようにリンクを設定し</font></font><code>mManagedEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、エンティティを追加してを呼び出します</font></font><code>onManagedEntityAdded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addEntity</span><span class="hljs-params">(Entity entity)</span>
</span>{<font></font>
    mEntityToManagedEntity[entity] = <span class="hljs-keyword">static_cast</span>&lt;Index&gt;(mManagedEntities.size());<font></font>
    mManagedEntities.emplace_back(entity);<font></font>
    onManagedEntityAdded(entity);<font></font>
}</code></pre><br>
<code>removeEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の呼び出し</font></font><code>onManagedEntityRemoved</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、最後に処理されたエンティティを、削除されるエンティティのインデックスに移動します。</font><font style="vertical-align: inherit;">移動したエンティティへの参照を更新します。</font><font style="vertical-align: inherit;">終わりに、それはから削除するために必要なエンティティを削除</font></font><code>mManagedEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>mEntityToManagedEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removeEntity</span><span class="hljs-params">(Entity entity)</span>
</span>{<font></font>
    onManagedEntityRemoved(entity);<font></font>
    <span class="hljs-keyword">auto</span> index = mEntityToManagedEntity[entity];<font></font>
    mEntityToManagedEntity[mManagedEntities.back()] = index;<font></font>
    mEntityToManagedEntity.erase(entity);<font></font>
    mManagedEntities[index] = mManagedEntities.back();<font></font>
    mManagedEntities.pop_back();<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EntityManager</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての重要なロジックは他のクラスにあります。</font><font style="vertical-align: inherit;">エンティティマネージャは単にすべてを一緒に結び付けます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼の広告を見てみましょう：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> ComponentCount, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> SystemCount&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntityManager</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-keyword">void</span> <span class="hljs-title">registerComponent</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> ...Args&gt;
    T* <span class="hljs-title">createSystem</span><span class="hljs-params">(Args&amp;&amp; ...args)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reserve</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> size)</span></span>;
    <span class="hljs-function">Entity <span class="hljs-title">createEntity</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removeEntity</span><span class="hljs-params">(Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-keyword">bool</span> <span class="hljs-title">hasComponent</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
    <span class="hljs-keyword">bool</span> <span class="hljs-title">hasComponents</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    T&amp; <span class="hljs-title">getComponent</span><span class="hljs-params">(Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-keyword">const</span> T&amp; <span class="hljs-title">getComponent</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
    <span class="hljs-built_in">std</span>::tuple&lt;Ts&amp;...&gt; <span class="hljs-title">getComponents</span><span class="hljs-params">(Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
    <span class="hljs-built_in">std</span>::tuple&lt;<span class="hljs-keyword">const</span> Ts&amp;...&gt; <span class="hljs-title">getComponents</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-keyword">void</span> <span class="hljs-title">addComponent</span><span class="hljs-params">(Entity entity, Args&amp;&amp;... args)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-keyword">void</span> <span class="hljs-title">removeComponent</span><span class="hljs-params">(Entity entity)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    Entity <span class="hljs-title">getOwner</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T&amp; component)</span> <span class="hljs-keyword">const</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;BaseComponentContainer&gt;, ComponentCount&gt; mComponentContainers;<font></font>
    EntityContainer&lt;ComponentCount, SystemCount&gt; mEntities;<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;System&lt;ComponentCount, SystemCount&gt;&gt;&gt; mSystems;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-keyword">void</span> <span class="hljs-title">checkComponentType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
    <span class="hljs-keyword">void</span> <span class="hljs-title">checkComponentTypes</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-keyword">auto</span> <span class="hljs-title">getComponentContainer</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-keyword">auto</span> <span class="hljs-title">getComponentContainer</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスは</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1：3人の可変クラスメンバー持って</font></font><code>mComponentContainers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いる店舗のポインタを</font></font><code>std::unique_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font><code>BaseComponentContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>mEntities</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単にインスタンスであることを1 </font></font><code>EntityContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>mSystems</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1店舗ポインタこと</font></font><code>unique_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font><code>System</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスには多くのメソッドがありますが、実際にはすべて非常に単純です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず</font></font><code>getComponentContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、型のコンポーネントを処理するコンポーネントコンテナへのポインタを返すを</font><font style="vertical-align: inherit;">見てみましょう</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">getComponentContainer</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;ComponentContainer&lt;T, ComponentCount, SystemCount&gt;*&gt;(mComponentContainers[T::type].get());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のヘルパー関数は</font></font><code>checkComponentType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、コンポーネントタイプIDがコンポーネントの最大数を下回って</font><font style="vertical-align: inherit;">いること</font><font style="vertical-align: inherit;">を単にチェックするものです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">checkComponentType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
    <span class="hljs-keyword">static_assert</span>(T::type &lt; ComponentCount);<font></font>
}</code></pre><br>
<code>checkComponentTypes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 畳み込み式を使用して、いくつかのタイプのチェックを実行します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">checkComponentTypes</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{<font></font>
    (checkComponentType&lt;Ts&gt;(), ...);<font></font>
}</code></pre><br>
<code>registerComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 指定されたタイプのコンポーネントの新しいコンテナを作成します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">registerComponent</span><span class="hljs-params">()</span>
</span>{<font></font>
    checkComponentType&lt;T&gt;();<font></font>
    mComponentContainers[T::type] = <span class="hljs-built_in">std</span>::make_unique&lt;ComponentContainer&lt;T, ComponentCount, SystemCount&gt;&gt;(<font></font>
        mEntities.getEntityToBitset());<font></font>
}</code></pre><br>
<code>createSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 指定されたタイプの新しいシステムを作成し、そのタイプを設定します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> ...Args&gt;
T* <span class="hljs-title">createSystem</span><span class="hljs-params">(Args&amp;&amp; ...args)</span>
</span>{
    <span class="hljs-keyword">auto</span> type = mSystems.size();
    <span class="hljs-keyword">auto</span>&amp; system = mSystems.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;T&gt;(<span class="hljs-built_in">std</span>::forward&lt;Args&gt;(args)...));<font></font>
    system-&gt;setUp(type);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;T*&gt;(system.get());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法は、</font></font><code>reserve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出して</font></font><code>reserve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、コンテナの</font><font style="vertical-align: inherit;">メソッドを</font></font><code>ComponentContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>EntityContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reserve</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> size)</span>
</span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span>(<span class="hljs-number">0</span>); i &lt; ComponentCount; ++i)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (mComponentContainers[i])<font></font>
            mComponentContainers[i]-&gt;reserve(size);<font></font>
    }<font></font>
    mEntities.reserve(size);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font></font><code>createEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><code>create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manager </font><font style="vertical-align: inherit;">メソッドの結果を返します</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">Entity <span class="hljs-title">createEntity</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> mEntities.create();<font></font>
}</code></pre><br>
<code>hasComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> エンティティビットのセットを使用して、このエンティティに指定されたタイプのコンポーネントがあることをすばやく確認します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">bool</span> <span class="hljs-title">hasComponent</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span>
</span>{<font></font>
    checkComponentType&lt;T&gt;();<font></font>
    <span class="hljs-keyword">return</span> mEntities.getBitset(entity)[T::type];<font></font>
}</code></pre><br>
<code>hasComponents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> は、たたみ込み式を使用して必要なコンポーネントを示すビットのセットを作成し、それをエンティティのビットのセットとともに使用して、エンティティに必要なすべてのコンポーネントがあるかどうかを確認します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
<span class="hljs-keyword">bool</span> <span class="hljs-title">hasComponents</span><span class="hljs-params">(Entity entity)</span> <span class="hljs-keyword">const</span>
</span>{<font></font>
    checkComponentTypes&lt;Ts...&gt;();<font></font>
    <span class="hljs-keyword">auto</span> requirements = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;ComponentCount&gt;();<font></font>
    (requirements.<span class="hljs-built_in">set</span>(Ts::type), ...);
    <span class="hljs-keyword">return</span> (requirements &amp; mEntities.getBitset(entity)) == requirements;<font></font>
}</code></pre><br>
<code>getComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要求を必要なコンポーネントコンテナにリダイレクトします。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
T&amp; <span class="hljs-title">getComponent</span><span class="hljs-params">(Entity entity)</span>
</span>{<font></font>
    checkComponentType&lt;T&gt;();<font></font>
    <span class="hljs-keyword">return</span> getComponentContainer&lt;T&gt;()-&gt;get(entity);<font></font>
}</code></pre><br>
<code>getComponents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求されたコンポーネントへのリンクのタプルを返します。</font><font style="vertical-align: inherit;">これを行うには、彼は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>std::tie</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">畳み込み式</font><font style="vertical-align: inherit;">を使用し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ...Ts&gt;
<span class="hljs-built_in">std</span>::tuple&lt;Ts&amp;...&gt; <span class="hljs-title">getComponents</span><span class="hljs-params">(Entity entity)</span>
</span>{<font></font>
    checkComponentTypes&lt;Ts...&gt;();<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::tie(getComponentContainer&lt;Ts&gt;()-&gt;get(entity)...);<font></font>
}</code></pre><br>
<code>addComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font></font><code>removeComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なコンポーネントコンテナに要求を転送し、システムメソッドを呼び出します</font></font><code>onEntityUpdated</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">addComponent</span><span class="hljs-params">(Entity entity, Args&amp;&amp;... args)</span>
</span>{<font></font>
    checkComponentType&lt;T&gt;();<font></font>
    getComponentContainer&lt;T&gt;()-&gt;add(entity, <span class="hljs-built_in">std</span>::forward&lt;Args&gt;(args)...);
    <span class="hljs-comment">// Send message to systems</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; <span class="hljs-built_in">bitset</span> = mEntities.getBitset(entity);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; system : mSystems)<font></font>
        system-&gt;onEntityUpdated(entity, <span class="hljs-built_in">bitset</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">removeComponent</span><span class="hljs-params">(Entity entity)</span>
</span>{<font></font>
    checkComponentType&lt;T&gt;();<font></font>
    getComponentContainer&lt;T&gt;()-&gt;remove(entity);<font></font>
    <span class="hljs-comment">// Send message to systems</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; <span class="hljs-built_in">bitset</span> = mEntities.getBitset(entity);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; system : mSystems)<font></font>
        system-&gt;onEntityUpdated(entity, <span class="hljs-built_in">bitset</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に</font></font><code>getOwner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、リクエストを目的のコンテナコンポーネント</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">転送します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
Entity <span class="hljs-title">getOwner</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T&amp; component)</span> <span class="hljs-keyword">const</span>
</span>{<font></font>
    checkComponentType&lt;T&gt;();<font></font>
    <span class="hljs-keyword">return</span> getComponentContainer&lt;T&gt;()-&gt;getOwner(component);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それが私の最初の実装でした。</font><font style="vertical-align: inherit;">わずか357行のコードで構成されています。</font><font style="vertical-align: inherit;">すべてのコードはこの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スレッドにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロファイリングとベンチマーク</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベンチマーク</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今こそ、私の最初のECS実装をベンチマークする時です！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は次のとおりです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c9/fc6/23e/4c9fc623e0787518bde7823317b0e6af.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb0/323/9a9/bb03239a90cccf5f95ab47ecf94e3a4d.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/679/e54/f0e/679e54f0e32260a9f62621838b51a15e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テンプレートは十分にスケーリングされます！</font><font style="vertical-align: inherit;">1秒間に処理される数は、エンティティの数を増やし、プロファイル（A、AA、およびAAA）を変更する場合とほぼ同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、エンティティのコンポーネント数の増加に合わせて適切にスケーリングされます。</font><font style="vertical-align: inherit;">3つのコンポーネントを持つエンティティを反復する場合、1つのコンポーネントを持つエンティティを反復するよりも3倍遅く発生します。</font><font style="vertical-align: inherit;">これは、3つのコンポーネントを取得する必要があるため、予想されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャッシュミス</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュミスの数を確認するために</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ここから</font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">した</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">cachegrindの</font></a><font style="vertical-align: inherit;">例</font><font style="vertical-align: inherit;">を実行</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">しました</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10,000エンティティ</font><font style="vertical-align: inherit;">
の結果は</font><font style="vertical-align: inherit;">
次のとおりです。100,000エンティティ</font><font style="vertical-align: inherit;">の結果は</font><font style="vertical-align: inherit;">次のとおりです</font><font style="vertical-align: inherit;">。結果はかなり良好です。</font><font style="vertical-align: inherit;">100,000エンティティでLLdミスが非常に多いのは、少し奇妙なことです。</font></font><br>
<br>
<code>==1652== D refs: 277,577,353 (254,775,159 rd + 22,802,194 wr)<br>
==1652== D1 misses: 20,814,368 ( 20,759,914 rd + 54,454 wr)<br>
==1652== LLd misses: 43,483 ( 7,847 rd + 35,636 wr)<br>
==1652== D1 miss rate: 7.5% ( 8.1% + 0.2% )<br>
==1652== LLd miss rate: 0.0% ( 0.0% + 0.2% )</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>==1738== D refs: 2,762,879,670 (2,539,368,564 rd + 223,511,106 wr)<br>
==1738== D1 misses: 207,415,181 ( 206,902,072 rd + 513,109 wr)<br>
==1738== LLd misses: 207,274,328 ( 206,789,289 rd + 485,039 wr)<br>
==1738== D1 miss rate: 7.5% ( 8.1% + 0.2% )<br>
==1738== LLd miss rate: 7.5% ( 8.1% + 0.2% )</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロファイリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在の実装のどの部分に時間がかかるかを理解するために、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gprofを使用し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て例をプロファイルしました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は次のとおり</font><font style="vertical-align: inherit;">です。gprofが意味のあるものを表示するように</font><font style="vertical-align: inherit;">
フラグを付けてコンパイルしたため、結果が少し歪んでいる可能性があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最適化レベルを上げると、コンパイラーはすべてを積極的に埋め込み始め、gprofはほとんど何も言わないようです。</font><font style="vertical-align: inherit;">
gprofによると、この実装の明らかなボトルネックは</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">それを最適化したい場合は、それらを取り除くことを試みる価値があります。</font></font><br>
<br>
<code>Flat profile:<br>
<br>
Each sample counts as 0.01 seconds.<br>
 % cumulative self self total<br>
 time seconds seconds calls ms/call ms/call name<br>
 57.45 1.16 1.16 200300000 0.00 0.00 std::__detail::_Map_base&lt;unsigned int, std::pair&lt;unsigned int const, unsigned int&gt;, std::allocator&lt;std::pair&lt;unsigned int const, unsigned int&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;unsigned int&gt;, std::hash&lt;unsigned int&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;false, false, true&gt;, true&gt;::operator[](unsigned int const&amp;)<br>
 19.31 1.55 0.39 main<br>
 16.34 1.88 0.33 200500000 0.00 0.00 std::_Hashtable&lt;unsigned int, std::pair&lt;unsigned int const, unsigned int&gt;, std::allocator&lt;std::pair&lt;unsigned int const, unsigned int&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;unsigned int&gt;, std::hash&lt;unsigned int&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;false, false, true&gt; &gt;::_M_find_before_node(unsigned long, unsigned int const&amp;, unsigned long) const<br>
 3.96 1.96 0.08 300000 0.00 0.00 std::_Hashtable&lt;unsigned int, std::pair&lt;unsigned int const, unsigned int&gt;, std::allocator&lt;std::pair&lt;unsigned int const, unsigned int&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;unsigned int&gt;, std::hash&lt;unsigned int&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;false, false, true&gt; &gt;::_M_insert_unique_node(unsigned long, unsigned long, std::__detail::_Hash_node&lt;std::pair&lt;unsigned int const, unsigned int&gt;, false&gt;*)<br>
 2.48 2.01 0.05 300000 0.00 0.00 unsigned int&amp; std::vector&lt;unsigned int, std::allocator&lt;unsigned int&gt; &gt;::emplace_back&lt;unsigned int&amp;&gt;(unsigned int&amp;)<br>
 0.50 2.02 0.01 3 3.33 3.33 std::_Hashtable&lt;unsigned int, std::pair&lt;unsigned int const, unsigned int&gt;, std::allocator&lt;std::pair&lt;unsigned int const, unsigned int&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;unsigned int&gt;, std::hash&lt;unsigned int&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;false, false, true&gt; &gt;::~_Hashtable()<br>
 0.00 2.02 0.00 200000 0.00 0.00 std::_Hashtable&lt;unsigned int, std::pair&lt;unsigned int const, unsigned int&gt;, std::allocator&lt;std::pair&lt;unsigned int const, unsigned int&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;unsigned int&gt;, std::hash&lt;unsigned int&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;false, false, true&gt; &gt;::find(unsigned int const&amp;)</code><br>
<br><font style="vertical-align: inherit;"></font><code>-O1</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>std::unordered_map</code><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比較 </font></font><code>std::map</code></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は間のパフォーマンスの違いが気になった</font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>std::map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、私は、コードのすべてを置き換える</font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>std::map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この実装は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらから</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入手でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます。</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ベンチマークの結果は次のとおりです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/611/50b/3da/61150b3da1ec1cf850a0ed5b761f03a1.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/136/3be/951/1363be95163a3dfb2ab968c1591c7c60.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d08/b4b/7f1/d08b4b7f1b5b35531bdc32a614ccbb81.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回は、エンティティの数が増えるため、実装がうまくスケーリングしないことがわかります。</font><font style="vertical-align: inherit;">また、エンティティが1000の場合でも、バージョンcの2倍の速度で反復が行われます</font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
entity-component-systemテンプレートのシンプルだが既に実用的なライブラリを作成しました。</font><font style="vertical-align: inherit;">将来的には、改善と最適化の基盤として使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の部分では、我々は交換することにより、生産性を向上させる方法を説明します</font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>std::vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さらに、IDタイプをコンポーネントに自動的に割り当てる方法を示します。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: unordered_mapをstd :: vectorに置き換える</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見てきたように、これら</font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は私たちの実装のボトルネックでした。</font><font style="vertical-align: inherit;">したがって、代わりに</font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in </font></font><code>mEntityToComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><code>ComponentContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">およびin </font></font><code>mEntityToManagedEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><code>System</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vector </font><font style="vertical-align: inherit;">を使用し</font></font><code>std::vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更は非常に簡単</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ここ</font></a><font style="vertical-align: inherit;">で確認でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
唯一の微妙な点である</font></font><code>vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font><code>mEntityToComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>mEntityToManagedEntity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意のエンティティによってインデックス付けのために十分な長さです。</font><font style="vertical-align: inherit;">簡単な方法でこれを行うために、私はこれら保存することを決めた</font></font><code>vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font></font><code>EntityContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、私たちは、エンティティの最大のIDを知っているし、。</font><font style="vertical-align: inherit;">次に</font></font><code>vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、エンティティマネージャーで参照またはポインターによってコンポーネントコンテナーに</font><font style="vertical-align: inherit;">ベクターを渡し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更されたコードはこの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スレッドにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このバージョンが以前のバージョンよりどのように機能するかを確認してみましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38a/1df/4bd/38a1df4bd3c8110d3873588854ffc314.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f5/897/2ae/0f58972ae408b9726899597fbd774be1.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22b/3f5/fcd/22b3f5fcd21c8285cc779f46ca3896a4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、多数のコンポーネントとシステムでの作成と削除は少し</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遅く</font><font style="vertical-align: inherit;">なってい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、反復ははるかに速くなり、ほぼ10倍になりました。</font><font style="vertical-align: inherit;">そして、それは非常によくスケーリングします。</font><font style="vertical-align: inherit;">この高速化は、作成と削除の速度低下を大幅に上回ります。</font><font style="vertical-align: inherit;">これは論理的です。エンティティの反復は何度も発生しますが、作成と削除は1回だけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、キャッシュミスの数が減少したかどうかを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは万のエンティティとcachegrindの出力は次のようになります。</font><font style="vertical-align: inherit;">
そして、ここで10万エンティティのために出力されます：</font><font style="vertical-align: inherit;">
私たちは、このバージョンは3回少ないリンクと4倍少ないキャッシュ・ミスについて作成していることがわかります。</font></font><br>
<br>
<code>==1374== D refs: 94,563,949 (72,082,880 rd + 22,481,069 wr)<br>
==1374== D1 misses: 4,813,780 ( 4,417,702 rd + 396,078 wr)<br>
==1374== LLd misses: 378,905 ( 9,626 rd + 369,279 wr)<br>
==1374== D1 miss rate: 5.1% ( 6.1% + 1.8% )<br>
==1374== LLd miss rate: 0.4% ( 0.0% + 1.6% )</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>==1307== D refs: 938,405,796 (715,424,940 rd + 222,980,856 wr)<br>
==1307== D1 misses: 51,034,738 ( 44,045,090 rd + 6,989,648 wr)<br>
==1307== LLd misses: 5,866,508 ( 1,997,948 rd + 3,868,560 wr)<br>
==1307== D1 miss rate: 5.4% ( 6.2% + 3.1% )<br>
==1307== LLd miss rate: 0.6% ( 0.3% + 1.7% )</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動タイプ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に説明する改善点は、コンポーネントタイプ識別子の自動生成です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
id型の自動生成を実装するためのすべての変更は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンポーネントのタイプごとに1つの一意のIDを割り当てることができるようにするには、CRTPと静的カウンターを持つ関数を使用する必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Component</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> type;<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> <span class="hljs-title">generateComponentType</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">auto</span> counter = <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> counter++;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> Component&lt;T&gt;::type = generateComponentType();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タイプIDが実行時に生成されるようになり、以前はコンパイル時に認識されていたことがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更後のコードは、この</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スレッドにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このバージョンのパフォーマンスをテストするために、ベンチマークを実施しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bd/112/0da/7bd1120da37daac5e3ef48446776b6e7.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/234/f2f/937/234f2f9377a0f3ad8ea231f91e335ddf.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/101/4f2/ade/1014f2adebd6156bc48c9b6fe5670b43.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作成と削除については、結果はほぼ同じままでした。</font><font style="vertical-align: inherit;">ただし、反復が少し遅く、約10％になっていることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この速度低下は、コンパイラーがコンパイル時に型識別子を知っていたために、コードをより最適化できるという事実で説明できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
idタイプの手動割り当ては少し不便で、エラーが発生する可能性があります。</font><font style="vertical-align: inherit;">したがって、パフォーマンスを少し低下させても、ECSライブラリの使いやすさは向上しています。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらなる改善のためのアイデア</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を締めくくる前に、他の改善のアイデアを皆さんと共有したいと思います。</font><font style="vertical-align: inherit;">これまでのところ、それらを実装していませんが、将来的には実装する可能性があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントとシステムの動的な数</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンポーネントとシステムの最大数をテンプレートパラメータの形式で事前に示すのは不便です。</font><font style="vertical-align: inherit;">私はそれを交換することが可能になると思う</font></font><code>std::array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><code>std::vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスの強い減少なし。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、</font></font><code>std::bitset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイル時にビット数を知る必要があります。</font><font style="vertical-align: inherit;">今のところ、私は置き換えることで、この問題を修正すると思って</font></font><code>std::vector&lt;bitset&lt;ComponentCount&gt;&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font></font><code>EntityContainer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><code>std::vector&lt;char&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、すべてのエンティティのビットセットを表すのに十分なバイトを割り当てます。</font><font style="vertical-align: inherit;">次に</font></font><code>BitsetView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ビットのセットの最初と最後へのポインタのペアを入力で受け取る</font><font style="vertical-align: inherit;">軽量クラスを実装</font><font style="vertical-align: inherit;">し</font></font><code>std::bitset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、このメモリ範囲で</font><font style="vertical-align: inherit;">必要なすべての操作を実行し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のアイデア：ビットセットを使用せず</font></font><code>mEntityToComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、エンティティにコンポーネントがあるかどうかを</font><font style="vertical-align: inherit;">確認するだけ</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡略化されたコンポーネントの反復</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現時点では、システムが処理するエンティティのコンポーネントを繰り返し処理したい場合は、次のようにする必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; entity : getManagedEntities())<font></font>
{<font></font>
    <span class="hljs-keyword">auto</span> [position, velocity] = mEntityManager.getComponents&lt;Position, Velocity&gt;(entity);<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようなことができれば、よりきれいで簡単になります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; [position, velocity] : mEntityManager.getComponents&lt;Position, Velocity&gt;(mManagedEntities))<font></font>
{<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><code>std::view::transform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ 20の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">範囲ライブラリ</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
と、これを実装するのが簡単になります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、まだありません。</font><font style="vertical-align: inherit;">Eric Niblerの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rangeライブラリーを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用することもできます</font><font style="vertical-align: inherit;">が、依存関係を追加したくありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解決策</font></font><code>EntityRangeView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、テンプレートパラメータとして受け取る必要があるコンポーネントのタイプを受け取る</font><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">と、コンストラクタパラメータとして</font></font><code>std::vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンティティ</font><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">を実装する</font><font style="vertical-align: inherit;">ことです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に</font></font><code>begin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">を実現</font></font><code>end</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、イテレータタイプを使用して目的の動作を実現するだけで済みます。</font><font style="vertical-align: inherit;">それほど難しくはありませんが、書くのに少し時間がかかります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント管理の最適化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在の実装では、エンティティにコンポーネントを追加または削除するときに、</font></font><code>onEntityUpdated</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのシステム</font><font style="vertical-align: inherit;">を呼び出し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">多くのシステムは、変更されたばかりのコンポーネントのタイプに関心がないため、これは少し非効率的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
損傷を最小限に抑えるために、指定されたタイプのコンポーネントに関連するシステムへのポインタをデータ構造に格納できます</font></font><code>std::array&lt;std::vector&lt;System&lt;ComponentCount, SystemCount&gt;&gt;, ComponentCount&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、コンポーネントを追加または削除するときに</font></font><code>onEntityUpdated</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、このコンポーネントに関連するシステム</font><font style="vertical-align: inherit;">のメソッドを呼び出すだけ</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムではなくエンティティマネージャによって管理されるエンティティのサブセット</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の最後のアイデアは、ライブラリの構造をより広範囲に変更することになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンティティのセットを管理するシステムの代わりに、エンティティマネージャがこれを行います。</font><font style="vertical-align: inherit;">このようなスキームの利点は、2つのシステムが同じコンポーネントのセットに関心がある場合、これらの要件を満たすエンティティのサブセットを複製しないことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムは、単に要件をエンティティマネージャに宣言することができます。</font><font style="vertical-align: inherit;">次に、エンティティマネージャーはエンティティのすべての異なるサブセットを保存します。</font><font style="vertical-align: inherit;">最後に、システムは同様の構文を使用してエンティティをクエリします。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; entity : mEntityManager.getEntitiesWith&lt;Position, Velocity&gt;())<font></font>
{<font></font>
    ...<font></font>
}</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、私のエンティティコンポーネントシステムの実装に関する記事の終わりです。</font><font style="vertical-align: inherit;">他に改善を加えたら、将来新しい記事を書くかもしれません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事で説明する実装は非常に単純です。500行未満のコードで構成されており、パフォーマンスも優れています。</font><font style="vertical-align: inherit;">すべてのトランザクションは、（償却された）一定の時間で実現されます。</font><font style="vertical-align: inherit;">さらに、実際には、キャッシュを最適に使用し、非常に迅速にエンティティーを取得して反復します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事がおもしろかったか、役に立ったと思います。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加の読書</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、entity-component-systemパターンのより詳細な調査に役立つリソースです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミシェルKayney、著者の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENTTは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、と呼ばれるエンティティコンポーネント・システム上の記事の非常に興味深い一連の書き込み</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECSの前後にを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entity Systems Wikiに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、非常に役立つ情報とリンクが含まれています。</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja459264/index.html">Tarantoolネットワークから抜け出す。トラフィックをフィルタリングする際のノードの同期</a></li>
<li><a href="../ja459272/index.html">Reactコンポーネント用のAPIを作成する、パート1：競合する小道具を作成しない</a></li>
<li><a href="../ja459274/index.html">Astra Linux Special Edition（スモレンスク）の画面ロックの脆弱性</a></li>
<li><a href="../ja459276/index.html">エピックフェイルレジスタンス2、またはFireFoxプラグインでプライバシーに関与すべきでない理由</a></li>
<li><a href="../ja459286/index.html">セミメタルテルル化タングステン-ナノテクノロジーの日のスイスナイフ</a></li>
<li><a href="../ja459292/index.html">モバイルアプリケーションテストの自動化：ツールの比較</a></li>
<li><a href="../ja459294/index.html">さらに重要なことは、プログラミング言語を知っているか、ビジネス上の問題を解決できるかです。</a></li>
<li><a href="../ja459296/index.html">JavaScript価格2019</a></li>
<li><a href="../ja459298/index.html">Angular：2019年のステータス</a></li>
<li><a href="../ja459300/index.html">Quasar 1.0：Vue開発者にとってだけでなく、Vue開発者にとっても新しい便利なツール</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>