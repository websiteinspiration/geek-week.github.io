<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💧 🕚 👩🏽‍🤝‍👩🏻 本当にスマートな検索を行う：ステップバイステップガイド 🏜️ 🐤 ☣️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="企業情報システムで検索 -すでにこのフレーズ自体から口から出られなくなっています。1つでもあれば、良いユーザーエクスペリエンスについて考える必要もありません。検索エンジンによって甘やかされて育ったユーザーの態度を逆転させて、速くて正確で完全に理解できる製品を作る方法は？少数のインテリジェントサービス...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>本当にスマートな検索を行う：ステップバイステップガイド</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/directum/blog/460263/"><p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企業情報システムで検索</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -すでにこのフレーズ自体から口から出られなくなっています。</font><font style="vertical-align: inherit;">1つでもあれば、良いユーザーエクスペリエンスについて考える必要もありません。</font><font style="vertical-align: inherit;">検索エンジンによって甘やかされて育ったユーザーの態度を逆転させて、速くて正確で完全に理解できる製品を作る方法は？</font><font style="vertical-align: inherit;">少数のインテリジェントサービスであるElasticsearchの優れた部分を取得し、このガイドで練り上げる必要があります。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearchに基づく全文検索を既存のデータベースに固定する方法に関する記事はたくさんあります。</font><font style="vertical-align: inherit;">しかし、本当にスマートな検索を行う方法についての記事は明らかに十分ではありません。</font></font></p><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同時に、「スマート検索」というフレーズ自体はすでに流行語になっており、その場所では使用されていますが、使用されていません。</font><font style="vertical-align: inherit;">それでは、検索エンジンがスマートと見なされるようにするにはどうすればよいでしょうか。</font><font style="vertical-align: inherit;">結局、これは、この結果が要求のテキストに完全に対応していなくても、ユーザーが実際に必要とする結果を提供するものとして説明できます。</font><font style="vertical-align: inherit;">GoogleやYandexなどの人気のある検索エンジンはさらに進んで、必要な情報を見つけるだけでなく、ユーザーの質問に直接回答します。</font></font></blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">わかりました、最後の決定をすぐに一掃することはしませんが、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の全文検索をより</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スマートな</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">検索に近づけるために</font><font style="vertical-align: inherit;">何ができる</font><font style="vertical-align: inherit;">でしょうか？</font></font></p><a name="habracut"></a><br>
<h2 id="elementy-intellektualnosti"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知性の要素</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スマート検索-これは、量が品質に入る可能性があり、多くの小さくてかなり単純な機能が魔法の感覚を形成できる場合にちょうど当てはまります。</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーエラーの修正-タイプミス、不適切なレイアウト、または結果が疑わしいほど少ない数のリクエストであるが、はるかに多くの情報があるリクエストに似ているかどうか。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">後ろに</font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">番目</font></font></del> NLP (natural language processing,   ,   ) —    <em><strong>    </strong></em>,                         ?</li>
<li>        .</li>
<li>  —    ,      ,  .         , , ,            ?</li>
<li> drilldown —        , .</li>
</ul><br>
<h2 id="vvodnaya"></h2><br>
<p> ECM DIRECTUM     .        ,     .</p><br>
<p> —               .</p><br>
<h2 id="indeksirovanie"></h2><br>
<blockquote> -  ,   -   .</blockquote><p>  ECM  ,   ,   ,    ;        .<br>
     Elasticsearch    .  ,  ECM      ,           .</p><br>
<h3 id="otobrazhenie-dokumentov-ecm-na-dokumenty-elasticsearch">  ECM   Elasticsearch</h3><br>
<p>   ECM    .  Elasticsearch        nested-,        —   ,        ,           (    —   ).       ECM    Elasticsearch   ,   .</p><br>
<p>      Elasticsearch    ,     :</p><br>
<ul>
<li>    ,    , —     ;</li>
<li>    —   ;</li>
<li>  .</li>
</ul><br>
<h3 id="sostav-indeksov"> </h3><br>
<p>,    .           Elasticsearch          -  ,  .     /       .        ,         .</p><br>
<p> —        ,      Elasticsearch  2 :</p><br>
<ul>
<li> .       ,   —  (    ),   —     (   ).             ,      .            .</li>
</ul><br>
<blockquote> —   .           .   ,       .<br>
 —  ,      ()  .</blockquote><br>
<ul>
<li>  .      ES       ( ,   )       ( ,   ). ,       ,      ,    ,         ,   .</li>
</ul><br>
<p>     ,       , (-     ) —      «» .</p><br>
<p>              .</p><br>
<p>  ,   ,               : - (  -), -, -, -  .. </p><br>
<p>      ,    — Elasticsearch   ,     ,     .       ,        ,      ,            .</p><br>
<h3 id="struktura-indeksov"> </h3><br>
<p>      ( multi-fields): default       custom   :</p><br>
<pre><code class="json hljs"><span class="hljs-string">"ru_en_analyzer"</span>: {
    <span class="hljs-attr">"filter"</span>: [
        <span class="hljs-string">"lowercase"</span>,
        <span class="hljs-string">"russian_morphology"</span>,
        <span class="hljs-string">"english_morphology"</span>,
        <span class="hljs-string">"word_delimiter"</span>,
        <span class="hljs-string">"ru_en_stopwords"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"char_filter"</span>: [
        <span class="hljs-string">"yo_filter"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"custom"</span>,
    <span class="hljs-attr">"tokenizer"</span>: <span class="hljs-string">"standard"</span>}</code></pre><br>
<p>  lowercase  ,   . </p><br>
<p> russian_morphology  english_morphology         .      Elasticsearch       analysis-morphology.  ,           , ,      .</p><br>
<pre><code class="json hljs">POST _analyze<font></font>
{<font></font>
    <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"russian"</span>, 
    <span class="hljs-attr">"text"</span>: <span class="hljs-string">"   "</span><font></font>
}<font></font>
&gt;&gt;   </code></pre><br>
<p>:</p><br>
<pre><code class="json hljs">POST _analyze<font></font>
{<font></font>
    <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ru_en_analyzer"</span>, 
    <span class="hljs-attr">"text"</span>: <span class="hljs-string">"   "</span><font></font>
}<font></font>
&gt;&gt;   </code></pre><br>
<p>   word_delimiter. , ,   ,     .   :</p><br>
<pre><code class="json hljs"><span class="hljs-string">"word_delimiter"</span>: {
    <span class="hljs-attr">"catenate_all"</span>: <span class="hljs-string">"true"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"word_delimiter"</span>,
    <span class="hljs-attr">"preserve_original"</span>: <span class="hljs-string">"true"</span>
}</code></pre><br>
<p>yo_filter     E  :</p><br>
<pre><code class="json hljs"><span class="hljs-string">"yo_filter"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"mapping"</span>,
    <span class="hljs-attr">"mappings"</span>: [
        <span class="hljs-string">" =&gt; "</span>,
        <span class="hljs-string">" =&gt; "</span><font></font>
    ]<font></font>
}</code></pre><br>
<p>ru_en_stopwords    stop —   -.</p><br>
<h3 id="process-indeksirovaniya"> </h3><br>
<p>   ECM — ,  ,   : .docx, .pdf  ..      ingest-attachment   pipeline:</p><br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"document_version"</span>: {
        <span class="hljs-attr">"processors"</span>: [<font></font>
            {<font></font>
                <span class="hljs-attr">"attachment"</span>: {
                    <span class="hljs-attr">"field"</span>: <span class="hljs-string">"content"</span>,
                    <span class="hljs-attr">"target_field"</span>: <span class="hljs-string">"attachment"</span>,
                    <span class="hljs-attr">"properties"</span>: [ <span class="hljs-string">"content"</span>, <span class="hljs-string">"content_length"</span>, <span class="hljs-string">"content_type"</span>, <span class="hljs-string">"language"</span> ],
                    <span class="hljs-attr">"indexed_chars"</span>: <span class="hljs-number">-1</span>,
                    <span class="hljs-attr">"ignore_failure"</span>: <span class="hljs-literal">true</span><font></font>
                }<font></font>
            },<font></font>
            {<font></font>
                <span class="hljs-attr">"remove"</span>: {
                    <span class="hljs-attr">"field"</span>: <span class="hljs-string">"content"</span>,
                    <span class="hljs-attr">"ignore_failure"</span>: <span class="hljs-literal">true</span><font></font>
                }<font></font>
            },<font></font>
            {<font></font>
                <span class="hljs-attr">"script"</span>: {
                    <span class="hljs-attr">"lang"</span>: <span class="hljs-string">"painless"</span>,
                    <span class="hljs-attr">"params"</span>: {
                        <span class="hljs-attr">"languages"</span>: [<span class="hljs-string">"ru"</span>, <span class="hljs-string">"en"</span> ],
                        <span class="hljs-attr">"language_delimeter"</span>: <span class="hljs-string">"_"</span><font></font>
                    },<font></font>
                    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"..."</span><font></font>
                }<font></font>
            },<font></font>
            {<font></font>
                <span class="hljs-attr">"remove"</span>: {
                    <span class="hljs-attr">"field"</span>: <span class="hljs-string">"attachment"</span>,
                    <span class="hljs-attr">"ignore_failure"</span>: <span class="hljs-literal">true</span><font></font>
                }<font></font>
            }<font></font>
        ]<font></font>
    }<font></font>
}</code></pre><br>
<p>   pipeline —     (    )    ,    .    painless-,     , .. -  JSON      .     (  —     )      painful.</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ctx.attachment != <span class="hljs-literal">null</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">params</span>.languages.contains(ctx.attachment.language))<font></font>
        ctx._index = ctx._index + <span class="hljs-keyword">params</span>.language_delimeter + ctx.attachment.language;
    <span class="hljs-keyword">if</span> (ctx.attachment.content != <span class="hljs-literal">null</span>)<font></font>
        ctx.content = ctx.attachment.content;<font></font>
    <span class="hljs-keyword">if</span> (ctx.attachment.content_length != <span class="hljs-literal">null</span>)<font></font>
        ctx.content_length = ctx.attachment.content_length;<font></font>
    <span class="hljs-keyword">if</span> (ctx.attachment.content_type != <span class="hljs-literal">null</span>)<font></font>
        ctx.content_type = ctx.attachment.content_type;<font></font>
    <span class="hljs-keyword">if</span> (ctx.attachment.language != <span class="hljs-literal">null</span>)<font></font>
        ctx.language = ctx.attachment.language; <font></font>
}</code></pre><br>
<p> ,      <em>index_name</em>.       ,       ,    <em>index_name_language</em>.</p><br>
<p>      ,   _source , ..         .</p><br>
<p>       ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Update By Query API</a>  pipeline.  , -,        ECM,  -,      Elasticsearch —        ,   .</p><br>
<blockquote>     Elasticsearch  ,        ,     .</blockquote><p>    ,         .    <em></em>      .</p><br>
<h2 id="poisk"></h2><br>
<p>      </p><br>
<p><img src="https://habrastorage.org/webt/ni/l4/xm/nil4xm-qrg7meikrjbd16mt_ziq.png"></p><br>
<h3 id="polnotekst"></h3><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Simple Query String Query</a>:</p><br>
<pre><code class="json hljs"><span class="hljs-string">"simple_query_string"</span>: {
    <span class="hljs-attr">"fields"</span>: [
        <span class="hljs-string">"card.d*.*_text"</span>,
        <span class="hljs-string">"card.d*.*_text.exact"</span>,
        <span class="hljs-string">"card.name^2"</span>,
        <span class="hljs-string">"card.name.exact^2"</span>,
        <span class="hljs-string">"content"</span>,
        <span class="hljs-string">"content.exact"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"query"</span>: <span class="hljs-string">" "</span>,
    <span class="hljs-attr">"default_operator"</span>: <span class="hljs-string">"or"</span>,
    <span class="hljs-attr">"analyze_wildcard"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"-35%"</span>,
    <span class="hljs-attr">"quote_field_suffix"</span>: <span class="hljs-string">".exact"</span>
}</code></pre><br>
<p> <em>.exact</em> —  ,  <em>default</em> .          .  <code>"default_operator": "or"</code>  <code>"minimum_should_match": "-35%"</code>        35%  .</p><br>
<h3 id="sinonimy"></h3><br>
<p>       ,      —         :</p><br>
<pre><code class="json hljs"><span class="hljs-string">"search_analyzer"</span>: {
    <span class="hljs-attr">"filter"</span>: [
        <span class="hljs-string">"lowercase"</span>,
        <span class="hljs-string">"russian_morphology"</span>,
        <span class="hljs-string">"english_morphology"</span>,
        <span class="hljs-string">"synonym_filter"</span>,
        <span class="hljs-string">"word_delimiter"</span>,
        <span class="hljs-string">"ru_en_stopwords"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"char_filter"</span>: [
        <span class="hljs-string">"yo_filter"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"tokenizer"</span>: <span class="hljs-string">"standard"</span>
}</code></pre><br>
<pre><code class="json hljs"><span class="hljs-string">"synonym_filter"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"synonym_graph"</span>,
    <span class="hljs-attr">"synonyms_path"</span>: <span class="hljs-string">"synonyms.txt"</span>
}</code></pre><br>
<h3 id="uchyot-prav"> </h3><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Bool Query</a>,   :</p><br>
<pre><code class="json hljs"><span class="hljs-string">"bool"</span>: {
    <span class="hljs-attr">"must"</span>: [<font></font>
        {<font></font>
            <span class="hljs-attr">"simple_query_string"</span>: {...}<font></font>
        }<font></font>
    ],<font></font>
    <span class="hljs-attr">"filter"</span>: [<font></font>
        {<font></font>
            <span class="hljs-attr">"terms"</span>: {
                <span class="hljs-attr">"rights"</span>: [           ]<font></font>
            }<font></font>
        }<font></font>
    ]<font></font>
}</code></pre><br>
<p>     ,         ,    .         —    .</p><br>
<h3 id="tyuning-relevantnosti"> </h3><br>
<p>  Elasticsearch      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">BM25</a>,     .  ,             :</p><br>
<ul>
<li>    —      ,   ,     ;</li>
<li>    —  ,  ,    ;</li>
<li><p>    ECM    : ,   . ,    .</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Function Score Query</a>:</p><br>
<pre><code class="json hljs"><span class="hljs-string">"function_score"</span>: {
<span class="hljs-attr">"functions"</span>: [<font></font>
    {<font></font>
        <span class="hljs-attr">"gauss"</span>: {
            <span class="hljs-attr">"modified_date"</span>: {
            <span class="hljs-attr">"origin"</span>: <span class="hljs-string">"now"</span>,
            <span class="hljs-attr">"scale"</span>: <span class="hljs-string">"1095d"</span>,
            <span class="hljs-attr">"offset"</span>: <span class="hljs-string">"31d"</span>,
            <span class="hljs-attr">"decay"</span>: <span class="hljs-number">0.5</span><font></font>
            }<font></font>
        }<font></font>
    },<font></font>
    {<font></font>
        <span class="hljs-attr">"field_value_factor"</span>: {
            <span class="hljs-attr">"field"</span>: <span class="hljs-string">"access_count"</span>,
            <span class="hljs-attr">"missing"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">"modifier"</span>: <span class="hljs-string">"log2p"</span><font></font>
        }<font></font>
    },<font></font>
    {<font></font>
        <span class="hljs-attr">"filter"</span>: {
            <span class="hljs-attr">"term"</span>: {
                <span class="hljs-attr">"life_stage_value_id"</span>: {
                    <span class="hljs-attr">"value"</span>: <span class="hljs-string">""</span><font></font>
                }<font></font>
            }<font></font>
        },<font></font>
        <span class="hljs-attr">"weight"</span>: <span class="hljs-number">1.1</span><font></font>
    }<font></font>
],<font></font>
<span class="hljs-attr">"query"</span>: {
    <span class="hljs-attr">"bool"</span>: {...}<font></font>
}<font></font>
}</code></pre><br>
<p> ,   ,             X    Y:</p><br>
</li>
</ul><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/wa/wz/td/wawztd9zvlz-fetkplnfrjw8ddy.png"></a></div><p></p><br>
<h3 id="vneshniy-intellekt"> </h3><br>
<p>            <em></em>:      (, ,   ..),  ,     ..</p><br>
<p>      , ,   ,  ,   ..</p><br>
<p>      ECM — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">DIRECTUM Ario</a>.</p><br>
<h3 id="process-umnogo-poiska">  </h3><br>
<p>   ,     .</p><br>
<h4 id="ispravlenie-oshibok-polzovatelya">  </h4><br>
<p>         —   ,             .      , , -,     :</p><br>
<p><img src="https://habrastorage.org/webt/ek/ow/c5/ekowc5ikjiwx1xe87b5wewhoohm.png"></p><br>
<p> -,       :</p><br>
<p><img src="https://habrastorage.org/webt/ug/dr/tc/ugdrtchejvx024datttkc_zcxxw.png"></p><br>
<p>        ,      . </p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Phrase Suggester</a>.     —       ,  suggest    ,            .  <em></em>  confidence = 0,   suggest       . ,     "<strong></strong>"    : <em>,   <strong></strong>?</em></p><br>
<p>  ,    suggester'  :</p><br>
<pre><code class="json hljs"><span class="hljs-string">"suggest"</span>: {
    <span class="hljs-attr">"content_suggest"</span>: {
        <span class="hljs-attr">"text"</span>: <span class="hljs-string">" "</span>,
        <span class="hljs-attr">"phrase"</span>: {
            <span class="hljs-attr">"collate"</span>: {
                <span class="hljs-attr">"query"</span>: {         {{suggestion}} }<font></font>
            },<font></font>
        }<font></font>
    },<font></font>
    <span class="hljs-string">"check_suggest"</span>: {
        <span class="hljs-attr">"text"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-attr">"phrase"</span>: {
            <span class="hljs-attr">"collate"</span>: {
                <span class="hljs-attr">"query"</span>: {         {{suggestion}} - ({{source_query}}) },
                <span class="hljs-string">"params"</span>: {
                    <span class="hljs-attr">"source_query"</span>: <span class="hljs-string">" "</span><font></font>
                }<font></font>
            },<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>   </p><br>
<pre><code class="json hljs"><span class="hljs-string">"confidence"</span>: <span class="hljs-number">0.0</span>,
<span class="hljs-string">"max_errors"</span>: <span class="hljs-number">3.0</span>,
<span class="hljs-string">"size"</span>: <span class="hljs-number">1</span></code></pre><br>
<p>  suggester  ,   ,    —   ,      ,     .  ,   - ,      .          ,    ( Hunspell)  . </p><br>
<p>      0 ,          :</p><br>
<p><img src="https://habrastorage.org/webt/up/r3/wx/upr3wxky4mkbeyy3exjocbwzocy.png"></p><br>
<p>           :</p><br>
<p><img src="https://habrastorage.org/webt/qv/ts/4t/qvts4tauspo9yspwy_itbzcdttq.png"></p><br>
<h4 id="klassifikaciya-zaprosov-i-izvlechenie-faktov">    </h4><br>
<p>   ,   DIRECTUM Ario,         .           ,   .       ,     ,             .       ,     . ,  <em><strong>  </strong></em>   <strong></strong>    ,    <strong> </strong> —  .   <em><strong>   </strong></em>        .</p><br>
<p>   —  ,    ,       .</p><br>
<h4 id="avtodopolnenie-vvoda"> </h4><br>
<p>    ,          .</p><br>
<p><img src="https://habrastorage.org/webt/zc/52/yo/zc52yohihrkkrnny6ekla80-mro.png"></p><br>
<p>      Suggester' — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Completion Suggester</a>,      .</p><br>
<h5 id="avtodopolnenie-istoriya-poiskov">:  </h5><br>
<p>  ECM  ,    ,         <del>  </del>   .       -  .  Completion Suggester         ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Context Suggester</a> —              .       ,       .</p><br>
<p>      ,    .            .        ,  , :</p><br>
<pre><code class="json hljs"><span class="hljs-string">"mappings"</span>: {
    <span class="hljs-attr">"document"</span>: {
        <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"input"</span>: {
                <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"suggest"</span>: {
                <span class="hljs-attr">"type"</span>: <span class="hljs-string">"completion"</span>,
                <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"simple"</span>,
                <span class="hljs-attr">"preserve_separators"</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">"preserve_position_increments"</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">"max_input_length"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-attr">"contexts"</span>: [<font></font>
                    {<font></font>
                        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"user"</span>,
                        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CATEGORY"</span><font></font>
                    }<font></font>
                ]<font></font>
            },<font></font>
            <span class="hljs-attr">"user"</span>: {
                <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>                <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Update By Query API</a>     <code>ctx._source.suggest.weight++</code>.</p><br>
<h5 id="avtodopolnenie-dokumenty">: </h5><br>
<p>           .   , ,        ,     .          .  ,     ,     :</p><br>
<p> — Completion Suggester    ,        ,  - <code>.01.01   </code>     <em><strong> </strong></em>  .            n-:</p><br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"extension"</span>: <span class="hljs-string">"pdf"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">".01.01   "</span>,
    <span class="hljs-attr">"suggest"</span>: [<font></font>
        {<font></font>
            <span class="hljs-attr">"input"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-attr">"weight"</span>: <span class="hljs-number">70</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-attr">"input"</span>: <span class="hljs-string">" "</span>,
            <span class="hljs-attr">"weight"</span>: <span class="hljs-number">80</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-attr">"input"</span>: <span class="hljs-string">"  "</span>,
            <span class="hljs-attr">"weight"</span>: <span class="hljs-number">90</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-attr">"input"</span>: <span class="hljs-string">".01.01   "</span>,
            <span class="hljs-attr">"weight"</span>: <span class="hljs-number">100</span><font></font>
        }<font></font>
    ]<font></font>
}</code></pre><br>
<p>      ,              ,   - . <em></em>.</p><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bi/rc/dv/bircdvzu2hvcblxhrryvauzajf0.png"></div><br>
<p> —     ,            ,        .       gauss  field_value_factor,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Function Score Query</a>.</p><br>
<p>   pipeline:</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"dir_public_documents_pipeline"</span>: {
    <span class="hljs-attr">"processors"</span>: [<font></font>
      ...<font></font>
      {<font></font>
        <span class="hljs-attr">"set"</span>: {
            <span class="hljs-attr">"field"</span>: <span class="hljs-string">"terms_array"</span>,
            <span class="hljs-attr">"value"</span>: <span class="hljs-string">"{{name}}"</span><font></font>
        }<font></font>
      },<font></font>
      {<font></font>
        <span class="hljs-attr">"split"</span>: {
            <span class="hljs-attr">"field"</span>: <span class="hljs-string">"terms_array"</span>,
            <span class="hljs-attr">"separator"</span>: <span class="hljs-string">"\\s+|$"</span><font></font>
        }<font></font>
      },<font></font>
      {<font></font>
        <span class="hljs-attr">"script"</span>: {
            <span class="hljs-attr">"source"</span>: <span class="hljs-string">"..."</span><font></font>
        }<font></font>
      }<font></font>
    ]<font></font>
  }<font></font>
} </code></pre><br>
<p>  :</p><br>
<pre><code class="cs hljs">Date modified = <span class="hljs-keyword">new</span> Date(<span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (ctx.modified_date != <span class="hljs-literal">null</span>)<font></font>
  modified = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">'dd.MM.yyyy'</span>).parse(ctx.modified_date);
<span class="hljs-keyword">long</span> dayCount = (System.currentTimeMillis() - modified.getTime())/(<span class="hljs-number">1000</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>*<span class="hljs-number">24</span>);
<span class="hljs-keyword">double</span> score = Math.exp((<span class="hljs-number">-0.7</span>*Math.max(<span class="hljs-number">0</span>, dayCount - <span class="hljs-number">31</span>))/<span class="hljs-number">1095</span>) * Math.log10(ctx.access_count + <span class="hljs-number">2</span>);
<span class="hljs-keyword">int</span> count = ctx.terms_array.length;<font></font>
ctx.suggest = <span class="hljs-keyword">new</span> ArrayList();<font></font>
ctx.suggest.<span class="hljs-keyword">add</span>([
    <span class="hljs-string">'input'</span>: ctx.terms_array[count - <span class="hljs-number">1</span>], 
    <span class="hljs-string">'weight'</span>: Math.round(score * (<span class="hljs-number">255</span> - count + <span class="hljs-number">1</span>))<font></font>
    ]);<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = count - <span class="hljs-number">2</span>; i &gt;= <span class="hljs-number">0</span> ; --i)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ctx.terms_array[i].trim() != <span class="hljs-string">""</span>)<font></font>
  {<font></font>
    ctx.suggest.<span class="hljs-keyword">add</span>([
      <span class="hljs-string">"input"</span>: ctx.terms_array[i] + <span class="hljs-string">" "</span> + ctx.suggest[ctx.suggest.length - <span class="hljs-number">1</span>].input,
      <span class="hljs-string">"weight"</span>: Math.round(score * (<span class="hljs-number">255</span> - i))]);<font></font>
  }<font></font>
}<font></font>
ctx.<span class="hljs-keyword">remove</span>(<span class="hljs-string">'terms_array'</span>);<font></font>
ctx.<span class="hljs-keyword">remove</span>(<span class="hljs-string">'access_count'</span>);<font></font>
ctx.<span class="hljs-keyword">remove</span>(<span class="hljs-string">'modified_date'</span>);</code></pre><br>
<p>   pipeline  painless  ,       ?      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Reindex API</a>          (   , )    .</p><br>
<p>       ,        .</p><br>
<h3 id="otobrazhenie-rezultatov"> </h3><br>
<h4 id="kategorii"></h4><br>
<p> ,         .     <em> </em>      .</p><br>
<h4 id="fasety"></h4><br>
<p> —      ,  ,   ,    .    :</p><br>
<ol>
<li><p>     ,        .   ?</p><br>
</li>
<li><p>           ,       :</p><br>
</li>
</ol><br>
<p><img src="https://habrastorage.org/webt/60/ei/g6/60eig601ltskcwvcesh5zno8crc.png"></p><br>
<ol>
<li>      ,       <em></em>   0       :</li>
</ol><br>
<p><img src="https://habrastorage.org/webt/mu/6u/e-/mu6ue-ybxh3sa9h6ymkj1idn_ti.png"></p><br>
<p>      ,                 .</p><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zd/jt/zu/zdjtzudyw9iei8x-tjarja-a5tm.jpeg"></div><br>
<p>  ,   :</p><br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"><pre><code class="json hljs">{<font></font>
    ...<font></font>
    <span class="hljs-attr">"post_filter"</span>: {
        <span class="hljs-attr">"bool"</span>: {
            <span class="hljs-attr">"must"</span>: [<font></font>
                {<font></font>
                    <span class="hljs-attr">"terms"</span>: {
                        <span class="hljs-attr">"card.author_value_id"</span>: [
                            <span class="hljs-string">"1951063"</span><font></font>
                        ]<font></font>
                    }<font></font>
                },<font></font>
                {<font></font>
                    <span class="hljs-attr">"terms"</span>: {
                        <span class="hljs-attr">"editor_value_id"</span>: [
                            <span class="hljs-string">"2337706"</span>,
                            <span class="hljs-string">"300643"</span><font></font>
                        ]<font></font>
                    }<font></font>
                }<font></font>
            ]<font></font>
        }<font></font>
    },<font></font>
    <span class="hljs-attr">"query"</span>: {...}
    <span class="hljs-string">"aggs"</span>: {
        <span class="hljs-attr">"card.author_value_id"</span>: {
            <span class="hljs-attr">"filter"</span>: {
                <span class="hljs-attr">"terms"</span>: {
                    <span class="hljs-attr">"editor_value_id"</span>: [
                        <span class="hljs-string">"2337706"</span>,
                        <span class="hljs-string">"300643"</span><font></font>
                    ]<font></font>
                }<font></font>
            },<font></font>
            <span class="hljs-attr">"aggs"</span>: {
                <span class="hljs-attr">"card.author_value_id"</span>: {
                    <span class="hljs-attr">"terms"</span>: {
                        <span class="hljs-attr">"field"</span>: <span class="hljs-string">"card.author_value_id"</span>,
                        <span class="hljs-attr">"size"</span>: <span class="hljs-number">11</span>,
                        <span class="hljs-attr">"exclude"</span>: [
                            <span class="hljs-string">"1951063"</span><font></font>
                        ],<font></font>
                        <span class="hljs-attr">"missing"</span>: <span class="hljs-string">""</span><font></font>
                    }<font></font>
                },<font></font>
                <span class="hljs-attr">"card.author_value_id_selected"</span>: {
                    <span class="hljs-attr">"terms"</span>: {
                        <span class="hljs-attr">"field"</span>: <span class="hljs-string">"card.author_value_id"</span>,
                        <span class="hljs-attr">"size"</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-attr">"include"</span>: [
                        <span class="hljs-string">"1951063"</span><font></font>
                        ],<font></font>
                        <span class="hljs-attr">"missing"</span>: <span class="hljs-string">""</span><font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
        },<font></font>
...<font></font>
        <span class="hljs-attr">"editor_value_id"</span>: {
            <span class="hljs-attr">"filter"</span>: {
                <span class="hljs-attr">"terms"</span>: {
                    <span class="hljs-attr">"card.author_value_id"</span>: [
                        <span class="hljs-string">"1951063"</span><font></font>
                    ]<font></font>
                }<font></font>
            },<font></font>
            <span class="hljs-attr">"aggs"</span>: {
                <span class="hljs-attr">"editor_value_id"</span>: {
                    <span class="hljs-attr">"terms"</span>: {
                        <span class="hljs-attr">"field"</span>: <span class="hljs-string">"editor_value_id"</span>,
                        <span class="hljs-attr">"size"</span>: <span class="hljs-number">11</span>,
                        <span class="hljs-attr">"exclude"</span>: [
                            <span class="hljs-string">"2337706"</span>,
                            <span class="hljs-string">"300643"</span><font></font>
                        ],<font></font>
                        <span class="hljs-attr">"missing"</span>: <span class="hljs-string">""</span><font></font>
                    }<font></font>
                },<font></font>
                <span class="hljs-attr">"editor_value_id_selected"</span>: {
                    <span class="hljs-attr">"terms"</span>: {
                        <span class="hljs-attr">"field"</span>: <span class="hljs-string">"editor_value_id"</span>,
                        <span class="hljs-attr">"size"</span>: <span class="hljs-number">2</span>,
                        <span class="hljs-attr">"include"</span>: [
                            <span class="hljs-string">"2337706"</span>,
                            <span class="hljs-string">"300643"</span><font></font>
                        ],<font></font>
                        <span class="hljs-attr">"missing"</span>: <span class="hljs-string">""</span><font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
        },<font></font>
...<font></font>
  }<font></font>
}</code></pre></div></div><br>
<p>  :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">post_filter</a>               .    .        .</li>
<li>  ,   — <em>card.author_value_id</em>  <em>editor_value_id</em>.   :<br>
<ul>
<li>     ,  ;</li>
<li>      — <em>  </em>;</li>
<li>     .  -10,   -11 —  ,     <strong> </strong>.</li>
</ul></li>
</ul><br>
<h4 id="snippety"></h4><br>
<p>        -, ,         </p><br>
<p><strong></strong>:</p><br>
<p><img src="https://habrastorage.org/webt/ka/_b/ia/ka_biaaygfgbsk2msyfhu-bnkse.png"></p><br>
<p> <strong></strong>:</p><br>
<p><img src="https://habrastorage.org/webt/5i/po/k_/5ipok_qgkc9170ucyidespnnitc.png"></p><br>
<p> ,           ?</p><br>
<p><img src="https://habrastorage.org/webt/-i/7z/g7/-i7zg7dwh7kbs9e9_2yk3fnxc6k.png"></p><br>
<p>        (  ),  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Source filtering</a>:</p><br>
<pre><code class="json hljs">{<font></font>
    ...<font></font>
    <span class="hljs-attr">"_source"</span>: {
        <span class="hljs-attr">"includes"</span>: [
            <span class="hljs-string">"id"</span>,
            <span class="hljs-string">"card.name"</span>,
            <span class="hljs-string">"card.card_type_value_id"</span>,
            <span class="hljs-string">"card.life_stage_value_id"</span>,
            <span class="hljs-string">"extension"</span>,<font></font>
            ...<font></font>
        ]<font></font>
    },<font></font>
    <span class="hljs-attr">"query"</span>: {...}<font></font>
    ...<font></font>
}</code></pre><br>
<p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Fast Vector highlighter</a> —        ,    — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Unified highlighter</a> —        :</p><br>
<pre><code class="json hljs"><span class="hljs-string">"highlight"</span>: {
    <span class="hljs-attr">"pre_tags"</span>: [
        <span class="hljs-string">"&lt;strong&gt;"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"post_tags"</span>: [
        <span class="hljs-string">"&lt;/strong&gt;"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"encoder"</span>: <span class="hljs-string">"html"</span>,
    <span class="hljs-attr">"fields"</span>: {
        <span class="hljs-attr">"card.name"</span>: {
            <span class="hljs-attr">"number_of_fragments"</span>: <span class="hljs-number">0</span><font></font>
        },<font></font>
        <span class="hljs-attr">"content"</span>: {
            <span class="hljs-attr">"fragment_size"</span>: <span class="hljs-number">300</span>,
            <span class="hljs-attr">"number_of_fragments"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"fvh"</span><font></font>
        }<font></font>
    }<font></font>
},</code></pre><br>
<p>    ,      3   300 . ,  Fast Vector highlighter',         .</p><br>
<h3 id="kollaps"></h3><br>
<p>   ECM ,     <em></em>,     Elasticsearch   <em> </em>.  ,             .         .  ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Field Collapsing</a> —    ,       (    post_filter, <em>  — </em>).  <em></em>      .</p><br>
<pre><code class="json hljs">{<font></font>
  ...<font></font>
  <span class="hljs-attr">"query"</span>: {...}  <font></font>
  ...<font></font>
  <span class="hljs-string">"collapse"</span>: {
    <span class="hljs-attr">"field"</span>: <span class="hljs-string">"id"</span><font></font>
  }<font></font>
}</code></pre><br>
<p> ,     , ,        ,      .  ,  ,     —   <em></em> ,      ,    ,       .</p><br>
<p>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460253/index.html">音声アシスタントのスキルを高める10の理由</a></li>
<li><a href="../ja460255/index.html">Node.jsのバックドア：理由、理由、方法</a></li>
<li><a href="../ja460257/index.html">"こんにちは世界" ターミナルに深く浸る</a></li>
<li><a href="../ja460259/index.html">UIおよびUXデザインとは何ですか？共通点と相違点は何ですか？</a></li>
<li><a href="../ja460261/index.html">アマゾン：25年間のeコマースの成功</a></li>
<li><a href="../ja460265/index.html">Xcodeプロジェクトテンプレートを作成する</a></li>
<li><a href="../ja460273/index.html">最小のApple Payでの承認</a></li>
<li><a href="../ja460275/index.html">完璧なソリューションが必要なのはなぜですか</a></li>
<li><a href="../ja460279/index.html">100億契約：国防総省のクラウドを誰が扱うか</a></li>
<li><a href="../ja460281/index.html">UXライターが製品の改善にどのように役立つか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>