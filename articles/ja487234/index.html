<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👧‍👦 🗄️ 🙍🏻 鉄または最適化？Badoo、Avito、Mamba-PHPのパフォーマンスについて 🏥 👋🏻 ⚽️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="BadooのPHPパフォーマンスの問題は、最も重要なものの1つです。 PHPバックエンドの品質は、開発と運用に費やすリソースの量、サービスの速度、およびユーザーに与える印象に直接依存します。
 
 したがって、私たちのオフィスでのPHP開発者のコ​​ミュニティの第3回会議のトピックでは、バックエンド...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>鉄または最適化？Badoo、Avito、Mamba-PHPのパフォーマンスについて</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/487234/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BadooのPHPパフォーマンスの問題は、最も重要なものの1つです。 PHPバックエンドの品質は、開発と運用に費やすリソースの量、サービスの速度、およびユーザーに与える印象に直接依存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、私たちのオフィスでのPHP開発者のコ​​ミュニティの第3回会議のトピックでは、バックエンドのパフォーマンスを作成し、AvitoとMambaの同僚に議論を依頼しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t-/p7/se/t-p7sef1pbww8vboigkup6ditzu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私がモデレーターになってラッキーだったディスカッションの筆記録をお読みください。3社のインフラストラクチャの配置、生産性の測定方法と注目するメトリック、使用するツール、ハードウェアと最適化の選択方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして2月15日に、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のBadoo PHPミートアップ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に来て</font><font style="vertical-align: inherit;">ください：Legacyについて話し合ってください。</font></font><br>
<a name="habracut"></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kWBm0C9A8oo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは、私たちにとって最も興味深いと思われた議論の一部のみを解読しました。</font><font style="vertical-align: inherit;">フルバージョンはビデオで入手できます。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
専門家：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コアサービスアヴィートの開発部門責任者、セミヨンカタエフ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パベル・ムザコフ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プムザコフ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、BadooのPHP Timlid </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mipxtx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、MambaのITディレクター</font></font></li>
</ul><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたの実践からの最適化についてのストーリーを語ってください：大成功または大失敗は共有するのが面白いものです。 </font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私にはたとえ話があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
約6か月に1回、メトリックを調べて、何が遅くなるか、うまく機能しないか、何を最適化する必要があるかを調べます。</font><font style="vertical-align: inherit;">symfonyの依存関係コンテナに気づいたら、52,000行になりました。</font><font style="vertical-align: inherit;">私たちは、悪党である彼がすべての責任を負うべきであると決定しました：リクエストごとに20ミリ秒のオーバーヘッド。</font><font style="vertical-align: inherit;">見ました。</font><font style="vertical-align: inherit;">減らしました。</font><font style="vertical-align: inherit;">どういうわけかそれを分離しようとしましたが、何も助けにはなりませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、必要なすべての要求を満たすために20のデータベースにアクセスする必要があるスパム対策があることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に来るソリューションは常に正しいものではありません。</font><font style="vertical-align: inherit;">リクエストのトレース、ログ、ベンチマークをよく見て、直接中断しないでください。</font><font style="vertical-align: inherit;">ここに物語があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPにはかなり大きなエコシステムがあるため、定期的に最適化を行っています。</font><font style="vertical-align: inherit;">私たちは成長しており、CPUのレベルに達しています。ハードウェアを購入するか、最適化する必要があることを理解しています。</font><font style="vertical-align: inherit;">各オプションの議論を比較検討し、決定します。</font><font style="vertical-align: inherit;">ほとんどの場合-鉄は多くのことを必要とするため、最適化を支持します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのポイントの1つで、PHPスクリプトでさまざまな最適ではないものを探して最適化することに従事しているグループ全体を選び出しました。</font><font style="vertical-align: inherit;">これは文字通り「ドロップバイドロップ」で起こりました。ここで彼らはパーセンテージを見つけました、そこで彼らはパーセンテージを見つけました-数人が1か月以内にパーセンテージを見つけました。</font><font style="vertical-align: inherit;">ある時点で、私たちのシシュニクは近くにありました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einstein_man</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">彼は何ができるかを確認することにしました。彼は夕方に行ってPerfを起動し、PHP拡張機能にいくつかの問題を発見しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つの話があります。 1つはファイルについて、もう1つはスーパー開発者についてです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
失敗について。 PHPを含む多くのマイクロサービスがあります。誰もがKubernetesで働いています。私はこれらのマイクロサービスの1つに取り組みました。かなりのCPU使用率があり、問題の最適化と発見に1週間を費やしました。開発者の1人が（他の）サービスでコードカバレッジテストを計算するためにベースイメージにXdebugを追加したことがわかりました。その後、本番環境のすべてのマイクロサービスがXdebugで4分間動作しました。四半期後、私たちはこれを発見し、基本的な画像を修正しました-予期しない贈り物を見つけ始めました：私は自分のサービスを再ロールし、それがより速く動作し始めました。デプロイのたびに、サービスイメージが再構築され、Xdebugはなくなりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
成功の歴史。私たちには多くのマイクロサービスがあり、それらはますます増えてきました。この状況では、RPC呼び出しの数が問題になります。たとえば、お知らせカードの場合-これはAvitoで最も頻繁に使用されるページの1つです-ページのレンダリングには約30のマイクロサービスが関与しています。さらに、これらはすべて明示的に行われたわけではありません。ある種の抽象化を呼び出しているようで、その下で他のサービスへの5つのRPC呼び出しが順番に行われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何年にもわたって、発表カードは大幅に機能が低下しています。</font><font style="vertical-align: inherit;">1人の強力な開発者が四半期をかけて戦い、最適化し、すべてのRPC呼び出しを引き出しました。</font><font style="vertical-align: inherit;">これが可能になったとき、Guzzleのマルチリクエストを介してそれらを並列化しました。また、30の連続した同期リクエストの代わりに、同じ30のリクエストを並行して受け取りました。これにより、作業が大幅に加速しました。</font><font style="vertical-align: inherit;">このリファクタリングの後、カードの応答時間は、どのサービスの最大応答時間にも等しくなります。</font><font style="vertical-align: inherit;">しかし、アナウンスメントカードの表示コードを最適化/書き直すには、四半期全体が必要でした。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちに、PHPクラスターのサイズはどのくらいか、どのように構成されているかを教えてください。</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
約15,000 RPSです。</font><font style="vertical-align: inherit;">数年前に購入した80台のFPMサーバーのクラスター。</font><font style="vertical-align: inherit;">各クラスターで、FPM（最大50の子まで）が静的に起動されます。</font><font style="vertical-align: inherit;">それは、プライムタイムのピーク時に約10をロードしました。</font><font style="vertical-align: inherit;">平均応答時間は100ミリ秒であり、それを保持しようとします（100ミリ秒を超えると、ブレーキピースの検索を開始します）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自のパフォーマンス監視システムがあります。</font><font style="vertical-align: inherit;">コード内には、リクエストごとに約120個のカウンターが散在しています。</font><font style="vertical-align: inherit;">PHPのコード内で発生する多くのイベントを監視します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nginx、PHP-FPMなど、すべてが標準です。 FPMを備えた約600台のサーバー。 PHPについて話すとすれば、おそらく、スクリプト、バックオフィスなどのさまざまな目的のために、約300台のサーバーが追加されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成機能には2つあります。まず、BMAプロキシがあります。これはモバイル用のプロキシです。つまり、リクエストがnginxに到着する前に、永続的な接続を保持してリクエストをnginxに送信する特別なプロキシに到達します。 2番目の機能-CLI opcacheをオフにする必要がある場合があります（スクリプトマシンではオンになっています）。一度オフにせず、これでCPUの30％を失いました。彼らは間違いを理解した後、1つの設定でどれだけ節約できるかを驚かせました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPパッチがありますが、パフォーマンスにはほとんど関係ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
競争力のあるAPCuロックにはポイントがあります。同じキーにたくさん書き込む必要がある場合です。</font><font style="vertical-align: inherit;">APCuの内部アーキテクチャは、グローバルキーロックがあり、集中的な記録中にブレーキがかかるように構築されています。</font><font style="vertical-align: inherit;">したがって、この問題を解決するカスタム拡張機能があります。</font><font style="vertical-align: inherit;">これは、応答時間に影響を与えるが、CPU消費には影響しないため、パフォーマンスに部分的にのみ関連しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1分あたり約200万のリクエストがあります（約33 kRPS）。</font><font style="vertical-align: inherit;">PHPで作成されたモノリシックアプリケーションは、11年以上にわたって作成されています。</font><font style="vertical-align: inherit;">それは急速な成長の段階にあります。</font><font style="vertical-align: inherit;">会社が設立されたとき、65台の物理サーバーに65台のLXCがありました。</font><font style="vertical-align: inherit;">アプリケーションを含む各コンテナで、PHP-FPM、nginx、およびメトリックとロギング用の補助ソフトウェアが実行されています。</font><font style="vertical-align: inherit;">特にない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
長年にわたって、モノリスに鉄を追加したことはありません。</font><font style="vertical-align: inherit;">参加者数、広告数、ユーザートランザクション数を増やしており、常に最適化、コードの改善、ソフトウェアの最適化を行っています。</font><font style="vertical-align: inherit;">CPUとメモリの消費量は過去数年間で減少しています。モノリスの65コンテナで十分です。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスをどのように測定しますか？</font><font style="vertical-align: inherit;">クライアントの応答時間を測定するツールは何ですか？</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ログ収集システムがあります。</font><font style="vertical-align: inherit;">FPMの開始からシャットダウン機能までの時間とスクリプトの終了までの2つのインジケーターをログに記録します。</font><font style="vertical-align: inherit;">2番目のメトリックは、シャットダウン機能の後に何が起こるかを確認するために必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSを測定します。</font><font style="vertical-align: inherit;">これは実際にはまあまあの指標であり、ネットワークチャネルは非常に頻繁に違反されます。</font><font style="vertical-align: inherit;">その結果、ロシアの奥地のどこかへの積み込みが鈍くなる。</font><font style="vertical-align: inherit;">したがって、次のようになります。「ああ、ジャンプした-どこかで何かが脱落したことを意味します。」</font><font style="vertical-align: inherit;">さらに、サードパーティの広告はメトリックを大きく歪めます。</font><font style="vertical-align: inherit;">そして、最も重要なのは、スパマーがやって来ることであり、これは一般的にある種のランダム性です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はBadooの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Pinba</font></a><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">積極的に利用してい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私は今彼女が好きです。</font><font style="vertical-align: inherit;">ほとんどのメトリックはそれによって収集されましたが、その後StatsDプロトコルに切り替えられました。</font><font style="vertical-align: inherit;">今、私たちはさまざまなポイントから測定を行っています：正面から、アプリケーションの前のサーバーから、nginxから、そしてPHPアプリケーション自体から。</font><font style="vertical-align: inherit;">専任のパフォーマンスチームがいます。</font><font style="vertical-align: inherit;">彼女はフロントのパフォーマンスから始めましたが、その後バッキングに切り替えました。</font><font style="vertical-align: inherit;">前面から、JS、CSS、その他の統計情報だけでなく、サーバーの応答時間も収集します。</font><font style="vertical-align: inherit;">まず、アプリケーションの応答時間に注目します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてはみんなが私たちに言ったことに似ています。</font><font style="vertical-align: inherit;">クラシックなPinba for PHPを使用して、PHPの観点からPHPスクリプトの実行時間を測定します。</font><font style="vertical-align: inherit;">ただし、nginxの観点から応答時間を測定するnginx用のPinbaなどもあります。</font><font style="vertical-align: inherit;">クライアントに関するメトリックも収集します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは何を見ていますか？</font><font style="vertical-align: inherit;">一方で、応答時間。</font><font style="vertical-align: inherit;">リソースプランニングとは関係ありません。</font><font style="vertical-align: inherit;">それが悪い場合は、実際にはサービスの品質であるため、改善する必要があります。</font><font style="vertical-align: inherit;">もう1つは、何らかの形でアイロンを計画する必要があるということです。</font><font style="vertical-align: inherit;">ITOpsと監視チームはすべてのハードウェアを監視します。</font><font style="vertical-align: inherit;">ネットワーク上、ディスク上にいくつかのバーがあります。</font><font style="vertical-align: inherit;">アラートが発生するいくつかの値があります-そして私たちは何かをしています。</font><font style="vertical-align: inherit;">実践が示しているように、通常はCPUに対して最適化します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちでは、PHPアプリケーションはそれ自体を測定し、register_shutdown_function（）でメトリックをスローします。</font><font style="vertical-align: inherit;">各LXCにはStatsDサーバーがあり、これらのメトリックを収集し、コレクターを介してデータが格納されているグラファイトクラスター（ClickHouseを含む）に送信します。</font><font style="vertical-align: inherit;">これは自己診断です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、各コンテナにはnginx、つまりnginx + PHP-FPMがあります。</font><font style="vertical-align: inherit;">nginxでは、PHPアプリケーションの実行時間に関連する外部メトリックを収集します。</font><font style="vertical-align: inherit;">また、これらは別々のサーバー（avi-httpと呼びます）nginxにも直面しています。nginxは、基本的なルーティングを実行し、応答時間、500応答コードの数などの高レベルのメトリックも収集します。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンストラックにはどのようなツールがありますか？</font><font style="vertical-align: inherit;">最も頻繁に使用するものは何ですか？</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自のツールを作成しました。 Pinbaが出たばかりのとき-かなり昔の2012年に-UDPを介してこのようなものを受け取ったのはMySQL用のモジュールでした。グラフィックを取り出すのは困難でした;パフォーマンスのためにあまり最適化されていませんでした。そして私たちは、ピンバと呼ばれる独自のものを書くことよりも優れたものを思いつきませんでした。 PHPクライアントからそれらを受け入れるのは単なるカウンターサーバーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのタイマーをコード内に散在させました。何かを測定したいときはいつでも、タイマーの開始と停止をコードで設定しました。モジュール自体がカウンターランタイムを計算し、蓄積されたカウンターをパケットに集約して、デーモンに送信します。インターフェイス自体が必要なものをすべて抽出し、目的のカウンターで接続グラフを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pinbaの問題の1つは、独自のインターフェースの欠如でした。データをRRDに転送する必要がありました（そのような暗闇がありました）。</font><font style="vertical-align: inherit;">したがって、独自のインターフェースを作成しました。</font><font style="vertical-align: inherit;">ジャンプしたものを確認するたびに、スクリプトをインストールできます。</font><font style="vertical-align: inherit;">スクリプトでは、集計されたすべてのカウンターが私たちに送信され、それが私たちに送信されます。</font><font style="vertical-align: inherit;">どのカウンターが増加したか、カウンターでの応答時間が増加したか、カウンターの数が増加したかを確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスが低下したときに表示されます。</font><font style="vertical-align: inherit;">私たちはこの方法を掘り始めています。</font><font style="vertical-align: inherit;">PHP 7以前は、XHProfを使用していましたが、XHProfはビルドを停止しました。</font><font style="vertical-align: inherit;">そのため、Xdebugに切り替えました。</font><font style="vertical-align: inherit;">Xdebugは、問題が表示されているときにのみ突く。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、XHProfがPHP 7でビルドされないという一般的な考えです。</font><font style="vertical-align: inherit;">これは真実ですが、一部だけです。</font><font style="vertical-align: inherit;">ウィザードからXHProfを取得する場合、実際には実行されません。</font><font style="vertical-align: inherit;">しかし、GitHubで、Experimental（またはそのようなもの）と呼ばれるブランチに切り替えると、PHP 7はすべて正常に動作し、本番環境で使用できます。</font><font style="vertical-align: inherit;">チェックしました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいえ、切り替えました。</font><font style="vertical-align: inherit;">うまくいきませんでした。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ピンバについて追加したい。</font><font style="vertical-align: inherit;">あなたはある程度預言者になりました。</font><font style="vertical-align: inherit;">私たちも、ある時点で生産性を失いました。</font><font style="vertical-align: inherit;">非常に高速な</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinba2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ピンバの代替品として使用できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが私たちに控えめです。</font><font style="vertical-align: inherit;">パフォーマンスの方向性を作業に取り入れました。応答時間などのメトリックを収集します。</font><font style="vertical-align: inherit;">StatsDを使用します。</font><font style="vertical-align: inherit;">私たちはまだ定期的にプロファイラーを使用していませんが、一部のチームがPHPで記述されたマイクロサービスでプロファイラーを使用していることは確かです。</font><font style="vertical-align: inherit;">私の意見では、誰かでもNew Relicを中継します。</font><font style="vertical-align: inherit;">しかし、主なモノリシックアプリケーションのコンテキストでは、これまでのところこれにのみ取り組んでいます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
鉄の歴史は、ZabbixのGrafanaで監視されています。</font><font style="vertical-align: inherit;">PHPの部分については、Pinbaがあり、多数のタイマーがあります。</font><font style="vertical-align: inherit;">それらの上に便利なグラフィックを作成します。</font><font style="vertical-align: inherit;">私たちはXHProfを使用しており、製造時には、要求の一部のために駆動します。</font><font style="vertical-align: inherit;">私たちは常に新しいXHProfプロファイルを利用できます。</font><font style="vertical-align: inherit;">私たちはliveprofを持っています。これは私たちのツールであり、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を含め</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、</font></a><font style="vertical-align: inherit;">それについて読むことができます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それはすべて自動的に起こります。あなたはただ見なければなりません。</font><font style="vertical-align: inherit;">phpspyを使用します。</font><font style="vertical-align: inherit;">それは常に私たちから始まるわけではありません。誰かが何かを見たいと思ったら、彼は車に乗り、プロフィールを外します。</font><font style="vertical-align: inherit;">原則として、Perfの場合と同様です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XHProfにも同じことが言えます。</font><font style="vertical-align: inherit;">私たちはかつてそれをずっと前に使用しました：これは数人の開発者の個人的なイニシアチブであり、実際には離陸しませんでした。</font><font style="vertical-align: inherit;">彼は収集をやめた。</font><font style="vertical-align: inherit;">ルーター、コントローラー、さまざまなモデルの呼び出しから一連のメトリックを収集します。</font><font style="vertical-align: inherit;">データセンターの内部ネットワークの約60〜70％が、メトリック付きのUDPパケットで占められています。</font><font style="vertical-align: inherit;">現時点では、これで十分です。</font><font style="vertical-align: inherit;">次に、最適化のための新しい場所を探します。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉄のポイントに到達してから：誰かが体系的に容量計画に従事していますか？</font><font style="vertical-align: inherit;">このプロセスはどのように構築されていますか？</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モノリシックアプリケーションは、少なくとも5年間、少なくとも65 LXCを実行します。</font><font style="vertical-align: inherit;">コードを最適化し、改善します。十分なリソースがあります。</font><font style="vertical-align: inherit;">私たちの主なキャパシティ計画はKubernetesに行きます。Kubernetesでは、約400の生きているマイクロサービスがPHP / Goで書かれています。</font><font style="vertical-align: inherit;">モノリスからゆっくりと断片をカットしていますが、それはまだ成長しています。</font><font style="vertical-align: inherit;">私たちは彼を止めることはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、PHPはクールな言語です。</font><font style="vertical-align: inherit;">ビジネスロジックをすばやく実装します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、ITOpsと監視チームは、十分なリソースがあることを確認します。</font><font style="vertical-align: inherit;">しきい値に近づき始めると、同僚はこれに気づきます。</font><font style="vertical-align: inherit;">彼らはおそらく、主にグローバルな容量計画を担当しています。</font><font style="vertical-align: inherit;">PHPの部分はメインのCPUリソースを持っているので、それを自分で追跡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは自分自身に基準を設定しました。クラスターの60％以上を「食べる」べきではありません。</font><font style="vertical-align: inherit;">これは、95％ではなく60％です。これは、ハイパートレッドを使用しているためです。ハイパートレッドは、プロセッサーなしでは絞り出せない量をプロセッサーからさらに絞り出します。</font><font style="vertical-align: inherit;">これについては、ハイパー読み取りカーネルは完全に正直ではないため、CPU使用量の50％を超えると、予測できない方法で成長する可能性があるという事実を支払います。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
展開を行い、何かが失敗したことを確認します-そのような容量計画。</font><font style="vertical-align: inherit;">目で！</font><font style="vertical-align: inherit;">これには、ある程度の生産性のマージンがあります。</font><font style="vertical-align: inherit;">私たちはそれに固執しようとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、事後最適化も行います。</font><font style="vertical-align: inherit;">何かが脱落しているのを見つけたとき、すべてが完全に悪い場合はロールバックします。</font><font style="vertical-align: inherit;">しかし、これは実際には起こりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または、「ここは最適ではありません。今すぐすべてを修正し、すべてが正常に機能するようになります。」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特に気にすることはありません。非常に難しく、排気ガスはそれほど大きくありません。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたはマイクロサービスについて話している。</font><font style="vertical-align: inherit;">彼らはどのように相互作用しますか？</font><font style="vertical-align: inherit;">RESTですか、それともバイナリプロトコルを使用していますか？</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kafkaはサービス間でイベントを送信するために使用され、JSON-RPCはサービス間の相互作用を保証するために使用されますが、完全ではありませんが、その単純化されたバージョンであり、取り除くことはできません。</font><font style="vertical-align: inherit;">より高速な実装があります：同じprotobuf、gRPC。</font><font style="vertical-align: inherit;">これは私たちの計画の中にありますが、確かに優先事項ではありません。</font><font style="vertical-align: inherit;">400を超えるマイクロサービスがあるため、それらすべてを新しいプロトコルに移植することは困難です。</font><font style="vertical-align: inherit;">他にも最適化する場所はたくさんあります。</font><font style="vertical-align: inherit;">私たちは間違いなく今それをしていません。</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、マイクロサービスはありません。</font><font style="vertical-align: inherit;">サービスがあり、Google protobufの上に独自のプロトコルであるKafkaもあります。</font><font style="vertical-align: inherit;">おそらく、私たちはgRPCを使用します。これはクールで、すべての言語をサポートしており、さまざまな部分を非常に簡単にバインドできる機能です。</font><font style="vertical-align: inherit;">しかし、必要なときにgRPCはまだありませんでした。</font><font style="vertical-align: inherit;">しかし、protobufがあり、それを採用しました。</font><font style="vertical-align: inherit;">その上、さまざまなものが追加されたため、シリアル化だけでなく完全なプロトコルになりました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロサービスもありません。</font><font style="vertical-align: inherit;">主にCで書かれたサービスがあります。便利なのでJSON-RPCを使います。</font><font style="vertical-align: inherit;">コードをデバッグするときにソケットを開いただけで、必要なものをすぐに書き込みました。</font><font style="vertical-align: inherit;">何かがあなたに戻ってきました。</font><font style="vertical-align: inherit;">いくつかの追加ツールを使用する必要があるため、Protobufはさらに困難です。</font><font style="vertical-align: inherit;">オーバーヘッドはわずかですが、利便性のために支払う必要があると私たちは考えています。これは大きな金額ではありません。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">巨大なデータベースがあります。</font><font style="vertical-align: inherit;">それらの1つで回路を変更する必要がある場合、どのように行うのですか？</font><font style="vertical-align: inherit;">ある種の移行？</font><font style="vertical-align: inherit;">これらの移行に数日かかる場合、これはパフォーマンスにどのように影響しますか？</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モノリシックな大きなテーブルがあります。</font><font style="vertical-align: inherit;">破片があります。</font><font style="vertical-align: inherit;">一度に多くの並行変更があるため、シャードは非常に迅速に変更されます。</font><font style="vertical-align: inherit;">プロファイルが変更された大きなテーブルは約3時間変更されました。</font><font style="vertical-align: inherit;">読み取りと書き込みを行わないPerkonovskieツールを使用しています。</font><font style="vertical-align: inherit;">さらに、コードが両方の状態をサポートするように、alterをデプロイします。</font><font style="vertical-align: inherit;">変更後、デプロイも行います。デプロイは、スキームを適用するよりも高速です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最大のストレージ（「スポット」と呼びます）があります。これは巨大な分割データベースです。</font><font style="vertical-align: inherit;">「ユーザー」テーブルを使用すると、彼女には多くの破片があります。</font><font style="vertical-align: inherit;">1台のサーバー上にいくつのテーブルが配置されるかを正確に説明することはしません。小さなテーブルがたくさんあるという考えです。</font><font style="vertical-align: inherit;">実際に回路を変更するときは、変更するだけです。</font><font style="vertical-align: inherit;">すべての小さなテーブルで、それはすぐに起こります。</font><font style="vertical-align: inherit;">他のリポジトリがあります-すでに他のアプローチがあります。</font><font style="vertical-align: inherit;">巨大な基盤が1つある場合は、ペルコニアンツールがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的には、ニーズに応じて使い分けます。</font><font style="vertical-align: inherit;">最も頻繁な変更は、この巨大な分割されたスポットベースの変更です。これには、すでにプロセスが構築されています。</font><font style="vertical-align: inherit;">それはすべて非常に簡単に機能します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどのトラフィックを処理する同じモノリシックアプリケーションが、1日に5〜6回展開されます。</font><font style="vertical-align: inherit;">ほぼ2時間ごと。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースの操作に関しては、これは別の問題です。</font><font style="vertical-align: inherit;">マイグレーションがあり、自動的にローリングします。</font><font style="vertical-align: inherit;">これはDBAのレビューです。</font><font style="vertical-align: inherit;">移行をスキップして手動でロールするオプションがあります。</font><font style="vertical-align: inherit;">移行は、コードをテストするときに自動的にステージングに組み込まれます。</font><font style="vertical-align: inherit;">しかし、本番環境では、大量のリソースを利用するある種の疑わしい移行がある場合、DBAが手動で開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードは、新旧のデータベース構造で機能するようにする必要があります。</font><font style="vertical-align: inherit;">多くの場合、機能を展開するために複数回出張します。</font><font style="vertical-align: inherit;">2、3回のロールアウトで、目的の状態を得ることができます。</font><font style="vertical-align: inherit;">同様に、巨大なデータベース、分割データベースがあります。</font><font style="vertical-align: inherit;">すべてのマイクロサービスを考慮に入れると、1日あたりの展開数は間違いなく100〜150になります。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたがフォローしているあなたのための標準的なバックエンド応答時間は何ですか？</font><font style="vertical-align: inherit;">さらに最適化するために何が必要か、またはいつ終了するかをいつ理解しますか？</font><font style="vertical-align: inherit;">「病院の平均」値はありますか？</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
番号。</font><font style="vertical-align: inherit;">エンドポイントによって異なります。</font><font style="vertical-align: inherit;">すべてを個別に調べます。</font><font style="vertical-align: inherit;">これがいかに重要であるかを理解しようとしています。</font><font style="vertical-align: inherit;">一部のエンドポイントは通常、バックグラウンドで要求されます。</font><font style="vertical-align: inherit;">これは、応答時間が20秒であっても、ユーザーに影響を与えることはありません。</font><font style="vertical-align: inherit;">これはバックグラウンドで行われ、違いはありません。</font><font style="vertical-align: inherit;">主なことは、いくつかの重要なことが迅速に行われることです。</font><font style="vertical-align: inherit;">おそらく200ミリ秒でも大丈夫ですが、わずかな増加はすでに重要です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTMLレンダリングからAPIリクエストに切り替えています。</font><font style="vertical-align: inherit;">実際、ここでは、APIは大きくて重いHTML応答よりもはるかに速く応答します。</font><font style="vertical-align: inherit;">したがって、例えば１００ｍｓという値を区別することは難しい。</font><font style="vertical-align: inherit;">200ミリ秒に注目しました。</font><font style="vertical-align: inherit;">それからPHP 7が起こりました-そして私たちは100ミリ秒に集中し始めました。</font><font style="vertical-align: inherit;">これは「病院の平均」です。</font><font style="vertical-align: inherit;">これは非常にあいまいな測定基準であり、少なくともそこに目を向ける時がきたことを示唆しています。</font><font style="vertical-align: inherit;">そのため、導入に重点を置き、その後の応答時間を飛躍的に向上させました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスチームの1つをスケッチしました。同僚は、さまざまなシナリオのもとでページの読み込みを高速化することで、企業がどれだけ多くの収入を得られるかを測定しました。さらに多くのバイヤー、トランザクション、コール、トランジションなどが進行していることを計算しました。これらのデータによれば、ある時点で加速が意味をなさなくなることが理解できます。たとえば、90ミリ秒のいずれかのページの応答時間が70ミリ秒に加速された場合、これにより購入者の+ 2％が得られます。また、70ミリ秒から60ミリ秒に加速すると、すでに0.1％のバイヤーがすでに存在しています。これは通常、エラーに含まれます。みんなと同じように、すべては私たちが取り組んでいるページに大きく依存します。一般的に、Avito 75パーセンタイル-約75ミリ秒。私の意見では、これは遅いです。現在、最適化する場所を探しています。マイクロサービスに移行する前は、すべてがはるかに速く行われており、パフォーマンスの最適化を試みています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5j/tw/ig/5jtwigxel1bcp3pbmmvhdxdslhu.jpeg"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして永遠の質問：鉄か最適化か？</font><font style="vertical-align: inherit;">ハードウェアを購入する価値があるのか​​、それとも最適化に投資する方が良いのかを理解するにはどうすればよいですか？</font><font style="vertical-align: inherit;">国境はどこですか</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の意見：本当のプログラマーは最適化です。</font><font style="vertical-align: inherit;">Badoo、鉱山、Yandexなどの大企業には、さまざまなレベルの開発者がたくさんいるようです。</font><font style="vertical-align: inherit;">ジュニア開発者/インターンと主要開発者の両方がいます。</font><font style="vertical-align: inherit;">そこには常に最適化・修正箇所が追加されているようです。</font><font style="vertical-align: inherit;">鉄は最後のステップです。</font><font style="vertical-align: inherit;">65 LXCのモノリスの場合、鉄を長期間追加していません。</font><font style="vertical-align: inherit;">CPU使用率-20％。</font><font style="vertical-align: inherit;">それらをKubernetesクラスターに転送することはすでに考えています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はセミョンの立場が本当に好きです。しかし、私はまったく逆の見方をしています。まず、アイロンを見てみます。鉄を落とすことはできますか？もしそうなら、鉄で問題を解決する方が簡単です。開発者は、現時点で役立つ他のことを行うことができます。開発者の時間はお金がかかります。鉄もお金がかかるので、比較する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのうちどれがより重要であるかは不明です。両方のコストが同じであれば、ハードウェアが優先されます。これは、開発者が現時点で何かを実行できるためです。具体的には、PHPバックエンドに関しては、これを行うことはできません。最適化のコストは、鉄を購入するよりもはるかに安価です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
停止しようとしています。</font><font style="vertical-align: inherit;">計画に関しては、ある種のバーがあります。</font><font style="vertical-align: inherit;">CPU使用量をそれ以下に減らすと、停止します。</font><font style="vertical-align: inherit;">一方、サービスの質もあります。</font><font style="vertical-align: inherit;">応答時間がどこかに合わない場合は、最適化する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてはチームとプロジェクトの規模に依存するようです。</font><font style="vertical-align: inherit;">プロジェクトが小さいほど、ハードウェアの購入が容易になります。これは、開発者の給与が一定であり、機能するコード、および機能するユーザーが大きく異なるためです。</font><font style="vertical-align: inherit;">ユーザーが少ない場合は、ハードウェアを購入し、開発者にプロジェクトの開発作業を委託する方が簡単です。</font><font style="vertical-align: inherit;">多くのユーザーがいる場合、1人の開発者がサーバーのほとんどのコストを補うことができます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべては本当に規模に依存します。</font><font style="vertical-align: inherit;">1,000台のサーバーがあり、最適化によって別の1000台のサーバーが不要になる場合は、最適化することをお勧めします。</font><font style="vertical-align: inherit;">サーバーが1台の場合は、さらに2台または3台のサーバーを安全に購入して、最適化でスコアを付けることができます。</font><font style="vertical-align: inherit;">コマンドが小さい場合は、サーバーを購入して起動します。</font><font style="vertical-align: inherit;">チームが大きく、2つまたは3つのデータセンターがある場合、6つのデータセンターを購入することは既にそれほど安くはなく、それほど速くありません。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはPHP mitapを持っているので、このフレーズは聞こえるはずです。なぜこのような問題が常にあるのに、なぜPHPが必要なのでしょうか。</font><font style="vertical-align: inherit;">Go、C、C＃、Rust、Node.jsを書き換えましょう！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
書き換えアプローチは一般的に正当化されていると思いますか？</font><font style="vertical-align: inherit;">これを実行して現時点で投資する価値がある解決策に問題はありますか？</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、PHPは非常に優れた言語です。それは本当にあなたがビジネスの問題を解決することを可能にします。彼は十分速い。すべてのパフォーマンスの問題は、エラー、バグ、レガシーコード（ある種のアンダーカットコード、同じ方法で別の言語で発生する次善の問題）の問題です。それらをそのままGolang、Java、Pythonに移植すると、同じパフォーマンスが得られます。全体的な問題は、多くの遺産があることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の意見では、新しい言語を導入することは、スタックと雇用機会を拡大するために理にかなっています。現在、優れたPHP開発者を見つけるのは十分に困難です。 TechlangarにGolangを導入すれば、Gopherを雇うことができます。市場にはPHP shnikとgopherがほとんどなく、一緒にそれらの多くはすでに存在しています。たとえば、1つの実験がありました。新しい言語を学習する準備ができているC＃の開発者を採用しました-採用スタックを拡大しただけです。私たちがPHPで書く方法を教えることを人々に言うと、彼らはそれをしない方がいいと言います。そして、PHP、Goで書くことを学ぶように彼らに提案し、それでもPythonで書く機会を約束すれば、人々はより喜んで対応します。私にとって、これは雇用機会の延長です。他の言語では、PHPには実際に欠けているものがあります。しかし一般に、PHPはビジネスの問題を解決し、大規模なプロジェクトを実装するのに非常に十分です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はセミョンに完全に同意するでしょう。</font><font style="vertical-align: inherit;">書き直しても意味がありません。</font><font style="vertical-align: inherit;">PHPはかなり生産的な言語です。</font><font style="vertical-align: inherit;">他のスクリプト化されたコンパイルされていない言語と比較すると、おそらく最も高速になります。</font><font style="vertical-align: inherit;">Goなどの一部の言語に書き換えますか？</font><font style="vertical-align: inherit;">これらは他の言語ですが、他の問題があります。</font><font style="vertical-align: inherit;">それらに書き込むのはさらに困難です。それほど速くなく、多くのニュアンスがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それにもかかわらず、PHPで書くのが困難または不便なものがあります。</font><font style="vertical-align: inherit;">マルチプロセス、マルチスレッド化されたものの中には、別の言語で書く方が良いものがあります。</font><font style="vertical-align: inherit;">PHPを使用しないことが正当化されるタスクの例は、原則として、任意のストレージです。</font><font style="vertical-align: inherit;">これがメモリに多く保存するサービスである場合、動的型付けのために非常に大きなメモリオーバーヘッドがあるため、おそらくPHPは最適な言語ではありません。</font><font style="vertical-align: inherit;">4バイトの整数を保存すると、50バイトが消費されることがわかります。</font><font style="vertical-align: inherit;">もちろん大げさですが、それでもこのオーバーヘッドは非常に大きいです。</font><font style="vertical-align: inherit;">何らかのストレージがある場合は、静的型付けを使用して別のコンパイル済み言語で作成することをお勧めします。</font><font style="vertical-align: inherit;">マルチスレッド実行が必要なものと同じように。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPがあまり速くないと考えられているのはなぜですか？ダイナミックだからです。 Go変換は、コードを動的型付けから静的型に変換する問題の解決策です。これにより、すべてがより速く起こっています。特にGoの場合、私の計画では特定のデータストリームのタスクがあります。たとえば、より便利な形式に変換する必要があるある種のデータストリームがある場合、これは理想的です。デーモンによって発生し、入力で1つのデータストリームを受け取り、別のデータストリームを発行します。少しの記憶を食べる。この場合、PHPは大量のメモリを消費します。PHPが確実にクリーンアップされるようにする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コード全体を切り取らないため、Transfer to Goはマイクロサービスへの転送です。</font><font style="vertical-align: inherit;">あなたはそれを完全に取り、書き直すことはありません。</font><font style="vertical-align: inherit;">マイクロサービスへの翻訳は、ある言語から別の言語への翻訳よりも深い作業です。</font><font style="vertical-align: inherit;">最初にそれを解決し、次にどの言語を書くかを考える必要があります。</font><font style="vertical-align: inherit;">最も難しいのは、マイクロサービスの方法を学ぶことです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semyon Kataev、Avito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロサービスでGoを使用する必要はありません。多くのサービスはPHPで記述されており、許容可能な応答時間があります。彼らをサポートするチームは、ビジネスロジックをすばやく作成して機能を導入する必要があると自ら判断しました。彼らは実際には時々gopherよりも速く動作します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはゴーファーを雇い、囲碁に翻訳する傾向があります。しかし、ほとんどのコードはまだPHPで書かれているため、少なくともあと数年はかかるでしょう。実際のレースはありません。Goの方が良いか悪いかは決めていません。 6つのリリースが毎日モノリスにロールアウトされます。チャット「Avito Deploy」には、デプロイされているタスクのリストがあります。各リリースでは、1日あたり少なくとも20のタスクがロールアウトされます。1日あたり少なくとも5または6のリリース、これらのタスクで実行された約80のタスク。これはすべてPHPで行われます。</font></font><br>
<br>
<blockquote>      ?       -,    ?</blockquote><br>
<h3> , </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはとても難しいです。心理的な瞬間があります。私は新機能をリリースしました-完了です。巨大な新機能をリリースしました-あなたは超若いです！管理者または開発者が機能を削除した（廃止された）と言った場合、そのような認識はありません。彼の作品は見えない。たとえば、チームは新機能の実装が成功した場合にボーナスを受け取る可能性がありますが、死んだ機能または実験的な機能に対する賞は見ていません。そして、これからの結果は本当に巨大になる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まだ誰も使用していないレガシー機能の集まりは、開発を本当に遅くします。新しい人が入社し、デッドコードであることを知らないために呼び出されないデッドコードをリファクタリングする場合は何百ものケースがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、どういうわけかマネージャーと交渉し、それがどのような機能であるかをgologで調べようとしています。アナリストは、それがもたらす金額、誰がそれを必要としているのかを検討し、その後でそれを削減しようとしています。</font><font style="vertical-align: inherit;">これは複雑なプロセスです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミハイル・ブイロフ、マンバ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
到達したら、死んだコードをカットします。</font><font style="vertical-align: inherit;">そして、それを迅速にカットすることは常に可能とはほど遠い。</font><font style="vertical-align: inherit;">最初に1つのコードを記述し、次に別のコードを3分の1の上に記述し、その下にすべての機能が不要であることがわかります。</font><font style="vertical-align: inherit;">彼女は膨大な数の依存関係を引き出しますが、これらも修正する必要があります。</font><font style="vertical-align: inherit;">これは常に可能であるとは限らず、マネージャーはそれを報告する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マネージャがタスクを設定し、評価します。</font><font style="vertical-align: inherit;">あなたは言います：「ねえ、私はこれを6か月間行います。</font><font style="vertical-align: inherit;">半年を許容する準備ができていますか？」</font><font style="vertical-align: inherit;">彼は言う：「いいえ、何をカットする必要があるか、何を残せるか考えましょう。</font><font style="vertical-align: inherit;">基本的に何が必要で、何をする必要があるのか​​」</font><font style="vertical-align: inherit;">それがそうです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Murzakov、Badoo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者は機能を受け取ると、開発の面でどれほど難しいか、パフォーマンスの点でどれほど難しいかを評価します。彼がどちらか一方を見つけた場合、彼はこれが本当に必要かどうか、どこかで何かを削除できるかどうかを製品マネージャーと明確にします。変更が重要ではないことが時々起こります、そして、彼らがこれが複雑であるかリソースを食べていると彼らが知ったとき、マネージャーはすぐに譲歩をします。それはちょうど起こります：あなたは「それを削除しましょう」と言います-そしてそれだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
機能が終了した後、機能が期待どおりに機能しないことがわかりました。そして、再び、あなたはマネージャーと話すことができます。多くの場合、すべてが正常に終了します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
機能を削除するための組み込みのプロセスはありません。これは散発的に行われます。私たちはいくつかの機能があることを確認し、それをオフにすることを提案します。私たちはそれをオフにして、それが与えるものを見て、それを切り取ります。もう1つはデッドコードです。デッドコード検出のための特別な拡張機能、さらにはインフラストラクチャ全体があります。このデッドコードが表示されます。私たちはそれをゆっくりと遮断しようとしています。別の質問は、それが本当に死んでいて、リクエストが決して入ってこない場合は、パフォーマンスに影響を与えないということです。サポート性に影響します。人々はそれを読んでいないかもしれませんが、常にそれを読んでいます。パフォーマンスとの関連は特にありません。</font></font><br>
<br>
<blockquote><i>15      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Badoo PHP Meetup</a>. ,      : SuperJob, ManyChat, , Badoo  FunCorp    . <br>
<br>
,   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">YouTube-</a>. ,       - .<br>
<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,     .</i><br>
</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja487224/index.html">傑作になる運命の長期建築はどれくらいできるのか</a></li>
<li><a href="../ja487226/index.html">バッジを作成：Shitty Add-OnはOFFZONEを気にしません</a></li>
<li><a href="../ja487228/index.html">フロントエンドmitap FacebookおよびAvitoTech</a></li>
<li><a href="../ja487230/index.html">アメリカの生活ノート</a></li>
<li><a href="../ja487232/index.html">小児期の免疫刷り込み：ウイルス防御の起源</a></li>
<li><a href="../ja487238/index.html">送電網保護装置の設計方法</a></li>
<li><a href="../ja487242/index.html">2月のITイベントダイジェスト</a></li>
<li><a href="../ja487246/index.html">Tensor証明機関が顧客の秘密キーを侵害する可能性があります</a></li>
<li><a href="../ja487248/index.html">不適切なテストについてもう少し</a></li>
<li><a href="../ja487250/index.html">遅延アルファブレンディング</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>