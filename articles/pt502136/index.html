<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üó£Ô∏è üí∏ ‚ú≥Ô∏è Compacta√ß√£o de dados no Apache Ignite. Experi√™ncia Sberbank ü§∂üèº ü§ûüèæ üë®üèæ‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ao trabalhar com grandes volumes de dados, √†s vezes o problema de espa√ßo insuficiente em disco pode se tornar agudo. Uma maneira de resolver esse prob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Compacta√ß√£o de dados no Apache Ignite. Experi√™ncia Sberbank</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/502136/"><img src="https://habrastorage.org/webt/cl/nj/sz/clnjsz90dmzkkj3wr4vuusu_-nu.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao trabalhar com grandes volumes de dados, √†s vezes o problema de espa√ßo insuficiente em disco pode se tornar agudo. </font><font style="vertical-align: inherit;">Uma maneira de resolver esse problema √© a compacta√ß√£o, pela qual, no mesmo equipamento, voc√™ pode aumentar o volume de armazenamento. </font><font style="vertical-align: inherit;">Neste artigo, veremos como a compacta√ß√£o de dados funciona no Apache Ignite. </font><font style="vertical-align: inherit;">Este artigo descreve apenas os m√©todos de compacta√ß√£o de disco implementados no produto. </font><font style="vertical-align: inherit;">Outros m√©todos de compacta√ß√£o de dados (na rede, na mem√≥ria), implementados e n√£o, permanecer√£o fora do escopo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, quando o modo de persist√™ncia est√° ativado, como resultado da altera√ß√£o de dados nos caches, o Ignite come√ßa a gravar no disco:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conte√∫do do cache</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Write Ahead Log (doravante denominado WAL)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um mecanismo chamado compacta√ß√£o WAL existe h√° muito tempo para compactar WALs. </font><font style="vertical-align: inherit;">O Apache Ignite 2.8, lan√ßado recentemente, introduziu mais dois mecanismos para compactar dados no disco: compacta√ß√£o de p√°gina em disco para compactar o conte√∫do de caches e compacta√ß√£o de instant√¢neo de p√°gina WAL para compactar alguns registros WAL. </font><font style="vertical-align: inherit;">Mais sobre todos esses tr√™s mecanismos abaixo.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compacta√ß√£o de p√°gina em disco</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, abordaremos brevemente como o Ignite armazena dados. Para armazenamento, a mem√≥ria da p√°gina √© usada. O tamanho da p√°gina √© definido no in√≠cio do n√≥ e n√£o pode ser alterado em est√°gios posteriores, tamb√©m o tamanho da p√°gina deve ser uma pot√™ncia de dois e um m√∫ltiplo do tamanho do bloco do sistema de arquivos. As p√°ginas s√£o carregadas na RAM do disco, conforme necess√°rio; o tamanho dos dados no disco pode exceder a quantidade de RAM alocada. Se n√£o houver espa√ßo suficiente na RAM para carregar p√°ginas do disco, p√°ginas antigas e n√£o utilizadas ser√£o for√ßadas a sair da RAM.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dados s√£o armazenados no disco da seguinte forma: um arquivo separado √© criado para cada parti√ß√£o de cada grupo de cache; nesse arquivo, em ordem crescente de √≠ndice, as p√°ginas v√£o uma ap√≥s a outra. O identificador de p√°gina inteira cont√©m o identificador do grupo de cache, o n√∫mero da parti√ß√£o e o √≠ndice da p√°gina no arquivo. Assim, pelo identificador de p√°gina inteira, podemos identificar exclusivamente o arquivo e compens√°-lo no arquivo para cada p√°gina. Voc√™ pode ler mais sobre a mem√≥ria da p√°gina em um artigo no Apache Ignite Wiki: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ignite Persistent Store - sob o cap√¥</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mecanismo de compacta√ß√£o de p√°gina do disco, como o nome sugere, funciona no n√≠vel da p√°gina. </font><font style="vertical-align: inherit;">Quando esse mecanismo √© ativado, o trabalho com dados na RAM √© executado como est√°, sem nenhuma compacta√ß√£o, mas no momento de salvar as p√°ginas da RAM no disco, elas s√£o compactadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas compactar cada p√°gina individualmente n√£o √© uma solu√ß√£o para o problema, voc√™ precisa reduzir o tamanho dos arquivos de dados resultantes. </font><font style="vertical-align: inherit;">Se o tamanho da p√°gina deixar de ser corrigido, n√£o ser√° mais poss√≠vel gravar as p√°ginas em um arquivo, uma por uma, pois isso pode causar v√°rios problemas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o podemos usar o √≠ndice da p√°gina para calcular o deslocamento em que est√° localizado no arquivo.</font></font></li>
<li> ,    ,          .    ,     .    ,         .</li>
<li>           ,      ,        ,      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o solucionar esses problemas em seu pr√≥prio n√≠vel, a compacta√ß√£o de p√°ginas em disco no Apache Ignite usa um mecanismo do sistema de arquivos chamado arquivos esparsos. Um arquivo esparso √© um arquivo no qual algumas regi√µes preenchidas com zeros podem ser marcadas como furos. Nesse caso, os blocos do sistema de arquivos para armazenar esses furos n√£o ser√£o alocados, como resultado do qual o espa√ßo em disco √© economizado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â l√≥gico que, para liberar o bloco do sistema de arquivos, o tamanho do furo seja maior ou igual ao bloco do sistema de arquivos, o que imp√µe uma restri√ß√£o adicional ao tamanho da p√°gina do Apache Ignite: para que a compacta√ß√£o d√™ pelo menos algum efeito, o tamanho da p√°gina deve ser estritamente maior que o tamanho do bloco do sistema de arquivos . Se o tamanho da p√°gina for igual ao tamanho do bloco, nunca poderemos liberar um √∫nico bloco, pois para liberar um √∫nico bloco, precisamos de uma p√°gina compactada para ocupar 0 bytes. Se o tamanho da p√°gina for igual ao tamanho de 2 ou 4 blocos, j√° podemos liberar pelo menos um bloco se a p√°gina for compactada em pelo menos 50% ou 75%, respectivamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, a descri√ß√£o final do mecanismo: Ao gravar uma p√°gina no disco, √© feita uma tentativa de compactar a p√°gina. Se o tamanho da p√°gina compactada permitir que um ou mais blocos do sistema de arquivos sejam liberados, a p√°gina ser√° gravada em formato compactado, um "furo" ser√° perfurado no lugar dos blocos liberados (√© feita uma chamada do sistema </font></font><code>fallocate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o sinalizador "punch hole"). Se o tamanho da p√°gina compactada n√£o permitir a libera√ß√£o de blocos, a p√°gina ser√° salva como est√°, na forma descompactada. Todas as compensa√ß√µes de p√°gina s√£o consideradas e sem compacta√ß√£o, multiplicando o √≠ndice da p√°gina pelo tamanho da p√°gina. N√£o √© necess√°ria realoca√ß√£o autom√°tica de p√°ginas. As compensa√ß√µes de p√°gina, bem como sem compacta√ß√£o, caem nos limites dos blocos do sistema de arquivos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-l/0f/3x/-l0f3xzxozvrxefbiauxdivslv0.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na implementa√ß√£o atual, o Ignite s√≥ pode funcionar com arquivos esparsos no SO Linux, portanto, a compacta√ß√£o de p√°gina em disco s√≥ pode ser ativada quando o Ignite √© usado neste sistema operacional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritmos de compacta√ß√£o que podem ser usados ‚Äã‚Äãpara compacta√ß√£o de p√°gina em disco: ZSTD, LZ4, Snappy. </font><font style="vertical-align: inherit;">Al√©m disso, existe um modo operacional (SKIP_GARBAGE), no qual apenas um local n√£o utilizado na p√°gina √© descartado sem aplicar compress√£o aos dados restantes, o que permite reduzir a carga na CPU em compara√ß√£o com os algoritmos listados acima.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impacto no desempenho </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, na verdade, n√£o medi o desempenho em bases reais, pois n√£o planejamos usar esse mecanismo na produ√ß√£o, mas teoricamente podemos especular onde vamos perder e onde vamos vencer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, precisamos lembrar como ler e escrever p√°ginas ao acess√°-las:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando uma opera√ß√£o de leitura √© executada, ela √© pesquisada primeiro na RAM; se a pesquisa falhar, a p√°gina √© carregada na RAM do disco com o mesmo fluxo que l√™.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao executar uma opera√ß√£o de grava√ß√£o, a p√°gina na RAM √© marcada como suja, enquanto o salvamento f√≠sico da p√°gina no disco imediatamente no fluxo que est√° executando a grava√ß√£o n√£o ocorre. </font><font style="vertical-align: inherit;">Todas as p√°ginas sujas s√£o salvas no disco posteriormente no processo do ponto de verifica√ß√£o em fluxos separados.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, o efeito nas opera√ß√µes de leitura:</font></font><br>
<br>
<ul>
<li> (disk IO),        .</li>
<li> (CPU),           sparse .       IO       sparse  (    sparse  ,  ,  ).</li>
<li> (CPU),     .</li>
<li>    .</li>
<li>    (    ):</li>
<li> (disk IO),        .</li>
<li> (CPU,  disk IO),     sparse .</li>
<li> (CPU),     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qual escala superar√°? </font><font style="vertical-align: inherit;">Tudo depende muito do ambiente, mas estou inclinado a acreditar que a compacta√ß√£o de p√°gina em disco tem mais probabilidade de degradar o desempenho na maioria dos sistemas. </font><font style="vertical-align: inherit;">Al√©m disso, testes em outros DBMSs usando uma abordagem semelhante com arquivos esparsos mostram uma queda no desempenho quando a compacta√ß√£o est√° ativada.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como habilitar e configurar</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionado acima, a vers√£o m√≠nima do Apache Ignite que suporta compacta√ß√£o de p√°gina em disco: 2.8 e suporta apenas o sistema operacional Linux. </font><font style="vertical-align: inherit;">A ativa√ß√£o e configura√ß√£o s√£o realizadas da seguinte maneira:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O caminho da classe deve ter um m√≥dulo de igni√ß√£o-compress√£o. </font><font style="vertical-align: inherit;">Por padr√£o, ele est√° localizado na distribui√ß√£o Apache Ignite no diret√≥rio libs / opcional e n√£o est√° inclu√≠do no caminho da classe. </font><font style="vertical-align: inherit;">Voc√™ pode simplesmente mover o diret√≥rio um n√≠vel para libs e, em seguida, quando iniciado atrav√©s do ignite.sh, ele ser√° automaticamente ativado.</font></font></li>
<li>Persistence    (  <code>DataRegionConfiguration.setPersistenceEnabled(true))</code>.</li>
<li>         (    <code>DataStorageConfiguration.setPageSize()</code> ).</li>
<li>  ,            ()   ( <code>CacheConfiguration.setDiskPageCompression() , CacheConfiguration.setDiskPageCompressionLevel()</code>).</li>
</ul><br>
<h3>WAL compaction</h3><br>
<h4>  </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que √© o WAL e por que √© necess√°rio? Muito brevemente: este √© um di√°rio em que todos os eventos que mudam como resultado do reposit√≥rio de p√°ginas se enquadram. Ele √© necess√°rio principalmente para a possibilidade de recupera√ß√£o em caso de queda. Antes de transferir o controle para um usu√°rio, qualquer opera√ß√£o deve primeiro gravar o evento no WAL, para que, em caso de queda, seja poss√≠vel executar o log e restaurar todas as opera√ß√µes pelas quais o usu√°rio recebeu uma resposta bem-sucedida, mesmo que essas opera√ß√µes n√£o tenham tempo para serem refletidas no armazenamento da p√°gina em disco (acima j√° foi descrito que a grava√ß√£o real no armazenamento de p√°ginas √© realizada em um processo chamado de ponto de verifica√ß√£o com algum atraso em threads separados).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As entradas no WAL s√£o divididas em l√≥gica e f√≠sica. Os l√≥gicos s√£o chaves e valores pr√≥prios. F√≠sico - reflete as altera√ß√µes da p√°gina no armazenamento de p√°ginas. Se os registros l√≥gicos puderem ser √∫teis para outros casos, os registros f√≠sicos ser√£o necess√°rios apenas para recupera√ß√£o no caso de uma queda e os registros ser√£o necess√°rios apenas a partir do momento do √∫ltimo ponto de verifica√ß√£o bem-sucedido. Aqui, n√£o entraremos em detalhes e explicaremos por que isso funciona dessa maneira, mas qualquer pessoa interessada pode consultar o artigo j√° mencionado no Apache Ignite Wiki: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ignite Persistent Store - sob o cap√¥</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um registro l√≥gico geralmente responde por v√°rios registros f√≠sicos. Ou seja, por exemplo, uma opera√ß√£o de coloca√ß√£o em cache afeta v√°rias p√°ginas na mem√≥ria da p√°gina (uma p√°gina com os pr√≥prios dados, p√°ginas com √≠ndices, p√°ginas com listas gratuitas). Em alguns testes sint√©ticos, verificou-se que os registros f√≠sicos ocupavam at√© 90% do arquivo WAL. Al√©m disso, eles precisam de um tempo muito curto (por padr√£o, o intervalo entre os pontos de verifica√ß√£o √© de 3 minutos). Seria l√≥gico se livrar desses dados depois de perder sua relev√¢ncia. √â exatamente isso que o mecanismo de compacta√ß√£o do WAL executa, livra-se dos registros f√≠sicos e compacta os demais registros l√≥gicos com zip, enquanto o tamanho do arquivo diminui significativamente (√†s vezes dezenas de vezes).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fisicamente, um WAL consiste em v√°rios segmentos (padr√£o 10) de tamanho fixo (padr√£o de 64 MB), que s√£o substitu√≠dos em um c√≠rculo. </font><font style="vertical-align: inherit;">Assim que o segmento atual √© preenchido, o pr√≥ximo segmento √© atribu√≠do ao atual e o segmento preenchido √© copiado para o arquivo morto em um fluxo separado. </font><font style="vertical-align: inherit;">A compacta√ß√£o WAL j√° funciona com segmentos de arquivamento. </font><font style="vertical-align: inherit;">Al√©m disso, em um fluxo separado, ele monitora a execu√ß√£o do ponto de verifica√ß√£o e inicia a compacta√ß√£o por segmentos de archive, para os quais os registros f√≠sicos n√£o s√£o mais necess√°rios.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zk/95/jo/zk95jo7dnthiox2sv0ezywhrj2a.png"><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impacto no desempenho</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a compacta√ß√£o WAL opera como um encadeamento separado, n√£o deve haver uma influ√™ncia direta nas opera√ß√µes executadas. </font><font style="vertical-align: inherit;">Mas ainda fornece uma carga adicional em segundo plano na CPU (compacta√ß√£o) e no disco (lendo cada segmento WAL do arquivamento e gravando segmentos compactados); portanto, se o sistema for executado no limite, isso tamb√©m levar√° √† degrada√ß√£o do desempenho.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como habilitar e configurar</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ativar a compacta√ß√£o WAL usando a propriedade </font></font><code>WalCompactionEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font><code>DataStorageConfiguration (DataStorageConfiguration.setWalCompactionEnabled(true)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Al√©m disso, usando o m√©todo DataStorageConfiguration.setWalCompactionLevel (), voc√™ pode definir a taxa de compacta√ß√£o se n√£o estiver satisfeito com o valor padr√£o (BEST_SPEED).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compacta√ß√£o de instant√¢neo da p√°gina WAL</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J√° descobrimos que no WAL, as entradas s√£o divididas em l√≥gicas e f√≠sicas. Para cada altera√ß√£o de cada p√°gina na mem√≥ria da p√°gina, √© gerado um registro f√≠sico do WAL. Os registros f√≠sicos, por sua vez, tamb√©m s√£o divididos em duas subesp√©cies: registro de instant√¢neo da p√°gina e registro delta. Sempre que alteramos algo em uma p√°gina e transferimos de um estado limpo para um sujo, uma c√≥pia completa desta p√°gina √© salva no WAL (registro de instant√¢neo da p√°gina). Mesmo que tenhamos alterado apenas um byte no WAL, um registro com um tamanho um pouco maior que o tamanho da p√°gina ser√° salvo. Se alterarmos algo em uma p√°gina j√° suja, um registro delta √© formado no WAL, que reflete apenas as altera√ß√µes em compara√ß√£o com o estado anterior da p√°gina, mas n√£o a p√°gina inteira. Como a redefini√ß√£o do status das p√°ginas de sujo para limpo √© realizada durante o processo do ponto de verifica√ß√£o,imediatamente ap√≥s o in√≠cio do ponto de verifica√ß√£o, quase todos os registros f√≠sicos consistir√£o apenas em instant√¢neos de p√°ginas (como todas as p√°ginas imediatamente ap√≥s o in√≠cio do ponto de verifica√ß√£o est√£o em branco); ent√£o, √† medida que voc√™ se aproxima do pr√≥ximo ponto de verifica√ß√£o, a propor√ß√£o de registro delta come√ßa a crescer e √© redefinida novamente no in√≠cio do pr√≥ximo ponto de verifica√ß√£o. As medi√ß√µes em alguns testes sint√©ticos mostraram que o compartilhamento de instant√¢neos de p√°gina no volume total de registros f√≠sicos atinge 90%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A id√©ia por tr√°s da compacta√ß√£o de instant√¢neo de p√°gina do WAL √© compactar instant√¢neos de p√°gina usando uma ferramenta de compacta√ß√£o de p√°gina pronta para uso (consulte compacta√ß√£o de p√°gina em disco). Ao mesmo tempo, no WAL, os registros s√£o salvos sequencialmente no modo somente anexado e n√£o h√° necessidade de vincular registros aos limites dos blocos do sistema de arquivos; portanto, aqui, diferentemente do mecanismo de compacta√ß√£o de p√°gina em disco, n√£o precisamos absolutamente de arquivos esparsos, portanto esse mecanismo n√£o funcionar√° apenas no SO Linux Al√©m disso, n√£o nos importamos mais com o quanto conseguimos compactar a p√°gina. Mesmo se liberamos 1 byte, esse j√° √© um resultado positivo e podemos salvar dados compactados no WAL, ao contr√°rio da compacta√ß√£o de p√°gina em disco, onde salvamos uma p√°gina compactada apenas se mais de 1 bloco do sistema de arquivos for liberado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As p√°ginas s√£o dados bem compact√°veis, sua participa√ß√£o no volume total do WAL √© muito alta; portanto, sem alterar o formato do arquivo WAL, podemos obter uma redu√ß√£o significativa em seu tamanho. </font><font style="vertical-align: inherit;">A compacta√ß√£o de registros l√≥gicos, entre outras coisas, exigiria uma altera√ß√£o no formato e perda de compatibilidade, por exemplo, para consumidores externos que possam estar interessados ‚Äã‚Äãem registros l√≥gicos, sem reduzir significativamente o tamanho do arquivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto √† compacta√ß√£o de p√°gina em disco para compacta√ß√£o de instant√¢neo de p√°gina WAL, os algoritmos de compacta√ß√£o ZSTD, LZ4, Snappy e o modo SKIP_GARBAGE podem ser usados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impacto no desempenho</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o √© dif√≠cil perceber que a inclus√£o direta da compacta√ß√£o de instant√¢neo da p√°gina WAL afeta apenas os fluxos que gravam dados na mem√≥ria da p√°gina, ou seja, aqueles fluxos que alteram os dados nos caches. A leitura dos registros f√≠sicos do WAL ocorre apenas uma vez, no momento da eleva√ß√£o do n√≥ ap√≥s a queda (e apenas no caso de uma queda durante o ponto de verifica√ß√£o). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso afeta os fluxos de dados da seguinte maneira: obtemos um efeito negativo (CPU) devido √† necessidade de compactar a p√°gina todas as vezes antes de gravar no disco e um efeito positivo (E / S de disco) reduzindo a quantidade de dados sendo gravados. Assim, tudo √© simples aqui, se o desempenho do sistema estiver na CPU, obteremos um pouco de degrada√ß√£o, se na E / S do disco, obteremos um aumento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indiretamente, a redu√ß√£o do tamanho do WAL tamb√©m afeta (positivamente) os fluxos que soltam segmentos WAL nos fluxos de arquivamento e compacta√ß√£o WAL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testes de desempenho real em nosso ambiente com dados sint√©ticos mostraram um pequeno aumento (taxa de transfer√™ncia aumentada em 10% a 15%, lat√™ncia diminu√≠da em 10% a 15%).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como habilitar e configurar</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vers√£o m√≠nima do Apache Ignite √© 2.8. </font><font style="vertical-align: inherit;">A ativa√ß√£o e configura√ß√£o s√£o realizadas da seguinte maneira:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O caminho da classe deve ter um m√≥dulo de igni√ß√£o-compress√£o. </font><font style="vertical-align: inherit;">Por padr√£o, ele est√° localizado na distribui√ß√£o Apache Ignite no diret√≥rio libs / opcional e n√£o est√° inclu√≠do no caminho da classe. </font><font style="vertical-align: inherit;">Voc√™ pode simplesmente mover o diret√≥rio um n√≠vel para libs e, em seguida, quando iniciado atrav√©s do ignite.sh, ele ser√° automaticamente ativado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A persist√™ncia deve estar ativada (ativada at√© </font></font><code>DataRegionConfiguration.setPersistenceEnabled(true)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font></li>
<li>        <code>DataStorageConfiguration.setWalPageCompression()</code>,     ( DISABLED).</li>
<li>        <code>DataStorageConfiguration.setWalPageCompression()</code>,         javadoc  .</li>
</ul><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os mecanismos de compacta√ß√£o de dados discutidos no Apache Ignite podem ser usados ‚Äã‚Äãindependentemente um do outro, mas qualquer combina√ß√£o deles tamb√©m √© v√°lida. </font><font style="vertical-align: inherit;">A compreens√£o dos princ√≠pios de seu trabalho determinar√° como eles se ajustam √†s suas tarefas no ambiente e o que voc√™ ter√° que sacrificar ao us√°-las. </font><font style="vertical-align: inherit;">A compacta√ß√£o de p√°gina em disco foi projetada para compactar o armazenamento principal e pode fornecer compacta√ß√£o m√©dia. </font><font style="vertical-align: inherit;">A compacta√ß√£o de instant√¢neo da p√°gina WAL fornecer√° um grau m√©dio de compacta√ß√£o dos arquivos j√° WAL, enquanto √© prov√°vel que melhore o desempenho. </font><font style="vertical-align: inherit;">A compacta√ß√£o WAL n√£o afetar√° positivamente o desempenho, mas minimizar√° o tamanho dos arquivos WAL, excluindo registros f√≠sicos.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt502122/index.html">Thanos - Prometheus escal√°vel</a></li>
<li><a href="../pt502124/index.html">Resultados do empreendimento em 2019 para a Ucr√¢nia</a></li>
<li><a href="../pt502126/index.html">Como melhorar seu curr√≠culo de programador de ingl√™s</a></li>
<li><a href="../pt502132/index.html">Como transferir o cont√™iner OpenVZ 6 para o servidor KVM sem dor de cabe√ßa</a></li>
<li><a href="../pt502134/index.html">O suficiente para ter medo de decis√µes subjetivamente bonitas no c√≥digo - voc√™ n√£o √© um rob√¥</a></li>
<li><a href="../pt502146/index.html">Mesa redonda on-line "Eu quero jogarev"</a></li>
<li><a href="../pt502148/index.html">Usando componentes de terceiros no armazenamento usando o Qsan como exemplo</a></li>
<li><a href="../pt502150/index.html">Escalando uma rede de alta carga com a Nutanix: recursos e desafios com um caso pessoal</a></li>
<li><a href="../pt502154/index.html">Como escrever autotestes de maneira eficaz - testes subcut√¢neos</a></li>
<li><a href="../pt502156/index.html">Caso Rambler v. NGINX: Riscos criminais da mesa redonda de digitaliza√ß√£o 16 de maio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>