<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ»â€ğŸ¨ ğŸ•´ğŸ¼ ğŸ˜® Kami memompa Ikea: bagaimana mengubah musik ringan menjadi Big Brother ğŸšµğŸ¿ ğŸ“§ ğŸš²</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="pengantar
 Ikea adalah toko yang penasaran. Bahkan jika Anda datang ke dalamnya dengan tujuan membeli satu hal tertentu dan tidak terganggu oleh semua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kami memompa Ikea: bagaimana mengubah musik ringan menjadi Big Brother</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495180/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/1c/b3/g-1cb35ov13g0bc7demuvnxiqla.gif"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ikea adalah toko yang penasaran. Bahkan jika Anda datang ke dalamnya dengan tujuan membeli satu hal tertentu dan tidak terganggu oleh semua sampah, maka Anda akan keluar dengan membeli tiga kali lebih banyak dari yang diperlukan. Bagi kami peretas, efek ini sangat jelas di departemen Ikea dengan kabel daya atau baterai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi saya, kasus terakhir kegilaan semacam itu terjadi di Belanda. Saya sedang dalam perjalanan yang direncanakan, berencana untuk menghabiskan hanya beberapa minggu di negara ini. Namun, ini adalah awal dari 2020 dan bencana dengan COVID-19 ... Saya harus tinggal jauh dari laboratorium saya lebih lama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ketika saya melihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> produk elektronik </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Frekevens</font></a><font style="vertical-align: inherit;"> di Ikea </font><font style="vertical-align: inherit;">, saya tidak dapat menahannya dan membeli semuanya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi mereka yang tidak tahu: garis Ikea Frekvens harus menjadi analog modern dari perangkat HiFi lama-sekolah ditambah dengan set musik ringan heksagonal, yang tampaknya berada di rumah-rumah setengah dari remaja 90-an. Dalam hal ini, garis perangkat yang terhubung satu sama lain terdiri dari speaker Bluetooth untuk output suara dan proyektor LED (dilengkapi dengan berbagai nozel) yang berkedip-kedip mengikuti irama musik, serta tampilan kubus LED yang dapat menampilkan animasi yang juga bergerak ke musik. Ikea membanggakan bahwa jalur ini dikembangkan bersama dengan Teenage Engineering, yang dikenal dengan seri Pocket Operator synthesizer "mainan" portabel.</font></font><br>
<a name="habracut"></a><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4d/8b4/e60/f4d8b4e60e7812b5b979850a18d3926c.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang diperlihatkan dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video promosi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ikea, pembelian selesai dari puluhan perangkat akan terlihat seperti karnaval berkelip yang tak tertahankan, yang tidak akan diatur oleh remaja saya yang berusia 15 tahun di kamarnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya sangat tertarik dengan tampilan kubus LED: ini adalah perangkat terintegrasi berkualitas tinggi yang berfungsi pada listrik. Pada panel depan adalah matriks 16 baris dan 16 kolom LED putih yang sangat terang, yaitu total 256 LED. Animasi yang dibangun ke dalam perangkat itu cukup sederhana, tetapi mereka membawa saya pada gagasan bahwa besi dapat benar-benar mengontrol setiap LED secara terpisah. Namun, karena ini, kotak kecil itu cukup mahal: sakuku kosong sekitar 40 euro. Untuk jumlah ini, Anda mendapatkan kotak dengan LED dan kabel daya. Karena diasumsikan bahwa Anda harus membeli produk ini bersama dengan produk Frekvens lainnya, Anda juga menerima elemen penghubung tambahan: kabel daya ekstensi untuk pasokan daya ujung ke ujung dari listrik ke kotak lain,serta satu set sekrup dan bantalan plastik yang Anda dapat secara mekanis mengencangkan perumahan satu sama lain.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begitu saya sampai di rumah, saya menghubungkan perangkat dan ... jujur, saya sedikit kecewa dengan apa yang mereka lakukan dengan setrika. </font><font style="vertical-align: inherit;">Perangkat memiliki beberapa animasi yang dapat dipilih dengan menekan tombol di bagian belakang case; </font><font style="vertical-align: inherit;">mikrofon kecil dipasang di kasing - setiap kali mengenali suara, bingkai animasi berubah. </font><font style="vertical-align: inherit;">Animasi tidak terlalu menarik: mereka hanya terdiri dari empat hingga lima bingkai, dan bingkai itu sendiri hanya hitam dan putih, tanpa nuansa abu-abu. </font><font style="vertical-align: inherit;">Jika Anda penasaran, saya merekam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pendek </font><font style="vertical-align: inherit;">dengan semua animasinya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jelas, ini tidak cocok untukku. </font><font style="vertical-align: inherit;">Mari hack perangkat - mari kita lihat apa yang membuatnya bekerja, dan apakah mungkin untuk membuat perilakunya sedikit lebih menarik.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autopsi</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk membongkar Frekvens, obeng untuk slot berbentuk silang dan, mungkin, pisau sudah cukup. </font><font style="vertical-align: inherit;">Anda juga akan membutuhkan kegigihan yang kuat, karena perangkat ini tidak mudah untuk dibongkar: desainnya rumit dan beberapa elemen diisi dengan silikon, mungkin untuk menghilangkan getaran dan menyederhanakan pembuatan.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71d/6e9/925/71d6e9925d31cbce7d1da4cf492948de.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pembongkaran kasus Frekvens dimulai dari belakang. </font><font style="vertical-align: inherit;">Rumah memiliki lubang sekrup di semua sisi, kecuali bagian depan; </font><font style="vertical-align: inherit;">berkat set sekrup dan penutup dari kit perangkat, itu dapat dihubungkan ke gadget Frekvens lainnya. </font><font style="vertical-align: inherit;">Namun, lubang belakang untuk sekrup sedikit lebih dalam dan di bawahnya ada sekrup yang menahan casing.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebf/2c5/8e2/ebf2c58e270c942b8e360a744f0ff6ea.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah melepas penutup belakang, kami melihat bahwa semua lubang sekrup telah memasang sisipan logam di mana sekrup dapat disekrup. </font><font style="vertical-align: inherit;">Wow! </font><font style="vertical-align: inherit;">Ini harus memberikan lubang dengan margin keselamatan yang memadai. </font><font style="vertical-align: inherit;">Ada kemungkinan bahwa ini sangat mempersulit produksi atau pembongkaran; </font><font style="vertical-align: inherit;">yang terakhir diperumit oleh fakta bahwa pertama-tama kita perlu memotong tetesan senyawa silikon yang mengeras.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ca/78c/bf2/4ca78cbf2e1f533658a361fd998a933a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sisipan sebenarnya diikat dengan sisipan plastik lainnya; </font><font style="vertical-align: inherit;">mereka harus dihapus terlebih dahulu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak punya foto lain dari proses pembongkaran, tetapi setelah tahap ini Anda akan melihat empat sekrup yang perlu dibuka, dan kemudian proses berlanjut seperti sebelumnya. </font><font style="vertical-align: inherit;">Pahami bagian plastik mana yang menyatukan semuanya, potong senyawa silikon, lepaskan pengencang plastik. </font><font style="vertical-align: inherit;">Lanjutkan sampai Anda dapat menarik keluar papan sirkuit.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e40/8c0/346/e408c0346ddbea872aa6100a7c37c303.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini dia: sisi kebalikan dari papan sirkuit. Ternyata, itu dirakit dari dua papan sirkuit cetak: yang putih memiliki dua sisi - di belakang ada semua driver LED (dan papan lain terpasang padanya), dan di bagian depan ada LED sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Papan sirkuit putih dirancang dengan cukup baik: alih-alih matriks LED, ada 16 driver LED </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCT2024</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bekerja dari arus searah. Driver LED ini memiliki 16 saluran, yaitu, setiap LED dikendalikan secara langsung. Driver LED hanya dapat sepenuhnya menghidupkan atau mematikan LED; driver sendiri tidak memiliki dukungan skala abu-abu. Bahkan, mereka melakukan register shift menggunakan output yang dikontrol saat ini, dan mereka semua berganti secara berurutan; Antarmuka koneksi PCB hijau terdiri dari bus sinkronisasi dan data, jalur snap memungkinkan, output, ground, dan saluran memungkinkan daya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di papan hijau ini adalah apa otak kecil perangkat: mikrokontroler, artikel yang tidak dapat ditemukan di Google, dan penguat operasional untuk mikrofon. </font><font style="vertical-align: inherit;">Menariknya, ada petunjuk bahwa perangkat harus memiliki lebih banyak fitur: ada tempat untuk, mungkin, I2C EEPROM 24Cxx dan petunjuk bahwa dalam proyek asli ada penerima IR di panel depan. </font><font style="vertical-align: inherit;">Mungkin seharusnya perangkat itu akan datang dengan remote control yang memungkinkan Anda membuat pola sendiri? </font><font style="vertical-align: inherit;">Ini mungkin menjelaskan bahwa animasi yang ada terlihat sangat membosankan.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/40f/a7a/1d9/40fa7a1d95a60af223eb12a5f5db7ba6.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bagian depan papan tulis putih semua LED. </font><font style="vertical-align: inherit;">Mikrofon datar kecil juga disolder untuk itu. </font><font style="vertical-align: inherit;">Pada awalnya saya berpikir bahwa itu disolder ke papan hijau dan menonjol melalui lubang di papan putih, tetapi sebenarnya itu hanya datar.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bb/613/620/2bb6136207e5ce1cf78895a6827a8dfd.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua elektronik lainnya terletak di bagian belakang papan. </font><font style="vertical-align: inherit;">Itu tidak cukup di sana: hanya catu daya di bawah merek Ikea, mengeluarkan 4 V. Di bawah catu daya ada papan sirkuit cetak kecil di mana ada dua sakelar taktil untuk tombol di bagian belakang kasing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, jika kita ingin "mengoptimalkan" desain, maka kita memiliki kelemahan yang jelas: lebih baik mengganti kartu hijau kecil dengan prosesor dengan sesuatu yang lebih kuat.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memodifikasi besi</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya pikir mungkin saja untuk mengganti peralatan dengan ESP-Cam. Ini adalah papan yang sangat murah (10 euro atau lebih) dengan chip WiFi / BT ESP32, beberapa megabita PSRAM, dan modul kamera. Saya tidak terlalu tertarik dengan musik ringan, saya ingin perangkat merespons sesuatu yang visual. Karena sudah ada lubang di ujung depan untuk penerima, saya pikir saya bisa menggunakannya di bawah kamera. Saya juga perlu mengebor lubang di papan tulis di mana mikrofon berada; untungnya, selain trek mikrofon yang sekarang tidak berguna, ini hanya akan menghancurkan satu trek LED. Saya mengebor lubang dan mengembalikan trek. Untuk sementara menempatkan papan kembali pada tempatnya dan menyalakan kubus, saya memastikan bahwa semua LED masih berfungsi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed1/c45/456/ed1c454569bc1fa6734a8c16bdfed1ae.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang saya memiliki papan dengan lubang bor, dan saya hanya bisa menghubungkan dan secara mekanis menghubungkan ESP-Cam. Para desainer dengan ramah menunjukkan tujuan semua bantalan pada layar silkscreen dari papan hijau, jadi saya hampir tidak bisa menebak apa pun. Karena catu daya hanya memasok 4 V, saya menghubungkannya langsung ke input 3,3 V dari chip ESP-CAM. Saya harus melakukan ini, karena ketika saya menghubungkannya ke pin Vin 5V, chip tidak mau memulai ... Kemungkinan besar, regulator LDO memiliki drop tegangan yang agak tinggi. Kembali, saya sekarang berpikir bahwa ada baiknya mencoba menghubungkan dioda secara seri dengan sumber 4 V untuk mendapatkan 3.3-3.4 V, tetapi solusi saya berhasil; ESP32 cukup bersahaja.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/021/93d/abe/02193dabe8880ceeea91807ec0a16d2f.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menyolder semua konektor, saya harus berurusan dengan mekanik. </font><font style="vertical-align: inherit;">Itu adalah proyek "cepat dan kotor", dan saya sudah menyolder konektor ESP-Cam sebelumnya, jadi untuk menyelaraskan kamera dengan lubang, Anda bisa melakukannya dengan beberapa gasket dan banyak epoksi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e62/f14/364/e62f143645504bfd1636cab8fdb3cdf8.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah operasi ini, masalah terakhir tetap ada: LED di sebelah kamera bersinar pada bingkai jendela, menyebabkan semua jenis artefak aneh. </font><font style="vertical-align: inherit;">Pertama-tama, untuk menghilangkannya, saya memotong bezel kecil dari selotip aluminium untuk melindungi kamera dari cahaya langsung.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa7/1a8/1bb/fa71a81bb0a3131132885840f8186e85.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah kedua adalah aplikasi cat akrilik. </font><font style="vertical-align: inherit;">Ini adalah sisipan plastik tempat semua difuser berada, di mana LED bersinar. </font><font style="vertical-align: inherit;">Saya sudah memperbesar lubang yang ada untuk mikrofon di dalamnya untuk membuat bingkai jendela yang lebih lebar untuk kamera, tetapi ini menyebabkan masalah lain - lubang itu terlalu mencolok dan terlalu banyak cahaya yang tersebar jatuh di kamera. </font><font style="vertical-align: inherit;">Noda cat akrilik hitam cukup baik pada kedua masalah; </font><font style="vertical-align: inherit;">kamera masih menerima cukup banyak cahaya dari LED, tetapi sekarang tidak membanjiri sepenuhnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, transplantasi otak sudah selesai dan tubuh siap untuk berkumpul. </font><font style="vertical-align: inherit;">Anda dapat memulai perangkat lunak.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perangkat lunak</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari beralih ke perangkat lunak. Pertama-tama, kita perlu mengendalikan driver LED. Ini tidak sulit: sinyal driver hampir secara langsung konsisten dengan antarmuka periferal SPI chip ESP32: bantalan CLK pada papan terhubung ke antarmuka CLK periferal SPI, pad DA pada papan terhubung ke MOSI sinyal SPI. Ini akan memungkinkan Anda untuk menyinkronkan 256 bit dengan rantai driver LED: masing-masing bit yang disinkronkan mengaktifkan atau menonaktifkan LED yang sesuai. Selain itu, ada pintu masuk LAK. Jika sinyalnya rendah, maka LED mempertahankan nilainya sebelumnya, terlepas dari apa yang ditransfer ke register shift; jika sinyalnya tinggi, maka semuanya secara bersamaan beralih ke nilai-nilai yang saat ini ada dalam register geser. Akhirnya, ada input EN yang menghidupkan atau mematikan semua LED;Saya tidak menghubungkannya ke GPIO dan selalu menyalakan LED secara terprogram.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, saya sekarang dapat menghidupkan dan mematikan LED individu, mendapatkan tampilan hitam dan putih. Namun, saya butuh sesuatu yang lain. Dengan daya komputasi yang memadai, layar juga harus mampu menampilkan nuansa abu-abu - untuk ini, Anda hanya perlu menghidupkan / mematikan LED lebih cepat daripada yang dilihat mata. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengimplementasikan ini dengan satu LED, saya biasanya menggunakan PWM, tetapi dalam kasus 256 LED, ini akan mengambil bagian yang signifikan dari kekuatan prosesor ESP32. Jadi sebagai gantinya, saya memutuskan untuk menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modulasi Kode Biner</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (juga disebut Bit Angle Modulation). Ini adalah teknik yang memungkinkan Anda untuk mendapatkan nuansa abu-abu dengan daya CPU lebih sedikit. Saya sudah berhasil menggunakannya di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyek lain</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jadi saya yakin itu akan berhasil.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e99/009/265/e990092656bfd3db2032718f55e7e086.jpg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan itu berhasil. Saya juga menambahkan tabel pencarian untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengubah cahaya CIE ke PWM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena mata pada dasarnya merespons kecerahan LED non-linear; tabel pencarian memperbaiki masalah ini. Pada akhirnya, saya berhasil mencapai jumlah yang cukup dari skala abu-abu dan skala linear dari kecerahan optik sesuai dengan nilai piksel yang saya tetapkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak sulit untuk mengimplementasikan proyek kamera: ada komponen ESP-IDF yang dapat ditambahkan ke proyek; dia akan mengatur kamera dan bertukar data dengannya, Anda hanya perlu menentukan parameter yang Anda butuhkan, dan kemudian meminta bitmap yang dilihat kamera. Satu-satunya hal yang tidak dapat saya gunakan dalam pengaturan standar adalah bahwa penyelarasan otomatis dan eksposur otomatis diaktifkan secara default, dan ini cukup mengganggu cara saya mengendalikan LED: tergantung pada bagian mana dari urutan Modulasi Kode Biner gambar diciptakan, kamera agak meningkatkan atau mengurangi perataan dan eksposur secara acak. Saya memperbaiki masalah dengan mengalihkan kamera ke penyelarasan manual dan kecepatan rana; kode itu sendiri memeriksa gambar dan menentukan apakah parameter ini perlu kompensasi.Berkat pemrosesan manual seperti itu, saya juga berhasil mengecualikan piksel yang melihat langsung ke LED untuk benar-benar menghapusnya dari persamaan. Ini juga sangat membantu dalam mendapatkan gambar yang stabil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang saya punya kamera dan kanvas 16x16 dalam nuansa abu-abu. Apa yang harus saya lakukan dengan mereka? Saya mendapat ide: pada saat komputer Macintosh pertama, ada ekstensi populer yang hanya menambahkan beberapa mata kartun ke menu bar. Mata ini hanya mengikuti kursor. (Variasi tema ini untuk Linux / Unix yang disebut "xeyes" masih ada.) Bagaimana jika saya mencoba mengulanginya di kehidupan nyata?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d1/c9e/0a1/6d1c9e0a114c84f246c051c4358cdcc7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai permulaan, saya perlu beberapa gambar mata. Saya tidak berpikir bahwa saya bisa menggambar sesuatu yang berharga, jadi saya memutuskan untuk menggunakan mata saya sendiri sebagai gambar dasar; menonton video pendek tempat saya menonton dan berkedip ke segala arah. Perlu dipertimbangkan bahwa karena situasi saat ini saya memiliki sedikit alat profesional: Saya berbaring di lantai untuk memaksimalkan pencahayaan yang jatuh dari langit-langit lampu neon dan mendapatkan gambar yang dapat dibaca; Semua video diambil di smartphone yang saya pegang.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena data awal agak ceroboh, saya harus bekerja keras pada pasca-pemrosesan. Saya mulai dengan memotong sebuah fragmen yang kira-kira ada di sekitar mata kanan saya. Lalu saya mengubah setiap frame video menjadi gambar dan menghapus semua gambar yang berlebihan; pada akhirnya saya memiliki pilihan gambar yang bagus dari saya melihat ke arah yang berbeda, serta beberapa bingkai dengan berkedip. Namun, karena saya menggunakan ponsel untuk merekam, video itu ternyata agak goyah dan gambarnya dilewati. Untuk mengatasinya, saya melewati serangkaian gambar melalui program </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">lem</font></a><font style="vertical-align: inherit;"> gambar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang biasanya digunakan untuk panorama dan gambar HDR; di pintu keluar, saya mendapat gambar yang berpusat di bagian wajah saya. Sekarang saya hanya bisa menandai ke arah mana saya melihat, dan apakah saya berkedip. Saya melakukan ini dengan terlebih dahulu mengonversi semua gambar ke nuansa abu-abu dan kemudian mengunggahnya ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gimp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dalam setiap gambar, saya menggunakan titik merah untuk menunjukkan lokasi pusat murid, ditambah titik merah di sudut kiri atau kanan untuk menunjukkan jika saya berkedip, dan jika saya berkedip, maka mata saya setengah terbuka, atau tertutup.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb6/112/a73/bb6112a73c7b9fbdb619afaff1b971c9.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menandai setiap gambar dengan cara ini, menjadi sangat mudah untuk menulis skrip untuk mendapatkan lokasi murid, serta keadaan berkedip. Script juga meningkatkan gambar ke 16x16 dan menyimpannya sebagai data biner mentah, siap ditulis ke firmware modul ESP-CAM. Pada akhirnya, saya mendapat satu set gambar dan indeks di mana murid berada dan dalam keadaan apa mata berkedip itu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-Cam memiliki komponen perpustakaan kamera yang cukup mudah digunakan untuk ESP-IDF, jadi mendapatkan gambar itu mudah. Saya mengatur pengambilan 120x160 gambar dalam nuansa abu-abu, karena mereka adalah yang termudah untuk diproses, dan saya tidak perlu banyak resolusi, karena hasil akhirnya harus ditampilkan pada layar 16x16. Namun, saya masih memiliki masalah perangkat keras: kamera masih terlalu dekat dengan LED.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb1/d78/621/cb1d786213e7450791968f0e7da4d6c3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada awalnya, saya mencoba menyelesaikannya dengan kalibrasi: ketika perangkat dinyalakan, dibutuhkan dua gambar: satu dengan LED dekat dengan lensa kamera, dan satu hanya dengan LED yang terletak jauh dari kamera. Mengurangi satu gambar dari yang lain, Anda dapat memahami piksel mana yang dipengaruhi oleh LED. Pixel ini disimpan dalam mask; piksel yang ditandai dalam topeng kemudian diabaikan. Gambar di atas menunjukkan dua pemotretan dan topeng.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan gambar yang lebih bersih, saya bisa beralih ke pengenalan gerakan. Saya menerapkannya dengan mendapatkan bingkai dari kamera dan mengurangi bingkai sebelumnya dari itu. Kemudian saya bisa menghitung jumlah gerakan dengan menambahkan semua piksel yang dihasilkan. Lebih lanjut, adalah mungkin untuk menghitung lokasi konsentrasi gerak dengan mengambil rata-rata koordinat semua piksel yang tertimbang oleh perbedaan bingkai dalam piksel ini. Pada akhirnya, sihir penyaringan dilakukan agar perangkat tidak terlihat tersentak seperti jack Russell Terrier dengan ADHD: untuk menarik perhatiannya, objek harus bergerak lebih seragam atau bergerak cukup jauh.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya ada satu masalah: ketika hari sangat gelap, algoritme pengenalan gerakan kadang-kadang bekerja pada pantulan LED pada benda mengkilap di ruangan: jika mata berkedip, maka perhatikan pantulannya sendiri. </font><font style="vertical-align: inherit;">Ini bukan yang saya inginkan, jadi saya menghindari masalah ini dengan membuat algoritma pengenalan gerakan "buta" ketika mengubah gambar pada LED; </font><font style="vertical-align: inherit;">jadi saya menghentikan perilaku ini. </font><font style="vertical-align: inherit;">Selain itu, ini juga sedikit lebih realistis: ketika Anda berkedip, Anda tidak dapat melihat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Firmware memiliki beberapa mode debugging yang menunjukkan seluruh proses. </font><font style="vertical-align: inherit;">Berikut adalah video singkat yang menggambarkan hal ini:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bR-CpMdz02I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi sekarang saya memiliki perangkat yang mengikuti saya ... tidak terlalu berguna, saya setuju. </font><font style="vertical-align: inherit;">Tapi itu menarik bagi saya untuk membuatnya, dan jika saya menemukan sesuatu yang lebih bermanfaat yang dapat diimplementasikan pada layar LED 16x16, maka saya dapat melakukannya, karena saya sudah memiliki kode kontrol. </font><font style="vertical-align: inherit;">Berbicara tentang kode: Anda dapat dengan bebas mengunduh hasil mentah saya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Semoga Anda menikmatinya dan berhati-hati.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UCPUPO21Cwk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495168/index.html">Bentuk alternatif dari operator ternary Python</a></li>
<li><a href="../id495170/index.html">Apa yang terdengar sementara hilang dari kehidupan kita, dan yang kembalinya tidak layak menunggu - diskusi</a></li>
<li><a href="../id495174/index.html">Freelance profesional</a></li>
<li><a href="../id495176/index.html">Memperbaiki serialisasi objek di Kotlin sekali dan untuk semua</a></li>
<li><a href="../id495178/index.html">Sudah waktunya untuk situs gratis</a></li>
<li><a href="../id495184/index.html">Kesulitan substitusi impor: alat untuk perusahaan negara dihapus dari registri perangkat lunak dalam negeri</a></li>
<li><a href="../id495188/index.html">Kesulitan dalam mengajar bahasa asing (saya juga akan merekomendasikan kepada siswa)</a></li>
<li><a href="../id495192/index.html">Skrip peluncuran server Minecraft yang sempurna</a></li>
<li><a href="../id495194/index.html">STM-32 Papan Audio Minimum</a></li>
<li><a href="../id495196/index.html">Jika IB memiliki "Penghargaan Darwin", atau 7 cerita tentang kebodohan, sampah, mudah tertipu dan konsekuensinya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>