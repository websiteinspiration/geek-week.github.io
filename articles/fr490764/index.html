<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÉüèº ‚ô®Ô∏è üåú Grafana, InfluxDB, deux balises et un montant. Ou comment calculer la somme des sous-groupes? ü¶ó üåã üéª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! 
 
 Engag√© dans des tests de performance. Et j'aime vraiment configurer la surveillance et profiter des m√©triques dans Grafana . Et la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Grafana, InfluxDB, deux balises et un montant. Ou comment calculer la somme des sous-groupes?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/490764/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ol/b6/9a/olb69a8cdqhqtmjf-ic8x8qjevi.png"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour √† tous! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Engag√© dans des tests de performance. </font><font style="vertical-align: inherit;">Et j'aime vraiment configurer la surveillance et profiter des m√©triques dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et la norme de stockage des m√©triques dans les outils de chargement est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous pouvez enregistrer des m√©triques √† partir d'outils populaires tels que:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="  Apache.JMeter
Real-time results

In this document we will present the configuration setup to graph and historize the data in different backends:

 ‚Ä¢ InfluxDB setup for InfluxDBBackendListenerClient
 ‚Ä¢ InfluxDB setup for GraphiteBackendListenerClient
 ‚Ä¢ Grafana
 ‚Ä¢ Graphite"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache.JMeter</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="  Gatling
Realtime monitoring

The sections below describe how to configure Gatling with InfluxDB and Graphite, and use Grafana as a graphing library"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gatling</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="  LoadRunner Enterprise
Manage analysis servers

This section describes how to configure external analysis database servers to be used with LoadRunner Enterprise"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entreprise Loadrunner</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="  Yandex.Tank
Modules / Artifact uploaders / InfluxDB

      Yandex.Tank  InfluxDB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En travaillant avec des outils de test de performances et leurs m√©triques, j'ai accumul√© une s√©lection de recettes de programmation pour le bundle de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je propose de consid√©rer un probl√®me int√©ressant qui se pose lorsqu'il existe une m√©trique avec deux balises ou plus. </font><font style="vertical-align: inherit;">Je pense que ce n'est pas rare. </font><font style="vertical-align: inherit;">Et dans le cas g√©n√©ral, la t√¢che ressemble √† ceci: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculer la m√©trique totale pour un groupe, qui est divis√©e en sous-groupes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a trois options: </font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juste le montant regroup√© par balise Type</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chemin Grafana. </font><font style="vertical-align: inherit;">Nous utilisons une pile de valeurs</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somme des sommets avec sous-requ√™te</font></font></a></li>
</ol> <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment tout a commenc√©</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuration de la surveillance du MBean JVM √† l'aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jolokia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegraf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et il a visualis√© les m√©triques par pools de m√©moire - combien de m√©moire est allou√©e par chaque pool de m√©moire dans HEAP et au-del√†. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Graphiques sur les pools de m√©moire JVM et l'activit√© du garbage collector de 13h00 de la veille √† 01h00 de la nuit du jour (p√©riode de 12 heures). Ici vous pouvez voir que les pools de m√©moire sont divis√©s en deux groupes: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et que vers 17h00 il y avait la </font><font style="vertical-align: inherit;">collecte des ordures, apr√®s quoi la taille des pools de m√©moire a </font><font style="vertical-align: inherit;">diminu√©: </font><font style="vertical-align: inherit;">
Pour m√©triques recueillir sur les </font><font style="vertical-align: inherit;">pools de m√©moire, je a </font><font style="vertical-align: inherit;">pr√©cis√© les </font><font style="vertical-align: inherit;">param√®tres suivants </font><font style="vertical-align: inherit;">dans le </font><b><font style="vertical-align: inherit;">Telegraf</font></b><font style="vertical-align: inherit;"> fichier de configuration </font><font style="vertical-align: inherit;">: </font><b><font style="vertical-align: inherit;">telegraf.conf</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ow/ow/os/owowosl0e-neglcsbew-0u7bjjq.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<pre><code class="apache hljs">[<span class="hljs-attribute">outputs</span>.influxdb]
  <span class="hljs-attribute">urls</span> =<span class="hljs-meta"> ["http://influxdb_server:8086"]</span>
  <span class="hljs-attribute">database</span> = <span class="hljs-string">"telegraf"</span>
  <span class="hljs-attribute">username</span> = <span class="hljs-string">"login-InfluxDb"</span>
  <span class="hljs-attribute">password</span> = <span class="hljs-string">"*****"</span>
  <span class="hljs-attribute">retention_policy</span> = <span class="hljs-string">"month"</span>
  <span class="hljs-attribute">influx_uint_support</span> = false<font></font>
<font></font>
[<span class="hljs-attribute">agent</span>]
  <span class="hljs-attribute">collection_jitter</span> = <span class="hljs-string">"2s"</span>
  <span class="hljs-attribute">interval</span> = <span class="hljs-string">"2s"</span>
  <span class="hljs-attribute">precision</span> = <span class="hljs-string">"s"</span><font></font>
<font></font>
[[<span class="hljs-attribute">inputs</span>.jolokia<span class="hljs-number">2</span>_agent]]
  <span class="hljs-attribute">username</span> = <span class="hljs-string">"login-Jolokia"</span>
  <span class="hljs-attribute">password</span> = <span class="hljs-string">"*****"</span>
  <span class="hljs-attribute">urls</span> =<span class="hljs-meta"> ["http://127.0.0.1:7777/jvm-service"]</span><font></font>
<font></font>
[[<span class="hljs-attribute">inputs</span>.jolokia<span class="hljs-number">2</span>_agent.metric]]
  <span class="hljs-attribute">paths</span> =<span class="hljs-meta"> ["Usage","PeakUsage","CollectionUsage","Type"]</span>
  <span class="hljs-attribute">name</span> = <span class="hljs-string">"java_memory_pool"</span>
  <span class="hljs-attribute">mbean</span> = <span class="hljs-string">"java.lang:name=*,type=MemoryPool"</span>
  <span class="hljs-attribute">tag_keys</span> =<span class="hljs-meta"> ["name"]</span><font></font>
<font></font>
[[<span class="hljs-attribute">processors</span>.converter]]<font></font>
  [<span class="hljs-attribute">processors</span>.converter.fields]
    <span class="hljs-attribute">integer</span> =<span class="hljs-meta"> ["CollectionUsage.*", "PeakUsage.*", "Usage.*"]</span>
    <span class="hljs-attribute">tag</span> =<span class="hljs-meta"> ["Type"]</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana, j'ai</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> construit une demande √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour afficher dans les graphiques la valeur m√©trique maximale </font></font><b><code>Usage.Committed</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour une p√©riode de temps avec un pas </font></font><b><code>$granularity</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1m) et regroup√©e par deux balises </font></font><b><code>Type</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(HEAP ou NON_HEAP) et </font></font><b><code>name</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Metaspace, G1 Old Gen, ...): </font><font style="vertical-align: inherit;">
La m√™me demande sous forme de texte, en tenant compte de toutes les variables de </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> (attention √† l'√©chappement des valeurs des variables avec </font><font style="vertical-align: inherit;">- c'est important pour que la requ√™te fonctionne correctement):</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/qx/2z/-2/qx2z-2mblgxyi-u6g4mrbyvybf8.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><code>:regex</code></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^${jolokia:regex}$/ <span class="hljs-keyword">AND</span><font></font>
    $timeFilter<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-built_in">time</span>($granularity)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La m√™me requ√™te sous forme de texte, en tenant compte des valeurs sp√©cifiques des variables </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^serverName$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^<span class="hljs-keyword">http</span>:\/\/<span class="hljs-number">127</span>\<span class="hljs-number">.0</span>\<span class="hljs-number">.0</span>\<span class="hljs-number">.1</span>:<span class="hljs-number">7777</span>\/jvm-service$/ <span class="hljs-keyword">AND</span>
    <span class="hljs-built_in">time</span> &gt;= <span class="hljs-number">1583834400000</span>ms <span class="hljs-keyword">and</span> <span class="hljs-built_in">time</span> &lt;= <span class="hljs-number">1583877600000</span>ms
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>m)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le regroupement par heure </font></font><b><code>GROUP BY time($granularity)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><b><code>GROUP BY time(1m)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permet de r√©duire le nombre de points sur le graphique. </font><font style="vertical-align: inherit;">Pour une dur√©e de 12 heures et un pas de regroupement de 1 minute, on obtient: 12 x 60 = 720 fois soit 721 points (le dernier point avec une valeur nulle).</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N'oubliez pas que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">721</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le nombre attendu de points en r√©ponse aux demandes √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec les param√®tres actuels pour l'intervalle de temps (12 heures) et l'√©tape de regroupement (1 minute).</font></font></blockquote> <br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pool de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
m√©moire </font><b><font style="vertical-align: inherit;">NON_HEAP: Metaspace</font></b><font style="vertical-align: inherit;"> (bleu) est en t√™te de la consommation de m√©moire √† 20h00. </font><font style="vertical-align: inherit;">Et selon </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP: G1 Old Gen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (jaune), il y a eu une petite surtension locale √† 17h03. </font><font style="vertical-align: inherit;">Et au moment de 20h00, au total, tous les </font><font style="vertical-align: inherit;">pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP ont</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> laiss√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172,5 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (113,2 + 45,9 + 13,4) et les </font><font style="vertical-align: inherit;">pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (67 + 57 + 4).</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ku/mo/wf/kumowfdo6gkw3wx_b8mugtsp8l4.png"></a><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N'oubliez pas les valeurs de 20:00: </font><font style="vertical-align: inherit;">pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172,5 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><font style="vertical-align: inherit;">pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous nous concentrerons sur ces valeurs √† l'avenir.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le contexte de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous avons facilement obtenu la valeur m√©trique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le contexte de la balise de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uniquement </font><font style="vertical-align: inherit;">, la valeur m√©trique est √©galement facile √† obtenir, car tous les noms des pools de m√©moire sont uniques et il suffit de ne laisser le regroupement des r√©sultats que par </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La question demeure: comment obtenir quelle taille est allou√©e pour tous les pools HEAP et tous les pools NON_HEAP au total?</font></font></blockquote><br>
<a name="1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Juste le montant regroup√© par balise Type</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">Somme regroup√©e par balise</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re solution qui peut vous venir √† l'esprit est de regrouper les valeurs par la balise </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de calculer la somme des valeurs dans chaque groupe. </font><font style="vertical-align: inherit;">Une telle requ√™te ressemblera √† ceci: Une </font><font style="vertical-align: inherit;">
repr√©sentation textuelle d'une demande de calcul de somme regroup√©e par balise </font><b><font style="vertical-align: inherit;">Type</font></b><font style="vertical-align: inherit;"> avec toutes les variables </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/xz/w_/4a/xzw_4aonrgekrw4onxv9fwcctlg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^${jolokia:regex}$/ <span class="hljs-keyword">AND</span><font></font>
    $timeFilter<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une requ√™te valide, mais elle ne renverra que deux points: la somme sera calcul√©e avec le regroupement uniquement par la balise </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec deux valeurs (HEAP et NON_HEAP). </font><font style="vertical-align: inherit;">Nous ne verrons m√™me pas le calendrier. </font><font style="vertical-align: inherit;">Il y aura deux points autonomes avec une √©norme somme de valeurs (plus de 3 TiB): </font><font style="vertical-align: inherit;">
Une telle somme ne convient pas, une ventilation en intervalles de temps est n√©cessaire.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/sz/lx/bo/szlxboh0o4r3-jsq7jg9d49wnic.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2. </font><font style="vertical-align: inherit;">Montant group√© par tag par minute</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la requ√™te d'origine, nous avons regroup√© les mesures selon un intervalle de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">granularit√© $</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> personnalis√© </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Faisons le regroupement maintenant par un intervalle personnalis√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette requ√™te se r√©v√©lera, elle a ajout√© </font></font><b><code>GROUP BY time($granularity)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Nous obtenons des valeurs gonfl√©es, au lieu de 172,5 </font><b><font style="vertical-align: inherit;">Mio</font></b><font style="vertical-align: inherit;"> par </font><b><font style="vertical-align: inherit;">NON_HEAP,</font></b><font style="vertical-align: inherit;"> nous voyons 4,88 Gio: </font><font style="vertical-align: inherit;">
√âtant donn√© que les mesures sont envoy√©es √† InfluxDB une fois toutes les 2 secondes (voir </font><b><font style="vertical-align: inherit;">telegraf.conf</font></b><font style="vertical-align: inherit;"> ci-dessus), la somme des lectures en une minute ne donnera pas le montant dans le moment, et la somme de trente de ces montants. </font><font style="vertical-align: inherit;">Nous ne pouvons pas non plus </font><font style="vertical-align: inherit;">
diviser le r√©sultat par la constante </font><b><font style="vertical-align: inherit;">30</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√âtant donn√© que </font><b><font style="vertical-align: inherit;">$ granularity</font></b><font style="vertical-align: inherit;"> est un param√®tre, il peut √™tre d√©fini sur 1 minute et 10 minutes. </font><font style="vertical-align: inherit;">Et la valeur du montant va changer.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/yb/xp/tw/ybxptwbmibq2xlujuuwbkwb83nq.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/9l/lo/hn/9llohn9ncpoztbtcsrfqzfzoqya.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3. </font><font style="vertical-align: inherit;">Tag group√© par seconde</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'obtenir correctement la valeur m√©trique pour l'intensit√© de collecte m√©trique actuelle (2 secondes), vous devez calculer le montant pour un intervalle fixe qui ne d√©passe pas l'intensit√© de collecte m√©trique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons d'afficher les statistiques avec un regroupement en quelques secondes. Ajouter au </font></font><b><code>GROUP BY</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regroupement </font></font><b><code>time(1s)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Avec une si petite granularit√©, nous obtenons un grand nombre de points pour notre intervalle de temps de 12 heures (12 heures * 60 minutes * 60 secondes = 43 200 intervalles, 43 201 points par ligne, dont le dernier est nul): </font><font style="vertical-align: inherit;">
43 201 points dans chaque ligne du graphique. Il y a tellement de </font><b><font style="vertical-align: inherit;">points qu'InfluxDB</font></b><font style="vertical-align: inherit;"> formera une r√©ponse pendant longtemps, </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> prendra une r√©ponse plus longtemps, puis le navigateur attirera un si grand nombre de points pendant longtemps.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/vn/sl/q_/vnslq_lq48mzzh9hgmjwiuvcy2i.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/_2/mw/4k/_2mw4ki9rcnf140m2doyqsn-zxy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et pas √† chaque seconde, il y a des points: les mesures ont √©t√© collect√©es toutes les 2 secondes, et regroup√©es par seconde, ce qui signifie que chaque deuxi√®me point sera nul. Pour voir une ligne fluide, configurez la connexion des valeurs non vides. Sinon, nous ne verrons pas les graphiques: </font><font style="vertical-align: inherit;">
auparavant, </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> √©tait tel que le navigateur se </font><b><font style="vertical-align: inherit;">bloquait</font></b><font style="vertical-align: inherit;"> lors du dessin d'un grand nombre de points. Maintenant, la version de </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> a la possibilit√© de dessiner plusieurs dizaines de milliers de points: le navigateur saute simplement certains d'entre eux, dessine un graphique en utilisant les donn√©es amincies. Mais le graphique est liss√©. Les sommets sont affich√©s comme des sommets moyens.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/xx/ya/hf/xxyahfkl3xzk6ezsakvgsbi8lp4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, il y a un graphique, il est affich√© avec pr√©cision, les mesures √† 20h00 sont calcul√©es correctement, les mesures dans la l√©gende du graphique sont calcul√©es correctement. </font><font style="vertical-align: inherit;">Mais le graphique est liss√©: les rafales n'y sont pas visibles avec une pr√©cision de 1 seconde. </font><font style="vertical-align: inherit;">En particulier, la surtension </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† 17:03 a disparu du graphique, le graphique </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">tr√®s lisse: le </font><font style="vertical-align: inherit;">
moins dans les performances se manifestera clairement sur un intervalle de temps plus long. </font><font style="vertical-align: inherit;">Si vous essayez de construire un graphique en un mois (720 heures), et non en 12 heures, alors tout g√®lera avec une si petite granularit√© (1 seconde), il y aura trop de points. </font><font style="vertical-align: inherit;">Et il y a un moins en l'absence de pics, un paradoxe - en </font><b><font style="vertical-align: inherit;">raison de la grande pr√©cision d'obtention des m√©triques, nous obtenons une faible pr√©cision de leur affichage</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/1g/vs/m8/1gvsm8owfg-ifjjcqwf-w1q2lbk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a name="2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Chemin Grafana. </font><font style="vertical-align: inherit;">Nous utilisons une pile de valeurs</font></font></h2><br><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">Il n'a</font></b><font style="vertical-align: inherit;"> pas </font><b><font style="vertical-align: inherit;">√©t√©</font></b><font style="vertical-align: inherit;"> possible </font><font style="vertical-align: inherit;">
de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr√©er une</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solution simple et productive avec </font><b><font style="vertical-align: inherit;">InfluxDB</font></b><font style="vertical-align: inherit;"> et le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concepteur de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> requ√™tes </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous essaierons uniquement d'utiliser les outils </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana pour</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©sumer les m√©triques </font><b><font style="vertical-align: inherit;">affich√©es</font></b><font style="vertical-align: inherit;"> dans le graphique d'origine. </font><font style="vertical-align: inherit;">Et oui, c'est possible!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1. </font><font style="vertical-align: inherit;">Il suffit de faire une info-bulle Hover / valeur empil√©e: cummulative</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous laisserons la demande de choix des m√©triques inchang√©e, la m√™me que dans la section ¬´Comment tout a commenc√©¬ª: les </font><font style="vertical-align: inherit;">
m√©triques seront regroup√©es par </font><b><font style="vertical-align: inherit;">type</font></b><font style="vertical-align: inherit;"> et </font><b><font style="vertical-align: inherit;">nom</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mais nous afficherons uniquement la balise </font><b><font style="vertical-align: inherit;">Type</font></b><font style="vertical-align: inherit;"> dans les noms des graphiques </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Et dans les param√®tres de visualisation, nous regrouperons les m√©triques par piles </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">
Tout d'abord, ajoutez la s√©paration de deux balises en deux piles A et B diff√©rentes, afin que leurs valeurs ne se croisent pas:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/s5/an/3e/s5an3errkt29lgc8byme6tnowz4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ls/vg/to/lsvgtohynssezzeiy04px0qwq3c.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/no/py/5g/nopy5ggb9ittxbz2phdei1egphg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter un remplacement de s√©rie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / HEAP / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : A</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter un remplacement de s√©rie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / NON_HEAP / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : B</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configurez ensuite la visualisation des m√©triques pour afficher les valeurs totales dans une info-bulle avec des graphiques:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stacking &amp; Null value</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : On</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Info-bulle de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> survol </font><font style="vertical-align: inherit;">/ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur empil√©e</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : cumulatif</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infobulle</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mode de </font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">survol</font></b><font style="vertical-align: inherit;"> : simple</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison des diff√©rentes fonctionnalit√©s de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous devez effectuer des actions dans cet ordre. </font><font style="vertical-align: inherit;">Si vous modifiez l'ordre des actions ou laissez certains champs avec des param√®tres par d√©faut, quelque chose ne fonctionnera pas:</font></font><br>
<br>
<ul>
<li>    Stack <b>A</b>  <b>B</b>    <b>Stacking &amp; Null value</b> / <b>Stack</b>: On,    ;</li>
<li>  <b>Hover tooltip / Mode</b>    ,    <b>Single</b>,  <b>Hover tooltip</b>    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, nous voyons beaucoup de lignes, telles que nous-m√™mes. </font><font style="vertical-align: inherit;">Mais! </font><font style="vertical-align: inherit;">Si vous </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">survolez</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le </font><b><font style="vertical-align: inherit;">NON_HEAP</font></b><font style="vertical-align: inherit;"> le plus </font><b><font style="vertical-align: inherit;">haut</font></b><font style="vertical-align: inherit;"> , l'info-bulle affichera la somme des valeurs de tous les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le montant est consid√©r√© comme vrai, d√©j√† par </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signifie </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Et si vous </font><b><font style="vertical-align: inherit;">survolez</font></b><font style="vertical-align: inherit;"> le graphique le plus haut avec le nom </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> , nous verrons le montant par </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le graphique s'affiche correctement. </font><font style="vertical-align: inherit;">M√™me la surtension </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> √† 17 h 03 est visible: </font><font style="vertical-align: inherit;">
officiellement, la t√¢che est termin√©e. </font><font style="vertical-align: inherit;">
Mais il y a des inconv√©nients - de nombreux graphiques suppl√©mentaires sont affich√©s. </font><font style="vertical-align: inherit;">Vous devez placer le curseur tout en haut. </font><font style="vertical-align: inherit;">Et dans la l√©gende du graphique, non cumulative, mais des valeurs individuelles sont affich√©es, de sorte que la l√©gende est devenue inutile.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/p9/tx/tw/p9txtwio9i4uozvliutk5_dg13o.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/g5/78/bo/g578boco1u0sncwf0jmh8ejsyow.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2. </font><font style="vertical-align: inherit;">Valeur empil√©e: cumulative avec masquage des lignes interm√©diaires</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Corrigeons le premier inconv√©nient de la solution pr√©c√©dente: assurez-vous que les graphiques suppl√©mentaires ne sont pas affich√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour √ßa:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez de nouvelles mesures avec un nom diff√©rent et une valeur 0 aux r√©sultats.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez de nouvelles mesures √† la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pile A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et √† la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pile B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en haut de la pile.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cacher de l'√©cran - les lignes originales de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous en ajoutons deux nouveaux apr√®s la requ√™te principale: la requ√™te </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour la r√©ception d'une s√©rie avec les valeurs 0 et le nom </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NON_HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la requ√™te </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour la r√©ception d'une s√©rie avec les valeurs 0 et le nom </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour obtenir 0, nous prenons dans chaque groupe de temps la premi√®re valeur du champ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Usage.committed¬ª</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la soustrayons: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first (¬´Usage.committed¬ª) - first (¬´Usage.committed¬ª)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - nous obtenons un 0 stable. Les noms des graphiques sont modifi√©s sans perte de sens en </font><font style="vertical-align: inherit;">raison des crochets: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NON_HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">[HEAP]</font></b><font style="vertical-align: inherit;"> et </font><b><font style="vertical-align: inherit;">HEAP sont</font></b><font style="vertical-align: inherit;"> combin√©s en </font><b><font style="vertical-align: inherit;">pile A</font></b><font style="vertical-align: inherit;"> , et cache aussi tous </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">[NON_HEAP]</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/no/kh/0f/nokh0fb2fp1t_ictdthli2etylg.png"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font><font style="vertical-align: inherit;">combiner </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cacher NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">Obtenez le</font></b><font style="vertical-align: inherit;"> 
montant exact par </font><b><font style="vertical-align: inherit;">[NON_HEAP]</font></b><font style="vertical-align: inherit;"> dans l'info - </font><font style="vertical-align: inherit;">bulle au survol de la carte: </font><font style="vertical-align: inherit;">
Obtenez le montant exact par </font><b><font style="vertical-align: inherit;">[HEAP]</font></b><font style="vertical-align: inherit;"> dans l'info - </font><font style="vertical-align: inherit;">bulle au survol de la carte. </font><font style="vertical-align: inherit;">Et m√™me toutes les rafales sont visibles: </font><font style="vertical-align: inherit;">
Et le planning se forme rapidement. </font><font style="vertical-align: inherit;">Mais la l√©gende affiche toujours 0, la l√©gende est devenue inutile. </font><font style="vertical-align: inherit;">
Tout a fonctionn√©! </font><font style="vertical-align: inherit;">Le vrai contournement passe par les piles de </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">C'est pour cette raison que l'article a √©t√© ajout√© √† la cat√©gorie </font><b><font style="vertical-align: inherit;">Programmation anormale</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/uf/zw/7s/ufzw7sw-oxjflnzkglbilrdgmw4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ga/mh/nz/gamhnzyw1thhnbi5mflkwrlvr_i.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/p_/tp/ev/p_tpevfzm7rwkc1534vyhe92ozg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a name="3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. La somme des sommets avec la sous-requ√™te</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque nous nous sommes d√©j√† engag√©s dans la voie d'une programmation anormale avec un tas de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , continuons. </font><font style="vertical-align: inherit;">Faisons en sorte </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu'InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retourne un petit nombre de points et faisons appara√Ætre la l√©gende.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1 Somme des incr√©ments de la somme cumul√©e des maxima</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Explorons les possibilit√©s d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Auparavant, j'ai souvent aid√© en prenant le d√©riv√© du montant cumul√©, nous allons donc essayer d'appliquer cette approche maintenant. </font><font style="vertical-align: inherit;">Passons au mode d'√©dition manuelle des requ√™tes: </font><font style="vertical-align: inherit;">
Faisons une telle requ√™te:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/om/-b/yt/om-bytkvhp5zisny6gw5io_g2ba.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"U"</span>) <span class="hljs-keyword">FROM</span> (
        <span class="hljs-keyword">SELECT</span> non_negative_difference(cumulative_sum(<span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>))) <span class="hljs-keyword">AS</span> <span class="hljs-string">"U"</span> 
        <span class="hljs-keyword">FROM</span> <span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span> 
        <span class="hljs-keyword">WHERE</span> <font></font>
            (<font></font>
                <span class="hljs-string">"host"</span> =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span> 
                <span class="hljs-string">"jolokia_agent_url"</span> =~ /^${jolokia:regex}$/<font></font>
            ) <span class="hljs-keyword">AND</span> <font></font>
            $timeFilter <font></font>
        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span><font></font>
)<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">"Type"</span>, <span class="hljs-built_in">time</span>($granularity)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, la valeur maximale de la m√©trique dans le groupe par le temps est prise et la somme de ces valeurs √† partir du moment o√π la r√©f√©rence commence, regroup√©es par les balises </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En cons√©quence, √† chaque instant du temps , </font><font style="vertical-align: inherit;">il y aura une somme de toutes les </font><font style="vertical-align: inherit;">indications par type ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) avec s√©paration par nom du pool, mais pas 30 valeurs sont additionn√©es, comme ce </font><font style="vertical-align: inherit;">fut le cas dans la </font><font style="vertical-align: inherit;">version 1.2, mais une </font><font style="vertical-align: inherit;">seule est le maximum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si nous prenons l'incr√©ment </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non_negative_difference</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d' </font><font style="vertical-align: inherit;">un tel montant cumul√© pour la derni√®re √©tape, nous obtenons la somme de tous les pools de donn√©es regroup√©s par </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><font style="vertical-align: inherit;">balises de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au moment o√π l'intervalle de temps a commenc√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, pour obtenir le montant par balise uniquement</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tapez</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sans regroupement par balise de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous devez effectuer une demande de niveau sup√©rieur avec des param√®tres de regroupement similaires, mais sans regroupement par </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la suite d'une requ√™te aussi complexe, nous obtenons la somme de tous les types. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Horaire parfait. </font><font style="vertical-align: inherit;">La somme des maxima est calcul√©e correctement. </font><font style="vertical-align: inherit;">Il existe une l√©gende avec les valeurs correctes, non nulles. </font><font style="vertical-align: inherit;">Dans l'info-bulle, vous pouvez afficher toutes les m√©triques, pas seulement Single. </font><font style="vertical-align: inherit;">M√™me les rafales </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s'affichent </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Une chose mais - la demande s'est av√©r√©e difficile: la somme de l'incr√©ment de la somme cumul√©e des maxima avec une modification du niveau de regroupement.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/an/yv/1t/anyv1t7m69cwrl6cnwgl-dwd7xy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 Somme des sommets avec changement de niveau de regroupement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pouvez-vous faire quelque chose de plus simple que dans la version 3.1? La bo√Æte de Pandore est d√©j√† ouverte, nous sommes pass√©s en mode d'√©dition de requ√™te manuelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On soup√ßonne que le fait de recevoir une augmentation du montant cumul√© conduit √† un effet nul - l'un √©teint l'autre. D√©barrassez-vous de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non_negative_difference (cumulative_sum (...))</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplifiez la demande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On laisse simplement la somme des maxima, avec une diminution du niveau de regroupement:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"A"</span>)
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">"A"</span>
    <span class="hljs-keyword">FROM</span> <span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span> 
    <span class="hljs-keyword">WHERE</span><font></font>
            (<font></font>
                <span class="hljs-string">"host"</span> =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span> 
                <span class="hljs-string">"jolokia_agent_url"</span> =~ /^${jolokia:regex}$/<font></font>
            ) <span class="hljs-keyword">AND</span> <font></font>
            $timeFilter<font></font>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span><font></font>
)<font></font>
<span class="hljs-keyword">WHERE</span> $timeFilter
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une requ√™te simple et rapide qui ne renvoie que 721 points par s√©rie en 12 heures, lorsqu'elle est regroup√©e par minutes: 12 (heures) * 60 (minutes) = 720 intervalles, 721 points (dernier vide). Veuillez noter que le filtre horaire est dupliqu√©. C'est dans la sous-requ√™te et dans la demande de regroupement: </font><font style="vertical-align: inherit;">
Sans </font><b><font style="vertical-align: inherit;">$ timeFilter,</font></b><font style="vertical-align: inherit;"> dans la demande de regroupement externe, le nombre de points retourn√©s ne sera pas de 721 en 12 heures, mais plus. Puisque la sous-requ√™te est regroup√©e pour l'intervalle </font><b><font style="vertical-align: inherit;">de</font></b><font style="vertical-align: inherit;"> ... </font><b><font style="vertical-align: inherit;">√†</font></b><font style="vertical-align: inherit;"> , et le regroupement d'une demande externe sans filtre sera pour l'intervalle </font><b><font style="vertical-align: inherit;">de</font></b><font style="vertical-align: inherit;"> ... </font><b><font style="vertical-align: inherit;">maintenant</font></b><font style="vertical-align: inherit;"> . Et si √† </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> un intervalle de temps qui ne dure pas X heures est s√©lectionn√© (pas tel que </font><b><font style="vertical-align: inherit;">to</font></b><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">now</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/8s/ab/tg/8sabtg9rebcu-tonmirjck2jdmk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), mais pour l'intervalle du pass√© ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√†</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maintenant</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), des points vides avec une valeur nulle √† la fin de la s√©lection appara√Ætront. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le graphique r√©sultant s'est av√©r√© √™tre simple, rapide et correct. </font><font style="vertical-align: inherit;">Avec une l√©gende qui affiche des m√©triques r√©capitulatives. </font><font style="vertical-align: inherit;">Avec info-bulle pour plusieurs lignes √† la fois. </font><font style="vertical-align: inherit;">Et aussi avec l'affichage de toutes les rafales de valeurs: </font><font style="vertical-align: inherit;">
Le r√©sultat est atteint!</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/an/yv/1t/anyv1t7m69cwrl6cnwgl-dwd7xy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©f√©rences (au lieu de r√©f√©rences)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Distributions des outils utilis√©s dans l'article:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grafana</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (6.5.0)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">influxdb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.7.9)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telegraf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.13.3)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jolokia-jvm-1.6.2-agent.jar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.6.2)</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Documentation sur les capacit√©s des outils utilis√©s dans l'article:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essence</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La description</font></font></th>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Politique de r√©tention</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB Data Retention</font></font></a></td>
<td>Retention policy <b>montn</b>   30  ,     JVM    .       <b>auto</b>,     .   ¬´  ¬ª   <b>telegraf.conf</b>      <b>InfluxDB</b>  ,      <b>Grafana</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">InfluxDB v1.x Output Plugin</a></td>
<td>    <b>Telegraf</b>  <b>InfluxDB</b>.     <b>telegraf.conf</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">agent / interval</a></td>
<td>   ,     2 .   ¬´  ¬ª   <b>telegraf.conf</b>.   ¬´1.2.       ¬ª  ¬´1.3.       ¬ª</td>
</tr>
<tr>
<td>Java 8 / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interface MemoryPoolMXBean</a></td>
<td>  MemoryPool,  ,     bool,  long.     <b>telegraf.conf</b>    int</td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jolokia2 Input Plugins</a></td>
<td>  <b>telegraf.conf</b>   MBean-,     <b>InfluxDB</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Converter Processor</a></td>
<td>  <b>telegraf.conf</b>,      <b>float</b>   <b>int</b>    <b>InfluxDB</b>.      <b>Type</b>   <b>Type</b>,        </td>
</tr>
<tr>
<td>Grafana / Variables / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Advanced Formatting Options / Regex</a></td>
<td> Grafana,    Multiselect    ,    ,     ,    <b><code>~ /^<u>${}</u>$/</code></b> ‚Äî ,  <b><code>~ /^${<u>:regex</u>}$/</code></b></td>
</tr>
<tr>
<td>Grafana / Variables / Global Built-in Variables / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The $timeFilter or $__timeFilter Variable</a></td>
<td> Grafana- <b>$timeFilter</b>,     </td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MAX()</a></td>
<td>  <b>MAX()</b>  <b>InfluxDB</b> 1.7,       </td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SUM()</a></td>
<td>    <b>SUM()</b>  <b>InfluxDB</b> 1.7</td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Subqueries</a></td>
<td>    <b>InfluxDB</b> 1.7,     3 </td>
</tr>
<tr>
<td>InfluxDB / Transformation / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CUMULATIVE_SUM()</a></td>
<td>  <b>CUMULATIVE_SUM()</b>,        <b>InfluxDB</b>,    <b>NON_NEGATIVE_DERIVATIVE()</b></td>
</tr>
<tr>
<td>InfluxDB / Transformation / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NON_NEGATIVE_DERIVATIVE()</a></td>
<td>  <b>NON_NEGATIVE_DERIVATIVE()</b>,     3 .     <b>CUMULATIVE_SUM()</b> ‚Äî          3</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Using Grafana‚Äôs Query Inspector to troubleshoot issues</a></td>
<td> <b>Query Inspector</b>,         ,        Grafana-</td>
</tr>
<tr>
<td>Grafana / Graph / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Draw Options</a></td>
<td>  Stack, Tooltip,‚Ä¶              ¬´2. Grafana-way.   ¬ª </td>
</tr>
<tr>
<td>Grafana / Graph / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Series overrides</a></td>
<td>       (     )  <b>Grafana</b></td>
</tr>
</tbody></table></div><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combinaison de Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit √™tre bien connue des ing√©nieurs de test de performance. Et dans ce bundle, de nombreuses t√¢ches simples sont tr√®s int√©ressantes et ne peuvent pas toujours √™tre r√©solues par des m√©thodes de programmation normales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois , les </font><font style="vertical-align: inherit;">comp√©tences de programmation anormales peuvent √™tre n√©cessaires avec les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caract√©ristiques </font><font style="vertical-align: inherit;">et les </font><font style="vertical-align: inherit;">subtilit√©s de la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> requ√™te </font><b><font style="vertical-align: inherit;">langage</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'article, des mesures ont √©t√© prises en compte pour quatre options d'impl√©mentation de la sommation d'une m√©trique regroup√©e par une balise, mais qui a plusieurs balises. La t√¢che √©tait int√©ressante. Et il existe de nombreuses t√¢ches de ce type. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pr√©pare un rapport sur les subtilit√©s de la programmation avec </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Je publierai p√©riodiquement des documents sur ce sujet. </font><font style="vertical-align: inherit;">En attendant, je serai heureux de vos questions sur l'article actuel.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490754/index.html">√âditeur de code de code Visual Studio. Le guide le plus d√©taill√© pour configurer et installer des plugins pour les d√©butants</a></li>
<li><a href="../fr490756/index.html">D√©ployer Jenkins comme code</a></li>
<li><a href="../fr490758/index.html">Les math√©maticiens ont prouv√© la loi universelle de la turbulence</a></li>
<li><a href="../fr490760/index.html">Recherche visuelle Ray Casting (RCVS). Algorithme simple et rapide pour trouver des mod√®les 3D similaires en g√©om√©trie</a></li>
<li><a href="../fr490762/index.html">Comment pr√©voir les billets d'avion?</a></li>
<li><a href="../fr490766/index.html">Comment comprendre un d√©butant, quelle langue choisir pour la profession souhait√©e?</a></li>
<li><a href="../fr490768/index.html">Quand les jeux informatiques sont votre m√©tier: le dispositif interne du cloud gaming</a></li>
<li><a href="../fr490770/index.html">√Ä bas la dette technique! √Ä TechLead Conf 2020, nous vous montrerons comment</a></li>
<li><a href="../fr490772/index.html">Comment r√©diger et publier un contrat intelligent dans le Telegram Open Network (TON)</a></li>
<li><a href="../fr490774/index.html">Sensible</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>