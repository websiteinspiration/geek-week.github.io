<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽🏼 😑 🐒 アニメーション化された状態グラフ 📣 🚴 🧛🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは！Playrixの私たちはUnity3Dを作ることにしました。そしてアニメーターがあります。この記事では、私たちが自宅でそれをどのように作成したか、そしてそれがどのように機能するかを説明します。
 
 
 アニメーショングラフのアーキテクチャの設計を開始したとき、もちろん、特にUnity ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>アニメーション化された状態グラフ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/471956/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは！</font><font style="vertical-align: inherit;">Playrixの私たちはUnity3Dを作ることにし</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そしてアニメーターがあります。</font><font style="vertical-align: inherit;">この記事では、私たちが自宅でそれをどのように作成したか、そしてそれがどのように機能するかを説明します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67b/a57/9de/67ba579dec3dab6038fcdfc5cc9aad25.png"></div></a><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーショングラフのアーキテクチャの設計を開始したとき、もちろん、特にUnity Animatorで他のアナログを調べました。</font><font style="vertical-align: inherit;">しかし、私たちはより普遍的な解決策を作りたかったのです。</font><font style="vertical-align: inherit;">同じUnityとは異なり、コントローラーインターフェイスを介してアニメーションの状態をカスタマイズできます。</font><font style="vertical-align: inherit;">しかし、最初に、アニメーション化された状態グラフが何であるかを理解する価値があります。</font><font style="vertical-align: inherit;">すでにこれに遭遇している場合は、導入部分をスキップして実装機能に進むことが理にかなっています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それでは、アニメーション化された状態グラフとは正確には何ですか？</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b20/d16/b78/b20d16b789def0dd88b8a65ee6deb99d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーション状態グラフを使用すると、異なるアニメーション状態間の遷移をグラフィカルに表すことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、キャラクターアニメーションを見てみましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/535/bf0/e94/535bf0e940d917fc81734e0747a71de1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
男性の3次元モデルがあり、男性のアニメーションがいくつかあります。&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイドル-静止しています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">歩く-進む;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">座っている</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは-手を振る。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーションを管理するための古典的なアプローチは次のとおりです。オブジェクトを立って-アイドル状態にして、歩いて-歩いて、座って-座ってほしい場合。</font><font style="vertical-align: inherit;">しかし、これにはいくつかの困難があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、アニメーションの継続時間とシーケンスを手動で制御する必要があります。</font><font style="vertical-align: inherit;">たとえば、人が座っている場合、最初にアニメーションを再生し、座っている方法を確認してから、その人がすでに座っているループアニメーションの再生を開始します。</font><font style="vertical-align: inherit;">コードでこれらのアニメーションのジョイントをカスタマイズすることは困難で不便です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、アニメーションの両端が一致しない場合、または現在のアニメーションの中央に別のアニメーションを含める必要がある場合、アニメーション間のジョイントが顕著になります。</font><font style="vertical-align: inherit;">この場合、アニメーションを完全に一致させることは不可能です。</font><font style="vertical-align: inherit;">キャラクターアニメーションが瞬時に切り替わる古いゲームを思い出してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーショングラフは、これらの問題に対処するように設計されています。これにより、アニメーションを手動で操作する必要がなくなり、状態で操作できるようになりました。この状態を実現するためにオブジェクトがどのようにアニメーション化されるかは、アニメーターとデザイナーの仕事です。これでプログラマーはアニメーションのタイミングとシーケンスを考慮せず、オブジェクトがどのような状態になるかを示すだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、アニメーショングラフを使用すると、アニメーションを結合する問題が解消されます。状態間の遷移では、あるアニメーションを別のアニメーションにスムーズに遷移させることができます。これは重みを使用して行われます。ウェイトは0から1までの混合係数です。0はアニメーションがオブジェクトにまったく影響を与えず、1は完全にオブジェクトに影響を与えることを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、プロセスのセットアップでは、ウォーキング（アイドル）とスタンディング（アイドル）の間の移行が非常に困難になります。</font><font style="vertical-align: inherit;">歩行アニメーションのどの時点でも、キャラクターは停止する可能性があります。</font><font style="vertical-align: inherit;">したがって、移行はすぐには実行されず、少しの間だけ実行されます。</font><font style="vertical-align: inherit;">このとき、歩行の重みは1から0に減少し、スタンディングの重みは0から1に増加します。重みの合計が1に等しいことが重要です。そうしないと、アーティファクトが発生する可能性があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのように機能しますか？</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94d/fc8/f36/94dfc8f3609b5f7353813ee40fa071b6.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフは、状態と遷移で構成されます。状態はアニメーションコントローラーのセットであり、それぞれがオブジェクトである種のアニメーションを再生したり、ある種のロジックを実行したりできます。コントローラーには入口と出口があります。これらは、このコントローラーでグラフが状態をオンにし、それに応じてオフにする瞬間です。コントローラーには更新機能もあり、最後のフレームからの時間間隔に加えて、トランジションの重みが加わります。アニメーションを混合するには、それを考慮する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントローラーには単一のインターフェースがあります。さらに、開発者はコントローラーを追加できます。たとえば、なんらかのロジックを実行したり、ポップアップにテキストを設定したりするコントローラーを作成できます。この簡単なカスタマイズにより、アニメーショングラフを非常に柔軟に使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数もあります。これらの変数は、コードを含めて外部で設定し、コントローラーで読み取ることができます。したがって、たとえば、同じ状態のキャラクターのアニメーションの種類を切り替えることができます。一般に、Unityのように、変数や条件を介して状態間の遷移のパラダイムを繰り返すこともできます。カスタマイズ可能なコントローラーと組み合わせると、非常に便利です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遷移は任意の数にすることができます。多くの遷移は、状態になり、同じ方法で無制限に終了できます。遷移は、状態に到達する可能性を決定します。たとえば、状態AとFの間に直接遷移がないが、チェーンA→B→C→D→E→Fがある場合、AからFへの遷移を要求すると、グラフ自体は中間状態B、C、Dを通過する必要があることを理解します、およびE.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca5/a75/506/ca5a755065638088486c8aaae5e30eb3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遷移には、開始間隔の設定と期間があります。期間を使用すると、すべてが簡単です-これは、移行が行われる時間です。ただし、間隔はすでにより複雑です。トランジションを開始できるアニメーションの許容期間を決定します。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、キャラクターが座るには、まず座るときにアニメーションを再生し、次に座るアニメーションを開始する必要があります。この場合、「座って」から「座って」への移行間隔は、アニメーションの「座って」の終わりである必要があります。そうすれば、座っている様子を確認でき、最後にすばやくスムーズに座席のアニメーションに入ります。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の例：キャラクターが歩いていて、停止する必要がある。この場合、キャラクターはいつでも停止できるため、トランジションの開始間隔はアニメーション全体の長さにする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーショングラフは、関連するすべての作業を行います。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要な状態への道を計画します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在実行中の状態を更新します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態間をスムーズに遷移します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらの重みを調整します。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深い機能</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Playrixエンジンには、3Dモデル、スパイン、フラッシュ、パーティクルエフェクト、骨格アニメーションなど、さまざまな種類のアニメーションがあります。</font><font style="vertical-align: inherit;">各タイプには特定のコントローラーがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単純なアニメーションコントローラに加えて、いくつかの補助的なコントローラがあります。</font><font style="vertical-align: inherit;">たとえば、ランダム化されたコントローラー。</font><font style="vertical-align: inherit;">他のコントローラーのリストと選択の可能性が含まれる場合があります。</font><font style="vertical-align: inherit;">オブジェクトがそのようなランダム化されたコントローラーの状態に入るたびに、ランダム選択は確率を考慮に入れ、選択されたコントローラーが機能し始めます。</font><font style="vertical-align: inherit;">残りは眠っていて、彼らの瞬間を待って活動していない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ある状態では、アニメーションを切り替える必要がある場合があります。たとえば、複数のキャラクターが同じグラフを持ち、すべてに何らかのアクションアニメーションがあるとします。 1人のキャラクターはほうきを取り、復讐を始める必要があり、もう1人はカメラを取り、写真を撮り始める必要があります。3人目はアイスクリームを食べています。そのような状況のために、コントローラーのリストも含む特別なコントローラーがありますが、ランダム化されたものとは異なり、ここでは変数に応じてコントローラーを選択します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数はグラフで設定され、コードなどから外部的に変更できます。この例では、文字列タイプが使用され、各タイプのアクションは変数の特定の値に対応しています。ゲームでキャラクターが作成されると、目的の動作に応じてこの変数が設定されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数のアニメーションをミックスできるコントローラもあります。</font><font style="vertical-align: inherit;">たとえば、歩行アニメーションを左、右、および前方に混在させることができます。</font><font style="vertical-align: inherit;">したがって、コーナリング時に、ウェイトを調整して、キャラクタの脚が滑らないようにして、歩行が自然に見えるようにすることができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もっと深く行く必要がある</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c17/ad8/196/c17ad819664185e383a0a5942fcbf7ef.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちがUnityを作るということには多くの利点があります。</font><font style="vertical-align: inherit;">それらの1つは、私たちが望むように、私たちが望むものを実行できることです。</font><font style="vertical-align: inherit;">そして、アニメーショングラフを拡張するための無限の機会が必要でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントローラーインターフェイスがあり、「すぐに使える」いくつかのコントローラーがあり、インターフェイスを実装し、その中で何かを行うことができます（必ずしもアニメーションではありません）。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタンのテキストを変更します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層内の他のオブジェクトと相互作用します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに別のアニメーショングラフを管理します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはこのアプローチを、Wildscapesゲームの動物園への訪問者に使用しました。</font><font style="vertical-align: inherit;">各ビジターには2つのグラフがあります。1つはモデルをアニメーション化するためのグラフ、もう1つは動作をアニメーション化するためのグラフです。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のグラフは非常にシンプルで、歩行を制御し、いくつかの個別のキャラクターアニメーションを再生できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のグラフははるかに複雑で、いくつかの動作シナリオがあります。</font><font style="vertical-align: inherit;">たとえば、最初にキャラクターが移動し、次にベンチに座って、誰かに挨拶し、写真を撮ってから続行します。</font><font style="vertical-align: inherit;">これは別の状態ブランチです。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このロジックは最初の列に配置できますが、アニメーションは何度も複製されます。</font><font style="vertical-align: inherit;">しかし、2つのグラフを使用すると、すべてがはるかに簡単になります。</font><font style="vertical-align: inherit;">制御グラフには、並列に実行される最初のグラフの状態を含む状態のチェーンが含まれています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/4c7/eb5/e1e4c7eb5f1ca273a001c98e5c61c6e6.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次は何ですか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのグラフはすでに多くを知っていますが、まだ開発の余地はたくさんあります。</font><font style="vertical-align: inherit;">計画では、入れ子を使用して、いくつかの州をグループ化します。</font><font style="vertical-align: inherit;">これにより、クエストの列が大幅に簡略化されます。</font><font style="vertical-align: inherit;">計画には、グラフとリンクの表示を改善する作業も含まれています。</font><font style="vertical-align: inherit;">大きなグラフの接続はスパゲッティに似ていて（色が似ていても）、混乱することがあります。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja471942/index.html">要件に応じて：Kingston DC500RおよびDC500M SSDのプロフェッショナルテスト</a></li>
<li><a href="../ja471946/index.html">FlinkCEPを使用してデータストリーム内のイベントのチェーンを探す</a></li>
<li><a href="../ja471948/index.html">ボックスで遊ぶ</a></li>
<li><a href="../ja471950/index.html">未来への私のビジョンD</a></li>
<li><a href="../ja471954/index.html">自分のインターネットラジオ</a></li>
<li><a href="../ja471958/index.html">バグのあるGAのAmazon EX Windowsですが、誰よりも高速です</a></li>
<li><a href="../ja471960/index.html">操作TA505、パート2：NetSupport RATによるServHelperバックドアの学習</a></li>
<li><a href="../ja471964/index.html">オラクルが救いに来る</a></li>
<li><a href="../ja471968/index.html">偽のPayPalサイトからランサムウェアNemtyに出会う</a></li>
<li><a href="../ja471974/index.html">2人の船長が将軍になった方法：白と赤</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>