<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚å®Ô∏è üë∞üèº üë©üèø‚Äç‚úàÔ∏è Meilleures pratiques Kubernetes. Cartographie des services externes üíå üë©üèΩ‚Äçüîß üññüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meilleures pratiques Kubernetes. Cr√©ation de petits conteneurs 
 Kubernetes Best Practices. Organisation Kubernetes avec l' 
 espace de noms Kubernete...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Meilleures pratiques Kubernetes. Cartographie des services externes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503612/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meilleures pratiques Kubernetes. Cr√©ation de petits conteneurs </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes Best Practices. Organisation Kubernetes avec l' </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espace de noms </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Kubernetes </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Best Practices. Test de viabilit√© Kubernetes avec tests de pr√©paration et de vivacit√© Kubernetes </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Best Practices. D√©finition des requ√™tes et des limites de </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ressources Meilleures pratiques Kubernetes. D√©connexion correcte de Terminate</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si vous √™tes comme la plupart des gens, vous utilisez probablement des ressources qui op√®rent en dehors de votre cluster. Vous utilisez peut-√™tre l'API Taleo pour envoyer des messages texte ou analyser des images √† l'aide de l'API Google Cloud Vision.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous utilisez le m√™me point de terminaison - le point de r√©ception des demandes c√¥t√© serveur dans tous vos environnements et que vous ne pr√©voyez pas de migrer vos serveurs vers Kubernetes, il est parfaitement normal d'avoir un service de point de terminaison directement dans votre code. Cependant, il existe de nombreux autres sc√©narios. Dans cette s√©rie de bonnes pratiques Kubernetes, vous apprendrez √† utiliser les m√©canismes int√©gr√©s de Kubernetes pour d√©couvrir des services √† l'int√©rieur et √† l'ext√©rieur du cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple de service externe √©tendu est une base de donn√©es qui s'ex√©cute en dehors d'un cluster Kubernetes. Contrairement aux bases de donn√©es cloud telles que Google Cloud Data Store ou Google Cloud Spanner, qui utilisent le m√™me point de terminaison pour tous les types d'acc√®s, la plupart des bases de donn√©es ont des points de terminaison distincts pour diff√©rentes circonstances.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les meilleures pratiques d'utilisation des bases de donn√©es traditionnelles, telles que MySQL et MongoDB, n√©cessitent g√©n√©ralement que vous vous connectiez √† diff√©rents composants pour diff√©rents environnements. Vous pouvez avoir une grande machine pour les donn√©es de production et une machine plus petite pour un environnement de test. Chacun d'eux aura sa propre adresse IP ou nom de domaine, mais vous ne voudrez probablement pas changer votre code lors du passage d'un environnement √† un autre. Par cons√©quent, au lieu de coder en dur ces adresses, vous pouvez utiliser le service int√©gr√© Kubernetes pour d√©couvrir les services externes bas√©s sur DNS de la m√™me mani√®re que pour les services Kubernetes natifs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qg/lz/vj/qglzvjg0ysvnlejo7v6pvtqc1se.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que vous ex√©cutez la base de donn√©es MongoDB dans Google Compute Engine. Vous serez coinc√© dans ce monde hybride jusqu'√† ce que vous parveniez √† le transf√©rer dans un cluster.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, vous pouvez utiliser les services statiques de Kubernetes pour vous faciliter la vie un peu. Dans cet exemple, j'ai cr√©√© un serveur MongoDB √† l'aide de Google Cloud Launcher. Comme il a √©t√© cr√©√© sur le m√™me r√©seau (ou cluster Kubernetes VPC), il est accessible √† l'aide d'une adresse IP interne haute performance. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/ou/z8/r3ouz8pak0n-al5obbd6y81qkke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit du param√®tre par d√©faut sur Google Cloud, vous n'avez donc rien √† configurer. Maintenant que vous avez une adresse IP, la premi√®re √©tape consiste √† cr√©er un service. Vous remarquerez peut-√™tre qu'il n'y a pas de s√©lecteurs de foyer pour ce service. Autrement dit, nous avons cr√©√© un service qui ne saura pas o√π envoyer du trafic. Cela vous permettra de cr√©er manuellement un objet de point de terminaison, qui recevra le trafic de ce service.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jo/tc/sr/jotcsra7vszs8kmlivxwl_awqsq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exemple de code suivant montre que les points de terminaison d√©terminent l'adresse IP de la base de donn√©es en utilisant le m√™me nom mongo que le service. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/y9/dz/cb/y9dzcbounajojfgkqd-7osjcxka.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes utilisera toutes les adresses IP pour trouver les points de terminaison comme s'il s'agissait de pods Kubernetes normaux, vous pouvez donc maintenant acc√©der √† la base de donn√©es √† l'aide d'une simple cha√Æne de connexion au nom ci-dessus mongodb: // mongo. Cependant, il n'est pas du tout n√©cessaire d'utiliser des adresses IP dans votre code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les adresses IP changent √† l'avenir, vous pouvez simplement mettre √† jour les points de terminaison avec la nouvelle adresse IP, et vos applications n'auront pas besoin d'√™tre modifi√©es de mani√®re suppl√©mentaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous utilisez une base de donn√©es h√©berg√©e sur un h√¥te tiers, les propri√©taires de l'h√¥te vous ont probablement fourni un URI d'identifiant de ressource unifi√© pour la connexion. Donc, si vous avez re√ßu une adresse IP, vous pouvez simplement utiliser la m√©thode pr√©c√©dente. Cet exemple montre que j'ai deux bases de donn√©es MongoDB h√©berg√©es sur l'h√¥te mLab. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/er/w9/bderw9_a42oa_nap45ol_au_jla.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un d'eux est une base de donn√©es de d√©veloppeurs et l'autre est une base de donn√©es de production. Les cha√Ænes de connexion pour ces bases de donn√©es sont les suivantes: mLab vous fournit un URI dynamique et un port dynamique. Comme vous pouvez le voir, ils sont diff√©rents. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fu/t9/v5/fut9v5yv1qtskdkx8tju2rmkmnq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ignorer cela, nous utilisons Kubernetes et nous connectons √† la base de donn√©es des d√©veloppeurs. Vous pouvez cr√©er un nom de service Kubernetes externe, qui vous fournira un service statique qui redirigera le trafic vers le service externe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jo/63/u6/jo63u6uv1quvocf8fxh1bnv_6om.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce service effectuera une simple redirection CNAME au niveau du noyau, qui aura un impact minimal sur les performances. Gr√¢ce √† cela, vous pouvez utiliser une cha√Æne de connexion plus simple. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/es/ip/jm/esipjmsa8t8nagtrwu4slv55isa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais comme le nom externe utilise la redirection CNAME, il ne peut pas effectuer de redirection de port. Par cons√©quent, cette solution s'applique uniquement aux ports statiques et ne peut pas √™tre utilis√©e avec des ports dynamiques. Mais le niveau gratuit mLab Free, par d√©faut, fournit √† l'utilisateur un num√©ro de port dynamique, et vous ne pouvez pas le modifier. Cela signifie que pour dev et prod, vous avez besoin de diff√©rentes lignes de commande de connexion. La mauvaise nouvelle est que vous devrez coder en dur le num√©ro de port. Alors, comment faire fonctionner la redirection de port?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re √©tape consiste √† obtenir l'adresse IP de l'URI. Si vous ex√©cutez la commande nslookup, hostname ou ping l'URI, vous pouvez obtenir l'adresse IP de la base de donn√©es. Si, en m√™me temps, le service vous renvoie plusieurs adresses IP, toutes ces adresses peuvent √™tre utilis√©es aux extr√©mit√©s de l'objet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ox/ki/ox/oxkioxus5e4idcigbaufhqfyquk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gardez √† l'esprit que les adresses IP URI peuvent changer sans pr√©avis, il est donc tr√®s risqu√© de les utiliser dans prod. En utilisant cette adresse IP, vous pouvez vous connecter √† une base de donn√©es distante sans sp√©cifier de port. Ainsi, le service Kubernetes effectue la redirection de port de mani√®re assez transparente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/iu/eo/rsiueor-lvslhr5vscjlowggkho.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mappage, ou mappage des ressources externes aux ressources internes, vous donne la possibilit√© d'utiliser de mani√®re flexible ces services au sein du cluster √† l'avenir tout en minimisant les efforts de refactoring. </font><font style="vertical-align: inherit;">Il facilite √©galement la gestion et donne un aper√ßu des services externes utilis√©s par votre entreprise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A suivre tr√®s prochainement ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/fvpq4jqtuZ8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicit√© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des mat√©riaux plus int√©ressants? Soutenez-nous en passant une commande ou en recommandant √† vos amis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des VPS bas√©s sur le cloud pour les d√©veloppeurs √† partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entr√©e de gamme que nous avons invent√©s pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la v√©rit√© sur les VPS (KVM) E5-2697 v3 (6 c≈ìurs) 10 Go DDR4 480 Go SSD 1 Gbit / s √† partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donn√©es Equinix Tier IV √† Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV √† partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - √† partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©ation d'un b√¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503600/index.html">STM32MP1: U-Boot, Buildroot, Arch Linux et un peu de Debian</a></li>
<li><a href="../fr503604/index.html">Sergey et ¬´la programmation vaut mieux que le sexe¬ª</a></li>
<li><a href="../fr503606/index.html">Swift 5.3: Quoi de neuf?</a></li>
<li><a href="../fr503608/index.html">Comment nous avons recherch√© les filtres antivirus</a></li>
<li><a href="../fr503610/index.html">Pourquoi ne pas cr√©er votre propre Lisp pour le Web?</a></li>
<li><a href="../fr503616/index.html">Comment nous avons cr√©√© un prototype de marchandiseur robot et quelle est la prochaine √©tape</a></li>
<li><a href="../fr503620/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 512 (05.05.2020-11.05.2020)</a></li>
<li><a href="../fr503624/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 416 (18-24 mai 2020)</a></li>
<li><a href="../fr503626/index.html">Essai. Erreurs de certification ISTQB ou r√©solvez un million d'exemples</a></li>
<li><a href="../fr503630/index.html">Lunettes de r√©alit√© augment√©e: o√π en sommes-nous maintenant?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>