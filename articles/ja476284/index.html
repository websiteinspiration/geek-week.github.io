<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌋 👸🏿 💇🏿 Reactでエラーを処理するための戦略を策定します 🚐 👩🏽‍🚒 🏳️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="秋を柔らかくするには？
 
 
 Reactアプリケーションでのエラー処理の包括的なガイドが見つからなかったので、この記事で得た経験を共有することにしました。この記事は初心者の開発者を対象としており、アプリケーションでのエラー処理を体系化するための出発点になる場合があります。
 
 問題と目標設定
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Reactでエラーを処理するための戦略を策定します</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476284/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秋を柔らかくするには？</font></font></h2><br>
<img src="https://habrastorage.org/webt/74/fa/c-/74fac--ati8ide9e4o946p1r-4g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reactアプリケーションでのエラー処理の包括的なガイドが見つからなかったので、この記事で得た経験を共有することにしました。</font><font style="vertical-align: inherit;">この記事は初心者の開発者を対象としており、アプリケーションでのエラー処理を体系化するための出発点になる場合があります。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題と目標設定</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 月曜日の朝、あなたは冷静にコーヒーを飲み、先週よりも多くのバグを修正したことを自慢します。そしてマネージャーが走り、手を振ります。 Macを実行して開き、SPAの製品版に移動し、数回クリックしてバグを再生します。白い画面が表示され、そこで何が起こったかを全能者しか知りません。コンソールに上り、掘り始めます。エラーでは、未定義のプロパティgetIdを読み取ることができません。 N時間の調査の後、勝利の叫びを上げてホットフィックスを送ります。このような襲撃はある程度の頻度で発生し、標準になっていますが、すべてが異なる可能性があると言ったらどうでしょうか？エラーをデバッグする時間を短縮し、そのような方法でプロセスを構築する方法クライアントが開発中に避けられない計算ミスに実際に気付かないように？</font></font><br>
<br>
<b>   ,    : </b><br>
<br>
<ol>
<li><u>        ,       </u><br>
 16  React            ,               .    ,    ,     try/catch        React.    16    Error Boundaries,     ,     .</li>
<li><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーは本番環境でのみ再現されるか、追加データなしでは再現できません  </font></font></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
理想的な世界では、開発環境は本番環境と一致し、ローカルでバグを再現できますが、私たちは実世界に住んでいます。</font><font style="vertical-align: inherit;">戦闘システムにはデバッグツールはありません。</font><font style="vertical-align: inherit;">そのようなインシデントを発掘することは難しく、生産的ではありません。基本的には、難読化されたコードとエラーに関する情報の欠如に対処する必要があり、問題の本質ではありません。</font><font style="vertical-align: inherit;">開発環境の条件を本番環境の条件にどのように近づけるかという問題は考慮しませんが、発生したインシデントに関する詳細情報を取得できるツールを考慮します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、ソフトウェア製品の開発速度とユーザーの忠誠心が低下するため、私は3つの最も重要な目標を設定しました。</font></font><br>
<br>
<ol>
<li>         ;</li>
<li>         ;</li>
<li>         .</li>
</ol><br>
<b>   ?</b><br>
<br>
<ol>
<li><u>     Error Boundary</u><br>
            UI   .  ,      ,         .            ,   .<br>
</li>
<li><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張エラー情報の保存 </font></font></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
エラーが発生した場合は、デバッグ情報を監視サーバーに送信します。監視サーバーは、インシデントに関する情報をフィルタリング、保存、および表示します。</font><font style="vertical-align: inherit;">これにより、展開後のエラーをすばやく検出して簡単にデバッグできます。</font></font><br>
</li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重大なエラー処理</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
バージョン16以降、Reactは標準のエラー処理動作を変更しました。</font><font style="vertical-align: inherit;">現在、エラー境界を使用してキャッチされなかった例外は、Reactツリー全体をアンマウントすることにつながり、その結果、アプリケーション全体が操作不能になります。</font><font style="vertical-align: inherit;">この決定は、ユーザーに予測できない結果を得る機会を与えるよりも、何も表示しない方がよいという事実によって主張されています。</font><font style="vertical-align: inherit;">詳しくは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">公式ドキュメントを</font></a><font style="vertical-align: inherit;">ご覧ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/-o/ik/jz-oik4v7a3skcbdxn_pttvugq8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、エラー境界がイベントハンドラーや非同期コードからのエラーをキャッチしないことに注意して多くの人が混乱していますが、それについて考えると、どのハンドラーも最終的に状態を変更でき、それに基づいて新しいレンダリングサイクルが呼び出されます。アカウントは、UIコードのエラーにつながる可能性があります。それ以外の場合、これはUIの重大なエラーではなく、ハンドラー内で特定の方法で処理できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの観点からは、重大なエラーはUIコード内で発生した例外であり、それが処理されない場合、Reactツリー全体がアンマウントされます。残りのエラーは重大ではなく、アプリケーションロジックに従って、たとえば通知を使用して処理できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、重大ではないエラーが最悪の場合にインターフェースの操作不能を引き起こす可能性があるという事実にもかかわらず、重大なエラーの処理に焦点を当てます。それらの処理を共通のブロックに分離することは困難であり、個々のケースごとに、アプリケーションロジックに応じて決定が必要になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、重大ではないエラーは非常に重大な場合があります（しゃれなど）。そのため、それらに関する情報は、重大なエラーと同じ方法で記録する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、単純なアプリケーションのエラー境界を設計しています。これは、ナビゲーションバー、ヘッダー、メインワークスペースで構成されます。エラー処理のみに焦点を当てるほどシンプルですが、多くのアプリケーションで一般的な構造になっています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q6/my/hd/q6myhdx0kjcwrwxe2q7b3sxdweu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つのリンクのナビゲーションパネルがあり、それぞれが他のコンポーネントから独立しているため、コンポーネントの1つが機能しなくても、残りのコンポーネントで引き続き作業できるような動作を実現したいと考えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、ヘッダーコンポーネント、ナビゲーションパネル、またはErrorBoundary内でエラーが発生した場合、ナビゲーションメニューからアクセスできる各コンポーネントのErrorBoundaryと、アプリケーション全体のクラッシュについて通知する一般的なErrorBoundaryがありますが、解決しませんでした。さらに処理して破棄します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ErrorBoundaryでラップされたアプリケーション全体をリストすることを検討してください</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span>&nbsp;AppWithBoundary&nbsp;=&nbsp;<span class="hljs-function"><span class="hljs-params">()</span>&nbsp;=&gt;</span>&nbsp;(
&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">"Application&nbsp;has&nbsp;crashed"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">App</span>/&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
)</code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title">App</span>(<span class="hljs-params"></span>)&nbsp;</span>{
&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Layout</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Sider</span>&nbsp;<span class="hljs-attr">width</span>=<span class="hljs-string">{200}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">SideNavigation</span>&nbsp;/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Sider</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Layout</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Header</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">ActionPanel</span>&nbsp;/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Header</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Content</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Switch</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Route</span>&nbsp;<span class="hljs-attr">path</span>=<span class="hljs-string">"/link1"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Page1</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">"Link&nbsp;1&nbsp;content&nbsp;page"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">"Page&nbsp;for&nbsp;link&nbsp;1&nbsp;crashed"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Route</span>&nbsp;<span class="hljs-attr">path</span>=<span class="hljs-string">"/link2"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Page2</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">"Link&nbsp;2&nbsp;content&nbsp;page"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">"Page&nbsp;for&nbsp;link&nbsp;2&nbsp;crashed"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Route</span>&nbsp;<span class="hljs-attr">path</span>=<span class="hljs-string">"/link3"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Page3</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">"Link&nbsp;3&nbsp;content&nbsp;page"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">"Page&nbsp;for&nbsp;link&nbsp;3&nbsp;crashed"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Route</span>&nbsp;<span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">MainPage</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">"Main&nbsp;page"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">"Only&nbsp;main&nbsp;page&nbsp;crashed"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Switch</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Content</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span><font></font>
&nbsp;&nbsp;);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ErrorBoundaryには魔法はありません。これは、componentDidCatchメソッドが定義されているクラスコンポーネントにすぎません。つまり、このメソッドを定義すると、任意のコンポーネントをErrorBoundaryにすることができます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">ErrorBoundary</span>&nbsp;<span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&nbsp;</span>{<font></font>
&nbsp;&nbsp;state&nbsp;=&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">hasError</span>:&nbsp;<span class="hljs-literal">false</span>,<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;componentDidCatch(error)&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.setState({&nbsp;<span class="hljs-attr">hasError</span>:&nbsp;<span class="hljs-literal">true</span>&nbsp;});<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;render()&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(<span class="hljs-keyword">this</span>.state.hasError)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Result</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">status</span>=<span class="hljs-string">"warning"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">{this.props.errorMessage}</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">extra</span>=<span class="hljs-string">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span class="hljs-attr">Button</span>&nbsp;<span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>&nbsp;<span class="hljs-attr">key</span>=<span class="hljs-string">"console"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Some&nbsp;action&nbsp;to&nbsp;recover
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;/&gt;</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">this</span>.props.children;<font></font>
&nbsp;&nbsp;}<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ContentブロックにレンダリングされるPageコンポーネントのErrorBoundaryの外観です。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span>&nbsp;PageBody&nbsp;=&nbsp;<span class="hljs-function">(<span class="hljs-params">{&nbsp;title&nbsp;}</span>)&nbsp;=&gt;</span>&nbsp;(
&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Content</span>&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">{title}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Empty</span>&nbsp;<span class="hljs-attr">className</span>=<span class="hljs-string">"content-empty"</span>&nbsp;/&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Content</span>&gt;</span></span><font></font>
);<font></font>
<font></font>
<span class="hljs-keyword">const</span>&nbsp;MainPage&nbsp;=&nbsp;<span class="hljs-function">(<span class="hljs-params">{&nbsp;errorMessage,&nbsp;title&nbsp;}</span>)&nbsp;=&gt;</span>&nbsp;(
&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">{errorMessage}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">PageBody</span>&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">{title}</span>&nbsp;/&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ErrorBoundaryは通常のReactコンポーネントなので、同じErrorBoundaryコンポーネントを使用して独自のハンドラーで各ページをラップし、異なるパラメーターを単にErrorBoundaryに渡すことができます。これらはクラスの異なるインスタンスであるため、状態は互いに依存しません。 。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要：ErrorBoundaryは、ツリー内でその下にあるコンポーネントでのみエラーをキャッチできます。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のリストでは、エラーはローカルのErrorBoundaryによってインターセプトされませんが、ツリーの上のハンドラーによってスローおよびインターセプトされます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span>&nbsp;Page&nbsp;=&nbsp;<span class="hljs-function">(<span class="hljs-params">{&nbsp;errorMessage&nbsp;}</span>)&nbsp;=&gt;</span>&nbsp;(
&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">{errorMessage}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;{null.toString()}
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><font></font>
);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ここでエラーはローカルのErrorBoundaryによってキャッチされます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span>&nbsp;ErrorProneComponent&nbsp;=&nbsp;<span class="hljs-function"><span class="hljs-params">()</span>&nbsp;=&gt;</span>&nbsp;<span class="hljs-literal">null</span>.toString();<font></font>
<font></font>
<span class="hljs-keyword">const</span>&nbsp;Page&nbsp;=&nbsp;<span class="hljs-function">(<span class="hljs-params">{&nbsp;errorMessage&nbsp;}</span>)&nbsp;=&gt;</span>&nbsp;(
&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">{errorMessage}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">ErrorProneComponent</span>&nbsp;/&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それぞれの個別のコンポーネントをErrorBoundaryでラップして、必要な動作を実現し、link3を使用して故意にエラーのあるコードをコンポーネントに入れ、何が起こるかを確認しました。</font><font style="vertical-align: inherit;">意図的にstepsパラメータを渡すことを忘れています：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span>&nbsp;PageBody&nbsp;=&nbsp;<span class="hljs-function">(<span class="hljs-params">{&nbsp;title,&nbsp;steps&nbsp;}</span>)&nbsp;=&gt;</span>&nbsp;(
&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Content</span>&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">{title}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Steps</span>&nbsp;<span class="hljs-attr">current</span>=<span class="hljs-string">{2}</span>&nbsp;<span class="hljs-attr">direction</span>=<span class="hljs-string">"vertical"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{steps.map(({&nbsp;title,&nbsp;description&nbsp;})&nbsp;=&gt;&nbsp;(<span class="hljs-tag">&lt;<span class="hljs-name">Step</span>&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">{title}</span>&nbsp;<span class="hljs-attr">description</span>=<span class="hljs-string">{description}</span>&nbsp;/&gt;</span>))}
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Steps</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Content</span>&gt;</span></span><font></font>
);<font></font>
<font></font>
<span class="hljs-keyword">const</span>&nbsp;Page&nbsp;=&nbsp;<span class="hljs-function">(<span class="hljs-params">{&nbsp;errorMessage,&nbsp;title&nbsp;}</span>)&nbsp;=&gt;</span>&nbsp;(
&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&nbsp;<span class="hljs-attr">errorMessage</span>=<span class="hljs-string">{errorMessage}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">PageBody</span>&nbsp;<span class="hljs-attr">title</span>=<span class="hljs-string">{title}</span>&nbsp;/&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><font></font>
);<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/6g/9g/fv/6g9gfvuuusmxrbedlytcmezyghe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションはエラーが発生したことを通知しますが、エラーは完全には発生せず、ナビゲーションメニューをナビゲートして他のセクションを操作できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4w/os/zh/4woszhf9ahhcl-uzdfwthj-d6a0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような単純な構成により、目標を簡単に達成できますが、実際には、アプリケーションの定期的な実行のみを計画してエラー処理に多くの注意を払う人はほとんどいません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー情報の保存</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
アプリケーションに十分なErrorBoundaryを配置したので、できるだけ早くエラーを検出して修正するために、エラー情報を保存する必要があります。最も簡単な方法は、SentryやRollbarなどのSaaSサービスを使用することです。これらは非常に類似した機能を備えているため、任意のエラー監視サービスを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sentryの基本的な例を示します。たった1分で最小限の機能が得られるからです。同時に、Sentry自体が例外をキャッチし、console.logを変更してすべてのエラー情報を取得します。その後、アプリケーションで発生するすべてのエラーが送信され、サーバーに保存されます。 Sentryには、イベントのフィルタリング、個人データの難読化、リリースへのリンクなどのメカニズムがあります。基本的な統合シナリオのみを検討します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続するには、彼らの公式ウェブサイトで登録し、登録後すぐにあなたを案内するクイックスタートガイドを通過する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプリケーションでは、数行追加するだけで、すべてが始まります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> Sentry <span class="hljs-keyword">from</span> <span class="hljs-string">'@sentry/browser'</span>;<font></font>
Sentry.init({<span class="hljs-attr">dsn</span>: “https:<span class="hljs-comment">//12345f@sentry.io/12345”}); </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再び、アプリケーションのリンク/ link3をクリックしてエラー画面を表示します。その後、監視センターのインターフェイスに移動します。イベントが発生し、内部で失敗したようです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/4p/bm/qx4pbm5d1dgv3gvxpabgeydwpoa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーはタイプ、頻度、発生時間によって自動的にグループ化され、さまざまなフィルターを適用できます。イベントが1つあります-そのイベントに分類され、次の画面で、スタックトレース</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bq/o8/ed/bqo8ed5grqrsme3yw8wa4rftwhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
や、エラーの前の最後のユーザーアクション（パンくず）</font><font style="vertical-align: inherit;">などの便利な情報</font><font style="vertical-align: inherit;">が表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bq/o8/ed/bqo8ed5grqrsme3yw8wa4rftwhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような単純な構成でも、エラー情報を蓄積および分析し、それをさらにデバッグするために使用できます。この例では、開発モードのクライアントからエラーが送信されるため、コンポーネントとエラーに関する完全な情報を観察できます。プロダクションモードから同様の情報を取得するには、追加でリリースデータとSentryの同期を構成する必要があります。これにより、ソースマップ自体が保存されるため、バンドルのサイズを増やすことなく十分な情報を保存できます。この記事のフレームワークではそのような構成については考慮しませんが、そのようなソリューションの落とし穴については、実装後に別の記事で説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計：</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ErrorBoundaryを使用したエラー処理により、アプリケーションの部分的なクラッシュによってコーナーを滑らかにし、システムのユーザーエクスペリエンスを向上させ、特殊なエラー監視システムを使用して問題の検出とデバッグの時間を短縮できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションのエラーを処理および監視する方法について慎重に検討してください。将来的には、これにより多くの時間と労力が節約されます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十分に検討された戦略は、主にインシデントの処理プロセスを改善し、それが初めてコードの構造に影響を与えます。</font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまなErrorBoundary構成オプションを試すか、feature_sentryブランチで自分でSentryをアプリケーションに接続し、サイトでの登録中に取得したキーでキーを置き換えます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Git-Hubデモアプリケーション</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reactの公式エラー境界ドキュメント</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja476270/index.html">当選者：TopCoder Open 2019</a></li>
<li><a href="../ja476272/index.html">会議2018-2019のPVS-Studioブースからのタスクへの回答</a></li>
<li><a href="../ja476276/index.html">Goでシンプルなバランサーを作成する</a></li>
<li><a href="../ja476278/index.html">BLACK HAT USAカンファレンス。金持ちになるか死ぬか：Black Hatを使用してインターネットでお金を稼ぐ。パート3</a></li>
<li><a href="../ja476280/index.html">とげからDOSへ：世界を変えた4枚のフロッピーディスク</a></li>
<li><a href="../ja476286/index.html">2020年のフロントエンド開発の上位5 JSフレームワーク。パート1</a></li>
<li><a href="../ja476288/index.html">2020年のフロントエンド開発の上位5 JSフレームワーク。パート2</a></li>
<li><a href="../ja476290/index.html">Expressでのエラー処理</a></li>
<li><a href="../ja476292/index.html">SVGまたはキャンバス？</a></li>
<li><a href="../ja476294/index.html">GFNの代替としての分散型ゲームネットワーク：ロシア連邦ですでに機能している、その方法と理由</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>