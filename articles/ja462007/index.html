<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✋🏻 👨🏽‍🎨 🤚🏿 堅牢なPythonスクリプトの開発 ㊙️ 🚞 ☣️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pythonは、スタンドアロンスクリプトの開発に最適なプログラミング言語です。同様のスクリプトを使用して目的の結果を得るには、数十行または数百行のコードを記述する必要があります。そして、作業が終わったら、書かれたコードを忘れて次の問題の解決に進むことができます。
 
 たとえば、特定の「1回限りの」...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>堅牢なPythonスクリプトの開発</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/462007/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pythonは、スタンドアロンスクリプトの開発に最適なプログラミング言語です。同様のスクリプトを使用して目的の結果を得るには、数十行または数百行のコードを記述する必要があります。そして、作業が終わったら、書かれたコードを忘れて次の問題の解決に進むことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、特定の「1回限りの」スクリプトが作成されてから6か月後に、このスクリプトがクラッシュする理由を作成者に尋ねた場合、スクリプトの作成者はこれに気付かない可能性があります。これは、そのようなスクリプトのドキュメントが記述されていないこと、コードにハードコーディングされているパラメーターの使用、操作中にスクリプトが何もログに記録しないこと、および許可されたテストがないことにより発生します。問題の原因をすばやく理解するため。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/bw/sc/8n/bwsc8np51ystvqsvlchcn-ukvwi.jpeg"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
速攻で書かれたスクリプトをより良いものに変えることはそれほど難しくないことに注意すべきです。</font><font style="vertical-align: inherit;">つまり、そのようなスクリプトは、使いやすく信頼性が高く理解しやすいコードに、作成者と他のプログラマーの両方をサポートするのが簡単なコードに変換するのが非常に簡単です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日私たちが公開している資料の著者は、例として古典的な</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィズバズテスト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題を使用して、そのような「変換」を示し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このタスクは、1から100までの数字のリストを表示し、それらのいくつかを特殊な行に置き換えます。</font><font style="vertical-align: inherit;">数が3の倍数であるのであれば、代わりに-それのあなたは、文字列を印刷する必要がある</font></font><code>Fizz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字列-数が5の倍数であれば、</font></font><code>Buzz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とあれば、これらの条件の両方が満たされています- </font></font><code>FizzBuzz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を解決するPythonスクリプトのソースコードを次に示します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> range(int(sys.argv[<span class="hljs-number">1</span>]), int(sys.argv[<span class="hljs-number">2</span>])):
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> n % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"fizzbuzz"</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"fizz"</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> n % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"buzz"</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">else</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(n)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それを改善する方法について話しましょう。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメンテーション</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードを書く前にドキュメンテーションを書くことは役に立ちます。</font><font style="vertical-align: inherit;">これにより作業が簡略化され、ドキュメントの作成を無期限に遅らせないようにできます。</font><font style="vertical-align: inherit;">スクリプトのドキュメントを上部に配置できます。</font><font style="vertical-align: inherit;">たとえば、次のようになります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python3</span><font></font>
<font></font>
<span class="hljs-string">"""Simple fizzbuzz generator.

This script prints out a sequence of numbers from a provided range
with the following restrictions:

&nbsp;- if the number is divisible by 3, then print out "fizz",
&nbsp;- if the number is divisible by 5, then print out "buzz",
&nbsp;- if the number is divisible by 3 and 5, then print out "fizzbuzz".
"""</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の行は、スクリプトの目的の簡単な説明です。</font><font style="vertical-align: inherit;">残りの段落には、スクリプトの機能に関する追加情報が含まれています。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドライン引数</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトを改善する次のタスクは、コードにハードコーディングされている値を、コマンドライン引数を介してスクリプトに渡されるドキュメント化された値で置き換えることです。</font><font style="vertical-align: inherit;">これは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argparse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールを使用して行うことができます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この例では、数値の範囲を指定し、指定された範囲の数値をチェックするときに使用される「fizz」と「buzz」の値を指定することをユーザーに提案します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> sys<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFormatter</span>(<span class="hljs-params">argparse.RawDescriptionHelpFormatter,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;argparse.ArgumentDefaultsHelpFormatter</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_args</span>(<span class="hljs-params">args=sys.argv[<span class="hljs-number">1</span>:]</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"""Parse arguments."""</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;parser = argparse.ArgumentParser(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description=sys.modules[__name__].__doc__,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatter_class=CustomFormatter)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;g = parser.add_argument_group(<span class="hljs-string">"fizzbuzz settings"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;g.add_argument(<span class="hljs-string">"--fizz"</span>, metavar=<span class="hljs-string">"N"</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=<span class="hljs-number">3</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=int,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help=<span class="hljs-string">"Modulo value for fizz"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;g.add_argument(<span class="hljs-string">"--buzz"</span>, metavar=<span class="hljs-string">"N"</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=<span class="hljs-number">5</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=int,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help=<span class="hljs-string">"Modulo value for buzz"</span>)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;parser.add_argument(<span class="hljs-string">"start"</span>, type=int, help=<span class="hljs-string">"Start value"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;parser.add_argument(<span class="hljs-string">"end"</span>, type=int, help=<span class="hljs-string">"End value"</span>)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> parser.parse_args(args)<font></font>
<font></font>
<font></font>
options = parse_args()<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> range(options.start, options.end + <span class="hljs-number">1</span>):
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># ...</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの変更は、スクリプトにとって非常に有益です。</font><font style="vertical-align: inherit;">つまり、パラメータが適切に文書化され、フラグを使用して目的を確認できます</font></font><code>--help</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さらに、対応するコマンドに従って、前のセクションで記述したドキュメントも表示されます。</font></font><br>
<br>
<pre><code class="python hljs">$ ./fizzbuzz.py --help<font></font>
usage: fizzbuzz.py [-h] [--fizz N] [--buzz N] start end<font></font>
<font></font>
Simple fizzbuzz generator.<font></font>
<font></font>
This script prints out a sequence of numbers <span class="hljs-keyword">from</span> a provided range
<span class="hljs-keyword">with</span> the following restrictions:<font></font>
<font></font>
&nbsp;- <span class="hljs-keyword">if</span> the number <span class="hljs-keyword">is</span> divisible by <span class="hljs-number">3</span>, then <span class="hljs-keyword">print</span> out <span class="hljs-string">"fizz"</span>,<font></font>
&nbsp;- <span class="hljs-keyword">if</span> the number <span class="hljs-keyword">is</span> divisible by <span class="hljs-number">5</span>, then <span class="hljs-keyword">print</span> out <span class="hljs-string">"buzz"</span>,<font></font>
&nbsp;- <span class="hljs-keyword">if</span> the number <span class="hljs-keyword">is</span> divisible by <span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-number">5</span>, then <span class="hljs-keyword">print</span> out <span class="hljs-string">"fizzbuzz"</span>.<font></font>
<font></font>
positional arguments:<font></font>
&nbsp;&nbsp;start &nbsp; &nbsp; &nbsp; &nbsp; Start value<font></font>
&nbsp;&nbsp;end &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End value<font></font>
<font></font>
optional arguments:<font></font>
&nbsp;&nbsp;-h, --help&nbsp; &nbsp; show this help message <span class="hljs-keyword">and</span> exit<font></font>
<font></font>
fizzbuzz settings:<font></font>
&nbsp;&nbsp;--fizz N&nbsp; &nbsp; &nbsp; Modulo value <span class="hljs-keyword">for</span> fizz (default: <span class="hljs-number">3</span>)<font></font>
&nbsp;&nbsp;--buzz N&nbsp; &nbsp; &nbsp; Modulo value <span class="hljs-keyword">for</span> buzz (default: <span class="hljs-number">5</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュール</font></font><code>argparse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は非常に強力なツールです。</font><font style="vertical-align: inherit;">これに慣れていない場合は、その</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を参照すると便利です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特に、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブコマンド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引数のグループ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を定義する彼の能力が気に入ってい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロギング</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトの実行中にいくつかの情報を表示する機能をスクリプトに装備すると、これはその機能への快適な追加となります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロギング</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールはこの目的に適してい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">まず、ロギングを実装するオブジェクトについて説明します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> logging.handlers
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys<font></font>
<font></font>
logger = logging.getLogger(os.path.splitext(os.path.basename(sys.argv[<span class="hljs-number">0</span>]))[<span class="hljs-number">0</span>])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ロギング中に表示される情報の詳細を制御できるようにします。</font><font style="vertical-align: inherit;">そのため、</font></font><code>logger.debug()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトがキーを使用して実行された場合にのみ</font><font style="vertical-align: inherit;">、コマンド</font><font style="vertical-align: inherit;">は何かを出力する必要があります</font></font><code>--debug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">キーを使用してスクリプトを実行すると、スクリプトは</font></font><code>--silent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外メッセージのみを表示します。</font><font style="vertical-align: inherit;">これらの機能を実装するには、</font></font><code>parse_args()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のコードを</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#  parse_args()</span><font></font>
g = parser.add_mutually_exclusive_group()<font></font>
g.add_argument(<span class="hljs-string">"--debug"</span>, <span class="hljs-string">"-d"</span>, action=<span class="hljs-string">"store_true"</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=<span class="hljs-literal">False</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help=<span class="hljs-string">"enable debugging"</span>)<font></font>
g.add_argument(<span class="hljs-string">"--silent"</span>, <span class="hljs-string">"-s"</span>, action=<span class="hljs-string">"store_true"</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=<span class="hljs-literal">False</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help=<span class="hljs-string">"don't log to console"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の関数をプロジェクトコードに追加して、ロギングを構成します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setup_logging</span>(<span class="hljs-params">options</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"""Configure logging."""</span>
&nbsp;&nbsp;&nbsp;&nbsp;root = logging.getLogger(<span class="hljs-string">""</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;root.setLevel(logging.WARNING)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;logger.setLevel(options.debug <span class="hljs-keyword">and</span> logging.DEBUG <span class="hljs-keyword">or</span> logging.INFO)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.silent:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = logging.StreamHandler()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch.setFormatter(logging.Formatter(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"%(levelname)s[%(name)s] %(message)s"</span>))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root.addHandler(ch)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メインスクリプトコードは次のように変更されます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;options = parse_args()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;setup_logging(options)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.debug(<span class="hljs-string">"compute fizzbuzz from {} to {}"</span>.format(options.start,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.end))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> range(options.start, options.end + <span class="hljs-number">1</span>):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># ..</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.exception(<span class="hljs-string">"%s"</span>, e)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(<span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえばを使用して、ユーザーが直接参加することなくスクリプトを実行する</font></font><code>crontab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合は、出力が次のようになるようにすることができます</font></font><code>syslog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setup_logging</span>(<span class="hljs-params">options</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"""Configure logging."""</span>
&nbsp;&nbsp;&nbsp;&nbsp;root = logging.getLogger(<span class="hljs-string">""</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;root.setLevel(logging.WARNING)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;logger.setLevel(options.debug <span class="hljs-keyword">and</span> logging.DEBUG <span class="hljs-keyword">or</span> logging.INFO)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.silent:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> sys.stderr.isatty():<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;facility = logging.handlers.SysLogHandler.LOG_DAEMON<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sh = logging.handlers.SysLogHandler(address=<span class="hljs-string">'/dev/log'</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;facility=facility)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sh.setFormatter(logging.Formatter(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"{0}[{1}]: %(message)s"</span>.format(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.name,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.getpid())))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root.addHandler(sh)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">else</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = logging.StreamHandler()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch.setFormatter(logging.Formatter(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"%(levelname)s[%(name)s] %(message)s"</span>))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root.addHandler(ch)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小さなスクリプトでは、コマンドを利用するためだけに、同様の量のコードが必要と思われます</font></font><code>logger.debug()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、実際のスクリプトでは、このコードはこのように見えなくなり、その利点が前面に現れます。つまり、その助けを借りて、ユーザーは問題の解決の進捗状況を知ることができます。</font></font><br>
<br>
<pre><code class="python hljs">$ ./fizzbuzz.py --debug <span class="hljs-number">1</span> <span class="hljs-number">3</span>
DEBUG[fizzbuzz] compute fizzbuzz <span class="hljs-keyword">from</span> <span class="hljs-number">1</span> to <span class="hljs-number">3</span>
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
fizz</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単体テストは、アプリケーションが正常に動作するかどうかを確認するのに役立つツールです。</font><font style="vertical-align: inherit;">ユニットスクリプトはスクリプトではあまり使用されませんが、スクリプトに含めるとコードの信頼性が大幅に向上します。</font><font style="vertical-align: inherit;">ループ内のコードを関数に変換し、その使用例をインタラクティブなドキュメントで説明します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fizzbuzz</span>(<span class="hljs-params">n, fizz, buzz</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"""Compute fizzbuzz nth item given modulo values for fizz and buzz.

&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt; fizzbuzz(5, fizz=3, buzz=5)
&nbsp;&nbsp;&nbsp;&nbsp;'buzz'
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt; fizzbuzz(3, fizz=3, buzz=5)
&nbsp;&nbsp;&nbsp;&nbsp;'fizz'
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt; fizzbuzz(15, fizz=3, buzz=5)
&nbsp;&nbsp;&nbsp;&nbsp;'fizzbuzz'
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt; fizzbuzz(4, fizz=3, buzz=5)
&nbsp;&nbsp;&nbsp;&nbsp;4
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt; fizzbuzz(4, fizz=4, buzz=6)
&nbsp;&nbsp;&nbsp;&nbsp;'fizz'

&nbsp;&nbsp;&nbsp;&nbsp;"""</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> n % fizz == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> n % buzz == <span class="hljs-number">0</span>:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> <span class="hljs-string">"fizzbuzz"</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> n % fizz == <span class="hljs-number">0</span>:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> <span class="hljs-string">"fizz"</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> n % buzz == <span class="hljs-number">0</span>:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> <span class="hljs-string">"buzz"</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> n</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドを使用して、関数の正しい動作を確認できます</font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">$ python3 -m pytest -v --doctest-modules ./fizzbuzz.py<font></font>
============================ test session starts =============================<font></font>
platform linux -- Python <span class="hljs-number">3.7</span><span class="hljs-number">.4</span>, pytest<span class="hljs-number">-3.10</span><span class="hljs-number">.1</span>, py<span class="hljs-number">-1.8</span><span class="hljs-number">.0</span>, pluggy<span class="hljs-number">-0.8</span><span class="hljs-number">.0</span> -- /usr/bin/python3<font></font>
cachedir: .pytest_cache<font></font>
rootdir: /home/bernat/code/perso/python-script, inifile:<font></font>
plugins: xdist<span class="hljs-number">-1.26</span><span class="hljs-number">.1</span>, timeout<span class="hljs-number">-1.3</span><span class="hljs-number">.3</span>, forked<span class="hljs-number">-1.0</span><span class="hljs-number">.2</span>, cov<span class="hljs-number">-2.6</span><span class="hljs-number">.0</span>
collected <span class="hljs-number">1</span> item<font></font>
<font></font>
fizzbuzz.py::fizzbuzz.fizzbuzz PASSED&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [<span class="hljs-number">100</span>%]<font></font>
<font></font>
========================== <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.05</span> seconds ==========================</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてが機能するためには、スクリプト名の後に拡張子を付ける必要があります</font></font><code>.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">スクリプト名に拡張子を付けるのは好きではありません。言語は技術的な詳細であり、ユーザーに表示する必要はありません。</font><font style="vertical-align: inherit;">ただし、スクリプト名に拡張子を付ける</font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことは、コードに含まれているテストを見つける</font><font style="vertical-align: inherit;">など、システムがテストを実行できるようにする最も簡単な方法のようです</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーが発生する</font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、対応するコードの場所と問題の本質を示すメッセージが表示されます。</font></font><br>
<br>
<pre><code class="python hljs">$ python3 -m pytest -v --doctest-modules ./fizzbuzz.py -k fizzbuzz.fizzbuzz<font></font>
============================ test session starts =============================<font></font>
platform linux -- Python <span class="hljs-number">3.7</span><span class="hljs-number">.4</span>, pytest<span class="hljs-number">-3.10</span><span class="hljs-number">.1</span>, py<span class="hljs-number">-1.8</span><span class="hljs-number">.0</span>, pluggy<span class="hljs-number">-0.8</span><span class="hljs-number">.0</span> -- /usr/bin/python3<font></font>
cachedir: .pytest_cache<font></font>
rootdir: /home/bernat/code/perso/python-script, inifile:<font></font>
plugins: xdist<span class="hljs-number">-1.26</span><span class="hljs-number">.1</span>, timeout<span class="hljs-number">-1.3</span><span class="hljs-number">.3</span>, forked<span class="hljs-number">-1.0</span><span class="hljs-number">.2</span>, cov<span class="hljs-number">-2.6</span><span class="hljs-number">.0</span>
collected <span class="hljs-number">1</span> item<font></font>
<font></font>
fizzbuzz.py::fizzbuzz.fizzbuzz FAILED&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [<span class="hljs-number">100</span>%]<font></font>
<font></font>
================================== FAILURES ==================================<font></font>
________________________ [doctest] fizzbuzz.fizzbuzz _________________________<font></font>
<span class="hljs-number">100</span>
<span class="hljs-number">101</span> &nbsp; &nbsp; &gt;&gt;&gt; fizzbuzz(<span class="hljs-number">5</span>, fizz=<span class="hljs-number">3</span>, buzz=<span class="hljs-number">5</span>)
<span class="hljs-number">102</span> &nbsp; &nbsp; <span class="hljs-string">'buzz'</span>
<span class="hljs-number">103</span> &nbsp; &nbsp; &gt;&gt;&gt; fizzbuzz(<span class="hljs-number">3</span>, fizz=<span class="hljs-number">3</span>, buzz=<span class="hljs-number">5</span>)
<span class="hljs-number">104</span> &nbsp; &nbsp; <span class="hljs-string">'fizz'</span>
<span class="hljs-number">105</span> &nbsp; &nbsp; &gt;&gt;&gt; fizzbuzz(<span class="hljs-number">15</span>, fizz=<span class="hljs-number">3</span>, buzz=<span class="hljs-number">5</span>)
<span class="hljs-number">106</span> &nbsp; &nbsp; <span class="hljs-string">'fizzbuzz'</span>
<span class="hljs-number">107</span> &nbsp; &nbsp; &gt;&gt;&gt; fizzbuzz(<span class="hljs-number">4</span>, fizz=<span class="hljs-number">3</span>, buzz=<span class="hljs-number">5</span>)
<span class="hljs-number">108</span> &nbsp; &nbsp; <span class="hljs-number">4</span>
<span class="hljs-number">109</span> &nbsp; &nbsp; &gt;&gt;&gt; fizzbuzz(<span class="hljs-number">4</span>, fizz=<span class="hljs-number">4</span>, buzz=<span class="hljs-number">6</span>)<font></font>
Expected:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fizz<font></font>
Got:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number">4</span><font></font>
<font></font>
/home/bernat/code/perso/python-script/fizzbuzz.py:<span class="hljs-number">109</span>: DocTestFailure<font></font>
========================== <span class="hljs-number">1</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.02</span> seconds ==========================</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユニットテストは通常​​のコードとして書くこともできます。</font><font style="vertical-align: inherit;">次の関数をテストする必要があるとします。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">options</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"""Compute a fizzbuzz set of strings and return them as an array."""</span>
&nbsp;&nbsp;&nbsp;&nbsp;logger.debug(<span class="hljs-string">"compute fizzbuzz from {} to {}"</span>.format(options.start,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.end))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> [str(fizzbuzz(i, options.fizz, options.buzz))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(options.start, options.end+<span class="hljs-number">1</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトの最後に、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">パラメーター化されたテスト関数</font></a></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用する機能</font><font style="vertical-align: inherit;">を使用</font><font style="vertical-align: inherit;">して、次の単体テストを追加します</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#  </span>
<span class="hljs-keyword">import</span> pytest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment"># noqa: E402</span>
<span class="hljs-keyword">import</span> shlex&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment"># noqa: E402</span><font></font>
<font></font>
<font></font>
<span class="hljs-meta">@pytest.mark.parametrize("args, expected", [</span>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"0 0"</span>, [<span class="hljs-string">"fizzbuzz"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"3 5"</span>, [<span class="hljs-string">"fizz"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"buzz"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"9 12"</span>, [<span class="hljs-string">"fizz"</span>, <span class="hljs-string">"buzz"</span>, <span class="hljs-string">"11"</span>, <span class="hljs-string">"fizz"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"14 17"</span>, [<span class="hljs-string">"14"</span>, <span class="hljs-string">"fizzbuzz"</span>, <span class="hljs-string">"16"</span>, <span class="hljs-string">"17"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"14 17 --fizz=2"</span>, [<span class="hljs-string">"fizz"</span>, <span class="hljs-string">"buzz"</span>, <span class="hljs-string">"fizz"</span>, <span class="hljs-string">"17"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"17 20 --buzz=10"</span>, [<span class="hljs-string">"17"</span>, <span class="hljs-string">"fizz"</span>, <span class="hljs-string">"19"</span>, <span class="hljs-string">"buzz"</span>]),<font></font>
])<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_main</span>(<span class="hljs-params">args, expected</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;options = parse_args(shlex.split(args))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;options.debug = <span class="hljs-literal">True</span>
&nbsp;&nbsp;&nbsp;&nbsp;options.silent = <span class="hljs-literal">True</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;setup_logging(options)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">assert</span> main(options) == expected</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトコードはcall </font></font><code>sys.exit()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">終了するため</font><font style="vertical-align: inherit;">、通常の呼び出し中にテストは実行されないことに</font><font style="vertical-align: inherit;">注意してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このおかげで</font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、スクリプトを実行する必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テスト関数は、パラメーターのグループごとに1回呼び出されます。</font><font style="vertical-align: inherit;">エンティティは</font></font><code>args</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数への入力として使用されます</font></font><code>parse_args()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このメカニズムのおかげで、関数に渡す必要があるものが得られます</font></font><code>main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">本質は</font></font><code>expected</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それが与えるものと比較され</font></font><code>main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてが期待どおりに機能</font><font style="vertical-align: inherit;">するかどうかを以下に示します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">$ python3 -m pytest -v --doctest-modules ./fizzbuzz.py<font></font>
============================ test session starts =============================<font></font>
platform linux -- Python <span class="hljs-number">3.7</span><span class="hljs-number">.4</span>, pytest<span class="hljs-number">-3.10</span><span class="hljs-number">.1</span>, py<span class="hljs-number">-1.8</span><span class="hljs-number">.0</span>, pluggy<span class="hljs-number">-0.8</span><span class="hljs-number">.0</span> -- /usr/bin/python3<font></font>
cachedir: .pytest_cache<font></font>
rootdir: /home/bernat/code/perso/python-script, inifile:<font></font>
plugins: xdist<span class="hljs-number">-1.26</span><span class="hljs-number">.1</span>, timeout<span class="hljs-number">-1.3</span><span class="hljs-number">.3</span>, forked<span class="hljs-number">-1.0</span><span class="hljs-number">.2</span>, cov<span class="hljs-number">-2.6</span><span class="hljs-number">.0</span>
collected <span class="hljs-number">7</span> items<font></font>
<font></font>
fizzbuzz.py::fizzbuzz.fizzbuzz PASSED&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ <span class="hljs-number">14</span>%]<font></font>
fizzbuzz.py::test_main[<span class="hljs-number">0</span> <span class="hljs-number">0</span>-expected0] PASSED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ <span class="hljs-number">28</span>%]<font></font>
fizzbuzz.py::test_main[<span class="hljs-number">3</span> <span class="hljs-number">5</span>-expected1] PASSED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ <span class="hljs-number">42</span>%]<font></font>
fizzbuzz.py::test_main[<span class="hljs-number">9</span> <span class="hljs-number">12</span>-expected2] PASSED&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ <span class="hljs-number">57</span>%]<font></font>
fizzbuzz.py::test_main[<span class="hljs-number">14</span> <span class="hljs-number">17</span>-expected3] PASSED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ <span class="hljs-number">71</span>%]<font></font>
fizzbuzz.py::test_main[<span class="hljs-number">14</span> <span class="hljs-number">17</span> --fizz=<span class="hljs-number">2</span>-expected4] PASSED&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ <span class="hljs-number">85</span>%]<font></font>
fizzbuzz.py::test_main[<span class="hljs-number">17</span> <span class="hljs-number">20</span> --buzz=<span class="hljs-number">10</span>-expected5] PASSED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [<span class="hljs-number">100</span>%]<font></font>
<font></font>
========================== <span class="hljs-number">7</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.03</span> seconds ==========================</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーが発生した場合、</font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何が起こったかについての有用な情報を提供します。</font></font><br>
<br>
<pre><code class="python hljs">$ python3 -m pytest -v --doctest-modules ./fizzbuzz.py<font></font>
[...]<font></font>
================================== FAILURES ==================================<font></font>
__________________________ test_main[<span class="hljs-number">0</span> <span class="hljs-number">0</span>-expected0] __________________________<font></font>
<font></font>
args = <span class="hljs-string">'0 0'</span>, expected = [<span class="hljs-string">'0'</span>]<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;@pytest.mark.parametrize(<span class="hljs-string">"args, expected"</span>, [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"0 0"</span>, [<span class="hljs-string">"0"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"3 5"</span>, [<span class="hljs-string">"fizz"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"buzz"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"9 12"</span>, [<span class="hljs-string">"fizz"</span>, <span class="hljs-string">"buzz"</span>, <span class="hljs-string">"11"</span>, <span class="hljs-string">"fizz"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"14 17"</span>, [<span class="hljs-string">"14"</span>, <span class="hljs-string">"fizzbuzz"</span>, <span class="hljs-string">"16"</span>, <span class="hljs-string">"17"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"14 17 --fizz=2"</span>, [<span class="hljs-string">"fizz"</span>, <span class="hljs-string">"buzz"</span>, <span class="hljs-string">"fizz"</span>, <span class="hljs-string">"17"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="hljs-string">"17 20 --buzz=10"</span>, [<span class="hljs-string">"17"</span>, <span class="hljs-string">"fizz"</span>, <span class="hljs-string">"19"</span>, <span class="hljs-string">"buzz"</span>]),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;])<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_main</span>(<span class="hljs-params">args, expected</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options = parse_args(shlex.split(args))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.debug = <span class="hljs-literal">True</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.silent = <span class="hljs-literal">True</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setup_logging(options)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">assert</span> main(options) == expected<font></font>
E &nbsp; &nbsp; &nbsp; AssertionError: <span class="hljs-keyword">assert</span> [<span class="hljs-string">'fizzbuzz'</span>] == [<span class="hljs-string">'0'</span>]<font></font>
E &nbsp; &nbsp; &nbsp; &nbsp; At index <span class="hljs-number">0</span> diff: <span class="hljs-string">'fizzbuzz'</span> != <span class="hljs-string">'0'</span><font></font>
E &nbsp; &nbsp; &nbsp; &nbsp; Full diff:<font></font>
E &nbsp; &nbsp; &nbsp; &nbsp; - [<span class="hljs-string">'fizzbuzz'</span>]<font></font>
E &nbsp; &nbsp; &nbsp; &nbsp; + [<span class="hljs-string">'0'</span>]<font></font>
<font></font>
fizzbuzz.py:<span class="hljs-number">160</span>: AssertionError<font></font>
----------------------------- Captured log call ------------------------------<font></font>
fizzbuzz.py&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">125</span> DEBUG    compute fizzbuzz <span class="hljs-keyword">from</span> <span class="hljs-number">0</span> to <span class="hljs-number">0</span>
===================== <span class="hljs-number">1</span> failed, <span class="hljs-number">6</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.05</span> seconds =====================</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドの出力もこの出力に含まれます</font></font><code>logger.debug()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、スクリプトでロギングメカニズムを使用するもう1つの理由です。</font><font style="vertical-align: inherit;">優れた機能について詳しく知りたい場合は</font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資料を</font><font style="vertical-align: inherit;">ご覧</font><font style="vertical-align: inherit;">ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の4つの手順に従うことで、Pythonスクリプトの信頼性を高めることができます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの上部にあるドキュメントをスクリプトに含めます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール</font></font><code>argparse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用して</font><font style="vertical-align: inherit;">、スクリプトを呼び出すときに使用できるパラメーターを文書化します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール</font></font><code>logging</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用して</font><font style="vertical-align: inherit;">、スクリプトのプロセスに関する情報を表示します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単体テストを記述します。</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">説明する例の完全なコードは次のとおりです。</font><font style="vertical-align: inherit;">独自のスクリプトのテンプレートとして使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この資料に関して興味深い議論が始まりました- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらを見つけることができます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">聴衆は、ドキュメントとコマンドライン引数に関する推奨をよく受け取ったようですが、一部の読者にとって、ロギングとテストについては「スズメの大砲からのショット」であるように見えました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事に応じて書かれた資料です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者の皆様！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この出版物に記載されているPythonスクリプトの記述に関する推奨事項を適用する予定はありますか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja461995/index.html">常駐プロキシーをマーケティングおよびWebサイトのプロモーションに使用する方法</a></li>
<li><a href="../ja461997/index.html">PostgreSQLでのクエリパフォーマンスのチューニング</a></li>
<li><a href="../ja461999/index.html">WordPress開発環境の別のバージョン（docker、wp-cli）</a></li>
<li><a href="../ja462003/index.html">Google PlayのSvelteにPWAを投稿した方法</a></li>
<li><a href="../ja462005/index.html">Google PageSpeedの機能：サイトの評価と検索ランキングの改善</a></li>
<li><a href="../ja462009/index.html">プログラミングの傾向：2020年に何が期待できるか？</a></li>
<li><a href="../ja462011/index.html">Webジオサービス。最新のソリューションの概要</a></li>
<li><a href="../ja462013/index.html">Dockerストレージ（docker root）移行の問題履歴</a></li>
<li><a href="../ja462015/index.html">SAPレポートユニバース</a></li>
<li><a href="../ja462021/index.html">同じことをやめる方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>