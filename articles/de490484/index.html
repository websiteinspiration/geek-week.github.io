<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙏🏿 🧝🏻 👦🏼 Verwalten von Smart-Home-Sensoren mit dem Google-Assistenten 🏂 🌎 🌉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo, die Kollegen in diesem Handbuch erklären Ihnen, wie Sie Smart-Home-Sensoren mithilfe des Google-Assistenten und des mqtt-Protokolls am Beispiel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Verwalten von Smart-Home-Sensoren mit dem Google-Assistenten</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490484/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo, die Kollegen in diesem Handbuch erklären Ihnen, wie Sie Smart-Home-Sensoren mithilfe des Google-Assistenten und des mqtt-Protokolls am Beispiel der ESP8266-Karte und der LED steuern. </font><font style="vertical-align: inherit;">Wir werden auch unsere eigene Assistant-App mit Blackjack- und PHP-Skripten erstellen. </font><font style="vertical-align: inherit;">Ich bitte alle um Katze.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu benötigen wir den ESP8266-Controller oder andere Controller mit einer Internetverbindung sowie einen Server mit einem gültigen SSL-Zertifikat (anstelle eines gültigen SSL-Zertifikats können Sie einen Reverse-Proxy verwenden, der bereits über einen verfügt) und einen MQTT-Server (Broker). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Integration mit Google Assistant verwenden wir den Google Actions-Dienst und Dialogflow. </font><font style="vertical-align: inherit;">Also fangen wir an.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/n4/so/7nn4sojacyuqznn0ngm2_az_tek.jpeg" alt="Bild"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt erstellen und einrichten</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Aktionskonsole</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst müssen Sie sich beim </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dienst</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anmelden </font><font style="vertical-align: inherit;">und ein Projekt erstellen, eine Sprache und eine Region auswählen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3c/8d/8p/3c8d8pr_uuzir7e6jizg3cx-xf4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie den Bereich auswählen müssen. </font><font style="vertical-align: inherit;">Ich habe mich für Kids &amp; Family entschieden. </font><font style="vertical-align: inherit;">Aus der Erfahrung eines anderen kann ich sagen, dass die logisch fragende Kategorie Smart Home nur mit Geräten von Google ordnungsgemäß funktioniert. Für Projekte mit eigenen Sensoren ist es besser, eine andere Kategorie für den korrekten Betrieb auszuwählen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/jk/-x/qrjk-xl3cvbhcrpdocrfhyfiecm.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir lesen und akzeptieren die Vereinbarung. </font><font style="vertical-align: inherit;">Gehen Sie in der Kategorie Schnelleinrichtung zu Entscheiden, wie Ihre Aktion aufgerufen wird. </font><font style="vertical-align: inherit;">Wir überlegen, wie unser Bot heißen wird, wählen eine der verfügbaren Stimmen aus und speichern sie. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w1/oz/ue/w1ozueqhhrzh0y42i1xwfwk8330.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wechseln Sie zur Registerkarte Aktionen, und fügen Sie eine Aktion für benutzerdefinierte Absichten hinzu</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/sg/n4/ntsgn4ps4curjg5c0ociivilfma.png" alt="Bild"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dialogfluss</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie auf die Schaltfläche Erstellen geklickt haben, werden wir zur Dialogflow-Ressource weitergeleitet. Außerdem melden wir uns an und fahren mit der Erstellung des Projekts fort:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wählen Sie die Standardsprache und Zeitzone.</font></font></li>
<li>   Fulfillment   <abbr title="Schnittstelle zwischen zwei Programmen">Webhook</abbr>.       (     ,  )   Dialogflow   POST .<br>
<br>
<img src="https://habrastorage.org/webt/2e/tu/ij/2etuijbmkox37tup8de8t8sq694.png" alt="Bild"></li>
<li>3.    .<br>
<br>
 intets         .       .      +   Intents.       .</li>
</ol><br>
<img src="https://habrastorage.org/webt/ay/d4/zy/ayd4zyszkzl59pzklkt8ps34sh4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Seite selbst kann in drei Kategorien unterteilt werden: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trainingsphrasen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind Wörter, auf die der Assistent mit dem Team antwortet. </font><font style="vertical-align: inherit;">Sie können für ein Team unterschiedlich sein. </font><font style="vertical-align: inherit;">Zum Beispiel die Wörter leuchten lassen, das Licht ausschalten, die Lampe einschalten usw. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/v8/mm/duv8mm1gpmvibh2w6fd0u7x777w.png" alt="Bild"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktion</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - die Aktion selbst oder das Wort, das der Sensor verstehen wird, ist eins und konkret. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antworten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind die Antworten des Assistenten, nachdem der Befehl ausgeführt wurde. </font><font style="vertical-align: inherit;">Hier ist nur ein Feld für Kreativität.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/vj/hp/yxvjhpwsqueymkbo-4llo9jfvh8.png" alt="Bild"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hosting-Setup </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Server habe ich das billigste (5 US-Dollar) Droplet gekauft und Debian 10.2 darauf installiert. </font><font style="vertical-align: inherit;">Welches Hosting Sie wählen, spielt keine Rolle.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurieren Sie Reverse Proxy und DNS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können diesen Teil überspringen, wenn Sie ein Hosting mit einem gültigen Zertifikat haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Cloudflare-Dienst selbst bietet viele Namen niedrigerer Ebenen. Wenn Sie also Probleme mit Schritt 4 haben, müssen Sie möglicherweise Ihre IP-Adresse anstelle der Standard-IP-Adresse in der Inhaltsspalte in der Nähe von www ***, https // www *** (*** ist Ihre Domain) angeben. . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Interaktion mit Dialogflow benötigen Sie ein SSL-Zertifikat. </font><font style="vertical-align: inherit;">Ich habe es nicht auf dem Server installiert, sondern den DNS-Proxy Cloudflare (kostenlos - grundlegend) verwendet. </font><font style="vertical-align: inherit;">Zu diesem Zweck habe ich bei der Konfiguration von Cloudflare meinen zuvor gekauften Domänennamen hinzugefügt und die IP-Adresse meines Servers hinzugefügt (Spalte Inhalt). </font><font style="vertical-align: inherit;">Außerdem wurden in den Einstellungen des Namensanbieters zwei A-Datensätze hinzugefügt (im Bild ist es Wert). </font><font style="vertical-align: inherit;">Es ist erwähnenswert, dass das Hinzufügen eines Datensatzes keine Frage von Sekunden ist und bis zu mehreren Werktagen dauern kann.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yp/gz/qz/ypgzqzczh7qgdveopje4to1dtp8.png" alt="Bild"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Software Installation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Vergessen Sie nicht, nach dem ersten Starten des Servers die Paketdatenbank zu aktualisieren</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und aktualisieren Sie dann die installierten Pakete </font></font><pre><code class="bash hljs">apt upgrade</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Nachdem wir LAMP </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache </font><font style="vertical-align: inherit;">installiert haben</font></font><br>
<br>
<pre><code class="bash hljs">apt install apache2 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Php / mysql</font></font><br>
<br>
<pre><code class="bash hljs">apt-get install php libapache2-mod-php php-mcrypt php-mysql</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie die Serveradresse in apache2.conf hinzu. Dies kann mit dem Befehl nano /etc/apache2/apache2.conf erfolgen, der am Ende der Datei Servername *** am Ende Ihrer Datei angibt, wo Sie anstelle von Sternchen die Server-IP ersetzen müssen. Überprüfen Sie die Syntax und starten Sie den Apach-Dienst neu. Weitere Informationen finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie die oben beschriebenen Schritte bei der Eingabe Ihres Domainnamens in die Browserleiste erfolgreich ausgeführt haben, erhalten Sie die Apache2-Begrüßungsseite. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/3k/uw/wu3kuwqec_ykskpcqtqttzph6wm.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn dies nicht der Fall ist, überprüfen Sie, ob die Befehle korrekt ausgeführt wurden und ob die Seite mit einer ungesicherten http-Verbindung funktioniert. Wenn es funktioniert, überwacht der Server wahrscheinlich Port 80 und nicht Port 443. Oder es läuft bereits ein Dienst darauf. Weitere Details </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Installieren der Mosquitto Library für PHP</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IoT-Geräte können unterschiedliche Protokolle für die Interoperabilität verwenden. </font><font style="vertical-align: inherit;">Ein solches </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das auf Publisher-Subscriber-Basis arbeitet. </font><font style="vertical-align: inherit;">In diesem Fall können Abonnenten Informationen von vielen Herausgebern erhalten. </font><font style="vertical-align: inherit;">Da das Protokoll jedoch nur bestimmte Arten von Nachrichten versteht, benötigt es einen Konverter (Broker). </font><font style="vertical-align: inherit;">Hier haben wir es eingerichtet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Wenn Sie PECL nicht installiert haben, installieren Sie es</font></font><br>
<br>
<pre><code class="bash hljs">apt install pecl</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir Makler geworden sind </font></font><br>
<br>
<pre><code class="bash hljs">pecl install Mosquitto-alpha</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie dann die Erweiterung = mosquitto.so zu Ihrer php.ini hinzu. </font><font style="vertical-align: inherit;">Und vergiss den Kunden nicht</font></font><br>
<br>
<pre><code class="bash hljs">apt install mosquitto mosquitto-clients
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere Details </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP-Skript einrichten, Thema abonnieren</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich das Skript selbst. </font><font style="vertical-align: inherit;">Der Zweck besteht darin, eine Post-Anfrage von Dialogflow zu akzeptieren, die Aktion von dieser zu isolieren und sie als Nachricht an den Broker im Betreff zu senden, dessen Name am Ende des Skripts angegeben ist. </font><font style="vertical-align: inherit;">Wie Sie ein Skript nennen, spielt keine Rolle. </font><font style="vertical-align: inherit;">Dies ist übrigens das Skript, das wir auf der Registerkarte Erfüllung angegeben haben. </font><font style="vertical-align: inherit;">Platzieren Sie das Skript unter / var / www / html. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Themen werden von Abonnenten erstellt. Verwenden Sie den Befehl, um ein Thema zu erstellen:</font></font><br>
<br>
<pre><code class="bash hljs">mosquitto_sub -h localhost - t /<span class="hljs-built_in">test</span>/light</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anstelle von localhost können Sie eine andere Adresse oder Domain angeben, unter der Sie einen Publisher (Pub) erstellen möchten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anstelle von / test / light können Sie ein beliebiges Thema angeben. </font><font style="vertical-align: inherit;">In unserem Fall ist die Hauptsache, dass es im Skript angegeben wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachrichten werden von Herausgebern erstellt. </font><font style="vertical-align: inherit;">Um eine Nachricht zu erstellen, können Sie den Befehl verwenden.</font></font><br>
<br>
<pre><code class="bash hljs">mosquitto_pub -h localhost - t /<span class="hljs-built_in">test</span>/light -m “light”</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber wir werden es nicht brauchen, weil unser Verlag (Pub) unsere Anwendung sein wird. </font><font style="vertical-align: inherit;">Wenn unsere Anwendung einen Befehl empfängt, sendet sie eine Anforderung an unser Skript. </font><font style="vertical-align: inherit;">Das Skript ist für den Broker und der Broker ist für den Abonnenten (esp8266). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden das Senden von Nachrichten über die Registerkarte Test Action Console überprüfen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/j0/ff/ljj0ffysayc5d3wfg8ui2rcc15w.png" alt="Bild"><br>
<br>
<img src="https://habrastorage.org/webt/j5/tf/xz/j5tfxzjm9gbh7toxf9wi6zah2zw.png" alt="Bild"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP-Skript</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">//Make sure that it is a POST request.</span>
<span class="hljs-keyword">if</span>(strcasecmp($_SERVER[<span class="hljs-string">'REQUEST_METHOD'</span>], <span class="hljs-string">'POST'</span>) != <span class="hljs-number">0</span>){
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">'Request method must be POST!'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//Make sure that the content type of the POST request has been set to application/json</span>
$contentType = <span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">"CONTENT_TYPE"</span>]) ? trim($_SERVER[<span class="hljs-string">"CONTENT_TYPE"</span>])                                                                                                              : <span class="hljs-string">''</span>;
<span class="hljs-keyword">if</span>(strcasecmp($contentType, <span class="hljs-string">'application/json'</span>) != <span class="hljs-number">0</span>){
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">'Content type must be: application/json'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//Receive the RAW post data.</span>
$content = trim(file_get_contents(<span class="hljs-string">"php://input"</span>));<font></font>
<font></font>
<span class="hljs-comment">//Attempt to decode the incoming RAW post data from JSON.</span><font></font>
$decoded = json_decode($content);<font></font>
<font></font>
<span class="hljs-comment">//file_put_contents($filename, $data);</span><font></font>
var_dump($decoded);<font></font>
<font></font>
<span class="hljs-keyword">echo</span> $decoded-&gt;queryResult-&gt;action;<font></font>
<font></font>
define(<span class="hljs-string">'BROKER'</span>, <span class="hljs-string">'localhost'</span>);<font></font>
define(<span class="hljs-string">'PORT'</span>, <span class="hljs-number">1883</span>);<font></font>
define(<span class="hljs-string">'CLIENT_ID'</span>,  getmypid());<font></font>
  <font></font>
$client = <span class="hljs-keyword">new</span> Mosquitto\Client(CLIENT_ID);<font></font>
$client-&gt;connect(BROKER, PORT, <span class="hljs-number">60</span>);<font></font>
<font></font>
        $message = $decoded-&gt;queryResult-&gt;action;<font></font>
        $client-&gt;publish(<span class="hljs-string">'/test/light'</span>, $message, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);<font></font>
        $client-&gt;loop();<font></font>
<span class="hljs-meta">?&gt;</span>
</code></pre><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware ESP8266</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Firmware verwenden wir die Arduino IDE. </font><font style="vertical-align: inherit;">Wenn jemand die IDE zum ersten Mal installiert, vergessen Sie nicht den ch340-Treiber. </font><font style="vertical-align: inherit;">Standardmäßig gibt es keine solche Zahlung in Arduino. </font><font style="vertical-align: inherit;">In Datei &gt;&gt; Einstellungen müssen Sie die Adresse der zusätzlichen Karten angeben: arduino.esp8266.com/stable/package_esp8266com_index.json. </font><font style="vertical-align: inherit;">In Tools &gt;&gt; board &gt;&gt; board manager müssen Sie das esp8266-Paket installieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Skizze nach const char * ssid sollten Sie den Namen Ihres Wi-Fi-Netzwerks angeben. </font><font style="vertical-align: inherit;">Nach const char * Passwort ihr Passwort. </font><font style="vertical-align: inherit;">Geben Sie nach const char * mqtt_server die IP-Adresse Ihres Servers an.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skizzieren Sie die Arduino IDE</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">#include &lt;ESP8266WiFi.h&gt;<font></font>
#include &lt;PubSubClient.h&gt;<font></font>
<font></font>
// Update these with values suitable for your network.<font></font>
<font></font>
const char* ssid = "***";<font></font>
const char* password = "********";<font></font>
const char* mqtt_server = "**.**.*.*";<font></font>
<font></font>
WiFiClient espClient;<font></font>
PubSubClient client(espClient);<font></font>
long lastMsg = 0;<font></font>
char msg[50];<font></font>
int value = 0;<font></font>
<font></font>
int led = D5;<font></font>
<font></font>
void setup_wifi() {<font></font>
<font></font>
  delay(10);<font></font>
  // We start by connecting to a WiFi network<font></font>
  Serial.println();<font></font>
  Serial.print("Connecting to ");<font></font>
  Serial.println(ssid);<font></font>
<font></font>
  WiFi.begin(ssid, password);<font></font>
<font></font>
  while (WiFi.status() != WL_CONNECTED) {<font></font>
    delay(500);<font></font>
    Serial.print(".");<font></font>
  }<font></font>
<font></font>
  randomSeed(micros());<font></font>
<font></font>
  Serial.println("");<font></font>
  Serial.println("WiFi connected");<font></font>
  Serial.println("IP address: ");<font></font>
  Serial.println(WiFi.localIP());<font></font>
}<font></font>
<font></font>
void callback(char* topic, byte* payload, unsigned int length) {<font></font>
  String msg="";<font></font>
  Serial.print("Message arrived [");<font></font>
  Serial.print(topic);<font></font>
  Serial.print("] ");<font></font>
  for (int i = 0; i &lt; length; i++) {<font></font>
    Serial.print((char)payload[i]);<font></font>
    msg+=(char)payload[i];<font></font>
  }<font></font>
  Serial.println();<font></font>
<font></font>
  // Switch on the LED if an 1 was received as first character<font></font>
//  if ((char)payload[0] == '1') {<font></font>
  if (msg == "light") {<font></font>
    digitalWrite(led, HIGH);   // Turn the LED on <font></font>
  } else {<font></font>
    digitalWrite(led, LOW);  // Turn the LED off <font></font>
  }<font></font>
<font></font>
}<font></font>
<font></font>
void reconnect() {<font></font>
  // Loop until we're reconnected<font></font>
  while (!client.connected()) {<font></font>
    Serial.print("Attempting MQTT connection...");<font></font>
    // Create a random client ID<font></font>
    String clientId = "ESP8266Client-";<font></font>
    clientId += String(random(0xffff), HEX);<font></font>
    // Attempt to connect<font></font>
    if (client.connect(clientId.c_str())) {<font></font>
      Serial.println("connected");<font></font>
      // ... and resubscribe<font></font>
      client.subscribe("/test/light");<font></font>
    } else {<font></font>
      Serial.print("failed, rc=");<font></font>
      Serial.print(client.state());<font></font>
      Serial.println(" try again in 5 seconds");<font></font>
      // Wait 5 seconds before retrying<font></font>
      delay(5000);<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
void setup() {<font></font>
  pinMode(led, OUTPUT);     // Initialize the led pin as an output<font></font>
  Serial.begin(115200);<font></font>
  setup_wifi();<font></font>
  client.setServer(mqtt_server, 1883);<font></font>
  client.setCallback(callback);<font></font>
}<font></font>
<font></font>
void loop() {<font></font>
<font></font>
  if (!client.connected()) {<font></font>
    reconnect();<font></font>
  }<font></font>
  client.loop();<font></font>
<font></font>
}<font></font>
</code></pre></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ergebnis</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis erhalten wir nach dem Kompilieren der Skizze eine Anwendung, die in den Google-Assistenten integriert ist und die Sensoren verwaltet. </font><font style="vertical-align: inherit;">Anstelle eines Smartphones habe ich eine Webanwendung verwendet, aber auf Android getestet - das Ergebnis ist das gleiche. </font><font style="vertical-align: inherit;">Die Hauptsache ist, wenn Sie von einem Smartphone aus testen, vergessen Sie nicht zu sagen: "Sprechen Sie mit der Anwendung ***".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/vh/ug/qfvhugumopat-isohcimmyujd08.jpeg" alt="Bild"><br>
<br>
<img src="https://habrastorage.org/webt/eh/or/mv/ehormvyz41fgzhgogas1yrszpvs.jpeg" alt="Bild"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/g-S82CdMIrY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490472/index.html">Da habe ich eine semi-dezentrale Kryptowährung in PHP geschrieben. (Teil 1 - Sammeln von Bibliotheken)</a></li>
<li><a href="../de490474/index.html">STM32 Teil 1: Die Grundlagen</a></li>
<li><a href="../de490476/index.html">Drahtloser Sensor zum Öffnen und Schließen mit erweiterter Funktionalität</a></li>
<li><a href="../de490478/index.html">DIY DIY Lötstation v2</a></li>
<li><a href="../de490480/index.html">O Tiling-wm in 2 Worten</a></li>
<li><a href="../de490490/index.html">Wochenendlesung: 10 Materialien zu den Auswirkungen von Geräuschen auf die Gesundheit - von „Lärmhygiene“ über guten Schlaf bis hin zu GTD</a></li>
<li><a href="../de490492/index.html">Der Lagerroboter lernt, nicht standardmäßige Dinge zu sortieren</a></li>
<li><a href="../de490494/index.html">Shop Ratten, Widiots und Gamer: Propaganda über die Gefahren von Videospielen in den 80er Jahren</a></li>
<li><a href="../de490496/index.html">Erstellen eines Online-Shops auf Nuxt.js 2 Exemplarische Vorgehensweise Teil 1</a></li>
<li><a href="../de490498/index.html">Da habe ich eine semi-dezentrale Kryptowährung in PHP geschrieben. (Teil 2 - Entwicklung)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>