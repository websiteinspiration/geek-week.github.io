<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🚒 🥕 Ⓜ️ Commencer avec Core Data! Difficile avec des mots simples 🃏 👨‍🚀 🥒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreux sujets ont déjà été écrits avec Core Data, mais la plupart de ces articles sont en anglais, ainsi qu'en utilisant beaucoup de mots «intell...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Commencer avec Core Data! Difficile avec des mots simples</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493262/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De nombreux sujets ont déjà été écrits avec Core Data, mais la plupart de ces articles sont en anglais, ainsi qu'en utilisant beaucoup de mots «intelligents» qui peuvent dérouter les débutants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je vais essayer de parler de ce cadre d'Apple dans un langage compréhensible afin que même les "plus petits" programmeurs puissent obtenir des informations pour eux-mêmes et obtenir le minimum de connaissances qui les aideront dans leurs projets.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Petit hors-sujet</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Core Data est un outil très puissant qui vous permet d'enregistrer des données dans votre application et de les utiliser plus tard. </font><font style="vertical-align: inherit;">Dans cet article, je ne parlerai PAS de travailler avec plusieurs contextes avec une synchronisation ultérieure, comment résoudre les problèmes de migration et diverses fonctionnalités avancées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le public cible de cet article est constitué de personnes n'ayant généralement aucune expérience avec Core Data.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien ... Commençons!</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, vous devez créer le fichier .xcdatamodeld lui-même, après l'avoir ouvert, au bas de l'écran, vous verrez le bouton "Ajouter une entité". </font><font style="vertical-align: inherit;">En cliquant dessus, votre modèle d'objet sera créé: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/eu/c5/tieuc5lzlieaqlnl2hzsnbgnypu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, plus en détail:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre entité. </font><font style="vertical-align: inherit;">Vous pouvez considérer Entity comme votre structure de données, qui a l'héritage d'une certaine classe - NSManagedObject, et aura également certains champs pour écrire des données, plus à ce sujet plus tard.</font></font></li>
<li> Attributes.    Entity    .    +       .    : <br>
<ul>
<li>Integer 16/32/64 —        .       ,      .       Int,         .<br>
: Integer16(15)</li>
<li>Decimal/Double/Float —          .       ,      .</li>
<li>String —        .</li>
<li>Boolean —        .</li>
<li>Date —        Date. <br>
<blockquote>NOTE: Core Data           00:00:00 UTC 1  1970   .</blockquote></li>
<li>Binary Data —       Data<br>
<blockquote>NOTE:      Allow External Storage. Core Data   ,     100 ,       Core Data        .           . </blockquote></li>
<li>UUID —          UUID.</li>
<li>URI —        URL</li>
<li>Transformable —     ,       NSCoding.</li>
</ul><br>
</li>
<li> Relationship.           Entity. Relationships  :<br>
<br>
<ol>
<li>One-to-One</li>
<li>One-to-Many</li>
<li>Many-to-Many</li>
</ol><br>
  Relationships.<br>
 <br>
   3 Entities, Andrey, Home, Car. <br>
<br>
<ul>
<li>     — One-to-One Relationship.</li>
<li>    1,    2    — One-to-Many Relationship.</li>
<li> Many-to-Many Relationship     .                       .</li>
</ul></li>
<li>         Entity</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Champ Codegen. </font><font style="vertical-align: inherit;">En bref, ce champ indique qui régira la création des classes NSManagedObject. </font><font style="vertical-align: inherit;">Pour une facilité d'utilisation, sélectionnez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manuel / Aucun</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis Core Data pourra créer les classes nécessaires pour votre entité elle-même. </font><font style="vertical-align: inherit;">À ce sujet ci-dessous.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour créer notre classe Entity, utilisez: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Editor&gt; Create NSManagedObject Subclass. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d7/yl/b6/d7ylb6nrjnzpsqytkn4-lzq-ctq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez définir des valeurs par défaut pour vos attributs, utilisez la méthode:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">awakeFromInsert</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.awakeFromInsert()<font></font>
        date = <span class="hljs-type">Date</span>()<font></font>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec NSManagedObjectContext et PersistentStoreCoordinator</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hiérarchie de la pile de données de base: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/jl/dr/spjldrdtwsjpgd5_6zxq7snxvj8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en termes simples, toutes vos entités sont affichées en tant qu'objets gérés dans le diagramme ci-dessus. </font><font style="vertical-align: inherit;">Tous nos objets gérés sont stockés dans NSManagedObjectContext. </font><font style="vertical-align: inherit;">Contexte Il fait référence au NSPersistentStoreCoordinator qui stocke vos données enregistrées sous forme de cache de lignes après avoir accédé à SQL, mais ce n'est plus le cas actuellement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour créer une instance de votre ManagedObject (Entity), vous devez vous référer à votre NSPersistentContainer qui est un wrapper pour votre NSPersistentStoreCoordinator.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> persistentContainer: <span class="hljs-type">NSPersistentContainer</span> = {
      <span class="hljs-keyword">let</span> container = <span class="hljs-type">NSPersistentContainer</span>(name: <span class="hljs-string">"SavingLearn"</span>)<font></font>
      container.loadPersistentStores(completionHandler: { (storeDescription, error) <span class="hljs-keyword">in</span>
          <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error <span class="hljs-keyword">as</span> <span class="hljs-type">NSError?</span> {
              <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Unresolved error \(error), \(error.userInfo)"</span>)<font></font>
          }<font></font>
      })<font></font>
      <span class="hljs-keyword">return</span> container<font></font>
  }()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous devons accéder à NSManagedObjectContext via notre PersistentContainer: </font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> context: <span class="hljs-type">NSManagedObjectContext</span> = {
    <span class="hljs-keyword">return</span> persistentContainer.viewContext<font></font>
  }()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons maintenant créer une instance de notre ManageObject à partir de notre contexte et lui affecter une valeur:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> person = <span class="hljs-type">Person</span>(context: context)<font></font>
person.age = <span class="hljs-number">32</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrement d'un objet</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour économiser, nous utilisons une fonction simple: </font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveContext</span> <span class="hljs-params">()</span></span> {
      <span class="hljs-keyword">if</span> context.hasChanges {
          <span class="hljs-keyword">do</span> {
              <span class="hljs-keyword">try</span> context.save()<font></font>
          } <span class="hljs-keyword">catch</span> {<font></font>
            context.rollback()<font></font>
              <span class="hljs-keyword">let</span> nserror = error <span class="hljs-keyword">as</span> <span class="hljs-type">NSError</span>
              <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Unresolved error \(nserror), \(nserror.userInfo)"</span>)<font></font>
          }<font></font>
      }<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la méthode ci-dessus, nous vérifions notre contexte pour les changements et s'ils sont présents, nous faisons une sauvegarde. </font><font style="vertical-align: inherit;">En cas d'erreur, la méthode est exécutée:</font></font><br>
<br>
<pre><code class="swift hljs">context.rollback()</code></pre><br>
<blockquote><pre><code class="swift hljs">rollback()</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La méthode ramène notre contexte à son état d'origine et annule toutes les modifications qui y ont été apportées.</font></font></blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supprimer un objet</font></font></b><br>
<br>
<pre><code class="swift hljs">context.delete(object)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous permet de supprimer facilement un objet de Core Data.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REMARQUE: pour que les modifications prennent effet, il est nécessaire d'enregistrer le contexte, sinon toutes les modifications ne seront pas enregistrées. </font></font><pre><code class="swift hljs">context.save()</code></pre> </blockquote><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Récupération de tous les objets</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'obtenir un tableau de nos objets à partir de Core Data, nous devons effectuer NSFetchRequest. </font><font style="vertical-align: inherit;">Je n'entrerai pas profondément dans la pleine puissance de FetchRequest puisque cet article est conçu pour les débutants.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> fetchRequest: <span class="hljs-type">NSFetchRequest</span>&lt;<span class="hljs-type">Person</span>&gt; = <span class="hljs-type">Person</span>.fetchRequest()
<span class="hljs-keyword">let</span> objects = <span class="hljs-keyword">try</span> context.fetch(fetchRequest)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous le capot, NSFetchRequest fait un excellent travail: </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSFetchRequest va au coordinateur de magasin persistant</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le coordinateur du magasin persistant envoie une demande au magasin persistant </font></font></li>
<li>Persistent Store     SQL</li>
<li>SQL       .    ID  Row Value.  Row Value   Persistent Store      Row Cache   ID. </li>
<li>Persistent Store  Managed Objects   ID     Persistent Store Coordinator.    fault ()          .   Managed Object Context      ID, Core Data       SQL.</li>
<li>Persistent Store Coordinator   context  Managed Object</li>
<li>   Core Data    .        <pre><code class="swift hljs">includePendingChanges = <span class="hljs-literal">false</span></code></pre> </li>
<li>  NSManagedObject </li>
</ol><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REMARQUE: pendant que le contexte d'objet géré NSFetchRequest est en cours d'exécution et que le coordinateur de magasin persistant s'exécute dans une file d'attente synchrone, tous les processus sont bloqués pendant qu'un autre processus est en cours d'exécution. </font></font></blockquote><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, j'ai décrit les informations minimales nécessaires pour travailler avec Core Data à mon avis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant créer vos propres modèles de données, les enregistrer, les supprimer et les récupérer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous êtes intéressé par un sujet plus «avancé» sur l'utilisation de Core Data et des conseils intéressants, écrivez dans les commentaires et je trouverai ce qui peut être fait à ce sujet. </font><font style="vertical-align: inherit;">Bon codage!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493244/index.html">Que peut un ordinateur quantique</a></li>
<li><a href="../fr493248/index.html">Webinaire "Opportunités de Winnum pour l'analyse industrielle"</a></li>
<li><a href="../fr493250/index.html">Que se passe-t-il avec les voyages en ce moment - et comment vous protéger dans les transports</a></li>
<li><a href="../fr493252/index.html">Expérience d'enseignement dans une école de développement, ou pourquoi vous devez aller à l'école après l'université</a></li>
<li><a href="../fr493254/index.html">Le système d'écoute électronique de masse de la population était pratiquement inutile pour le FBI</a></li>
<li><a href="../fr493264/index.html">Où vous étiez avant ou fonctionnalités implicites de BI BA</a></li>
<li><a href="../fr493266/index.html">45 chaînes YouTube en anglais pour les professionnels de l'informatique</a></li>
<li><a href="../fr493268/index.html">Pentester Appliqué</a></li>
<li><a href="../fr493272/index.html">Comment activer Google Documents hors ligne dans le nouveau Microsoft Edge</a></li>
<li><a href="../fr493274/index.html">Plus de 30 recommandations professionnelles concises pour les développeurs Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>