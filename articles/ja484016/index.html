<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆓 🤸🏽 🔋 デバッグオートエンコーダーの例に関するディープラーニングの基礎、パート1 👩🏼‍🤝‍👨🏽 💨 ❣️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="keras.ioのWebサイトでオートエンコーダーに関するトレーニングを読んだ場合、最初のメッセージの1つは次のようなものです。実際には、オートエンコーダーはほとんど使用されていませんが、トレーニングで話題になり、人々が訪れるため、これらについて独自のチュートリアルを書くことにしました。
 

彼ら...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>デバッグオートエンコーダーの例に関するディープラーニングの基礎、パート1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484016/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keras.ioのWebサイトでオートエンコーダーに関するトレーニングを読んだ場合、最初のメッセージの1つは次のようなものです。実際には、オートエンコーダーはほとんど使用されていませんが、トレーニングで話題になり、人々が訪れるため、これらについて独自のチュートリアルを書くことにしました。</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼らの名声への主な主張は、オンラインで利用できる多くの入門機械学習クラスで紹介されていることに由来しています。</font><font style="vertical-align: inherit;">その結果、この分野の初心者の多くは、オートエンコーダを絶対に愛し、十分にそれらを入手することができません。</font><font style="vertical-align: inherit;">これが、このチュートリアルが存在する理由です。</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それにもかかわらず、それらを自分に適用できる実用的なタスクの1つは異常の検索であり、私は個人的に夕方のプロジェクトのフレームワークでそれを必要としていました。 </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターネット上に</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動エンコーダに関するチュートリアル</font><strong><font style="vertical-align: inherit;">が</font></strong><font style="vertical-align: inherit;">たくさん</font><font style="vertical-align: inherit;">あり</font><strong><font style="vertical-align: inherit;">ますが、</font></strong><font style="vertical-align: inherit;">もう1つ書くにはどう</font><font style="vertical-align: inherit;">すれ</font><font style="vertical-align: inherit;">ばよいでしょうか。</font><font style="vertical-align: inherit;">正直なところ、これにはいくつかの理由がありました。</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実はチュートリアルは3つか4つくらいで、残りは全て自分の言葉で書き直した感じがしました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほとんどすべて-長く苦しんでいるMNIST'eの写真28x28;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の控えめな意見では-彼らはこれがどのように機能するかについて直感を発達させませんが、単に繰り返すことを提案します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、最も重要な要因-個人的には、MNISTを</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自分のデータセット</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に置き換えたとき</font><strong><font style="vertical-align: inherit;">-すべてが愚かに動作を停止しました</font></strong><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<p>   ,    .       ( )         —  ,    ,  .   —   ,   ,  -    ,    . </p><br>
<p>        ,      .   data scientists      ,   ,   ,  -   . </p><a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><p>    ,     .  ADS-B ,          , ,   . ,     — ,     ,         ().         ,     ,  .  ,      ,       <del></del>  .</p></div></div><br>
<p>.      4000 -  6464 ,     :</p><br>
<p><img src="https://habrastorage.org/webt/vw/5r/mh/vw5rmhetruoniuc7p4ksjulshde.png"></p><br>
<p> -    ,    6464   2% .    ,  , , ,      . </p><br>
<p>     ,   , ,   ,  ,  .     .</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># only for google colab</span>
%tensorflow_version <span class="hljs-number">2.</span>x 
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> zipfile
<span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> tensorflow_addons <span class="hljs-keyword">as</span> tfa<font></font>
<font></font>
BATCH_SIZE = <span class="hljs-number">128</span><font></font>
AUTOTUNE=tf.data.experimental.AUTOTUNE<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_image</span>(<span class="hljs-params">fpath</span>):</span><font></font>
  img_raw = tf.io.read_file(fpath)<font></font>
  img = tf.io.decode_png(img_raw, channels=<span class="hljs-number">1</span>, dtype=tf.uint8)
  <span class="hljs-keyword">return</span> tf.image.convert_image_dtype(img, dtype=tf.float32)<font></font>
<font></font>
<span class="hljs-comment">## for splitting test/train</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_test</span>(<span class="hljs-params">x, y</span>):</span>
  <span class="hljs-keyword">return</span> x % <span class="hljs-number">4</span> == <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_train</span>(<span class="hljs-params">x, y</span>):</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">not</span> is_test(x,y)<font></font>
<font></font>
<span class="hljs-comment">## for image augmentation</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_flip_flop</span>(<span class="hljs-params">img</span>):</span>
  <span class="hljs-keyword">return</span> tf.image.random_flip_left_right(img)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform_aug</span>(<span class="hljs-params">shift_val</span>):</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_transform</span>(<span class="hljs-params">img</span>):</span>
    <span class="hljs-keyword">return</span> tfa.image.translate(img,tf.random.uniform([<span class="hljs-number">2</span>], <span class="hljs-number">-1</span>*shift_val, shift_val))
  <span class="hljs-keyword">return</span> random_transform<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prepare_for_training</span>(<span class="hljs-params">ds, cache=True, shuffle_buffer_size=<span class="hljs-number">1000</span>, transform=<span class="hljs-number">0</span>, flip=False</span>):</span>
  <span class="hljs-keyword">if</span> cache:
    <span class="hljs-keyword">if</span> isinstance(cache, str):<font></font>
      ds = ds.cache(cache)<font></font>
    <span class="hljs-keyword">else</span>:<font></font>
      ds = ds.cache()<font></font>
<font></font>
  ds = ds.shuffle(buffer_size=shuffle_buffer_size)<font></font>
<font></font>
  <span class="hljs-keyword">if</span> transform != <span class="hljs-number">0</span>:<font></font>
    ds = ds.map(transform_aug(transform))<font></font>
<font></font>
  <span class="hljs-keyword">if</span> flip:<font></font>
    ds = ds.map(random_flip_flop)<font></font>
<font></font>
  ds = ds.repeat()<font></font>
  ds = ds.batch(BATCH_SIZE)<font></font>
  ds = ds.prefetch(buffer_size=AUTOTUNE)<font></font>
<font></font>
  <span class="hljs-keyword">return</span> ds<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prepare_input_output</span>(<span class="hljs-params">x</span>):</span>
    <span class="hljs-keyword">return</span> (x, x)<font></font>
<font></font>
list_ds = tf.data.Dataset.list_files(<span class="hljs-string">"/content/planes64/*"</span>)<font></font>
imgs_df = list_ds.map(load_image)<font></font>
<font></font>
train = imgs_df.enumerate().filter(is_train).map(<span class="hljs-keyword">lambda</span> x,y: y)<font></font>
train_ds = prepare_for_training(train, transform=<span class="hljs-number">10</span>, flip=<span class="hljs-literal">True</span>)<font></font>
train_ds = train_ds.map(prepare_input_output)<font></font>
<font></font>
val = imgs_df.enumerate().filter(is_test).map(<span class="hljs-keyword">lambda</span> x, y: y)<font></font>
val_ds = val.map(prepare_input_output).batch(BATCH_SIZE, drop_remainder=<span class="hljs-literal">True</span>)</code></pre></div></div><br>
<p>, ,      keras.io,     mnist'   :</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># this is the size of our encoded representations</span>
encoding_dim = <span class="hljs-number">32</span>  <span class="hljs-comment"># 32 floats -&gt; compression of factor 24.5, assuming the input is 784 floats</span><font></font>
<font></font>
<span class="hljs-comment"># this is our input placeholder</span>
input_img = Input(shape=(<span class="hljs-number">784</span>,))
<span class="hljs-comment"># "encoded" is the encoded representation of the input</span>
encoded = Dense(encoding_dim, activation=<span class="hljs-string">'relu'</span>)(input_img)
<span class="hljs-comment"># "decoded" is the lossy reconstruction of the input</span>
decoded = Dense(<span class="hljs-number">784</span>, activation=<span class="hljs-string">'sigmoid'</span>)(encoded)</code></pre><br>
<p>      :</p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>/<span class="hljs-number">10</span>, activation=<span class="hljs-string">'relu'</span>)) <font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, activation=<span class="hljs-string">"sigmoid"</span>))<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p>  ,       flatten  reshape,   ""   25 ,    10.       . </p><br>
<p>  loss- — mean squared error,   ,  adam.   ,  20 ,  100   . </p><br>
<p>    —   . Accuracy == 0.993.      —   ,       .</p><br>
<p><img src="https://habrastorage.org/webt/fo/rq/r7/forqr7krelrj1xq1qis_jg2jeoq.png"></p><br>
<p>        ,      ( ,  —  -):</p><br>
<p><img src="https://habrastorage.org/webt/xo/mn/oq/xomnoqmjj80uaal0echobmal9xm.png"></p><br>
<p> ,     -   —                 .   . </p><br>
<p>   —            .        flatten  reshape.   no-op : </p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p>:<br>
<img src="https://habrastorage.org/webt/vx/z0/aj/vxz0ajadu2qiktdq5ndzj5xje8w.png"></p><br>
<p>    .     ,      . </p><br>
<p> ,     no-op,    —    ,      input.     , ,  ,     ,     identity .        ,        .</p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, activation=<span class="hljs-string">"sigmoid"</span>))<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p>-  , accuracy == 0.995     .<br>
<img src="https://habrastorage.org/webt/ro/t6/jk/rot6jkf2ertweb7weeh8d_layui.png"></p><br>
<p>,  , ,     .    —   ,      . </p><br>
<p>   keras'  dense ,   ,   : <code>output = activation(dot(input, kernel) + bias)</code><br>
 output   input'     — bias = 0  kernel —   (     ,   —    ). ,              <code>Dense</code>.</p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, activation = <span class="hljs-string">"sigmoid"</span>, use_bias=<span class="hljs-literal">False</span>, kernel_initializer = tf.keras.initializers.Identity()))<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p>..    ,      —   :<br>
<img src="https://habrastorage.org/webt/dm/tk/5a/dmtk5ardo9xksg8c5v5febzikdo.png"></p><br>
<p>     —   ,   ,  —    accuracy == 1.0,    .<br>
 evaluate  : <code>8/Unknown - 1s 140ms/step - loss: 0.2488 - accuracy: 1.0000[0.24875330179929733, 1.0]</code>. :</p><br>
<pre><code class="plaintext hljs">Epoch 1/20<font></font>
100/100 [==============================] - 6s 56ms/step - loss: 0.1589 - accuracy: 0.9990 - val_loss: 0.0944 - val_accuracy: 0.9967<font></font>
Epoch 2/20<font></font>
100/100 [==============================] - 5s 51ms/step - loss: 0.0836 - accuracy: 0.9964 - val_loss: 0.0624 - val_accuracy: 0.9958<font></font>
Epoch 3/20<font></font>
100/100 [==============================] - 5s 50ms/step - loss: 0.0633 - accuracy: 0.9961 - val_loss: 0.0470 - val_accuracy: 0.9958<font></font>
Epoch 4/20<font></font>
100/100 [==============================] - 5s 48ms/step - loss: 0.0520 - accuracy: 0.9961 - val_loss: 0.0423 - val_accuracy: 0.9961<font></font>
Epoch 5/20<font></font>
100/100 [==============================] - 5s 48ms/step - loss: 0.0457 - accuracy: 0.9962 - val_loss: 0.0357 - val_accuracy: 0.9962</code></pre><br>
<p>    ,      —   1  1,  loss (mean squared error) —  0.25 . </p><br>
<p>, ,     — loss ,  accuracy  ,    ?<br>
       Dense: <code>output = activation(dot(input, kernel) + bias)</code>      activation,      .    identity    bias   <code>output = activation(input)</code>.</p><br>
<p>,      -  , sigmoid,       .        .   . </p><br>
<p> ,    ,    : <code>The sigmoid activation: (1.0 / (1.0 + exp(-x)))</code>.      ,      ,      .<br>
   :</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> matplotlib.ticker <span class="hljs-keyword">as</span> plticker<font></font>
range_tensor = tf.range(<span class="hljs-number">-4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0.01</span>, dtype=tf.float32)<font></font>
fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<font></font>
plt.plot(range_tensor.numpy(), tf.keras.activations.sigmoid(range_tensor).numpy())<font></font>
ax.grid(which=<span class="hljs-string">'major'</span>, linestyle=<span class="hljs-string">'-'</span>, linewidth=<span class="hljs-string">'0.5'</span>, color=<span class="hljs-string">'red'</span>)<font></font>
ax.grid(which=<span class="hljs-string">'minor'</span>, linestyle=<span class="hljs-string">':'</span>, linewidth=<span class="hljs-string">'0.5'</span>, color=<span class="hljs-string">'black'</span>)<font></font>
ax.yaxis.set_major_locator(plticker.MultipleLocator(base=<span class="hljs-number">0.5</span>) )<font></font>
plt.minorticks_on()</code></pre><br>
<p><img src="https://habrastorage.org/webt/tp/bs/1b/tpbs1bjym9vqahdihjhm1aubrne.png"></p><br>
<p>    ,       0.5,    —   0.73.        (0.0),   (1.0).   ,  mean squared error  identity    . </p><br>
<p>   ,      :</p><br>
<pre><code class="python hljs">array([<span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.7310586</span>, <span class="hljs-number">0.7310586</span>,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ,
       <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      , <span class="hljs-number">0.5</span>      ], dtype=float32)</code></pre><br>
<p>  ,   ,  ,     :</p><br>
<ul>
<li>       ? </li>
<li>   accuracy == 1.0,     0  1. </li>
</ul><br>
<p>  —   .   ,   matplotlib: <code>plt.imshow(res_imgs[i][:, :, 0])</code>. ,  ,    ,     : <code>The Normalize instance used to scale scalar data to the [0, 1] range before mapping to colors using cmap. By default, a linear scaling mapping the lowest value to 0 and the highest to 1 is used.</code> ..     0.5  0.73    0  1.  :</p><br>
<pre><code class="python hljs">plt.imshow(res_imgs[i][:, :, <span class="hljs-number">0</span>], norm=matplotlib.colors.Normalize(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>))</code></pre><br>
<p><img src="https://habrastorage.org/webt/rn/qn/ta/rnqntag1dohhikail8y6myq7siy.png"></p><br>
<p>     accuracy.   —     ,   <code>tf.keras.metrics.Accuracy</code>     :</p><br>
<pre><code class="plaintext hljs">For example, if y_true is [1, 2, 3, 4] and y_pred is [0, 2, 3, 4] then the accuracy is 3/4 or .75.</code></pre><br>
<p>      accuracy    0. ,  ,         :</p><br>
<pre><code class="plaintext hljs"> When you pass the strings 'accuracy' or 'acc', we convert this to<font></font>
one of `tf.keras.metrics.BinaryAccuracy`,<font></font>
`tf.keras.metrics.CategoricalAccuracy`,<font></font>
`tf.keras.metrics.SparseCategoricalAccuracy` based on the loss<font></font>
function used and the model output shape. We do a similar conversion<font></font>
for the strings 'crossentropy' and 'ce' as well.</code></pre><br>
<p>     -      <code>.compile</code>. </p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://github.com/tensorflow/tensorflow/blob/66c48046f169f3565d12e5fea263f6d731f9bfd2/tensorflow/python/keras/engine/compile_utils.py</a></p><br>
<pre><code class="python hljs">y_t_rank = len(y_t.shape.as_list())<font></font>
y_p_rank = len(y_p.shape.as_list())<font></font>
y_t_last_dim = y_t.shape.as_list()[<span class="hljs-number">-1</span>]<font></font>
y_p_last_dim = y_p.shape.as_list()[<span class="hljs-number">-1</span>]<font></font>
<font></font>
is_binary = y_p_last_dim == <span class="hljs-number">1</span><font></font>
is_sparse_categorical = (<font></font>
    y_t_rank &lt; y_p_rank <span class="hljs-keyword">or</span> y_t_last_dim == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> y_p_last_dim &gt; <span class="hljs-number">1</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> metric <span class="hljs-keyword">in</span> [<span class="hljs-string">'accuracy'</span>, <span class="hljs-string">'acc'</span>]:
<span class="hljs-keyword">if</span> is_binary:<font></font>
    metric_obj = metrics_mod.binary_accuracy<font></font>
<span class="hljs-keyword">elif</span> is_sparse_categorical:<font></font>
    metric_obj = metrics_mod.sparse_categorical_accuracy<font></font>
<span class="hljs-keyword">else</span>:<font></font>
    metric_obj = metrics_mod.categorical_accuracy</code></pre><br>
<p><code>y_t</code>  y_true,     , <code>y_p</code>  y_predicted,    .<br>
   : <code>shape=(64,64,1)</code>,   ,  accuracy   binary_accuracy.  ,   :</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">binary_accuracy</span>(<span class="hljs-params">y_true, y_pred, threshold=<span class="hljs-number">0.5</span></span>):</span><font></font>
  threshold = math_ops.cast(threshold, y_pred.dtype)<font></font>
  y_pred = math_ops.cast(y_pred &gt; threshold, y_pred.dtype)<font></font>
  <span class="hljs-keyword">return</span> K.mean(math_ops.equal(y_true, y_pred), axis=<span class="hljs-number">-1</span>)</code></pre><br>
<p>,      —     ,   0.5,  0.5   — .    accuracy    identity ,          .  , ,      —    threshold   accuracy  , ,     .   ,    ,   ,            .   ,       -    :</p><br>
<pre><code class="python hljs">m = tf.keras.metrics.BinaryAccuracy()<font></font>
m.update_state(x_batch, res_imgs)<font></font>
print(m.result().numpy())</code></pre><br>
<p>  <code>1.0</code>. </p><br>
<p>  </p><br>
<pre><code class="python hljs">m = tf.keras.metrics.Accuracy()<font></font>
m.update_state(x_batch, res_imgs)<font></font>
print(m.result().numpy())</code></pre><br>
<p>  <code>0.0</code>     .</p><br>
<p>,       ,    loss-     .     ,         loss-:  mean squared error,  'binary_crossentropy'.      . </p><br>
<p>,  <code>mse</code>    <code>evaluate</code> :</p><br>
<pre><code class="plaintext hljs">8/Unknown - 2s 221ms/step - loss: 0.2488 - accuracy: 1.0000[0.24876083992421627, 1.0]</code></pre><br>
<p>.. loss == 0.2488.    .   ,      : -    y_true  y_predict,     ,    . </p><br>
<pre><code class="python hljs">tf.keras.backend.mean(tf.math.squared_difference(x_batch[<span class="hljs-number">0</span>], res_imgs[<span class="hljs-number">0</span>]))</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">&lt;tf.Tensor: shape=(), dtype=float32, numpy=0.24826494&gt;</code></pre><br>
<p>    —   ,     0.5,  0.25 — squared difference  . </p><br>
<p>C binary crossenttrtopy   ,      ,   ,        ,       :</p><br>
<pre><code class="python hljs">  <span class="hljs-keyword">if</span> from_logits:
    <span class="hljs-keyword">return</span> nn.sigmoid_cross_entropy_with_logits(labels=target, logits=output)<font></font>
<font></font>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isinstance(output, (ops.EagerTensor, variables_module.Variable)):<font></font>
    output = _backtrack_identity(output)<font></font>
      <span class="hljs-keyword">if</span> output.op.type == <span class="hljs-string">'Sigmoid'</span>:
        <span class="hljs-comment"># When sigmoid activation function is used for output operation, we</span>
        <span class="hljs-comment"># use logits from the sigmoid function directly to compute loss in order</span>
        <span class="hljs-comment"># to prevent collapsing zero when training.</span>
        <span class="hljs-keyword">assert</span> len(output.op.inputs) == <span class="hljs-number">1</span>
        output = output.op.inputs[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">return</span> nn.sigmoid_cross_entropy_with_logits(labels=target, logits=output)<font></font>
<font></font>
  <span class="hljs-comment"># Compute cross entropy from probabilities.</span><font></font>
  bce = target * math_ops.log(output + epsilon())<font></font>
  bce += (<span class="hljs-number">1</span> - target) * math_ops.log(<span class="hljs-number">1</span> - output + epsilon())
  <span class="hljs-keyword">return</span> -bce</code></pre><br>
<p> ,          . -,  ,     :    <code>sigmoid_cross_entropy_with_logits</code>,     .   ,  <code>sigmoid_cross_entropy_with_logits</code>   (   , doh),    —  . </p><br>
<p>  ?       ,      , ,  -.  ,   ,   ( ,    ).    —  .   log-odds,  ,    <strong>log</strong>istic un<strong>its</strong> —  . </p><br>
<div class="spoiler"><b class="spoiler_title">   -   </b><div class="spoiler_text"><p> (odds) —           (    —          ).  —        .     .      —     -,       1/2 (  ),      —      1/100.     — -  2/1,     —   100/1.  ,         0  1,    —  1  .    ,  ,       ,   .       —    :</p><br>
<pre><code class="plaintext hljs">ln(1/2) == -0.69<font></font>
ln(2/1) == 0.69<font></font>
ln(1/100) == -4.6<font></font>
ln(100/1) == 4.6</code></pre></div></div><br>
<p>   tensorflow —   , ..,  ,      log-odds,    .     -∞  +∞ —  .      .     : softmax     — sigmoid. Softmax —   ,      ,    ,          1. Sigmoid(  tf)    ,        ,   . </p><br>
<pre><code class="python hljs"><span class="hljs-comment"># 1+ln(0.5) == 0.30685281944</span><font></font>
<font></font>
tf.math.softmax(tf.constant([<span class="hljs-number">0.30685281944</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.30685281944</span>]))
<span class="hljs-comment">## &lt;tf.Tensor: shape=(3,), dtype=float32, numpy=array([0.25, 0.5 , 0.25], dtype=float32)&gt;</span>
tf.math.sigmoid(tf.constant([<span class="hljs-number">0.30685281944</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.30685281944</span>]))
<span class="hljs-comment">## &lt;tf.Tensor: shape=(3,), dtype=float32, numpy=array([0.57611686, 0.7310586 , 0.57611686], dtype=float32)&gt;</span></code></pre><br>
<p>      .   multi-label classification,   multi-class classification. Multiclass —     ,     ,     .  multilabel —            ,        ,   .   multiclass —  softmax,   multilabel —  sigmoid.<br>
    multilabel —     () ,   . </p><br>
<p>  tensorflow    binary crossentropy (     crossentropy    ) —   . Crossentropy    ,       .    :      ,      —       sigmoid,   .  ,   sigmoid   crossentropy  ,    crossentropy   (       <code>sigmoid_cross_entropy_with_logits</code>,      'numerical stability cross entropy'),    tensorflow       crossentropy ,     .      loss- ,    — sigmoid,          ,    ,     <code>sigmoid_cross_entropy_with_logits</code>.</p><br>
<p>,   ,  binary_crossentropy.    "" ,   cross-entropy. </p><br>
<p> : ,    ,   n     (y<sub>0</sub>, y<sub>1</sub>, ..., y<sub>n</sub>).            k<sub>n</sub> (k<sub>1</sub>, k<sub>1</sub>, ..., k<sub>n</sub>).    —        — (y<sub>1</sub>^k<sub>1</sub>)(y<sub>2</sub>^k<sub>2</sub>)...(y<sub>n</sub>^k<sub>n</sub>).   —     - —         .     ,     0  1     ,     .<br>
     —  k<sub>1</sub>log(y<sub>1</sub>) + k<sub>2</sub>log(y<sub>2</sub>)    .     -∞  0.     -1/n —     0  +∞,  , ..        ,           . </p><br>
<p> : - ,    ,       .         2 —     .     ,     nat' (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://en.wikipedia.org/wiki/Nat_(unit</a>)),   . </p><br>
<p>Binary cross-entropy,   ,     -,     .         — y<sub>1</sub>,      (1-y<sub>1</sub>).</p><br>
<p>,   ,   . ,       identity ,     ,   accuracy  1.0,       .  ,     :<br>
1)    ,   identity<br>
2)     ,    relu</p><br>
<p> :</p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, use_bias=<span class="hljs-literal">False</span>, kernel_initializer=tf.keras.initializers.Identity()))<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p>  identity :</p><br>
<pre><code class="python hljs">model.evaluate(x=val.map(<span class="hljs-keyword">lambda</span> x: (x,x)).batch(BATCH_SIZE, drop_remainder=<span class="hljs-literal">True</span>))
<span class="hljs-comment">#  8/Unknown - 1s 173ms/step - loss: 0.0000e+00 - accuracy: 1.0000[0.0, 1.0]</span></code></pre><br>
<p>, ,     ,  loss == 0.0. </p><br>
<p>  relu.     :</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> matplotlib.ticker <span class="hljs-keyword">as</span> plticker<font></font>
range_tensor = tf.range(<span class="hljs-number">-4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0.01</span>, dtype=tf.float32)<font></font>
fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<font></font>
plt.plot(range_tensor.numpy(), tf.keras.activations.relu(range_tensor).numpy())<font></font>
ax.grid(which=<span class="hljs-string">'major'</span>, linestyle=<span class="hljs-string">'-'</span>, linewidth=<span class="hljs-string">'0.5'</span>, color=<span class="hljs-string">'red'</span>)<font></font>
ax.grid(which=<span class="hljs-string">'minor'</span>, linestyle=<span class="hljs-string">':'</span>, linewidth=<span class="hljs-string">'0.5'</span>, color=<span class="hljs-string">'black'</span>)<font></font>
ax.yaxis.set_major_locator(plticker.MultipleLocator(base=<span class="hljs-number">1</span>) )<font></font>
plt.minorticks_on()</code></pre><br>
<p><img src="https://habrastorage.org/webt/wq/ph/iw/wqphiwwmhtmxwfogld4nstyfp9w.png"></p><br>
<p>  — ,  — y=x, ..        ,      —  .</p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>, use_bias=<span class="hljs-literal">False</span>, kernel_initializer=tf.keras.initializers.Identity()))<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
<font></font>
model.compile(optimizer=<span class="hljs-string">"adam"</span>, loss=<span class="hljs-string">"binary_crossentropy"</span>, metrics=[<span class="hljs-string">"accuracy"</span>])<font></font>
<font></font>
model.evaluate(x=val.map(<span class="hljs-keyword">lambda</span> x: (x,x)).batch(BATCH_SIZE, drop_remainder=<span class="hljs-literal">True</span>))
<span class="hljs-comment">#    8/Unknown - 1s 158ms/step - loss: 0.0000e+00 - accuracy: 1.0000[0.0, 1.0]</span></code></pre><br>
<p>,  identity  ,   -    .      ,    identity. </p><br>
<p> ,       .   — relu,      (  ,   kernel_initializer,       <code>glorot_uniform</code>):</p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>, use_bias=<span class="hljs-literal">False</span>))<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p> :</p><br>
<p><img src="https://habrastorage.org/webt/hv/wz/oo/hvwzoodkp6dxopq7pjkopeeuorw.png"></p><br>
<p>    , accuracy: 0.9999, loss(mse): 2e-04  20     .</p><br>
<p><img src="https://habrastorage.org/webt/4y/io/jt/4yiojttsafqnf796ha6all0qmsy.png"></p><br>
<p>   :</p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, activation=<span class="hljs-string">'sigmoid'</span>, use_bias=<span class="hljs-literal">False</span>))<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p>-     ,    —   bias.  ,      50 , accuracy: 0.9970, loss: 0.01  60 . </p><br>
<p>   :</p><br>
<p><img src="https://habrastorage.org/webt/_7/fl/o_/_7flo_xh5gkgh8oennqthe2ymhk.png"></p><br>
<p>    tanh:</p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, activation=<span class="hljs-string">'tanh'</span>, use_bias=<span class="hljs-literal">False</span>))<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p>   relu — accuracy: 0.9999, loss: 6e-04  20 ,    :</p><br>
<p><img src="https://habrastorage.org/webt/m4/ib/xc/m4ibxctlge5cxs7eqozjt5uwfsc.png"></p><br>
<p><img src="https://habrastorage.org/webt/sk/r3/p8/skr3p8etvlatcf-mnc6q9sabtfk.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際、シグモイドが同等の結果を示すように何かを実行できるかどうかという疑問に悩まされています。</font><font style="vertical-align: inherit;">排他的にスポーツの興味から。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえば、BatchNormalizationの追加を試すことができます。</font></font></p><br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(tf.keras.Input(shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))<font></font>
model.add(tf.keras.layers.Flatten())<font></font>
model.add(tf.keras.layers.Dense(<span class="hljs-number">64</span>*<span class="hljs-number">64</span>, activation=<span class="hljs-string">'sigmoid'</span>, use_bias=<span class="hljs-literal">False</span>))<font></font>
model.add(tf.keras.layers.BatchNormalization())<font></font>
model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>)))</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、ある種の魔法が起こります。</font><font style="vertical-align: inherit;">第13時代の精度：1.0。</font><font style="vertical-align: inherit;">そして激しい結果：</font></font></p><br>
<p><img src="https://habrastorage.org/webt/6x/md/di/6xmddijppdnstc8ire1mxlcwkca.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">III ...この崖のハンガーで、テキストが曖昧すぎるため、最初の部分を終了します。誰かがそれを必要としているかどうかは不明です。</font><font style="vertical-align: inherit;">第2部では、何が起こったのかを理解し、さまざまなオプティマイザで実験し、正直なエンコーダ/デコーダを構築して、頭をテーブルにぶつけます。</font><font style="vertical-align: inherit;">誰かが興味深く、助けてくれたことを願っています。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja483994/index.html">ヨットでのIT移転。スウェーデンからスペインへ</a></li>
<li><a href="../ja484004/index.html">@Pythonetc 2019年12月</a></li>
<li><a href="../ja484008/index.html">チームリーダーとは</a></li>
<li><a href="../ja484010/index.html">Microsoft Exchange Onlineでの商業情報？それはあなたの権利によるものですか？そうであれば、何によるものですか？</a></li>
<li><a href="../ja484012/index.html">ブロックノートブックの書き込みプロセスを合理化する</a></li>
<li><a href="../ja484018/index.html">ヨットのIT技術面</a></li>
<li><a href="../ja484020/index.html">締め切りを印象づけようとしているのは誰ですか？</a></li>
<li><a href="../ja484026/index.html">パート6：MemTest86 +からRISC-Vへの移植</a></li>
<li><a href="../ja484028/index.html">ホースシューベンド-折りたたみ式ディスプレイを備えたコンバーチブルタブレット</a></li>
<li><a href="../ja484030/index.html">Typescriptのランタイムタイプセーフティ（ランタイムでの便利なタイプチェックが可能）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>