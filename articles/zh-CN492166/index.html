<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¢ ğŸ•³ï¸ ğŸ˜¡ Androidä¸Šçš„å°éƒ¨ä»¶ã€‚éš¾å¾—çš„åŠŸèƒ½ ğŸ‘©ğŸ»â€ğŸ”§ ğŸ¤˜ğŸ½ ğŸ¤¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼æˆ‘å«Alexander Khakimovï¼Œæˆ‘æ˜¯FINCHçš„ä¸€åAndroidå¼€å‘äººå‘˜ã€‚
 
 ç¢°å·§æ‚¨çš„è®¾è®¡æ˜¯é’ˆå¯¹iOSçš„ï¼Œè€Œæ‚¨ä¸å¾—ä¸å°†å…¶æ”¹ç¼–æˆé€‚ç”¨äºandroidçš„è½¯ä»¶å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œæ‚¨çš„è®¾è®¡å¸ˆæ˜¯å¦ç»å¸¸ä½¿ç”¨å°éƒ¨ä»¶ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œå¯¹äºè®¸å¤šå¼€å‘äººå‘˜æ¥è¯´ï¼Œå°éƒ¨ä»¶å¾ˆå°‘è§ï¼Œå› ä¸ºå¾ˆå°‘æœ‰äººä½¿ç”¨å®ƒã€‚
 
 åœ¨æœ¬...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Androidä¸Šçš„å°éƒ¨ä»¶ã€‚éš¾å¾—çš„åŠŸèƒ½</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492166/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆHaï¼</font><font style="vertical-align: inherit;">æˆ‘å«Alexander Khakimovï¼Œæˆ‘æ˜¯FINCHçš„ä¸€åAndroidå¼€å‘äººå‘˜ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¢°å·§æ‚¨çš„è®¾è®¡æ˜¯é’ˆå¯¹iOSçš„ï¼Œè€Œæ‚¨ä¸å¾—ä¸å°†å…¶æ”¹ç¼–æˆé€‚ç”¨äºandroidçš„è½¯ä»¶å—ï¼Ÿ</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œæ‚¨çš„è®¾è®¡å¸ˆæ˜¯å¦ç»å¸¸ä½¿ç”¨å°éƒ¨ä»¶ï¼Ÿ</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œå¯¹äºè®¸å¤šå¼€å‘äººå‘˜æ¥è¯´ï¼Œå°éƒ¨ä»¶å¾ˆå°‘è§ï¼Œå› ä¸ºå¾ˆå°‘æœ‰äººä½¿ç”¨å®ƒã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ›å»ºä¸€ä¸ªå°éƒ¨ä»¶ï¼Œå€¼å¾—å…³æ³¨å¹¶åˆ†äº«æˆ‘çš„æ¡ˆä¾‹ã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°éƒ¨ä»¶åˆ›å»º</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦åˆ›å»ºå°éƒ¨ä»¶ï¼Œæ‚¨éœ€è¦äº†è§£ä»¥ä¸‹å†…å®¹ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°éƒ¨ä»¶ç»„ä»¶çš„åŠŸèƒ½ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å±å¹•ç½‘æ ¼ä¸­æ˜¾ç¤ºå°éƒ¨ä»¶çš„åŠŸèƒ½ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠŸèƒ½éƒ¨ä»¶æ›´æ–°ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†åˆ†åˆ«åˆ†ææ¯ä¸ªé¡¹ç›®ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°éƒ¨ä»¶ç»„ä»¶çš„åŠŸèƒ½</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»»ä½•è‡³å°‘ä½¿ç”¨è¿‡RemoteViewsçš„å¼€å‘äººå‘˜éƒ½å¯¹æ­¤é¡¹ç›®å¾ˆç†Ÿæ‚‰ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œè¯·ç»§ç»­è¿›è¡Œä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RemoteViewsæ—¨åœ¨æè¿°å’Œç®¡ç†å±äºå¦ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­çš„è¿›ç¨‹çš„Viewå±‚æ¬¡ç»“æ„ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨å±‚æ¬¡ç»“æ„ç®¡ç†ï¼Œæ‚¨å¯ä»¥æ›´æ”¹å±äºå¦ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„Viewçš„å±æ€§æˆ–è°ƒç”¨æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">RemoteViewsåŒ…å«æ ‡å‡†android.widgetç»„ä»¶åº“ä¸­çš„æœ‰é™ç»„ä»¶é›†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å†…éƒ¨è§†å›¾å°éƒ¨ä»¶ä¸­å·¥ä½œçš„è¿‡ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼ˆé€šå¸¸æ˜¯ä¸»å±å¹•ï¼‰ï¼Œå› æ­¤ï¼Œè¦æ›´æ”¹å°éƒ¨ä»¶çš„UIï¼Œè¯·ä½¿ç”¨åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å·¥ä½œçš„BroadcastReceiveræ‰©å±•-AppWidgetProviderã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å±å¹•çš„â€œç½‘æ ¼â€ä¸­æ˜¾ç¤ºå°éƒ¨ä»¶çš„åŠŸèƒ½</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®é™…ä¸Šï¼Œå¦‚æœæ‚¨æŸ¥çœ‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®˜æ–¹æŒ‡å—</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¿™ä¸€ç‚¹å¹¶ä¸é‚£ä¹ˆå¤æ‚</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
 <blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªå°éƒ¨ä»¶éƒ½å¿…é¡»å®šä¹‰ä¸€ä¸ªminWidthå’ŒminHeightï¼Œä»¥æŒ‡ç¤ºé»˜è®¤æƒ…å†µä¸‹å®ƒåº”æ¶ˆè€—çš„æœ€å°ç©ºé—´é‡ã€‚</font><font style="vertical-align: inherit;">å½“ç”¨æˆ·å°†å°éƒ¨ä»¶æ·»åŠ åˆ°å…¶ä¸»å±å¹•æ—¶ï¼Œå®ƒé€šå¸¸ä¼šå ç”¨æ¯”æ‚¨æŒ‡å®šçš„æœ€å°å®½åº¦å’Œé«˜åº¦æ›´å¤šçš„ç©ºé—´ã€‚</font><font style="vertical-align: inherit;">Androidä¸»å±å¹•ä¸ºç”¨æˆ·æä¾›äº†å¯ç”¨ç©ºé—´çš„ç½‘æ ¼ï¼Œå¯ä»¥åœ¨å…¶ä¸­æ”¾ç½®å°éƒ¨ä»¶å’Œå›¾æ ‡ã€‚</font><font style="vertical-align: inherit;">è¯¥ç½‘æ ¼å¯èƒ½å› è®¾å¤‡è€Œå¼‚ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œè®¸å¤šæ‰‹æœºéƒ½æä¾›4x4ç½‘æ ¼ï¼Œè€Œå¹³æ¿ç”µè„‘å¯ä»¥æä¾›æ›´å¤§çš„8x7ç½‘æ ¼ã€‚</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¿»è¯‘æˆä¿„æ–‡ï¼šæ¯ä¸ªå°éƒ¨ä»¶éƒ½å¿…é¡»è®¾ç½®è‡ªå·±çš„æœ€å°å®½åº¦å’Œé«˜åº¦ï¼Œä»¥è¡¨ç¤ºé»˜è®¤æƒ…å†µä¸‹å°†å ç”¨çš„æœ€å°ç©ºé—´ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6r/p-/ux/6rp-uxyfekjzwlpantqmxkdfaio.png" alt="å›¾ç‰‡"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨Android Studioä¸­åˆ›å»ºæ—¶çš„çª—å£å°éƒ¨ä»¶è®¾ç½®ç¤ºä¾‹</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ·»åŠ åˆ°ä¸»å±å¹•çš„çª—å£å°éƒ¨ä»¶é€šå¸¸ä¼šå ç”¨æ¯”æ‚¨è®¾ç½®çš„å±å¹•çš„æœ€å°å®½åº¦å’Œé«˜åº¦æ›´å¤šçš„ç©ºé—´ã€‚ Androidä¸»å±å¹•ä¸ºç”¨æˆ·æä¾›äº†å¯ç”¨ç©ºé—´çš„ç½‘æ ¼ï¼Œå¯ä»¥åœ¨å…¶ä¸­æ”¾ç½®å°éƒ¨ä»¶å’Œå›¾æ ‡ã€‚è¯¥ç½‘æ ¼å¯èƒ½å› è®¾å¤‡è€Œå¼‚ï¼›ä¾‹å¦‚ï¼Œè®¸å¤šæ‰‹æœºæä¾›4x4ç½‘æ ¼ï¼Œè€Œå¹³æ¿ç”µè„‘å¯ä»¥æä¾›8x4å¤§å‹ç½‘æ ¼ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±æ­¤å¯è§ï¼Œè®¾å¤‡çš„ç½‘æ ¼å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œå¹¶ä¸”å•å…ƒçš„å¤§å°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å–å†³äºç½‘æ ¼çš„å¤§å°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨è®¾è®¡å°éƒ¨ä»¶çš„å†…å®¹æ—¶åº”ç‰¢è®°è¿™äº›åŠŸèƒ½ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºç»™å®šçš„åˆ—æ•°å’Œè¡Œæ•°ï¼Œå°éƒ¨ä»¶çš„æœ€å°å®½åº¦å’Œé«˜åº¦å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
minSideSizeDp = 70Ã—n-30ï¼Œå…¶ä¸­næ˜¯è¡Œæ•°æˆ–åˆ—æ•°</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€‚ç›®å‰ï¼Œæ‚¨å¯ä»¥è®¾ç½®çš„æœ€å¤§æœ€å°ç½‘æ ¼ä¸º4x4ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·å¯ä»¥ç¡®ä¿æ‚¨çš„çª—å£å°éƒ¨ä»¶å°†æ˜¾ç¤ºåœ¨æ‰€æœ‰è®¾å¤‡ä¸Šã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åŠŸèƒ½éƒ¨ä»¶æ›´æ–°</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºAppWidgetProvideræœ¬è´¨ä¸Šæ˜¯BroadcastReceiverçš„æ‰©å±•ï¼Œå› æ­¤æ‚¨å¯ä»¥åƒä½¿ç”¨å¸¸è§„BroadcastReceiverä¸€æ ·å¯¹å…¶è¿›è¡Œç›¸åŒçš„æ“ä½œã€‚ AppWidgetProvideråªéœ€è§£æonReceiveä¸­æ¥æ”¶åˆ°çš„Intentä¸­çš„ç›¸åº”å­—æ®µï¼Œç„¶åä½¿ç”¨æ¥æ”¶åˆ°çš„é™„åŠ å‡½æ•°è°ƒç”¨æ‹¦æˆªæ–¹æ³•ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›°éš¾ä¹‹å¤„åœ¨äºæ›´æ–°å†…å®¹çš„é¢‘ç‡-æ•´ä¸ªé—®é¢˜åœ¨äºiOSå’ŒAndroidä¸Šçš„å°éƒ¨ä»¶çš„å†…éƒ¨æ“ä½œæœ‰æ‰€ä¸åŒã€‚äº‹å®æ˜¯ï¼Œå½“å°éƒ¨ä»¶å¯¹ç”¨æˆ·å¯è§æ—¶ï¼ŒiOSå°éƒ¨ä»¶ä¸Šçš„æ•°æ®ä¼šæ›´æ–°ã€‚åœ¨Androidä¸­ï¼Œæ­¤ç±»äº‹ä»¶ä¸å­˜åœ¨ã€‚æˆ‘ä»¬æ— æ³•ç¡®å®šç”¨æˆ·ä½•æ—¶çœ‹åˆ°çª—å£å°éƒ¨ä»¶ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºAndroidä¸Šçš„å°éƒ¨ä»¶ï¼Œå»ºè®®çš„æ›´æ–°æ–¹æ³•æ˜¯è®¡æ—¶å™¨æ›´æ–°ã€‚</font><font style="vertical-align: inherit;">è®¡æ—¶å™¨è®¾ç½®ç”±çª—å£å°éƒ¨ä»¶å‚æ•°updatePeriodMillisè®¾ç½®ã€‚</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œæ­¤è®¾ç½®ä¸å…è®¸æ¯30åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡å°éƒ¨ä»¶ã€‚</font><font style="vertical-align: inherit;">ä¸‹é¢æˆ‘å°†æ›´è¯¦ç»†åœ°è®¨è®ºè¿™ä¸€ç‚¹ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°å·¥å…·ç®±</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†è®¨è®ºåœ¨FINCHçš„å¤§å‹å½©ç¥¨ç”³è¯·ä¸­çš„æ¡ˆä¾‹ï¼Œä»¥åŠStolotoç”³è¯·å‚åŠ å·å½©ç¥¨çš„æ¡ˆä¾‹ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥åº”ç”¨ç¨‹åºçš„ä»»åŠ¡æ˜¯ç®€åŒ–å½©ç¥¨çš„é€‰æ‹©å’Œå½©ç¥¨çš„è´­ä¹°å¹¶ä½¿ç”¨æˆ·é€æ˜ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå°éƒ¨ä»¶æ‰€éœ€çš„åŠŸèƒ½éå¸¸ç®€å•ï¼šå‘ç”¨æˆ·æ˜¾ç¤ºè¦è´­ä¹°çš„æ¨èæ¸¸æˆï¼Œç„¶åç‚¹æŒ‰ä»¥è½¬åˆ°ç›¸åº”çš„æ¸¸æˆã€‚</font><font style="vertical-align: inherit;">æ¸¸æˆåˆ—è¡¨åœ¨æœåŠ¡å™¨ä¸Šç¡®å®šå¹¶å®šæœŸæ›´æ–°ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°éƒ¨ä»¶è®¾è®¡åŒ…æ‹¬ä¸¤ä¸ªçŠ¶æ€ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºæˆæƒç”¨æˆ·</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºæœªç»æˆæƒçš„ç”¨æˆ·</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆæƒç”¨æˆ·éœ€è¦æ˜¾ç¤ºå…¶ä¸ªäººèµ„æ–™æ•°æ®ï¼šå†…éƒ¨é’±åŒ…çš„çŠ¶æ€ï¼Œç­‰å¾…æŠ½å¥–çš„å½©ç¥¨æ•°é‡ä»¥åŠä¸¢å¤±çš„å½©é‡‘ã€‚</font><font style="vertical-align: inherit;">å¯¹äºè¿™äº›å…ƒç´ ä¸­çš„æ¯ä¸€ä¸ªï¼Œéƒ½æä¾›äº†åˆ°åº”ç”¨ç¨‹åºå†…éƒ¨å±å¹•çš„è¿‡â€‹â€‹æ¸¡ï¼Œä¸å…¶ä»–å…ƒç´ ä¸åŒã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/d2/6i/rpd26ixtdxfjopibvmgaaczfkco.png" alt="å›¾ç‰‡"><br>
<br>
<img src="https://habrastorage.org/webt/dk/yy/qx/dkyyqxqcnopxezwhknrmqbuedgu.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆæƒç”¨æˆ·çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯â€œåˆ·æ–°â€æŒ‰é’®ï¼Œä½†ç¨åä¼šä»‹ç»æ›´å¤šã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†å®ç°ä¸¤ç§çŠ¶æ€çš„æ˜¾ç¤ºï¼ŒåŒæ—¶è€ƒè™‘åˆ°è®¾è®¡ï¼Œæˆ‘ä½¿ç”¨RemoteAdapterä½œä¸ºRemoteViewsServiceçš„å®ç°æ¥ç”Ÿæˆå†…å®¹å¡ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æœ‰ä¸€äº›ä»£ç ï¼Œä»¥åŠé‡Œé¢çš„æ‰€æœ‰å†…å®¹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨å·²ç»æœ‰è¿‡ä½¿ç”¨çª—å£å°éƒ¨ä»¶çš„ç»éªŒï¼Œé‚£ä¹ˆæ‚¨å°†çŸ¥é“çª—å£å°éƒ¨ä»¶æ•°æ®çš„ä»»ä½•æ›´æ–°å‡ä»¥onUpdateæ–¹æ³•å¼€å§‹ï¼š</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onUpdate</span><span class="hljs-params">(
        context: <span class="hljs-type">Context</span>,
        appWidgetManager: <span class="hljs-type">AppWidgetManager</span>,
        appWidgetIds: <span class="hljs-type">IntArray</span>
    )</span></span> {<font></font>
        injector.openScope(<span class="hljs-keyword">this</span>, *arrayOf(<span class="hljs-keyword">this</span>))
        <span class="hljs-comment">// update each of the widgets with the remote adapter</span><font></font>
        appWidgetIds<font></font>
            .forEach {<font></font>
                updateWidget(context, appWidgetManager, it)<font></font>
          }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬æ­£åœ¨ä¸ºå°éƒ¨ä»¶çš„æ¯ä¸ªå®ä¾‹ç¼–å†™æ›´æ–°ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateWidget</span><span class="hljs-params">(
        context: <span class="hljs-type">Context</span>,
        appWidgetManager: <span class="hljs-type">AppWidgetManager</span>,
        appWidgetId: <span class="hljs-type">Int</span>
    )</span></span> {
<span class="hljs-comment">// remoteViews   widgetId</span>
        <span class="hljs-keyword">val</span> remoteViews = RemoteViews(<font></font>
            context.packageName,<font></font>
            R.layout.app_widget_layout<font></font>
...<font></font>
<span class="hljs-comment">//        </span><font></font>
...<font></font>
<span class="hljs-comment">//    remoteViews</span><font></font>
updateRemoteAdapter(context, remoteViews, appWidgetId)<font></font>
 <font></font>
<span class="hljs-comment">//   remoteViews </span><font></font>
appWidgetManager.updateAppWidget(appWidgetId, remoteViews)<font></font>
<span class="hljs-comment">// collection view  </span><font></font>
appWidgetManager.notifyAppWidgetViewDataChanged(<font></font>
            appWidgetId,<font></font>
            R.id.lvWidgetItems<font></font>
        )<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ›´æ–°é€‚é…å™¨ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateRemoteAdapter</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, remoteViews: <span class="hljs-type">RemoteViews</span>, appWidgetId: <span class="hljs-type">Int</span>)</span></span> {
<span class="hljs-comment">//   RemoteViewsService   RemoteAdapter   </span>
        <span class="hljs-keyword">val</span> adapterIntent = Intent(context, StolotoAppWidgetRemoteViewsService::<span class="hljs-keyword">class</span>.java).apply {<font></font>
            putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)<font></font>
        }<font></font>
        remoteViews.setRemoteAdapter(R.id.lvWidgetItems, adapterIntent)<font></font>
// actionIntent  pendingIntent      <font></font>
        <span class="hljs-keyword">val</span> actionIntent = Intent(context, StolotoAppWidgetProvider::<span class="hljs-keyword">class</span>.java).apply {<font></font>
            action = WIDGET_CLICK_ACTION<font></font>
            putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)<font></font>
        }<font></font>
        <span class="hljs-keyword">val</span> pendingIntent = PendingIntent.getBroadcast(<font></font>
            context, <span class="hljs-number">0</span>, actionIntent,<font></font>
            PendingIntent.FLAG_UPDATE_CURRENT<font></font>
        )<font></font>
<span class="hljs-comment">// pendingIntent      </span><font></font>
        remoteViews.setPendingIntentTemplate(R.id.lvWidgetItems, pendingIntent)<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬æ­£åœ¨ç¼–å†™æœåŠ¡çš„å®ç°ã€‚</font><font style="vertical-align: inherit;">åœ¨å…¶ä¸­ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´é‡è¦çš„æ˜¯æŒ‡å‡ºè¦ä½¿ç”¨å“ªç§RemoteViewsService.RemoteViewsFactoryæ¥å£çš„å®ç°æ¥ç”Ÿæˆå†…å®¹ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StolotoAppWidgetRemoteViewsService</span> : <span class="hljs-type">RemoteViewsService</span></span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onGetViewFactory</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>)</span></span>: RemoteViewsFactory =<font></font>
        StolotoAppWidgetRemoteViewsFactory(<font></font>
            <span class="hljs-keyword">this</span>.applicationContext,<font></font>
            intent<font></font>
        )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™å®é™…ä¸Šæ˜¯é€‚é…å™¨çš„è–„åŒ…è£…ã€‚</font><font style="vertical-align: inherit;">å¤šäºäº†ä»–ï¼Œæˆ‘ä»¬æ‰èƒ½å°†æˆ‘ä»¬çš„æ•°æ®ä¸è¿œç¨‹é›†åˆè§†å›¾ç›¸å…³è”ã€‚</font><font style="vertical-align: inherit;">RemoteViewsFactoryæä¾›äº†ä¸ºæ•°æ®é›†ä¸­çš„æ¯ä¸ªé¡¹ç›®ç”ŸæˆRemoteViewçš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æ„é€ å‡½æ•°æ²¡æœ‰è¦æ±‚-æˆ‘è¦åšçš„å°±æ˜¯åœ¨å…¶ä¸­ä¼ é€’ä¸Šä¸‹æ–‡ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œç®€è¦ä»‹ç»ä¸€ä¸‹ä¸»è¦æ–¹æ³•ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onCreate-åˆ›å»ºé€‚é…å™¨ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getLoadingView-è¯¥æ–¹æ³•å»ºè®®è¿”å›è§†å›¾ï¼Œç³»ç»Ÿå°†åœ¨åˆ›å»ºè§†å›¾æ—¶æ˜¾ç¤ºè¯¥è§†å›¾ï¼Œè€Œä¸æ˜¯åˆ—è¡¨é¡¹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨åœ¨æ­¤å¤„æœªåˆ›å»ºä»»ä½•å†…å®¹ï¼Œåˆ™ç³»ç»Ÿå°†ä½¿ç”¨æŸäº›é»˜è®¤è§†å›¾ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getViewAt-è¯¥æ–¹æ³•å»ºè®®åˆ›å»ºåˆ—è¡¨é¡¹ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯RemoteViewsçš„æ ‡å‡†ç”¨æ³•ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¶åˆ°æ›´æ–°åˆ—è¡¨ä¸­æ•°æ®çš„è¯·æ±‚æ—¶ï¼Œå°†è°ƒç”¨onDataSetChangedã€‚</font><font style="vertical-align: inherit;">é‚£äº›ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸ºåˆ—è¡¨å‡†å¤‡æ•°æ®ã€‚</font><font style="vertical-align: inherit;">é€šè¿‡æ‰§è¡Œç¹é‡çš„é•¿ä»£ç ï¼Œè¯¥æ–¹æ³•å˜å¾—æ›´åŠ æ¸…æ™°ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“åˆ é™¤ä½¿ç”¨é€‚é…å™¨çš„æœ€åä¸€ä¸ªåˆ—è¡¨ï¼ˆä¸€ä¸ªé€‚é…å™¨å¯ä»¥è¢«å¤šä¸ªåˆ—è¡¨ä½¿ç”¨ï¼‰æ—¶ï¼Œå°†è°ƒç”¨onDestroyã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemoteViewsFactoryå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè€Œåˆ—è¡¨çš„æ‰€æœ‰å®ä¾‹å‡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨å½“å‰æ•°æ®ï¼Œä¾‹å¦‚ï¼Œå½“å‰é¡¹ç›®çš„åˆ—è¡¨ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®šä¹‰å°†æ˜¾ç¤ºçš„æ•°æ®åˆ—è¡¨ï¼š</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> widgetItems = ArrayList&lt;WidgetItem&gt;()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºé€‚é…å™¨æ—¶ï¼Œæˆ‘ä»¬å¼€å§‹åŠ è½½æ•°æ®ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œä»»ä½•å›°éš¾çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬å®‰é™åœ°è¿›å…¥ç½‘ç»œä»¥é˜»æ­¢æµé‡ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {<font></font>
        updateDataSync()<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“è°ƒç”¨å‘½ä»¤æ›´æ–°æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿè°ƒç”¨updateDataSyncï¼ˆï¼‰</font></font><br>
<br>
<pre><code class="kotlin hljs">   <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDataSetChanged</span><span class="hljs-params">()</span></span> {<font></font>
        updateDataSync()<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨updateDataSyncå†…éƒ¨ï¼Œä¸€åˆ‡ä¹Ÿå¾ˆç®€å•ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ¸…é™¤äº†å½“å‰çš„ç‰©å“æ¸…å•ã€‚</font><font style="vertical-align: inherit;">ä¸‹è½½ä¸ªäººèµ„æ–™å’Œæ¸¸æˆæ•°æ®ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"> <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateDataSync</span><span class="hljs-params">()</span></span> {<font></font>
        widgetItems.clear()<font></font>
        updateProfileSync()<font></font>
        updateGamesSync()<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™é‡Œæ¯”è¾ƒæœ‰è¶£</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateProfileSync</span><span class="hljs-params">()</span></span> {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºä»…å‘æˆæƒç”¨æˆ·æ˜¾ç¤ºä¸ªäººèµ„æ–™å¯¹æˆ‘ä»¬å¾ˆé‡è¦ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»…éœ€è¦ä¸‹è½½ä¸ªäººèµ„æ–™ä¿¡æ¯ï¼š</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> isUserFullAuth = isUserFullAuthInteractor<font></font>
            .execute()<font></font>
            .blockingGet()<font></font>
        <span class="hljs-keyword">if</span> (isUserFullAuth) {
            <span class="hljs-keyword">val</span> profile = getWidgetProfileInteractor<font></font>
                .execute()<font></font>
                .onErrorReturn {<font></font>
                    WidgetProfile()<font></font>
<span class="hljs-comment">//           </span><font></font>
                }<font></font>
                .blockingGet()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WidgetProfileæ¨¡å‹æ˜¯ä»ä¸åŒæ¥æºç»„è£…è€Œæˆçš„ï¼Œå› æ­¤å…¶æ”¶è´§é€»è¾‘åŠå…¶é»˜è®¤å€¼çš„æ’åˆ—æ–¹å¼ä¸ºè´Ÿçš„é’±åŒ…å€¼è¡¨ç¤ºæ•°æ®ä¸æ­£ç¡®æˆ–æ”¶è´§æœ‰é—®é¢˜ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºä¸šåŠ¡é€»è¾‘ï¼Œç¼ºå°‘é’±åŒ…æ•°æ®è‡³å…³é‡è¦ï¼Œå› æ­¤ï¼Œå¦‚æœé’±åŒ…ä¸æ­£ç¡®ï¼Œå°†ä¸ä¼šåˆ›å»ºé…ç½®æ–‡ä»¶æ¨¡å‹å¹¶å°†å…¶æ·»åŠ åˆ°é¡¹ç›®åˆ—è¡¨ä¸­ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs">  <span class="hljs-keyword">if</span> (profile.walletAmount &gt;= <span class="hljs-number">0L</span>) {<font></font>
                widgetItems.add(<font></font>
                    WidgetItem.Profile(<font></font>
                        wallet = profile.walletAmount.toMoneyFormat(),<font></font>
                        waitingTickets = <span class="hljs-keyword">if</span> (profile.waitingTicketsCount &gt;= <span class="hljs-number">0</span>) profile.waitingTicketsCount.toString() <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>,<font></font>
                        unpaidPrizeAmount = <span class="hljs-keyword">if</span> (profile.unpaidPrizeAmount &gt;= <span class="hljs-number">0</span>) profile.unpaidPrizeAmoount.toMoneyFormat() <span class="hljs-keyword">else</span> <span class="hljs-string">""</span><font></font>
                    )<font></font>
                )<font></font>
            }<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
updateGamesSyncï¼ˆï¼‰æ–¹æ³•ä½¿ç”¨getWidgetGamesInteractorï¼Œå¹¶å°†ä¸è¯¥å°éƒ¨ä»¶ç›¸å…³çš„ä¸€ç»„æ¸¸æˆæ·»åŠ åˆ°widgetItemsåˆ—è¡¨ä¸­ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç»§ç»­ç”Ÿæˆå¡ç‰‡ä¹‹å‰ï¼Œè¯·æ›´è¯¦ç»†åœ°è€ƒè™‘WidgetItemæ¨¡å‹ã€‚</font><font style="vertical-align: inherit;">å®ƒé€šè¿‡kotlinå¯†å°ç±»å®ç°ï¼Œä»è€Œä½¿æ¨¡å‹æ›´çµæ´»ï¼Œå¹¶ä¸”ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">sealed</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WidgetItem</span> </span>{<font></font>
 <font></font>
    <span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Profile</span></span>(
        <span class="hljs-keyword">val</span> wallet: String,
        <span class="hljs-keyword">val</span> waitingTickets: String,
        <span class="hljs-keyword">val</span> unpaidPrizeAmount: String<font></font>
    ) : WidgetItem()<font></font>
 <font></font>
    <span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Game</span></span>(
        <span class="hljs-keyword">val</span> id: String,
        <span class="hljs-keyword">val</span> iconId: <span class="hljs-built_in">Int</span>,
        <span class="hljs-keyword">val</span> prizeValue: String,
        <span class="hljs-keyword">val</span> date: String<font></font>
    ) : WidgetItem()<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºRemoteViewså¹¶é€šè¿‡FillInIntentç¡®å®šå®ƒä»¬çš„å“åº”</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getViewAt</span><span class="hljs-params">(position: <span class="hljs-type">Int</span>)</span></span>: RemoteViews {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> item = widgetItems[position]) {
            <span class="hljs-keyword">is</span> WidgetItem.Profile -&gt; {<font></font>
              RemoteViews(<font></font>
                        context.packageName,<font></font>
                        R.layout.item_widget_user_profile<font></font>
                    ).apply {<font></font>
                        setTextViewText(R.id.tvWidgetWalletMoney, item.wallet)<font></font>
                        setTextViewText(R.id.tvWidgetUnpaidCount, item.unpaidPrizeAmount)<font></font>
                        setTextViewText(R.id.tvWidgetWaitingCount, item.waitingTickets)<font></font>
                        setOnClickFillInIntent(<font></font>
                            R.id.llWidgetProfileWallet, Intent().putExtra(<font></font>
                                StolotoAppWidgetProvider.KEY_PROFILE_OPTIONS,<font></font>
                                StolotoAppWidgetProvider.VALUE_USER_WALLET<font></font>
                            )<font></font>
                        )<font></font>
                        setOnClickFillInIntent(<font></font>
                            R.id.llWidgetProfileUnpaid, Intent().putExtra(<font></font>
                                StolotoAppWidgetProvider.KEY_PROFILE_OPTIONS,<font></font>
                                StolotoAppWidgetProvider.VALUE_UNPAID_PRIZE<font></font>
                            )<font></font>
                        )<font></font>
                        setOnClickFillInIntent(<font></font>
                            R.id.llWidgetProfileWaiting, Intent().putExtra(<font></font>
                                StolotoAppWidgetProvider.KEY_PROFILE_OPTIONS,<font></font>
                                StolotoAppWidgetProvider.VALUE_WAITING_TICKETS<font></font>
                            )<font></font>
                        )<font></font>
                    }<font></font>
 <font></font>
            <span class="hljs-keyword">is</span> WidgetItem.Game -&gt; {<font></font>
                RemoteViews(<font></font>
                    context.packageName,<font></font>
                    R.layout.item_widget_game<font></font>
                ).apply {<font></font>
                    setImageViewResource(R.id.ivWidgetGame, item.iconId)<font></font>
                    setTextViewText(R.id.tvWidgetGamePrize, item.prizeValue)<font></font>
                    setTextViewText(R.id.tvWidgetGameDate, item.date)<font></font>
                    setOnClickFillInIntent(<font></font>
                        R.id.llWidgetGame, Intent().putExtra(<font></font>
                            StolotoAppWidgetProvider.KEY_GAME_CLICK, item.id<font></font>
                        )<font></font>
                    )<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
setOnClickFillInIntentæ–¹æ³•åˆ†é…æŒ‡å®šçš„viewIdæ„å›¾ï¼Œè¯¥æ„å›¾å°†ä¸çˆ¶PendingIntentç»“åˆä½¿ç”¨ï¼Œä»¥ç¡®å®šåœ¨å•å‡»å¸¦æœ‰è¯¥viewIdçš„è§†å›¾æ—¶çš„è¡Œä¸ºã€‚</font><font style="vertical-align: inherit;">è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å“åº”WidgetProviderä¸­çš„ç”¨æˆ·ç‚¹å‡»ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰‹åŠ¨å°éƒ¨ä»¶æ›´æ–°</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä¸ºå°éƒ¨ä»¶è®¾ç½®äº†åŠå°æ—¶çš„æ›´æ–°æ—¶é—´ã€‚æ‚¨å¯ä»¥æ›´é¢‘ç¹åœ°æ›´æ–°å®ƒï¼Œä¾‹å¦‚ï¼Œé€šè¿‡ä¸WorkManagerè·³èˆï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦åŠ è½½ç½‘ç»œå’Œç”µæ± ï¼Ÿåœ¨å¼€å‘çš„æ—©æœŸé˜¶æ®µï¼Œè¿™ç§è¡Œä¸ºä¼¼ä¹æ˜¯è¶³å¤Ÿçš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“â€œä¼ä¸šâ€æ³¨æ„åˆ°ç”¨æˆ·æŸ¥çœ‹çª—å£å°éƒ¨ä»¶æ—¶ï¼Œä¸€åˆ‡éƒ½æ”¹å˜äº†ï¼Œæ— å…³çš„æ•°æ®æ˜¾ç¤ºåœ¨ä¸Šé¢ï¼šâ€œåœ¨iPhoneä¸Šï¼Œæˆ‘æ‰“å¼€çª—å£å°éƒ¨ä»¶ï¼Œå¹¶ä¸”æˆ‘çš„é…ç½®æ–‡ä»¶ä¸­æœ‰æœ€æ–°é²œçš„æ•°æ®ã€‚â€ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ç§æƒ…å†µå¾ˆå¸¸è§ï¼šiOSä¼šä¸ºæ¯ä¸ªå°éƒ¨ä»¶æ˜¾ç¤ºç”Ÿæˆæ–°çš„å¡ç‰‡ï¼Œå› ä¸ºè¿™ä¼šäº§ç”Ÿç‰¹æ®Šçš„å±å¹•ï¼Œè€ŒAndroidåŸåˆ™ä¸Šä¸ä¼šä¸ºå°éƒ¨ä»¶äº§ç”Ÿæ­¤ç±»äº‹ä»¶ã€‚æˆ‘ä¸å¾—ä¸è€ƒè™‘åˆ°æŸäº›å½©ç¥¨æ¯15åˆ†é’Ÿä¸¾è¡Œä¸€æ¬¡ï¼Œå› æ­¤å°éƒ¨ä»¶åº”æä¾›æœ€æ–°ä¿¡æ¯-æ‚¨æƒ³å‚åŠ æŸç§æŠ½å¥–ï¼Œä½†å·²ç»è¿‡å»äº†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æ‘†è„±è¿™ç§ä¸æ„‰å¿«çš„æƒ…å†µå¹¶ä»¥æŸç§æ–¹å¼è§£å†³æ›´æ–°æ•°æ®çš„é—®é¢˜ï¼Œæˆ‘æå‡ºå¹¶å®æ–½äº†ç»è¿‡æ—¶é—´è€ƒéªŒçš„è§£å†³æ–¹æ¡ˆ-â€œæ›´æ–°â€æŒ‰é’®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†æ­¤æŒ‰é’®æ·»åŠ åˆ°å¸¦æœ‰åˆ—è¡¨çš„å¸ƒå±€å¸ƒå±€ä¸­ï¼Œå¹¶åœ¨è°ƒç”¨updateWidgetæ—¶åˆå§‹åŒ–å…¶è¡Œä¸ºã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs">...
<span class="hljs-comment">// Intent   AppWidgetManager.ACTION_APPWIDGET_UPDATE</span>
<span class="hljs-keyword">val</span> intentUpdate = Intent(context, StolotoAppWidgetProvider::<span class="hljs-keyword">class</span>.java)<font></font>
intentUpdate.action = AppWidgetManager.ACTION_APPWIDGET_UPDATE<font></font>
<font></font>
//    <font></font>
<span class="hljs-keyword">val</span> ids = AppWidgetManager.getInstance(context)<font></font>
   .getAppWidgetIds(ComponentName(context, StolotoAppWidgetProvider::<span class="hljs-keyword">class</span>.java))<font></font>
intentUpdate.putExtra(AppWidgetManager.EXTRA_APPWIDGET_IDS, ids)<font></font>
<font></font>
//  intent  PendingIntent,  PendingIntent.getBroadcast()<font></font>
<span class="hljs-keyword">val</span> pendingUpdate = PendingIntent.getBroadcast(<font></font>
   context,<font></font>
   appWidgetId,<font></font>
   intentUpdate,<font></font>
   PendingIntent.FLAG_UPDATE_CURRENT<font></font>
)<font></font>
//  pendingIntent      â€˜â€™<font></font>
remoteViews.setOnClickPendingIntent(R.id.ivWidgetRefresh, pendingUpdate)<font></font>
â€¦</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åˆçš„å‘å±•æ˜¾ç¤ºå‡ºä»¤äººæ²®ä¸§çš„æ™¯è±¡ï¼šä»æŒ‰ä¸‹â€œæ›´æ–°â€æŒ‰é’®åˆ°å®é™…æ›´æ–°ï¼Œå¯èƒ½éœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡å°éƒ¨ä»¶æ˜¯ç”±æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç”Ÿæˆçš„ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯åœ¨ç³»ç»Ÿçš„æ§åˆ¶ä¹‹ä¸‹ï¼Œå¹¶é€šè¿‡å¹¿æ’­ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‚£äº›ã€‚</font><font style="vertical-align: inherit;">å½“æ‚¨å•å‡»çª—å£å°éƒ¨ä»¶çš„â€œæ›´æ–°â€æŒ‰é’®æ—¶ï¼Œé“¾å¼€å§‹ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨onReceiveæä¾›ç¨‹åºçš„â€œæ“ä½œâ€ä¸­è·å–Intentã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppWidgetManager.ACTION_APPWIDGET_UPDATEã€‚ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºintent-eä¸­æŒ‡å®šçš„æ‰€æœ‰widgetsIdè°ƒç”¨onUpdateã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨çº¿è·å–æ–°æ•°æ®ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ·æ–°æœ¬åœ°æ•°æ®å¹¶æ˜¾ç¤ºæ–°çš„åˆ—è¡¨å¡ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœï¼Œæ›´æ–°çª—å£å°éƒ¨ä»¶çœ‹èµ·æ¥ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºé€šè¿‡å•å‡»æŒ‰é’®ï¼Œæˆ‘ä»¬è§‚å¯Ÿäº†åŒä¸€çª—å£å°éƒ¨ä»¶å‡ ç§’é’Ÿã€‚</font><font style="vertical-align: inherit;">ç›®å‰å°šä¸æ¸…æ¥šæ•°æ®æ˜¯å¦å·²æ›´æ–°ã€‚</font><font style="vertical-align: inherit;">å¦‚ä½•è§£å†³è§†è§‰ååº”é—®é¢˜ï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæˆ‘æ·»åŠ äº†isWidgetLoadingæ ‡å¿—ï¼Œå¯é€šè¿‡äº¤äº’å™¨è¿›è¡Œå…¨å±€è®¿é—®ã€‚</font><font style="vertical-align: inherit;">æ­¤å‚æ•°çš„ä½œç”¨éå¸¸ç®€å•-åŠ è½½å°éƒ¨ä»¶æ•°æ®æ—¶ä¸è¦æ˜¾ç¤ºåˆ·æ–°æŒ‰é’®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…¶æ¬¡ï¼Œæˆ‘å°†å·¥å‚ä¸­çš„æ•°æ®åŠ è½½è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">enum</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoadingStep</span> </span>{<font></font>
   START,<font></font>
   MIDDLE,<font></font>
   END<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¼€å§‹-å¼€å§‹ä¸‹è½½ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤é˜¶æ®µï¼Œæ‰€æœ‰é€‚é…å™¨è§†å›¾å’Œå…¨å±€ä¸‹è½½æ ‡å¿—çš„çŠ¶æ€æ›´æ”¹ä¸ºâ€œæ­£åœ¨åŠ è½½â€ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MIDDLE-ä¸»æ•°æ®åŠ è½½é˜¶æ®µã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬ä¸‹è½½åï¼Œå…¨å±€ä¸‹è½½æ ‡å¿—ç½®äºâ€œå·²åŠ è½½â€çŠ¶æ€ï¼Œå¹¶ä¸”å·²ä¸‹è½½çš„æ•°æ®æ˜¾ç¤ºåœ¨é€‚é…å™¨ä¸­ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
END-ä¸‹è½½ç»“æŸã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œé€‚é…å™¨ä¸éœ€è¦æ›´æ”¹é€‚é…å™¨æ•°æ®ã€‚</font><font style="vertical-align: inherit;">éœ€è¦æ­¤æ­¥éª¤æ‰èƒ½æ­£ç¡®å¤„ç†WidgetProviderä¸­è§†å›¾çš„æ›´æ–°é˜¶æ®µã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬è¯¦ç»†äº†è§£æŒ‰é’®æ›´æ–°åœ¨æä¾›ç¨‹åºä¸­çš„å¤–è§‚ï¼š</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">if</span> (isFullAuthorized &amp;&amp; !widgetLoadingStateInteractor.isWidgetLoading) {<font></font>
   remoteViews.setViewVisibility(R.id.ivWidgetRefresh, View.VISIBLE)<font></font>
...<font></font>
<span class="hljs-comment">//     ,    </span><font></font>
...   <font></font>
} <span class="hljs-keyword">else</span> {<font></font>
   remoteViews.setViewVisibility(<font></font>
       R.id.ivWidgetRefresh,<font></font>
       <span class="hljs-keyword">if</span> (isFullAuthorized) View.INVISIBLE <span class="hljs-keyword">else</span> View.GONE <span class="hljs-comment">//       .</span><font></font>
   )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹é€‚é…å™¨ä¸­å‘ç”Ÿçš„æƒ…å†µï¼š</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateDataSync</span><span class="hljs-params">()</span></span> {
   <span class="hljs-keyword">when</span> (loadingStep) {<font></font>
       START -&gt; {<font></font>
           widgetItems.forEach { it.isLoading = <span class="hljs-literal">true</span> }<font></font>
           widgetLoadingStateInteractor.isWidgetLoading = <span class="hljs-literal">true</span><font></font>
           loadingStep = MIDDLE<font></font>
           widgetManager.updateWidgets()<font></font>
       }<font></font>
       MIDDLE -&gt; {<font></font>
           widgetItems.clear()<font></font>
           updateProfileSync()<font></font>
           updateGamesSync()<font></font>
           widgetLoadingStateInteractor.isWidgetLoading = <span class="hljs-literal">false</span><font></font>
           loadingStep = END<font></font>
           widgetManager.updateWidgets()<font></font>
       }<font></font>
       END -&gt; {<font></font>
           loadingStep = START<font></font>
       }<font></font>
   }<font></font>
}</code></pre><br>
<img src="https://habrastorage.org/webt/bq/ah/hg/bqahhgnwugy10345-bcegnupxo8.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å·¥ä½œé€»è¾‘ï¼š </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨STARTå’ŒMIDDLEæ­¥éª¤çš„æœ€åï¼Œæˆ‘è°ƒç”¨updateWidgetsæ–¹æ³•ä»¥æ›´æ–°æä¾›ç¨‹åºç®¡ç†çš„è§†å›¾çŠ¶æ€ã€‚</font></font></li>
<li>   START     Â«Â»   ,    MIDDLE.</li>
<li>         MIDDLE,    Â«Â».</li>
<li>   MIDDLE,          END. </li>
<li>      ,   END,    Â«Â».        ,    END   loadingStep  START.</li>
</ol><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ç§å®ç°çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘åœ¨â€œä¸šåŠ¡â€çœ‹åˆ°å°éƒ¨ä»¶ä¸Šçš„å®é™…æ•°æ®çš„éœ€æ±‚ä¸è¿‡äºé¢‘ç¹åœ°â€œæ‹‰â€æ›´æ–°çš„éœ€æ±‚ä¹‹é—´è¾¾æˆäº†æŠ˜è¡·ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨æœ‰åˆ›å»ºAndroidå°éƒ¨ä»¶çš„ç»éªŒï¼Œè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ä»¬ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¥å¥½è¿</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN492150/index.html">å®Œå…¨å®æ–½ã€‚Di-in-js</a></li>
<li><a href="../zh-CN492154/index.html">ExoMarsçš„å‘å°„æ¨è¿Ÿåˆ°2022å¹´çš„ä¸‹ä¸€ä¸ªå‘å°„çª—å£</a></li>
<li><a href="../zh-CN492156/index.html">å‡å»ã€‚æƒ³ã€‚åš</a></li>
<li><a href="../zh-CN492162/index.html">çœ¼æ¥å£ã€‚Yandexä¸­çš„æŠ¥å‘Š</a></li>
<li><a href="../zh-CN492164/index.html">é€šå‘å¤©å ‚æˆ–æœªæ¥åŸå¸‚çš„é—¨æˆ·</a></li>
<li><a href="../zh-CN492168/index.html">å¼€æºè½¯ä»¶æœ€å¤§é—¨æˆ·ç½‘ç«™çš„åç«¯å¼€å‘çš„å‰ç«¯å·¥ä½œï¼šå…±äº«ç»éªŒ</a></li>
<li><a href="../zh-CN492172/index.html">Linuxæ–‡ä»¶ç³»ç»Ÿçš„ç²¾ç®€å¤‡ä»½ã€‚å¦‚ä½•åœ¨20ç§’å†…åˆ›å»ºä¸‰TBçš„MySQL DBMSçš„å·¥ä½œå‰¯æœ¬</a></li>
<li><a href="../zh-CN492174/index.html">æ— çº¿DIYåœŸå£¤æ°´åˆ†ç›‘æµ‹ä»ª</a></li>
<li><a href="../zh-CN492178/index.html">ä¸ƒåƒåƒç´ çš„è·¯å¾„ï¼šæ˜¾ç¤ºå™¨åˆ†è¾¨ç‡çš„æ¼”å˜å’Œæˆ‘ä»¬çš„è¦æ±‚</a></li>
<li><a href="../zh-CN492182/index.html">Microsoft Teamsçš„ä¿¡æ¯å®‰å…¨åŸºç¡€çŸ¥è¯†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>