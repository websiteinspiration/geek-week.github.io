<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👫 🌁 😼 Mengapa server web asinkron muncul? 🏤 🕵🏼 👃🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Dalam sentuhan Vladislav Rodin. Saat ini, saya adalah kepala kursus Arsitek Beban Tinggi di OTUS, dan saya juga mengajar kursus arsitek...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mengapa server web asinkron muncul?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/496956/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya. </font><font style="vertical-align: inherit;">Dalam sentuhan Vladislav Rodin. </font><font style="vertical-align: inherit;">Saat ini, saya adalah kepala kursus Arsitek Beban Tinggi di OTUS, dan saya juga mengajar kursus arsitektur perangkat lunak. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain mengajar, seperti yang Anda lihat, saya telah menulis untuk materi hak cipta blog OTUS Habré dan artikel hari ini saya ingin bertepatan dengan dimulainya kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Linux Administrator"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang sekarang sedang membuka set.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/mq/fl/9f/mqfl9f73j0kklcb2wikqonkd4rk.png"><br>
<hr><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengapa aplikasi web melambat dan tidak menahan beban? </font><font style="vertical-align: inherit;">Para pengembang, yang pertama kali menghadapi pertanyaan seperti itu dan melakukan penelitian pada beberapa sistem, sampai pada kesimpulan yang mengecewakan bahwa mengoptimalkan logika bisnis saja tidak akan cukup. </font><font style="vertical-align: inherit;">Jawaban atas pertanyaan ini terletak pada level yang lebih rendah - pada level sistem operasi. </font><font style="vertical-align: inherit;">Agar aplikasi Anda dapat menahan beban, perlu untuk merevisi konsep arsitekturnya sedemikian rupa sehingga berfungsi secara efektif pada level ini. </font><font style="vertical-align: inherit;">Hal ini menyebabkan munculnya server web yang tidak sinkron. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, saya tidak dapat menemukan satu bahan pun yang memungkinkan saya mengembalikan semua hubungan sebab akibat dalam evolusi server web sekaligus. </font><font style="vertical-align: inherit;">Jadi ide untuk menulis artikel ini muncul, yang, saya harap, akan menjadi bahan seperti itu.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fitur OS Linux</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum berbicara tentang model server web, saya membiarkan diri saya mengingat beberapa fitur dari proses dan utas di Linux. </font><font style="vertical-align: inherit;">Kita akan membutuhkan ini ketika menganalisis kelebihan dan kekurangan dari model di atas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sakelar konteks</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemungkinan besar, setiap pengguna yang tahu bahwa hanya satu program dapat dijalankan pada satu inti prosesor sekaligus akan bertanya: "Mengapa 20 program dapat diluncurkan pada prosesor 4-inti saya sekaligus?". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faktanya, ini disebabkan oleh fakta bahwa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preemptive multitasking</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terjadi </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sistem operasi mengalokasikan kuantum waktu tertentu (~ 50 μs) dan menempatkan program untuk dieksekusi pada kernel selama waktu ini. </font><font style="vertical-align: inherit;">Setelah waktu habis, </font><b><font style="vertical-align: inherit;">saklar konteks </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terputus</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diaktifkan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Artinya, sistem operasi hanya menempatkan program berikutnya untuk dijalankan. </font><font style="vertical-align: inherit;">Karena pergantian sering terjadi, kami mendapat kesan bahwa semua program bekerja secara bersamaan. </font><font style="vertical-align: inherit;">Perhatikan frekuensi switching yang tinggi, ini akan menjadi penting untuk presentasi selanjutnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Switch konteks disebutkan di atas. </font><font style="vertical-align: inherit;">Apa yang termasuk di dalamnya? </font><font style="vertical-align: inherit;">Saat mengalihkan konteks, perlu untuk menyimpan register prosesor, untuk menghapus pipa instruksinya, untuk menghemat wilayah memori yang dialokasikan untuk proses. </font><font style="vertical-align: inherit;">Secara umum, operasinya cukup mahal. </font><font style="vertical-align: inherit;">Dibutuhkan ~ 0,5 μs, sementara eksekusi dari satu baris kode sederhana adalah ~ 1 ns. </font><font style="vertical-align: inherit;">Selain itu, dengan peningkatan jumlah proses per inti prosesor, overhead untuk pengalihan konteks akan meningkat.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model Server Web</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini, ada model server web berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pekerja</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prefork</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak sinkron</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">digabungkan</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita bahas masing-masing secara terpisah.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pekerja dan prefork</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara historis, dengan model-model ini, semuanya dimulai. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intinya sangat sederhana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : klien datang kepada kami, kami memilih penangan terpisah untuknya, yang memproses klien yang masuk dari awal hingga akhir. Pawang dapat berupa proses (prefork) atau utas (pekerja). Contoh dari server web semacam itu adalah Apache yang terkenal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan segera melakukan reservasi: membuat penangan baru untuk setiap klien mahal. Pertama, dengan jumlah inti yang konstan, peningkatan jumlah prosesor menyebabkan peningkatan latensi (karena sakelar konteks). Kedua, jumlah memori yang dibutuhkan tumbuh secara linear dengan peningkatan klien, karena bahkan jika Anda menggunakan utas berbagi memori, setiap utas memiliki tumpukan sendiri. Dengan demikian, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jumlah klien yang diproses secara bersamaan terbatas.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ukuran pool, yang, pada gilirannya, tergantung pada jumlah core prosesor. </font><font style="vertical-align: inherit;">Masalahnya diselesaikan dengan menggunakan metode penskalaan vertikal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kelemahan mendasar lain dari server tersebut adalah penggunaan sumber daya yang tidak optimal. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagian besar proses (atau utas) tidak digunakan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Bayangkan situasi berikut: selama pemrosesan klien, perlu untuk mengambil beberapa data dari hard drive, membuat permintaan ke database, atau menulis sesuatu ke jaringan. </font><font style="vertical-align: inherit;">Karena membaca dari hard disk di Linux adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operasi pemblokiran</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , proses (atau utas) akan menunggu respons, tetapi masih akan berpartisipasi dalam alokasi waktu prosesor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pekerja vs prefork</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pekerja dan prefork memiliki beberapa perbedaan mendasar. </font><font style="vertical-align: inherit;">Streaming agak lebih ekonomis dalam memori karena mereka membagikannya. </font><font style="vertical-align: inherit;">Untuk alasan yang sama, pergantian konteks di antara mereka lebih mudah daripada antar proses. </font><font style="vertical-align: inherit;">Namun, dalam kasus pekerja, kode menjadi multi-utas, karena utas harus disinkronkan. </font><font style="vertical-align: inherit;">Akibatnya, kami mendapatkan semua "pesona" kode multi-utas: menjadi lebih sulit untuk menulis, membaca, menguji dan men-debug-nya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model asinkron</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, pekerja dan prefork tidak memungkinkan untuk memproses sejumlah besar klien pada saat yang sama karena ukuran kolam yang terbatas, dan juga tidak secara optimal menggunakan sumber daya karena pengalihan konteks dan pemblokiran panggilan sistem. Seperti yang Anda lihat, masalahnya adalah multithreading dan penjadwal OS yang berat. Ini mengarah pada gagasan berikut: mari kita proses klien hanya dalam satu utas, tetapi biarkan dimuat pada 100%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Server semacam itu didasarkan pada loop peristiwa dan templat reaktor ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesin acara</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Kode klien, yang memulai operasi I / O, mendaftarkan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panggilan balik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam antrian prioritas (prioritas adalah waktu kesiapan). Pengulangan acara jajak pendapat deskriptor menunggu I / O, dan kemudian memperbarui prioritas (jika tersedia) Selain itu, loop acara menarik acara dari antrian prioritas, memanggil panggilan balik yang mengembalikan kontrol ke loop acara di akhir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model ini memungkinkan Anda untuk menangani sejumlah besar klien, menghindari overhead'a untuk beralih konteks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Model ini tidak sempurna dan memiliki beberapa kelemahan. Pertama, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak lebih dari satu inti prosesor yang dikonsumsi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena hanya ada satu proses. Ini diperlakukan menggunakan model gabungan, yang akan dibahas di bawah ini. Kedua, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pelanggan terhubung dengan proses ini.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kode harus ditulis dengan hati-hati. </font><font style="vertical-align: inherit;">Kebocoran memori, kesalahan mengarah pada kenyataan bahwa semua klien jatuh sekaligus. </font><font style="vertical-align: inherit;">Selain itu, proses ini tidak boleh diblokir oleh apa pun, panggilan balik tidak harus terdiri dalam menyelesaikan beberapa tugas sulit, karena semua klien akan diblokir. </font><font style="vertical-align: inherit;">Ketiga, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kode asinkron jauh lebih rumit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Adalah perlu untuk mendaftarkan panggilan balik tambahan bahwa data tidak akan datang, untuk menyelesaikan masalah tentang cara melakukan percabangan yang benar, dll.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model gabungan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Model ini digunakan di server nyata. </font><font style="vertical-align: inherit;">Model ini memiliki kumpulan proses, masing-masing memiliki kumpulan benang, yang masing-masing, pada gilirannya, menggunakan model pemrosesan berdasarkan input-output asinkron. </font><font style="vertical-align: inherit;">Nginx menghadirkan model gabungan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, beralih ke dasar-dasar sistem operasi, kami memeriksa perbedaan konseptual antara model server web yang digunakan di Apache dan Nginx. </font><font style="vertical-align: inherit;">Masing-masing dari mereka memiliki kelebihan dan kekurangan, sehingga kombinasi mereka sering digunakan dalam produksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gagasan pemrosesan asinkron telah berkembang lebih lanjut: pada tingkat platform bahasa, konsep benang hijau / serat / goroutine telah muncul, yang memungkinkan Anda untuk "menyembunyikan di balik tudung" asinkron input dan output, membuat pengembang senang dengan kode sinkron yang indah. </font><font style="vertical-align: inherit;">Namun, konsep ini layak mendapat artikel terpisah.</font></font><br>
<br>
<hr><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pelajari lebih lanjut tentang kursus.</font></font></a></b><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id496944/index.html">Acara digital di St. Petersburg dari 13 hingga 19 April</a></li>
<li><a href="../id496946/index.html">Sekali lagi tentang kunci perangkat keras GPG untuk satu sen</a></li>
<li><a href="../id496950/index.html">Desain adalah desain, bukan keindahan gambar.</a></li>
<li><a href="../id496952/index.html">Qualcomm QCC3020 - munculnya headphone TWS Cina</a></li>
<li><a href="../id496954/index.html">Pengembangan di Wargaming - bertemu dengan Maxim Baryshnikov, Kepala Platform (Bagian I)</a></li>
<li><a href="../id496958/index.html">CSS yang menarik ditemukan di desain Facebook yang baru</a></li>
<li><a href="../id496960/index.html">Mempercepat grafik menggunakan OffscreenCanvas</a></li>
<li><a href="../id496962/index.html">Bagaimana cara merapikan server yang kelebihan beban?</a></li>
<li><a href="../id496964/index.html">Seminar Mingguan IBM - April 2020</a></li>
<li><a href="../id496966/index.html">Warna CSS LCH</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>