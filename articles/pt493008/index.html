<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úåüèø üé≥ üé± Sobre o cluster do servidor 1C üçπ üë©üèª‚Äç‚öñÔ∏è üóÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um cluster √© um tipo de 
 sistema paralelo ou distribu√≠do que: 
 1. consiste em v√°rios 
 computadores interconectados ; 
 2. Usado como 
 recurso √∫nic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sobre o cluster do servidor 1C</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/1c/blog/493008/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um cluster √© um tipo de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sistema </font><font style="vertical-align: inherit;">paralelo </font><font style="vertical-align: inherit;">ou distribu√≠do que: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. consiste em v√°rios </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
computadores </font><font style="vertical-align: inherit;">interconectados </font><font style="vertical-align: inherit;">; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Usado como </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
recurso </font><font style="vertical-align: inherit;">√∫nico e </font><font style="vertical-align: inherit;">unificado de computador </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gregory F. Pfister, ‚ÄúEm busca de clusters‚Äù. </font></font></a></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dado:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existe um aplicativo comercial (por exemplo, um sistema ERP) com o qual milhares (possivelmente dezenas de milhares) de usu√°rios trabalham simultaneamente. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â necess√°rio:</font></font></b><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Torne o aplicativo escal√°vel, para que, com um aumento no n√∫mero de usu√°rios, seja poss√≠vel devido ao aumento dos recursos de hardware para fornecer o desempenho necess√°rio do aplicativo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Torne o aplicativo resistente a falhas de componentes do sistema (software e hardware), perda de conex√£o entre componentes e outros poss√≠veis problemas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use os recursos do sistema da maneira mais eficiente poss√≠vel e forne√ßa o desempenho desejado do aplicativo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facilite a implanta√ß√£o e administra√ß√£o do sistema.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver esses problemas, usamos a arquitetura de cluster na plataforma 1C: Enterprise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o alcan√ßamos imediatamente o resultado desejado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, falaremos sobre que tipo de clusters s√£o, como escolhemos o tipo de cluster que mais nos conv√©m e como nosso cluster evoluiu de vers√£o para vers√£o, e quais abordagens nos permitiram criar um sistema que serve </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dezenas de </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">milhares de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usu√°rios simult√¢neos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0g/mo/rq/0gmorqiise6fvaouym5mwpabl7y.png" alt="imagem"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como Gregory Pfister, autor da ep√≠grafe deste artigo, escreveu em seu livro "Em busca de clusters", o cluster n√£o foi inventado por nenhum fabricante espec√≠fico de hardware ou software, mas por clientes que n√£o tinham o poder de um computador ou precisavam de redund√¢ncia. </font><font style="vertical-align: inherit;">Isso aconteceu, segundo Pfister, nos anos 60 do s√©culo passado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tradicionalmente, distingue os seguintes tipos principais de clusters:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusters de failover (HA, clusters de alta disponibilidade)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusters de balanceamento de carga (LBC)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusters de computa√ß√£o (Clusters de computa√ß√£o de alto desempenho, HPC)</font></font></li>
<li>   (grid)      ,              .   grid-      ,    .  grid-    HPC-,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver nossos problemas (resist√™ncia √† falha dos componentes do sistema e uso eficiente dos recursos), precis√°vamos combinar a funcionalidade de um cluster √† prova de falhas e um cluster com balanceamento de carga. </font><font style="vertical-align: inherit;">N√£o chegamos a essa decis√£o imediatamente, mas a abordamos evolutivamente, passo a passo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para aqueles que n√£o est√£o atualizados, mostrarei brevemente como os aplicativos de neg√≥cios 1C s√£o organizados. </font><font style="vertical-align: inherit;">S√£o aplicativos escritos em uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linguagem orientada ao assunto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , "aprimorada" para a automa√ß√£o de tarefas de neg√≥cios cont√°beis. </font><font style="vertical-align: inherit;">Para executar aplicativos escritos nesse idioma, um tempo de execu√ß√£o da plataforma 1C: Enterprise deve estar instalado no computador.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C: Enterprise 8.0</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira vers√£o do servidor de aplicativos 1C (ainda n√£o um cluster) apareceu na plataforma vers√£o 8.0. Antes disso, 1C trabalhava na vers√£o cliente-servidor, os dados eram armazenados em um arquivo DBMS ou MS SQL e a l√≥gica de neg√≥cios trabalhava exclusivamente no cliente. Na vers√£o 8.0, foi feita uma transi√ß√£o para a arquitetura de tr√™s camadas "cliente - servidor de aplicativos - DBMS". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O servidor 1C na plataforma 8.0 era </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COM +</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um servidor que pode executar o c√≥digo do aplicativo em 1C. </font><font style="vertical-align: inherit;">O uso do COM + nos forneceu transporte pronto, permitindo que os aplicativos clientes se comuniquem com o servidor pela rede. </font><font style="vertical-align: inherit;">Muitas coisas na arquitetura da intera√ß√£o cliente-servidor e os objetos de aplicativo dispon√≠veis para o desenvolvedor do 1C foram projetados levando em considera√ß√£o o uso do COM +. </font><font style="vertical-align: inherit;">Naquele momento, a toler√¢ncia a falhas n√£o era incorporada √† arquitetura e uma falha no servidor fazia com que todos os clientes fossem desligados. </font><font style="vertical-align: inherit;">Quando o aplicativo do servidor travou, o COM + o levantou quando o primeiro cliente o acessou, e os clientes come√ßaram seu trabalho desde o in√≠cio - a partir da conex√£o com o servidor. </font><font style="vertical-align: inherit;">Naquele momento, todos os clientes eram atendidos por um processo.</font></font><br>
<img src="https://habrastorage.org/webt/fg/oo/en/fgooenmx-pqv5tuizcfcvbvbaqg.png" alt="imagem"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C: Empresa 8.1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na pr√≥xima vers√£o, quer√≠amos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fornecer toler√¢ncia a falhas para nossos clientes, para que acidentes e erros de alguns usu√°rios n√£o levem a acidentes e erros de outros usu√°rios. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre-se da tecnologia COM +. </font><font style="vertical-align: inherit;">O COM + funcionava apenas no Windows e, naquele momento, a possibilidade de trabalhar no Linux j√° estava se tornando relevante.</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao mesmo tempo, n√£o quer√≠amos desenvolver uma nova vers√£o da plataforma do zero - ela consumiria muitos recursos. </font><font style="vertical-align: inherit;">Quer√≠amos aproveitar ao m√°ximo nossas conquistas, bem como manter a compatibilidade com aplicativos desenvolvidos para a vers√£o 8.0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, na vers√£o 8.1, o primeiro cluster apareceu. </font><font style="vertical-align: inherit;">Implementamos nosso protocolo para chamada de procedimento remoto (acima do TCP), que parecia quase COM + para o consumidor final (ou seja, praticamente n√£o precisamos reescrever o c√≥digo respons√°vel pelas chamadas cliente-servidor). </font><font style="vertical-align: inherit;">Ao mesmo tempo, tornamos o servidor implementado na plataforma C ++ independente, capaz de trabalhar no Windows e no Linux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O servidor monol√≠tico vers√£o 8.0 foi substitu√≠do por 3 tipos de processos - um processo de trabalho que atende clientes e 2 processos de servi√ßo que suportam a opera√ß√£o do cluster:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O rphost √© um fluxo de trabalho que atende clientes e executa o c√≥digo do aplicativo. </font><font style="vertical-align: inherit;">Um cluster pode ter mais de um fluxo de trabalho, diferentes fluxos de trabalho podem ser executados em diferentes servidores f√≠sicos - devido a essa escalabilidade ser alcan√ßada.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ragent - um processo de agente do servidor que inicia todos os outros tipos de processos, bem como uma lista principal de clusters localizados neste servidor.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O rmngr √© um gerenciador de cluster que controla a opera√ß√£o de todo o cluster (mas o c√≥digo do aplicativo n√£o funciona nele). </font></font></li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sob o corte, est√° o diagrama de opera√ß√£o desses tr√™s processos no cluster.</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/mn/yh/tc/mnyhtcaf9zf3_nqddsbfq4xgpsg.png" alt="image"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante a sess√£o, o cliente trabalhou com um fluxo de trabalho, a queda no fluxo de trabalho significou para todos os clientes aos quais esse processo atendeu, a sess√£o foi encerrada de forma anormal. </font><font style="vertical-align: inherit;">Os demais clientes continuaram trabalhando.</font></font><br>
<img src="https://habrastorage.org/webt/wm/tm/mc/wmtmmcct7xd6v2ecl6vi7nlx5dk.png" alt="imagem"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C: Empresa 8.2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na vers√£o 8.2, quer√≠amos que os aplicativos 1C pudessem ser executados n√£o apenas no cliente nativo (execut√°vel), mas tamb√©m no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navegador</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (sem modificar o c√≥digo do aplicativo). </font><font style="vertical-align: inherit;">Nesse sentido, em particular, surgiu a tarefa de dissociar o estado atual do aplicativo da conex√£o atual com o fluxo de trabalho do rphost e torn√°-lo sem estado. </font><font style="vertical-align: inherit;">Como resultado, surgiu o conceito de uma sess√£o e os dados da sess√£o que precisavam ser armazenados fora do fluxo de trabalho (porque eram sem estado). </font><font style="vertical-align: inherit;">Foi desenvolvido um servi√ßo de dados da sess√£o que armazena e armazena em cache as informa√ß√µes da sess√£o. </font><font style="vertical-align: inherit;">Outros servi√ßos tamb√©m apareceram - um servi√ßo de bloqueios transacionais gerenciados, um servi√ßo de pesquisa de texto completo etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa vers√£o tamb√©m apresentou v√°rias inova√ß√µes importantes - toler√¢ncia a falhas aprimorada, balanceamento de carga e um mecanismo de redund√¢ncia de cluster.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toler√¢ncia ao erro</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o processo de trabalho ficou sem estado e todos os dados necess√°rios para o trabalho foram armazenados fora do cliente atual - conex√£o do fluxo de trabalho, no caso de uma falha no fluxo de trabalho, o cliente mudou para outro fluxo de trabalho "ativo" na pr√≥xima vez em que acessou o servidor. Na maioria dos casos, essa op√ß√£o era invis√≠vel para o cliente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mecanismo funciona assim. Se a chamada do cliente para o fluxo de trabalho, por algum motivo, n√£o puder ser conclu√≠da at√© o final, a parte do cliente poder√°, ap√≥s receber um erro de chamada, repetir essa chamada restabelecendo a conex√£o com o mesmo fluxo de trabalho ou com outro. Mas voc√™ nem sempre pode repetir uma liga√ß√£o; Repetir a chamada significa que enviamos a chamada para o servidor, mas n√£o recebemos o resultado. Tentamos repetir a chamada, enquanto fazemos a segunda chamada, avaliamos qual foi o resultado da chamada anterior no servidor (informa√ß√µes sobre isso s√£o armazenadas no servidor nos dados da sess√£o), porque se a chamada tiver tempo para "herdar" (fechar a transa√ß√£o, salvar os dados da sess√£o) etc.) - √© imposs√≠vel repeti-lo, isso levar√° √† inconsist√™ncia dos dados. Se a chamada n√£o puder ser repetida, o cliente receber√° uma mensagem sobre um erro irrecuper√°vel,e o aplicativo cliente ter√° que reiniciar. Se voc√™ n√£o conseguiu "herdar" a chamada (e essa √© a situa√ß√£o mais comum, porque muitas chamadas n√£o alteram dados, por exemplo, relat√≥rios, exibi√ß√£o de dados em um formul√°rio etc.) e aquelas que alteram dados n√£o t√™m uma transa√ß√£o ou at√© que uma altera√ß√£o nos dados da sess√£o seja enviada ao gerente - n√£o h√° rastreamento da chamada) - ela pode ser repetida sem risco de inconsist√™ncia dos dados. Se o fluxo de trabalho travar ou uma conex√£o de rede for interrompida, essa chamada ser√° repetida e esse "desastre" para o aplicativo cliente ocorrer√° completamente despercebido.que alteram os dados - at√© que a transa√ß√£o seja confirmada ou at√© que a altera√ß√£o nos dados da sess√£o seja enviada ao gerente - n√£o h√° rastreamento da chamada) - ela pode ser repetida sem risco de inconsist√™ncia dos dados. Se o fluxo de trabalho travar ou uma conex√£o de rede for interrompida, essa chamada ser√° repetida e esse "desastre" para o aplicativo cliente ocorrer√° completamente despercebido.que alteram os dados - at√© que a transa√ß√£o seja confirmada ou at√© que a altera√ß√£o nos dados da sess√£o seja enviada ao gerente - n√£o h√° rastreamento da chamada) - ela pode ser repetida sem risco de inconsist√™ncia dos dados. Se o fluxo de trabalho travar ou uma conex√£o de rede for interrompida, essa chamada ser√° repetida e esse "desastre" para o aplicativo cliente ocorrer√° completamente despercebido.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Balanceamento de carga</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tarefa de balanceamento de carga no nosso caso √© a seguinte: um novo cliente entra no sistema (ou um cliente que j√° est√° trabalhando faz outra chamada). </font><font style="vertical-align: inherit;">Precisamos escolher para qual servidor e fluxo de trabalho enviar a chamada do cliente para fornecer velocidade m√°xima ao cliente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© uma tarefa padr√£o para um cluster com balanceamento de carga. </font><font style="vertical-align: inherit;">Existem v√°rios algoritmos t√≠picos para resolv√™-lo, por exemplo:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Round-Robin ()</a> ‚Äì    ,      ,   ‚Äì    . .    .           .    ,          ¬´¬ª .           (   )    .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Weighted Round Robin</a> ‚Äì  Round-Robin:          ,    ÃÅ    .</li>
<li>Least Connections:     ,       .</li>
<li>Least Response Time:       :    ,    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o nosso cluster, escolhemos um algoritmo essencialmente pr√≥ximo ao Tempo de resposta m√≠nimo. Temos um mecanismo que coleta estat√≠sticas sobre o desempenho dos fluxos de trabalho em todos os servidores no cluster. Faz uma chamada de refer√™ncia para cada processo do servidor no cluster; a chamada de refer√™ncia envolve um subconjunto das fun√ß√µes do subsistema de disco, mem√≥ria, processador e avalia a rapidez com que essa chamada √© feita. O resultado dessas medi√ß√µes, em m√©dia nos √∫ltimos 10 minutos, √© um crit√©rio - qual servidor no cluster √© o mais produtivo e preferido para enviar conex√µes de clientes a ele em um determinado per√≠odo de tempo. As solicita√ß√µes dos clientes s√£o distribu√≠das de forma a melhor carregar o servidor mais produtivo - carregue aquele que tiver sorte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A solicita√ß√£o do novo cliente √© endere√ßada ao servidor mais produtivo no momento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na maioria dos casos, uma solicita√ß√£o de um cliente existente √© endere√ßada a esse servidor e ao fluxo de trabalho ao qual sua solicita√ß√£o anterior foi endere√ßada. </font><font style="vertical-align: inherit;">Um conjunto extenso de dados no servidor est√° associado a um cliente que trabalha; transferi-lo entre processos (e mais ainda entre servidores) √© bastante caro (embora possamos fazer isso tamb√©m). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma solicita√ß√£o de um cliente existente √© transferida para outro fluxo de trabalho em dois casos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o h√° mais processo: o fluxo de trabalho com o qual o cliente interagiu anteriormente n√£o est√° mais dispon√≠vel (o processo caiu, o servidor ficou indispon√≠vel etc.).</font></font></li>
<li>   :     ,            ,     ,   ,              .         ,  ,     ‚Äì             .    ‚Äì      (..   ).</li>
</ol><br>
<br>
<h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos aumentar a resili√™ncia do cluster recorrendo ao esquema </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ativo / passivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Houve uma oportunidade de configurar dois clusters - trabalhando e reserva. </font><font style="vertical-align: inherit;">Se o cluster prim√°rio n√£o estiver dispon√≠vel (problemas de rede ou, por exemplo, manuten√ß√£o agendada), as chamadas do cliente ser√£o redirecionadas para o cluster de backup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, esse design foi bastante dif√≠cil de configurar. </font><font style="vertical-align: inherit;">O administrador teve que montar manualmente dois grupos de servidores em clusters e configur√°-los. </font><font style="vertical-align: inherit;">√Äs vezes, os administradores cometem erros ao definir configura√ß√µes conflitantes, como </font><font style="vertical-align: inherit;">n√£o havia mecanismo centralizado para verificar as configura√ß√µes. </font><font style="vertical-align: inherit;">Mas, no entanto, essa abordagem aumentou a toler√¢ncia a falhas do sistema.</font></font><br>
<img src="https://habrastorage.org/webt/ik/k7/06/ikk7062chdd8qtpk0kzvfncq7vu.png" alt="imagem"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1C: Empresa 8.3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na vers√£o 8.3, reescrevemos substancialmente o c√≥digo do servidor respons√°vel pela toler√¢ncia a falhas. Decidimos abandonar o esquema de cluster Ativo / passivo devido √† complexidade de sua configura√ß√£o. Apenas um cluster tolerante a falhas permaneceu no sistema, consistindo em qualquer n√∫mero de servidores - isso √© mais pr√≥ximo do esquema </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ativo / Ativo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">no qual as solicita√ß√µes de um n√≥ com falha s√£o distribu√≠das entre os n√≥s de trabalho restantes. Devido a isso, o cluster ficou mais f√°cil de configurar. V√°rias opera√ß√µes que aumentam a toler√¢ncia a falhas e melhoram o balanceamento de carga foram automatizadas. Das inova√ß√µes importantes:</font></font><br>
<br>
<ul>
<li>   ¬´ ¬ª: , ,               .                ,           ¬´¬ª          .</li>
<li>     ,  ,            .</li>
<li>  ,     ,     ,   ,   ,    :</li>
</ul><br>
<img src="https://habrastorage.org/webt/o7/aw/pz/o7awpzltn3jxnderotcyf_wbahm.png" alt="imagem"><br>
<br>
<img src="https://habrastorage.org/webt/v5/kc/rj/v5kcrjv3ldm96l3ovj1seqobrga.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ideia principal desses desenvolvimentos √© simplificar o trabalho do administrador, permitindo que ele configure o cluster em termos familiares a ele, no n√≠vel de opera√ß√£o do servidor, n√£o diminuindo, e tamb√©m para minimizar o n√≠vel de "controle manual" do trabalho do cluster, fornecendo mecanismos de cluster para resolver a maioria das tarefas de trabalho e poss√≠veis problemas " no piloto autom√°tico ".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/da/9i/zy/da9izy3cj4wlf80nr8s35tqnp3e.png" alt="imagem"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr√™s links de toler√¢ncia a falhas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ sabe, mesmo que os componentes do sistema separadamente sejam confi√°veis, podem surgir problemas onde os componentes do sistema causam um ao outro. </font><font style="vertical-align: inherit;">Quer√≠amos minimizar o n√∫mero de locais cr√≠ticos para o desempenho do sistema. </font><font style="vertical-align: inherit;">Uma considera√ß√£o adicional importante foi a minimiza√ß√£o de altera√ß√µes nos mecanismos aplicados na plataforma e a exclus√£o de altera√ß√µes nas solu√ß√µes aplicadas. </font><font style="vertical-align: inherit;">Na vers√£o 8.3, havia 3 links para garantir a toler√¢ncia a falhas "nas articula√ß√µes":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kb/1g/s1/kb1gs1mfus_rsminiyizg4t5dma.png" alt="imagem"><br>
<ol>
<li>  ,   HTTP(S),  -.   -     -.    ,   HTTP  -,    (     HTTP)    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libcurl</a>    . </li>
<li>  ,                     .</li>
<li>  -   .       1,   -     .    -            .       ,         .           ,     ‚Äì    .    -         (,     ,   ,         ) ‚Äì          .</li>
<li>     ,    rmngr.    20 (    ) ‚Äî   ,     ..                .     1:          .</li>
</ol><br>
<br>
<h2> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gra√ßas ao mecanismo de toler√¢ncia a falhas, os aplicativos criados na plataforma 1C: Enterprise sobrevivem com √™xito a v√°rios tipos de falhas de servidores de produ√ß√£o no cluster, enquanto a maioria dos clientes continua trabalhando sem reiniciar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° situa√ß√µes em que n√£o podemos repetir a chamada ou um travamento do servidor captura a plataforma em um momento muito infeliz, por exemplo, no meio de uma transa√ß√£o e n√£o est√° muito claro o que fazer com eles. Tentamos garantir a sobreviv√™ncia estatisticamente boa do cliente quando os servidores caem no cluster. Como regra, a perda m√©dia de clientes por falha do servidor √© de alguns por cento. Nesse caso, todos os clientes "perdidos" podem continuar trabalhando no cluster ap√≥s reiniciar o aplicativo cliente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A confiabilidade do cluster de servidores 1C na vers√£o 8.3 aumentou significativamente. </font><font style="vertical-align: inherit;">H√° muito tempo n√£o √© incomum a introdu√ß√£o de produtos 1C, onde o n√∫mero de usu√°rios que trabalham simultaneamente chega a v√°rios milhares. </font><font style="vertical-align: inherit;">Existem implementa√ß√µes em que 5.000 e 10.000 usu√°rios trabalham simultaneamente - por exemplo, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introdu√ß√£o no Beeline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , onde o aplicativo 1C: Trade Management atende a todos os </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">pontos de</font></a><font style="vertical-align: inherit;"> venda da Beeline na R√∫ssia ou a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementa√ß√£o de Linhas de Neg√≥cios na transportadora de carga</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , em que o aplicativo, criado de forma independente pelos desenvolvedores do departamento de TI das linhas de neg√≥cios na plataforma 1C: Enterprise, atende a todo o ciclo de transporte de carga. </font><font style="vertical-align: inherit;">Nossos testes de carga de cluster interno simulam a opera√ß√£o simult√¢nea de at√© 20.000 usu√°rios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Concluindo, gostaria de listar brevemente o que mais √© √∫til em nosso cluster (a lista est√° incompleta):</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>,         . ,             ,   .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ‚Äì ,   ,   ,   (      ‚Äì <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a>  ..)      . ,   ,      (, )     ,   ERP, ,           ERP.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ‚Äì ,     (,  ,    ..).  ,  ,    ,     ,   ,        .</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt492994/index.html">O que h√° de novo no TestMace Parte 1. Sincroniza√ß√£o em nuvem, interface atualizada e muito mais</a></li>
<li><a href="../pt492996/index.html">Organiza√ß√£o de formatos de data personalizados e desserializa√ß√£o de marca√ß√µes no Go</a></li>
<li><a href="../pt492998/index.html">Como ficamos confusos com o freelancer para um data center e o que aconteceu</a></li>
<li><a href="../pt493000/index.html">M√©todos para lidar com c√≥digo legado usando o GitLab como exemplo</a></li>
<li><a href="../pt493002/index.html">350 pessoas remotamente: como foi</a></li>
<li><a href="../pt493010/index.html">Como o Quarkus combina programa√ß√£o imperativa e reativa</a></li>
<li><a href="../pt493012/index.html">Ar, rel√©s, cabos pela janela: como n√£o encontrar um fornecedor monopolista em um centro de neg√≥cios</a></li>
<li><a href="../pt493014/index.html">Entrevista com Vyacheslav Utochkin, diretor de programas de treinamento para desenvolvedores de jogos na Escola Superior de Economia, Escola Superior de Economia, Escola Superior de Economia Escola Superior de Economia: 20 perguntas sobre Game Dev</a></li>
<li><a href="../pt493016/index.html">O cabe√ßalho "Leia artigos para voc√™". Janeiro - fevereiro 2020</a></li>
<li><a href="../pt493018/index.html">O desenvolvedor apreciou a complexidade dos navegadores modernos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>