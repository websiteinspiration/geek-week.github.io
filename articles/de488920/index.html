<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧕🏻 🐡 👨🏾‍🏭 Bestimmen Sie die geeignete Größe für den Kafka-Cluster in Kubernetes 📭 👨🏽‍⚕️ 💜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hinweis perev. : In diesem Artikel gibt Banzai Cloud ein Beispiel für die Verwendung seiner speziellen Dienstprogramme, um den Betrieb von Kafka inner...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bestimmen Sie die geeignete Größe für den Kafka-Cluster in Kubernetes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/488920/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis perev.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : In diesem Artikel gibt Banzai Cloud ein Beispiel für die Verwendung seiner speziellen Dienstprogramme, um den Betrieb von Kafka innerhalb von Kubernetes zu erleichtern. Diese Anweisungen veranschaulichen, wie Sie die optimale Infrastrukturgröße ermitteln und Kafka selbst konfigurieren können, um den erforderlichen Durchsatz zu erzielen.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/hw/a_/x4/hwa_x4pat6hztyyuh8lorl015pq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apache Kafka ist eine verteilte Streaming-Plattform zur Erstellung zuverlässiger, skalierbarer und leistungsstarker Echtzeit-Streaming-Systeme. Seine beeindruckenden Funktionen können mit Kubernetes erweitert werden. Zu diesem</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"> Zweck haben</font></a><font style="vertical-align: inherit;"> wir den</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kafka Open Source-Operator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ein Tool namens</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Supertubes entwickelt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mit ihnen können Sie Kafka in Kubernetes ausführen und die verschiedenen Funktionen verwenden, z. B. die Feinabstimmung der Brokerkonfiguration, die Skalierung basierend auf Metriken mit Neuausrichtung, Rack-Erkennung (Kenntnis der Hardwareressourcen), „weiche“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ordnungsgemäße)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fortlaufende Updates usw.</font></font><a name="habracut"></a><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probieren Sie Supertubes in Ihrem Cluster aus:</font></font><br>
<br>
<pre><code class="bash hljs">curl https://getsupertubes.sh | sh  supertubes install -a --no-democluster --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oder beziehen Sie sich auf die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sie können auch einige der Funktionen von Kafka lesen, die mithilfe von Supertubes und dem Kafka-Operator automatisiert werden. </font><font style="vertical-align: inherit;">Wir haben bereits im Blog darüber geschrieben:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ach nein! </font><font style="vertical-align: inherit;">Noch ein Kafka-Betreiber für Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überwachen und betreiben Sie Kafka basierend auf Prometheus-Metriken</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kafka Rack Awareness auf Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Kafka über Istio laufen lassen - Benchmark</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benutzerauthentifizierte und zugriffsgesteuerte Cluster mit dem Kafka-Operator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kafka Rolling Upgrade und dynamische Konfiguration auf Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesandterprotokollfilter für Kafka, vermascht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie sich für die Bereitstellung eines Kafka-Clusters in Kubernetes entscheiden, werden Sie wahrscheinlich auf das Problem stoßen, die optimale Größe der zugrunde liegenden Infrastruktur zu ermitteln und die Kafka-Konfiguration an die Bandbreitenanforderungen anzupassen. </font><font style="vertical-align: inherit;">Die maximale Leistung jedes Brokers wird durch die Leistung der Infrastrukturkomponenten in seinem Kern bestimmt, z. B. Speicher, Prozessor, Festplattengeschwindigkeit, Netzwerkbandbreite usw.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Idealfall sollte die Konfiguration des Brokers so sein, dass alle Elemente der Infrastruktur maximal genutzt werden. Im wirklichen Leben ist dieses Setup jedoch sehr kompliziert. Es ist wahrscheinlicher, dass Benutzer Broker so konfigurieren, dass die Verwendung von einer oder zwei Komponenten (Festplatte, Speicher oder Prozessor) maximiert wird. Im Allgemeinen zeigt ein Broker maximale Leistung, wenn seine Konfiguration es Ihnen ermöglicht, die langsamste Komponente "vollständig" zu verwenden. So können wir eine ungefähre Vorstellung von der Last bekommen, die ein Broker bewältigen kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Theoretisch können wir auch die Anzahl der Broker schätzen, die für die Arbeit mit einer bestimmten Last benötigt werden. In der Praxis gibt es jedoch so viele Konfigurationsoptionen auf verschiedenen Ebenen, dass es sehr schwierig (wenn nicht unmöglich) ist, die potenzielle Leistung einer bestimmten Konfiguration zu bewerten. Mit anderen Worten, es ist sehr schwierig, die Konfiguration ausgehend von einer bestimmten Leistung zu planen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für Supertubes-Benutzer verwenden wir normalerweise den folgenden Ansatz: Beginnen Sie mit einer Konfiguration (Infrastruktur + Einstellungen), messen Sie dann die Leistung, passen Sie die Brokereinstellungen an und wiederholen Sie den Vorgang erneut. Dies geschieht so lange, bis das Potenzial der langsamsten Infrastrukturkomponente voll ausgeschöpft ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf diese Weise erhalten wir eine klarere Vorstellung davon, wie viele Broker ein Cluster benötigt, um mit einer bestimmten Last fertig zu werden (die Anzahl der Broker hängt auch von anderen Faktoren ab, z. B. der Mindestanzahl von Nachrichtenreplikaten, um Stabilität zu gewährleisten, der Anzahl der Partitionsleiter usw.). Darüber hinaus erhalten wir eine Vorstellung davon, welche vertikale Skalierung der Infrastrukturkomponente gewünscht wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werden die Schritte erläutert, die wir unternehmen, um aus den langsamsten Komponenten in den Anfangskonfigurationen „alles herauszuholen“ und den Durchsatz des Kafka-Clusters zu messen. Für eine hoch belastbare Konfiguration sind mindestens drei Arbeitsmakler erforderlich (</font></font><code>min.insync.replicas=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) in drei verschiedenen Zugänglichkeitszonen angeordnet. </font><font style="vertical-align: inherit;">Zur Konfiguration, Skalierung und Überwachung der Kubernetes-Infrastruktur verwenden wir unsere eigene Hybrid-Cloud-Container-Management-Plattform - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pipeline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es unterstützt On-Premise (Bare Metal, VMware) und fünf Arten von Clouds (Alibaba, AWS, Azure, Google, Oracle) sowie eine beliebige Kombination davon.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gedanken zur Infrastruktur und Konfiguration des Kafka-Clusters</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In den folgenden Beispielen haben wir AWS als Cloud-Dienstanbieter und EKS als Kubernetes-Distribution ausgewählt. </font><font style="vertical-align: inherit;">Eine ähnliche Konfiguration kann mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementiert werden </font><font style="vertical-align: inherit;">, einer von CNCF zertifizierten Kubernetes-Distribution von Banzai Cloud.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Platte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amazon bietet verschiedene </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arten von EBS-Volumes an</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">SSDs sind die </font><font style="vertical-align: inherit;">Basis von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1. Um</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jedoch einen hohen Durchsatz zu gewährleisten, </font><font style="vertical-align: inherit;">verbraucht </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akkumulierte Kredite </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(E / A-Gutschriften)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Daher bevorzugen wir den Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , der einen stabilen hohen Durchsatz bietet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instanztypen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Leistung von Kafka hängt stark vom Seiten-Cache des Betriebssystems ab. Daher benötigen wir Instanzen mit genügend Speicher für Broker (JVMs) und Seiten-Cache. Instanz </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.2xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein guter Anfang, da sie über 16 GB Arbeitsspeicher verfügt und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">für die Arbeit mit EBS optimiert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist </font><font style="vertical-align: inherit;">. Der Nachteil ist, dass alle 24 Stunden eine maximale Leistung von nicht mehr als 30 Minuten erzielt werden kann. Wenn Ihre Arbeitslast über einen längeren Zeitraum maximale Leistung erfordert, sehen Sie sich andere Arten von Instanzen an. Wir haben genau das getan und bei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge angehalten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Es bietet einen maximalen Durchsatz von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">593,75 Mb / s.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der maximale Durchsatz des EBS </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1-Volumes ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> höher als der der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Instanz </font><font style="vertical-align: inherit;">. Das langsamste Infrastrukturelement ist daher wahrscheinlich der E / A-Durchsatz dieses </font><i><font style="vertical-align: inherit;">Instanztyps</font></i><font style="vertical-align: inherit;"> (was auch durch die Ergebnisse unserer Auslastungstests bestätigt werden sollte).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netzwerk</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Netzwerkbandbreite sollte im Vergleich zur Leistung der VM-Instanz und der Festplatte recht groß sein, da sonst das Netzwerk zu einem Engpass wird. </font><font style="vertical-align: inherit;">In unserem Fall unterstützt die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Netzwerkschnittstelle </font><font style="vertical-align: inherit;">Geschwindigkeiten von bis zu 10 Gbit / s, was erheblich über der Bandbreite der E / A-Instanz der VM liegt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Broker-Bereitstellung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Broker sollten auf dedizierten Knoten bereitgestellt (in Kubernetes geplant) werden, um den Wettbewerb mit anderen Prozessen um Prozessor-, Speicher-, Netzwerk- und Festplattenressourcen zu vermeiden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java-Version</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die logische Wahl ist Java 11, da es mit Docker in dem Sinne kompatibel ist, dass die JVM die Prozessoren und den Speicher, die für den Container, in dem der Broker ausgeführt wird, verfügbar sind, korrekt bestimmt. </font><font style="vertical-align: inherit;">In dem Wissen, dass Prozessorlimits wichtig sind, legt die JVM intern und transparent die Anzahl der GC-Threads und JIT-Compiler-Threads fest. </font><font style="vertical-align: inherit;">Wir haben ein Kafka-Image verwendet </font></font><code>banzaicloud/kafka:2.13-2.4.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, das Kafka Version 2.4.0 (Scala 2.13) in Java 11 enthält.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie mehr über Java / JVM auf Kubernetes erfahren möchten, lesen Sie unsere folgenden Veröffentlichungen:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum meine Java-Anwendung OOMKilled ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So dimensionieren Sie Container für Java 10-Anwendungen richtig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Broker-Speichereinstellungen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Einstellen des Broker-Speichers hat zwei Hauptaspekte: Einstellungen für die JVM und für den Kubernetes-Pod. </font><font style="vertical-align: inherit;">Das für den Pod festgelegte Speicherlimit muss größer als die maximale Heap-Größe sein, damit die JVM genügend Speicherplatz für den Java-Metaspace in ihrem eigenen Speicher und für den von Kafka aktiv verwendeten Seitencache des Betriebssystems hat. </font><font style="vertical-align: inherit;">In unseren Tests haben wir Kafka-Broker mit Parametern ausgeführt </font></font><code>-Xmx4G -Xms2G</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, und das Speicherlimit für den Pod war </font></font><code>10 Gi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Bitte beachten Sie, dass die Speichereinstellungen für die JVM automatisch mit </font></font><code>-XX:MaxRAMPercentage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>-X:MinRAMPercentage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basierend auf dem Speicherlimit für den Pod </font><font style="vertical-align: inherit;">abgerufen werden können </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Broker-Prozessoreinstellungen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen können Sie die Produktivität steigern, indem Sie die Parallelität erhöhen, indem Sie die Anzahl der von Kafka verwendeten Threads erhöhen. </font><font style="vertical-align: inherit;">Je mehr Prozessoren für Kafka verfügbar sind, desto besser. </font><font style="vertical-align: inherit;">In unserem Test haben wir mit einem Limit von 6 Prozessoren begonnen und deren Anzahl schrittweise (iteriert) auf 15 erhöht. Außerdem haben wir </font></font><code>num.network.threads=12</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in den Brokereinstellungen festgelegt, wie viele Streams Daten vom Netzwerk empfangen und senden. </font><font style="vertical-align: inherit;">Nachdem sie sofort festgestellt hatten, dass Follower-Broker Replikate nicht schnell genug erhalten können, erhöhten sie sich </font></font><code>num.replica.fetchers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf 4, um die Geschwindigkeit zu erhöhen, mit der Follower-Broker Nachrichten von Führungskräften replizierten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tool zur Lasterzeugung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sicher, dass das Potenzial des ausgewählten Lastgenerators nicht ausgeht, bevor der Kafka-Cluster (dessen Benchmark ausgeführt wird) seine maximale Last erreicht. </font><font style="vertical-align: inherit;">Mit anderen Worten, es ist erforderlich, eine vorläufige Bewertung der Funktionen des Lastgenerierungswerkzeugs durchzuführen und Instanztypen mit einer ausreichenden Anzahl von Prozessoren und Speicher auszuwählen. </font><font style="vertical-align: inherit;">In diesem Fall erzeugt unser Tool mehr Last, als der Kafka-Cluster verdauen kann. </font><font style="vertical-align: inherit;">Nach vielen Experimenten haben wir uns für drei Kopien von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge entschieden</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in denen jeweils der Generator gestartet wurde.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benchmarking</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Leistungsmessung ist ein iterativer Prozess, der die folgenden Schritte umfasst:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einrichtung der Infrastruktur (EKS-Cluster, Kafka-Cluster, Lastgenerierungstool sowie Prometheus und Grafana);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lastgenerierung für einen bestimmten Zeitraum, um zufällige Abweichungen in den gesammelten Leistungsindikatoren zu filtern;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Feinabstimmung der Infrastruktur und Konfiguration des Brokers anhand der beobachteten Leistungsindikatoren;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiederholen des Vorgangs, bis die erforderliche Kafka-Cluster-Bandbreite erreicht ist. </font><font style="vertical-align: inherit;">Gleichzeitig sollte es stabil reproduzierbar sein und minimale Bandbreitenschwankungen aufweisen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im nächsten Abschnitt werden die Schritte beschrieben, die während des Benchmark-Testclusters ausgeführt wurden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Werkzeuge</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgenden Tools wurden verwendet, um die Basiskonfiguration, die Lastgenerierung und die Leistungsmessung schnell bereitzustellen:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Banzai Cloud Pipeline</a>    EKS  Amazon c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Prometheus</a> (   Kafka  )  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Grafana</a> (   ).   <b></b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pipeline</a> ,    ,   ,  ,   ,      .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sangrenel</a> —      Kafka.</li>
<li>  Grafana    Kafka  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubernetes Kafka</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Node Exporter</a>.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supertubes CLI für die einfachste Möglichkeit, einen Kafka-Cluster in Kubernetes zu konfigurieren. </font><font style="vertical-align: inherit;">Zookeeper, Kafka-Operator, Envoy und viele andere Komponenten sind installiert und ordnungsgemäß konfiguriert, um den Kafka-Cluster für die Produktion in Kubernetes auszuführen.</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwenden Sie die </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">hier</font></a><font style="vertical-align: inherit;"> angegebenen Anweisungen, </font><font style="vertical-align: inherit;">um die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supertubes-CLI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu installieren </font><font style="vertical-align: inherit;">.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul></li>
</ul><br>
<img src="https://habrastorage.org/webt/98/xv/7i/98xv7iy-cxitdjo3xakipblgp5u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EKS-Cluster</font></font></h3><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bereiten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sie einen EKS-Cluster mit dedizierten </font><i><font style="vertical-align: inherit;">c5.4xlarge-</font></i><font style="vertical-align: inherit;"> Arbeitsknoten </font><font style="vertical-align: inherit;">in verschiedenen Verfügbarkeitszonen für Pods mit Kafka-Brokern sowie dedizierten Knoten für den Lastgenerator und die Überwachungsinfrastruktur vor.</font></font><br>
<br>
<pre><code class="bash hljs">banzai cluster create -f https://raw.githubusercontent.com/banzaicloud/kafka-operator/master/docs/benchmarks/infrastructure/cluster_eks_202001.json</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der EKS-Cluster betriebsbereit ist, aktivieren Sie seinen integrierten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überwachungsdienst.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prometheus und Grafana werden im Cluster bereitgestellt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kafka-Systemkomponenten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie die Kafka-Systemkomponenten (Zookeeper, Kafka-Operator) mithilfe der Supertubes-CLI in der EKS:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes install -a --no-democluster --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kafka Cluster</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Standardmäßig verwendet EKS </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBS- </font><i><font style="vertical-align: inherit;">Volumes. </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher müssen Sie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für den Kafka-Cluster </font><font style="vertical-align: inherit;">eine separate Speicherklasse erstellen, die auf </font><i><font style="vertical-align: inherit;">io1-</font></i><font style="vertical-align: inherit;"> Volumes basiert </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">kubectl create -f - &lt;&lt;EOF<font></font>
apiVersion: storage.k8s.io/v1<font></font>
kind: StorageClass<font></font>
metadata:<font></font>
  name: fast-ssd<font></font>
provisioner: kubernetes.io/aws-ebs<font></font>
parameters:<font></font>
  type: io1<font></font>
  iopsPerGB: "50"<font></font>
  fsType: ext4<font></font>
volumeBindingMode: WaitForFirstConsumer<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Legen Sie einen Parameter für Broker fest </font></font><code>min.insync.replicas=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und stellen Sie Broker-Pods auf Knoten in drei verschiedenen Verfügbarkeitszonen bereit:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f https://raw.githubusercontent.com/banzaicloud/kafka-operator/master/docs/benchmarks/infrastructure/kafka_202001_3brokers.yaml --<span class="hljs-built_in">wait</span> --timeout 600</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Themen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben gleichzeitig drei Instanzen des Lastgenerators gestartet. </font><font style="vertical-align: inherit;">Jeder von ihnen schreibt in einem eigenen Thema, das heißt, wir brauchen nur drei Themen:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
  name: perftest1<font></font>
spec:<font></font>
  name: perftest1<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF<font></font>
<font></font>
supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
    name: perftest2<font></font>
spec:<font></font>
  name: perftest2<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF<font></font>
<font></font>
supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
  name: perftest3<font></font>
spec:<font></font>
  name: perftest3<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für jedes Thema beträgt der Replikationsfaktor 3 - der empfohlene Mindestwert für hochverfügbare Produktionssysteme.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tool zur Lasterzeugung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben drei Instanzen des Lastgenerators gestartet (jede in einem separaten Thema geschrieben). </font><font style="vertical-align: inherit;">Für Pods des Lastgenerators müssen Sie die Knotenaffinität registrieren, damit sie nur auf den ihnen zugewiesenen Knoten geplant werden:</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: extensions/v1beta1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  labels:<font></font>
    app: loadtest<font></font>
  name: perf-load1<font></font>
  namespace: kafka<font></font>
spec:<font></font>
  progressDeadlineSeconds: 600<font></font>
  replicas: 1<font></font>
  revisionHistoryLimit: 10<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      app: loadtest<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      creationTimestamp: null<font></font>
      labels:<font></font>
        app: loadtest<font></font>
    spec:<font></font>
      affinity:<font></font>
        nodeAffinity:<font></font>
          requiredDuringSchedulingIgnoredDuringExecution:<font></font>
            nodeSelectorTerms:<font></font>
            - matchExpressions:<font></font>
              - key: nodepool.banzaicloud.io/name<font></font>
                operator: In<font></font>
                values:<font></font>
                - loadgen<font></font>
      containers:<font></font>
      - args:<font></font>
        - -brokers=kafka-0:29092,kafka-1:29092,kafka-2:29092,kafka-3:29092<font></font>
        - -topic=perftest1<font></font>
        - -required-acks=all<font></font>
        - -message-size=512<font></font>
        - -workers=20<font></font>
        image: banzaicloud/perfload:0.1.0-blog<font></font>
        imagePullPolicy: Always<font></font>
        name: sangrenel<font></font>
        resources:<font></font>
          limits:<font></font>
            cpu: 2<font></font>
            memory: 1Gi<font></font>
          requests:<font></font>
            cpu: 2<font></font>
            memory: 1Gi<font></font>
        terminationMessagePath: /dev/termination-log<font></font>
        terminationMessagePolicy: File<font></font>
      dnsPolicy: ClusterFirst<font></font>
      restartPolicy: Always<font></font>
      schedulerName: default-scheduler<font></font>
      securityContext: {}<font></font>
      terminationGracePeriodSeconds: 30</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einige Punkte, die Sie beachten sollten:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Lastgenerator generiert 512-Byte-Nachrichten und veröffentlicht diese in Stapeln von 500 Nachrichten an Kafka.</font></font></li>
<li>    <code>-required-acks=all</code>   ,          Kafka.  ,          ,  ,    ,  .           <i>(consumers)</i>   ,       ,       ,   .</li>
<li>     20 worker' (<code>-workers=20</code>).  worker  5 producer',     worker'   Kafka.      100 producer',        Kafka.</li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clusterüberwachung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während der Stresstests des Kafka-Clusters haben wir auch dessen Zustand überwacht, um sicherzustellen, dass keine Pod-Neustarts, nicht synchronen Replikate und maximaler Durchsatz bei minimalen Schwankungen aufgetreten sind:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Lastgenerator schreibt Standardstatistiken über die Anzahl der veröffentlichten Nachrichten und die Fehlerquote. </font><font style="vertical-align: inherit;">Der Prozentsatz der Fehler sollte im Wert bleiben </font></font><code>0,00%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vom kafka-operator bereitgestellte Geschwindigkeitsregelung bietet ein Dashboard, auf dem wir auch den Status des Clusters überwachen können. </font><font style="vertical-align: inherit;">Gehen Sie wie folgt vor, um dieses Fenster anzuzeigen:</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster cruisecontrol show -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ISR-Stufe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Anzahl der synchronen Replikate) für</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verkleinerung und Erweiterung beträgt 0.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Messergebnisse</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 Broker, Nachrichtengröße - 512 Bytes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit gleichmäßig auf drei Broker verteilten Partitionen konnten wir eine Leistung von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ 500 Mbit / s (ca. 990.000 Nachrichten pro Sekunde)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erzielen </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/5s/kk/ql5skk9eq59vw1dxiptnpv5baoo.png"><br>
<br>
<img src="https://habrastorage.org/webt/ye/cg/rc/yecgrcrh-mrdchebbysisw4mg3a.png"><br>
<br>
<img src="https://habrastorage.org/webt/5i/t6/it/5it6itlq4hfnndz2f-refjm1sbq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Speicherverbrauch der virtuellen JVM-Maschine überschritt 2 GB nicht: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pc/_s/-f/pc_s-fapugnsmx114p1rssgst8m.png"><br>
<br>
<img src="https://habrastorage.org/webt/2e/1-/qw/2e1-qwc0rb2fqk_bw_hkgr0jbl8.png"><br>
<br>
<img src="https://habrastorage.org/webt/m-/tr/nw/m-trnwodxrqpftqhnrnp35f25cy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Festplattenbandbreite erreichte die maximale E / A-Bandbreite Der Knoten in allen drei Instanzen, an denen die Broker gearbeitet haben: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/tx/tg/trtxtgaqntrbc_bwrxmxmxh9opu.png"><br>
<br>
<img src="https://habrastorage.org/webt/_k/ns/dh/_knsdhmjkkc2245qffym_pnkxge.png"><br>
<br>
<img src="https://habrastorage.org/webt/rq/xo/8x/rqxo8xwg5dualnt3uqt2jxmfeta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus den Daten zur Speichernutzung durch die Knoten folgt, dass das Puffern und Zwischenspeichern des Systems ~ 10-15 GB dauerte:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p3/ls/r6/p3lsr6ixa3wx0zfeowuqo_qlpq0.png"><br>
<br>
<img src="https://habrastorage.org/webt/aq/tn/fd/aqtnfdsjnp33e3buy5dxkrvojg4.png"><br>
<br>
<img src="https://habrastorage.org/webt/pi/aa/iv/piaaivarggmqsqiopmtx_doi4tg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 Broker, Nachrichtengröße - 100 Bytes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit einer Verringerung der Nachrichtengröße verringert sich der Durchsatz um etwa 15 bis 20%: Die für die Verarbeitung jeder Nachricht aufgewendete Zeit ist betroffen. </font><font style="vertical-align: inherit;">Außerdem hat sich die Prozessorlast fast verdoppelt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mp/9l/9l/mp9l9lcmuwuh866dce_v0puzrt0.png"><br>
<br>
<img src="https://habrastorage.org/webt/z0/ck/hd/z0ckhdrst6iqql9i5drcksb7y7i.png"><br>
<br>
<img src="https://habrastorage.org/webt/hu/dg/dp/hudgdpo3e8s0ft0zxd7tngwne3y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da Brokerknoten noch nicht verwendete Kernel haben, können Sie die Leistung verbessern, indem Sie die Konfiguration von Kafka ändern. </font><font style="vertical-align: inherit;">Dies ist keine leichte Aufgabe. Um den Durchsatz zu erhöhen, ist es daher besser, mit größeren Nachrichten zu arbeiten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 Broker, Nachrichtengröße - 512 Bytes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können die Leistung des Kafka-Clusters problemlos steigern, indem Sie einfach neue Broker hinzufügen und das Gleichgewicht der Partitionen beibehalten (dies gewährleistet eine gleichmäßige Lastverteilung zwischen den Brokern). </font><font style="vertical-align: inherit;">In unserem Fall stieg der Cluster-Durchsatz nach dem Hinzufügen eines Brokers auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ 580 Mbit / s (~ 1,1 Millionen Nachrichten pro Sekunde)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Das Wachstum erwies sich als geringer als erwartet: Dies ist hauptsächlich auf das Ungleichgewicht der Partitionen zurückzuführen (nicht alle Broker arbeiten auf dem Höhepunkt der Chancen). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8x/cs/nq/8xcsnqeafi6tom_rxrbb5jz1zmk.png"><br>
<br>
<img src="https://habrastorage.org/webt/_2/qm/2j/_2qm2jqmcig_qwnypgirtzwcnw0.png"><br>
<br>
<img src="https://habrastorage.org/webt/zn/vx/jm/znvxjmy9hpxm3c29l-x616hfyfa.png"><br>
<br>
<img src="https://habrastorage.org/webt/gm/mt/sc/gmmtscxckvpwqr3ypzmkz45jscu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Speicherverbrauch des JVM-Computers bleibt unter 2 GB: Das </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/w7/qh/a7w7qh73p6ug6ozgqksh224fanc.png"><br>
<br>
<img src="https://habrastorage.org/webt/pe/cn/gs/pecngsl4nhacfu1drnmevl3p96q.png"><br>
<br>
<img src="https://habrastorage.org/webt/ee/vh/ei/eevheiyiaf_sxnw8epxlsnizxak.png"><br>
<br>
<img src="https://habrastorage.org/webt/lz/gj/lb/lzgjlblbytxjujal32u1nmgjixo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Partitionsungleichgewicht hat den Betrieb von Brokern mit Laufwerken beeinträchtigt:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4w/ga/3j/4wga3j3ogq8d_pesoite7ln9alk.png"><br>
<br>
<img src="https://habrastorage.org/webt/jb/sh/rl/jbshrlplduwv4xrnfdhab65auy8.png"><br>
<br>
<img src="https://habrastorage.org/webt/3r/dw/ox/3rdwox-qntdekifec-vuoooozuc.png"><br>
<br>
<img src="https://habrastorage.org/webt/oz/ux/cd/ozuxcdtsqz-rfgwmun8iljtgxcq.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der oben vorgestellte iterative Ansatz kann erweitert werden, um komplexere Szenarien abzudecken, einschließlich Hunderten von Verbrauchern, Neupartitionierung, fortlaufenden Aktualisierungen, Pod-Neustarts usw. All dies ermöglicht es uns, die Grenzen der Fähigkeiten des Kafka-Clusters unter verschiedenen Bedingungen zu bewerten, Engpässe in seiner Arbeit zu identifizieren und Wege zu finden, um mit ihnen umzugehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben Supertubes entwickelt, um einen Cluster schnell und einfach bereitzustellen, zu konfigurieren, Broker und Themen hinzuzufügen / zu entfernen, auf Warnungen zu reagieren und sicherzustellen, dass Kafka in Kubernetes insgesamt ordnungsgemäß funktioniert. Unser Ziel ist es, uns auf die Hauptaufgabe zu konzentrieren (Kafka-Nachrichten zu „generieren“ und zu „konsumieren“) und dem Bediener die ganze harte Arbeit für Supertubes und Kafka zur Verfügung zu stellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie an Banzai Cloud-Technologien und Open Source-Projekten interessiert sind, abonnieren Sie das Unternehmen auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinkedIn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS vom Übersetzer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lesen Sie auch in unserem Blog:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Geschichte mit dem Redis-Betreiber in K8s und eine kleine Übersicht der Dienstprogramme zur Analyse von Daten aus dieser Datenbank</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ungehinderte RabbitMQ-Migration zu Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zetcd von CoreOS: Ersetzen von ZooKeeper durch ... Speicher usw.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488908/index.html">KPI-Texter oder Merkmale der Bewertung der Arbeit von Remote-Autoren an Mitarbeitern und Freiberuflern</a></li>
<li><a href="../de488910/index.html">Das Buch „Liebe und Mathematik. Das Herz der verborgenen Realität</a></li>
<li><a href="../de488912/index.html">Python News Bitcoin Preisvorhersage</a></li>
<li><a href="../de488916/index.html">Cascadeur: Das Problem der fallenden Katze</a></li>
<li><a href="../de488918/index.html">Data Engineer oder sterben: eine einzelne Entwicklergeschichte</a></li>
<li><a href="../de488926/index.html">5 kostenlose Kurse für Microsoft AI Engineers</a></li>
<li><a href="../de488946/index.html">Python-Konsolenmenü</a></li>
<li><a href="../de488948/index.html">UPD. Testen der REST-API auf Golang. 120 000 [# / sec] ist nicht die Grenze?</a></li>
<li><a href="../de488950/index.html">Zeit in einer zellularen Maschine</a></li>
<li><a href="../de488952/index.html">Phrasen-Stimmungsanalyse unter Verwendung neuronaler Netze</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>