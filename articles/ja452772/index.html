<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥝 🤵🏽 👌 Goの5つの高度なテスト手法 🤦🏼 🧑🏿 🗃️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みんなに敬礼！「Golang Developer」コースの開始まであと1週間足らずで、このトピックに関する有用な資料を引き続き共有しています。行こう！
 
 
 
 Goには、テスト用の優れた信頼性の高い組み込みライブラリがあります。囲碁で書けば、あなたはすでにそれを知っています。この記事では、Go...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Goの5つの高度なテスト手法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/452772/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">みんなに敬礼！</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Golang Developer」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コースの開始まで</font><font style="vertical-align: inherit;">あと1週間足らずで、このトピックに関する有用な資料を引き続き共有しています。行こう！</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mi/ly/nj/milynjiemmrcxgeldshfcz383pa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goには、テスト用の優れた信頼性の高い組み込みライブラリがあります。囲碁で書けば、あなたはすでにそれを知っています。この記事では、Goを使用してテストスキルを向上させることができるいくつかの戦略について説明します。 Goで印象的なコードベースを作成した経験から、これらの戦略が実際に機能し、コードの操作にかかる時間と労力を節約できることがわかりました。</font></font><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストスイートを使用する</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この記事から役立つことを1つだけ学んだ場合は、テストスイートを使用する必要があります。この概念に精通していない人にとって、セットによるテストは、このインターフェイスの多くの実装で使用できる共通のインターフェイスをテストするテストを開発するプロセスです。以下に、いくつかの異なる実装を渡し</font></font><code>Thinger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それらを同じテストで実行する</font><font style="vertical-align: inherit;">方法を示し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Thinger <span class="hljs-keyword">interface</span> {<font></font>
    DoThing(input <span class="hljs-keyword">string</span>) (Result, error)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Suite tests all the functionality that Thingers should implement</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Suite</span><span class="hljs-params">(t *testing.T, impl Thinger)</span></span> {<font></font>
    res, _ := impl.DoThing(<span class="hljs-string">"thing"</span>)
    <span class="hljs-keyword">if</span> res != expected {<font></font>
        t.Fail(<span class="hljs-string">"unexpected result"</span>)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// TestOne tests the first implementation of Thinger</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestOne</span><span class="hljs-params">(t *testing.T)</span></span> {<font></font>
    one := one.NewOne()<font></font>
    Suite(t, one)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// TestOne tests another implementation of Thinger</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestTwo</span><span class="hljs-params">(t *testing.T)</span></span> {<font></font>
    two := two.NewTwo()<font></font>
    Suite(t, two)<font></font>
}<font></font>
	</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 幸運な読者は、この方法を使用するコードベースを扱ってきました。インターフェースをテストするために作成されたプラグインベースのシステムテストでよく使用されますが、このインターフェースのすべての実装で、動作の要件をどのように満たすかを理解するために使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチを使用すると、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">クラスPとNPの</font></a><font style="vertical-align: inherit;">平等の問題を解決するために、時間、日、さらには十分な時間を節約できる可能性があります</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。また、あるベースシステムを別のベースシステムに置き換える場合、追加のテストを（大量に）作成する必要がなくなり、このアプローチによってアプリケーションの動作が中断されることもありません。暗黙的に、テストされた領域の領域を定義するインターフェースを作成する必要があります。依存性注入を使用すると、パッケージ全体の実装に渡されるパッケージからセットをカスタマイズできます。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ここで</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
完全な例を見つけることができます</font><font style="vertical-align: inherit;">。この例は遠く離れていますが、一方のデータベースがリモートにあり、もう一方のデータベースがメモリ内にあると想像できます。</font><font style="vertical-align: inherit;">
この手法のもう1つの優れた例は、パッケージの標準ライブラリにあります</font><font style="vertical-align: inherit;">。これは、net.Connがインターフェイスを満たしていることを確認する手段を提供します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>golang.org/x/net/nettest</code><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェース汚染の回避</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Goでのテストについて話すことはできませんが、</font><b><font style="vertical-align: inherit;">インターフェース</font></b><font style="vertical-align: inherit;">について話すことはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターフェースは、私たちのテストの武器の中で最も強力なツールであるため、テストのコンテキストでは重要です。したがって、正しく使用する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージは多くの場合、開発者用のインターフェースをエクスポートします。これは、次の事実につながります</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。A）開発者は、パッケージを実装するための独自のモックを作成します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 B）パッケージは独自のモックをエクスポートします。</font></font><br>
<br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「インターフェースが大きくなるほど、抽象化が弱くなる」</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -Rob Pike、Go Talks</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 エクスポートする前に、インターフェイスを注意深くチェックする必要があります。多くの場合、ユーザーが必要な動作をシミュレートできるようにインターフェイスをエクスポートするのは魅力的です。代わりに、コンシューマーパッケージと独自のパッケージの間に強い依存関係を作成しないように、どのインターフェイスが構造に適しているかを文書化してください。この良い例は、</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージ</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エクスポートしたくないインターフェースがある場合は、</font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">内部/パッケージサブツリーを</font></a></i><font style="vertical-align: inherit;">使用できます &nbsp;</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージ内に保存します。したがって、エンドユーザーが彼に依存している可能性があることを恐れることはできません。したがって、新しい要件に応じてインターフェイスを柔軟に変更できます。通常、ローカルでテストを実行できるようにするために、外部依存関係を持つインターフェースを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチでは、ライブラリの一部をテスト用にラップするだけで、ユーザーは独自の小さなインターフェースを実装できます。この概念の詳細については</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、インターフェース汚染に関するrakylの記事を参照してください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
 <br>
 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同時実行プリミティブをエクスポートしない</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goは使いやすい並行処理プリミティブを提供しますが、同じ単純さのために、それらが過度に使用される場合もあります。まず最初に、チャンネルと同期パッケージについて心配しています。他のユーザーが使用できるように、パッケージからチャネルをエクスポートしたくなる場合があります。さらに、よくある間違いは</font></font><code>sync.Mutex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プライベートに設定せずに</font><font style="vertical-align: inherit;">埋め込む</font><font style="vertical-align: inherit;">ことです。これはいつものように常に悪いことではありませんが、プログラムをテストするときに特定の問題を引き起こします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チャンネルをエクスポートする場合、パッケージユーザーの生活をさらに複雑にするため、行う価値はありません。チャンネルがパッケージからエクスポートされるとすぐに、このチャンネルを使用するユーザーをテストするときに問題が発生します。テストを成功させるには、ユーザーは次のことを知っている必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データがチャネルを介して送信されることになったとき。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データの受信時にエラーが発生しました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全にフラッシュした場合、パケットは完了後にどのようにチャネルをフラッシュしますか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接呼び出さないようにパッケージAPIをラップする方法は？</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キューの読み取りの例を確認してください。</font><font style="vertical-align: inherit;">以下は、キューから読み取り、読み取り用のフィードをユーザーに提供するライブラリーの例です。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">struct</span> {...}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *Reader)</span> <span class="hljs-title">ReadChan</span><span class="hljs-params">()</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">Msg</span></span> {...}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 今、あなたの図書館のユーザーは彼の消費者のためにテストを実装したいです：</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestConsumer</span><span class="hljs-params">(t testing.T)</span></span> {<font></font>
    cons := &amp;Consumer{<font></font>
        r: libqueue.NewReader(),<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> msg := <span class="hljs-keyword">range</span> cons.r.ReadChan() {
        <span class="hljs-comment">// Test thing.</span><font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ユーザーは、依存関係の注入が適切であると判断し、チャネルに独自のメッセージを書き込むことができます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestConsumer</span><span class="hljs-params">(t testing.T, q queueIface)</span></span> {<font></font>
    cons := &amp;Consumer{<font></font>
        r: q,<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> msg := <span class="hljs-keyword">range</span> cons.r.ReadChan() {
        <span class="hljs-comment">// Test thing.</span><font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
待って、エラーはどうですか？</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestConsumer</span><span class="hljs-params">(t testing.T, q queueIface)</span></span> {<font></font>
    cons := &amp;Consumer{<font></font>
        r: q,<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">select</span> {
        <span class="hljs-keyword">case</span> msg := &lt;-cons.r.ReadChan():
            <span class="hljs-comment">// Test thing.</span>
        <span class="hljs-keyword">case</span> err := &lt;-cons.r.ErrChan():
            <span class="hljs-comment">// What caused this again?</span><font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、実際にこのスタブに書き込むために、イベントを生成する必要があります。これは、使用しているライブラリの動作を複製します。ライブラリが同期APIを作成しただけの場合、すべての並列処理をクライアントコードに追加できるため、テストが容易になります。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestConsumer</span><span class="hljs-params">(t testing.T, q queueIface)</span></span> {<font></font>
    cons := &amp;Consumer{<font></font>
        r: q,<font></font>
    }<font></font>
    msg, err := cons.r.ReadMsg()<font></font>
    <span class="hljs-comment">// handle err, test thing</span><font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
疑問がある場合は、コンシューマパッケージ（コンシューミングパッケージ）に常に並列処理を追加するのは簡単であり、ライブラリからエクスポートした後でそれを削除することは困難または不可能であることを覚えておいてください。そして最も重要なこととして、構造/パッケージが複数のゴルーチンへの同時アクセスに対して安全であるかどうかをパッケージのドキュメントに書くことを忘れないでください。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チャンネルをエクスポートすることが望ましい場合や必要な場合があります。上記の問題のいくつかを軽減するために、直接アクセスの代わりにアクセサを介してチャネルを提供し</font><font style="vertical-align: inherit;">、宣言時に</font><font style="vertical-align: inherit;">読み取り（</font></font><code>←chan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）または書き込み（</font></font><code>chan←</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">のみに</font><font style="vertical-align: inherit;">チャネルを開いたままにすることができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>net/http/httptest</code></b><br>
<br>
<code>Httptest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すると、実行</font><b><font style="vertical-align: inherit;">する</font></b><font style="vertical-align: inherit;">ことができます</font></font><code>http.Handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーを起動したり、ポートにバインドしたりせずにコードを記述します。これによりテストがスピードアップし、低コストで並行してテストを実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、2つの方法で実装された同じテストの例です。ここでは壮大なものは何もありませんが、このアプローチはコードの量を減らし、リソースを節約します。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestServe</span><span class="hljs-params">(t *testing.T)</span></span> {
    <span class="hljs-comment">// The method to use if you want to practice typing</span><font></font>
    s := &amp;http.Server{<font></font>
        Handler: http.HandlerFunc(ServeHTTP),<font></font>
    }<font></font>
    <span class="hljs-comment">// Pick port automatically for parallel tests and to avoid conflicts</span>
    l, err := net.Listen(<span class="hljs-string">"tcp"</span>, <span class="hljs-string">":0"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
        t.Fatal(err)<font></font>
    }<font></font>
    <span class="hljs-keyword">defer</span> l.Close()
    <span class="hljs-keyword">go</span> s.Serve(l)<font></font>
<font></font>
    res, err := http.Get(<span class="hljs-string">"http://"</span> + l.Addr().String() + <span class="hljs-string">"/?sloths=arecool"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
        log.Fatal(err)<font></font>
    }<font></font>
    greeting, err := ioutil.ReadAll(res.Body)<font></font>
    res.Body.Close()<font></font>
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
        log.Fatal(err)<font></font>
    }<font></font>
    fmt.Println(<span class="hljs-keyword">string</span>(greeting))<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestServeMemory</span><span class="hljs-params">(t *testing.T)</span></span> {
    <span class="hljs-comment">// Less verbose and more flexible way</span>
    req := httptest.NewRequest(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"http://example.com/?sloths=arecool"</span>, <span class="hljs-literal">nil</span>)<font></font>
    w := httptest.NewRecorder()<font></font>
<font></font>
    ServeHTTP(w, req)<font></font>
    greeting, err := ioutil.ReadAll(w.Body)<font></font>
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
        log.Fatal(err)<font></font>
    }<font></font>
    fmt.Println(<span class="hljs-keyword">string</span>(greeting))<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 おそらく最も重要な機能は、ヘルプ</font></font><code>httptest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、テストをテストする機能にのみ分割できることです。ルーター、ミドルウェア、またはサーバー、サービス、プロセッサフ​​ァクトリ、プロセッサフ​​ァクトリ、またはその他の考えられるものをセットアップするときに現れる副作用はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この原則の実際を確認するには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marc Bergerの記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をご覧ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のパッケージを使用する</font></font><code>_test</code></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
エコシステムのテストのほとんどはファイルにあります</font></font><code>pkg_test.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、同じパッケージに残っています：</font></font><code>package pkg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。別のテストパッケージは、新しいファイルに作成するパッケージです。</font></font><code>foo_test.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、テストするモジュールのディレクトリで</font></font><code>foo/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、宣言を使用し</font></font><code>package foo_test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。ここから、</font></font><code>github.com/example/foo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他の依存関係</font><font style="vertical-align: inherit;">をインポートできます</font><font style="vertical-align: inherit;">。この機能により、多くのことが可能になります。これは、テストにおける循環依存関係の推奨ソリューションであり、「脆弱なテスト」の出現を防ぎ、開発者が独自のパッケージを使用するのと同じように感じることができます。パッケージが使いにくい場合、この方法でのテストも困難になります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 この戦略は、プライベート変数へのアクセスを制限することにより、脆弱なテストを防ぎます。特に、テストが中断し、別のテストパッケージを使用する場合、テストで中断する関数を使用するクライアントも、呼び出されたときに中断することがほぼ保証されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、テストでインポートサイクルを回避するのに役立ちます。ほとんどのパッケージは、テストパッケージ以外に作成した他のパッケージに依存する可能性が高いため、インポートサイクルが自然に発生する状況になります。外部パッケージは、パッケージ階層の両方のパッケージの上にあります。 Goプログラミング言語（第11章2.4節）の例を取り上げます。この例では</font></font><code>net/url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>net/http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インポートして使用</font><font style="vertical-align: inherit;">するURLパーサーを実装しています</font><font style="vertical-align: inherit;">。ただし、</font></font><code>net / url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をインポートして、実際のユースケースを使用してテストする必要があります</font></font><code>net / http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。だから、それは判明し</font></font><code>net/url_test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、別のテストパッケージを使用する場合、以前に利用可能であったパッケージ内のエクスポートされていないエンティティにアクセスする必要がある場合があります。一部の開発者は、時間に基づいて何かをテストするときに初めてこれに直面します（たとえば、time.Nowは関数を使用してスタブになります）。この場合、ファイル</font></font><code>_test.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は通常のビルドから除外さ</font><font style="vertical-align: inherit;">れるため、追加のファイルを使用して、テスト中にのみエンティティを提供できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何を覚えておく必要がありますか？</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
上記の方法はいずれも万能薬ではないことを覚えておくことが重要です。どのビジネスでも最善のアプローチは、状況を批判的に分析し、問題に対する最適なソリューションを個別に選択することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goを使用したテストの詳細については、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 これらの記事を読んでください：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストに関するGo </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Goプログラミング言語の章の</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Dave Cheneyの書き込みテーブル駆動テスト</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">。</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または、これらのビデオ</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をご覧ください。Gophercon2017からの橋本のGoによる高度なテストの</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トーク2014年からAndrew Gerrandのテストテクニックのトーク</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この翻訳がお役に立てば幸いです。</font><font style="vertical-align: inherit;">コメントをお待ちしております。コースについて詳しく知りたい方は、</font><font style="vertical-align: inherit;">5月23日に開催される</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンデー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">ぜひご参加ください</font><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja452760/index.html">ビタミンD。飲むか飲まないか、それが問題です。（または、私が処方されていない分析にどのように合格したかについての物語）</a></li>
<li><a href="../ja452762/index.html">MVCC-7。自動洗浄</a></li>
<li><a href="../ja452764/index.html">[ピーター]セルゲイメルニコフとJUG.ruとの出会い-超光速のプロファイリング：理論と実践</a></li>
<li><a href="../ja452766/index.html">プログレッシブストリーミングテクノロジー、またはフリーズなしでネットワーク経由で4kビデオを視聴する方法</a></li>
<li><a href="../ja452768/index.html">海外進出を決意した場合の商品デザイン</a></li>
<li><a href="../ja452774/index.html">Dell XPS 13 9380：本格的なビジネス向けの信頼性が高く非常にコンパクトなノートパソコン</a></li>
<li><a href="../ja452776/index.html">N.M.D. （それは私の仕事ではありません）</a></li>
<li><a href="../ja452778/index.html">ClickHouseでLZ4のアンロードを高速化する方法</a></li>
<li><a href="../ja452780/index.html">Mobius 2019 Piter：無料のライブストリーミングとその他すべて</a></li>
<li><a href="../ja452788/index.html">Webアプリケーション、うつ病、ドラゴン、Westerosにおける品質の闘い</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>