<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍎 🧑🏽‍🤝‍🧑🏽 🧖🏾 スタンドオフ：現状 🆗 👨🏻‍💻 🌍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは！PHDays 9のディフェンダーのランクでThe Standoffで起こっていることに十分な関心を見て、Jet CSIRTの一部として、Jet CSIRTの目を通して準備と「スタンドオフ」がどのように行われたかについて話し合うことにしました。
 
 郭スタンドオフ、私は作成しました
 こ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>スタンドオフ：現状</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/454298/"><img src="https://habrastorage.org/webt/ef/tx/b3/eftxb30vyae7fr5w6xkios-nl9q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんにちは！</font><font style="vertical-align: inherit;">PHDays 9のディフェンダーのランクでThe Standoffで起こっていることに十分な関心を見て、Jet CSIRTの一部として、Jet CSIRTの目を通して準備と「スタンドオフ」がどのように行われたかについて話し合うことにしました。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">郭スタンドオフ、私は作成しました</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような何かは、私たちが再びスタンドオフに参加していたと同僚が報告し、私たちは自然に同意しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今年のディフェンダーにとっては、コンテストの形式が少し変わったことをすぐに言及する価値があります。すべてのチームが非常に類似したオフィスインフラストラクチャを受け取り、これにより主催者は特定のオウムの防御者の評価を入力することができました。そして、Jet Security Teamにとって、これは産業インフラではなくオフィスが保護された最初の「対立」でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4月の最後の日にサイバー戦に備えるためのインフラストラクチャにアクセスできました。インフラストラクチャの監査後、欠陥のワゴン全体が組み立てられました。ここにそれらのほんの一部を示します。インフラストラクチャ全体で、関連するパッチはありませんでした。すべてのユーザーのパスワードは、Ntds.ditを介してクリアテキストで取得できます。さらに、一部のユーザーはTOP-500リストのパスワード、または簡単に元に戻せるハッシュを使用したパスワードを持っています。システムの強化は、ほとんどまたはまったくありませんでした。 DMZ内の一部のホストには、サーバーサブネット内にインターフェイスがありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
監査の結果に基づいて、特定のセキュリティ対策を開発し、主催者は事前の承認を受けて、必要なポリシーを適用し、仮想環境に展開できるセキュリティツールやツールを提供できるようにしました。締め切りが厳しかったため、保護対策に関するいくつかのアイデアが最初から失敗しました。 SPIの主な設定とプロファイリングは5月の休暇中に行われ（ピクニックから写真を投げてくれた皆さん、こんにちは。私たちもあなたを愛しています）、いくつかの保護具は、サイトの開始直前に調整する必要がありました。また、多くのサービスはパッチを適用して強く再構成することが禁止されていました。たとえば、これらの1つはOracle Weblogicで、CVE-2019-2725があり、2019年5月のごく初期にリリースされたPoCでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、私たちが持ってきたもののリストは次のとおりです。</font></font><br>
<br>
<ul>
<li>  (   );</li>
<li> ;</li>
<li>WAF;</li>
<li>EDR;</li>
<li> deception-;</li>
<li>  ;</li>
<li>ELK-    Netflow;</li>
<li>SIEM.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SIEMに何が起こったかについても話し合う必要があります。</font><font style="vertical-align: inherit;">イベントのソースとして、Windowsログ、Sysmon、Auditdログ、そしてご想像のとおり、SZI自体からのイベントを自由に利用できました。</font><font style="vertical-align: inherit;">最初の2つに特別な問題がなく、Sysmonのポリシーと構成の変更にすばやく同意した場合、Auditd構成のオーガナイザーと取り組む必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これと並行して、主要な攻撃ベクトルを特定し、これに基づいて、関連するシナリオと相関ルール（合計約160の相関ルール）を選択して適用しました。</font><font style="vertical-align: inherit;">さらに、重要なノード、SZI、およびゲームインフラストラクチャで特別な注意が必要なもののために、一連の雑多なダッシュボードが組み立てられました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタンドオフ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Standoffについては、外部からWebを積極的にクロールして操作しようとすることを明確に理解していたため、インシデントを外部と内部に分割するという概念に従うことにしました。スキャンに関連するインシデントとWAFを回避する試みは個別に監視され、優先度は低くなったため、内部のインシデントに集中することができました。 SPIのダッシュボードは、責任のある領域で防御側の間で配布され、ローテーションと休憩の可能性のために、少なくとも2人が各ツールに割り当てられました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
予想通り、すべてが起こった。対立は午前10時頃に始まり、開始が行われるやいなや、SIEMシステムは外部スキャンに関連する一連のインシデントと攻撃者によるWebの悪用の試みを提供し始めました。場合によっては、グループでさえ保存しませんでした。同時に、主催者のチェッカーが働き始め、オフィス内のさまざまなサービスのステータスをチェックしたため、プロファイリングを実行して、関連する誤報を遮断する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームの最初の数時間で、Hack.ERSチームはいずれかのリソースのCMSで管理者（admin / admin）から標準の資格情報を見つけ、LFIの潜在的な脆弱性を検出しました。これらの試みは見過ごされず、防御側は作戦対応を行い、最終的に攻撃者はこれ以上前進できませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームの初日が終わるまで、方法は変更されず、WAFは会社のWebサイトに興味深いものをアップロードするすべての試みを打ち破り、同じ「外部アドレス」を停止することなくリソースをスキャンしようとしました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k4/h2/je/k4h2jeeackujcdpdfydy2ci7i7s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イベント全体では、インシデント内のイベントのグループ化を考慮せずに、スキャン試行に関連する3000のインシデントが記録されました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eo/c0/j-/eoc0j-v5ohyz-kbja5goxy9vzsi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、インシデント内のイベントのグループ化を考慮せずに、WAFを回避しようとする約2500のインシデント。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
夜に向けて、すべての活動の強度は減少しました—これにはいくつかの理由がありました。一部のディフェンダーとアタッカーは、翌日開催されるはずだったコンサートのサウンドチェックとリハーサルに抵抗できなかった。一部の攻撃チームは、ディフェンダーとモニタリングのモニタリングリソースと疲労が減ることを期待して、休憩を取って午前中に攻撃を続けることを決定しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2日目の朝、攻撃者は戦術を変更しました。従業員の一部に関する情報は、会社のWebサイトの1つに投稿されました。ハッカーはこの情報を利用して、Exchangeを通じてユーザーアカウントを積極的に収集し始めました（スクリーンショットの試行の統計）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/pp/z0/udppz0drbdk_woprerkpwz3xgos.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し後、VPNゲートウェイでパスワードを選択するための安全ではない試みが行われ、インフラストラクチャにないアカウントがブルートグループに参加しました。攻撃者は、主催者がどこにでも同じままにしておくことを期待して、すでにハッキングされたインフラストラクチャのアカウントを使用しようとしました。その結果、ブルートフォースでの全体的な状況により、ユーザー認証の傾向に関するダッシュボードのグループが作成されました。さらに、ブルートフォースの成功に関連するインシデントの監視を強化しましたが、幸い、そのようなケースは検出されませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームの終了の約1時間前に、Exchangeを含む複数のユーザーを認証する単一の成功した試みが傾向に気づきました、運用分析は、ソースが直接ユーザーマシンであることを示し、イベントのほとんどは、オーガナイザーがVMwareコンソールからログインしたことを示しましたVcenter。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、VPN経由で正常に接続されたノードからの内部スキャンを記録しました。インシデントに関連するイベントの運用分析の結果、攻撃者が複数のユーザーの資格情報を侵害できることが明らかになり、失敗した認証試行がないことから判断すると、ユーザーデータが「漏洩」した可能性が非常に高いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
情報は防御側に渡されました。侵害されたユーザーのパーソナルコンピューターの応答時間全体を通じて、エンドポイントソリューションが予防保護モードになり、システムの足掛かりを獲得する能力が低下しました。 VPNゲートウェイ上の攻撃者のセッションは強制的に切断され、攻撃者は保護された境界から追い出されました。侵害されたUZでは、パスワードが即座に変更されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その瞬間、True0xA3チームのメンバーがステージに上がり、OSINTをうまく使用し、別のチームの保護下にあるBehealthyオフィスの侵害を報告しました。攻撃者はなんとかドメイン管理者を危険にさらしました。主催者は私たちの事件について通知され、証拠が提供されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の1時間は、突然のOSINTにより特に暑かったため、主催者からの準備がさらに進むのを皆が待っていました。</font><font style="vertical-align: inherit;">次に、監視チームはすべての疑わしい異常とインシデントを監視しましたが、新しいハッキングの試みに侵入しようとして失敗した後は、追跡できませんでした。</font><font style="vertical-align: inherit;">したがって、プレイ時間の最後の数分が過ぎ、Jet Security Teamによって保護されたオフィスのハッキングの成功は起こりませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、2日間のゲームの最終的な統計：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平均で1200 EPS、ピーク時は3000 EPS弱。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">約7000件のインシデント。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1億2,000万以上のイベント。</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちの勝利を助けた要因</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">役割の適切な配分。</font><font style="vertical-align: inherit;">それぞれがセットアップし、彼が日々のプロジェクトで行っていることのほとんどに従事していました。</font><font style="vertical-align: inherit;">「ダミーのファイアウォール」のカテゴリの資料を研究する必要はありませんでした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相関ルールの運用プロファイリング。</font><font style="vertical-align: inherit;">すべての誤検知が処理され、ゲームインフラストラクチャの機能に関連する修正が行われました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迅速な対応。</font><font style="vertical-align: inherit;">各タイプのSZIとシステムには数人が割り当てられているため、担当者が休憩したり、数分間立ち去ったりしても問題はありませんでした。</font><font style="vertical-align: inherit;">モニタリングからのすべての情報は、可能な限り迅速に処理されました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまなインフラストラクチャの強化とモニタリングの経験。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS来て質問してくださったすべての人に感謝します。プロセスで何かを伝えることができなかった人には謝罪します-チームは攻撃者からの「取り違えられたコサック」を待っていて、すべての詳細を開示できませんでした。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Center for Information Security Incidents Jet CSIRTのエキスパートであるDmitry Lifanov氏</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja454280/index.html">VS Codeでのリモート開発：あなたの人生は決して同じにはなりません</a></li>
<li><a href="../ja454284/index.html">すみません、冬なので出勤しません</a></li>
<li><a href="../ja454290/index.html">単一の責任原則。思ったほど単純ではない</a></li>
<li><a href="../ja454292/index.html">JS プロキシ。知っておくべき落とし穴</a></li>
<li><a href="../ja454294/index.html">「不要な実験なし」、つまり銀行アクセラレーターをどのように立ち上げたか</a></li>
<li><a href="../ja454300/index.html">CTTが従来のヒートパイプとどのように異なり、どのように適用するか</a></li>
<li><a href="../ja454302/index.html">QVDファイル-内容</a></li>
<li><a href="../ja454304/index.html">セラミック用の日曜大工のDelta 3Dプリンター</a></li>
<li><a href="../ja454306/index.html">私がリード開発者として犯した5つの間違い</a></li>
<li><a href="../ja454308/index.html">Habr。V.9.0のAMA。ポッドキャスト、会議、コンセプト</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>