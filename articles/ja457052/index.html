<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ğŸ¼ ğŸ§ ğŸ—ï¸ æœˆé¡100ãƒ‰ãƒ«ã§Webåˆ†æã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’è¨­å®šã™ã‚‹æ–¹æ³• â™€ï¸ ğŸ‘©ğŸ¼â€âš•ï¸ â†”ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="é…ã‹ã‚Œæ—©ã‹ã‚Œã€ã»ã¨ã‚“ã©ã™ã¹ã¦ã®ä¼æ¥­ãŒWebåˆ†æã®é–‹ç™ºã¨ã„ã†å•é¡Œã«ç›´é¢ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€Google Analyticsã‚³ãƒ¼ãƒ‰ã‚’ã‚µã‚¤ãƒˆã«é…ç½®ã™ã‚‹ã ã‘ã§ã‚ˆã„ã¨ã„ã†æ„å‘³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ¡ãƒªãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æŠ•ç¨¿ã§ã¯ã€ï¼ˆå°‚é–€ã‚µãƒ¼ãƒ“ã‚¹ã®åŸºæº–ã§ï¼‰ã»ã¨ã‚“ã©ãŠé‡‘ã‚’ã‹ã‘ãšã«ã€å¯èƒ½ãª...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>æœˆé¡100ãƒ‰ãƒ«ã§Webåˆ†æã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’è¨­å®šã™ã‚‹æ–¹æ³•</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/idfinance/blog/457052/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é…ã‹ã‚Œæ—©ã‹ã‚Œã€ã»ã¨ã‚“ã©ã™ã¹ã¦ã®ä¼æ¥­ãŒWebåˆ†æã®é–‹ç™ºã¨ã„ã†å•é¡Œã«ç›´é¢ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€Google Analyticsã‚³ãƒ¼ãƒ‰ã‚’ã‚µã‚¤ãƒˆã«é…ç½®ã™ã‚‹ã ã‘ã§ã‚ˆã„ã¨ã„ã†æ„å‘³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ¡ãƒªãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®æŠ•ç¨¿ã§ã¯ã€ï¼ˆå°‚é–€ã‚µãƒ¼ãƒ“ã‚¹ã®åŸºæº–ã§ï¼‰ã»ã¨ã‚“ã©ãŠé‡‘ã‚’ã‹ã‘ãšã«ã€å¯èƒ½ãªé™ã‚ŠåŠ¹ç‡çš„ã«ãã‚Œã‚’è¡Œã†æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/nl/6k/qqnl6k_u6nzumajp_x5ydgyyjo8.jpeg" alt="ç”»åƒ"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®åå‰ã¯Andrey Kolesnichenkoã§ã™ã€‚ç§ã¯ãƒ•ã‚£ãƒ³ãƒ†ãƒƒã‚¯ä¼æ¥­ID Financeã®Webåˆ†æéƒ¨é–€ã®è²¬ä»»è€…ã§ã™ã€‚ä¼šç¤¾ã§ã¯ã€å¸¸ã«å¤šãã®æŒ‡æ¨™ã‚’å¸¸ã«ç›£è¦–ã—ã¦ã„ã¾ã™ã€‚ã¾ãšã€ã•ã¾ã–ã¾ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã®ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒé‡è¦ã§ã™ã€‚å½“åˆã€ã™ã¹ã¦ã®ãƒ¬ãƒãƒ¼ãƒˆã¯Google Analyticså°‚ç”¨ã§ã—ãŸã€‚ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–ã—ã€å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ã‚·ã‚§ã‚¢ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€Googleãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã®ãƒ¬ãƒãƒ¼ãƒˆã«ç§»ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã¤ã„ã¦ã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥å‰ãƒãƒ–ãƒ¬ã§æ›¸ãã¾ã—ãŸ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¾åœ¨ã€ç§ãŸã¡ã¯æ¬¡ã®æ®µéšã«ã„ã¾ã™-ã™ã¹ã¦ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ç”Ÿãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã‚‰ã¯ã™ã¹ã¦ã®ã‚¢ãƒŠãƒªã‚¹ãƒˆã«ã¨ã£ã¦é‡è¦ã§ã™ã€‚Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®é›†è¨ˆãƒ¬ãƒãƒ¼ãƒˆã‚’æ“ä½œã™ã‚‹ã¨ã€ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®å“è³ªã«å¤§ããªå½±éŸ¿ã‚’ä¸ãˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•ã‚’æ·±ãç†è§£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚’æ”¯æ‰•ã†ã“ã¨ãŒã§ãã¾ã™ã€‚è²»ç”¨ã¯å¹´é–“æ•°ç™¾ä¸‡ãƒ«ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®å ´åˆã€BigQueryã§ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡è£½ã—ã¦BigQueryã«å…¥ã‚Œã‚‹ã•ã¾ã–ã¾ãªã‚µãƒ¼ãƒ“ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€ãã‚Œã‚’è‡ªåˆ†ã§è¡Œã†ã“ã¨ãŒã§ãã€ã‚ˆã‚Šå®‰ä¾¡ãªæ–¹æ³•ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">å§‹ã‚ã¾ã—ã‚‡ã†ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æº–å‚™</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã§ã«ã‚µã‚¤ãƒˆãŒã‚ã‚Šã€Google Analyticsã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã«ã€ç”Ÿãƒ‡ãƒ¼ã‚¿ã®åé›†ã‚’é–‹å§‹ã™ã‚‹ãŸã‚ã«å°ã•ãªå¤‰æ›´ã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¸»ãªã‚¢ã‚¤ãƒ‡ã‚¢ã¯ã€Googleã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’é€ä¿¡ã—ã¦ã‹ã‚‰ã€ã“ã‚Œã‚‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ãšã€Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§3ã¤ã®æ–°ã—ã„ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0i/sa/iv/0isaivr_aaz6lo5e_dbsgwfxysa.png" alt="ç”»åƒ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã‚‰ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã€Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‹ã‚‰ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClientID-ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥å­</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SessionID-ã‚»ãƒƒã‚·ãƒ§ãƒ³è­˜åˆ¥å­</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HitID-ãƒ’ãƒƒãƒˆID</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã«é€ä¿¡ã•ã‚Œã‚‹ã™ã¹ã¦ã®ãƒ’ãƒƒãƒˆã«ã“ã‚Œã‚‰ã®å¤‰æ•°ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">ga(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tracker</span>) </span>{
            <span class="hljs-keyword">var</span> clientId = tracker.get(<span class="hljs-string">'clientId'</span>);
            <span class="hljs-keyword">var</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();<font></font>
<font></font>
            ga(<span class="hljs-string">'set'</span>, <span class="hljs-string">'dimension1'</span>, clientId);<font></font>
            ga(<span class="hljs-string">'set'</span>, <span class="hljs-string">'dimension2'</span>, clientId + <span class="hljs-string">'_'</span> + timestamp);<font></font>
            ga(<span class="hljs-string">'set'</span>, <span class="hljs-string">'dimension3'</span>, clientId + <span class="hljs-string">'_'</span> + timestamp);<font></font>
        });<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å„ãƒ’ãƒƒãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ãã€dimension2ã¨dimension3ã‚’å†ç”Ÿæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">Dimension3ã¯ãƒ’ãƒƒãƒˆIDã§ã‚ã‚‹ãŸã‚ã€ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">GTMã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹åŸç†ã¯åŒã˜ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ClientIDã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ™ãƒ«ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å€‹äººã‚’ä¸€æ„ã«è­˜åˆ¥ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">SessionIDã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã§è¨­å®šã•ã‚Œã€ãã‚Œã«å¾“ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ±ºå®šã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¯å›ç•°ãªã‚‹SessionIDã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã«æ°—ã¥ãã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€Googleã¯æœ€å¾Œã®å€¤ã‚’1ã¤ã ã‘ä¿æŒã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®å€¤ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ±ºå®šã—ã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¤ãƒ³ãƒ•ãƒ©</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’è¨­å®šã—ãŸå¾Œã€ç”Ÿãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ </font></font><br>
<br>
<ol>
<li>     Google BigQuery.         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Google Cloud Platform</a>.       BigQuery,          API. ,     Google Cloud,     300$   .           .</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">console.cloud.google.com/iam-admin/serviceaccounts</a>    ,      API Google Analytics  Google BigQuery. </li>
<li>        Google Analytics.</li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">console.cloud.google.com/apis/library/analytics.googleapis.comã«</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»å‹•ã—</font><font style="vertical-align: inherit;">ã€Google Analytics APIã‚’æœ‰åŠ¹ã«ã—ã¾ã™</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯æ—¥ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã€ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ãŒå¿…è¦ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãŸã‚ã€Google Compute Engineã‚’ä½¿ç”¨ã—ã¾ã™</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8f/xa/6x/8fxa6xlxq0zogqannrk5ytifwni.png" alt="ç”»åƒ"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Analytics APIã‚’ä»‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Analyticsã«ã¯ã€ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹APIãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã™ã¹ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯pythonã§è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸»ãªã‚‚ã®ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">from</span> apiclient.discovery <span class="hljs-keyword">import</span> build
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> unicodecsv <span class="hljs-keyword">as</span> csv
<span class="hljs-keyword">from</span> googleapiclient.errors <span class="hljs-keyword">import</span> HttpError
<span class="hljs-keyword">import</span> time<font></font>
SCOPES = [<span class="hljs-string">'https://www.googleapis.com/auth/analytics.readonly'</span>]<font></font>
KEY_FILE_LOCATION = <span class="hljs-string">'my_key_file.p12'</span>
SERVICE_ACCOUNT_EMAIL = <span class="hljs-string">'service_account_email@my-google-cloud-project.iam.gserviceaccount.com'</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiGA</span>():
    
    <span class="hljs-title">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-title">self</span>, <span class="hljs-title">scopes</span></span>=SCOPES, <font></font>
                 key_file_location=KEY_FILE_LOCATION, <font></font>
                 service_account_email=SERVICE_ACCOUNT_EMAIL, <font></font>
                 version=<span class="hljs-string">'v4'</span>):<font></font>
        credentials = ServiceAccountCredentials.from_p12_keyfile(<font></font>
                service_account_email, key_file_location, scopes=scopes)<font></font>
        self.handler = build(<span class="hljs-string">'analytics'</span>, version, credentials=credentials)<font></font>
        <font></font>
    <font></font>
    def downloadReport(self, view_id, dim_list, metrics_list, date, page, end_date=None, filters=None):<font></font>
        <span class="hljs-keyword">if</span> not end_date:<font></font>
            end_date = date<font></font>
        body = {<font></font>
                <span class="hljs-string">'reportRequests'</span>: [<font></font>
        {<font></font>
          <span class="hljs-string">'viewId'</span>: view_id,
          <span class="hljs-string">'dateRanges'</span>: [{<span class="hljs-string">'startDate'</span>: date, <span class="hljs-string">'endDate'</span>: end_date}],
          <span class="hljs-string">'dimensions'</span>: dim_list,
          <span class="hljs-string">'metrics'</span>: metrics_list,
          <span class="hljs-string">'includeEmptyRows'</span>: True,
          <span class="hljs-string">'pageSize'</span>: <span class="hljs-number">10000</span>,
          <span class="hljs-string">'samplingLevel'</span>: <span class="hljs-string">'LARGE'</span><font></font>
        }]}<font></font>
        <span class="hljs-keyword">if</span> page:<font></font>
            body[<span class="hljs-string">'reportRequests'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'pageToken'</span>] = page        
        <span class="hljs-keyword">if</span> filters:<font></font>
            body[<span class="hljs-string">'reportRequests'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'filtersExpression'</span>] = filters
        <span class="hljs-keyword">while</span> True:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">return</span> self.handler.reports().batchGet(body=body).execute()<font></font>
            except HttpError:<font></font>
                time.sleep(<span class="hljs-number">0.5</span>)<font></font>
    <font></font>
    def getData(self, view_id, dimensions, metrics, date, filename=<span class="hljs-string">'raw_data.csv'</span>, end_date=None, write_mode=<span class="hljs-string">'wb'</span>, filters=None):<font></font>
        dim_list = map(lambda x: {<span class="hljs-string">'name'</span>: <span class="hljs-string">'ga:'</span>+x}, dimensions)<font></font>
        metrics_list = map(lambda x: {<span class="hljs-string">'expression'</span>: <span class="hljs-string">'ga:'</span>+x}, metrics)<font></font>
        <font></font>
        file_data = open(filename, write_mode)<font></font>
        writer = csv.writer(file_data)<font></font>
        <font></font>
        page = None<font></font>
        <span class="hljs-keyword">while</span> True:<font></font>
            response = self.downloadReport(view_id, dim_list, metrics_list, date, page, end_date=end_date, filters=filters)<font></font>
            report = response[<span class="hljs-string">'reports'</span>][<span class="hljs-number">0</span>]<font></font>
            rows = report.get(<span class="hljs-string">'data'</span>, {}).get(<span class="hljs-string">'rows'</span>, [])
            <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> rows:<font></font>
                dimensions = row[<span class="hljs-string">'dimensions'</span>]<font></font>
                metrics = row[<span class="hljs-string">'metrics'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'values'</span>]<font></font>
                writer.writerow(dimensions+metrics)<font></font>
                <font></font>
            <span class="hljs-keyword">if</span> <span class="hljs-string">'nextPageToken'</span> <span class="hljs-keyword">in</span> report:<font></font>
                page = report[<span class="hljs-string">'nextPageToken'</span>]
            <span class="hljs-attr">else</span>:
                <span class="hljs-keyword">break</span>
        file_data.close()</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯APIã‚’ä»‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€æ—¥ä»˜dateã®ãƒ•ã‚¡ã‚¤ãƒ«filenameã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚</font><font style="vertical-align: inherit;">View_id-ã‚°ãƒ¼ã‚°ãƒ«ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®ãƒ“ãƒ¥ãƒ¼ç•ªå·ï¼š</font></font><br>
<br>
<pre><code class="python hljs">filename = <span class="hljs-string">'raw_data.csv'</span>
date = <span class="hljs-string">'2019-01-01'</span>
view_id = <span class="hljs-string">'123123123'</span><font></font>
<font></font>
ga = ApiGA()<font></font>
dims = [<span class="hljs-string">'dimension1'</span>, <span class="hljs-string">'dimension2'</span>, <span class="hljs-string">'source'</span>, <span class="hljs-string">'medium'</span>, <span class="hljs-string">'campaign'</span>, <span class="hljs-string">'keyword'</span>, <span class="hljs-string">'adContent'</span>, <span class="hljs-string">'userType'</span>]<font></font>
metrics = [<span class="hljs-string">'hits'</span>, <span class="hljs-string">'pageviews'</span>, <span class="hljs-string">'totalEvents'</span>, <span class="hljs-string">'transactions'</span>, <span class="hljs-string">'screenviews'</span>]<font></font>
ga.getData(view_id, dims, metrics, date, filename)<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã«ã€å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’BigQueryã«èª­ã¿è¾¼ã¿ã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">from</span> google.cloud <span class="hljs-keyword">import</span> bigquery<font></font>
<font></font>
client = bigquery.Client()<font></font>
<font></font>
<font></font>
schema = [<font></font>
    	bigquery.SchemaField(<span class="hljs-string">'clientId'</span>, <span class="hljs-string">'STRING'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'sessionId'</span>, <span class="hljs-string">'STRING'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'source'</span>, <span class="hljs-string">'STRING'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'medium'</span>, <span class="hljs-string">'STRING'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'campaign'</span>, <span class="hljs-string">'STRING'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'keyword'</span>, <span class="hljs-string">'STRING'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'adContent'</span>, <span class="hljs-string">'STRING'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'userType'</span>, <span class="hljs-string">'STRING'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'hits'</span>, <span class="hljs-string">'INTEGER'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'pageviews'</span>, <span class="hljs-string">'INTEGER'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'totalEvents'</span>, <span class="hljs-string">'INTEGER'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'transactions'</span>, <span class="hljs-string">'INTEGER'</span>),<font></font>
bigquery.SchemaField(<span class="hljs-string">'screenviews'</span>, <span class="hljs-string">'INTEGER'</span>)<font></font>
]<font></font>
table_id = â€˜raw.sessionsâ€™<font></font>
table = bigquery.Table(table_id, schema=schema)<font></font>
table = client.create_table(table)<font></font>
<font></font>
dataset_ref = client.dataset(dataset_id)<font></font>
table_ref = dataset_ref.table(table_id)<font></font>
job_config = bigquery.LoadJobConfig()<font></font>
job_config.source_format = bigquery.SourceFormat.CSV<font></font>
job_config.skip_leading_rows = <span class="hljs-number">0</span><font></font>
job_config.autodetect = True<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(filename, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> source_file:<font></font>
    job = client.load_table_from_file(source_file, table_ref, job_config=job_config)<font></font>
<font></font>
job.result()<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã¹ã¦ã®ãƒ’ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹ã«ã¯ã€dimension2ã€dimension3ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">dims = [<span class="hljs-string">'dimension2'</span>, <span class="hljs-string">'dimension13'</span>, <span class="hljs-string">'pagePath'</span>, <span class="hljs-string">'hostname'</span>, <span class="hljs-string">'dateHourMinute'</span>]<font></font>
metrics = [<span class="hljs-string">'hits'</span>, <span class="hljs-string">'entrances'</span>, <span class="hljs-string">'exits'</span>]<font></font>
â€¦.<font></font>
dims = [<span class="hljs-string">'dimension3'</span>, <span class="hljs-string">'eventCategory'</span>, <span class="hljs-string">'eventAction'</span>, <span class="hljs-string">'eventLabel'</span>]<font></font>
metrics = [<span class="hljs-string">'eventValue'</span>]<font></font>
â€¦.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€å¾Œã«ã€ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’SQLã‚¯ã‚¨ãƒªã§ç›¸äº’ã«çµåˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã®ã‚ˆã†ãªçµæœã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nv/p5/1k/nvp51kq9h-x3-0zvgutvsy1qut8.png" alt="ç”»åƒ"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ã™ã‚‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BigQueryã§ç”Ÿãƒ‡ãƒ¼ã‚¿åé›†ã‚’è¨­å®šã—ã¾ã—ãŸã€‚ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’æº–å‚™ã™ã‚‹ã ã‘ã§ã™ã€‚</font><font style="vertical-align: inherit;">å˜ç´”ãªSQLã‚¯ã‚¨ãƒªãŒä½œæˆã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¬ãƒãƒ¼ãƒˆã«ã¯ã€Tableauã¨Googleãƒ‡ãƒ¼ã‚¿ã‚¹ã‚¿ã‚¸ã‚ªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã‚‰ã«ã€Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ç™ºè¡Œã€æ”¯æ‰•ã„ã®é…å»¶ã€æ”¯æ‰•ã„ãªã©ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å«ã‚€å†…éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã§å¼·åŒ–ã™ã‚‹æ©Ÿä¼šãŒã‚ã‚Šã¾ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã‚‰ã«ã€Google Cloudã§ã¯ã€å¿…è¦ã«å¿œã˜ã¦ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’ç°¡å˜ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ†æãƒ¬ãƒãƒ¼ãƒˆã®å®Œå…¨ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/pg/bb/qtpgbbffktyvthyt09i6u2dtamq.png" alt="ç”»åƒ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çµæœã¨ã—ã¦ã€æ¬¡ã®ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚ˆã‚ŠæŸ”è»Ÿã§ä¾¿åˆ©ã«ã—ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤‰æ›ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹</font></font></li>
<li>    .           ,      ,    .</li>
<li>      </li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457036/index.html">å®šæœŸçš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã¯æ™‚ä»£é…ã‚Œã®æ…£è¡Œã§ã‚ã‚Šã€ãã‚Œã‚’æ”¾æ£„ã™ã‚‹æ™‚ãŒããŸ</a></li>
<li><a href="../ja457038/index.html">ãƒ­ã‚·ã‚¢èªã®ãƒ¢ãƒã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã€‚ãƒ©ã‚¸ã‚ªãƒã‚¤ãƒ‹ãƒ³ã‚°ã€ãƒ˜ãƒªã‚¦ãƒ ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</a></li>
<li><a href="../ja457040/index.html">ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚µãƒ¼ã¨ã—ã¦ã‚ˆã‚Šå¤šãã‚’è¡Œã„ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¤±ã‚ãªã„æ–¹æ³•</a></li>
<li><a href="../ja457042/index.html">è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã®ãƒ„ãƒªãƒ¼ã‚¦ã‚©ãƒ¼ã‚¯</a></li>
<li><a href="../ja457050/index.html">Facebook Libraã‚’æœ€åˆã«è¦‹ã‚‹</a></li>
<li><a href="../ja457054/index.html">åºƒå‘ŠæŒ‡æ¨™ã®è¾æ›¸ã€‚CTRã€CPIã€CPMã€CPCã€CR</a></li>
<li><a href="../ja457056/index.html">GITã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã®ç·¨æˆ</a></li>
<li><a href="../ja457058/index.html">2019å¹´ã«Googleã¨Yandexã®ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³çµæœã‚’ã‚¯ãƒªãƒƒã‚¯æ•°ã«å¤‰æ›ã™ã‚‹</a></li>
<li><a href="../ja457060/index.html">iOSãƒ©ã‚¤ã‚¿ãƒ¼å‘ã‘ã®3ã¤ã®ãƒ“ãƒ‡ã‚ª</a></li>
<li><a href="../ja457062/index.html">ã‚¹ã‚¿ãƒ¼ã‚·ãƒ†ã‚£ã®å®‡å®™é£›è¡Œå£«è¨“ç·´ã‚»ãƒ³ã‚¿ãƒ¼</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>