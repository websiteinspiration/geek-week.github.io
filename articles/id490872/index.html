<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺 ☘️ 👨🏽‍💼 Trio - Pemrograman Asinkron untuk Orang 🌦️ 🧛🏾 👏🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Python memiliki pustaka Trio - pustaka pemrograman asinkron. 
 Mengenal Trio terutama akan menarik bagi mereka yang bekerja di Asyncio, karena itu ada...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Trio - Pemrograman Asinkron untuk Orang</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/barsgroup/blog/490872/"><img src="https://habrastorage.org/webt/m7/0o/ye/m70oyejwkcwdk32csx1mq2wprao.jpeg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python memiliki </font><font style="vertical-align: inherit;">pustaka </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pustaka pemrograman asinkron. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengenal Trio terutama akan menarik bagi mereka yang bekerja di Asyncio, karena itu adalah alternatif yang baik yang memungkinkan Anda untuk menyelesaikan beberapa masalah yang tidak dapat ditangani Asyncio. </font><font style="vertical-align: inherit;">Dalam ulasan ini, kami akan mempertimbangkan apa itu Trio dan fitur apa yang diberikan kepada kami.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi mereka yang baru mulai bekerja dalam pemrograman asinkron, saya mengusulkan untuk membaca pengantar kecil tentang apa itu asinkron dan sinkronisasi. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sinkronisasi dan asinkron </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pemrograman sinkron,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> semua operasi dilakukan secara berurutan, dan Anda dapat memulai tugas baru hanya setelah menyelesaikan yang sebelumnya. </font><font style="vertical-align: inherit;">Namun, salah satu poin “sakitnya” adalah bahwa jika salah satu utas telah mengerjakan tugas untuk waktu yang sangat lama, seluruh program dapat membeku. </font><font style="vertical-align: inherit;">Ada tugas yang tidak memerlukan daya komputasi, tetapi membutuhkan waktu prosesor, yang dapat digunakan lebih rasional dengan memberikan kontrol ke utas lainnya. </font><font style="vertical-align: inherit;">Dalam pemrograman sinkron, tidak ada cara untuk menjeda tugas saat ini untuk menyelesaikan yang berikut di celahnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk apa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asinkron?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Penting untuk membedakan antara asinkron yang sebenarnya dan input-output asinkron. Dalam kasus kami, kami berbicara tentang input-output asinkron. Secara global - untuk menghemat waktu dan lebih efisien menggunakan fasilitas produksi. Asynchrony memungkinkan Anda untuk melewati area bermasalah pada utas. Dalam input-output asinkron, utas saat ini tidak akan menunggu eksekusi beberapa peristiwa eksternal, tetapi akan memberikan kontrol ke utas lainnya. Jadi, pada kenyataannya, hanya satu utas yang dijalankan sekaligus. Thread yang telah memberikan kontrol masuk ke antrian dan menunggu kontrol untuk kembali ke sana. Mungkin, pada saat itu, peristiwa eksternal yang diharapkan akan terjadi dan akan mungkin untuk terus bekerja. Ini akan memungkinkan Anda untuk beralih di antara tugas-tugas untuk meminimalkan pemborosan waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang kita bisa kembali ke apa adanya</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asyncio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pengoperasian </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop peristiwa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pustaka </font><b><font style="vertical-align: inherit;">ini</font></b><font style="vertical-align: inherit;"> ( </font><b><font style="vertical-align: inherit;">loop</font></b><font style="vertical-align: inherit;"> acara), yang mencakup antrian tugas dan loop itu sendiri. Siklus mengontrol pelaksanaan tugas, yaitu, ia mengambil tugas dari antrian dan menentukan apa yang akan terjadi padanya. Misalnya, mungkin menangani tugas I / O. Yaitu, loop peristiwa memilih tugas, mendaftar dan pada waktu yang tepat memulai prosesnya. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coroutine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah fungsi khusus yang mengembalikan kontrol tugas ini kembali ke loop acara, yaitu, mengembalikannya ke antrian. Penting bahwa coroutine ini diluncurkan secara tepat melalui serangkaian acara. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga ada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masa depan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- objek di mana hasil saat ini dari pelaksanaan tugas disimpan. </font><font style="vertical-align: inherit;">Ini mungkin informasi bahwa tugas belum diproses atau hasilnya sudah diperoleh; </font><font style="vertical-align: inherit;">atau mungkin ada pengecualian. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, perpustakaan Asyncio terkenal, namun, memiliki sejumlah kekurangan yang dapat ditutup oleh Trio.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trio</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut penulis perpustakaan, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nathaniel Smith</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mengembangkan Trio, ia berusaha membuat alat yang ringan dan mudah digunakan untuk pengembang, yang akan memberikan input / output asinkron paling sederhana dan penanganan kesalahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fitur penting dari Trio adalah manajemen konteks asinkron, yang tidak dimiliki Asyncio. </font><font style="vertical-align: inherit;">Untuk melakukan ini, penulis membuat dalam Trio apa yang disebut </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"kamar anak"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(pembibitan) - area pembatalan yang bertanggung jawab atas atomicity (kontinuitas) dari sekelompok utas. Gagasan utamanya adalah bahwa jika di “pembibitan” salah satu coroutine gagal, maka semua aliran di “pembibitan” akan berhasil diselesaikan atau dibatalkan. Bagaimanapun, hasilnya akan benar. Dan hanya ketika semua coroutine selesai, setelah keluar dari fungsi, pengembang sendiri memutuskan bagaimana untuk melanjutkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, "anak-anak" memungkinkan Anda untuk mencegah kelanjutan pemrosesan kesalahan, yang dapat mengarah pada fakta bahwa segala sesuatu akan "jatuh", atau hasilnya akan salah.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah yang bisa terjadi dengan Asyncio, karena di Asyncio prosesnya tidak berhenti, meskipun ada kesalahan. </font><font style="vertical-align: inherit;">Dan dalam hal ini, pertama, pengembang tidak akan tahu apa yang sebenarnya terjadi pada saat kesalahan, dan kedua, pemrosesan akan berlanjut.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contohnya </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan contoh paling sederhana dari dua fitur yang bersaing: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asyncio</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> asyncio<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo1</span>():</span>
    print(<span class="hljs-string">'  foo1: '</span>)
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)<font></font>
    print(<span class="hljs-string">'  foo1: '</span>)<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo2</span>():</span>
    print(<span class="hljs-string">'  foo2: '</span>)
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<font></font>
    print(<span class="hljs-string">'  foo2: '</span>)<font></font>
<font></font>
loop = asyncio.get_event_loop()<font></font>
bundle = asyncio.wait([<font></font>
    loop.create_task(foo1()),<font></font>
    loop.create_task(foo2()),<font></font>
])<font></font>
<span class="hljs-keyword">try</span>:<font></font>
    loop.run_until_complete(bundle)<font></font>
<span class="hljs-keyword">finally</span>:<font></font>
    loop.close()</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trio</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> trio<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo1</span>():</span>
    print(<span class="hljs-string">'  foo1: '</span>)
    <span class="hljs-keyword">await</span> trio.sleep(<span class="hljs-number">2</span>)<font></font>
    print(<span class="hljs-string">'  foo1: '</span>)<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo2</span>():</span>
    print(<span class="hljs-string">'  foo2: '</span>)
    <span class="hljs-keyword">await</span> trio.sleep(<span class="hljs-number">1</span>)<font></font>
    print(<span class="hljs-string">'  foo2: '</span>)<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> trio.open_nursery() <span class="hljs-keyword">as</span> nursery:<font></font>
        nursery.start_soon(foo1)<font></font>
        nursery.start_soon(foo2)<font></font>
<font></font>
trio.run(root)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dalam kedua kasus hasilnya akan sama:</font></font><br>
<br>
<pre><code class="python hljs">foo1: <font></font>
foo2: <font></font>
foo2: <font></font>
foo1: </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara struktural, kode Asyncio dan Trio dalam contoh ini serupa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perbedaan yang jelas adalah bahwa Trio tidak memerlukan penyelesaian eksplisit dari loop acara. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan contoh yang sedikit lebih hidup. </font><font style="vertical-align: inherit;">Mari membuat panggilan ke layanan web untuk mendapatkan cap waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk Asyncio, kami juga akan menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aiohttp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> aiohttp<font></font>
<font></font>
URL = <span class="hljs-string">'https://yandex.ru/time/sync.json?geo=213'</span>
MAX_CLIENTS = <span class="hljs-number">5</span><font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">session, i</span>):</span><font></font>
    start = time.time()<font></font>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(URL) <span class="hljs-keyword">as</span> response:<font></font>
        content = <span class="hljs-keyword">await</span> response.json()<font></font>
        print(<span class="hljs-string">f'<span class="hljs-subst">{i}</span> | <span class="hljs-subst">{content.get(<span class="hljs-string">"time"</span>)}</span> (  <span class="hljs-subst">{time.time() - start}</span>)'</span>)<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span><font></font>
    start = time.time()<font></font>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<font></font>
        tasks = [<font></font>
            asyncio.ensure_future(foo(session, i))<font></font>
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(MAX_CLIENTS)<font></font>
        ]<font></font>
        <span class="hljs-keyword">await</span> asyncio.wait(tasks)<font></font>
    print(<span class="hljs-string">f'  <span class="hljs-subst">{time.time() - start}</span>'</span>)<font></font>
<font></font>
ioloop = asyncio.get_event_loop()<font></font>
<span class="hljs-keyword">try</span>:<font></font>
    ioloop.run_until_complete(root())<font></font>
<span class="hljs-keyword">finally</span>:<font></font>
    ioloop.close()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk Trio kami menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bertanya</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> trio
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> asks<font></font>
URL = <span class="hljs-string">'https://yandex.ru/time/sync.json?geo=213'</span>
MAX_CLIENTS = <span class="hljs-number">5</span><font></font>
<font></font>
asks.init(<span class="hljs-string">'trio'</span>)<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">i</span>):</span><font></font>
    start = time.time()<font></font>
    response = <span class="hljs-keyword">await</span> asks.get(URL)<font></font>
    content = response.json()<font></font>
    print(<span class="hljs-string">f'<span class="hljs-subst">{i}</span> | <span class="hljs-subst">{content.get(<span class="hljs-string">"time"</span>)}</span> (  <span class="hljs-subst">{time.time() - start}</span>)'</span>)<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span><font></font>
    start = time.time()<font></font>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> trio.open_nursery() <span class="hljs-keyword">as</span> nursery:
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(MAX_CLIENTS):<font></font>
            nursery.start_soon(foo, i)<font></font>
<font></font>
    print(<span class="hljs-string">f'  <span class="hljs-subst">{time.time() - start}</span>'</span>)<font></font>
<font></font>
trio.run(root)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kedua kasus, kita mendapatkan sesuatu seperti</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-number">0</span> | <span class="hljs-number">1543837647522</span> (  <span class="hljs-number">0.11855053901672363</span>)
<span class="hljs-number">2</span> | <span class="hljs-number">1543837647535</span> (  <span class="hljs-number">0.1389765739440918</span>)
<span class="hljs-number">3</span> | <span class="hljs-number">1543837647527</span> (  <span class="hljs-number">0.13904547691345215</span>)
<span class="hljs-number">4</span> | <span class="hljs-number">1543837647557</span> (  <span class="hljs-number">0.1591191291809082</span>)
<span class="hljs-number">1</span> | <span class="hljs-number">1543837647607</span> (  <span class="hljs-number">0.2100353240966797</span>)<font></font>
  <span class="hljs-number">0.2102828025817871</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baik. </font><font style="vertical-align: inherit;">Bayangkan selama eksekusi salah satu coroutine, terjadi kesalahan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pada Asyncio.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">session, i</span>):</span><font></font>
    start = time.time()<font></font>
    <span class="hljs-keyword">if</span> i == <span class="hljs-number">3</span>:
        <span class="hljs-keyword">raise</span> Exception
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(URL) <span class="hljs-keyword">as</span> response:<font></font>
        content = <span class="hljs-keyword">await</span> response.json()<font></font>
        print(<span class="hljs-string">f'<span class="hljs-subst">{i}</span> | <span class="hljs-subst">{content.get(<span class="hljs-string">"time"</span>)}</span> (  <span class="hljs-subst">{time.time() - start}</span>)'</span>)<font></font>
<font></font>
<span class="hljs-number">1</span> | <span class="hljs-number">1543839060815</span> (  <span class="hljs-number">0.10857725143432617</span>)
<span class="hljs-number">2</span> | <span class="hljs-number">1543839060844</span> (  <span class="hljs-number">0.10372781753540039</span>)
<span class="hljs-number">5</span> | <span class="hljs-number">1543839060843</span> (  <span class="hljs-number">0.10734415054321289</span>)
<span class="hljs-number">4</span> | <span class="hljs-number">1543839060874</span> (  <span class="hljs-number">0.13985681533813477</span>)<font></font>
  <span class="hljs-number">0.15044045448303223</span><font></font>
Traceback (most recent call last):<font></font>
  File <span class="hljs-string">"...py"</span>, line <span class="hljs-number">12</span>, <span class="hljs-keyword">in</span> foo
    <span class="hljs-keyword">raise</span> Exception<font></font>
Exception</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
untuk trio</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">i</span>):</span><font></font>
    start = time.time()<font></font>
    response = <span class="hljs-keyword">await</span> asks.get(URL)<font></font>
    content = response.json()<font></font>
    <span class="hljs-keyword">if</span> i == <span class="hljs-number">3</span>:
        <span class="hljs-keyword">raise</span> Exception<font></font>
    print(<span class="hljs-string">f'<span class="hljs-subst">{i}</span> | <span class="hljs-subst">{content.get(<span class="hljs-string">"time"</span>)}</span> (  <span class="hljs-subst">{time.time() - start}</span>)'</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-number">4</span> | <span class="hljs-number">1543839223372</span> (  <span class="hljs-number">0.13524699211120605</span>)
<span class="hljs-number">2</span> | <span class="hljs-number">1543839223379</span> (  <span class="hljs-number">0.13848185539245605</span>)<font></font>
Traceback (most recent call last):<font></font>
  File <span class="hljs-string">"...py"</span>, line <span class="hljs-number">28</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<font></font>
    trio.run(root)<font></font>
  File <span class="hljs-string">"/lib64/python3.6/site-packages/trio/_core/_run.py"</span>, line <span class="hljs-number">1337</span>, <span class="hljs-keyword">in</span> run
    <span class="hljs-keyword">raise</span> runner.main_task_outcome.error<font></font>
  File <span class="hljs-string">"...py"</span>, line <span class="hljs-number">23</span>, <span class="hljs-keyword">in</span> root<font></font>
    nursery.start_soon(foo, i)<font></font>
  File <span class="hljs-string">"/lib64/python3.6/site-packages/trio/_core/_run.py"</span>, line <span class="hljs-number">397</span>, <span class="hljs-keyword">in</span> __aexit__
    <span class="hljs-keyword">raise</span> combined_error_from_nursery<font></font>
  File <span class="hljs-string">"...py"</span>, line <span class="hljs-number">15</span>, <span class="hljs-keyword">in</span> foo
    <span class="hljs-keyword">raise</span> Exception<font></font>
Exception</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jelas terlihat bahwa di Trio, segera setelah terjadinya kesalahan, "membatalkan area" bekerja, dan dua dari empat tugas yang tidak mengandung kesalahan diakhiri secara tidak normal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Asyncio, semua tugas sudah selesai, dan baru saat itulah trackback muncul. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam contoh yang diberikan, ini tidak penting, tetapi mari kita bayangkan bahwa tugas-tugas dalam satu atau lain cara bergantung satu sama lain, dan serangkaian tugas harus memiliki sifat atomisitas. Dalam hal ini, respons yang tepat waktu terhadap kesalahan menjadi jauh lebih penting. Tentu saja, Anda dapat menggunakan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menunggu asyncio.wait (tugas, return_when = FIRST_EXCEPTION)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi Anda harus ingat untuk menyelesaikan tugas terbuka dengan benar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah contoh lain: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan coroutine secara bersamaan mengakses beberapa layanan web yang serupa, dan respons pertama yang diterima adalah penting.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> asyncio <span class="hljs-keyword">import</span> FIRST_COMPLETED
<span class="hljs-keyword">import</span> aiohttp<font></font>
<font></font>
URL = <span class="hljs-string">'https://yandex.ru/time/sync.json?geo=213'</span>
MAX_CLIENTS = <span class="hljs-number">5</span><font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">session</span>):</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(URL) <span class="hljs-keyword">as</span> response:<font></font>
        content = <span class="hljs-keyword">await</span> response.json()
        <span class="hljs-keyword">return</span> content.get(<span class="hljs-string">"time"</span>)<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<font></font>
        tasks = [<font></font>
            asyncio.ensure_future(foo(session))<font></font>
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, MAX_CLIENTS + <span class="hljs-number">1</span>)<font></font>
        ]<font></font>
        done, pending = <span class="hljs-keyword">await</span> asyncio.wait(tasks, return_when=FIRST_COMPLETED)<font></font>
        print(done.pop().result())<font></font>
        <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> pending:<font></font>
            future.cancel()<font></font>
<font></font>
ioloop = asyncio.get_event_loop()<font></font>
<span class="hljs-keyword">try</span>:<font></font>
    ioloop.run_until_complete(root())<font></font>
<span class="hljs-keyword">except</span>:<font></font>
    ioloop.close()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya sangat sederhana. </font><font style="vertical-align: inherit;">Satu-satunya persyaratan adalah mengingat untuk menyelesaikan tugas yang belum selesai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Trio, melakukan manuver serupa sedikit lebih sulit, tetapi hampir tidak mungkin untuk meninggalkan "ekor" tidak terlihat segera:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> trio
<span class="hljs-keyword">import</span> asks<font></font>
URL = <span class="hljs-string">'https://yandex.ru/time/sync.json?geo=213'</span>
MAX_CLIENTS = <span class="hljs-number">5</span>
asks.init(<span class="hljs-string">'trio'</span>)<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>(<span class="hljs-params">session, send_channel, nursery</span>):</span>
    response = <span class="hljs-keyword">await</span> session.request(<span class="hljs-string">'GET'</span>, url=URL)<font></font>
    content = response.json()<font></font>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> send_channel:<font></font>
        send_channel.send_nowait(content.get(<span class="hljs-string">"time"</span>))<font></font>
    nursery.cancel_scope.cancel()<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span>
    send_channel, receive_channel = trio.open_memory_channel(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> send_channel, receive_channel:
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> trio.open_nursery() <span class="hljs-keyword">as</span> nursery:
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> asks.Session() <span class="hljs-keyword">as</span> session:
                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(MAX_CLIENTS):<font></font>
                    nursery.start_soon(foo, session, send_channel.clone(), nursery)<font></font>
<font></font>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> receive_channel:<font></font>
            x = <span class="hljs-keyword">await</span> receive_channel.receive()<font></font>
            print(x)<font></font>
<font></font>
trio.run(root)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nursery.cancel_scope.cancel ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - coroutine pertama yang selesai akan memanggil fungsi di area undo yang akan membatalkan semua tugas lain, sehingga tidak perlu khawatir tentang hal itu secara terpisah. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Benar, untuk mentransfer hasil eksekusi coroutine ke fungsi yang menyebabkannya, Anda harus memulai saluran komunikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semoga ulasan perbandingan ini memberikan pemahaman tentang fitur utama Trio. </font><font style="vertical-align: inherit;">Terimakasih untuk semua!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id490850/index.html">Bantu kompiler membantu Anda</a></li>
<li><a href="../id490852/index.html">Secara detail tentang SpinLaunch - rahasia yang paling dijaga ketat dalam industri luar angkasa</a></li>
<li><a href="../id490854/index.html">Robot gudang menggunakan AI untuk mengurutkan item sudah siap</a></li>
<li><a href="../id490856/index.html">Master Penjara Bawah Tanah Otomatis</a></li>
<li><a href="../id490862/index.html">LetsEncrypt berencana untuk mencabut sertifikatnya karena bug perangkat lunak</a></li>
<li><a href="../id490874/index.html">Implementasi kerja jarak jauh yang disengaja: cara menggandakan hasil Anda tanpa mempekerjakan siapa pun</a></li>
<li><a href="../id490876/index.html">Mengapa kita kelelahan?</a></li>
<li><a href="../id490878/index.html">Persamaan diferensial nonlinier, diskresi ruang-waktu dan produk epsilon</a></li>
<li><a href="../id490882/index.html">Perbaiki masalah di bawah Docker. Tampaknya, apa hubungannya GIT dengan itu?</a></li>
<li><a href="../id490884/index.html">Konferensi DEFCON 27. Mobil Anda adalah mobil saya. Bagian 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>