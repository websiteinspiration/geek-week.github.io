<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèø üë®üèæ‚Äç‚öñÔ∏è üí§ Production of Material Icons for MacOSX Home Assistant on Electron üï• ‚õ≤Ô∏è üôáüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first series, I brewed a smart home on the Home Assistant. In the process, I fell in love with the Home Assistant and thought about writing a d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Production of Material Icons for MacOSX Home Assistant on Electron</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497880/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first series,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I brewed a smart home on the Home Assistant. In the process, I fell in love with the Home Assistant and thought about writing a desktop application for this system. Home Assitant has a wonderful web-based interface and it seemed reasonable to wrap it in Electron to get a beautiful dock icon, native notifications, a menu bar for quick access and other zeroconf. Home Assistant for everything that can be used Material Icons: for dashboards, for states, for buttons, for everything. This means that you need to pull the entire set of material icons into the Electron application.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Electron uses the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nativeImage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API to work with pictures </font><font style="vertical-align: inherit;">, which in 2020 does not accept vector formats and deigns to consume only PNG and JPG. JPG is not suitable for us since the compression artifacts for the icons are deadly. So you need somewhere to get the format being transferred to PNG. Climbing to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">home site of material icons for</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> about 15 minutes I was looking for a ready-made package of material icons for MacOSX cut into png in different sizes and under different dpi ... It's hard to say why, but they don‚Äôt publish anything like that there. Will have to produce independently. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Home Assistant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> offers to declare in configs icons in the format ‚Äúmdi: home-cirlce‚Äù - the name of the icon ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) with the replacement of the first character '-' by ':'. </font><font style="vertical-align: inherit;">Replace ‚Äú-‚Äú =&gt; ‚Äù:‚Äù we programmatically convert to be closer to the original and did not use the characters ‚Äú:‚Äù in the file names. </font><font style="vertical-align: inherit;">The first place I wanted to screw on the icons was the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Home Assistant dashboard menu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">For menubar, macosx uses 16x16 pixel images and @ 2 for retina (maybe some more, @ 2 was enough on my poppy). </font><font style="vertical-align: inherit;">So I need to get two files for each icon from the material set:</font></font><br>
<br>
<pre><code class="bash hljs">mdi-icon-name16.png<font></font>
mdi-icon-name16@2.png<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Added a size to the name so that adding new sizes of pictures would not interfere with walking in the future. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The final fonts are usually collected from SVG images, this gave rise to two tasks: 1 - find svg material icons, 2 - automate their slicing for&gt; 5000 files. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The native site was still useful, there I found the command ‚Äúnpm install</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ font. " </font><font style="vertical-align: inherit;">At random substituting svg instead of font with the command ‚Äúnpm install</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ svg ‚Äùwe got the whole set of material icons neatly lying in the same directory node_modules / @ mdi / svg / svg / with names like mdi-icon-name.svg. </font><font style="vertical-align: inherit;">The familiar ImageMagick showed extremely low quality of the resulting images, the svg2png utility worked even worse. </font><font style="vertical-align: inherit;">But the good stackoverflow suggested that </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inkscape would</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cope with this task </font><font style="vertical-align: inherit;">with such a command</font></font><br>
<br>
<pre><code class="bash hljs">inkscape -w 16 -h 16 node_modules/@mdi/svg/svg/ab-testing.svg \<font></font>
    -o images/mdi-ab-testing16.png</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The result turned out to be satisfactory. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/u5/3w/h7u53wlvlxmjfgh5gf8hdkcrajm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But a closer examination showed that in Dark Mode such icons look dull: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ag/k_/tj/agk_tjmhekpylck8-0y9nv2w6fc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apple‚Äôs website said that they invented a special </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Template</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> format </font><font style="vertical-align: inherit;">so that the pictures could be inverted without much difficulty, if fate brings them to Dark Mode. </font><font style="vertical-align: inherit;">The role of such files is a PNG image in which all the pixels are black, and the icon itself is drawn with transparency (on the alpha channel). </font><font style="vertical-align: inherit;">At the same time, Electron can pick up such pictures if there is a ‚ÄúTemplate‚Äù in their name. </font><font style="vertical-align: inherit;">So, two more files with icons need to be added two more with Template icons, we get this set for each icon:</font></font><br>
<br>
<pre><code class="bash hljs">mdi-icon-name16.png<font></font>
mdi-icon-name16@2.png<font></font>
mdi-icon-name16Template.png<font></font>
mdi-icon-name16Template@2.png<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inkscape won‚Äôt be able to perform miracles with the alpha channel from the console, but it‚Äôs easy to convert from ImageMagick. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We do in three steps:</font></font><br>
<br>
<pre><code class="bash hljs">inkscape -w 16 -h 16 \<font></font>
    node_modules/@mdi/svg/svg/ab-testing.svg \<font></font>
    -o images/mdi-ab-testing16.png<font></font>
convert -size 16x16 xc:none images/background16.png<font></font>
convert -verbose -composite images/background16.png \<font></font>
    images/mdi-ab-testing16.png -compose CopyAlpha \<font></font>
    menuicons/ab-testingTemplate16.png</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 - Creating a bitmap image from a vector </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 - Creating a transparent image for step three </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 - Creating a file with the transfer of gray gradations to the alpha channel </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Already with the Template menu icons in Dark Mode it began to look like this </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/g4/w7/mjg4w7raoh9flq3szdvkgllte9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, the goal is achieved. </font><font style="vertical-align: inherit;">The script distills all the images in the desired formats</font></font><br>
<br>
<pre><code class="bash hljs">
<span class="hljs-comment">#!/bin/sh -x</span><font></font>
<font></font>
<span class="hljs-built_in">set</span> -e<font></font>
<font></font>
<span class="hljs-comment"># Run 'npm install @mdi/svg' beforehead</span>
MDISVG_PATH=<span class="hljs-string">'node_modules/@mdi/svg/svg/'</span><font></font>
<font></font>
<span class="hljs-comment">#Put inkscape and convert into PATH</span>
PATH=<span class="hljs-variable">$PATH</span>:/Applications/Inkscape.app/Contents/MacOS/<font></font>
<font></font>
mkdir -p images<font></font>
convert -size 32x32 xc:none images/background16@2x.png<font></font>
convert -size 16x16 xc:none images/background16.png<font></font>
<font></font>
SIZES=<span class="hljs-string">"
16,16
32,16@2x
"</span>
FILES=`ls <span class="hljs-variable">${MDISVG_PATH}</span> |grep svg`
<span class="hljs-keyword">for</span> SVG <span class="hljs-keyword">in</span> <span class="hljs-variable">$FILES</span>; <span class="hljs-keyword">do</span>
    BASE=$(basename <span class="hljs-string">"<span class="hljs-variable">$SVG</span>"</span> | sed <span class="hljs-string">'s/\.[^\.]*$//'</span>)
    <span class="hljs-keyword">for</span> PARAMS <span class="hljs-keyword">in</span> <span class="hljs-variable">$SIZES</span>; <span class="hljs-keyword">do</span>
        SIZE=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$PARAMS</span> | cut -d, -f1)<font></font>
        LABEL=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$PARAMS</span> | cut -d, -f2)<font></font>
        inkscape -w <span class="hljs-variable">$SIZE</span> -h <span class="hljs-variable">$SIZE</span> <span class="hljs-string">"<span class="hljs-variable">$MDISVG_PATH</span>/<span class="hljs-variable">$SVG</span>"</span> \<font></font>
            -o <span class="hljs-string">"images/mdi-<span class="hljs-variable">${BASE}</span><span class="hljs-variable">${LABEL}</span>"</span>.png<font></font>
        convert -verbose \<font></font>
            -composite images/background<span class="hljs-variable">${LABEL}</span>.png <span class="hljs-string">"images/mdi-<span class="hljs-variable">${BASE}</span><span class="hljs-variable">${LABEL}</span>"</span>.png \<font></font>
            -compose CopyAlpha \<font></font>
            <span class="hljs-string">"images/<span class="hljs-variable">${BASE}</span>Template<span class="hljs-variable">${LABEL}</span>"</span>.png
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">done</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are waiting for a couple of hours until&gt; 20,000 pictures come off the assembly line ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS These are not the only adventures when working with Electron, I will write about further adventures as they are completed ...</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497870/index.html">Computer viruses: a story from harmless home spies to bank card thieves</a></li>
<li><a href="../en497872/index.html">Unusual and quite obvious factors affecting the traffic of corporate networks and the work of providers</a></li>
<li><a href="../en497874/index.html">David Heinemeyer Hansson (Basecamp, ReWork, Ruby on Rails) on how it works</a></li>
<li><a href="../en497876/index.html">[bookmark] Working with images on the web</a></li>
<li><a href="../en497878/index.html">Install GPL version of HPL with OpenBLAS</a></li>
<li><a href="../en497882/index.html">How to get an interview or why aren‚Äôt you hired?</a></li>
<li><a href="../en497886/index.html">IOS field validation - quick and easy</a></li>
<li><a href="../en497890/index.html">Microsoft 365 Virtual Training Day: Dive into Microsoft Teams</a></li>
<li><a href="../en497894/index.html">Microsoft Azure Virtual Training Day: Modern Data Warehouse</a></li>
<li><a href="../en497896/index.html">We preserve vision on a remote site using a projector instead of a monitor - several unobvious nuances</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>