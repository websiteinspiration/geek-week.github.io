<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛀🏼 🏁 👼🏽 一連のViewModel + LiveData、Retrofit +コルーチンを備えたAndroidアプリケーションでの単純なアーキテクチャの編成 👩🏾‍⚖️ 🌰 👨🏽‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="長い紹介なしで、アプリケーションの便利なアーキテクチャをすばやく簡単に整理する方法を説明します。このマテリアルは、mvvmパターンとKotlinコルーチンに慣れていない人に役立ちます。
 
 したがって、私たちには単純なタスクがあります。ネットワーク要求を受信して​​処理するには、結果をビューに表示...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>一連のViewModel + LiveData、Retrofit +コルーチンを備えたAndroidアプリケーションでの単純なアーキテクチャの編成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475598/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長い紹介なしで、アプリケーションの便利なアーキテクチャをすばやく簡単に整理する方法を説明します。</font><font style="vertical-align: inherit;">このマテリアルは、mvvmパターンとKotlinコルーチンに慣れていない人に役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、私たちには単純なタスクがあります。ネットワーク要求を受信して​​処理するには、結果をビューに表示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクション：アクティビティ（フラグメント）から目的のメソッドViewModel-&gt; ViewModelを呼び出して改造ハンドルにアクセスし、コルーチンを介して要求を実行します-&gt;応答はイベントとしてライブデータに送信されます-&gt;データを転送するイベントを受信するアクティビティで。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトのセットアップ</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存関係</font></font></h4><br>
<pre><code class="javascript hljs">    <span class="hljs-comment">//Retrofit</span>
    implementation <span class="hljs-string">'com.squareup.retrofit2:retrofit:2.6.2'</span>
    implementation <span class="hljs-string">'com.squareup.retrofit2:converter-gson:2.6.2'</span>
    implementation <span class="hljs-string">'com.squareup.okhttp3:logging-interceptor:4.2.1'</span><font></font>
<font></font>
    <span class="hljs-comment">//Coroutines</span>
    implementation <span class="hljs-string">'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.0'</span>
    implementation <span class="hljs-string">'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.0'</span><font></font>
<font></font>
    <span class="hljs-comment">//ViewModel lifecycle</span>
    implementation <span class="hljs-string">'androidx.lifecycle:lifecycle-extensions:2.1.0'</span>
    implementation <span class="hljs-string">"androidx.lifecycle:lifecycle-viewmodel-ktx:2.2.0-rc01"</span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニフェスト</font></font></h4><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">...</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.INTERNET"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">後付けセットアップ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kotlinovsky </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトを作成します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これがネットワーククライアントになります</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。理解を容易にするために</font><font style="vertical-align: inherit;">シングルトン</font><font style="vertical-align: inherit;">UPDシングルトンが使用されます。</font><font style="vertical-align: inherit;">コメントは、コントロールの反転を使用する方が適切であることを示していますが、これは別のトピックです。</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">object</span> NetworkService {<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> BASE_URL = <span class="hljs-string">" http://www.mocky.io/v2/"</span><font></font>
<font></font>
    <span class="hljs-comment">// HttpLoggingInterceptor      </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> loggingInterceptor = run {
        <span class="hljs-keyword">val</span> httpLoggingInterceptor = HttpLoggingInterceptor()<font></font>
        httpLoggingInterceptor.apply {<font></font>
            httpLoggingInterceptor.level = HttpLoggingInterceptor.Level.BODY<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> baseInterceptor: Interceptor = invoke { chain -&gt;
        <span class="hljs-keyword">val</span> newUrl = chain<font></font>
            .request()<font></font>
            .url<font></font>
            .newBuilder()<font></font>
            .build()<font></font>
<font></font>
        <span class="hljs-keyword">val</span> request = chain<font></font>
                .request()<font></font>
                .newBuilder()<font></font>
                .url(newUrl)<font></font>
                .build()<font></font>
<font></font>
        <span class="hljs-keyword">return</span><span class="hljs-symbol">@invoke</span> chain.proceed(request)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> client: OkHttpClient = OkHttpClient<font></font>
            .Builder()<font></font>
            .addInterceptor(loggingInterceptor)<font></font>
            .addInterceptor(baseInterceptor)<font></font>
            .build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">retrofitService</span><span class="hljs-params">()</span></span>: Api {
        <span class="hljs-keyword">return</span> Retrofit.Builder()<font></font>
                .baseUrl(BASE_URL)<font></font>
                .addConverterFactory(GsonConverterFactory.create())<font></font>
                .client(client)<font></font>
                .build()<font></font>
                .create(Api::<span class="hljs-keyword">class</span>.java)<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIインターフェース</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
偽のサービスへのロックされたリクエストを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
楽しみを一時停止し、ここでコルチンの魔法を開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数のキーワードに</font></font><b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、suspend</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fun ...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をマークし</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
改造はバージョン2.6.0からKotlinサスペンド機能を操作することを学びました。ネットワーク要求を直接実行し、データを含むオブジェクトを返します。</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Api</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@GET(<span class="hljs-meta-string">"5dcc12d554000064009c20fc"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">(
        <span class="hljs-meta">@Query(<span class="hljs-meta-string">"page"</span>)</span> page: <span class="hljs-type">Int</span>
    )</span></span>: ResponseWrapper&lt;Users&gt;<font></font>
<font></font>
    <span class="hljs-meta">@GET(<span class="hljs-meta-string">"5dcc147154000059009c2104"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsersError</span><span class="hljs-params">(
        <span class="hljs-meta">@Query(<span class="hljs-meta-string">"page"</span>)</span> page: <span class="hljs-type">Int</span>
    )</span></span>: ResponseWrapper&lt;Users&gt;<font></font>
}<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ResponseWrapper</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ネットワークリクエストの単純なラッパークラスです。</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResponseWrapper</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">Serializable {</span></span>
    <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"response"</span>)</span>
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T? = <span class="hljs-literal">null</span>
    <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"error"</span>)</span>
    <span class="hljs-keyword">val</span> error: Error? = <span class="hljs-literal">null</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
日付クラスの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー</font></font></b><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Users</span></span>(
    <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"count"</span>)</span>
    <span class="hljs-keyword">var</span> count: <span class="hljs-built_in">Int</span>?,
    <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"items"</span>)</span>
    <span class="hljs-keyword">var</span> items: List&lt;Item?&gt;?<font></font>
) {<font></font>
    <span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Item</span></span>(
        <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"first_name"</span>)</span>
        <span class="hljs-keyword">var</span> firstName: String?,
        <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"last_name"</span>)</span>
        <span class="hljs-keyword">var</span> lastName: String?<font></font>
    )<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ViewModel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのViewModelが継承される</font><font style="vertical-align: inherit;">
抽象</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseViewModel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスを作成し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここでさらに詳しく説明します。</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseViewModel</span> : <span class="hljs-type">ViewModel</span></span>() {<font></font>
<font></font>
    <span class="hljs-keyword">var</span> api: Api = NetworkService.retrofitService()<font></font>
<font></font>
    <span class="hljs-comment">//       requestWithLiveData  </span>
    <span class="hljs-comment">// requestWithCallback,      </span>
    <span class="hljs-comment">//          </span>
    <span class="hljs-comment">// .       suspend , </span>
    <span class="hljs-comment">//             </span>
    <span class="hljs-comment">//    .     </span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">requestWithLiveData</span><span class="hljs-params">(
        liveData: <span class="hljs-type">MutableLiveData</span>&lt;<span class="hljs-type">Event</span>&lt;<span class="hljs-type">T</span>&gt;&gt;,
        request: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">ResponseWrapper</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {<font></font>
<font></font>
        <span class="hljs-comment">//       </span><font></font>
        liveData.postValue(Event.loading())<font></font>
<font></font>
        <span class="hljs-comment">//     ViewModel,  viewModelScope.</span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-comment">//    .</span>
        <span class="hljs-comment">//   IO    </span>
        <span class="hljs-keyword">this</span>.viewModelScope.launch(Dispatchers.IO) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> response = request.invoke()
                <span class="hljs-keyword">if</span> (response.<span class="hljs-keyword">data</span> != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">//     postValue  IO </span>
                    liveData.postValue(Event.success(response.<span class="hljs-keyword">data</span>))<font></font>
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response.error != <span class="hljs-literal">null</span>) {<font></font>
                    liveData.postValue(Event.error(response.error))<font></font>
                }<font></font>
            } <span class="hljs-keyword">catch</span> (e: Exception) {<font></font>
                e.printStackTrace()<font></font>
                liveData.postValue(Event.error(<span class="hljs-literal">null</span>))<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">requestWithCallback</span><span class="hljs-params">(
        request: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">ResponseWrapper</span>&lt;<span class="hljs-type">T</span>&gt;,
        response: (<span class="hljs-type">Event</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {<font></font>
<font></font>
        response(Event.loading())<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.viewModelScope.launch(Dispatchers.IO) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> res = request.invoke()<font></font>
<font></font>
                <span class="hljs-comment">//   ,    </span>
                <span class="hljs-comment">//       ,  </span>
                <span class="hljs-comment">//    </span>
                <span class="hljs-comment">//    </span>
                <span class="hljs-comment">//  context </span><font></font>
                launch(Dispatchers.Main) {<font></font>
                    <span class="hljs-keyword">if</span> (res.<span class="hljs-keyword">data</span> != <span class="hljs-literal">null</span>) {<font></font>
                        response(Event.success(res.<span class="hljs-keyword">data</span>))<font></font>
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res.error != <span class="hljs-literal">null</span>) {<font></font>
                        response(Event.error(res.error))<font></font>
                    }<font></font>
                }<font></font>
            } <span class="hljs-keyword">catch</span> (e: Exception) {<font></font>
                e.printStackTrace()<font></font>
                <span class="hljs-comment">// UPD (  )   catch     Main </span><font></font>
                launch(Dispatchers.Main) {<font></font>
                    response(Event.error(<span class="hljs-literal">null</span>))<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Googleのクールなソリューションは、日付クラスをイベントラッパークラスにラップすることです。このクラスでは、通常、LOADING、SUCCESS、ERRORのようないくつかの状態をとることができます。 </font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event</span>&lt;<span class="hljs-type">out T</span>&gt;</span>(<span class="hljs-keyword">val</span> status: Status, <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T?, <span class="hljs-keyword">val</span> error: Error?) {<font></font>
<font></font>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">loading</span><span class="hljs-params">()</span></span>: Event&lt;T&gt; {
            <span class="hljs-keyword">return</span> Event(Status.LOADING, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">success</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">T</span>?)</span></span>: Event&lt;T&gt; {
            <span class="hljs-keyword">return</span> Event(Status.SUCCESS, <span class="hljs-keyword">data</span>, <span class="hljs-literal">null</span>)<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">error</span><span class="hljs-params">(error: <span class="hljs-type">Error</span>?)</span></span>: Event&lt;T&gt; {
            <span class="hljs-keyword">return</span> Event(Status.ERROR, <span class="hljs-literal">null</span>, error)<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">enum</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Status</span> </span>{<font></font>
    SUCCESS,<font></font>
    ERROR,<font></font>
    LOADING<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがどのように機能するかです。</font><font style="vertical-align: inherit;">ネットワークリクエスト中に、ステータスがLOADINGのイベントを作成します。</font><font style="vertical-align: inherit;">サーバーからの応答を待ってから、データをイベントでラップし、指定されたステータスでさらに送信します。</font><font style="vertical-align: inherit;">ビューでは、イベントのタイプを確認し、状態に応じて、ビューに異なる状態を設定します。</font><font style="vertical-align: inherit;">ほぼ同じ哲学は建築パターンMVIに基づいています</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ActivityViewModel</font></font></h3><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActivityViewModel</span> : <span class="hljs-type">BaseViewModel</span></span>() {<font></font>
<font></font>
    <span class="hljs-comment">//      </span>
    <span class="hljs-keyword">val</span> simpleLiveData = MutableLiveData&lt;Event&lt;Users&gt;&gt;()<font></font>
   <font></font>
    <span class="hljs-comment">//  .     requestWithLiveData</span>
    <span class="hljs-comment">//  BaseViewModel     , </span>
    <span class="hljs-comment">//         </span>
    <span class="hljs-comment">//     api.getUsers</span>
    <span class="hljs-comment">//         </span>
    <span class="hljs-comment">//   </span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">(page: <span class="hljs-type">Int</span>)</span></span> {<font></font>
        requestWithLiveData(simpleLiveData) {<font></font>
            api.getUsers(<font></font>
                page = page<font></font>
            )<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//  ,      </span>
    <span class="hljs-comment">// UPD          </span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsersError</span><span class="hljs-params">(page: <span class="hljs-type">Int</span>, callback: (<span class="hljs-type">data</span>: <span class="hljs-type">Event</span>&lt;<span class="hljs-type">Users</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {<font></font>
        requestWithCallback({<font></font>
            api.getUsersError(<font></font>
                page = page<font></font>
            )<font></font>
        }) {<font></font>
            callback(it)<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後に</font></font><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主な活動</font></font></h3><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() {<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> activityViewModel: ActivityViewModel<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<font></font>
        setContentView(R.layout.activity_main)<font></font>
<font></font>
        activityViewModel = ViewModelProviders.of(<span class="hljs-keyword">this</span>).<span class="hljs-keyword">get</span>(ActivityViewModel::<span class="hljs-keyword">class</span>.java)<font></font>
        observeGetPosts()<font></font>
<font></font>
        buttonOneClickListener()<font></font>
        buttonTwoClickListener()<font></font>
    }<font></font>
<font></font>
    //    <font></font>
    //        <font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">fun</span> observeGetPosts() {<font></font>
        activityViewModel.simpleLiveData.observe(this, Observer {<font></font>
            <span class="hljs-keyword">when</span> (it.status) {<font></font>
                Status.LOADING -&gt; viewOneLoading()<font></font>
                Status.SUCCESS -&gt; viewOneSuccess(it.<span class="hljs-keyword">data</span>)<font></font>
                Status.ERROR -&gt; viewOneError(it.error)<font></font>
            }<font></font>
        })<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">fun</span> buttonOneClickListener() {<font></font>
        btn_test_one.setOnClickListener {<font></font>
            activityViewModel.getUsers(page = <span class="hljs-number">1</span>)<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//      ,  </span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buttonTwoClickListener</span><span class="hljs-params">()</span></span> {<font></font>
        btn_test_two.setOnClickListener {<font></font>
            activityViewModel.getUsersError(page = <span class="hljs-number">2</span>) {
                <span class="hljs-keyword">when</span> (it.status) {<font></font>
                    Status.LOADING -&gt; viewTwoLoading()<font></font>
                    Status.SUCCESS -&gt; viewTwoSuccess(it.<span class="hljs-keyword">data</span>)<font></font>
                    Status.ERROR -&gt; viewTwoError(it.error)<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewOneLoading</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">//  ,   </span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewOneSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Users</span>?)</span></span> {
        <span class="hljs-keyword">val</span> usersList: MutableList&lt;Users.Item&gt;? = <span class="hljs-keyword">data</span>?.items <span class="hljs-keyword">as</span> MutableList&lt;Users.Item&gt;?<font></font>
        usersList?.shuffle()<font></font>
        usersList?.let {<font></font>
            Toast.makeText(applicationContext, <span class="hljs-string">"<span class="hljs-subst">${it}</span>"</span>, Toast.LENGTH_SHORT).show()<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewOneError</span><span class="hljs-params">(error: <span class="hljs-type">Error</span>?)</span></span> {
        <span class="hljs-comment">//  </span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewTwoLoading</span><span class="hljs-params">()</span></span> {}<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewTwoSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Users</span>?)</span></span> {}<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewTwoError</span><span class="hljs-params">(error: <span class="hljs-type">Error</span>?)</span></span> {<font></font>
        error?.let {<font></font>
            Toast.makeText(applicationContext, error.errorMsg, Toast.LENGTH_SHORT).show()<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja475586/index.html">AudioContext APIによるコンピュータのサウンドフィンガープリント</a></li>
<li><a href="../ja475588/index.html">3つのパラダイム</a></li>
<li><a href="../ja475590/index.html">Notepad ++を使用したプログラムのコンパイル</a></li>
<li><a href="../ja475594/index.html">面白いJavaScript：ほぼ線形の方程式</a></li>
<li><a href="../ja475596/index.html">少数のシステムで証明された大きな素数の仮説</a></li>
<li><a href="../ja475600/index.html">プロメテウスとのつながり方</a></li>
<li><a href="../ja475604/index.html">Zabbix 4.4での公式PostgreSQLテンプレートの設定</a></li>
<li><a href="../ja475608/index.html">Googleタグマネージャー：わかりにくい、便利なトリガー設定</a></li>
<li><a href="../ja475610/index.html">視覚を保持する安全なLEDテーブルランプ</a></li>
<li><a href="../ja475612/index.html">与えられたとき、主張と実装の信頼性</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>