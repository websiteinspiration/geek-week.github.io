<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ›€ğŸ¼ ğŸ ğŸ‘¼ğŸ½ ä¸€é€£ã®ViewModel + LiveDataã€Retrofit +ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’å‚™ãˆãŸAndroidã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®å˜ç´”ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç·¨æˆ ğŸ‘©ğŸ¾â€âš–ï¸ ğŸŒ° ğŸ‘¨ğŸ½â€ğŸ“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="é•·ã„ç´¹ä»‹ãªã—ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾¿åˆ©ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ã™ã°ã‚„ãç°¡å˜ã«æ•´ç†ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚ã“ã®ãƒãƒ†ãƒªã‚¢ãƒ«ã¯ã€mvvmãƒ‘ã‚¿ãƒ¼ãƒ³ã¨Kotlinã‚³ãƒ«ãƒ¼ãƒãƒ³ã«æ…£ã‚Œã¦ã„ãªã„äººã«å½¹ç«‹ã¡ã¾ã™ã€‚
 
 ã—ãŸãŒã£ã¦ã€ç§ãŸã¡ã«ã¯å˜ç´”ãªã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¦æ±‚ã‚’å—ä¿¡ã—ã¦â€‹â€‹å‡¦ç†ã™ã‚‹ã«ã¯ã€çµæœã‚’ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤º...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä¸€é€£ã®ViewModel + LiveDataã€Retrofit +ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’å‚™ãˆãŸAndroidã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®å˜ç´”ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç·¨æˆ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475598/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é•·ã„ç´¹ä»‹ãªã—ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾¿åˆ©ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ã™ã°ã‚„ãç°¡å˜ã«æ•´ç†ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒãƒ†ãƒªã‚¢ãƒ«ã¯ã€mvvmãƒ‘ã‚¿ãƒ¼ãƒ³ã¨Kotlinã‚³ãƒ«ãƒ¼ãƒãƒ³ã«æ…£ã‚Œã¦ã„ãªã„äººã«å½¹ç«‹ã¡ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ãŸãŒã£ã¦ã€ç§ãŸã¡ã«ã¯å˜ç´”ãªã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¦æ±‚ã‚’å—ä¿¡ã—ã¦â€‹â€‹å‡¦ç†ã™ã‚‹ã«ã¯ã€çµæœã‚’ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼šã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ï¼ˆãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼‰ã‹ã‚‰ç›®çš„ã®ãƒ¡ã‚½ãƒƒãƒ‰ViewModel-&gt; ViewModelã‚’å‘¼ã³å‡ºã—ã¦æ”¹é€ ãƒãƒ³ãƒ‰ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’ä»‹ã—ã¦è¦æ±‚ã‚’å®Ÿè¡Œã—ã¾ã™-&gt;å¿œç­”ã¯ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦ãƒ©ã‚¤ãƒ–ãƒ‡ãƒ¼ã‚¿ã«é€ä¿¡ã•ã‚Œã¾ã™-&gt;ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã™ã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã§ã€‚</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾å­˜é–¢ä¿‚</font></font></h4><br>
<pre><code class="javascript hljs">    <span class="hljs-comment">//Retrofit</span>
    implementation <span class="hljs-string">'com.squareup.retrofit2:retrofit:2.6.2'</span>
    implementation <span class="hljs-string">'com.squareup.retrofit2:converter-gson:2.6.2'</span>
    implementation <span class="hljs-string">'com.squareup.okhttp3:logging-interceptor:4.2.1'</span><font></font>
<font></font>
    <span class="hljs-comment">//Coroutines</span>
    implementation <span class="hljs-string">'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.0'</span>
    implementation <span class="hljs-string">'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.0'</span><font></font>
<font></font>
    <span class="hljs-comment">//ViewModel lifecycle</span>
    implementation <span class="hljs-string">'androidx.lifecycle:lifecycle-extensions:2.1.0'</span>
    implementation <span class="hljs-string">"androidx.lifecycle:lifecycle-viewmodel-ktx:2.2.0-rc01"</span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ</font></font></h4><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">...</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.INTERNET"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾Œä»˜ã‘ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kotlinovsky </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã‚ŒãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãªã‚Šã¾ã™</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€‚ç†è§£ã‚’å®¹æ˜“ã«ã™ã‚‹ãŸã‚ã«</font><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³</font><font style="vertical-align: inherit;">UPDã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®åè»¢ã‚’ä½¿ç”¨ã™ã‚‹æ–¹ãŒé©åˆ‡ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯åˆ¥ã®ãƒˆãƒ”ãƒƒã‚¯ã§ã™ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">object</span> NetworkService {<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> BASE_URL = <span class="hljs-string">" http://www.mocky.io/v2/"</span><font></font>
<font></font>
    <span class="hljs-comment">// HttpLoggingInterceptor      </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> loggingInterceptor = run {
        <span class="hljs-keyword">val</span> httpLoggingInterceptor = HttpLoggingInterceptor()<font></font>
        httpLoggingInterceptor.apply {<font></font>
            httpLoggingInterceptor.level = HttpLoggingInterceptor.Level.BODY<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> baseInterceptor: Interceptor = invoke { chain -&gt;
        <span class="hljs-keyword">val</span> newUrl = chain<font></font>
            .request()<font></font>
            .url<font></font>
            .newBuilder()<font></font>
            .build()<font></font>
<font></font>
        <span class="hljs-keyword">val</span> request = chain<font></font>
                .request()<font></font>
                .newBuilder()<font></font>
                .url(newUrl)<font></font>
                .build()<font></font>
<font></font>
        <span class="hljs-keyword">return</span><span class="hljs-symbol">@invoke</span> chain.proceed(request)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> client: OkHttpClient = OkHttpClient<font></font>
            .Builder()<font></font>
            .addInterceptor(loggingInterceptor)<font></font>
            .addInterceptor(baseInterceptor)<font></font>
            .build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">retrofitService</span><span class="hljs-params">()</span></span>: Api {
        <span class="hljs-keyword">return</span> Retrofit.Builder()<font></font>
                .baseUrl(BASE_URL)<font></font>
                .addConverterFactory(GsonConverterFactory.create())<font></font>
                .client(client)<font></font>
                .build()<font></font>
                .create(Api::<span class="hljs-keyword">class</span>.java)<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½ã®ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥½ã—ã¿ã‚’ä¸€æ™‚åœæ­¢ã—ã€ã“ã“ã§ã‚³ãƒ«ãƒãƒ³ã®é­”æ³•ã‚’é–‹å§‹ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é–¢æ•°ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«</font></font><b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€suspend</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fun ...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’ãƒãƒ¼ã‚¯ã—</font><b><font style="vertical-align: inherit;">ã¾ã™</font></b><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ”¹é€ ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³2.6.0ã‹ã‚‰Kotlinã‚µã‚¹ãƒšãƒ³ãƒ‰æ©Ÿèƒ½ã‚’æ“ä½œã™ã‚‹ã“ã¨ã‚’å­¦ã³ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¦æ±‚ã‚’ç›´æ¥å®Ÿè¡Œã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Api</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@GET(<span class="hljs-meta-string">"5dcc12d554000064009c20fc"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">(
        <span class="hljs-meta">@Query(<span class="hljs-meta-string">"page"</span>)</span> page: <span class="hljs-type">Int</span>
    )</span></span>: ResponseWrapper&lt;Users&gt;<font></font>
<font></font>
    <span class="hljs-meta">@GET(<span class="hljs-meta-string">"5dcc147154000059009c2104"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsersError</span><span class="hljs-params">(
        <span class="hljs-meta">@Query(<span class="hljs-meta-string">"page"</span>)</span> page: <span class="hljs-type">Int</span>
    )</span></span>: ResponseWrapper&lt;Users&gt;<font></font>
}<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ResponseWrapper</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å˜ç´”ãªãƒ©ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹ã§ã™ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResponseWrapper</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">Serializable {</span></span>
    <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"response"</span>)</span>
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T? = <span class="hljs-literal">null</span>
    <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"error"</span>)</span>
    <span class="hljs-keyword">val</span> error: Error? = <span class="hljs-literal">null</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ—¥ä»˜ã‚¯ãƒ©ã‚¹ã®</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼</font></font></b><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Users</span></span>(
    <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"count"</span>)</span>
    <span class="hljs-keyword">var</span> count: <span class="hljs-built_in">Int</span>?,
    <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"items"</span>)</span>
    <span class="hljs-keyword">var</span> items: List&lt;Item?&gt;?<font></font>
) {<font></font>
    <span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Item</span></span>(
        <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"first_name"</span>)</span>
        <span class="hljs-keyword">var</span> firstName: String?,
        <span class="hljs-meta">@SerializedName(<span class="hljs-meta-string">"last_name"</span>)</span>
        <span class="hljs-keyword">var</span> lastName: String?<font></font>
    )<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ViewModel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã¹ã¦ã®ViewModelãŒç¶™æ‰¿ã•ã‚Œã‚‹</font><font style="vertical-align: inherit;">
æŠ½è±¡</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseViewModel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—</font><b><font style="vertical-align: inherit;">ã¾ã™</font></b><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã“ã§ã•ã‚‰ã«è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseViewModel</span> : <span class="hljs-type">ViewModel</span></span>() {<font></font>
<font></font>
    <span class="hljs-keyword">var</span> api: Api = NetworkService.retrofitService()<font></font>
<font></font>
    <span class="hljs-comment">//       requestWithLiveData  </span>
    <span class="hljs-comment">// requestWithCallback,      </span>
    <span class="hljs-comment">//          </span>
    <span class="hljs-comment">// .       suspend , </span>
    <span class="hljs-comment">//             </span>
    <span class="hljs-comment">//    .     </span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">requestWithLiveData</span><span class="hljs-params">(
        liveData: <span class="hljs-type">MutableLiveData</span>&lt;<span class="hljs-type">Event</span>&lt;<span class="hljs-type">T</span>&gt;&gt;,
        request: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">ResponseWrapper</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {<font></font>
<font></font>
        <span class="hljs-comment">//       </span><font></font>
        liveData.postValue(Event.loading())<font></font>
<font></font>
        <span class="hljs-comment">//     ViewModel,  viewModelScope.</span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-comment">//    .</span>
        <span class="hljs-comment">//   IO    </span>
        <span class="hljs-keyword">this</span>.viewModelScope.launch(Dispatchers.IO) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> response = request.invoke()
                <span class="hljs-keyword">if</span> (response.<span class="hljs-keyword">data</span> != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">//     postValue  IO </span>
                    liveData.postValue(Event.success(response.<span class="hljs-keyword">data</span>))<font></font>
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response.error != <span class="hljs-literal">null</span>) {<font></font>
                    liveData.postValue(Event.error(response.error))<font></font>
                }<font></font>
            } <span class="hljs-keyword">catch</span> (e: Exception) {<font></font>
                e.printStackTrace()<font></font>
                liveData.postValue(Event.error(<span class="hljs-literal">null</span>))<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">requestWithCallback</span><span class="hljs-params">(
        request: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">ResponseWrapper</span>&lt;<span class="hljs-type">T</span>&gt;,
        response: (<span class="hljs-type">Event</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {<font></font>
<font></font>
        response(Event.loading())<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.viewModelScope.launch(Dispatchers.IO) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> res = request.invoke()<font></font>
<font></font>
                <span class="hljs-comment">//   ,    </span>
                <span class="hljs-comment">//       ,  </span>
                <span class="hljs-comment">//    </span>
                <span class="hljs-comment">//    </span>
                <span class="hljs-comment">//  context </span><font></font>
                launch(Dispatchers.Main) {<font></font>
                    <span class="hljs-keyword">if</span> (res.<span class="hljs-keyword">data</span> != <span class="hljs-literal">null</span>) {<font></font>
                        response(Event.success(res.<span class="hljs-keyword">data</span>))<font></font>
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res.error != <span class="hljs-literal">null</span>) {<font></font>
                        response(Event.error(res.error))<font></font>
                    }<font></font>
                }<font></font>
            } <span class="hljs-keyword">catch</span> (e: Exception) {<font></font>
                e.printStackTrace()<font></font>
                <span class="hljs-comment">// UPD (  )   catch     Main </span><font></font>
                launch(Dispatchers.Main) {<font></font>
                    response(Event.error(<span class="hljs-literal">null</span>))<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¤ãƒ™ãƒ³ãƒˆ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Googleã®ã‚¯ãƒ¼ãƒ«ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€æ—¥ä»˜ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ™ãƒ³ãƒˆãƒ©ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹ã«ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã®ã‚¯ãƒ©ã‚¹ã§ã¯ã€é€šå¸¸ã€LOADINGã€SUCCESSã€ERRORã®ã‚ˆã†ãªã„ãã¤ã‹ã®çŠ¶æ…‹ã‚’ã¨ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ </font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event</span>&lt;<span class="hljs-type">out T</span>&gt;</span>(<span class="hljs-keyword">val</span> status: Status, <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T?, <span class="hljs-keyword">val</span> error: Error?) {<font></font>
<font></font>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">loading</span><span class="hljs-params">()</span></span>: Event&lt;T&gt; {
            <span class="hljs-keyword">return</span> Event(Status.LOADING, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">success</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">T</span>?)</span></span>: Event&lt;T&gt; {
            <span class="hljs-keyword">return</span> Event(Status.SUCCESS, <span class="hljs-keyword">data</span>, <span class="hljs-literal">null</span>)<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">error</span><span class="hljs-params">(error: <span class="hljs-type">Error</span>?)</span></span>: Event&lt;T&gt; {
            <span class="hljs-keyword">return</span> Event(Status.ERROR, <span class="hljs-literal">null</span>, error)<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">enum</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Status</span> </span>{<font></font>
    SUCCESS,<font></font>
    ERROR,<font></font>
    LOADING<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚ŒãŒã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã™ã‚‹ã‹ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸­ã«ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒLOADINGã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã‚’å¾…ã£ã¦ã‹ã‚‰ã€ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ©ãƒƒãƒ—ã—ã€æŒ‡å®šã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ã•ã‚‰ã«é€ä¿¡ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ“ãƒ¥ãƒ¼ã§ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ã‚¤ãƒ—ã‚’ç¢ºèªã—ã€çŠ¶æ…‹ã«å¿œã˜ã¦ã€ãƒ“ãƒ¥ãƒ¼ã«ç•°ãªã‚‹çŠ¶æ…‹ã‚’è¨­å®šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã»ã¼åŒã˜å“²å­¦ã¯å»ºç¯‰ãƒ‘ã‚¿ãƒ¼ãƒ³MVIã«åŸºã¥ã„ã¦ã„ã¾ã™</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ActivityViewModel</font></font></h3><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActivityViewModel</span> : <span class="hljs-type">BaseViewModel</span></span>() {<font></font>
<font></font>
    <span class="hljs-comment">//      </span>
    <span class="hljs-keyword">val</span> simpleLiveData = MutableLiveData&lt;Event&lt;Users&gt;&gt;()<font></font>
   <font></font>
    <span class="hljs-comment">//  .     requestWithLiveData</span>
    <span class="hljs-comment">//  BaseViewModel     , </span>
    <span class="hljs-comment">//         </span>
    <span class="hljs-comment">//     api.getUsers</span>
    <span class="hljs-comment">//         </span>
    <span class="hljs-comment">//   </span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">(page: <span class="hljs-type">Int</span>)</span></span> {<font></font>
        requestWithLiveData(simpleLiveData) {<font></font>
            api.getUsers(<font></font>
                page = page<font></font>
            )<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//  ,      </span>
    <span class="hljs-comment">// UPD          </span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsersError</span><span class="hljs-params">(page: <span class="hljs-type">Int</span>, callback: (<span class="hljs-type">data</span>: <span class="hljs-type">Event</span>&lt;<span class="hljs-type">Users</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {<font></font>
        requestWithCallback({<font></font>
            api.getUsersError(<font></font>
                page = page<font></font>
            )<font></font>
        }) {<font></font>
            callback(it)<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦æœ€å¾Œã«</font></font><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸»ãªæ´»å‹•</font></font></h3><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() {<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> activityViewModel: ActivityViewModel<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<font></font>
        setContentView(R.layout.activity_main)<font></font>
<font></font>
        activityViewModel = ViewModelProviders.of(<span class="hljs-keyword">this</span>).<span class="hljs-keyword">get</span>(ActivityViewModel::<span class="hljs-keyword">class</span>.java)<font></font>
        observeGetPosts()<font></font>
<font></font>
        buttonOneClickListener()<font></font>
        buttonTwoClickListener()<font></font>
    }<font></font>
<font></font>
    //    <font></font>
    //        <font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">fun</span> observeGetPosts() {<font></font>
        activityViewModel.simpleLiveData.observe(this, Observer {<font></font>
            <span class="hljs-keyword">when</span> (it.status) {<font></font>
                Status.LOADING -&gt; viewOneLoading()<font></font>
                Status.SUCCESS -&gt; viewOneSuccess(it.<span class="hljs-keyword">data</span>)<font></font>
                Status.ERROR -&gt; viewOneError(it.error)<font></font>
            }<font></font>
        })<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">fun</span> buttonOneClickListener() {<font></font>
        btn_test_one.setOnClickListener {<font></font>
            activityViewModel.getUsers(page = <span class="hljs-number">1</span>)<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//      ,  </span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buttonTwoClickListener</span><span class="hljs-params">()</span></span> {<font></font>
        btn_test_two.setOnClickListener {<font></font>
            activityViewModel.getUsersError(page = <span class="hljs-number">2</span>) {
                <span class="hljs-keyword">when</span> (it.status) {<font></font>
                    Status.LOADING -&gt; viewTwoLoading()<font></font>
                    Status.SUCCESS -&gt; viewTwoSuccess(it.<span class="hljs-keyword">data</span>)<font></font>
                    Status.ERROR -&gt; viewTwoError(it.error)<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewOneLoading</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">//  ,   </span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewOneSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Users</span>?)</span></span> {
        <span class="hljs-keyword">val</span> usersList: MutableList&lt;Users.Item&gt;? = <span class="hljs-keyword">data</span>?.items <span class="hljs-keyword">as</span> MutableList&lt;Users.Item&gt;?<font></font>
        usersList?.shuffle()<font></font>
        usersList?.let {<font></font>
            Toast.makeText(applicationContext, <span class="hljs-string">"<span class="hljs-subst">${it}</span>"</span>, Toast.LENGTH_SHORT).show()<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewOneError</span><span class="hljs-params">(error: <span class="hljs-type">Error</span>?)</span></span> {
        <span class="hljs-comment">//  </span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewTwoLoading</span><span class="hljs-params">()</span></span> {}<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewTwoSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Users</span>?)</span></span> {}<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">viewTwoError</span><span class="hljs-params">(error: <span class="hljs-type">Error</span>?)</span></span> {<font></font>
        error?.let {<font></font>
            Toast.makeText(applicationContext, error.errorMsg, Toast.LENGTH_SHORT).show()<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚½ãƒ¼ã‚¹</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja475586/index.html">AudioContext APIã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ã‚µã‚¦ãƒ³ãƒ‰ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ</a></li>
<li><a href="../ja475588/index.html">3ã¤ã®ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ </a></li>
<li><a href="../ja475590/index.html">Notepad ++ã‚’ä½¿ç”¨ã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«</a></li>
<li><a href="../ja475594/index.html">é¢ç™½ã„JavaScriptï¼šã»ã¼ç·šå½¢ã®æ–¹ç¨‹å¼</a></li>
<li><a href="../ja475596/index.html">å°‘æ•°ã®ã‚·ã‚¹ãƒ†ãƒ ã§è¨¼æ˜ã•ã‚ŒãŸå¤§ããªç´ æ•°ã®ä»®èª¬</a></li>
<li><a href="../ja475600/index.html">ãƒ—ãƒ­ãƒ¡ãƒ†ã‚¦ã‚¹ã¨ã®ã¤ãªãŒã‚Šæ–¹</a></li>
<li><a href="../ja475604/index.html">Zabbix 4.4ã§ã®å…¬å¼PostgreSQLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¨­å®š</a></li>
<li><a href="../ja475608/index.html">Googleã‚¿ã‚°ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼šã‚ã‹ã‚Šã«ãã„ã€ä¾¿åˆ©ãªãƒˆãƒªã‚¬ãƒ¼è¨­å®š</a></li>
<li><a href="../ja475610/index.html">è¦–è¦šã‚’ä¿æŒã™ã‚‹å®‰å…¨ãªLEDãƒ†ãƒ¼ãƒ–ãƒ«ãƒ©ãƒ³ãƒ—</a></li>
<li><a href="../ja475612/index.html">ä¸ãˆã‚‰ã‚ŒãŸã¨ãã€ä¸»å¼µã¨å®Ÿè£…ã®ä¿¡é ¼æ€§</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>