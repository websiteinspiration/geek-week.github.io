<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë®üèª ‚õπüèæ üë®‚Äçüé® Custom-made: a story about how a line of code turned into kilotons of coal ü§≤üèº ü§ôüèº üë©üèø‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Brad's phone burst into the familiar trill of an office call. 
 
 - Yes? He barked, picking up the phone. - What do you want? 
 
 By the standards of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Custom-made: a story about how a line of code turned into kilotons of coal</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/digital-ecosystems/blog/501536/"><img src="https://habrastorage.org/webt/vf/7f/mt/vf7fmthf1wdqwbwh8pdjpic4sli.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brad's phone burst into the familiar trill of an office call. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Yes? He barked, picking up the phone. - What do you want? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the standards of Brad, such a way of communicating over the phone was, in fact, considered even polite. As the Chief Trader of ecxecor, one of the largest energy trading companies in the world, Brad was not going to please anyone, and he considered any manifestation of feelings, except arrogant mockery, as a sign of weakness. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚ÄúUh,‚Äù said the obviously nervous secretary, ‚Äúhere you are ... uh ... delivery.‚Äù They ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚Äù‚Äú Pf, ‚ÄùBrad snorted, breaking her off at a glance. - Well, sign for her! Or is it so hard? Can‚Äôt you handle it yourself?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚ÄúYou see,‚Äù the secretary said, ‚Äúthey ask me to explain how to moor.‚Äù </font><font style="vertical-align: inherit;">And we also need to pay a mooring fee. </font><font style="vertical-align: inherit;">They say that you are in the know. </font><font style="vertical-align: inherit;">I do not understand anything. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚ÄúOkay,‚Äù Brad grumbled. </font><font style="vertical-align: inherit;">- It seems, and the truth, everything here you need to do yourself.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He threw the phone and left his corner office. </font><font style="vertical-align: inherit;">Despite the fact that √Üxecor's residence was located in an area adjacent to the old marina, their office was considered one of the most luxurious in the city. </font><font style="vertical-align: inherit;">At one end of the spacious building, which used to be a warehouse, bosses' offices were located, at the other ‚Äî Brad was going there and headed ‚Äî there was a reception room, whose windows overlooked the company‚Äôs personal pier near the river itself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Well, here I am! </font><font style="vertical-align: inherit;">He announced angrily, barely crossing the threshold of the hall. </font><font style="vertical-align: inherit;">- Come on, lay it out. </font><font style="vertical-align: inherit;">What should I ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brad stopped short before finishing the sentence. His gaze immediately shifted to the spectacle on the pier near the √Üxecor office, which opened through high, floor-to-ceiling windows. There was a monstrous-sized barge ‚Äî no, an entire armada of securely fastened barges filled to the brim with heaps of coal. All this armada intended to moor at the pier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚ÄúWhat the fuck ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚Äù ‚ÄúAnd you must be Brad,‚Äù came a peppy voice. Brad turned his eyes to the shabby-looking peasant in some kind of working clothes, who was sitting on one of the chairs in the waiting room. ‚ÄúWell, for starters, how do we moor?‚Äù I have two stoppers, but you can‚Äôt catch it. And do you have anything ready for unloading?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For once, Brad was speechless. </font><font style="vertical-align: inherit;">He had no idea who this person was, and almost did not understand a word from what he was saying. </font><font style="vertical-align: inherit;">Moreover, this community, gradually approaching the building. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚ÄúUh ...‚Äù he muttered, ‚Äúhey ... did you bring ... coal?‚Äù </font><font style="vertical-align: inherit;">And for us? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Well yes! </font><font style="vertical-align: inherit;">Twenty eight thousand tons of good old black gold! </font><font style="vertical-align: inherit;">- Worker mockingly wrinkled his forehead and added: - Well, unless, of course, the address was not mistaken, haha. </font><font style="vertical-align: inherit;">Is this √Üxecor? </font><font style="vertical-align: inherit;">Berth number fifty three? </font><font style="vertical-align: inherit;">Are you Brad, the same guy who ordered it? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then Brad's hand met in a split second with Brad's face. </font><font style="vertical-align: inherit;">He realized that something had gone very wrong according to plan, and instead of selling twenty-eight thousand tons of coal virtually, he somehow got them in his hands</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A short course in commodity futures trading</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you have ever watched the </font><font style="vertical-align: inherit;">1983 </font><font style="vertical-align: inherit;">classic " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Swap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " movie with Eddie Murphy and Dan Ackroyd in the lead roles, you can already imagine how the raw materials are sold. In its most general terms, commodities - for example, gold, wool, soybeans - are sold by manufacturers and, ultimately, reach customers. But Billy Ray Valentine made his money and busted the Duke brothers by not just selling frozen concentrated orange juice from a tray. He managed to break into the market due to the fact that he sold and bought up futures contracts. In fact, this is the only way commodity trading is carried out.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Futures contracts are a fairly transparent thing: you agree to purchase goods in quantities of X at a price of Y per unit at a certain point in the future. Of course, it may seem strange that a person decides to buy twenty tons of brisket for $ 34,420 in April (even if he loves brisket very much), but the bottom line is that he intends to sell this delivery long before the beginning of April and for an amount significantly exceeding 34 420 $. Almost any product that you can imagine is sold and bought in this way even before the start of production. The point of such a trading scheme is that the risks (and benefits) caused by fluctuations in commodity prices are no longer given to producers (farmers, miners, etc.), but to traders.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, commodity traders are not at all interested in staying with kilotons of brisket in their hands. Therefore, a whole chain of intermediaries ‚Äî brokers, stock exchanges, clearing houses ‚Äî that work in the sweat of their faces, is included in the process, so that the person who says: ‚ÄúIn May I will buy three hundred tons of brisket for $ 518,000‚Äù, I can be sure that I will not buy it in May three hundred tons of brisket for $ 518,000 in the literal sense of these words.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brokers, for example, organize circular transactions, suggesting that every futures contract purchased will be compensated by selling the corresponding contract to a person who is really interested in the product. </font><font style="vertical-align: inherit;">The automated trading systems used by exchanges have built-in codes of practice to catch obvious errors (for example, the delivery of large quantities of goods to the territory of a commercial enterprise). </font><font style="vertical-align: inherit;">And finally, clearing houses once again verify transactions to make sure that nothing is sent in error. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on the foregoing, it is almost impossible for a trader to be the actual owner of the goods that he buys. </font><font style="vertical-align: inherit;">Nearly.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Like clockwork</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Üxecor only traded coal on one exchange (WTFSE), and coal transactions did not take place very often. Accordingly, when WTFSE introduced a new API that turned to the user and was based on web services, the internal trading system was unable to interact with it. A couple of coal deals loomed on the horizon, so the company had a small problem looming. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, there were a couple of self-taught programmers in √Üxecor and they managed to put together a solution that got along well with the new WTFSE API. In essence, the programmer added some XML code to the trading requests. In particular, there was such a fragment:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">AdditionalProperties</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">PhysicallyDeliver</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">PhysicallyDeliver</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">AdditionalProperties</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Find nothing strange in this XML code? If you answered: "The value should not be False, but 0", you can pat yourself on the shoulder. As it turned out, the WTFSE system perceived only 1 and 0 to denote True and False, respectively; any other value was simply automatically equated to one. Oops! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, in normal circumstances, a big disaster would not have come out of this. To make sure that everything is accurate in the transaction, WTFSE (and any other exchange) sends a transaction confirmation to the client, where all the source information is written in XML. Thus, both parties have access to data. On the √Üxecor side, everything looked completely safe, primarily due to the following lines in the code:</font></font><br>
<br>
<pre><code class="xml hljs"><font></font>
bool physicallyDeliver = <font></font>
    (getNodeVal("PhysicallyDeliver").toLower() == "true");</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well done, the developer did verification ... only a line can give much more values ‚Äã‚Äãthan true or false. Let's say 1 or 0. Oops. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But even the fact that the wrong transaction by mistake passed verification, in theory, is not yet a disaster, because the clearing house would have noticed that something was fundamentally wrong with it. You can‚Äôt just call the FedEx delivery service and ask them to take several thousand tons of raw materials to some office building in the business center. The list of points where you can deliver raw materials is very limited - usually these are warehouses near depots or ports. However, the √Üxecor residence was located near the fifty-three pier in the coastal area with storage facilities, which has recently undergone renovation - at first glance, it is a reasonable place to deliver a whole pile of coal, especially from the point of view of the machine. Oops</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, the commodity futures trading market does not rely entirely on software. On both sides of the transaction (and also in a pair of intermediate points), the data passes through the employees of the operational departments who check to see if the trader has done any stupid things: for example, accidentally ticked the box ‚Äúphysical delivery‚Äù, entered the group transaction, which immediately will give a loss, and so on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since so many people are viewing transactions, it would be logical to assume that at least someone noticed that the trading giant √Üxecor asks physically to deliver them a load of coal for one and a half million dollars. Yes, someone probably noticed, but Brad was engaged in the deal, which means it was impossible to conceive that there was some kind of misunderstanding.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As the Chief Trader of xecor, Brad conveyed to everyone with utmost clarity: no one, ‚Äúeven His Holiness the Pope of Rome‚Äù dares to question his actions. </font><font style="vertical-align: inherit;">In the end, Brad has to make the most difficult bidding decisions that no one else can comprehend. </font><font style="vertical-align: inherit;">Sometimes he buys expensive, and sells cheaply. </font><font style="vertical-align: inherit;">Sometimes it holds the goods, although the price falls. </font><font style="vertical-align: inherit;">Sometimes he refuses to sell it at all regardless of the price. </font><font style="vertical-align: inherit;">Brad‚Äôs paths are mysterious, and if he says: ‚ÄúDo it!‚Äù, Then it‚Äôs better to do it.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Early christmas</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚ÄúJust don‚Äôt tell me that it‚Äôs not your coal,‚Äù sensing that the matter was unclean, the worker took a defensive position. - Do you need it, do not need it - understand it yourself. But your coal, Mr. Brad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brad would be glad to object, but he himself understood: his coal. Even worse, he over and over again confidently confirmed this to the √Üxecor operations department. He simply assumed that it was typical for him that these stupid paper-shifters could not really read. He mentally went back to his last conversation with a coal purchase department employee (‚ÄúI told you to get a fucking deal, what word do you not understand?‚Äù) And lost in thought about what to do with fifty-six million pounds of coal in its physical embodiment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Try to imagine for a moment how you yourself would get away with a pile of coal worth one and a half million dollars. Even Craigslist features still have limits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As it turned out, selling real coal was even more difficult than Brad could have imagined. The commodity market, in fact, trades with futures alone - everyone who needs twenty-eight thousand tons of coal at the moment has already bought it in advance. Anyway, who will buy coal from some obscure type named Brad? In the end, spending sky-high sums on berthage, delivery, environmental tax, docking, unloading, loading and other duties, Brad heartbroken in half sold coal at twenty cents to the dollar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After this ‚Äúgrandiose purchase‚Äù, Brad‚Äôs mountain of coal was never forgotten. </font><font style="vertical-align: inherit;">Each time, passing by colleagues in the corridor, he knew that they remember about coal, and they knew that he understood this. </font><font style="vertical-align: inherit;">No one particularly mocked or made fun of him, but it did not matter. </font><font style="vertical-align: inherit;">Brad was no longer perceived as the ecxecor Chief Trader, he became the guy who mistakenly bought a breakthrough of coal.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501522/index.html">Free Skillbox Webinars: Writing Games in PHP, Unity and Unreal Engine</a></li>
<li><a href="../en501524/index.html">Secrets of synchronizing the electromagnetic fields of the Earth and a living organism</a></li>
<li><a href="../en501526/index.html">Why Canadian English is considered "dirty" and what does Keanu Reeves have to do with it?</a></li>
<li><a href="../en501528/index.html">The book "Bash and cybersecurity: attack, defense and analysis from the Linux command line"</a></li>
<li><a href="../en501534/index.html">Now with COVID-19 there is also a rash</a></li>
<li><a href="../en501538/index.html">Indentation in Python - Solution Option</a></li>
<li><a href="../en501544/index.html">Perfect smartphone</a></li>
<li><a href="../en501546/index.html">‚ÄúWhy am I going through this?‚Äù - psychologists explain how to find meaning in isolation</a></li>
<li><a href="../en501548/index.html">Dorofei Proleskovsky: ‚ÄúThe only mapping project in which it makes sense to invest your time and energy is OSM‚Äù</a></li>
<li><a href="../en501554/index.html">We are building a personal account for the SaaS service for security</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>