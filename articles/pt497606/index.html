<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßìüèø üëÜüèΩ ü§û Sistema de rega autom√°tica para jardim para Home Assistant, ESP8266 e MiFlora üßëüèª‚Äçü§ù‚Äçüßëüèª üèÜ üïØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Algum tempo atr√°s, minha fam√≠lia tinha uma casa com um pequeno jardim em um local muito quente e √°rido, e enfrent√°vamos o problema de regar regularmen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sistema de rega autom√°tica para jardim para Home Assistant, ESP8266 e MiFlora</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497606/"><img src="https://habrastorage.org/webt/87/-y/wi/87-ywilifgui1kkhe06izsbt7ag.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algum tempo atr√°s, minha fam√≠lia tinha uma casa com um pequeno jardim em um local muito quente e √°rido, e enfrent√°vamos o problema de regar regularmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Queria que o sistema de irriga√ß√£o fosse autom√°tico, ao escolher, tive que levar em considera√ß√£o as seguintes condi√ß√µes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √°gua muito cara que deve ser economizada de todas as formas dispon√≠veis </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plantas diferentes no jardim para necessidades de umidade, de suculentas a amantes da umidade</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a necessidade de rega totalmente aut√¥noma durante a aus√™ncia de pessoas na casa, de prefer√™ncia com a possibilidade de controle remoto </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> clima √°rido que n√£o perdoa erros de irriga√ß√£o</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de avaliar as solu√ß√µes prontas encontradas nas redes locais de bricolage e na Amazon e ler resenhas sobre sua confiabilidade (geralmente n√£o a mais alta), decidimos tentar fazer algo por conta pr√≥pria. </font></font><br>
<a name="habracut"></a><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isen√ß√£o de responsabilidade: o autor n√£o √© especialista em TI e n√£o afirma ser um conhecimento profissional do t√≥pico. </font><font style="vertical-align: inherit;">O n√≠vel de execu√ß√£o do projeto √© um hobby. </font><font style="vertical-align: inherit;">O autor est√° ciente do n√≠vel de seu conhecimento em programa√ß√£o e eletr√¥nica e agradecer√° muito as sugest√µes para melhorar e otimizar as solu√ß√µes utilizadas.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama de circuito</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O jardim foi dividido em 4 zonas de irriga√ß√£o, cada uma delas equipada com um sensor individual de umidade do solo e pode ser regada de acordo com uma programa√ß√£o individual e com uma quantidade diferente de √°gua. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No solo, s√£o instalados tubos PND de irriga√ß√£o por gotejamento com perfura√ß√£o, os quais s√£o conectados aos tubos que convergem na unidade de coleta de √°gua e conectados atrav√©s das v√°lvulas eletromagn√©ticas ao suprimento de √°gua. </font><font style="vertical-align: inherit;">As v√°lvulas s√£o controladas por rel√©s conectados ao ESP8266 (Sonoff 4Ch). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A rega √© realizada por temporizadores, √† noite, para aumentar a quantidade de √°gua absorvida pelo solo e n√£o ser√° evaporada pelo sol. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hor√°rio de rega programado, √© verificado o cumprimento de v√°rias condi√ß√µes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> umidade do solo abaixo de um valor predeterminado </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o h√° precipita√ß√£o prevista em uma quantidade suficientemente grande para os pr√≥ximos 2 dias </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limite de √°gua para irriga√ß√£o definido para esta linha n√£o √© excedido</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipamento usado</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Torta de framboesa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o HassIO instalado (j√° tinha) o </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32 DevKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um firmware ESPHome, atuando como um gateway bluetooth para o MiFlora e recebendo dados de sensores de umidade com fio. </font><font style="vertical-align: inherit;">Localizado no jardim. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Umidade Wired sensores </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capacitivos Soil Moisture Sensor v1.2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que medem a humidade nas zonas de rega mais pr√≥ximas do local ESP32 instala√ß√£o. MiFlora </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sensores est√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conectados √† ESP32 via BLE, que medem a umidade em zonas de rega remoto. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O SONOFF 4Ch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , costurado com ESPHome, est√° localizado na unidade de entrada de √°gua, onde tubos de todas as zonas de rega v√™m </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 v√°lvulas solen√≥ides normalmente fechadas para 220V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localizado no suporte de √°gua e conectado ao Sonoff 4Ch. Abra o suprimento de √°gua para irriga√ß√£o. Um modelo normalmente fechado foi escolhido para que a probabilidade de ‚Äúinunda√ß√£o‚Äù no evento de qualquer falha nos componentes eletr√¥nicos e eletr√¥nicos fosse m√≠nima e para minimizar o n√∫mero de sa√≠das de rel√© necess√°rias. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> medidor de </font><b><font style="vertical-align: inherit;">√°gua pulsado</font></b><font style="vertical-align: inherit;"> na entrada do sistema de irriga√ß√£o na unidade de entrada de √°gua e conectado ao Sonoff 4ch. Permitido transferir totalmente os dados do fluxo de √°gua para o Home Asssistant e implementar a funcionalidade de irriga√ß√£o com uma determinada quantidade. Foi muito bem-sucedido que nesta vers√£o do sonoff os contatos do firmware j√° estavam soldados e at√© havia um GPIO02 gratuito - um contador de pulsos estava pendurado nele.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/zz/d9/eczzd9zfq4drf8katpm4ofyn0b4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece um coletor com v√°lvulas instaladas e um medidor de √°gua. </font><font style="vertical-align: inherit;">O controlador (sonoff 4Ch) n√£o entrou no quadro, ele √© instalado a uma dist√¢ncia de meio metro na blindagem IP65</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√µes do ESPHome e do Assistente para Casa</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonoff 4ch</font></font></b><div class="spoiler_text"> ESPHome    ,     :<br>
<br>
<pre><code class="xml hljs">switch:<font></font>
  - platform: gpio<font></font>
    name: "   1"<font></font>
    pin: GPIO12<font></font>
    id: sw1<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   2"<font></font>
    pin: GPIO5<font></font>
    id: sw2<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   3"<font></font>
    pin: GPIO4<font></font>
    id: sw3<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   4"<font></font>
    pin: GPIO15<font></font>
    id: sw4<font></font>
    icon: mdi:water<font></font>
binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: button<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor capacitivo de umidade do solo v1.2</font></font></b><div class="spoiler_text">   ESPHome:<br>
<br>
<pre><code class="xml hljs">sensor:<font></font>
  - platform: adc<font></font>
    pin: GPIO34<font></font>
    filters:<font></font>
      - lambda: |-<font></font>
          if (x &gt; 3.22) {<font></font>
            return 0;<font></font>
          } else if (x <span class="hljs-tag">&lt; <span class="hljs-attr">1.65</span>) {
            <span class="hljs-attr">return</span> <span class="hljs-attr">100</span>;
          } <span class="hljs-attr">else</span> {
            <span class="hljs-attr">return</span> (<span class="hljs-attr">3.22-x</span>) / (<span class="hljs-attr">3.22-1.65</span>) * <span class="hljs-attr">100.0</span>;
          }
    <span class="hljs-attr">name:</span> "   <span class="hljs-attr">1</span>  "
    <span class="hljs-attr">update_interval:</span> <span class="hljs-attr">60s</span>
    <span class="hljs-attr">attenuation:</span> <span class="hljs-attr">11db</span>
    <span class="hljs-attr">unit_of_measurement:</span> "%"
    <span class="hljs-attr">accuracy_decimals:</span> <span class="hljs-attr">0</span>
    <span class="hljs-attr">icon:</span> <span class="hljs-attr">mdi:water-percent</span>
</span></code></pre><br>
       (ADC)  <br>
  ,        (   3.22 )     (1,65 ).      log'   ESPHome  HassIO            .<br>
<br>
<img src="https://habrastorage.org/webt/sb/tf/b4/sbtfb4ckgxx7kltxe6kk8a5q0r4.png"><br>
<br>
  ESP32  Home Assistant    ,         <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medidor de √°gua de pulso</font></font></b><div class="spoiler_text">   ¬´¬ª,          (   ).       ‚Äî      ,   ,        (  ‚Äî  3   10 ). <br>
,      GND    GPIO      .<br>
<br>
  ESPHome   : <br>
<br>
<pre><code class="xml hljs">binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: counter<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
 Home Assistant   :<br>
<br>
     (counter),       <br>
          (,   ¬´¬ª  ).      ‚Äî  counter,              ESPHome,   sensor,          counter (       ).<br>
<br>
           2      ‚Äî    ,    ¬´¬ª.       ,   ,                      . <br>
<br>
<div class="spoiler"><b class="spoiler_title">    ( automations.yaml   )</b><div class="spoiler_text"><pre><code class="xml hljs">- alias:     <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_counter<font></font>
    service: counter.increment<font></font>
- alias:    1 <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: switch.sistema_poliva_liniia_1<font></font>
      state: 'on'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_line1, counter.my_water_line1t<font></font>
    service: counter.increment    <font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml    +      </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
      water_counter:    <font></font>
        unit_of_measurement: 'M3'<font></font>
        value_template: "{{ (states('counter.my_water_counter')| float)/1000 }}"    <font></font>
counter:<font></font>
  my_water_counter:<font></font>
    initial: 2.667<font></font>
    step: 10<font></font>
  my_water_line1:<font></font>
    name: " 1     ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
  my_water_line1t:<font></font>
    name: " 1   ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
</code></pre><br>
</div></div><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MiFlora Sensor</font></font></b><div class="spoiler_text"> MiFlora   ESPHome   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">esphome.io</a> <br>
 Home Assistant          ‚Äî , ,   ¬´¬ª .   ‚Äî     ,        .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor virtual de chuva</font></font></b><div class="spoiler_text">   ‚Äî          .            ,   . <br>
<br>
       darksky.  ,          Apple        ¬´ ¬ª. API  , ,   ,      ,   HA     .      darksky, ,          .<br>
<br>
  2        :<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml   </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: darksky<font></font>
    api_key: xxxx_your_API_key_xxxx<font></font>
    forecast:<font></font>
      - 1<font></font>
      - 2<font></font>
    monitored_conditions:<font></font>
      - precip_intensity<font></font>
</code></pre><br>
   HA   : sensor.dark_sky_precip_intensity_1d  sensor.dark_sky_precip_intensity_2d,              .<br>
</div></div><br>
       template-sensor:<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml    </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
       rain2days:    <font></font>
        unit_of_measurement: 'mm'<font></font>
        value_template: "{{ (((states('sensor.dark_sky_precip_intensity_2d')| float)+(states('sensor.dark_sky_precip_intensity_1d')| float))*24)| round(3) }}"    <font></font>
</code></pre><br>
 HA  sensor.rain2days          2 . <br>
  ,   Darksky         ,              <br>
</div></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a coleta de todos os dados, voc√™ pode prosseguir diretamente para a rega. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â assim que olho uma parte da interface de uma das zonas do Assistente Domiciliar: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pf/l6/ut/pfl6ut8aoieytcg0kxlk-mjslcu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui voc√™ pode definir a quantidade de √°gua para irriga√ß√£o (com um controle deslizante) e ver os valores dos principais sensores e contadores. </font><font style="vertical-align: inherit;">Eu dei a interface para uma das linhas, para o resto tudo √© o mesmo, apenas nas linhas com sensores de dados com fio √© um pouco menos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na interface, voc√™ pode notar um detalhe "sup√©rfluo" - o sensor auxiliar "A norma foi atingida". </font><font style="vertical-align: inherit;">Tinha que ser introduzido, porque </font><font style="vertical-align: inherit;">N√£o consegui obter condi√ß√£o: o modelo funcionava para interromper a automa√ß√£o quando a norma para a quantidade de √°gua foi atingida e, como resultado, a automa√ß√£o apenas verifica o valor desse sensor. </font><font style="vertical-align: inherit;">Estou certo de que essa parte da automa√ß√£o pode ser mais simples e elegante, mas meu n√≠vel n√£o foi suficiente para isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo est√° o c√≥digo para o sensor de gabarito "muleta" resultante:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor de sufici√™ncia de rega (dentro de configuration.yaml ou um arquivo separado)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">  - platform: template<font></font>
    sensors:<font></font>
      line4_status:<font></font>
        friendly_name: " 4 -  "<font></font>
        value_template: &gt;-<font></font>
          {% if states('counter.my_water_line4t')|float &gt; states('input_number.slider4')|float %}<font></font>
            yes<font></font>
          {% elif states('counter.my_water_line4t')|float == states('input_number.slider4')|float  %}<font></font>
            yes<font></font>
          {% else %}<font></font>
            no<font></font>
          {% endif %}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A automa√ß√£o para iniciar a rega acaba sendo assim:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comece a regar (dentro de automations.yaml ou em um arquivo separado)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4   23.01<font></font>
  trigger:<font></font>
    platform: time<font></font>
    at: "23:01:00"<font></font>
  condition:<font></font>
   condition: and<font></font>
   conditions:<font></font>
#    <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.rainfor2days<font></font>
      below: 5<font></font>
#      <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.miflora_1_moisture<font></font>
      below: 50<font></font>
# ,       <font></font>
    - condition: state<font></font>
      entity_id: 'sensor.line4_status'<font></font>
      state: 'no'<font></font>
  action:<font></font>
   - service: switch.turn_on<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A rega come√ßa no final da noite, com cada linha come√ßando em seu pr√≥prio intervalo de tempo. </font><font style="vertical-align: inherit;">A separa√ß√£o por hora de in√≠cio permite que voc√™ use um medidor de √°gua de entrada para obter dados em 4 linhas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na inicializa√ß√£o, tr√™s condi√ß√µes s√£o verificadas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O limite da quantidade de √°gua hoje n√£o foi excedido (se, por exemplo, a irriga√ß√£o manual foi ativada)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a umidade excede 50% (de acordo com as observa√ß√µes em nossas condi√ß√µes, o solo rec√©m derramado tem um teor de umidade n√£o superior a 60%)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precipita√ß√£o maior que 5 mm n√£o √© esperada nos pr√≥ximos dois dias.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pr√≥xima automa√ß√£o est√° desativando a rega:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desativando a rega (dentro de automations.yaml ou um arquivo separado)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4 <font></font>
  trigger:<font></font>
#      <font></font>
  - entity_id: sensor.line4_status<font></font>
    platform: state<font></font>
    to: 'yes'<font></font>
    for: <font></font>
      seconds: 5    <font></font>
#   <font></font>
  - platform: time<font></font>
    at: "23:59:00"<font></font>
#     <font></font>
  - platform: numeric_state<font></font>
    entity_id: sensor.miflora_1_moisture<font></font>
    above: 65<font></font>
#       <font></font>
  - platform: state<font></font>
    entity_id: switch.sistema_poliva_liniia_4<font></font>
    to: 'on'<font></font>
    for: <font></font>
      minutes: 60<font></font>
  action:<font></font>
   - service: switch.turn_off<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na automa√ß√£o, foram utilizadas at√© 4 variantes de gatilhos, mas na maioria dos casos funciona de acordo com o primeiro - um sensor de ‚Äúmuleta‚Äù, que monitora o excesso do limite pela quantidade de √°gua. </font><font style="vertical-align: inherit;">O restante dos gatilhos √© feito em grande parte por raz√µes de seguran√ßa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, a √∫ltima automa√ß√£o relacionada ao problema √© redefinir o contador di√°rio</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zerando o contador di√°rio (dentro de automations.yaml ou um arquivo separado)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
- alias:    4 <font></font>
  trigger:<font></font>
  - platform: time<font></font>
    at: "00:00:01"<font></font>
  action:<font></font>
  - service: counter.reset<font></font>
    entity_id: counter.my_water_line4t<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Economia do projeto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os custos para a parte de controle do sistema de irriga√ß√£o foram os seguintes: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(TORTA de framboesa com HassIO a bordo e um roteador WiFi com revestimento no jardim j√° estavam antes do in√≠cio do projeto, n√£o os levo em considera√ß√£o) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√°lvula solen√≥ide UNIPUMP BCX-15 1/2 "(normalmente fechada) 4 * 20 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sonoff 4CH 17 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Medidor de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pulsa√ß√µes </font><font style="vertical-align: inherit;">Pulsar 8 euros </font><font style="vertical-align: inherit;">ESP32 DevKitC 3,5 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensor capacitivo de umidade do solo v1.2 2 * 0,67 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensores MiFlora 2 * 16 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Guardas, coletores, fios, conex√µes, todos juntos cerca de 50 euros </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TOTAL: cerca de 190 euros</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tempo gasto na configura√ß√£o dos sensores e MK √© de cerca de 15 a 16 horas por v√°rias horas, mas a maior parte do tempo foi gasta em ‚Äúinventar bicicletas‚Äù e em ‚Äúmuletas‚Äù, em geral, n√£o h√° muito trabalho. </font><font style="vertical-align: inherit;">A montagem f√≠sica do sistema levou cerca de 2 noites. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, s√£o esperadas economias de √°gua de cerca de 20 a 50% em compara√ß√£o com o sistema de timer ‚Äúbobo‚Äù e, a pre√ßos locais da √°gua, o sistema deve pagar em uma ou duas esta√ß√µes.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defici√™ncias e planos de revis√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado do projeto, algumas nuances e oportunidades para melhorias adicionais foram reveladas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em particular, eu substituiria as v√°lvulas solen√≥ides de 220V por um modelo de 24V - essa tens√£o √© padr√£o para sistemas de irriga√ß√£o. Nesse caso, voc√™ teria que adicionar um transformador de 24V ao sistema e mudar o Sonoff 4Ch para algo com contato seco (por exemplo, Sonoff 4CH Pro ou algo auto-montado). As v√°lvulas s√£o mais baratas (de 8 euros) e reduzem a probabilidade de choque el√©trico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m ocorreu que, para trabalhar com tubula√ß√µes de pl√°stico, a press√£o do suprimento de √°gua √© muito alta e os encaixes podem vazar durante o ciclo de irriga√ß√£o. No meu caso, isso n√£o √© cr√≠tico, todos os acess√≥rios est√£o localizados acima do ponto de irriga√ß√£o, mas, de uma maneira boa, voc√™ precisa adicionar um redutor na entrada para diminuir a press√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fiquei ainda mais chateado com a impossibilidade de contabilizar a quantidade de √°gua para irriga√ß√£o em volumes inferiores a 10 litros - esse volume √© a quantidade m√≠nima mensur√°vel para esse medidor. </font><font style="vertical-align: inherit;">Esse problema pode ser resolvido desmontando o balc√£o e trocando as rodas, mas at√© ent√£o as m√£os n√£o o alcan√ßaram.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt497588/index.html">Spring Security - um exemplo de aplicativo da Web de autoriza√ß√£o OAuth2 por meio do BitBucket</a></li>
<li><a href="../pt497590/index.html">Lidamos com o algoritmo de colapso da fun√ß√£o de onda</a></li>
<li><a href="../pt497594/index.html">Armazenamento de dados externos: do tempo do IBM 1311 at√© os dias atuais. Parte 1</a></li>
<li><a href="../pt497596/index.html">Viva PHP</a></li>
<li><a href="../pt497602/index.html">Voc√™ se considera um signor? Quem voce esta brincando</a></li>
<li><a href="../pt497608/index.html">Como os sistemas de an√°lise de tr√°fego detectam t√°ticas de hackers por MITRE ATT & CK, parte 5</a></li>
<li><a href="../pt497612/index.html">A hist√≥ria de como a m√£o invis√≠vel do mercado me transferiu para um lugar remoto</a></li>
<li><a href="../pt497614/index.html">Experi√™ncias de pensamento, paradoxos e limites da l√≥gica // Estamos condenados # 2</a></li>
<li><a href="../pt497616/index.html">Entrevista com Alexander Makarov (Yii) sobre Opensource, confer√™ncias e Yii</a></li>
<li><a href="../pt497618/index.html">Implementa√ß√£o do conceito de acesso remoto altamente seguro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>