<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗳️ 🧑🏾‍🤝‍🧑🏻 👼🏼 一枚岩を守る言葉 👩🏻‍⚕️ 🌽 🕵️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="マイクロサービスとモノリシックアーキテクチャの機能、それらの長所と短所を比較します。この記事は、2019年2月9日にサマラで開催されたメタHot Backendの資料に基づいてHabrのために作成されました。特定のタスクに応じてアーキテクチャを選択する要因を検討します。
 
 5年前でさえ、誰もマイ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>一枚岩を守る言葉</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/simbirsoft/blog/453932/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロサービスとモノリシックアーキテクチャの機能、それらの長所と短所を比較します。</font><font style="vertical-align: inherit;">この記事は</font><font style="vertical-align: inherit;">、2019年2月9日にサマラで開催された</font><font style="vertical-align: inherit;">メタ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hot Backendの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資料に基づいてHabrのために作成されました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特定のタスクに応じてアーキテクチャを選択する要因を検討します。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5年前でさえ、誰もマイクロサービスについて聞いたことがありませんでした。</font><font style="vertical-align: inherit;">ただし、</font><font style="vertical-align: inherit;">Googleトレンドの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">統計</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によると、その人気は年々高まってい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1_/of/jd/1_ofjdwx6pauxathtq1srtfdsas.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モノリスとマイクロサービス：例</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトがモノリシックアーキテクチャを使用する場合、開発者は1つのアプリケーションのみを使用し、そのすべてのコンポーネントとモジュールは単一のベースで機能します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8q/pt/px/8qptpxklg15wtydbx847sqk2c9o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロサービスアーキテクチャには、個別のプロセスとして実行され、個別のサーバーを持つことができるモジュールに分解することが含まれます。</font><font style="vertical-align: inherit;">各マイクロサービスは独自のデータベースで動作し、これらすべてのサービスは同期（http）と非同期の両方で相互に通信できます。</font><font style="vertical-align: inherit;">さらに、アーキテクチャを最適化するには、サービス間の関係を最小限に抑えることが望ましいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下の図は簡略化されており、まずビジネスコンポーネントを反映しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q2/gi/y-/q2giy-br8pq2amiqihkrkzmn2e4.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロサービス：利点</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロサービスアーキテクチャの少なくとも4つの利点を区別できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独立したスケーリングとデプロイメント</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
マイクロサービスごとに独立したデプロイメントが提供されます。これは、個々のモジュールを更新するときに便利です。</font><font style="vertical-align: inherit;">モジュールの負荷が増加した場合、対応するマイクロサービスを他のサービスに影響を与えることなくスケーリングできます。</font><font style="vertical-align: inherit;">これにより、負荷を柔軟に分散してリソースを節約できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独立した開発</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ソフトウェア製品の作成速度を上げるために、各マイクロサービス（メモリモジュールなど）を1つのチームで開発できます。</font><font style="vertical-align: inherit;">
1つのマイクロサービスの</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安定性</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">障害は、他のモジュールのパフォーマンスには影響しません。</font></font><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異質性</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各チームはマイクロサービスの実装のために独自の言語とテクノロジーを自由に選択できますが、互換性のあるインターフェースを持っていることが望ましいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者の間では、モノリシックアーキテクチャは時代遅れであり、維持と拡張が困難であり、「汚れの大きな混乱」の中で急速に成長し、ほとんどアンチパターンである、つまりコード内での存在が望ましくないという意見を聞くことができます。</font><font style="vertical-align: inherit;">この意見の証拠として、プロジェクトでマイクロサービスアーキテクチャに切り替えたNetflixなどの大企業がよく挙げられます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最大のブランドの例に従って、誰もが本当にモノリスからマイクロサービスに切り替えるべきかどうか見てみましょうか？</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロサービスへの切り替え：考えられる問題</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の問題：分解</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
理想的には、アプリケーションをマイクロサービスに分割して、相互のやり取りをできるだけ少なくする必要があります。そうしないと、アプリケーションの保守が難しくなります。同時に、開発の最初の段階で分解を実装することは困難であり、新しい要件の出現によりビジネスの問題と主題領域が依然として変化する可能性があります。リファクタリングは高価です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数の一部をサービスAからサービスBに転送する必要が生じた場合、問題が発生する可能性があります。たとえば、サービスが異なる言語で実行されたり、サービスへの内部呼び出しがネットワークになったり、他のライブラリを接続する必要があります。テストの助けを借りてのみ、リファクタリングの正確性を検証できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/sb/zd/mssbzdbu2gw0mkt3xxsxd7cozuo.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題2：トランザクション</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの問題は、マイクロサービスに分散トランザクションの概念がないことです。 1つのマイクロサービス内でのみ、ビジネスオペレーションのアーキテクチャの整合性を保証できます。操作に複数のマイクロサービスが含まれる場合は、そこでさまざまなデータベースを使用できるため、そのようなトランザクションは破棄する必要があります。この問題を解決するために、整合性よりもアクセシビリティが重要な場合に、ビジネスで使用されるさまざまな方法があります。同時に、問題が発生した場合の補償メカニズムが提供されます。たとえば、商品の在庫がない場合は、購入者の口座に返金する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モノリスがアーキテクチャの整合性を自動的に提供する場合、マイクロサービスを使用して独自のメカニズムを考え出し、既製のソリューションでライブラリを使用する必要があります。サービス間で操作を分散する場合、データを同期的にリクエストし、後続のアクションを非同期的に実行することをお勧めします。サービスの1つにアクセスできない場合、チームは再び利用可能になるとすぐにキューに入れられます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この点で、ユーザーインターフェイスへのアプローチを修正する必要があります。一部のアクションはすぐには実行されず、特定の時間内に実行されることをユーザーに通知する必要があります。アプリケーションが処理されると、結果を表示するための招待状を受け取ります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j3/ms/1m/j3ms1mf_jzbabdwangp62th2uru.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題3：レポート</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単一のデータベースでモノリシックアーキテクチャを使用している場合、複雑なレポートを作成するには、選択して複数のデータラベルをプルアップします。遅かれ早かれ、表示されます。ただし、マイクロサービスでは、このデータはさまざまなベースに分散する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、特定の指標を持つ企業を一覧表示する必要があります。会社の簡単なリストがあれば、すべてがうまくいきます。また、別のデータベースにあるメトリックを追加する必要がある場合はどうでしょうか。はい、追加のリクエストを行い、TINによって指標をリクエストできます。そして、このリストをフィルタリングしてソートする必要がある場合はどうでしょうか？企業のリストは非常に大きくなる可能性があるため、独自のデータベースを備えた追加サービス-レポートを導入する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lz/kq/sn/lzkqsn07kbbjovz9_rttgfqbfmg.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題4：高度な開発の複雑さ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分散サービスでの作業はより複雑です。すべての要求はネットワークを介して行われ、オフにすることができます。コールバックメカニズムを提供する必要があります（コールは再度行われますか？何回ですか）。これらは、徐々に蓄積され、プロジェクトの複雑さの増大に寄与する「レンガ」です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスは複数の異なるチームによって開発でき、それらを文書化し、文書を最新の状態に保ち、バージョンを変更するときに他のチームに警告する必要があります。これらは追加の人件費です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各チームに独立したデプロイがある場合、少なくとも以前のバージョンをサポートし、サービスのすべてのコンシューマーが新しいAPIに切り替えた後にのみ、それを無効にする必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、すべてのAPIを、一般に公開される何らかのアーティファクトに取り込むことができます。ただし、1つはサービスをさまざまな言語で作成できること、もう1つは推奨されないことです。たとえば、私たちのプロジェクトの1つでは、セキュリティの考慮事項に関して、お客様の要求によりこれを拒否しました。各マイクロサービスには個別のリポジトリがあり、お客様はそれらにアクセスできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発プロセスでは、すべてが正しく機能し、それから-いいえ。例外が発生すると、アプリケーションが無限にそれらを処理しようとすることが起こり、これにより大きな負荷がかかります-システム全体が「レイダウン」します。このような状況を回避するには、たとえば、試行回数を制限したり、この呼び出しを同じ秒でキューに返さないように、すべてを設定する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_w/jd/oj/_wjdoj3ln-k7ysfb6wuh8kz1ycg.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/ae/rr/xc/aerrxc3udwi9pgafnmkzc7xy2du.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5番目の問題：テスト、トレース、デバッグの複雑さ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題をテストするには、関連するすべてのマイクロサービスをダウンロードする必要があります。デバッグは重要なタスクになり、すべてのログを1か所のどこかに収集する必要があります。同時に、何が起こったかを把握するために、できるだけ多くのログが必要です。問題を追跡するには、メッセージが伝わった経路全体を理解する必要があります。エラーはサービスの接合部で発生する可能性が高いため、ここでは単体テストでは不十分です。変更を行う場合は、スタンドでの走行後のみ操作性の確認が可能です。各マイクロサービスを特定の量のメモリ（たとえば、500メガバイト）に制限することができますが、最大2ギガバイトに達するとピーク負荷になる場合があります。システムの速度が低下し始める場合があります。その結果、リソースはクライアントの直接のタスクに属していないものに費やすことができます。たとえば、ビジネスマイクロサービスは2つしかなく、リソースの半分は残りをサポートする3つの追加のマイクロサービスに費やされています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pl/bn/36/plbn36qdp9gnyslu-b0xbecfo7c.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロサービスまたはモノリス：選択基準</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モノリシックアーキテクチャとマイクロサービスアーキテクチャのどちらを選択するかは、まず、対象領域の複雑さとスケーリングの必要性から始める必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
対象領域が単純で、ユーザー数の世界的な増加が予想されない場合は、間違いなくマイクロサービスを使用できます。</font><font style="vertical-align: inherit;">他の場合では、スケーリングが必要ない場合は、モノリスで開発を開始してリソースを節約することをお勧めします。</font><font style="vertical-align: inherit;">対象領域が複雑で、最初の段階で最終要件が定義されていない場合は、マイクロサービスを何度もやり直さないように、モノリスから開始することもお勧めします。</font><font style="vertical-align: inherit;">プロジェクトのさらなる発展により、マイクロサービスの個々の部分を区別することが可能です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/5c/9e/bl5c9elyajqq00pivozpby_yauy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラスは、プロジェクトの開始時に境界が存在することです。これは、開発プロセス中に境界を壊さないようにするのに役立ちます。また、1つのデータベースから始めて、各モジュールのスキーム（たとえば、支払いスキーム）を定義することも意味があります。その後、これはモジュールのマイクロサービスへの分割を簡素化するのに役立ちます。この場合、モジュールの境界を監視し、マイクロサービスを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各モジュールには独自のAPIが必要で、後で割り当ててモジュールをマイクロサービスにすることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6i/rp/b9/6irpb9ewnkmgleylittjhh5z-f8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュールの境界を決定したら、必要に応じてマイクロサービスへの分解に進むことができます。ケースの約90％でモノリスを維持することが可能ですが、必要に応じて、アーキテクチャを変更する方が簡単で安価です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モノリスとマイクロサービスを扱う私たちの実践では、次の結論に達しました。</font></font><br>
<ul>
<li>     ,    Netflix, Twitter, Facebook</li>
<li>  - ,     ,        (, ,   ..)       </li>
<li> ,   </li>
<li> </li>
<li> </li>
<li>    (        ).</li>
<li>     ,    ,        3  ,   . ,       ,       .</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja453914/index.html">TONテストクライアントのインストール手順</a></li>
<li><a href="../ja453916/index.html">モバイル詐欺師から身を守る方法</a></li>
<li><a href="../ja453920/index.html">ネットワークインフラストラクチャを制御する方法。第四章 オートメーション。テンプレート</a></li>
<li><a href="../ja453926/index.html">カーシェアリングサービスの仕組みと仕組み</a></li>
<li><a href="../ja453930/index.html">データ移行システムの比較と選択</a></li>
<li><a href="../ja453934/index.html">仕事を始める前に話し合う11の質問</a></li>
<li><a href="../ja453938/index.html">NB-IoT盗難自転車追跡</a></li>
<li><a href="../ja453942/index.html">PMI Codexの例による倫理について</a></li>
<li><a href="../ja453944/index.html">embeddのマスクされたバグ</a></li>
<li><a href="../ja453950/index.html">あなたはここにいるはずです！伝説のゲームDuke Nukem 3Dのリリースから22年</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>