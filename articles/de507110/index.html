<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♣️ 🤽🏼 🐂 So finden Sie Fehler in einem C # -Projekt unter Linux und MacOS 🙇🏿 ⛹🏿 👋🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio ist ein bekannter statischer Code-Analysator, mit dem Sie viele knifflige Fehler finden können, die in der Quelle versteckt sind. Der Beta-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>So finden Sie Fehler in einem C # -Projekt unter Linux und MacOS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507110/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/607/d60/6a2607d60720993d5834a2c2e83a6bb1.png" alt="Bild 8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio ist ein bekannter statischer Code-Analysator, mit dem Sie viele knifflige Fehler finden können, die in der Quelle versteckt sind. </font><font style="vertical-align: inherit;">Der Beta-Test der neuen Version wurde kürzlich abgeschlossen, in dem C # -Projekte für Linux und macOS analysiert werden können. </font><font style="vertical-align: inherit;">Darüber hinaus kann der Analysator jetzt in JetBrains Cross-Platform IDE - Rider integriert werden. </font><font style="vertical-align: inherit;">In diesem Artikel können Sie sich am Beispiel der Überprüfung des Open-Source-Projekts RavenDB mit diesen Funktionen vertraut machen.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor einiger Zeit schrieb mein Kollege </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Vasiliev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notiz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über die Eröffnung eines Betatests einer neuen Version des statischen Analysators PVS-Studio, den wir entwickeln. </font><font style="vertical-align: inherit;">Jetzt ist der Betatest abgeschlossen und die neue Version kann durch Klicken auf den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> heruntergeladen werden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Im selben Artikel werden wir untersuchen, wie C # -Projekte unter Linux / macOS mithilfe der Konsolenschnittstelle und von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> analysiert werden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Danach werden wir eine traditionelle Analyse einiger interessanter Analysatoroperationen durchführen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ravendb</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/dca/148/5ecdca148f1673576dcd824058b19e63.png" alt="Bild 5"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Überprüfung wurde ein offenes RavenDB-Projekt ausgewählt, dessen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fast 5.000 Quellcodedateien umfasst. </font><font style="vertical-align: inherit;">Es ist eine ziemlich beliebte NoSQL-Datenbank. </font><font style="vertical-align: inherit;">Details finden Sie auf der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es ist leicht zu erraten, dass mich seine Größe angezogen hat, denn in einem so großen und zweifellos ernsthaften Projekt wird es wahrscheinlich etwas Interessantes geben.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehlszeilenschnittstelle</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überlegen Sie zunächst, wie Sie über die Konsole analysieren. </font><font style="vertical-align: inherit;">Dieser Abschnitt ist meiner Meinung nach besonders interessant für diejenigen, die den Analysator in das CI-System integrieren möchten. </font><font style="vertical-align: inherit;">Das Team, das die Analyse startet, hat eine Reihe interessanter Optionen, aber im Allgemeinen ist alles ziemlich trivial. </font><font style="vertical-align: inherit;">Um RavenDB zu analysieren, gehe ich zum Projektordner und gebe Folgendes in die Konsole ein:</font></font><br>
<br>
<pre><code class="cs hljs">pvs-studio-dotnet -t ./RavenDB.sln </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Flag -t (kurz für target) wird verwendet, um eine Lösung oder Projektdatei zur Überprüfung anzugeben. </font><font style="vertical-align: inherit;">Die oben dargestellte Zeile startet die Analyse und bildet als Ergebnis der Arbeit eine Datei mit den gefundenen Fehlern. </font><font style="vertical-align: inherit;">Es ist einfach, nicht wahr?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fahrer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Arbeit mit dem Analysator in Rider entspricht in etwa der in Visual Studio. </font><font style="vertical-align: inherit;">Über die einfache und intuitive Benutzeroberfläche des Plugins können Sie das Projekt mit nur wenigen Klicks überprüfen. </font><font style="vertical-align: inherit;">Dies ist keine Übertreibung - um eine RavenDB-Analyse durchzuführen, musste ich nur auf das Hauptmenü Extras klicken, auf „PVS-Studio“ zeigen und auf „Aktuelle Lösung / Projekt prüfen“ klicken.</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/105/bd4/a2c105bd4e20693c064b6c1a4f0dc9f5.png" alt="Bild 2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Analyseergebnisse werden am unteren Rand des Fensters auf der Registerkarte PVS-Studio angezeigt (nun, welche noch? :))</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a4/8d2/477/7a48d2477e60a0038e89c97dbd991406.png" alt="Bild 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie beim Plug-In für Visual Studio wird durch Doppelklicken auf eine Warnung der Speicherort angezeigt, dem sie zugeordnet ist. Alles ist bequem und verständlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noch wichtiger ist, dass das PVS-Studio-Tool nicht nur Fehler anzeigt, sondern über eine Infrastruktur verfügt, die es einfach macht, die statische Analysemethode auch in einem großen alten Projekt zu implementieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die allgemeine Idee ist wie folgt. Der Benutzer startete den Analysator und erhielt viele Warnungen. Da ein seit vielen Jahren entwickeltes Projekt lebendig ist, sich entwickelt und Geld verdient, enthält der Bericht höchstwahrscheinlich nicht viele Warnungen, die auf kritische Mängel hinweisen. Mit anderen Worten, kritische Fehler wurden bereits auf die eine oder andere Weise auf teurere Weise oder dank des Feedbacks von Kunden behoben. Dementsprechend kann alles, was der Analysator jetzt findet, als technische Schuld angesehen werden, was unpraktisch ist, um zu versuchen, sie sofort zu beseitigen. Es ist vernünftig, diese Warnungen vorerst zu ignorieren, aber neuen Code zu schreiben, der bereits eine regelmäßige Analyse durchführt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können PVS-Studio anweisen, diese Warnungen als irrelevant zu betrachten (technische Schulden auf später zu verschieben) und sie nicht erneut anzuzeigen. Der Analysator erstellt eine spezielle Datei, in der Informationen zu bisher uninteressanten Fehlern gespeichert werden. Und jetzt gibt PVS-Studio Warnungen nur für neuen oder geänderten Code aus. Darüber hinaus wird all dies geschickt umgesetzt. Wenn beispielsweise am Anfang einer Datei eine leere Zeile hinzugefügt wird, versteht der Analysator, dass sich tatsächlich nichts geändert hat, und bleibt stumm. Diese Markup-Datei kann in das Versionskontrollsystem eingebettet werden. Die Datei ist groß, aber nicht beängstigend, da es oft keinen Sinn macht, sie zu legen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt sehen alle Programmierer Warnungen, die sich nur auf neuen oder geänderten Code beziehen. Somit kann der Analysator beginnen, das zu verwenden, was am nächsten Tag genannt wird. Und es wird möglich sein, später zur technischen Verschuldung zurückzukehren, Fehler schrittweise zu korrigieren und den Analysator zu konfigurieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um Warnungen auf vorhandenen Code in Rider zu unterdrücken, gehen Sie einfach zum Hauptmenü unter Extras-&gt; PVS-Studio und klicken Sie auf "Alle Nachrichten unterdrücken".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/860/1eb/1d38601ebc120fa0c03d91df2237a8df.png" alt="Bild 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Klicken Sie im angezeigten Fenster mit der Warnung, dass alle aktuellen Vorgänge in die Unterdrückungsliste fallen, auf „OK“. </font><font style="vertical-align: inherit;">Infolgedessen wird im Projektordner eine Unterdrückungsdatei erstellt, die vom Analysator bei weiteren Arbeiten berücksichtigt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist zu beachten, dass Rider bereits über einen Analysator verfügt, der einige Fehler erfolgreich hervorhebt. </font><font style="vertical-align: inherit;">Eine Reihe von Warnungen von PVS-Studio verweist daher auf Code, der aus Sicht des Editors verdächtig aussieht. </font><font style="vertical-align: inherit;">Trotzdem findet PVS-Studio häufig Fehler, die vom empfindlichen Auge des Analysators von JetBrains abweichen können. </font><font style="vertical-align: inherit;">Deshalb besteht die effektivste Lösung darin, dass sie in einem Team arbeiten können.</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/401/c23/d47/401c23d47c7f813c25acd347e7517482.png" alt="Bild 10"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und zum Dessert</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun werden wir, wie versprochen, prüfen, welche interessanten Warnungen der Analysator gemäß den Ergebnissen der Überprüfung angezeigt hat. Das Projekt enthält eine große Anzahl von Quellcodedateien, daher war es nicht überraschend, viele verdächtige Momente darin zu finden. Es gibt nichts zu tun - jeder macht Fehler, aber es ist wichtig, alle Anstrengungen zu unternehmen, um sie rechtzeitig zu erkennen und zu korrigieren. Die statische Analyse kann diese Aufgabe erheblich vereinfachen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis der Überprüfung wurden ungefähr tausend Warnungen angezeigt:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/3d4/124/2a63d41242fd337aaff1753454f8a79c.png" alt="Bild 11"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können mehr über Warnstufen lesen, indem Sie auf den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> klicken </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich weisen nicht alle Auslöser auf beängstigende Fehler hin. </font><font style="vertical-align: inherit;">Wenn dies so wäre, wäre es unwahrscheinlich, dass zumindest etwas im Projekt funktioniert :). </font><font style="vertical-align: inherit;">Es ist jedoch wichtig zu verstehen, dass der Code seltsam aussieht und sorgfältig untersucht werden sollte, wenn der Analysator „schwört“. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen fand das Projekt viele interessante positive Ergebnisse. </font><font style="vertical-align: inherit;">Trotzdem möchte ich nicht, dass der Artikel sehr groß ist, deshalb werden wir nur einige davon betrachten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur ein zusätzlicher Scheck?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsurePathExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> dirpath = Path.GetDirectoryName(file);<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; dirsToCreate = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
  <span class="hljs-keyword">while</span> (Directory.Exists(dirpath) == <span class="hljs-literal">false</span>)<font></font>
  {<font></font>
    dirsToCreate.Add(dirpath);<font></font>
    dirpath = Directory.GetParent(dirpath).ToString();<font></font>
    <span class="hljs-keyword">if</span> (dirpath == <span class="hljs-literal">null</span>)                                  <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  dirsToCreate.ForEach(x =&gt; Directory.CreateDirectory(x));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 Der</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck 'dirpath == null' ist immer falsch. PosixHelper.cs (124) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Vorgang kann auf verschiedene Arten betrachtet werden. Einerseits ist ein zusätzlicher Scheck natürlich nicht sehr gut, aber an sich ist es kein Fehler. Auf der anderen Seite lohnt es sich zu überlegen: Funktioniert dieser Code wirklich so, wie es der Programmierer beabsichtigt hat? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht wusste der Entwickler wirklich nicht, dass </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> niemals </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null zurückgeben würde</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn dies nicht der Fall ist, können wir davon ausgehen, was er erreichen wollte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Möglicherweise </font><font style="vertical-align: inherit;">sollte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aufgerufen werden, wenn es nicht möglich ist, ein übergeordnetes Element für das betreffende Verzeichnis abzurufen. Wenn ja, dann auf </font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;"> prüfen</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macht Sinn. </font><font style="vertical-align: inherit;">Wir müssen jedoch nicht das Ergebnis von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString berücksichtigen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sondern den von der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode zurückgegebenen Wert </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs">dirsToCreate.Add(dirpath);
<span class="hljs-keyword">var</span> dir = Directory.GetParent(dirpath);    
<span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">break</span>;<font></font>
<font></font>
dirpath = dir.ToString();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Andernfalls </font><i><font style="vertical-align: inherit;">löst die</font></i><font style="vertical-align: inherit;"> Rückgabe von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">beim Aufrufen von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Ausnahme </font><i><font style="vertical-align: inherit;">aus</font></i><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typische Null</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ScanOldest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; copy.Length; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> item = copy[i].Value;
    <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span> || item == InvalidLowLevelTransaction) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (val &gt; item.Id)                                    <span class="hljs-comment">// &lt;=</span><font></font>
        val = item.Id;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Objekt 'item' wurde verwendet, nachdem es gegen null verifiziert wurde. Überprüfen Sie die Zeilen: 249, 247. ActiveTransactions.cs (249), ActiveTransactions.cs (247) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code sieht seltsam aus, da das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Element</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wirklich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ebenfalls </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ist die Bedingung wahr und ein Versuch, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.Id abzurufen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><i><font style="vertical-align: inherit;">löst</font></i><font style="vertical-align: inherit;"> eine Ausnahme aus. Und wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null sein kann</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dann die Bedingung " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Es ist einfach überflüssig. Dies liegt daran, dass es nur überprüft wird, wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == null ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nun, wenn das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Element</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plötzlich </font><font style="vertical-align: inherit;">nicht </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null sein kann</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , verliert die gesamte Bedingung ihre Bedeutung und fügt nur unnötige Verschachtelungen hinzu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich denke, dass vielleicht Der falsche logische Operator wird ausgewählt. Wenn Sie in der Bedingung "||" durch "&amp;&amp;" ersetzen, sieht der Code sofort logisch aus. In diesem Fall können keine Probleme auftreten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Entwicklung eines solchen Plans ist ein typischer Vertreter sehr gefährlicher Fehler in der vom Analysator erkannten Theorie Fairerweise sollte beachtet werden, dass der in Rider eingebaute Analysator dieses Fragment auch als potenziell gefährlich markiert.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noch eine Überprüfung?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_continuationState.Count &gt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> outerState = <font></font>
      _continuationState.Count &gt; <span class="hljs-number">0</span> ? _continuationState.Pop() : currentState<font></font>
    ;<font></font>
    <span class="hljs-keyword">if</span> (outerState.FirstWrite == <span class="hljs-number">-1</span>)<font></font>
      outerState.FirstWrite = start;<font></font>
    _continuationState.Push(outerState);<font></font>
  }  <font></font>
   ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck '_continuationState.Count&gt; 0' ist immer wahr. </font><font style="vertical-align: inherit;">ManualBlittableJsonDocumentBuilder.cs (152) Sparrow </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst wird im externen Zustand überprüft, ob die Anzahl der Elemente in der Auflistung größer als 1 ist, und dann überprüft der ternäre Operator in der nächsten Zeile, ob ihre Anzahl größer als 0 ist. Es scheint, dass eine der Überprüfungen anders aussehen sollte. </font><font style="vertical-align: inherit;">Auf die eine oder andere Weise sieht dieser Code sehr verdächtig aus und sollte bei Bedarf sorgfältig untersucht und verarbeitet werden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mögliches NRE</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Expression <span class="hljs-title">VisitIndex</span>(<span class="hljs-params">IndexExpression node</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (node.Object != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Visit(node.Object);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    Out(node.Indexer.DeclaringType.Name); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (node.Indexer != <span class="hljs-literal">null</span>)               <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Out(<span class="hljs-string">"."</span>);<font></font>
    Out(node.Indexer.Name);<font></font>
  }<font></font>
  VisitExpressions(<span class="hljs-string">'['</span>, node.Arguments, <span class="hljs-string">']'</span>);
  <span class="hljs-keyword">return</span> node;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Objekt 'node.Indexer' wurde verwendet, bevor es gegen null verifiziert wurde. Überprüfen Sie die Zeilen: 1180, 1182. ExpressionStringBuilder.cs (1180), ExpressionStringBuilder.cs (1182) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist ein weiterer Ort, den PVS-Studio und Rider als verdächtig betrachten. Der Wortlaut ist zwar etwas anders: Der Analysator von JetBrains hebt nur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer.DeclaringType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit dem Kommentar „Possible NullReferenceException“ hervor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beide Gutachter behaupten, dass in diesem Fragment tatsächlich eine Ausnahme ausgelöst werden kann. Ich muss sagen, dass die Warnung von PVS-Studio nicht nur besagt, dass hier ein Fehler möglich ist, sondern auch erklärt, warum er eine solche Meinung hatte. Es scheint eine Kleinigkeit, aber schön.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich ist es keine Tatsache, dass es wirklich einen Fehler gibt. </font><font style="vertical-align: inherit;">Es ist möglich, dass wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object == null ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> genau angegeben ist. </font><font style="vertical-align: inherit;">In diesem Fall ist eine Situation zulässig, in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null sind</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nur in diesem Fall kann der gegebene Betrieb beider Analysatoren als falsch angesehen werden. </font><font style="vertical-align: inherit;">Daher lohnt es sich, alle möglichen Optionen sorgfältig zu analysieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wenn Sie tiefer graben?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadStartingWithInternal</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">var</span> command = operation.CreateRequest();
  <span class="hljs-keyword">if</span> (command != <span class="hljs-literal">null</span>)                       <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    <span class="hljs-keyword">await</span> RequestExecutor<font></font>
      .ExecuteAsync(command, Context, SessionInfo, token)<font></font>
      .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
    ;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">null</span>)<font></font>
      Context.Write(stream, command.Result.Results.Parent);<font></font>
    <span class="hljs-keyword">else</span><font></font>
      operation.SetResult(command.Result);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck 'Befehl! = Null' ist immer wahr. AsyncDocumentSession.Load.cs (175) Raven.Client Eine </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warnung wird ausgegeben, da die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRequest-Methode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> niemals </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zurückgibt </font><font style="vertical-align: inherit;">. Schauen Sie sich einfach den Code an, um Folgendes zu sehen:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> GetDocumentsCommand <span class="hljs-title">CreateRequest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  _session.IncrementRequestCount();<font></font>
  <span class="hljs-keyword">if</span> (Logger.IsInfoEnabled)<font></font>
    Logger.Info(....);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetDocumentsCommand(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen ist diese Überprüfung kein solches Problem, obwohl es sein kann, dass die Methode, die verwendet wird, um unter bestimmten Umständen null zurückzugeben, jetzt eine Ausnahme auslöst. </font><font style="vertical-align: inherit;">Wer weiß, es ist möglich, dass anstelle dieser Überprüfung auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jetzt ein Try-Catch durchgeführt werden sollte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Möglicherweise haben Sie eine sehr vernünftige Frage: Wo wird hier die Ausnahme ausgelöst? </font><font style="vertical-align: inherit;">Wenn dies nicht der Fall ist, haben wir nur noch einen zusätzlichen Scheck, und hier kann kein Fehler vorliegen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider kann bei der Ausführung der Methode eine Ausnahme tatsächlich zweimal ausgelöst werden. </font><font style="vertical-align: inherit;">Zuerst in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IncrementRequestCount-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementRequestCount</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (++NumberOfRequests &gt; MaxNumberOfRequestsPerSession)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann im Konstruktor von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetDocumentsCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetDocumentsCommand</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> startWith, ....</span>)</span><font></font>
{<font></font>
  _startWith = startWith ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(startWith));<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traditionelles Kopieren und Einfügen</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteTo</span>(<span class="hljs-params">StringBuilder writer</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (SqlConnectionStringsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(SqlConnectionStringsUpdated)] = SqlConnectionStringsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PeriodicBackupsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(PeriodicBackupsUpdated)] = PeriodicBackupsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ExternalReplicationsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ExternalReplicationsUpdated)] = ExternalReplicationsUpdated;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3127</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es wurden zwei ähnliche Codefragmente gefunden. Vielleicht ist das ein Tippfehler. SmugglerResult.cs (256), SmugglerResult.cs (253) Raven.Client Ich </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bezweifle sehr, dass zumindest jemand hier Verrücktheit sehen würde, wenn er sich den Code ansieht. Die Funktion besteht aus 14 ähnlichen Bedingungen und alle Variablen enden mit Aktualisiert. Selbst wenn hier ein kleiner Teil angegeben ist, ist der Fehler nicht sofort sichtbar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das menschliche Gehirn weigert sich buchstäblich, nach irgendetwas in einem solchen Code zu suchen. Gleichzeitig stellte PVS-Studio leicht fest, dass es zugewiesen wurde. Höchstwahrscheinlich ist es völlig falsch. Es sollte:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist logisch, dass die untere Zeile rechts vom Zuweisungsoperator </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConflictSolverConfigUpdated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lautet </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ich bin sicher, dass diese Seltsamkeit ohne statische Analyse nur gefunden werden würde, wenn etwas Ernsthaftes daran gebrochen wäre. </font><font style="vertical-align: inherit;">Der Programmierer kann feststellen, dass ein Problem in dieser Funktion verborgen ist, es sei denn, er weiß es vorher.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh das "??"</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Count =&gt; <font></font>
  _documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analysator Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vielleicht das '??' Der Bediener arbeitet anders als erwartet. Ihre Priorität ist niedriger als die Priorität anderer Betreiber im linken Teil. InMemoryDocumentSessionOperations.cs (1952) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich bleibt die Möglichkeit bestehen, dass dies überhaupt kein Fehler ist, so wie es beabsichtigt war. Und doch sieht dieser Ort sehr verdächtig aus. Schließlich ist es logisch anzunehmen, dass die Idee der Funktion nicht darin besteht, 0 mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_onBeforeStoreDocumentsByEntity == null zurückzugeben.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ich denke, dass es wirklich einen Fehler gibt, der mit den Prioritäten der Betreiber zusammenhängt. In diesem Fall müssen Sie die Klammern setzen:</font></font><br>
<br>
<pre><code class="cs hljs">_documentsByEntity.Count + (_onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, wenn plötzlich wirklich alles geplant ist, sollten Sie vielleicht explizit darauf hinweisen - dann haben der Analysator und die Programmierer, die den Code lesen, keine Fragen:</font></font><br>
<br>
<pre><code class="cs hljs">(_documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count) ?? <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber das ist natürlich Geschmackssache.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter übergeben</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateEnvironmentVariableLicenseString</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ValidateLicense(newLicense, rsaParameters, oldLicense) == <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Möglicherweise falsche Reihenfolge der Argumente, die an die Methode 'ValidateLicense' übergeben wurden: 'newLicense' und 'oldLicense'. </font><font style="vertical-align: inherit;">LicenseHelper.cs (177) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Argumente, die in verdächtiger Reihenfolge an die Methode übergeben wurden. </font><font style="vertical-align: inherit;">Schauen Sie sich die Anzeige an:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ValidateLicense</span>(<span class="hljs-params">
  License oldLicense, 
  RSAParameters rsaParameters, 
  License newLicense
</span>)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist sehr angenehm, dass PVS-Studio auch solche Fehler finden kann. </font><font style="vertical-align: inherit;">Dies ist ein gutes Beispiel für die Frage nach den Vorteilen der statischen Analyse gegenüber der dynamischen Analyse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ungeachtet des Vorstehenden schlug ich zunächst vor, dass es möglicherweise keine Rolle spielt, in welcher Reihenfolge diese Argumente weitergegeben werden. </font><font style="vertical-align: inherit;">In diesem Fall wären die Namen natürlich nicht richtig gewählt worden, aber was können Sie tun? </font><font style="vertical-align: inherit;">Die interne Struktur von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidateLicense</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> legt jedoch nahe, dass diese Parameter immer noch unterschiedliche Bedeutungen haben. </font><font style="vertical-align: inherit;">Der Code dieser Funktion kann durch Klicken auf den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angezeigt werden </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Niemals weitermachen</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;CounterOperation&gt; <span class="hljs-title">GetCounterOperationsFor</span>(<span class="hljs-params">RavenEtlItem item</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; counters.Count; i++)<font></font>
  {<font></font>
    counters.GetPropertyByIndex(i, <span class="hljs-keyword">ref</span> prop);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<font></font>
      GetCounterValueAndCheckIfShouldSkip(<font></font>
        item.DocumentId, <font></font>
        <span class="hljs-literal">null</span>, <font></font>
        prop, <font></font>
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete<font></font>
      )<font></font>
    ) <span class="hljs-keyword">continue</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck 'GetCounterValueAndCheckIfShouldSkip (item.DocumentId, null, prop, out long value, out bool delete)' ist immer falsch. RavenEtlDocumentTransformer.cs (362) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Methode kann durch Klicken auf den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vollständig berücksichtigt werden </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Warnung zeigt an, dass ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fortgesetzter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anruf </font><font style="vertical-align: inherit;">in dieser Schleife nicht erreichbar ist. Und wenn ja, dann ist das Fragment wirklich seltsam. Aber vielleicht ist es nur ein falsches Positiv? Doch Rider schwört nicht darauf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sich die </font><i><font style="vertical-align: inherit;">GetCounterValueAndCheckIfShouldSkip-</font></i><font style="vertical-align: inherit;"> Methode an </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCounterValueAndCheckIfShouldSkip</span>(<span class="hljs-params">
  LazyStringValue docId, 
  <span class="hljs-keyword">string</span> function, 
  BlittableJsonReaderObject.PropertyDetails prop, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (prop.Value <span class="hljs-keyword">is</span> LazyStringValue)<font></font>
  {<font></font>
    delete = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    delete = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">value</span> = CountersStorage.InternalGetCounterValue(<font></font>
      prop.Value <span class="hljs-keyword">as</span> BlittableJsonReaderObject.RawBlob, <font></font>
      docId, <font></font>
      prop.Name<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (function != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> result = BehaviorsScript.Run(<font></font>
        Context, <font></font>
        Context, <font></font>
        function, <font></font>
        <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { docId, prop.Name }<font></font>
      ))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (result.BooleanValue != <span class="hljs-literal">true</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Offensichtlich kann diese Methode </font><font style="vertical-align: inherit;">nur dann </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true zurückgeben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In dem zuvor betrachteten Code wird genau der Nullzeiger an die Stelle dieses Parameters übergeben. </font><font style="vertical-align: inherit;">So ist </font><font style="vertical-align: inherit;">die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weiterhin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anruf ist </font><font style="vertical-align: inherit;">wirklich nicht erreichbar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Moment kann sowohl eine harmlose Auslassung als auch ein Problem sein, das mit einem Fehler in der Bedingung verbunden ist. </font><font style="vertical-align: inherit;">Auf die eine oder andere Weise sollten Sie darauf achten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vertrauen, aber überprüfen</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> LicenseType Type<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ErrorMessage != <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.Invalid;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.None;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes != <span class="hljs-literal">null</span> &amp;&amp;                             <span class="hljs-comment">// &lt;=</span>
        Attributes.TryGetValue(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">object</span> type) &amp;&amp;<font></font>
        type <span class="hljs-keyword">is</span> <span class="hljs-keyword">int</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">var</span> typeAsInt = (<span class="hljs-keyword">int</span>)type;
      <span class="hljs-keyword">if</span> (Enum.IsDefined(<span class="hljs-keyword">typeof</span>(LicenseType), typeAsInt))
        <span class="hljs-keyword">return</span> (LicenseType)typeAsInt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> LicenseType.Community;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analysator Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein Teil des bedingten Ausdrucks ist immer wahr, wenn er ausgewertet wird: Attribute! = Null. </font><font style="vertical-align: inherit;">LicenseStatus.cs (28) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein äußerst seltsames Fragment. </font><font style="vertical-align: inherit;">In der Regel werden überflüssige Prüfungen zumindest irgendwie getrennt - hier wird die Entsprechung der Variablen zum Nullzeiger direkt in den nächsten Zeilen geprüft. </font><font style="vertical-align: inherit;">Es scheint, dass der Code höchstwahrscheinlich überhaupt nicht das tut, was der Programmierer wollte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nullable, was niemals null ist</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)                                  <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 Der</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck 'suspend.HasValue' ist immer wahr. </font><font style="vertical-align: inherit;">RachisAdminHandler.cs (116) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiterer scheinbar harmloser "zusätzlicher" Check. </font><font style="vertical-align: inherit;">Obwohl noch nicht klar ist, warum der Analysator dies für so hält. </font><i><font style="vertical-align: inherit;">Wenden Sie sich</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
an </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span>? GetBoolValueQueryString(<span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> boolAsString = GetStringQueryString(name, required);
  <span class="hljs-keyword">if</span> (boolAsString == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">bool</span>.TryParse(boolAsString, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> result) == <span class="hljs-literal">false</span>)<font></font>
    ThrowInvalidBoolean(name, boolAsString);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Tat gibt diese Funktion manchmal </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null zurück</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ja, und Rider hielt diese Überprüfung nicht für unnötig. </font><font style="vertical-align: inherit;">Hat das Einhorn versagt?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/99d/ab6/34999dab64459aebc38561a25b2bad72.png" alt="Bild 15"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber was ist, wenn Sie sich die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><i><font style="vertical-align: inherit;">ansehen</font></i><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetStringQueryString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> val = HttpContext.Request.Query[name];
  <span class="hljs-keyword">if</span> (val.Count == <span class="hljs-number">0</span> || <span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(val[<span class="hljs-number">0</span>]))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (required)<font></font>
      ThrowRequiredMember(name);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> val[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm, wenn der Parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erforderlich</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wahr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dann ist </font><font style="vertical-align: inherit;">die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThrowRequiredMember</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird Methode aufgerufen werden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ich frage mich, was er tut? </font><font style="vertical-align: inherit;">:) Nun, so dass es sicherlich keinen Zweifel mehr gibt:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThrowRequiredMember</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(
    <span class="hljs-string">$"Query string <span class="hljs-subst">{name}</span> is mandatory, but wasn't specified."</span><font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also fassen wir zusammen. Der Entwickler ruft die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode auf </font><font style="vertical-align: inherit;">. Er glaubt wahrscheinlich, dass die Methode möglicherweise nicht den notwendigen Wert erhält. Nun, als Ergebnis gibt es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null zurück</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Im Inneren wird </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString aufgerufen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Bei Problemen wird entweder null zurückgegeben oder eine Ausnahme ausgelöst. Der zweite tritt auf, wenn der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erforderliche</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameter </font><font style="vertical-align: inherit;">auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true gesetzt ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Darüber hinaus ist dies der Standardwert. Gleichzeitig wird beim Aufrufen von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wenn Sie sich den obigen Code ansehen, einfach nicht übertragen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns noch einmal den Code der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuspendObserver-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode an </font><font style="vertical-align: inherit;">, deren Fragment der Analysator geschworen hat:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)<font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass der Thread hier nicht unterbrochen werden sollte, wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Wert nicht erhalten konnte. Tatsächlich werden nach einem Block mit einer Prüfung auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verschiedene Aktionen ausgeführt und ein Wert zurückgegeben. Ich glaube, dass diese Aktionen </font><font style="vertical-align: inherit;">von </font><i><font style="vertical-align: inherit;">Natur aus </font></i></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unabhängig vom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erfolg der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode ausgeführt werden </font><font style="vertical-align: inherit;">. Was wird eigentlich passieren? Ein Ausführungsthread wird durch eine Ausnahme unterbrochen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bis zu diesem Punkt benötigen Sie einen Aufruf von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als zweiten Parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, der den</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wert </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">erfordert</font></i><font style="vertical-align: inherit;"> . Dann wird wirklich alles wie erwartet funktionieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie ich bereits sagte, scheint es manchmal so, als ob der Analysator sich irrt (was für eine Sünde zu verbergen, manchmal passiert es). </font><font style="vertical-align: inherit;">Auch ziemlich oft sieht die Warnung unbedeutend aus. </font><font style="vertical-align: inherit;">Es scheint, dass es hier einen zusätzlichen Scheck gibt, und okay. </font><font style="vertical-align: inherit;">Nun, oder noch besser - wir entfernen es und keine Probleme - die Warnung wird verschwinden! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auch in Fällen, in denen die Operation seltsam und unverständlich erscheint, markieren Sie sie nicht hastig als falsch. </font><font style="vertical-align: inherit;">Sie müssen versuchen zu verstehen, warum der Analysator den Ort als problematisch ansieht, und danach eine Entscheidung treffen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kuriositäten</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">WriteDocumentsJsonAsync</span>(<span class="hljs-params">...., <span class="hljs-keyword">int</span> numberOfResults</span>) <span class="hljs-comment">// &lt;=</span></span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (
    <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> AsyncBlittableJsonTextWriter(<font></font>
      context, <font></font>
      ResponseBodyStream(), <font></font>
      Database.DatabaseShutdown<font></font>
    )<font></font>
  )<font></font>
  {<font></font>
    writer.WriteStartObject();<font></font>
    writer.WritePropertyName(<span class="hljs-keyword">nameof</span>(GetDocumentsResult.Results));<font></font>
    numberOfResults = <span class="hljs-keyword">await</span> writer.WriteDocumentsAsync(                    <span class="hljs-comment">// &lt;=</span><font></font>
      context, <font></font>
      documentsToWrite, <font></font>
      metadataOnly<font></font>
    );<font></font>
<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> numberOfResults;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061 Der</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameter 'numberOfResults' wird vor seiner Verwendung immer im Methodenkörper neu geschrieben. </font><font style="vertical-align: inherit;">DocumentHandler.cs (273), DocumentHandler.cs (267) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der an die Funktion </font><font style="vertical-align: inherit;">übergebene </font><font style="vertical-align: inherit;">Parameter wird nicht verwendet, sondern sofort überschrieben. </font><font style="vertical-align: inherit;">Warum wird es hier gebraucht? </font><font style="vertical-align: inherit;">Sie wollten es durch ref weitergeben? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich war gespannt, wie diese Methode in vorhandenem Code verwendet wird. </font><font style="vertical-align: inherit;">Ich hoffte, dass es nicht zu viele von ihnen geben sollte, da es privat ist. </font><font style="vertical-align: inherit;">Dank Rider konnte ich leicht herausfinden, wo der Anruf getätigt wird. </font><font style="vertical-align: inherit;">Dies war der einzige Ort:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetDocumentsByIdAsync</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....            <font></font>
  <span class="hljs-keyword">int</span> numberOfResults = <span class="hljs-number">0</span>;<font></font>
<font></font>
  numberOfResults = <span class="hljs-keyword">await</span> WriteDocumentsJsonAsync(<font></font>
    context, <font></font>
    metadataOnly, <font></font>
    documents, <font></font>
    includes, <font></font>
    includeCounters?.Results, <font></font>
    numberOfResults<font></font>
  );<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Variablen wird 0 zugewiesen, dann wird sie an die Methode übergeben, deren Ergebnis ihr zugewiesen wird. </font><font style="vertical-align: inherit;">Und innerhalb der Methode wird dieser Parameter in keiner Weise verwendet. </font><font style="vertical-align: inherit;">Em. </font><font style="vertical-align: inherit;">Warum das alles?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/e29/1cf/74ae291cf3c642aafc84c5bfce7ed18e.png" alt="Bild 6"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falscher logischer Operator</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> OrderByField <span class="hljs-title">ExtractOrderByFromMethod</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (me.Arguments.Count &lt; <span class="hljs-number">2</span> &amp;&amp; me.Arguments.Count &gt; <span class="hljs-number">3</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryException(....);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck 'me.Arguments.Count &lt;2 &amp;&amp; me.Arguments.Count&gt; 3' ist immer falsch. </font><font style="vertical-align: inherit;">Wahrscheinlich das '||' </font><font style="vertical-align: inherit;">Operator sollte hier verwendet werden. </font><font style="vertical-align: inherit;">QueryMetadata.cs (861) Raven.Server Die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vollständige Methode kann hier eingesehen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diesmal haben wir einen offensichtlichen Fehler, der darin besteht, den falschen logischen Operator zu verwenden. </font><font style="vertical-align: inherit;">In der aktuellen Form funktioniert das Überprüfen der Anzahl der Argumente einfach nicht, da es keinen Wert gibt, der sowohl kleiner als 2 als auch größer als 3 ist. Die tatsächlichen Absichten des Entwicklers lassen sich leicht anhand des ersten an den Ausnahmekonstruktor übergebenen Arguments erkennen:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-string">"Invalid ORDER BY 'spatial.distance(from, to, roundFactor)' call, 
expected 2-3 arguments, got "</span> + me.Arguments.Count<font></font>
   ,    <span class="hljs-string">"&amp;&amp;"</span>  <span class="hljs-string">"||"</span>.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seltsame Versuchsmethode</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Operator</span>(<span class="hljs-params">OperatorField fieldOption, <span class="hljs-keyword">out</span> QueryExpression op</span>)</span><font></font>
{ <font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span> (match)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
      <span class="hljs-keyword">var</span> isMethod = Method(field, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> method); <span class="hljs-comment">// &lt;=</span><font></font>
      op = method;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (isMethod &amp;&amp; Operator(OperatorField.Optional, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodOperator))<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> isMethod;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein Teil des bedingten Ausdrucks ist immer wahr, wenn er ausgewertet wird: isMethod. QueryParser.cs (1797) Raven.Server Die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vollständige Methode finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Konstrukt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var isMethod = Method (Feld, out var method)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erinnerte mich an Standardmethoden wie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int.TryParse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Solche Methoden versuchen, das Ergebnis abzurufen und in die Variable out zu schreiben, und das Flag für den Erfolg der Operation ist der Rückgabewert. Code, der solche Funktionen verwendet, überprüft normalerweise den Rückgabewert und führt dann bestimmte darauf basierende Operationen aus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meiner Meinung nach funktioniert die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier auf diese Weise verwendet. Das Ergebnis der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist außerdem der Rückgabewert der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operator-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">, die sie aufruft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Analysator zeigt an, dass die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isMethod</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> immer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wahr ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ihre Überprüfung in der Bedingung bedeutungslos ist. Dies bedeutet, dass die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">niemals </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zurückgibt </font><font style="vertical-align: inherit;">. Was nützt dann eine solche Konstruktion? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie zunächst sicher, dass sich der Analysator nicht geirrt hat:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Method</span>(<span class="hljs-params">FieldExpression field, <span class="hljs-keyword">out</span> MethodExpression op</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> args = ReadMethodArguments();<font></font>
<font></font>
  op = <span class="hljs-keyword">new</span> MethodExpression(field.FieldValue, args);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Tat ist der Rückgabewert dieser Methode immer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wahr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Und wenn alles so geplant war, wie es war, dann ist das ... seltsam, aber im Prinzip spielt es keine Rolle. Aber was ist, wenn nicht? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReadMethodArguments</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">, deren Code kann eingesehen werden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wirft Ausnahmen in einigen Fällen. Dies geschieht, wenn eine Methode ihre Aufgabe nicht korrekt ausführen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass der Code, der die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion aufruft, </font><font style="vertical-align: inherit;">keine Ausnahmen auslöst. Höchstwahrscheinlich wird angenommen , </font><font style="vertical-align: inherit;">dass , </font><font style="vertical-align: inherit;">wenn es nicht möglich ist, korrekt den Wert des aus Variable zu erhalten, wird </font><font style="vertical-align: inherit;">die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">zurückkehren wird </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falsch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Bei der aktuellen Implementierung wird jedoch stattdessen eine Ausnahme ausgelöst.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie dem auch sei, es lohnt sich, diesem Fragment Aufmerksamkeit zu schenken.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null! = null?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Address <span class="hljs-title">GetNextEdge</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_curEdgeBlock == <span class="hljs-literal">null</span> || m_curEdgeBlock.Count &lt;= m_curEdgeIdx)<font></font>
  {<font></font>
    m_curEdgeBlock = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (m_edgeBlocks.Count == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error not enough edge data.  Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> nextEdgeBlock = m_edgeBlocks.Dequeue();
    <span class="hljs-keyword">if</span> (<font></font>
      m_curEdgeBlock != <span class="hljs-literal">null</span> &amp;&amp;                       <span class="hljs-comment">// &lt;=</span>
      nextEdgeBlock.Index != m_curEdgeBlock.Index + <span class="hljs-number">1</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error expected Node Index "</span> + (m_curEdgeBlock.Index + <span class="hljs-number">1</span>) + 
        <span class="hljs-string">" Got "</span> + nextEdgeBlock.Index + <span class="hljs-string">" Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    m_curEdgeBlock = nextEdgeBlock;<font></font>
    m_curEdgeIdx = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> m_curEdgeBlock.Values(m_curEdgeIdx++).Target;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein Teil des bedingten Ausdrucks ist immer falsch, wenn er ausgewertet wird: m_curEdgeBlock! = Null. </font><font style="vertical-align: inherit;">DotNetHeapDumpGraphReader.cs (803) Raven.Debug Die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variable einen Nullzeiger zugeordnet ist </font><font style="vertical-align: inherit;">, und dann nach ein paar Zeilen ist es für seine geprüft </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ungleichheit </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In diesem Fall wird der Code, der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextEdgeBlock.Index! = M_curEdgeBlock.Index + 1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> überprüft, bedeutungslos </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Außerdem wird niemals eine Ausnahme ausgelöst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist logisch anzunehmen, dass etwas nicht so funktioniert, wie es sollte, da das Fragment sehr seltsam aussieht. </font><font style="vertical-align: inherit;">Entweder wird die Prüfung hier überhaupt nicht benötigt oder sie ist irgendwie falsch implementiert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können das Auslösen in Betracht ziehen und andererseits vom Gegenteil ausgehen. </font><font style="vertical-align: inherit;">Versuchen wir uns eine Situation vorzustellen, in der diese Antwort falsch ist. </font><font style="vertical-align: inherit;">Ich denke, dies ist nur möglich, wenn der Wert der Variablen durch Aufrufen von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geändert werden </font><i><font style="vertical-align: inherit;">kann</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Allerdings </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein privates Feld und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_edgeBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist eine Standard - </font><font style="vertical-align: inherit;">Warteschlange , </font><font style="vertical-align: inherit;">die in der gleichen Klasse initialisiert wird. </font><font style="vertical-align: inherit;">Daher ist es höchst zweifelhaft, dass ein Aufruf von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dequeue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Wert von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> irgendwie beeinflussen </font><i><font style="vertical-align: inherit;">könnte</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Daher ist der Auslöser höchstwahrscheinlich nicht falsch.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuerst oder null</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">FindSpecialColumns</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableSchema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> mainSchema = GetTable(tableSchema, tableName);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
  mainSchema.PrimaryKeyColumns.ForEach(x =&gt; result.Add(x)); <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> fkCandidate <span class="hljs-keyword">in</span> Tables)
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tableReference <span class="hljs-keyword">in</span> fkCandidate.References.Where(<font></font>
        x =&gt; x.Table == tableName &amp;&amp; x.Schema == tableSchema<font></font>
      )<font></font>
    )<font></font>
    {<font></font>
      tableReference.Columns.ForEach(x =&gt; result.Add(x));<font></font>
    }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer-Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3146</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mögliche Null-Dereferenzierung von 'mainSchema'. Der 'Tables.FirstOrDefault' kann den Standardwert Null zurückgeben. DatabaseSchema.cs (31) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font><font style="vertical-align: inherit;">Operation </font><font style="vertical-align: inherit;">scheint auf den ersten Blick unverständlich. Was hat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> damit zu tun </font><font style="vertical-align: inherit;">? Um zu verdeutlichen, warum der Analysator schwört, müssen Sie sich die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><i><font style="vertical-align: inherit;">ansehen</font></i><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> TableSchema <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> schema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> Tables.FirstOrDefault(<font></font>
    x =&gt; x.Schema == schema &amp;&amp; x.TableName == tableName<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Aufruf der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">anstelle von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kann darauf zurückzuführen sein, dass die Auflistung möglicherweise keine Elemente enthält, die der angegebenen Bedingung entsprechen. In diesem Fall </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und daher </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kehrt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Table</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein Referenztyp ist. Aus diesem Grund gibt PVS-Studio an, dass in diesem Code möglicherweise versucht wird, einen Nullzeiger zu dereferenzieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es kann sich dennoch lohnen, nach einem solchen Fall zu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suchen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , damit die Ausführung nicht mit einer </font><i><font style="vertical-align: inherit;">NullReferenceException</font></i><font style="vertical-align: inherit;"> unterbrochen </font><i><font style="vertical-align: inherit;">wird</font></i><font style="vertical-align: inherit;"> . Wenn die Option, in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tables.FirstOrDefault </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zurückgibt, nicht möglich </font><i><font style="vertical-align: inherit;">ist,</font></i><font style="vertical-align: inherit;"> macht die Verwendung keinen Sinn</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> statt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immer wahr</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VerifyCanExecuteCommand</span>(<span class="hljs-params">
  ServerStore store, TransactionOperationContext context, <span class="hljs-keyword">bool</span> isClusterAdmin
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (context.OpenReadTransaction())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> read = store.Cluster.GetCertificateByThumbprint(context, Name);
    <span class="hljs-keyword">if</span> (read == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> definition = JsonDeserializationServer.CertificateDefinition(read);
    <span class="hljs-keyword">if</span> (<font></font>
      definition.SecurityClearance != SecurityClearance.ClusterAdmin || <span class="hljs-comment">// &lt;=</span>
      definition.SecurityClearance != SecurityClearance.ClusterNode     <span class="hljs-comment">// &lt;=</span><font></font>
    )<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  AssertClusterAdmin(isClusterAdmin);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer Warnung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck ist immer wahr. </font><font style="vertical-align: inherit;">Wahrscheinlich sollte hier der Operator '&amp;&amp;' verwendet werden. </font><font style="vertical-align: inherit;">DeleteCertificateFromClusterCommand.cs (21) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiteres Beispiel für eine Situation, in der höchstwahrscheinlich der falsche logische Operator ausgewählt wird. </font><font style="vertical-align: inherit;">In diesem Fall ist die Bedingung immer wahr, da die Variable definitiv nicht mindestens einem der Werte entspricht, mit denen sie verglichen wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich glaube, dass "||" </font><font style="vertical-align: inherit;">sollte durch "&amp;&amp;" ersetzt werden. </font><font style="vertical-align: inherit;">Dann macht das Geschriebene Sinn. </font><font style="vertical-align: inherit;">Wenn der logische Operator immer noch richtig ausgewählt ist, sollte höchstwahrscheinlich unter einer der Bedingungen ein Vergleich anderer Variablen erfolgen. </font><font style="vertical-align: inherit;">Auf die eine oder andere Weise sieht dieses Fragment sehr verdächtig aus und muss analysiert werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst möchte ich mich bei allen bedanken, die an diesen Ort gekommen sind. Der Artikel war ziemlich lang, aber ich hoffe, Sie wollten mit mir zusammenarbeiten, um die neue Version des PVS-Studio-Analysators zu verstehen und die gefundenen Fehler zu untersuchen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wichtig zu bedenken, dass der Entwickler als Hauptziel festlegen sollte, die Anzahl der Vorgänge nicht zu reduzieren. Nicht um ein leeres Fehlerprotokoll zu erhalten, müssen Sie PVS-Studio verwenden. Positive zu bekämpfen ist wie die Symptome einer Krankheit zu bekämpfen, an der der Quellcode leidet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie sich Analysatormeldungen ansehen, sollten Sie immer versuchen zu verstehen, warum diese oder jene Warnung ausgegeben wird. </font><font style="vertical-align: inherit;">Nur wenn wir die Logik erkennen, mit der der Analysator eine Warnung ausgegeben hat, können wir schließen, ob sie einen Fehler anzeigt oder nicht. </font><font style="vertical-align: inherit;">In diesem Fall kämpfen Sie nicht mit dem Symptom, sondern mit der Krankheit. </font><font style="vertical-align: inherit;">Und so wird Ihr Code sauberer und gesünder. </font><font style="vertical-align: inherit;">Und natürlich wird es mit einer so großartigen Quelle viel weniger Probleme geben. </font><font style="vertical-align: inherit;">Obwohl es besser ist, wünsche ich dir, dass du sie überhaupt nicht hast :)</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ca9/91e/843ca991e0e2688c6dc6a299fe3af231.png" alt="Bild 16"></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie diesen Artikel einem englischsprachigen Publikum zugänglich machen möchten, verwenden Sie bitte den Link zur Übersetzung: Nikita Lipilin. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So finden Sie Fehler in einem C # -Projekt, das unter Linux und macOS funktioniert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de507086/index.html">Konvertieren Sie das Bash-Skript in C # -Code, um SMS über das USB-Modem HUAWEI E3372 zu senden</a></li>
<li><a href="../de507090/index.html">Wie kann ein Tech-Team sein Startup aufbauen oder den Weg von der Funktionsüberwachung zur AIOps-Plattform?</a></li>
<li><a href="../de507092/index.html">Wir laden Sie zum zweiten Online-Mitap Zabbix ein</a></li>
<li><a href="../de507104/index.html">Die große Spaltung beim Import: Klärung der Unsicherheit beim Import in Typescript</a></li>
<li><a href="../de507106/index.html">Wie ist die Implementierung von DNS-over-HTTPS</a></li>
<li><a href="../de507112/index.html">PayOnline | Internet-Akquisition für Unternehmen</a></li>
<li><a href="../de507114/index.html">Ode Excel: 34 Jahre Magie</a></li>
<li><a href="../de507116/index.html">"Udalenka". Notizen vom gestrigen Büroentwickler. Teil 2</a></li>
<li><a href="../de507124/index.html">PDB ist nicht nur wertvolles Fell</a></li>
<li><a href="../de507132/index.html">Vladimir Kitov: „Es ist unmöglich zu verstehen, wie wegweisende Wissenschaftler in den 1950er Jahren die universelle Computerisierung vorausgesehen haben!“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>