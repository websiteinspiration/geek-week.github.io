<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚰 🎍 👎 Laravelの例でのモデルのフィルタリングの概念 🤽 🙎🏻 🌖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="URLリクエストによるフィルタリングを整理するという概念に注目したいと思います。たとえば、PHP言語とLaravelフレームワークを使用します。
 
 概念
 アイデアはQueryFilter、フィルターを操作するためのユニバーサルクラスを作成することです。
 
 

GET /posts?titl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Laravelの例でのモデルのフィルタリングの概念</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485520/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URLリクエストによるフィルタリングを整理するという概念に注目したいと思います。</font><font style="vertical-align: inherit;">たとえば、PHP言語とLaravelフレームワークを使用します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アイデアは</font></font><code>QueryFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、フィルター</font><font style="vertical-align: inherit;">を操作するためのユニバーサルクラスを作成すること</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="php hljs">GET /posts?title=source&amp;status=active</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例を使用</font><font style="vertical-align: inherit;">して、次の基準で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投稿</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（投稿モデル）</font><font style="vertical-align: inherit;">をフィルタリングし</font><font style="vertical-align: inherit;">ます。</font></font><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイトル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドに「ソース」という単語が含まれている</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステータス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドの値「publish」</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">応用例</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
型番 </font></font><code>Post</code><br>
<br>
<pre><code class="php hljs">
<span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Model</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-comment">/**
     * The attributes that are mass assignable.
     *
     * <span class="hljs-doctag">@var</span> array
     */</span>
    <span class="hljs-keyword">protected</span> $fillable = [
        <span class="hljs-string">'name'</span>,
        <span class="hljs-string">'id'</span>,
        <span class="hljs-string">'title'</span>,
        <span class="hljs-string">'slug'</span>,
        <span class="hljs-string">'status'</span>,
        <span class="hljs-string">'type'</span>,
        <span class="hljs-string">'published_at'</span>,
        <span class="hljs-string">'updated_at'</span>,<font></font>
    ];<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルートを追加：</font></font><br>
<br>
<pre><code class="php hljs">Route::get(<span class="hljs-string">'/posts'</span>, <span class="hljs-string">'PostController@index'</span>);</code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">JSON形式</font></i><font style="vertical-align: inherit;">で出力するための</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resource \ Post</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="php hljs">
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Resources</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Resources</span>\<span class="hljs-title">Json</span>\<span class="hljs-title">JsonResource</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JsonResource</span>
</span>{
    <span class="hljs-comment">/**
     * Transform the resource into an array.
     *
     * <span class="hljs-doctag">@param</span>  \Illuminate\Http\Request  $request
     * <span class="hljs-doctag">@return</span> array
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toArray</span>(<span class="hljs-params">$request</span>)
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'id'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;ID,
            <span class="hljs-string">'title'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;post_title,
            <span class="hljs-string">'slug'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;post_name,
            <span class="hljs-string">'status'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;post_status,
            <span class="hljs-string">'type'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;post_type,
            <span class="hljs-string">'published_at'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;post_date,
            <span class="hljs-string">'updated_at'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;post_modified,<font></font>
        ];<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、1つのアクションを持つコントローラー自体：</font></font><br>
<br>
<pre><code class="php hljs">
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Resources</span>\<span class="hljs-title">Post</span> <span class="hljs-title">as</span> <span class="hljs-title">PostResource</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Post</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Resources\Json\AnonymousResourceCollection
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)
    </span>{<font></font>
        $posts = Post::limit(<span class="hljs-number">10</span>)-&gt;get();<font></font>
<font></font>
        <span class="hljs-keyword">return</span> PostResource::collection($posts);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
標準フィルタリングは次のコードで構成されています。</font></font><br>
<br>
<pre><code class="php hljs">
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> Request $request
 * <span class="hljs-doctag">@return</span> \Illuminate\Http\Resources\Json\AnonymousResourceCollection
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params">Request $request</span>)
</span>{<font></font>
    $query = Post::limit(<span class="hljs-number">10</span>);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ($request-&gt;filled(<span class="hljs-string">'status'</span>)) {<font></font>
        $query-&gt;where(<span class="hljs-string">'post_status'</span>, $request-&gt;get(<span class="hljs-string">'status'</span>));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ($request-&gt;filled(<span class="hljs-string">'title'</span>)) {<font></font>
        $title = $request-&gt;get(<span class="hljs-string">'title'</span>);<font></font>
        $query-&gt;where(<span class="hljs-string">'post_title'</span>, <span class="hljs-string">'like'</span>, <span class="hljs-string">"%$title%"</span>);<font></font>
    }<font></font>
    $posts = $query-&gt;get();<font></font>
<font></font>
    <span class="hljs-keyword">return</span> PostResource::collection($posts);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチでは、コントローラーの増加に直面しますが、これは望ましくありません。 </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryFilterの実装</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような概念の意味は、フィルタリングのためにメソッドを各フィールドにマップするエンティティごとに個別のクラスを使用することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストでフィルター：</font></font><br>
<br>
<pre><code class="php hljs">GET /posts?title=source&amp;status=publish</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィルタリングのために、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostFilter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">と、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">title（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">status（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを用意し</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostFilter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><font style="vertical-align: inherit;">クラスメソッドを渡されたパラメーターにマッピングする役割を持つ</font><font style="vertical-align: inherit;">抽象</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryFiler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">拡張</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply（）</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
クラス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryFIlter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、派生クラス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postFilterで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用可能なフィルターを呼び出します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="php hljs">
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Filters</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Builder</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;<font></font>
<font></font>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryFilter</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> Request
     */</span>
    <span class="hljs-keyword">protected</span> $request;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> Builder
     */</span>
    <span class="hljs-keyword">protected</span> $builder;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> Request $request
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">Request $request</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;request = $request;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> Builder $builder
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params">Builder $builder</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;builder = $builder;<font></font>
<font></font>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;fields() <span class="hljs-keyword">as</span> $field =&gt; $value) {<font></font>
            $method = camel_case($field);<font></font>
            <span class="hljs-keyword">if</span> (method_exists(<span class="hljs-keyword">$this</span>, $method)) {<font></font>
                call_user_func_array([<span class="hljs-keyword">$this</span>, $method], (<span class="hljs-keyword">array</span>)$value);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> array
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fields</span>(<span class="hljs-params"></span>): <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> array_filter(<font></font>
            array_map(<span class="hljs-string">'trim'</span>, <span class="hljs-keyword">$this</span>-&gt;request-&gt;all())<font></font>
        );<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要点は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Request</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を介して渡されるフィールドごと</font><font style="vertical-align: inherit;">に、子フィルタークラス（PostFilterクラス）に個別のメソッドがあるということです。これにより、各フィルターフィールドのロジックをカスタマイズできます。</font><b><i><font style="vertical-align: inherit;">ポストフィルタ</font></i></b></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font></font><i><font style="vertical-align: inherit;"></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
今は作成する上での動きを聞かせて</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポストフィルタ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のクラス</font><font style="vertical-align: inherit;">拡張</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryFilterを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。前述のように、このクラスには、フィルタリングする必要がある各フィールドのメソッドが含まれている必要があります。この例では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイトル（$値）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font><i><font style="vertical-align: inherit;">ステータス（$値）</font></i><font style="vertical-align: inherit;">メソッド</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="php hljs">
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Filters</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Builder</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">QueryFilter</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> string $status
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">status</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $status</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;builder-&gt;where(<span class="hljs-string">'post_status'</span>, strtolower($status));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> string $title
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">title</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $title</span>)
    </span>{<font></font>
        $words = array_filter(explode(<span class="hljs-string">' '</span>, $title));<font></font>
<font></font>
        <span class="hljs-keyword">$this</span>-&gt;builder-&gt;where(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">Builder $query</span>) <span class="hljs-title">use</span> (<span class="hljs-params">$words</span>) </span>{
            <span class="hljs-keyword">foreach</span> ($words <span class="hljs-keyword">as</span> $word) {<font></font>
                $query-&gt;where(<span class="hljs-string">'post_title'</span>, <span class="hljs-string">'like'</span>, <span class="hljs-string">"%$word%"</span>);<font></font>
            }<font></font>
        });<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、非常に標準的なクエリである、各メソッドの詳細な分析の理由がわかりません。</font><font style="vertical-align: inherit;">ポイントは、各フィールドに個別のメソッドがあり、リクエストを形成するために必要なロジックを使用できることです。</font><b><i><font style="vertical-align: inherit;">scopeFilter（）を</font></i></b></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成します</font></font><i><font style="vertical-align: inherit;"></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
モデルとクエリコンストラクターをバインドする必要があります</font></font><br>
<br>
<pre><code class="php hljs">
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> Builder $builder
 * <span class="hljs-doctag">@param</span> QueryFilter $filter
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scopeFilter</span>(<span class="hljs-params">Builder $builder, QueryFilter $filter</span>)
</span>{<font></font>
    $filter-&gt;apply($builder);<font></font>
}<font></font>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検索するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filter（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを呼び出し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryFilterの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンス（</font><font style="vertical-align: inherit;">この場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostFilter </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">）</font></i><font style="vertical-align: inherit;">を渡す</font><font style="vertical-align: inherit;">必要</font><font style="vertical-align: inherit;">があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="php hljs">$filteredPosts = Post::filter($postFilter)-&gt;get();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、すべてのフィルタリングロジックは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filter（$ postFilter）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを呼び出すことによって処理され</font><font style="vertical-align: inherit;">、コントローラーを不要なロジックから節約します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再利用を容易にするために、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scopeFilter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">をトレイトに</font><font style="vertical-align: inherit;">配置し、</font><i><font style="vertical-align: inherit;">フィルター</font></i><font style="vertical-align: inherit;">が必要な各モデルにそれを使用できます。</font></font><br>
<br>
<pre><code class="php hljs">
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Filters</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Builder</span>;<font></font>
<font></font>
<span class="hljs-keyword">trait</span> Filterable<font></font>
{<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> Builder $builder
     * <span class="hljs-doctag">@param</span> QueryFilter $filter
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scopeFilter</span>(<span class="hljs-params">Builder $builder, QueryFilter $filter</span>)
    </span>{<font></font>
        $filter-&gt;apply($builder);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポスト</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を追加します。</font></font><br>
<br>
<pre><code class="php hljs"><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CorcelPost</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">Filterable</span>;
</code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">index（）</font></i><font style="vertical-align: inherit;">メソッドを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostFilter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パラメーターとして</font><font style="vertical-align: inherit;">コントローラーメソッド</font><font style="vertical-align: inherit;">に追加し</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">filter（）</font></i><font style="vertical-align: inherit;">モデルメソッドを呼び出すだけ</font><font style="vertical-align: inherit;">です。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="php hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> PostFilter $filter
     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Resources\Json\ResourceCollection
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params">PostFilter $filter</span>)
    </span>{<font></font>
        $posts = Post::filter($filter)-&gt;limit(<span class="hljs-number">10</span>)-&gt;get();<font></font>
<font></font>
        <span class="hljs-keyword">return</span> PostResource::collection($posts);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です。</font><font style="vertical-align: inherit;">すべてのフィルタリングロジックを適切なクラスに移動し、単一責任の原則（SOLIDシステムの原則ではS）を遵守しました</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィルターの実装に対するこのアプローチにより、トレーラーのシンコントローラーに準拠することができ、テストの記述も容易になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPとLaravelを使用した例を次に示します。</font><font style="vertical-align: inherit;">しかし、すでに述べたように、これは概念であり、任意の言語またはフレームワークで機能します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h4><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジュニアグロッシ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ブログ</font></a></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Killian Blaisの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">既製パッケージ</font></a></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485504/index.html">顔認識を禁止することで、私たちは要点を逃します</a></li>
<li><a href="../ja485508/index.html">機能的なDBMSおよびNoSQL ERPに向けて：残高の保管とコスト計算</a></li>
<li><a href="../ja485510/index.html">開発者である場合に製品を単独で起動する方法：Laravelの作成者であるTaylor Otvelからのヒント。パート3：あきらめないでください</a></li>
<li><a href="../ja485514/index.html">EBlink-ARM Cortex-Mマイクロコントローラー用GDBサーバー</a></li>
<li><a href="../ja485518/index.html">構成可能ではないものを構成しようとする：すべてを上げる</a></li>
<li><a href="../ja485522/index.html">ハックザボックス-ウォークスルーAI。JDWPのSreach、SSH転送、およびRCEへのAPIテキストでのSQLi</a></li>
<li><a href="../ja485524/index.html">モバイル＃330開発者向けの興味深い資料のダイジェスト（1月20〜26日）</a></li>
<li><a href="../ja485526/index.html">誰が、なぜインターネットを「共有」したいのか</a></li>
<li><a href="../ja485530/index.html">ガイド付き学習</a></li>
<li><a href="../ja485532/index.html">それらを理解していないプログラマのためのインタビューガイド</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>