<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è∫Ô∏è üëäüèø üëÉüèº How email works üïù üê± üõ¢Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the beginning of a long course about the operation of mail servers. I do not pursue the goal of quickly teaching someone to work with mail ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How email works</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494788/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is the beginning of a long course about the operation of mail servers. </font><font style="vertical-align: inherit;">I do not pursue the goal of quickly teaching someone to work with mail servers. </font><font style="vertical-align: inherit;">There will be a lot of additional information regarding those issues that we will meet along the way, because I try to do the course mainly for those who are just taking their first steps.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vb/cc/ho/vbcchoia9prwmtumxdulq7iftg0.png" alt="image"><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreword</font></font></b><div class="spoiler_text">  ,      .            ,   -  , -   .       ,    . ,    ,   ,     .       , , ,  , ,   , -   , -    .<br>
<br>
     -         .     ,       ?        ,    ,  ? -     , -     (    )     .<br>
<br>
     .       IT ,        .      .                  .     ,     .      ,            .<br>
<br>
  ,         ,     .    ,      ,   ,     .     ,    .    ,         .             .<br>
<br>
P.S.  ,          .    ,     ‚Äî  ,   . <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/dDb9j9UqK2E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next&gt; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operating modes of mail servers</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
To be able to work with e-mail, you need an e-mail client. It can be either a web client, say gmail, owa, roundcube, or an application on a computer - outlook, thunderbird, etc. Suppose you are already registered on some mail service and you need to configure your mail client. You open the program and it asks you for data: name for the account, your email address and password.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gd/wm/wa/gdwmwaptbjjvfyjlmtyiiv_mevc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After you enter this data, your mail client will try to find information about your mail server. This is done to simplify the configuration of the connection to the server, since most users do not know the addresses and connection protocols. To do this, email clients use different methods of finding information about the server and connection settings. These methods may vary depending on the mail client. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wb/y8/oj/wby8ojpp1cg5_el9jrs4hvvqg5u.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, Outlook uses the ‚Äúautodiscover‚Äù method, the client contacts the dns server and asks for a specific autodiscover entry that is associated with the mail domain that you specified in the settings of your mail client. If the administrator has configured this record on the DNS server, it points to the web server.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/5u/fp/ti5ufpfwlmxducyjy7t5giaqvu8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the email client finds out the address of the web server, he contacts it and finds a pre-prepared file with the settings for connecting to the mail server in XML format. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/im/jy/kj/imjykj-4cnqzqmwa5ct6p8onn6c.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of Thunderbird, the mail client dispenses with the DNS lookup of the autodiscover DNS record, and immediately tries to connect to the autoconfig web server. and the name of the specified domain. And he also tries to find a connection settings file in XML format on a web server.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/uf/mz/igufmzx7ogem9gpc4utk6aaeut4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the mail client does not find the file with the necessary settings, it will try to guess the settings among the frequently used ones. For example, if the domain is called example.com, then the mail server will check if there are servers with the names imap.example.com and smtp.example.com. If it finds, it will register it in the settings. If the mail client cannot determine the address of the mail server in any way, it will prompt the user to enter the connection data himself.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u6/t3/wo/u6t3wolilnuwmn6v7dp72aykxr4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then you will notice 2 fields for servers - the address of the incoming mail server and the address of the outgoing mail server. As a rule, in small organizations these addresses coincide, even if they are indicated through different DNS names, and in large companies they can be different servers. But it doesn‚Äôt matter if it is the same server or not - the services behind them are different. One of the most popular bundles of email services is Postfix &amp; Dovecot. Where Postfix acts as an outgoing mail server (MTA - mail transfer agent), and Dovecot acts as an incoming mail server (MDA - mail delivery agent). The name suggests that Postfix is ‚Äã‚Äãused to send mail, and Dovecot is used to receive mail by the mail client. The mail servers themselves communicate with each other via the SMTP protocol - i.e. Dovecot (MDA) is needed for users.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rg/pq/dw/rgpqdwa6p3xqgkawkbi5_2bss-a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose we configured a connection to our mail server. Let's try to send a message. In the message we indicate your address and the address of the recipient. Now, to deliver the message, your mail client will send a message to your outgoing mail server. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xo/8y/c9/xo8yc9hqesmmen_imelwid8fhbo.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When your server receives a message, it will try to find who to deliver this message to. Your server cannot know the addresses of all mail servers by heart, so it turns to DNS in order to find a special MX record - pointing to the mail server for this domain. These entries may vary for different subdomains.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ac/bl/t9/acblt9ocaounyp2tbp630kurvi0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After he learns the recipient‚Äôs server address, he sends your message via SMTP to this address, where the recipient‚Äôs mail server (MTA) will receive the message and put it in a special directory, which also looks at the service responsible for receiving messages (MDA) by clients. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qg/w0/2m/qgw02m9vwo250tvslakgxyzkblq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next time, the recipient's email client asks the incoming mail server for new messages, the MDA will send him your message.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But since mail servers work on the Internet and anyone can connect to them and send messages, as well as mail servers are widely used by various companies to exchange important data, this is a pretty tidbit for attackers, especially for spammers. </font><font style="vertical-align: inherit;">Therefore, in modern mail servers there are many additional measures for confirming the sender, checking for spam, etc. </font><font style="vertical-align: inherit;">And I will try to reveal a lot of these topics in the following parts.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494776/index.html">PostgreSQL Antipatterns: calculating conditions in SQL</a></li>
<li><a href="../en494780/index.html">Revelations and fears of an Amazon employee in the era of the coronavirus</a></li>
<li><a href="../en494782/index.html">Classify images on Android using TensorFlow Lite and Azure Custom Vision</a></li>
<li><a href="../en494784/index.html">DBLog - a common framework for Change Data Capture</a></li>
<li><a href="../en494786/index.html">MitM-like RTOS support in GDB</a></li>
<li><a href="../en494792/index.html">Yandex.Routing: how we plunged into logistics and decided to change the future</a></li>
<li><a href="../en494794/index.html">We have long arms</a></li>
<li><a href="../en494798/index.html">Snowden: pandemic will end, but surveillance of the population will remain</a></li>
<li><a href="../en494800/index.html">Reverse engineering of Chinese USB IR transceiver protocol</a></li>
<li><a href="../en494804/index.html">‚ÄúSorry, I recognized ...‚Äù or recognize raspberries and controllers using the Tensorflow Object Detection API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>