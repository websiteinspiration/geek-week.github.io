<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙆🏿 🤒 🐧 Menggunakan paralelisasi saat memproses data dalam C # 🏧 🍻 🚠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hari baik untuk semua! Saya seorang spesialis teknis yang bekerja dalam sistem audit internal, tanggung jawab saya termasuk membuat alat ETL dalam bah...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Menggunakan paralelisasi saat memproses data dalam C #</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502868/"><img src="https://habrastorage.org/webt/mr/xs/_r/mrxs_ryliqoncau3bzm0xdxj4g4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hari baik untuk semua! </font><font style="vertical-align: inherit;">Saya seorang spesialis teknis yang bekerja dalam sistem audit internal, tanggung jawab saya termasuk membuat alat ETL dalam bahasa pemrograman C #.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara berkala, sumber data adalah file yang terstruktur dengan ketat dalam format xml, csv, json, atau lainnya. Terkadang jumlah mereka menjadi cukup besar dan terus meningkat. Misalnya, dalam salah satu tugas saya, jumlah file meningkat dengan rata-rata refresh rate sekitar 150.000 file per hari. Jika pada saat yang sama memproses satu file (membaca array byte dari hard disk menjadi memori, mengubah data yang diunduh dan menulisnya ke database) membutuhkan waktu satu detik, maka menjadi jelas bahwa pemrosesan semua file akan memakan waktu lebih dari 40 jam. Dalam hal ini, kami tidak akan dapat memproses file-file ini sampai akhir, karena kecepatan meningkatkan jumlah file akan jelas lebih tinggi daripada kecepatan pemrosesan mereka.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu solusi untuk masalah ini adalah mengembangkan aplikasi untuk membuat kumpulan benang yang terpisah satu sama lain. Utas akan memproses file yang dipilih dari antrian umum. Namun, dalam kasus ini, kesulitan muncul dengan sinkronisasi arus kerja dan pembagian sumber daya, karena saling mengunci sangat mungkin terjadi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menghindari kesulitan ini, Microsoft menambahkan perpustakaan TPL ke framework .Net (dimulai dengan versi 4.0). Saya akan memberi tahu Anda cara menggunakan perpustakaan ini untuk menyelesaikan masalah ini.</font></font><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi, awalnya algoritma operasi terlihat sebagai berikut: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Direktori penyimpanan file dipindai dan daftar (misalnya, Daftar) yang berisi data tentang semua file dikembalikan; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Siklus dimulai (untuk atau foreach) di mana data dari file berikutnya dibaca ke dalam memori, jika perlu, diubah dan ditulis ke database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jelas, operasi yang paling memakan waktu adalah membaca data dari hard disk ke dalam memori dan menulis data dari memori ke database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita coba optimalkan algoritma kami menggunakan pustaka TPL: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubah daftar yang dikembalikan dengan memindai direktori penyimpanan file dari Daftar ke ConcurrentQueue.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kenapa kita melakukan ini? Faktanya adalah bahwa kelas ConcurrentQueue adalah thread aman, yaitu, jika pada saat yang sama dua utas mencoba untuk mengekstrak data dari daftar ini atau menulis data ke dalamnya, maka kami tidak akan membuang pengecualian (Pengecualian). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Poin 1 dari algoritma kami akan terlihat seperti ini: direktori penyimpanan file dipindai dan daftar ConcurrentQueue dikembalikan berisi data tentang semua file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Butir 2: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita ubah desain membentuk siklus pemrosesan data dari file. Ganti dengan Parallel.For atau Parallel.ForEach. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa perbedaan antara konstruksi baru dan untuk? Semuanya sederhana dan pada dasarnya jelas dari nama konstruk bahasa. Semua iterasi loop dilakukan dalam utas paralel. Sebagai contoh, saya akan menunjukkan organisasi loop dengan konstruk Parallel.ForEach:</font></font><br>
<br>
<pre><code class="plaintext hljs">Parallel.ForEach(listFiles, (currentFile) =&gt;<font></font>
       	  {<font></font>
              	var dataFile = getDataFile(currentFile.FullName);<font></font>
		TransformData(dataFile);<font></font>
		WriteToDB(dataFile);<font></font>
               });</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
di mana: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
listFiles adalah kumpulan tipe ConcurrentQueue yang berisi daftar file dalam direktori; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 currentFile - elemen koleksi listFiles, yang dikembalikan oleh konstruk ForEach; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 dataFile - suatu kondisional beberapa struktur data dalam memori, diperoleh dengan membaca isi file ke dalam memori; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 getDataFile - fungsi bersyarat yang mengembalikan konten file dalam bentuk beberapa struktur data; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 TransformData - prosedur bersyarat untuk mengubah data yang diterima; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 WriteToDB adalah prosedur bersyarat untuk menulis data ke database.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam contoh ini, menggunakan konstruk Parallel.ForEach, kami akan mengatur loop. Dalam siklus ini, dalam aliran paralel, data dibaca dari hard disk, transformasi dan penulisan ke database. Pada saat yang sama, tidak ada masalah dengan organisasi thread paralel. Jumlah utas paralel tergantung pada jumlah inti prosesor dan beban kerjanya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan menggunakan algoritma yang diusulkan, kami akan mempercepat pemrosesan file setidaknya 2 kali. Meskipun, tentu saja, angka ini akan bervariasi tergantung pada jumlah inti dan memori mesin tempat program akan berjalan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, untuk mempercepat program, Anda harus meletakkan catatan di basis data dalam aliran terpisah yang berfungsi terlepas dari yang utama. Ini dapat dilakukan dengan menggunakan koleksi ConcurrentQueue untuk menghindari konflik saat menambahkan data ke antrian.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menulis ulang contoh di atas, dengan mempertimbangkan pengoptimalan penulisan ke basis data. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan pembaca file mengembalikan data kepada kami di DataTable):</font></font><br>
<br>
<pre><code class="plaintext hljs">Parallel.ForEach(listFiles, (currentFile) =&gt;<font></font>
       	  {<font></font>
              	DataTable dataFile = getDataFile(currentFile.FullName);<font></font>
		TransformData(dataFile);<font></font>
		threadWriteToDB.ListData.Enqueue(dataFile);<font></font>
               });<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, alih-alih sebuah baris dengan panggilan ke prosedur tulis dalam database, kami cukup menambah koleksi ConcurrentQueue ListData yang diuraikan dan diinisialisasi dalam utas terpisah, contoh yang threadWriteToDB digunakan dalam loop kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menulis ke basis data sudah dalam aliran terpisah. </font><font style="vertical-align: inherit;">Menulis ke database dapat diatur seperti halnya bekerja dengan file menggunakan konstruksi Parallel.For dan / atau Paral-lel.Foreach. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam tugas saya, di mana diperlukan untuk memproses jumlah file yang sebanding, sekarang dapat memproses rata-rata dari 200.000 hingga 400.000 file per hari, dan kecepatan dibatasi dengan memuat basis data dan lebar saluran data.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id502846/index.html">Zuckerberg meluncurkan Shops. Instagram dan Facebook secara bertahap menjadi toko.</a></li>
<li><a href="../id502852/index.html">Mengapa orang menolak perubahan dan bagaimana mereka dapat membantu mereka membangun kembali</a></li>
<li><a href="../id502854/index.html">Mengapa implementasi ERP gagal?</a></li>
<li><a href="../id502860/index.html">Transportasi pada 20 Mei: pemulihan penerbangan yang cepat terlihat</a></li>
<li><a href="../id502862/index.html">LabVIEW NXG - Dasar-Dasar Panel Depan - Kontrol dan Indikator</a></li>
<li><a href="../id502870/index.html">Apa yang terjadi dengan popularitas MySQL dan PostgreSQL? Diskusi mitap</a></li>
<li><a href="../id502872/index.html">Bagaimana memperkuat kekebalan dan melindungi terhadap SARS dan, mungkin, COVID-19. Bukti Sains</a></li>
<li><a href="../id502874/index.html">Tentang matriks dan suasana yang kuat di tim pengembangan</a></li>
<li><a href="../id502876/index.html">Alur kerja di Google Drive?</a></li>
<li><a href="../id502880/index.html">Sejarah AtariTel. Telepon dan videophone dari departemen rahasia perusahaan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>