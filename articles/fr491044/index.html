<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòà üôçüèæ üë®üèæ‚Äçüîß Orchestrator et VIP en tant que solution HA pour le cluster MySQL üõÅ ‚úåüèΩ ‚úä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans CityMobile, nous utilisons la base de donn√©es MySQL comme stockage principal pour les donn√©es persistantes. Nous avons plusieurs clusters de base...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Orchestrator et VIP en tant que solution HA pour le cluster MySQL</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/citymobil/blog/491044/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans CityMobile, nous utilisons la base de donn√©es MySQL comme stockage principal pour les donn√©es persistantes. </font><font style="vertical-align: inherit;">Nous avons plusieurs clusters de bases de donn√©es pour diff√©rents services et objectifs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La disponibilit√© constante de l'assistant est un indicateur critique de la sant√© de l'ensemble du syst√®me et de ses diff√©rentes parties. </font><font style="vertical-align: inherit;">La r√©cup√©ration automatique du cluster en cas de d√©faillance de l'assistant r√©duit consid√©rablement le temps de r√©ponse aux incidents et les temps d'arr√™t du syst√®me. </font><font style="vertical-align: inherit;">Dans cet article, je vais regarder un cluster </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HA bas√© sur </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">MySQL Orchestrator</font></a><font style="vertical-align: inherit;"> et des adresses IP virtuelles (VIP).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dn/78/bb/dn78bbg_qvozrgufsyzr0joysuw.png"><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solution VIP HA</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais d'abord parler bri√®vement de ce √† quoi ressemble notre syst√®me de stockage de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons le sch√©ma de r√©plication classique avec un assistant en √©criture seule et de nombreuses r√©pliques en lecture seule. Un cluster peut contenir un ma√Ætre interm√©diaire - un n≈ìud qui est √† la fois une r√©plique et un ma√Ætre pour les autres. Les clients acc√®dent aux r√©pliques via HAProxy, ce qui permet une r√©partition uniforme de la charge et une √©volutivit√© ais√©e. L'utilisation de HAProxy est due √† des raisons historiques, et maintenant nous sommes en train de migrer vers ProxySQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La r√©plication est semi-synchrone bas√©e sur</font></font><code>GTID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cela signifie qu'au moins une r√©plique doit √©crire la transaction dans le journal avant qu'elle ne soit consid√©r√©e comme r√©ussie. Ce mode de r√©plication offre un √©quilibre optimal entre performances et s√©curit√© des donn√©es en cas de panne du n≈ìud principal. Fondamentalement, toutes les modifications sont transf√©r√©es du ma√Ætre aux r√©pliques √† l'aide </font></font><code>Row Based Replication (RBR)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais certains n≈ìuds peuvent l'√™tre </font></font><code>mixed binlog format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'orchestrateur met √† jour p√©riodiquement l'√©tat de la topologie du cluster, analyse les informations re√ßues et, en cas de probl√®me, peut d√©marrer la proc√©dure de r√©cup√©ration automatique. Le d√©veloppeur est responsable de la proc√©dure elle-m√™me, car elle peut √™tre impl√©ment√©e de diff√©rentes mani√®res: bas√©e sur VIP, DNS, en utilisant des services de d√©couverte de services ou des m√©canismes autonomes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une des fa√ßons les plus simples de restaurer un assistant en cas d'√©chec consiste √† utiliser des adresses VIP flottantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce que vous devez savoir sur cette solution avant de poursuivre:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VIP est une adresse IP qui n'est pas li√©e √† une interface r√©seau physique sp√©cifique. </font><font style="vertical-align: inherit;">Lorsqu'un n≈ìud tombe en panne ou pendant un travail planifi√©, nous pouvons basculer le VIP vers une autre ressource avec un temps d'arr√™t minimal.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La publication et la d√©livrance d'une adresse IP virtuelle est une op√©ration rapide et bon march√©.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour travailler avec le VIP, il faut acc√©der au serveur via SSH ou utiliser des outils sp√©ciaux, par exemple </font></font><code>keepalived</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous examinerons les probl√®mes possibles avec notre ma√Ætre et imaginerons comment le m√©canisme de r√©cup√©ration automatique devrait fonctionner.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La connectivit√© r√©seau au ma√Ætre a disparu ou un probl√®me est survenu au niveau mat√©riel et le serveur n'est pas disponible</font></font></h4><br>
<ol>
<li>   ,      .     ,     ,   .<br>
</li>
<li>  VIP    ‚Äî .<br>
</li>
<li>    .  .<br>
</li>
<li>     VIP.   VIP  ,        <b>gratuitous ARP</b>.   /        IP-  MAC-,       VIP.    <code>split brain</code>    . <br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les nouvelles connexions sont imm√©diatement redirig√©es vers le nouveau ma√Ætre. </font><font style="vertical-align: inherit;">Les anciennes connexions √©chouent, des appels r√©p√©t√©s sont effectu√©s vers la base de donn√©es au niveau de l'application.</font></font><br>
</li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le serveur fonctionne en mode normal; une d√©faillance s'est produite au niveau du SGBD</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme est similaire au cas pr√©c√©dent: mise √† jour de la topologie et d√©marrage du processus de r√©cup√©ration. </font><font style="vertical-align: inherit;">Puisque le serveur est disponible, nous lib√©rons avec succ√®s le VIP sur l'ancien ma√Ætre, le transf√©rons vers le nouveau et envoyons plusieurs requ√™tes ARP. </font><font style="vertical-align: inherit;">Le retour possible de l'ancien assistant ne devrait pas affecter le cluster reconstruit et le fonctionnement de l'application.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D'autres probl√®mes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La d√©faillance des r√©pliques ou des ma√Ætres interm√©diaires </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne conduit pas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† des actions automatiques et n√©cessite une intervention manuelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'interface r√©seau virtuelle est toujours ajout√©e temporairement, c'est-√†-dire qu'apr√®s le red√©marrage, le serveur VIP n'est pas automatiquement attribu√©. </font><font style="vertical-align: inherit;">Chaque instance de la base de donn√©es est lanc√©e par d√©faut en mode lecture seule, l'orchestrateur bascule automatiquement le nouveau ma√Ætre en enregistrement et essaie de l'installer </font></font><code>read only</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur l'ancien ma√Ætre. </font><font style="vertical-align: inherit;">Ces actions visent √† r√©duire la probabilit√© </font></font><code>split brain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours du processus de r√©cup√©ration, des probl√®mes peuvent survenir, qui doivent √©galement √™tre notifi√©s via l'interface utilisateur de l'orchestrateur en plus des outils de surveillance standard. </font><font style="vertical-align: inherit;">Nous avons √©tendu l'API REST en ajoutant cette fonctionnalit√© ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est actuellement √† l'√©tude).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sch√©ma g√©n√©ral de la solution HA est pr√©sent√© ci-dessous.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yl/pk/gk/ylpkgksjn1cfj0wdbil7dje9qss.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choisir un nouvel assistant</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'orchestre est assez intelligent et essaie de choisir la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©plique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">plus appropri√©e en</font></a><font style="vertical-align: inherit;"> tant que nouveau ma√Ætre selon les crit√®res suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©calage de la r√©plique du ma√Ætre;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assistant MySQL et version r√©plique;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type de r√©plication (RBR, SBR ou mixte);</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">emplacement dans un ou plusieurs centres de donn√©es;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disponibilit√© </font></font><code>errant GTID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- transactions effectu√©es sur la r√©plique et absentes sur le ma√Ætre;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des r√®gles de s√©lection personnalis√©es sont √©galement prises en compte.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les r√©pliques ne sont pas un candidat id√©al pour le r√¥le de ma√Ætre. </font><font style="vertical-align: inherit;">Par exemple, une r√©plique peut √™tre utilis√©e pour sauvegarder des donn√©es, ou le serveur a une configuration mat√©rielle plus faible. </font><font style="vertical-align: inherit;">L'orchestrateur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend en charge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les r√®gles manuelles par lesquelles vous pouvez ajuster vos pr√©f√©rences pour choisir un candidat parmi les plus pr√©f√©r√©s ou ignor√©s.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temps de r√©ponse et de r√©cup√©ration</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cas d'incident, il est important de minimiser le temps d'arr√™t du syst√®me, par cons√©quent, nous consid√©rons les param√®tres MySQL qui affectent la construction et la mise √† jour de la topologie du cluster par l'orchestre:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>slave_net_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- le nombre de secondes pendant lesquelles la r√©plique attend de nouvelles donn√©es ou un signal de pulsation du ma√Ætre avant que la connexion ne soit reconnue comme perdue et que la reconnexion soit effectu√©e. </font><font style="vertical-align: inherit;">Plus la valeur est faible, plus la r√©plique pourra d√©terminer rapidement que la connexion avec le ma√Ætre est rompue. </font><font style="vertical-align: inherit;">Nous d√©finissons cette valeur sur 5 secondes.</font></font><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>MASTER_CONNECT_RETRY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- le nombre de secondes entre les tentatives de reconnexion. </font><font style="vertical-align: inherit;">En cas de probl√®mes de r√©seau, une valeur faible de ce param√®tre vous permettra de vous reconnecter rapidement et d'emp√™cher le d√©marrage du processus de r√©cup√©ration du cluster. </font><font style="vertical-align: inherit;">La valeur recommand√©e est de 1 seconde.</font></font><br>
</li>
<li><code>MASTER_RETRY_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Le nombre maximum de tentatives de reconnexion. </font></font><br>
</li>
<li><code>MASTER_HEARTBEAT_PERIOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- l'intervalle en secondes apr√®s lequel le ma√Ætre envoie un signal de rythme cardiaque. </font><font style="vertical-align: inherit;">La valeur par d√©faut est la moiti√© de la valeur </font></font><code>slave_net_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Options d'orchestrateur:</font></font><br>
<br>
<ul>
<li><code>DelayMasterPromotionIfSQLThreadNotUpToDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- si √©gal </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le r√¥le de l'assistant ne sera pas appliqu√© sur la r√©plique candidate tant que le flux SQL de r√©plique n'aura pas termin√© toutes les transactions non appliqu√©es √† partir du journal de relais. </font><font style="vertical-align: inherit;">Nous utilisons cette option afin de ne pas perdre de transactions lorsque toutes les r√©pliques candidates sont en retard.</font></font><br>
</li>
<li><code>InstancePollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la fr√©quence de construction et de mise √† jour de la topologie.</font></font><br>
</li>
<li><code>RecoveryPollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- fr√©quence d'analyse de la topologie. </font><font style="vertical-align: inherit;">Si un probl√®me est d√©tect√©, la r√©cup√©ration de la topologie d√©marre. </font><font style="vertical-align: inherit;">Il s'agit d'une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©gale √† 1 seconde.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque n≈ìud de cluster est interrog√© par l'orchestrateur une fois par </font></font><code>InstancePollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seconde. </font><font style="vertical-align: inherit;">Lorsqu'un probl√®me est d√©tect√©, l'√©tat du cluster est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mis √† jour de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> force </font><font style="vertical-align: inherit;">, puis la d√©cision finale est prise pour effectuer la r√©cup√©ration. </font><font style="vertical-align: inherit;">En exp√©rimentant diff√©rents param√®tres de la base de donn√©es et de l'orchestre, nous avons pu r√©duire la dur√©e de la r√©ponse et de la r√©cup√©ration √† 30 secondes.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banc d'essai</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons commenc√© √† tester le syst√®me HA en d√©veloppant un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banc de test</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> local </font><font style="vertical-align: inherit;">et en le mettant en ≈ìuvre dans un environnement de test et de combat. </font><font style="vertical-align: inherit;">Le stand local est enti√®rement automatis√© bas√© sur Docker et vous permet d'exp√©rimenter la configuration de l'orchestre et du r√©seau, de faire √©voluer le cluster de 2-3 serveurs √† plusieurs dizaines et de mener des exercices dans un environnement s√ªr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours des exercices, nous choisissons l'une des m√©thodes pour √©muler le probl√®me: lancer instantan√©ment l'assistant avec </font></font><code>kill -9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, terminer doucement le processus et arr√™ter le serveur ( </font></font><code>docker-compose stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), simuler les probl√®mes de r√©seau avec </font></font><code>iptables -j REJECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>iptables -j DROP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous attendons ces r√©sultats:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'orchestre d√©tectera les probl√®mes avec le ma√Ætre et mettra √† jour la topologie en moins de 10 secondes;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la proc√©dure de r√©cup√©ration d√©marre automatiquement: la configuration du r√©seau va changer, le r√¥le de l'assistant ira √† la r√©plique, la topologie sera reconstruite;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le nouveau master sera disponible pour l'enregistrement, les r√©pliques live ne seront pas perdues lors du processus de reconstruction;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les donn√©es commenceront √† √™tre √©crites sur le nouveau ma√Ætre et r√©pliqu√©es;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le temps de r√©cup√©ration total ne d√©passera pas 30 secondes.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous le savez, un syst√®me peut se comporter diff√©remment dans les environnements de test et de production en raison des diff√©rentes configurations de mat√©riel et de r√©seau, des diff√©rences de charge synth√©tique et r√©elle, etc. </font><font style="vertical-align: inherit;">Par cons√©quent, nous effectuons p√©riodiquement des exercices en conditions r√©elles, v√©rifiant le comportement du syst√®me en cas de perte de connectivit√© r√©seau ou de d√©gradation de ses diff√©rentes parties. </font><font style="vertical-align: inherit;">√Ä l'avenir, nous voulons construire une infrastructure compl√®tement identique pour les deux environnements et automatiser ses tests.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©sultats</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'op√©rabilit√© du n≈ìud principal du syst√®me de stockage est l'une des principales t√¢ches de l'√©quipe SRE et de son fonctionnement. </font><font style="vertical-align: inherit;">L'introduction de l'orchestre et des solutions HA bas√©es sur VIP a permis d'obtenir les r√©sultats suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©tection fiable des probl√®mes avec la topologie du cluster de base de donn√©es;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©ponse automatique et rapide aux incidents li√©s au ma√Ætre, ce qui r√©duit les temps d'arr√™t du syst√®me.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, la solution a ses limites et ses inconv√©nients:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'adaptation du sch√©ma HA √† plusieurs centres de donn√©es n√©cessitera un r√©seau L2 unique entre eux;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avant d'attribuer un VIP au nouveau ma√Ætre, nous devons le lib√©rer sur l'ancien. </font><font style="vertical-align: inherit;">Le processus est s√©quentiel, ce qui augmente le temps de r√©cup√©ration;</font></font><br>
</li>
<li> VIP  SSH-  ,       .      ,   ,     ,   VIP  .            IP-   <code>split brain</code>.<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour √©viter cela </font></font><code>split brain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez utiliser la m√©thode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STONITH</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (¬´Shoot The Other Node In The Head¬ª), qui isole ou d√©connecte compl√®tement le n≈ìud probl√©matique. </font><font style="vertical-align: inherit;">Il existe d'autres fa√ßons d'impl√©menter la haute disponibilit√© du cluster: une combinaison de VIP et DNS, de services de d√©couverte et de proxy, de r√©plication synchrone et d'autres m√©thodes qui ont leurs inconv√©nients et leurs avantages. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai parl√© de notre approche pour cr√©er un cluster de basculement MySQL. </font><font style="vertical-align: inherit;">Il est facile √† mettre en ≈ìuvre et offre un niveau de fiabilit√© acceptable dans l'environnement actuel. </font><font style="vertical-align: inherit;">Avec le d√©veloppement de l'ensemble du syst√®me dans son ensemble et des infrastructures en particulier, cette approche √©voluera sans aucun doute.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr491032/index.html">"RTFM, mec!", Ou comment le fromage gratuit m'a co√ªt√© 5 $. Et cela aurait pu √™tre √† 80 $ et plus</a></li>
<li><a href="../fr491034/index.html">WireGuard - VPN rapide et s√©curis√© dans le noyau Linux</a></li>
<li><a href="../fr491036/index.html">Quand un framework JavaScript n'est pas n√©cessaire</a></li>
<li><a href="../fr491038/index.html">Yandex ouvre Testsuite</a></li>
<li><a href="../fr491040/index.html">Meetup QA √† Nizhny - tel quel et le mat√©riel de l'√©v√©nement</a></li>
<li><a href="../fr491050/index.html">Inscription √† NeoQUEST-2020: Open World post-apocalyptique</a></li>
<li><a href="../fr491052/index.html">Comment et pourquoi les conservateurs du HSE de Saint-P√©tersbourg aident les programmeurs de premi√®re ann√©e</a></li>
<li><a href="../fr491054/index.html">Comment signer une correspondance par e-mail avec une cl√© GPG √† l'aide de jetons PKCS # 11</a></li>
<li><a href="../fr491056/index.html">Ampere Altra - le premier processeur ARM 80 c≈ìurs au monde</a></li>
<li><a href="../fr491058/index.html">Mortalit√©, mortalit√©, coronavirus et matan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>