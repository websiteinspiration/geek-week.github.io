<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏾 🌙 🤽🏽 PHPUnit。「どうすれば私のコントローラーをテストできますか」、または疑わしい人のためのテスト 👩‍💼 🍒 👨🏾‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル。
 
 
 
 はい、これはテストのトピックに関する別の投稿です。ここですでに議論することは可能だと思われますか？それを必要とするすべて-彼らはテストを書き、それを必要としない-彼らは書きません、誰もが幸せです！事実は、ユニットテストに関するほとんどの投稿に...どうすれば誰も気...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PHPUnit。「どうすれば私のコントローラーをテストできますか」、または疑わしい人のためのテスト</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485418/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/do/li/as/doliasx6rmfzgqhvfc-7jdazq-w.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、これはテストのトピックに関する別の投稿です。</font><font style="vertical-align: inherit;">ここですでに議論することは可能だと思われますか？</font><font style="vertical-align: inherit;">それを必要とするすべて-彼らはテストを書き、それを必要としない-彼らは書きません、誰もが幸せです！</font><font style="vertical-align: inherit;">事実は、ユニットテストに関するほとんどの投稿に...どうすれば誰も気分を害しないでしょう...ばかげた例！</font><font style="vertical-align: inherit;">いや、本当に！</font><font style="vertical-align: inherit;">今日、私はそれを修正しようとします。</font><font style="vertical-align: inherit;">猫をお願いします。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、テストのトピックをすばやく検索すると、大量の記事が見つかります。それらの記事は、2つのカテゴリに分類されます</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。1）コピーライターの幸福。最初に長い紹介、次に古代ロシアでのユニットテストの歴史、次にテストによる10のライフハック、そして最後に例を示します。このようなコードのテストでは：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Calculator</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">plus</span>(<span class="hljs-params">$a, $b</span>)
    </span>{
         <span class="hljs-keyword">return</span> $a + $b;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、私は今冗談ではありません。勉強ガイドとして「電卓」の記事を見ました。はい、はい、私は最初に前後にすべて、抽象化を単純化する必要があることを理解しています...しかし、これがすべての終わりです！そして、彼らが言うように、フクロウを完成させます</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2）過度に複雑な例。テストを作成してGitlab CIに詰め込み、テストに合格した場合は自動デバッグし、テストにPHP感染を適用しますが、すべてをHudsonに接続します。などのスタイルで。便利なようですが、探しているものとはまったく違うようです。ただし、プロジェクトの安定性を少し高めたいだけです。そして、これらすべての継続性-それでは、一度にすべてではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、人々は「私はそれが必要ですか」と疑います。次に、テストについてより明確に説明したいと思います。そして、すぐに予約してください。私は開発者であり、テスターではありません。私自身はあまり知らないはずですし、人生の最初の言葉は「mok」ではありませんでした。私はTDDに取り組んだことさえありません！しかし、私の現在のレベルのスキルでさえ、テストでいくつかのプロジェクトをカバーすることができたことを確かに知っています、そしてこれらのまさにテストはすでにダースのバグを捕らえました。そして、それが私を助けてくれるなら、それは他の誰かを助けることができるでしょう。捕獲されたバグの中には、手動で捕獲することが難しいものもあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、質疑応答形式の短い教育プログラム：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Q：ある種のフレームワークを使用する義務がありますか？ Yiiを持っている場合はどうなりますか？コハナの場合はどうなりますか？ if％one_more_framework_name％？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A：いいえ、PHPUnitは独立したテストフレームワークです。自作のフレームワークのレガシーコードにそれをねじ込むこともできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Q：現在、サイト内をすばやく移動していますが、それは正常です。なぜ必要なのですか？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A：数十のテストの「実行」は数秒続きます。自動テストは常に手動テストよりも高速で、高品質のテストを使用すると、すべてのシナリオをカバーできるため、信頼性も高くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Q：2000行の関数を持つレガシーコードがあります。これをテストできますか？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A：はい、いいえ。理論的には、はい、どのコードもテストでカバーできます。実際には、コードは将来のテストのための土台で書かれるべきです。 2000行関数には、依存関係、分岐、境界ケースが多すぎます。最終的にそれをすべてカバーすることになるかもしれませんが、それはおそらくあなたに受け入れられないほど長い時間がかかります。コードが良いほど、テストが簡単になります。単一責任の原則が順守されているほど、テストは容易になります。古いプロジェクトをテストするには、ほとんどの場合、最初にそれらを冷却する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c5/oa/ze/c5oaze8gmau8ticskgu44o5wyza.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Q：私は非常に単純なメソッド（関数）を持っていますが、何をテストする必要がありますか？すべてが信頼でき、エラーの余地はありません！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A：関数の正しい実装をテストしていないこと（TDDがない場合）ではなく、単に現在の作業状態を「修正」することを理解する必要があります。将来、それを変更する必要がある場合、テストを使用してその動作を壊したかどうかをすばやく判別できます。例：メールを検証する関数があります。彼女はそれを定期的にしています。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValid</span>(<span class="hljs-params">$email</span>)
</span>{<font></font>
    $regex = <span class="hljs-string">"very_complex_regex_here"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (is_array($email)) {<font></font>
        $result = <span class="hljs-literal">true</span>;<font></font>
<font></font>
        <span class="hljs-keyword">foreach</span> ($email <span class="hljs-keyword">as</span> $item) {
            <span class="hljs-keyword">if</span> (preg_match($regex, $item) === <span class="hljs-number">0</span>) {<font></font>
                $result = <span class="hljs-literal">false</span>;<font></font>
            }<font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        $result = preg_match($regex, $emai) ==! <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> $result;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのコードは、この関数に有効な電子メールを渡すとtrueが返されることを期待しています。有効なメールの配列も当てはまります。無効なメールアドレスが少なくとも1つある配列はfalseです。そうですね、コードは明確です。しかし、その日が来て、巨大なレギュラーシーズンを外部APIに置き換えることにしました。しかし、書き換えられた関数が動作原理を変更していないことをどのように保証するのでしょうか？いきなり配列が上手くいかない？それともブール値ではなく戻りますか？そしてテストはこれを制御下に保つことができます。適切に記述されたテストは、期待された以外の関数の動作をすぐに示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Q：テストから何らかの意味が見え始めるのはいつですか？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A：まず、コードの重要な部分をカバーするとすぐに。カバレッジが100％に近いほど、テストの信頼性が高くなります。次に、グローバルな変更、またはコードの複雑な部分の変更を行う必要があるとすぐに。テストでは、手動で簡単に見逃す可能性がある問題（境界線の場合）を検出できます。第三に、テスト自体を書くとき！多くの場合、テストを作成すると、一見して見えないコードの欠陥が明らかになる場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Q：ええと、私はlaravelのウェブサイトを持っています。このサイトは機能ではなく、コードの山のような山のようなものです。ここでテストする方法は？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A：これについては後で説明します。つまり、コントローラーのメソッド、ミドルウェア、サービスなどを個別にテストします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユニットテストのアイデアの1つは、テストされたコードのセクションを分離することです。 1つのテストでテストするコードが少ないほど、優れています。実際の例にできるだけ近い例を見てみましょう。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$userService, $emailService</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;userService = $userService;
        <span class="hljs-keyword">$this</span>-&gt;emailService = $emailService;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params">$request</span>)
    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($request-&gt;login) || <span class="hljs-keyword">empty</span>($request-&gt;password)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Auth error"</span>;<font></font>
        }<font></font>
<font></font>
        $password = <span class="hljs-keyword">$this</span>-&gt;userService-&gt;getPasswordFor($request-&gt;login);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($password)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Auth error - no password"</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> ($password !== $request-&gt;password) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Incorrect password"</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">$this</span>-&gt;emailService-&gt;sendEmail($request-&gt;login);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Success"</span>;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ....</span><font></font>
<font></font>
<span class="hljs-comment">/* somewhere in project core */</span>
$controller = <span class="hljs-keyword">new</span> Controller($userService, $emailService);<font></font>
<font></font>
$controller-&gt;login($request);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、小規模なプロジェクトでシステムにログインするための非常に典型的な方法です。期待されるのは、正しいエラーメッセージと、ログインが成功した場合に送信される電子メールだけです。この方法をテストする方法は？まず、外部の依存関係を特定する必要があります。私たちのケースでは、それらの2つ-$ userServiceと$ emailServiceがあります。これらはクラスコンストラクターを介して渡されるため、タスクが大幅に容易になります。ただし、前述のように、1つのパスでテストするコードが少ないほど、優れています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクトのエミュレーション、置換はmokanyと呼ばれます（英語から。モックオブジェクト、文字通り「オブジェクトパロディ」）。そのようなオブジェクトを手動で書くことに煩わされる人はいませんが、すべてがすでに私たちの前で発明されているので、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mockery</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのすばらしいライブラリが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">役に立ち</font></a><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。サービス用のモカを作成しましょう。</font></font><br>
<br>
<pre><code class="php hljs">$userService = Mockery::mock(<span class="hljs-string">'user_service'</span>);<font></font>
$emailService = Mockery::mock(<span class="hljs-string">'email_service'</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$リクエストオブジェクトを作成します。</font><font style="vertical-align: inherit;">まず、ログインフィールドとパスワードフィールドをチェックするロジックをテストします。</font><font style="vertical-align: inherit;">存在しない場合、メソッドがこのケースを正しく処理し、目的の（！）メッセージを返すことを確認します。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testEmptyLogin</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $userService = Mockery::mock(<span class="hljs-string">'user_service'</span>);<font></font>
    $emailService = Mockery::mock(<span class="hljs-string">'email_service'</span>);<font></font>
<font></font>
    $controller = <span class="hljs-keyword">new</span> Controller($userService, $emailService);<font></font>
<font></font>
    $request = (<span class="hljs-keyword">object</span>) [];<font></font>
<font></font>
    $result = $controller-&gt;login($request);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複雑なことはありませんか？</font><font style="vertical-align: inherit;">必要なクラスパラメータのスタブを作成し、目的のクラスのインスタンスを作成し、目的のメソッドを "プル"して、意図的に間違ったリクエストを渡しました。</font><font style="vertical-align: inherit;">答えを得た。</font><font style="vertical-align: inherit;">しかし、今それを確認する方法は？</font><font style="vertical-align: inherit;">これはテストの最も重要な部分、いわゆるアサーションです。</font><font style="vertical-align: inherit;">PHPUnitには、多数の既製の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アサーションがあり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">そのうちの1つを使用してください。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testEmptyLogin</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $userService = Mockery::mock(<span class="hljs-string">'user_service'</span>);<font></font>
    $emailService = Mockery::mock(<span class="hljs-string">'email_service'</span>);<font></font>
<font></font>
    $controller = <span class="hljs-keyword">new</span> Controller($userService, $emailService);<font></font>
<font></font>
    $request = (<span class="hljs-keyword">object</span>) [];<font></font>
<font></font>
    $result = $controller-&gt;login($request);<font></font>
    <font></font>
    <span class="hljs-comment">// vv assertion here! vv</span>
    <span class="hljs-keyword">$this</span>-&gt;assertEquals(<span class="hljs-string">"Auth error"</span>, $result);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテストは次のことを保証します。オブジェクトの引数が、ログインフィールドまたはパスワードフィールドを持たないメソッドに到達した場合、メソッドは文字列「Auth error」を返します。それが一般的にはすべてです。とても単純ですが、何かを壊すことを恐れずにloginメソッドを編集できるので、とても便利です。私たちのフロントエンドは、何かが発生した場合に、彼がそのようなエラーを受け取ることを確認できます。そして、誰かがこの動作を破った場合（たとえば、エラーテキストを変更することを決定した場合）-テストはすぐにこれを通知します！可能な限り多くのシナリオをカバーするために、残りのチェックを追加します。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testEmptyPassword</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $userService = Mockery::mock(<span class="hljs-string">'user_service'</span>);<font></font>
<font></font>
    <span class="hljs-comment">// $userService-&gt;getPasswordFor(__any__arg__); // ''</span>
    $userService-&gt;shouldReceive(<span class="hljs-string">'getPasswordFor'</span>)-&gt;andReturn(<span class="hljs-string">''</span>);<font></font>
<font></font>
    $emailService = Mockery::mock(<span class="hljs-string">'email_service'</span>);<font></font>
<font></font>
    $request = (<span class="hljs-keyword">object</span>) [
        <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'john'</span>,
        <span class="hljs-string">'pass'</span> =&gt; <span class="hljs-string">'1234'</span><font></font>
    ];<font></font>
<font></font>
    $result = (<span class="hljs-keyword">new</span> Controller($userService, $emailService))-&gt;login($request);<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEquals(<span class="hljs-string">"Auth error - no password"</span>, $result);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testUncorrectPassword</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $userService = Mockery::mock(<span class="hljs-string">'user_service'</span>);<font></font>
<font></font>
    <span class="hljs-comment">// $userService-&gt;getPasswordFor(__any__arg__); // '4321'</span>
    $userService-&gt;shouldReceive(<span class="hljs-string">'getPasswordFor'</span>)-&gt;andReturn(<span class="hljs-string">'4321'</span>);<font></font>
<font></font>
    $emailService = Mockery::mock(<span class="hljs-string">'email_service'</span>);<font></font>
<font></font>
    $request = (<span class="hljs-keyword">object</span>) [
        <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'john'</span>,
        <span class="hljs-string">'pass'</span> =&gt; <span class="hljs-string">'1234'</span><font></font>
    ];<font></font>
<font></font>
    $result = (<span class="hljs-keyword">new</span> Controller($userService, $emailService))-&gt;login($request);<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEquals(<span class="hljs-string">"Incorrect password"</span>, $result);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testSuccessfullLogin</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $userService = Mockery::mock(<span class="hljs-string">'user_service'</span>);<font></font>
<font></font>
    <span class="hljs-comment">// $userService-&gt;getPasswordFor(__any__arg__); // '1234'</span>
    $userService-&gt;shouldReceive(<span class="hljs-string">'getPasswordFor'</span>)-&gt;andReturn(<span class="hljs-string">'1234'</span>);<font></font>
<font></font>
    $emailService = Mockery::mock(<span class="hljs-string">'email_service'</span>);<font></font>
<font></font>
    $request = (<span class="hljs-keyword">object</span>) [
        <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'john'</span>,
        <span class="hljs-string">'pass'</span> =&gt; <span class="hljs-string">'1234'</span><font></font>
    ];<font></font>
<font></font>
    $result = (<span class="hljs-keyword">new</span> Controller($userService, $emailService))-&gt;login($request);<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEquals(<span class="hljs-string">"Success"</span>, $result);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shouldReceiveメソッドとandReturnメソッドに注目してください。これらにより、必要なものだけを返すメソッドをスタブ内に作成できます。間違ったパスワードエラーをテストする必要がありますか？常に間違ったパスワードを返すスタブ$ userServiceを記述します。以上です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
依存関係についてはどうでしょうか。それから私たちは彼らを「溺れさせました」、そして彼らが壊れたらどうしますか？しかし、これがまさにテストでの最大のコードカバレッジの目的です。ログインのコンテキストでこれらのサービスの動作をチェックすることはありません-サービスの正しい動作を期待してログインをテストします。次に、これらのサービスに対して同じ分離テストを記述します。そして、それらの依存関係をテストします。等。その結果、個々のテストは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての依存関係が正しく機能する場合、小さなコードの正しい操作。また、すべての依存関係もテストでカバーされているため、それらの正しい動作も保証されています。その結果、最小のコードでもロジックが壊れるようなシステムへの変更は、特定のテストにすぐに反映されます。テスト実行の具体的な方法-わかりませんが、PHPUnitのドキュメントは非常に優れています。たとえば、Laravelでは、プロジェクトのルートからvendor / bin / phpunitを実行してこのようなメッセージを表示するだけで十分</font></font><br>
<br>
<img src="https://habrastorage.org/webt/va/bc/co/vabccob2dpo9xiqk7ek9syxinmo.jpeg" alt="画像"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。すべてのテストが正常に終了しました。または、このようなものです</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bh/mc/pu/bhmcpuar0iluxa8nxxmwrkdgvqs.jpeg" alt="画像"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。7つのアサーションの1つが失敗しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「もちろん、これはクールですが、手に負えないものは何ですか？」 - あなたが尋ねる。そして、このための次のコードを想像してみましょう</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params">$infoApi, $userName</span>)
</span>{<font></font>
    $response = $infoApi-&gt;getInfo($userName);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ($response-&gt;status === <span class="hljs-string">"API Error"</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> $response-&gt;result;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ... somewhere in system</span><font></font>
<font></font>
$api = <span class="hljs-keyword">new</span> ExternalApi();<font></font>
<font></font>
$info = getInfo($api, <span class="hljs-string">'John'</span>);<font></font>
<font></font>
<span class="hljs-keyword">if</span> ($info === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">die</span>(<span class="hljs-string">'Api is down'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">echo</span> $info;
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
外部APIを操作する簡略化されたモデルが表示されます。この関数は、クラスを使用してAPIを処理し、エラーの場合はnullを返します。この関数を使用しているときにnullが発生した場合は、「パニックを発生させます」（メッセージをスラックに送信するか、開発者にメールを送信するか、エラーをキバナにスローします。はい、多数のオプションがあります）。すべてがシンプルに見えますよね？しかし、しばらくして、別の開発者がこの機能を「修正」することにしたと想像してください。彼はnullを返すのは最後の世紀であり、例外をスローするべきだと決めました。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params">$infoApi, $userName</span>): <span class="hljs-title">string</span>
</span>{<font></font>
    $response = $infoApi-&gt;getInfo($userName);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ($response-&gt;status === <span class="hljs-string">"API Error"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApiException($response);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> $response-&gt;result;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、この関数が呼び出されたコードのすべてのセクションを書き直しました。 1つを除くすべて。彼は彼を逃した。気が散って、疲れて、間違っている-しかし、あなたは決して知りません。実際のところ、1つのコードが古い関数の動作を待っています。また、PHPはJavaではありません。スロー可能な関数がtry-catchでラップされていないという理由でコンパイルエラーが発生することはありません。その結果、サイトを使用するための100のシナリオの1つで、APIクラッシュが発生した場合、システムからメッセージを受信しません。さらに、手動テストでは、このバージョンのイベントをキャッチできない可能性が高くなります。 APIは外部であり、私たちには依存せず、適切に機能します。APIが失敗し、例外が正しく処理されない場合、APIを手に入れることができません。しかし、テストがある場合、ExternalApiクラスが多くのテストで「こもられ」、通常の動作としてエミュレートされるため、テストはこのケースを非常にうまくキャッチします。とても落ちる。そして次のテストは落ちる</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testApiFail</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $api = Mockery::mock(<span class="hljs-string">'api'</span>);<font></font>
<font></font>
    $api-&gt;shouldReceive(<span class="hljs-string">'getInfo'</span>)-&gt;andReturn((<span class="hljs-keyword">object</span>) [
        <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'API Error'</span><font></font>
    ]);<font></font>
<font></font>
    $result = getInfo($api, <span class="hljs-string">'name'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertNull($result);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、この情報で十分です。</font><font style="vertical-align: inherit;">レガシーヌードルがない場合は、20〜30分後に最初のテストを書くことができます。</font><font style="vertical-align: inherit;">そして数週間後-新しい、クールな何かを学ぶために、この投稿の下のコメントに戻り、govnokoderが％framework_name％について知らない作者を書き、悪いテストを書きますが、％this_way％を実行する必要があります。</font><font style="vertical-align: inherit;">その場合、私はとても幸せになります。</font><font style="vertical-align: inherit;">これは私の目標が達成されたことを意味します：他の誰かが自分のためのテストを発見し、私たちの分野でのプロ意識の全体的なレベルを少し高めました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理性的な批判は大歓迎です。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485404/index.html">映画「マトリックス」の視覚効果を実感</a></li>
<li><a href="../ja485406/index.html">Raspberry Piのクラウドオブジェクト検出器を使用したビデオ</a></li>
<li><a href="../ja485408/index.html">ユニバーサルRESTサービスの実装例（Avalanche-Javaのアプリケーションフレームワーク）</a></li>
<li><a href="../ja485412/index.html">ITスペシャリストの欠員に関する正しい手紙</a></li>
<li><a href="../ja485416/index.html">Kotlinでデータをマッピングする実用的な方法</a></li>
<li><a href="../ja485420/index.html">ジオメトリックコアでマルチスレッドを使用する方法</a></li>
<li><a href="../ja485424/index.html">子供にPythonを教える方法</a></li>
<li><a href="../ja485426/index.html">オランダの自動車：2019年の統計と情報</a></li>
<li><a href="../ja485428/index.html">神秘的なLyXプログラム。パート5</a></li>
<li><a href="../ja485430/index.html">エンドツーエンドの暗号化を備えたシンプルなマルチユーザーテキストエディター</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>