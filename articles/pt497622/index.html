<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèΩ üñêüèª üë©üèª‚Äçüåæ Detector COVID-19 automatizado a partir de imagens de fluorografia üëç üêñ üßöüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste guia, voc√™ aprender√° como detectar automaticamente o COVID-19 em um conjunto de dados especialmente selecionado usando Keras, TensorFlow e apren...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Detector COVID-19 automatizado a partir de imagens de fluorografia</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497622/"><img src="https://habrastorage.org/getpro/habr/post_images/e21/f41/a1d/e21f41a1d483179326c7822160c6beb8.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste guia, voc√™ aprender√° como detectar automaticamente o COVID-19 em um conjunto de dados especialmente selecionado usando Keras, TensorFlow e aprendizado profundo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a maioria das pessoas no mundo atualmente, estou sinceramente preocupado com o COVID-19. </font><font style="vertical-align: inherit;">Percebo que comecei a analisar constantemente minha sa√∫de pessoal e suspeito que j√° tenha sido infectado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto mais me preocupo com isso, mais uma dolorosa combina√ß√£o de sintomas reais com hipocondria se manifesta:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acordei de manh√£, me sinto um pouco sobrecarregado.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando sa√≠ da cama, j√° havia um vazamento no nariz (embora </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agora se saiba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que o nariz escorrendo n√£o √© um sintoma do COVID-19).</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enquanto ele chegava ao banheiro para pegar um guardanapo, ele tamb√©m tossiu.</font></font></li>
</ul><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No come√ßo, n√£o dei muita import√¢ncia a isso - sou al√©rgico ao p√≥len e, devido ao clima quente na costa leste, a primavera chegou no in√≠cio deste ano. Muito provavelmente, minha alergia acabou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas os sintomas n√£o melhoraram o dia todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui estou eu sentado aqui, escrevendo este manual com um term√¥metro na boca; e olhando para baixo mostra 37,4 ¬∞ C. A temperatura est√° mais alta do que meus 36,3 ¬∞ C habituais. Tudo acima de 37,2 ¬∞ C, eu j√° considero uma febre leve. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tosse e um pouco de febre? Pode ser COVID-19 ... ou apenas minha alergia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â imposs√≠vel descobrir sem um teste, e √© exatamente essa "ignor√¢ncia" que torna essa situa√ß√£o t√£o perigosa para o equil√≠brio mental. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para as pessoas n√£o h√° nada mais terr√≠vel que o desconhecido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar de todos os medos, tento me livrar deles de uma maneira racional. Tenho mais de trinta anos, estou em √≥tima forma, meu sistema imunol√≥gico √© muito forte. Vou para a quarentena (s√≥ por precau√ß√£o), vou descansar e me recuperar normalmente. O COVID-19 n√£o me assusta em termos de </font><font style="vertical-align: inherit;">sa√∫de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pessoal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pelo menos continuo dizendo isso para mim mesmo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, eu me preocupo com meus parentes idosos, incluindo aqueles que t√™m doen√ßas cr√¥nicas e aqueles em um lar de idosos ou hospital. Eles s√£o vulner√°veis ‚Äã‚Äãe ser√° realmente triste se os perdermos devido a esta infec√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o me sentar e n√£o sucumbir √† fraqueza (seja alergia, COVID-19 ou apenas ansiedade), decidi fazer o que fa√ßo de melhor -</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atenda a toda a comunidade de vis√£o de m√°quina e aprendizado profundo escrevendo c√≥digo, realizando experimentos e ensinando outras pessoas a usar a vis√£o computacional e o aprendizado profundo em aplica√ß√µes pr√°ticas do mundo real</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, para ser sincero, este n√£o √© o artigo mais cient√≠fico que j√° escrevi. </font><font style="vertical-align: inherit;">De fato, longe de ser o mais. </font><font style="vertical-align: inherit;">Os m√©todos e conjuntos de dados usados ‚Äã‚Äãn√£o merecem publica√ß√£o. </font><font style="vertical-align: inherit;">Mas eles podem ser o ponto de partida para quem quer ajudar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas eu quero fazer tudo ao meu alcance. </font><font style="vertical-align: inherit;">Este artigo √© simplesmente minha maneira de superar mentalmente momentos dif√≠ceis e, ao mesmo tempo, ajudar outras pessoas em uma situa√ß√£o semelhante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu espero que voc√™ me entenda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na li√ß√£o de hoje, faremos o seguinte:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coletaremos um conjunto de dados abertos de fluorogramas de pacientes com teste positivo para COVID-19.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coletamos uma sele√ß√£o de fluorogramas de pacientes saud√°veis.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Treinaremos a rede neural convolucional para detectar automaticamente o COVID-19 nas imagens do conjunto criado.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avaliaremos os resultados obtidos do ponto de vista educacional.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isen√ß√£o de responsabilidade: eu j√° sugeri, mas vou dizer sem rodeios. </font><font style="vertical-align: inherit;">Os m√©todos e t√©cnicas deste artigo s√£o apenas para fins educacionais. </font><font style="vertical-align: inherit;">Este n√£o √© um estudo cient√≠fico real e n√£o ser√° publicado em uma revista. </font><font style="vertical-align: inherit;">O artigo √© destinado a leitores interessados ‚Äã‚Äãem (1) vis√£o computacional / aprendizado profundo e que desejam aprender usando m√©todos pr√°ticos e (2) est√£o preocupados com os eventos atuais. </font><font style="vertical-align: inherit;">Eu imploro que voc√™ se relacione com isso dessa maneira.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COVID-19 em fluorogramas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na primeira parte, discutiremos como o COVID-19 pode ser detectado nas radiografias de t√≥rax. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, considere nosso conjunto de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, mostrarei como treinar o modelo de aprendizado profundo usando Keras e TensorFlow para definir COVID-19 em nosso conjunto de dados de imagens. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Minha tarefa √© inspir√°-lo e mostrar que o estudo da vis√£o computacional / aprendizado profundo e a aplica√ß√£o desse conhecimento na √°rea m√©dica podem ter um grande impacto no mundo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplificando: voc√™ n√£o precisa de um diploma m√©dico para contribuir com a medicina. Especialistas em aprendizado profundo que trabalham em estreita colabora√ß√£o com m√©dicos e profissionais de sa√∫de podem resolver problemas complexos, salvar vidas e tornar o mundo um lugar melhor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que este guia o inspire a fazer exatamente isso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas com tudo isso dito, as revistas cient√≠ficas e os sistemas de avalia√ß√£o de especialistas est√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cheios de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> materiais com modelos de previs√£o do COVID-19 de qualidade duvidosa. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o pegue o c√≥digo / modelo deste artigo e n√£o o envie para a revista ou coloque-o em dom√≠nio p√∫blico em sites cient√≠ficos - voc√™ apenas adicionar√° algum ru√≠do.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Al√©m disso, se voc√™ pretende usar este artigo (ou qualquer outro artigo da COVID-19 da Internet) em sua pr√≥pria pesquisa, verifique as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regras</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">TRIPOD para criar modelos de relat√≥rios de previs√£o</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ provavelmente sabe, o uso da IA ‚Äã‚Äãna medicina leva a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consequ√™ncias muito reais</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Publique ou use esses modelos somente ap√≥s consulta cuidadosa com um m√©dico especialista.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f74/c2b/450/f74c2b450fa7308154dca67ad2692309.jpg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 1. Um exemplo de fluorograma de um paciente com teste positivo para COVID-19. Usando Keras e TensorFlow nessas imagens, √© poss√≠vel treinar o classificador para detectar COVID-19. Atualmente, os</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
testes</font><i><font color="gray"><font style="vertical-align: inherit;"> COVID-19</font></font></i><font style="vertical-align: inherit;"> s√£o dif√≠ceis de encontrar -</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eles simplesmente n√£o s√£o suficientes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e n√£o podem ser feitos com rapidez, o que causa p√¢nico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando h√° p√¢nico, algumas pessoas vil aproveitam isso e</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vendem kits de teste COVID-19 falsos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> encontrando v√≠timas em redes sociais e mensageiros instant√¢neos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o n√∫mero de kits de teste COVID-19 √© limitado, voc√™ deve confiar em outros m√©todos de diagn√≥stico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os m√©dicos costumam confiar nas radiografias do t√≥rax (comumente chamadas fluorogramas) para diagnosticar pneumonia, pneumonia, abscessos e / ou linfonodos aumentados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O COVID-19 ataca o epit√©lio do trato respirat√≥rio e os raios X ajudam a examinar a condi√ß√£o pulmonar do paciente. As m√°quinas de raio-X s√£o instaladas na maioria dos hospitais; portanto, √© l√≥gico usar a fluorografia para testar o COVID-19 sem kits de teste especiais. A desvantagem √© que essa an√°lise requer um especialista em radiologia e leva um tempo consider√°vel. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, o desenvolvimento de um sistema automatizado ser√° muito valioso para economizar o tempo valioso de profissionais m√©dicos em todo o mundo. </font></font></b><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Algumas publica√ß√µes mais recentes sugerem que a tomografia computadorizada √© melhor para o diagn√≥stico do COVID-19, mas nesta li√ß√£o trabalhamos apenas com fluorogramas.</font></font></i> <br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conjunto de dados</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/855/213/e50/855213e505792a063cef8c831820dd7a.png"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">2. √Ä esquerda, amostras positivas (de pacientes infectados) e √† direita, negativas. </font><font style="vertical-align: inherit;">Essas imagens s√£o usadas para treinar um modelo para prever automaticamente a presen√ßa de uma doen√ßa.O</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nosso conjunto de dados foi compilado pelo</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dr. Joseph Cohen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um estudante de gradua√ß√£o da Universidade de Montreal. </font><font style="vertical-align: inherit;">No in√≠cio de mar√ßo, ele come√ßou a coletar fluorogramas de pacientes com COVID-19, MERS, SARS e SARS e public√°-los no</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reposit√≥rio no GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Precisamos baixar um arquivo do reposit√≥rio</font></font><code>metadata.csv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e selecionar as linhas onde √© indicado</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado positivo em COVID-19.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipo de pulm√£o 'posterior-anterior' (AP). </font><font style="vertical-align: inherit;">Pelo que entendi, esse √© o tipo de imagem usada em imagens "saud√°veis".</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um total de 25 fluorogramas foi encontrado com casos positivos de COVID-19 (Fig. 2, √† esquerda). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para pacientes saud√°veis, usei o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conjunto de dados Cuggle (pneumonia)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e selecionei 25 imagens de pacientes saud√°veis ‚Äã‚Äã(Fig. 2, √† direita). </font><font style="vertical-align: inherit;">Esse conjunto de dados apresenta v√°rios problemas, como etiquetas com ru√≠do / incorretos, mas serve para uma verifica√ß√£o conceitual do detector autom√°tico COVID-19.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estrutura do projeto</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na se√ß√£o Downloads do meu site, voc√™ pode inserir seu endere√ßo de e-mail e descobrir um link para o arquivo com c√≥digo, scripts e outros arquivos para este projeto. </font><font style="vertical-align: inherit;">Extraia os arquivos e voc√™ ver√° a estrutura de diret√≥rios:</font></font><br>
<br>
<pre><code class="bash hljs">$ tree --dirsfirst --filelimit 10<font></font>
.<font></font>
‚îú‚îÄ‚îÄ dataset<font></font>
‚îÇ   ‚îú‚îÄ‚îÄ covid [25 entries]<font></font>
‚îÇ   ‚îî‚îÄ‚îÄ normal [25 entries]<font></font>
‚îú‚îÄ‚îÄ build_covid_dataset.py<font></font>
‚îú‚îÄ‚îÄ sample_kaggle_dataset.py<font></font>
‚îú‚îÄ‚îÄ train_covid19.py<font></font>
‚îú‚îÄ‚îÄ plot.png<font></font>
‚îî‚îÄ‚îÄ covid19.model<font></font>
3 directories, 5 files</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os fluorogramas est√£o em um diret√≥rio em </font></font><code>dataset/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que duas classes de dados s√£o divididas em diret√≥rios </font></font><code>covid/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>normal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambos os scripts s√£o apresentados para a constru√ß√£o de um conjunto de dados, mas n√£o os consideraremos hoje. </font><font style="vertical-align: inherit;">Em vez disso, considere um script </font></font><code>train_covid19.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que ensina nosso detector COVID-19.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementa√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos seguir para a cria√ß√£o de uma rede neural convolucional. </font><font style="vertical-align: inherit;">Abra o arquivo </font></font><code>train_covid19.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e cole o seguinte c√≥digo:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># import the necessary packages</span>
<span class="hljs-keyword">from</span> tensorflow.keras.preprocessing.image <span class="hljs-keyword">import</span> ImageDataGenerator
<span class="hljs-keyword">from</span> tensorflow.keras.applications <span class="hljs-keyword">import</span> VGG16
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> AveragePooling2D
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Dropout
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Flatten
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Dense
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Input
<span class="hljs-keyword">from</span> tensorflow.keras.models <span class="hljs-keyword">import</span> Model
<span class="hljs-keyword">from</span> tensorflow.keras.optimizers <span class="hljs-keyword">import</span> Adam
<span class="hljs-keyword">from</span> tensorflow.keras.utils <span class="hljs-keyword">import</span> to_categorical
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelBinarizer
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> confusion_matrix
<span class="hljs-keyword">from</span> imutils <span class="hljs-keyword">import</span> paths
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> os</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse script usa v√°rias bibliotecas de aprendizado profundo do TensorFlow 2.0 e Keras. </font><font style="vertical-align: inherit;">Al√©m disso, usamos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scikit-learn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a biblioteca padr√£o do Python para aprendizado de m√°quina, o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matplotlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para gr√°ficos e o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para carregar e processar imagens. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para instalar o TensorFlow 2.0 (incluindo as bibliotecas apropriadas scikit-learn, OpenCV e matplotlib), basta seguir minhas instru√ß√µes para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubuntu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, analisaremos os argumentos da linha de comando e inicializaremos os hiperpar√¢metros:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># construct the argument parser and parse the arguments</span><font></font>
ap = argparse.ArgumentParser()<font></font>
ap.add_argument(<span class="hljs-string">"-d"</span>, <span class="hljs-string">"--dataset"</span>, required=<span class="hljs-literal">True</span>,<font></font>
	help=<span class="hljs-string">"path to input dataset"</span>)<font></font>
ap.add_argument(<span class="hljs-string">"-p"</span>, <span class="hljs-string">"--plot"</span>, type=str, default=<span class="hljs-string">"plot.png"</span>,<font></font>
	help=<span class="hljs-string">"path to output loss/accuracy plot"</span>)<font></font>
ap.add_argument(<span class="hljs-string">"-m"</span>, <span class="hljs-string">"--model"</span>, type=str, default=<span class="hljs-string">"covid19.model"</span>,<font></font>
	help=<span class="hljs-string">"path to output loss/accuracy plot"</span>)<font></font>
args = vars(ap.parse_args())<font></font>
<span class="hljs-comment"># initialize the initial learning rate, number of epochs to train for,</span>
<span class="hljs-comment"># and batch size</span>
INIT_LR = <span class="hljs-number">1e-3</span>
EPOCHS = <span class="hljs-number">25</span>
BS = <span class="hljs-number">8</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tr√™s </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argumentos de linha de comando</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><code>--dataset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: caminho para o conjunto de dados de entrada</font></font><br>
</li>
<li><code>--plot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Um caminho opcional para a programa√ß√£o de sa√≠da do seu hist√≥rico de aprendizado. </font><font style="vertical-align: inherit;">Salvo indica√ß√£o em contr√°rio, o padr√£o √©</font></font><code>plot.png</code><br>
</li>
<li><code>--model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: caminho opcional para o modelo de sa√≠da; </font><font style="vertical-align: inherit;">padr√£o</font></font><code>covid19.model</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As pr√≥ximas linhas inicializam a velocidade inicial de aprendizado, o n√∫mero de eras e os hiperpar√¢metros do tamanho do pacote. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora estamos prontos para baixar e pr√©-processar os fluorogramas:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># grab the list of images in our dataset directory, then initialize</span>
<span class="hljs-comment"># the list of data (i.e., images) and class images</span>
print(<span class="hljs-string">"[INFO] loading images..."</span>)<font></font>
imagePaths = list(paths.list_images(args[<span class="hljs-string">"dataset"</span>]))<font></font>
data = []<font></font>
labels = []<font></font>
<span class="hljs-comment"># loop over the image paths</span>
<span class="hljs-keyword">for</span> imagePath <span class="hljs-keyword">in</span> imagePaths:
	<span class="hljs-comment"># extract the class label from the filename</span>
	label = imagePath.split(os.path.sep)[<span class="hljs-number">-2</span>]
	<span class="hljs-comment"># load the image, swap color channels, and resize it to be a fixed</span>
	<span class="hljs-comment"># 224x224 pixels while ignoring aspect ratio</span><font></font>
	image = cv2.imread(imagePath)<font></font>
	image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)<font></font>
	image = cv2.resize(image, (<span class="hljs-number">224</span>, <span class="hljs-number">224</span>))
	<span class="hljs-comment"># update the data and labels lists, respectively</span><font></font>
	data.append(image)<font></font>
	labels.append(label)<font></font>
<span class="hljs-comment"># convert the data and labels to NumPy arrays while scaling the pixel</span>
<span class="hljs-comment"># intensities to the range [0, 1]</span>
data = np.array(data) / <span class="hljs-number">255.0</span>
labels = np.array(labels)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para carregar dados, capturamos todos os caminhos para as imagens no cat√°logo </font></font><code>--dataset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Depois, para cada um </font></font><code>imagePath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recuperamos o r√≥tulo da classe ( </font></font><code>covid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>normal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">do caminho </font><font style="vertical-align: inherit;">.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s o carregamos </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e pr√©-processamos, convertendo-o em RGB e redimensionando para 224 √ó 224 pixels, para que esteja pronto para a rede neural.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atualizando listas </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>labels</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, redimensione a intensidade do pixel para o intervalo [0, 1] e converta os dados e os r√≥tulos no formato de matriz NumPy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, executamos a codifica√ß√£o direta </font></font><code>labels</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dividindo os dados em conjuntos para treinamento / teste:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># perform one-hot encoding on the labels</span><font></font>
lb = LabelBinarizer()<font></font>
labels = lb.fit_transform(labels)<font></font>
labels = to_categorical(labels)<font></font>
<span class="hljs-comment"># partition the data into training and testing splits using 80% of</span>
<span class="hljs-comment"># the data for training and the remaining 20% for testing</span><font></font>
(trainX, testX, trainY, testY) = train_test_split(data, labels,<font></font>
	test_size=<span class="hljs-number">0.20</span>, stratify=labels, random_state=<span class="hljs-number">42</span>)
<span class="hljs-comment"># initialize the training data augmentation object</span><font></font>
trainAug = ImageDataGenerator(<font></font>
	rotation_range=<span class="hljs-number">15</span>,<font></font>
	fill_mode=<span class="hljs-string">"nearest"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codifica√ß√£o direta significa que os dados s√£o convertidos no seguinte formato:</font></font><br>
<br>
<pre><code class="python hljs">[[<span class="hljs-number">0.</span> <span class="hljs-number">1.</span>]<font></font>
 [<span class="hljs-number">0.</span> <span class="hljs-number">1.</span>]<font></font>
 [<span class="hljs-number">0.</span> <span class="hljs-number">1.</span>]<font></font>
 ...<font></font>
 [<span class="hljs-number">1.</span> <span class="hljs-number">0.</span>]<font></font>
 [<span class="hljs-number">1.</span> <span class="hljs-number">0.</span>]<font></font>
 [<span class="hljs-number">1.</span> <span class="hljs-number">0.</span>]]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada etiqueta codificada consiste em uma matriz com dois elementos: 'hot' (1) ou 'not' (0). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As linhas a seguir separam nossos dados, deixando 80% para treinamento e 20% para teste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para garantir que o modelo seja generalizado, realizamos o aumento dos dados configurando a imagem para girar aleatoriamente 15 ¬∞ no sentido hor√°rio ou anti-hor√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As √∫ltimas tr√™s linhas inicializam o objeto gerador de aumento de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, inicialize nosso modelo VGGNet e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajuste-o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># load the VGG16 network, ensuring the head FC layer sets are left</span>
<span class="hljs-comment"># off</span>
baseModel = VGG16(weights=<span class="hljs-string">"imagenet"</span>, include_top=<span class="hljs-literal">False</span>,<font></font>
	input_tensor=Input(shape=(<span class="hljs-number">224</span>, <span class="hljs-number">224</span>, <span class="hljs-number">3</span>)))
<span class="hljs-comment"># construct the head of the model that will be placed on top of the</span>
<span class="hljs-comment"># the base model</span><font></font>
headModel = baseModel.output<font></font>
headModel = AveragePooling2D(pool_size=(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>))(headModel)<font></font>
headModel = Flatten(name=<span class="hljs-string">"flatten"</span>)(headModel)<font></font>
headModel = Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">"relu"</span>)(headModel)<font></font>
headModel = Dropout(<span class="hljs-number">0.5</span>)(headModel)<font></font>
headModel = Dense(<span class="hljs-number">2</span>, activation=<span class="hljs-string">"softmax"</span>)(headModel)
<span class="hljs-comment"># place the head FC model on top of the base model (this will become</span>
<span class="hljs-comment"># the actual model we will train)</span><font></font>
model = Model(inputs=baseModel.input, outputs=headModel)<font></font>
<span class="hljs-comment"># loop over all layers in the base model and freeze them so they will</span>
<span class="hljs-comment"># *not* be updated during the first training process</span>
<span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> baseModel.layers:<font></font>
	layer.trainable = <span class="hljs-literal">False</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As duas primeiras linhas criam uma inst√¢ncia da rede VGG16 com pesos previamente treinados no ImageNet sem tocar na camada totalmente conectada (FC). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, criamos uma nova camada totalmente conectada, composta por camadas </font></font><code>POOL =&gt; FC = SOFTMAX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e a adicionamos ao VGG16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, congelamos os pesos </font></font><code>CONV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o VGG16, para que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a camada FC </font><font style="vertical-align: inherit;">seja treinada </font><font style="vertical-align: inherit;">. Isso completa a instala√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora estamos prontos para compilar e treinar nosso modelo de aprendizado profundo para o COVID-19:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># compile our model</span>
print(<span class="hljs-string">"[INFO] compiling model..."</span>)<font></font>
opt = Adam(lr=INIT_LR, decay=INIT_LR / EPOCHS)<font></font>
model.compile(loss=<span class="hljs-string">"binary_crossentropy"</span>, optimizer=opt,<font></font>
	metrics=[<span class="hljs-string">"accuracy"</span>])
<span class="hljs-comment"># train the head of the network</span>
print(<span class="hljs-string">"[INFO] training head..."</span>)<font></font>
H = model.fit_generator(<font></font>
	trainAug.flow(trainX, trainY, batch_size=BS),<font></font>
	steps_per_epoch=len(trainX) // BS,<font></font>
	validation_data=(testX, testY),<font></font>
	validation_steps=len(testX) // BS,<font></font>
	epochs=EPOCHS)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As primeiras linhas compilam a rede neural com a op√ß√£o de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reduzir a velocidade de aprendizado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o otimizador </font></font><code>Adam</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dado que este √© um problema de duas classes, usamos perda em </font></font><code>"binary_crossentropy"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vez de entropia cruzada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para iniciar o processo de aprendizado, chamamos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fit_generator </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">em Keras</font></a><font style="vertical-align: inherit;"> , passando os fluorogramas pelo nosso objeto de aumento de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avaliamos o modelo:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># make predictions on the testing set</span>
print(<span class="hljs-string">"[INFO] evaluating network..."</span>)<font></font>
predIdxs = model.predict(testX, batch_size=BS)<font></font>
<span class="hljs-comment"># for each image in the testing set we need to find the index of the</span>
<span class="hljs-comment"># label with corresponding largest predicted probability</span>
predIdxs = np.argmax(predIdxs, axis=<span class="hljs-number">1</span>)
<span class="hljs-comment"># show a nicely formatted classification report</span>
print(classification_report(testY.argmax(axis=<span class="hljs-number">1</span>), predIdxs,<font></font>
	target_names=lb.classes_))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para avaliar, primeiro fazemos previs√µes no conjunto de testes, preservando os √≠ndices de previs√£o. </font><font style="vertical-align: inherit;">Em seguida, criamos e exibimos um relat√≥rio de classifica√ß√£o usando o scikit-learn, onde existe uma fun√ß√£o auxiliar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, calculamos a matriz de imprecis√µes para posterior avalia√ß√£o estat√≠stica:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># compute the confusion matrix and and use it to derive the raw</span>
<span class="hljs-comment"># accuracy, sensitivity, and specificity</span>
cm = confusion_matrix(testY.argmax(axis=<span class="hljs-number">1</span>), predIdxs)<font></font>
total = sum(sum(cm))<font></font>
acc = (cm[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] + cm[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]) / total<font></font>
sensitivity = cm[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] / (cm[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] + cm[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>])<font></font>
specificity = cm[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] / (cm[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>] + cm[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
<span class="hljs-comment"># show the confusion matrix, accuracy, sensitivity, and specificity</span><font></font>
print(cm)<font></font>
print(<span class="hljs-string">"acc: {:.4f}"</span>.format(acc))<font></font>
print(<span class="hljs-string">"sensitivity: {:.4f}"</span>.format(sensitivity))<font></font>
print(<span class="hljs-string">"specificity: {:.4f}"</span>.format(specificity))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui fazemos o seguinte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geramos uma matriz de imprecis√µes.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com sua ajuda, calculamos a precis√£o, a sensibilidade e a especificidade, imprimindo todas essas m√©tricas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o autoteste, geramos um gr√°fico com um hist√≥rico de precis√£o e perdas de treinamento e o enviamos para um arquivo gr√°fico:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># plot the training loss and accuracy</span><font></font>
N = EPOCHS<font></font>
plt.style.use(<span class="hljs-string">"ggplot"</span>)<font></font>
plt.figure()<font></font>
plt.plot(np.arange(<span class="hljs-number">0</span>, N), H.history[<span class="hljs-string">"loss"</span>], label=<span class="hljs-string">"train_loss"</span>)<font></font>
plt.plot(np.arange(<span class="hljs-number">0</span>, N), H.history[<span class="hljs-string">"val_loss"</span>], label=<span class="hljs-string">"val_loss"</span>)<font></font>
plt.plot(np.arange(<span class="hljs-number">0</span>, N), H.history[<span class="hljs-string">"accuracy"</span>], label=<span class="hljs-string">"train_acc"</span>)<font></font>
plt.plot(np.arange(<span class="hljs-number">0</span>, N), H.history[<span class="hljs-string">"val_accuracy"</span>], label=<span class="hljs-string">"val_acc"</span>)<font></font>
plt.title(<span class="hljs-string">"Training Loss and Accuracy on COVID-19 Dataset"</span>)<font></font>
plt.xlabel(<span class="hljs-string">"Epoch #"</span>)<font></font>
plt.ylabel(<span class="hljs-string">"Loss/Accuracy"</span>)<font></font>
plt.legend(loc=<span class="hljs-string">"lower left"</span>)<font></font>
plt.savefig(args[<span class="hljs-string">"plot"</span>])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, salve o modelo do classificador </font></font><code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em disco:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># serialize the model to disk</span>
print(<span class="hljs-string">"[INFO] saving COVID-19 detector model..."</span>)<font></font>
model.save(args[<span class="hljs-string">"model"</span>], save_format=<span class="hljs-string">"h5"</span>)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Treinamento de detectores</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de baixar todos os arquivos do arquivo morto com as fontes e scripts mencionados acima, abra o console e execute o seguinte comando para treinar o detector:</font></font><br>
<br>
<pre><code class="bash hljs">$ python train_covid19.py --dataset dataset<font></font>
[INFO] loading images...<font></font>
[INFO] compiling model...<font></font>
[INFO] training head...<font></font>
Epoch 1/25<font></font>
5/5 [==============================] - 20s 4s/step - loss: 0.7169 - accuracy: 0.6000 - val_loss: 0.6590 - val_accuracy: 0.5000<font></font>
Epoch 2/25<font></font>
5/5 [==============================] - 0s 86ms/step - loss: 0.8088 - accuracy: 0.4250 - val_loss: 0.6112 - val_accuracy: 0.9000<font></font>
Epoch 3/25<font></font>
5/5 [==============================] - 0s 99ms/step - loss: 0.6809 - accuracy: 0.5500 - val_loss: 0.6054 - val_accuracy: 0.5000<font></font>
Epoch 4/25<font></font>
5/5 [==============================] - 1s 100ms/step - loss: 0.6723 - accuracy: 0.6000 - val_loss: 0.5771 - val_accuracy: 0.6000<font></font>
...<font></font>
Epoch 22/25<font></font>
5/5 [==============================] - 0s 99ms/step - loss: 0.3271 - accuracy: 0.9250 - val_loss: 0.2902 - val_accuracy: 0.9000<font></font>
Epoch 23/25<font></font>
5/5 [==============================] - 0s 99ms/step - loss: 0.3634 - accuracy: 0.9250 - val_loss: 0.2690 - val_accuracy: 0.9000<font></font>
Epoch 24/25<font></font>
5/5 [==============================] - 27s 5s/step - loss: 0.3175 - accuracy: 0.9250 - val_loss: 0.2395 - val_accuracy: 0.9000<font></font>
Epoch 25/25<font></font>
5/5 [==============================] - 1s 101ms/step - loss: 0.3655 - accuracy: 0.8250 - val_loss: 0.2522 - val_accuracy: 0.9000<font></font>
[INFO] evaluating network...<font></font>
              precision    recall  f1-score   support<font></font>
       covid       0.83      1.00      0.91         5<font></font>
      normal       1.00      0.80      0.89         5<font></font>
    accuracy                           0.90        10<font></font>
   macro avg       0.92      0.90      0.90        10<font></font>
weighted avg       0.92      0.90      0.90        10<font></font>
[[5 0]<font></font>
 [1 4]]<font></font>
acc: 0.9000<font></font>
sensitivity: 1.0000<font></font>
specificity: 0.8000<font></font>
[INFO] saving COVID-19 detector model...</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagn√≥stico autom√°tico de COVID-19 de acordo com os resultados da fluorografia</font></font></h2><br>
<i><b>  :</b>      ,  ¬´¬ª   COVID-19.        .              ,        ,    ,    (  ,        ).  ,  /       COVID-19.</i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como pode ser visto pelos resultados acima, nosso detector autom√°tico tem uma precis√£o de cerca de 90 a 92% em um conjunto de amostras existente. </font><font style="vertical-align: inherit;">Esta classifica√ß√£o √© baseada apenas na an√°lise de imagem. </font><font style="vertical-align: inherit;">Durante o treinamento, n√£o foram utilizados mais dados, incluindo localiza√ß√£o geogr√°fica, densidade populacional etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A sensibilidade foi de 100% e a especificidade de 80%, o que significa:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacientes verdadeiramente infectados s√£o reconhecidos em 100% dos casos.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacientes saud√°veis ‚Äã‚Äãs√£o reconhecidos como saud√°veis, com uma probabilidade de 80%.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mostra o gr√°fico do hist√≥rico de treinamento, nossa rede n√£o √© muito treinada, apesar de um </font><font style="vertical-align: inherit;">conjunto de dados </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito limitado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : a </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/cf5/53a/b9f/cf553ab9faf7bf72c58b885e016809c8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
capacidade de reconhecer o COVID-19 com precis√£o absoluta √© √≥tima, embora a taxa de falsos positivos seja um pouco preocupante, porque muitas pessoas saud√°veis ‚Äã‚Äãser√£o enviadas para quarentena com pacientes realmente infectados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Equilibrar sensibilidade e especificidade √© incrivelmente dif√≠cil quando se trata de aplica√ß√µes m√©dicas, especialmente no caso de doen√ßas infecciosas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando se trata de vis√£o computacional e treinamento profundo em medicina, lembre-se sempre de que nossos modelos preditivos podem ter consequ√™ncias muito reais - um diagn√≥stico perdido pode custar a vida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Novamente, esses resultados s√£o coletados apenas para fins educacionais. </font><font style="vertical-align: inherit;">Este artigo e os resultados que o acompanham n√£o se destinam √† publica√ß√£o em uma revista cient√≠fica e n√£o est√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conformidade </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">com as regras do TRIPOD para a cria√ß√£o de modelos de relat√≥rios de previs√£o</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limita√ß√µes, melhorias e trabalhos futuros</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/cc9/625/a5c/cc9625a5cdbe14b0b74d42eed54945cc.jpg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 4. Atualmente, especialistas em intelig√™ncia artificial (IA) e especialistas em aprendizado profundo sofrem com a falta de dados de qualidade para o treinamento eficaz dos sistemas de detec√ß√£o autom√°tica COVID-19 em imagens ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonte da imagem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Uma das principais limita√ß√µes para a cria√ß√£o desses sistemas s√£o os dados. Simplesmente n√£o temos dados suficientes (confi√°veis) para treinar o detector COVID-19. Os hospitais est√£o lotados de pacientes com COVID-19, mas, devido a seus direitos e privacidade, est√° se tornando</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ainda mais dif√≠cil</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coletar conjuntos de imagens m√©dicas de qualidade em tempo h√°bil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponho que nos pr√≥ximos 12 a 18 meses o problema ser√° resolvido, mas por enquanto estamos satisfeitos com o que temos. Fiz o meu melhor (considerando minha atual condi√ß√£o mental e f√≠sica) para compilar um guia para aqueles que est√£o interessados ‚Äã‚Äãem usar a vis√£o computacional e o aprendizado profundo na luta contra o COVID-19, levando em considera√ß√£o as limita√ß√µes de tempo e recursos. Mas devo lembr√°-lo de que n√£o sou especialista em medicina. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um verdadeiro detector COVID-19 deve ser submetido a testes rigorosos por profissionais m√©dicos treinados, trabalhando lado a lado com profissionais experientes em aprendizado profundo. O m√©todo descrito aqui, √© claro, n√£o √© adequado para uso pr√°tico e destina-se apenas a fins educacionais. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, devemos nos perguntar o que esse modelo realmente ‚Äúaprende‚Äù.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como eu disse em</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pelo guia Grad-CAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na semana passada, √© perfeitamente poss√≠vel que nosso modelo estude padr√µes que n√£o estejam relacionados ao COVID-19, mas simplesmente sejam varia√ß√µes entre dois conjuntos de dados (ou seja, entre pacientes com e sem COVID-19). Para confirmar os resultados, s√£o necess√°rios testes completos e assist√™ncia especializada. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalmente, os futuros (e melhores) detectores ser√£o multimodais.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora, consideramos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagens (por exemplo, raios-x). Os melhores detectores autom√°ticos COVID-19 devem usar v√°rias fontes de dados, n√£o limitadas a imagens, incluindo indicadores vitais do paciente, densidade populacional, localiza√ß√£o geogr√°fica, etc. As imagens por si s√≥ geralmente n√£o s√£o suficientes para esse tipo de aplica√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que este guia sirva como ponto de partida para qualquer pessoa interessada em usar vis√£o computacional e aprendizado profundo para detectar automaticamente o COVID-19.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© o pr√≥ximo?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalmente, termino meus artigos de blog com uma recomenda√ß√£o de um dos meus livros ou cursos para que voc√™ possa aprender mais sobre o uso da vis√£o computacional e do aprendizado profundo. </font><font style="vertical-align: inherit;">Por respeito √† seriedade do coronav√≠rus, n√£o vou fazer isso - agora n√£o √© a hora nem o lugar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em vez disso, direi que agora estamos em um per√≠odo de vida muito terr√≠vel. </font><font style="vertical-align: inherit;">Como as esta√ß√µes do ano, tudo vai passar, mas por enquanto voc√™ precisa se agachar e se preparar para o inverno frio - √© prov√°vel que o pior ainda esteja por vir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recebi v√°rias cartas dos leitores do PyImageSearch que desejam usar esse tempo de inatividade para estudar a vis√£o por computador e o aprendizado profundo, em vez de enlouquecer em suas casas. </font><font style="vertical-align: inherit;">Este √© um pensamento √∫til.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum√°rio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste guia, voc√™ aprendeu como usar o Keras e o TensorFlow para treinar o detector autom√°tico COVID-19 em um conjunto de fluorogramas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainda n√£o existem conjuntos de dados de imagem de alta qualidade e revisados ‚Äã‚Äãpor pares para o COVID-19, portanto tivemos que trabalhar com o que t√≠nhamos, a saber, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o reposit√≥rio de Joseph Cohen no GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecionamos 25 imagens do conjunto de dados Cohen, selecionando apenas a vista p√≥stero-anterior (PA) e um diagn√≥stico confirmado.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, 25 imagens de pacientes saud√°veis ‚Äã‚Äãforam selecionadas a partir de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um conjunto de dados com imagens de fluorografia Kaggle (pneumonia)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos o Keras e o TensorFlow para treinar o detector COVID-19, que demonstra precis√£o de 90 a 92%, sensibilidade de 100% e especificidade de 80% no conjunto de testes (dado nosso conjunto de dados limitado). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembre-se de que o detector COVID-19 descrito √© apenas para fins educacionais.</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt497612/index.html">A hist√≥ria de como a m√£o invis√≠vel do mercado me transferiu para um lugar remoto</a></li>
<li><a href="../pt497614/index.html">Experi√™ncias de pensamento, paradoxos e limites da l√≥gica // Estamos condenados # 2</a></li>
<li><a href="../pt497616/index.html">Entrevista com Alexander Makarov (Yii) sobre Opensource, confer√™ncias e Yii</a></li>
<li><a href="../pt497618/index.html">Implementa√ß√£o do conceito de acesso remoto altamente seguro</a></li>
<li><a href="../pt497620/index.html">Escrevendo um plugin de alerta de telegrama chrome</a></li>
<li><a href="../pt497624/index.html">Digital Banking Campus - resultados do programa de est√°gio</a></li>
<li><a href="../pt497628/index.html">Como gastar muito tempo em um script pequeno ou no hist√≥rico de uma solicita√ß√£o pull</a></li>
<li><a href="../pt497632/index.html">Web HighLoad - como gerenciamos o tr√°fego de dezenas de milhares de dom√≠nios</a></li>
<li><a href="../pt497634/index.html">Rainbow Coloring s√£o os melhores amigos dos matem√°ticos</a></li>
<li><a href="../pt497636/index.html">Como a falta de poder de computa√ß√£o afetou as batalhas navais nas guerras mundiais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>