<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👧 🙏🏾 🛃 Bitrix Lakukan audit sendiri 👩🏽‍💼 🙏 🧔🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. 
 
 Ketika saya mencari informasi tentang pencatatan (audit peristiwa) di Bitrix, tidak ada apa-apa tentang Habr, tetapi ada sesuatu ya...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bitrix Lakukan audit sendiri</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491826/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika saya mencari informasi tentang pencatatan (audit peristiwa) di Bitrix, tidak ada apa-apa tentang Habr, tetapi ada sesuatu yang lain dalam sisanya, tetapi siapa yang akan menemukannya di sana? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengisi kembali basis pengetahuan, saya memutuskan untuk menulis artikel ini: berbagi pengalaman saya dan memperingatkan tentang kemungkinan penggaruk.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perumusan masalah</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas saya adalah mengembangkan sistem akuntansi paling sederhana untuk struktur periklanan, berdasarkan ketentuan kontrak negara, sistem tersebut harus bekerja berdasarkan Bitrix (versi 15). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimungkinkan untuk bersepeda segala sesuatu di sisi Bitrix, tetapi saya memutuskan bahwa itu akan terlalu tidak jujur ​​dalam kaitannya dengan pelanggan, fungsi Bitrix digunakan secara maksimal:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">otentikasi pengguna</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistem penyimpanan data (EAV)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editor data</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">penangan acara audit</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">model peran untuk mengotorisasi tindakan pengguna</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manajemen pengguna</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bekerja dengan direktori</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini terutama tentang acara audit, saya juga akan berbicara sedikit tentang otorisasi dan menambahkan bookmark kustom ke kartu catatan blok info.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acara Audit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam sistem yang dikembangkan, bekerja dengan data dilakukan melalui API (menambahkan objek baru ke peta dan mengubah koordinatnya), parameter lain dari objek diedit melalui editor Bitrix, karena API tidak memproses semua permintaan perubahan data, maka audit hanya dalam API tidak akan lengkap, yang berarti kami membutuhkan audit di sisi Bitrix. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bukannya saya tidak tahu apa itu audit, tetapi saya tidak harus sering menulisnya. Biasanya ini diselesaikan dengan menulis versi lama dari baris (data lama) ke dalam tabel terpisah, dan implementasi dilakukan sepenuhnya di sisi DBMS. Selain itu, kami secara bersamaan memiliki status sebelum perubahan dan status setelah perubahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menulis audit tentang pemicu DBMS, atau untuk menulis audit tentang peristiwa Bitrix, perbedaannya tidak besar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acara untuk pemrosesan terdaftar dalam skrip "</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitrix / php_interface / init.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", jika tidak ada file, maka Anda harus membuatnya:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">use</span> <span class="hljs-title">Topliner</span>\<span class="hljs-title">Scheme</span>\<span class="hljs-title">Logger</span>;
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">require_once</span>($_SERVER[<span class="hljs-string">'DOCUMENT_ROOT'</span>] . <span class="hljs-string">'/vendor/autoload.php'</span>);
<span class="hljs-comment">//        </span>
<span class="hljs-keyword">if</span> (!defined(<span class="hljs-string">'IBLOCK_MODULE'</span>)) {<font></font>
    define(<span class="hljs-string">'IBLOCK_MODULE'</span>, <span class="hljs-string">'iblock'</span>);<font></font>
}<font></font>
<span class="hljs-comment">//    </span>
AddEventHandler(IBLOCK_MODULE, <span class="hljs-string">'OnIBlockElementAdd'</span>,
    <span class="hljs-keyword">Array</span>(Logger::class, <span class="hljs-string">'OnAdd'</span>));
<span class="hljs-comment">//     ,  -    ,              ,   </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah contoh dari satu penangan, dalam implementasi saya ada beberapa di antaranya, kode dapat dilihat di repositori, tautannya ada di akhir artikel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tanda tangan dari metode untuk memproses acara untuk setiap acara memiliki sendiri, yang secara khusus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kita lihat dalam dokumentasi Bitrix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau debutnya dan lihat sumbernya (lebih jelas, semua peristiwa dan momen penangan panggilan juga dapat dilihat di sumber selama debugging). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan di sini kita dihadapkan dengan fakta bahwa ketika bekerja dengan DBMS, kita memiliki data saat ini (lama) dan data yang akan direkam (baru), dan ketika bekerja dengan Bitrix, kita memiliki data lama atau data baru, tetapi tidak ketika tidak akan ada yang lama dan baru pada saat yang sama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah lain adalah ada beberapa peristiwa sebelum mengubah data, dan saya tidak bisa memahami perbedaan di antara mereka, cerita yang sama adalah ketika beberapa peristiwa dipicu setelah data diubah, mata menatap dari banyak pilihan, sebenarnya itu hanyalah ilusi pilihan.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pendapat saya yang sederhana tentang Bitrix</font></font></b><div class="spoiler_text"><blockquote>       ,      ,    _  ,     (       Delphi        PHP),     .<br>
<br>
           depricated       «»,       .<br>
<br>
  « »       ( )  «» (, , )  ,              .                ,         «»  .<br>
<br>
             ,      :)<br>
<br>
            ,            ,       ,                  ,   ,       ,     ,   ?   .<br>
</blockquote><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan negara global</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menyimpan dan melewati status antara penangan acara, Anda harus memiliki variabel global. </font><font style="vertical-align: inherit;">Variabel global adalah sesuatu yang tidak dapat di refactored, jadi saya menggunakan properti statis kelas:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Logger</span>
</span>{
    <span class="hljs-keyword">const</span> CHANGE = <span class="hljs-string">'change'</span>;
    <span class="hljs-keyword">const</span> REMOVE = <span class="hljs-string">'remove'</span>;
    <span class="hljs-keyword">const</span> CREATE = <span class="hljs-string">'create'</span>;
    <span class="hljs-keyword">const</span> UNDEFINED = <span class="hljs-string">'undefined'</span>;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $operation = <span class="hljs-built_in">self</span>::UNDEFINED;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> NO_VALUE = [];<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $fields = <span class="hljs-built_in">self</span>::NO_VALUE;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $properties = <span class="hljs-built_in">self</span>::NO_VALUE;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $names = <span class="hljs-built_in">self</span>::NO_VALUE;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda perlu membuat penjelasan tentang penggunaan "bidang" dan "properti". Bidang adalah parameter yang dimiliki oleh setiap catatan infoblock (pengidentifikasi, nama, “induk” infoblock), properti adalah parameter khusus untuk rekaman jenis infoblock tertentu, dalam model EAV, ini adalah atribut dan nilainya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Nama" adalah nama atribut, di satu peristiwa kami memiliki pengidentifikasi atribut dan nama, di acara lain kami hanya memiliki pengidentifikasi, dan untuk catatan yang indah di jurnal kita perlu menyimpan nama (tentu saja kita dapat mengurangi pengidentifikasi, tetapi untuk beberapa alasan Anda tidak ingin).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Operasi" adalah operasi saat ini, untuk bekerja dengan "bidang" Bitrix memberikan peristiwa spesifik, ketika bekerja dengan "properti" (fungsi "SetPropertyValues" dan "SetPropertyValuesEx"), tidak ada peristiwa dengan jenis operasi, ada acara sebelum dan sesudah panggilan, tetapi tidak Diketahui operasi apa yang dilakukan (tambah / perbarui / hapus), oleh karena itu operasi juga perlu ditransfer dari handler ke handler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin saya tidak mengetahuinya, dan dalam Bitrix Anda dapat secara bersamaan melihat nilai-nilai seperti apa dan bagaimana nantinya, atau mungkin perlu untuk secara terpisah merekam keadaan sebelum dan keadaan setelah, tetapi untuk beberapa alasan saya memutuskan bahwa entri log harus dalam format “properti % name% adalah% nilai sebelum perubahan% =&gt; itu menjadi% nilai setelah% ”dan karena itu ada banyak masalah dengan mempertahankan keadaan global.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menentukan apakah perubahan diperlukan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cukup aneh, tetapi pawang kami akan dipanggil untuk mengubah catatan blok informasi apa pun. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, dalam handler, kita perlu memahami catatan blok informasi mana yang kami terima dalam parameter. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infoblock catatan ditandai oleh dua nilai: infoblock itu sendiri ('IBLOCK_ID') dan bagiannya ('IBLOCK_SECTION_ID'), dan pengenal bagian kadang-kadang terletak pada array nilai dengan indeks 'IBLOCK_SECTION_ID', dan kadang-kadang 'IBLOCK_SECTION', jadi terkadang saya membaca pengenal bagian oleh kedua kunci dengan prioritas untuk 'IBLOCK_SECTION'. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, dalam beberapa situasi, pengidentifikasi bagian tidak dapat ditentukan pada prinsipnya, oleh karena itu, pemeriksaan untuk kebutuhan untuk menambahkan entri ke log audit harus dilakukan hanya berdasarkan pengidentifikasi blok informasi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menentukan blok dan bagian informasi, kami memutuskan perlunya mendaftarkan acara di jurnal.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyimpan status sebelum perubahan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap entri infoblock terdiri dari dua bagian, satu bagian adalah "bidang", dan parameter ini diubah dengan metode:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: Tambah () </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: Perbarui () </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: Delete ()</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian lainnya adalah metode "properti":</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: SetPropertyValues ​​()</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: SetPropertyValuesEx ()</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak ingat mengapa, tetapi lebih baik jangan menggunakan CIBlockElement :: SetPropertyValuesEx () dalam kode saya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap bagian dari data dalam pengendali eventnya terpisah dari yang lain, oleh karena itu, dengan mengklik tombol "Simpan", dua entri dalam log audit dapat dibuat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tanda tangan acara untuk "bidang" dan "properti" berbeda, di bagian dengan memproses "bidang" kami menyimpan keadaan saat ini untuk bidang dan mengatur nilai untuk operasi, di bagian dengan memproses "properti" kami menyimpan properti dan namanya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melakukan ini tentu saja di pawang "sebelum".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubah Registrasi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam penangan "setelah", kita menulis ke log. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menyusun daftar perbedaan dalam rekaman, ada masalah dengan atribut yang dapat mengambil banyak nilai. </font><font style="vertical-align: inherit;">Format untuk merekam keadaan mereka "sebelum" dan menyatakan "setelah" sangat berbeda sehingga satu tidak dapat menyimpulkan yang lain, jadi ketika menentukan apakah akan mendaftar perubahan, Anda akan selalu menyimpulkan bahwa pendaftaran diperlukan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode sumber audit dalam repositori di file </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / Topliner / Scheme / Logger.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menambahkan tab khusus ke kartu infoblock (di penglasifikasi Bitrix)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menambahkan kartu, pendekatan yang mirip dengan audit digunakan - kami menambahkan penangan:</font></font><br>
<br>
<pre><code class="php hljs">AddEventHandler(<span class="hljs-string">'main'</span>, <span class="hljs-string">'OnAdminIBlockElementEdit'</span>,
    <span class="hljs-keyword">Array</span>(PermitTab::class, <span class="hljs-string">'OnInit'</span>));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam metode 'OnInit', kami mendefinisikan metode lain untuk bekerja dengan tab di editor Bitrix:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermitTab</span>
</span>{
    <span class="hljs-keyword">const</span> LINKS = <span class="hljs-string">'links'</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OnInit</span>(<span class="hljs-params">$arArgs</span>)
    </span>{<font></font>
        $permits = BitrixScheme::getPermits();<font></font>
        $pubPermits = BitrixScheme::getPublishedPermits();<font></font>
        $blockId = (<span class="hljs-keyword">int</span>)$arArgs[<span class="hljs-string">'IBLOCK'</span>][<span class="hljs-string">'ID'</span>];<font></font>
        $letShow = $blockId === $permits-&gt;getBlock()<font></font>
            || $blockId === $pubPermits-&gt;getBlock();<font></font>
        $result = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> ($letShow) {<font></font>
            $result = [<font></font>
                <span class="hljs-string">'TABSET'</span> =&gt; <span class="hljs-string">'LinksToConstructs'</span>,
                <span class="hljs-string">'GetTabs'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'GetTabs'</span>],
                <span class="hljs-string">'ShowTab'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'ShowTab'</span>],
                <span class="hljs-string">'Action'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'Action'</span>],
                <span class="hljs-string">'Check'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'Check'</span>],<font></font>
            ];<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> $result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, tentu saja, kami memeriksa bahwa untuk blok informasi ini kami perlu menunjukkan tab pengguna kami, jika perlu, kami menetapkan metode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada yang istimewa untuk diceritakan di sini, lihat sumber di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositori src / Topliner / Skema / PermitTab.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , baca dokumentasi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Model peran untuk mengotorisasi tindakan pengguna</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode Bitrix untuk otorisasi bekerja dengan skala hak linear, yaitu, skenario di mana seseorang dapat memiliki yang pertama dan kedua, tetapi bukan yang ketiga, dan yang lain bisa menjadi yang kedua dan ketiga, tetapi bukan yang pertama, Anda tidak dapat mengimplementasikan Bitrix secara langsung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk skenario rumit seperti itu di Bitrix, hanya ada pemeriksaan beberapa izin, dan dalam kode saat melakukan operasi, Anda melihat apakah pengguna memiliki izin atau tidak, dan Anda mengizinkan peran pertama dan kedua, dan yang kedua dan ketiga memungkinkan peran lain.</font></font><br>
<br>
<pre><code class="php hljs">        $constSec = BitrixScheme::getConstructs();<font></font>
        $isAllow = CIBlockSectionRights::UserHasRightTo(<font></font>
            $constSec-&gt;getBlock(), $constSec-&gt;getSection(),<font></font>
            BitrixPermission::ELEMENT_ADD, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (!$isAllow) {<font></font>
            $output[<span class="hljs-string">'message'</span>] = <span class="hljs-string">'Forbidden, not enough permission;'</span>;<font></font>
        }<font></font>
</code></pre><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ constSec-&gt; getBlock () - pengidentifikasi blok informasi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ constSec-&gt; getSection () - pengidentifikasi bagian</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BitrixPermission :: ELEMENT_ADD - kode izin</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di pengklasifikasi (direktori blok informasi) di blok dan bagian informasi yang diperlukan, Anda menetapkan hak yang sesuai untuk peran tersebut. </font><font style="vertical-align: inherit;">Bagikan peran kepada pengguna dan semuanya akan berada di bawah kendali Anda.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autentikasi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda memerlukan otentikasi pengguna untuk beberapa halaman, cukup tambahkan:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>
define(<span class="hljs-string">"NEED_AUTH"</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">require</span>($_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>] . <span class="hljs-string">"/bitrix/header.php"</span>);
<span class="hljs-meta">?&gt;</span><font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">require</span>($_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>] . <span class="hljs-string">"/bitrix/footer.php"</span>);
<span class="hljs-meta">?&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat memuat halaman seperti itu, Bitrix akan memberikan formulir login jika pengguna belum masuk. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda hanya perlu menghubungkan Bitrix dalam beberapa jenis skrip, maka:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">require_once</span>($_SERVER[<span class="hljs-string">'DOCUMENT_ROOT'</span>]<font></font>
    . <span class="hljs-string">'/bitrix/modules/main/include/prolog_before.php'</span>);
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekerja dengan direktori</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Direktori "baru" (per November 2019) di Bitrix disebut "HighloadBlock", bekerja dengan mereka sedikit tidak standar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap blok Hyload dapat disimpan dalam tabel terpisah, oleh karena itu, untuk mengakses direktori, setiap kali Anda perlu menentukan nama tabel untuk dibaca. </font><font style="vertical-align: inherit;">Agar tidak terus-menerus melakukan ini, dalam Bitrix Anda harus membuat instance kelas untuk mengakses data. </font><font style="vertical-align: inherit;">Sebuah instance dibuat dalam dua baris:</font></font><br>
<br>
<pre><code class="php hljs">CModule::IncludeModule(<span class="hljs-string">'highloadblock'</span>);<font></font>
$entity = HighloadBlockTable::compileEntity(<span class="hljs-string">'ConstructionTypes'</span>);<font></font>
$reference = $entity-&gt;getDataClass();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di mana 'ConstructionTypes' adalah kode referensi. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Agar</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
tidak terus-menerus menulis dua baris ini, Anda dapat menulis kelas yang akan membuat instance referensi untuk kita ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / Topliner / Bitrix / BitrixReference.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kami bekerja dengan instance seperti pada kelas ORM Bitrix biasa (D7):</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $reference DataManager */</span>
$data = $reference::getList(<span class="hljs-keyword">array</span>(
    <span class="hljs-string">'select'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'UF_NAME'</span>, <span class="hljs-string">'UF_XML_ID'</span>),
    <span class="hljs-string">'filter'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'UF_TYPE_ID'</span> =&gt; <span class="hljs-number">0</span>)<font></font>
    ));<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repositori</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (hati-hati, banyak copy-paste) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terima kasih atas perhatian Anda.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id491812/index.html">IntelliJ IDEA Tip & Trik: 2. Analisis Ketergantungan</a></li>
<li><a href="../id491814/index.html">Diagram jaringan sebagai kode</a></li>
<li><a href="../id491816/index.html">[Forecast] Transportasi masa depan: horizon jangka panjang</a></li>
<li><a href="../id491818/index.html">Dasar-Dasar Transfer Data Yang Andal</a></li>
<li><a href="../id491824/index.html">Cintai semua orang - laporan terbaik dengan TeamLeadConf dalam 5 menit</a></li>
<li><a href="../id491828/index.html">DataMatrix atau cara memberi label sepatu dengan benar</a></li>
<li><a href="../id491832/index.html">8 plus Flutter dibandingkan dengan React Native</a></li>
<li><a href="../id491838/index.html">MIPT meluncurkan kursus online terbuka tentang pemrograman olahraga</a></li>
<li><a href="../id491840/index.html">Visualisasi pekerjaan pekerja layanan</a></li>
<li><a href="../id491844/index.html">Visualisasi cakupan uji otomatis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>