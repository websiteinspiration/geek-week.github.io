<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîç üê™ üöø Protecting and Hacking the Xbox 360 (Part 3) üë©üèΩ‚Äçüè≠ ü¶ë ‚ùÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 2011, 6 years after the release of the Xbox 360 game console, the researchers discovered an interesting fact - if the signal ‚Äú0‚Äù is sent to the RES...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Protecting and Hacking the Xbox 360 (Part 3)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500246/"><img src="https://habrastorage.org/webt/ly/33/lc/ly33lcab4l10ezi7uwxcjouyzw8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2011, 6 years after the release of the Xbox 360 game console, the researchers discovered an interesting fact - if the signal ‚Äú0‚Äù is sent to the RESET output of the central processor for a very short time, the processor will not reset its state (as it should be), but instead change your behavior! </font><font style="vertical-align: inherit;">Based on this ‚Äúfeature‚Äù, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reset Glitch Hack (RGH)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was developed </font><font style="vertical-align: inherit;">, with the help of which it was possible to completely compromise the protection of the Xbox 360, run unsigned code, thereby opening the way to hacking the system itself and defeating the ‚Äúunbreakable‚Äù </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DG-16D5S drives</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's take a closer look at how RGH worked, how the developers tried to patch a hole, and how these patches were able to get around!</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is a glitch attack?</font></font></h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The processor is pretty dumb, no matter what marketers say. </font><font style="vertical-align: inherit;">All the high-level code written by programmers is reduced to the execution of simple commands - arithmetic with numbers, moving data, conditional and unconditional jumps. </font><font style="vertical-align: inherit;">It is assumed that the processor always executes these commands without errors, and the result matches the documentation.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ae/ae/ik/aeaeiktfaf_phbyprnjmqmwu0y4.png"></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indeed, compiling the code</font></font><br>
<pre><code class="cpp hljs">i = i + <span class="hljs-number">2</span>;</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you rely on the fact that the value of the variable i will increase by exactly 2, without even realizing how it could be otherwise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Glitch attacks violate this confidence - their goal is to ensure that the processor is ‚Äúbuggy‚Äù and behaves wrong. </font><font style="vertical-align: inherit;">There are several ways to ‚Äúglitch‚Äù the processor, for example:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Draw down CPU voltage</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To give an extra impulse to the reference frequency of the CPU</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Shine" on percent radiation</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are special devices for carrying out such attacks - for example, ChipWhisperer offers a wide range of attacks in frequency and power:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/uy/bu/ycuybuxustoyjxpu590edtbyjz0.jpeg" width="550"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of the Xbox 360, a ‚Äúglitch‚Äù occurs as a result of exposure to the RESET line. </font><font style="vertical-align: inherit;">The processor begins the reset procedure, but due to the very short duration of the signal, it does not have time to complete it and continues to work as if nothing had happened. </font><font style="vertical-align: inherit;">But just for this brief moment, while the RESET signal is active, its behavior changes!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Glitch processor</font></font></h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xbox 360 protection rests on bootloaders checking each other in a chain. Ultimately, the verification at each stage comes down to calling the function of comparing the hash sum with the ‚Äúpattern‚Äù. It was then that they applied the glitch attack, forcing the processor to ignore the mismatch. An impulse to the RESET line immediately after calling the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memcmp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> procedure </font><font style="vertical-align: inherit;">forces the processor to ‚Äúgo‚Äù along another branch and continue loading, even if the hash sum is incorrect:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e6/8a/i7/e68ai7t_wy0-har4u49gddcfwh4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The best place to attack was found in the bootloader of the second stage, "CB". </font><font style="vertical-align: inherit;">The later stages are harder to attack (and easy to fix), but at the first stage of loading ("1BL", ROM) the attack failed due to a slightly different construction of the program code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It sounds simple, but in fact, when trying to carry out an attack, many nuances were discovered. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, in order to successfully conduct a glitch attack, it is necessary to very accurately determine the point in time when a RESET pulse should be applied. </font><font style="vertical-align: inherit;">If you make a mistake at least for a microsecond, send too short or long impulse, the attack does not work. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, on Xbox 360, each boot step is accompanied by a change in value on the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">POST_OUT</font></a><font style="vertical-align: inherit;"> debug bus</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Moreover, the debug output is so often arranged that a new POST value is set immediately before comparing the hash sum:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/o_/pz/hn/o_pzhn6nqueomzmzvlv2vkkfazw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So close the location of the debug output from the attack site was an extremely convenient trigger. </font><font style="vertical-align: inherit;">POST_OUT is a parallel bus and is output to 8 test sites on the printed circuit board, each of which is responsible for one of the bits of the value. </font><font style="vertical-align: inherit;">It was even possible to simplify the connection scheme using only one bit and counting the number of changes in its state since the system booted up:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ci/zg/qm/cizgqmpbnxyy2jnhoy5fmqovkde.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It also turned out that due to the high frequency of the processor, it is almost impossible to get to the right moment in terms of accuracy and duration. </font><font style="vertical-align: inherit;">The exposure time should be very short, on the order of the execution time of one instruction by the processor. </font><font style="vertical-align: inherit;">But the slower the processor runs, the longer the time interval suits us. </font><font style="vertical-align: inherit;">Therefore, we take and slow down the processor! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On a regular PC, the CPU frequency is defined as the product of the external, ‚Äúreference‚Äù frequency and multiplier:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5h/vb/oo/5hvbooyj4elvow6nxit04kc4ypk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So in the Xbox 360, external lines of the reference frequency are suitable for the processor, and inside this frequency is multiplied by </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PLL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">And on the old, ‚Äúthick‚Äù revisions of the set-top box, the PLL mechanism could be turned off, slowing down the processor as much as 128 times:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/4w/yt/sp4wytmvkymnu5geqbdp0jwgtag.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the ‚ÄúSlim‚Äù versions, the PLL trick cannot be done (the line is not separated on the board), and since we cannot influence the ‚ÄúSlim‚Äù factor, we will reduce the ‚Äúreference‚Äù frequency! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is generated by the HANA chip, and it can be configured via the I2C bus:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/u0/mv/h3/u0mvh32w0mjhaeylbllspnsiwwc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, it was not possible to reduce much, ‚Äúat low speeds‚Äù the final processor frequency began to ‚Äúswim‚Äù strongly, which reduced the chances of success. </font><font style="vertical-align: inherit;">The most stable option was a slowdown of 3.17 times. </font><font style="vertical-align: inherit;">Not 128 times, but at least something. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All? </font><font style="vertical-align: inherit;">No, not all. </font><font style="vertical-align: inherit;">It is far from a fact that the attack will work the first time (especially on Slim). </font><font style="vertical-align: inherit;">And if the start fails, the prefix reboots and tries to start again. </font><font style="vertical-align: inherit;">Only 5 attempts are given to start, after which the prefix stops and starts blinking the ‚Äúred ring of death‚Äù. </font><font style="vertical-align: inherit;">Therefore, we also patch the south bridge firmware (SMC) so that it does not suffer from garbage and reboots the prefix until it turns blue:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4s/em/3z/4sem3zqaipwaskszcy_nzntxdvu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we get the algorithm:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patch SMC</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slow down percent (via PLL or I2C)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">waiting for a POST trigger</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">waiting for N microseconds</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send impulse to RESET</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">speed up percent back</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For greater accuracy of calculations, we take the frequency from the same HANA (48 MHz):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dq/cg/em/dqcgemuy43cr24pzdnor6sl2zpy.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And we get such a design based on the inexpensive CPLD Xilinx XC2C64A:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yx/uf/5m/yxuf5mhm9uohsh7axeb_trevnue.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not forget to shamanize with the length and location of the wiring on the RESET (pay attention to the "coil" at the bottom of the photo) and forward, hope that the launch will work out within a minute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But this is only on the hardware side. </font><font style="vertical-align: inherit;">How do we patch the bootloader and stuff our code?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patch loaders</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As I mentioned, the second-level bootloader, ‚ÄúCB,‚Äù is being attacked. This bootloader is encrypted with a fixed key, the same for all consoles, but just ‚ÄúCB‚Äù cannot be modified, we only attack it. But the next one is already encrypted with a CPU key, unique for each set-top box. And to modify it, you need to know this key ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or not? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the old "thick" revisions of the Xbox 360, the so-called "Zero-Pairing" mode, which is used at the stage of production of the console, was supported in the CB loader. Each bootloader's header at offset 0x10 contains a random Pairing Data set that is used as part of the key for decryption. And if this data set consisted entirely of zeros (‚ÄúZero-Pairing‚Äù), then the processor key was ignored and a fixed, zero key was used instead!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/s6/yd/tc/s6ydtc65_pqwl6vqimx88x7j4ws.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With this trick it was possible to assemble an image with the original ‚ÄúCB‚Äù, encrypt the next bootloader, ‚ÄúCD‚Äù (with its own code) with a zero key and run it using RGH!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/s5/mg/9y/s5mg9ynt52prplbrelkmas-3hqg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the consoles ‚ÄúSlim‚Äù wrapped this trick, removing the ‚ÄúZero-Pairing‚Äù mode and dividing the ‚ÄúCB‚Äù into two parts. </font><font style="vertical-align: inherit;">Here, ‚ÄúCB‚Äù was divided into a very simple and small ‚ÄúCB_A‚Äù and encrypted by the processor key ‚ÄúCB_B‚Äù:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/io/kw/fr/iokwfrhtycw2bg8fd8qnuzq9c-c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But encryption with the RC4 algorithm (namely, CB_B is encrypted with this algorithm) has one peculiarity. </font><font style="vertical-align: inherit;">In the process of encryption based on the key, a pseudo-random data stream is generated, which is binary ‚Äúadded up‚Äù (operation 'exclusive or', 'xor') with the source data. </font><font style="vertical-align: inherit;">When decrypting, accordingly, the same thing happens, adding with the same pseudo-random stream returns the data to its original value:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mw/_3/da/mw_3da2ixwvjpwa3wmxion8bjvk.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the binary addition operation is commutative and associative, which means that we can modify the encrypted data without knowing the key, just for </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'and the encrypted code with the patch we need!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/uc/hk/mr/uchkmrjc4tjpy5sepvgm_pv-jo4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, we can encrypt ‚ÄúCB_A‚Äù, patch the encrypted ‚ÄúCB_B‚Äù (so that it does not perform decryption at all) and put in plain text ‚ÄúCD‚Äù with its code!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_q/g1/hg/_qg1hghntkm59bnmg1bv5xp4h_8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In short, if you put it together, then the launch looks something like this: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(XeLL is the bootloader of homebrew, Linux, and it also shows the CPU keys)</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/JOiPjlWDA1A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft strikes back</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, Microsoft tried to patch everything up. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the new system update, all old consoles were transferred to a ‚Äúseparate‚Äù boot from ‚ÄúCB_A‚Äù and ‚ÄúCB_B‚Äù, thereby finally closing the ‚ÄúZero-Paired‚Äù mode. </font><font style="vertical-align: inherit;">On Slim, bootloaders have also been updated. </font><font style="vertical-align: inherit;">The new bootloaders have been seriously modified to protect against RGH, with the greatest emphasis being placed on the protection of CB_A:</font></font><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Completely removed debug output in POST</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The hash verification has been redone and duplicated for reliability</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Throughout the code, sleep () was set for a random time (depending on the CPU key !!)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Added CBLDV fusion check to revoke CB_A</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ro/zh/ak/rozhaks1oyb4q0ck6f_2mbzmwmi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The list of innovations leaves no chance for RGH. </font><font style="vertical-align: inherit;">But let‚Äôs pay attention to the last item on the list - before that, there was no fusion check in CB_A! </font><font style="vertical-align: inherit;">Fatal flaw. </font><font style="vertical-align: inherit;">Moreover, as we recall, the processor key is not involved in decoding ‚ÄúCB_A‚Äù. </font><font style="vertical-align: inherit;">This means that the CB_A loader vulnerable to RGH can be launched on any console, and this cannot be prohibited. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But in order to start something with the help of this vulnerable "CB_A", you need to dodge a little. </font><font style="vertical-align: inherit;">If we do not know the CPU key, all that remains for us is to patch the existing ‚ÄúCB_B‚Äù. </font><font style="vertical-align: inherit;">But what if, instead of modifying individual sections, we completely overwrite the entire bootloader? </font><font style="vertical-align: inherit;">And due to this, "write" the old bootloader, which we already know how to patch, to replace the new one? </font><font style="vertical-align: inherit;">So they did:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We encrypt the vulnerable CB_A in the same way as in the original image</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XOR our CB_B with the new, getting the ‚Äúdifference‚Äù</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We put it on the encrypted "CB_B"!</font></font></li>
</ol><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rt/4t/7c/rt4t7ct5vu1vfnvexya_4yjp_oc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything, again, without knowing the key, we successfully replaced the encrypted content, and also put the vulnerable bootloader. </font><font style="vertical-align: inherit;">Consoles hack, Microsoft are surprised. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The developers worked hard, and in the next system update ... slightly changed the encryption method "CB_B", now the encryption key has also become dependent on the version of "CB_A":</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2_/zy/kq/2_zykqm27pplqsop8gquppheo4g.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, when trying to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'and shove the data to the vulnerable "CB_A" of the old version, the bootloader decrypted the garbage due to differences in keys. </font><font style="vertical-align: inherit;">And the new bootloader cannot be hacked, it is well protected from glich attacks. </font><font style="vertical-align: inherit;">So far, victory for Microsoft!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corona throws problems</font></font></h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meanwhile, a new revision of the Xbox 360, Corona, entered the market, and it brought modders problems:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fs/zj/b1/fszjb1roudnv3rix_uf3usnwml4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not enough chips on the board, can you find it? </font><font style="vertical-align: inherit;">That's right, the HANA chip was "hidden" in the south bridge. </font><font style="vertical-align: inherit;">There is nowhere else to take the frequency of 48 MHz for the mod chip, the previous I2C slowdown commands do not work. </font><font style="vertical-align: inherit;">But what is it, the 16 MB NAND flash, which has served as the Xbox 360 system storage all these years, was treacherously replaced with a 4 GB chip with an eMMC interface! </font><font style="vertical-align: inherit;">(True, only in the cheaper version of the console, but still):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ho/pv/dl/hopvdl-wilvzq4pzvndoogihru4.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But nothing, everything was dealt with. </font><font style="vertical-align: inherit;">We figured out how to read / write flash memory through a card reader:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oo/sz/pj/ooszpjupnf_mgzwpkc-vry0ovou.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Found new I2C slowdown commands, an external 48 MHz crystal oscillator replaced HANA:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/88/lm/ic/88lmicizuembheqjiod-uff7jau.jpeg" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Completed build scripts, added support for 4 GB NAND ...</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qm/7a/tk/qm7atka28kaj3anjmoq2cgoalz0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But Microsoft continued to put sticks in the wheels. </font><font style="vertical-align: inherit;">For example, on the new boards, some resistors disappeared, without which the mod chip stopped working:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kv/ji/wg/kvjiwggxf9dncmv8rehaqhpzuy4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
True, this was fixed by installing jumpers with a soldering iron:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ku/7x/sv/ku7xsv8rpu2fov8upv6g-osgfm8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Things got more serious when the POST_OUT tracks disappeared from the board:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lu/lo/0m/lulo0m01ihmy34glpcoeriz4ojo.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But here Microsoft was not lucky, the CPU ‚Äúballs‚Äù needed for RGH were on the extreme row:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hc/nk/e2/hcnke2-7eh_xgrz0bmpf2ewtzro.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And, of course, they were able to connect to them. </font><font style="vertical-align: inherit;">First, the most sleevey ones, slightly drilling up the edge of the processor and soldering directly to the ball with the wiring:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gk/-t/k_/gk-tk_mzrvo5suirxpk_d_kknru.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dw/ue/ai/dwueaifiz18-tfgrylfhdgkpats.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then the Chinese released a framework with a spring-loaded needle, exactly resting on the ball, and the problem was solved for everyone else:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/k7/sd/xj/k7sdxjysbtq9ofcadfby2jpdf-i.jpeg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Last Frontier</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we defeated the ‚Äúcrown‚Äù, there was one problem - new versions of the system did not give in to hacking. To start RGH, you need to know the CPU key, and to find out the CPU key, you need to run RGH at least once. The problem of chicken and eggs in general. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then a thought arose - and let's not only check with ‚Äúglitch‚Äù authentication, but we will also skip the decryption! If it works out, then we don‚Äôt need to know the key, put ‚ÄúCB_B‚Äù in the clear, that's all. This idea formed the basis of Double Glitch Hack (DGX):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/28/h2/yh/28h2yheods_vx8jptciovob9yby.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This chip ‚Äúbuggy‚Äù the percent twice, the first pulse skipped the decryption phase of the bootloader, and the second pulse skipped authentication. </font><font style="vertical-align: inherit;">It worked much less stable, since at least one successful launch was required - then we get the CPU key and proceed as before. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DGX was not relevant for long, after 3 months the Chinese threw in the release of ‚ÄúDGX RIP‚Äù with images that run on any set-top boxes, worked with standard RGH and, of course, started much more stable:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ig/yv/fy/igyvfysfq1qsiyyefeqsknjiz1e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These images contained a special version of the CB_A bootloader used in the Xbox 360 production and, in fact, is a complete analogue of the good old ‚ÄúZero-Pairing‚Äù mode. </font><font style="vertical-align: inherit;">Instead of the processor key, this "CB_A_mfg" decrypted "CB_B" with a fixed null key:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_2/3k/n1/_23kn1nx7eydggdpskbzkudinv4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here Microsoft is. </font><font style="vertical-align: inherit;">In this ‚Äúservice‚Äù version of ‚ÄúCB_A‚Äù there was also no fusion check and it was impossible to ban it. </font><font style="vertical-align: inherit;">It was enough to record the image according to the revision of the Xbox 360, solder the chip - and everything worked.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fa/_9/hd/fa_9hdfa5kgwphr69k6xpdnyaia.jpeg" width="550"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Winchester!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RGH was fully fixed only in the new revision of the console, codenamed Winchester. </font><font style="vertical-align: inherit;">For the first time, CPU and GPU processors combined in one chip, the board was simplified as much as possible:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/of/ps/1g/ofps1gt_gevcpmlz39aj97ukquc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
POST_OUT tracks were not just removed. </font><font style="vertical-align: inherit;">Even if you solder to the platform under the processor:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ha/vg/c6/havgc6afvvs4nt5pn8lihldlspq.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nz/si/lc/nzsilch-pq6gun98tbugnx89owi.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And even if you solder the processor to a special version of the board for developers, XDK, where these tracks are still there:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/m2/di/n4/m2din48-hbqpbs2aw_if-uorx0g.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On POST_OUT, only one pulse is visible when the console starts. </font><font style="vertical-align: inherit;">Bus locked:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kq/6q/5c/kq6q5cngontmkypyxrsfbke-atw.png" width="550"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moreover, it is blocked only at the production stage. </font><font style="vertical-align: inherit;">If you take a ‚Äúclean‚Äù processor from a factory where you haven‚Äôt burned fuses yet, POST_OUT works on it!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/p0/ke/au/p0keau_qpxnl61bmosmxcv5unya.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But RGH on it no longer works. </font><font style="vertical-align: inherit;">No matter how you try to give a RESET pulse, the processor correctly performs a reset, or ignores your signal due to its too short duration. </font><font style="vertical-align: inherit;">Apparently, a special logic module was added to the processor, filtering the RESET line and thereby finally fixed the hardware error.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Post scriptum</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out that the latest revision of the Xbox 360 is impossible to hack? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes and no. </font><font style="vertical-align: inherit;">At the moment, there is only one known way to run a modified system on Winchester revisions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The software development kit (XDK) contains various private keys for signing compiled code. </font><font style="vertical-align: inherit;">And so it turned out that among them the signature key ‚Äúshadowboot‚Äù, a third-level bootloader for XDK systems, was cluttered. </font><font style="vertical-align: inherit;">And with it, you can collect a legitimate signed image with modified firmware. </font><font style="vertical-align: inherit;">Just work on ordinary, "store" consoles, he will not. </font><font style="vertical-align: inherit;">We need a processor with the XDK version of the console, or a ‚Äúclean‚Äù CPU with non-fused fuses (you could see it on Aliexpress):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/sl/fz/rrslfzrmohmrxuagyadwvojnpvq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And only then will you have the opportunity to contemplate such an inscription in the "system information" of the custom shell:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gg/te/g7/ggteg7iezt2c-hw-h_mczs132fe.jpeg" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And that‚Äôs all! </font><font style="vertical-align: inherit;">As usual, I‚Äôm ready to answer your questions in the comments :) </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xbox 360 Protection and Hacking, Part 1 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xbox 360 Protection and Hacking, Part 2 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xbox 360 Protection and Hacking, Part 3</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500228/index.html">How Gatsby circumvented Next.js</a></li>
<li><a href="../en500232/index.html">Learning Akka.NET: Server of a simple online game</a></li>
<li><a href="../en500234/index.html">Why I made a personal expense accounting project for Git + JS</a></li>
<li><a href="../en500238/index.html">Tell me what's bothering you</a></li>
<li><a href="../en500244/index.html">Outside the array</a></li>
<li><a href="../en500248/index.html">FOSS News No. 14 - a review of free and open source news for April 27 - May 3, 2020</a></li>
<li><a href="../en500250/index.html">News from the world of OpenStreetMap No. 509 (04.14.2020-20.04.2020)</a></li>
<li><a href="../en500252/index.html">Kaspersky Security Center - New Level</a></li>
<li><a href="../en500254/index.html">We write front-end which works. Or how to become an engineer from a developer. Part 2</a></li>
<li><a href="../en500256/index.html">Dmitry Lebedev: ‚ÄúA few years ago, I clearly understood that a little bit more and OpenStreetMap would sink‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>