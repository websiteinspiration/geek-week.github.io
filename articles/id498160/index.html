<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😭 ➖ 🙍🏽 GlusterFS sebagai penyimpanan eksternal untuk Kubernetes 👐🏾 🖕 👐🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Menemukan penyimpanan yang optimal adalah proses yang agak rumit, semuanya memiliki pro dan kontra. Tentu saja, pemimpin dalam kategori ini adalah CEP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>GlusterFS sebagai penyimpanan eksternal untuk Kubernetes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498160/"><img src="https://portworx.com/wp-content/uploads/2018/10/Twitter-Social-Graphic-68.png" alt="gambar"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menemukan penyimpanan yang optimal adalah proses yang agak rumit, semuanya memiliki pro dan kontra. </font><font style="vertical-align: inherit;">Tentu saja, pemimpin dalam kategori ini adalah CEPH, tetapi ini adalah sistem yang agak rumit, meskipun dengan fungsionalitas yang sangat kaya. </font><font style="vertical-align: inherit;">Bagi kami, sistem seperti itu berlebihan, mengingat kami membutuhkan penyimpanan sederhana yang direplikasi dalam mode master-master untuk beberapa terabyte. </font><font style="vertical-align: inherit;">Setelah mempelajari banyak bahan, diputuskan untuk menguji produk paling modis di pasar untuk rangkaian yang kami minati. </font><font style="vertical-align: inherit;">Karena kenyataan bahwa tidak ada solusi siap dari rencana seperti itu ditemukan, saya ingin berbagi praktik terbaik saya tentang topik ini dan menggambarkan masalah yang kami temui dalam proses penyebaran.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tujuan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang kami harapkan dari repositori baru:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemampuan untuk bekerja dengan sejumlah genap untuk replikasi.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Instalasi mudah, pengaturan, dukungan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sistem harus dewasa, teruji waktu, dan pengguna</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemampuan untuk memperluas ruang penyimpanan tanpa downtime</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Penyimpanan harus kompatibel dengan Kubernetes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seharusnya ada failover otomatis ketika salah satu node crash</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada poin terakhir kita punya banyak pertanyaan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyebaran</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk penyebaran, dua mesin virtual diciptakan pada CentOs 8. Masing-masing terhubung melalui disk tambahan dengan penyimpanan.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Persiapan awal</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk GlusterFS, Anda perlu mengalokasikan disk terpisah dengan XFS sehingga tidak mempengaruhi sistem dengan cara apa pun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pilih partisi:</font></font><br>
<br>
<pre><code class="bash hljs">$ fdisk /dev/sdb<font></font>
Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): n<font></font>
Partition <span class="hljs-built_in">type</span><font></font>
   p   primary (0 primary, 0 extended, 4 free)<font></font>
   e   extended (container <span class="hljs-keyword">for</span> logical partitions)<font></font>
Select (default p): p<font></font>
Partition number (1-4, default 1):  1<font></font>
First sector (2048-16777215, default 2048): <font></font>
Last sector, +sectors or +size{K,M,G,T,P} (2048-16777215, default 16777215): <font></font>
&nbsp;<font></font>
Created a new partition 1 of <span class="hljs-built_in">type</span> ‘Linux’ and of size 8 GiB.<font></font>
Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w <font></font>
<font></font>
The partition table has been altered.<font></font>
Calling ioctl() to re-read partition table. Syncing disks.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Format dalam XFS dan mount:</font></font><br>
<br>
<pre><code class="bash hljs">$ mkfs.xfs /dev/sdb1<font></font>
$ mkdir /gluster<font></font>
$ mount /dev/sdb1 /gluster</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan to top it off, letakkan entri di / etc / fstab untuk secara otomatis me-mount direktori saat startup sistem:</font></font><br>
<br>
<pre><code class="bash hljs">/dev/sdb1       /gluster        xfs     defaults        0       0</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalasi</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengenai instalasi, banyak artikel telah ditulis, dalam hubungan ini kita tidak akan masuk jauh ke dalam proses, kita hanya akan mempertimbangkan apa yang perlu diperhatikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di kedua node, instal dan jalankan glusterfs versi terbaru:</font></font><br>
<br>
<pre><code class="bash hljs">$ wget -P /etc/yum.repos.d  https://download.gluster.org/pub/gluster/glusterfs/LATEST/CentOS/glusterfs-rhel8.repo<font></font>
$ yum -y install yum-utils<font></font>
$ yum-config-manager --<span class="hljs-built_in">enable</span> PowerTools<font></font>
$ yum install -y glusterfs-server<font></font>
$ systemctl start glusterd<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, Anda perlu memberi tahu glaster di mana simpul tetangganya berada. </font><font style="vertical-align: inherit;">Ini dilakukan hanya dengan satu simpul. </font><font style="vertical-align: inherit;">Poin penting: jika Anda memiliki jaringan domain, maka Anda harus menentukan nama server dengan domain, jika tidak di masa depan Anda harus mengulang semuanya.</font></font><br>
<br>
<pre><code class="bash hljs">$ gluster peer probe gluster-02.example.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika berhasil, maka kami memeriksa koneksi dengan perintah dari kedua server:</font></font><br>
<br>
<pre><code class="bash hljs">$ gluster peer status<font></font>
Number of Peers: 1<font></font>
<font></font>
Hostname: gluster-02.example.com<font></font>
Uuid: a6de3b23-ee31-4394-8bff-0bd97bd54f46<font></font>
State: Peer <span class="hljs-keyword">in</span> Cluster (Connected)<font></font>
Other names:<font></font>
10.10.6.72<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda dapat membuat Volume di mana kami akan menulis.</font></font><br>
<br>
<pre><code class="bash hljs">gluster volume create main replica 2 gluster-01.example.com:/gluster/main gluster-02.example.com:/gluster/main force</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimana:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volume nama utama </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">replika - tipe Volume (lebih jelasnya dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dokumentasi resmi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 - jumlah replika </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan Volume dan periksa kinerjanya:</font></font><br>
<br>
<pre><code class="bash hljs">gluster volume start main<font></font>
gluster volume status main</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk Volume yang direplikasi, Anda disarankan untuk mengatur parameter berikut:</font></font><br>
<br>
<pre><code class="bash hljs">$ gluster volume <span class="hljs-built_in">set</span> main network.ping-timeout 5<font></font>
$ gluster volume <span class="hljs-built_in">set</span> main cluster.quorum-type fixed<font></font>
$ gluster volume <span class="hljs-built_in">set</span> main cluster.quorum-count 1<font></font>
$ gluster volume <span class="hljs-built_in">set</span> main performance.quick-read on</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan langkah-langkah sederhana ini, kami telah membangun cluster GlusterFS. </font><font style="vertical-align: inherit;">Masih terhubung ke sana dan periksa kinerjanya. </font><font style="vertical-align: inherit;">Ubuntu diinstal pada mesin klien, untuk pemasangan Anda perlu menginstal klien:</font></font><br>
<br>
<pre><code class="bash hljs">$ add-apt-repository ppa:gluster/glusterfs-7<font></font>
$ apt install glusterfs-client<font></font>
$ mkdir /gluster<font></font>
$ mount.glusterfs gluster-01.example.com:/main /gluster</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gluster, ketika terhubung ke salah satu node, memberikan alamat semua node dan secara otomatis terhubung ke semua node. </font><font style="vertical-align: inherit;">Jika klien telah terhubung, kegagalan salah satu node tidak akan menyebabkan berhenti. </font><font style="vertical-align: inherit;">Tetapi jika node pertama tidak tersedia, itu tidak akan mungkin untuk terhubung jika terjadi sesi istirahat. </font><font style="vertical-align: inherit;">Untuk melakukan ini, saat pemasangan, Anda dapat melewati parameter backupvolfile yang menunjukkan simpul kedua.</font></font><br>
<pre><code class="bash hljs">mount.glusterfs gluster-01.example.com:/main /gluster -o backupvolfile-server=gluster-02.example.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Poin penting: gluster menyinkronkan file antar node hanya jika perubahannya melalui volume yang dipasang. </font><font style="vertical-align: inherit;">Jika Anda membuat perubahan langsung pada node, file akan tidak sinkron.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terhubung ke Kubernetes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada tahap ini, pertanyaan dimulai: "Bagaimana menghubungkannya?". </font><font style="vertical-align: inherit;">Dan ada beberapa opsi. </font><font style="vertical-align: inherit;">Pertimbangkan mereka.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heketi</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang paling populer dan direkomendasikan adalah menggunakan layanan eksternal: heketi. </font><font style="vertical-align: inherit;">heketi adalah lapisan antara kubernetes dan gluster, yang memungkinkan Anda untuk mengelola dan bekerja dengan penyimpanan melalui http. </font><font style="vertical-align: inherit;">Tapi heketi akan menjadi titik kegagalan itu, karena </font><font style="vertical-align: inherit;">layanan tidak berkerumun. </font><font style="vertical-align: inherit;">Contoh kedua dari layanan ini tidak akan dapat bekerja secara mandiri, karena </font><font style="vertical-align: inherit;">setiap perubahan disimpan dalam database lokal. </font><font style="vertical-align: inherit;">Menjalankan layanan ini di kubernetes juga tidak cocok, karena </font><font style="vertical-align: inherit;">ia membutuhkan disk statis tempat database-nya akan disimpan. </font><font style="vertical-align: inherit;">Dalam hal ini, opsi ini ternyata paling tidak pantas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Titik akhir di Kubernetes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda memiliki Kubernet pada sistem dengan manajer paket, maka ini adalah pilihan yang sangat nyaman. </font><font style="vertical-align: inherit;">Intinya adalah bahwa untuk semua server GlusteFS di Kubernetes, Endpoint umum dibuat. </font><font style="vertical-align: inherit;">Suatu layanan digantung pada Titik Akhir ini dan kami akan sudah terpasang pada layanan ini. </font><font style="vertical-align: inherit;">Agar opsi ini berfungsi, perlu menginstal glusterfs-client pada setiap simpul Kubernetes dan memastikan bahwa ia dapat dipasang. </font><font style="vertical-align: inherit;">Di Kubernetes, gunakan konfigurasi berikut:</font></font><br>
<br>
<pre><code class="python hljs">apiVersion: v1<font></font>
kind: Endpoints<font></font>
metadata: <font></font>
  name: glusterfs-cluster<font></font>
subsets:<font></font>
  - addresses:<font></font>
      <span class="hljs-comment">#  ip  </span>
      - ip: <span class="hljs-number">10.10</span><span class="hljs-number">.6</span><span class="hljs-number">.71</span><font></font>
    ports:<font></font>
      <span class="hljs-comment">#    1,    </span>
      - port: <span class="hljs-number">1</span><font></font>
  - addresses:<font></font>
      - ip: <span class="hljs-number">10.10</span><span class="hljs-number">.6</span><span class="hljs-number">.72</span><font></font>
    ports:<font></font>
      - port: <span class="hljs-number">1</span><font></font>
<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  name: glusterfs-cluster<font></font>
spec:<font></font>
  ports:<font></font>
  - port: <span class="hljs-number">1</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita dapat membuat penyebaran uji sederhana dan memeriksa cara kerja pemasangan. </font><font style="vertical-align: inherit;">Di bawah ini adalah contoh penyebaran tes sederhana:</font></font><br>
<br>
<pre><code class="python hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: gluster-test<font></font>
spec:<font></font>
  replicas: <span class="hljs-number">1</span><font></font>
  selector:<font></font>
    matchLabels:<font></font>
      app: gluster-test<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        app: gluster-test<font></font>
    spec:<font></font>
      volumes:<font></font>
      - name: gluster<font></font>
        glusterfs:<font></font>
          endpoints: glusterfs-cluster<font></font>
          path: main<font></font>
      containers:<font></font>
      - name: gluster-test<font></font>
        image: nginx<font></font>
        volumeMounts:<font></font>
        - name: gluster<font></font>
          mountPath: /gluster</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi ini tidak cocok untuk kami, karena kami memiliki container-linux di semua node Kubernetes. </font><font style="vertical-align: inherit;">Pengelola paket tidak ada di sana, jadi itu tidak mungkin untuk menginstal gluster-client untuk pemasangan. </font><font style="vertical-align: inherit;">Dalam hal ini, opsi ketiga ditemukan, yang diputuskan untuk digunakan.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GlusterFS + NFS + terus disimpan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sampai baru-baru ini, GlusterFS menawarkan server NFS sendiri, tetapi sekarang layanan eksternal nfs-ganesha digunakan untuk NFS. </font><font style="vertical-align: inherit;">Cukup banyak yang telah ditulis tentang ini, sehubungan dengan ini kita akan mencari cara untuk mengkonfigurasinya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Repositori harus didaftarkan secara manual. </font><font style="vertical-align: inherit;">Untuk melakukan ini, dalam file /etc/yum.repos.d/nfs-ganesha.repo kita tambahkan:</font></font><br>
<br>
<pre><code class="bash hljs">[nfs-ganesha]<font></font>
name=nfs-ganesha<font></font>
baseurl=https://download.nfs-ganesha.org/2.8/2.8.0/RHEL/el-8/<span class="hljs-variable">$basearch</span>/<font></font>
enabled=1<font></font>
gpgcheck=1<font></font>
[nfs-ganesha-noarch]<font></font>
name=nfs-ganesha-noarch<font></font>
baseurl=https://download.nfs-ganesha.org/2.8/2.8.0/RHEL/el-8/noarch/<font></font>
enabled=1<font></font>
gpgcheck=1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan instal:</font></font><br>
<br>
<pre><code class="bash hljs">yum -y install nfs-ganesha-gluster --nogpgcheck
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah instalasi, kami melakukan konfigurasi dasar pada file /etc/ganesha/ganesha.conf.</font></font><br>
<br>
<pre><code class="json hljs"># create new<font></font>
NFS_CORE_PARAM {<font></font>
    # possible to mount with NFSv3 to NFSv4 Pseudo path<font></font>
    mount_path_pseudo = true;<font></font>
    # NFS protocol<font></font>
    Protocols = 3,4;<font></font>
}<font></font>
EXPORT_DEFAULTS {<font></font>
    # default access mode<font></font>
    Access_Type = RW;<font></font>
}<font></font>
EXPORT {<font></font>
    # uniq ID<font></font>
    Export_Id = 101;<font></font>
    # mount path of Gluster Volume<font></font>
    Path = <span class="hljs-attr">"/gluster/main"</span>;<font></font>
    FSAL {<font></font>
        # any name<font></font>
        name = GLUSTER;<font></font>
        # hostname or IP address of this Node<font></font>
        hostname=<span class="hljs-attr">"gluster-01.example.com"</span>;<font></font>
        # Gluster volume name<font></font>
        volume=<span class="hljs-attr">"main"</span>;<font></font>
    }<font></font>
    # config for root Squash<font></font>
    Squash=<span class="hljs-string">"No_root_squash"</span>;<font></font>
    # NFSv4 Pseudo path<font></font>
    Pseudo=<span class="hljs-string">"/main"</span>;<font></font>
    # allowed security options<font></font>
    SecType = <span class="hljs-string">"sys"</span>;<font></font>
}<font></font>
LOG {<font></font>
    # default log level<font></font>
    Default_Log_Level = WARN;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita perlu memulai layanan, mengaktifkan nfs untuk volume kita dan memeriksa apakah sudah dinyalakan.</font></font><br>
<br>
<pre><code class="bash hljs">$ systemctl start nfs-ganesha<font></font>
$ systemctl <span class="hljs-built_in">enable</span> nfs-ganesha<font></font>
$ gluster volume <span class="hljs-built_in">set</span> main nfs.disable off<font></font>
$ gluster volume status main<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, statusnya harus menunjukkan bahwa server nfs telah mulai untuk volume kami. </font><font style="vertical-align: inherit;">Anda perlu melakukan mount dan periksa.</font></font><br>
<br>
<pre><code class="bash hljs">mkdir /gluster-nfs<font></font>
mount.nfs gluster-01.example.com:/main /gluster-nfs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi opsi ini tidak toleran terhadap kesalahan, jadi Anda perlu membuat alamat VIP yang akan melakukan perjalanan antara dua node kami dan membantu mengalihkan lalu lintas jika salah satu dari node tersebut jatuh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menginstal keepalived di CentOs dilakukan segera melalui manajer paket.</font></font><br>
<br>
<pre><code class="bash hljs">$ yum install -y keepalived</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mengkonfigurasi layanan di file /etc/keepalived/keepalived.conf:</font></font><br>
<br>
<pre><code class="json hljs">global_defs {<font></font>
    notification_email {<font></font>
        admin@example.com<font></font>
    }<font></font>
    notification_email_from alarm@example.com<font></font>
    smtp_server mail.example.com<font></font>
    smtp_connect_timeout <span class="hljs-number">30</span><font></font>
<font></font>
    vrrp_garp_interval <span class="hljs-number">10</span>
    vrrp_garp_master_refresh <span class="hljs-number">30</span><font></font>
}<font></font>
<font></font>
#C   ,   .    , VIP .<font></font>
vrrp_script chk_gluster {<font></font>
    script <span class="hljs-attr">"pgrep glusterd"</span><font></font>
    interval 2<font></font>
}<font></font>
<font></font>
vrrp_instance gluster {<font></font>
    interface ens192<font></font>
    state MASTER #     BACKUP<font></font>
    priority 200 #      ,  100<font></font>
    virtual_router_id 1<font></font>
    virtual_ipaddress {<font></font>
        10.10.6.70/24<font></font>
    }<font></font>
<font></font>
    unicast_peer {<font></font>
        10.10.6.72 #        <font></font>
    }<font></font>
<font></font>
    track_script {<font></font>
        chk_gluster<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita dapat memulai layanan dan memeriksa apakah VIP pada node muncul:</font></font><br>
<br>
<pre><code class="bash hljs">$ systemctl start keepalived<font></font>
$ systemctl <span class="hljs-built_in">enable</span> keepalived<font></font>
$ ip addr<font></font>
1: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<font></font>
    link/ether 00:50:56:97:55:eb brd ff:ff:ff:ff:ff:ff<font></font>
    inet 10.10.6.72/24 brd 10.10.6.255 scope global noprefixroute ens192<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet 10.10.6.70/24 scope global secondary ens192<font></font>
       valid_lft forever preferred_lft forever<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika semuanya bekerja untuk kami, maka tetap menambahkan PersistentVolume ke Kubernetes dan membuat layanan pengujian untuk memverifikasi operasi.</font></font><br>
<br>
<pre><code class="python hljs">---<font></font>
apiVersion: v1<font></font>
kind: PersistentVolume<font></font>
metadata:<font></font>
  name: gluster-nfs<font></font>
spec:<font></font>
  capacity:<font></font>
    storage: <span class="hljs-number">10</span>Gi<font></font>
  accessModes:<font></font>
    - ReadWriteMany<font></font>
  persistentVolumeReclaimPolicy: Retain<font></font>
  nfs:<font></font>
    server: <span class="hljs-number">10.10</span><span class="hljs-number">.6</span><span class="hljs-number">.70</span><font></font>
    path: /main<font></font>
<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: PersistentVolumeClaim<font></font>
metadata:<font></font>
 name: gluster-nfs<font></font>
spec:<font></font>
 accessModes:<font></font>
 - ReadWriteMany<font></font>
 resources:<font></font>
   requests:<font></font>
     storage: <span class="hljs-number">10</span>Gi<font></font>
 volumeName: <span class="hljs-string">"gluster-nfs"</span><font></font>
<font></font>
---<font></font>
apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: gluster-test<font></font>
  labels:<font></font>
    app: gluster-test<font></font>
spec:<font></font>
  replicas: <span class="hljs-number">1</span><font></font>
  selector:<font></font>
    matchLabels:<font></font>
      app: gluster-test<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        app: gluster-test<font></font>
    spec:<font></font>
      volumes:<font></font>
      - name: gluster<font></font>
        persistentVolumeClaim:<font></font>
          claimName: gluster-nfs<font></font>
      containers:<font></font>
      - name: gluster-test<font></font>
        image: nginx<font></font>
        volumeMounts:<font></font>
        - name: gluster<font></font>
          mountPath: /gluster</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan konfigurasi ini, jika terjadi penurunan simpul utama, ia akan diam selama sekitar satu menit sampai mount jatuh dalam batas waktu dan beralih. </font><font style="vertical-align: inherit;">Sederhana selama satu menit untuk penyimpanan ini, katakanlah ini bukan situasi biasa dan kita jarang akan bertemu dengannya, tetapi dalam kasus ini sistem akan secara otomatis beralih dan terus bekerja, dan kita akan dapat menyelesaikan masalah dan melakukan pemulihan tanpa khawatir tentang yang sederhana.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ringkasan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, kami memeriksa 3 opsi yang memungkinkan untuk menghubungkan GlusterFS ke Kubernetes, dalam versi kami dimungkinkan untuk menambahkan revisioner ke Kubernetes, tetapi kami belum membutuhkannya. </font><font style="vertical-align: inherit;">Masih menambahkan hasil tes kinerja antara NFS dan Gluster pada node yang sama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File di 1Mb:</font></font><br>
<br>
<pre><code class="bash hljs">sync; dd <span class="hljs-keyword">if</span>=/dev/zero of=tempfile bs=1M count=1024; sync<font></font>
Gluster: 1073741824 bytes (1.1 GB, 1.0 GiB) copied, 2.63496 s, 407 MB/s<font></font>
NFS: 1073741824 bytes (1.1 GB, 1.0 GiB) copied, 5.4527 s, 197 MB/s<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File di 1Kb:</font></font><br>
<br>
<pre><code class="bash hljs">sync; dd <span class="hljs-keyword">if</span>=/dev/zero of=tempfile bs=1K count=1048576; sync<font></font>
Gluster: 1073741824 bytes (1.1 GB, 1.0 GiB) copied, 70.0508 s, 15.3 MB/s<font></font>
NFS: 1073741824 bytes (1.1 GB, 1.0 GiB) copied, 6.95208 s, 154 MB/s<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NFS bekerja sama untuk ukuran file apa pun, perbedaan kecepatan tidak terlalu terlihat, tidak seperti GlusterFS, yang sangat terdegradasi dengan file kecil. </font><font style="vertical-align: inherit;">Tetapi pada saat yang sama, dengan ukuran file besar, NFS menunjukkan kinerja 2-3 kali lebih rendah dari Gluster.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id498146/index.html">Enam tren keamanan cerdas yang harus diwaspadai</a></li>
<li><a href="../id498150/index.html">Programer tukang ledeng, atau kisah satu kebocoran dan kesulitan mengatasinya</a></li>
<li><a href="../id498154/index.html">Kalender acara TI gratis online dari 20 hingga 26 April</a></li>
<li><a href="../id498156/index.html">F #, morfologi gambar biner</a></li>
<li><a href="../id498158/index.html">Remote Marathon Week 1: Workplace</a></li>
<li><a href="../id498162/index.html">Kami mengundang Anda ke magang TI di Alfa Bank</a></li>
<li><a href="../id498164/index.html">Strategi Produk untuk Biaya Transisi</a></li>
<li><a href="../id498168/index.html">Arsitektur jaringan saraf baru</a></li>
<li><a href="../id498172/index.html">Java Digest untuk 21 April</a></li>
<li><a href="../id498174/index.html">Cara berhenti khawatir dan mulai percaya pada tes A / B</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>