<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙇🏼 ㊙️ 🥤 Und noch einmal zu Embedded: Suche nach Fehlern im Embox-Projekt ➗ 👨🏽‍💻 🎉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Embox ist ein plattformübergreifendes Multitasking-Echtzeitbetriebssystem für eingebettete Systeme. Es wurde für den Betrieb mit geringen Rechenressou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Und noch einmal zu Embedded: Suche nach Fehlern im Embox-Projekt</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/499986/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e62/20f/e3c/e6220fe3c8d556e40580a1cf49eab7cb.png" alt="Figur 2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embox ist ein plattformübergreifendes Multitasking-Echtzeitbetriebssystem für eingebettete Systeme. Es wurde für den Betrieb mit geringen Rechenressourcen entwickelt und ermöglicht es Ihnen, Linux-basierte Anwendungen auf Mikrocontrollern auszuführen, ohne Linux selbst zu verwenden. Natürlich werden auch Embox-Fehler wie bei jeder anderen Anwendung nicht verschont. Dieser Artikel befasst sich mit der Analyse von Fehlern im Code des Embox-Projekts.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor einigen Monaten habe ich bereits </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über die Überprüfung von FreeRTOS geschrieben, einem anderen Betriebssystem für eingebettete Systeme. </font><font style="vertical-align: inherit;">Ich habe damals keine Fehler darin gefunden, aber ich habe sie in Bibliotheken gefunden, die von den Jungs von Amazon hinzugefügt wurden, als sie ihre eigene Version von FreeRTOS entwickelten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Artikel, den Sie jetzt vor sich sehen, setzt gewissermaßen das Thema des vorherigen fort. </font><font style="vertical-align: inherit;">Wir haben oft Anfragen erhalten, FreeRTOS zu überprüfen, und wir haben es getan. </font><font style="vertical-align: inherit;">Dieses Mal gab es keine Anfragen, ein bestimmtes Projekt zu überprüfen, aber ich erhielt Briefe und Kommentare von eingebetteten Entwicklern, denen es gefiel und die mehr wollten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, die neue Ausgabe des PVS-Studio for Embedded Magazins ist gereift und liegt vor Ihnen. </font><font style="vertical-align: inherit;">Genieße das Zusehen!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Analyse wurde mit PVS-Studio durchgeführt - einem statischen Code-Analysator für C, C ++, C # und Java. Vor der Analyse muss das Projekt zusammengestellt werden. Wir stellen also sicher, dass der Projektcode funktioniert, und geben dem Analysator die Möglichkeit, die Baugruppeninformationen zu sammeln, die für eine bessere Codeüberprüfung hilfreich sein können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Anweisungen im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offiziellen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Embox- </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Repository</font></a><font style="vertical-align: inherit;"> bieten die Möglichkeit, unter verschiedenen Systemen (Arch Linux, macOS, Debian) und mit Docker zu erstellen. Ich beschloss, mein Leben etwas abwechslungsreicher zu gestalten und unter Debian zu erstellen und zu analysieren, das ich kürzlich auf meiner virtuellen Maschine installiert hatte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Montage verlief reibungslos. </font><font style="vertical-align: inherit;">Nun war es notwendig, eine Analyse durchzuführen. </font><font style="vertical-align: inherit;">Debian ist eines der unterstützten PVS-Studio Linux-basierten Systeme. </font><font style="vertical-align: inherit;">Eine bequeme Möglichkeit, Projekte unter Linux zu überprüfen, ist das Kompilieren von Trace. </font><font style="vertical-align: inherit;">Dies ist ein spezieller Modus, in dem der Analysator alle erforderlichen Informationen über die Baugruppe sammelt, sodass Sie die Analyse mit einem Klick starten können. </font><font style="vertical-align: inherit;">Ich musste lediglich: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) PVS-Studio herunterladen und installieren; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Starten Sie die Baugruppenverfolgung, indem Sie in den Ordner mit Embox gehen und das Terminal eingeben</font></font><br>
<br>
<pre><code class="cpp hljs">pvs-studio-analyzer analyze -- make</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Nachdem Sie auf den Abschluss der Assembly gewartet haben, führen Sie den folgenden Befehl aus:</font></font><br>
<br>
<pre><code class="cpp hljs">pvs-studio-analyzer analyze -o /path/to/output.<span class="hljs-built_in">log</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Konvertieren Sie den Rohbericht in ein für Sie geeignetes Format. </font><font style="vertical-align: inherit;">Der Analysator wird mit einem speziellen Dienstprogramm PlogConverter geliefert, mit dem Sie dies tun können. </font><font style="vertical-align: inherit;">Der Befehl zum Konvertieren des Berichts in eine Aufgabenliste (zum Anzeigen beispielsweise in QtCreator) sieht beispielsweise folgendermaßen aus:</font></font><br>
<br>
<pre><code class="cpp hljs">plog-converter -t tasklist -o /path/to/output.tasks /path/to/project</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle! </font><font style="vertical-align: inherit;">Ich habe nicht länger als 15 Minuten gebraucht, um diese Punkte zu erreichen. </font><font style="vertical-align: inherit;">Der Bericht ist fertig, jetzt können Sie die Fehler anzeigen. </font><font style="vertical-align: inherit;">Nun, lass uns anfangen :)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seltsamer Zyklus</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einer der vom Analysator gefundenen Fehler war die seltsame while-Schleife:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">while</span> (dp.skip != <span class="hljs-number">0</span> ) {<font></font>
    n_read = read(ifd, tbuf, dp.bs);<font></font>
    <span class="hljs-keyword">if</span> (n_read &lt; <span class="hljs-number">0</span>) {<font></font>
      err = -errno;<font></font>
      <span class="hljs-keyword">goto</span> out_cmd;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (n_read == <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">goto</span> out_cmd;<font></font>
    }<font></font>
<font></font>
    dp.skip --;<font></font>
  } <span class="hljs-keyword">while</span> (dp.skip != <span class="hljs-number">0</span>);       <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">do</span> {<font></font>
    n_read = read(ifd, tbuf, dp.bs);<font></font>
    <span class="hljs-keyword">if</span> (n_read &lt; <span class="hljs-number">0</span>) {<font></font>
      err = -errno;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (n_read == <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    ....<font></font>
<font></font>
    dp.count --;<font></font>
  } <span class="hljs-keyword">while</span> (dp.count != <span class="hljs-number">0</span>);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio- </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">: </font></b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">V715</font></a><font style="vertical-align: inherit;"> Der Operator 'while' hat einen leeren Körper. </font><font style="vertical-align: inherit;">Verdächtiges Muster erkannt: 'while (Ausdruck) {...} while (dp.skip! = 0);'. </font><font style="vertical-align: inherit;">dd.c 225 hm </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. </font><font style="vertical-align: inherit;">Wirklich seltsame Schleife. </font><font style="vertical-align: inherit;">Der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausdruck </font><i><font style="vertical-align: inherit;">(dp.skip! = 0)</font></i><font style="vertical-align: inherit;"> wird zweimal geschrieben, einmal direkt über der Schleife und der zweite direkt darunter. </font><font style="vertical-align: inherit;">Tatsächlich sind dies nun zwei verschiedene Zyklen: Einer enthält Ausdrücke in geschweiften Klammern und der zweite ist leer. </font><font style="vertical-align: inherit;">In diesem Fall wird der zweite Zyklus niemals ausgeführt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unten ist eine do ... while-Schleife mit einer ähnlichen Bedingung, was mich zu der Annahme veranlasst: Die seltsame Schleife war ursprünglich als do ... while gedacht, aber etwas ist schiefgegangen. </font><font style="vertical-align: inherit;">Ich denke, dass dieser Code mit hoher Wahrscheinlichkeit einen logischen Fehler enthält.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speicherlecks</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, nicht ohne sie.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">krename</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *oldpath, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *newpath)</span> </span>{<font></font>
  <font></font>
  <span class="hljs-keyword">char</span> *newpatharg, *oldpatharg;<font></font>
<font></font>
  ....<font></font>
<font></font>
  oldpatharg =<font></font>
    <span class="hljs-built_in">calloc</span>(<span class="hljs-built_in">strlen</span>(oldpath) + diritemlen + <span class="hljs-number">2</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>));<font></font>
  newpatharg =<font></font>
    <span class="hljs-built_in">calloc</span>(<span class="hljs-built_in">strlen</span>(newpath) + diritemlen + <span class="hljs-number">2</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>));
  <span class="hljs-keyword">if</span> (<span class="hljs-literal">NULL</span> == oldpatharg || <span class="hljs-literal">NULL</span> == newpatharg) {<font></font>
    SET_ERRNO(ENOMEM);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio-Warnungen:</font></font></b> <br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V773</a> The function was exited without releasing the 'newpatharg' pointer. A memory leak is possible. kfsop.c 611</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V773</a> The function was exited without releasing the 'oldpatharg' pointer. A memory leak is possible. kfsop.c 611</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktion erstellt die lokalen Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newpatharg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oldpatharg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in sich </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Diesen Zeigern werden die Adressen neuer Speicherorte zugewiesen, die intern mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calloc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zugewiesen </font><i><font style="vertical-align: inherit;">wurden</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wenn beim </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuweisen von</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Speicher ein Problem auftritt, gibt </font><i><font style="vertical-align: inherit;">calloc</font></i><font style="vertical-align: inherit;"> einen Nullzeiger zurück. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist, wenn nur ein Speicherblock zugeordnet ist? </font><font style="vertical-align: inherit;">Die Funktion stürzt ab, ohne dass Speicher freigegeben wird. </font><font style="vertical-align: inherit;">Die Site, die zufällig zugewiesen wurde, bleibt im Speicher, ohne dass die Möglichkeit besteht, erneut darauf zuzugreifen und sie für die weitere Verwendung freizugeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiteres Beispiel für einen Speicherverlust ist etwas heller:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">block_dev_test</span><span class="hljs-params">(....)</span> </span>{
  <span class="hljs-keyword">int8_t</span> *read_buf, *write_buf;<font></font>
  <font></font>
  ....<font></font>
<font></font>
  read_buf = <span class="hljs-built_in">malloc</span>(blk_sz * m_blocks);<font></font>
  write_buf = <span class="hljs-built_in">malloc</span>(blk_sz * m_blocks);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (read_buf == <span class="hljs-literal">NULL</span> || write_buf == <span class="hljs-literal">NULL</span>) {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Failed to allocate memory for buffer!\n"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (read_buf != <span class="hljs-literal">NULL</span>) {
      <span class="hljs-built_in">free</span>(read_buf);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (write_buf != <span class="hljs-literal">NULL</span>) {
      <span class="hljs-built_in">free</span>(write_buf);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> -ENOMEM;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (s_block &gt;= blocks) {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Starting block should be less than number of blocks\n"</span>);
    <span class="hljs-keyword">return</span> -EINVAL;            <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio-Warnungen:</font></font></b> <br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V773</a> The function was exited without releasing the 'read_buf' pointer. A memory leak is possible. block_dev_test.c 195</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V773</a> The function was exited without releasing the 'write_buf' pointer. A memory leak is possible. block_dev_test.c 195</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier hat der Programmierer bereits Genauigkeit gezeigt und den Fall korrekt verarbeitet, in dem es möglich war, nur ein Stück Speicher zuzuweisen. </font><font style="vertical-align: inherit;">Richtig verarbeitet ... und im nächsten Ausdruck buchstäblich einen weiteren Fehler gemacht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dank einer korrekt geschriebenen Prüfung können wir sicher sein, dass zum Zeitpunkt der Ausführung des Ausdrucks </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-EINVAL zurückgegeben wird. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir werden definitiv Speicher sowohl für </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">read_buf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als auch für </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">write_buf haben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mit einer solchen Rückkehr von der Funktion haben wir also zwei Lecks gleichzeitig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich denke, dass ein Speicherverlust auf einem eingebetteten Gerät schmerzhafter sein kann als auf einem klassischen PC. </font><font style="vertical-align: inherit;">Unter Bedingungen, in denen die Ressourcen stark eingeschränkt sind, müssen Sie sie besonders sorgfältig überwachen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeiger Misshandlung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der folgende Fehlercode ist kurz und einfach genug:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">scsi_write</span><span class="hljs-params">(struct block_dev *bdev, <span class="hljs-keyword">char</span> *buffer,
                      <span class="hljs-keyword">size_t</span> count, <span class="hljs-keyword">blkno_t</span> blkno)</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">scsi_dev</span> *<span class="hljs-title">sdev</span>;</span>
  <span class="hljs-keyword">int</span> blksize;<font></font>
<font></font>
  ....<font></font>
<font></font>
  sdev = bdev-&gt;privdata;<font></font>
  blksize = sdev-&gt;blk_size; <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!sdev) {              <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">return</span> -ENODEV;<font></font>
  }<font></font>
<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Zeiger 'sdev' wurde verwendet, bevor er gegen nullptr verifiziert wurde. Überprüfen Sie die Zeilen: 116, 118. scsi_disk.c 116 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sdev-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeiger </font><i><font style="vertical-align: inherit;">wird</font></i><font style="vertical-align: inherit;"> dereferenziert, kurz bevor er auf NULL überprüft wird. Es ist logisch anzunehmen, dass dieser Zeiger null sein kann, wenn jemand eine solche Prüfung geschrieben hat. In diesem Fall haben wir die mögliche Dereferenzierung des Nullzeigers in der Zeichenfolge </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blksize = sdev-&gt; blk_size</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Fehler ist, dass sich die Prüfung nicht dort befindet, wo sie benötigt wird. Es sollte nach der Zeile " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sdev = bdev-&gt; privdata;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " stehen, aber vor der Zeile " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blksize = sdev-&gt; blk_size;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Dann könnte die mögliche Anziehungskraft auf die Nulladresse vermieden werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio hat im folgenden Code zwei weitere Fehler gefunden:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">xdrrec_create</span><span class="hljs-params">(....)</span>
</span>{
  <span class="hljs-keyword">char</span> *buff;<font></font>
<font></font>
  ....<font></font>
<font></font>
  buff = (<span class="hljs-keyword">char</span> *)<span class="hljs-built_in">malloc</span>(sendsz + recvsz);<font></font>
  assert(buff != <span class="hljs-literal">NULL</span>);<font></font>
<font></font>
  ....<font></font>
<font></font>
  xs-&gt;extra.rec.in_base = xs-&gt;extra.rec.in_curr = buff;<font></font>
  xs-&gt;extra.rec.in_boundry <font></font>
    = xs-&gt;extra.rec.in_base + recvsz;                    <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  ....<font></font>
  xs-&gt;extra.rec.out_base<font></font>
    = xs-&gt;extra.rec.out_hdr = buff + recvsz;             <span class="hljs-comment">// &lt;= </span><font></font>
  xs-&gt;extra.rec.out_curr <font></font>
    = xs-&gt;extra.rec.out_hdr + <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">union</span> xdrrec_hdr);<font></font>
<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio-Warnungen:</font></font></b> <br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V769</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Zeiger 'xs-&gt; extra.rec.in_base' im Ausdruck 'xs-&gt; extra.rec.in_base + recvsz' könnte nullptr sein. </font><font style="vertical-align: inherit;">In diesem Fall ist der resultierende Wert sinnlos und sollte nicht verwendet werden. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 56, 48. xdr_rec.c 56</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V769</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Zeiger 'buff' im Ausdruck 'buff + recvsz' könnte nullptr sein. </font><font style="vertical-align: inherit;">In diesem Fall ist der resultierende Wert sinnlos und sollte nicht verwendet werden. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 61, 48. xdr_rec.c 61</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Buf-Zeiger wird mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> initialisiert </font><font style="vertical-align: inherit;">, und sein Wert wird dann verwendet, um andere Zeiger zu initialisieren. Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malloc-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">kann einen Nullzeiger zurückgeben, und dies sollte immer überprüft werden. Es scheint , </font><font style="vertical-align: inherit;">dass hier ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Überprüfung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und alles sollte gut funktionieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber nein! Tatsache ist, dass </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 's zum Debuggen verwendet werden. Wenn Sie das Projekt in der Release-Konfiguration </font><font style="vertical-align: inherit;">erstellen </font><font style="vertical-align: inherit;">, wird diese </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gelöscht. Es stellt sich heraus, dass das Programm bei der Arbeit in Debug korrekt funktioniert und beim Erstellen in Release der Nullzeiger weiter "geht". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verwenden Sie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in arithmetischen Operationen ist falsch, weil das Ergebnis einer solchen Operation keinen Sinn ergibt und ein solches Ergebnis nicht verwendet werden kann. </font><font style="vertical-align: inherit;">Darum warnt uns der Analysator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einige könnten argumentieren, dass </font><font style="vertical-align: inherit;">es furchtlos ist </font><font style="vertical-align: inherit;">, den Zeiger nach </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realloc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calloc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht zu überprüfen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wie beim ersten Zugriff durch einen Nullzeiger tritt ein Signal / eine Ausnahme auf und es ist nichts falsch. </font><font style="vertical-align: inherit;">In der Praxis ist alles viel komplizierter, und wenn Ihnen die fehlende Überprüfung nicht gefährlich erscheint, empfehlen wir Ihnen, den Artikel „ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum ist es wichtig zu überprüfen, was die Malloc-Funktion zurückgegeben hat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “ zu </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">lesen</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falsche Behandlung von Arrays</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der folgende Fehler ist dem vorletzten Beispiel sehr ähnlich:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fat_read_filename</span><span class="hljs-params">(struct fat_file_info *fi,
                      <span class="hljs-keyword">void</span> *p_scratch,
                      <span class="hljs-keyword">char</span> *name)</span> </span>{
  <span class="hljs-keyword">int</span> offt = <span class="hljs-number">1</span>;<font></font>
<font></font>
  ....<font></font>
<font></font>
  offt = <span class="hljs-built_in">strlen</span>(name);
  <span class="hljs-keyword">while</span> (name[offt - <span class="hljs-number">1</span>] == <span class="hljs-string">' '</span> &amp;&amp; offt &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// &lt;=</span>
    name[--offt] = <span class="hljs-string">'\0'</span>;<font></font>
  }<font></font>
  log_debug(<span class="hljs-string">"name(%s)"</span>, name);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> DFS_OK;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V781</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Wert des 'offt'-Index wird nach seiner Verwendung überprüft. </font><font style="vertical-align: inherit;">Möglicherweise liegt ein Fehler in der Programmlogik vor. </font><font style="vertical-align: inherit;">fat_common.c 1813 Die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offt wird</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zuerst innerhalb der Indizierungsoperation verwendet, und erst dann wird überprüft, ob ihr Wert größer als Null ist. </font><font style="vertical-align: inherit;">Aber was passiert, wenn </font><font style="vertical-align: inherit;">sich herausstellt, dass der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine leere Zeichenfolge ist? </font><font style="vertical-align: inherit;">Die Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlen ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 zurück</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dann einen lauten Schuss ins Bein. </font><font style="vertical-align: inherit;">Das Programm greift mit einem negativen Index zu, was zu undefiniertem Verhalten führt. </font><font style="vertical-align: inherit;">Alles kann passieren, einschließlich eines Programmabsturzes. </font><font style="vertical-align: inherit;">Chaos!</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8d/fde/b0d/a8dfdeb0d70054257d1d08162bbd39aa.png" alt="Bild 1"></div> <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verdächtige Bedingungen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wo ohne sie? </font><font style="vertical-align: inherit;">Wir finden solche Fehler buchstäblich in jedem Projekt, das wir überprüfen.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">index_descriptor_cloexec_set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">int</span> cloexec)</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">idesc_table</span> *<span class="hljs-title">it</span>;</span><font></font>
<font></font>
  it = task_resource_idesc_table(task_self());<font></font>
  assert(it);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (cloexec | FD_CLOEXEC) {<font></font>
    idesc_cloexec_set(it-&gt;idesc_table[fd]);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    idesc_cloexec_clear(it-&gt;idesc_table[fd]);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V617</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Überprüfen Sie den Zustand. Das Argument '0x0010' des '|' Die bitweise Operation enthält einen Wert ungleich Null. index_descriptor.c 55 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zu verstehen, worin der Fehler liegt, sehen Sie sich die Definition der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FD_CLOEXEC-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Konstante an </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FD_CLOEXEC 0x0010</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass im Ausdruck </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (cloexec | FD_CLOEXEC)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rechts vom bitweisen „oder“ immer eine Konstante ungleich Null vorhanden ist. </font><font style="vertical-align: inherit;">Das Ergebnis einer solchen Operation ist immer eine Zahl ungleich Null. </font><font style="vertical-align: inherit;">Somit ist dieser Ausdruck immer äquivalent zum </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (true)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Ausdruck </font><font style="vertical-align: inherit;">, und wir werden immer nur den then-Zweig des if-Ausdrucks verarbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich vermute, dass diese Makrokonstante verwendet wird, um das Embox-Betriebssystem vorzukonfigurieren, aber selbst dann sieht dieser immer wahre Zustand seltsam aus. </font><font style="vertical-align: inherit;">Vielleicht wollten sie hier den Operator </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp; verwenden</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aber sie haben einen Tippfehler gemacht.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ganzzahlige Division</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der folgende Fehler hängt mit einer Funktion der C-Sprache zusammen:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SBSIZE    1024</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ext2fs_format</span><span class="hljs-params">(struct block_dev *bdev, <span class="hljs-keyword">void</span> *priv)</span> </span>{
  <span class="hljs-keyword">size_t</span> dev_bsize;
  <span class="hljs-keyword">float</span> dev_factor;<font></font>
<font></font>
  ....<font></font>
<font></font>
  dev_size = block_dev_size(bdev);<font></font>
  dev_bsize = block_dev_block_size(bdev);<font></font>
  dev_factor = SBSIZE / dev_bsize;            <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  ext2_dflt_sb(&amp;sb, dev_size, dev_factor);<font></font>
  ext2_dflt_gd(&amp;sb, &amp;gd);<font></font>
<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio- </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">: </font></b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">V636</font></a><font style="vertical-align: inherit;"> Der Ausdruck '1024 / dev_bsize' wurde implizit vom Typ 'int' in den Typ 'float' umgewandelt. Erwägen Sie die Verwendung eines expliziten Typgusses, um den Verlust eines Bruchteils zu vermeiden. Ein Beispiel: double A = (double) (X) / Y; ext2.c 777 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Funktion lautet wie folgt: Wenn wir zwei ganzzahlige Werte teilen, ist das Ergebnis der Division eine ganze Zahl. Somit erfolgt die Teilung ohne Rest, oder mit anderen Worten, der Bruchteil wird aus dem Teilungsergebnis verworfen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal vergessen Programmierer es und es werden solche Fehler gemacht. Die SBSIZE-Konstante und die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev_bsize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> haben einen ganzzahligen Typ (int bzw. size_t). Daher das Ergebnis des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausdrucks SBSIZE / dev_bsize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird auch vom Typ Integer sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber warte einen Moment. </font><font style="vertical-align: inherit;">Die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev_factor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">float</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">Offensichtlich erwartete der Programmierer ein Bruchteilungsergebnis. </font><font style="vertical-align: inherit;">Dies kann weiter überprüft werden, wenn Sie auf die weitere Verwendung dieser Variablen achten. </font><font style="vertical-align: inherit;">Beispielsweise hat die Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext2_dflt_sb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , bei der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev_factor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als dritter Parameter übergeben wird, die folgende Signatur:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ext2_dflt_sb</span><span class="hljs-params">(struct ext2sb *sb, <span class="hljs-keyword">size_t</span> dev_size, <span class="hljs-keyword">float</span> dev_factor)</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ebenso an anderen Stellen, an denen die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev_factor verwendet wird</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Alles zeigt an, dass eine Gleitkommazahl erwartet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diesen Fehler zu korrigieren, reicht es aus, nur einen der Divisionsoperanden in einen realen Typ umzuwandeln. </font><font style="vertical-align: inherit;">Zum Beispiel:</font></font><br>
<br>
<pre><code class="cpp hljs">dev_factor = <span class="hljs-keyword">float</span>(SBSIZE) / dev_bsize;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann ist das Ergebnis der Division eine Bruchzahl.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht überprüfte Eingabe</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der folgende Fehler hängt mit der Verwendung nicht verifizierter Daten zusammen, die von außerhalb des Programms empfangen wurden.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{
  <span class="hljs-keyword">int</span> ret;
  <span class="hljs-keyword">char</span> text[SMTP_TEXT_LEN + <span class="hljs-number">1</span>];<font></font>
<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-literal">NULL</span> == fgets(&amp;text[<span class="hljs-number">0</span>], <span class="hljs-keyword">sizeof</span> text - <span class="hljs-number">2</span>, <span class="hljs-comment">/* for \r\n */</span>
      <span class="hljs-built_in">stdin</span>)) { ret = -EIO; <span class="hljs-keyword">goto</span> error; }<font></font>
    text[<span class="hljs-built_in">strlen</span>(&amp;text[<span class="hljs-number">0</span>]) - <span class="hljs-number">1</span>] = <span class="hljs-string">'\0'</span>; <span class="hljs-comment">/* remove \n */</span>    <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1010 Nicht aktivierte fehlerhafte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Daten werden im Index verwendet: 'strlen (&amp; text [0])'. </font><font style="vertical-align: inherit;">sendmail.c 102 </font><i><font style="vertical-align: inherit;">Überlegen Sie zunächst</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
, was die Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fgets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zurückgibt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Bei erfolgreichem Lesen einer Zeile gibt die Funktion einen Zeiger auf diese Zeile zurück. </font><font style="vertical-align: inherit;">Wenn die Lese ein antrifft </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">end of file</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bevor mindestens ein Element gelesen wird </font><font style="vertical-align: inherit;">, oder wenn ein Eingangsfehler auftritt, die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fgets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">kehrt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Ausdruck lautet also </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL == fgets (....)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prüft, ob die empfangene Eingabe korrekt ist. Aber es gibt eine Einschränkung. Wenn Sie ein Null-Terminal als erstes zu lesendes Zeichen übertragen (dies kann beispielsweise durch Drücken von Strg + 2 im Legacy-Modus der Windows-Befehlszeile erfolgen), </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berücksichtigt die</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><i><font style="vertical-align: inherit;">fgets</font></i><font style="vertical-align: inherit;"> dies, ohne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL zurückzugeben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In diesem Fall hat die Zeile, in der die Aufnahme gemacht wird, nur ein Element - ' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was wird als nächstes passieren? Der Ausdruck </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlen (&amp; text [0])</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 zurück</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Als Ergebnis erhalten wir einen negativen Indexaufruf:</font></font><br>
<br>
<pre><code class="cpp hljs">text[ <span class="hljs-number">0</span> - <span class="hljs-number">1</span> ] = <span class="hljs-string">'\0'</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen können wir das Programm „umkippen“, indem wir einfach das Zeilenabschlusszeichen übergeben. </font><font style="vertical-align: inherit;">Dies ist umständlich und kann möglicherweise verwendet werden, um Systeme mit Embox anzugreifen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mein Kollege, der diese Diagnoseregel entwickelte, machte sich sogar ein Beispiel für einen solchen Angriff auf das NcFTP-Projekt:</font></font><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/8DBQjvPQ7tk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich empfehle zu sehen, ob Sie immer noch nicht an eine solche Gelegenheit glauben :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem hat der Analysator zwei weitere Stellen mit demselben Fehler gefunden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1010 Nicht aktivierte fehlerhafte Daten werden im Index 'strlen (&amp; from [0])' verwendet. </font><font style="vertical-align: inherit;">sendmail.c 55</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1010 Nicht aktivierte fehlerhafte Daten werden im Index 'strlen (&amp; to [0])' verwendet. </font><font style="vertical-align: inherit;">sendmail.c 65</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Misra</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MISRA ist eine Reihe von Richtlinien und Richtlinien zum Schreiben von sicherem C- und C ++ - Code für verantwortungsbewusste eingebettete Systeme. </font><font style="vertical-align: inherit;">In gewisser Weise handelt es sich hierbei um ein Schulungshandbuch, mit dem Sie nicht nur die sogenannten "Code-Gerüche" beseitigen, sondern auch Ihr Programm vor Schwachstellen schützen können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MISRA wird dort eingesetzt, wo Menschenleben von der Qualität Ihres eingebetteten Systems abhängen: in der Medizin-, Automobil-, Flugzeug- und Militärindustrie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio verfügt über </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">umfangreiche</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diagnoseregeln, mit denen Sie Ihren Code auf Übereinstimmung mit den Standards MISRA C und MISRA C ++ überprüfen können. </font><font style="vertical-align: inherit;">Standardmäßig ist der Modus mit dieser Diagnose deaktiviert, aber da wir im Projekt nach Fehlern für eingebettete Systeme suchen, könnte ich einfach nicht auf MISRA verzichten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Folgendes habe ich gefunden:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* find and read symlink file */</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ext2_read_symlink</span><span class="hljs-params">(struct nas *nas,
                             <span class="hljs-keyword">uint32_t</span> parent_inumber,
                             <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **cp)</span> </span>{
  <span class="hljs-keyword">char</span> namebuf[MAXPATHLEN + <span class="hljs-number">1</span>];<font></font>
<font></font>
  ....<font></font>
<font></font>
  *cp = namebuf;              <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">if</span> (*namebuf != <span class="hljs-string">'/'</span>) {<font></font>
    inumber = parent_inumber;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    inumber = (<span class="hljs-keyword">uint32_t</span>) EXT2_ROOTINO;<font></font>
  }<font></font>
  rc = ext2_read_inode(nas, inumber);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> rc;<font></font>
} </code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warnung: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V2548</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [MISRA C 18.6] Die Adresse des lokalen Arrays 'namebuf' sollte nicht außerhalb des Bereichs dieses Arrays gespeichert werden. ext2.c 298 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Analysator hat eine verdächtige Zuordnung festgestellt, die möglicherweise zu undefiniertem Verhalten führen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns den Code genauer an. Hier ist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">namebuf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein Array, das im lokalen Bereich der Funktion erstellt wird, und der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeiger wird </font><font style="vertical-align: inherit;">per Zeiger an die Funktion übergeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gemäß der C-Syntax ist der Name des Arrays ein Zeiger auf das erste Element in dem Speicherbereich, in dem das Array gespeichert ist. Es stellt sich heraus, dass der Ausdruck </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* cp = namebuf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der Variablen, auf die </font><i><font style="vertical-align: inherit;">cp </font></i><i><font style="vertical-align: inherit;">zeigt</font></i><font style="vertical-align: inherit;"> , die Adresse des Arrays </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">namebuf zuweist</font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> per Zeiger an die Funktion übergeben wird, wird eine Änderung des Werts, auf den sie zeigt, an der Stelle wiedergegeben, an der die Funktion aufgerufen wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass der </font><font style="vertical-align: inherit;">dritte Parameter </font><font style="vertical-align: inherit;">nach Abschluss der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeit der</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><i><font style="vertical-align: inherit;">ext2_read_symlink</font></i><font style="vertical-align: inherit;"> den Bereich angibt, den das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">namebuf-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array einmal belegt hat </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt nur ein "aber": Da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">namebuf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein auf dem Stapel reserviertes Array ist, wird es beim </font><i><font style="vertical-align: inherit;">Beenden</font></i><font style="vertical-align: inherit;"> der Funktion gelöscht. Ein Zeiger, der außerhalb der Funktion vorhanden ist, zeigt somit auf den freigegebenen Speicher.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was wird an dieser Adresse sein? </font><font style="vertical-align: inherit;">Es ist unmöglich vorherzusagen. </font><font style="vertical-align: inherit;">Es ist möglich, dass sich der Inhalt des Arrays noch einige Zeit im Speicher befindet, oder dass das Programm diesen Bereich sofort mit etwas anderem löscht. </font><font style="vertical-align: inherit;">Im Allgemeinen gibt der Zugriff auf eine solche Adresse einen undefinierten Wert zurück, und die Verwendung eines solchen Werts ist ein grober Fehler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Analysator hat mit derselben Warnung auch einen anderen Fehler gefunden:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V2548</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [MISRA C 18.6] Die Adresse der lokalen Variablen 'dst_haddr' sollte nicht außerhalb des Bereichs dieser Variablen gespeichert werden. </font><font style="vertical-align: inherit;">net_tx.c 82</font></font></li>
</ul><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ba/353/6e6/2ba3536e675a564e65b802a3e596fa36.png" alt="Abbildung 6"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe gerne mit dem Embox-Projekt gearbeitet. Trotz der Tatsache, dass ich nicht alle im Artikel gefundenen Fehler ausgeschrieben habe, war die Gesamtzahl der Warnungen relativ gering, und im Allgemeinen wurde der Projektcode mit hoher Qualität geschrieben. Daher danke ich sowohl den Entwicklern als auch denen, die im Namen der Community zum Projekt beigetragen haben. Du bist großartig! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich nutze diese Gelegenheit, um den Entwicklern von Tula Grüße zu übermitteln. Ich werde glauben, dass es in St. Petersburg momentan nicht sehr kalt ist :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier endet mein Artikel. Ich hoffe, es hat Ihnen Spaß gemacht, es zu lesen, und Sie haben etwas Neues für sich gefunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie an PVS-Studio interessiert sind und ein Projekt unabhängig davon überprüfen möchten, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laden Sie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">herunter und probieren Sie es aus</font></a><font style="vertical-align: inherit;"> . Dies dauert nicht länger als 15 Minuten.</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie diesen Artikel einem englischsprachigen Publikum zugänglich machen möchten, verwenden Sie bitte den Link zur Übersetzung: George Gribkov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wieder eingebettet: Suche nach Fehlern im Embox-Projekt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de499970/index.html">Wir untersuchen die Mediastreamer2 VoIP-Engine. Teil 12</a></li>
<li><a href="../de499972/index.html">Mögen Online-Events verdauen</a></li>
<li><a href="../de499974/index.html">3D-Spiele auf Instagram Javascript oder Wurstflugbahn</a></li>
<li><a href="../de499978/index.html">Übersetzung von Andrew Un's Buch, Leidenschaft für maschinelles Lernen, Kapitel 36 und 37</a></li>
<li><a href="../de499982/index.html">Anfänger-Tester-Plan: Von "IT eingeben" bis "Ich bin Ingenieur!"</a></li>
<li><a href="../de499988/index.html">Zucker und COVID-19</a></li>
<li><a href="../de499990/index.html">Geokodierung Wie binde ich in 10 Minuten 250.000 Adressen an Koordinaten?</a></li>
<li><a href="../de499992/index.html">Designtechnologien zur Implementierung von Abrechnungssystemen für Firmenkunden (Teil 2)</a></li>
<li><a href="../de499994/index.html">Wenn das Coronavirus endet</a></li>
<li><a href="../de500000/index.html">Zum Radiotag. Kommunikation - die Nerven des Krieges</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>