<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüîß üè´ ü§öüèº Internet das coisas no Yandex.Cloud: como os servi√ßos de fun√ß√µes do Yandex IoT Core e Yandex Cloud s√£o organizados üêª üë©üèø‚Äçü§ù‚Äçüë©üèº ü•ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em outubro do ano passado, foi realizada a primeira confer√™ncia em nuvem Yandex Yandex Scale. Anunciou o lan√ßamento de muitos novos servi√ßos, incluind...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Internet das coisas no Yandex.Cloud: como os servi√ßos de fun√ß√µes do Yandex IoT Core e Yandex Cloud s√£o organizados</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/491740/"><img src="https://habrastorage.org/webt/wf/_u/zo/wf_uzobkj9vxp2ddkzxzux7lhbo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em outubro do ano passado, foi realizada a primeira confer√™ncia em nuvem Yandex Yandex Scale. Anunciou o lan√ßamento de muitos novos servi√ßos, incluindo o Yandex IoT Core, que permite trocar dados com milh√µes de dispositivos IoT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, falarei sobre por que o Yandex IoT Core √© necess√°rio e como ele funciona, bem como como ele pode interagir com outros servi√ßos Yandex. Voc√™ aprender√° sobre a arquitetura, os meandros da intera√ß√£o dos componentes e os recursos da implementa√ß√£o da funcionalidade - tudo isso o ajudar√° a otimizar o uso desses servi√ßos.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, vamos relembrar as principais vantagens das nuvens p√∫blicas e do PaaS - reduzindo o tempo e os custos de desenvolvimento, bem como os custos de suporte e infraestrutura, que tamb√©m s√£o relevantes para projetos de IoT. Mas existem alguns recursos √∫teis menos √≥bvios que voc√™ pode acessar na nuvem. Esse dimensionamento eficaz e toler√¢ncia a falhas s√£o aspectos importantes ao trabalhar com dispositivos, especialmente em projetos de infraestrutura de informa√ß√µes cr√≠ticas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escala eficaz √© a capacidade de aumentar ou diminuir livremente o n√∫mero de dispositivos sem enfrentar problemas t√©cnicos e observar uma mudan√ßa previs√≠vel no custo do sistema ap√≥s as altera√ß√µes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toler√¢ncia a falhas √© a confian√ßa de que os servi√ßos s√£o projetados e implantados de forma a garantir o desempenho mais alto poss√≠vel, mesmo no caso de uma falha de alguns recursos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos entrar em detalhes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitetura de script IoT</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro de tudo, vamos ver como √© a arquitetura geral do script da IoT. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z_/po/yk/z_poykwjdwprirjgwkxmkvjnq0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Duas partes grandes podem ser distinguidas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O primeiro √© a entrega de dados para o armazenamento e a entrega de comandos para os dispositivos. </font><font style="vertical-align: inherit;">Quando voc√™ constr√≥i um sistema de IoT, essa tarefa deve ser resolvida em qualquer caso, independentemente do projeto que voc√™ faz.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O segundo est√° trabalhando com os dados recebidos. </font><font style="vertical-align: inherit;">Tudo √© semelhante a qualquer outro projeto baseado na an√°lise e visualiza√ß√£o de conjuntos de dados. </font><font style="vertical-align: inherit;">Voc√™ tem um reposit√≥rio com uma matriz inicial de informa√ß√µes, trabalhando com a qual permitir√° realizar sua tarefa.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira parte √© aproximadamente a mesma em todos os sistemas de IoT: ela √© baseada em princ√≠pios gerais e se encaixa em um cen√°rio comum adequado para a maioria dos sistemas de IoT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda parte √© quase sempre √∫nica em termos de fun√ß√µes executadas, embora seja constru√≠da sobre componentes padr√£o. Ao mesmo tempo, sem um sistema de intera√ß√£o de alta qualidade, tolerante a falhas e escal√°vel com hardware, a efic√°cia da parte anal√≠tica da arquitetura √© reduzida a quase zero, porque simplesmente n√£o h√° nada a analisar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â por isso que a equipe do Yandex.Cloud decidiu, em primeiro lugar, concentrar-se na cria√ß√£o de um ecossistema conveniente de servi√ßos que entregaria dados de maneira r√°pida, eficiente e confi√°vel, dos dispositivos aos armazenamentos, e vice-versa - enviar comandos aos dispositivos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tq/k8/ug/tqk8ugcmjnp3-s3cscc4ldhmuou.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver esses problemas, estamos trabalhando na funcionalidade e integra√ß√£o dos servi√ßos Yandex IoT Core, Yandex Functions e armazenamento de dados na nuvem: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O servi√ßo Yandex IoT Core √© um broker MQTT escalon√°vel e seguro para falhas de v√°rios inquilinos com um conjunto de fun√ß√µes √∫teis adicionais.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O servi√ßo Yandex Cloud Functions √© um representante da dire√ß√£o promissora sem servidor e permite que voc√™ execute seu c√≥digo como uma fun√ß√£o em um ambiente seguro, tolerante a falhas e escal√°vel automaticamente sem criar e manter m√°quinas virtuais.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Yandex Object Storage √© um armazenamento eficaz de grandes matrizes de dados e √© muito adequado para registros de arquivamento "hist√≥ricos".</font></font></li>
<li>          ,    ,      Yandex Managed Service for ClickHouse,     ¬´¬ª  .       ¬´¬ª      ,       ,     ,             .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se os servi√ßos de armazenamento e an√°lise de dados s√£o servi√ßos de "uso geral" j√° escritos sobre muito, o Yandex IoT Core e sua intera√ß√£o com o Yandex Cloud Functions geralmente causam muitas perguntas, especialmente para pessoas que est√£o come√ßando a entender a Internet sobre coisas e tecnologias em nuvem. </font><font style="vertical-align: inherit;">E como esses servi√ßos oferecem toler√¢ncia a falhas e redimensionamento do trabalho com dispositivos, veremos primeiro o que eles t√™m sob o cap√¥.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o Yandex IoT Core funciona</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Yandex IoT Core √© um servi√ßo de plataforma especializado para troca de dados bidirecional entre a nuvem e os dispositivos que executam o protocolo MQTT. De fato, esse protocolo se tornou o padr√£o para a transfer√™ncia de dados para a IoT. Ele usa o conceito de filas nomeadas (t√≥picos), onde, por um lado, √© poss√≠vel gravar dados e, por outro lado, receb√™-los de forma ass√≠ncrona, assinando os eventos dessa fila. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O servi√ßo Yandex IoT Core √© multilocat√°rio, o que significa uma √∫nica entidade acess√≠vel a todos os usu√°rios. Ou seja, todos os dispositivos e todos os usu√°rios interagem com a mesma inst√¢ncia de servi√ßo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso permite, por um lado, garantir uniformidade de trabalho para todos os usu√°rios, por outro lado, escala eficaz e toler√¢ncia a falhas, a fim de manter uma conex√£o com um n√∫mero ilimitado de dispositivos e processar uma quantidade ilimitada de dados em volume e velocidade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daqui resulta que o servi√ßo deve ter mecanismos de redund√¢ncia e capacidade de gerenciar de forma flex√≠vel os recursos utilizados - para responder √†s altera√ß√µes de carga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, a multiloca√ß√£o exige uma l√≥gica especial de compartilhamento de direitos de acesso aos t√≥picos do MQTT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver como isso √© implementado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como muitos outros servi√ßos Yandex.Cloud, o Yandex IoT Core √© logicamente dividido em duas partes - Plano de Controle e Plano de Dados:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8a/u0/f3/8au0f3pzmwa1v-hhsxikvo_l_0m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Data Plane √© respons√°vel pela l√≥gica de opera√ß√£o sob o protocolo MQTT e o Control Plane √© respons√°vel por delimitar os direitos de acesso a determinados t√≥picos e usa o registro e o dispositivo de entidades l√≥gicas para esse fim. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eu/b1/1n/eub11nm0nlmhprrhfqzohfwcyow.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada usu√°rio do Yandex.Cloud pode ter v√°rios registros, cada um dos quais pode conter seu pr√≥prio subconjunto de dispositivos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O acesso aos t√≥picos √© fornecido da seguinte maneira: Os </font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/wc/hd/dfwchdy-bdwxs56mkgykrcs0ia4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dispositivos podem enviar dados apenas para o t√≥pico de eventos e o evento de registro:</font></font><br>
<br>
<pre><code class="xml hljs">$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device1</span> <span class="hljs-attr">ID</span>&gt;</span>/events<font></font>
$registries/<span class="hljs-tag">&lt;<span class="hljs-name">Registry</span> <span class="hljs-attr">ID</span>&gt;</span>/events</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e assine apenas mensagens do seu t√≥pico de comandos e do t√≥pico de comandos do registro:</font></font><br>
<br>
<pre><code class="xml hljs">$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device1</span> <span class="hljs-attr">ID</span>&gt;</span>/commands<font></font>
$registries/<span class="hljs-tag">&lt;<span class="hljs-name">Registry</span> <span class="hljs-attr">ID</span>&gt;</span>/commands</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O registro pode enviar dados para todos os t√≥picos de comandos do dispositivo e para o t√≥pico de comandos do registro:</font></font><br>
<br>
<pre><code class="xml hljs">$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device1</span> <span class="hljs-attr">ID</span>&gt;</span>/commands<font></font>
$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device2</span> <span class="hljs-attr">ID</span>&gt;</span>/commands<font></font>
$registries/<span class="hljs-tag">&lt;<span class="hljs-name">Registry</span> <span class="hljs-attr">ID</span>&gt;</span>/commands</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e assine mensagens de todos os t√≥picos de eventos do dispositivo e o t√≥pico de eventos do registro:</font></font><br>
<br>
<pre><code class="xml hljs">$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device1</span> <span class="hljs-attr">ID</span>&gt;</span>/events<font></font>
$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device2</span> <span class="hljs-attr">ID</span>&gt;</span>/events<font></font>
$registries/<span class="hljs-tag">&lt;<span class="hljs-name">Registry</span> <span class="hljs-attr">ID</span>&gt;</span>/events</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para trabalhar com todas as entidades descritas acima, o Data Plane possui um protocolo gRPC e um protocolo REST, com base no qual o acesso √© implementado por meio do console da GUI do Yandex.Cloud e da interface da linha de comandos da CLI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto ao Data Plane, ele suporta o protocolo MQTT vers√£o 3.1.1. </font><font style="vertical-align: inherit;">No entanto, existem v√°rios recursos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao conectar, certifique-se de usar o TLS.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somente conex√£o TCP √© suportada. </font><font style="vertical-align: inherit;">O WebSocket ainda n√£o est√° dispon√≠vel.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A autoriza√ß√£o est√° dispon√≠vel por login e senha (em que o login √© o ID do dispositivo ou registro, e as senhas s√£o definidas pelo usu√°rio) e usando certificados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O sinalizador Reter n√£o √© suportado, ao usar o qual o broker do MQTT salva a mensagem marcada com o sinalizador e a envia na pr√≥xima vez que voc√™ assina o t√≥pico.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Sess√£o Persistente n√£o √© suportada, na qual o broker do MQTT salva informa√ß√µes sobre o cliente (dispositivo ou registro) para facilitar a reconex√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com a assinatura e publica√ß√£o, apenas os dois primeiros n√≠veis de servi√ßo s√£o suportados:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QoS0 - No m√°ximo uma vez. </font><font style="vertical-align: inherit;">N√£o h√° garantia de entrega, mas n√£o h√° devolu√ß√£o da mesma mensagem.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QoS1 - pelo menos uma vez. </font><font style="vertical-align: inherit;">A entrega √© garantida, mas h√° uma chance de receber novamente a mesma mensagem.</font></font></li>
</ol></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para simplificar a conex√£o com o Yandex IoT Core, adicionamos regularmente novos exemplos para diferentes plataformas e idiomas ao nosso reposit√≥rio no GitHub, e tamb√©m descrevemos scripts na documenta√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A arquitetura do servi√ßo √© assim: A </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6g/ig/4o/6gig4ofj7dksmbn18wvq5swkpuo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l√≥gica de neg√≥cios do servi√ßo inclui quatro partes:</font></font><br>
<br>
<ol>
<li> Device management ‚Äî     .   Control Plane.</li>
<li> MQTT Broker ‚Äî  MQTT-.  Data Plane.</li>
<li> Triggers ‚Äî     Yandex Cloud Functions.  Data Plane.</li>
<li> Shards ‚Äî      MQTT-    .  Data Plane.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toda intera√ß√£o com o "mundo exterior" passa por balanceadores de carga. Al√©m disso, de acordo com a filosofia de alimenta√ß√£o de c√£es, o Yandex Load Balancer √© usado, dispon√≠vel para todos os usu√°rios do Yandex.Cloud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada parte da l√≥gica de neg√≥cios consiste em v√°rios conjuntos de tr√™s m√°quinas virtuais - uma em cada zona de disponibilidade (nos Esquemas A, B e C). M√°quinas virtuais s√£o exatamente iguais a todos os usu√°rios do Yandex.Cloud. Quando a carga aumenta, o dimensionamento ocorre com a ajuda de todo o conjunto - tr√™s m√°quinas s√£o adicionadas ao mesmo tempo na estrutura de uma parte da l√≥gica de neg√≥cios. Isso significa que, se um conjunto de tr√™s m√°quinas MQTT Broker n√£o puder manipular a carga, outro conjunto de tr√™s m√°quinas MQTT Broker ser√° inclu√≠do, enquanto a configura√ß√£o de outras partes da l√≥gica de neg√≥cios permanecer√° a mesma.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E apenas o Logbroker n√£o est√° dispon√≠vel ao p√∫blico. √â um servi√ßo para opera√ß√£o eficiente e √† prova de falhas com fluxos de dados. Ele √© baseado no Apache Kafka, mas possui muitas outras fun√ß√µes √∫teis: implementa processos de recupera√ß√£o de desastres (incluindo exatamente a sem√¢ntica √∫nica quando voc√™ tem uma garantia de entrega de mensagens sem duplica√ß√£o) e processos de servi√ßo (como replica√ß√£o entre centros, distribui√ß√£o de dados para clusters de c√°lculo) e tamb√©m possui um mecanismo para distribui√ß√£o uniforme e n√£o duplicada de dados entre os assinantes de fluxo - uma esp√©cie de balanceador de carga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os recursos de gerenciamento de dispositivos no Plano de controle est√£o descritos acima. Mas com o Data Plane, tudo √© muito mais interessante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada inst√¢ncia do MQTT Broker funciona independentemente e n√£o sabe nada sobre outras inst√¢ncias. Todos os dados recebidos (publica√ß√£o dos clientes) s√£o enviados pelos corretores para a Logbroker, de onde s√£o coletados pelos Shards and Triggers. E √© nos shards que a sincroniza√ß√£o ocorre entre inst√¢ncias de corretores. Os shards conhecem todos os clientes MQTT e a distribui√ß√£o de suas assinaturas (assinatura) entre inst√¢ncias de intermedi√°rios MQTT e determinam para onde enviar os dados recebidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, o cliente MQTT A √© inscrito no t√≥pico do intermedi√°rio A e o cliente MQTT B √© inscrito no mesmo t√≥pico do intermedi√°rio B. Se o cliente MQTT C publica no mesmo t√≥pico, mas no intermedi√°rio C, o shard transfere dados de intermedi√°rio C para os corretores A e B, como resultado dos quais os dados ser√£o recebidos pelos clientes MQTT A e MQTT B.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ia/dv/dz/iadvdzgd2cs6o1r3stjkqfhsq6y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A √∫ltima parte da l√≥gica de neg√≥cios, Triggers, tamb√©m recebe todos os dados recebidos dos clientes MQTT e, se isso estiver configurado pelo usu√°rio, transfere-os para os acionadores do servi√ßo Yandex Cloud Functions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, o Yandex IoT Core possui uma arquitetura e l√≥gica de trabalho bastante complicadas, dif√≠ceis de repetir em instala√ß√µes locais. </font><font style="vertical-align: inherit;">Isso permite que ele resista √† perda de at√© duas das tr√™s zonas de disponibilidade e elabore um n√∫mero ilimitado de conex√µes e volumes de dados ilimitados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, toda essa l√≥gica est√° oculta do usu√°rio "por baixo do cap√¥", mas do lado de fora tudo parece muito simples - como se voc√™ estivesse trabalhando com um √∫nico broker MQTT.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acionadores e fun√ß√µes da nuvem Yandex</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Yandex Cloud Functions √© um representante dos servi√ßos "sem servidor" (sem servidor) no Yandex.Cloud. A principal ess√™ncia desses servi√ßos √© que o usu√°rio n√£o gasta seu tempo configurando, implantando e dimensionando o ambiente para executar c√≥digo, mas apenas lida com a coisa mais valiosa para ele - escrever o pr√≥prio c√≥digo que executa a tarefa necess√°ria. No caso de fun√ß√µes, esse √© o chamado c√≥digo sem estado at√¥mico que pode ser acionado por algum evento. "At√¥mico" e "sem estado" significam que esse c√≥digo deve executar uma tarefa relativamente pequena, mas integral, enquanto o c√≥digo n√£o deve usar nenhuma vari√°vel para armazenar valores entre as chamadas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem v√°rias maneiras de chamar fun√ß√µes: uma chamada HTTP direta, uma chamada de timer (cron) ou uma assinatura de evento. Como o √∫ltimo, o servi√ßo j√° suporta a inscri√ß√£o em filas de mensagens (fila de mensagens Yandex), eventos gerados pelo servi√ßo de armazenamento de objetos e (mais valioso para o cen√°rio da IoT) a assinatura de mensagens no Yandex IoT Core.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar de voc√™ poder trabalhar com o Yandex IoT Core usando qualquer cliente compat√≠vel com MQTT, o Yandex Cloud Functions √© uma das maneiras mais √≥timas e convenientes de receber e processar dados. A raz√£o para isso √© muito simples. Uma fun√ß√£o pode ser chamada em todas as mensagens recebidas de qualquer dispositivo, e as fun√ß√µes ser√£o executadas paralelamente umas √†s outras (devido √† atomicidade e √† abordagem sem estado), e o n√∫mero de suas chamadas mudar√° naturalmente √† medida que o n√∫mero de mensagens recebidas dos dispositivos for alterado. Assim, o usu√°rio pode ignorar completamente os problemas de configura√ß√£o da infraestrutura e, al√©m disso, diferentemente das mesmas m√°quinas virtuais, o pagamento ocorrer√° apenas pelo trabalho realmente executado.Isso permitir√° que voc√™ economize significativamente em baixa carga e obtenha um custo claro e previs√≠vel com o crescimento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mecanismo para chamar fun√ß√µes em eventos (assinar eventos) √© chamado de gatilho (Trigger). Sua ess√™ncia est√° representada no diagrama: Um </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5u/yv/bn/5uyvbnyviueygxt4ykzdh9n2nug.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
servi√ßo que gera eventos para chamar fun√ß√µes os coloca em uma fila no Logbroker. No caso do Yandex IoT Core, os gatilhos do Data Plane fazem isso. Al√©m disso, esses eventos s√£o realizados pelo pr√©-processador, que est√° procurando um registro no banco de dados para esse evento, indicando a fun√ß√£o a ser chamada. Se uma entrada desse tipo for encontrada, o pr√©-processador coloca as informa√ß√µes sobre a chamada de fun√ß√£o (ID da fun√ß√£o e par√¢metros de chamada) na fila no servi√ßo Fila de Mensagens Yandex, de onde o manipulador de chamadas as coleta. O manipulador, por sua vez, envia uma solicita√ß√£o HTTP para chamar a fun√ß√£o para o servi√ßo Yandex Cloud Functions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao mesmo tempo, novamente, de acordo com a filosofia dogfooding, o servi√ßo Yandex Message Queue, acess√≠vel a todos os usu√°rios, √© usado e as fun√ß√µes s√£o chamadas exatamente da mesma maneira que qualquer outro usu√°rio pode chamar suas fun√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Digamos algumas palavras sobre a fila de mensagens Yandex. Apesar de esse, como o Logbroker, ser um servi√ßo de fila, h√° uma diferen√ßa significativa entre eles. Ao processar mensagens de filas, o manipulador informa a fila que terminou e a mensagem pode ser exclu√≠da. Esse √© um importante mecanismo de confiabilidade em tais servi√ßos, mas complica a l√≥gica de trabalhar com mensagens.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Fila de mensagens Yandex permite "paralelizar" o processamento de cada mensagem na fila. Em outras palavras, a mensagem da fila que est√° sendo processada atualmente n√£o bloqueia a possibilidade de outro "encadeamento" pegar o pr√≥ximo evento da fila para processamento. Isso √© chamado simultaneidade no n√≠vel da mensagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o LogBroker opera em grupos de mensagens e, at√© que todo o grupo seja processado, o pr√≥ximo grupo n√£o poder√° ser escolhido para processamento. Essa abordagem √© chamada simultaneidade no n√≠vel da parti√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E √© precisamente o uso da fila de mensagens Yandex que permite processar de forma r√°pida e eficiente em paralelo muitas solicita√ß√µes para chamar uma fun√ß√£o para eventos de um servi√ßo espec√≠fico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar de os acionadores serem uma unidade independente separada, eles fazem parte do servi√ßo Yandex Cloud Functions. N√≥s apenas temos que descobrir exatamente como as fun√ß√µes s√£o chamadas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fb/ew/ke/fbewkedbrp6eyri7zkubwiu6dzu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas as solicita√ß√µes para chamar fun√ß√µes (externas e internas) se enquadram no balanceador de carga, que as distribui para roteadores em diferentes zonas de acesso (AZ), v√°rias partes s√£o implantadas em cada zona. Ao receber uma solicita√ß√£o, o roteador vai primeiro ao servi√ßo Gerenciador de Identidade e Acesso (IAM) para garantir que a origem da solicita√ß√£o tenha direitos para chamar essa fun√ß√£o. Ele ent√£o vira para o agendador e pergunta em qual trabalhador executar a fun√ß√£o. Worker √© uma m√°quina virtual com um tempo de execu√ß√£o personalizado de fun√ß√µes isoladas. Al√©m disso, o roteador, tendo recebido do agendador o endere√ßo do trabalhador no qual executar a fun√ß√£o, envia um comando para esse trabalhador para iniciar a fun√ß√£o com determinados par√¢metros.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De onde vem o trabalhador? √â aqui que toda a magia sem servidor acontece. Agendadores, analisando a carga (o n√∫mero e a dura√ß√£o das fun√ß√µes), gerenciam (iniciam e param) m√°quinas virtuais com um tempo de execu√ß√£o espec√≠fico. NodeJS e Python agora s√£o suportados. E aqui um par√¢metro √© extremamente importante - a velocidade das fun√ß√µes de inicializa√ß√£o. A equipe de desenvolvimento de servi√ßos fez um √≥timo trabalho e agora a m√°quina virtual inicia no m√°ximo 250 ms, enquanto usa o ambiente mais seguro para isolar fun√ß√µes uma da outra - a virtualiza√ß√£o QEMU, que executa todo o Yandex. Ao mesmo tempo, se j√° houver um trabalhador ativo para a solicita√ß√£o recebida, a fun√ß√£o ser√° iniciada quase instantaneamente.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, de acordo com a mesma abordagem de dogfooding, o Load Balancer usa um servi√ßo p√∫blico acess√≠vel a todos os usu√°rios, e o trabalhador, o planejador e o roteador s√£o m√°quinas virtuais comuns, iguais a todos os usu√°rios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, a toler√¢ncia a falhas do servi√ßo √© implementada no n√≠vel do balanceador de carga e redund√¢ncia dos principais componentes do sistema (roteador e planejador), e o dimensionamento ocorre devido √† implanta√ß√£o ou redu√ß√£o do n√∫mero de trabalhadores. </font><font style="vertical-align: inherit;">Al√©m disso, cada zona de acessibilidade funciona de forma independente, o que permite sobreviver √† perda de at√© duas das tr√™s zonas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links √öteis</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Concluindo, desejo fornecer alguns links que permitir√£o estudar os servi√ßos com mais detalhes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫cleo de IoT do Yandex: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud.yandex.ru/services/iot-core</font></font></a> </li>
<li> Yandex Cloud Functions: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cloud.yandex.ru/services/functions</a> </li>
<li> Yandex Message Queue: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cloud.yandex.ru/services/message-queue</a> </li>
<li> Yandex Managed Service for ClickHouse: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cloud.yandex.ru/services/managed-clickhouse</a> </li>
<li> Yandex Load Balancer: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cloud.yandex.ru/services/load-balancer</a> </li>
<li> Yandex Object Storage: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cloud.yandex.ru/services/storage</a> </li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt491724/index.html">O livro "Laravel. Guia completo. 2¬™ edi√ß√£o</a></li>
<li><a href="../pt491726/index.html">Expandir colunas aninhadas - listas usando a linguagem R (pacote tidyr e fun√ß√µes da fam√≠lia unnest)</a></li>
<li><a href="../pt491728/index.html">Princ√≠pio DRY com o Laravel</a></li>
<li><a href="../pt491732/index.html">Existe vida ap√≥s o Scratch ou como introduzir uma crian√ßa no Python</a></li>
<li><a href="../pt491736/index.html">TMS1000: o primeiro microcontrolador dispon√≠vel comercialmente</a></li>
<li><a href="../pt491742/index.html">Sherbet: teclado ergon√¥mico para jogos</a></li>
<li><a href="../pt491744/index.html">Hackers iranianos exploraram vulnerabilidades na VPN</a></li>
<li><a href="../pt491746/index.html">A hist√≥ria da s√≠ntese da fala: a era das solu√ß√µes el√©tricas</a></li>
<li><a href="../pt491748/index.html">Tecnologias que ajudam os cegos a aprender ingl√™s</a></li>
<li><a href="../pt491750/index.html">Escrevemos melhor a pesquisa por substring do que nos livros did√°ticos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>