<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌉 🎼 🎒 Loki - mengumpulkan log menggunakan pendekatan Prometheus 🌓 📸 🧖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, orang Khabrovit! Untuk mengantisipasi dimulainya set baru untuk kursus Praktek dan Alat DevOps, kami telah menyiapkan untuk Anda terjemahan mat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Loki - mengumpulkan log menggunakan pendekatan Prometheus</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/487118/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salut, orang Khabrovit! </font><font style="vertical-align: inherit;">Untuk mengantisipasi dimulainya set baru untuk kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Praktek dan Alat DevOps, kami telah</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menyiapkan untuk Anda terjemahan materi yang menarik.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/rb/vv/kv/rbvvkvqoi8amlv_ndkojxwj283q.png"><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini adalah pengantar singkat untuk Loki. </font><font style="vertical-align: inherit;">Proyek Loki </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">didukung oleh Grafana</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan bertujuan untuk mengumpulkan kayu secara terpusat (dari server atau wadah). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sumber utama inspirasi untuk Loki adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan gagasan untuk menerapkan pendekatan manajemen log:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">penggunaan label (label) untuk penyimpanan data</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">konsumsi sumber daya yang rendah</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan kembali ke prinsip-prinsip Prometheus dan memberikan beberapa contoh penggunaannya dalam konteks Kubernetes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa kata tentang Prometheus </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk sepenuhnya memahami cara kerja Loki, penting untuk mundur sedikit dan mengingat Prometheus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu fitur yang membedakan Prometheus adalah ekstraksi metrik dari titik pengumpulan (melalui eksportir) dan menyimpannya dalam TSDB (Basis Data Time Series, basis data time series) dengan penambahan metadata dalam bentuk label.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa itu perlu?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baru-baru ini, Prometheus telah menjadi standar de facto di dunia kontainer dan Kubernetes: pemasangannya sangat sederhana, dan kluster Kubernetes awalnya memiliki titik akhir untuk Prometheus. </font><font style="vertical-align: inherit;">Prometheus juga dapat mengambil metrik dari aplikasi yang digunakan dalam wadah, sambil mempertahankan tag tertentu. </font><font style="vertical-align: inherit;">Karena itu, aplikasi pemantauan sangat mudah diimplementasikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, masih belum ada solusi turnkey untuk mengelola log, dan Anda harus menemukan solusi sendiri:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">layanan cloud yang dikelola untuk memusatkan log (AWS, Azure atau Google)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pemantauan sebagai layanan pemantauan layanan (misalnya, Datadog)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">membuat layanan pengumpulan log Anda sendiri.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk opsi ketiga, saya secara tradisional menggunakan Elasticsearch, meskipun pada kenyataannya saya tidak selalu senang dengan itu (terutama tingkat keparahan dan kompleksitas pengaturan). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Loki dirancang untuk menyederhanakan implementasi sesuai dengan prinsip-prinsip berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mudah untuk memulai</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengkonsumsi sedikit sumber daya</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bekerja secara mandiri tanpa perawatan khusus</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melengkapi Prometheus untuk membantu menyelidiki bug</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, kesederhanaan ini dicapai melalui beberapa kompromi. </font><font style="vertical-align: inherit;">Salah satunya adalah tidak mengindeks konten. </font><font style="vertical-align: inherit;">Oleh karena itu, pencarian teks tidak terlalu efektif atau kaya dan tidak memungkinkan statistik pada konten teks. </font><font style="vertical-align: inherit;">Tetapi karena Loki ingin menjadi setara dengan grep dan melengkapi Prometheus, ini bukan cacat.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Investigasi insiden</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk lebih memahami mengapa Loki tidak perlu pengindeksan, mari kembali ke metode investigasi insiden yang digunakan oleh pengembang Loki: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9x/sp/rn/9xsprnklb6bomy1xmhkegiywwpw.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 Peringatan → 2 Dashboard → 3 Adhoc Query → 4 Log Agregasi → 5 Tracing Terdistribusi → 6 Fix! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(1 Peringatan → 2 Dasbor → 3 Permintaan Adhoc → 4 Agregasi Log → 5 Pelacakan Terdistribusi → 6 Mengoreksi!)</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Idenya adalah bahwa kita mendapatkan beberapa peringatan (Pemberitahuan Slack, SMS, dll.) Dan setelah itu:</font></font><br>
<br>
<ul>
<li>  Grafana</li>
<li>   (,  Prometheus)</li>
<li>   (,  Elasticsearch)</li>
<li>,     (Jaeger, Zipkin  .)</li>
<li>, ,   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, dalam kasus tumpukan Grafana + Prometheus + Elasticsearch + Zipkin, Anda harus menggunakan empat alat yang berbeda. </font><font style="vertical-align: inherit;">Untuk mengurangi waktu, alangkah baiknya bisa melakukan semua langkah ini dengan satu alat: Grafana. </font><font style="vertical-align: inherit;">Perlu dicatat bahwa pendekatan penelitian ini telah diterapkan di Grafana sejak versi 6. Dengan demikian, menjadi mungkin untuk mengakses data Prometheus langsung dari Grafana. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r4/ur/bg/r4urbgqrnkgms5wiga5jvbvw4li.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemisahan layar Explorer antara Prometheus dan Loki</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pada layar ini, Anda dapat melihat log Loki yang terkait dengan metrik Prometheus menggunakan konsep layar terbagi. </font><font style="vertical-align: inherit;">Dimulai dengan versi 6.5, Grafana memungkinkan Anda untuk memproses id jejak dalam entri log Loki untuk mengikuti tautan ke alat pelacak terdistribusi favorit Anda (Jaeger).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tes Lokal Loki</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara termudah untuk menguji Loki secara lokal adalah dengan menggunakan komposisi buruh pelabuhan. </font><font style="vertical-align: inherit;">File docker-compose ada di repositori Loki. </font><font style="vertical-align: inherit;">Anda bisa mendapatkan repositori menggunakan perintah berikut </font></font><code>git</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs">$ git clone https:<span class="hljs-comment">//github.com/grafana/loki.git</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maka Anda harus pergi ke direktori produksi:</font></font><br>
<br>
<pre><code class="go hljs">$ cd production</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, Anda bisa mendapatkan gambar Docker versi terbaru:</font></font><br>
<br>
<pre><code class="go hljs">$ docker-compose pull</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, tumpukan Loki diluncurkan dengan perintah berikut:</font></font><br>
<br>
<pre><code class="go hljs">$ docker-compose up</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsitektur Loki</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah diagram kecil dengan arsitektur Loki: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7z/-5/hd/7z-5hd6ycmdocdvzsrcmwjydsbs.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prinsip-prinsip arsitektur Loki</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Klien web meluncurkan aplikasi di server, Promtail mengumpulkan log dan mengirimkannya ke Loki, klien web juga mengirim metadata ke Loki. </font><font style="vertical-align: inherit;">Loki mengumpulkan semuanya dan mentransfernya ke Grafana. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Loki bangkit dan berjalan. </font><font style="vertical-align: inherit;">Untuk melihat komponen yang tersedia, jalankan perintah berikut:</font></font><br>
<br>
<pre><code class="go hljs">$ docker ps</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus Docker yang baru diinstal, perintah harus mengembalikan hasil berikut:</font></font><br>
<br>
<pre><code class="go hljs">IMAGE               PORTS                  NAMES<font></font>
grafana/promtail:                          production_promtail_1<font></font>
grafana/grafana: m  <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">3000</span>-&gt;<span class="hljs-number">3000</span>/tcp production_grafana_1<font></font>
grafana/loki: late  <span class="hljs-number">80</span>/tcp,<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">3100.</span>.. production_loki_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat komponen-komponen berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promtail: agen untuk memusatkan log</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana: Alat Dashboard Terkenal </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Loki: daemon sentralisasi data</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kerangka infrastruktur klasik (misalnya, berdasarkan pada mesin virtual), agen Promtail harus digunakan pada setiap mesin. </font><font style="vertical-align: inherit;">Grafana dan Loki dapat diinstal pada mesin yang sama.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyebaran Kubernetes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menginstal komponen Loki di Kubernetes adalah sebagai berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">daemonSet untuk menggunakan agen Promtail di setiap mesin di server cluster</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penempatan Loki</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan terakhir, penyebaran Grafana.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untungnya, Loki tersedia sebagai paket Helm, sehingga mudah digunakan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalasi melalui Helm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Helm harus sudah dipasang. </font><font style="vertical-align: inherit;">Itu dapat diunduh dari repositori GitHub proyek. </font><font style="vertical-align: inherit;">Itu diinstal dengan membongkar arsip yang sesuai dengan arsitektur Anda dan menambahkan helm ke </font></font><code>$PATH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<blockquote><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Helm versi 3.0.0 baru-baru ini dirilis. </font><font style="vertical-align: inherit;">Karena ada banyak perubahan di dalamnya, pembaca disarankan untuk menunggu sebentar sebelum menggunakannya terlebih dahulu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menambahkan sumber untuk Helm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah pertama adalah menambahkan repositori “loki” dengan perintah berikut:</font></font><br>
<br>
<pre><code class="go hljs">$ helm add loki https:<span class="hljs-comment">//grafana.github.io/loki/charts</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, Anda dapat mencari paket yang bernama "loki":</font></font><br>
<br>
<pre><code class="go hljs">$ helm search loki</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil:</font></font><br>
<br>
<pre><code class="go hljs">loki/loki       <span class="hljs-number">0.17</span><span class="hljs-number">.2</span> v0<span class="hljs-number">.4</span><span class="hljs-number">.0</span> Loki: like Prometheus, but <span class="hljs-keyword">for</span> logs.<font></font>
loki/loki-stack <span class="hljs-number">0.19</span><span class="hljs-number">.1</span> v0<span class="hljs-number">.4</span><span class="hljs-number">.0</span> Loki: like Prometheus, but <span class="hljs-keyword">for</span> logs.<font></font>
loki/fluent-bit <span class="hljs-number">0.0</span><span class="hljs-number">.2</span>  v0<span class="hljs-number">.0</span><span class="hljs-number">.1</span> Uses fluent-bit Loki <span class="hljs-keyword">go</span> plugin <span class="hljs-keyword">for</span>...<font></font>
loki/promtail   <span class="hljs-number">0.13</span><span class="hljs-number">.1</span> v0<span class="hljs-number">.4</span><span class="hljs-number">.0</span> Responsible <span class="hljs-keyword">for</span> gathering logs and...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paket-paket ini memiliki fitur-fitur berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paket </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loki / loki</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hanya cocok dengan server Loki</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loki / fasih-bit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paket </font><font style="vertical-align: inherit;">memungkinkan Anda untuk menggunakan DaemonSet menggunakan fasih-bin untuk log mengumpulkan bukannya Promtail</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paket </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loki / promtail</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berisi file log agen pengumpulan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paket </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loki / loki-stack</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memungkinkan Anda untuk segera menggunakan Loki bersama dengan Promtail.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalasi Loki</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menggunakan Loki ke Kubernetes, jalankan perintah berikut di namespace "pemantauan":</font></font><br>
<br>
<pre><code class="go hljs">$ helm upgrade --install loki loki/loki-stack --namespace monitoring</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menyimpan ke disk, tambahkan opsi </font></font><code>--set loki.persistence.enabled = true:</code><br>
<br>
<pre><code class="go hljs">$ helm upgrade --install loki loki/loki-stack \<font></font>
              --namespace monitoring \<font></font>
              --set loki.persistence.enabled=<span class="hljs-literal">true</span></code></pre><br>
<blockquote><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jika Anda ingin menggunakan Grafana secara bersamaan, tambahkan parameter</font></font><code>--set grafana.enabled = true</code></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika Anda menjalankan perintah ini, Anda harus mendapatkan output berikut:</font></font><br>
<br>
<pre><code class="go hljs">LAST DEPLOYED: Tue Nov <span class="hljs-number">19</span> <span class="hljs-number">15</span>:<span class="hljs-number">56</span>:<span class="hljs-number">54</span> <span class="hljs-number">2019</span><font></font>
NAMESPACE: monitoring<font></font>
STATUS: DEPLOYED<font></font>
RESOURCES:<font></font>
==&gt; v1/ClusterRole<font></font>
NAME AGE<font></font>
loki-promtail-clusterrole <span class="hljs-number">189</span>d<font></font>
…<font></font>
NOTES:<font></font>
The Loki stack has been deployed to your cluster. Loki can now be added as a datasource in Grafana.<font></font>
See &lt;a href=<span class="hljs-string">"http://docs.grafana.org/features/datasources/loki/"</span>&gt;http:<span class="hljs-comment">//docs.grafana.org/features/datasources/loki/&lt;/a&gt; for more details.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melihat status perapian di namespace "pemantauan", kita akan melihat bahwa semuanya diperluas:</font></font><br>
<br>
<pre><code class="go hljs">$ kubectl -n monitoring get pods -l release=loki</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil:</font></font><br>
<br>
<pre><code class="go hljs">NAME                 READY  STATUS   RESTARTS  AGE<font></font>
loki<span class="hljs-number">-0</span>               <span class="hljs-number">1</span>/<span class="hljs-number">1</span>    Running  <span class="hljs-number">0</span>         <span class="hljs-number">147</span>m<font></font>
loki-promtail<span class="hljs-number">-9</span>zjvc  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>    Running  <span class="hljs-number">0</span>         <span class="hljs-number">3</span>h25m<font></font>
loki-promtail-f6brf  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>    Running  <span class="hljs-number">0</span>         <span class="hljs-number">11</span>h<font></font>
loki-promtail-hdcj7  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>    Running  <span class="hljs-number">0</span>         <span class="hljs-number">3</span>h23m<font></font>
loki-promtail-jbqhc  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>    Running  <span class="hljs-number">0</span>         <span class="hljs-number">11</span>h<font></font>
loki-promtail-mj642  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>    Running  <span class="hljs-number">0</span>         <span class="hljs-number">62</span>m<font></font>
loki-promtail-nm64g  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>    Running  <span class="hljs-number">0</span>         <span class="hljs-number">24</span>m</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua pod sedang berjalan. </font><font style="vertical-align: inherit;">Sekarang saatnya untuk melakukan beberapa tes!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terhubung ke Grafana </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk terhubung ke Grafana di bawah Kubernetes, Anda perlu membuka terowongan ke dasarnya. </font><font style="vertical-align: inherit;">Berikut ini adalah perintah untuk membuka port 3000 untuk perapian Grafana:</font></font><br>
<br>
<pre><code class="go hljs">$ kubectl -n port-forward monitoring svc/loki-grafana <span class="hljs-number">3000</span>:<span class="hljs-number">80</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Poin penting lainnya adalah perlunya memulihkan kata sandi administrator Grafana. </font><font style="vertical-align: inherit;">Kata sandi dirahasiakan </font></font><code>loki-grafana</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam bidang </font></font><code>.data.admin-user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam format base64. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengembalikannya, Anda harus menjalankan perintah berikut:</font></font><br>
<br>
<pre><code class="go hljs">$ kubectl -n monitoring get secret loki-grafana \<font></font>
 --template <span class="hljs-string">'{{index .data "admin-password" | base64decode}}'</span>; echo</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gunakan kata sandi ini dengan akun administrator default (admin).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menentukan sumber data Loki di Grafana </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, pastikan sumber data Loki (Konfigurasi / Sumber Data) dibuat. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini sebuah contoh: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zu/0r/e6/zu0re6d6tzo5izslpttqpeaglz4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh pengaturan sumber data untuk Loki</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dengan mengklik "Tes" Anda dapat memeriksa koneksi dengan Loki.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat permintaan ke Loki</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang pergi ke bagian "Jelajahi" Grafana. </font><font style="vertical-align: inherit;">Saat menerima log dari kontainer, Loki menambahkan metadata dari Kubernetes. </font><font style="vertical-align: inherit;">Dengan demikian, menjadi mungkin untuk melihat log dari wadah tertentu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
: Misalnya, promtail kueri berikut digunakan untuk memilih log kontainer </font></font><code>{container_name = "promtail"}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga, pastikan untuk memilih sumber data Loki Anda di sini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permintaan ini akan mengembalikan aktivitas kontainer sebagai berikut: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/jh/0h/hcjh0htns_lqzhmwmtd01wa4-5k.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil permintaan di Grafana</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menambahkan ke dasbor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimulai dengan Grafana 6.4, Anda dapat menaruh informasi tentang log langsung di dasbor. </font><font style="vertical-align: inherit;">Setelah itu, pengguna akan dapat dengan cepat beralih di antara jumlah permintaan di situsnya ke jejak aplikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah contoh dari dasbor yang mengimplementasikan interaksi ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ac/xo/0w/acxo0wom7hyf0bfne2xtc2lyt6a.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh dasbor dengan metrik Prometheus dan log Loki</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Loki masa depan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mulai menggunakan Loki kembali pada bulan Mei / Juni dengan versi 0.1. Hari ini versi 1 sudah dirilis, dan bahkan 1.1 dan 1.2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memang, versi 0,1 tidak cukup stabil. Tapi 0,3 sudah menunjukkan tanda-tanda nyata kedewasaan, dan versi berikutnya (0,4, kemudian 1,0) hanya memperkuat kesan ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah 1.0.0, tidak ada yang bisa memiliki alasan untuk tidak menggunakan alat luar biasa ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perbaikan lebih lanjut seharusnya tidak menjadi perhatian Loki, melainkan integrasi dengan Grafana yang sangat baik. Faktanya, Grafana 6.4 sudah memiliki integrasi yang baik dengan dashboard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grafana 6.5, yang dirilis baru-baru ini, semakin meningkatkan integrasi ini dengan secara otomatis mengenali isi log dalam format JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Video berikut menunjukkan contoh kecil dari mekanisme ini:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/de/hk/vi/dehkvinzf3xh6ed6yud7ptt4aye.gif"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan Loki Strings Ditampilkan di Grafana</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Menjadi mungkin untuk menggunakan salah satu bidang JSON, misalnya, untuk:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan alat eksternal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memfilter konten log</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, Anda dapat mengklik traceId untuk membuka Zipkin atau Jaeger. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara tradisional, kami menunggu komentar Anda dan kami mengundang Anda ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">webinar terbuka</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di mana kami akan berbicara tentang bagaimana industri DevOps dikembangkan selama 2019 dan membahas kemungkinan jalur pengembangan untuk tahun 2020.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id487106/index.html">Penganalisa PVS-Studio RunUO memeriksa</a></li>
<li><a href="../id487108/index.html">Profil Gamer Seluler: Penelitian MyTracker</a></li>
<li><a href="../id487110/index.html">BURUK SRE. Eksperimen lengkap dengan pakar dari Booking.com dan Google.com</a></li>
<li><a href="../id487112/index.html">Edge of Madness: Lingkaran Dasar</a></li>
<li><a href="../id487116/index.html">Mengapa Perselisihan Bermigrasi dari Pergi ke Karat</a></li>
<li><a href="../id487120/index.html">Bagaimana cara mendistribusikan anak kucing</a></li>
<li><a href="../id487122/index.html">Terjemahan Panduan Gaya Google JavaScript</a></li>
<li><a href="../id487124/index.html">Wawancara dengan Borey Yangel tentang drive mandiri Yandex dan kisah penciptaan Alice</a></li>
<li><a href="../id487126/index.html">Bagaimana tim pengembangan perusahaan menggunakan GitLab dan Mattermost ChatOps untuk mempercepat pengembangan</a></li>
<li><a href="../id487132/index.html">Bagaimana kami memindahkan ke SAAS tim yang terdiri dari beberapa ratus orang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>