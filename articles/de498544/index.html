<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👧🏼 😢 👨🏽‍🔧 Red Team Tactics: Fortgeschrittene Prozessüberwachungstechniken in offensiven Operationen 👨🏾‍🤝‍👨🏽 😪 🕴🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo wieder. Am Vorabend des Pentest. Penetrationstestpraxis “hat ein weiteres interessantes Material für Sie übersetzt.
 
 
 
 In diesem Artikel wer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Red Team Tactics: Fortgeschrittene Prozessüberwachungstechniken in offensiven Operationen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/498544/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo wieder. </font><font style="vertical-align: inherit;">Am Vorabend des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pentest. </font><font style="vertical-align: inherit;">Penetrationstestpraxis “hat ein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> weiteres interessantes Material für Sie übersetzt.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/av/qe/wo/avqewourhsmerqakgy0q9hqbk-e.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werden wir die Funktionen bekannter Dienstprogramme zur Prozessüberwachung verstehen und zeigen, wie die diesen Tools zugrunde liegende Technologie für offensive Operationen des Roten Teams verwendet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein gutes technisches Verständnis des Systems, auf das wir uns verlassen, ist ein Schlüsselkriterium für Entscheidungen über den nächsten Schritt des Vorgangs. Die Erfassung und Analyse von Daten zur Ausführung von Prozessen in gefährdeten Systemen liefert uns eine Fülle von Informationen und hilft uns zu verstehen, wie die IT-Infrastruktur der Zielorganisation funktioniert. Darüber hinaus helfen uns regelmäßig angeforderte Prozessdaten, auf Umweltveränderungen zu reagieren und Triggersignale zu empfangen, wenn eine Untersuchung beginnt.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um detaillierte Daten zu Prozessen an gefährdeten Endpunkten erfassen zu können, haben wir eine Reihe von Tools erstellt, die die Leistungsfähigkeit fortschrittlicher Prozessdienstprogramme und C2-Frameworks (wie Cobalt Strike) zusammenführen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tools (und deren Quellcode) finden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows-Dienstprogramme für interne Systeme</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst werden wir herausfinden, mit welchen Dienstprogrammen Informationen zu Computerprozessen unter Windows erfasst werden können. </font><font style="vertical-align: inherit;">Anschließend erfahren wir, wie diese Dienstprogramme Informationen sammeln, damit sie später in Red Team-Toolkits verwendet werden können.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Windows-Betriebssystem ist mit vielen vorgefertigten Dienstprogrammen zur Verwaltung des Systems ausgestattet. Obwohl die meisten der bereitgestellten Tools für grundlegende Systemverwaltungszwecke geeignet sind, verfügen einige von ihnen nicht über die erforderlichen Funktionen für die erweiterte Fehlerbehebung und Überwachung. Der Windows-Task-Manager gibt uns beispielsweise grundlegende Informationen zu allen im System ausgeführten Prozessen. Was ist jedoch, wenn wir detailliertere Informationen benötigen, z. B. Objektbeschreibungen, Netzwerkverbindungen oder Module, die als Teil eines bestimmten Prozesses geladen werden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um solche Informationen zu sammeln, gibt es ein erweitertes Tool. Zum Beispiel Systemdienstprogramme des </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Sysinternals-</font></a><font style="vertical-align: inherit;"> Pakets</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Als Red Team-Mitglied mit umfassender Erfahrung in der Netzwerk- und Systemadministration war ich schon immer ein großer Fan von Sysinternals. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Fehlerbehebung bei einem langsam laufenden Serversystem oder einem infizierten Clientcomputer habe ich meistens mit der Fehlerbehebung mithilfe von Tools wie Process Explorer oder Procmon begonnen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus Sicht der digitalen Forensik scheinen diese Tools auch sehr nützlich zu sein, um grundlegende dynamische Analysen von Malware-Beispielen durchzuführen und nach Artefakten in infizierten Systemen zu suchen. Warum sind diese Tools sowohl bei Systemadministratoren als auch bei Sicherheitsexperten so beliebt? Lassen Sie es uns herausfinden und einige Prozessinformationen untersuchen, die wir mit dem Prozess-Explorer-Tool erhalten können.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prozess-Explorer verwenden</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das erste, was wir beim Starten von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Explorer sehen,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist eine Liste / ein Baum aller laufenden Prozesse des Systems. </font><font style="vertical-align: inherit;">Dies gibt uns Informationen über die Namen von Prozessen, ihre Kennungen, den Kontext des Benutzers und den Grad der Integrität der Prozess- und Versionsinformationen. </font><font style="vertical-align: inherit;">Zusätzliche Informationen können auch durch entsprechende Anpassung der Spalten wiedergegeben werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/9s/fk/9d9sfkhmwl222wp8vlzcuhcw85y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir das untere Bedienfeld verwenden, können wir alle von einem bestimmten Prozess geladenen Module anzeigen oder zur Anzeige von Deskriptoren wechseln, um uns mit allen benannten Deskriptorobjekten vertraut zu machen, die vom Prozess verwendet werden:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/ss/ei/bassei2hnk4jg_kuyl2xd3maihg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Durchsuchen der Module kann hilfreich sein, wenn Sie nach schädlichen Bibliotheken suchen, die im Prozess geladen wurden, oder wenn Red Team ein aktives Sicherheitsprodukt (z. B. EDR) ist, das ein Modul für die Verbindung über eine API im Benutzermodus implementiert hat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/f0/sn/lyf0snflh_begeau_5pjbtwhtis.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Wenn Sie zur Anzeige von Deskriptoren wechseln, können Sie sich mit dem Typ und dem Namen aller im Prozess verwendeten benannten Objekte vertraut machen. Dies kann hilfreich sein, um herauszufinden, welche Dateien und Registrierungsschlüssel geöffnet sind und welche Named Pipes für die Interprozesskommunikation verwendet werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Wenn Sie auf den Prozessnamen doppelklicken, wird ein Fenster mit detaillierteren Informationen angezeigt. Schauen wir uns einige Registerkarten an, um mehr über die zusätzlichen Eigenschaften des Objekts zu erfahren: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mx/cr/k-/mxcrk-tik-hny6ailuno3pksvs4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bild</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeigt Informationen zum Binärpfad, zum Arbeitsverzeichnis und zu den Befehlszeilenoptionen an. Darüber hinaus werden Informationen zum Benutzerkontext, zum übergeordneten Prozess, zum Bildtyp (x86 oder x64) und vielem mehr angezeigt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-i/_o/bu/-i_obubvbxw47snh32g2ysmp7yg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Die Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enthält Informationen zum Ausführen von Threads im Prozess. Wenn Sie einen Stream auswählen und dann darauf klicken, zeigt die Schaltfläche "Stapel" den Aufrufstapel für diesen bestimmten Stream an. Zum Anzeigen von Threads / Aufrufen, die im Kernelmodus gestartet wurden, verwendet Process Explorer den Kerneltreiber, der installiert wird, wenn im erhöhten Modus gearbeitet wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus Sicht von DFIR sind Thread-Informationen nützlich, um Injektionen in den Speicher zu erkennen, beispielsweise wenn die Gefahr von dateifreien Viren besteht. </font><font style="vertical-align: inherit;">Daher können Streams, die nicht durch Dateien auf der Festplatte gesichert sind, verdächtiges Verhalten anzeigen. </font><font style="vertical-align: inherit;">Für weitere Informationen zu Threads und Speicher empfehle ich dringend, das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Hacker-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tool zu beachten </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/_s/0s/3w_s0sra5w6xq4_jf56lbg7czu4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Eine weitere interessante Registerkarte im Prozess-Explorer ist die Registerkarte TCP / IP. </font><font style="vertical-align: inherit;">Darauf sehen Sie alle Netzwerkverbindungen, die mit diesem Prozess verbunden sind. </font><font style="vertical-align: inherit;">Unter Angriffssicht kann dies hilfreich sein, um zu verstehen, wann eine Verbindung von einem kompromittierten System hergestellt wird. </font><font style="vertical-align: inherit;">Eine eingehende PowerShell-Remotesitzung oder RDP-Sitzung kann signalisieren, dass eine Untersuchung bereits begonnen hat.</font></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwenden Sie die für den Angriff beschriebenen Methoden</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Nachdem wir einige interessante Dinge über Prozesse und die Informationen erfahren haben, die wir mit Process Explorer über sie sammeln können, fragen Sie sich möglicherweise, wie Sie über unsere bevorzugten C2-Frameworks auf diese Informationen zugreifen können. Natürlich könnten wir PowerShell verwenden, da dies uns die Möglichkeit geben würde, eine leistungsstarke Skriptsprache und eine Windows-API zu verwenden. Heute steht PowerShell jedoch unter ständiger Aufsicht des Sicherheitsdienstes. Daher versuchen wir, diese Methode zu vermeiden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cobalt Strike können</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir den Befehl ps im Kontext von Beacons verwenden. Dieser Befehl zeigt grundlegende Informationen zum Prozess basierend auf allen im System ausgeführten Prozessen an. In Kombination mit einem Skript </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@r3dQu1nn ProcessColor</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist diese Methode wahrscheinlich die beste, um Prozessdaten abzurufen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ausgabe des Befehls </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist </font><font style="vertical-align: inherit;">nützlich, um laufende Prozesse schnell zu sortieren. Sie enthält jedoch keine detaillierten Informationen, die Ihnen helfen würden, das System besser zu verstehen. </font><font style="vertical-align: inherit;">Um detailliertere Informationen zu sammeln, haben wir eigene Dienstprogramme erstellt, um Informationen zu Prozessen zu erhalten. </font><font style="vertical-align: inherit;">Mit ihrer Hilfe können wir Informationen sammeln und anreichern, die aus kompromittierten Systemen stammen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ps Tools </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Es ist nicht einfach, die Funktionen und Informationen eines Tools wie Process Explorer zu replizieren. Zuerst müssen wir herausfinden, wie diese Tools unter der Haube (und im Benutzermodus) funktionieren, dann müssen wir verstehen, wie diese Informationen in der Konsole und nicht in der grafischen Oberfläche besser wiedergegeben werden können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Analyse des Quellcodes wurde deutlich, dass viele </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einfache</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tools zur Bereitstellung von Systeminformationen weitgehend auf der nativen </font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">NtQuerySystemInformation-</font></a></i><font style="vertical-align: inherit;"> API basieren </font><font style="vertical-align: inherit;">. Obwohl die API und die zugehörigen Strukturen nicht vollständig dokumentiert sind, können Sie mit dieser API viele Informationen über das Windows-System sammeln. Verwenden Sie also </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als Ausgangspunkt für das Sammeln von Informationen zu den im System ausgeführten Prozessen verwenden wir die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einzelner Prozesse, um detaillierte Informationen zu jedem dieser Prozesse zu sammeln. </font><font style="vertical-align: inherit;">Mit der </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQueryInformationProcess-</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API </font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">können</font></a></i><font style="vertical-align: inherit;"> wir die Struktur </font></font><code>PROCESS_BASIC_INFORMATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mithilfe des Prozessdeskriptors </font><font style="vertical-align: inherit;">lesen </font><font style="vertical-align: inherit;">und finden </font></font><code>PebBaseAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dann verwenden wir die </font></font><code>NtReadVirtualMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API, um die Struktur zu lesen </font></font><code>RTL_USER_PROCESS_PARAMETERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wodurch wir die Parameter </font></font><code>ImagePathName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und den </font></font><code>CommandLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prozess </font><font style="vertical-align: inherit;">herausfinden </font><font style="vertical-align: inherit;">können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit diesen APIs als Grundlage für unseren Code haben wir die folgenden Tools geschrieben, um Informationen zu Prozessen zu erhalten:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Zeigt eine detaillierte Liste aller auf dem System ausgeführten Prozesse an.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><i><font style="vertical-align: inherit;">Zeigt Kernelinformationen an</font></i><font style="vertical-align: inherit;"> , einschließlich geladener Treiber.</font></font></li>
<li><i>Psc</i>:        TCP-.</li>
<li><i>Psm</i>:          (    , ).</li>
<li><i>Psh</i>:         (,  ,  ).</li>
<li><i>Psw</i>:        .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Alle diese Tools sind in C als reflektierende DLLs geschrieben und können mithilfe eines C2-Frameworks wie Cobalt Strike (oder eines anderen Frameworks, das reflektierende DLL-Injektionen unterstützt) reflexiv in einen gespawnten Prozess eingebettet werden. </font><font style="vertical-align: inherit;">Für Cobalt Strike haben wir ein Aggressor-Skript hinzugefügt, mit dem Tools mithilfe des Cobalt Strike-Skript-Managers geladen werden können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns jedes spezifische Tool an, das in Cobalt Strike gestartet wurde, um die Funktionalität zu demonstrieren und zu zeigen, welche Informationen damit gesammelt werden können:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Dieses Tool zeigt eine detaillierte Liste aller auf dem System ausgeführten Prozesse. Die Ausgabe kann mit den Informationen auf dem Hauptbildschirm des Prozess-Explorers verglichen werden. Psx zeigt den Namen des Prozesses, seine ID, die übergeordnete PID, die Erstellungszeit und Informationen zu den Binärdateien des Prozesses (Architektur, Firmenname, Version usw.) an. Wie Sie sehen können, werden auch einige interessante Informationen aus dem aktiven Kernel des Systems angezeigt, z. B. die Basisadresse des Kernels, die beim Betrieb des Kernels hilfreich ist (z. B. zum Berechnen der Offsets von ROP-Gadgets). Alle diese Informationen können aus einem normalen Benutzerkontext (ohne Erhöhung der Berechtigungen) erfasst werden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ni/jt/be/nijtbefsyhpct-kkpkxpwdp4pvc.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Wenn wir über genügend Berechtigungen zum Öffnen des Prozessdeskriptors verfügen, können Sie zusätzliche Informationen lesen, z. B. den Kontext des Benutzers und die Integritätsstufe seines Tokens. </font><font style="vertical-align: inherit;">Durch Auflisten von PEB und verwandten Strukturen können Sie Informationen über den Bildpfad und die Befehlszeilenparameter abrufen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-d/hu/bm/-dhubmeevabpdhf1_-f_wpq8q9c.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Wie Sie vielleicht bemerkt haben, lesen und zeigen wir Versionsinformationen aus binären Prozessabbildern an, z. B. Firmenname und Beschreibung. </font><font style="vertical-align: inherit;">Wenn Sie den Namen des Unternehmens kennen, können Sie problemlos alle aktiven Sicherheitsprodukte im System auflisten. </font><font style="vertical-align: inherit;">Mit diesem Tool vergleichen wir die Namen von Unternehmen aller aktiven Prozesse mit einer Liste bekannter Anbieter von Sicherheitsprodukten und zeigen die Ergebnisse an:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xv/c4/nf/xvc4nflmu_fzxkgjq8wuq5zkd0m.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Dieses Tool enthält Informationen zum laufenden Kernel, einschließlich aller geladenen Treibermodule. </font><font style="vertical-align: inherit;">Wie das Psx-Tool bietet es auch eine Zusammenfassung aller geladenen Kernelmodule bekannter Sicherheitsprodukte.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/mr/ii/oemrii004bpzkatpi1solktzfvq.png"><br>
 <br>
 <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psc</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Dieses Tool verwendet dieselben Methoden zum Anzeigen von Informationen zu aktiven Prozessen wie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , außer dass nur Prozesse mit einer aktiven Netzwerkverbindung (IPv4, IPv6 TCP, RDP, ICA) angezeigt werden:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/m9/gf/su/m9gfsulxhhfcacdvaofmpmxvdpy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Mit diesem Tool können Sie detaillierte Informationen zu einem bestimmten Prozess abrufen. </font><font style="vertical-align: inherit;">Es wird eine Liste aller Module (DLLs) angezeigt, die vom Prozess und der Netzwerkverbindung verwendet werden:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/5x/wc/yu5xwczhban43kmlv5kjjg7o8v8.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psh</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Wie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jedoch anstelle der geladenen Module wird eine Liste der Prozessdeskriptoren </font><i><font style="vertical-align: inherit;">angezeigt</font></i><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-q/ok/nt/-qokntyj-1pdgaetariouoyi15a.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Das letzte wichtige </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tool </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dieses Tool zeigt eine Liste von Prozessen mit aktiven Fensterhandles an, die auf dem Desktop des Benutzers geöffnet sind, einschließlich Fenstertiteln. </font><font style="vertical-align: inherit;">Dies ist nützlich, um festzustellen, welche grafischen Anwendungsoberflächen der Benutzer öffnet, ohne Screenshots vom Desktop machen zu müssen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/ah/zg/tjahzg3ck9ed8-9of7hvv0krrl4.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anwendungsfälle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Sie fragen sich vielleicht: "Und wie hilft uns das alles bei offensiven Operationen?" </font><font style="vertical-align: inherit;">Nachdem wir Zugriff auf ein gefährdetes Asset erhalten haben, verwenden wir diese Informationen normalerweise für folgende Zwecke:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erkennen Sie Sicherheitstools für ein gefährdetes Asset. </font><font style="vertical-align: inherit;">Nicht nur nach Prozessinformationen, sondern auch nach geladenen Modulen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benutzerdefinierte Hakenmotoren erkennen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suchen Sie nach Möglichkeiten für Manöver (durch Netzwerksitzungen) und die Eskalation von Berechtigungen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem ersten Kompromiss können Sie regelmäßig ähnliche Informationen zu den Prozessen anfordern und mit der Erstellung von Triggern beginnen. </font><font style="vertical-align: inherit;">Beispielsweise geben wir diese Informationen automatisch in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RedELK ein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Anschließend können Sie Warnungen zu verdächtigen Änderungen an Prozessinformationen erstellen, z.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starten Sie ein Sicherheitsüberprüfungstool oder installieren Sie ein neues Endpunkt-Sicherheitsprodukt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eingehende Netzwerkverbindungen von der Sicherheitsabteilung über eine RDP-Sitzung oder Remote-PowerShell.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Öffnen eines Handles durch einen anderen Prozess für eines unserer schädlichen Artefakte (z. B. eine Datei, mit der die Präsenz erhalten bleibt).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel haben wir gezeigt, wie Tools wie Sysinternals Process Explorer verwendet werden können, um detaillierte Informationen zu den auf dem System ausgeführten Prozessen abzurufen, und wie diese Informationen Administratoren und Sicherheitsexperten bei der Fehlerbehebung und Überprüfung des Systems auf Sicherheitsprobleme oder helfen können Performance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieselben Informationen sind auch für Red Team relevant und nützlich, die während des Betriebs Zugriff auf gefährdete Systeme haben. Es hilft, das System und die IT-Infrastruktur Ihres Ziels besser zu verstehen, und die regelmäßige Befragung eines solchen Systems ermöglicht es dem Roten Team, auf mögliche Änderungen in der Umgebung (z. B. einen Auslöser für Ermittlungen) zu reagieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben einige der Funktionen von Tools wie Process Explorer repliziert, damit wir dieselben Informationen bei anstößigen Vorgängen verwenden können. </font><font style="vertical-align: inherit;">Zu diesem Zweck wurden mehrere Tools zur Prozessüberwachung erstellt, die als Teil des C2-Frameworks verwendet werden können, z. B. Cobalt Strike. </font><font style="vertical-align: inherit;">Wir haben gezeigt, wie Sie diese Tools verwenden und welche Informationen Sie zum Sammeln verwenden können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Tools sind auf unserer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub-Seite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verfügbar </font><font style="vertical-align: inherit;">und können als Teil von Cobalt Strike verwendet werden.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfahren Sie mehr über den Kurs.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de498534/index.html">Anerkennung von Dokumenten und Personen: eine Gewerkschaft im Namen der Freiheit oder ein Schritt in Richtung einer digitalen Diktatur?</a></li>
<li><a href="../de498536/index.html">Wie kann man Code mit Symfony 5-Bundles wiederverwenden? Teil 2. Wir nehmen den Code im Bundle heraus</a></li>
<li><a href="../de498538/index.html">Meine schöne Kröte</a></li>
<li><a href="../de498540/index.html">Infografiken mit Excel und PowerPoint. Teil 2</a></li>
<li><a href="../de498542/index.html">Praktische Klasse „Suche nach Malware im IoT“</a></li>
<li><a href="../de498548/index.html">Erstellen Sie Ihr eigenes Paket für Laravel Nova: OptimalImage</a></li>
<li><a href="../de498552/index.html">Welche Fehler machen Manager an einem entfernten Standort?</a></li>
<li><a href="../de498556/index.html">Hans Peter Lun und die Geburt des Hash-Algorithmus</a></li>
<li><a href="../de498560/index.html">Webkomponenten in einem realen Projekt</a></li>
<li><a href="../de498562/index.html">Im Gegensatz zur Quarantäne: Wie wir unsere Praktika auf ein Remote-Format übertragen haben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>