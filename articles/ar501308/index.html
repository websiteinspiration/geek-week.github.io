<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘’ ğŸ¥˜ ğŸ‘‚ğŸ» Ù†Ø­Ù† Ù†Ø­Ø§ÙˆÙ„ Ø£Ù† Ù†ÙÙ‡Ù… StateFlow ğŸ… ğŸ˜• ğŸ‘©ğŸ¼â€ğŸ’»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ØªØ­ÙŠØ© Ù„Ù„Ø¬Ù…ÙŠØ¹. 
 
 Ù‚Ø¨Ù„ Ø¨Ø¶Ø¹Ø© Ø£ÙŠØ§Ù… ØŒ Ø£ØµØ¯Ø±Øª JetBrains Ø¥ØµØ¯Ø§Ø±Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ Ù…Ù† Corutin - 1.3.6 ÙˆÙƒØ§Ù† Ø£Ø­Ø¯ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª Ù‡Ùˆ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ù† Flow - StateFlow ØŒ Ø§Ù„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ù†Ø­Ù† Ù†Ø­Ø§ÙˆÙ„ Ø£Ù† Ù†ÙÙ‡Ù… StateFlow</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501308/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªØ­ÙŠØ© Ù„Ù„Ø¬Ù…ÙŠØ¹. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù‚Ø¨Ù„ Ø¨Ø¶Ø¹Ø© Ø£ÙŠØ§Ù… ØŒ Ø£ØµØ¯Ø±Øª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JetBrains Ø¥ØµØ¯Ø§Ø±Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ Ù…Ù† Corutin - 1.3.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ÙˆÙƒØ§Ù† Ø£Ø­Ø¯ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª Ù‡Ùˆ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ù† Flow - StateFlow ØŒ Ø§Ù„Ø°ÙŠ ÙŠØ­Ù„ Ù…Ø­Ù„ ConflatedBroadcastChannel. </font><font style="vertical-align: inherit;">Ù‚Ø±Ø±Øª Ø£Ù† Ø£Ø¬Ø±Ø¨ StateFlow ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ¯Ø±Ø§Ø³Ø© Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù† Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù…Ù† ÙŠØ³ØªØ®Ø¯Ù…ÙˆÙ† Kotlin Ø¹Ù†Ø¯ Ø§Ù„ØªØ·ÙˆÙŠØ± Ù„Ù†Ø¸Ø§Ù… Android Ø£Ùˆ ÙÙŠ MPP Ø¹Ù„Ù‰ Ø¯Ø±Ø§ÙŠØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª ØŒ ÙˆÙ‡Ù… Ù„ÙŠØ³ÙˆØ§ ÙƒØ°Ù„Ùƒ - Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ù‡ÙŠ Ù†Ø¸Ø§Ø¦Ø± Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† BehaviorProcessor / BehaviorSubject Ù…Ù† RxJava Ùˆ LiveData / MutableLiveData Ù…Ù† Jetpack. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
StateFlow Ù†ÙØ³Ù‡Ø§ Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ø§Ù…ØªØ¯Ø§Ø¯ Ø¨Ø³ÙŠØ· Ù„ÙˆØ§Ø¬Ù‡Ø© Flow ÙˆÙŠØ£ØªÙŠ ÙÙŠ Ø´ÙƒÙ„ÙŠÙ†:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">StateFlow</span>&lt;<span class="hljs-type">out T</span>&gt; : <span class="hljs-type">Flow</span>&lt;<span class="hljs-type">T</span>&gt; </span>{
    <span class="hljs-comment">/**
     * The current value of this state flow.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> value: T<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MutableStateFlow</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">StateFlow</span>&lt;<span class="hljs-type">T</span>&gt; </span>{
    <span class="hljs-comment">/**
     * The current value of this state flow.
     *
     * Setting a value that is [equal][Any.equals] to the previous one does nothing.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø§Ù„ÙÙƒØ±Ø© Ù‡ÙŠ Ù†ÙØ³Ù‡Ø§ ÙƒÙ…Ø§ ÙÙŠ LiveData / MutableLiveData - Ù…Ù† Ø®Ù„Ø§Ù„ ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ø­Ø¯Ø© ÙŠÙ…ÙƒÙ† ÙÙ‚Ø· Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØŒ ÙˆÙ…Ù† Ø®Ù„Ø§Ù„ Ø£Ø®Ø±Ù‰ ÙŠÙ…ÙƒÙ† ØªØ«Ø¨ÙŠØªÙ‡Ø§ Ø£ÙŠØ¶Ù‹Ø§. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù…Ø§Ø°Ø§ ØªÙ‚Ø¯Ù… Ù„Ù†Ø§ StateFlow Ù…Ù‚Ø§Ø±Ù†Ø© ConflatedBroadcastChannel:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ØªÙ†ÙÙŠØ° Ø¯Ø§Ø®Ù„ÙŠ Ø£Ø¨Ø³Ø· ÙˆØ®Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ù‚Ù…Ø§Ù…Ø©. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ Ø¹Ù†ØµØ± Ø§ÙØªØ±Ø§Ø¶ÙŠ. </font><font style="vertical-align: inherit;">Null Ù…Ù…ÙƒÙ† Ø£ÙŠØ¶Ù‹Ø§.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ø§Ù„ÙØµÙ„ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø· ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø©. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø³Ø§ÙˆØ§Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø·. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø§Ù„Ø¢Ù† Ø¯Ø¹ÙˆÙ†Ø§ Ù†Ø­Ø§ÙˆÙ„ ØªÙ†ÙÙŠØ° Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø³ÙŠØ· Ù„Ù€ StateFlow. </font><font style="vertical-align: inherit;">Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ø°Ù„Ùƒ ØŒ Ù‚Ù…Øª Ø¨Ø¹Ù…Ù„ ØºÙ„Ø§Ù Ø£ÙˆÙ„ÙŠ Ù…Ø¹ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ ØªØ¹ÙŠÙŠÙ† Ø£ÙŠ Ù†ÙˆØ¹ Ø¨Ø¹Ù†ØµØ± ÙØ§Ø±Øº Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateFlowRepository</span>&lt;<span class="hljs-type">T</span>&gt;</span>(initialValue: T? = <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> stateFlow = MutableStateFlow(initialValue)<font></font>
<font></font>
    <span class="hljs-keyword">var</span> value: T?
        <span class="hljs-keyword">get</span>() = stateFlow.value
        <span class="hljs-keyword">set</span>(value) {<font></font>
            stateFlow.value = value<font></font>
        }<font></font>
<font></font>
    <span class="hljs-keyword">val</span> stream: Flow&lt;T?&gt; = stateFlow<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</font></font><br>
<br>
<pre><code class="kotlin hljs">lifecycleScope.launch {<font></font>
            simpleRepo.stream.collect {<font></font>
                addData(it.toString())<font></font>
            }<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙˆÙ†Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø¹ Ø£Ø¨Ø³Ø· ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØŒ ÙˆÙ„Ø§ ÙŠØ³Ø¨Ø¨ Ø£ÙŠ Ù…Ø´Ø§ÙƒÙ„ ÙˆÙŠØ¹Ù…Ù„ ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø«Ù„ Ø§Ù„Ø³Ø§Ø¹Ø©: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/cv/_c/pncv_c41cwncgwkfc3hd3wxzfh0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø§Ù„Ø¢Ù† Ø¯Ø¹ÙˆÙ†Ø§ Ù†Ù†Ø¸Ø± ÙÙŠ Ø§Ù„Ø¯Ø§Ø®Ù„ ÙˆÙ†Ø±Ù‰ ÙƒÙŠÙ ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù…Ù† Ø§Ù„Ù…Ø¯Ù‡Ø´ Ø£Ù† Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ø³ÙŠØ· Ù„Ù„ØºØ§ÙŠØ© ÙˆÙ„Ø§ ÙŠØ³ØªØºØ±Ù‚ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ø³ÙˆÙ‰ 316 Ø®Ø·Ù‹Ø§ ØŒ 25Ùª Ù…Ù†Ù‡Ø§ Ù‡ÙŠ javadoki. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙˆÙ‡ÙƒØ°Ø§ ØŒ ÙØ¥Ù† ÙØ¦Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù‡ÙŠ ÙØ¦Ø© StateFlowImpl:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateFlowImpl</span>&lt;<span class="hljs-type">T</span>&gt;</span>(initialValue: Any) : SynchronizedObject(), MutableStateFlow&lt;T&gt;, FusibleFlow&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _state = atomic(initialValue) <span class="hljs-comment">// T | NULL</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sequence = <span class="hljs-number">0</span> <span class="hljs-comment">// serializes updates, value update is in process when sequence is odd</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> slots = arrayOfNulls&lt;StateFlowSlot?&gt;(INITIAL_SIZE)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> nSlots = <span class="hljs-number">0</span> <span class="hljs-comment">// number of allocated (!free) slots</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> nextIndex = <span class="hljs-number">0</span> <span class="hljs-comment">// oracle for the next free slot index</span><font></font>
<font></font>
. . .<font></font>
}<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_state</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°Ø±ÙŠ Ù„ØªØ®Ø²ÙŠÙ† Ø¯ÙˆÙ„ØªÙ†Ø§. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªØ³Ù„Ø³Ù„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ù…Ø¤Ø´Ø± Ù…Ø³Ø§Ø¹Ø¯ ØŒ ÙˆØ§Ù„Ø°ÙŠ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ØªØ­Ø¯ÙŠØ« </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙØªØ­Ø§Øª</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ø§Ù„Ø­Ø§Ù„Ø© </font><font style="vertical-align: inherit;">- Ø§Ù„ØµÙÙŠÙ / Ø§Ù„ØªØ¬Ù…Ø¹ StateFlowSlot </font><font style="vertical-align: inherit;">ØŒ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªÙƒØ§ÙØ¤ / Ø§Ù„ØºØ±Ø§Ø¨Ø© </font><font style="vertical-align: inherit;">. StateFlowSlot - Ø§Ù„ØªØ¬Ø±ÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù„ÙƒÙ„ "Ø§ØªØµØ§Ù„" Ø¨Ù€ StateFlow. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nSlots ØŒ nextIndex</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¹Ù…Ù„ Ù…Ø¹ ÙØªØ­Ø§Øª Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙˆØ³ÙŠØ¹ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¯Ø¹ÙˆÙ†Ø§ Ù†Ù†Ø¸Ø± ÙÙŠ StateFlowSlot Ù…Ù‚Ø¯Ù…Ù‹Ø§. ÙŠÙ…Ø«Ù„ ÙÙ‚Ø·:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _state = atomic&lt;Any?&gt;(<span class="hljs-literal">null</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø·Ø±Ù‚ Ù„ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø§Øª Ø§Ù„ÙØªØ­Ø©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† ÙƒÙ„ ÙØªØ­Ø© ÙÙŠ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø­Ø§Ù„Ø§Øª: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙØ§Ø±ØºØ©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ ØŒ ÙˆÙ„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NONE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø­Ø§Ù„Ø© PENDING</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© </font><font style="vertical-align: inherit;">- ØªØ­Ø³Ø¨Ù‹Ø§ Ù„Ø¥Ø±Ø³Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø¬Ø§Ù…Ø¹ </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CancellableContinuationImpl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ø­Ø§Ù„Ø© saspended Ø¨Ø§Ù„Ù‚Ø±Ø¨ Ù…Ù† Ø­Ø§Ù„Ø© PENDING Ø§Ù„ÙˆØ¬Ù‡Ø© ØŒ ÙŠØªÙ… ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…Ø¬Ù…Ù‘Ø¹ Ù„Ù† ÙŠØ£ØªÙŠ Ø­ØªÙ‰ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Stateflow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¶Ø¹ ÙÙŠ Ø§Ø¹ØªØ¨Ø§Ø±Ùƒ Ù…Ø§ ÙŠØ­Ø¯Ø« Ø¹Ù†Ø¯ ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T
        <span class="hljs-keyword">get</span>() = NULL.unbox(_state.value)
        <span class="hljs-keyword">set</span>(value) {
            <span class="hljs-keyword">var</span> curSequence = <span class="hljs-number">0</span>
            <span class="hljs-keyword">var</span> curSlots: Array&lt;StateFlowSlot?&gt; = <span class="hljs-keyword">this</span>.slots <span class="hljs-comment">// benign race, we will not use it</span>
            <span class="hljs-keyword">val</span> newState = value ?: NULL<font></font>
            synchronized(<span class="hljs-keyword">this</span>) {
                <span class="hljs-keyword">val</span> oldState = _state.value
                <span class="hljs-keyword">if</span> (oldState == newState) <span class="hljs-keyword">return</span> <span class="hljs-comment">// Don't do anything if value is not changing</span><font></font>
                _state.value = newState<font></font>
                curSequence = sequence<font></font>
                <span class="hljs-keyword">if</span> (curSequence and <span class="hljs-number">1</span> == <span class="hljs-number">0</span>) { <span class="hljs-comment">// even sequence means quiescent state flow (no ongoing update)</span>
                    curSequence++ <span class="hljs-comment">// make it odd</span><font></font>
                    sequence = curSequence<font></font>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// update is already in process, notify it, and return</span>
                    sequence = curSequence + <span class="hljs-number">2</span> <span class="hljs-comment">// change sequence to notify, keep it odd</span>
                    <span class="hljs-keyword">return</span><font></font>
                }<font></font>
                curSlots = slots <span class="hljs-comment">// read current reference to collectors under lock</span><font></font>
            }<font></font>
            <span class="hljs-comment">/*
               Fire value updates outside of the lock to avoid deadlocks with unconfined coroutines
               Loop until we're done firing all the changes. This is sort of simple flat combining that
               ensures sequential firing of concurrent updates and avoids the storm of collector resumes
               when updates happen concurrently from many threads.
             */</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// Benign race on element read from array</span>
                <span class="hljs-keyword">for</span> (col <span class="hljs-keyword">in</span> curSlots) {<font></font>
                    col?.makePending()<font></font>
                }<font></font>
                <span class="hljs-comment">// check if the value was updated again while we were updating the old one</span>
                synchronized(<span class="hljs-keyword">this</span>) {
                    <span class="hljs-keyword">if</span> (sequence == curSequence) { <span class="hljs-comment">// nothing changed, we are done</span>
                        sequence = curSequence + <span class="hljs-number">1</span> <span class="hljs-comment">// make sequence even again</span>
                        <span class="hljs-keyword">return</span> <span class="hljs-comment">// done</span><font></font>
                    }<font></font>
                    <span class="hljs-comment">// reread everything for the next loop under the lock</span><font></font>
                    curSequence = sequence<font></font>
                    curSlots = slots<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù‡Ù†Ø§ Ù‡ÙŠ Ø¥ØµÙ„Ø§Ø­ ØªØºÙŠÙŠØ±Ø§Øª Ø­Ø§Ù„Ø© StateFlow Ù…Ù† Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù„Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ© Ø¥Ù„Ù‰ FlowCollector. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙŠÙ…ÙƒÙ† ØªÙ…ÙŠÙŠØ² Ø¹Ø¯Ø© Ø®Ø·ÙˆØ§Øª:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªØ­Ø¯ÙŠØ¯ Ù‚ÙŠÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙŠØ¹Ù†ÙŠ ØªØ¹ÙŠÙŠÙ† Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© ÙØ±Ø¯ÙŠØ© Ø£Ù†Ù†Ø§ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠØ«.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makePending () - Ø¶Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„ÙØªØ­Ø§Øª (Ø£ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª) Ø¹Ù„Ù‰ ØªØ¹Ù„ÙŠÙ‚ - Ø³Ù†Ø±Ø³Ù„ Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ù‚ÙŠÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªÙ‚ÙˆÙ… Ø§Ù„Ø­Ù„Ù‚Ø© Ø¨ÙØ­Øµ Ø§Ù„ØªØ³Ù„Ø³Ù„ == curSequence Ø¨Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø© ÙˆØªØ¶Ø¨Ø· Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø²ÙˆØ¬ÙŠ.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø« ÙÙŠ Ø·Ø±ÙŠÙ‚Ø© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ù„Ø¬Ù…Ø¹</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        <span class="hljs-keyword">val</span> slot = allocateSlot()
        <span class="hljs-keyword">var</span> prevState: Any? = <span class="hljs-literal">null</span> <span class="hljs-comment">// previously emitted T!! | NULL (null -- nothing emitted yet)</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// The loop is arranged so that it starts delivering current value without waiting first</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// Here the coroutine could have waited for a while to be dispatched,</span>
                <span class="hljs-comment">// so we use the most recent state here to ensure the best possible conflation of stale values</span>
                <span class="hljs-keyword">val</span> newState = _state.value
                <span class="hljs-comment">// Conflate value emissions using equality</span>
                <span class="hljs-keyword">if</span> (prevState == <span class="hljs-literal">null</span> || newState != prevState) {<font></font>
                    collector.emit(NULL.unbox(newState))<font></font>
                    prevState = newState<font></font>
                }<font></font>
                <span class="hljs-comment">// Note: if awaitPending is cancelled, then it bails out of this loop and calls freeSlot</span>
                <span class="hljs-keyword">if</span> (!slot.takePending()) { <span class="hljs-comment">// try fast-path without suspending first</span>
                    slot.awaitPending() <span class="hljs-comment">// only suspend for new values when needed</span><font></font>
                }<font></font>
            }<font></font>
        } <span class="hljs-keyword">finally</span> {<font></font>
            freeSlot(slot)<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù‡ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙˆØ§Ù†ØªØ¸Ø± Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙØªØ­Ø© Ù„Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø­Ø«Ù‹Ø§ Ø¹Ù† Ù‚ÙŠÙ…Ø© ÙØ§Ø±ØºØ© Ø£Ùˆ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¯ÙˆÙ„Ø©. </font><font style="vertical-align: inherit;">Emittim Ù…Ø¹Ù†Ù‰ Ø¬Ø¯ÙŠØ¯.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù†ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ ÙØªØ­Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ« (Ø­Ø§Ù„Ø© ØªØ¹Ù„ÙŠÙ‚) ÙˆØ¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† ÙƒØ°Ù„Ùƒ ØŒ ÙØ¥Ù†Ù†Ø§ Ù†Ø¹Ù„Ù‚ Ø§Ù„ÙØªØ­Ø© ØªØ­Ø³Ø¨Ù‹Ø§ Ù„Ù‚ÙŠÙ… Ø¬Ø¯ÙŠØ¯Ø©.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… ØŒ Ù‡Ø°Ø§ ÙƒÙ„ Ø´ÙŠØ¡. </font><font style="vertical-align: inherit;">Ù„Ù… Ù†Ø£Ø®Ø° ÙÙŠ Ø§Ù„Ø§Ø¹ØªØ¨Ø§Ø± ÙƒÙŠÙ ÙŠØªÙ… ØªØ®ØµÙŠØµ Ø§Ù„ÙØªØ­Ø§Øª ÙˆØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø§ØªÙ‡Ø§ ØŒ Ù„ÙƒÙ†Ù†ÙŠ Ø§Ø¹ØªÙ‚Ø¯Øª Ø£Ù† Ù‡Ø°Ø§ Ù„ÙŠØ³ Ù…Ù‡Ù…Ù‹Ø§ Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù€ StateFlow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø´ÙƒØ±Ø§.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar501292/index.html">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø© Ù„Ù„Ø³ÙÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©. Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© ÙˆØ§Ù„Ø­Ø³ Ø§Ù„Ø³Ù„ÙŠÙ…</a></li>
<li><a href="../ar501296/index.html">ÙƒÙŠÙÙŠØ© Ø¬Ø¹Ù„ Ù…Ù‡Ù†Ø© ÙƒÙ…Ø¨Ø±Ù…Ø¬ Ø¯ÙˆÙ† Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© ØªØ¬Ø§Ø±ÙŠØ©</a></li>
<li><a href="../ar501298/index.html">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙˆØ¯Ø¹ Ù…ÙƒÙˆÙ†Ø§Øª QGIS Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</a></li>
<li><a href="../ar501302/index.html">Ù…Ù† ÙØ¶Ù„Ùƒ Ù„Ø§ ØªØµØ¯Ø± Ø¶ÙˆØ¶Ø§Ø¡</a></li>
<li><a href="../ar501306/index.html">Ø¨Ù†Ø§Ø¡ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù„ØªÙ‚Ø¯ÙŠÙ… ØµÙˆØ±Ø© Graal Native Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠÙŠÙ†</a></li>
<li><a href="../ar501310/index.html">Ø­ÙˆÙ„ Ø¨ÙŠØ±ÙˆÙƒØ³ÙŠØ¯ Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙ† ÙˆØ¹Ù„Ø© Ø§Ù„ØµØ§Ø±ÙˆØ®</a></li>
<li><a href="../ar501312/index.html">Alpine.js - Ø¥Ø·Ø§Ø± Ø®ÙÙŠÙ Ø§Ù„ÙˆØ²Ù† Ù…Ø¹ Ø¨Ù†Ø§Ø¡ Ø¬Ù…Ù„Ø© Ù…Ù†Ø§Ø³Ø¨</a></li>
<li><a href="../ar501316/index.html">Ø¯Ø±Ø§Ø³Ø© Ù…Ø§ÙŠÙƒØ±ÙˆØ³ÙˆÙØª: ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù‡Ùˆ Ø£Ø­Ø¯ Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</a></li>
<li><a href="../ar501318/index.html">ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµØ­Ø§Ø¦Ù Ø´Ø¨ÙŠØ¨Ø© Ø§Ù„Ø¬ÙˆØ¬Ù„ ÙˆØ¬ÙˆØ¬Ù„ Ù„ØªØµØ¨Ø­ Ø¬Ø§Ø± Ù†Ø§Ø¯ÙŠ Ø¨ÙŠÙ„ Ø¬ÙŠØªØ³ Ù„Ù„Ø¬ÙˆÙ„Ù</a></li>
<li><a href="../ar501320/index.html">Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ´ØºÙŠÙ„ LED Ø¨ØªÙƒÙ„ÙØ© BOM Ø£Ù‚Ù„ Ù…Ù† 1 Ø¯ÙˆÙ„Ø§Ø±. Ù‡Ù„ Ù‡Ùˆ Ù…Ù…ÙƒÙ†ØŸ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>