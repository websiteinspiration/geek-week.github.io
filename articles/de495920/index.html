<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📄 🕵️ 🗿 Implementierungsdetails des PTPv2-Zeitsynchronisationsprotokolls 🌔 🤸🏼 👩🏿‍🤝‍👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einleitung
 
 Das Konzept des Aufbaus einer „digitalen Unterstation“ in der Elektroindustrie erfordert eine Synchronisation mit einer Genauigkeit von ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Implementierungsdetails des PTPv2-Zeitsynchronisationsprotokolls</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/phoenix_contact/blog/495920/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einleitung</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Das Konzept des Aufbaus einer „digitalen Unterstation“ in der Elektroindustrie erfordert eine Synchronisation mit einer Genauigkeit von 1 μs. </font><font style="vertical-align: inherit;">Finanztransaktionen erfordern auch eine Genauigkeit von Mikrosekunden. </font><font style="vertical-align: inherit;">In diesen Anwendungen reicht die NTP-Zeitgenauigkeit nicht mehr aus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das durch den IEEE 1588v2-Standard beschriebene PTPv2-Synchronisationsprotokoll ermöglicht eine Synchronisationsgenauigkeit von mehreren zehn Nanosekunden. </font><font style="vertical-align: inherit;">Mit PTPv2 können Sie Synchronisationspakete über L2- und L3-Netzwerke senden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptbereiche, in denen PTPv2 verwendet wird, sind:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Energietechnik;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steuer- und Messgeräte;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">militärisch-industrieller Komplex;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telekommunikation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finanzsektor.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Beitrag befasst sich mit der Funktionsweise des PTPv2-Synchronisationsprotokolls. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben mehr Branchenerfahrung und stoßen bei Energieanwendungen häufig auf dieses Protokoll. Dementsprechend werden wir die Überprüfung mit Blick </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf Energie durchführen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum ist es notwendig?</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Derzeit enthalten STO 34.01-21-004-2019 von PJSC Rosseti und STO 56947007-29.240.10.302-2020 von PJSC FGC UES Anforderungen zum Organisieren eines Prozessbusses mit Zeitsynchronisation über PTPv2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies liegt daran, dass Relaisschutzklemmen und Messgeräte an den Prozessbus angeschlossen sind, die über die sogenannten SV-Streams (Multicast-Streams) über den Prozessbus Momentanwerte von Strom und Spannung übertragen.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Relaisschutzklemmen verwenden diese Werte, um den Verbindungsschutz zu implementieren. Wenn die Genauigkeit der Messungen über die Zeit gering ist, können einige Schutzmaßnahmen falsch funktionieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise kann der Schutz der absoluten Selektivität Opfer einer "schwachen" Zeitsynchronisation werden. Oft basiert die Logik solcher Verteidigungen auf einem Vergleich zweier Werte. Wenn die Werte von einem ausreichend großen Wert abweichen, wird der Schutz ausgelöst. Wenn diese Werte mit einer Genauigkeit von 1 ms gemessen werden, können Sie einen großen Unterschied feststellen, wenn die Werte tatsächlich normal sind, wenn Sie sie mit einer Genauigkeit von 1 μs messen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTP-Versionen</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das PTP-Protokoll wurde ursprünglich im Jahr 2002 im IEEE 1588-2002-Standard beschrieben und als „Standard für ein Präzisionsuhr-Synchronisationsprotokoll für vernetzte Mess- und Steuerungssysteme“ bezeichnet. </font><font style="vertical-align: inherit;">Im Jahr 2008 wurde der aktualisierte IEEE 1588-2008-Standard veröffentlicht, der die PTP-Version 2 beschreibt. In dieser Version des Protokolls wurden Genauigkeit und Stabilität verbessert, die Abwärtskompatibilität mit der ersten Version des Protokolls wurde jedoch nicht beibehalten. </font><font style="vertical-align: inherit;">Außerdem wurde 2019 die Standardversion IEEE 1588-2019 veröffentlicht, die PTP v2.1 beschreibt. </font><font style="vertical-align: inherit;">Diese Version fügt geringfügige Verbesserungen zu PTPv2 hinzu und ist abwärtskompatibel mit PTPv2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit anderen Worten, wir haben das folgende Bild mit den Versionen:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTPv1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(IEEE 1588-2002)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTPv2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(IEEE 1588-2008)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTPv2.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(IEEE 1588-2019)</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTPv1 (IEEE 1588-2002)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unvereinbar</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unvereinbar</font></font><br>
</td>
</tr>
<tr>
<td>PTPv2 (IEEE 1588-2008)<br>
</td>
<td><br>
</td>
<td> — </td>
<td><br>
</td>
</tr>
<tr>
<td>PTPv2.1 (IEEE 1588-2019)<br>
</td>
<td><br>
</td>
<td><br>
</td>
<td> — </td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber wie immer gibt es Nuancen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Inkompatibilität zwischen PTPv1 und PTPv2 deutet darauf hin, dass ein Gerät mit PTPv1-Unterstützung nicht mit der genauen Uhr synchronisieren kann, die auf PTPv2 ausgeführt wird. Sie verwenden unterschiedliche Nachrichtenformate für die Synchronisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können jedoch weiterhin Geräte mit PTPv1 und Geräte mit PTPv2 im selben Netzwerk kombinieren. Zu diesem Zweck können Sie bei einigen Herstellern die Protokollversion an den Ports der Grenzuhr auswählen. Das heißt, die Grenzuhr kann über PTPv2 synchronisiert werden und gleichzeitig andere mit PTPv1 und PTPv2 verbundene Uhren synchronisieren. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTP-Geräte. Was sind und wie unterscheiden sie sich?</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Der IEEE 1588v2-Standard beschreibt verschiedene Arten von Geräten. Alle von ihnen sind in der Tabelle angegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geräte kommunizieren über LAN über PTP miteinander.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PTP-Geräte werden als Uhren bezeichnet. </font><font style="vertical-align: inherit;">Alle Uhren nehmen die genaue Zeit von der Großmeisteruhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt 5 Arten von Uhren:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Großmeisteruhr</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Hauptquelle für genaue Zeit. </font><font style="vertical-align: inherit;">Oft mit einer Schnittstelle zum Anschließen von GPS ausgestattet.</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gewöhnliche Uhr</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Single-Port-Gerät, das ein Master (Master Clock) oder ein Slave (Master Clock) sein kann.</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Führende Stunden (Meister)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie sind die Quelle der genauen Zeit, zu der andere Uhren synchronisiert werden.</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sklavenuhr (Sklave)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Endgerät, das von der Hauptuhr synchronisiert wird</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grenzuhr</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Gerät mit mehreren Ports, das ein Master oder ein Slave sein kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das heißt, diese Uhr kann von einer höheren Hauptuhr und einer niedrigeren Nebenuhr synchronisieren.</font></font><br>
</td>
</tr>
<tr>
<td>End-to-end Transparent Clock ( ,    End-to-End)<br>
</td>
<td>   ,      ,  .    PTP   . <br>
<br>
       PTP-. <br>
<br>
                .<br>
 </td>
</tr>
<tr>
<td>Peer-to-Peer Transparent Clock ( ,    Peer-to-Peer)<br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Gerät mit mehreren Ports, das weder eine Hauptuhr noch ein Slave ist. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es überträgt PTP-Daten zwischen zwei Stunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Datenübertragung korrigiert die transparente Uhr alle PTP-Nachrichten Sync und Follow_Up (mehr dazu weiter unten). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Korrektur wird erreicht, indem das Feld der Einstellung des übertragenen Verzögerungspakets auf dem sendenden Gerät und der Verzögerung auf dem Datenkanal addiert wird.</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwaltungsknoten</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Gerät, das andere Uhren konfiguriert und diagnostiziert</font></font><br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Master- und Slave-Uhren werden mithilfe von Zeitstempeln in PTP-Nachrichten synchronisiert. </font><font style="vertical-align: inherit;">Es gibt zwei Arten von Nachrichten im PTP-Protokoll:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ereignismeldungen sind synchronisierte Nachrichten, bei denen zum Zeitpunkt des Sendens und zum Empfang einer Nachricht ein Zeitstempel generiert wird.</font></font></li>
<li>General Messages –      ,        </li>
</ul><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>Event Messages<br>
</td>
<td>General Messages<br>
</td>
</tr>
<tr>
<td>Sync<br>
Delay_Req<br>
Pdelay_Req<br>
Pdelay_Resp<br>
</td>
<td>Announce<br>
Follow_Up<br>
Delay_Resp<br>
Pdelay_Resp_Follow_Up<br>
Management<br>
Signaling<br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes werden wir alle Arten von Nachrichten genauer betrachten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Hauptprobleme der Synchronisation</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bei der Übertragung eines Synchronisationspakets über ein lokales Netzwerk wird es auf dem Switch und im Datenübertragungskanal verzögert. </font><font style="vertical-align: inherit;">Jeder Schalter ergibt eine Verzögerung von ca. 10 μs, was für PTPv2 nicht akzeptabel ist. </font><font style="vertical-align: inherit;">Immerhin müssen wir am Endgerät eine Genauigkeit von 1 μs erreichen. </font><font style="vertical-align: inherit;">(Dies ist der </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fall, </font><font style="vertical-align: inherit;">wenn es um Energie geht. Andere Anwendungen erfordern möglicherweise eine höhere Genauigkeit.) </font><font style="vertical-align: inherit;">IEEE 1588v2 beschreibt mehrere Betriebsalgorithmen, mit denen Sie die Zeitverzögerung aufzeichnen und anpassen können. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betriebsalgorithmus</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Während des normalen Betriebs arbeitet das Protokoll in zwei Phasen.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase 1 - Aufbau der Hierarchie „Leading Clock - Slave Clock“.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase 2 - Taktsynchronisation mit dem End-to-End-Mechanismus oder Peer-to-Peer.</font></font></li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase 1 - Aufbau einer Master-Slave-Hierarchie</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jeder Port einer regulären oder Grenzuhr hat eine bestimmte Anzahl von Zuständen (Slave-Uhr und Master-Uhr). Der Standard beschreibt den Übergangsalgorithmus zwischen diesen Zuständen. Bei der Programmierung wird ein solcher Algorithmus als Zustandsmaschine oder Zustandsmaschine bezeichnet (mehr im Wiki). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Zustandsmaschine verwendet den BMCA (Best Master Clock Algorithm), um den Master einzustellen, wenn zwei Stunden verbunden sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Algorithmus ermöglicht es der Uhr, die Verpflichtungen einer Großmeisteruhr zu übernehmen, wenn eine überlegene Großmeisteruhr ihr GPS-Signal verliert, sich vom Netzwerk trennt usw. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zustandsübergänge gemäß BMCA sind in der folgenden Abbildung kurz dargestellt:</font></font><br>
<img src="https://habrastorage.org/webt/uy/hz/h6/uyhzh63gb0jt63bppsuuhcllwmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informationen über die Uhr am anderen Ende des „Kabels“ werden in einer speziellen Nachricht (Announce-Nachricht) gesendet. </font><font style="vertical-align: inherit;">Wenn diese Informationen empfangen werden, verarbeitet und vergleicht der Zustandsmaschinenalgorithmus, welcher Takt besser ist. </font><font style="vertical-align: inherit;">Der Hafen der besten Uhren wird zur führenden Uhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine einfache Hierarchie ist in der folgenden Abbildung dargestellt. </font><font style="vertical-align: inherit;">Die Pfade 1, 2, 3, 4, 5 können eine transparente Uhr (transparente Uhr) enthalten, sie sind jedoch nicht an der Erstellung der Hierarchie „Führende Uhr - Slave-Uhr“ beteiligt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kj/md/ci/kjmdcibg-ls2rflwu6qtur-0osg.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase 2 - Synchronisation einer regulären Uhr und einer Grenzuhr</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Unmittelbar nach Festlegung der Hierarchie „Leitstunden - Slave-Stunden“ beginnt die Synchronisationsphase einer regulären Uhr und einer Grenzuhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Synchronisation sendet die Hauptuhr eine Nachricht mit einem Zeitstempel an die Nebenuhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vorlaufzeiten können sein:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einstufig;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zweistufig.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine einstufige Uhr für die Synchronisation sendet eine Synchronisationsnachricht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine zweistufige Uhr verwendet zwei Nachrichten für die Synchronisation - Sync und Follow_Up. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Synchronisationsphase können zwei Mechanismen verwendet werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anforderungs- / Antwortmechanismus verzögern.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer-Delay-Messmechanismus.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst werden wir diese Mechanismen im einfachsten Fall betrachten - wenn keine transparenten Uhren verwendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verzögerungsanforderungs-Antwort-Mechanismus </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Mechanismus besteht aus zwei Schritten:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Messung der Verzögerung beim Senden einer Nachricht zwischen einer Hauptuhr und einem Slave. </font><font style="vertical-align: inherit;">Es wird unter Verwendung des Verzögerungsanforderungs- / Antwortmechanismus durchgeführt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Korrigiert die Verschiebung der genauen Zeit.</font></font></li>
</ol><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verzögerungsmessung</font></font></i><br>
<img src="https://habrastorage.org/webt/zj/hp/sa/zjhpsak259vihrylfiujf5vj2sm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
t1 - Synchronisieren der Sendezeit der Nachricht durch die führende Uhr; t2 - Empfangszeit der Synchronisierungsnachricht mit der Slave-Uhr; t3 - Sendezeit der Verzögerungsanforderung (Delay_Req) ​​um Slave-Stunden; t4 - Delay_Req Empfangszeit durch die führende Uhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Slave-Uhr die Zeit t1, t2, t3 und t4 kennt, kann sie die durchschnittliche Verzögerung beim Senden der Synchronisationsnachricht (tmpd) ​​berechnen. Es wird wie folgt berechnet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e6/cz/qx/e6czqxjr1wen8eld_z4y16joa4k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Übertragung einer Sync- und Follow_Up-Nachricht wird die Zeitverzögerung vom Master zum Slave berechnet - t-ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Übertragung von Delay_Req- und Delay_Resp-Nachrichten wird die Zeitverzögerung vom Slave zum Master t-sm berechnet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn zwischen diesen beiden Werten eine gewisse Asymmetrie auftritt, tritt ein Fehler bei der Korrektur der Abweichung der genauen Zeit auf. Der Fehler wird durch die Tatsache verursacht, dass die berechnete Verzögerung der Durchschnitt der Verzögerungen t-ms und t-sm ist. Wenn die Verzögerungen nicht gleich sind, werden wir die Zeit ungenau anpassen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Korrektur des Versatzes der genauen Zeit</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachdem die Verzögerung zwischen der führenden Uhr und der Nebenuhr bekannt ist, führt die Nebenuhr die Zeitkorrektur durch. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/gv/qz/a7gvqzykdjxtg6nm5rcqhcqmyzs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Slave-Uhr verwendet die Sync-Nachricht und die optionale Follow_Up-Nachricht, um den genauen Zeitversatz beim Übertragen des Pakets von der Master-Uhr zum Slave zu berechnen. Die Verschiebung wird nach folgender Formel berechnet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n1/rk/nw/n1rknwzr-r0qio-uf1a9iiqd_9o.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer-Delay-Messmechanismus</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dieser Mechanismus verwendet auch zwei Schritte zum Synchronisieren:</font></font><br>
<br>
<ol>
<li>         .     peer delay mechanism.</li>
<li>   .</li>
</ol><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer-to-Peer-</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Verzögerungsmessung </font><i><font style="vertical-align: inherit;">Die Verzögerung zwischen</font></i><font style="vertical-align: inherit;"> Peer-to-Peer- </font><i><font style="vertical-align: inherit;">fähigen Geräten</font></i><font style="vertical-align: inherit;"> wird anhand der folgenden Meldungen gemessen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eo/0o/y2/eo0oy26vhwksm1rel2znic_q8rs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Port 1 die Zeiten t1, t2, t3 und t4 kennt, kann er die durchschnittliche Verzögerung (tmld) berechnen ) Die Berechnung erfolgt nach folgender Formel: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a6/3r/mc/a63rmc4ehosk81dvktfv4prevt0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Port verwendet diesen Wert dann bei der Berechnung des Anpassungsfelds für jede Synchronisierungsnachricht oder optionale Follow_Up-Nachricht, die dieses Gerät durchläuft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Gesamtverzögerung ist gleich der Summe der Verzögerung während der Übertragung durch dieses Gerät, der durchschnittlichen Verzögerung während der Übertragung durch den Datenkanal und der bereits in dieser Nachricht enthaltenen Verzögerung, die auf den höheren Geräten enthalten ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit den Nachrichten Pdelay_Req, Pdelay_Resp und optional Pdelay_Resp_Follow_Up können Sie eine Verzögerung vom Master zum Slave und vom Slave zum Master erhalten (Rundschreiben). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Asymmetrie zwischen diesen beiden Werten führt zu einem genauen Zeitversatzkorrekturfehler. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Korrigieren des Versatzes der genauen Zeit Die</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/m6/do/ku/m6dokuldnfjmqscwyrtin2tvjiu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Slave-Uhr verwendet die Sync-Nachricht und die optionale Follow_Up-Nachricht, um den Versatz der genauen Zeit beim Übertragen des Pakets von der führenden Uhr zum Slave zu berechnen. Die Verschiebung wird gemäß der folgenden Formel berechnet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ub/ui/xk/ubuixkpfmzizo7ilzkdgyfwvh8c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vorteile Peer-to-Peer-Anpassung - Die Zeitverzögerung jeder Sync- oder Follow_Up-Nachricht wird berechnet, wenn sie im Netzwerk übertragen wird. Daher hat eine Änderung des Übertragungswegs keinen Einfluss auf die Genauigkeit der Einstellung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Verwendung dieses Mechanismus erfordert die Zeitsynchronisation nicht die Berechnung der Zeitverzögerung auf dem vom Synchronisationspaket zurückgelegten Pfad, wie dies bei einem Basisaustausch der Fall ist. Jene. Delay_Req- und Delay_Resp-Nachrichten werden nicht gesendet. Bei dieser Methode wird die Verzögerung zwischen der Hauptuhr und den Followern einfach im Anpassungsfeld jeder Sync- oder Follow_Up-Nachricht summiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiterer Vorteil besteht darin, dass die Fahruhr entlastet wird, da Delay_Req-Nachrichten verarbeitet werden müssen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funktionsweise transparenter Uhren</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dementsprechend wurden einfache Beispiele untersucht. Angenommen, auf dem Synchronisationspfad werden Schalter angezeigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Switches ohne PTPv2-Unterstützung verwenden, wird das Synchronisationspaket auf dem Switch um ca. 10 μs verzögert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Switches, die PTPv2 in der IEEE 1588v2-Terminologie unterstützen, werden als transparente Uhren bezeichnet. </font><font style="vertical-align: inherit;">Die transparente Uhr ist nicht mit der führenden Uhr synchronisiert und nimmt nicht an der Hierarchie „Führende Uhr - Slave-Uhr“ teil. Bei der Übertragung von Synchronisationsnachrichten merken sie sich jedoch, wie stark die Nachricht von ihnen verzögert wurde. </font><font style="vertical-align: inherit;">Auf diese Weise können Sie die Zeitverzögerung anpassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine transparente Uhr kann in zwei Modi arbeiten:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ende zu Ende.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer-To-Peer.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">End-to-End (E2E) Die</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/cb/ev/vy/cbevvyylfmfgq9jgwm_jiuxvkjw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
transparente E2E-Uhr überträgt Synchronisierungsnachrichten und zugehörige Follow_Up-Nachrichten an alle Ports. Sogar diejenigen, die durch Protokolle blockiert sind (z. B. RSTP). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Switch merkt sich den Zeitstempel, zu dem das Synchronisierungspaket (Follow_Up) am Port empfangen und vom Port gesendet wurde. Basierend auf diesen beiden Zeitstempeln wird die Switch-Verarbeitungszeit für die Nachricht berechnet. In der Norm wird diese Zeit als Verweilzeit bezeichnet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verarbeitungszeit wird dem FeldrectionField der Sync-Nachricht (einstufige Uhr) oder Follow_Up (zweistufige Uhr) hinzugefügt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hv/4q/rj/hv4qrjcuzer2hejocmtzitnntma.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die transparente E2E-Uhr misst die Verarbeitungszeit für Sync- und Delay_Req-Nachrichten, die den Switch durchlaufen. Es ist jedoch wichtig zu verstehen, dass die Zeitverzögerung zwischen der führenden Uhr und der Nebenuhr unter Verwendung des Verzögerungsanforderungs-Antwort-Mechanismus berechnet wird. Wenn sich die Hauptuhr ändert oder sich der Pfad von der Hauptuhr zum Slave ändert, wird die Verzögerung erneut gemessen. Dies erhöht die Übergangszeit bei Netzwerkänderungen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/im/q7/swimq7rpv2n24wyd8erbsvf420s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der transparente P2P-Takt misst zusätzlich zur Messung der Verarbeitungszeit der Nachricht durch den Switch die Verzögerung auf dem Datenkanal zum nächsten Nachbarn unter Verwendung des Verzögerungsmessmechanismus des benachbarten Knotens.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verzögerung wird auf jedem Kanal in beide Richtungen gemessen, einschließlich der Kanäle, die durch ein Protokoll (z. B. RSTP) blockiert sind. </font><font style="vertical-align: inherit;">Auf diese Weise können Sie sofort eine neue Verzögerung auf dem Synchronisationspfad berechnen, wenn sich die Großmeisteruhr oder die Netzwerktopologie geändert hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Switch-Verarbeitungszeit und die Verzögerungszeit werden beim Senden von Sync- oder Follow_Up-Nachrichten akkumuliert. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arten der Unterstützung für PTPv2-Switches</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Switches können PTPv2 unterstützen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programmatisch;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Softwareimplementierung des PTPv2-Protokolls fordert der Switch einen Zeitstempel von der Firmware an. </font><font style="vertical-align: inherit;">Das Problem ist, dass die Firmware zyklisch arbeitet und Sie warten müssen, bis der aktuelle Zyklus abgeschlossen ist, die Anforderung verarbeitet wird und nach Ablauf des nächsten Zyklus ein Zeitstempel ausgegeben wird. </font><font style="vertical-align: inherit;">Dies wird auch einige Zeit dauern und wir werden eine Verzögerung erhalten, wenn auch nicht so bedeutend wie ohne Softwareunterstützung für PTPv2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur die Hardware-Unterstützung für PTPv2 ermöglicht es Ihnen, die erforderliche Genauigkeit aufrechtzuerhalten. </font><font style="vertical-align: inherit;">In diesem Fall erfolgt die Ausgabe des Zeitstempels durch einen speziellen ASIC, der am Port installiert ist. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichtenformat</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alle PTP-Nachrichten bestehen aus folgenden Feldern:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Header - 34 Bytes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Körper - Die Größe hängt von der Art der Nachricht ab.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suffix (optional.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/ae/9l/_3/ae9l_3mph3pkhb-2oi0h_ppy48u.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Header</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Das Feld </font><b><font style="vertical-align: inherit;">Header</font></b><font style="vertical-align: inherit;"> ist für alle PTP-Nachrichten gleich. Seine Größe beträgt 34 ​​Bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Format des </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/xs/gu/yuxsgundgrz9iyiyyfabaxt5i38.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Felds</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Header: </font><b><font style="vertical-align: inherit;">messageType</font></b><font style="vertical-align: inherit;"> ist der Typ der übertragenen Nachricht, z. B. Sync, Delay_Req, PDelay_Req usw. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">messageLength</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - enthält die volle Größe der PTP-Nachricht, einschließlich Header, Body und Suffix (jedoch ohne Füllbytes). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">domainNumber</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bestimmt, zu welcher PTP-Domäne die Nachricht gehört. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Domäne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> besteht aus einigen verschiedenen Uhren, die zu einer logischen Gruppe zusammengefasst und von einer führenden Uhr synchronisiert sind, jedoch nicht unbedingt mit einer Uhr synchronisiert sind, die zu einer anderen Domäne gehört. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dieses Feld enthält verschiedene Flags, um den Status der Nachricht zu identifizieren. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Korrekturfeld</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- enthält die Verzögerungszeit in Nanosekunden. Die Verzögerungszeit umfasst die Übertragungsverzögerung durch den transparenten Takt sowie die Übertragungsverzögerung durch den Kanal bei Verwendung des Peer-to-Peer-Modus. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourcePortIdentity</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dieses Feld enthält Informationen darüber, von welchem ​​Port diese Nachricht ursprünglich gesendet wurde. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sequenceID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - enthält die Identifikationsnummer für einzelne Nachrichten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlField</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Artefaktfeld =) Es stammt aus der ersten Version des Standards und enthält Informationen zum Typ dieser Nachricht. Im Wesentlichen dasselbe wie messageType, jedoch mit weniger Optionen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">logMessageInterval</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dieses Feld wird durch den Nachrichtentyp bestimmt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Körper</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie oben erläutert, gibt es verschiedene Arten von Nachrichten. Diese Typen werden im Folgenden beschrieben: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ankündigungsnachricht Mit der Ankündigungsnachricht werden</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
andere Uhren innerhalb derselben Domäne über ihre Einstellungen informiert. Mit dieser Nachricht können Sie die Hierarchie „Leading Clock - Slave Clock“ einstellen. </font></font><br>
<img src="https://habrastorage.org/webt/-i/zs/dh/-izsdhnvkookhpjtrdrqx2myimy.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synchronisationsnachricht</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Eine Synchronisationsnachricht (Sync) wird von der Hauptuhr gesendet und enthält die Uhrzeit der Hauptuhr zum Zeitpunkt der Erstellung der Synchronisierungsnachricht. Wenn die führende Uhr zweistufig ist, wird der Zeitstempel in der Synchronisierungsnachricht auf 0 gesetzt und der aktuelle Zeitstempel in der gepaarten Follow_Up-Nachricht gesendet. Die Synchronisierungsnachricht wird für beide Verzögerungsmessmechanismen verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachricht wird mit Multicast übertragen. Sie können optional Unicast verwenden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sc/pp/1f/scpp1fns1uuyccw9bucbvghesgo.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delay_Req-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht Das Format der </font><b><font style="vertical-align: inherit;">Delay_Req-</font></b><font style="vertical-align: inherit;"> Nachricht ist identisch mit der Sync-Nachricht. Die Slave-Uhr sendet Delay_Req. Es enthält die Zeit, zu der Delay_Req von der Slave-Uhr gesendet wurde. Diese Nachricht wird nur für den Verzögerungsanforderungs-Antwort-Mechanismus verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachricht wird mit Multicast übertragen. Sie können optional Unicast verwenden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fe/bm/r_/febmr_zz7v1dricuta5z88xmjqk.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Follow_Up-Nachricht Die Follow_Up-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht wird optional von der Hauptuhr gesendet und enthält die Uhrzeit, zu der der </font><font style="vertical-align: inherit;">Assistent </font><font style="vertical-align: inherit;">die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synchronisierungsnachricht gesendet hat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Die Follow_Up-Nachricht wird nur von einer zweistufigen Fahruhr gesendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Follow_Up-Nachricht wird für beide Verzögerungsmessmechanismen verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachricht wird mit Multicast übertragen. Sie können optional Unicast verwenden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1g/42/2a/1g422aehbonsjrjjq0dwn9ceoxi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachricht Delay_Resp</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Delay_Resp-Nachricht wird von der Hauptuhr gesendet. Es enthält die Zeit, zu der Delay_Req von der Hauptuhr empfangen wird. Diese Nachricht wird nur für den Verzögerungsanforderungs-Antwort-Mechanismus verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachricht wird mit Multicast übertragen. Sie können optional Unicast verwenden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/up/is/gz/upisgzu5d7dk0iscixogmmjciwi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pdelay_Req-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht </font><b><font style="vertical-align: inherit;">Eine Pdelay_Req-</font></b><font style="vertical-align: inherit;"> Nachricht wird von einem Gerät gesendet, das eine Verzögerung anfordert. Es enthält die Zeit, zu der die Nachricht vom Port dieses Geräts gesendet wurde. Pdelay_Req wird nur für den Mechanismus zur Messung der Verzögerung benachbarter Knoten verwendet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/km/rz/hnkmrzmcidqsawxtazho-oprpus.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pdelay_Resp-Nachricht Die Pdelay_Resp-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht wird von dem Gerät gesendet, das die Verzögerungsanforderung empfangen hat. Es enthält die Zeit, zu der die Pdelay_Req-Nachricht von diesem Gerät empfangen wurde. Pdelay_Resp-Nachrichten werden nur für den Mechanismus zur Messung der Verzögerung benachbarter Knoten verwendet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/bb/34/khbb34wn7ujy84lldruomgaenmg.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pdelay_Resp_Follow_Up-Nachricht Die Pdelay_Resp_Follow_Up-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht wird optional von dem Gerät gesendet, das die Verzögerungsanforderung empfangen hat. </font><font style="vertical-align: inherit;">Es enthält die Zeit, zu der die Pdelay_Req-Nachricht von diesem Gerät empfangen wurde. </font><font style="vertical-align: inherit;">Die Nachricht Pdelay_Resp_Follow_Up wird nur von einer zweistufigen Hauptuhr gesendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Nachricht kann anstelle eines Zeitstempels auch zur Laufzeit verwendet werden. </font><font style="vertical-align: inherit;">Die Ausführungszeit ist die Zeit vom Empfang von Pdelay-Req bis zum Senden von Pdelay_Resp. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pdelay_Resp_Follow_Up werden nur für den Mechanismus zur Messung der Verzögerung benachbarter Knoten verwendet. </font><font style="vertical-align: inherit;">
Steuernachrichten </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w7/-k/q2/w7-kq2pssesbnko10w1tmsrs9ow.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Verwaltungsnachricht)</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PTP-Steuernachrichten sind erforderlich, um Informationen zwischen einer oder mehreren Uhren und dem Steuerknoten zu übertragen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/xi/c0/r7xic0kvnb_yurjc53bah53f2ss.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transfer zu LV</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine PTP-Nachricht kann auf zwei Ebenen übertragen werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netzwerk - als Teil von IP-Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link - als Teil eines Ethernet-Frames.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Senden einer PTP-Nachricht über UDP über IP über Ethernet </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/k6/al/f7k6alykkmt_4jrstkfkad_if-4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PTP über UDP über Ethernet </font><font style="vertical-align: inherit;">
PTP- </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/pe/wu/a7pewujvuii1chap6wppv51dh0k.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verfügen über viele „flexible“ Parameter, die konfiguriert werden müssen. </font><font style="vertical-align: inherit;">Zum Beispiel:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BMCA-Optionen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Verzögerungsmessmechanismus.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intervalle und Anfangswerte aller konfigurierbaren Parameter usw.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und trotz der Tatsache, dass wir zuvor gesagt haben, dass PTPv2-Geräte miteinander kompatibel sind, ist dies in guter Weise nicht der Fall. Geräte müssen dieselben Einstellungen haben, um interagieren zu können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher gibt es sogenannte PTPv2-Profile. Profile sind Gruppen konfigurierter Einstellungen und bestimmter Protokollbeschränkungen, sodass Sie die Zeitsynchronisierung für eine bestimmte Anwendung implementieren können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der IEEE 1588v2-Standard selbst beschreibt nur ein Profil - das „Standardprofil“. Alle anderen Profile werden von verschiedenen Organisationen und Verbänden erstellt und beschrieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise wurde das Leistungsprofil oder das PTPv2-Leistungsprofil vom Power Systems Relaying Committee und dem Substation Committee der IEEE Power and Energy Society erstellt. Das Profil selbst heißt IEEE C37.238-2011.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Profil beschreibt, dass PTP übertragen werden kann:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur über L2-Netzwerke (d. H. Ethernet, HSR, PRP, nicht IP).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichten werden nur von der Multicast-Mailingliste übertragen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Peer-Verzögerungsmessmechanismus wird als Verzögerungsmessmechanismus verwendet.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Standarddomäne ist 0, die empfohlene Domäne ist 93. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Philosophie beim Erstellen von C37.238-2011 war der Wunsch, die Anzahl der optionalen Funktionen zu reduzieren und nur die erforderlichen Funktionen für eine zuverlässige Interaktion zwischen Geräten zu belassen und die Systemstabilität zu erhöhen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem wird die Frequenz der Nachrichtenübertragung bestimmt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wc/gp/z9/wcgpz9du_jejtkxidtptsh9x53i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich steht nur ein Parameter zur Auswahl - der Typ des führenden Takts (einstufig oder zweistufig). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Genauigkeit sollte nicht mehr als 1 μs betragen. </font><font style="vertical-align: inherit;">Mit anderen Worten können maximal 15 transparente Uhren oder drei Grenzstunden in einem Synchronisationspfad enthalten sein.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/et/zp/y0/etzpy01l2mtcewn9mxik3wyztrq.png"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495904/index.html">Kann eine Epidemie vorhergesagt werden?</a></li>
<li><a href="../de495908/index.html">Der Weg zur Belohnung</a></li>
<li><a href="../de495910/index.html">Installieren von ROS in einem Ubuntu Single-Board IMG-Image</a></li>
<li><a href="../de495912/index.html">Intelligente Wiederholungsaufkleber</a></li>
<li><a href="../de495918/index.html">Wie man realistischen Sound in Computerspielen und VR reproduziert und warum es schwierig ist</a></li>
<li><a href="../de495924/index.html">Warum ist es so verdammt schwierig, ein gutes COVID-19-Verteilungsmodell zu erstellen?</a></li>
<li><a href="../de495926/index.html">Wir schreiben Firmware für TI cc2530 auf Z-Stack 3.0 für ZigBee Sonoff BASICZBR3 Relais mit ds18b20 Sensor</a></li>
<li><a href="../de495932/index.html">Was ist die verborgene Bedeutung der Autoren im SCRUM-Handbuch? Teil 1. Über den Prozess</a></li>
<li><a href="../de495934/index.html">DataGovernance zu Hause</a></li>
<li><a href="../de495938/index.html">Eine Auswahl von Artikeln zum maschinellen Lernen: Fälle, Leitfäden und Studien für März 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>