<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÑ üïµÔ∏è üóø Implementierungsdetails des PTPv2-Zeitsynchronisationsprotokolls üåî ü§∏üèº üë©üèø‚Äçü§ù‚Äçüë©üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einleitung
 
 Das Konzept des Aufbaus einer ‚Äûdigitalen Unterstation‚Äú in der Elektroindustrie erfordert eine Synchronisation mit einer Genauigkeit von ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Implementierungsdetails des PTPv2-Zeitsynchronisationsprotokolls</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/phoenix_contact/blog/495920/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einleitung</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Das Konzept des Aufbaus einer ‚Äûdigitalen Unterstation‚Äú in der Elektroindustrie erfordert eine Synchronisation mit einer Genauigkeit von 1 Œºs. </font><font style="vertical-align: inherit;">Finanztransaktionen erfordern auch eine Genauigkeit von Mikrosekunden. </font><font style="vertical-align: inherit;">In diesen Anwendungen reicht die NTP-Zeitgenauigkeit nicht mehr aus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das durch den IEEE 1588v2-Standard beschriebene PTPv2-Synchronisationsprotokoll erm√∂glicht eine Synchronisationsgenauigkeit von mehreren zehn Nanosekunden. </font><font style="vertical-align: inherit;">Mit PTPv2 k√∂nnen Sie Synchronisationspakete √ºber L2- und L3-Netzwerke senden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptbereiche, in denen PTPv2 verwendet wird, sind:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Energietechnik;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steuer- und Messger√§te;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">milit√§risch-industrieller Komplex;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telekommunikation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finanzsektor.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Beitrag befasst sich mit der Funktionsweise des PTPv2-Synchronisationsprotokolls. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben mehr Branchenerfahrung und sto√üen bei Energieanwendungen h√§ufig auf dieses Protokoll. Dementsprechend werden wir die √úberpr√ºfung mit Blick </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf Energie durchf√ºhren</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum ist es notwendig?</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Derzeit enthalten STO 34.01-21-004-2019 von PJSC Rosseti und STO 56947007-29.240.10.302-2020 von PJSC FGC UES Anforderungen zum Organisieren eines Prozessbusses mit Zeitsynchronisation √ºber PTPv2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies liegt daran, dass Relaisschutzklemmen und Messger√§te an den Prozessbus angeschlossen sind, die √ºber die sogenannten SV-Streams (Multicast-Streams) √ºber den Prozessbus Momentanwerte von Strom und Spannung √ºbertragen.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Relaisschutzklemmen verwenden diese Werte, um den Verbindungsschutz zu implementieren. Wenn die Genauigkeit der Messungen √ºber die Zeit gering ist, k√∂nnen einige Schutzma√ünahmen falsch funktionieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise kann der Schutz der absoluten Selektivit√§t Opfer einer "schwachen" Zeitsynchronisation werden. Oft basiert die Logik solcher Verteidigungen auf einem Vergleich zweier Werte. Wenn die Werte von einem ausreichend gro√üen Wert abweichen, wird der Schutz ausgel√∂st. Wenn diese Werte mit einer Genauigkeit von 1 ms gemessen werden, k√∂nnen Sie einen gro√üen Unterschied feststellen, wenn die Werte tats√§chlich normal sind, wenn Sie sie mit einer Genauigkeit von 1 Œºs messen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTP-Versionen</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das PTP-Protokoll wurde urspr√ºnglich im Jahr 2002 im IEEE 1588-2002-Standard beschrieben und als ‚ÄûStandard f√ºr ein Pr√§zisionsuhr-Synchronisationsprotokoll f√ºr vernetzte Mess- und Steuerungssysteme‚Äú bezeichnet. </font><font style="vertical-align: inherit;">Im Jahr 2008 wurde der aktualisierte IEEE 1588-2008-Standard ver√∂ffentlicht, der die PTP-Version 2 beschreibt. In dieser Version des Protokolls wurden Genauigkeit und Stabilit√§t verbessert, die Abw√§rtskompatibilit√§t mit der ersten Version des Protokolls wurde jedoch nicht beibehalten. </font><font style="vertical-align: inherit;">Au√üerdem wurde 2019 die Standardversion IEEE 1588-2019 ver√∂ffentlicht, die PTP v2.1 beschreibt. </font><font style="vertical-align: inherit;">Diese Version f√ºgt geringf√ºgige Verbesserungen zu PTPv2 hinzu und ist abw√§rtskompatibel mit PTPv2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit anderen Worten, wir haben das folgende Bild mit den Versionen:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTPv1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(IEEE 1588-2002)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTPv2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(IEEE 1588-2008)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTPv2.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(IEEE 1588-2019)</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTPv1 (IEEE 1588-2002)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unvereinbar</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unvereinbar</font></font><br>
</td>
</tr>
<tr>
<td>PTPv2 (IEEE 1588-2008)<br>
</td>
<td><br>
</td>
<td> ‚Äî </td>
<td><br>
</td>
</tr>
<tr>
<td>PTPv2.1 (IEEE 1588-2019)<br>
</td>
<td><br>
</td>
<td><br>
</td>
<td> ‚Äî </td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber wie immer gibt es Nuancen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Inkompatibilit√§t zwischen PTPv1 und PTPv2 deutet darauf hin, dass ein Ger√§t mit PTPv1-Unterst√ºtzung nicht mit der genauen Uhr synchronisieren kann, die auf PTPv2 ausgef√ºhrt wird. Sie verwenden unterschiedliche Nachrichtenformate f√ºr die Synchronisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen jedoch weiterhin Ger√§te mit PTPv1 und Ger√§te mit PTPv2 im selben Netzwerk kombinieren. Zu diesem Zweck k√∂nnen Sie bei einigen Herstellern die Protokollversion an den Ports der Grenzuhr ausw√§hlen. Das hei√üt, die Grenzuhr kann √ºber PTPv2 synchronisiert werden und gleichzeitig andere mit PTPv1 und PTPv2 verbundene Uhren synchronisieren. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTP-Ger√§te. Was sind und wie unterscheiden sie sich?</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Der IEEE 1588v2-Standard beschreibt verschiedene Arten von Ger√§ten. Alle von ihnen sind in der Tabelle angegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ger√§te kommunizieren √ºber LAN √ºber PTP miteinander.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PTP-Ger√§te werden als Uhren bezeichnet. </font><font style="vertical-align: inherit;">Alle Uhren nehmen die genaue Zeit von der Gro√ümeisteruhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt 5 Arten von Uhren:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gro√ümeisteruhr</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Hauptquelle f√ºr genaue Zeit. </font><font style="vertical-align: inherit;">Oft mit einer Schnittstelle zum Anschlie√üen von GPS ausgestattet.</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gew√∂hnliche Uhr</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Single-Port-Ger√§t, das ein Master (Master Clock) oder ein Slave (Master Clock) sein kann.</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºhrende Stunden (Meister)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie sind die Quelle der genauen Zeit, zu der andere Uhren synchronisiert werden.</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sklavenuhr (Sklave)</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Endger√§t, das von der Hauptuhr synchronisiert wird</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grenzuhr</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Ger√§t mit mehreren Ports, das ein Master oder ein Slave sein kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das hei√üt, diese Uhr kann von einer h√∂heren Hauptuhr und einer niedrigeren Nebenuhr synchronisieren.</font></font><br>
</td>
</tr>
<tr>
<td>End-to-end Transparent Clock ( ,    End-to-End)<br>
</td>
<td>   ,      ,  .    PTP   . <br>
<br>
       PTP-. <br>
<br>
                .<br>
 </td>
</tr>
<tr>
<td>Peer-to-Peer Transparent Clock ( ,    Peer-to-Peer)<br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Ger√§t mit mehreren Ports, das weder eine Hauptuhr noch ein Slave ist. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es √ºbertr√§gt PTP-Daten zwischen zwei Stunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Daten√ºbertragung korrigiert die transparente Uhr alle PTP-Nachrichten Sync und Follow_Up (mehr dazu weiter unten). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Korrektur wird erreicht, indem das Feld der Einstellung des √ºbertragenen Verz√∂gerungspakets auf dem sendenden Ger√§t und der Verz√∂gerung auf dem Datenkanal addiert wird.</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwaltungsknoten</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Ger√§t, das andere Uhren konfiguriert und diagnostiziert</font></font><br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Master- und Slave-Uhren werden mithilfe von Zeitstempeln in PTP-Nachrichten synchronisiert. </font><font style="vertical-align: inherit;">Es gibt zwei Arten von Nachrichten im PTP-Protokoll:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ereignismeldungen sind synchronisierte Nachrichten, bei denen zum Zeitpunkt des Sendens und zum Empfang einer Nachricht ein Zeitstempel generiert wird.</font></font></li>
<li>General Messages ‚Äì      ,        </li>
</ul><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>Event Messages<br>
</td>
<td>General Messages<br>
</td>
</tr>
<tr>
<td>Sync<br>
Delay_Req<br>
Pdelay_Req<br>
Pdelay_Resp<br>
</td>
<td>Announce<br>
Follow_Up<br>
Delay_Resp<br>
Pdelay_Resp_Follow_Up<br>
Management<br>
Signaling<br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes werden wir alle Arten von Nachrichten genauer betrachten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Hauptprobleme der Synchronisation</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bei der √úbertragung eines Synchronisationspakets √ºber ein lokales Netzwerk wird es auf dem Switch und im Daten√ºbertragungskanal verz√∂gert. </font><font style="vertical-align: inherit;">Jeder Schalter ergibt eine Verz√∂gerung von ca. 10 Œºs, was f√ºr PTPv2 nicht akzeptabel ist. </font><font style="vertical-align: inherit;">Immerhin m√ºssen wir am Endger√§t eine Genauigkeit von 1 Œºs erreichen. </font><font style="vertical-align: inherit;">(Dies ist der </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fall, </font><font style="vertical-align: inherit;">wenn es um Energie geht. Andere Anwendungen erfordern m√∂glicherweise eine h√∂here Genauigkeit.) </font><font style="vertical-align: inherit;">IEEE 1588v2 beschreibt mehrere Betriebsalgorithmen, mit denen Sie die Zeitverz√∂gerung aufzeichnen und anpassen k√∂nnen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betriebsalgorithmus</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
W√§hrend des normalen Betriebs arbeitet das Protokoll in zwei Phasen.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase 1 - Aufbau der Hierarchie ‚ÄûLeading Clock - Slave Clock‚Äú.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase 2 - Taktsynchronisation mit dem End-to-End-Mechanismus oder Peer-to-Peer.</font></font></li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase 1 - Aufbau einer Master-Slave-Hierarchie</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jeder Port einer regul√§ren oder Grenzuhr hat eine bestimmte Anzahl von Zust√§nden (Slave-Uhr und Master-Uhr). Der Standard beschreibt den √úbergangsalgorithmus zwischen diesen Zust√§nden. Bei der Programmierung wird ein solcher Algorithmus als Zustandsmaschine oder Zustandsmaschine bezeichnet (mehr im Wiki). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Zustandsmaschine verwendet den BMCA (Best Master Clock Algorithm), um den Master einzustellen, wenn zwei Stunden verbunden sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Algorithmus erm√∂glicht es der Uhr, die Verpflichtungen einer Gro√ümeisteruhr zu √ºbernehmen, wenn eine √ºberlegene Gro√ümeisteruhr ihr GPS-Signal verliert, sich vom Netzwerk trennt usw. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zustands√ºberg√§nge gem√§√ü BMCA sind in der folgenden Abbildung kurz dargestellt:</font></font><br>
<img src="https://habrastorage.org/webt/uy/hz/h6/uyhzh63gb0jt63bppsuuhcllwmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informationen √ºber die Uhr am anderen Ende des ‚ÄûKabels‚Äú werden in einer speziellen Nachricht (Announce-Nachricht) gesendet. </font><font style="vertical-align: inherit;">Wenn diese Informationen empfangen werden, verarbeitet und vergleicht der Zustandsmaschinenalgorithmus, welcher Takt besser ist. </font><font style="vertical-align: inherit;">Der Hafen der besten Uhren wird zur f√ºhrenden Uhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine einfache Hierarchie ist in der folgenden Abbildung dargestellt. </font><font style="vertical-align: inherit;">Die Pfade 1, 2, 3, 4, 5 k√∂nnen eine transparente Uhr (transparente Uhr) enthalten, sie sind jedoch nicht an der Erstellung der Hierarchie ‚ÄûF√ºhrende Uhr - Slave-Uhr‚Äú beteiligt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kj/md/ci/kjmdcibg-ls2rflwu6qtur-0osg.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase 2 - Synchronisation einer regul√§ren Uhr und einer Grenzuhr</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Unmittelbar nach Festlegung der Hierarchie ‚ÄûLeitstunden - Slave-Stunden‚Äú beginnt die Synchronisationsphase einer regul√§ren Uhr und einer Grenzuhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Synchronisation sendet die Hauptuhr eine Nachricht mit einem Zeitstempel an die Nebenuhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vorlaufzeiten k√∂nnen sein:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einstufig;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zweistufig.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine einstufige Uhr f√ºr die Synchronisation sendet eine Synchronisationsnachricht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine zweistufige Uhr verwendet zwei Nachrichten f√ºr die Synchronisation - Sync und Follow_Up. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr die Synchronisationsphase k√∂nnen zwei Mechanismen verwendet werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anforderungs- / Antwortmechanismus verz√∂gern.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer-Delay-Messmechanismus.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zun√§chst werden wir diese Mechanismen im einfachsten Fall betrachten - wenn keine transparenten Uhren verwendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verz√∂gerungsanforderungs-Antwort-Mechanismus </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Mechanismus besteht aus zwei Schritten:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Messung der Verz√∂gerung beim Senden einer Nachricht zwischen einer Hauptuhr und einem Slave. </font><font style="vertical-align: inherit;">Es wird unter Verwendung des Verz√∂gerungsanforderungs- / Antwortmechanismus durchgef√ºhrt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Korrigiert die Verschiebung der genauen Zeit.</font></font></li>
</ol><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verz√∂gerungsmessung</font></font></i><br>
<img src="https://habrastorage.org/webt/zj/hp/sa/zjhpsak259vihrylfiujf5vj2sm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
t1 - Synchronisieren der Sendezeit der Nachricht durch die f√ºhrende Uhr; t2 - Empfangszeit der Synchronisierungsnachricht mit der Slave-Uhr; t3 - Sendezeit der Verz√∂gerungsanforderung (Delay_Req) ‚Äã‚Äãum Slave-Stunden; t4 - Delay_Req Empfangszeit durch die f√ºhrende Uhr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Slave-Uhr die Zeit t1, t2, t3 und t4 kennt, kann sie die durchschnittliche Verz√∂gerung beim Senden der Synchronisationsnachricht (tmpd) ‚Äã‚Äãberechnen. Es wird wie folgt berechnet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e6/cz/qx/e6czqxjr1wen8eld_z4y16joa4k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der √úbertragung einer Sync- und Follow_Up-Nachricht wird die Zeitverz√∂gerung vom Master zum Slave berechnet - t-ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der √úbertragung von Delay_Req- und Delay_Resp-Nachrichten wird die Zeitverz√∂gerung vom Slave zum Master t-sm berechnet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn zwischen diesen beiden Werten eine gewisse Asymmetrie auftritt, tritt ein Fehler bei der Korrektur der Abweichung der genauen Zeit auf. Der Fehler wird durch die Tatsache verursacht, dass die berechnete Verz√∂gerung der Durchschnitt der Verz√∂gerungen t-ms und t-sm ist. Wenn die Verz√∂gerungen nicht gleich sind, werden wir die Zeit ungenau anpassen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Korrektur des Versatzes der genauen Zeit</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachdem die Verz√∂gerung zwischen der f√ºhrenden Uhr und der Nebenuhr bekannt ist, f√ºhrt die Nebenuhr die Zeitkorrektur durch. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/gv/qz/a7gvqzykdjxtg6nm5rcqhcqmyzs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Slave-Uhr verwendet die Sync-Nachricht und die optionale Follow_Up-Nachricht, um den genauen Zeitversatz beim √úbertragen des Pakets von der Master-Uhr zum Slave zu berechnen. Die Verschiebung wird nach folgender Formel berechnet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n1/rk/nw/n1rknwzr-r0qio-uf1a9iiqd_9o.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer-Delay-Messmechanismus</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dieser Mechanismus verwendet auch zwei Schritte zum Synchronisieren:</font></font><br>
<br>
<ol>
<li>         .     peer delay mechanism.</li>
<li>   .</li>
</ol><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer-to-Peer-</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Verz√∂gerungsmessung </font><i><font style="vertical-align: inherit;">Die Verz√∂gerung zwischen</font></i><font style="vertical-align: inherit;"> Peer-to-Peer- </font><i><font style="vertical-align: inherit;">f√§higen Ger√§ten</font></i><font style="vertical-align: inherit;"> wird anhand der folgenden Meldungen gemessen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eo/0o/y2/eo0oy26vhwksm1rel2znic_q8rs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Port 1 die Zeiten t1, t2, t3 und t4 kennt, kann er die durchschnittliche Verz√∂gerung (tmld) berechnen ) Die Berechnung erfolgt nach folgender Formel: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a6/3r/mc/a63rmc4ehosk81dvktfv4prevt0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Port verwendet diesen Wert dann bei der Berechnung des Anpassungsfelds f√ºr jede Synchronisierungsnachricht oder optionale Follow_Up-Nachricht, die dieses Ger√§t durchl√§uft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Gesamtverz√∂gerung ist gleich der Summe der Verz√∂gerung w√§hrend der √úbertragung durch dieses Ger√§t, der durchschnittlichen Verz√∂gerung w√§hrend der √úbertragung durch den Datenkanal und der bereits in dieser Nachricht enthaltenen Verz√∂gerung, die auf den h√∂heren Ger√§ten enthalten ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit den Nachrichten Pdelay_Req, Pdelay_Resp und optional Pdelay_Resp_Follow_Up k√∂nnen Sie eine Verz√∂gerung vom Master zum Slave und vom Slave zum Master erhalten (Rundschreiben). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Asymmetrie zwischen diesen beiden Werten f√ºhrt zu einem genauen Zeitversatzkorrekturfehler. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Korrigieren des Versatzes der genauen Zeit Die</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/m6/do/ku/m6dokuldnfjmqscwyrtin2tvjiu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Slave-Uhr verwendet die Sync-Nachricht und die optionale Follow_Up-Nachricht, um den Versatz der genauen Zeit beim √úbertragen des Pakets von der f√ºhrenden Uhr zum Slave zu berechnen. Die Verschiebung wird gem√§√ü der folgenden Formel berechnet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ub/ui/xk/ubuixkpfmzizo7ilzkdgyfwvh8c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vorteile Peer-to-Peer-Anpassung - Die Zeitverz√∂gerung jeder Sync- oder Follow_Up-Nachricht wird berechnet, wenn sie im Netzwerk √ºbertragen wird. Daher hat eine √Ñnderung des √úbertragungswegs keinen Einfluss auf die Genauigkeit der Einstellung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Verwendung dieses Mechanismus erfordert die Zeitsynchronisation nicht die Berechnung der Zeitverz√∂gerung auf dem vom Synchronisationspaket zur√ºckgelegten Pfad, wie dies bei einem Basisaustausch der Fall ist. Jene. Delay_Req- und Delay_Resp-Nachrichten werden nicht gesendet. Bei dieser Methode wird die Verz√∂gerung zwischen der Hauptuhr und den Followern einfach im Anpassungsfeld jeder Sync- oder Follow_Up-Nachricht summiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiterer Vorteil besteht darin, dass die Fahruhr entlastet wird, da Delay_Req-Nachrichten verarbeitet werden m√ºssen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funktionsweise transparenter Uhren</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dementsprechend wurden einfache Beispiele untersucht. Angenommen, auf dem Synchronisationspfad werden Schalter angezeigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Switches ohne PTPv2-Unterst√ºtzung verwenden, wird das Synchronisationspaket auf dem Switch um ca. 10 Œºs verz√∂gert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Switches, die PTPv2 in der IEEE 1588v2-Terminologie unterst√ºtzen, werden als transparente Uhren bezeichnet. </font><font style="vertical-align: inherit;">Die transparente Uhr ist nicht mit der f√ºhrenden Uhr synchronisiert und nimmt nicht an der Hierarchie ‚ÄûF√ºhrende Uhr - Slave-Uhr‚Äú teil. Bei der √úbertragung von Synchronisationsnachrichten merken sie sich jedoch, wie stark die Nachricht von ihnen verz√∂gert wurde. </font><font style="vertical-align: inherit;">Auf diese Weise k√∂nnen Sie die Zeitverz√∂gerung anpassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine transparente Uhr kann in zwei Modi arbeiten:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ende zu Ende.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peer-To-Peer.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">End-to-End (E2E) Die</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/cb/ev/vy/cbevvyylfmfgq9jgwm_jiuxvkjw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
transparente E2E-Uhr √ºbertr√§gt Synchronisierungsnachrichten und zugeh√∂rige Follow_Up-Nachrichten an alle Ports. Sogar diejenigen, die durch Protokolle blockiert sind (z. B. RSTP). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Switch merkt sich den Zeitstempel, zu dem das Synchronisierungspaket (Follow_Up) am Port empfangen und vom Port gesendet wurde. Basierend auf diesen beiden Zeitstempeln wird die Switch-Verarbeitungszeit f√ºr die Nachricht berechnet. In der Norm wird diese Zeit als Verweilzeit bezeichnet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verarbeitungszeit wird dem FeldrectionField der Sync-Nachricht (einstufige Uhr) oder Follow_Up (zweistufige Uhr) hinzugef√ºgt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hv/4q/rj/hv4qrjcuzer2hejocmtzitnntma.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die transparente E2E-Uhr misst die Verarbeitungszeit f√ºr Sync- und Delay_Req-Nachrichten, die den Switch durchlaufen. Es ist jedoch wichtig zu verstehen, dass die Zeitverz√∂gerung zwischen der f√ºhrenden Uhr und der Nebenuhr unter Verwendung des Verz√∂gerungsanforderungs-Antwort-Mechanismus berechnet wird. Wenn sich die Hauptuhr √§ndert oder sich der Pfad von der Hauptuhr zum Slave √§ndert, wird die Verz√∂gerung erneut gemessen. Dies erh√∂ht die √úbergangszeit bei Netzwerk√§nderungen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/im/q7/swimq7rpv2n24wyd8erbsvf420s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der transparente P2P-Takt misst zus√§tzlich zur Messung der Verarbeitungszeit der Nachricht durch den Switch die Verz√∂gerung auf dem Datenkanal zum n√§chsten Nachbarn unter Verwendung des Verz√∂gerungsmessmechanismus des benachbarten Knotens.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verz√∂gerung wird auf jedem Kanal in beide Richtungen gemessen, einschlie√ülich der Kan√§le, die durch ein Protokoll (z. B. RSTP) blockiert sind. </font><font style="vertical-align: inherit;">Auf diese Weise k√∂nnen Sie sofort eine neue Verz√∂gerung auf dem Synchronisationspfad berechnen, wenn sich die Gro√ümeisteruhr oder die Netzwerktopologie ge√§ndert hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Switch-Verarbeitungszeit und die Verz√∂gerungszeit werden beim Senden von Sync- oder Follow_Up-Nachrichten akkumuliert. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arten der Unterst√ºtzung f√ºr PTPv2-Switches</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Switches k√∂nnen PTPv2 unterst√ºtzen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programmatisch;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Softwareimplementierung des PTPv2-Protokolls fordert der Switch einen Zeitstempel von der Firmware an. </font><font style="vertical-align: inherit;">Das Problem ist, dass die Firmware zyklisch arbeitet und Sie warten m√ºssen, bis der aktuelle Zyklus abgeschlossen ist, die Anforderung verarbeitet wird und nach Ablauf des n√§chsten Zyklus ein Zeitstempel ausgegeben wird. </font><font style="vertical-align: inherit;">Dies wird auch einige Zeit dauern und wir werden eine Verz√∂gerung erhalten, wenn auch nicht so bedeutend wie ohne Softwareunterst√ºtzung f√ºr PTPv2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur die Hardware-Unterst√ºtzung f√ºr PTPv2 erm√∂glicht es Ihnen, die erforderliche Genauigkeit aufrechtzuerhalten. </font><font style="vertical-align: inherit;">In diesem Fall erfolgt die Ausgabe des Zeitstempels durch einen speziellen ASIC, der am Port installiert ist. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichtenformat</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alle PTP-Nachrichten bestehen aus folgenden Feldern:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Header - 34 Bytes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K√∂rper - Die Gr√∂√üe h√§ngt von der Art der Nachricht ab.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suffix (optional.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/ae/9l/_3/ae9l_3mph3pkhb-2oi0h_ppy48u.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Header</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Das Feld </font><b><font style="vertical-align: inherit;">Header</font></b><font style="vertical-align: inherit;"> ist f√ºr alle PTP-Nachrichten gleich. Seine Gr√∂√üe betr√§gt 34 ‚Äã‚ÄãBytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Format des </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/xs/gu/yuxsgundgrz9iyiyyfabaxt5i38.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Felds</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Header: </font><b><font style="vertical-align: inherit;">messageType</font></b><font style="vertical-align: inherit;"> ist der Typ der √ºbertragenen Nachricht, z. B. Sync, Delay_Req, PDelay_Req usw. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">messageLength</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - enth√§lt die volle Gr√∂√üe der PTP-Nachricht, einschlie√ülich Header, Body und Suffix (jedoch ohne F√ºllbytes). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">domainNumber</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bestimmt, zu welcher PTP-Dom√§ne die Nachricht geh√∂rt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Dom√§ne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> besteht aus einigen verschiedenen Uhren, die zu einer logischen Gruppe zusammengefasst und von einer f√ºhrenden Uhr synchronisiert sind, jedoch nicht unbedingt mit einer Uhr synchronisiert sind, die zu einer anderen Dom√§ne geh√∂rt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dieses Feld enth√§lt verschiedene Flags, um den Status der Nachricht zu identifizieren. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Korrekturfeld</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- enth√§lt die Verz√∂gerungszeit in Nanosekunden. Die Verz√∂gerungszeit umfasst die √úbertragungsverz√∂gerung durch den transparenten Takt sowie die √úbertragungsverz√∂gerung durch den Kanal bei Verwendung des Peer-to-Peer-Modus. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourcePortIdentity</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dieses Feld enth√§lt Informationen dar√ºber, von welchem ‚Äã‚ÄãPort diese Nachricht urspr√ºnglich gesendet wurde. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sequenceID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - enth√§lt die Identifikationsnummer f√ºr einzelne Nachrichten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlField</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Artefaktfeld =) Es stammt aus der ersten Version des Standards und enth√§lt Informationen zum Typ dieser Nachricht. Im Wesentlichen dasselbe wie messageType, jedoch mit weniger Optionen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">logMessageInterval</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dieses Feld wird durch den Nachrichtentyp bestimmt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K√∂rper</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie oben erl√§utert, gibt es verschiedene Arten von Nachrichten. Diese Typen werden im Folgenden beschrieben: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ank√ºndigungsnachricht Mit der Ank√ºndigungsnachricht werden</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
andere Uhren innerhalb derselben Dom√§ne √ºber ihre Einstellungen informiert. Mit dieser Nachricht k√∂nnen Sie die Hierarchie ‚ÄûLeading Clock - Slave Clock‚Äú einstellen. </font></font><br>
<img src="https://habrastorage.org/webt/-i/zs/dh/-izsdhnvkookhpjtrdrqx2myimy.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synchronisationsnachricht</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Eine Synchronisationsnachricht (Sync) wird von der Hauptuhr gesendet und enth√§lt die Uhrzeit der Hauptuhr zum Zeitpunkt der Erstellung der Synchronisierungsnachricht. Wenn die f√ºhrende Uhr zweistufig ist, wird der Zeitstempel in der Synchronisierungsnachricht auf 0 gesetzt und der aktuelle Zeitstempel in der gepaarten Follow_Up-Nachricht gesendet. Die Synchronisierungsnachricht wird f√ºr beide Verz√∂gerungsmessmechanismen verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachricht wird mit Multicast √ºbertragen. Sie k√∂nnen optional Unicast verwenden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sc/pp/1f/scpp1fns1uuyccw9bucbvghesgo.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delay_Req-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht Das Format der </font><b><font style="vertical-align: inherit;">Delay_Req-</font></b><font style="vertical-align: inherit;"> Nachricht ist identisch mit der Sync-Nachricht. Die Slave-Uhr sendet Delay_Req. Es enth√§lt die Zeit, zu der Delay_Req von der Slave-Uhr gesendet wurde. Diese Nachricht wird nur f√ºr den Verz√∂gerungsanforderungs-Antwort-Mechanismus verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachricht wird mit Multicast √ºbertragen. Sie k√∂nnen optional Unicast verwenden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fe/bm/r_/febmr_zz7v1dricuta5z88xmjqk.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Follow_Up-Nachricht Die Follow_Up-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht wird optional von der Hauptuhr gesendet und enth√§lt die Uhrzeit, zu der der </font><font style="vertical-align: inherit;">Assistent </font><font style="vertical-align: inherit;">die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synchronisierungsnachricht gesendet hat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Die Follow_Up-Nachricht wird nur von einer zweistufigen Fahruhr gesendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Follow_Up-Nachricht wird f√ºr beide Verz√∂gerungsmessmechanismen verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachricht wird mit Multicast √ºbertragen. Sie k√∂nnen optional Unicast verwenden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1g/42/2a/1g422aehbonsjrjjq0dwn9ceoxi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachricht Delay_Resp</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Delay_Resp-Nachricht wird von der Hauptuhr gesendet. Es enth√§lt die Zeit, zu der Delay_Req von der Hauptuhr empfangen wird. Diese Nachricht wird nur f√ºr den Verz√∂gerungsanforderungs-Antwort-Mechanismus verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nachricht wird mit Multicast √ºbertragen. Sie k√∂nnen optional Unicast verwenden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/up/is/gz/upisgzu5d7dk0iscixogmmjciwi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pdelay_Req-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht </font><b><font style="vertical-align: inherit;">Eine Pdelay_Req-</font></b><font style="vertical-align: inherit;"> Nachricht wird von einem Ger√§t gesendet, das eine Verz√∂gerung anfordert. Es enth√§lt die Zeit, zu der die Nachricht vom Port dieses Ger√§ts gesendet wurde. Pdelay_Req wird nur f√ºr den Mechanismus zur Messung der Verz√∂gerung benachbarter Knoten verwendet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/km/rz/hnkmrzmcidqsawxtazho-oprpus.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pdelay_Resp-Nachricht Die Pdelay_Resp-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht wird von dem Ger√§t gesendet, das die Verz√∂gerungsanforderung empfangen hat. Es enth√§lt die Zeit, zu der die Pdelay_Req-Nachricht von diesem Ger√§t empfangen wurde. Pdelay_Resp-Nachrichten werden nur f√ºr den Mechanismus zur Messung der Verz√∂gerung benachbarter Knoten verwendet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/bb/34/khbb34wn7ujy84lldruomgaenmg.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pdelay_Resp_Follow_Up-Nachricht Die Pdelay_Resp_Follow_Up-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachricht wird optional von dem Ger√§t gesendet, das die Verz√∂gerungsanforderung empfangen hat. </font><font style="vertical-align: inherit;">Es enth√§lt die Zeit, zu der die Pdelay_Req-Nachricht von diesem Ger√§t empfangen wurde. </font><font style="vertical-align: inherit;">Die Nachricht Pdelay_Resp_Follow_Up wird nur von einer zweistufigen Hauptuhr gesendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Nachricht kann anstelle eines Zeitstempels auch zur Laufzeit verwendet werden. </font><font style="vertical-align: inherit;">Die Ausf√ºhrungszeit ist die Zeit vom Empfang von Pdelay-Req bis zum Senden von Pdelay_Resp. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pdelay_Resp_Follow_Up werden nur f√ºr den Mechanismus zur Messung der Verz√∂gerung benachbarter Knoten verwendet. </font><font style="vertical-align: inherit;">
Steuernachrichten </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w7/-k/q2/w7-kq2pssesbnko10w1tmsrs9ow.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Verwaltungsnachricht)</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PTP-Steuernachrichten sind erforderlich, um Informationen zwischen einer oder mehreren Uhren und dem Steuerknoten zu √ºbertragen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/xi/c0/r7xic0kvnb_yurjc53bah53f2ss.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transfer zu LV</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine PTP-Nachricht kann auf zwei Ebenen √ºbertragen werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netzwerk - als Teil von IP-Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link - als Teil eines Ethernet-Frames.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Senden einer PTP-Nachricht √ºber UDP √ºber IP √ºber Ethernet </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/k6/al/f7k6alykkmt_4jrstkfkad_if-4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PTP √ºber UDP √ºber Ethernet </font><font style="vertical-align: inherit;">
PTP- </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/pe/wu/a7pewujvuii1chap6wppv51dh0k.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verf√ºgen √ºber viele ‚Äûflexible‚Äú Parameter, die konfiguriert werden m√ºssen. </font><font style="vertical-align: inherit;">Zum Beispiel:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BMCA-Optionen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Verz√∂gerungsmessmechanismus.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intervalle und Anfangswerte aller konfigurierbaren Parameter usw.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und trotz der Tatsache, dass wir zuvor gesagt haben, dass PTPv2-Ger√§te miteinander kompatibel sind, ist dies in guter Weise nicht der Fall. Ger√§te m√ºssen dieselben Einstellungen haben, um interagieren zu k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher gibt es sogenannte PTPv2-Profile. Profile sind Gruppen konfigurierter Einstellungen und bestimmter Protokollbeschr√§nkungen, sodass Sie die Zeitsynchronisierung f√ºr eine bestimmte Anwendung implementieren k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der IEEE 1588v2-Standard selbst beschreibt nur ein Profil - das ‚ÄûStandardprofil‚Äú. Alle anderen Profile werden von verschiedenen Organisationen und Verb√§nden erstellt und beschrieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise wurde das Leistungsprofil oder das PTPv2-Leistungsprofil vom Power Systems Relaying Committee und dem Substation Committee der IEEE Power and Energy Society erstellt. Das Profil selbst hei√üt IEEE C37.238-2011.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Profil beschreibt, dass PTP √ºbertragen werden kann:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur √ºber L2-Netzwerke (d. H. Ethernet, HSR, PRP, nicht IP).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichten werden nur von der Multicast-Mailingliste √ºbertragen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Peer-Verz√∂gerungsmessmechanismus wird als Verz√∂gerungsmessmechanismus verwendet.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Standarddom√§ne ist 0, die empfohlene Dom√§ne ist 93. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Philosophie beim Erstellen von C37.238-2011 war der Wunsch, die Anzahl der optionalen Funktionen zu reduzieren und nur die erforderlichen Funktionen f√ºr eine zuverl√§ssige Interaktion zwischen Ger√§ten zu belassen und die Systemstabilit√§t zu erh√∂hen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au√üerdem wird die Frequenz der Nachrichten√ºbertragung bestimmt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wc/gp/z9/wcgpz9du_jejtkxidtptsh9x53i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich steht nur ein Parameter zur Auswahl - der Typ des f√ºhrenden Takts (einstufig oder zweistufig). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Genauigkeit sollte nicht mehr als 1 Œºs betragen. </font><font style="vertical-align: inherit;">Mit anderen Worten k√∂nnen maximal 15 transparente Uhren oder drei Grenzstunden in einem Synchronisationspfad enthalten sein.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/et/zp/y0/etzpy01l2mtcewn9mxik3wyztrq.png"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495904/index.html">Kann eine Epidemie vorhergesagt werden?</a></li>
<li><a href="../de495908/index.html">Der Weg zur Belohnung</a></li>
<li><a href="../de495910/index.html">Installieren von ROS in einem Ubuntu Single-Board IMG-Image</a></li>
<li><a href="../de495912/index.html">Intelligente Wiederholungsaufkleber</a></li>
<li><a href="../de495918/index.html">Wie man realistischen Sound in Computerspielen und VR reproduziert und warum es schwierig ist</a></li>
<li><a href="../de495924/index.html">Warum ist es so verdammt schwierig, ein gutes COVID-19-Verteilungsmodell zu erstellen?</a></li>
<li><a href="../de495926/index.html">Wir schreiben Firmware f√ºr TI cc2530 auf Z-Stack 3.0 f√ºr ZigBee Sonoff BASICZBR3 Relais mit ds18b20 Sensor</a></li>
<li><a href="../de495932/index.html">Was ist die verborgene Bedeutung der Autoren im SCRUM-Handbuch? Teil 1. √úber den Prozess</a></li>
<li><a href="../de495934/index.html">DataGovernance zu Hause</a></li>
<li><a href="../de495938/index.html">Eine Auswahl von Artikeln zum maschinellen Lernen: F√§lle, Leitf√§den und Studien f√ºr M√§rz 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>