<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚å®Ô∏è üõ¢Ô∏è üíÉüèø Analizador PVS-Studio RunUO check üÖøÔ∏è ü§Ω üò¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo est√° dedicado a verificar el proyecto RunUO utilizando el analizador est√°tico PVS-Studio. RunUO es un emulador de software de servidor p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Analizador PVS-Studio RunUO check</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/487106/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/vz/nb/pkvznbl6d22oijuluuu2xfoztcs.png" alt="Foto 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo est√° dedicado a verificar el proyecto RunUO utilizando el analizador est√°tico PVS-Studio. </font><font style="vertical-align: inherit;">RunUO es un emulador de software de servidor para Ultima Online, un juego que una vez se gan√≥ los corazones de muchos fan√°ticos de MMORPG.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un emulador de software de servidor para MMORPG Ultima Online. El objetivo de este proyecto es crear un software estable que pueda competir con los servidores oficiales de EA Games. RunUO se cre√≥ en 2002, pero no pierde relevancia y se utiliza activamente hasta el d√≠a de hoy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El prop√≥sito de la verificaci√≥n del proyecto es popularizar el tema del an√°lisis est√°tico. Verificamos varios proyectos: juegos ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), bibliotecas ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mensajeros ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), navegadores ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) y mucho m√°s ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) para atraer la atenci√≥n de una audiencia diversa. Con estos art√≠culos, intentamos llamar la atenci√≥n sobre la importancia de utilizar el an√°lisis est√°tico en el desarrollo. El an√°lisis est√°tico hace que el c√≥digo sea m√°s confiable y seguro. Adem√°s, con su uso regular, puede encontrar y eliminar errores en las primeras etapas. Esto ahorra tiempo y esfuerzo a los desarrolladores, porque nadie quiere pasar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 horas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buscando el error que el analizador puede encontrar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n ayudamos a la comunidad de c√≥digo abierto. </font><font style="vertical-align: inherit;">A trav√©s de art√≠culos con errores encontrados, contribuimos al desarrollo de c√≥digo abierto. </font><font style="vertical-align: inherit;">Sin embargo, en los art√≠culos no analizamos todas las advertencias. </font><font style="vertical-align: inherit;">Algunas advertencias parec√≠an demasiado aburridas para nosotros para entrar en el art√≠culo, algunas resultaron ser falsos positivos, etc. </font><font style="vertical-align: inherit;">Por lo tanto, estamos listos para proporcionar una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">licencia gratuita</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para proyectos de c√≥digo abierto. </font><font style="vertical-align: inherit;">Adem√°s, lo que nos pareci√≥ aburrido para el art√≠culo puede parecer bastante interesante para los desarrolladores del proyecto que se est√° probando, porque los desarrolladores del proyecto a√∫n son m√°s conscientes de qu√© problemas son m√°s cr√≠ticos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Piezas de c√≥digo que llamaron la atenci√≥n al examinar el informe del analizador</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3010 Se requiere utilizar el valor de retorno de la funci√≥n 'Intern'. </font><font style="vertical-align: inherit;">BasePaintedMask.cs 49</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Intern</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> str </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( str == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( str.Length == <span class="hljs-number">0</span> )
    <span class="hljs-keyword">return</span> String.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> String.Intern( str );<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BasePaintedMask</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> staffer, <span class="hljs-keyword">int</span> itemid </span>)
                            : <span class="hljs-title">base</span>(<span class="hljs-params"> itemid + Utility.Random( <span class="hljs-number">2</span> </span>) )</span><font></font>
{<font></font>
  m_Staffer = staffer;<font></font>
<font></font>
  Utility.Intern( m_Staffer );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El valor de retorno del m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intern ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no se tiene en cuenta en ninguna parte, como lo indica el analizador. </font><font style="vertical-align: inherit;">Quiz√°s esto sea un error o un c√≥digo redundante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3017 Se detect√≥ un patr√≥n: (el elemento es BasePotion) || </font><font style="vertical-align: inherit;">((el art√≠culo es BasePotion) &amp;&amp; ...). </font><font style="vertical-align: inherit;">La expresi√≥n es excesiva o contiene un error l√≥gico. </font><font style="vertical-align: inherit;">Cleanup.cs 137</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsBuggable</span>(<span class="hljs-params"> Item item </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> Fists )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> ICommodity || item <span class="hljs-keyword">is</span> Multis.BaseBoat<font></font>
    || item <span class="hljs-keyword">is</span> Fish || item <span class="hljs-keyword">is</span> BigFish<font></font>
    || item <span class="hljs-keyword">is</span> BasePotion || item <span class="hljs-keyword">is</span> Food || item <span class="hljs-keyword">is</span> CookableFood<font></font>
    || item <span class="hljs-keyword">is</span> SpecialFishingNet || item <span class="hljs-keyword">is</span> BaseMagicFish<font></font>
    || item <span class="hljs-keyword">is</span> Shoes || item <span class="hljs-keyword">is</span> Sandals<font></font>
    || item <span class="hljs-keyword">is</span> Boots || item <span class="hljs-keyword">is</span> ThighBoots<font></font>
    || item <span class="hljs-keyword">is</span> TreasureMap || item <span class="hljs-keyword">is</span> MessageInABottle<font></font>
    || item <span class="hljs-keyword">is</span> BaseArmor || item <span class="hljs-keyword">is</span> BaseWeapon<font></font>
    || item <span class="hljs-keyword">is</span> BaseClothing<font></font>
    || ( item <span class="hljs-keyword">is</span> BaseJewel &amp;&amp; Core.AOS )<font></font>
    || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay subexpresiones que se pueden simplificar. </font><font style="vertical-align: inherit;">Los escribir√© para que quede m√°s claro:</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (item <span class="hljs-keyword">is</span> BasePotion || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML ))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culo es BasePotion = true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces la condici√≥n es verdadera, a pesar de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culo es BasePotion = false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces la condici√≥n es falsa, una vez m√°s, independientemente del valor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este c√≥digo suele ser simplemente redundante, sin embargo, hay situaciones peores cuando el programador cometi√≥ un error y escribi√≥ la variable incorrecta en la segunda subexpresi√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 Se puede simplificar una comprobaci√≥n excesiva. </font><font style="vertical-align: inherit;">El '||' </font><font style="vertical-align: inherit;">El operador est√° rodeado de expresiones opuestas 'bPlayerOnly' y '! bPlayerOnly'. </font><font style="vertical-align: inherit;">BaseCreature.cs 3005</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetFightModeRanking</span>(<span class="hljs-params"> Mobile m,
                                           FightMode acqType,
                                           <span class="hljs-keyword">bool</span> bPlayerOnly </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ( bPlayerOnly &amp;&amp; m.Player ) ||  !bPlayerOnly )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este c√≥digo es redundante o err√≥neo. </font><font style="vertical-align: inherit;">Su problema es que en ambos lados de '||' </font><font style="vertical-align: inherit;">son diferentes en el sentido de subexpresi√≥n. </font><font style="vertical-align: inherit;">Si lo cortamos as√≠:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ( m.Player || !bPlayerOnly )</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
entonces nada cambiar√°. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3001 Hay subexpresiones id√©nticas 'deed is SmallBrickHouseDeed' a la izquierda y a la derecha de '||' </font><font style="vertical-align: inherit;">operador. </font><font style="vertical-align: inherit;">RealEstateBroker.cs 132</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ComputePriceFor</span>(<span class="hljs-params"> HouseDeed deed </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">int</span> price = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> StonePlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> FieldStoneHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> WoodHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> WoodPlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> ThatchedRoofCottageDeed )<font></font>
      ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que no vale la pena explicar nada aqu√≠, el siguiente o el c√≥digo incorrecto o redundante. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3067 Es posible que se haya olvidado o comentado el bloque 'else', alterando as√≠ las l√≥gicas de operaci√≥n del programa. </font><font style="vertical-align: inherit;">BaseHouse.cs 1558</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetLockdown</span>(<span class="hljs-params"> Item i, <span class="hljs-keyword">bool</span> locked, <span class="hljs-keyword">bool</span> checkContains </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( m_LockDowns == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span>;<font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> Mondain's Legacy</span>
  <span class="hljs-keyword">if</span> ( i <span class="hljs-keyword">is</span> BaseAddonContainer )<font></font>
    i.Movable = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">else</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span><font></font>
<font></font>
  i.Movable = !locked;<font></font>
  i.IsLockedDown = locked;<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una advertencia bastante rara. </font><font style="vertical-align: inherit;">El analizador encontr√≥ sospechoso el formato del c√≥digo despu√©s de la directiva </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#endregion. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si no lee el c√≥digo, parece una l√≠nea</font></font><br>
<br>
<pre><code class="cs hljs">i.Movable = !locked;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
se ejecutar√° en cualquier caso, independientemente de la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Quiz√°s las llaves se olvidaron aqu√≠ ... En general, los desarrolladores deber√≠an verificar este c√≥digo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3043 La l√≥gica operativa del c√≥digo no se corresponde con su formato. </font><font style="vertical-align: inherit;">La declaraci√≥n est√° sangrada a la derecha, pero siempre se ejecuta. </font><font style="vertical-align: inherit;">Es posible que falten llaves. </font><font style="vertical-align: inherit;">Earthquake.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCast</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( Core.AOS )<font></font>
  {<font></font>
    damage = m.Hits / <span class="hljs-number">2</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ( !m.Player )<font></font>
      damage = Math.Max( Math.Min( damage, <span class="hljs-number">100</span> ), <span class="hljs-number">15</span> );<font></font>
      damage += Utility.RandomMinMax( <span class="hljs-number">0</span>, <span class="hljs-number">15</span> );            <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es posible que falten llaves en este c√≥digo. </font><font style="vertical-align: inherit;">Esta conclusi√≥n puede hacerse debido al extra√±o formato del c√≥digo en el cuerpo de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (! M.Player)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3083 Invocaci√≥n insegura del evento 'ServerStarted', NullReferenceException es posible. </font><font style="vertical-align: inherit;">Considere asignar un evento a una variable local antes de invocarlo. </font><font style="vertical-align: inherit;">EventSink.cs 921</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ServerStarted != <span class="hljs-literal">null</span> )<font></font>
    ServerStarted();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√©todo utiliza una llamada potencialmente insegura al </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlador de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eventos </font><i><font style="vertical-align: inherit;">RefreshStarted</font></i><font style="vertical-align: inherit;"> , como indica el analizador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øPor qu√© es peligroso? Imagina esta situaci√≥n. El evento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solo tiene un suscriptor. Y en el momento entre verificar nulo y llamar directamente al controlador de eventos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en otro hilo, se realiz√≥ una cancelaci√≥n de suscripci√≥n de este evento. Esto arrojar√° una </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La forma m√°s f√°cil de prevenir esta situaci√≥n es proporcionar una llamada de evento segura utilizando el operador '?.':</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ServerStarted?.Invoke();<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3054 Bloqueo de doble verificaci√≥n potencialmente inseguro. Use variables vol√°tiles o primitivas de sincronizaci√≥n para evitar esto. Item.cs 1624</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          m_RemovePacket = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          m_RemovePacket.SetStatic();<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La advertencia del analizador est√° asociada con el uso inseguro del patr√≥n de bloqueo doblemente verificado. Como puede ver en el c√≥digo anterior, se aplic√≥ un bloqueo de doble verificaci√≥n para implementar el patr√≥n generativo: Loners. Cuando intentamos obtener una instancia de la clase </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> accediendo a la propiedad </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el captador comprueba la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">igualdad del</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> campo </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> para cero. Si se aprueba la verificaci√≥n, </font><i><font style="vertical-align: inherit;">ingresamos</font></i><font style="vertical-align: inherit;"> al cuerpo de la declaraci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donde se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inicializa el</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> campo </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> . Una situaci√≥n interesante surge en el momento en que el hilo principal ya ha inicializado la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> trav√©s del constructor, pero a√∫n no ha llamado al m√©todo</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic ().</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Te√≥ricamente, otro hilo puede acceder a la propiedad </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el momento muy inconveniente. La comprobaci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para la igualdad a cero ya no fallar√°, y el hilo de llamada recibir√° un enlace a un objeto incompleto listo para usar. Para resolver este problema, </font><font style="vertical-align: inherit;">puede crear una variable intermedia de la clase </font><i><font style="vertical-align: inherit;">Packet</font></i><font style="vertical-align: inherit;"> en el cuerpo de la instrucci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , inicializarla mediante una llamada de constructor y el m√©todo </font><i><font style="vertical-align: inherit;">SetStatic (),</font></i><font style="vertical-align: inherit;"> y luego asignarla a la variable </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> . En este caso, el cuerpo de la declaraci√≥n de </font><i><font style="vertical-align: inherit;">bloqueo</font></i><font style="vertical-align: inherit;"> podr√≠a verse as√≠:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">lock</span> (_rpl)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    m_RemovePacket = instance;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema parece estar solucionado y el c√≥digo funcionar√° como se esperaba. Pero esto no es as√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un punto m√°s: el analizador no solo sugiere usar la palabra clave </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En la versi√≥n de lanzamiento del programa, el compilador puede realizar la optimizaci√≥n y reordenar las l√≠neas de la llamada al m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y asignar la variable de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instancia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (desde el punto de vista del compilador, la sem√°ntica del programa no ser√° violada). Y nuevamente volvemos al mismo punto donde comenzamos: la posibilidad de obtener la variable no inicializada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es imposible decir con exactitud cu√°ndo puede ocurrir este reordenamiento y si ocurrir√° en absoluto: puede verse afectado por la versi√≥n CLR, la arquitectura del procesador utilizado, etc. Todav√≠a vale la pena protegerse de tal escenario, y una de las soluciones (sin embargo, no la m√°s productiva) ser√° usar la palabra clave </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Una variable que se declarar√° con el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modificador vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no estar√° sujeta a permutaciones durante la optimizaci√≥n por parte del compilador. Un c√≥digo finalmente arreglado puede verse as√≠:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          instance.SetStatic();<font></font>
          m_RemovePacket = instance;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces, usar un </font><font style="vertical-align: inherit;">campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede ser indeseable debido a la sobrecarga de acceder a dicho campo. No nos detendremos en este tema en detalle, simplemente notando que en el ejemplo en consideraci√≥n, se necesita un registro de campo at√≥mico solo una vez (cuando se accede por primera vez a la propiedad), sin embargo, declarar el campo como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> har√° que el compilador haga su lectura y escritura at√≥mica eso puede no ser √≥ptimo en t√©rminos de rendimiento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, otro enfoque para corregir esta advertencia del analizador para evitar una sobrecarga adicional al declarar un </font><font style="vertical-align: inherit;">campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vol√°til</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es usar el tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para respaldar el campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en lugar de doble control de bloqueo. </font><font style="vertical-align: inherit;">En este caso, el cuerpo getter se puede reemplazar por el m√©todo inicializador, que se pasar√° al constructor de la instancia </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Lazy&lt;Packet&gt; m_RemovePacket = <span class="hljs-keyword">new</span> Lazy&lt;Packet&gt;(() =&gt;<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    <span class="hljs-keyword">return</span> instance;<font></font>
  }, LazyThreadSafetyMode.ExecutionAndPublication);<font></font>
<font></font>
....<font></font>
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket.Value;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√©todo de inicializador se llamar√° una vez, cuando se acceda al tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por primera vez, </font><font style="vertical-align: inherit;">y la seguridad de transmisi√≥n en caso de acceder a la propiedad desde varios subprocesos al mismo tiempo estar√° garantizada por el tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (el modo de seguridad de subprocesos se controla mediante el segundo par√°metro del constructor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3131 Se verifica la compatibilidad de la expresi√≥n 'espec√≠fica' con el tipo 'IAxe', pero se convierte al tipo 'Elemento'. </font><font style="vertical-align: inherit;">HarvestTarget.cs 61</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTarget</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, <span class="hljs-keyword">object</span> targeted </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( m_System <span class="hljs-keyword">is</span> Lumberjacking &amp;&amp;<font></font>
            targeted <span class="hljs-keyword">is</span> IAxe &amp;&amp; m_Tool <span class="hljs-keyword">is</span> BaseAxe )<font></font>
  {<font></font>
    IAxe obj = (IAxe)targeted;<font></font>
    Item item = (Item)targeted;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se </font><font style="vertical-align: inherit;">comprob√≥ que la </font><font style="vertical-align: inherit;">variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objetivo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pertenec√≠a al tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IAxe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero </font><font style="vertical-align: inherit;">nadie verific√≥ la </font><font style="vertical-align: inherit;">pertenencia al </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , como informa el analizador. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3070 La variable no inicializada 'Cero' se usa al inicializar la variable 'm_LastMobile'. Serial.cs 29</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Serial : IComparable, IComparable&lt;Serial&gt;<font></font>
{<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> m_Serial;<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastMobile = Zero;                <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastItem = <span class="hljs-number">0x40000000</span>;<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastMobile { .... }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastItem { .... }<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial MinusOne = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">-1</span> );
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial Zero = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">0</span> );     <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Serial</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> serial </span>)</span><font></font>
  {<font></font>
    m_Serial = serial;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como tal, no hay ning√∫n error aqu√≠, sin embargo, escribir esto no es muy bueno. Debido a la asignaci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_LastMobile al</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor de un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cero sin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inicializar </font><font style="vertical-align: inherit;">, se crear√° una estructura con el constructor predeterminado </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que conducir√° a la inicializaci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial = 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Y esto, a su vez, es equivalente a llamar a la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nueva serie (0)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De hecho, los desarrolladores tienen la suerte de que el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de serie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sea ‚Äã‚Äãigual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , si hubiera habido alg√∫n otro valor, esto conducir√≠a a un error. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3063 Una parte de la expresi√≥n condicional siempre es verdadera si se eval√∫a: m_Serial &lt;= 0x7FFFFFFF. Serial.cs 83</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> ( m_Serial &gt;= <span class="hljs-number">0x40000000</span> &amp;&amp; m_Serial &lt;= <span class="hljs-number">0x7FFFFFFF</span> );<font></font>
  }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el valor m√°ximo posible que puede contener </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por lo tanto, cualquiera que sea el valor que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tenga la</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><i><font style="vertical-align: inherit;">m_Serial</font></i><font style="vertical-align: inherit;"> , en cualquier caso ser√° menor o igual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3004 La declaraci√≥n 'then' es equivalente a la declaraci√≥n 'else'. </font><font style="vertical-align: inherit;">Serialization.cs 1571</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">try</span> <font></font>
  { <font></font>
    d = <span class="hljs-keyword">new</span> TimeSpan( ticks-now ); <font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> <font></font>
  {<font></font>
    <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
      d = TimeSpan.MaxValue; <font></font>
    <span class="hljs-keyword">else</span> <font></font>
      d = TimeSpan.MaxValue;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El analizador advierte sobre un c√≥digo sospechoso en el que las ramas verdadera y falsa de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">declaraci√≥n if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coinciden completamente. </font><font style="vertical-align: inherit;">Quiz√°s una de las ramas deber√≠a tener </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TimeSpan.MinValue. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se encontr√≥ el mismo c√≥digo en varios lugares: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 La declaraci√≥n 'then' es equivalente a la declaraci√≥n 'else'. </font><font style="vertical-align: inherit;">Item.cs 2103</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Serialize</span>(<span class="hljs-params"> GenericWriter writer </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 La declaraci√≥n 'then' es equivalente a la declaraci√≥n 'else'. </font><font style="vertical-align: inherit;">Serialization.cs 383</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Us√© "Esto" por una raz√≥n, es muy probable que, entre otras cosas, no podr√≠a funcionar sin copiar y pegar, estos fragmentos de c√≥digo se ven muy dolorosos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3051 Un tipo de molde excesivo. </font><font style="vertical-align: inherit;">El objeto ya es del tipo 'Elemento'. </font><font style="vertical-align: inherit;">Mobile.cs 11237</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> Item Talisman<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> FindItemOnLayer( Layer.Talisman ) <span class="hljs-keyword">as</span> Item;<font></font>
  }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Item <span class="hljs-title">FindItemOnLayer</span>(<span class="hljs-params"> Layer layer </span>)</span><font></font>
{<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta advertencia analizador puede obtenerse si se hace un uso excesivo de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> el operador </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No hay error en esta secci√≥n del c√≥digo, pero tampoco tiene sentido convertir el objeto en su propio tipo. </font><font style="vertical-align: inherit;">Advertencia de </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3148 El valor potencial 'nulo' de conversi√≥n de 'toSet' a un tipo de valor puede conducir a NullReferenceException. </font><font style="vertical-align: inherit;">Properties.cs 502</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ConstructFromString</span>(<span class="hljs-params"> .... </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">object</span> toSet;
  <span class="hljs-keyword">bool</span> isSerial = IsSerial( type );<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate into int32</span>
    type = m_NumericTypes[<span class="hljs-number">4</span>];<font></font>
<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">value</span> == <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    toSet = <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate back</span><font></font>
    toSet = (Serial)((Int32)toSet);<font></font>
<font></font>
  constructed = toSet;<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta secci√≥n del c√≥digo nos interesa el caso en que el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la variable </font><font style="vertical-align: inherit;">es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Entonces la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tambi√©n </font><i><font style="vertical-align: inherit;">es </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Adem√°s, si la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esSerial == verdadero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se </font><i><font style="vertical-align: inherit;">convierte</font></i><font style="vertical-align: inherit;"> en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que conducir√° a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede corregir este c√≥digo agregando, por ejemplo, 0 de forma predeterminada:</font></font><br>
<br>
<pre><code class="cs hljs">toSet = (Serial)((Int32)(toSet ?? <span class="hljs-number">0</span>));</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 Se puede simplificar una comprobaci√≥n excesiva. </font><font style="vertical-align: inherit;">El '||' </font><font style="vertical-align: inherit;">El operador est√° rodeado de expresiones opuestas 'pack == null' y 'pack! = null'. </font><font style="vertical-align: inherit;">BODBuyGump.cs 64</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnResponse</span>(<span class="hljs-params">Server.Network.NetState sender, RelayInfo info</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( (pack == <span class="hljs-literal">null</span>) ||<font></font>
       ((pack != <span class="hljs-literal">null</span>) &amp;&amp;<font></font>
        (!pack.CheckHold(<font></font>
                m_From,<font></font>
                item,<font></font>
                <span class="hljs-literal">true</span>,
                <span class="hljs-literal">true</span>,
                <span class="hljs-number">0</span>,<font></font>
                item.PileWeight + item.TotalWeight)) ) )<font></font>
  {<font></font>
    pv.SayTo(m_From, <span class="hljs-number">503204</span>);<font></font>
    m_From.SendGump(<span class="hljs-keyword">new</span> BOBGump(m_From, m_Book, m_Page, <span class="hljs-literal">null</span>));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este c√≥digo se puede simplificar, ya que el analizador informa: </font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ((pack == <span class="hljs-literal">null</span>) || ((pack != <span class="hljs-literal">null</span>) &amp;&amp; (!pack.CheckHold(....))))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la izquierda y a la derecha del operador '||' </font><font style="vertical-align: inherit;">hay expresiones que son opuestas en significado. </font><font style="vertical-align: inherit;">Aqu√≠ el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paquete de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verificaci√≥n </font><i><font style="vertical-align: inherit;">! = Nulo</font></i><font style="vertical-align: inherit;"> es redundante, porque antes de eso </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comprueba la condici√≥n opuesta </font><i><font style="vertical-align: inherit;">paquete == nulo</font></i><font style="vertical-align: inherit;"> , y estas expresiones est√°n separadas por el operador '||'. </font><font style="vertical-align: inherit;">Esta l√≠nea se puede acortar de la siguiente manera:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (pack == <span class="hljs-literal">null</span> || !pack.CheckHold(....))</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Advertencia:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3080 Posible desreferencia nula. </font><font style="vertical-align: inherit;">Considere inspeccionar 'ganador'. </font><font style="vertical-align: inherit;">CTF.cs 1302</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Finish_Callback</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  CTFTeamInfo winner = ( teams.Count &gt; <span class="hljs-number">0</span> ? teams[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span> );<font></font>
<font></font>
  .... <font></font>
<font></font>
  m_Context.Finish( m_Context.Participants[winner.TeamID] <span class="hljs-keyword">as</span> Participant );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Digamos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">equipos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El </font><i><font style="vertical-align: inherit;">conteo</font></i><font style="vertical-align: inherit;"> es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Entonces </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ganador = nulo.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y m√°s adelante en el c√≥digo, se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accede a la</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propiedad </font><i><font style="vertical-align: inherit;">winner.TeamID</font></i><font style="vertical-align: inherit;"> sin verificar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que dar√° como resultado el acceso por una referencia nula. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3041 La expresi√≥n se convirti√≥ impl√≠citamente de tipo 'int' a tipo 'doble'. Considere utilizar un molde de tipo expl√≠cito para evitar la p√©rdida de una parte fraccional. Un ejemplo: doble A = (doble) (X) / Y;. StormsEye.cs 87</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Gain</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, Skill skill </span>)</span> <font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">from</span>.Player &amp;&amp; <font></font>
     ( skills.Total / skills.Cap ) &gt;= Utility.RandomDouble())<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este fragmento de c√≥digo contiene la operaci√≥n de dividir las variables </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skill.Total</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Cap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que son de tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y el resultado se convierte impl√≠citamente en type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">double</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , como informa el analizador. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3085 El nombre del campo 'typeofObject' en un tipo anidado es ambiguo. El tipo externo contiene un campo est√°tico con un nombre id√©ntico. PropsGump.cs 744</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( <span class="hljs-keyword">object</span> );<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GroupComparer</span> : <span class="hljs-title">IComparer</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( Object );<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeofObject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se cre√≥ en esta secci√≥n de c√≥digo en una clase anidada </font><font style="vertical-align: inherit;">. Su problema es que en la clase externa hay una variable con el mismo nombre, y pueden ocurrir errores debido a esto. Es mejor no permitir esto para reducir la probabilidad de tales errores debido a la falta de atenci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio: los</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> accesores de propiedades V3140 utilizan diferentes campos de respaldo. WallBanner.cs 77</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_IsRewardItem;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsRewardItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_IsRewardItem; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_East;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> East<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_East; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y aqu√≠ hay un error que apareci√≥ debido a copiar y pegar. El m√©todo de acceso </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">establecido</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la </font><font style="vertical-align: inherit;">propiedad </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> era asignar un valor para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_East</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_IsRewardItem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Advertencias de </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio:</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3012 El operador '?:', Independientemente de su expresi√≥n condicional, siempre devuelve el mismo valor: 0xe7f. TreasureChestLevel2.cs 52 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3012 El operador '?:', Independientemente de su expresi√≥n condicional, siempre devuelve el mismo valor: 0xe77. TreasureChestLevel2.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetChestAppearance</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">bool</span> UseFirstItemId = Utility.RandomBool();<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>( Utility.RandomList( <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span> ) )<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<span class="hljs-comment">// Keg</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe7f</span> : <span class="hljs-number">0xe7f</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<span class="hljs-comment">// Barrel</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe77</span> : <span class="hljs-number">0xe77</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alg√∫n tipo de ilusi√≥n de elecci√≥n :) Independientemente del valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UseFirstItemId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.ItemID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe7f</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el primer caso o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe77</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el segundo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3066 Posible orden incorrecto de argumentos pasados ‚Äã‚Äãal m√©todo 'OnSwing': 'defensor' y 'atacante'. </font><font style="vertical-align: inherit;">BaseWeapon.cs 1188</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">AbsorbDamageAOS</span>(<span class="hljs-params"> Mobile attacker,
                                    Mobile defender,
                                    <span class="hljs-keyword">int</span> damage </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( weapon != <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    defender.FixedParticles(<span class="hljs-number">0x3779</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">15</span>,
                            <span class="hljs-number">0x158B</span>,
                            <span class="hljs-number">0x0</span>,
                            <span class="hljs-number">0x3</span>,<font></font>
                            EffectLayer.Waist);<font></font>
    weapon.OnSwing( defender, attacker );<font></font>
  }<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> TimeSpan <span class="hljs-title">OnSwing</span>(<span class="hljs-params"> Mobile attacker, Mobile defender </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> OnSwing( attacker, defender, <span class="hljs-number">1.0</span> );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al analizador le pareci√≥ sospechoso que el m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnSwing ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pasara argumentos en el orden inverso. </font><font style="vertical-align: inherit;">Quiz√°s esto se deba a un error. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3092 Las intersecciones de rango son posibles dentro de las expresiones condicionales. </font><font style="vertical-align: inherit;">Ejemplo: if (A&gt; 0 &amp;&amp; A &lt;5) {...} m√°s if (A&gt; 3 &amp;&amp; A &lt;9) {...}. </font><font style="vertical-align: inherit;">HouseFoundation.cs 1883</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsFixture</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> itemID </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31B0</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// ML doors</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID == <span class="hljs-number">0x2D46</span> ||<font></font>
           itemID == <span class="hljs-number">0x2D48</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE2</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE4</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x2D63</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x2D70</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31AF</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los rangos probados bajo condiciones se cruzan. </font><font style="vertical-align: inherit;">Esto le pareci√≥ sospechoso al analizador. </font><font style="vertical-align: inherit;">Incluso si este c√≥digo funciona correctamente, vale la pena arreglarlo. </font><font style="vertical-align: inherit;">Imagine una situaci√≥n en la que necesit√°ramos reescribir el cuerpo del √∫ltimo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as√≠, si la condici√≥n es verdadera, el m√©todo devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemID es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> igual a, digamos, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x319C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el m√©todo a√∫n devolver√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esto, a su vez, implicar√° la p√©rdida de tiempo para buscar errores.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RunUO se cre√≥ hace mucho tiempo, se ha realizado mucho trabajo, sin embargo, con el ejemplo de este proyecto puede ver los beneficios de usar an√°lisis est√°tico en proyectos con un historial. </font><font style="vertical-align: inherit;">El analizador de 543 mil l√≠neas de c√≥digo de proyecto emiti√≥ alrededor de 500 advertencias (sin contar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el nivel</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bajo), la mayor√≠a de las cuales no aparecieron en el art√≠culo debido a su uniformidad. </font><font style="vertical-align: inherit;">Para familiarizarse con el resultado del an√°lisis en m√°s detalle, sugiero usar una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">licencia gratuita para proyectos de c√≥digo abierto</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea compartir este art√≠culo con una audiencia de habla inglesa, utilice el enlace a la traducci√≥n: Ekaterina Nikiforova. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO Check con el analizador PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es487092/index.html">Modelado de procesos comerciales como parte de un proyecto para implementar un sistema ERP</a></li>
<li><a href="../es487094/index.html">Reprocesamiento de eventos recibidos de Kafka</a></li>
<li><a href="../es487096/index.html">Fragmentos C√≥mo facilitar el proceso de trabajar con documentaci√≥n</a></li>
<li><a href="../es487098/index.html">Dibujar con hormigas: im√°genes de procedimiento utilizando algoritmos de optimizaci√≥n de colonias de hormigas</a></li>
<li><a href="../es487100/index.html">Estructuras de datos inmutables de √∫ltima generaci√≥n.</a></li>
<li><a href="../es487108/index.html">Perfil de jugador m√≥vil: MyTracker Research</a></li>
<li><a href="../es487110/index.html">Slurm SRE. Un experimento completo con expertos de Booking.com y Google.com.</a></li>
<li><a href="../es487112/index.html">Edge of Madness: The Basic Circle</a></li>
<li><a href="../es487116/index.html">Por qu√© Discord migra de Go to Rust</a></li>
<li><a href="../es487118/index.html">Loki: recopilaci√≥n de registros utilizando el enfoque de Prometeo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>