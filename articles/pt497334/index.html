<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∞üèº üï∫üèø üèåÔ∏è Os erros not√≥rios e como evit√°-los no exemplo do ClickHouse üë®üèæ‚ÄçüöÄ üåßÔ∏è üò¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se voc√™ estiver escrevendo c√≥digo, prepare-se para problemas. Definitivamente ser√£o, e devem ser esperados de todos os lados: do seu c√≥digo e compilad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Os erros not√≥rios e como evit√°-los no exemplo do ClickHouse</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/497334/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ estiver escrevendo c√≥digo, prepare-se para problemas. </font><font style="vertical-align: inherit;">Definitivamente ser√£o, e devem ser esperados de todos os lados: do seu c√≥digo e compilador, do sistema operacional e do hardware, e os usu√°rios √†s vezes lan√ßam "surpresas". </font><font style="vertical-align: inherit;">Se voc√™ escalou o cluster para escalas c√≥smicas, espere erros de "espa√ßo". </font><font style="vertical-align: inherit;">Especialmente quando se trata de dados do tr√°fego da Internet.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/ooBAQIe0KlQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexey Milovidov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o6CuFl2Q</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) falar√° sobre os problemas mais rid√≠culos, desanimadores e sem esperan√ßa da sua experi√™ncia no desenvolvimento e suporte ao ClickHouse. </font><font style="vertical-align: inherit;">Vamos ver como eles tiveram que ser depurados e quais medidas os desenvolvedores devem tomar desde o in√≠cio, para que haja menos problemas.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erros not√≥rios</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ escreveu algum c√≥digo, prepare-se para problemas imediatamente. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erros no c√≥digo.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eles ser√£o necess√°rios. Mas digamos que voc√™ escreveu o c√≥digo perfeito, compilado, mas os bugs aparecer√£o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no compilador</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o c√≥digo n√£o funcionar√° corretamente. Consertamos o compilador, tudo compilado - execute-o. Mas (inesperadamente) tudo funciona incorretamente, porque </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m h√° bugs no kernel do sistema operacional</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se n√£o houver erros no sistema operacional, inevitavelmente, eles estar√£o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no hardware</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mesmo se voc√™ escreveu o c√≥digo perfeito que funciona perfeitamente no hardware perfeito, ainda encontrar√° problemas, por exemplo, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erros de configura√ß√£o</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Parece que voc√™ fez tudo certo, mas algu√©m cometeu um erro no arquivo de configura√ß√£o e tudo n√£o funciona novamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando todos os erros foram corrigidos, os usu√°rios o terminam, porque constantemente usam seu c√≥digo "incorretamente". </font><font style="vertical-align: inherit;">Mas o problema definitivamente n√£o est√° nos usu√°rios, mas no c√≥digo: voc√™ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escreveu algo que √© dif√≠cil de usar</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos esses erros com alguns exemplos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erros de configura√ß√£o</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exclus√£o de dados</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O primeiro caso da pr√°tica. Felizmente, nem o meu nem o Yandex, n√£o se preocupe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introdut√≥rio primeiro. A arquitetura de um cluster de redu√ß√£o de mapa (como o Hadoop) consiste em v√°rios servidores de dados (n√≥s de dados) que armazenam dados e em um ou mais servidores principais que sabem a localiza√ß√£o de todos os dados nos servidores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os n√≥s de dados conhecem o endere√ßo do mestre e se conectam a ele. O assistente monitora onde e quais dados devem ser localizados e fornece comandos diferentes para os n√≥s de dados: ‚ÄúFa√ßa o download dos dados X, voc√™ deve ter os dados Y e exclua os dados Z‚Äù. O que poderia dar errado?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando um novo arquivo de configura√ß√£o foi carregado em todos os n√≥s de dados, eles se conectaram por engano ao mestre de outro cluster e n√£o ao pr√≥prio. </font><font style="vertical-align: inherit;">O mestre examinou os dados sobre os quais os n√≥s foram informados, decidiu que os dados estavam incorretos e deveriam ser exclu√≠dos. </font><font style="vertical-align: inherit;">O problema foi percebido quando metade dos dados foi apagada.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/s8/ii/6i/s8ii6igrww4j3zdjhrfyyqrl2nk.png" width="350"></div><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os bugs mais √©picos s√£o aqueles que levam √† exclus√£o acidental de dados.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Evitar isso √© muito simples. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o apague dados</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por exemplo, reserve em um diret√≥rio separado ou exclua com um atraso. Primeiro, transferimos para que eles n√£o fiquem vis√≠veis para o usu√°rio e, se ele descobrir que algo desapareceu dentro de alguns dias, n√≥s o devolveremos. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o exclua dados inesperados se a causa for desconhecida</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Limite programaticamente o in√≠cio da exclus√£o de dados desconhecidos: inesperado, com nomes estranhos ou se houver muitos deles. O administrador notar√° que o servidor n√£o inicia e grava alguma mensagem e entender√°. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o programa executar a√ß√µes destrutivas - isole os testes e a produ√ß√£o no n√≠vel da rede</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(iptables). Por exemplo, excluir arquivos ou enviar e-mail √© uma a√ß√£o destrutiva, pois "consome" a aten√ß√£o de algu√©m. Coloque um limite neles: cem cartas podem ser enviadas e, para mil, coloque uma caixa de sele√ß√£o de seguran√ßa, que √© definida antes que algo terr√≠vel aconte√ßa. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√µes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O segundo exemplo j√° √© da minha pr√°tica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma boa empresa de alguma forma tinha um cluster ClickHouse estranho. O estranho √© que as r√©plicas n√£o foram sincronizadas. Quando o servidor foi reiniciado, ele n√£o foi iniciado e apareceu uma mensagem informando que todos os dados estavam incorretos: ‚ÄúExistem muitos dados inesperados, n√£o inicio. Temos que armar a bandeira </font></font><code>force_restore_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e descobrir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ningu√©m conseguiu descobrir isso na empresa - eles apenas definiram a bandeira. Ao mesmo tempo, metade dos dados desapareceu em algum lugar, resultando em gr√°ficos com lacunas. Os desenvolvedores se voltaram para mim, pensei que algo interessante estava acontecendo e decidi investigar. Quando a manh√£ chegou algumas horas depois e os p√°ssaros come√ßaram a cantar do lado de fora da janela, percebi que n√£o entendia nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O servidor ClickHouse usa o servi√ßo ZooKeeper para coordena√ß√£o. O ClickHouse armazena dados e o ZooKeeper determina em quais servidores quais dados devem estar: armazena metadados sobre quais dados em que r√©plica deve estar. O ZooKeeper tamb√©m √© um cluster - ele se replica de acordo com um algoritmo de consenso distribu√≠do muito bom, com consist√™ncia estrita.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como regra, o ZooKeeper √© de 3 m√°quinas, √†s vezes 5. Todas as m√°quinas s√£o listadas na configura√ß√£o do ClickHouse de uma s√≥ vez, uma conex√£o √© estabelecida com uma m√°quina aleat√≥ria, interage com ela e esse servidor replica todas as solicita√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que aconteceu? A empresa tinha tr√™s servidores ZooKeeper. Mas eles n√£o funcionaram como um </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cluster de tr√™s n√≥s</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas como </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tr√™s n√≥s independentes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tr√™s clusters de um n√≥. Um ClickHouse se conecta a um servidor e grava dados. As r√©plicas desejam fazer o download desses dados, mas eles n√£o s√£o encontrados em nenhum lugar. Ao reiniciar, o servidor se conecta a outro ZooKeeper: v√™ que os dados com os quais trabalhou antes s√£o sup√©rfluos, devem ser adiados em algum lugar. Ele n√£o os exclui, mas os transfere para um diret√≥rio separado - os dados do ClickHouse n√£o s√£o exclu√≠dos com tanta facilidade.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decido corrigir a configura√ß√£o do ZooKeeper. </font><font style="vertical-align: inherit;">Renomeio todos os dados e solicito </font></font><code>ATTACH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partes dos dados do diret√≥rio </font></font><code>detached/unexpeted_*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, todos os dados foram restaurados, as r√©plicas foram sincronizadas, n√£o houve perdas, os gr√°ficos foram cont√≠nuos. </font><font style="vertical-align: inherit;">A empresa est√° satisfeita, agradecida, como se j√° tivessem esquecido como tudo funcionara mal antes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses eram erros de configura√ß√£o simples. </font><font style="vertical-align: inherit;">Mais bugs estar√£o no c√≥digo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erros no c√≥digo</font></font></h2><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escrevemos c√≥digo em C ++. </font><font style="vertical-align: inherit;">Isso significa que j√° temos problemas.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pr√≥ximo exemplo √© um bug real da produ√ß√£o no </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cluster Yandex.Metrica</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (2015) - uma consequ√™ncia do c√≥digo C ++. </font><font style="vertical-align: inherit;">O erro era que, √†s vezes, o usu√°rio, em vez de responder √† solicita√ß√£o, recebia uma mensagem de erro:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúA soma de verifica√ß√£o n√£o corresponde, dados corrompidos‚Äù - a soma de verifica√ß√£o n√£o corresponde, os dados est√£o quebrados - assustador!</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"O LRUCache se tornou inconsistente. </font><font style="vertical-align: inherit;">Deve haver um bug nele ‚Äù- o cache se tornou inconsistente, provavelmente um bug nele.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo que escrevemos informa que existe um bug l√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"A </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soma de verifica√ß√£o n√£o corresponde, dados corrompidos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ." </font><font style="vertical-align: inherit;">As somas dos blocos de dados compactados s√£o verificadas antes de serem descompactadas. </font><font style="vertical-align: inherit;">Geralmente, esse erro aparece quando os dados s√£o quebrados no sistema de arquivos. </font><font style="vertical-align: inherit;">Por v√°rias raz√µes, alguns arquivos acabam sendo lixo quando o servidor √© reiniciado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas aqui est√° outro caso: eu li o arquivo manualmente, a soma da verifica√ß√£o corresponde, n√£o h√° erro. </font><font style="vertical-align: inherit;">Uma vez exibido, o erro √© reproduzido de forma est√°vel mediante solicita√ß√£o repetida. </font><font style="vertical-align: inherit;">Quando o servidor √© reiniciado, o erro desaparece por um tempo e, em seguida, aparece de forma est√°vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez o problema esteja na RAM? </font><font style="vertical-align: inherit;">Uma situa√ß√£o t√≠pica √© quando os bits est√£o batendo nela. </font><font style="vertical-align: inherit;">Eu olho em </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dmesg</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(kern.log), mas n√£o h√° exce√ß√µes na verifica√ß√£o da m√°quina - elas geralmente escrevem quando algo est√° errado com a RAM. Se o servidor tivesse ultrapassado a RAM, n√£o apenas o meu programa funcionaria incorretamente, mas todos os outros gerariam erros aleatoriamente. No entanto, n√£o h√° outras manifesta√ß√µes do erro. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"O LRUCache se tornou inconsistente. Deve haver um bug nele. "</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este √© um erro claro no c√≥digo, e estamos escrevendo em C ++ - talvez acesso √† mem√≥ria? Mas os testes em AddressSanitizer, ThreadSanitizer, MemorySanitizer, UndefinedBehaviorSanitizer no IC n√£o mostram nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez alguns casos de teste n√£o sejam cobertos? Eu coleciono o servidor com o AddressSanitizer, o executo na produ√ß√£o - ele n√£o captura nada. Por algum tempo, o erro √© resolvido ao redefinir algum cache de marca (cache de sach√™).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das regras de programa√ß√£o diz: se n√£o estiver claro qual √© o erro, observe atentamente o c√≥digo, esperando encontrar algo l√°. Fiz isso, encontrei um bug, consertei - n√£o ajudou. Eu olho para outro lugar no c√≥digo - tamb√©m h√° um bug. Corrigido, novamente n√£o ajudou. Corrigi mais um pouco, o c√≥digo melhorou, mas o erro ainda n√£o desapareceu! </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Causa.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tentando encontrar um padr√£o por servidor, por tempo, pela natureza da carga - nada ajuda. Ent√£o ele percebeu que o problema se manifesta apenas em um dos agrupamentos e nunca nos outros. O erro n√£o √© reproduzido com tanta frequ√™ncia, mas sempre aparece em um cluster ap√≥s uma reinicializa√ß√£o e tudo est√° limpo no outro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verificou-se que o motivo √© que no cluster ‚Äúproblema‚Äù eles usaram um novo recurso - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dicion√°rios de cache</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eles usam o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alocador de</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mem√≥ria manuscrita </font><strong><font style="vertical-align: inherit;">ArenaWithFreeLists</font></strong><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">N√£o apenas escrevemos em C ++, mas tamb√©m vimos algum tipo de alocadores personalizados - nos condenamos a problemas duas vezes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ArenaWithFreeLists √© uma parte da mem√≥ria na qual a mem√≥ria √© alocada consecutivamente em tamanhos divis√≠veis por dois: 16, 32, 64 bytes. </font><font style="vertical-align: inherit;">Se a mem√≥ria for liberada, eles formar√£o uma lista isolada de blocos gratuitos de FreeLists. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos dar uma olhada no c√≥digo.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArenaWithFreeLists</span>
{</span>
    Block * free_lists[<span class="hljs-number">16</span>] {};
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">sizeToPreviousPowerOfTwo</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> size)</span>
    </span>{
        <span class="hljs-keyword">return</span> _bit_scan_reverse(size - <span class="hljs-number">1</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">char</span> * <span class="hljs-title">alloc</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> size)</span>
    </span>{
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> list_idx = findFreeListIndex(size);<font></font>
        free_lists[list_idx] -&gt;...<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele usa uma fun√ß√£o </font></font><code>_bit_scan_reverse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um sublinhado no in√≠cio.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe uma regra n√£o escrita: "Se uma fun√ß√£o tiver um sublinhado no in√≠cio, leia a documenta√ß√£o uma vez e, se houver duas, leia duas vezes".</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvimos e lemos a documenta√ß√£o: ‚Äúint _bit_scan_reverse (int a). Defina dst como o √≠ndice do bit mais alto definido no n√∫mero inteiro de 32 bits a. Se nenhum bit estiver definido em um, ent√£o dst ser√° </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indefinido</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . " Parece que encontramos um problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No C ++, essa situa√ß√£o √© considerada imposs√≠vel para o compilador. O compilador pode usar um comportamento indefinido, essa "impossibilidade", como uma suposi√ß√£o para otimizar o c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O compilador n√£o faz nada errado - honestamente gera instru√ß√µes de montagem </font></font><code>bsr %edi, %eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mas, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se o operando for zero, a instru√ß√£o </font></font></strong><code><strong>bsr</strong></code><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ter√° um comportamento indefinido, n√£o no n√≠vel C ++, mas no n√≠vel da CPU.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se o registro de origem for zero, o registro de destino n√£o ser√° alterado: havia algum lixo na entrada, esse lixo tamb√©m permanecer√° na sa√≠da.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O resultado depende de onde o compilador coloca essa instru√ß√£o. </font><font style="vertical-align: inherit;">√Äs vezes, uma fun√ß√£o com esta instru√ß√£o est√° embutida, √†s vezes n√£o. </font><font style="vertical-align: inherit;">No segundo caso, haver√° algo como este c√≥digo:</font></font><br>
<br>
<pre><code class="cpp hljs">bsrl %edi, %eax<font></font>
retq</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o eu olhei para um exemplo de c√≥digo semelhante no meu bin√°rio usando </font></font><code>objdump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lq/6k/4f/lq6k4fg0lwpm2nhwhxbyauyjt2c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com os resultados, vejo que algumas vezes o registro de origem e o destino s√£o iguais. </font><font style="vertical-align: inherit;">Se houvesse zero, o resultado tamb√©m ser√° zero - est√° tudo bem. </font><font style="vertical-align: inherit;">Mas √†s vezes os registros s√£o diferentes, e o resultado ser√° lixo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como esse bug se manifesta?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usamos lixo como um √≠ndice na matriz FreeLists. </font><font style="vertical-align: inherit;">Em vez de uma matriz, vamos para um endere√ßo distante e obtemos acesso √† mem√≥ria.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos sorte, quase todos os endere√ßos pr√≥ximos s√£o preenchidos com dados do cache - n√≥s estragamos o cache. </font><font style="vertical-align: inherit;">O cache cont√©m deslocamentos de arquivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lemos os arquivos no deslocamento errado. </font><font style="vertical-align: inherit;">Do deslocamento errado, obtemos a soma do cheque. </font><font style="vertical-align: inherit;">Mas n√£o h√° uma soma de verifica√ß√£o, mas outra coisa - essa soma de verifica√ß√£o n√£o coincidir√° com os seguintes dados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recebemos o erro "A soma de verifica√ß√£o n√£o corresponde, dados corrompidos".</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente, n√£o h√° dados corrompidos, mas apenas o cache da RAM. </font><font style="vertical-align: inherit;">Fomos informados imediatamente sobre o erro, porque verificamos a soma dos dados. </font><font style="vertical-align: inherit;">O erro foi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corrigido</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em 27 de dezembro de 2015 e foi comemorado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, o c√≥digo errado pode pelo menos ser corrigido. </font><font style="vertical-align: inherit;">Mas como consertar bugs no hardware?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erros no ferro</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses nem s√£o erros, mas leis f√≠sicas - efeitos inevit√°veis. De acordo com as leis da f√≠sica, o ferro √© inevitavelmente danificado. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grava√ß√£o n√£o at√¥mica para RAID</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por exemplo, criamos o RAID1. Consiste em dois discos r√≠gidos. Isso significa que um servidor √© um sistema distribu√≠do: os dados s√£o gravados em um disco r√≠gido e em outro. Mas e se os dados forem gravados em um disco e a energia for perdida durante a grava√ß√£o no segundo? Os dados em uma matriz RAID1 n√£o ser√£o consistentes. N√£o conseguiremos entender quais dados est√£o corretos, porque leremos um byte ou outro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode lidar com isso colocando o log. Por exemplo, no ZFS, esse problema foi resolvido, mas mais tarde. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podrid√£o de bits no HDD e SSD</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Os bits nos discos r√≠gidos e nos SSDs podem ficar ruins assim. Os SSDs modernos, especialmente aqueles com c√©lulas de v√°rios n√≠veis, s√£o projetados para garantir que as c√©lulas se deteriorem constantemente. Os c√≥digos de corre√ß√£o de erros ajudam, mas √†s vezes as c√©lulas se deterioram tanto e at√© isso n√£o salva. Erros n√£o detectados s√£o obtidos. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pouco vira na RAM</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (mas e o ECC?). Na RAM dos servidores, os bits tamb√©m est√£o corrompidos. Tamb√©m possui c√≥digos de corre√ß√£o de erros. Quando ocorrem erros, eles geralmente s√£o vis√≠veis nas mensagens no log do kernel do Linux no dmesg. Quando houver muitos erros, veremos algo como: "N milh√µes de erros com mem√≥ria foram corrigidos". Mas bits individuais n√£o ser√£o notados e, com certeza, algo ficar√° com erros. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit vira no n√≠vel da CPU e da rede</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Existem erros no n√≠vel da CPU, nos caches da CPU e, √© claro, na transmiss√£o de dados pela rede.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como os erros de ferro geralmente se manifestam? O ticket " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um znode malformado impede que o ClickHouse seja iniciado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">chega ao GitHub </font><font style="vertical-align: inherit;">- os dados no n√≥ ZooKeeper est√£o corrompidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No ZooKeeper, geralmente escrevemos alguns metadados em texto simples. H√° algo errado com ele - " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©plica</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " est√° escrito muito estranho. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8_/gk/zk/8_gkzkxlb1dzwhiph0saer-0d50.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Raramente acontece que, devido a um erro no c√≥digo, um bit seja alterado. Claro, podemos escrever um c√≥digo assim: pegamos o filtro Bloom, alteramos o bit em determinados endere√ßos, calculamos os endere√ßos incorretamente, alteramos o bit errado, ele cai em alguns dados. √â isso a√≠, agora no ClickHouse n√£o √© " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©plica"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repli </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " e todos os dados est√£o errados. Mas geralmente, uma </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mudan√ßa em um bit √© um sintoma de problemas de ferro</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez voc√™ conhe√ßa o exemplo de bitsquatting. </font><font style="vertical-align: inherit;">Artyom Dinaburg </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fez um experimento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : existem dom√≠nios na Internet com muito tr√°fego, embora os usu√°rios n√£o acessem esses dom√≠nios por conta pr√≥pria. </font><font style="vertical-align: inherit;">Por exemplo, esse dom√≠nio FB-CDN.com √© um CDN do Facebook. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artyom registrou um dom√≠nio semelhante (e muitos outros), mas mudou um pouco. </font><font style="vertical-align: inherit;">Por exemplo, FA-CDN.com em vez de FB-CDN.com. </font><font style="vertical-align: inherit;">O dom√≠nio n√£o foi publicado em nenhum lugar, mas o tr√°fego chegou a ele. </font><font style="vertical-align: inherit;">√Äs vezes, o host FB-CDN foi gravado nos cabe√ßalhos HTTP e a solicita√ß√£o foi para outro host devido a erros na RAM nos dispositivos dos usu√°rios. </font><font style="vertical-align: inherit;">RAM com corre√ß√£o de erros nem sempre ajuda. </font><font style="vertical-align: inherit;">√Äs vezes, at√© interfere e leva a vulnerabilidades (leia sobre Rowhammer, ECCploit, RAMBleed).</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o: sempre verifique os dados voc√™ mesmo.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao gravar no sistema de arquivos, verifique a soma sem falha. </font><font style="vertical-align: inherit;">Ao transmitir pela rede, verifique tamb√©m resumir - n√£o espere que haja somas de verifica√ß√£o l√°.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais bugs! ..</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©tricas de Cluster de Produ√ß√£o</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√Äs vezes, os usu√°rios em resposta a uma solicita√ß√£o recebem uma exce√ß√£o: ‚ÄúA soma de verifica√ß√£o n√£o corresponde: dados corrompidos‚Äù - a soma da verifica√ß√£o n√£o est√° correta, os dados est√£o corrompidos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/lb/wz/jylbwzqxrbk-g3hgygq4bktgdr8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A mensagem de erro exibe dados detalhados: qual valor de cheque era esperado, qual valor de cheque realmente est√° nesses dados, o tamanho do bloco para o qual verificamos o valor de cheque e o contexto de exce√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando recebemos o pacote pela rede de algum servidor, uma exce√ß√£o apareceu - parece familiar. </font><font style="vertical-align: inherit;">Talvez novamente passando pela mem√≥ria, condi√ß√£o de ra√ßa ou outra coisa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta exce√ß√£o apareceu em 2015. O bug foi corrigido, n√£o apareceu mais. Em fevereiro de 2019, ele apareceu de repente novamente. Nessa √©poca, eu estava em uma das confer√™ncias, meus colegas lidaram com o problema. O erro foi reproduzido v√°rias vezes ao dia entre 1000 servidores com ClickHouse: n√£o √© poss√≠vel coletar estat√≠sticas em um servidor e depois em outro. Ao mesmo tempo, n√£o havia novos lan√ßamentos no momento. N√£o deu certo e resolveu o problema, mas depois de alguns dias o erro desapareceu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles esqueceram o erro e, em 15 de maio de 2019, repetiu. Continuamos a lidar com ela. A primeira coisa que fiz foi examinar todos os logs e gr√°ficos dispon√≠veis. Ele os estudou o dia inteiro, n√£o entendeu nada, n√£o encontrou nenhum padr√£o. Se o problema n√£o puder ser reproduzido, a √∫nica op√ß√£o √© coletar todos os casos, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">procurar padr√µes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e v√≠cios. </font><font style="vertical-align: inherit;">Talvez o kernel do Linux n√£o funcione corretamente com o processador, salve ou carregue incorretamente quaisquer registros.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hip√≥teses e padr√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 de 9 servidores com E5-2683 v4 falharam. Mas, com rela√ß√£o ao erro, apenas cerca da metade do E5-2683 v4 √© uma hip√≥tese vazia. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erros geralmente n√£o s√£o repetidos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Al√©m do cluster mtauxyz, onde h√° realmente dados corrompidos (dados incorretos no disco). Este √© outro caso, rejeitamos a hip√≥tese. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O erro n√£o depende do kernel do Linux</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - verificado em servidores diferentes, n√£o encontrou nada. Nada interessante no kern.log, </font></font><code>machine check exception</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem </font><font style="vertical-align: inherit;">mensagens </font><font style="vertical-align: inherit;">. Em gr√°ficos de rede, incluindo retransmissores, CPU, IO, Rede, nada de interessante. Todos os adaptadores de rede nos servidores em que os erros ocorrem e n√£o aparecem s√£o os mesmos. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o h√° padr√µes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O que fazer? Continue procurando padr√µes. Segunda tentativa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu olho para servidores de tempo de atividade:</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o tempo de atividade √© alto, os servidores funcionam de forma est√°vel</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o segfault e algo assim n√£o √©. Sempre me alegro quando vejo que o programa travou com segfault - pelo menos ele travou. Pior, quando h√° um erro, estraga algo, mas ningu√©m percebe. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os erros s√£o agrupados por dia</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e ocorrem dentro de alguns dias. Em cerca de 2 dias, mais aparecem, em alguns menos e mais uma vez - n√£o √© poss√≠vel determinar com precis√£o o tempo de ocorr√™ncia de erros. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alguns erros correspondem aos pacotes e ao valor do cheque que esper√°vamos.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A maioria dos erros possui apenas duas op√ß√µes de pacote. Tive sorte porque, na mensagem de erro, adicionamos o pr√≥prio valor da soma de verifica√ß√£o, o que ajudou a compilar estat√≠sticas. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem padr√µes de servidor</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de onde lemos os dados. O tamanho do bloco compactado que verificamos como soma √© menor que um kilobyte. Observou os tamanhos das embalagens em HEX. Isso n√£o foi √∫til para mim - a representa√ß√£o bin√°ria de tamanhos de pacotes e somas de verifica√ß√£o n√£o √© percept√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o corrigi o erro: estava novamente procurando padr√µes. Terceira tentativa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por alguma raz√£o, o erro aparece apenas </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em um dos clusters</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - nas terceiras r√©plicas no Vladimir DC (gostamos de chamar data centers por nomes de cidades). Em fevereiro de 2019, um erro tamb√©m apareceu no Vladimirs DC, mas em uma vers√£o diferente do ClickHouse. Esse √© outro argumento contra a hip√≥tese de que escrevemos o c√≥digo errado. J√° o reescrevemos tr√™s vezes de fevereiro a maio - o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erro provavelmente n√£o est√° no c√≥digo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os erros ao ler pacotes pela rede -</font></font><code>while receiving packet from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O pacote no qual o erro ocorreu depende da estrutura da solicita√ß√£o. </font><font style="vertical-align: inherit;">Para solicita√ß√µes que diferem na estrutura, um erro em diferentes somas de verifica√ß√£o. </font><font style="vertical-align: inherit;">Mas nas solicita√ß√µes em que o erro est√° na mesma soma de verifica√ß√£o, as constantes diferem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas as solicita√ß√µes com erro, exceto uma, s√£o </font></font><code>GLOBAL JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas, para compara√ß√£o, h√° uma solicita√ß√£o incomumente simples e o tamanho do bloco compactado √© de apenas 75 bytes.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(ReceiveTimestamp) <span class="hljs-keyword">FROM</span> tracking_events_all 
<span class="hljs-keyword">WHERE</span> APIKey = <span class="hljs-number">1111</span> <span class="hljs-keyword">AND</span> (OperatingSystem <span class="hljs-keyword">IN</span> (<span class="hljs-string">'android'</span>, <span class="hljs-string">'ios'</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rejeitamos a hip√≥tese de influ√™ncia </font></font><code>GLOBAL JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais interessante √© que os servidores afetados </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o agrupados em faixas pelos seus nomes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<code>mtxxxlog01-{39..44 57..58 64 68..71 73..74 76}-3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu estava cansado e desesperado, comecei a procurar padr√µes completamente ilus√≥rios. </font><font style="vertical-align: inherit;">√â bom que eu n√£o tenha conseguido depurar o c√≥digo usando a numerologia. </font><font style="vertical-align: inherit;">Mas ainda havia pistas.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os grupos de servidores com problemas s√£o os mesmos de fevereiro.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os servidores com problemas est√£o localizados em certas partes do data center. </font><font style="vertical-align: inherit;">Em DC Vladimir, existem as chamadas linhas - suas diferentes partes: VLA-02, VLA-03, VLA-04. </font><font style="vertical-align: inherit;">Os erros est√£o claramente agrupados: em algumas filas √© bom (VLA-02), em outros problemas (VLA-03, VLA-04).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digitando depura√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permaneceu apenas para depura√ß√£o usando o m√©todo "spear". </font><font style="vertical-align: inherit;">Isso significa formar a hip√≥tese "O que acontece se voc√™ tentar fazer isso?" </font><font style="vertical-align: inherit;">e coletar dados. </font><font style="vertical-align: inherit;">Por exemplo, encontrei uma </font></font><code>query_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta simples com um erro </font><font style="vertical-align: inherit;">na tabela </font><font style="vertical-align: inherit;">para o qual o tamanho do pacote √© </font></font><code>size of compressed block</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito pequeno (= 107). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cs/zz/fd/cszzfdvfkob2rhon1-n_xfnqtn4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peguei a solicita√ß√£o, copiei e executei manualmente usando clickhouse-local.</font></font><br>
<br>
<pre><code class="sql hljs">strace -f -e trace=network -s 1000 -x \<font></font>
clickhouse-local <span class="hljs-comment">--query "</span>
    <span class="hljs-keyword">SELECT</span> uniqIf(DeviceIDHash, SessionType = <span class="hljs-number">0</span>)
    <span class="hljs-keyword">FROM</span> remote(<span class="hljs-string">'127.0.0.{2,3}'</span>, mobile.generic_events)
    <span class="hljs-keyword">WHERE</span> StartDate = <span class="hljs-string">'2019-02-07'</span> <span class="hljs-keyword">AND</span> APIKey <span class="hljs-keyword">IN</span> (<span class="hljs-number">616988</span>,<span class="hljs-number">711663</span>,<span class="hljs-number">507671</span>,<span class="hljs-number">835591</span>,<span class="hljs-number">262098</span>,<span class="hljs-number">159700</span>,<span class="hljs-number">635121</span>,<span class="hljs-number">509222</span>)
        <span class="hljs-keyword">AND</span> EventType = <span class="hljs-number">1</span> <span class="hljs-keyword">WITH</span> TOTALS<span class="hljs-string">" --config config.xml</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com a ajuda do strace, recebi uma captura instant√¢nea (despejo) de blocos na rede - exatamente os mesmos pacotes que s√£o recebidos quando essa solicita√ß√£o √© executada e posso estud√°-los. Voc√™ pode usar o tcpdump para isso, mas √© inconveniente: √© dif√≠cil isolar uma solicita√ß√£o espec√≠fica do tr√°fego de produ√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando strace, voc√™ pode rastrear o pr√≥prio servidor ClickHouse. Mas esse servidor funciona em produ√ß√£o, se eu fizer isso, receberei uma variedade de informa√ß√µes incompreens√≠veis. Portanto, lancei um programa separado que executa exatamente uma solicita√ß√£o. J√° para este programa eu corro strace e recebo o que foi transmitido pela rede. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A solicita√ß√£o √© executada sem erros - o erro n√£o √© reproduzido</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se reproduzido, o problema seria resolvido. Portanto, copiei os pacotes em um arquivo de texto e comecei a analisar manualmente o protocolo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f5/0y/-8/f50y-8qvloj4brnns-nvgydpbsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O valor do cheque era o mesmo que o esperado. </font><font style="vertical-align: inherit;">Este √© exatamente o pacote no qual, √†s vezes, em outros momentos, em outras solicita√ß√µes, ocorrem erros. </font><font style="vertical-align: inherit;">Mas at√© agora n√£o houve erros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu escrevi um programa simples que pega um pacote e verifica o valor do cheque ao substituir um bit em cada byte. </font><font style="vertical-align: inherit;">O programa executou o bit flip em todas as posi√ß√µes poss√≠veis e leu o valor do cheque. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3m/fn/wr/3mfnwrp1udvm_ecrw0lnpcyoz0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iniciei o programa e descobri que, se voc√™ alterar o valor de um bit, obt√©m exatamente esse valor de verifica√ß√£o quebrado, para o qual h√° uma reclama√ß√£o</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema de hardware</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se houver um erro no software (por exemplo, dirigir atrav√©s da mem√≥ria), √© improv√°vel que o flip de bit √∫nico. </font><font style="vertical-align: inherit;">Portanto, surgiu uma nova hip√≥tese - o problema est√° na gl√¢ndula. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode-se fechar a tampa do laptop e dizer: "O problema n√£o est√° do nosso lado, mas no hardware, n√£o fazemos isso". </font><font style="vertical-align: inherit;">Mas n√£o, vamos tentar entender onde est√° o problema: na RAM, no disco r√≠gido, no processador, na placa de rede ou na RAM da placa de rede no equipamento de rede. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como localizar um problema de hardware?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O problema surgiu e desapareceu em determinadas datas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidores afetados s√£o agrupados por seus nomes: </font></font><code>mtxxxlog01-{39..44 57..58 64 68..71 73..74 76}-3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os grupos de servidores com problemas s√£o os mesmos de fevereiro.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os servidores com problemas est√£o apenas em determinadas filas do datacenter.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Havia perguntas para os engenheiros de rede - os dados est√£o batendo nos comutadores de rede. Acontece que os engenheiros de rede trocaram switches por outros exatamente nessas datas. Ap√≥s uma pergunta, eles foram substitu√≠dos pelos anteriores e o problema desapareceu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O problema foi resolvido, mas ainda restam perguntas (n√£o mais para engenheiros). </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que o ECC (mem√≥ria de corre√ß√£o de erros) n√£o ajuda nos comutadores de rede?</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como o flip de v√°rios bits pode compensar um ao outro - voc√™ recebe um erro n√£o detectado. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que as somas de verifica√ß√£o TCP n√£o ajudam?</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eles s√£o fracos. Se apenas um bit tiver sido alterado nos dados, as somas de verifica√ß√£o TCP sempre ver√£o a altera√ß√£o. Se dois bits foram alterados, as altera√ß√µes podem n√£o ser detectadas - elas se cancelam.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apenas um bit foi alterado em nosso pacote, mas o erro n√£o √© vis√≠vel. Isso ocorre porque 2 bits foram alterados no segmento TCP: eles calcularam a soma de verifica√ß√£o, coincidiu. Mas em um segmento TCP, mais de um pacote de nosso aplicativo est√° localizado. E para um deles, j√° consideramos nossa soma de verifica√ß√£o. Apenas um bit foi alterado neste pacote. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que as somas de verifica√ß√£o de Ethernet n√£o ajudam - elas s√£o mais fortes que o TCP? </font></font></strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quantidade de verifica√ß√£o de Ethernet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fa√ßa um resumo dos dados para que eles n√£o quebrem durante a transmiss√£o por um segmento (posso estar errado com a terminologia, n√£o sou engenheiro de rede). </font><font style="vertical-align: inherit;">O equipamento de rede encaminha esses pacotes e pode encaminhar alguns dados durante o encaminhamento. </font><font style="vertical-align: inherit;">Portanto, os valores dos cheques s√£o simplesmente recontados. </font><font style="vertical-align: inherit;">Verificamos - nos fios os pacotes n√£o foram alterados. </font><font style="vertical-align: inherit;">Mas se eles baterem no pr√≥prio switch de rede, ele recalcular√° o valor do cheque (ser√° diferente) e encaminhar√° o pacote ainda mais.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nada ir√° salv√°-lo - soma voc√™ mesmo. </font><font style="vertical-align: inherit;">N√£o espere que algu√©m fa√ßa isso por voc√™.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para blocos de dados, uma soma de verifica√ß√£o de 128 bits √© considerada (esse exagero apenas por precau√ß√£o). </font><font style="vertical-align: inherit;">Informamos corretamente o usu√°rio sobre o erro. </font><font style="vertical-align: inherit;">Os dados s√£o transmitidos pela rede, est√£o danificados, mas n√£o os gravamos em nenhum lugar - todos os nossos dados est√£o em ordem, n√£o se preocupe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dados armazenados no ClickHouse permanecem consistentes. </font><font style="vertical-align: inherit;">Use somas de verifica√ß√£o no ClickHouse. </font><font style="vertical-align: inherit;">Adoramos tanto os cheques que consideramos imediatamente tr√™s op√ß√µes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para blocos de dados compactados ao gravar em um arquivo, na rede.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A verifica√ß√£o total √© a soma dos dados compactados para verifica√ß√£o de reconcilia√ß√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifica√ß√£o total √© a soma dos dados n√£o compactados para verifica√ß√£o de reconcilia√ß√£o.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem erros nos algoritmos de compacta√ß√£o de dados, este √© um caso conhecido. </font><font style="vertical-align: inherit;">Portanto, quando os dados s√£o replicados, tamb√©m consideramos a soma total de verifica√ß√£o dos dados compactados e a quantidade total de dados n√£o compactados.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o tenha medo de contar os valores dos cheques, pois eles n√£o diminuem a velocidade.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, depende de quais e como contar. </font><font style="vertical-align: inherit;">Existem nuances, mas n√£o se esque√ßa de considerar o valor do cheque. </font><font style="vertical-align: inherit;">Por exemplo, se voc√™ contar a partir dos dados compactados, haver√° menos dados, eles n√£o diminuir√£o a velocidade.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mensagem de erro aprimorada</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como explicar ao usu√°rio quando ele recebe uma mensagem de erro que este √© um problema de hardware? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t4/f6/rj/t4f6rj1mtuo38kojydfgddfh2nc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a soma de verifica√ß√£o n√£o corresponder, antes de enviar uma exce√ß√£o, tento mudar todos os bits - apenas por precau√ß√£o. Se a soma da verifica√ß√£o convergir durante a altera√ß√£o e um bit for alterado, o problema provavelmente ser√° o hardware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se podemos detectar esse erro e se ele muda quando um bit √© alterado, por que n√£o corrigi-lo? Podemos fazer isso, mas se corrigirmos erros o tempo todo, o usu√°rio n√£o saber√° que o equipamento est√° com problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando descobrimos que havia problemas nos comutadores, pessoas de outros departamentos come√ßaram a relatar: ‚ÄúE n√≥s escrevemos um pouco incorretamente para o Mongo! E algo nos atingiu no PostgreSQL! ‚Äù Isso √© bom, mas √© melhor relatar problemas mais cedo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando lan√ßamos uma nova vers√£o de diagn√≥stico, o primeiro usu√°rio a quem ele trabalhou escreveu uma semana depois: "Aqui est√° a mensagem - qual √© o problema?" </font><font style="vertical-align: inherit;">Infelizmente, ele n√£o leu. </font><font style="vertical-align: inherit;">Mas eu li e sugeri com uma probabilidade de 99% que, se o erro aparecer em um servidor, o problema esteja no hardware. </font><font style="vertical-align: inherit;">Deixo a porcentagem restante no caso de escrever o c√≥digo incorretamente - isso acontece. </font><font style="vertical-align: inherit;">Como resultado, o usu√°rio substituiu o SSD e o problema desapareceu.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Delirium" nos dados</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse problema interessante e inesperado me deixou preocupada. Temos dados Yandex.Metrica. Um JSON simples √© gravado no banco de dados em uma das colunas - par√¢metros do usu√°rio do c√≥digo JavaScript do contador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu fa√ßo algum tipo de solicita√ß√£o e o servidor ClickHouse travou com o segfault. A partir do rastreamento da pilha, percebi qual era o problema - um novo commit de nossos colaboradores externos de outro pa√≠s. A consolida√ß√£o corrigida, segfault desapareceu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu executo o mesmo pedido: </font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no ClickHouse, para obter JSON, mas, novamente, bobagem, tudo funciona lentamente. Eu recebo JSON, e √© 10 MB. Eu o mostro e olho com mais aten√ß√£o: </font></font><code>{"jserrs": cannot find property of object undefind...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e ent√£o um megabyte de c√≥digo bin√°rio caiu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/ab/1g/ntab1gtbj8eialtctjq4nu-ucdi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Havia pensamentos de que isso √© novamente uma passagem da mem√≥ria ou uma condi√ß√£o de ra√ßa. </font><font style="vertical-align: inherit;">Muitos desses dados bin√°rios s√£o ruins, podem conter qualquer coisa. </font><font style="vertical-align: inherit;">Nesse caso, agora vou encontrar senhas e chaves privadas l√°. </font><font style="vertical-align: inherit;">Mas como n√£o encontrei nada, rejeitei imediatamente a hip√≥tese. </font><font style="vertical-align: inherit;">Talvez este seja um erro no meu programa no servidor ClickHouse? </font><font style="vertical-align: inherit;">Talvez em um programa que escreve (tamb√©m √© escrito em C ++) - de repente ela acidentalmente coloca sua mem√≥ria de despejo no ClickHouse? </font><font style="vertical-align: inherit;">Neste inferno, comecei a olhar atentamente para as cartas e percebi que n√£o era t√£o simples.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caminho da pista</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mesmo lixo foi registrado em dois grupos, independentemente um do outro. </font><font style="vertical-align: inherit;">Os dados s√£o lixo, mas s√£o UTF-8 v√°lidos. </font><font style="vertical-align: inherit;">Este UTF-8 possui alguns URLs estranhos, nomes de fontes e muitas letras "I" seguidas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que h√° de especial no pequeno "eu" cir√≠lico? </font><font style="vertical-align: inherit;">N√£o, este n√£o √© o Yandex. </font><font style="vertical-align: inherit;">O fato √© que, na codifica√ß√£o do Windows 1251, √© o 255¬∫ caractere. </font><font style="vertical-align: inherit;">E em nossos servidores Linux, ningu√©m usa a codifica√ß√£o do Windows 1251. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que este √© um despejo do navegador: o c√≥digo JavaScript do contador de m√©tricas coleta erros de JavaScript. </font><font style="vertical-align: inherit;">Como se viu, a resposta √© simples - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tudo veio do usu√°rio</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir daqui tamb√©m √© poss√≠vel tirar conclus√µes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erros de toda a Internet</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Yandex.Metrica coleta tr√°fego de 1 bilh√£o de dispositivos na Internet: navegadores em PCs, telefones celulares, tablets. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O lixo vir√° inevitavelmente</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : existem bugs nos dispositivos dos usu√°rios, em todos os lugares RAM n√£o confi√°vel e hardware terr√≠vel que superaquece. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O banco de dados armazena mais de 30 trilh√µes de linhas (visualiza√ß√µes de p√°gina). Se voc√™ analisar os dados desta tabela, poder√° encontrar qualquer coisa l√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, √© correto simplesmente filtrar esse lixo antes de gravar no banco de dados. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o h√° necessidade de escrever lixo no banco de dados - ela n√£o gosta.</font></font></b><br>
<br>
<blockquote> HighLoad++   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 133 </a>   ),       -  ,   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">++</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PHP Russia 2020 Online</a>. <br>
<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Badoo</a>, <b> PHP Russia 2020 Online  </b>. PHP Russia 2020 Online  13 ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>.<br>
<br>
          ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>,     . </blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt497324/index.html">‚ÄúComo a menina de um olho ...‚Äù ou criamos um sistema de seguran√ßa simples baseado em um microcontrolador (Canny ou Arduino) e Raspberry PI</a></li>
<li><a href="../pt497326/index.html">Conectividade SSH mais segura com DNSSEC</a></li>
<li><a href="../pt497328/index.html">Maneira f√°cil de aprender um idioma (qualquer)</a></li>
<li><a href="../pt497330/index.html">√Årea de trabalho remota do Chrome. Suporte remoto</a></li>
<li><a href="../pt497332/index.html">Houston, n√≥s temos um problema. Falha no projeto do sistema</a></li>
<li><a href="../pt497336/index.html">Marcas de computadores dos anos 90, parte 3, final</a></li>
<li><a href="../pt497338/index.html">O que aconteceu com o transporte na semana passada - a crise est√° se desenvolvendo</a></li>
<li><a href="../pt497340/index.html">COVID-19: como parar de ler not√≠cias e come√ßar a analisar dados</a></li>
<li><a href="../pt497342/index.html">Navegador atento √†s solicita√ß√µes de API: construindo comunica√ß√£o segura entre o front-end e o back-end</a></li>
<li><a href="../pt497346/index.html">Acelere o numpy, o scikit e os pandas 100 vezes com Rust e LLVM: entrevista com o desenvolvedor Weld</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>