<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧥 🏝️ 🖥️ Perlを1987年からそのまま 🚚 🕵🏾 ♈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="LINUX.ORG.RUで「GitHubに正式に移植されたPerlインタープリターコード」というニュースを読んだ後、すでにGitHubにあるPerl 5リポジトリを確認することにしました。
 
 プロジェクトの32年の履歴全体を完全に保存するだけでなく、バ​​グレポート（Issuesに取り込んだ）、...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Perlを1987年からそのまま</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473228/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINUX.ORG.RUで「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Perlインタープリターコードが公式にGitHubに移植された、LINUX.ORG.RUのニュース"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubに正式に移植されたPerlインタープリターコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」というニュースを読んだ後、</font><font style="vertical-align: inherit;">すでにGitHubにあるPerl 5リポジトリを確認することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの32年の履歴全体を完全に保存するだけでなく、バ​​グレポート（Issuesに取り込んだ）、パッチ（PRに取り込んだ）、リリース、ブランチも保持して、途方もなく質的にそれらを転送したのは驚くべきことです。</font><font style="vertical-align: inherit;">ファイルの横に</font><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="32年前のPerlソースファイル、公式Perl 5 GitHubリポジトリ。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32年前</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」と</font><font style="vertical-align: inherit;">記さ</font><font style="vertical-align: inherit;">れていたため、思わず笑ってしまいました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
雨と雪が通りに不快に霧雨を降し、すべての通りの道が秋の大雪に埋もれている、この退屈な金曜日の夜に他に何をしますか？そうです、目の充血した！実験と興味のために、私は古代のPerlを取得して、最新バージョンの</font><strong><font style="vertical-align: inherit;">GCC 9.2.0を</font></strong><font style="vertical-align: inherit;">備えた最新のx86_64マシンにアセンブルすることにしました。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイラとして。</font><font style="vertical-align: inherit;">そのような古いコードは時の試練に合格することができますか？</font></font><br>
<br>
<div style="text-align:center;"><img title="最新のArch Linuxディストリビューションでの、X Window Systemの最初のウィンドウマネージャーの1つであるtwmのデモ。" src="https://habrastorage.org/webt/-0/d5/wt/-0d5wtkg6ylqdd-h5g1hbtdiypi.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最新のArch LinuxディストリビューションでのX Window Systemの最初のウィンドウマネージャーの1つである</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twmの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモ</font><font style="vertical-align: inherit;">。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全に本物でネクロマントネンコにするために、私は裸のXと</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="twm、ウィキペディアのページ。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィンドウマネージャーを備えた仮想マシンをデプロイしました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">誰が知っているか、おそらく</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="ラリー・ウォール、ウィキペディアのページ。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラリー・ウォール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は正確に</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twm</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してPerlを作成した</font><font style="vertical-align: inherit;">ので</font><font style="vertical-align: inherit;">、当時の</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最先端テクノロジーと</font></font></em><font style="vertical-align: inherit;"><strong><font style="vertical-align: inherit;">言え</font></strong><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">使用されているディストリビューションはArch Linuxです。</font><font style="vertical-align: inherit;">彼のリポジトリに後で役立ついくつかの便利なものがあるからといって。</font><font style="vertical-align: inherit;">じゃ、行こう！</font></font><br>
<a name="habracut"></a><br>
<a name="article-content"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテンツ：</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">1.  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">2.   </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.    yacc</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">4.     «C»</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">5.    Segmentation fault</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">6.  </a><br>
<br>
<a name="environment"></a><h2>1.  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、仮想マシンのデプロイ済みオペレーティングシステムに、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vim</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">git</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdb</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など</font><font style="vertical-align: inherit;">のソースコードのアセンブルと編集に必要なすべての紳士的なユーティリティとコンパイラのセットをインストールします</font><font style="vertical-align: inherit;">。それらのいくつかはすでにインストールされていますが、他のものはメタパッケージで利用可能です</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base-devel</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、インストールされていない場合はインストールする必要があります。</font><font style="vertical-align: inherit;">環境の準備が整ったら、32年前のPerlソースコードのコピーを入手します。</font></font><br>
<br>
<pre><code class="bash hljs">$ git <span class="hljs-built_in">clone</span> https://github.com/Perl/perl5/ --depth=1 -b perl-1.0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gitの機能のおかげで、プロジェクトの最初のリリースに到達するために一連のファイルをドラッグする必要はありません。</font></font><br>
<br>
<pre><code class="plaintext hljs">* commit 8d063cd8450e59ea1c611a2f4f5a21059a2804f1 (grafted, HEAD, tag: perl-1.0)<font></font>
  Commit:     Larry Wall &lt;lwall@jpl-devvax.jpl.nasa.gov&gt;<font></font>
  CommitDate: Fri Dec 18 00:00:00 1987 +0000<font></font>
<font></font>
      a "replacement" for awk and sed<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少量のデータしかダウンロードしないため、Perlの最初のバージョンのソースコードを含むリポジトリは150 KBしかかかりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その暗いと密な時などはそのような基本的なことがなかった</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="GNU Autotools、Wikipediaページ。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autotoolsのは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何を祝福！</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、しかし、そこにある</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定の</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリのルート内のスクリプト</font><font style="vertical-align: inherit;">。何か問題でもありますか？しかし実際には、ラリーウォールは、当時最も変化に富んだUNIXマシン用のMakefileを生成できるスクリプトの発明者である。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="スクリプト、履歴、Wikipediaページを構成します。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ名前の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトに関するWikipediaの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="スクリプト、履歴、Wikipediaページを構成します。"><font style="vertical-align: inherit;">記事にある</font></a><font style="vertical-align: inherit;">ように</font><font style="vertical-align: inherit;">、ラリーウォール</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、Perlを書く3年前</font><font style="vertical-align: inherit;">に、ニュースリーダー</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="rn、ニュースリーダー、ウィキペディアのページ。"><font style="vertical-align: inherit;">rn</font></a><font style="vertical-align: inherit;">などのソフトウェアの一部を</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルに提供しました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="rn、ニュースリーダー、ウィキペディアのページ。"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、Perlも例外ではなく、すでに多くのマシンで実行されているスクリプトを使用して構築されました。</font><font style="vertical-align: inherit;">その後、他の開発者、たとえばTrolltechのプログラマーもこのアイデアを採用しました。</font><font style="vertical-align: inherit;">彼らは同様のスクリプトを使用してQtフレームワークのビルドを構成しましたが、多くの人</font><font style="vertical-align: inherit;">が</font><strong><font style="vertical-align: inherit;">autotoolsの</font></strong></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configureと</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">混同してい</font><strong><font style="vertical-align: inherit;">ます</font></strong><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">簡素化された自動生成のためのツールを作成するきっかけとなったのは、さまざまな開発者からのそのようなスクリプトの動物園でした。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em><font style="vertical-align: inherit;">&lt;&lt;コンテンツにスキップ</font></em></a></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em><font style="vertical-align: inherit;"></font></em></a><br>
<br>
<a name="configure"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.ソースコードを構成する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スペースのある</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Shebang, Unix, Wikipedia page."><font style="vertical-align: inherit;">シバン</font></a><font style="vertical-align: inherit;"> ' </font><font style="vertical-align: inherit;">からすでに明らかな「古い学校」</font><font style="vertical-align: inherit;">
の</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト</font><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Shebang, Unix, Wikipedia page."><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">$ cat Configure | head -5
<span class="hljs-meta">#! /bin/sh</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># If these # comments don't work, trim them.  Don't worry about any other</span>
<span class="hljs-comment"># shell scripts, Configure will trim # comments from them for you.</span>
<span class="hljs-comment">#</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コメントによると、スクリプトにコメントを残すことができないシェルがあったことがわかりました！宇宙の状況は異常に見えますが、これが標準になった後で、詳細については</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Is space allowed between #! and /bin/bash in shebang? - Unix and Linux Stack Exchange."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンクを参照してください</font><font style="vertical-align: inherit;">。最も重要なのは、スペースの有無にかかわらず、最新のシェルインタープリターに違いはないということです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
歌詞はもう十分だ、さあ仕事に取り掛かろう！スクリプトを開始すると、興味深い仮定が表示されますが、これは完全に正しいわけではありません。</font></font><br>
<br>
<pre><code class="plaintext hljs">$ ./Configure<font></font>
(I see you are using the Korn shell.  Some ksh's blow up on Configure,<font></font>
especially on exotic machines.  If yours does, try the Bourne shell instead.)<font></font>
<font></font>
Beginning of configuration questions for perl kit.<font></font>
<font></font>
Checking echo to see how to suppress newlines...<font></font>
...using -n.<font></font>
Type carriage return to continue.  Your cursor should be here--&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
驚いたことに、このスクリプトはインタラクティブであり、さまざまな背景情報が大量に含まれています。</font><font style="vertical-align: inherit;">ユーザーインタラクションモデルはダイアログに基づいて構築され、スクリプトがパラメーターを変更する回答を分析し、それに従ってスクリプトがその後Makefileを生成します。</font><font style="vertical-align: inherit;">個人的に、すべてのシェルコマンドが設定されているかどうかを確認することに興味がありましたか？</font></font><br>
<br>
<pre><code class="plaintext hljs">Locating common programs...<font></font>
expr is in /bin/expr.<font></font>
sed is in /bin/sed.<font></font>
echo is in /bin/echo.<font></font>
cat is in /bin/cat.<font></font>
rm is in /bin/rm.<font></font>
mv is in /bin/mv.<font></font>
cp is in /bin/cp.<font></font>
tr is in /bin/tr.<font></font>
mkdir is in /bin/mkdir.<font></font>
sort is in /bin/sort.<font></font>
uniq is in /bin/uniq.<font></font>
grep is in /bin/grep.<font></font>
<font></font>
Don't worry if any of the following aren't found...<font></font>
test is in /bin/test.<font></font>
egrep is in /bin/egrep.<font></font>
I don't see Mcc out there, offhand.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうやらこれは事件から遠かった前に。</font><font style="vertical-align: inherit;">見つからなかっ</font><font style="vertical-align: inherit;">た</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mcc</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティの原因は何</font><font style="vertical-align: inherit;">ですか？</font><font style="vertical-align: inherit;">面白いことに、このスクリプトは当時の最高のハッカーの伝統であり、フレンドリーなユーモアでいっぱいです。</font><font style="vertical-align: inherit;">これで、そのようなものはほとんど見えなくなります。</font></font><br>
<br>
<pre><code class="plaintext hljs">Is your "test" built into sh? [n] (OK to guess) OK<font></font>
<font></font>
Checking compatibility between /bin/echo and builtin echo (if any)...<font></font>
They are compatible.  In fact, they may be identical.<font></font>
<font></font>
Your C library is in /lib/libc.a.  You're normal.<font></font>
<font></font>
Extracting names from /lib/libc.a for later perusal...done<font></font>
<font></font>
Hmm...  Looks kind of like a USG system, but we'll see...<font></font>
<font></font>
Congratulations.  You aren't running Eunice.<font></font>
<font></font>
It's not Xenix...<font></font>
<font></font>
Nor is it Venix...<font></font>
<font></font>
Checking your sh to see if it knows about # comments...<font></font>
Your sh handles # comments correctly.<font></font>
<font></font>
Okay, let's see if #! works on this system...<font></font>
It does.<font></font>
<font></font>
Checking out how to guarantee sh startup...<font></font>
Let's see if '#!/bin/sh' works...<font></font>
Yup, it does.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はほとんどの質問にデフォルト値で、またはスクリプトが提供するもので答えました。</font><font style="vertical-align: inherit;">特に満足して驚いたのは、コンパイラーとリンカーのフラグの要求でした。</font></font><br>
<br>
<pre><code class="plaintext hljs">Any additional cc flags? [none]<font></font>
<font></font>
Any additional ld flags? [none]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで、たとえば</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m32</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの興味深いものを記述して</font><font style="vertical-align: inherit;">、リンクに必要な32ビットの実行可能ファイルまたはライブラリを構築できます。スクリプトの最後の質問へ：</font></font><br>
<br>
<pre><code class="plaintext hljs">Now you need to generate make dependencies by running "make depend".<font></font>
You might prefer to run it in background: "make depend &gt; makedepend.out &amp;"<font></font>
It can take a while, so you might not want to run it right now.<font></font>
<font></font>
Run make depend now? [n] y<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は肯定的に答えました。</font><font style="vertical-align: inherit;">ウィキペディアの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="makedepend, History, Wikipedia page."><font style="vertical-align: inherit;">ページ</font></a><font style="vertical-align: inherit;">から判断すると、</font><font style="vertical-align: inherit;">古代の</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makedepend</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティ</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、Makefileでの作業を容易にするため</font><font style="vertical-align: inherit;">に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Project Athena, Wikipedia page."><font style="vertical-align: inherit;">、Athenaプロジェクトの</font></a><font style="vertical-align: inherit;">最初期に作成されました</font><font style="vertical-align: inherit;">。このプロジェクトは私たちにX Window System、Kerberos、Zephyrを与え、今日よく知られている他の多くのものに影響を与えました。これはすばらしいことですが、このユーティリティは最近のLinux環境ではどこから来たのでしょうか。それは長い間誰も、どこでも使われていませんでした。しかし、リポジトリのルートを注意深く見ると、Larry Wallがスクリプトのバージョン置換を記述していることがわかります。このスクリプトを慎重に解凍し、構成スクリプトを実行しました。</font><font style="vertical-align: inherit;">
実行</font><strong><font style="vertical-align: inherit;">のmakedepend</font></strong><font style="vertical-align: inherit;">いくつかの奇妙なエラーメッセージで終了。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="makedepend, History, Wikipedia page."><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Project Athena, Wikipedia page."><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">./makedepend: <span class="hljs-built_in">command</span> substitution: line 82: unexpected EOF <span class="hljs-keyword">while</span> looking <span class="hljs-keyword">for</span> matching `<span class="hljs-string">''</span>
./makedepend: <span class="hljs-built_in">command</span> substitution: line 83: syntax error: unexpected end of file<font></font>
./makedepend: <span class="hljs-built_in">command</span> substitution: line 82: unexpected EOF <span class="hljs-keyword">while</span> looking <span class="hljs-keyword">for</span> matching `<span class="hljs-string">''</span>
./makedepend: <span class="hljs-built_in">command</span> substitution: line 83: syntax error: unexpected end of file
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらくそれが問題を引き起こしたのは、生成されたMakefileが少し噛まれたためです。</font></font><br>
<br>
<pre><code class="bash hljs">$ make<font></font>
make: *** No rule to make target <span class="hljs-string">'&lt;built-in&gt;'</span>, needed by <span class="hljs-string">'arg.o'</span>.  Stop.
</code></pre><br><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makedepend</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ユーティリティの複雑なシェルヌードルのジャングル</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">行き</font><font style="vertical-align: inherit;">たくなかったのは間違いで、奇妙なパターンが出現したMakefileを注意深く調べることにしました。</font></font><br>
<br>
<pre><code class="plaintext hljs">arg.o: arg.c<font></font>
arg.o: arg.h<font></font>
arg.o: array.h<font></font>
arg.o: &lt;built-in&gt;<font></font>
arg.o: cmd.h<font></font>
arg.o: &lt;command-line&gt;<font></font>
arg.o: config.h<font></font>
arg.o: EXTERN.h<font></font>
...<font></font>
array.o: arg.h<font></font>
array.o: array.c<font></font>
array.o: array.h<font></font>
array.o: &lt;built-in&gt;<font></font>
array.o: cmd.h<font></font>
array.o: &lt;command-line&gt;<font></font>
array.o: config.h<font></font>
array.o: EXTERN.h<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうやらいくつかのユーティリティは、その引数を排気に誤って挿入しました。</font><strong><font style="vertical-align: inherit;">sed</font></strong><font style="vertical-align: inherit;">の</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ax</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティを</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入手して、</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この問題を少し修正することにしました。</font></font><br>
<br>
<pre><code class="bash hljs">$ sed -i <span class="hljs-string">'/built-in/d'</span> Makefile<font></font>
$ sed -i <span class="hljs-string">'/command-line/d'</span> Makefile
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
驚いたことに、トリックは機能し、Makefileは正常に機能しました。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt;コンテンツにスキップ</font></font></em></a><br>
<br>
<a name="yacc"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Yacc文法ファイルのエラー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
32年前のコードが問題なく実行されてコンパイルされたとしたら、信じられないでしょう。残念ながら、奇跡は起こりません。ソースツリーを</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調べ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たところ、</font><strong><font style="vertical-align: inherit;">perl.y</font></strong><font style="vertical-align: inherit;">ファイルに出会いました</font><font style="vertical-align: inherit;">。これは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="yacc, Wikipedia page."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yacc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティの文法記述であり</font><font style="vertical-align: inherit;">、最近のディストリビューションでは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="GNU Bison, Wikipedia page."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bison</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に長い間置き換えられてい</font><font style="vertical-align: inherit;">ます。パス上にあるスクリプト</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は/ usr / binに/ yaccは</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ちょうど呼び出し、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイソン</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">との互換モードで</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YACC</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。この互換性が完全ではないというだけのことです。このファイルを処理するときに大量のエラーが発生しますが、最近修正した代替ソリューションがあるため、修正方法がわからず、本当にしたくないのです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1、2年前に、KDEの開発者であるHelio Chissini de Castroが同様の作業を行い、KDE ​​1、2およびQt 1、2を最新の環境およびコンパイラに適合させました。私は彼の仕事に興味を持ち、プロジェクトのソースコードをダウンロードしましたが、アセンブリ中</font><font style="vertical-align: inherit;">に</font><strong><font style="vertical-align: inherit;">yacc</font></strong><font style="vertical-align: inherit;">と</font><strong><font style="vertical-align: inherit;">bisonの</font></strong><font style="vertical-align: inherit;">互換性がないために</font><font style="vertical-align: inherit;">同様の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Qt 2 modern adaptation by Helio Castro, Issues, GitHub repository."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">落とし穴に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遭遇しました</font><font style="vertical-align: inherit;">。これら</font><font style="vertical-align: inherit;">は</font><strong><font style="vertical-align: inherit;">moc</font></strong><font style="vertical-align: inherit;">メタコンパイラーの古いバージョンのビルドに使用されていました</font><font style="vertical-align: inherit;">。その後、私は</font><strong><font style="vertical-align: inherit;">バイソン</font></strong><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Berkeley Yacc, Official page."><font style="vertical-align: inherit;">byacc</font></a><font style="vertical-align: inherit;">ユーティリティ</font><font style="vertical-align: inherit;">（Berkeley Yacc）</font><font style="vertical-align: inherit;">で置き換えるという形でこの問題の解決策を見つけることができました。これは、</font><strong><font style="vertical-align: inherit;">yaccの</font></strong><font style="vertical-align: inherit;">古い文法と互換性</font><font style="vertical-align: inherit;">があり、多くのLinuxディストリビューションで利用可能でした。</font><font style="vertical-align: inherit;">
簡単な交換</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Berkeley Yacc, Official page."><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yaccの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byaccに</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少し後の新しいバージョンのため、ビルドシステムではその後、というわけではないため、長い、私を助けた</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼らbyaccに</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、まだ壊した互換性</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のyacc</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のデバッグに関連したオフ破り、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YYDEBUGの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンティティを</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのため、</font><font style="vertical-align: inherit;">ユーティリティの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Fix undefined reference error, Pull Requests, Qt 2 modern adaptation by Helio Castro, GitHub repository."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を少し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Fix undefined reference error, Pull Requests, Qt 2 modern adaptation by Helio Castro, GitHub repository."><font style="vertical-align: inherit;">修正する必要がありました</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perl.y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの構築エラーを修正するための戦略は</font><font style="vertical-align: inherit;">、以前の経験から予測されていました</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。byacc</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティをインストールし、</font><font style="vertical-align: inherit;">すべてのMakefileで</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yacc</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byacc</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">変更して</font><font style="vertical-align: inherit;">から、どこからでも</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yydebug</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を切り取ります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらのアクションにより、このファイルのすべての問題が解決され、エラーが消え、コンパイルが続行されました。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt;コンテンツにスキップ</font></font></em></a><br>
<br>
<a name="c-errors"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. "C"でのコードのコンパイルエラー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlの古代のコードは、古くて忘れられていたK＆R関数定義の表記法のように、恐怖に満ちていました。</font></font><br>
<br>
<pre><code class="cpp hljs">format(orec,fcmd)
<span class="hljs-keyword">register</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">outrec</span> *<span class="hljs-title">orec</span>;</span>
<span class="hljs-keyword">register</span> FCMD *fcmd;<font></font>
{<font></font>
    ...<font></font>
}<font></font>
<font></font>
<span class="hljs-function">STR *
<span class="hljs-title">hfetch</span><span class="hljs-params">(tb,key)</span>
<span class="hljs-keyword">register</span> HASH *tb</span>;
<span class="hljs-keyword">char</span> *key;<font></font>
{<font></font>
    ...<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*VARARGS1*/</span><font></font>
fatal(pat,a1,a2,a3,a4)<font></font>
<span class="hljs-keyword">char</span> *pat;<font></font>
{<font></font>
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,pat,a1,a2,a3,a4);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様の機能は、たとえば</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title=" .  PVS-Studio  Microsoft Word 1.1a,    Habr."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Word 1.1a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">も見られますが</font><font style="vertical-align: inherit;">、これも非常に古いものです。</font><font style="vertical-align: inherit;">プログラミング言語「C」の最初の標準である「C89」は、2年後に登場します。</font><font style="vertical-align: inherit;">現代のコンパイラは、このようなコードを使用して作業することができますが、いくつかのIDEには、このような定義を解析にも対応し、構文エラーとしてそれらをハイライト表示されませんが、例えば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Qt Creator IDE, Wikipedia page."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QtのCreatorは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">罪を犯した</font><font style="vertical-align: inherit;">にして、コードを解析する前に、前に</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libclang</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリ</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCC 9.2.0コンパイラは、膨大な数の警告を吐き出し、Perlの最初のバージョンの古いコードをコンパイルすることを約束しました。警告のシートは非常に大きかったため、エラーを発生させるには、排気の数ページを上にスクロールする必要がありました。驚いたことに、ほとんどのコンパイルエラーは典型的なものであり、主に事前定義された定義に関連しており、アセンブリのフラグの役割を果たしました。</font></font><br>
<br>
<div style="text-align:center;"><img title="   GCC 9.2.0   GDB 8.3.1    twm    xterm." src="https://habrastorage.org/getpro/habr/post_images/3a9/b3c/004/3a9b3c0041c48a06e6805bd39883c6a4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最新のGCC 9.2.0コンパイラとGDB 8.3.1デバッガの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twm</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィンドウマネージャ</font><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xterm</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端末エミュレータで</font><font style="vertical-align: inherit;">の作業</font><font style="vertical-align: inherit;">。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
STDSTDIOの下で</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラリーウォールはいくつかの古くて非標準のプログラミング言語ライブラリ「C」を実験し、</font><font style="vertical-align: inherit;">デバッグの</font><font style="vertical-align: inherit;">下</font><font style="vertical-align: inherit;">では悪名高い</font><strong><font style="vertical-align: inherit;">yydebugを使用</font></strong><font style="vertical-align: inherit;">してデバッグ情報</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がありまし</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た</font><font style="vertical-align: inherit;">。デフォルトでは、これらのチェックボックスは有効になっています。</font><strong><font style="vertical-align: inherit;">perl.h</font></strong><font style="vertical-align: inherit;">ファイルでそれらをオフにし、</font><font style="vertical-align: inherit;">忘れられた定義を追加することで、エラーの数を大幅に減らすことができました。</font><font style="vertical-align: inherit;">
別のタイプのエラーは、標準ライブラリとPOSIXレイヤーの現在標準化されている関数を上書きすることです。プロジェクトには独自の</font><strong><font style="vertical-align: inherit;">malloc（）があります</font></strong></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setenv（）</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">およびその他の競合を引き起こしたエンティティ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの場所は宣言なしで静的関数を定義しました。</font><font style="vertical-align: inherit;">時間の経過とともに、コンパイラはこの問題に対してより厳密なアプローチを取り始め</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="How to solve static declaration follows non-static declaration in GCC C code? - Stack Overflow."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、警告をエラーに変えました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして最後に、忘れられたいくつかのヘッダー。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
驚いたことに、32年前のコードのパッチは非常に小さいため、ここで完全に引用できます。</font></font><br>
<br>
<pre><code class="diff hljs">diff --git a/malloc.c b/malloc.c<font></font>
index 17c3b27..a1dfe9c 100644<font></font>
<span class="hljs-comment">--- a/malloc.c</span>
<span class="hljs-comment">+++ b/malloc.c</span><font></font>
@@ -79,6 +79,9 @@ static    u_int nmalloc[NBUCKETS];<font></font>
 #include &lt;stdio.h&gt;<font></font>
 #endif<font></font>
<font></font>
<span class="hljs-addition">+static findbucket(union overhead *freep, int srchlen);</span>
<span class="hljs-addition">+static morecore(register bucket);</span>
<span class="hljs-addition">+</span><font></font>
 #ifdef debug<font></font>
 #define    ASSERT(p)   if (!(p)) botch("p"); else<font></font>
 static<font></font>
diff --git a/perl.h b/perl.h<font></font>
index 3ccff10..e98ded5 100644<font></font>
<span class="hljs-comment">--- a/perl.h</span>
<span class="hljs-comment">+++ b/perl.h</span>
<span class="hljs-meta">@@ -6,16 +6,16 @@</span><font></font>
  *<font></font>
  */<font></font>
<font></font>
<span class="hljs-deletion">-#define DEBUGGING</span>
<span class="hljs-deletion">-#define STDSTDIO   /* eventually should be in config.h */</span>
<span class="hljs-addition">+//#define DEBUGGING</span>
<span class="hljs-addition">+//#define STDSTDIO /* eventually should be in config.h */</span><font></font>
<font></font>
 #define VOIDUSED 1<font></font>
 #include "config.h"<font></font>
<font></font>
<span class="hljs-deletion">-#ifndef BCOPY</span>
<span class="hljs-deletion">-#   define bcopy(s1,s2,l) memcpy(s2,s1,l);</span>
<span class="hljs-deletion">-#   define bzero(s,l) memset(s,0,l);</span>
<span class="hljs-deletion">-#endif</span>
<span class="hljs-addition">+//#ifndef BCOPY</span>
<span class="hljs-addition">+//#   define bcopy(s1,s2,l) memcpy(s2,s1,l);</span>
<span class="hljs-addition">+//#   define bzero(s,l) memset(s,0,l);</span>
<span class="hljs-addition">+//#endif</span><font></font>
<font></font>
 #include &lt;stdio.h&gt;<font></font>
 #include &lt;ctype.h&gt;<font></font>
@@ -183,11 +183,11 @@ double atof();<font></font>
 long time();<font></font>
 struct tm *gmtime(), *localtime();<font></font>
<font></font>
<span class="hljs-deletion">-#ifdef CHARSPRINTF</span>
<span class="hljs-deletion">-    char *sprintf();</span>
<span class="hljs-deletion">-#else</span>
<span class="hljs-deletion">-    int sprintf();</span>
<span class="hljs-deletion">-#endif</span>
<span class="hljs-addition">+//#ifdef CHARSPRINTF</span>
<span class="hljs-addition">+//    char *sprintf();</span>
<span class="hljs-addition">+//#else</span>
<span class="hljs-addition">+//    int sprintf();</span>
<span class="hljs-addition">+//#endif</span><font></font>
<font></font>
 #ifdef EUNICE<font></font>
 #define UNLINK(f) while (unlink(f) &gt;= 0)<font></font>
diff --git a/perl.y b/perl.y<font></font>
index 16f8a9a..1ab769f 100644<font></font>
<span class="hljs-comment">--- a/perl.y</span>
<span class="hljs-comment">+++ b/perl.y</span>
<span class="hljs-meta">@@ -7,6 +7,7 @@</span><font></font>
  */<font></font>
<font></font>
 %{<font></font>
<span class="hljs-addition">+#include &lt;stdlib.h&gt;</span><font></font>
 #include "handy.h"<font></font>
 #include "EXTERN.h"<font></font>
 #include "search.h"<font></font>
diff --git a/perly.c b/perly.c<font></font>
index bc32318..fe945eb 100644<font></font>
<span class="hljs-comment">--- a/perly.c</span>
<span class="hljs-comment">+++ b/perly.c</span><font></font>
@@ -246,12 +246,14 @@ yylex()<font></font>
     static bool firstline = TRUE;<font></font>
<font></font>
   retry:<font></font>
<span class="hljs-addition">+#ifdef DEBUGGING</span><font></font>
 #ifdef YYDEBUG<font></font>
     if (yydebug)<font></font>
    if (index(s,'\n'))<font></font>
        fprintf(stderr,"Tokener at %s",s);<font></font>
    else<font></font>
        fprintf(stderr,"Tokener at %s\n",s);<font></font>
<span class="hljs-addition">+#endif</span><font></font>
 #endif<font></font>
     switch (*s) {<font></font>
     default:<font></font>
diff --git a/stab.c b/stab.c<font></font>
index b9ef533..9757cfe 100644<font></font>
<span class="hljs-comment">--- a/stab.c</span>
<span class="hljs-comment">+++ b/stab.c</span>
<span class="hljs-meta">@@ -7,6 +7,7 @@</span><font></font>
  */<font></font>
<font></font>
 #include &lt;signal.h&gt;<font></font>
<span class="hljs-addition">+#include &lt;errno.h&gt;</span><font></font>
 #include "handy.h"<font></font>
 #include "EXTERN.h"<font></font>
 #include "search.h"<font></font>
diff --git a/util.h b/util.h<font></font>
index 4f92eeb..95cb9bf 100644<font></font>
<span class="hljs-comment">--- a/util.h</span>
<span class="hljs-comment">+++ b/util.h</span><font></font>
@@ -28,7 +28,7 @@ void  prexit();<font></font>
 char   *get_a_line();<font></font>
 char   *savestr();<font></font>
 int    makedir();<font></font>
<span class="hljs-deletion">-void   setenv();</span>
<span class="hljs-addition">+//void setenv();</span><font></font>
 int    envix();<font></font>
 void   notincl();<font></font>
 char   *getval();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
32年前のコードにとって素晴らしい結果です！</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「crypt」</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンクの</font><font style="vertical-align: inherit;">バグ</font><strong><font style="vertical-align: inherit;">へ</font></strong><font style="vertical-align: inherit;">の</font><strong><font style="vertical-align: inherit;">未定義の参照</font></strong><font style="vertical-align: inherit;">は、</font><font style="vertical-align: inherit;">適切な</font><strong><font style="vertical-align: inherit;">libcrypt</font></strong><font style="vertical-align: inherit;">ライブラリ</font><font style="vertical-align: inherit;">を使用してMakefileに</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-lcrypt</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクティブを追加することで修正され</font><font style="vertical-align: inherit;">、その後、最終的に目的のPerlインタープリター実行可能ファイルを取得しました。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">$ file perl<font></font>
perl: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=fd952ceae424613568530b3a2ca88ebd6477e0ae, <span class="hljs-keyword">for</span> GNU/Linux 3.2.0, not stripped
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt;コンテンツにスキップ</font></font></em></a><br>
<br>
<a name="segfaults"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.いくつかのエラーの修正セグメンテーションエラー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほぼ手間のかからない編集の後、運は私に背を向けました。</font><font style="vertical-align: inherit;">組み立てられたPerlインタープリターを開始した直後に、最後に奇妙なエラーとセグメンテーション違反が発生しました。</font></font><br>
<br>
<pre><code class="bash hljs">$ ./perl -e <span class="hljs-string">'print "Hello World!\n";'</span><font></font>
Corrupt malloc ptr 0x2db36040 at 0x2db36000<font></font>
Corrupt malloc ptr 0x2db36880 at 0x2db36800<font></font>
Corrupt malloc ptr 0x2db36080 at 0x2db36040<font></font>
Corrupt malloc ptr 0x2db37020 at 0x2db37000<font></font>
Segmentation fault (core dumped)<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corrupt malloc</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
という語句のソーステキストを熟読した結果</font><font style="vertical-align: inherit;">、システムの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc（）の</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代わりに、</font><font style="vertical-align: inherit;">何らかのカスタムアロケーターが1982年から呼び出されたことがわかりました。興味深いことに、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berkeleyは</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコード内の文字列リテラルの1つで記述され</font><font style="vertical-align: inherit;">、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caltech</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はその隣のコメントで</font><font style="vertical-align: inherit;">記述さ</font><font style="vertical-align: inherit;">れてい</font><font style="vertical-align: inherit;">ます。これらの大学間のコラボレーションは、そのとき非常に強力であることが明らかでした。一般に、私はこのハッカーアロケーターをコメントアウトし、ソースコードを再構築しました。メモリ破損エラーはなくなりましたが、セグメンテーション違反は残りました。そのため、それはポイントではなく、今度はデバッガーを明らかにする必要があります。</font><strong><font style="vertical-align: inherit;">gdbで</font></strong></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プログラムを実行する</font><font style="vertical-align: inherit;">と、</font><font style="vertical-align: inherit;">libcから</font><font style="vertical-align: inherit;">一時的な</font><strong><font style="vertical-align: inherit;">mktemp（）</font></strong><font style="vertical-align: inherit;">ファイルを作成する関数を呼び出すとクラッシュが発生することがわかりました</font><font style="vertical-align: inherit;">。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">$ gdb --args ./perl -e 'print "Hello, World!\n";'<font></font>
(gdb) r<font></font>
Starting program: /home/exl/perl5/perl -e print\ \"Hello\ World\!\\n\"\;<font></font>
<font></font>
Program received signal SIGSEGV, Segmentation fault.<font></font>
0x00007ffff7cd20c7 in __gen_tempname () from /usr/lib/libc.so.6<font></font>
(gdb) bt<font></font>
#0  0x00007ffff7cd20c7 in __gen_tempname () from /usr/lib/libc.so.6<font></font>
#1  0x00007ffff7d71577 in mktemp () from /usr/lib/libc.so.6<font></font>
#2  0x000055555556bb08 in main ()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、リンカは以前この関数で呪われていました。</font><font style="vertical-align: inherit;">コンパイラではなく、リンカ。驚いたのは、</font></font><br>
<br>
<pre><code class="plaintext hljs">/usr/bin/ld: perl.o: in function `main':<font></font>
perl.c:(.text+0x978c): warning: the use of `mktemp' is dangerous, better use `mkstemp' or `mkdtemp'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらくあなたも頭に浮かんだ最初の考えは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="The GNU C Library, Temporary Files, Official GNU Documenation."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全でない関数</font></font></a> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mktemp（）</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mkstemp（）</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に置き換える</font><font style="vertical-align: inherit;">ことでした。</font><font style="vertical-align: inherit;">リンカの警告は消えましたが、いずれにしてもセグメンテーション違反はこの場所に残りましたが、今は</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mkstemp（）</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数にのみありました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、この関数に関連付けられているコードを注意深く確認する必要があります。</font><font style="vertical-align: inherit;">そこで私はこのスニペットで強調されているかなり奇妙なものを発見しました：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">char</span> *e_tmpname = <span class="hljs-string">"/tmp/perl-eXXXXXX"</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
   mktemp(e_tmpname);<font></font>
   e_fp = f_open(e_tmpname, <span class="hljs-string">"w"</span>);<font></font>
<font></font>
   ...<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ことが判明し</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ている）（mktempのを</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に位置しているマスク、リテラル変更しようとしている</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に.rodata</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクション</font><font style="vertical-align: inherit;">は明らかに失敗する運命にあります。</font><font style="vertical-align: inherit;">または、結局、32年前、これは許容範囲内であり、コードで満たされ、どういうわけかうまくいったのでしょうか。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char * e_tmpname</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char e_tmpname []</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に置き換える</font><font style="vertical-align: inherit;">と、このセグメンテーション違反が修正され、私が一晩中殺したものを取得することができました。</font></font><br>
<br>
<pre><code class="bash hljs">$ ./perl -e <span class="hljs-string">'print "Hello World!\n";'</span><font></font>
$ Hello, World!<font></font>
$ ./perl -e <span class="hljs-string">'$a = 5; $b = 6.3; $c = $a+$b; print $c."\n";'</span><font></font>
$ 11.3000000000000007<font></font>
$ ./perl -v<font></font>
<span class="hljs-variable">$Header</span>: perly.c,v 1.0 87/12/18 15:53:31 root Exp $<font></font>
Patch level: 0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドラインから実行を確認しましたが、ファイルについてはどうでしょうか。</font><font style="vertical-align: inherit;">Perlプログラミング言語の最初の「Hello World」をインターネットからダウンロードしました。</font></font><br>
<br>
<pre><code class="perl hljs"><span class="hljs-comment">################# test.pl</span>
<span class="hljs-comment">#!/usr/bin/perl</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># The traditional first program.</span><font></font>
<font></font>
<span class="hljs-comment"># Strict and warnings are recommended.</span>
<span class="hljs-keyword">use</span> strict;
<span class="hljs-keyword">use</span> warnings;<font></font>
<font></font>
<span class="hljs-comment"># Print a message.</span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"Hello, World!\n"</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それから私はそれを始めようとしました、しかし、悲しいことに、セグメンテーションフォールトは再び私を待っていました。</font><font style="vertical-align: inherit;">今回は完全に異なる場所で：</font></font><br>
<br>
<pre><code class="plaintext hljs">$ gdb --args ./perl test.pl<font></font>
(gdb) r<font></font>
Starting program: /home/exl/perl5/perl test.pl<font></font>
<font></font>
Program received signal SIGSEGV, Segmentation fault.<font></font>
0x00007ffff7d1da75 in __strcpy_sse2_unaligned () from /usr/lib/libc.so.6<font></font>
(gdb) bt<font></font>
#0  0x00007ffff7d1da75 in __strcpy_sse2_unaligned () from /usr/lib/libc.so.6<font></font>
#1  0x00005555555629ea in yyerror ()<font></font>
#2  0x0000555555568dd6 in yyparse ()<font></font>
#3  0x000055555556bd4f in main ()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の興味深い点が</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yyerror（）</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
関数</font><font style="vertical-align: inherit;">で見つかりました。元のスニペットを引用します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// perl.y</span>
<span class="hljs-keyword">char</span> *tokename[] = {
    <span class="hljs-string">"256"</span>,
    <span class="hljs-string">"word"</span>,
    <span class="hljs-string">"append"</span>,<font></font>
    ...<font></font>
<font></font>
<span class="hljs-comment">// perl.c</span><font></font>
yyerror(s)<font></font>
<span class="hljs-keyword">char</span> *s;<font></font>
{<font></font>
     <span class="hljs-keyword">char</span> tmpbuf[<span class="hljs-number">128</span>];
     <span class="hljs-keyword">char</span> *tname = tmpbuf;<font></font>
<font></font>
     <span class="hljs-keyword">if</span> (yychar &gt; <span class="hljs-number">256</span>) {<font></font>
     tname = tokename[yychar<span class="hljs-number">-256</span>]; <span class="hljs-comment">// ???</span>
         <span class="hljs-keyword">if</span> (strEQ(tname,<span class="hljs-string">"word"</span>))
             <span class="hljs-built_in">strcpy</span>(tname,tokenbuf); <span class="hljs-comment">// Oops!</span>
         <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strEQ(tname,<span class="hljs-string">"register"</span>))
             <span class="hljs-built_in">sprintf</span>(tname,<span class="hljs-string">"$%s"</span>,tokenbuf); <span class="hljs-comment">// Oops!</span><font></font>
<font></font>
     ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しますが、状況は上記で書いたものと似ています。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.rodata</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションのデータが</font><strong><font style="vertical-align: inherit;">再度変更され</font></strong><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">たぶんそれは単にコピーと貼り付けのためのタイプミスであり、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tnameの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代わりに</font><strong><font style="vertical-align: inherit;">tmpbuf</font></strong><font style="vertical-align: inherit;">を書き</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たかったの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でしょうか？</font><font style="vertical-align: inherit;">それとも、本当に何かの裏に隠された意味があるのでしょうか？</font><font style="vertical-align: inherit;">いずれの場合でも、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char * tokename []</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char tokename [] [32]</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に置き換えると</font><font style="vertical-align: inherit;">、セグメンテーション違反エラーが削除され、Perlから次のように通知されます。</font></font><br>
<br>
<pre><code class="bash hljs">$ ./perl test.pl<font></font>
syntax error <span class="hljs-keyword">in</span> file test.pl at line 7, next token <span class="hljs-string">"strict"</span><font></font>
Execution aborted due to compilation errors.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はあらゆる種類の新しい</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">厳密な使用strict</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を好きではないことがわかりました</font><font style="vertical-align: inherit;">、それは彼が私たちに伝えようとしていることです！</font><font style="vertical-align: inherit;">ファイル内のこれらの行を削除またはコメント化すると、プログラムが起動します。</font></font><br>
<br>
<pre><code class="bash hljs">$ ./perl test.pl<font></font>
Hello, World!<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt;コンテンツにスキップ</font></font></em></a><br>
<br>
<a name="theend"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.まとめる</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、私は目標を達成し、1987年の古代のコードをコンパイルするだけでなく、最新のLinux環境でも動作させました。疑いもなく、64ビットアーキテクチャ上のポインタのサイズに関連する可能性がある、さまざまなセグメンテーションフォールトエラーの大きな山が残っています。これらはすべて、デバッガを使用して数晩座った後でクリーニングできます。しかし、これはあまり楽しくなくて退屈な作業ではありません。結局のところ、この実験は当初、退屈な夜の娯楽として計画されたものであり、本格的な作品としてではなく、終了する予定でした。取られた措置から実際的なメリットはありますか？たぶん、いつかデジタル考古学者がこの記事に出くわし、彼にとって役に立つでしょう。しかし、現実の世界では、そのような研究から得られた経験でさえ、私の意見ではあまり価値がありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味があれば、2つのパッチのセットを投稿します。</font><font style="vertical-align: inherit;">1つ目はコンパイルエラーを修正し、2つ目はいくつかのセグメンテーションフォールトエラーを修正します。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="コンパイルエラーパッチ、EXLMOTODEV GitHubリポジトリを修正します。"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perl1987-Fix-compilation-errors.patch</font></font></strong></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="一部のセグメンテーション違反パッチ、EXLMOTODEV GitHubリポジトリを修正します。"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perl1987-Fix-some-Segmentation-Faults.patch</font></font></strong></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS私は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Perl単一行プログラム、Lurkmore記事。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破壊的なシングルラインプレーヤーの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファンを混乱させるために急い</font><font style="vertical-align: inherit;">でいますが、これはここでは機能しません。おそらく、Perlのバージョンはそのような娯楽には古すぎます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPSすべて良いと良い週末があります。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Perl   1987 ,    LINUX.ORG.RU"><font style="vertical-align: inherit;">小さな修正</font></a><font style="vertical-align: inherit;">をして</font><font style="vertical-align: inherit;">くれた</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kawaii_neko</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">感謝し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="1987年からのPerl、LINUX.ORG.RUリソースに関するコメント"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新日2019年10月28日：</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニックネーム</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utf8nowhere</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用するLINUX.ORG.RUフォーラムのユーザーは、</font><font style="vertical-align: inherit;">この記事に関する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="1987年からのPerl、LINUX.ORG.RUリソースに関するコメント"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼のコメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に非常に興味深いリンク</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Perl   1987 ,    LINUX.ORG.RU"><font style="vertical-align: inherit;">を</font></a><font style="vertical-align: inherit;">提供</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="Perl   1987 ,    LINUX.ORG.RU"><font style="vertical-align: inherit;">しまし</font></a><font style="vertical-align: inherit;">た。この情報から、可変文字列リテラルの状況を明確にするだけでなく、上記の使用問題も考慮されます</font><strong><font style="vertical-align: inherit;">mktemp（）</font></strong><font style="vertical-align: inherit;">関数</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！標準化されていないK＆R CとGNU Cの間のさまざまな非互換性を説明するこれらのソースを引用させてください。</font></font><br>
<blockquote><strong>Incompatibilities of GCC</strong><br>
There are several noteworthy incompatibilities between GNU C and K&amp;R (non-ISO) versions of C.<br>
<br>
GCC normally makes string constants read-only. If several identical-looking string constants are used, GCC stores only one copy of the string.<br>
One consequence is that you cannot call <strong>mktemp</strong> with a string constant argument. The function <strong>mktemp</strong> always alters the string its argument points to.<br>
<br>
Another consequence is that <strong>sscanf</strong> does not work on some systems when passed a string constant as its format control string or input. This is because <strong>sscanf</strong> incorrectly tries to write into the string constant. Likewise <strong>fscanf</strong> and <strong>scanf</strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの問題に対する最善の解決策は、プログラムを変更して、</font><font style="vertical-align: inherit;">これらの目的のために、文字列定数の代わりに初期化文字列を持つ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -array変数</font><font style="vertical-align: inherit;">を使用する</font><font style="vertical-align: inherit;">ことです。</font><font style="vertical-align: inherit;">ただし、これが不可能な場合は、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-fwritable-strings</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグを</font><font style="vertical-align: inherit;">使用できます</font><font style="vertical-align: inherit;">。これにより、ほとんどのCコンパイラと同じ方法で文字列定数を処理するようにGCCに指示できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出典：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="GNUコンパイラコレクション（GCC 3.3）の公式マニュアルを使用する。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using the GNU Compiler Collection（GCC 3.3）Official Manual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
</blockquote><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-fwritable-strings</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイラフラグ</font><font style="vertical-align: inherit;">はGCC 3.4で廃止され、GCC 4.0で完全に削除されました。</font></font><br>
<blockquote><strong>ANSI C rationale | String literals</strong><br>
String literals are specified to be unmodifiable. This specification allows implementations to share copies of strings with identical text, to place string literals in read-only memory, and perform certain optimizations. However, string literals do not have the type array of const char, in order to avoid the problems of pointer type checking, particularly with library functions, since assigning a pointer to const char to a plain pointer to char is not valid. Those members of the Committee who insisted that string literals should be modifiable were content to have this practice designated a common extension (see F.5.5).<br>
<br>
Existing code which modifies string literals can be made strictly conforming by replacing the string literal with an initialized static character array. For instance,<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">char</span> *p, *make_temp(<span class="hljs-keyword">char</span> *str);
    <span class="hljs-comment">/* ... */</span>
p = make_temp(<span class="hljs-string">"tempXXX"</span>);
        <span class="hljs-comment">/* make_temp overwrites the literal */</span>
        <span class="hljs-comment">/* with a unique name */</span>
</code></pre><br>
can be changed to:<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">char</span> *p, *make_temp(<span class="hljs-keyword">char</span> *str);
    <span class="hljs-comment">/* ... */</span><font></font>
{<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">template</span>[ ] = <span class="hljs-string">"tempXXX"</span>;<font></font>
    p = make_temp( <span class="hljs-keyword">template</span> );<font></font>
}<font></font>
</code></pre><br>
: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="情報システムの米国国家標準、プログラミング言語C、文字列リテラルの根拠。">Rationale for American National Standard for Information Systems, Programming Language C</a>.<br>
</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VarfolomeyKote4ka</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><strong><font style="vertical-align: inherit;">.rodata</font></strong><font style="vertical-align: inherit;">セクションのデータを</font><strong><font style="vertical-align: inherit;">.rwdata</font></strong><font style="vertical-align: inherit;">セクションに変換して</font><font style="vertical-align: inherit;">変更しようとするときに、セグメンテーション違反エラーをバイパスできる</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="1987年からのPerl、LINUX.ORG.RUリソースに関するコメント"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深いダーティハック</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">提案しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プログラマーの</font><strong><font style="vertical-align: inherit;">guye1296</font></strong><font style="vertical-align: inherit;">がインターネット上で</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title=".rodataから.rwdataへ-メモリマッピングとLDスクリプトの紹介、BITSのガイ。"><font style="vertical-align: inherit;">「.rodataから.rwdataへ-メモリマッピングとLDスクリプトの紹介」</font></a><font style="vertical-align: inherit;">という非常に興味深い記事を掲載しました</font><font style="vertical-align: inherit;">。目的の結果を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="ldリンカー、guye1296、GitHubリポジトリ用のrwdata.ldスクリプト。"><font style="vertical-align: inherit;">簡単に</font></a><font style="vertical-align: inherit;">取得できるように、記事の作成者は標準リンカー</font><strong><font style="vertical-align: inherit;">ld</font></strong><font style="vertical-align: inherit;"> - </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="ldリンカー、guye1296、GitHubリポジトリ用のrwdata.ldスクリプト。"><font style="vertical-align: inherit;">rwdata.ld</font></a><font style="vertical-align: inherit;">用にかなりボリュームのあるスクリプトを作成しました。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title=".rodataから.rwdataへ-メモリマッピングとLDスクリプトの紹介、BITSのガイ。"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="ldリンカー、guye1296、GitHubリポジトリ用のrwdata.ldスクリプト。"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このスクリプトをダウンロードしてPerlソースディレクトリのルートに配置し、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDFLAGS</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグ</font><font style="vertical-align: inherit;">を次のように</font><font style="vertical-align: inherit;">修正する</font><strong><font style="vertical-align: inherit;">だけで十分</font></strong><font style="vertical-align: inherit;">です</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。LDFLAGS= -T rwdata.ld</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プロジェクトを再ビルドします。</font><font style="vertical-align: inherit;">その結果、次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">$ make clean &amp;&amp; make -j1<font></font>
$ mv perl perl_rodata<font></font>
<font></font>
$ curl -LOJ https://raw.githubusercontent.com/guye1296/ld_script_elf_blog_post/master/rwdata.ld<font></font>
$ sed -i <span class="hljs-string">'s/LDFLAGS =/LDFLAGS = -T rwdata.ld/'</span> Makefile<font></font>
$ make clean &amp;&amp; make -j1<font></font>
$ mv perl perl_rwdata<font></font>
<font></font>
$ objdump -s -j .rodata perl_rodata | grep tmp -2<font></font>
 19da0 21233f5e 7e3d2d25 30313233 34353637  !<span class="hljs-comment">#?^~=-%01234567</span><font></font>
 19db0 38392e2b 262a2829 2c5c2f5b 7c002400  89.+&amp;*(),\/[|.$.<font></font>
 19dc0 73746465 7272002f 746d702f 7065726c  stderr./tmp/perl<font></font>
 19dd0 2d655858 58585858 00323536 00617070  -eXXXXXX.256.app<font></font>
 19de0 656e6400 6c6f6f70 63746c00 66756e63  end.loopctl.func<font></font>
$ objdump -s -j .rwdata perl_rodata | grep tmp -2<font></font>
objdump: section <span class="hljs-string">'.rwdata'</span> mentioned <span class="hljs-keyword">in</span> a -j option, but not found <span class="hljs-keyword">in</span> any input file<font></font>
<font></font>
$ objdump -s -j .rwdata perl_rwdata | grep tmp -2<font></font>
 41d9c0 21233f5e 7e3d2d25 30313233 34353637  !<span class="hljs-comment">#?^~=-%01234567</span><font></font>
 41d9d0 38392e2b 262a2829 2c5c2f5b 7c002400  89.+&amp;*(),\/[|.$.<font></font>
 41d9e0 73746465 7272002f 746d702f 7065726c  stderr./tmp/perl<font></font>
 41d9f0 2d655858 58585858 00323536 00617070  -eXXXXXX.256.app<font></font>
 41da00 656e6400 6c6f6f70 63746c00 66756e63  end.loopctl.func<font></font>
$ objdump -s -j .rodata perl_rwdata | grep tmp -2<font></font>
objdump: section <span class="hljs-string">'.rodata'</span> mentioned <span class="hljs-keyword">in</span> a -j option, but not found <span class="hljs-keyword">in</span> any input file<font></font>
<font></font>
$ ./perl_rodata -e <span class="hljs-string">'print "Hello, World!\n";'</span><font></font>
Segmentation fault (core dumped)<font></font>
$ ./perl_rwdata -e <span class="hljs-string">'print "Hello, World!\n";'</span><font></font>
Hello, World!<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このハックのおかげで、2番目のパッチからのほとんどすべての変更を単純に省略できることがわかりました。</font><font style="vertical-align: inherit;">もちろん、コードを標準に違反しない外観にすることは依然として望ましいですが。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt;コンテンツにスキップ</font></font></em></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja473214/index.html">ヤーガ-モバイル環境でのスラブの物語</a></li>
<li><a href="../ja473218/index.html">プリンシパル開発者のIvan Kruglovへのインタビュー：サービスメッシュと「非標準」のBooking.comツール</a></li>
<li><a href="../ja473220/index.html">Wolfram言語の遅いコードの破壊の土台：コードを数十、数百、数千回高速化</a></li>
<li><a href="../ja473222/index.html">zabbixを例として使用するdockerのカスタムiptablesルール</a></li>
<li><a href="../ja473224/index.html">高等教育vsコンピテンシー。高等教育の状態に関するロシア連邦憲法裁判所の裁判官の個別の意見</a></li>
<li><a href="../ja473230/index.html">衛星インターネットは新しい宇宙競争ですか？</a></li>
<li><a href="../ja473232/index.html">Какую систему управления версиями вы используете (в реальной работе, больше всего)?</a></li>
<li><a href="../ja473234/index.html">Node.jsとOracleデータベースを使用したREST APIの作成</a></li>
<li><a href="../ja473236/index.html">クラウドでのIT、プロジェクト管理、PD規制、開発での作業：1cloud.ruのmegadigest</a></li>
<li><a href="../ja473238/index.html">Netflixの仕組み</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>