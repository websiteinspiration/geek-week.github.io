<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧜🏾 👩🏾‍🎨 🙄 Não é um dia sem esportes - 2: reprogramando uma pulseira chinesa 🙇🏽 🙋 👩🏽‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para as pessoas envolvidas no esporte, um companheiro frequente de corrida ou corrida é um smartphone com vários aplicativos. Com uma bicicleta, é mai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Não é um dia sem esportes - 2: reprogramando uma pulseira chinesa</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499774/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para as pessoas envolvidas no esporte, um companheiro frequente de corrida ou corrida é um smartphone com vários aplicativos. </font><font style="vertical-align: inherit;">Com uma bicicleta, é mais fácil, você pode consertar um smartphone, por exemplo, no volante e assistir aos dados dos sensores. </font><font style="vertical-align: inherit;">Mas e se você estiver correndo ou esquiando? </font><font style="vertical-align: inherit;">Você pode consertar o smart na sua mão, pois existem capas especiais (incluindo as giratórias). </font><font style="vertical-align: inherit;">Mas isso é inconveniente e às vezes complicado. </font><font style="vertical-align: inherit;">Além disso, o herói russo não vai diretamente.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/j1/q_/fz/j1q_fzwtiw73syp5etvzvj7rtz0.png"></div><br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem vários artigos na Internet nos quais os entusiastas fazem seus relógios inteligentes. </font><font style="vertical-align: inherit;">Caixa fabricada ou impressa. </font><font style="vertical-align: inherit;">Faça o recheio. </font><font style="vertical-align: inherit;">Mas existem muitos dispositivos prontos no aliexpress. </font><font style="vertical-align: inherit;">Por exemplo, como na foto abaixo. </font><font style="vertical-align: inherit;">Se você acredita na descrição, é um super dispositivo direto: mede a frequência cardíaca, a pressão, as calorias e outras coisas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/1e/lx/_m/1elx_m11liwbpplrvgyeuv6ysre.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos abrir e ver o que está dentro.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zh/nh/a7/zhnha7n6p12xuxjq7orp3viizem.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ig/yt/c2/igytc2hz31xj2jcedbdn2wjxuso.jpeg"></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E de fato</font></font></b>
                        <div class="spoiler_text">        .           .       Random()  . ,  ,    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>.<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oa/hw/qq/oahwqqwuxmukbxri_l8ripqzsha.jpeg"></div></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cérebro dessa pulseira é um chip PHY6202 de um fabricante da Microelectronics Middle Kingdom Fengjia. No interior, possui um Cortex-M0 e um conjunto padrão de periféricos. Memória: Flash de 512kB, SRAM de 138kB e ROM de 128kB. A ROM contém uma pilha BLE e um gerenciador de inicialização UART, como chip programável através do UART. Os camaradas chineses trouxeram cuidadosamente contatos para o UART. Para alternar para o modo UART, o carregador de inicialização precisa elevar a saída da TM para um nível alto e redefinir o chip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os utilitários e SDKs do PHY6202 (assim como do irmão mais velho dele, PHY6212) podem ser encontrados </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O utilitário de programação de chips PhyPlusKit é fornecido diretamente. </font><font style="vertical-align: inherit;">A documentação possui uma lista de comandos: apagar, gravar etc. Detalhes no documento PHY62XX_UART_FlashWrite_Protocol no link acima (em chinês). </font><font style="vertical-align: inherit;">Honestamente, a lista de comandos não está completa. </font><font style="vertical-align: inherit;">O PhyPlusKit usa outro comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rdreg</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (leia qualquer registro). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos começar. </font><font style="vertical-align: inherit;">Desmontamos, soldamos os contatos necessários ao adaptador UART-USB e </font></font><abbr title="Faça backup de tudo o que é possível.  “Readback?  Não, não ouvi."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pronto</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O SDK contém muitos exemplos. </font><font style="vertical-align: inherit;">Em si, na minha opinião, é torto e úmido. </font><font style="vertical-align: inherit;">Às vezes você tem que editar a fonte, porque </font><font style="vertical-align: inherit;">eles não foram projetados apenas para uso “externo”. </font><font style="vertical-align: inherit;">Aqui está a função de medição do nível da bateria do Battery Service. </font><font style="vertical-align: inherit;">Por que ela está lá incompreensível?</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> uint8 <span class="hljs-title">battMeasure</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{<font></font>
  uint8 percent;<font></font>
  percent = <span class="hljs-number">95</span>;
  <span class="hljs-keyword">return</span> percent;<font></font>
} </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não é um SDK, mas um exemplo sólido. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pinagem da pulseira é:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) acelerômetro</font></font></td>
<td>SDA P32<br>
SCL P33</td>
</tr>
<tr>
<td>2) LCD</td>
<td>SDA P25<br>
SCL P31<br>
RS P00<br>
Reset P01<br>
CS P02<br>
LED P34</td>
</tr>
<tr>
<td>3)  </td>
<td>P03</td>
</tr>
<tr>
<td>4) </td>
<td>P20</td>
</tr>
<tr>
<td>5) USB Vin (   USB)</td>
<td>P15</td>
</tr>
<tr>
<td>6) Vbat</td>
<td>P14/AIO3</td>
</tr>
<tr>
<td>7) Green LED (  )</td>
<td>P23</td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tela é padrão (cheia no aliexpress) no ST7735 com uma resolução de 80 * 160. Desenvolvido por SPI. Existem bibliotecas prontas para isso, mas é melhor criar sua própria versão leve, para o tamanho da fonte e seus próprios caracteres. A tela é colorida, mas isso não é muito relevante na rua, pois baixo contraste (lembrou-se tristemente dos monitores transflectivos dos telefones Siemens). Sim, e vidro colorido. Usaremos a cor branca para exibir o texto, é melhor visualizado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O botão de toque é fabricado em um chip Tontec TTP233D-HA6. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O acelerômetro é desconhecido, mas a varredura do barramento I2C mostrou que ele usa registros como todos os acelerômetros ST. Acima de tudo, é semelhante ao LIS2DH12. Parece que todos os registros de controle correspondem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para exibir nossas informações na pulseira, precisamos do nosso próprio serviço BLE para transferência de dados. </font><font style="vertical-align: inherit;">Algo como o </font></font><abbr title="Perfil de porta serial"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPP</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Além disso, você pode adicionar o Serviço de bateria e atualização de firmware via BLE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como base para o projeto, pegamos um exemplo de firmware para atualizar o </font></font><abbr title="Over the air"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OTA</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o refazemos de acordo com nossas necessidades. </font><font style="vertical-align: inherit;">Adicione um serviço para a bateria. </font><font style="vertical-align: inherit;">Para transferir dados, você pode usar um exemplo de implementação de um serviço personalizado do SDK. </font><font style="vertical-align: inherit;">Utiliza um serviço FF01 e nele uma característica FF02.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spoiler</font></font></b>
                        <div class="spoiler_text">   SDK     GPIO     0,   .    .       ,      .         ,     pull-up   pull-down (   100 )        .     .           40 ,    «» pull-down,    15  (     ).<br>
</div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prendemos os serviços de trabalho:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interromper o manuseio pelo botão de toque. </font><font style="vertical-align: inherit;">Além de ligar a tela e ligar / desligar a pulseira, faremos reconhecimento de toque único e duplo com a transmissão de um comando através de nossa característica FF02.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saída de dados recebidos de um smartphone pela mesma característica da tela.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">breve inclusão de um vibromotor para chamar a atenção.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando o acelerômetro, ligando a tela com um aceno agudo da mão (é difícil de configurar, porque quando você corre, agita as mãos).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, a pulseira está pronta. </font><font style="vertical-align: inherit;">Verificamos através do nRFConnect, que permite ler e escrever os valores das características. </font><font style="vertical-align: inherit;">Na tela, o pulso, o tempo, a distância e outro temporizador (por exemplo, para exibir o intervalo de tempo ou exibir o gráfico, ou seja, uma espécie de marca-passo, mas isso só pode ser obtido com a sua aplicação).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yw/15/c8/yw15c888j_n2kg56fpeuxwi0lim.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora precisamos levar os dados para algum lugar para transmiti-los. Atualmente, uso o aplicativo Strava, embora goste cada vez menos. Talvez a maneira mais fácil de obter tempo de corrida dela e a distância (embora com arredondamento para 100 m) das notificações na barra de status. Para fazer isso, você precisa escrever um aplicativo com um serviço para ouvir notificações. Isto não é difícil. Mas leremos o pulso diretamente do cinto BLE ou ANT +. Bem, como temos notificações do bracelete sobre pressionar os botões, precisamos usá-los em algum lugar. Por exemplo, você pode, enviando mensagens através do BroadCastReceiver, pausar o Strava e reiniciá-lo. E é melhor um dia fazer seu Strava com sinos e assobios. O aplicativo requer direitos para acessar o local (isso é necessário para trabalhar com o BLE) e direitos para acessar notificações.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resta verificar o caso. Infelizmente, o inverno terminou em fevereiro, então o ciclo da imagem no início do artigo já terminou. Mas você pode dar uma corrida. O acelerômetro geralmente liga a tela desnecessariamente, talvez deva ser completamente desligado. Um botão de toque pode reagir a uma queda que caiu da testa.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vc/7c/go/vc7cgorhq8yuzwjdl2ju4oqhrpa.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ad/za/tt/adzattbhn-7hvqcxu0e55o55f88.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lu/er/lt/luerltdtedmppo1bwkiy4skyrhk.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, finalmente, as boas notícias. </font><font style="vertical-align: inherit;">A pulseira já de fábrica suporta a atualização do OTA por meio do aplicativo PhyApp (ela fica no mesmo local que o SDK, originalmente em chinês). </font><font style="vertical-align: inherit;">Portanto, com um firmware pronto, não é necessário desmontar a pulseira. </font><font style="vertical-align: inherit;">Flash e uso. </font><font style="vertical-align: inherit;">Para fazer isso, você precisa instalar o aplicativo, colocar o firmware na “raiz” do telefone (HEX, não HEXF, pois o último contém o gerenciador de inicialização que já temos de fábrica), conectar à pulseira e usar o botão OTA para carregar o firmware na pulseira. </font><font style="vertical-align: inherit;">Depois de piscar, o bracelete será desligado. Para ligá-lo, mantenha o botão pressionado por 2 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, relógios e pulseiras no PHY62 podem ser facilmente convertidos em qualquer coisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Referências:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">códigos-fonte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e APK de um aplicativo Android (foi escrito no Android 8.1, parece funcionar com menos de 9 anos, não foi verificado com outros);</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquivo de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> firmware </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HEX</font></a><font style="vertical-align: inherit;"> via BLE e HEXF - para firmware via UART (não me importo com a fonte, mas preciso entender que posso carregá-lo mediante contrato de licença e quem não escreve neste especial) + aplicativo de firmware PhyApp para firmware OTA.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comprei uma pulseira </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas não posso garantir que o recheio será o mesmo, porque </font><font style="vertical-align: inherit;">muito parecido na aparência, mas com um chip diferente. </font><font style="vertical-align: inherit;">Existem tipos de opções com uma tela maior, que também possui o PHY6202. </font><font style="vertical-align: inherit;">Em geral, existem relógios / pulseiras com chips diferentes (Phy +, Telink e até nRF).</font></font><br>
</li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Em geral, parece que o SDK para PHY62 foi criado com base no SDK da Texas Instruments para seus chips BLE.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt499758/index.html">Padrões arquitetônicos convenientes</a></li>
<li><a href="../pt499762/index.html">Melhore suas habilidades no DevSecOps: 5 webinars com teoria e prática</a></li>
<li><a href="../pt499764/index.html">Revisão do scanner 3D XYZPrinting 3D Hand 2.0</a></li>
<li><a href="../pt499770/index.html">Aprenda enquanto auto-isolamento</a></li>
<li><a href="../pt499772/index.html">Será muito, muito: como a tecnologia 5G mudará o mercado publicitário</a></li>
<li><a href="../pt499776/index.html">Características da implementação da linguagem MSH</a></li>
<li><a href="../pt499784/index.html">O que toca nas paredes virtuais?</a></li>
<li><a href="../pt499786/index.html">Classificação de pilha fraca</a></li>
<li><a href="../pt499788/index.html">Curso online gratuito "Documentação técnica em projetos de TI"</a></li>
<li><a href="../pt499792/index.html">Teste de carga Atlassian Jira, Confluence, Bitbucket Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>