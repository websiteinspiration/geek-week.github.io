<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ… ğŸ¥› ğŸ’†ğŸ¼ ãƒ¢ãƒã‚¤ãƒ«PvPã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®ç‰©ç†å­¦ã¨ã€ECSã¨ã®å‹æƒ… ğŸ¤˜ğŸ¾ ğŸ¤¦ğŸ¿ ğŸ§‘â€ğŸ¤â€ğŸ§‘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã¿ãªã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ã“ã®è¨˜äº‹ã§ã¯ã€ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ“ä½œã™ã‚‹å€‹äººçš„ãªçµŒé¨“ã«ã¤ã„ã¦èª¬æ˜ã—ã€ä¸»ã«ç‰©ç†å­¦ã¨ECSã®ç›¸äº’ä½œç”¨ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚ä½œæ¥­ä¸­ã«ã©ã®ã‚ˆã†ãªç¨®é¡ã®ãƒ¬ãƒ¼ã‚­ã‚’å–ã‚Šå…¥ã‚ŒãŸã‹ã€å­¦ã‚“ã ã“ã¨ã€ç‰¹å®šã®è§£æ±ºç­–ã«ç€æ‰‹ã—ãŸç†ç”±ã€‚
 
 
 
 ã¾ãšã€ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ãŒå¿…è¦ãªç†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ãƒ¢ãƒã‚¤ãƒ«PvPã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®ç‰©ç†å­¦ã¨ã€ECSã¨ã®å‹æƒ…</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/481880/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¿ãªã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ã“ã®è¨˜äº‹ã§ã¯ã€ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ“ä½œã™ã‚‹å€‹äººçš„ãªçµŒé¨“ã«ã¤ã„ã¦èª¬æ˜ã—ã€ä¸»ã«ç‰©ç†å­¦ã¨</font></font><abbr title="ECSã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ã‚¸ãƒƒã‚¯ã‹ã‚‰åˆ†é›¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æŒ‡å‘ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚ ãƒ‡ãƒ¼ã‚¿ã¯ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŠã‚ˆã³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å±ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦è¡¨ã•ã‚Œã¾ã™ã€‚ ãƒ­ã‚¸ãƒƒã‚¯ã¯ã‚·ã‚¹ãƒ†ãƒ ã§èª¬æ˜ã•ã‚Œã¦ãŠã‚Šã€é€šå¸¸ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é€šéã—ã¦å¤‰æ›´ã—ã€æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œæˆã—ã¾ã™ã€‚"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECSã®</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸äº’ä½œç”¨ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä½œæ¥­ä¸­ã«ã©ã®ã‚ˆã†ãªç¨®é¡ã®ãƒ¬ãƒ¼ã‚­ã‚’å–ã‚Šå…¥ã‚ŒãŸã‹ã€å­¦ã‚“ã ã“ã¨ã€ç‰¹å®šã®è§£æ±ºç­–ã«ç€æ‰‹ã—ãŸç†ç”±ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/b_/2-/gpb_2-4ml1nwdsb443-f2pp6zyu.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ãšã€ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ãŒå¿…è¦ãªç†ç”±ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚æ™®éçš„ãªç­”ãˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã©ã®ã‚²ãƒ¼ãƒ ã§ã‚‚ç›®çš„ã‚’æœãŸã—ã¾ã™ã€‚ä¸€éƒ¨ã®ã‚²ãƒ¼ãƒ ã§ã¯ã€ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€ä¸–ç•Œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹•ä½œã‚’æ­£ã—ãã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ²¡å…¥ã•ã›ã‚‹åŠ¹æœã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚ä»–ã®ã‚²ãƒ¼ãƒ ã§ã¯ã€ç‰©ç†ã¯ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã®åŸºç¤ã§ã™-ãŸã¨ãˆã°ã€Angry Birdsã‚„Red Factionãªã©ã€‚ã¾ãŸã€ç‰©ç†çš„ãªæ³•å‰‡ãŒé€šå¸¸ã®æ³•å‰‡ã¨ã¯ç•°ãªã‚‹ã€Œã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã€ã‚‚ã‚ã‚Šã€ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ãŒã‚ˆã‚Šé¢ç™½ãã€çã—ã„ã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ï¼ˆPortalã€A Slower Speed of Lightï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®è¦³ç‚¹ã‹ã‚‰ã¯ã€ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã‚Šã€ã‚²ãƒ¼ãƒ å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹•ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç°¡ç•¥åŒ–ã§ãã¾ã™ã€‚å®Ÿéš›ã€ã“ã‚Œã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç‰©ç†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨˜è¿°ã‚’æ ¼ç´ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ç‰©ç†çš„ãªã‚¨ãƒ³ã‚¸ãƒ³ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ã‚²ãƒ¼ãƒ ä¸–ç•ŒãŒç”Ÿãã‚‹èº«ä½“ã¨æ™®éçš„ãªæ³•å‰‡ã¨ã®é–“ã®ç›¸äº’ä½œç”¨ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è†¨å¤§ãªæ™‚é–“ã¨é–‹ç™ºä½œæ¥­ã‚’ç¯€ç´„ã§ãã¾ã™ã€‚</font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ä¸Š</font></a></i></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/5ef/938/61f/5ef93861ff7c4921e44bcf14902cab51.jpg" alt="ç”»åƒ"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›³ã§ã¯</font></font></a>   Player,     ,  ,       .      :      â€”  Transform  Movement,  MoveSystem;   -     â€”  Health, Damage,  DamageSystem;       (respawn) â€”  Transform  ,  RespawnSystem;    â€”  Invincible.</i><br>
<br>
<h2>        ?</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ãŸã¡ã®ã‚²ãƒ¼ãƒ ã«ã¯è¤‡é›‘ãªç‰©ç†çš„ç›¸äº’ä½œç”¨ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ç‰©ç†çš„ã‚¨ãƒ³ã‚¸ãƒ³ãŒä¾ç„¶ã¨ã—ã¦å¿…è¦ã¨ãªã‚‹å¤šãã®ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚æœ€åˆã¯ã€ã“ã‚Œã‚’ä½¿ç”¨ã—ã¦ã€æ‰€å®šã®æ³•å‰‡ã«å¾“ã£ã¦ä¸–ç•Œã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ç§»å‹•ã™ã‚‹äºˆå®šã§ã—ãŸã€‚é€šå¸¸ã€ã“ã‚Œã¯ãƒœãƒ‡ã‚£ã«ç‰¹å®šã®ã‚¤ãƒ³ãƒ‘ãƒ«ã‚¹ã¾ãŸã¯ä¸€å®šã®é€Ÿåº¦ã‚’ä¸ãˆã‚‹ã“ã¨ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã¾ã™ã€‚ãã®å¾Œã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®Simulate / Updateãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ãã“ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒœãƒ‡ã‚£ãŒ1ã‚¹ãƒ†ãƒƒãƒ—ã ã‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã§ã¯ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å‹•ãã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã ã‘ã§ãªãã€å¼¾ä¸¸ã‚„ãƒ­ã‚±ãƒƒãƒˆã®å¼¾é“ã€ã‚¸ãƒ£ãƒ³ãƒ—ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åŒå£«ã®ç›¸äº’ä½œç”¨ã‚„ç’°å¢ƒã‚’æ­£ã—ãå‡¦ç†ã™ã‚‹ãŸã‚ã«ã€3Dç‰©ç†ãŒã‚ˆãä½¿ç”¨ã•ã‚Œã¾ã™ã€‚å°„æ‰‹ãŒç¾å®Ÿçš„ã§ã‚ã‚‹ã¨ä¸»å¼µã—ã€å°„æ’ƒãƒ—ãƒ­ã‚»ã‚¹ã®æœ¬å½“ã®æ„Ÿè¦šã‚’ä¼ãˆã‚ˆã†ã¨ã™ã‚‹å ´åˆã€ç‰©ç†çš„ãªã‚¨ãƒ³ã‚¸ãƒ³ãŒå¿…è¦ã§ã™ã€‚ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã‚·ãƒ§ãƒƒãƒˆã‚¬ãƒ³ã‚’æ’ƒã£ãŸã¨ãã€å½¼ã¯çµŒé¨“ã¨ã€ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®é•·æœŸçš„ãªã‚²ãƒ¼ãƒ ã‹ã‚‰ã™ã§ã«çŸ¥ã£ã¦ã„ã‚‹ã‚‚ã®ã«å¯èƒ½ãªé™ã‚Šè¿‘ã„çµæœã‚’å¾—ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™-æ ¹æœ¬çš„ã«æ–°ã—ã„ä½•ã‹ã¯ã€ãŠãã‚‰ãå½¼ã‚’ä¸æ„‰å¿«ã«é©šã‹ã›ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ã‹ã—ã€ç§ãŸã¡ã®ã‚²ãƒ¼ãƒ ã®å ´åˆã€ã„ãã¤ã‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚ç§ãŸã¡ã®ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã¯å¯å‹•å¼ã§ã‚ã‚‹ãŸã‚ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åŒå£«ã‚„å‘¨å›²ã®ä¸–ç•Œã¨ã®è¤‡é›‘ãªç›¸äº’ä½œç”¨ã‚’æ„å‘³ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€ç¾ã—ã„å¼¾é“ã€ç ´å£Šæ€§ã€å‡¹å‡¸ã®ã‚ã‚‹è¡¨é¢ã§ã®ã‚¸ãƒ£ãƒ³ãƒ—ã‚’å¿…è¦ã¨ã—ã¾ã›ã‚“ã€‚ã—ã‹ã—åŒæ™‚ã«ã€åŒã˜ç†ç”±ã§ã€éå¸¸ã«å³ã—ã„ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ä»¶ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€3Dç‰©ç†æ¼”ç®—ã¯å†—é•·ã«ãªã‚Šã¾ã™ã€‚ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚½ãƒ¼ã‚¹ã®ã”ãä¸€éƒ¨ã—ã‹ä½¿ç”¨ã›ãšã€ä¸è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã¯ã€UDPã‚’ä»‹ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã‚’å¸¸ã«åŒæœŸã™ã‚‹ã¨ã€å¿…è¦ãªã‚¹ãƒšãƒ¼ã‚¹ãŒå¤§ãããªã‚Šã¾ã™ã€‚ç§ãŸã¡ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¢ãƒ‡ãƒ«ã«ã¯ã€</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">äºˆæ¸¬ã‚„èª¿æ•´</font></a><font style="vertical-align: inherit;">ãªã©ã®ã‚‚ã®ãŒã¾ã æ®‹ã£ã¦ã„ã‚‹ã“ã¨ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å’Œè§£ã‚‚å«ã¿ã¾ã™ã€‚ãã®çµæœã€ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚„ä»–ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ã«å¹²æ¸‰ã™ã‚‹ã“ã¨ãªãã€ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã§æ­£å¸¸ã«èµ·å‹•ã—ã¦ä½œæ¥­ã™ã‚‹ãŸã‚ã«ã€ç‰©ç†æ¼”ç®—ãŒå¯èƒ½ãªé™ã‚Šé«˜é€Ÿã«å‹•ä½œã™ã‚‹ã¯ãšã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®ãŸã‚ã€3Dç‰©ç†å­¦ã¯ç§ãŸã¡ã«é©ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚ãŸã ã—ã€ã“ã“ã§ã¯ã€ã‚²ãƒ¼ãƒ ãŒ3æ¬¡å…ƒã®ã‚ˆã†ã«è¦‹ãˆã¦ã‚‚ã€ç‰©ç†ãŒ3æ¬¡å…ƒã§ã‚ã‚‹ã“ã¨ã¯äº‹å®Ÿã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã™ã¹ã¦ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç›¸äº’ä½œç”¨ã®æ€§è³ªã‚’æ±ºå®šã—ã¾ã™ã€‚å¤šãã®å ´åˆã€2Dç‰©ç†ã§ã¯ã‚«ãƒãƒ¼ã§ããªã„åŠ¹æœã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Šã€3æ¬¡å…ƒã®ç›¸äº’ä½œç”¨ã®ã‚ˆã†ã«è¦‹ãˆã‚‹ãƒ­ã‚¸ãƒƒã‚¯ãŒä½œæˆã•ã‚Œã‚‹ã‹ã€ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã«å½±éŸ¿ã‚’ä¸ãˆãªã„è¦–è¦šåŠ¹æœã«å˜ç´”ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚ Heroes of the Stormã€Defense of the Ancientsã€League of Legendsã§ã¯ã€2æ¬¡å…ƒã®ç‰©ç†å­¦ã«ã‚ˆã‚Šã€ã‚²ãƒ¼ãƒ ã®ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã‚„ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãŒä½œæˆã—ãŸç”»åƒã®å“è³ªã‚„ä¿¡é ¼æ€§ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ãªãã€ã‚²ãƒ¼ãƒ ã®ã™ã¹ã¦ã®ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤æ©Ÿèƒ½ã‚’æä¾›ã§ãã¾ã™ã€‚ãŸã¨ãˆã°ã€ã“ã‚Œã‚‰ã®ã‚²ãƒ¼ãƒ ã§ã¯ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒã„ã¾ã™ãŒã€ã‚¸ãƒ£ãƒ³ãƒ—ã®é«˜ã•ã«ç‰©ç†çš„ãªæ„Ÿè¦šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ã€ãã‚Œã¯2æ¬¡å…ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å¸°ç€ã—ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒç©ºä¸­ã«ã„ã‚‹ã¨ãã«_isInTheAirå½¢å¼ã®ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã—ã¾ã™-ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨ˆç®—ã™ã‚‹ã¨ãã«è€ƒæ…®ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã“ã§ã€2Dç‰©ç†æ¼”ç®—ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒæ±ºå®šã•ã‚Œã¾ã—ãŸã€‚ã‚²ãƒ¼ãƒ ã¯Unityã§è¨˜è¿°ã—ã¦ã„ã¾ã™ãŒã€ã‚µãƒ¼ãƒãƒ¼ã¯Unityãªã—ã®.netã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€Unityã¯ã“ã‚Œã‚’ç†è§£ã—ã¦ã„ã¾ã›ã‚“ã€‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®å¤§éƒ¨åˆ†ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã®é–“ã§ã¶ã¤ã‹ã‚‹ã®ã§ã€ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ã¤ã¾ã‚Šãƒ¢ãƒã‚¤ãƒ«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã®ãƒªã‚¹ã‚¯ã‚’æ’é™¤ã™ã‚‹ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã›ãšã«ç´”ç²‹ãªCï¼ƒã§è¨˜è¿°ã•ã‚ŒãŸç‰©ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¢ã—å§‹ã‚ã¾ã—ãŸã€‚ã•ã‚‰ã«ã€</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">å°„æ‰‹ã®è©³ç´°</font></a><font style="vertical-align: inherit;">ã‚’è€ƒæ…®ã«å…¥ã‚Œã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹ã«ã€ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒã©ã“ã‚’æ’ƒã£ã¦ã„ãŸã‹ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ä¸€å®šã®å·»ãæˆ»ã—ã‚’è¡Œã†ã“ã¨ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå±¥æ­´ã¨é€£å‹•ã§ãã‚‹ã“ã¨ãŒé‡è¦ã§ã—ãŸã€‚ã¤ã¾ã‚Šã€Nãƒ•ãƒ¬ãƒ¼ãƒ å‰ã®ãƒœãƒ‡ã‚£ã®ä½ç½®ã‚’å®‰ãç¢ºèªã§ãã¾ã—ãŸã€‚ãã—ã¦ã‚‚ã¡ã‚ã‚“ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ”¾æ£„ã•ã‚Œã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä½œè€…ãŒãã‚Œã‚’ã‚µãƒãƒ¼ãƒˆã—ã€é‹ç”¨ä¸­ã«ãƒã‚°ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã™ãã«ãƒã‚°ã‚’ä¿®æ­£ã§ãã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çµå±€ã®ã¨ã“ã‚ã€ç¾æ™‚ç‚¹ã§ã¯ã€è¦ä»¶ã‚’æº€ãŸã™ã“ã¨ãŒã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã€‚å®Ÿéš›ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VolatilePhysicsã®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1ã¤ã ã‘ãŒç§ãŸã¡ã«é©ã—ã¦ã„ã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€Unityã¨Unityã‚’ä½¿ç”¨ã—ãªã„ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸¡æ–¹ã§æ©Ÿèƒ½ã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éå»ã®çŠ¶æ…‹ã«ã™ãã«å†ã‚­ãƒ£ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ã„ã†ç‚¹ã§æ³¨ç›®ã«å€¤ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã«é©ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã•ã‚‰ã«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆ©ä¾¿æ€§ã¯ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹å§‹Simulateï¼ˆï¼‰ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã«ã‚ˆã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå¿…è¦ãªã¨ãã«ã„ã¤ã§ã‚‚ãã‚Œã‚’ç”Ÿæˆã§ãã‚‹ã“ã¨ã«ã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚‚ã†1ã¤ã®æ©Ÿèƒ½-è¿½åŠ ã®ãƒ‡ãƒ¼ã‚¿ã‚’èº«ä½“ã«æ›¸ãè¾¼ã‚€æ©Ÿèƒ½ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€reykastã®çµæœã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¢ãƒ‰ãƒ¬ã‚¹æŒ‡å®šã™ã‚‹ã¨ãã«å½¹ç«‹ã¡ã¾ã™ãŒã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå¤§å¹…ã«ä½ä¸‹ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã„ãã¤ã‹ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã›ãšã«VolatilePhysicsã¨é©åˆ‡ã«ç›¸äº’ä½œç”¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸå¾Œã€ãã‚Œã‚’é¸æŠã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ECSã§ä½œæ¥­ã™ã‚‹é€šå¸¸ã®æ–¹æ³•ã«ã©ã®ã‚ˆã†ã«å…¥åŠ›ã—ãŸã‹ã€ãŠã‚ˆã³ãã‚Œã‹ã‚‰ä½•ãŒå¾—ã‚‰ã‚ŒãŸã‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VolatilePhysicsã§ä½œæ¥­ã™ã‚‹ã¨ãã®æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€VoltWorldã®ç‰©ç†çš„ãªä¸–ç•Œã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€ä¸»ãªä½œæ¥­ãŒè¡Œã‚ã‚Œã‚‹ãƒ—ãƒ­ã‚­ã‚·ã‚¯ãƒ©ã‚¹ã§ã™ï¼šãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ¬ã‚¤ã‚¯ã‚­ãƒ£ã‚¹ãƒˆãªã©ã€‚ç‰¹åˆ¥ãªãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã«ãƒ©ãƒƒãƒ—ã—ã¦ã€å°†æ¥ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®Ÿè£…ã‚’åˆ¥ã®ã‚‚ã®ã«å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PhysicsWorld</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> HistoryLength = <span class="hljs-number">32</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> VoltWorld _voltWorld;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Dictionary&lt;<span class="hljs-keyword">uint</span>, VoltBody&gt; _cache = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">uint</span>, VoltBody&gt;();<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PhysicsWorld</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> deltaTime</span>)</span><font></font>
    {<font></font>
        _voltWorld = <span class="hljs-keyword">new</span> VoltWorld(HistoryLength) { DeltaTime = deltaTime };<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HasBody</span>(<span class="hljs-params"><span class="hljs-keyword">uint</span> tag</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> _cache.ContainsKey(tag);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> VoltBody <span class="hljs-title">GetBody</span>(<span class="hljs-params"><span class="hljs-keyword">uint</span> tag</span>)</span><font></font>
    {<font></font>
        VoltBody body;<font></font>
        _cache.TryGetValue(tag, <span class="hljs-keyword">out</span> body);
        <span class="hljs-keyword">return</span> body;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> VoltRayResult <span class="hljs-title">RayCast</span>(<span class="hljs-params">Vector2 origin, Vector2 direction, <span class="hljs-keyword">float</span> distance, VoltBodyFilter filter, <span class="hljs-keyword">int</span> ticksBehind</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> ray = <span class="hljs-keyword">new</span> VoltRayCast(origin, direction.normalized, distance);
        <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> VoltRayResult();<font></font>
<font></font>
        _voltWorld.RayCast(<span class="hljs-keyword">ref</span> ray, <span class="hljs-keyword">ref</span> result, filter, ticksBehind);
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> VoltRayResult <span class="hljs-title">CircleCast</span>(<span class="hljs-params">Vector2 origin, Vector2 direction, <span class="hljs-keyword">float</span> distance, <span class="hljs-keyword">float</span> radius, VoltBodyFilter filter, <span class="hljs-keyword">int</span> ticksBehind</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> ray = <span class="hljs-keyword">new</span> VoltRayCast(origin, direction.normalized, distance);
        <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> VoltRayResult();<font></font>
<font></font>
        _voltWorld.CircleCast(<span class="hljs-keyword">ref</span> ray, radius, <span class="hljs-keyword">ref</span> result, filter, ticksBehind);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        _voltWorld.Update();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">uint</span> tag</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> body = _cache[tag];<font></font>
        _voltWorld.Update(body, <span class="hljs-literal">true</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateBody</span>(<span class="hljs-params"><span class="hljs-keyword">uint</span> tag, Vector2 position, <span class="hljs-keyword">float</span> angle</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> body = _cache[tag];<font></font>
        body.Set(position, angle);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateStaticCircle</span>(<span class="hljs-params">Vector2 origin, <span class="hljs-keyword">float</span> radius, <span class="hljs-keyword">uint</span> tag</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> shape = _voltWorld.CreateCircleWorldSpace(origin, radius, <span class="hljs-number">1f</span>, <span class="hljs-number">0f</span>, <span class="hljs-number">0f</span>);
        <span class="hljs-keyword">var</span> body = _voltWorld.CreateStaticBody(origin, <span class="hljs-number">0</span>, shape);<font></font>
        body.UserData = tag;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateDynamicCircle</span>(<span class="hljs-params">Vector2 origin, <span class="hljs-keyword">float</span> radius, <span class="hljs-keyword">uint</span> tag</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> shape = _voltWorld.CreateCircleWorldSpace(origin, radius, <span class="hljs-number">1f</span>, <span class="hljs-number">0f</span>, <span class="hljs-number">0f</span>);
        <span class="hljs-keyword">var</span> body = _voltWorld.CreateDynamicBody(origin, <span class="hljs-number">0</span>, shape);<font></font>
        body.UserData = tag;<font></font>
        body.CollisionFilter = StaticCollisionFilter;<font></font>
        _cache.Add(tag, body);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateStaticSquare</span>(<span class="hljs-params">Vector2 origin, <span class="hljs-keyword">float</span> rotationAngle, Vector2 extents, <span class="hljs-keyword">uint</span> tag</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> shape = _voltWorld.CreatePolygonBodySpace(extents.GetRectFromExtents(), <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">var</span> body = _voltWorld.CreateStaticBody(origin, rotationAngle, shape);<font></font>
        body.UserData = tag;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateDynamicSquare</span>(<span class="hljs-params">Vector2 origin, <span class="hljs-keyword">float</span> rotationAngle, Vector2 extents, <span class="hljs-keyword">uint</span> tag</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> shape = _voltWorld.CreatePolygonBodySpace(extents.GetRectFromExtents(), <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">var</span> body = _voltWorld.CreateDynamicBody(origin, rotationAngle, shape);<font></font>
        body.UserData = tag;<font></font>
        body.CollisionFilter = StaticCollisionFilter;<font></font>
        _cache.Add(tag, body);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;VoltBody&gt; <span class="hljs-title">GetBodies</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> _voltWorld.Bodies;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">StaticCollisionFilter</span>(<span class="hljs-params">VoltBody a, VoltBody b</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> b.IsStatic;<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸–ç•Œã‚’ä½œæˆã™ã‚‹ã¨ãã€æ­´å²ã®å¤§ãã•ãŒç¤ºã•ã‚Œã¾ã™-ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä¿å­˜ã™ã‚‹ä¸–ç•Œã®çŠ¶æ…‹ã®æ•°ã€‚ç§ãŸã¡ã®å ´åˆã€ãã‚Œã‚‰ã®æ•°ã¯32ã§ã—ãŸï¼š1ç§’ã‚ãŸã‚Š30ãƒ•ãƒ¬ãƒ¼ãƒ ã€‚ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›´æ–°ã™ã‚‹è¦ä»¶ã«åŸºã¥ã„ã¦å¿…è¦ã§ã‚ã‚Šã€ãƒ‡ãƒãƒƒã‚°ãƒ—ãƒ­ã‚»ã‚¹ã®åˆ¶é™ã‚’è¶…ãˆãŸå ´åˆã«å‚™ãˆã¦ã€ã•ã‚‰ã«2ã¤å¿…è¦ã§ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ç‰©ç†çš„ãªãƒœãƒ‡ã‚£ã‚’ç”Ÿæˆã™ã‚‹å¤–éƒ¨ã‚­ãƒ£ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚„ã€ã•ã¾ã–ã¾ãªç¨®é¡ã®ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒˆã‚‚è€ƒæ…®ã«å…¥ã‚Œã¦ã„ã¾ã™ã€‚</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ä»¥å‰ã®è¨˜äº‹</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ã‹ã‚‰æ€ã„å‡ºã™ã‚ˆã†ã«</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ECSã®ä¸–ç•Œã¯æœ¬è³ªçš„ã«ã€ã™ã¹ã¦ã®ã‚·ã‚¹ãƒ†ãƒ ã«å¯¾ã—ã¦å®šæœŸçš„ã«Executeãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ã‚’ä¸­å¿ƒã«å±•é–‹ã—ã¾ã™ã€‚å„ã‚·ã‚¹ãƒ†ãƒ ã®é©åˆ‡ãªå ´æ‰€ã§ã€ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã¸ã®å‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚æœ€åˆã¯ã€ç‰©ç†çš„ãªã‚¨ãƒ³ã‚¸ãƒ³ã«æŒ‘æˆ¦ã™ã‚‹ãŸã‚ã®ãƒãƒƒãƒå‡¦ç†ã¯è¨˜è¿°ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€ãã®ã‚ˆã†ãªè€ƒãˆã¯ã‚ã‚Šã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰å†…ã§ã¯ã€ç‰©ç†ä¸–ç•Œã®Updateï¼ˆï¼‰ã®å‘¼ã³å‡ºã—ãŒè¡Œã‚ã‚Œã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«ç™ºç”Ÿã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã™ã¹ã¦ã®ç›¸äº’ä½œç”¨ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ãŸãŒã£ã¦ã€ç‰©ç†æ¼”ç®—ã¯2ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å‰Šæ¸›ã•ã‚Œã¾ã™ã€‚1ã¤ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã®ç©ºé–“å†…ã®ä½“ã®å‡ä¸€ãªå‹•ãã¨ã€æ’®å½±ã«å¿…è¦ãªå¤šãã®ãƒ©ã‚«ã‚¹ãƒˆã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®é©åˆ‡ãªæ“ä½œãªã©ã§ã™ã€‚ãƒ¬ã‚¤ã‚«ã‚¹ãƒˆã¯ç‰¹ã«èº«ä½“ã®çŠ¶æ…‹ã®æ­´å²ã«é–¢é€£ã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ†ã‚¹ãƒˆã®çµæœã«ã‚ˆã‚‹ã¨ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã¯ã•ã¾ã–ã¾ãªé€Ÿåº¦ã§ã¯éå¸¸ã«ã†ã¾ãæ©Ÿèƒ½ã›ãšã€ç‰¹å®šã®é€Ÿåº¦ã§ã¯ä½“ãŒå£ã‚’ç°¡å˜ã«é€šéã—å§‹ã‚ã‚‹ã“ã¨ãŒã™ãã«ã‚ã‹ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¨ãƒ³ã‚¸ãƒ³ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ç¶™ç¶šçš„ãªè¡çªæ¤œå‡ºã«é–¢é€£ã™ã‚‹è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€å½“æ™‚ã®å¸‚å ´ã«ã¯ç§ãŸã¡ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«ä»£ã‚ã‚‹ã‚‚ã®ã¯ãªã‹ã£ãŸã®ã§ã€ç§ã¯è‡ªåˆ†ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸–ç•Œä¸­ã§å‹•ã‹ã—ã€ç‰©ç†ãƒ‡ãƒ¼ã‚¿ã‚’ECSã¨åŒæœŸã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ãŸã¨ãˆã°ã€ç§»å‹•ã‚·ã‚¹ãƒ†ãƒ ã®ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> System;<font></font>
...<font></font>
<span class="hljs-keyword">using</span> Volatile;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MovePhysicsSystem</span> : <span class="hljs-title">ExecutableSystem</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> PhysicsWorld _physicsWorld;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> CollisionFilter _moveFilter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> VoltBodyFilter _collisionFilterDelegate;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovePhysicsSystem</span>(<span class="hljs-params">PhysicsWorld physicsWorld</span>)</span><font></font>
    {<font></font>
        _physicsWorld = physicsWorld;<font></font>
        _moveFilter = <span class="hljs-keyword">new</span> CollisionFilter(<span class="hljs-literal">true</span>, CollisionLayer.ExplosiveBarrel);<font></font>
        _collisionFilterDelegate = _moveFilter.Filter;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Execute</span>(<span class="hljs-params">GameState gs</span>)</span><font></font>
    {<font></font>
        _moveFilter.State = gs;<font></font>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> pair <span class="hljs-keyword">in</span> gs.WorldState.Movement)<font></font>
        {<font></font>
            ExecuteMovement(gs, pair.Key, pair.Value);<font></font>
        }<font></font>
<font></font>
        _physicsWorld.Update();<font></font>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> pair <span class="hljs-keyword">in</span> gs.WorldState.PhysicsDynamicBody)<font></font>
        {<font></font>
            <span class="hljs-keyword">if</span>(pair.Value.IsAlive)<font></font>
            {<font></font>
                ExecutePhysicsDynamicBody(gs, pair.Key);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Execute</span>(<span class="hljs-params">GameState gs, <span class="hljs-keyword">uint</span> avatarId</span>)</span><font></font>
    {<font></font>
        _moveFilter.State = gs;<font></font>
        <span class="hljs-keyword">var</span> movement = gs.WorldState.Movement[avatarId];
        <span class="hljs-keyword">if</span> (movement != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            ExecuteMovement(gs, avatarId, movement);<font></font>
<font></font>
            _physicsWorld.Update(avatarId);<font></font>
            <span class="hljs-keyword">var</span> physicsDynamicBody = gs.WorldState.PhysicsDynamicBody[avatarId];
            <span class="hljs-keyword">if</span> (physicsDynamicBody != <span class="hljs-literal">null</span> &amp;&amp; physicsDynamicBody.IsAlive)<font></font>
                ExecutePhysicsDynamicBody(gs, avatarId);<font></font>
        }<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ExecutePhysicsDynamicBody</span>(<span class="hljs-params">GameState gs, <span class="hljs-keyword">uint</span> entityId</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> body = _physicsWorld.GetBody(entityId);
        <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> transform = gs.WorldState.Transform[entityId];<font></font>
            transform.Position = body.Position;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ExecuteMovement</span>(<span class="hljs-params">GameState gs, <span class="hljs-keyword">uint</span> entityId, Movement movement</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> body = _physicsWorld.GetBody(entityId);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">float</span> raycastRadius;
            <span class="hljs-keyword">if</span> (CalculateRadius(gs, entityId, <span class="hljs-keyword">out</span> raycastRadius))<font></font>
            {<font></font>
                <span class="hljs-keyword">return</span>;<font></font>
            }<font></font>
<font></font>
            body.AngularVelocity = <span class="hljs-number">0</span>;<font></font>
            body.LinearVelocity = movement.Velocity;<font></font>
            <span class="hljs-keyword">var</span> movPhysicInfo = gs.WorldState.MovementPhysicInfo[entityId];
            <span class="hljs-keyword">var</span> collisionDirection = CircleRayCastSpeedCorrection(body, GameState.TickDurationSec, raycastRadius);<font></font>
            CheckMoveInWall(movement, movPhysicInfo, collisionDirection, gs.WorldState.Transform[entityId]);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CalculateRadius</span>(<span class="hljs-params">GameState gs, <span class="hljs-keyword">uint</span> id, <span class="hljs-keyword">out</span> <span class="hljs-keyword">float</span> raycastRadius</span>)</span><font></font>
    {<font></font>
        raycastRadius = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> circleShape = gs.WorldState.DynamicCircleCollider[id];
        <span class="hljs-keyword">if</span> (circleShape != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            raycastRadius = circleShape.Radius;<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> boxShape = gs.WorldState.DynamicBoxCollider[id];
            <span class="hljs-keyword">if</span> (boxShape != <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                raycastRadius = boxShape.RaycastRadius;<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span><font></font>
            {<font></font>
                gs.Log.Error(<span class="hljs-keyword">string</span>.Format(<span class="hljs-string">"Physics body {0} doesn't contains shape!"</span>, id));
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CheckMoveInWall</span>(<span class="hljs-params">Movement movement, MovementPhysicInfo movPhysicInfo,
        Vector2 collisionDirection, Transform transform</span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">// 60 is the max angle when player move in wall and can shoot through the wall from weapon without target.</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> maxAngleToWall = <span class="hljs-number">60</span>;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (movement.Velocity.IsEqual(Vector2.zero))<font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (movPhysicInfo.LastCollisionDirection.IsEqual(Vector2.zero))<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> angleToCollision = transform.Angle.GetDirection().CalculateAbsoluteAngleInDegrees(movPhysicInfo.LastCollisionDirection);<font></font>
                movPhysicInfo.TurnOnWall = angleToCollision &lt;= maxAngleToWall;<font></font>
            }<font></font>
            <span class="hljs-keyword">return</span>;<font></font>
        }<font></font>
<font></font>
        movPhysicInfo.LastCollisionDirection = collisionDirection * <span class="hljs-number">-1f</span>;
        <span class="hljs-keyword">if</span> (movPhysicInfo.LastCollisionDirection.IsEqual(Vector2.zero))<font></font>
        {<font></font>
            movPhysicInfo.TurnOnWall = <span class="hljs-literal">false</span>;<font></font>
            movPhysicInfo.LastCollisionDirection = collisionDirection;<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> angleToCollision = transform.Angle.GetDirection().CalculateAbsoluteAngleInDegrees(movPhysicInfo.LastCollisionDirection);<font></font>
            movPhysicInfo.TurnOnWall = angleToCollision &lt;= maxAngleToWall;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// I can't believe we are using a physics engine and have to write such kludges</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> Vector2 <span class="hljs-title">CircleRayCastSpeedCorrection</span>(<span class="hljs-params">VoltBody targetBody, <span class="hljs-keyword">float</span> deltaSeconds, <span class="hljs-keyword">float</span> rayCastRadius</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (rayCastRadius &lt;= <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> Vector2.zero;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">var</span> speed = targetBody.LinearVelocity;
        <span class="hljs-keyword">var</span> position = targetBody.Position;<font></font>
<font></font>
        <span class="hljs-keyword">var</span> direction = speed * deltaSeconds;<font></font>
<font></font>
        <span class="hljs-keyword">var</span> rayCastResult = _physicsWorld.CircleCast(position + direction.normalized * <span class="hljs-number">0.1f</span>, direction, direction.magnitude, rayCastRadius, _collisionFilterDelegate, <span class="hljs-number">0</span>);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (rayCastResult.Body == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> Vector2.zero;<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">var</span> magSpeed = speed.magnitude;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (rayCastResult.Distance &gt; <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> penetratingDistance = magSpeed * deltaSeconds - rayCastResult.Distance;
            <span class="hljs-keyword">var</span> sinVelocityEdge = Vector2.Dot(-speed.normalized, rayCastResult.Normal);<font></font>
<font></font>
            <span class="hljs-keyword">var</span> biasSpeed = penetratingDistance * sinVelocityEdge / deltaSeconds;
            <span class="hljs-keyword">var</span> biasVector = rayCastResult.Normal * biasSpeed * <span class="hljs-number">1.1f</span>;<font></font>
<font></font>
            <span class="hljs-keyword">var</span> resultVelocity = speed + biasVector;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (magSpeed &lt;= <span class="hljs-number">0</span>)<font></font>
            {<font></font>
                resultVelocity = Vector2.zero;<font></font>
            }<font></font>
            targetBody.LinearVelocity = resultVelocity;<font></font>
            <span class="hljs-keyword">return</span> rayCastResult.Normal;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">var</span> destination = rayCastResult.Body.Position;<font></font>
        direction = destination - position;<font></font>
<font></font>
        <span class="hljs-keyword">var</span> rayCastResultToBody =<font></font>
            _physicsWorld.RayCast(position, direction, direction.magnitude, _collisionFilterDelegate, <span class="hljs-number">0</span>);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (rayCastResultToBody.IsValid)<font></font>
            targetBody.LinearVelocity = rayCastResultToBody.Normal * magSpeed * deltaSeconds;<font></font>
<font></font>
        <span class="hljs-keyword">return</span> rayCastResultToBody.Normal;<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¢ã‚¤ãƒ‡ã‚¢ã¯ã€å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒå‹•ãå‰ã«</font><font style="vertical-align: inherit;">ã€ãã®å‹•ãã®æ–¹å‘ã«</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CircleCast</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’ä½œæˆã—ã¦ã€</font><font style="vertical-align: inherit;">ãã®å‰ã«éšœå®³ç‰©ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã™ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ã‚²ãƒ¼ãƒ å†…ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æŠ•å½±ã¯å††ã‚’è¡¨ã™ãŸã‚ã€CircleCastãŒå¿…è¦ã§ã‚ã‚Šã€ç•°ãªã‚‹ã‚¸ã‚ªãƒ¡ãƒˆãƒªé–“ã®ã‚³ãƒ¼ãƒŠãƒ¼ã«ç•™ã¾ã‚‹ã“ã¨ã¯æœ›ã¾ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚æ¬¡ã«ã€é€Ÿåº¦ã®å¢—åˆ†ã‚’è€ƒæ…®ã—ã€ã“ã®å€¤ã‚’1ãƒ•ãƒ¬ãƒ¼ãƒ ã®é€Ÿåº¦ã¨ã—ã¦ç‰©ç†ä¸–ç•Œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å‰²ã‚Šå½“ã¦ã¾ã™ã€‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³Updateï¼ˆï¼‰ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€å¿…è¦ãªã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç§»å‹•ã—ã€åŒæ™‚ã«å¤ã„çŠ¶æ…‹ã‚’å±¥æ­´ã«è¨˜éŒ²ã—ã¾ã™ã€‚ã‚¨ãƒ³ã‚¸ãƒ³å†…éƒ¨ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ãŸã‚‰ã€ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã€ãã‚Œã‚’ECSã®å¤‰æ›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚³ãƒ”ãƒ¼ã—ã¦ã€å¼•ãç¶šãä½œæ¥­ã—ã¾ã™ã€‚ç‰¹ã«ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§é€ä¿¡ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç§»å‹•é€Ÿåº¦ã«é–¢ã™ã‚‹å°ã•ãªåˆ¶å¾¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ£ãƒ³ã‚¯ã§ç‰©ç†ã‚’æ›´æ–°ã™ã‚‹ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã®ç‰©ç†ã®ä¸ä¸€è‡´ã‚’å‡¦ç†ã™ã‚‹ã®ã«éå¸¸ã«åŠ¹æœçš„ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ãã—ã¦ã€ç§ãŸã¡ã®ç‰©ç†å­¦ã¯æ±ºå®šè«–çš„ã§ã¯ãªã„ãŸã‚ã€ã¤ã¾ã‚Šã€åŒã˜å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã§ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœãŒç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ä¾¡å€¤ãŒã‚ã‚‹ã‹ã©ã†ã‹ã€ãŠã‚ˆã³æ¥­ç•Œã®èª°ã‹ãŒåŒæ§˜ã®ã“ã¨ã‚’ã™ã‚‹ã‹ã©ã†ã‹ã«ã¤ã„ã¦å¤šãã®è­°è«–ãŒã‚ã‚Šã¾ã—ãŸã€‚æ±ºå®šè«–çš„ãªç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ‰‹ã«ã—ã¦ã„ã¾ã™ã€‚å¹¸ã„ã«ã‚‚ã€ã‚²ãƒ¼ãƒ é–‹ç™ºè€…ä¼šè­°ã§NetherRealm Studiosã®é–‹ç™ºè€…ã‹ã‚‰å½¼ã‚‰ã®ã‚²ãƒ¼ãƒ ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é–¢ã™ã‚‹å„ªã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’è¦‹ã¤ã‘ã€ãã®ã‚ˆã†ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå®Ÿéš›ã«è¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ°—ä»˜ãã¾ã—ãŸã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Œå…¨ã«çµ„ã¿ç«‹ã¦ã€ã„ãã¤ã‹ã®ãƒ†ã‚¹ãƒˆã§å®Ÿè¡Œã™ã‚‹ã¨ã€9000ãƒ†ã‚£ãƒƒã‚¯ã€ã¤ã¾ã‚Š5åˆ†é–“ã®ãƒãƒˆãƒ«ä¸­ã«ç´„50ã®èª¤äºˆæ¸¬ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã“ã®ã‚ˆã†ãªäºˆæ¸¬ãƒŸã‚¹ã¯ã€èª¿æ•´ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®ä½ç½®ã‚’è¦–è¦šçš„ã«è£œé–“ã™ã‚‹ã“ã¨ã§ç°¡å˜ã«å¹³æº–åŒ–ã§ãã¾ã™ã€‚ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ç‰©ç†ã‚’æ‰‹å‹•ã§é »ç¹ã«æ›´æ–°ã™ã‚‹ã¨ãã«ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼ã¯é‡è¦ã§ã¯ãªã„ãŸã‚ã€è¦–è¦šçš„ãªè£œé–“ã¯ã‹ãªã‚Šè¿…é€Ÿã«å®Ÿè¡Œã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ‡ãƒ«ã§è¦–è¦šçš„ãªã‚¸ãƒ£ãƒ³ãƒ—ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã®ã¿å¿…è¦ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹ã®ä¸€è‡´ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®å½¢å¼ã®è‡ªå·±è¨˜è¿°ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> PS.Logs.Unity;<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> Compares the same avatar in two states. Compares the values potentially</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> affected by prediction.</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GameStateComparer</span> : <span class="hljs-title">IGameStateComparer</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsSame</span>(<span class="hljs-params">GameState s1, GameState s2, <span class="hljs-keyword">uint</span> avatarId</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (s1 == <span class="hljs-literal">null</span> &amp;&amp; s2 != <span class="hljs-literal">null</span> ||<font></font>
            s1 != <span class="hljs-literal">null</span> &amp;&amp; s2 == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (s1 == <span class="hljs-literal">null</span> &amp;&amp; s2 == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
        <span class="hljs-keyword">var</span> entity1 = s1.WorldState[avatarId];
        <span class="hljs-keyword">var</span> entity2 = s2.WorldState[avatarId];<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (entity1 == <span class="hljs-literal">null</span> &amp;&amp; entity2 == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (entity1 == <span class="hljs-literal">null</span> || entity2 == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            LogManager.Debug(<span class="hljs-string">"entity is different"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (s1.Time != s2.Time)<font></font>
        {<font></font>
            LogManager.Warning(<span class="hljs-keyword">string</span>.Format(<span class="hljs-string">"Trying to compare states with different time! Predicted time: {0} Server time: {1}"</span>, <font></font>
                s1.Time, s2.Time));<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (s1.WorldState.Transform[avatarId] != s2.WorldState.Transform[avatarId])<font></font>
        {<font></font>
            LogManager.Debug(<span class="hljs-string">"Transform is different"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
        <font></font>
        <span class="hljs-comment">// ... some code ...</span><font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¿…è¦ã«å¿œã˜ã¦è‡ªå‹•åŒ–ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€å°†æ¥çš„ã«ã¯è€ƒãˆã¾ã—ãŸãŒã€è‡ªå‹•åŒ–ã¯ã—ã¦ã„ã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤‰æ›æ¯”è¼ƒã‚³ãƒ¼ãƒ‰ï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span> ==(Transform a, Transform b)<font></font>
{<font></font>
    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">object</span>)a == <span class="hljs-literal">null</span> &amp;&amp; (<span class="hljs-keyword">object</span>)b == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">object</span>)a == <span class="hljs-literal">null</span> &amp;&amp; (<span class="hljs-keyword">object</span>)b != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">object</span>)a != <span class="hljs-literal">null</span> &amp;&amp; (<span class="hljs-keyword">object</span>)b == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (Math.Abs(a.Angle - b.Angle) &gt; <span class="hljs-number">0.01f</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (Math.Abs(a.Position.x - b.Position.x) &gt; <span class="hljs-number">0.01f</span> || Math.Abs(a.Position.y - b.Position.y) &gt; <span class="hljs-number">0.01f</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åˆã®å›°é›£</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€2Då¹³é¢ã«æŠ•å½±ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ãã®ã‚ˆã†ãªå ´åˆã®ç‰©ç†å­¦ã¯éå¸¸ã«ã†ã¾ãæ©Ÿèƒ½ã—ã¾ã—ãŸãŒã€ã‚ã‚‹æ™‚ç‚¹ã§ã‚²ãƒ¼ãƒ ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ãŒæ¥ã¦è¨€ã£ãŸï¼šã€Œæ‰‹æ¦´å¼¾ãŒæ¬²ã—ã„ï¼ã€</font><font style="vertical-align: inherit;">ãã—ã¦ã€ã‚ã¾ã‚Šå¤‰åŒ–ã—ãªã„ã¨æ€ã£ãŸã®ã§ã€æ‰‹å…ƒã«2Dãƒ‡ãƒ¼ã‚¿ã—ã‹ãªã„ã€èº«ä½“ã®3Dé£›è¡Œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ã¿ã¾ã›ã‚“ã‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€å½¼ã‚‰ã¯ã„ãã¤ã‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é«˜ã•ã®æ¦‚å¿µã‚’å°å…¥ã—ã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¨™é«˜ã®æ³•å‰‡ãŒæ™‚é–“ã®çµŒéã¨ã¨ã‚‚ã«å¤‰åŒ–ã™ã‚‹æ§˜å­ã¯ã€æ”¾æ£„ã•ã‚ŒãŸèº«ä½“ã«ã¨ã£ã¦ã©ã®ã‚ˆã†ã«è¦‹ãˆã‚‹ã‹ã€å½¼ã‚‰ã¯ä¸­å­¦2å¹´ç”Ÿã®ç‰©ç†å­¦ã®ã‚¯ãƒ©ã‚¹ã«åˆæ ¼ã—ãŸãŸã‚ã€å¼¾é“å­¦ã®æ±ºå®šã¯å–ã‚‹ã«è¶³ã‚‰ãªã„ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚ã—ã‹ã—ã€è¡çªã‚’ä¼´ã†ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãã‚Œã»ã©ç°¡å˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã®å ´åˆã‚’æƒ³åƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚é£›è¡Œä¸­ã®æ‰‹æ¦´å¼¾ã¯ã€å£ã«è¡çªã™ã‚‹ã‹ã€ç¾åœ¨ã®é«˜ã•ã¨å£ã®é«˜ã•ã«å¿œã˜ã¦ã€ãã®ä¸Šã‚’é£›è¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚°ãƒ¬ãƒãƒ¼ãƒ‰ãŒå††ã§ã€å£ãŒé•·æ–¹å½¢ã§è¡¨ã•ã‚Œã‚‹2æ¬¡å…ƒã®ä¸–ç•Œã§ã®ã¿å•é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ej/yr/lk/ejyrlkwa0tu9hm-3j7nobxmazpo.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªã®ãƒ“ãƒ¥ãƒ¼ã€‚</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ãšã€æ‰‹æ¦´å¼¾ã®å‹•çš„æœ¬ä½“ã¨ä»–ã®é™çš„ãŠã‚ˆã³å‹•çš„æœ¬ä½“ã¨ã®ç›¸äº’ä½œç”¨ã‚’ç„¡åŠ¹ã«ã—ã¾ã—ãŸã€‚ã“ã‚Œã¯ã€ç›®æ¨™ã«ç„¦ç‚¹ã‚’åˆã‚ã›ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚ç§ãŸã¡ã®ã‚¿ã‚¹ã‚¯ã§ã¯ã€æ‰‹æ¦´å¼¾ã¯ä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é€šéã—ã€2æ¬¡å…ƒå¹³é¢ã¸ã®æŠ•å½±ãŒäº’ã„ã«äº¤å·®ã™ã‚‹ã¨ãã«å£ã‚’ã€Œé£›ã³è¶Šãˆã‚‹ã€ã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚é€šå¸¸ã®ç›¸äº’ä½œç”¨ã§ã¯ã€2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç›¸äº’ã«é€šéã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒã€å‹•ãã¨é«˜ã•ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒã¤æ‰‹æ¦´å¼¾ã®å ´åˆã€ç‰¹å®šã®æ¡ä»¶ä¸‹ã§ã“ã‚Œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚°ãƒ¬ãƒãƒ¼ãƒ‰ç”¨ã®åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆGrenadeMovementã‚’å°å…¥ã—ã€é«˜ã•ã®æ¦‚å¿µã‚’å°å…¥ã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Component</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GrenadeMovement</span><font></font>
{<font></font>
   <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> Height;<font></font>
   [<span class="hljs-meta">DontPack</span>]
   <span class="hljs-keyword">public</span> Vector2 Velocity;<font></font>
   [<span class="hljs-meta">DontPack</span>]
   <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> VerticalVelocity;<font></font>
<font></font>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GrenadeMovement</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> height, Vector2 velocity, <span class="hljs-keyword">float</span> verticalVelocity</span>)</span> { }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§æ‰‹æ¦´å¼¾ã«ã¯é«˜ã•åº§æ¨™ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã®æƒ…å ±ã¯ä»–ã®ä¸–ç•Œã«ã¯ä½•ã‚‚ä¸ãˆã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ã€ç§ãŸã¡ã¯ãƒãƒ¼ãƒˆã‚’ã™ã‚‹ã“ã¨ã‚’æ±ºå®šã—ã€æ¬¡ã®æ¡ä»¶ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼šæ‰‹æ¦´å¼¾ã¯å£ã®ä¸Šã‚’é£›ã¶ã“ã¨ãŒã§ãã¾ã™ãŒã€ä¸€å®šã®é«˜ã•ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã—ãŸãŒã£ã¦ã€è¡çªã®å®šç¾©å…¨ä½“ã¯ã€æŠ•å½±ã®è¡çªã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å£ã®é«˜ã•ã‚’GrenadeMovement.Heightãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã¨æ¯”è¼ƒã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚æ‰‹æ¦´å¼¾ã®é£›è¡Œã®é«˜ã•ãŒä½ã„å ´åˆã¯ã€å£ã¨è¡çªã—ã¾ã™ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€2Dã‚¹ãƒšãƒ¼ã‚¹ã‚’å«ã‚ã€ãƒ‘ã‚¹ã«æ²¿ã£ã¦é™ã‹ã«å‹•ãç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åˆã®åå¾©ã§ã¯ã€äº¤å·®ç‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã¨æ‰‹æ¦´å¼¾ãŒè½ã¡ã‚‹ã ã‘ã§ã—ãŸãŒã€æ¬¡ã«å¼¾æ€§è¡çªã‚’è¿½åŠ ã—ã€3Dã§å¾—ã‚‰ã‚Œã‚‹çµæœã¨ã»ã¨ã‚“ã©åŒºåˆ¥ãŒã¤ã‹ãªã„å‹•ä½œã‚’å§‹ã‚ã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰‹æ¦´å¼¾ã®è»Œé“ã¨å¼¾æ€§è¡çªã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> System;
<span class="hljs-comment">// ... some code ...</span>
<span class="hljs-keyword">using</span> Volatile;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Common.WorldState</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GrenadeMovementSystem</span> : <span class="hljs-title">ExecutableSystem</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">struct</span> Projection<font></font>
        {<font></font>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> Min;
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> Max;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> _r;<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Vector2[] _vertices = <span class="hljs-keyword">new</span> Vector2[<span class="hljs-number">4</span>];
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Vector2[] _verticesV = <span class="hljs-keyword">new</span> Vector2[<span class="hljs-number">4</span>];
        <span class="hljs-keyword">private</span> Vector2 _Vunit;
        <span class="hljs-keyword">private</span> Vector2 _VTunit;
        <span class="hljs-keyword">private</span> Projection _wallProj1;
        <span class="hljs-keyword">private</span> Projection _wallProj2;
        <span class="hljs-keyword">private</span> Projection _wallProj1V;
        <span class="hljs-keyword">private</span> Projection _wallProj2V;<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> CollisionPrecision = <span class="hljs-number">1e-3</span>f;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">float</span> HalfSlope = Mathf.Cos(Mathf.PI / <span class="hljs-number">4.0f</span>);<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ContactPointList _contactPoints = <span class="hljs-keyword">new</span> ContactPointList(<span class="hljs-number">3</span>);<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Execute</span>(<span class="hljs-params">GameState gs</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> settings = gs.RuleBook.GrenadeConfig[<span class="hljs-number">1</span>];<font></font>
            _r = settings.R;<font></font>
<font></font>
            <span class="hljs-keyword">var</span> floorDampeningPerTick = (<span class="hljs-keyword">float</span>)Math.Pow(settings.FloorDampening, <span class="hljs-number">1.0</span> / GameState.Hz);<font></font>
<font></font>
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> grenade <span class="hljs-keyword">in</span> gs.WorldState.GrenadeMovement)<font></font>
            {<font></font>
                <span class="hljs-comment">// Gravity must take effect before collision</span>
                <span class="hljs-comment">// because contact with walls may and will adjust vertical velocity</span>
                <span class="hljs-comment">// and penetration will even move the ball up.</span><font></font>
                grenade.Value.VerticalVelocity -= settings.Gravity * GameState.TickDurationSec;<font></font>
                grenade.Value.Height += grenade.Value.VerticalVelocity * GameState.TickDurationSec;<font></font>
                <span class="hljs-comment">// prevent falling through floor</span>
                <span class="hljs-keyword">if</span> (grenade.Value.Height &lt;= _r)<font></font>
                {<font></font>
                    <span class="hljs-comment">// slow down horizontal movement by floor friction</span>
                    <span class="hljs-comment">// actually, friciton is simplified to just dampening coefficient</span>
                    <span class="hljs-keyword">var</span> spdH = grenade.Value.Velocity.sqrMagnitude;
                    <span class="hljs-keyword">var</span> spdV = grenade.Value.VerticalVelocity;
                    <span class="hljs-keyword">var</span> cos = spdH / Mathf.Sqrt(spdH * spdH + spdV * spdV);<font></font>
                    grenade.Value.Velocity *= floorDampeningPerTick * cos;<font></font>
<font></font>
                    <span class="hljs-comment">// slow down vertical movement</span><font></font>
                    grenade.Value.VerticalVelocity = settings.FloorRestitution * Math.Abs(grenade.Value.VerticalVelocity);<font></font>
<font></font>
                    <span class="hljs-comment">// move up to the floor level</span><font></font>
                    grenade.Value.Height = _r;<font></font>
                }<font></font>
<font></font>
                <span class="hljs-comment">// A collision will stop the ball and change its velocity.</span>
                <span class="hljs-comment">// Otherwise it will be moved by velocity</span><font></font>
                PerformCollisionAndMovement(gs, grenade.Key, grenade.Value);<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PerformCollisionAndMovement</span>(<span class="hljs-params">GameState gs, <span class="hljs-keyword">uint</span> id, GrenadeMovement grenade</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> settings = gs.RuleBook.GrenadeConfig[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">var</span> velocity = grenade.Velocity * GameState.TickDurationSec;<font></font>
<font></font>
            <span class="hljs-keyword">var</span> trans = gs.WorldState.Transform[id];
            <span class="hljs-keyword">var</span> position = trans.Position;<font></font>
            _Vunit = velocity.normalized;<font></font>
            _VTunit = <span class="hljs-keyword">new</span> Vector2(-_Vunit.y, _Vunit.x);<font></font>
<font></font>
            _vertices[<span class="hljs-number">0</span>] = position + _VTunit * _r;<font></font>
            _vertices[<span class="hljs-number">1</span>] = position - _VTunit * _r;<font></font>
            _vertices[<span class="hljs-number">2</span>] = _vertices[<span class="hljs-number">1</span>] + velocity;<font></font>
            _vertices[<span class="hljs-number">3</span>] = _vertices[<span class="hljs-number">0</span>] + velocity;<font></font>
<font></font>
            _contactPoints.Reset();<font></font>
<font></font>
            <span class="hljs-keyword">int</span> collisions = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">var</span> grenProj1V = ProjectCapsule(_Vunit, _vertices, position, velocity);
            <span class="hljs-keyword">var</span> grenProj2V = ProjectCapsule(_VTunit, _vertices, position, velocity);<font></font>
            collisions += CollideWithStaticBoxes(gs, id, position, velocity, grenade, grenProj1V, grenProj2V);<font></font>
            collisions += CollideWithCircles(gs, gs.RuleBook.StaticCircleCollider, gs.RuleBook.Transform, id, position, velocity, grenade, grenProj1V, grenProj2V, (CollisionLayer)~<span class="hljs-number">0</span>);<font></font>
            collisions += CollideWithCircles(gs, gs.WorldState.DynamicCircleCollider, gs.WorldState.Transform, id, position, velocity, grenade, grenProj1V, grenProj2V, ~CollisionLayer.Character);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (collisions == <span class="hljs-number">0</span>)<font></font>
            {<font></font>
                trans.Position += velocity;<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span><font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> contactSuperposition = CalculateContactSuperposition();<font></font>
<font></font>
                trans.Position += velocity * contactSuperposition.TravelDistance;<font></font>
<font></font>
                <span class="hljs-keyword">var</span> reflectedVelocity = grenade.Velocity - <span class="hljs-number">2.0f</span> * Vector2.Dot(grenade.Velocity, contactSuperposition.Normal) * contactSuperposition.Normal;<font></font>
                reflectedVelocity *= settings.WallRestitution;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DEBUG_GRENADES</span>
                gs.Log.Debug(<span class="hljs-string">"contact"</span>
                             + <span class="hljs-string">"\n\ttravel "</span> + contactSuperposition.TravelDistance<font></font>
                             + <span class="hljs-string">"\n\tcontactNormal "</span> + contactSuperposition.Normal.x + <span class="hljs-string">":"</span> + contactSuperposition.Normal.y<font></font>
                             + <span class="hljs-string">"\n\treflected V "</span> + reflectedVelocity.x + <span class="hljs-string">":"</span> + reflectedVelocity.y);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
                grenade.Velocity = reflectedVelocity;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">CollideWithStaticBoxes</span>(<span class="hljs-params">
            GameState gs,
            <span class="hljs-keyword">uint</span> id,
            Vector2 position,
            Vector2 velocity,
            GrenadeMovement grenade,
            Projection grenProj1V,
            Projection grenProj2V</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> settings = gs.RuleBook.GrenadeConfig[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">var</span> collisions = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-comment">// TODO spatial query</span>
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> collider <span class="hljs-keyword">in</span> gs.RuleBook.StaticBoxCollider)<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> wall = collider.Value;<font></font>
<font></font>
                <span class="hljs-keyword">var</span> transform = gs.RuleBook.Transform[collider.Key];
                <span class="hljs-keyword">var</span> colliderData = gs.RuleBook.PrecomputedColliderData[collider.Key];<font></font>
<font></font>
                <span class="hljs-comment">// test projection to V</span><font></font>
                _wallProj1V = ProjectPolygon(_Vunit, colliderData.Vertices);<font></font>
                <span class="hljs-keyword">if</span> (!Overlap(_wallProj1V, grenProj1V)) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                <span class="hljs-comment">// test projection to VT</span><font></font>
                _wallProj2V = ProjectPolygon(_VTunit, colliderData.Vertices);<font></font>
                <span class="hljs-keyword">if</span> (!Overlap(_wallProj2V, grenProj2V)) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                <span class="hljs-comment">// test projection to wall axis 1</span><font></font>
                _wallProj1 = ProjectPolygon(colliderData.Axis1, colliderData.Vertices);<font></font>
                <span class="hljs-keyword">var</span> grenProj1 = ProjectCapsule(colliderData.Axis1, _vertices, position, velocity);
                <span class="hljs-keyword">if</span> (!Overlap(_wallProj1, grenProj1)) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                <span class="hljs-comment">// test projection to wall axis 2</span><font></font>
                _wallProj2 = ProjectPolygon(colliderData.Axis2, colliderData.Vertices);<font></font>
                <span class="hljs-keyword">var</span> grenProj2 = ProjectCapsule(colliderData.Axis2, _vertices, position, velocity);
                <span class="hljs-keyword">if</span> (!Overlap(_wallProj2, grenProj2)) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                <span class="hljs-keyword">var</span> lowWall = wall.Height &lt; settings.TallWallHeight;
                <span class="hljs-keyword">if</span> (lowWall)<font></font>
                {<font></font>
                    <span class="hljs-comment">// the wall is too far below, ignore it completely</span>
                    <span class="hljs-keyword">if</span> (grenade.Height &gt; wall.Height + _r) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                    <span class="hljs-comment">// if grenade if falling down, it can bounce off the top of the wall</span>
                    <span class="hljs-keyword">if</span> (grenade.VerticalVelocity &lt; <span class="hljs-number">0f</span>)<font></font>
                    {<font></font>
                        <span class="hljs-keyword">if</span> (grenade.Height &gt; wall.Height - _r)<font></font>
                        {<font></font>
                            <span class="hljs-keyword">var</span> localPV = WorldToBoxLocal(transform.Position, colliderData, position + velocity);<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DEBUG_GRENADES</span>
                            gs.Log.Debug(<span class="hljs-string">"fall on wall"</span>
                                         + <span class="hljs-string">"\n\tP+V "</span> + (P.x + V.x) + <span class="hljs-string">":"</span> + (P.y + V.y)<font></font>
                                         + <span class="hljs-string">"\n\tlocal "</span> + localPV.x + <span class="hljs-string">":"</span> + localPV.y<font></font>
                                         + <span class="hljs-string">"\n\tH w "</span> + wall.Height + <span class="hljs-string">" g "</span> + grenade.Height<font></font>
                            );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
                            <span class="hljs-keyword">if</span> (Math.Abs(localPV.x) &lt; wall.Size.x * <span class="hljs-number">0.5f</span> || Math.Abs(localPV.y) &lt; wall.Size.y * <span class="hljs-number">0.5f</span>)<font></font>
                            {<font></font>
                                grenade.Height = wall.Height + _r;<font></font>
                                grenade.VerticalVelocity = settings.WallRestitution * Math.Abs(grenade.VerticalVelocity);<font></font>
                                <span class="hljs-keyword">continue</span>;<font></font>
                            }<font></font>
                        }<font></font>
                    }<font></font>
                }<font></font>
<font></font>
                <span class="hljs-comment">// collision detected</span><font></font>
<font></font>
                <span class="hljs-comment">// try to find minimal V before collision</span>
                <span class="hljs-keyword">var</span> scaleV = CalcTranslationScaleBeforeCollision(CheckBoxCollision, colliderData, <span class="hljs-number">0</span>, position, velocity);<font></font>
<font></font>
                <span class="hljs-keyword">var</span> contactPoint = CalcBoxContactPoint(transform.Position, wall, colliderData, position);<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DEBUG_GRENADES</span>
                gs.Log.Debug(<span class="hljs-string">"collision grenade #"</span> + id + <span class="hljs-string">" with static box #"</span> + collider.Key<font></font>
                             + <span class="hljs-string">"\n\tP="</span> + P.x + <span class="hljs-string">":"</span> + P.y<font></font>
                             + <span class="hljs-string">"\n\tV="</span> + V.x + <span class="hljs-string">":"</span> + V.y + <span class="hljs-string">" scale="</span> + scaleV<font></font>
                             + <span class="hljs-string">"\n\tP+Vs="</span> + (P.x + V.x * scaleV) + <span class="hljs-string">":"</span> + (P.y + V.y * scaleV)<font></font>
                             + <span class="hljs-string">"\n\twall pos "</span> + transform.Position.x + <span class="hljs-string">":"</span> + transform.Position.y + <span class="hljs-string">" sz "</span> + wall.Size.x + <span class="hljs-string">":"</span> + wall.Size.y + <span class="hljs-string">" angle "</span> + transform.Angle<font></font>
                             + <span class="hljs-string">"\n\tproj V  w "</span> + _wallProj1V.Min + <span class="hljs-string">":"</span> + _wallProj1V.Max + <span class="hljs-string">" g "</span> + grenProj1V.Min + <span class="hljs-string">":"</span> + grenProj1V.Max + <span class="hljs-string">" overlap="</span> + Overlap(_wallProj1V, grenProj1V)<font></font>
                             + <span class="hljs-string">"\n\tproj VT w "</span> + _wallProj2V.Min + <span class="hljs-string">":"</span> + _wallProj2V.Max + <span class="hljs-string">" g "</span> + grenProj2V.Min + <span class="hljs-string">":"</span> + grenProj2V.Max + <span class="hljs-string">" overlap="</span> + Overlap(_wallProj2V, grenProj2V)<font></font>
                             + <span class="hljs-string">"\n\taxis1 "</span> + colliderData.Axis1.x + <span class="hljs-string">":"</span> + colliderData.Axis1.y<font></font>
                             + <span class="hljs-string">"\n\tproj  1 w "</span> + _wallProj1.Min + <span class="hljs-string">":"</span> + _wallProj1.Max + <span class="hljs-string">" g "</span> + grenProj1.Min + <span class="hljs-string">":"</span> + grenProj1.Max + <span class="hljs-string">" overlap="</span> + Overlap(_wallProj1, grenProj1)<font></font>
                             + <span class="hljs-string">"\n\taxis2 "</span> + colliderData.Axis2.x + <span class="hljs-string">":"</span> + colliderData.Axis2.y<font></font>
                             + <span class="hljs-string">"\n\tproj  2 w "</span> + _wallProj2.Min + <span class="hljs-string">":"</span> + _wallProj2.Max + <span class="hljs-string">" g "</span> + grenProj2.Min + <span class="hljs-string">":"</span> + grenProj2.Max + <span class="hljs-string">" overlap="</span> + Overlap(_wallProj2, grenProj2)<font></font>
                             + <span class="hljs-string">"\n\tpoint "</span> + contactPoint.Point.x + <span class="hljs-string">":"</span> + contactPoint.Point.y + <span class="hljs-string">" dotV "</span> + Vector2.Dot(P - contactPoint.Point, V)<font></font>
                );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
                <span class="hljs-comment">// ignore colliders that are behind</span>
                <span class="hljs-keyword">if</span> (Vector2.Dot(position - contactPoint.Point, velocity) &gt;= <span class="hljs-number">0.0f</span>) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                contactPoint.TravelDistance = velocity.magnitude * scaleV;<font></font>
                _contactPoints.Add(<span class="hljs-keyword">ref</span> contactPoint);<font></font>
<font></font>
                collisions++;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> collisions;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CheckBoxCollision</span>(<span class="hljs-params">PrecomputedColliderData colliderData, <span class="hljs-keyword">int</span> x, Vector2 position, Vector2 velocity</span>)</span><font></font>
        {<font></font>
            _verticesV[<span class="hljs-number">0</span>] = _vertices[<span class="hljs-number">0</span>];<font></font>
            _verticesV[<span class="hljs-number">1</span>] = _vertices[<span class="hljs-number">1</span>];<font></font>
            _verticesV[<span class="hljs-number">2</span>] = _vertices[<span class="hljs-number">1</span>] + velocity;<font></font>
            _verticesV[<span class="hljs-number">3</span>] = _vertices[<span class="hljs-number">0</span>] + velocity;<font></font>
<font></font>
            <span class="hljs-comment">// test projection to V</span>
            <span class="hljs-keyword">var</span> grenProj1V = ProjectCapsule(_Vunit, _verticesV, position, velocity);
            <span class="hljs-keyword">if</span> (!Overlap(_wallProj1V, grenProj1V)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
            <span class="hljs-comment">// testing projection to VT would be redundant</span><font></font>
<font></font>
            <span class="hljs-comment">// test projection to wall axis 1</span>
            <span class="hljs-keyword">var</span> grenProj1 = ProjectCapsule(colliderData.Axis1, _verticesV, position, velocity);
            <span class="hljs-keyword">if</span> (!Overlap(_wallProj1, grenProj1)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
            <span class="hljs-comment">// test projection to wall axis 2</span>
            <span class="hljs-keyword">var</span> grenProj2 = ProjectCapsule(colliderData.Axis2, _verticesV, position, velocity);
            <span class="hljs-keyword">if</span> (!Overlap(_wallProj2, grenProj2)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">CollideWithCircles</span>(<span class="hljs-params">
            GameState gs,
            Table&lt;CircleCollider&gt; colliderTable,
            Table&lt;Transform&gt; transformTable,
            <span class="hljs-keyword">uint</span> id,
            Vector2 position,
            Vector2 velocity,
            GrenadeMovement grenade,
            Projection grenProj1V,
            Projection grenProj2V,
            CollisionLayer collisionLayers</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> settings = gs.RuleBook.GrenadeConfig[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">var</span> collisions = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> collider <span class="hljs-keyword">in</span> colliderTable)<font></font>
            {<font></font>
                <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">int</span>)collisionLayers != ~<span class="hljs-number">0</span>)<font></font>
                {<font></font>
                    <span class="hljs-keyword">var</span> body = gs.WorldState.PhysicsDynamicBody[collider.Key];
                    <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span> &amp;&amp; (body.CollisionLayer &amp; collisionLayers) == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">var</span> wall = collider.Value;
                <span class="hljs-keyword">var</span> transform = transformTable[collider.Key];<font></font>
<font></font>
                <span class="hljs-comment">// test projection to V</span><font></font>
                _wallProj1V = ProjectCircle(_Vunit, transform.Position, wall.Radius);<font></font>
                <span class="hljs-keyword">if</span> (!Overlap(_wallProj1V, grenProj1V)) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                <span class="hljs-comment">// test projection to VT</span><font></font>
                _wallProj2V = ProjectCircle(_VTunit, transform.Position, wall.Radius);<font></font>
                <span class="hljs-keyword">if</span> (!Overlap(_wallProj2V, grenProj2V)) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                <span class="hljs-comment">// test distance from the circle wall to semicircles on capsule ends</span>
                <span class="hljs-keyword">var</span> collisionDistance = (_r + wall.Radius) * (_r + wall.Radius);
                <span class="hljs-keyword">if</span> ((position - transform.Position).sqrMagnitude &gt; collisionDistance) <span class="hljs-keyword">continue</span>;
                <span class="hljs-keyword">var</span> distSqr = (position + velocity - transform.Position).sqrMagnitude;
                <span class="hljs-keyword">if</span> (distSqr &gt; collisionDistance) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                <span class="hljs-keyword">var</span> lowWall = wall.Height &lt; settings.TallWallHeight;
                <span class="hljs-keyword">if</span> (lowWall)<font></font>
                {<font></font>
                    <span class="hljs-comment">// the wall is too far below, ignore it completely</span>
                    <span class="hljs-keyword">if</span> (grenade.Height &gt; wall.Height + _r) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                    <span class="hljs-comment">// if grenade if falling down, it can bounce off the top of the wall</span>
                    <span class="hljs-keyword">if</span> (grenade.VerticalVelocity &lt; <span class="hljs-number">0f</span>)<font></font>
                    {<font></font>
                        <span class="hljs-keyword">if</span> (grenade.Height &gt; wall.Height - _r)<font></font>
                        {<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DEBUG_GRENADES</span>
                            gs.Log.Debug(<span class="hljs-string">"grenade #"</span> + id + <span class="hljs-string">" falls on wall"</span>
                                         + <span class="hljs-string">"\n\tP+V "</span> + (P.x + V.x) + <span class="hljs-string">":"</span> + (P.y + V.y)<font></font>
                                         + <span class="hljs-string">"\n\tdist "</span> + Mathf.Sqrt(distSqr)<font></font>
                                         + <span class="hljs-string">"\n\tH w "</span> + wall.Height + <span class="hljs-string">" g "</span> + grenade.Height<font></font>
                            );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
                            <span class="hljs-keyword">if</span> (distSqr &lt; wall.Radius * wall.Radius)<font></font>
                            {<font></font>
                                grenade.Height = wall.Height + _r;<font></font>
                                grenade.VerticalVelocity = settings.WallRestitution * Math.Abs(grenade.VerticalVelocity);<font></font>
                                <span class="hljs-keyword">continue</span>;<font></font>
                            }<font></font>
                        }<font></font>
                    }<font></font>
                }<font></font>
<font></font>
                <span class="hljs-comment">// collision detected</span><font></font>
<font></font>
                <span class="hljs-comment">// try to find minimal V before collision</span>
                <span class="hljs-keyword">var</span> scaleV = CalcTranslationScaleBeforeCollision(CheckCircleCollision, transform.Position, wall, position, velocity);<font></font>
<font></font>
                <span class="hljs-keyword">var</span> contactPoint = CalcCircleContactPoint(transform.Position, wall, position);<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DEBUG_GRENADES</span>
                gs.Log.Debug(<span class="hljs-string">"collision grenade #"</span> + id + <span class="hljs-string">" with circle #"</span> + collider.Key<font></font>
                             + <span class="hljs-string">"\n\tP="</span> + P.x + <span class="hljs-string">":"</span> + P.y<font></font>
                             + <span class="hljs-string">"\n\tV="</span> + V.x + <span class="hljs-string">":"</span> + V.y + <span class="hljs-string">" scale="</span> + scaleV<font></font>
                             + <span class="hljs-string">"\n\tP+Vs="</span> + (P.x + V.x * scaleV) + <span class="hljs-string">":"</span> + (P.y + V.y * scaleV)<font></font>
                             + <span class="hljs-string">"\n\tcircle pos "</span> + transform.Position.x + <span class="hljs-string">":"</span> + transform.Position.y + <span class="hljs-string">" r "</span> + wall.Radius<font></font>
                             + <span class="hljs-string">"\n\tdist "</span> + (transform.Position - (P + V * scaleV)).magnitude<font></font>
                             + <span class="hljs-string">"\n\tproj V  w "</span> + _wallProj1V.Min + <span class="hljs-string">":"</span> + _wallProj1V.Max + <span class="hljs-string">" g "</span> + grenProj1V.Min + <span class="hljs-string">":"</span> + grenProj1V.Max + <span class="hljs-string">" overlap="</span> + Overlap(_wallProj1V, grenProj1V)<font></font>
                             + <span class="hljs-string">"\n\tproj VT w "</span> + _wallProj2V.Min + <span class="hljs-string">":"</span> + _wallProj2V.Max + <span class="hljs-string">" g "</span> + grenProj2V.Min + <span class="hljs-string">":"</span> + grenProj2V.Max + <span class="hljs-string">" overlap="</span> + Overlap(_wallProj2V, grenProj2V)<font></font>
                             + <span class="hljs-string">"\n\tpoint "</span> + contactPoint.Point.x + <span class="hljs-string">":"</span> + contactPoint.Point.y + <span class="hljs-string">" dotV "</span> + Vector2.Dot(P - contactPoint.Point, V)<font></font>
                             );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
                <span class="hljs-comment">// ignore colliders that are behind</span>
                <span class="hljs-keyword">if</span> (Vector2.Dot(position - contactPoint.Point, velocity) &gt;= <span class="hljs-number">0.0f</span>) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
                contactPoint.TravelDistance = velocity.magnitude * scaleV;<font></font>
                _contactPoints.Add(<span class="hljs-keyword">ref</span> contactPoint);<font></font>
<font></font>
                collisions++;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> collisions;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CheckCircleCollision</span>(<span class="hljs-params">Vector2 wallCentre, CircleCollider wall, Vector2 position, Vector2 velocity</span>)</span><font></font>
        {<font></font>
            _verticesV[<span class="hljs-number">0</span>] = _vertices[<span class="hljs-number">0</span>];<font></font>
            _verticesV[<span class="hljs-number">1</span>] = _vertices[<span class="hljs-number">1</span>];<font></font>
            _verticesV[<span class="hljs-number">2</span>] = _vertices[<span class="hljs-number">1</span>] + velocity;<font></font>
            _verticesV[<span class="hljs-number">3</span>] = _vertices[<span class="hljs-number">0</span>] + velocity;<font></font>
<font></font>
            <span class="hljs-comment">// test projection to V</span>
            <span class="hljs-keyword">var</span> grenProj1V = ProjectCapsule(_Vunit, _verticesV, position, velocity);
            <span class="hljs-keyword">if</span> (!Overlap(_wallProj1V, grenProj1V)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
            <span class="hljs-comment">// testing projection to VT would be redundant</span><font></font>
<font></font>
            <span class="hljs-comment">// test distance from the circle wall to the semicircle on the second capsule end</span>
            <span class="hljs-keyword">var</span> dSqr = (_r + wall.Radius) * (_r + wall.Radius);
            <span class="hljs-keyword">return</span> (position + velocity - wallCentre).sqrMagnitude &lt; dSqr;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">float</span> CalcTranslationScaleBeforeCollision&lt;TData1, TData2&gt;(<font></font>
            Func&lt;TData1, TData2, Vector2, Vector2, <span class="hljs-keyword">bool</span>&gt; collision,<font></font>
            TData1 colliderData1,<font></font>
            TData2 colliderData2,<font></font>
            Vector2 position,<font></font>
            Vector2 vector)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> min = <span class="hljs-number">0.0f</span>;
            <span class="hljs-keyword">var</span> max = <span class="hljs-number">1.0f</span>;
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> d = (max - min) * <span class="hljs-number">0.5f</span>;
                <span class="hljs-keyword">if</span> (d &lt; CollisionPrecision) <span class="hljs-keyword">break</span>;<font></font>
<font></font>
                <span class="hljs-keyword">var</span> scale = min + d;<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (collision(colliderData1, colliderData2, position, vector * scale))<font></font>
                {<font></font>
                    max = scale;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span><font></font>
                {<font></font>
                    min = scale;<font></font>
                }<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> min;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> ContactPoint <span class="hljs-title">CalculateContactSuperposition</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            ContactPoint contactSuperposition;<font></font>
            _contactPoints.TryPopClosest(<span class="hljs-number">1000f</span>, <span class="hljs-keyword">out</span> contactSuperposition);<font></font>
<font></font>
            ContactPoint contact;<font></font>
            <span class="hljs-keyword">while</span> (_contactPoints.TryPopClosest(contactSuperposition.TravelDistance, <span class="hljs-keyword">out</span> contact))<font></font>
            {<font></font>
                contactSuperposition.Normal += contact.Normal;<font></font>
            }<font></font>
<font></font>
            contactSuperposition.Normal = contactSuperposition.Normal.normalized;<font></font>
<font></font>
            <span class="hljs-keyword">return</span> contactSuperposition;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Projection <span class="hljs-title">ProjectPolygon</span>(<span class="hljs-params">Vector2 axisNormalised, Vector2[] vertices</span>)</span><font></font>
        {<font></font>
            Projection proj;<font></font>
            <span class="hljs-keyword">var</span> d = Vector2.Dot(axisNormalised, vertices[<span class="hljs-number">0</span>]);<font></font>
            proj.Min = d;<font></font>
            proj.Max = d;<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; vertices.Length; i++)<font></font>
            {<font></font>
                d = Vector2.Dot(axisNormalised, vertices[i]);<font></font>
                proj.Min = Mathf.Min(proj.Min, d);<font></font>
                proj.Max = Mathf.Max(proj.Max, d);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> proj;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> Projection <span class="hljs-title">ProjectCapsule</span>(<span class="hljs-params">Vector2 axisNormalised, Vector2[] vertices, Vector2 p, Vector2 v</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> proj = ProjectPolygon(axisNormalised, vertices);<font></font>
            proj = AddCircleProjection(proj, axisNormalised, p, _r);<font></font>
            proj = AddCircleProjection(proj, axisNormalised, p + v, _r);<font></font>
            <span class="hljs-keyword">return</span> proj;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Projection <span class="hljs-title">AddCircleProjection</span>(<span class="hljs-params">Projection proj, Vector2 axisNormalised, Vector2 centre, <span class="hljs-keyword">float</span> r</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> c = Vector2.Dot(axisNormalised, centre);<font></font>
            proj.Min = Mathf.Min(proj.Min, c - r);<font></font>
            proj.Max = Mathf.Max(proj.Max, c + r);<font></font>
            <span class="hljs-keyword">return</span> proj;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Projection <span class="hljs-title">ProjectCircle</span>(<span class="hljs-params">Vector2 axisNormalised, Vector2 centre, <span class="hljs-keyword">float</span> r</span>)</span><font></font>
        {<font></font>
            Projection proj;<font></font>
            <span class="hljs-keyword">var</span> c = Vector2.Dot(axisNormalised, centre);<font></font>
            proj.Min = c - r;<font></font>
            proj.Max = c + r;<font></font>
            <span class="hljs-keyword">return</span> proj;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Overlap</span>(<span class="hljs-params">Projection p1, Projection p2</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> p1.Min &lt; p2.Min ? p1.Max &gt; p2.Min : p2.Max &gt; p1.Min;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Vector2 <span class="hljs-title">WorldToBoxLocal</span>(<span class="hljs-params">Vector2 wallCentre, PrecomputedColliderData colliderData, Vector2 position</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Vector2(<font></font>
                Vector2.Dot(colliderData.Axis1, position) - Vector2.Dot(colliderData.Axis1, wallCentre),<font></font>
                Vector2.Dot(colliderData.Axis2, position) - Vector2.Dot(colliderData.Axis2, wallCentre)<font></font>
            );<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ContactPoint <span class="hljs-title">CalcBoxContactPoint</span>(<span class="hljs-params">Vector2 wallCentre, BoxCollider wall, PrecomputedColliderData colliderData, Vector2 position</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> contactPoint = CaclBoxLocalContactPoint(wall.Size * <span class="hljs-number">0.5f</span>, WorldToBoxLocal(wallCentre, colliderData, position));<font></font>
<font></font>
            <span class="hljs-keyword">var</span> worldAxisX = <span class="hljs-keyword">new</span> Vector2(colliderData.Axis1.x, -colliderData.Axis1.y);
            <span class="hljs-keyword">var</span> worldAxisY = <span class="hljs-keyword">new</span> Vector2(colliderData.Axis1.y, colliderData.Axis1.x);<font></font>
            contactPoint.Point = wallCentre + <span class="hljs-keyword">new</span> Vector2(Vector2.Dot(worldAxisX, contactPoint.Point), Vector2.Dot(worldAxisY, contactPoint.Point));<font></font>
            contactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(Vector2.Dot(worldAxisX, contactPoint.Normal), Vector2.Dot(worldAxisY, contactPoint.Normal));<font></font>
<font></font>
            <span class="hljs-keyword">return</span> contactPoint;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ContactPoint <span class="hljs-title">CaclBoxLocalContactPoint</span>(<span class="hljs-params">Vector2 boxHalfSize, Vector2 localPosition</span>)</span><font></font>
        {<font></font>
            ContactPoint localContactPoint = <span class="hljs-keyword">default</span>(ContactPoint);<font></font>
<font></font>
            <span class="hljs-comment">// cases are numbered like numpad keys</span><font></font>
<font></font>
            <span class="hljs-comment">// 1, 2, 3</span>
            <span class="hljs-keyword">if</span> (localPosition.y &lt; -boxHalfSize.y)<font></font>
            {<font></font>
                <span class="hljs-comment">// 1</span>
                <span class="hljs-keyword">if</span> (localPosition.x &lt; -boxHalfSize.x)<font></font>
                {<font></font>
                    localContactPoint.Point = <span class="hljs-keyword">new</span> Vector2(-boxHalfSize.x, -boxHalfSize.y);<font></font>
                    localContactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(-HalfSlope, -HalfSlope);<font></font>
                }<font></font>
                <span class="hljs-comment">// 2, 3</span>
                <span class="hljs-keyword">else</span><font></font>
                {<font></font>
                    <span class="hljs-comment">// 3</span>
                    <span class="hljs-keyword">if</span> (localPosition.x &gt; boxHalfSize.x)<font></font>
                    {<font></font>
                        localContactPoint.Point = <span class="hljs-keyword">new</span> Vector2(boxHalfSize.x, -boxHalfSize.y);<font></font>
                        localContactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(HalfSlope, -HalfSlope);<font></font>
                    }<font></font>
                    <span class="hljs-comment">// 2</span>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        localContactPoint.Point = <span class="hljs-keyword">new</span> Vector2(localPosition.x, -boxHalfSize.y);<font></font>
                        localContactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0.0f</span>, <span class="hljs-number">-1.0f</span>);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
            <span class="hljs-comment">// 4, 6, 7, 8, 9</span>
            <span class="hljs-keyword">else</span><font></font>
            {<font></font>
                <span class="hljs-comment">// 7, 8, 9</span>
                <span class="hljs-keyword">if</span> (localPosition.y &gt; boxHalfSize.y)<font></font>
                {<font></font>
                    <span class="hljs-comment">// 7</span>
                    <span class="hljs-keyword">if</span> (localPosition.x &lt; -boxHalfSize.x)<font></font>
                    {<font></font>
                        localContactPoint.Point = <span class="hljs-keyword">new</span> Vector2(-boxHalfSize.x, boxHalfSize.y);<font></font>
                        localContactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(-HalfSlope, HalfSlope);<font></font>
                    }<font></font>
                    <span class="hljs-comment">// 8, 9</span>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        <span class="hljs-comment">// 9</span>
                        <span class="hljs-keyword">if</span> (localPosition.x &gt; boxHalfSize.x)<font></font>
                        {<font></font>
                            localContactPoint.Point = <span class="hljs-keyword">new</span> Vector2(boxHalfSize.x, boxHalfSize.y);<font></font>
                            localContactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(HalfSlope, HalfSlope);<font></font>
                        }<font></font>
                        <span class="hljs-comment">// 8</span>
                        <span class="hljs-keyword">else</span><font></font>
                        {<font></font>
                            localContactPoint.Point = <span class="hljs-keyword">new</span> Vector2(localPosition.x, boxHalfSize.y);<font></font>
                            localContactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>);<font></font>
                        }<font></font>
                    }<font></font>
                }<font></font>
                <span class="hljs-comment">// 4, 6</span>
                <span class="hljs-keyword">else</span><font></font>
                {<font></font>
                    <span class="hljs-comment">// 4</span>
                    <span class="hljs-keyword">if</span> (localPosition.x &lt; -boxHalfSize.x)<font></font>
                    {<font></font>
                        localContactPoint.Point = <span class="hljs-keyword">new</span> Vector2(-boxHalfSize.x, localPosition.y);<font></font>
                        localContactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">-1.0f</span>, <span class="hljs-number">0.0f</span>);<font></font>
                    }<font></font>
                    <span class="hljs-comment">// 6</span>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        localContactPoint.Point = <span class="hljs-keyword">new</span> Vector2(boxHalfSize.x, localPosition.y);<font></font>
                        localContactPoint.Normal = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> localContactPoint;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ContactPoint <span class="hljs-title">CalcCircleContactPoint</span>(<span class="hljs-params">Vector2 wallCentre, CircleCollider wall, Vector2 position</span>)</span><font></font>
        {<font></font>
            ContactPoint contactPoint = <span class="hljs-keyword">default</span>(ContactPoint);<font></font>
<font></font>
            contactPoint.Normal = (position - wallCentre).normalized;<font></font>
            contactPoint.Point = wallCentre + wall.Radius * contactPoint.Normal;<font></font>
<font></font>
            <span class="hljs-keyword">return</span> contactPoint;<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½¼ã‚‰ã¯ç‰©ç†å­¦ã‚’æ›¸ã„ãŸã€‚</font><font style="vertical-align: inherit;">æ¬¡ã¯ä½•ã§ã™ã‹ï¼Ÿ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚²ãƒ¼ãƒ ã¯ç”Ÿãç¶šã‘ã€ç™ºå±•ã—ã€æ™‚é–“ã®çµŒéã¨ã¨ã‚‚ã«ã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã§ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã®ã‹ã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã“ã¨ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">è¨˜äº‹ã®1ã¤ã§</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã‚µãƒ¼ãƒãƒ¼ã§ã®ECS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ãƒ‡ãƒãƒƒã‚°</font></a><font style="vertical-align: inherit;">ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¾ã—ãŸ</font></a><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç‰©ç†å­¦ã«é–¢ã—ã¦ã¯ã€JSONã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ç›´æ¥ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãŒã‚ã‚Šã€ãã®æ§‹é€ ã¯æ®‹ã‚Šã®ECSãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨å…±ã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x6/wv/1w/x6wv1w0hkb13r4rflik9hvacnk0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Ÿéš›ã«ã¯2ã¤ã®ã€Œä¸–ç•Œã€ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ 1ã¤ç›®ã¯ECSã§ã™ã€‚ECSã§ã¯ã€ç‰©ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚€ã‚²ãƒ¼ãƒ ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ç¬¬äºŒã®ä¸–ç•Œ-ç‰©ç†çš„ãªä¸–ç•Œ-ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã€ã‚‚ã¡ã‚ã‚“ã€ECSã‚¹ã‚¿ã‚¤ãƒ«ã§è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€ECSã¯ã“ã‚Œã‚‰ã®ä¸–ç•Œé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’å¼•ãå—ã‘ã¾ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹APIã‚’æä¾›ã—ã€èª­ã¿æ›¸ãã§ãã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã¾ãŸã€ç§ãŸã¡ã«ã¨ã£ã¦éå¸¸ã«é‡è¦ãªçµè«–ã¯ã€ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã®ã™ã¹ã¦ã®æ©Ÿèƒ½ã®ä¸­ã§ã€äºˆæ¸¬ã®å¤±æ•—ã‚’é˜²ãã¨ã„ã†ç‚¹ã§æœ€ã‚‚ä¿¡é ¼ã§ãã‚‹ã®ã¯ã€ä¸€å®šã®é€Ÿåº¦ã¨ãƒ¬ãƒ¼ã‚­ã‚­ãƒ£ã‚¹ãƒˆã®çŸ­ã„é‡ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç›¸äº’ä½œç”¨ã¨ç§»å‹•ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ã°ã‚‰ãã®é–“ã€ç§ãŸã¡ã¯2Dç‰©ç†å­¦ã§æˆåŠŸã‚’åã‚ç¶šã‘ã¦ãã¾ã—ãŸã€‚ãã‚Œã¯ã€ç§ãŸã¡ã®ã‚¿ã‚¹ã‚¯ã¨ã‚²ãƒ¼ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³ã®ãƒ‹ãƒ¼ã‚ºã‚’å®Œå…¨ã«ã‚«ãƒãƒ¼ã—ã€ä¸€èˆ¬ã«éå¸¸ã«æˆåŠŸã—ãŸã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ã€ãƒã‚¤ãƒŠã‚¹ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚ç§ãŸã¡ã¯å¸¸ã«ãã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«æº€è¶³ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹å¸‚å ´ã«ã¯é©åˆ‡ãªä»£æ›¿æ‰‹æ®µãŒã¾ã ãªãã€ç§ãŸã¡è‡ªèº«ã®ã‚‚ã®ã‚’æ›¸ãã®ã¯ã‚¨ãƒãƒ«ã‚®ãƒ¼é›†ç´„çš„ã§ã—ãŸã€‚åŒã˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚£ãƒƒã‚¯ã§å®Ÿè¡Œã•ã‚Œã‚‹100ã‚’è¶…ãˆã‚‹ECSã‚·ã‚¹ãƒ†ãƒ ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã®çµæœã«ã‚ˆã‚‹ã¨ã€ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ä¸Šã®ã‚·ã‚¹ãƒ†ãƒ ãŒæœ€ã‚‚è²ªæ¬²ã§ã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚ã•ã‚‰ã«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ã€ç‰©ç†â€‹â€‹ãƒœãƒ‡ã‚£ã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªã¨ãã®å¯¾ç§°æ€§ã«åŸºã¥ãå¤šãã®æœ€é©åŒ–ãŒæ¬ ã‘ã¦ã„ã‚‹ãŸã‚ã€éå¸¸ã«ä¾¿åˆ©ã§ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚³ãƒ¼ãƒ‰ã®OOPã«ç„¦ç‚¹ã‚’å½“ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚±ãƒƒãƒˆã§ã¯ãªãå€‹ã€…ã®æœ¬ä½“ã‚’æ“ä½œã™ã‚‹ã“ã¨ã‚‚æ··ä¹±ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã«ã¨ã£ã¦ã¯ã‚‹ã‹ã«æœ€é©ã§ã™ã€‚ãã—ã¦ã¯ã„-æœ€çµ‚çš„ã«ã€é–‹ç™ºè€…ã¯ã¾ã ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ”¾æ£„ã—ã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã‚Œã§ã‚‚ã—ã°ã‚‰ãã—ã¦ã€3Dç‰©ç†æ¼”ç®—ã®ä½¿ç”¨ã‚’å«ã‚€æ–°ã—ã„è¦ä»¶ãŒã‚²ãƒ¼ãƒ ã®ã‚²ãƒ¼ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³ã«ç¾ã‚Œã¾ã—ãŸã€‚ãã—ã¦ã€ç‰©ç†çš„ã«äºˆé˜²ã®ãŸã‚ã«æ›¸ã‹ã‚ŒãŸãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã¯å¤§ããèª¤è§£ã•ã‚Œã€æ–°ã—ã„ç¾å®Ÿã«å®Œå…¨ã«ã¯é©åˆã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2æ¬¡å…ƒã®ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã‚’3æ¬¡å…ƒã®ã‚¨ãƒ³ã‚¸ãƒ³ã«ç½®ãæ›ãˆã‚‹æ–¹æ³•ã€ç†ç”±ã€ãŠã‚ˆã³ç†ç”±ã«ã¤ã„ã¦ã®è³ªå•ã«ã€ä»Šå¾Œã®è¨˜äº‹ã§å–ã‚Šä¸Šã’ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã¾ã§ã®é–“ã€ã”ç†è§£ã®ã»ã©ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚ã“ã®è³‡æ–™ã®å¾Œã§ã€ECSã¨å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ç›¸äº’ä½œç”¨ãŒå°‘ã—æ˜ç¢ºã«ãªã£ãŸã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½¹ç«‹ã¤ãƒªãƒ³ã‚¯</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥å‰ã®é–¢é€£è¨˜äº‹ã¸ï¼š</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã®ä¸€èˆ¬çš„ãªã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒã‚¤ãƒ«PvPã‚·ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ãŸã¨ãï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã®ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®åŒæœŸ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECSã‚’ä½œæˆã—ãŸæ–¹æ³•ã¨ç†ç”±</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚²ãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§è‡ªå·±è¨˜è¿°å‹ECSã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹æ–¹æ³•</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ï¼š</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">8 Frames in 16ms: Rollback Networking in Mortal Kombat and Injustice 2</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481858/index.html">Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®èª•ç”Ÿæ—¥ã¨å¹´é½¢</a></li>
<li><a href="../ja481860/index.html">2020å¹´ã«ITã¯ä½•ã‚’ã™ã¹ãã‹ï¼ŸÂ </a></li>
<li><a href="../ja481862/index.html">Nvidia Jetsonçµ„ã¿è¾¼ã¿æ©Ÿæ¢°å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ </a></li>
<li><a href="../ja481866/index.html">DBAï¼šVACUUMãŒãƒ‘ã‚¹ã—ãŸã¨ã-ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ‰‹å‹•ã§ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¾ã™</a></li>
<li><a href="../ja481874/index.html">æŒ‡æ¨™-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¥å…¨æ€§ã®æŒ‡æ¨™</a></li>
<li><a href="../ja481882/index.html">4. Fortinet Getting Started v6.0ã€‚ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãƒãƒªã‚·ãƒ¼</a></li>
<li><a href="../ja481884/index.html">ã‚·ãƒ‹ã‚¢ã®å²è·¯ï¼šæ¬¡ã¯ã©ã“ã¸ï¼Ÿ</a></li>
<li><a href="../ja481886/index.html">å‡ºå¸­ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚’ã™ã°ã‚„ãä½œæˆã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja481890/index.html">ãƒ­ã‚·ã‚¢ã¸ã®ãƒ‰ã‚¤ãƒ„ã®ã‚¦ãƒ©ãƒ³å°¾é‰±ã®è¼¸å…¥ã€‚ãƒ‘ãƒ¼ãƒˆ2.ã‚¨ãƒ³ãƒªãƒƒãƒãƒ¡ãƒ³ãƒˆ</a></li>
<li><a href="../ja481892/index.html">ãƒ“ãƒƒãƒˆã®ä»£ã‚ã‚Šã«é‡å­ãƒ“ãƒƒãƒˆï¼šé‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯ç§ãŸã¡ã«ã¨ã£ã¦ã©ã®ã‚ˆã†ãªæœªæ¥ã‚’æŒã£ã¦ã„ã¾ã™ã‹ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>