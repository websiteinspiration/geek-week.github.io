<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ğŸ½ ğŸ‘‹ğŸ¾ ğŸ‘©ğŸ¿â€ğŸŒ¾ Sekali pada pentest, atau Bagaimana memecahkan semuanya dengan bantuan seorang ahli urologi dan Roskomnadzor ğŸ‘¨ğŸ¿â€ğŸ¨ ğŸŒ™ ğŸ¹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini didasarkan pada pentest yang sangat sukses, yang dilakukan oleh spesialis Group-IB beberapa tahun yang lalu: sebuah kisah terjadi yang men...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sekali pada pentest, atau Bagaimana memecahkan semuanya dengan bantuan seorang ahli urologi dan Roskomnadzor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/496712/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/vn/0a/bo/vn0abo7bxrqzjjq0vgophwwr3rm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini didasarkan pada pentest yang sangat sukses, yang dilakukan oleh spesialis Group-IB beberapa tahun yang lalu: sebuah kisah terjadi yang mengklaim sebagai adaptasi film di Bollywood. Sekarang, mungkin, reaksi pembaca akan mengikuti: "Oh, artikel PR lain, sekali lagi ini ditarik, seberapa baik mereka, jangan lupa untuk membeli pentest." Ya, di satu sisi, benar. Namun, ada sejumlah alasan mengapa artikel ini muncul. Saya ingin menunjukkan apa yang sebenarnya dilakukan pentester, betapa menarik dan non-sepele pekerjaan ini bisa, keadaan lucu apa yang dapat berkembang pada proyek, dan yang paling penting, untuk menunjukkan materi langsung dengan contoh nyata.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengembalikan keseimbangan kesopanan di dunia, setelah beberapa saat kita akan menulis tentang pentest, yang tidak berjalan. </font><font style="vertical-align: inherit;">Kami menunjukkan bagaimana proses yang telah mapan di perusahaan dapat melindungi dari seluruh jajaran serangan, bahkan yang dipersiapkan dengan baik, hanya karena proses ini ada dan benar-benar berfungsi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelanggan dari artikel ini, juga, semuanya baik-baik saja secara umum, setidaknya lebih baik dari 95% pasar di Federasi Rusia, menurut perasaan kami, tetapi ada sejumlah nuansa kecil yang membentuk rantai panjang peristiwa, yang pertama-tama menghasilkan laporan panjang tentang karya tersebut. , dan kemudian ke artikel ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, siapkan popcorn, dan selamat datang di detektif. </font><font style="vertical-align: inherit;">Saya </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memberikan kesempatan kepada Pavel Suprunyuk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Direktur Teknis Audit dan Consulting Group-IB.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 1. Dokter Pochkin </font></font><br>
</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018 tahun. Ada pelanggan - perusahaan IT berteknologi tinggi, yang dengan sendirinya melayani banyak pelanggan. Dia ingin mendapatkan jawaban atas pertanyaan: apakah mungkin, tanpa pengetahuan dan akses awal, bekerja melalui Internet, untuk mendapatkan hak administrator untuk domain Direktori Aktif? Tidak ada rekayasa sosial yang menarik ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eh, tetapi sia-sia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mereka tidak secara khusus akan mengganggu pekerjaan, tetapi mereka dapat secara tidak sengaja memuat ulang server yang bekerja aneh, misalnya. Tugas tambahan adalah mengidentifikasi sebanyak mungkin vektor serangan lain sehubungan dengan perimeter eksternal. Perusahaan secara teratur melakukan tes seperti itu, dan sekarang batas waktu untuk tes baru. Kondisinya hampir khas, memadai, dapat dimengerti. Turun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada nama pelanggan - biarlah "Perusahaan", dengan situs utama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.company.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Tentu saja, pelanggan dipanggil secara berbeda, tetapi dalam artikel ini semuanya akan direpersonalisasikan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya melakukan intelijen jaringan - Saya mencari tahu alamat dan domain mana yang terdaftar oleh pelanggan, menggambar diagram jaringan, bagaimana layanan didistribusikan ke alamat-alamat ini. Saya mendapatkan hasilnya: lebih dari 4000 alamat IP langsung. Saya melihat-lihat domain di jaringan ini: untungnya, sebagian besar adalah jaringan yang ditujukan untuk pelanggan pelanggan, dan mereka tidak menarik minat kita secara resmi. Pelanggan meyakini hal yang sama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masih ada satu jaringan dengan 256 alamat, yang saat ini sudah ada pemahaman tentang distribusi domain dan subdomain dengan alamat IP, ada informasi tentang port yang dipindai, yang berarti Anda dapat melihat layanan untuk yang menarik dengan mata Anda. Secara paralel, semua jenis pemindai diluncurkan pada alamat IP yang dapat diakses dan secara terpisah - di situs web.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada banyak layanan. Ini biasanya menyenangkan bagi pentester dan antisipasi kemenangan cepat, karena semakin banyak layanan, semakin besar bidang serangan dan semakin mudah untuk menemukan artefak. Melihat sekilas pada situs web menunjukkan bahwa kebanyakan dari mereka adalah antarmuka web dari produk-produk terkenal dari perusahaan dunia besar yang mengatakan bahwa mereka tidak senang dengan Anda. Mereka meminta nama pengguna dan kata sandi, dari ambang batas mereka mengguncang bidang untuk memasukkan faktor kedua, mereka meminta sertifikat klien TLS atau mengirimnya ke Microsoft ADFS. Beberapa tidak tersedia dari Internet. Untuk beberapa, Anda jelas perlu memiliki klien berbayar khusus untuk tiga gaji atau untuk mengetahui URL yang tepat untuk masuk. Kami akan menghilangkan satu minggu lagi dari keputusasaan bertahap dalam proses mencoba â€œmenerobosâ€ perangkat lunak sesuai versi untuk kerentanan yang diketahui, mencari konten tersembunyi di jalur web dan membocorkan akun dari layanan pihak ketiga seperti LinkedIn,mencoba untuk memilih kata sandi untuk mereka, serta menggali kerentanan di situs web yang dijelaskan sendiri - omong-omong, menurut statistik, ini adalah vektor serangan eksternal yang paling menjanjikan hingga saat ini. Segera saya perhatikan senapan bioskop, yang kemudian ditembakkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, ada dua situs yang menonjol dari ratusan layanan. Situs-situs ini memiliki satu kesamaan: jika Anda tidak melakukan pengintaian jaringan yang cermat berdasarkan domain, tetapi lihat "di dahi" untuk port terbuka atau meracuni pemindai kerentanan pada rentang IP yang diketahui, maka situs-situs ini akan menjauh dari verifikasi, mereka tidak akan terlihat tanpa mengetahui nama DNS. Mungkin mereka terlewatkan lebih awal, setidaknya, dan alat otomatis kami tidak menemukan masalah di dalamnya, bahkan jika mereka diatur langsung pada sumber daya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Omong-omong, tentang fakta bahwa scanner yang diluncurkan sebelumnya umumnya ditemukan. Biarkan saya mengingatkan Anda: bagi sebagian orang, "pentest" sama dengan "pemindaian otomatis". Dan pemindai pada proyek ini tidak mengatakan apa-apa. Yah, kerentanan sedang menunjukkan maksimum (3 dari 5 dalam hal bahaya): beberapa layanan memiliki sertifikat TLS buruk atau algoritma enkripsi yang ketinggalan zaman, dan sebagian besar situs memiliki Clickjacking. Tetapi dalam hal ini Anda tidak akan sampai pada tujuan. Mungkin, pemindai akan lebih bermanfaat di sini, tetapi izinkan saya mengingatkan Anda: pelanggan itu sendiri dapat membeli program-program semacam itu dan menguji dirinya dengan program-program itu, dan menilai dari hasil yang membosankan, ia sudah memeriksanya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kembali ke situs "abnormal". Yang pertama adalah sesuatu seperti Wiki lokal di alamat non-standar, tetapi biarkan wiki.company [.] Ru berada di artikel ini. Dia juga segera meminta nama pengguna dan kata sandi, tetapi sudah melalui NTLM di browser. Untuk pengguna, ini terlihat seperti jendela pertapa yang meminta nama pengguna dan kata sandi. Dan ini adalah praktik buruk.</font></font><br>
<br>
<blockquote> . NTLM  -      .   â€”    Active Directory.       company.ru,   Â«Â» DNS-.  ,    - ,        ,    - .  â€”        NTLM (, ?),     Â«Â» ,         .    ,      .         â€”  ,    .  â€”       .         â€” , ,  .  â€”   pass-the-hash-. ADFS           .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada satu fitur buruk dari produk Microsoft: bahkan jika Anda belum secara khusus menerbitkan NTLM tersebut, itu akan menjadi instalasi default di OWA dan Lync, setidaknya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ngomong-ngomong, penulis artikel ini dengan cara yang sama secara tidak sengaja memblokir sekitar 1000 akun karyawan dari satu bank besar hanya dalam satu jam dan kemudian memiliki penampilan yang agak pucat. </font><font style="vertical-align: inherit;">Layanan TI bank juga pucat, tetapi semuanya berakhir dengan baik dan memadai, kami bahkan dipuji bahwa kami adalah orang pertama yang menemukan masalah ini dan memicu koreksi yang cepat dan menentukan.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situs kedua memiliki alamat "jelas-beberapa-nama belakang.company.ru". </font><font style="vertical-align: inherit;">Ditemukan melalui Google, sesuatu seperti ini di halaman 10. </font><font style="vertical-align: inherit;">Desainnya mulai pertengahan 2000, dan orang terhormat melihat dari halaman utama, seperti ini:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vn/0a/bo/vn0abo7bxrqzjjq0vgophwwr3rm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lalu dia mengambil bingkai dari "Dog's Heart", tapi percayalah, itu mirip, bahkan skema warna dalam warna yang sama. Biarkan situs itu disebut </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preobrazhensky.company.ru</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu adalah situs pribadi ... seorang ahli urologi. Menjadi menarik apa yang dilakukan situs ahli urologi pada subdomain perusahaan teknologi tinggi. Penggalian cepat di Google menunjukkan bahwa dokter ini adalah salah satu pendiri salah satu badan hukum pelanggan kami dan bahkan menyumbang sekitar 1.000 rubel modal terdaftar. Situs ini mungkin dibuat bertahun-tahun yang lalu, dan sumber daya server pelanggan digunakan sebagai hosting. Situs ini telah lama kehilangan relevansinya, tetapi karena beberapa alasan dibiarkan bekerja untuk waktu yang lama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal kerentanan, situs web itu sendiri aman. Ke depan, saya akan mengatakan bahwa itu adalah seperangkat statika - halaman html sederhana dengan sisipan ilustrasi dalam bentuk ginjal dan kandung kemih. "Menghancurkan" situs seperti itu tidak berguna.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi server web di bawahnya lebih menarik. Dilihat oleh header HTTP Server, ada IIS 6.0, yang berarti bahwa Windows 2003 digunakan sebagai sistem operasi. Pemindai sebelumnya mengungkapkan bahwa situs web khusus urologis ini, tidak seperti host virtual lainnya di server web yang sama, merespons perintah PROPFIND, yaitu, WebDAV bekerja di sana. Omong-omong, pemindai mengeluarkan informasi ini dengan tanda Info (dalam bahasa pemindai melaporkan ini adalah bahaya terendah) - hal-hal seperti itu biasanya dilewati begitu saja. Dalam kombinasi, ini memberikan efek yang menarik, yang terungkap hanya setelah penggalian lain ke dalam Google: kerentanan buffer overflow yang langka terkait dengan satu set Shadow Brokers, yaitu CVE-2017-7269, yang sudah memiliki exploit siap. Dengan kata lain, itu akan menjadi bencana jika Anda memiliki Windows 2003 dan WebDAV berjalan di IIS.Meskipun bekerja dalam produksi Windows 2003 pada 2018, ini dengan sendirinya merupakan bencana.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eksploitasi berakhir di Metasploit dan segera diuji dengan beban yang mengirim permintaan DNS ke layanan terkontrol - Burp Collaborator secara tradisional digunakan untuk menjebak pertanyaan DNS. Anehnya, itu bekerja pertama kali: brengsek diterima di DNS. Kemudian ada upaya untuk membuat koneksi back-end melalui port 80 (yaitu, koneksi jaringan dari server ke penyerang, dengan akses ke cmd.exe pada host korban), tetapi kemudian kegagalan terjadi. Sambungan tidak datang, dan setelah upaya operasi ketiga, situs, bersama dengan semua gambar yang menghibur, menghilang untuk selamanya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biasanya ini diikuti oleh surat dengan gaya "pelanggan, bangun, kami telah menjatuhkan segalanya." Tetapi kami diberitahu bahwa situs tersebut tidak ada hubungannya dengan proses bisnis dan bekerja di sana secara umum, tidak jelas mengapa, seperti seluruh server, dan bahwa kami dapat menggunakan sumber daya ini sesuka kami.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah sekitar satu hari, situs itu tiba-tiba mulai bekerja sendiri. Setelah membangun stand dari WebDAV pada IIS 6.0, saya menemukan bahwa pengaturan default adalah me-restart alur kerja IIS setiap 30 jam. Yaitu, ketika kontrol keluar dari kode shell, alur kerja IIS berakhir, kemudian restart beberapa kali sendiri dan kemudian beristirahat selama 30 jam.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena pertama kali bekconnect di tcp gagal, saya menghapus masalah ini ke port yang tertutup. </font><font style="vertical-align: inherit;">Artinya, ia menyarankan adanya beberapa firewall yang tidak membiarkan koneksi keluar. </font><font style="vertical-align: inherit;">Saya mulai menjalankan kode shell yang mengurutkan banyak port tcp dan udp, tidak ada efek. </font><font style="vertical-align: inherit;">Koneksi terbalik dimuat melalui http (s) dari Metasploit - meterpreter / reverse_http tidak bekerja. </font><font style="vertical-align: inherit;">Tiba-tiba, koneksi ke port 80 yang sama terjalin, tetapi segera putus. </font><font style="vertical-align: inherit;">Dia menulisnya untuk tindakan IPS masih imajiner, yang tidak suka lalu lintas meterpreter. </font><font style="vertical-align: inherit;">Mengingat fakta bahwa koneksi tcp murni ke port 80 gagal, tetapi http berhasil, saya menyimpulkan bahwa proxy http entah bagaimana dikonfigurasikan dalam sistem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mencoba bahkan meterpreter melalui DNS (terima kasih</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d00kie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atas upayanya, menyelamatkan banyak proyek), mengingat kesuksesan pertama, tetapi ia bahkan tidak bekerja di stand - kode shell terlalu tebal untuk kerentanan ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada kenyataannya, itu terlihat seperti ini: 3-4 upaya untuk menyerang dalam 5 menit, kemudian menunggu selama 30 jam. Jadi selama tiga minggu berturut-turut. Saya bahkan menyiapkan pengingat agar tidak membuang waktu. Selain itu, ada perbedaan dalam perilaku lingkungan pengujian dan pertempuran: ada dua eksploitasi serupa untuk kerentanan ini, satu dari Metasploit, yang kedua dari Internet, yang diperbaiki dari versi Shadow Brokers. Jadi, pada pertempuran itu hanya Metasploit yang berhasil, di stand - hanya yang kedua, yang semakin rumit men-debug dan menghancurkan otak.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada akhirnya, kode shell terbukti efektif, yang mengunduh file exe dari server tertentu melalui http dan menjalankannya pada sistem target. Shellcode cukup kecil untuk muat, dan setidaknya itu berhasil. Karena server TCP sama sekali tidak menyukai lalu lintas dan http (s) diperiksa untuk meterpreter, saya memutuskan bahwa cara tercepat adalah dengan mengunduh file exe yang berisi DNS-meterpreter melalui shellcode ini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini muncul lagi masalah: ketika mengunduh file-exe dan, seperti yang ditunjukkan oleh upaya, apa pun yang terjadi, unduhannya terputus. </font><font style="vertical-align: inherit;">Sekali lagi, beberapa jenis perangkat perlindungan antara server saya dan ahli urologi tidak suka lalu lintas http dengan exe di dalamnya. </font><font style="vertical-align: inherit;">Sepertinya solusi "cepat" untuk mengubah shellcode sehingga mengaburkan lalu lintas http dengan cepat, sehingga data biner abstrak ditransfer alih-alih exe. </font><font style="vertical-align: inherit;">Akhirnya, serangan itu berhasil, kontrol datang melalui saluran DNS yang tipis:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ca/-h/da/ca-hdaxtehdtgxz-o1sypuvgo5u.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Segera menjadi jelas bahwa saya memiliki hak paling sederhana untuk alur kerja IIS yang memungkinkan saya untuk tidak melakukan apa pun. </font><font style="vertical-align: inherit;">Ini adalah tampilannya di konsol Metasploit:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/cu/ck/nccucklqwhs5kpekejdz8vky3qc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua metodologi pentest sangat menyarankan bahwa Anda perlu meningkatkan hak ketika mendapatkan akses. Biasanya saya tidak melakukan ini secara lokal, karena akses pertama dianggap hanya sebagai titik masuk jaringan, dan kompromi mesin lain pada jaringan yang sama biasanya lebih mudah dan lebih cepat daripada meningkatkan hak istimewa pada host yang ada. Tapi ini bukan masalahnya, karena saluran DNS sangat sempit dan itu tidak akan memungkinkan lalu lintas untuk menjelajah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan asumsi bahwa server ini dengan Windows 2003 tidak diperbaiki dari kerentanan MS17-010 yang terkenal, saya tunneling traffic ke port 445 / TCP melalui meterpreter DNS tunnel ke localhost (ya, ini juga mungkin) dan mencoba untuk menjalankan exe yang sebelumnya diunduh melalui kerentanan. Serangannya berhasil, saya mendapatkan koneksi kedua, tetapi dengan hak istimewa SISTEM.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bv/mq/em/bvmqempcbcjfwu7colpyjhiupju.png"></div><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menariknya, server masih berusaha melindungi terhadap MS17-010 - ia telah menonaktifkan layanan jaringan yang rentan pada antarmuka eksternal. </font><font style="vertical-align: inherit;">Ini benar-benar melindungi terhadap serangan melalui jaringan, tetapi serangan dari dalam localhost berhasil, karena Anda tidak bisa begitu saja mengambil dan dengan cepat mematikan SMB di localhost.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selanjutnya, detail menarik baru terungkap:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memiliki izin SISTEM, Anda dapat dengan mudah menginstal kembali-terhubung melalui TCP. </font><font style="vertical-align: inherit;">Jelas, larangan TCP langsung secara eksklusif merupakan masalah pengguna terbatas IIS. </font><font style="vertical-align: inherit;">Spoiler: Lalu lintas pengguna IIS entah bagaimana dibungkus dengan Proxy ISA lokal di kedua arah. </font><font style="vertical-align: inherit;">Bagaimana tepatnya ini tidak direproduksi.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya berada di "DMZ" tertentu (dan ini bukan domain Direktori Aktif, tetapi WORKGROUP) - kedengarannya logis. </font><font style="vertical-align: inherit;">Tetapi alih-alih alamat IP pribadi ("abu-abu") yang diharapkan, saya cukup "putih", persis sama dengan yang saya serang sebelumnya. </font><font style="vertical-align: inherit;">Ini berarti bahwa perusahaan sudah sangat tua untuk dunia pengalamatan IPv4 sehingga mampu mempertahankan zona DMZ di 128 alamat â€œputihâ€ tanpa NAT sesuai dengan skema, seperti yang diilustrasikan dalam manual Cisco 2005.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena server sudah lama, Mimikatz dijamin untuk langsung bekerja dari memori:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qn/bu/tk/qnbutkh_dfi7ngbtp1cguanlf5q.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mendapatkan kata sandi administrator lokal, saya tunnel traffic RDP melalui TCP dan saya masuk ke desktop yang nyaman. </font><font style="vertical-align: inherit;">Karena Anda bisa melakukan apa saja dengan server, saya menghapus antivirus, saya menemukan bahwa server dapat diakses dari Internet hanya pada port TCP 80 dan 443, dan 443 tidak sibuk. </font><font style="vertical-align: inherit;">Saya menaikkan server OpenVPN ke 443, menambahkan fungsi NAT untuk lalu lintas VPN saya dan mendapatkan akses langsung ke jaringan DMZ dalam bentuk tidak terbatas melalui OpenVPN saya. </font><font style="vertical-align: inherit;">Patut dicatat bahwa ISA, dengan beberapa fitur IPS non-disable, memblokir lalu lintas saya dengan pemindaian port, yang harus diganti dengan RRAS yang lebih sederhana dan lebih fleksibel. </font><font style="vertical-align: inherit;">Jadi, pentester terkadang masih harus mengatur semuanya.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y3/cs/rb/y3csrbtb7drx_oh7bcswhqf8apq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pembaca yang penuh perhatian akan bertanya: "Dan apa situs kedua - wiki dengan otentikasi NTLM, yang sudah begitu banyak ditulis?" </font><font style="vertical-align: inherit;">Tentang itu lebih jauh.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 2. Apakah Anda masih tidak mengenkripsi? </font><font style="vertical-align: inherit;">Lalu kami </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pergi ke Anda</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sudah di sini</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, ada akses ke segmen jaringan DMZ. </font><font style="vertical-align: inherit;">Anda harus pergi ke administrator domain. </font><font style="vertical-align: inherit;">Hal pertama yang terlintas dalam pikiran adalah untuk secara otomatis memeriksa keamanan layanan di dalam segmen DMZ, terlebih lagi karena mereka sekarang jauh lebih terbuka untuk penelitian. </font><font style="vertical-align: inherit;">Gambaran umum dalam uji penetrasi: perimeter eksternal lebih terlindungi daripada layanan internal, dan ketika Anda mendapatkan akses ke infrastruktur besar, jauh lebih mudah untuk mendapatkan hak diperpanjang dalam domain hanya karena domain ini mulai dapat diakses untuk alat, dan kedua, selalu ada beberapa masalah kritis dalam infrastruktur untuk beberapa ribu host.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya memuat pemindai pada DMZ melalui terowongan OpenVPN, saya menunggu. Saya membuka laporan - lagi tidak ada yang serius, ternyata seseorang berjalan dengan cara yang sama kepada saya. Langkah selanjutnya adalah memeriksa bagaimana host berkomunikasi dalam jaringan DMZ. Untuk melakukan ini, sebagai permulaan, Wireshark reguler diluncurkan dengan mendengarkan permintaan siaran, terutama ARP. Paket ARP dikumpulkan sepanjang hari. Ternyata beberapa gateway digunakan di segmen ini. Ini akan berguna nanti. Merekatkan data pada data tanggapan-permintaan ARP dan data pemindaian port, saya menemukan titik-titik keluaran lalu lintas pengguna dari dalam jaringan lokal di samping layanan-layanan yang sebelumnya dikenal, seperti web dan surat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena saat ini saya tidak memiliki akses ke sistem lain dan tidak ada satu akun untuk layanan perusahaan, diputuskan untuk mengambil setidaknya beberapa akun dari lalu lintas menggunakan ARP Spoofing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cain &amp; Abel diluncurkan di server urologis. </font><font style="vertical-align: inherit;">Dengan mempertimbangkan arus lalu lintas yang teridentifikasi, pasangan yang paling menjanjikan dipilih untuk serangan "man in the middle", kemudian dengan peluncuran jangka pendek selama 5-10 menit, dengan timer untuk memulai kembali server jika terjadi "pembekuan", beberapa lalu lintas jaringan diterima. </font><font style="vertical-align: inherit;">Seperti dalam lelucon, ada dua berita:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagus: banyak kredensial tertangkap dan serangan secara keseluruhan berhasil.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buruk: semua kredensial berasal dari pelanggan sendiri. </font><font style="vertical-align: inherit;">Memberikan layanan dukungan, spesialis pelanggan terhubung ke layanan pelanggan yang tidak selalu memiliki enkripsi lalu lintas yang dikonfigurasi.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, saya mendapatkan banyak kredensial yang tidak berguna dalam konteks proyek, tetapi jelas menarik sebagai peragaan bahaya serangan. Router perbatasan dari perusahaan besar dengan telnet, meneruskan debugging http-port ke CRM internal dengan semua data, akses langsung ke RDP dari Windows XP pada jaringan lokal dan obskurantisme lainnya. Ternyata semacam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supply Chain Compromise sesuai dengan matriks MITER</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga menemukan peluang yang menyenangkan untuk mengumpulkan email dari lalu lintas, sesuatu seperti ini. Ini adalah contoh surat jadi yang beralih dari pelanggan kami ke port SMTP kliennya, lagi-lagi, tanpa enkripsi. Andrei tertentu meminta namanya untuk mengirim ulang dokumentasi, dan diletakkan di cloud disk dengan nama pengguna, kata sandi, dan tautan dalam satu surat balasan:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ec/mo/y1/ecmoy10hbidcsgl7809ldpkx1fu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah pengingat lain bahwa Anda perlu mengenkripsi semua layanan. Tidak diketahui siapa dan kapan akan membaca dan menerapkan secara khusus data Anda - penyedia, administrator sistem perusahaan lain, atau pentester semacam itu. Saya diam bahwa banyak orang dapat dengan mudah mencegat lalu lintas yang tidak dienkripsi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun sukses nyata, ini tidak dibawa lebih dekat ke tujuan. Tentu saja mungkin untuk duduk lama dan mendapatkan informasi yang berharga, tetapi bukan fakta bahwa itu akan muncul di sana, dan serangan itu sendiri sangat berisiko dalam hal integritas jaringan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menggali lagi dalam layanan, sebuah ide menarik muncul di benak saya. Ada sebuah utilitas yang disebut Responder (mudah untuk menemukan contoh aplikasi dengan nama ini), yang, dengan "meracuni" permintaan siaran, memicu koneksi melalui berbagai protokol seperti SMB, HTTP, LDAP, dll. dengan cara yang berbeda, maka setiap orang yang terhubung diminta untuk mengotentikasi dan menyesuaikan sehingga otentikasi melewati NTLM dan dalam mode transparan untuk korban. Paling sering, seorang penyerang dengan demikian mengumpulkan jabat tangan NetNTLMv2 dan dari mereka, menurut kamus, dengan cepat memulihkan kata sandi domain pengguna. Saya menginginkan sesuatu seperti ini, tetapi pengguna duduk "di belakang dinding", atau lebih tepatnya, mereka dipisahkan oleh firewall, dan di WEB mereka pergi melalui cluster proxy Blue Coat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingat, saya menetapkan bahwa nama domain Active Directory bertepatan dengan domain "eksternal", yaitu company.ru? Jadi, Windows, lebih tepatnya Internet Explorer (dan Edge, dan Chrome), memungkinkan pengguna untuk mengotentikasi secara transparan dalam HTTP melalui NTLM, jika mereka menganggap bahwa situs tersebut berada dalam "Zona Intranet". Salah satu tanda "Intranet" adalah panggilan ke alamat IP "abu-abu" atau nama DNS pendek, yaitu tanpa titik. Karena server dengan IP "putih" dan nama DNS preobrazhensky.company.ru siap digunakan, dan mesin domain biasanya mendapatkan akhiran domain Direktori Aktif melalui DHCP untuk menyederhanakan entri nama, mereka hanya perlu menulis URL </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">preobrazhensky</font></a><font style="vertical-align: inherit;"> di bilah alamat</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sehingga mereka menemukan jalan yang benar ke server urologis yang dikompromikan, tidak lupa bahwa itu sekarang disebut "Intranet". </font><font style="vertical-align: inherit;">Artinya, pada saat yang sama memberi saya pengguna jabat tangan NTLM tanpa sepengetahuannya. </font><font style="vertical-align: inherit;">Tetap membuat browser klien berpikir tentang kebutuhan mendesak untuk mengakses server ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilitas hebat Intercepter-NG datang untuk menyelamatkan (terima kasih</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intercepter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Itu memungkinkan Anda untuk mengubah lalu lintas saat bepergian dan bekerja dengan baik pada Windows 2003. Bahkan ada fungsi terpisah untuk memodifikasi hanya file JavaScript dalam arus lalu lintas. Direncanakan semacam Cross-Site Scripting besar-besaran. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blue Coat proksi yang melaluinya pengguna mengakses WEB global yang di-cache secara berkala. Dengan mencegat lalu lintas, jelas bahwa mereka bekerja sepanjang waktu, tanpa henti meminta statika yang sering digunakan untuk mempercepat tampilan konten selama jam sibuk. Selain itu, BlueCoat memiliki User-Agent tertentu, yang dengan jelas membedakannya dari pengguna yang masih hidup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javascript disiapkan, yang dengan bantuan Intercepter-NG pada malam hari menghabiskan seluruh jam menerapkan setiap jawaban dengan file JS untuk Blue Coat. Script melakukan hal berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mendeteksi browser saat ini oleh User-Agent. </font><font style="vertical-align: inherit;">Jika itu Internet Explorer, Edge atau Chrome - itu berhasil.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu hingga DOM halaman terbentuk.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya menyisipkan gambar yang tidak terlihat dengan atribut src dari tipe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preobrazhensky ke DOM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 8080 / NNNNNNNN.png, di mana NNN adalah angka yang berubah-ubah sehingga BlueCoat tidak melakukan cache.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapkan variabel bendera global tempat injeksi dibuat dan Anda tidak perlu lagi menyisipkan gambar.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Browser mencoba memuat gambar ini, pada port 8080 dari server yang dikompromikan, ia menunggu terowongan TCP ke laptop saya, di mana Responder yang sama diluncurkan, yang memerlukan login NTLM dari browser.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ht/p8/d-/htp8d-9mcytkfs2ov2yuom9bm4i.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dilihat oleh log Responder, di pagi hari orang-orang datang untuk bekerja, menyalakan stasiun kerja mereka, kemudian mulai mengunjungi server urologis secara massal dan tanpa disadari, tidak lupa untuk "menggabungkan" jabat tangan NTLM. </font><font style="vertical-align: inherit;">Jabat tangan menghujani sepanjang hari dan mengumpulkan materi dengan jelas untuk serangan pemulihan kata sandi yang terkenal sukses. </font><font style="vertical-align: inherit;">Ini adalah apa yang tampak seperti log Responder:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aj/ba/yt/ajbaytlvh2okb4xknkzalcniqyc.png"></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kunjungan rahasia besar-besaran ke server urologis oleh pengguna</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anda mungkin sudah memperhatikan bahwa keseluruhan cerita ini dibangun berdasarkan prinsip "semuanya baik-baik saja, tetapi ada yang mengecewakan, lalu ada yang mengatasi, dan kemudian semuanya menjadi sukses". </font><font style="vertical-align: inherit;">Jadi, ada yang mengecewakan. </font><font style="vertical-align: inherit;">Dari lima ratus jabat tangan yang unik, tidak ada yang terungkap. </font><font style="vertical-align: inherit;">Dan ini mempertimbangkan fakta bahwa bahkan pada laptop dengan prosesor yang mati, jabat tangan NTLMv2 ini berhasil dengan kecepatan beberapa ratus juta upaya per detik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harus mempersenjatai diri dengan teknik mutasi kata sandi, kartu grafis, kamus lebih tebal dan menunggu. </font><font style="vertical-align: inherit;">Setelah beberapa lama, beberapa akun dengan kata sandi dalam bentuk â€œQ11111111 ... .1111111qâ€ dibuka, yang menunjukkan bahwa semua pengguna pernah dipaksa untuk membuat kata sandi yang sangat panjang dengan karakter huruf yang berbeda, yang seharusnya rumit. </font><font style="vertical-align: inherit;">Tapi Anda tidak bisa hanya gagal pengguna berpengalaman, dan dengan cara ini ia membuatnya lebih mudah diingat. </font><font style="vertical-align: inherit;">Secara total, sekitar 5 buah dibuka, dan hanya satu dari mereka yang memiliki hak berharga untuk layanan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 3. Roskomnadzor menyerang balik</font></font><br>
</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, akun domain pertama diterima. </font><font style="vertical-align: inherit;">Jika pada titik ini Anda tidak tertidur karena pembacaan yang lama, Anda mungkin akan ingat bahwa saya menyebutkan layanan yang tidak memerlukan faktor otentikasi kedua: ini adalah wiki dengan otentikasi NTLM. </font><font style="vertical-align: inherit;">Tentu saja, hal pertama yang mereka lakukan adalah masuk. </font><font style="vertical-align: inherit;">Menggali basis pengetahuan internal dengan cepat membawa hasil:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perusahaan memiliki jaringan WiFi dengan otentikasi akun domain dengan akses ke jaringan lokal. </font><font style="vertical-align: inherit;">Dengan kumpulan data saat ini, ini sudah merupakan vektor serangan yang berfungsi, tetapi Anda harus pergi ke kantor dengan kaki Anda dan menempatkan diri Anda di suatu tempat di kantor pelanggan.</font></font></li>
<li> ,    , â€¦    Â« Â» ,              .    Â«Â»  Â«Â»        .      ,       DMZ.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, "faktor kedua" segera ditambahkan ke akun yang dikompromikan sebagai aplikasi di ponsel saya. Ada sebuah program yang dapat mengirim permintaan push ke telepon dengan keras dengan tombol "setujui" / "setujui", atau tampilkan kode OTP di layar secara diam-diam untuk input independen selanjutnya. Selain itu, metode pertama seharusnya menjadi satu-satunya instruksi yang benar, tetapi tidak berhasil, tidak seperti metode OTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan "faktor kedua" yang rusak, saya berhasil masuk ke email Outlook Web Access dan mengakses Citrix Netscaler Gateway dari jarak jauh. Di Outlook, kejutan menunggu di surat:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/l8/3r/hr/l83rhrmhg4o8cn1ghrhhyjqagrg.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam bidikan langka ini, Anda dapat melihat bagaimana Roskomnadzor membantu pentester.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ini adalah bulan-bulan pertama setelah kunci kipas Telegram yang terkenal, ketika seluruh jaringan ke ribuan alamat menghilang dari akses tanpa </font><i><font style="vertical-align: inherit;">dapat dihindari</font></i><font style="vertical-align: inherit;"> . Menjadi jelas mengapa push tidak bekerja segera dan mengapa "korban" saya tidak membunyikan alarm karena mereka mulai menggunakan akunnya di jam buka. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mereka yang terbiasa dengan Citrix Netscaler membayangkan bahwa itu biasanya diimplementasikan sedemikian rupa sehingga memungkinkan untuk menyampaikan kepada pengguna hanya antarmuka gambar, berusaha untuk tidak memberinya alat untuk meluncurkan aplikasi pihak ketiga dan mentransfer data, dengan segala cara membatasi tindakan melalui cangkang kontrol standar. Menurut pekerjaan saya, saya hanya mendapat 1C:</font></font><br>
<br>
<div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/jl/oy/wi/jloywi1o1ollk3__dpvedswgina.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah berjalan sedikit di antarmuka 1C, saya menemukan bahwa ada modul pemrosesan eksternal di sana. </font><font style="vertical-align: inherit;">Mereka dapat dimuat dari antarmuka, dan mereka akan dieksekusi pada klien atau server, tergantung pada hak dan pengaturan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya meminta teman-teman programmer 1C untuk membuat pemrosesan yang akan mengambil string dan menjalankannya. </font><font style="vertical-align: inherit;">Di 1C, peluncuran prosesnya terlihat seperti ini (diambil dari Internet). </font><font style="vertical-align: inherit;">Setuju, sintaks bahasa 1C menyerang orang berbahasa Rusia dengan kedekatannya? </font></font><br>
<br>
<img width="600" src="https://habrastorage.org/webt/su/_m/ec/su_mecdfowq1wm2voklffkf4zeu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemrosesan dieksekusi dengan sempurna, ternyata Pentester menyebut "shell" - Internet Explorer diluncurkan melaluinya.</font></font><br>
<br>
<div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/5v/xd/kj/5vxdkjtdo7aowdfvpfgj0hdrfso.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelumnya, alamat suatu sistem ditemukan dalam surat yang memungkinkan Anda memesan tiket ke wilayah tersebut. </font><font style="vertical-align: inherit;">Saya memesan pass jika saya harus menggunakan vektor serangan melalui WiFi.</font></font><br>
<br>
<div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/dc/xj/sg/dcxjsgmg53xnrzopu0j6_mlxx9s.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Internet, mereka mengatakan bahwa di kantor pelanggan masih ada katering gratis yang lezat, tetapi saya masih lebih suka mengembangkan serangan melalui situs jarak jauh, lebih tenang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AppLocker diaktifkan pada server aplikasi dengan Citrix, tetapi itu dilewati. </font><font style="vertical-align: inherit;">Meterpreter yang sama dimuat dan mulai melalui DNS, karena versi http tidak ingin terhubung, dan saya tidak tahu alamat proxy internal saat itu. </font><font style="vertical-align: inherit;">Ngomong-ngomong, sejak saat ini, pentest eksternal pada dasarnya berubah menjadi yang internal.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 4. Hak admin untuk pengguna - ini buruk, p-nyatnenko?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal pertama yang dilakukan Pentester ketika dia mengendalikan sesi pengguna domain adalah mengumpulkan semua informasi tentang hak-hak di domain. </font><font style="vertical-align: inherit;">Ada semacam utilitas BloodHound, yang secara otomatis memungkinkan Anda mengunduh informasi tentang pengguna, komputer, grup keamanan melalui protokol LDAP dari pengontrol domain, dan informasi tentang pengguna mana yang baru-baru ini masuk dan siapa administrator lokal melalui SMB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teknik khas untuk mengambil hak administrator domain tampak disederhanakan seperti siklus tindakan monoton:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami pergi ke komputer domain, di mana ada hak administrator lokal, berdasarkan akun domain yang sudah diambil.</font></font></li>
<li> Mimikatz    ,  Kerberos   NTLM  ,       .      lsass.exe        .     Windows  2012R2/Windows 8.1    .</li>
<li>,       .   .  -      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"End of Cycle;" seperti yang ditulis oleh programmer 1C di sini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, pengguna kami ternyata menjadi administrator lokal hanya pada satu host dengan Windows 7, yang namanya adalah kata "VDI", atau "Virtual Desktop Infrastructure", mesin virtual pribadi. </font><font style="vertical-align: inherit;">Mungkin, perancang layanan VDI menyiratkan bahwa karena VDI adalah sistem operasi pribadi pengguna, biarkan pengguna kemudian mengubah lingkungan perangkat lunak, sesuai keinginan Anda, toh tuan rumah dapat "diisi ulang". </font><font style="vertical-align: inherit;">Saya juga berpikir bahwa, secara umum, idenya bagus, saya pergi ke host VDI pribadi ini dan membuat soket di sana:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya menginstal klien OpenVPN di sana, yang membuat terowongan melalui Internet ke server saya. </font><font style="vertical-align: inherit;">Klien harus melalui Blue Coat dengan otentikasi domain, tetapi OpenVPN mengatasi, seperti yang mereka katakan, di luar kotak.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diinstal pada VDI OpenSSH. </font><font style="vertical-align: inherit;">Nah, sungguh, apa ini Windows 7 tanpa SSH?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginilah tampilannya. </font><font style="vertical-align: inherit;">Saya mengingatkan Anda bahwa semua ini harus dilakukan melalui Citrix dan 1C:</font></font><br>
<br>
<div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/tc/4p/g8/tc4pg8otdktkxljex7oblfldjo0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu teknik untuk mempromosikan akses ke komputer tetangga adalah memeriksa kata sandi administrator lokal untuk kecocokan. </font><font style="vertical-align: inherit;">Di sini keberuntungan sedang menunggu segera: hash NTLM administrator lokal default (yang tiba-tiba disebut Administrator) mendekati host VDI tetangga, yang ada beberapa ratus, melalui serangan pass-the-hash. </font><font style="vertical-align: inherit;">Tentu saja, serangan itu segera menyerang mereka.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemudian administrator VDI menembak kaki mereka dua kali:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertama kali mesin VDI tidak dijalankan oleh LAPS, pada dasarnya menyimpan kata sandi administrator lokal yang sama dari gambar yang secara besar-besaran dikerahkan ke VDI.</font></font></li>
<li>   â€”   ,    pass-the-hash .          ,         ,   â€” .</li>
</ul></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa layanan SSH di Windows itu? Sangat sederhana: sekarang server OpenSSH tidak hanya menyediakan perintah shell interaktif yang nyaman tanpa mengganggu pekerjaan pengguna, tetapi juga proxy socks5 pada VDI. Melalui kaus kaki ini, saya terhubung melalui SMB dan mengumpulkan akun dalam cache dari semua ratusan mesin VDI ini, lalu mencari jalur ke administrator domain dalam grafik BloodHound. Dengan ratusan host yang saya miliki, saya menemukan cara ini dengan cukup cepat. Hak administrator domain telah diperoleh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah gambar dari Internet, menunjukkan pencarian yang serupa. Tautan menunjukkan siapa administrator dan siapa yang memasukkan di mana.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hm/49/aa/hm49aasvb46cltksyxo-ugguwns.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, ingat kondisi dari awal proyek - "jangan terapkan rekayasa sosial." </font><font style="vertical-align: inherit;">Jadi, saya mengusulkan untuk merenungkan berapa banyak seluruh Bollywood ini akan dipotong dengan efek khusus, jika seseorang dapat menerapkan phishing dangkal. </font><font style="vertical-align: inherit;">Tetapi secara pribadi saya sangat tertarik untuk melakukan semua ini. </font><font style="vertical-align: inherit;">Saya harap Anda tertarik membaca ini. </font><font style="vertical-align: inherit;">Tentu saja, tidak setiap proyek terlihat begitu menarik, tetapi pekerjaan secara keseluruhan sangat membingungkan dan tidak mandek. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin, seseorang akan memiliki pertanyaan: bagaimana melindungi diri sendiri? </font><font style="vertical-align: inherit;">Bahkan dalam artikel ini, banyak teknik yang dijelaskan, administrator Windows bahkan tidak tahu banyak dari mereka. </font><font style="vertical-align: inherit;">Namun, saya mengusulkan untuk melihatnya dari sudut pandang prinsip-prinsip usang dan langkah-langkah keamanan informasi:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jangan gunakan perangkat lunak yang ketinggalan jaman (ingat Windows 2003 di awal?)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jangan biarkan sistem yang tidak perlu dihidupkan (mengapa situs urologis itu?)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">periksa sendiri kata sandi pengguna untuk kekuatan (jika tidak </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentara ...</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pentester </font><font style="vertical-align: inherit;">akan melakukan ini </font><font style="vertical-align: inherit;">)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak memiliki kata sandi yang sama untuk akun yang berbeda (kompromi VDI)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan lainnya</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, ini sangat sulit untuk diterapkan, tetapi dalam artikel selanjutnya kita akan menunjukkan dalam prakteknya bahwa ini sangat mungkin.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id496702/index.html">PCI Express dalam Intel V-Series FPGAs: Dasar-Dasar Antarmuka dan Fitur Inti Perangkat Keras</a></li>
<li><a href="../id496704/index.html">PCB dari roket Saturn-5 - rekayasa terbalik dengan penjelasan</a></li>
<li><a href="../id496706/index.html">Membaca Akhir Pekan: Sejarah Format Audio - Zaman Kaset dan Perkembangan Teknologi Sintesis Bicara</a></li>
<li><a href="../id496708/index.html">Senapan ruang angkasa, roket uap dan cermin orbital</a></li>
<li><a href="../id496710/index.html">Informasi Komputer: Sederhana dan Cepat</a></li>
<li><a href="../id496714/index.html">Power Automate VS Logic Apps. informasi Umum</a></li>
<li><a href="../id496716/index.html">Power Automate VS Logic Apps. Kasing Daya Otomatis</a></li>
<li><a href="../id496720/index.html">Proyek LLHD - Bahasa Deskripsi Perangkat Keras Universal</a></li>
<li><a href="../id496722/index.html">Tinkov API. Investasi. Langkah pertama</a></li>
<li><a href="../id496726/index.html">Gent ke bawah</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>