<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥒 ✖️ 🧑🏿‍🤝‍🧑🏽 Implementasi proses mengunggah file dari wadah dengan browser ke kerangka uji 🎤 👩🏻‍🏫 🍤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Otomatisasi Pengujian Akhir-2-Akhir dari sistem informasi terintegrasi 
 Bagian 2-2. Menerapkan proses mengunggah file dari wadah dengan browser ke ke...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Implementasi proses mengunggah file dari wadah dengan browser ke kerangka uji</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489268/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otomatisasi Pengujian Akhir-2-Akhir dari sistem informasi terintegrasi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian 2-2. </font><font style="vertical-align: inherit;">Menerapkan proses mengunggah file dari wadah dengan browser ke kerangka uji. </font><font style="vertical-align: inherit;">Cari nama file yang diunduh oleh browser</font></font></h2><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penulis: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/users/anrad</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hubs: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tags: #autotest, #selenium, #selenoid, #headlessbrowser, #download</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Saat kami mengembangkan autotest End-2-End untuk UI, kami dihadapkan dengan pertanyaan "Bagaimana cara mendapatkan nama yang terakhir dimuat file browser dari WebDriver? ", Google tidak mendapatkan apa-apa dengan cepat. Oleh karena itu, saya menulis artikel ini, yang pada saat yang sama memberi tahu apa sebenarnya yang kami punya masalah dan bagaimana kami menyelesaikannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan artikel ini, kami melanjutkan serangkaian publikasi tentang bagaimana kami mengotomatiskan proses pengujian manual (selanjutnya disebut sebagai tes otomatis) dari sistem informasi besar (selanjutnya disebut sebagai Sistem) di salah satu proyek LANIT utama dan apa yang datang darinya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9w/wz/lk/9wwzlkncoqwymqxqltqhcxatig0.jpeg" alt="gambar"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sumber</font></font></i></a><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel itu sendiri menyelesaikan siklus, di bawah ini adalah tautan ke semua bagian sebelumnya: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian 1. Organisasi dan manajerial. Kenapa kita perlu otomatisasi. Organisasi proses pengembangan dan manajemen. Organisasi penggunaan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian 2. Teknis. Arsitektur dan tumpukan teknis. Detail Implementasi dan Kejutan Teknis </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian 2-1. Implementasi kelas dasar untuk semua tes dan JUnit RuleChain, </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itu setahun yang lalu. Jadi hari ini mungkin tidak relevan. Tulis di komentar jika Anda tahu cara efisien untuk memproses file dengan beberapa server kotak selenoid.</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ketika mengembangkan "autotests", kami memiliki tugas untuk mengunduh (mengunduh) file dari sistem dengan analisis selanjutnya dari isinya. Untuk "mengunggah" file dari sistem yang diuji, kami menggunakan solusi berikut:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk mode peluncuran "lokal" (langsung diluncurkan pada PC yang berfungsi) - ketika browser "lokal" diinisialisasi, nama folder lokal sementara dilewatkan sebagai parameter. </font><font style="vertical-align: inherit;">Selanjutnya, file dibaca langsung dari folder lokal untuk analisis selanjutnya;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk mode "jarak jauh" (via Bamboo) - file "diambil" dari wadah dengan browser melalui fitur server Solenoid: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selenoid-host.example.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 4444 / unduh / {SESSION_ID} / {FILE_NAME}</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Detailnya dijelaskan dalam dokumentasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk kedua mode, untuk mengakses file, Anda harus tahu namanya. </font><font style="vertical-align: inherit;">Ini mengejutkan. </font><font style="vertical-align: inherit;">Masalah kurangnya data pada nama file "unduh" adalah sebagai berikut:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setelah "mengklik" tombol "unduh file", browser mengunduh file ke folder lokal yang sesuai dalam wadah;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam hal ini, nama file dibentuk secara dinamis dan, bagaimana menentukannya terlebih dahulu, kami tidak dapat menemukannya. </font><font style="vertical-align: inherit;">Ini adalah fitur dari sistem pengujian kami;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selanjutnya, file ini harus "ditarik keluar" dari wadah dan verifikasi bisnis dari isinya harus dilakukan;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk "menarik keluar" file, Anda harus tahu namanya, tetapi kami tidak tahu nama itu, karena nama itu dihasilkan secara dinamis dan tidak ada nilai di tautan.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, situasi ini diperparah oleh kenyataan bahwa, karena kerumitan besar beberapa tes, beberapa file dapat dibongkar selama tes sebagai bagian dari skrip tes independen yang berbeda dari komposisi tes itu sendiri. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi terbaik bagi kami adalah metode untuk menentukan file yang terakhir diunduh. </font><font style="vertical-align: inherit;">Ada beberapa cara untuk melakukan ini:</font></font><br>
<ul>
<li>        .        .   ,    ;</li>
<li>    Google Chrome   javascript  chrome://downloads/,      html-.       .<br>
</li>
</ul><br>
<br>
<h3>      <br>
</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menganalisis komposisi file yang dimuat browser untuk mode lokal adalah tugas yang sepele. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mode jarak jauh, Anda perlu menggunakan fitur "tidak berdokumen" dari server selenoid: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selenoid-host.example.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 4444 / unduh / {SESSION_ID} menampilkan daftar semua file yang berhasil diunduh, di mana SESSION_ID adalah ID sesi selenoid </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, skema bekerja dengan satu pengecualian: kami Anda perlu menunggu beberapa saat hingga file diunduh dan muncul di daftar. Penantian dapat diatur melalui siklus batas waktu, namun demikian, dengan cara ini kami tidak dapat memperoleh informasi tentang kemungkinan kesalahan pengunggahan file. Kami hanya dapat menentukan bahwa file tidak dimuat di sirkuit ini. Oleh karena itu, pada akhirnya, kami menentukan metode untuk menentukan nama file melalui chrome: // Downloads / page.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mendapatkan nama file melalui chrome: // unduhan / halaman</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ini berfungsi sama baiknya dalam mode lokal dan jarak jauh. </font><font style="vertical-align: inherit;">Skema kerjanya cukup sederhana:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jalankan skrip java untuk membuka jendela chrome: // unduhan /;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memproses data di jendela dengan cara biasa. </font><font style="vertical-align: inherit;">Tunggu hingga file pertama dalam daftar dimuat dan tentukan namanya;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tutup krom: // unduhan / jendela dan kembalikan nama file yang Anda cari.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami googled gagasan menggunakan chrome: // unduhan / dan, sayangnya, saya tidak bisa memberikan tautan ke sumbernya, karena itu belum terpelihara norak. </font><font style="vertical-align: inherit;">Implementasi aktual kelas untuk mendapatkan nama file diberikan di bawah ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kelas untuk mendapatkan nama file yang diunduh melalui chrome: // unduhan /</font></font><br>
<pre><code class="java hljs">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> DOWNLOADS_PAGE_LOAD_TIMEOUT = <span class="hljs-number">5_000</span>;
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> MAX_GET_FILE_NAME_ATTEMPT = <span class="hljs-number">5</span>;<font></font>
 <font></font>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getLastDownloadedFilename</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> DownloaderException </span>{<font></font>
        String[] filename = <span class="hljs-keyword">new</span> String[<span class="hljs-number">1</span>];<font></font>
        Exception[] ex = <span class="hljs-keyword">new</span> Exception[<span class="hljs-number">1</span>];<font></font>
        WebDriver driver = WebDriverRunner.getWebDriver();<font></font>
        JavascriptExecutor executor = (JavascriptExecutor) driver;<font></font>
        Utils.driver.openNewTabCheckAndClose(<font></font>
                () -&gt; {<font></font>
                    executor.executeScript(<span class="hljs-string">"window.open('','_blank');"</span>);<font></font>
                },<font></font>
                () -&gt; {<font></font>
                    driver.get(<span class="hljs-string">"chrome://downloads/"</span>);<font></font>
 <font></font>
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; MAX_GET_FILE_NAME_ATTEMPT; i++) {<font></font>
                    	ex[<span class="hljs-number">0</span>] = <span class="hljs-keyword">null</span>;<font></font>
                        sleep();<font></font>
                    	<span class="hljs-keyword">try</span> {<font></font>
                        	WebElement element = (WebElement) executor.executeScript(<font></font>
                                    <span class="hljs-string">"return document.querySelector('downloads-manager').shadowRoot.querySelector('downloads-item').shadowRoot.getElementById('file-link')"</span>);<font></font>
                        	filename[<span class="hljs-number">0</span>] = element.getText();<font></font>
                            LOGGER.info(<span class="hljs-string">"Attempt get file name "</span> + i + <span class="hljs-string">". Name = '"</span> + filename[<span class="hljs-number">0</span>] + <span class="hljs-string">"'"</span>);<font></font>
                    	} <span class="hljs-keyword">catch</span> (WebDriverException e) {<font></font>
                        	ex[<span class="hljs-number">0</span>] = e;<font></font>
                            LOGGER.info(<span class="hljs-string">"Failed attempt "</span>+ i + <span class="hljs-string">" to get filename text: "</span> + e.getMessage());
                        	<span class="hljs-keyword">continue</span>;<font></font>
                    	}<font></font>
                    	<span class="hljs-keyword">if</span> (filename[<span class="hljs-number">0</span>] != <span class="hljs-keyword">null</span> &amp;&amp; !filename[<span class="hljs-number">0</span>].isEmpty()) {
                        	 <span class="hljs-comment">//             </span><font></font>
                         	executor.executeScript(<font></font>
                                    <span class="hljs-string">"document.querySelector('downloads-manager').shadowRoot.querySelector('downloads-item').shadowRoot.getElementById('remove').click()"</span>);
                        	<span class="hljs-keyword">break</span>;<font></font>
                    	}<font></font>
                    }<font></font>
                }<font></font>
    	);<font></font>
 <font></font>
    	<span class="hljs-keyword">if</span> (filename[<span class="hljs-number">0</span>] != <span class="hljs-keyword">null</span> &amp;&amp; !filename[<span class="hljs-number">0</span>].isEmpty()) {
            <span class="hljs-keyword">return</span> filename[<span class="hljs-number">0</span>];<font></font>
    	}<font></font>
 <font></font>
    	String message = <span class="hljs-string">"Timeout. Can not get last downloaded file name from chrome://downloads/. File name is '"</span> + filename[<span class="hljs-number">0</span>] + <span class="hljs-string">"'. Exception: "</span> + ex[<span class="hljs-number">0</span>].getMessage();<font></font>
        LOGGER.warning(message);<font></font>
    	<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DownloaderException(message, ex[<span class="hljs-number">0</span>]);<font></font>
	}<font></font>
</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id489254/index.html">Apakah Yandex membantu menyebarkan malware?</a></li>
<li><a href="../id489256/index.html">Yayasan Sistem Otomasi Fieldbus</a></li>
<li><a href="../id489258/index.html">Bagaimana tipe integer yang sangat panjang diimplementasikan dalam Python?</a></li>
<li><a href="../id489260/index.html">Bagaimana merancang sistem otomatis skala besar untuk perusahaan besar dalam tujuh langkah</a></li>
<li><a href="../id489262/index.html">Mengapa tidak mudah memberi pengembang kebebasan memilih</a></li>
<li><a href="../id489270/index.html">WebAuthn dalam kehidupan nyata</a></li>
<li><a href="../id489272/index.html">Mata, otak, kualitas video: pantulan 120fps, 8K, HDR, tongkat, kerucut, dan "efek opera sabun"</a></li>
<li><a href="../id489274/index.html">Tegas pesan dalam tes</a></li>
<li><a href="../id489276/index.html">Tes darah untuk zat besi - cara mengontrol level, mendiagnosis alasan mengapa itu penting</a></li>
<li><a href="../id489280/index.html">Ping semua host IPv6 di saluran</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>