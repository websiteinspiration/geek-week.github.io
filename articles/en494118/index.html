<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçø üçΩÔ∏è ‚õëÔ∏è COVID-19 Telegram-bot // We answer FAQ questions automatically üßïüèª ü§¢ üçπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the context of universal hype on Coronavirus, I decided to do at least something useful (but no less hype). In this article I‚Äôll talk about how to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>COVID-19 Telegram-bot // We answer FAQ questions automatically</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494118/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the context of universal hype on Coronavirus, I decided to do at least something useful (but no less hype). </font><font style="vertical-align: inherit;">In this article I‚Äôll talk about how to create and deploy the Telegram Bot using Rule-Based NLP methods in 2.5 hours (that‚Äôs how much it took me) to answer FAQ questions using the COVID-19 case as an example. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the course of work, we will use the good old Python, Telegram API, a couple of standard NLP libraries, as well as Docker.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/68/e4/tw/68e4twfyppio_uy1o1dojajfeca.jpeg"><br>
<a name="habracut"></a><br>
<blockquote><img src="https://habrastorage.org/webt/fi/0x/4z/fi0x4z2nhcc3-3bdzugakb4csji.png" align="left"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UFO Care Minute</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The pandemic COVID-19, a potentially severe acute respiratory infection caused by the SARS-CoV-2 coronavirus (2019-nCoV), has officially been announced in the world. </font><font style="vertical-align: inherit;">There is a lot of information on Habr√© on this topic - always remember that it can be both reliable / useful, and vice versa.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We urge you to be critical of any published information.</font></font></h4><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Official sources</font></font></b><div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">C   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">C </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  ()</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> </a></li>
<li>       </li>
</ul><br>
     ,      .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wash your hands, take care of your loved ones, stay at home whenever possible and work remotely. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Read publications about: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coronavirus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remote work</font></font></a></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brief Preface</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article describes the process of creating a simple Telegram Bot answering FAQ questions on COVID-19. </font><font style="vertical-align: inherit;">Development technology is extremely simple and versatile, and can be used for any other cases. </font><font style="vertical-align: inherit;">I emphasize once again that I do not pretend to be State of the Art, but only offer a simple and effective solution that can be reused. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since I believe that the reader of this article already has some experience with Python, we will assume that you already have Python 3.X installed and the necessary development tools (PyCharm, VS Code), you can create a Bot in Telegram via BotFather, and therefore, I will skip these things.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Configure API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing you need to install is the wrapper library for the Telegram API " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">The standard command for this is:</font></font><br>
<br>
<pre><code class="python hljs">pip install python-telegram-bot --upgrade</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we‚Äôll build the framework of our small program by defining ‚Äúhandlers‚Äù for the following Bot events:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start - Bot's launch command;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help - help command (help);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">message - text message processing;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">error - an error.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The signature of the handlers will look like this:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment"># </span>
    <span class="hljs-keyword">pass</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, by analogy with the example from the library documentation, we define the main function in which we assign all these handlers and start the bot:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_answer</span>():</span>
    <span class="hljs-string">"""Start the bot."""</span>
    <span class="hljs-comment"># Create the Updater and pass it your bot's token.</span>
    <span class="hljs-comment"># Make sure to set use_context=True to use the new context based callbacks</span>
    <span class="hljs-comment"># Post version 12 this will no longer be necessary</span>
    updater = Updater(<span class="hljs-string">"Token"</span>, use_context=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-comment"># Get the dispatcher to register handlers</span><font></font>
    dp = updater.dispatcher<font></font>
<font></font>
    <span class="hljs-comment"># on different commands - answer in Telegram</span>
    dp.add_handler(CommandHandler(<span class="hljs-string">"start"</span>, start))<font></font>
    dp.add_handler(CommandHandler(<span class="hljs-string">"help"</span>, help))<font></font>
<font></font>
    <span class="hljs-comment"># on noncommand i.e message - echo the message on Telegram</span><font></font>
    dp.add_handler(MessageHandler(Filters.text, message))<font></font>
<font></font>
    <span class="hljs-comment"># log all errors</span><font></font>
    dp.add_error_handler(error)<font></font>
<font></font>
    <span class="hljs-comment"># Start the Bot</span><font></font>
    updater.start_polling()<font></font>
<font></font>
    <span class="hljs-comment"># Run the bot until you press Ctrl-C or the process receives SIGINT,</span>
    <span class="hljs-comment"># SIGTERM or SIGABRT. This should be used most of the time, since</span>
    <span class="hljs-comment"># start_polling() is non-blocking and will stop the bot gracefully.</span><font></font>
    updater.idle()<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<font></font>
    get_answer()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I draw your attention to the fact that there are 2 mechanisms how to launch a bot:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standard Polling - periodic polling of Bot using standard Telegram API tools for new events ( </font></font><code>updater.start_polling()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webhook - we start our server with an endpoint, to which events from the bot arrive, it requires HTTPS.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you already noticed, for simplicity we use the standard Polling.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. We fill in standard handlers with logic</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start with a simple one, fill in the start and help handlers with standard answers, we get something like this:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /start is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
!
        COVID-19.
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /help is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
     (  COVID-19).
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, when the user sends the / start or / help commands, they will receive the answer prescribed by us. </font><font style="vertical-align: inherit;">I draw your attention to the fact that the text is formatted in Markdown</font></font><br>
<br>
<pre><code class="python hljs">parse_mode=telegram.ParseMode.MARKDOWN</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, add error logging to the error handler:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Log Errors caused by Updates."""</span>
    logger.warning(<span class="hljs-string">'Update "%s" caused error "%s"'</span>, update, context.error)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, let's check whether our Bot works. </font><font style="vertical-align: inherit;">Copy the whole code written in a single file, for example </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.py</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Add the necessary </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imports</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run the file and go to Telegram ( </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do not forget to insert your Token into the code</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">We write the commands / start and / help and rejoice:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/jf/bo/hnjfbobptb1e1no0h-nl5cdegt4.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. We process the message and generate a response</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing we need to answer the question is the Knowledge Base. </font><font style="vertical-align: inherit;">The simplest thing you can do is create a simple json file in the form of Key-Value values, where Key is the text of the proposed question, and Value is the answer to the question. </font><font style="vertical-align: inherit;">Knowledge Base Example:</font></font><br>
<br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"      ?"</span>: <span class="hljs-string">"  ‚Äî  .     -     ,     ,     ,        .    ,      ,   .        ,     ."</span>,
  <span class="hljs-attr">"   ?"</span>: <span class="hljs-string">"  :\n     \n    \n    \n     \n\n         ,    ."</span>,
  <span class="hljs-attr">"  ?"</span>: <span class="hljs-string">" :\n- (    , , )\n- (  )"</span>,<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The algorithm for answering the question will be as follows:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We get the text of the question from the user;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lemmatize all the words in the user's text;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We do not clearly compare the resulting text with all the lemmatized questions from the knowledge base ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Levenshtein distance</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We select the most ‚Äúsimilar‚Äù question from the knowledge base;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We send the answer to the selected question to the user.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To implement our plans, we need libraries: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fuzzywuzzy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (for fuzzy comparisons) and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pymorphy2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (for lemmatization). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create a new file and implement the sounded algorithm:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> fuzzywuzzy <span class="hljs-keyword">import</span> fuzz
<span class="hljs-keyword">import</span> pymorphy2<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
morph = pymorphy2.MorphAnalyzer()<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">"faq.json"</span>) <span class="hljs-keyword">as</span> json_file:<font></font>
    faq = json.load(json_file)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classify_question</span>(<span class="hljs-params">text</span>):</span>
    <span class="hljs-comment">#  </span>
    text = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> text.split())<font></font>
    questions = list(faq.keys())<font></font>
    scores = list()<font></font>
    <span class="hljs-comment">#      </span>
    <span class="hljs-keyword">for</span> question <span class="hljs-keyword">in</span> questions:
        <span class="hljs-comment">#    </span>
        norm_question = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> question.split())
        <span class="hljs-comment">#       </span><font></font>
        scores.append(fuzz.token_sort_ratio(norm_question.lower(), text.lower()))<font></font>
    <span class="hljs-comment"># </span><font></font>
    answer = faq[questions[scores.index(max(scores))]]<font></font>
<font></font>
    <span class="hljs-keyword">return</span> answer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before writing a message handler, we will write a function that saves the history of correspondence in a tsv file:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump_data</span>(<span class="hljs-params">user, question, answer</span>):</span><font></font>
    username = user.username<font></font>
    full_name = user.full_name<font></font>
    id = user.id<font></font>
<font></font>
    str = <span class="hljs-string">"""{username}\t{full_name}\t{id}\t{question}\t{answer}\n"""</span>.format(username=username,<font></font>
                                                                 full_name=full_name,<font></font>
                                                                 id=id,<font></font>
                                                                 question=question,<font></font>
                                                                 answer=answer)<font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"/data/dump.tsv"</span>, <span class="hljs-string">"a"</span>) <span class="hljs-keyword">as</span> myfile:<font></font>
        myfile.write(str)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, use the method we wrote in the message text message handler:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Answer the user message."""</span>
    <span class="hljs-comment"># </span><font></font>
    answer = classify_question(update.message.text)<font></font>
    <span class="hljs-comment">#  </span><font></font>
    dump_data(update.message.from_user, update.message.text, answer)<font></font>
    <span class="hljs-comment"># </span>
    update.message.reply_text(answer)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voila, now go to Telegram and enjoy the writing:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/id/fj/2h/idfj2hjue-vkxmusxsd6hibl-zu.jpeg" width="300"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Configure Docker and deploy the application</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As the classic said: ‚ÄúIf you execute, then it‚Äôs beautiful to execute.‚Äù, So that we have everything as people, we‚Äôll configure containerization using Docker Compose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For this we need:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create Dockerfile - defines the image of the container and the entry point;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create docker-compose.yml - launches many containers using a single Dockerfile (in our case it is not necessary, but in case you have many services, it will be useful.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create boot.sh (the script is responsible directly for launching).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the contents of the Dockerfile:</font></font><br>
<br>
<pre><code class="plaintext hljs">#<font></font>
FROM python:3.6.6-slim<font></font>
<font></font>
#  <font></font>
WORKDIR /home/alex/covid-bot<font></font>
<font></font>
#  requirements.txt<font></font>
COPY requirements.txt ./<font></font>
<font></font>
# Install required libs<font></font>
RUN pip install --upgrade pip -r requirements.txt; exit 0<font></font>
<font></font>
#      <font></font>
COPY data data<font></font>
<font></font>
#   <font></font>
COPY app.py faq.json reply_generator.py boot.sh  ./<font></font>
<font></font>
#   <font></font>
RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*<font></font>
<font></font>
# <font></font>
RUN chmod +x boot.sh<font></font>
<font></font>
#  <font></font>
ENTRYPOINT ["./boot.sh"]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The content of docker-compose.yml:</font></font><br>
<br>
<pre><code class="plaintext hljs"># docker-compose<font></font>
version: '2'<font></font>
#  <font></font>
services:<font></font>
  bot:<font></font>
    restart: unless-stopped<font></font>
    image: covid19_rus_bot:latest<font></font>
    container_name: covid19_rus_bot<font></font>
    #    boot.sh<font></font>
    environment:<font></font>
      - SERVICE_TYPE=covid19_rus_bot<font></font>
    # volume      <font></font>
    volumes: <font></font>
        - ./data:/data<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The contents of boot.sh:</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/bash<font></font>
if [ -n $SERVICE_TYPE ]<font></font>
then<font></font>
  if [ $SERVICE_TYPE == "covid19_rus_bot" ]<font></font>
  then<font></font>
    exec python app.py<font></font>
    exit<font></font>
  fi<font></font>
else<font></font>
  echo -e "SERVICE_TYPE not set\n"<font></font>
fi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we are ready, in order to start all this you need to execute the following commands in the project folder:</font></font><br>
<br>
<pre><code class="bash hljs">sudo docker build -t covid19_rus_bot:latest .<font></font>
sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's it, our bot is ready.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instead of a conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As expected, all code is available in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach, shown by me, can be applied in any case for answering FAQ questions, just customize the knowledge base! Regarding the knowledge base, it can also be improved by changing the structure of Key and Value to arrays, so each pair will be an array of potential questions on one topic and an array of potential answers to them (for a variety of answers, you can choose randomly). Naturally, the Rule-Based approach is not too flexible for scaling, but I am sure that this approach will withstand a knowledge base with about 500 questions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Those who have read to the end I invite you to try my Bot </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494096/index.html">Intranet deployment. Experience, mistakes, recommendations</a></li>
<li><a href="../en494098/index.html">Imperative approach to reactive data on the example of Jetbrains KTor and R2DBC</a></li>
<li><a href="../en494100/index.html">What you need to create the ideal model of an educational center for training IT-specialists</a></li>
<li><a href="../en494110/index.html">Property-based testing for JavaScript and UI: an unusual approach to automated tests</a></li>
<li><a href="../en494114/index.html">How to reduce the number and increase the readability of code in react-redux, redux-saga</a></li>
<li><a href="../en494124/index.html">Assembling an 8-bit computer: how to reduce the number of chips to six</a></li>
<li><a href="../en494126/index.html">TOP SCIENCE. February Media Ten: Crab Zombie Feminists, Prehistoric Salamanders and Exaggerated Alcoholics</a></li>
<li><a href="../en494128/index.html">Hackspace Neuron - a meeting place for hackers in Moscow</a></li>
<li><a href="../en494130/index.html">What happens to online events: some of our statistics</a></li>
<li><a href="../en494132/index.html">Befunge compiler in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>