<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👷🏻 ❤️ 🤠 8base機能を使用したSlackアプリケーションの作成 👫 🙆🏻 👑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Slackは、チーム間の内部コミュニケーションに最適なアプリケーションです。ユーザーが外部サービスと対話できるようにするチャットボットとスラッシュチャットコマンドを作成して統合することで、簡単に拡張できる機能の1つ。優れたSlackボットは、非常に人気があり便利なGitHubボットで、プルリクエスト...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>8base機能を使用したSlackアプリケーションの作成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466335/"><img src="https://habrastorage.org/getpro/habr/post_images/ee8/574/873/ee8574873908032aed87f5703682d618.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Slackは、チーム間の内部コミュニケーションに最適なアプリケーションです。ユーザーが外部サービスと対話できるようにするチャットボットとスラッシュチャットコマンドを作成して統合することで、簡単に拡張できる機能の1つ。優れたSlackボットは、非常に人気があり便利なGitHubボットで、プルリクエストの更新、コミット、チャネルでのishを発行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、私たちが管理する発明されたeコマースプラットフォームで注文を作成するときに更新を公開するSlackボットを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
eコマースプラットフォームは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8base</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して作成されたサーバーレスアプリケーションです</font><font style="vertical-align: inherit;">。この記事では、8base関数を使用して、トリガーを使用するデータモデルでCreateイベントをリッスンします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トリガーは、データ変更イベントに応じてトリガーされる関数のタイプです</font><font style="vertical-align: inherit;">。オブジェクトの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または削除です。</font><font style="vertical-align: inherit;">8baseは、開発者がデータの変更前または変更後に関数を実行するかどうかに応じて、trigger.beforeとtrigger.afterの2種類のトリガーを提供します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要になるだろう </font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.jsの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的な理解</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">始める前に、Nodeと</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">npm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yarnがインストールされ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ていることを確認してください</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトではいくつかのGraphQLクエリを使用するため、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQLに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">精通して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">いると役立ち</font></a><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=http://"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウェブサイトにアクセスして</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、8baseアカウントを作成します（まだ作成していない場合）</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8base環境の準備</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アカウントを作成するか、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://auth.8base.com/login%3Fstate%3Dg6Fo2SBpTkZiUGl6QXJ5VFVkZS16U09yanNQU3dxNlJlQlV2NqN0aWTZIC04bGxiaENJU05ha0MzVUduT2ZuU19senhlbE5VN1l1o2NpZNkgcUdIWlZ1NUN4WTVrbGl2bTI4T1BMam9wdnNZcDBiYUQ%26client%3DqGHZVu5CxY5klivm28OPLjopvsYp0baD%26protocol%3Doauth2%26response_type%3Dtoken%2520id_token%26redirect_uri%3D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8baseに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ログインします</font><font style="vertical-align: inherit;">。新規アカウントの場合、8baseは30日間の無料アクセスを提供します。</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/getpro/habr/post_images/064/449/5e8/0644495e868a6e3b11bf27df93d61080.png" alt="画像"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‍2。</font><font style="vertical-align: inherit;">ログイン後、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページに移動し、</font><font style="vertical-align: inherit;">[新しいテーブル]をクリックしてバックエンドの構成を開始します。</font></font><br>
<img src="https://habrastorage.org/getpro/habr/post_images/011/8e4/ce6/0118e4ce63f1da4bc98b872b1e76a260.png" alt="画像"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‍3。</font><font style="vertical-align: inherit;">新しいテーブルをロードすると、図が表示され、フィールドの定義を開始できます。</font><font style="vertical-align: inherit;">次に、次のフィールドで構成されるOrdersというテーブルを作成します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：フィールドタイプ-テーブル。</font><font style="vertical-align: inherit;">右側のセクションで「ユーザー」テーブルを選択し、「関係フィールド名」フィールドで「注文」を指定します。</font><font style="vertical-align: inherit;">次に、[ </font><b><font style="vertical-align: inherit;">ユーザー</font></b><font style="vertical-align: inherit;">ごとに</font><font style="vertical-align: inherit;">複数の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注文を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">許可する]チェックボックスをオンにします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
 -items：フィールドタイプはJSONです。</font><font style="vertical-align: inherit;">このフィールドには、価格、名前、画像など、ユーザーが購入した製品に関する情報が含まれます。</font><font style="vertical-align: inherit;">
私たちのレイアウトは非常にシンプルで、必要な機能をカバーしています。</font><font style="vertical-align: inherit;">次に、Slackアプリをセットアップしてインストールします。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<img src="https://habrastorage.org/getpro/habr/post_images/64f/24f/8d0/64f24f8d0f5f626c397708980ef822ea.png" alt="画像"><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slackアプリケーションを作成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まずSlackにログインするか、このガイド用に新しいSlackを作成します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slack APIコンソール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">アクセス</font><font style="vertical-align: inherit;">して、新しいSlackアプリを作成します。</font><b><font style="vertical-align: inherit;">Shop Squick</font></b></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/870/fb8/956/870fb8956f2b3b4dabceadf602df6d0d.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
と呼ばれる架空のeコマースプラットフォームの後に、このSlackアプリを呼び出し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">
ワークショップでアプリケーションを作成した後、Slackアプリケーションを一時的に延期し、8base関数の作成に取り掛かることができます。この関数は、</font><b><font style="vertical-align: inherit;">Shop Quick</font></b><font style="vertical-align: inherit;">プラットフォームでの新しい注文の作成のイベントをリッスンします</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8base関数を作成する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8baseプラットフォームは、サーバーレスアプリケーションの作成を容易にする機能を提供します。このSlackアプリケーションでは、CRUDだけでは実装できないカスタムロジックと統合が必要です。今回のケースでは、新しい注文を作成するときにSlackにメッセージを送信します。これは、8base関数を使用して実現でき、Create、Update、およびDeleteイベントをリッスンします。トリガーを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トリガーは、データ変更イベントに応じてトリガーされる関数です。オブジェクトが作成、更新、または削除されたときです。トリガーには、データ変更の前と後のどちらで実行されるかに応じて、trigger.beforeとtrigger.afterの2種類があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、注文を作成した後に関数を呼び出します。</font><font style="vertical-align: inherit;">したがって、Orders.createを指定する必要があります。</font><font style="vertical-align: inherit;">データイベントの可能な値は、作成、更新、および削除です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8base CLI</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CLI 8baseを使用すると、ボイラープレートコードを回避しながら、カスタムJavaScriptまたはTypeScriptを記述してロジックを効率的に追加し、アプリケーションに固有のものにのみ焦点を当てることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8baseコマンドラインインターフェイス（CLI）を使用すると、端末から直接、カスタムサーバーロジックをアプリケーションに簡単に追加できます。</font><font style="vertical-align: inherit;">端末で次のコマンドを実行して、CLIをインストールします。</font></font><br>
<br>
<pre><code class="javascript hljs">npm install -g <span class="hljs-number">8</span>base
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CLIをグローバルにインストールしたら、ログインして、8baseアカウントへのCLIアクセスを付与する必要があります。</font><font style="vertical-align: inherit;">次のコマンドを実行してログイン</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font><font style="vertical-align: inherit;">し</font></font><br>
<pre><code class="javascript hljs"><span class="hljs-number">8</span>base login
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンドを実行すると、CLI認証のためのブラウザウィンドウが表示されます。</font><font style="vertical-align: inherit;">ログインすると、8baseアカウントへのCLIアクセスが提供されます。</font><font style="vertical-align: inherit;">helpコマンドを実行すると、CLIが提供する他のコマンドを見つけることができます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-number">8</span>base help
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ターミナルで次のコマンドを実行して、CLIを使用して8baseプロジェクトを初期化します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-number">8</span>base init shop-quick-functions
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドを実行すると、新しいフォルダが作成されます。</font><font style="vertical-align: inherit;">フォルダー構造は次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs">├── src/<font></font>
|   ├── function1.ts<font></font>
|   └── function2.js<font></font>
├── <span class="hljs-number">8</span>base.yml<font></font>
└── package.json</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CLIは通常のNodeプロジェクトをロードします。これにより、npmまたはyarnを使用して依存関係をインストールできます。</font><font style="vertical-align: inherit;">さらに、8base CLIには、WebpackとTypeScriptがあらかじめ設定されているため、JavaScriptまたはTypeScriptコードを記述できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8base.ymlでカスタム関数と権限を設定します。</font><font style="vertical-align: inherit;">必要に応じて、8base.ymlファイルの現在の設定を変更します。</font><font style="vertical-align: inherit;">ファイルを開き、次の変更を行います。</font></font><br>
<br>
<pre><code class="javascript hljs">functions:  <font></font>
  notifySlack:<font></font>
    handler:      <font></font>
     code: src/notifySlack.js    <font></font>
   <span class="hljs-attr">type</span>: trigger.after    
   <span class="hljs-attr">operation</span>: Orders.create</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル構造は、YAMLファイルに似ています。</font><font style="vertical-align: inherit;">最初に見るブロックは関数ブロックです。</font><font style="vertical-align: inherit;">作成するすべての関数定義をこのブロックに配置します。</font><font style="vertical-align: inherit;">たとえば、作成したnotifySlack関数です。</font><font style="vertical-align: inherit;">この関数には次のプロパティがあります。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handler</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：notifySlack関数ハンドラーへの相対ファイルパス。</font></font></li>
<li><b>operation</b>:  ,        .</li>
<li><b>type</b>:        .   : trigger.before  trigger.after.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは、トリガー後にイベントの受信を開始するハンドラーファイルを作成することです。 Slackに更新を送信するには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chat.postMessage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを使用し</font><font style="vertical-align: inherit;">ます。メッセージはHTTP postメソッドを使用して送信されます-chat.postMessageメソッドへの各リクエストは、ボットのOAuthアクセストークンによって署名されます。アプリケーションの詳細ページにアクセスし、サイドバーナビゲーションの[OAuth＆権限]リンクをクリックします。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/180/c54/94d/180c5494dcf0df2c5de56fcefbc65c2a.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
theトークンをコピー</font><font style="vertical-align: inherit;">し、8base設定ページの</font><font style="vertical-align: inherit;">[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">環境変数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブ</font><font style="vertical-align: inherit;">に移動します。関数は、作成されたすべての環境変数にアクセスできます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いつも</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここには機密の値と認証情報を保存し、ソースコードデータベースに直接配置しないでください。 SLACK_ACCESS_TOKENという新しい変数を作成し、コピーしたトークンを貼り付けて保存します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/84a/b45/96b/84ab4596bc04520f2ae6da4675274dc4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、コードをエディターに追加します。 srcディレクトリにutils.jsというファイルを作成します。お気に入りのエディターでファイルを開き、以下をコピーします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/* src/utils.js */</span><span class="hljs-keyword">export</span>
<span class="hljs-keyword">const</span> sendMessage = <span class="hljs-function">(<span class="hljs-params">order</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> message = <span class="hljs-string">`A new order was just created`</span>;
	<span class="hljs-keyword">const</span> messageBody = dataBuilder(order);  
	<span class="hljs-keyword">const</span> body = {
		<span class="hljs-attr">channel</span>: <span class="hljs-string">'general'</span>,
		<span class="hljs-attr">attachments</span>: messageBody,
		<span class="hljs-attr">text</span>: message<font></font>
	};<font></font>
‍<font></font>
       <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Message body'</span>, { body });  
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Sending message request'</span>);  <span class="hljs-keyword">return</span> makeRequest(body);<font></font>
};‍</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、sendMessage関数は1つの引数を持つ注文を受け入れます。これは、Orderモデル用に作成したフィールドを含むオブジェクトです。次に、orderオブジェクトを使用して新しいメッセージを作成する必要があるので、dataBuilderという関数にオブジェクトを渡します。 dataBuilder関数は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slack添付ファイルの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式でオブジェクトを返します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、メッセージのパブリッシュ先のワークスペースチャネル、dataBuilderから返された添付ファイル、最後にテキストを含むリクエスト本文を作成します。次に、メッセージをパブリッシュする要求がmakeRequest関数によって送信されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dataBuilder関数を作成して、以下のフラグメントをコピーし、utils.jsファイルを更新してみましょう。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/* src/utils.js */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> sendMessage = <span class="hljs-function">(<span class="hljs-params">order</span>) =&gt;</span> { ...};
<span class="hljs-keyword">const</span> dataBuilder = <span class="hljs-function">(<span class="hljs-params">order</span>) =&gt;</span> {
 <span class="hljs-keyword">const</span> { items } = order;
 <span class="hljs-keyword">const</span> itemSections = items.map(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
   <span class="hljs-keyword">return</span> {
     <span class="hljs-attr">type</span>: <span class="hljs-string">'section'</span>,
     <span class="hljs-attr">text</span>: item.name,
     <span class="hljs-attr">color</span>: <span class="hljs-string">'#3AA3E3'</span>,
     <span class="hljs-attr">accessory</span>: {
       <span class="hljs-attr">type</span>: <span class="hljs-string">'image'</span>,
       <span class="hljs-attr">image_url</span>: item.image,
       <span class="hljs-attr">alt_text</span>: item.name,<font></font>
     },<font></font>
   };<font></font>
 });<font></font>
 <span class="hljs-keyword">const</span> data = [<font></font>
   {<font></font>
     <span class="hljs-attr">type</span>: <span class="hljs-string">'section'</span>,
     <span class="hljs-attr">text</span>: {
       <span class="hljs-attr">type</span>: <span class="hljs-string">'mrkdwn'</span>,
       <span class="hljs-attr">text</span>: <span class="hljs-string">`*There are <span class="hljs-subst">${items.length}</span> items in the order*`</span>,<font></font>
     },<font></font>
   },<font></font>
   ...itemSections,<font></font>
 ];<font></font>
 <span class="hljs-keyword">return</span> data;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dataBuilder関数は、orderオブジェクトを取り、アイテムの名前と画像を使用して、オーダー内の各アイテムのセクションを作成します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッセージビルダー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用して</font><font style="vertical-align: inherit;">、メッセージと添付ファイルのフォーマットをリアルタイムでプレビュー</font><font style="vertical-align: inherit;">できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、メッセージ本文をSlackワークショップに送信するmakeRequest関数を追加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のスニペットをutils.jsファイルにコピーします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/* src/utils.js */</span>
<span class="hljs-keyword">import</span> fetch <span class="hljs-keyword">from</span> <span class="hljs-string">'node-fetch'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> sendMessage = <span class="hljs-function">(<span class="hljs-params">order</span>) =&gt;</span> { ... };
<span class="hljs-keyword">const</span> dataBuilder = <span class="hljs-function">(<span class="hljs-params">order</span>) =&gt;</span> { ... };
<span class="hljs-keyword">const</span> makeRequest = <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> url = <span class="hljs-string">'https://slack.com/api/chat.postMessage'</span>;
	<span class="hljs-keyword">const</span> headers = {
		<span class="hljs-attr">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${process.env.SLACK_ACCESS_TOKEN}</span>`</span>,
		<span class="hljs-string">'Content-type'</span>: <span class="hljs-string">'application/json'</span>,<font></font>
	};<font></font>
	<span class="hljs-keyword">return</span> fetch(url, {
		<span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
		<span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(data),<font></font>
		headers,<font></font>
	});<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、次のコマンドを実行してノードフェッチパッケージをインストールします。</font></font><br>
<br>
<pre><code class="javascript hljs">npm install node-fetch
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージをインポートして、makeRequest関数で使用します。関数の一部として、必要なすべてのヘッダーをリクエストに追加します。リクエストはベアラ認証ヘッダーで署名されている必要があります。トークンは、前に作成した環境変数から取得されます。最後に、フェッチAPIを使用してPOSTリクエストを返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ボットを使用してSlackウォースペースにメッセージを送信するために必要なものがすべて揃いました。上記の8base.ymlファイルで参照した関数ハンドラーを作成しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
srcディレクトリにnotifySlack.jsというファイルを作成し、ファイルを開いてコードをコピーします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/* src/notifySlack.js */</span>
<span class="hljs-keyword">import</span> {<font></font>
   sendMessage<font></font>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> (event) =&gt; {
   <span class="hljs-keyword">try</span> {
       <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Sending notification to slack'</span>);
       <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> sendMessage(event.data);
       <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Notification sent successfully'</span>);<font></font>
   } <span class="hljs-keyword">catch</span> (error) {
       <span class="hljs-built_in">console</span>.log(error);<font></font>
   }<font></font>
   <span class="hljs-keyword">return</span> {
       <span class="hljs-attr">data</span>: event.data,<font></font>
   };<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルでは、作成したsendMessageユーティリティ関数を使用します。 8base関数ハンドラーは、イベントとコンテキストの2つの引数を渡します。イベントオブジェクトの構造は、機能の種類に依存し、コンテキストオブジェクトを使用すると、約読むことができる便利なプロパティとメソッドが含まれ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ここを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、イベントオブジェクトには、2つのユーザーフィールドとアイテムフィールドで構成される、作成された注文が含まれます。 Orderオブジェクトはイベントオブジェクトデータのプロパティであり、このオブジェクトをsendMessage関数に渡してSlackに通知します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーによる関数の終了を望まないため、関数呼び出しはtry / catchにラップされています。最後に、関数の最後にイベントデータを返します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデータを使用して、メッセージの件名と本文を示し、作成したトランスポーターを使用してメールを送信できます。</font><font style="vertical-align: inherit;">次の</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font><font style="vertical-align: inherit;">コマンド</font></font><pre><code class="javascript hljs"># deploy <span class="hljs-keyword">while</span> <span class="hljs-keyword">in</span> project root directory
<span class="hljs-number">8</span>base deploy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
計算機能が正常に終了すると、次の出力ターミナル</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データが表示されます。</font></font><br>
<pre><code class="javascript hljs">➜ <span class="hljs-number">8</span>base deploy<font></font>
deploy done. Time: <span class="hljs-number">15</span>,<span class="hljs-number">553</span> ms.</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバッグ機能</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数を簡単にデバッグし、そこで何が行われているかを追跡できるように、関数にログを記録することが重要です。</font><font style="vertical-align: inherit;">8baseには、プロファイルに関連付けられたすべての機能を表示するためのページがあります。</font><font style="vertical-align: inherit;">各機能からのすべてのログを簡単に表示できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8base </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダッシュボード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に移動</font><font style="vertical-align: inherit;">し、サイドメニューの</font><font style="vertical-align: inherit;">[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロジック</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリックし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ロジックページでは、レイアウトされたすべての関数を表示できます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/1a2/c20/38a/1a2c2038afb3be1b65769a05cda9482b.png" alt="画像"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定の機能については、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ログの表示」を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリック</font><font style="vertical-align: inherit;">してすべての</font><b><font style="vertical-align: inherit;">ログ</font></b><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">表示し</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、Slackアプリケーションをインストールしてテストします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slackアプリのインストールとテスト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のステップを完了して、Slackアプリケーションをワークスペースにインストールしましょう。これを行うには、Slackアプリコンソールに戻り</font><font style="vertical-align: inherit;">、サイドナビゲーションバーの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[アプリのインストール</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><b><font style="vertical-align: inherit;">を</font></b><font style="vertical-align: inherit;">クリックし</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/76e/212/b74/76e212b74709411272256b422a77f653.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このページでは、アプリケーションをインストールするための機能または権限のある領域の追加に関する警告が表示されます。それをクリックして、権限を追加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションが正常にインストールされたら、機能とアプリケーションをテストできます。 8base </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページ</font><font style="vertical-align: inherit;">に移動し、サイドバーのOrdersテーブルをクリックします。注文テーブルビューアで、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブをクリックします</font><font style="vertical-align: inherit;">。ここで、テーブルに新しい行を追加できます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7c0/fab/84c/7c0fab84c009f1f3620ab57e41086a55.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データテーブルで、{+}ボタンを押して新しい行を作成します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b1a/015/2bf/b1a0152bf7dad2951b3ef2d1e0a07310.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
製品フィールドに次のデータを入力できます。</font></font><br>
<br>
<pre><code class="javascript hljs">[{
   <span class="hljs-string">"name"</span>: <span class="hljs-string">"Food product"</span>,
   <span class="hljs-string">"image"</span>: <span class="hljs-string">"https://static.pexels.com/photos/368893/pexels-photo-368893.jpeg"</span>,
   <span class="hljs-string">"price"</span>: <span class="hljs-number">4</span><font></font>
}, {<font></font>
   <span class="hljs-string">"name"</span>: <span class="hljs-string">"The real fruit"</span>,
   <span class="hljs-string">"image"</span>: <span class="hljs-string">"https://static.pexels.com/photos/368893/pexels-photo-368883.jpeg"</span>,
   <span class="hljs-string">"price"</span>: <span class="hljs-number">20</span>
}]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">追加]を</font></b><font style="vertical-align: inherit;">クリック</font><font style="vertical-align: inherit;">して、新しい注文を作成します。</font><font style="vertical-align: inherit;">次に、Slackアプリをインストールしたワークショップに移動し、＃generalチャネルをクリックすると、ボットから新しいメッセージが表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようになります</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/739/025/ef1/739025ef157a8879e5a1aa63595036de.png" alt="画像"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 。Slackチャネルの8baseボットからの新しい通知</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後の言葉</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Slackアプリケーションを作成することをお勧めします。</font><font style="vertical-align: inherit;">Slackは、ほとんどのチームにとって主要なコミュニケーション手段であり、日常業務に必要なすべての情報を入手できるようにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、8base機能を使用して、システム内の新しい注文に関するメッセージを送信するシンプルなSlackアプリケーションを作成しました。</font><font style="vertical-align: inherit;">送信されたメッセージはかなり単純でした。</font><font style="vertical-align: inherit;">Slackの</font><font style="vertical-align: inherit;">メッセージに</font><font style="vertical-align: inherit;">は豊富な</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォーマット</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり、メッセージを複雑にしてより多くの情報を含めることができます。</font><font style="vertical-align: inherit;">8base機能の詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でこの記事のコードを参照してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読んでくれてありがとう。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja466315/index.html">@Pythonetcコンパイル、2019年8月</a></li>
<li><a href="../ja466319/index.html">ディール：VMwareがクラウドベースのスタートアップを買収</a></li>
<li><a href="../ja466323/index.html">Cortex M0 +マイクロコントローラーでポータブルプラットフォームゲームを作成します</a></li>
<li><a href="../ja466329/index.html">ロシアのワイン造りの電子地図。デザインとコンテンツ</a></li>
<li><a href="../ja466333/index.html">自分で職場を整える方法</a></li>
<li><a href="../ja466337/index.html">あなたの機能は何色ですか？</a></li>
<li><a href="../ja466339/index.html">Microsoft SQL ServerでRを使用してGoogleアナリティクスからデータを取得する方法</a></li>
<li><a href="../ja466341/index.html">Cisco 200-125 CCNA v3.0のトレーニング。33日目。ICND1試験の準備</a></li>
<li><a href="../ja466345/index.html">配色を構築するウェーブ法</a></li>
<li><a href="../ja466347/index.html">Cisco 200-125 CCNA v3.0のトレーニング。34日目。高度なVLANの概念</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>