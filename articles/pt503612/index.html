<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏴󠁧󠁢󠁥󠁮󠁧󠁿 😦 🤽🏼 Melhores práticas do Kubernetes. Mapeando Serviços Externos 💃🏼 🔰 👆🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Melhores práticas do Kubernetes. Criando 
 práticas recomendadas para Kubernetes de contêineres pequenos. Organização Kubernetes com o namespace Kuber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Melhores práticas do Kubernetes. Mapeando Serviços Externos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503612/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhores práticas do Kubernetes. Criando </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">práticas recomendadas para Kubernetes de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">contêineres </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">pequenos. Organização Kubernetes com o namespace Kubernetes </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Best Practices. Teste de viabilidade Kubernetes com testes de prontidão e vida </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Práticas recomendadas de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Kubernetes </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">. Definindo consultas e limites de </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recursos Melhores práticas do Kubernetes. Desconexão correta de Terminar</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se você é como a maioria das pessoas, provavelmente usa recursos que operam fora do seu cluster. Você pode estar usando a API do Taleo para enviar mensagens de texto ou analisar imagens usando a API do Google Cloud Vision.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você usar o mesmo terminal - o ponto de recebimento de solicitações do servidor em todos os seus ambientes e não planeja transferir seus servidores para o Kubernetes, é perfeitamente normal ter um serviço de terminal diretamente no seu código. No entanto, existem muitos outros cenários. Nesta série de práticas recomendadas do Kubernetes, você aprenderá como usar os mecanismos internos do Kubernetes para descobrir serviços dentro e fora do cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo de serviço externo generalizado é um banco de dados executado fora de um cluster Kubernetes. Ao contrário dos bancos de dados em nuvem, como o Google Cloud Data Store ou o Google Cloud Spanner, que usam um ponto de extremidade para todos os tipos de acesso, a maioria dos bancos de dados possui pontos de extremidade separados para diferentes circunstâncias.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As práticas recomendadas para o uso de bancos de dados tradicionais, como MySQL e MongoDB, geralmente exigem que você se conecte a diferentes componentes para diferentes ambientes. Você pode ter uma máquina grande para dados de produção e uma máquina menor para um ambiente de teste. Cada um deles terá seu próprio endereço IP ou nome de domínio, mas você provavelmente não desejará alterar seu código ao passar de um ambiente para outro. Portanto, em vez de codificar esses endereços, você pode usar o serviço interno do Kubernetes para descobrir serviços externos baseados em DNS da mesma maneira que para os serviços nativos do Kubernetes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qg/lz/vj/qglzvjg0ysvnlejo7v6pvtqc1se.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que você execute o banco de dados MongoDB no Google Compute Engine. Você ficará preso nesse mundo híbrido até conseguir transferi-lo para um cluster.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente, você pode usar os serviços estáticos do Kubernetes para facilitar sua vida. Neste exemplo, criei um servidor MongoDB usando o Google Cloud Launcher. Como foi criado na mesma rede (ou cluster Kubernetes VPC), é acessado usando um endereço IP interno de alto desempenho. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/ou/z8/r3ouz8pak0n-al5obbd6y81qkke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta é a configuração padrão no Google Cloud, portanto você não precisa configurar nada. Agora que você tem um endereço IP, o primeiro passo é criar um serviço. Você pode perceber que não há seletores de lareira para este serviço. Ou seja, criamos um serviço que não saberá para onde enviar tráfego. Isso permitirá que você crie manualmente um objeto de terminal, que receberá tráfego desse serviço.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jo/tc/sr/jotcsra7vszs8kmlivxwl_awqsq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O exemplo de código a seguir mostra que os terminais determinam o endereço IP do banco de dados usando o mesmo nome de mongo que o serviço. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/y9/dz/cb/y9dzcbounajojfgkqd-7osjcxka.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes usará todos os endereços IP para encontrar os pontos de extremidade como se fossem pods regulares do Kubernetes; portanto, agora você pode acessar o banco de dados usando uma cadeia de conexão simples com o nome acima mongodb: // mongo. No entanto, não há necessidade de usar endereços IP no seu código. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se os endereços IP mudarem no futuro, você pode simplesmente atualizar os pontos de extremidade com o novo endereço IP e seus aplicativos não precisarão ser alterados de nenhuma maneira adicional.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você estiver usando um banco de dados hospedado em um host de terceiros, provavelmente os proprietários do host forneceram um URI de identificador de recurso unificado para conexão. Portanto, se você recebeu um endereço IP, pode simplesmente usar o método anterior. Este exemplo mostra que eu tenho dois bancos de dados MongoDB hospedados no host mLab. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/er/w9/bderw9_a42oa_nap45ol_au_jla.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um deles é um banco de dados de desenvolvedores e o outro é um banco de dados de produção. As cadeias de conexão para esses bancos de dados são as seguintes - o mLab fornece um URI dinâmico e uma porta dinâmica. Como você pode ver, eles são diferentes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fu/t9/v5/fut9v5yv1qtskdkx8tju2rmkmnq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ignorar isso, usamos o Kubernetes e nos conectamos ao banco de dados dos desenvolvedores. Você pode criar um nome de serviço Kubernetes externo, que fornecerá um serviço estático que redirecionará o tráfego para o serviço externo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jo/63/u6/jo63u6uv1quvocf8fxh1bnv_6om.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este serviço executará um redirecionamento CNAME simples no nível do kernel, que terá um impacto mínimo no desempenho. Graças a isso, você pode usar uma cadeia de conexão mais simples. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/es/ip/jm/esipjmsa8t8nagtrwu4slv55isa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas como o nome externo usa o redirecionamento CNAME, ele não pode executar o encaminhamento de porta. Portanto, esta solução é aplicável apenas a portas estáticas e não pode ser usada com portas dinâmicas. Mas o nível gratuito do mLab gratuito, por padrão, fornece ao usuário um número de porta dinâmico e você não pode alterar isso. Isso significa que para dev e prod você precisa de diferentes linhas de comando de conexão. A má notícia é que você precisará codificar o número da porta. Então, como você faz o encaminhamento de porta funcionar?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro passo é obter o endereço IP do URI. Se você executar o comando nslookup, hostname ou efetuar ping no URI, poderá obter o endereço IP do banco de dados. Se, ao mesmo tempo, o serviço retornar vários endereços IP para você, todos esses endereços poderão ser usados ​​nos pontos de extremidade do objeto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ox/ki/ox/oxkioxus5e4idcigbaufhqfyquk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se de que os IPs de URI podem mudar sem aviso prévio, por isso é bastante arriscado usá-los no prod. Usando esse endereço IP, você pode conectar-se a um banco de dados remoto sem especificar uma porta. Assim, o serviço Kubernetes executa o encaminhamento de porta de forma bastante transparente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/iu/eo/rsiueor-lvslhr5vscjlowggkho.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mapeamento, ou mapeamento de recursos externos para internos, oferece a capacidade de usar esses serviços com flexibilidade no cluster no futuro, minimizando os esforços de refatoração. </font><font style="vertical-align: inherit;">Também facilita o gerenciamento e fornece informações sobre os serviços externos que sua empresa usa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para continuar em breve ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/fvpq4jqtuZ8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Você gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS na nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analógico exclusivo de servidores de nível básico que foi inventado por nós para você: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 núcleos) 10 GB DDR4 480 GB SSD 1 Gbps de US $ 19 ou como dividir o servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (as opções estão disponíveis com RAID1 e RAID10, até 24 núcleos e até 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterdã?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente nós temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como criar um prédio de infraestrutura. </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt503600/index.html">STM32MP1: Inicialização em U, Buildroot, Arch Linux e um pouco de Debian</a></li>
<li><a href="../pt503604/index.html">Sergey e "programar é melhor que sexo"</a></li>
<li><a href="../pt503606/index.html">Swift 5.3: O que há de novo?</a></li>
<li><a href="../pt503608/index.html">Como pesquisamos filtros de vírus</a></li>
<li><a href="../pt503610/index.html">Por que não criar seu próprio Lisp para a web?</a></li>
<li><a href="../pt503616/index.html">Como criamos um protótipo de comerciante robô e o que vem a seguir</a></li>
<li><a href="../pt503620/index.html">Notícias do mundo do OpenStreetMap No. 512 (05.05.2020-11.05.2020)</a></li>
<li><a href="../pt503624/index.html">O resumo de materiais frescos do mundo do front-end da última semana n ° 416 (18-24 de maio de 2020)</a></li>
<li><a href="../pt503626/index.html">Teste. Erros de certificação ISTQB ou resolva um milhão de exemplos</a></li>
<li><a href="../pt503630/index.html">Óculos de realidade aumentada: onde estamos agora?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>