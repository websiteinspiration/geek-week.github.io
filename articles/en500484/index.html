<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçã üëµüèø üë©üèº‚Äçü§ù‚Äçüë®üèø Web Components Instead of React - Another Attempt üë≤ üêÄ üçî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! 
 
 I recently decided to figure out what a client-side web application written entirely on vanilla web components should look like witho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Web Components Instead of React - Another Attempt</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500484/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I recently decided to figure out what a client-side web application written entirely on vanilla web components should look like without using frameworks. </font><font style="vertical-align: inherit;">It turned out to be quite a working thing, in the end I sketched </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the mobile PWA template</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which I now use in prototypes. </font><font style="vertical-align: inherit;">Proceeding from the following premises:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOM is a state. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since we do not have a framework, we immediately forget about functionalism and return to the imperative OOP. </font><font style="vertical-align: inherit;">Web components are long-lived DOM nodes that encapsulate their state and have a public API. </font><font style="vertical-align: inherit;">They are not recreated, but changed. </font><font style="vertical-align: inherit;">This means that we should consider the DOM not only as a representation, but as a repository of business objects, and therefore we need to build a hierarchy of components taking into account the convenience of their interaction.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The interaction of the components. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Components can interact through direct calls, callback exchanges, or through up / down user DOM events. </font><font style="vertical-align: inherit;">The latter method is most preferable, as it reduces the mutual engagement (coupling), and orders the graph of bonds (see example below).</font></font><a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DOM events work only within the hierarchy - they can pop up from the bottom up the chain of ancestors, or broadcast down to all descendants. </font><font style="vertical-align: inherit;">In other cases, the standard browser API is used to address the component: document.querySelector ('page-home'), and some components can register themselves in the window and used globally: APP.route ('page-login').</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inner styles. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shadow DOM is not used, therefore components inherit global styles, but can also have their own. </font><font style="vertical-align: inherit;">Since &lt;style scoped&gt; is unlikely to be implemented in the near future, you have to use the component name prefix to declare the internal style, however this is laconic and works fine (see the example below).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interaction with HTML / DOM.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Since the DOM is a state, the data source is the values ‚Äã‚Äãof the HTML elements themselves (value, checked, innerHTML for contenteditable = ‚Äútrue‚Äù, etc.). Additional JS variables are not needed, and for convenience of accessing the form values ‚Äã‚Äã- we just create getters / setters and add them to the ancestor object (for which a small library is needed). Addressing form values ‚Äã‚Äãis now no different from addressing class variables, for example, this.pass is the password value entered in the &lt;input&gt; child of the current component. Thus, neither a virtual DOM nor a two-way binding is needed, redrawing forms when they are reopened is also not necessary, and the data entered into the form is saved during navigation, unless you specifically purge them.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navigation. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The page components live inside the &lt;main&gt; container, and once created, they are not deleted, but simply hidden. </font><font style="vertical-align: inherit;">This allows you to implement navigation using location.hash, and the standard browser buttons back and forth work correctly. </font><font style="vertical-align: inherit;">When navigating to an existing component, the onRoute () method is called, where you can update the data.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application structure</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our application consists of:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the root component &lt;app-app&gt;, accessible via window.APP, containing a page router and global functionality;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panels with contextual buttons (I didn‚Äôt put them into a separate component, but made them part of the &lt;app-app&gt; layout to simplify event handling);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drop-down menu (separate component);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the &lt;main&gt; container into which the page components will be added: &lt;page-home&gt;, &lt;page-login&gt;, &lt;page-work&gt; as they open.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pages are stacked with back and forth navigation. </font><font style="vertical-align: inherit;">In addition, we demonstrate bottom-up and top-down data flows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The authorization status and current username is stored in the &lt;app-app&gt; component, but comes from the &lt;page-login&gt; component through a pop-up event.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A timer ticks in the &lt;app-app&gt; component, which sends the current value down through a broadcast event that is caught only in the descendant of &lt;page-work&gt;.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Through pop-up events, the installation of context-sensitive buttons on the application panel is also implemented - the buttons themselves, together with the handlers, are created in the page components, then sent to the top, where they are intercepted at the app level and inserted into the panel.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To work with the internal DOM of the component, and send downstream events, the tiny </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WcMixin.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library is </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">used</font></a><font style="vertical-align: inherit;"> - less than 200 lines of code, half of which (unification of user input events) can also be thrown out. </font><font style="vertical-align: inherit;">Everything else is pure vanilla. </font><font style="vertical-align: inherit;">A typical component (authorization page) looks like this:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> wcmixin <span class="hljs-keyword">from</span> <span class="hljs-string">'./WcMixin.js'</span><font></font>
<font></font>
<span class="hljs-keyword">const</span> me = <span class="hljs-string">'page-login'</span>
customElements.define(me, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{<font></font>
   _but = <span class="hljs-literal">null</span><font></font>
<font></font>
   connectedCallback() {<font></font>
      <span class="hljs-keyword">this</span>.innerHTML = <span class="hljs-string">`
         &lt;style scoped&gt;
            <span class="hljs-subst">${me}</span> {
               height: 90%; width: 100%;
               display: flex; flex-direction: column;
               justify-content: center; align-items: center;
            }
            <span class="hljs-subst">${me}</span> input { width: 60%; }
         &lt;/style&gt;
         &lt;input w-id='userInp/user' placeholder='user'/&gt;&nbsp;
         &lt;input w-id='passInp/pass' type='password' placeholder='password'/&gt;
      `</span>
      wcmixin(<span class="hljs-keyword">this</span>)<font></font>
<font></font>
      <span class="hljs-keyword">this</span>.userInp.oninput = <span class="hljs-function">(<span class="hljs-params">ev</span>) =&gt;</span> {
         <span class="hljs-keyword">this</span>.bubbleEvent(<span class="hljs-string">'login-change'</span>, {<span class="hljs-attr">logged</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">user</span>: <span class="hljs-keyword">this</span>.user})<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">this</span>.passInp.onkeypress = <span class="hljs-function">(<span class="hljs-params">ev</span>) =&gt;</span> {
         <span class="hljs-keyword">if</span> (ev.key === <span class="hljs-string">'Enter'</span>) <span class="hljs-keyword">this</span>.login()<font></font>
      }<font></font>
   }<font></font>
<font></font>
   onRoute() {<font></font>
      <span class="hljs-keyword">this</span>.userInp.focus()
      <span class="hljs-keyword">this</span>._but = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'button'</span>)
      <span class="hljs-keyword">this</span>._but.innerHTML = <span class="hljs-string">'Log in&lt;br&gt;‚áí'</span>
      <span class="hljs-keyword">this</span>._but.onclick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.login()
      <span class="hljs-keyword">this</span>.bubbleEvent(<span class="hljs-string">'set-buts'</span>, { <span class="hljs-attr">custom</span>: [<span class="hljs-keyword">this</span>._but] })<font></font>
   }<font></font>
<font></font>
   <span class="hljs-keyword">async</span> login() {<font></font>
      APP.msg = <span class="hljs-string">'Authorization...'</span>
      <span class="hljs-keyword">this</span>._but.disabled = <span class="hljs-literal">true</span>
      setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
         <span class="hljs-keyword">this</span>._but.disabled = <span class="hljs-literal">false</span>
         <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.user) {
            <span class="hljs-keyword">this</span>.bubbleEvent(<span class="hljs-string">'login-change'</span>, {<span class="hljs-attr">logged</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">user</span>: <span class="hljs-keyword">this</span>.user})<font></font>
            APP.route(<span class="hljs-string">'page-work'</span>)<font></font>
         } <span class="hljs-keyword">else</span> {<font></font>
            APP.msg = <span class="hljs-string">'Empty user !'</span>
            <span class="hljs-keyword">this</span>.userInp.focus()<font></font>
         }<font></font>
      }, <span class="hljs-number">1500</span>)<font></font>
   }<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, here we see the local styles of the component. Secondly, the only non-standard attribute w-id = `` userInp / user '' has been added to the HTML markup. The wcmixin () function processes all the elements marked with this attribute and adds variables to the current component: this.userInp refers to the &lt;input&gt; element itself (which allows you to hang the handler), and this.user is the value of the element (username). If access to the element is not needed, you can specify w-id = `` / user '', and only the value will be created. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When entering a username, we send the current value up through a pop-up event, create a context-sensitive button in the onRoute () method, and also send it up.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is important that the authorization component does not know anything about the higher components of the application / panel, that is, it is not hooked. </font><font style="vertical-align: inherit;">He simply sends events upstairs, and whoever intercepts them is up to the developer. </font><font style="vertical-align: inherit;">The reception of events from the &lt;app-app&gt; application in the &lt;page-work&gt; component is implemented in the same way:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> wcmixin <span class="hljs-keyword">from</span> <span class="hljs-string">'./WcMixin.js'</span><font></font>
<font></font>
<span class="hljs-keyword">const</span> me = <span class="hljs-string">'page-work'</span>
customElements.define(me, <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{<font></font>
<font></font>
   connectedCallback() {<font></font>
      <span class="hljs-keyword">this</span>.innerHTML = <span class="hljs-string">`
         &lt;p w-id='/msg'&gt;Enter text:&lt;/p&gt;
         &lt;p w-id='textDiv/text' contenteditable='true'&gt;1)&lt;br&gt;2)&lt;br&gt;3)&lt;/p&gt;
      `</span>
      wcmixin(<span class="hljs-keyword">this</span>)<font></font>
<font></font>
      <span class="hljs-keyword">this</span>.addEventListener(<span class="hljs-string">'notify-timer'</span>, (ev) =&gt; {
         <span class="hljs-keyword">this</span>.msg = <span class="hljs-string">`Enter text (elapsed <span class="hljs-subst">${ev.val}</span>s):`</span><font></font>
      })<font></font>
   }<font></font>
<font></font>
   <span class="hljs-keyword">async</span> onRoute() {
      <span class="hljs-keyword">this</span>.textDiv.focus()
      <span class="hljs-built_in">document</span>.execCommand(<span class="hljs-string">'selectAll'</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>)
      <span class="hljs-keyword">const</span> but = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'button'</span>)<font></font>
      but.innerHTML = <span class="hljs-string">'Done&lt;br&gt;‚áí'</span>
      but.onclick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> alert(<span class="hljs-keyword">this</span>.text)
      <span class="hljs-keyword">this</span>.bubbleEvent(<span class="hljs-string">'set-buts'</span>, { <span class="hljs-attr">custom</span>: [but] })<font></font>
   }<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And in the &lt;app-app&gt; component we write:</font></font><br>
<br>
<pre><code class="javascript hljs">setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
   <span class="hljs-keyword">this</span>._elapsed += <span class="hljs-number">1</span>
   <span class="hljs-keyword">this</span>.drownEvent(<span class="hljs-string">'notify-timer'</span>, <span class="hljs-keyword">this</span>._elapsed)<font></font>
}, <span class="hljs-number">1000</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The &lt;app-app&gt; component also does not know anything about page components that want to use its counter, that is, it is not hooked on its descendants. </font><font style="vertical-align: inherit;">It is enough for the developer to agree on the event signatures. </font><font style="vertical-align: inherit;">DOM events are lightweight, descending events are sent only to web components (and not simple elements), and ascending events pass through the entire chain of ancestors as standard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actually, that‚Äôs all I wanted to say. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Full project code</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objections and suggestions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is often objected to me that such an approach mixes business logic and display in one ‚Äúthick‚Äù component, which violates generally accepted patterns. However, we are only talking about the logic for displaying and validating user input, the rest of the business logic can be easily moved to separate JS classes or even services - with its own hierarchy and interaction methods. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why is this necessary. There is still a rendering performance problem (garbage collection is not free), and an imperative approach using native tools will always be faster and less demanding on resources than declarative / functional using JS libraries and VDOM. If you want, I‚Äôm ready to compete with a representative of any framework, on an agreed TOR, if you take on the benchmarking function (I can do this poorly).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you for the attention.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500468/index.html">Java Features Guide 8-14</a></li>
<li><a href="../en500470/index.html">Adapting your existing business solution for SwiftUI. Part 3. Working with architecture</a></li>
<li><a href="../en500472/index.html">Python is time to make room. About the prospects of Julia</a></li>
<li><a href="../en500476/index.html">Uncertainty</a></li>
<li><a href="../en500478/index.html">Tetris on the sleeve: gas-permeable material for wearable electronics</a></li>
<li><a href="../en500486/index.html">How to explain binary notation</a></li>
<li><a href="../en500488/index.html">Dispersion and the method of dynamic light scattering: a big step in medicine and forensics</a></li>
<li><a href="../en500492/index.html">Adapting your existing business solution for SwiftUI. Part 4. Navigation and configuration</a></li>
<li><a href="../en500494/index.html">Spell Checking Online VS Privacy</a></li>
<li><a href="../en500498/index.html">Create a Python Flask service with up-to-date COVID-19 data from Wikipedia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>