<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏿 👋🏿 👨🏻‍🚒 Thanos - Prométhée évolutif 📼 👩🏿‍💻 🎙️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La traduction de l'article a été préparée spécialement pour les étudiants du cours "DevOps Practices and Tools" .
 
 
 
  (Fabian Reinartz) — , Go . P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Thanos - Prométhée évolutif</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/502122/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La traduction de l'article a été préparée spécialement pour les étudiants du cours </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"DevOps Practices and Tools"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/hn/yb/6z/hnyb6zs1kjgdaigpvcdypntr4yo.png"><br>
<hr><br>
<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  (Fabian Reinartz)</a> —   ,  Go     .    Prometheus   Kubernetes SIG instrumentation.     production-  SoundCloud      CoreOS.      Google.<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  (Bartek Plotka)</a> —    Improbable.       .      Intel,    Mesos  production- SRE    Improbable.    .   : Golang, open source  .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En regardant notre produit phare SpatialOS, vous pouvez deviner qu'Improbable a besoin d'une infrastructure cloud mondiale hautement dynamique avec des dizaines de clusters Kubernetes. Nous avons été l'un des premiers à utiliser le système de surveillance </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Prometheus est capable de suivre des millions de métriques en temps réel et est livré avec un langage de requête puissant pour récupérer les informations nécessaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplicité et fiabilité Prometheus est l'un de ses principaux avantages. Cependant, ayant dépassé une certaine échelle, nous avons rencontré plusieurs inconvénients. Pour résoudre ces problèmes, nous avons développé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Un projet open source créé par Improbable pour transformer en toute transparence les clusters Prometheus existants en un système de surveillance unique avec un référentiel illimité de données historiques. </font><font style="vertical-align: inherit;">Thanos est disponible sur github </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restez à jour avec les dernières nouvelles d'Improbable.</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nos objectifs avec Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À une certaine échelle, des problèmes surgissent qui dépassent les capacités du vanille Prométhée. </font><font style="vertical-align: inherit;">Comment stocker de manière fiable et économique des pétaoctets de données historiques? </font><font style="vertical-align: inherit;">Peut-on le faire sans préjudice du délai de réponse à la demande? </font><font style="vertical-align: inherit;">Est-il possible d'accéder à toutes les métriques situées sur différents serveurs Prometheus avec une seule demande d'API? </font><font style="vertical-align: inherit;">Est-il possible de combiner en quelque sorte les données répliquées collectées à l'aide de Prometheus HA? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour résoudre ces problèmes, nous avons créé Thanos. </font><font style="vertical-align: inherit;">Les sections suivantes décrivent comment nous avons abordé ces questions et expliqué les objectifs que nous avons poursuivis.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interrogation de données à partir de plusieurs instances de Prométhée (requête globale)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus propose une approche fonctionnelle du sharding. Un seul serveur Prometheus offre une évolutivité suffisante pour libérer les utilisateurs des difficultés de partage horizontal dans presque tous les cas d'utilisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien qu'il s'agisse d'un excellent modèle de déploiement, il est souvent nécessaire d'accéder aux données sur différents serveurs Prometheus via une seule API ou UI - vue globale. Bien sûr, il est possible d'afficher plusieurs requêtes dans un panneau Grafana, mais chaque requête ne peut être exécutée que sur un serveur Prometheus. Avec Thanos, d'autre part, vous pouvez interroger et agréger les données de plusieurs serveurs Prometheus, car ils sont tous accessibles à partir d'un point de terminaison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auparavant, pour obtenir une vue globale d'Improbable, nous avons organisé nos instances Prometheus en plusieurs niveaux</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fédération hiérarchique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cela signifiait créer un méta-serveur Prometheus qui collecte une partie des métriques de chaque serveur feuille, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pv/0j/w3/pv0jw3yhsdl31rqexmamjdx4tiy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ce qui s'est avéré problématique, compliquant la configuration, ajoutant un point de défaillance potentiel supplémentaire et appliquant des règles complexes pour fournir au point de terminaison fédéré les bonnes données. De plus, une telle fédération ne vous permet pas d'obtenir une véritable vue globale, car toutes les données ne sont pas accessibles à partir d'une seule demande d'API.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La présentation unique des données collectées sur les serveurs haute disponibilité (HA) de Prometheus est étroitement liée à cela. Le modèle Prometheus HA collecte indépendamment les données deux fois, ce qui est si simple qu'il ne pourrait pas être plus simple. Cependant, l'utilisation d'une représentation combinée et dédupliquée des deux threads serait beaucoup plus pratique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, il existe un besoin de serveurs Prometheus hautement disponibles. Chez Improbable, nous tenons vraiment à surveiller les données chaque minute, mais avoir une instance de Prometheus par cluster est un point de défaillance unique. Toute erreur de configuration ou défaillance matérielle peut potentiellement entraîner la perte de données importantes. Même les déploiements simples peuvent entraîner des problèmes mineurs dans la collecte des mesures, car le redémarrage peut être considérablement plus long que l'intervalle de raclage.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stockage fiable des données historiques</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le stockage de métriques bon marché, rapide et à long terme est notre rêve (partagé par la plupart des utilisateurs de Prometheus). </font><font style="vertical-align: inherit;">Dans Improbable, nous avons été obligés de définir la période de stockage des métriques sur neuf jours (pour Prometheus 1.8). </font><font style="vertical-align: inherit;">Cela ajoute des limites évidentes à jusqu'où nous pouvons regarder en arrière. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus 2.0 est meilleur à cet égard, car le nombre de séries chronologiques n'affecte plus les performances globales du serveur (voir le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discours KubeCon sur Prometheus 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Cependant, Prometheus stocke les données sur un disque local. </font><font style="vertical-align: inherit;">Bien que la compression de données très efficace puisse réduire considérablement l'utilisation d'un SSD local, il existe toujours une limitation de la quantité de données historiques enregistrées.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chez Improbable, nous nous soucions également de la fiabilité, de la simplicité et du coût. </font><font style="vertical-align: inherit;">Les gros disques locaux sont plus difficiles à utiliser et à sauvegarder. </font><font style="vertical-align: inherit;">Ils sont plus chers et nécessitent davantage d'outils de sauvegarde, ce qui entraîne une complexité inutile.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous-échantillonnage</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dès que nous avons commencé à travailler avec des données historiques, nous avons réalisé qu'il existe des difficultés fondamentales avec O-big qui rendent les requêtes de plus en plus lentes si nous travaillons avec des données pendant des semaines, des mois et des années. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une solution standard à ce problème sera le sous- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">échantillonnage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sous-échantillonnage du signal. </font><font style="vertical-align: inherit;">Par sous-échantillonnage, nous pouvons «réduire» à une plus grande plage de temps et maintenir le même nombre d'échantillons, ce qui nous permet de maintenir la réactivité des demandes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sous-échantillonnage des anciennes données est une exigence inévitable de toute solution de stockage à long terme et va au-delà de Prometheus vanille.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objectifs supplémentaires</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des objectifs initiaux du projet Thanos était de s'intégrer de manière transparente à toutes les installations Prometheus existantes. </font><font style="vertical-align: inherit;">Le deuxième objectif était une opération simple avec une barrière d'entrée minimale. </font><font style="vertical-align: inherit;">Toutes les dépendances doivent être facilement satisfaites pour les petits et les grands utilisateurs, ce qui implique également un faible coût de base.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture de Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois nos objectifs répertoriés dans la section précédente, travaillons dessus et voyons comment Thanos résout ces problèmes.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vue globale</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour obtenir une vue globale sur les instances existantes de Prometheus, nous devons associer un point d'entrée de demande unique à tous les serveurs. C'est exactement ce que fait le composant Thanos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sidecar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il est déployé à côté de chaque serveur Prometheus et agit comme un proxy, servant les données Prometheus locales via l'interface gRPC du magasin, vous permettant de sélectionner des données de séries chronologiques par étiquette et plage de temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'un autre côté, il existe un composant Querier sans état évolutif horizontalement qui fait un peu plus que simplement répondre aux requêtes PromQL via l'API HTTP Prometheus standard. Les composants Querier, Sidecar et autres Thanos communiquent via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le protocole Gossip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1p/zn/ts/1pzntsrxrwhxxvdou57tpxhypwm.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querier, à la réception de la demande, se connecte au serveur API Store correspondant, c'est-à-dire à notre Sidecar, et reçoit les données de séries chronologiques des serveurs Prometheus correspondants.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après cela, il combine les réponses et effectue une requête PromQL sur celles-ci. </font><font style="vertical-align: inherit;">Querier peut combiner des données disjointes et des données en double provenant des serveurs Prometheus HA.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela résout l'essentiel de notre casse-tête: combiner les données de serveurs Prometheus isolés en une seule vue. </font><font style="vertical-align: inherit;">En fait, Thanos ne peut être utilisé que pour cette opportunité. </font><font style="vertical-align: inherit;">Les serveurs Prometheus existants ne nécessitent aucune modification!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durée de conservation illimitée!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, tôt ou tard, nous voudrons enregistrer des données qui dépassent la durée de stockage normale de Prometheus. Pour stocker des données historiques, nous avons choisi le stockage d'objets. Il est largement disponible dans n'importe quel cloud, ainsi que dans les centres de données locaux et est très économique. De plus, presque n'importe quel stockage d'objets est accessible via l'API S3 bien connue. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus écrit des données de la RAM sur le disque toutes les deux heures environ. Le bloc de données stockées contient toutes les données pour une période de temps fixe et est immuable. C'est très pratique, car Thanos Sidecar peut simplement consulter le catalogue de données Prometheus et, à mesure que de nouveaux blocs apparaissent, les charger dans les compartiments de stockage d'objets.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ss/l6/lh/ssl6lhmk5kyfwe0luqcsbpe8z9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le téléchargement sur le stockage de l'objet immédiatement après l'écriture sur un disque vous permet également de garder simple la simplicité d'un «grattoir» (Prométhée et Thanos Sidecar). Ce qui simplifie le support, le coût et la conception du système. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, la sauvegarde des données est très simple. Mais qu'en est-il de la requête de données dans le stockage d'objets? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le composant Thanos Store agit comme un proxy pour récupérer les données du stockage d'objets. Comme Thanos Sidecar, il participe au cluster de potins et implémente l'API Store. Ainsi, Querier existant peut le considérer comme Sidecar, comme une autre source de données de séries chronologiques - aucune configuration spéciale n'est requise.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/n_/pl/vqn_pl2z-oq1-m1yiix-y-tgvwc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les blocs de données de séries chronologiques sont constitués de plusieurs fichiers volumineux. Les télécharger à la demande serait assez inefficace et la mise en cache locale nécessitait une mémoire et un espace disque énormes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de cela, Store Gateway sait comment gérer le format de stockage Prometheus. Grâce au planificateur de requêtes intelligent et à la mise en cache uniquement des parties d'index nécessaires des blocs, il est devenu possible de réduire les requêtes complexes au nombre minimal de requêtes HTTP pour les fichiers de stockage d'objets. Ainsi, il est possible de réduire le nombre de demandes de quatre à six ordres de grandeur et d'obtenir des temps de réponse généralement difficiles à distinguer des demandes de données sur un SSD local.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/c-/hv/qxc-hvkg1llfi9oaoee6uxtla9c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le montre le diagramme ci-dessus, Thanos Querier réduit considérablement le coût d'une seule demande de données dans le stockage d'objets en utilisant le format de stockage Prometheus et en plaçant les données associées côte à côte. </font><font style="vertical-align: inherit;">En utilisant cette approche, nous pouvons combiner de nombreuses requêtes uniques en un nombre minimum d'opérations en bloc.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compactage et sous-échantillonnage</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que le nouveau bloc de données de série chronologique a été chargé avec succès dans le stockage d'objets, nous le considérons comme des données «historiques» qui deviennent immédiatement disponibles via Store Gateway. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, après un certain temps, les blocs d'une seule source (Prométhée avec Sidecar) s'accumulent et n'utilisent plus le plein potentiel d'indexation. Pour résoudre ce problème, nous avons introduit un autre composant appelé Compacteur. Il applique simplement le mécanisme de compactage Prometheus local aux données historiques dans le magasin d'objets et peut être exécuté comme un travail par lots périodique simple.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/wt/sy/lpwtsym1qftrslmkks3fre9q2o8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grâce à une compression efficace, une requête dans le référentiel pendant une longue période ne présente pas de problèmes en termes de taille des données. Cependant, le coût potentiel du déballage d'un milliard de valeurs et de leur exécution via un processeur de requêtes entraînera inévitablement une forte augmentation du temps d'exécution des requêtes. D'un autre côté, comme il y a des centaines de points de données par pixel de l'écran, il devient même impossible de visualiser les données en pleine résolution. Ainsi, le sous-échantillonnage est non seulement possible, mais n'entraînera pas une perte notable de précision.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/ju/gh/xmjughzg4svkzo0behzid9tt02s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le sous-échantillonnage des données, Compactor agrège en continu les données avec une résolution de cinq minutes et une heure. Pour chaque fragment brut codé à l'aide de la compression TSDB XOR, différents types de données agrégées sont stockées, telles que min, max ou sum pour un bloc. Cela permet à Querier de sélectionner automatiquement l'agrégat qui convient à cette requête PromQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour utiliser les données avec une précision réduite, l'utilisateur n'a besoin d'aucune configuration spéciale. Querier bascule automatiquement entre différentes résolutions et données brutes lorsque l'utilisateur effectue un zoom avant ou arrière. Si vous le souhaitez, l'utilisateur peut le contrôler directement via le paramètre «step» dans la demande.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que le coût de stockage d'un Go est faible, Thanos enregistre par défaut les données d'origine, des données avec une résolution de cinq minutes et une heure. </font><font style="vertical-align: inherit;">Il n'est pas nécessaire de supprimer les données d'origine.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Règles d'enregistrement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même avec Thanos, les règles d'enregistrement sont un élément essentiel de la pile de surveillance. </font><font style="vertical-align: inherit;">Ils réduisent la complexité, la latence et le coût des demandes. </font><font style="vertical-align: inherit;">Ils permettent également aux utilisateurs d'obtenir des données métriques agrégées. </font><font style="vertical-align: inherit;">Thanos est basé sur des instances vanille de Prometheus, il est donc parfaitement acceptable de stocker des règles d'enregistrement et des règles d'alerte sur un serveur Prometheus existant. </font><font style="vertical-align: inherit;">Cependant, dans certains cas, cela peut ne pas être suffisant:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alertes et règles globales (par exemple, alertes lorsqu'un service est en panne sur plus de deux des trois clusters).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Règle pour les données en dehors du stockage local.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le désir de garder toutes les règles et d'alerte en un seul endroit.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/wu/da/bf/wudabfepzgopbamehs1hqzx5s7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tous ces cas, Thanos comprend un composant distinct appelé Règle, qui calcule la règle et alerte via les requêtes Thanos. </font><font style="vertical-align: inherit;">En fournissant le StoreAPI bien connu, le nœud Query peut accéder à des métriques fraîchement calculées. </font><font style="vertical-align: inherit;">Plus tard, ils sont également stockés dans le stockage d'objets et mis à disposition via Store Gateway.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le pouvoir de Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanos est suffisamment flexible pour être personnalisé selon vos besoins. </font><font style="vertical-align: inherit;">Cela est particulièrement utile lors de la migration à partir d'un simple Prométhée. </font><font style="vertical-align: inherit;">Jetons un coup d'œil à ce que nous avons appris sur les composants de Thanos. </font><font style="vertical-align: inherit;">Voici comment transférer votre Prometheus vanille dans le monde du «stockage de métriques illimité»:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d-/y0/cn/d-y0cnjpddmhvlfbw-8c7fvqt7o.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez Thanos Sidecar à vos serveurs Prometheus - par exemple, le conteneur adjacent dans le module Kubernetes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Développez plusieurs répliques Thanos Querier pour afficher les données. </font><font style="vertical-align: inherit;">À ce stade, il est facile de configurer les ragots entre Scraper et Querier. </font><font style="vertical-align: inherit;">Utilisez la métrique 'thanos_cluster_members' pour tester les interactions des composants.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seules ces deux étapes sont suffisantes pour fournir une vue globale et une déduplication transparente des données à partir des réplicas potentiels de Prometheus HA! </font><font style="vertical-align: inherit;">Connectez simplement vos tableaux de bord au point de terminaison HTTP Querier ou utilisez directement l'interface utilisateur de Thanos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, si vous devez sauvegarder des métriques et un stockage à long terme, vous devrez effectuer trois étapes supplémentaires:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez un compartiment AWS S3 ou GCS. </font><font style="vertical-align: inherit;">Configurez Sidecar pour copier les données dans ces compartiments. </font><font style="vertical-align: inherit;">Vous pouvez désormais minimiser le stockage de données local.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Développez Store Gateway et connectez-le à un cluster de potins existant. </font><font style="vertical-align: inherit;">Vous pouvez maintenant envoyer des demandes de données dans des sauvegardes!</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Déployez Compactor pour améliorer les performances des requêtes sur de longues périodes en utilisant le compactage et le sous-échantillonnage.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous voulez en savoir plus, n'hésitez pas à regarder nos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemples de kubernetes manifestes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à commencer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cinq étapes seulement, nous avons transformé Prometheus en un système de surveillance fiable avec une vue globale, un temps de stockage illimité et une haute disponibilité potentielle des métriques.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tirez la demande: nous avons besoin de vous!</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> était un projet open source depuis le début. </font><font style="vertical-align: inherit;">L'intégration transparente avec Prometheus et la possibilité d'utiliser uniquement une partie de Thanos en font un excellent choix pour faire évoluer un système de surveillance sans effort supplémentaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous accueillons toujours les demandes et problèmes GitHub Pull. </font><font style="vertical-align: inherit;">Dans le même temps, n'hésitez pas à nous contacter via Github Issues ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">relâchez Improbable-fra #thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si vous avez des questions ou des commentaires, ou si vous souhaitez partager votre expérience! </font><font style="vertical-align: inherit;">Si vous aimez ce que nous faisons chez Improbable, n'hésitez pas à nous contacter - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous avons toujours des postes vacants</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur le cours.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502104/index.html">Le secrétaire robot, informateur du bot, thérapeute du bot et autres projets du hackathon en ligne VirusHack</a></li>
<li><a href="../fr502114/index.html">Jeu de motivations. Partie 1</a></li>
<li><a href="../fr502116/index.html">Présentation des fonctionnalités de PVS-Studio version 7.07</a></li>
<li><a href="../fr502118/index.html">Conception au niveau du système. Partie 3: Liaison de System Composer et de la chaîne d'outils MathWorks</a></li>
<li><a href="../fr502120/index.html">Surveillance et diagnostic à distance des équipements de production</a></li>
<li><a href="../fr502124/index.html">Résultats 2019 du capital-risque pour l'Ukraine</a></li>
<li><a href="../fr502126/index.html">Comment améliorer votre CV de programmeur anglais</a></li>
<li><a href="../fr502132/index.html">Comment transférer un conteneur OpenVZ 6 vers un serveur KVM sans maux de tête</a></li>
<li><a href="../fr502134/index.html">Assez pour avoir peur de belles décisions subjectives dans le code - vous n'êtes pas des robots</a></li>
<li><a href="../fr502136/index.html">Compression des données dans Apache Ignite. Expérience Sberbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>