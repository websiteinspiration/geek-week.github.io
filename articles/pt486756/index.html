<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👖 ㊗️ 🐟 Python para o testador: como pequenos scripts c pandas ajudam a testar grandes conjuntos de dados 👤 👩🏿‍🎓 🐠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Trabalho como testador em um projeto, cuja essência é a coleta e armazenamento de vários dados e a formação de vários relatórios e upload de arquivos ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Python para o testador: como pequenos scripts c pandas ajudam a testar grandes conjuntos de dados</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486756/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalho como testador em um projeto, cuja essência é a coleta e armazenamento de vários dados e a formação de vários relatórios e upload de arquivos com base. </font><font style="vertical-align: inherit;">Ao gerar esses relatórios, um grande número de condições para a seleção de dados é levado em consideração e, portanto, ao testar, você precisa trabalhar muito com as consultas SQL no banco de dados. </font><font style="vertical-align: inherit;">Mas, para verificar a seleção correta de dados e procurar dados em excesso / ausentes, isso muitas vezes não é suficiente, então tive que procurar ferramentas adicionais para isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu já tinha algum conhecimento básico de python, decidi tentar escrever pequenos scripts que me permitissem fazer algo com os dados existentes e, assim, facilitar e acelerar o processo de teste. </font><font style="vertical-align: inherit;">Neste artigo, vou lhe contar o que aconteceu.</font></font><br>
<a name="habracut"></a><br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projetando um Script Script</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para escrever um script, você precisa descobrir o que exatamente o script deve fazer, quais dados precisam ser inseridos e quais dados devem ser gerados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Etapas de amostra para o cenário:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtemos um arquivo com dados em um determinado formato (ou vários arquivos)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obter dados de arquivo / arquivos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecionamos os dados necessários</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realizamos algumas operações em dados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregamos dados em um arquivo do Excel, se necessário (geralmente esse formato é o mais conveniente para análises e armazenamento adicionais)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então você precisa pensar em como e onde obter informações. </font><font style="vertical-align: inherit;">Este pode ser um arquivo criado manualmente com dados, fazendo o upload de dados para uma interface do usuário em um arquivo levando em consideração os filtros, um arquivo com análise de dados usando outro script, um arquivo para fazer upload dos resultados de uma consulta SQL no banco de dados (você pode fazer upload rápido de dados para um arquivo csv no banco de dados), json -file ou xml-file com dados da resposta a uma solicitação à API, etc.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escrevemos scripts em python usando pandas e outras bibliotecas</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para escrever scripts em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> você precisa instalar um interpretador e um IDE adequado. </font><font style="vertical-align: inherit;">Também é melhor criar um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ambiente virtual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> separado </font><font style="vertical-align: inherit;">para este projeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu uso bibliotecas diferentes para scripts, algumas delas são </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bibliotecas python internas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , outras precisam ser instaladas adicionalmente:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é uma biblioteca para análise de dados. </font><font style="vertical-align: inherit;">Ele permite trabalhar com dados de arquivos de vários formatos, além de receber dados diretamente do banco de dados usando uma consulta SQL. </font><font style="vertical-align: inherit;">Os dados dos arquivos são carregados nos quadros de dados (visualmente as mesmas tabelas do Excel), com dados nos quais você já pode executar operações diferentes: combine dados de diferentes quadros de dados por analogia com junção / união no SQL, selecione os dados necessários sob certas condições, compare os dados em diferentes colunas do quadro de dados etc.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openpyxl, xlrd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - bibliotecas para trabalhar com o Excel.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A estrutura de script mais simples para trabalhar com dados de arquivos csv, json, Excel é a seguinte:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment">#       csv-     ";"</span>
df = pd.read_csv(<span class="hljs-string">'./csv_file.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-comment">#    json-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment"># df = pd.read_json('./json_file.json', encoding='utf-8')</span><font></font>
<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-comment">#    Excel-  -,     </span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment"># file_excel = 'Excel_file.xlsx'</span>
<span class="hljs-comment"># df = pd.ExcelFile(file_excel).parse('1')</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  -     -  </span>
<span class="hljs-comment">#    - final_df</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,  </span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
final_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse script, os dados de um arquivo com o formato requerido são carregados em um quadro de dados, os dados necessários são selecionados e algumas operações são executadas neles, e os dados são gravados em um novo arquivo do Excel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você precisar trabalhar com dados obtidos como resultado de uma consulta SQL para o banco de dados, não poderá exportá-los para um arquivo csv, mas inseri-los imediatamente em um quadro de dados executando uma consulta SQL no banco de dados no próprio script:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-comment">#      ,     PostgreSQL</span>
<span class="hljs-comment"># (   -    )</span>
<span class="hljs-keyword">import</span> psycopg2<font></font>
<font></font>
<span class="hljs-comment">#    </span>
conn = psycopg2.connect(dbname=<span class="hljs-string">'_'</span>, host=<span class="hljs-string">''</span>, port=<span class="hljs-string">''</span>,<font></font>
                        user=<span class="hljs-string">''</span>, password=<span class="hljs-string">''</span>)<font></font>
<font></font>
<span class="hljs-comment">#   SQL-</span>
q = <span class="hljs-string">"""select ... 
    from ... 
    where ..."""</span><font></font>
<font></font>
<span class="hljs-comment">#    -,  SQL-</span><font></font>
df = pd.read_sql_query(q, conn)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  -     -  </span>
<span class="hljs-comment">#    - final_df</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,  </span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
final_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você precisar obter dados de um arquivo xml, poderá usar as bibliotecas projetadas para isso. </font><font style="vertical-align: inherit;">Eu uso a biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interna ElementTree</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando os dados são recebidos em um quadro de dados, você pode combiná-los imediatamente com dados de outro quadro de dados (análogos de união ou união no SQL) ou executar algumas operações neles, por exemplo, remover duplicatas, remover linhas com valores vazios em determinadas células , compare dados em várias colunas, selecione as linhas / colunas desejadas etc. </font><font style="vertical-align: inherit;">Leia mais na documentação para pandas.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opções de uso de script</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora ativamos a ferramenta principal do testador e selecionamos os dados / recursos em nosso projeto, para verificação de quais scripts seriam úteis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arquivos com uma pequena quantidade de dados de teste gerados usando dados </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gerados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foram criados para os scripts </font><font style="vertical-align: inherit;">. Na realidade, os arquivos de dados contêm dezenas de milhares de linhas e um grande número de colunas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cenário # 1</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Existem três arquivos no formato csv com dados. Para cada linha de dados, há um campo com um ID de identificador exclusivo. Os dados desses arquivos são selecionados levando em consideração determinadas condições e inseridos em uma tabela no banco de dados; esses dados são exibidos em um relatório na forma de uma tabela na interface do usuário. É possível fazer upload de dados em uma interface do usuário para um arquivo do Excel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que as condições para selecionar dados para um relatório a partir dos arquivos de origem sejam as seguintes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os arquivos podem ter duplicatas por ID; em um relatório, um registro com o mesmo identificador deve ser levado em consideração apenas uma vez (nesse caso, simplesmente selecionamos qualquer uma das linhas com esse identificador nos dados).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linhas com dados ausentes na célula da coluna reg_date não devem ser contadas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, pode haver mais condições de seleção, os dados também podem ser comparados com os dados já existentes no sistema e apenas os dados de interseção por ID serão exibidos no relatório, mas, por exemplo, levaremos em conta apenas as duas condições indicadas acima.</font></font></li>
</ul><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tarefa do testador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verifique se as linhas com os objetos necessários estão corretamente selecionadas nos arquivos de origem e se todos esses objetos são exibidos no relatório na interface do usuário. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós compomos um script para o script:</font></font></u><br>
<br>
<ul>
<li>  -      csv-,     - (   union  SQL),      id,       reg_date.</li>
<li>  UI     Excel-,   ,       -.</li>
<li> (merge)   -   (   outer join  SQL)          Excel-   .</li>
<li>              ,   ,   -   ,      ,   UI.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No arquivo final, os dados conterão apenas uma coluna com id, se os nomes das colunas em diferentes quadros de dados coincidirem e não for claro quais colunas / linhas de qual arquivo foram. </font><font style="vertical-align: inherit;">Portanto, nomeio as colunas com um identificador exclusivo por nomes diferentes nos arquivos ou adiciono uma coluna separada “Linhas de um arquivo de tal e tal” a cada arquivo e coloco “Sim” nele - então, ao analisar o arquivo Excel resultante, é conveniente filtrar por esta coluna Porque </font><font style="vertical-align: inherit;">eles sempre contêm um valor e, filtrando por eles, você já pode entender quais dados divergem nas colunas correspondentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dados de exemplo do arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example1_csv_1.csv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/5j/_u/of5j_us3u07uset3ljspbbwtrr4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dados de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo do</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo </font><i><font style="vertical-align: inherit;">report_UI.xlsx</font></i><font style="vertical-align: inherit;"> : Um </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uh/xy/1s/uhxy1sygvioxbbhlksppdpsar_e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
script python se parece com o seguinte:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#     csv-    -</span>
<span class="hljs-comment"># (        )</span>
df_from_file1 = pd.read_csv(<span class="hljs-string">'./example1_csv_1.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'reg_date'</span>])<font></font>
df_from_file2 = pd.read_csv(<span class="hljs-string">'./example1_csv_2.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>,<span class="hljs-string">'reg_date'</span>])<font></font>
df_from_file3 = pd.read_csv(<span class="hljs-string">'./example1_csv_3.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'reg_date'</span>])<font></font>
<font></font>
<span class="hljs-comment">#    -    - </span>
<span class="hljs-comment"># (   union  SQL)</span><font></font>
df_from_csv = pd.concat([df_from_file1, df_from_file2, df_from_file3]).\<font></font>
    reset_index(drop=<span class="hljs-literal">True</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#       </span>
df_from_csv.drop_duplicates(subset=<span class="hljs-string">'id'</span>, keep=<span class="hljs-string">'first'</span>, inplace=<span class="hljs-literal">True</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#     NaN ( )   reg_date</span><font></font>
df_from_csv = df_from_csv.dropna()<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-   UI  -,</span>
<span class="hljs-comment">#       </span>
<span class="hljs-comment"># (        )</span>
file_excel = <span class="hljs-string">'report_UI.xlsx'</span>
df_from_excel = pd.ExcelFile(file_excel).parse(<span class="hljs-string">'1'</span>)<font></font>
print(df_from_excel)<font></font>
<font></font>
<span class="hljs-comment">#  -     - </span>
<span class="hljs-comment"># -       UI</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df = df_from_csv.merge(df_from_excel, left_on=<span class="hljs-string">'id'</span>, right_on=<span class="hljs-string">""</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df)<font></font>
<font></font>
<span class="hljs-comment">#     Excel-</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitações:</font></font></u><br>
<br>
<ul>
<li>               (  ,       30 000 ).</li>
<li>   (  Excel)  /           ,            .</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cenário No. 2</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A seção contém dados na forma de uma tabela para certos objetos de uma única fonte. O sistema receberá dados de uma segunda fonte (integração) e atualizará os dados da tabela existente com esses dados. Cada registro na tabela são dados para um objeto que possui um identificador exclusivo. Se, a partir de uma nova fonte, os dados de um objeto por identificador coincidirem com os dados de um objeto existente, todos os campos de um registro existente serão atualizados com os dados de uma nova fonte (confirmada). Se a tabela ainda não tiver um objeto com um identificador da segunda fonte, um novo registro será criado na tabela com dados da nova fonte. Os dados do segundo sistema podem ser enviados para um arquivo json com antecedência. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tarefa do testador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare um arquivo com dados para o teste com antecedência, a fim de verificar se os registros existentes são atualizados corretamente e são afixados com um sinal de confirmação no banco de dados se houver uma correspondência por identificador. o identificador ainda não estava. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós compomos um script para o script:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregamos os dados da tabela de partição para o arquivo do Excel na interface do usuário (se isso não for possível, você sempre pode exportar os dados do resultado da consulta SQL usada no código para gerar dados para esta tabela na interface do usuário) e preenchê-los no primeiro quadro de dados .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós obtemos o arquivo json com dados da segunda fonte e o carregamos no segundo quadro de dados.</font></font></li>
<li>  (merge —    outer join  SQL)    -    -          Excel-,        .      ,        ,      .</li>
</ul><br>
<u>:</u><br>
<br>
<ul>
<li>               (  ,       30 000 ).</li>
<li>  json-     /  –           /,    -   json-   pandas        /.</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cenário 3</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
É feita uma solicitação para a API do sistema, em resposta à qual dados sobre objetos no formato json são recebidos. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa do testador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare os dados da resposta à solicitação à API com os dados do resultado da consulta SQL no banco de dados. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós compomos um script para o script:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executamos a consulta SQL no banco de dados, exportamos os dados do resultado da consulta para um arquivo csv, carregamos esses dados no primeiro quadro de dados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós salvamos os dados da resposta à solicitação para a API no arquivo json, carregamos os dados do arquivo no segundo quadro de dados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combinamos os dados (mesclagem - por analogia com junção externa no SQL) de dois quadros de dados recebidos em um novo quadro de dados por um identificador exclusivo e descarregamos os dados para um arquivo do Excel, no qual já comparamos dados por colunas usando as funções de Excel</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou os dados nas colunas no quadro de dados geral podem ser comparados usando pandas, enquanto descarregam as linhas com os mesmos / diferentes dados nas colunas em um novo arquivo de quadro de dados / Excel para análise.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dados de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo do</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo </font><i><font style="vertical-align: inherit;">example3_csv.csv</font></i><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/e6/xz/zxe6xzjff9vbfwgntsfqb-qyykc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dados de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo do</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo </font><i><font style="vertical-align: inherit;">example3_json.json</font></i><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="json hljs">[<font></font>
    {<font></font>
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"16421118-4116"</span>,
        <span class="hljs-attr">"name_json"</span>: <span class="hljs-string">"Tempor Consulting"</span>,
        <span class="hljs-attr">"email_json"</span>: <span class="hljs-string">"Nullam.lobortis.quam@***"</span>,
        <span class="hljs-attr">"tel_json"</span>: <span class="hljs-string">"1-821-805-****"</span>,
        <span class="hljs-attr">"reg_date_json"</span>: <span class="hljs-string">"12-11-16"</span>,
        <span class="hljs-attr">"city_json"</span>: <span class="hljs-string">"Natales"</span><font></font>
    },<font></font>
    {<font></font>
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"16040210-2206"</span>,
        <span class="hljs-attr">"name_json"</span>: <span class="hljs-string">"Odio Etiam Incorporated"</span>,
        <span class="hljs-attr">"email_json"</span>: <span class="hljs-string">"arcu@***"</span>,
        <span class="hljs-attr">"tel_json"</span>: <span class="hljs-string">"1-730-291-****"</span>,
        <span class="hljs-attr">"reg_date_json"</span>: <span class="hljs-string">"26-06-05"</span>,
        <span class="hljs-attr">"city_json"</span>: <span class="hljs-string">"Viddalba"</span><font></font>
    },<font></font>
...<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script python fica assim:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment">#       csv-     ";"</span>
df_from_csv = pd.read_csv(<span class="hljs-string">'./example3_csv.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#    json-  -</span>
<span class="hljs-comment"># (        )</span>
df_from_json = pd.read_json(<span class="hljs-string">'./example3_json.json'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_json)<font></font>
<font></font>
<span class="hljs-comment">#  -    -</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df_csv_json = df_from_csv.merge(df_from_json, left_on=<span class="hljs-string">'id'</span>, <font></font>
                                right_on=<span class="hljs-string">"id"</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df_csv_json)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,   ,</span>
<span class="hljs-comment">#      -   ,</span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
<span class="hljs-comment"># writer = pd.ExcelWriter('.xlsx')</span>
<span class="hljs-comment"># df_csv_json.to_excel(writer, '1')</span>
<span class="hljs-comment"># writer.save()</span><font></font>
<font></font>
<span class="hljs-comment">#       </span>
<span class="hljs-comment"># (, name_csv  name_json) </span>
<span class="hljs-comment">#       Excel-  </span>
<span class="hljs-comment"># (        )</span>
unequal_data_df = df_csv_json.loc[df_csv_json[<span class="hljs-string">'name_csv'</span>] != <font></font>
                                  df_csv_json[<span class="hljs-string">'name_json'</span>]]<font></font>
unequal_data_df = unequal_data_df[[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name_csv'</span>, <span class="hljs-string">'name_json'</span>]]<font></font>
print(unequal_data_df)<font></font>
<font></font>
writer = pd.ExcelWriter(<span class="hljs-string">'_name.xlsx'</span>)<font></font>
unequal_data_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitações:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao trabalhar com arquivos com um número muito grande de linhas, você precisará dividi-los em arquivos separados (aqui você precisa tentar, raramente tenho arquivos com mais de 30.000 linhas).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o arquivo json tiver vários níveis de aninhamento de objetos / matrizes de dados, a partir dos níveis internos eles serão carregados na célula como um objeto / matriz, portanto, trabalhar sem qualquer preparação com arquivos json usando pandas é conveniente apenas para dados sem aninhamento excessivo de objetos / matrizes.</font></font></li>
<li>       API         SQL-  ,             SQL-   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a resposta à solicitação da API vier no formato xml, primeiro será necessário analisar os dados necessários do arquivo xml usando o ElementTree ou outra biblioteca e carregá-los no quadro de dados. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cenário No. 4</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Na interface do usuário, é baixado um arquivo xml com dados sobre objetos, que é gerado em tempo real a partir de dados no banco de dados sujeitos a determinadas condições (por exemplo, status, datas, anos ou outros valores de parâmetros para objetos são levados em consideração). </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa do testador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare a identificação de identificadores exclusivos dos objetos do arquivo xml que estão no atributo da marca da empresa com os identificadores dos objetos do resultado da consulta SQL no banco de dados. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós compomos um script para o script:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós salvamos os dados da resposta à solicitação para a API no arquivo xml, obtemos os dados necessários desse arquivo usando a biblioteca ElementTree, carregamos os dados no primeiro quadro de dados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executamos a consulta SQL no banco de dados, exportamos os dados do resultado da consulta para o arquivo csv, carregamos esses dados no segundo quadro de dados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combinamos os dados (mesclagem - por analogia com junção externa no SQL) de dois quadros de dados recebidos em um novo quadro de dados por um identificador exclusivo e descarregamos os dados para um arquivo do Excel.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, abra o arquivo resultante e analise as linhas de dados.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dados de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo do</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo </font><i><font style="vertical-align: inherit;">example4_csv.csv</font></i><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gb/zk/ou/gbzkou2bivh2gsnk6do0lthh1_g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dados de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo do</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo </font><i><font style="vertical-align: inherit;">example4_xml.xml</font></i><font style="vertical-align: inherit;"> : Um </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/x4/no/zhx4noe3virrsagqnaduwpqyp_w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
script python se parece com o seguinte:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   ElementTree</span>
<span class="hljs-keyword">from</span> xml.etree <span class="hljs-keyword">import</span> ElementTree
<span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    xml-   </span>
<span class="hljs-comment"># (        )</span>
tree = ElementTree.parse(<span class="hljs-string">"example4_xml.xml"</span>)<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
root = tree.getroot()<font></font>
<font></font>
<span class="hljs-comment">#  ,     </span><font></font>
data_list = []<font></font>
i = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#    -   id_type1  id_type2</span>
<span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> root.iter(<span class="hljs-string">"companies"</span>):
    <span class="hljs-keyword">for</span> child_1 <span class="hljs-keyword">in</span> child.iter(<span class="hljs-string">"company"</span>):<font></font>
            data_list.append({<span class="hljs-string">""</span>: i, <span class="hljs-string">"id"</span>: child_1.get(<span class="hljs-string">"id_type1"</span>)
                                                <span class="hljs-keyword">or</span> child_1.get(<span class="hljs-string">"id_type2"</span>), 
                              <span class="hljs-string">"  xml"</span>: <span class="hljs-string">""</span>})<font></font>
            i += <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#     data_list  -</span>
df_from_xml = pd.DataFrame.from_dict(data_list, orient=<span class="hljs-string">'columns'</span>)<font></font>
print(df_from_xml)<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
df_from_csv = pd.read_csv(<span class="hljs-string">'./example4_csv.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#  -   -</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df = df_from_csv.merge(df_from_xml, left_on=<span class="hljs-string">'id'</span>, right_on=<span class="hljs-string">"id"</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-</span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cenário 5</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Na interface do usuário, a seção exibe dados sobre objetos na forma de uma tabela. </font><font style="vertical-align: inherit;">É possível fazer upload de dados para um arquivo do Excel. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tarefa do testador:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare os dados da tabela de partição com os dados baixados no arquivo do Excel. </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós compomos um script para o script:</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pedimos aos desenvolvedores uma consulta SQL no banco de dados a partir do código responsável pela saída de dados para a tabela de partições na interface do usuário.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executamos essa consulta SQL no banco de dados, carregamos os dados em um arquivo csv, carregamos os dados dele no primeiro quadro de dados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregamos os dados da tabela de partição para o arquivo do Excel na interface do usuário e carregamos os dados para o segundo quadro de dados.</font></font></li>
<li>  (merge —    outer join  SQL)    -    -          Excel-,             Excel.</li>
<li>      -     pandas,      /      -/Excel-  .</li>
</ul><br>
<u>:</u><br>
<br>
<ul>
<li>    ,     Excel-  UI, ,         ,          .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, scripts semelhantes podem ser usados ​​simplesmente para transferir dados de arquivos json ou arquivos csv para arquivos do Excel. </font><font style="vertical-align: inherit;">Ou, você pode combinar dados de vários arquivos do Excel em determinadas colunas e carregá-los em um novo arquivo do Excel.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estes são apenas alguns exemplos de como você pode usar python + pandas para acelerar o processo de teste e encontrar bugs. </font><font style="vertical-align: inherit;">De fato, os pandas têm muito mais oportunidades para trabalhar com dados. Você pode ler mais sobre isso na documentação desta biblioteca. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez seu projeto tenha outras opções para usar esses scripts e este artigo o ajude a começar a usá-los no trabalho dos testadores.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486744/index.html">Um corretor de postura doméstico inteligente foi colocado à venda. Vimos o novo produto - IBACK</a></li>
<li><a href="../pt486746/index.html">Escreva, não corte. O que comecei a perder nas publicações de Habr</a></li>
<li><a href="../pt486750/index.html">A série "For All Mankind": de uma história alternativa ao lixo</a></li>
<li><a href="../pt486752/index.html">Servidor Web WSGI exclusivo usando ESP8266. Parte 1</a></li>
<li><a href="../pt486754/index.html">JIRA: regras para a preparação oportuna de softwares deliciosos. TLDR 2: gerenciamento de requisitos</a></li>
<li><a href="../pt486760/index.html">Semana da Segurança 06: rastreadores de publicidade em aplicativos móveis</a></li>
<li><a href="../pt486762/index.html">Hospedagem de cabeceira: a prática assustadora de hospedagem em casa</a></li>
<li><a href="../pt486764/index.html">Faça Você Mesmo Schema.org: personalizando o micro-layout sem um programador</a></li>
<li><a href="../pt486766/index.html">Como transferir todas as transações on-line no mercado arcaico de factoring? Experiência de Sberbank Factoring</a></li>
<li><a href="../pt486768/index.html">Revisão do painel de administração do Webasyst</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>