<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚶🏿 🚨 🚍 Membuat Viberbot lengkap. Bagian dua - kontak pertama atau "conversion_started" 🦒 👡 🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mengirim pesan pertama kepada pengguna - selamat datang dan masuk
 Pada bagian pertama, kami belajar cara meluncurkan starter, menginstal webhook untu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Membuat Viberbot lengkap. Bagian dua - kontak pertama atau "conversion_started"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486858/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim pesan pertama kepada pengguna - selamat datang dan masuk</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada bagian </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pertama,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami belajar cara </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meluncurkan starter,</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menginstal webhook untuk proyek botviber kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada tanggal 2 ini, kita akan belajar bagaimana mengirim pesan pertama yang ditunjukkan kepada pengguna kita, membuat tautan untuk mencari dan meluncurkan bot kita, baik di dalam ViberURL dan NoViberURL</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/k4/py/cik4pyycxovsxsmki6rjrtupv6a.jpeg" alt="gambar"><br>
<br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami akan membentuk tautan ke bot</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Offline QR - dapat diunduh dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">area</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> admin afiliasi </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
viber 2) Tautan untuk messenger ViberURL dan transfer messenger</font></font><br>
<br>
<pre><code class="plaintext hljs">viber://pa?chatURI=dinner&amp;context=fromhabr</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pengalihan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">NoViberURL</font></a><font style="vertical-align: inherit;"> di Internet ada banyak penyingkat URL seperti itu - tetapi semuanya terlihat seperti spam, jadi saya sarankan untuk membuat kode Anda sendiri dari tiga baris PHP dan meletakkan file di hosting Anda, berikut adalah isi dari file foot.php</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>
header (<span class="hljs-string">"Location: viber://pa?chatURI=dinner"</span>);
<span class="hljs-keyword">exit</span>();</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Botviber salam atau "acara": "conversation_started"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah membuka QR atau mengikuti tautan ke alamat aplikasi kami dari server Viber (Jetty), POST meminta acara ("event": "conversation_started") tiba dan konten lengkapnya terlihat seperti ini:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PARAMETER POST INCOMING - atau JSON dari 13 bidang</font></font></b><div class="spoiler_text"><pre><code class="python hljs">{
  <span class="hljs-string">"chat_hostname"</span>: <span class="hljs-string">"SN-327_"</span>, <span class="hljs-comment">#  Viber    -   "chat_hostname"</span>
  <span class="hljs-string">"event"</span>: <span class="hljs-string">"conversation_started"</span>, <span class="hljs-comment">#          </span>
  <span class="hljs-string">"context"</span>: <span class="hljs-string">"fromlanding"</span>, <span class="hljs-comment">#    UTM     </span>
  <span class="hljs-string">"message_token"</span>: <span class="hljs-number">5406893180055821524</span>, <span class="hljs-comment">#  </span>
  <span class="hljs-string">"subscribed"</span>: false, <span class="hljs-comment">#    ,   true   </span>
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-number">1581161565470</span>, <span class="hljs-comment"># UNIXTIME </span>
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"open"</span>, <span class="hljs-comment">#  </span>
  <span class="hljs-string">"user"</span>: {
    <span class="hljs-string">"api_version"</span>: <span class="hljs-number">8</span>,  <span class="hljs-comment">#   API   . </span>
    <span class="hljs-string">"avatar"</span>: <span class="hljs-string">"https://media-direct.cdn.viber.com/avatar..."</span>, <span class="hljs-comment">#      -   ,   </span>
    <span class="hljs-string">"country"</span>: <span class="hljs-string">"RU"</span>, <span class="hljs-comment">#       (UA-, BY-, IL-, MD - )</span>
    <span class="hljs-string">"id"</span>: <span class="hljs-string">"J2k6sasdgghaazDeoXVYww=="</span>, <span class="hljs-comment"># ID    </span>
    <span class="hljs-string">"language"</span>: <span class="hljs-string">"ru"</span>, <span class="hljs-comment">#      (  )</span>
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Denis"</span> № <span class="hljs-comment">#   Viber -      -     name  </span><font></font>
  }<font></font>
}</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapi dalam kebanyakan kasus kami hanya tertarik pada 5 bidang ini</font></font></b><div class="spoiler_text"><pre><code class="python hljs">{
  <span class="hljs-string">"context"</span>: <span class="hljs-string">"fromlanding"</span>, <span class="hljs-comment">#      </span>
  <span class="hljs-string">"subscribed"</span>: false,
   <span class="hljs-string">"user"</span>: {
    <span class="hljs-string">"country"</span>: <span class="hljs-string">"RU"</span>, <span class="hljs-comment">#      </span>
    <span class="hljs-string">"id"</span>: <span class="hljs-string">"J2k6sasdgghaazDeoXVYww=="</span>, <span class="hljs-comment"># ID    </span>
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Denis"</span> № <span class="hljs-comment">#   ,   .</span><font></font>
  }<font></font>
}</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan terkadang kita hanya membutuhkan satu bidang</font></font></b><div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Id": "J2k6sasdgghaazDeoXVYww =="</font></font><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah pengidentifikasi Viber utama pengguna, analog dari chat_id di telegram. </font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan, harap dicatat bahwa di kereta chat_id ada satu messenger di semua bot di seluruh jaringan - seperti nomor ponsel, dan id dalam getaran - itu seperti token dan unik dalam salah satu bot Anda. </font><font style="vertical-align: inherit;">Di bot lain, id Anda akan berbeda ...</font></font><br>
 </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memprosesnya dan menjawab untuk mendapatkan salah satu dari tiga jawaban seperti pada tangkapan layar di atas </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a) type = "text" </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
b) dan di sini kita melihat case klasik type = "rich_media" </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c) pada layar ketiga Type = "keyboard" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detail</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tentang </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">viber REST API</font></a><font style="vertical-align: inherit;"> , dan di bawah ini kami akan mempertimbangkan cara mendapatkan opsi pertama</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti yang telah kita lihat, botviber dapat dicap untuk bisnis apa pun atau toko mini, serta gaya yang sesuai untuk situs utama Anda</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) untuk memproses pesan pengguna di file proyek myviberbot / views.py, buat perubahan:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-comment">#</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> requests <span class="hljs-comment">#      </span>
<span class="hljs-keyword">import</span> json 
<span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> HttpResponse
<span class="hljs-keyword">from</span> django.views.decorators.csrf <span class="hljs-keyword">import</span> csrf_exempt<font></font>
<font></font>
auth_token = <span class="hljs-string">'45df835d27d01f-cd2e7wetwerga18a8-9a7wert786234'</span> <span class="hljs-comment">#!     </span>
url = <span class="hljs-string">'https://chatapi.viber.com/pa/send_message'</span>
headers = {<span class="hljs-string">'X-Viber-Auth-Token'</span>: auth_token}<font></font>
<font></font>
<span class="hljs-comment">#     </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sending</span>(<span class="hljs-params">func</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapped</span>(<span class="hljs-params">*args</span>):</span>
        <span class="hljs-keyword">return</span> requests.post(url, json.dumps(func(*args)), headers=headers)
    <span class="hljs-keyword">return</span> wrapped<font></font>
<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-meta">@sending</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_text</span>(<span class="hljs-params">agent, text, track=None</span>):</span>
    m = dict(receiver=agent, min_api_version=<span class="hljs-number">2</span>, tracking_data=track, type=<span class="hljs-string">"text"</span>, text=text)
    <span class="hljs-keyword">return</span> m<font></font>
<font></font>
<span class="hljs-meta">@csrf_exempt</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trx_bot</span>(<span class="hljs-params">request</span>):</span>
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">"POST"</span>:<font></font>
        viber = json.loads(request.body.decode(<span class="hljs-string">'utf-8'</span>))
        <span class="hljs-keyword">if</span> viber[<span class="hljs-string">'event'</span>] == <span class="hljs-string">'conversation_started'</span>:<font></font>
            print(<span class="hljs-string">" "</span>)<font></font>
            conversation(viber) <span class="hljs-comment">#  -    .</span>
        <span class="hljs-keyword">elif</span> viber[<span class="hljs-string">'event'</span>] == <span class="hljs-string">'webhook'</span>:
            <span class="hljs-comment">#print(viber)</span>
            <span class="hljs-comment">#print("Webhook  ")</span>
            <span class="hljs-keyword">return</span> HttpResponse(status=<span class="hljs-number">200</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"  Webhook -   ,   POSTMAN"</span>) 
            <span class="hljs-keyword">return</span> HttpResponse(status=<span class="hljs-number">500</span>)
        <span class="hljs-keyword">return</span> HttpResponse(status=<span class="hljs-number">200</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">conversation</span>(<span class="hljs-params">viber</span>):</span>
    id = viber[<span class="hljs-string">'user'</span>][<span class="hljs-string">'id'</span>]
    <span class="hljs-keyword">if</span> viber[<span class="hljs-string">'subscribed'</span>]:<font></font>
	    send_text(id, <span class="hljs-string">'  '</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        send_text(id, <span class="hljs-string">'   ?\n\n   .      ...'</span>)<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mulai ulang proyek Django kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, "Rakuten Viber" tidak memberikan halaman resmi kepada PA dan komunitas kepada siapa pun, kecuali untuk merek besar dan tokoh publik, oleh karena itu, untuk promosi SEO dan PR di jejaring sosial, dll. Saya sarankan membuat minilanding - halaman kecil yang digunakan semua orang untuk mengunjungi situs utama atau orang lain. Berikut adalah contoh sumber daya: </font><font style="vertical-align: inherit;">
Berhasil meluncurkan botviber. </font><font style="vertical-align: inherit;">
Untuk dilanjutkan ... </font><font style="vertical-align: inherit;">
Pada artikel berikutnya, kami akan menganalisis acara ["pesan"], untuk memproses pesan pengguna, Anda akan mempelajari apa yang harus dilakukan untuk melakukan dialog, cara memisahkan pesan-pesan berikut, umumnya cara mengajar botviber untuk memahami bahwa ini adalah yang berikut. </font><font style="vertical-align: inherit;">
(Membuat Viberbot lengkap pada Django 2 dan API Viber REST. Bagian Tiga - Pesan) </font><font style="vertical-align: inherit;">
Bahan: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">dokumentasi viber REST API</font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/le/f8/jp/lef8jpeb1jvzrdzheg-qqbtf3eq.jpeg"><br>
</a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Django versi 2.2 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Radio-penambang</font></font></a></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id486828/index.html">Intisari Desain Makanan, Januari 2020</a></li>
<li><a href="../id486832/index.html">Berapa tahun pergi taiga - mengerti tidak</a></li>
<li><a href="../id486842/index.html">Konsul + iptables =: 3</a></li>
<li><a href="../id486844/index.html">Evolusi pemrosesan webhook Facebook: dari nol menjadi 25.000 per detik</a></li>
<li><a href="../id486850/index.html">Kursi baru yang dipesan - seperti hotel kapsul</a></li>
<li><a href="../id486860/index.html">ATX12VO - Makan dengan Cara Baru</a></li>
<li><a href="../id486862/index.html">5 alasan mengapa desain gerak membantu Anda terhubung dengan orang-orang</a></li>
<li><a href="../id486864/index.html">Bermigrasi dari OpenVPN ke WireGuard untuk bergabung dengan jaringan menjadi satu jaringan L2</a></li>
<li><a href="../id486866/index.html">Fuete Sinkron: Motor Biologis dalam Nanoteknologi</a></li>
<li><a href="../id486868/index.html">Kenapa dan untuk siapa kita melakukan Slime Agile</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>