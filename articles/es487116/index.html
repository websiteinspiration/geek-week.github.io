<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßó üë©üèΩ‚Äçüî¨ üçí Por qu√© Discord migra de Go to Rust üî© üë©üèæ‚Äçüî¨ üö∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Rust se est√° convirtiendo en un lenguaje de primera clase en una amplia gama de campos. Nosotros en Discord lo usamos con √©xito tanto en el servidor c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Por qu√© Discord migra de Go to Rust</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487116/"><img src="https://habrastorage.org/getpro/habr/post_images/84a/0f1/d61/84a0f1d6126d5fd59b9c708f19c84692.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rust se est√° convirtiendo en un lenguaje de primera clase en una amplia gama de campos. </font><font style="vertical-align: inherit;">Nosotros en Discord lo usamos con √©xito tanto en el servidor como en el cliente. </font><font style="vertical-align: inherit;">Por ejemplo, en el lado del cliente en la canalizaci√≥n de codificaci√≥n de video para Go Live, y en el lado del servidor para las </font><font style="vertical-align: inherit;">funciones </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elixir NIF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Funciones implementadas nativas). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recientemente, mejoramos dr√°sticamente el rendimiento de un solo servicio, reescribi√©ndolo desde Go to Rust. </font><font style="vertical-align: inherit;">Este art√≠culo explicar√° por qu√© ten√≠a sentido reescribir el servicio, c√≥mo lo hicimos y cu√°nta productividad mejor√≥.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servicio de seguimiento de estado de lectura (estados de lectura)</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestra empresa se basa en un solo producto, as√≠ que comencemos con un contexto, lo que transferimos exactamente de Go to Rust. Este es un servicio de lectura de estados. Su √∫nica tarea es realizar un seguimiento de los canales y mensajes que lee. Se accede a los estados de lectura cada vez que se conecta a Discord, cada vez que env√≠a un mensaje y cada vez que lo lee. En resumen, los estados se leen de forma continua y se encuentran en una "ruta activa". Queremos asegurarnos de que Discord sea siempre r√°pido, por lo que la verificaci√≥n de estado debe ser r√°pida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La implementaci√≥n del servicio en Go no cumpli√≥ con todos los requisitos. </font><font style="vertical-align: inherit;">La mayor√≠a de las veces funcion√≥ r√°pidamente, pero cada pocos minutos hubo fuertes retrasos, notorios para los usuarios. </font><font style="vertical-align: inherit;">Despu√©s de examinar la situaci√≥n, determinamos que los retrasos se debieron a las caracter√≠sticas clave de Go: su modelo de memoria y recolector de basura (GC).</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por qu√© Go no cumple con nuestros objetivos de rendimiento</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para explicar por qu√© Go no cumple con nuestros objetivos de rendimiento, primero debemos analizar las estructuras de datos, la escala, los patrones de acceso y la arquitectura de servicio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para almacenar informaci√≥n de estado, utilizamos una estructura de datos, que se llama: Leer estado. Hay miles de millones de ellos en Discord: un estado para cada usuario por canal. Cada estado tiene varios contadores, que deben actualizarse at√≥micamente y, a menudo, restablecerse a cero. Por ejemplo, uno de los contadores es el n√∫mero </font></font><code>@mention</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el canal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para actualizar r√°pidamente el contador at√≥mico, cada servidor de Estados de lectura tiene un cach√© menos utilizado recientemente (LRU). Cada cach√© tiene millones de usuarios y decenas de millones de estados. El cach√© se actualiza cientos de miles de veces por segundo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por seguridad, el cach√© se sincroniza con el cl√∫ster de base de datos Cassandra. </font><font style="vertical-align: inherit;">Cuando una clave es expulsada de la cach√©, ingresamos los estados de este usuario en la base de datos. </font><font style="vertical-align: inherit;">En el futuro, planeamos actualizar la base de datos en 30 segundos con cada actualizaci√≥n de estado. </font><font style="vertical-align: inherit;">Esto es decenas de miles de registros en la base de datos cada segundo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente gr√°fico muestra el tiempo de respuesta y la carga de la CPU en el intervalo de tiempo pico para el servicio Go </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup></a><a name="1_1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se puede ver que los retrasos y las explosiones de carga en la CPU ocurren aproximadamente cada dos minutos.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/90d/37b/89f/90d37b89f25eab54420107e63c086c44.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, ¬øde d√≥nde viene el crecimiento de los retrasos cada dos minutos?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Go, la memoria no se libera inmediatamente cuando se saca una clave del cach√©. En cambio, el recolector de basura se ejecuta peri√≥dicamente y busca porciones de memoria no utilizadas. Esto es mucho trabajo que puede ralentizar un programa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es muy probable que las ralentizaciones peri√≥dicas de nuestro servicio est√©n asociadas con la recolecci√≥n de basura. Pero escribimos un c√≥digo Go muy eficiente con una cantidad m√≠nima de asignaci√≥n de memoria. No deber√≠a quedar mucha basura. ¬øCu√°l es el problema? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al hurgar en el c√≥digo fuente de Go, aprendimos que Go inicia forzosamente la recolecci√≥n de basura </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al menos cada dos minutos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Independientemente del tama√±o del almacenamiento din√°mico, si el GC no se inici√≥ durante dos minutos, Go lo forzar√° a iniciarse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos que si ejecuta GC con m√°s frecuencia, puede evitar estos picos con grandes demoras, por lo que establecemos un punto final en el servicio para cambiar el valor de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">porcentaje de GC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre la marcha </font><font style="vertical-align: inherit;">. Desafortunadamente, la configuraci√≥n de GC Percent no afect√≥ nada. ¬øC√≥mo pudo pasar esto? Resulta que GC no quer√≠a comenzar con m√°s frecuencia, porque no asignamos memoria con la frecuencia suficiente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenzamos a cavar m√°s. Result√≥ que no se producen demoras tan grandes debido a la gran cantidad de memoria liberada, sino porque el recolector de basura escanea todo el cach√© LRU para verificar toda la memoria. Luego decidimos que si disminuimos el cach√© LRU, entonces el volumen de escaneo disminuir√°. Por lo tanto, agregamos un par√°metro m√°s al servicio para cambiar el tama√±o de la cach√© LRU, y cambiamos la arquitectura, dividiendo la LRU en muchas cach√©s separadas en cada servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y as√≠ sucedi√≥. Con cach√©s m√°s peque√±os, se reducen los retrasos m√°ximos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, el compromiso con la disminuci√≥n de la cach√© LRU aument√≥ el percentil 99 (es decir, el valor promedio para una muestra del 99% de los retrasos aument√≥, excluyendo los picos). Esto se debe a que la disminuci√≥n de la memoria cach√© reduce la probabilidad de que el estado de lectura del usuario est√© en la memoria cach√©. Si no est√° aqu√≠, entonces debemos recurrir a la base de datos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de una gran cantidad de pruebas de carga en diferentes tama√±os de cach√©, encontramos una configuraci√≥n aceptable. </font><font style="vertical-align: inherit;">Aunque no era ideal, era una soluci√≥n satisfactoria, por lo que dejamos el servicio durante mucho tiempo para trabajar as√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo, implementamos Rust con mucho √©xito en otros sistemas Discord y, como resultado, tomamos la decisi√≥n colectiva de escribir marcos y bibliotecas para nuevos servicios solo en Rust. </font><font style="vertical-align: inherit;">Y este servicio parec√≠a ser un gran candidato para portar a Rust: es peque√±o y aut√≥nomo, y esperamos que Rust solucione estos arrebatos con retrasos y, en √∫ltima instancia, haga que el servicio sea m√°s agradable para los usuarios </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup></a><a name="2_2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesti√≥n de memoria en √≥xido</font></font></h1><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rust es incre√≠blemente r√°pido y eficiente con la memoria: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en ausencia de un entorno de tiempo de ejecuci√≥n y un recolector de basura,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es adecuado para servicios de alto rendimiento, aplicaciones integradas y se integra f√°cilmente con otros idiomas. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup></a><a name="3_3"></a></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rust no tiene un recolector de basura, por lo que decidimos que no habr√≠a tales demoras, como Go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la gesti√≥n de la memoria, utiliza un enfoque bastante √∫nico con la idea de "poseer" memoria. </font><font style="vertical-align: inherit;">En resumen, Rust realiza un seguimiento de qui√©n tiene derecho a leer y escribir en la memoria. </font><font style="vertical-align: inherit;">√âl sabe cu√°ndo un programa usa memoria e inmediatamente lo libera tan pronto como ya no se necesita memoria. </font><font style="vertical-align: inherit;">Rust aplica las reglas de memoria en tiempo de compilaci√≥n, lo que pr√°cticamente elimina la posibilidad de errores de memoria en tiempo de ejecuci√≥n. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 4</font></font></sup></a><a name="4_4"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No necesita rastrear manualmente la memoria. </font><font style="vertical-align: inherit;">El compilador se encargar√° de esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, en la versi√≥n Rust, cuando Read State se excluye de la memoria cach√© de LRU, la memoria se libera inmediatamente. </font><font style="vertical-align: inherit;">Esta memoria no se sienta y no espera al recolector de basura. </font><font style="vertical-align: inherit;">Rust sabe que ya no est√° en uso y lo libera de inmediato. </font><font style="vertical-align: inherit;">No hay ning√∫n proceso en tiempo de ejecuci√≥n para escanear qu√© memoria liberar.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ìxido asincr√≥nico</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero hab√≠a un problema con el ecosistema Rust. En el momento de la implementaci√≥n de nuestro servicio, no hab√≠a funciones asincr√≥nicas decentes en la rama estable de Rust. Para un servicio de red, la programaci√≥n asincr√≥nica es imprescindible. La comunidad ha desarrollado varias bibliotecas, pero con una conexi√≥n no trivial y mensajes de error muy est√∫pidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente, el equipo de Rust trabaj√≥ duro para simplificar la programaci√≥n asincr√≥nica, y ya estaba disponible en el canal inestable (Nightly).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discord nunca tuvo miedo de aprender nuevas tecnolog√≠as prometedoras. Por ejemplo, fuimos uno de los primeros usuarios de Elixir, React, React Native y Scylla. Si alguna tecnolog√≠a parece prometedora y nos da una ventaja, entonces estamos listos para enfrentar la inevitable dificultad de implementaci√≥n y la inestabilidad de las herramientas avanzadas. Esta es una de las razones por las que hemos llegado tan r√°pidamente a una audiencia de 250 millones de usuarios con menos de 50 programadores en el estado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La introducci√≥n de nuevas funciones asincr√≥nicas desde el canal Rust inestable es otro ejemplo de nuestra voluntad de adoptar una tecnolog√≠a nueva y prometedora. El equipo de ingenier√≠a decidi√≥ implementar las funciones necesarias sin esperar su soporte en la versi√≥n estable. Junto con otros representantes de la comunidad, hemos superado todos los problemas que han surgido, y ahora el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√≥xido asincr√≥nico</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mantenido en una rama estable. </font><font style="vertical-align: inherit;">Nuestra tasa ha valido la pena.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementaci√≥n, pruebas de resistencia y lanzamiento.</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo reescribir el c√≥digo fue f√°cil. Comenzamos con una transmisi√≥n aproximada, luego la redujimos a lugares donde ten√≠a sentido. Por ejemplo, Rust tiene un excelente sistema de tipos con un amplio soporte para gen√©ricos (para trabajar con datos de cualquier tipo), por lo que descartamos en silencio el c√≥digo Go, que compens√≥ la falta de gen√©ricos. Adem√°s, el modelo de memoria Rust tiene en cuenta la seguridad de la memoria en diferentes subprocesos, por lo que descartamos las gorutinas protectoras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las pruebas de carga mostraron inmediatamente un excelente resultado. El rendimiento del servicio en Rust result√≥ ser tan alto como el de la versi√≥n Go, ¬° </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pero sin estas explosiones de mayor retraso</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo general, pr√°cticamente no optimizamos la versi√≥n Rust. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero incluso con las optimizaciones m√°s simples, Rust pudo superar a una versi√≥n cuidadosamente ajustada de Go.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta es una prueba elocuente de lo f√°cil que es escribir programas eficaces de Rust en comparaci√≥n con profundizar en Go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no satisfacemos el simple rendimiento quo. </font><font style="vertical-align: inherit;">Despu√©s de un peque√±o perfil y optimizaci√≥n, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">superamos a Go en todos los aspectos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Retardo, CPU y memoria: todo mejor√≥ en la versi√≥n Rust. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las optimizaciones de rendimiento de √≥xido incluyen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cambiar a BTreeMap en lugar de HashMap en la cach√© LRU para optimizar el uso de la memoria.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reemplazar la biblioteca original de m√©tricas con una versi√≥n con soporte para la concurrencia moderna Rust.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disminuya el n√∫mero de copias en la memoria.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satisfechos, decidimos implementar el servicio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El lanzamiento fue bastante fluido, ya que realizamos pruebas de estr√©s. </font><font style="vertical-align: inherit;">Conectamos el servicio a un nodo de prueba, descubrimos y solucionamos varios casos l√≠mite. </font><font style="vertical-align: inherit;">Poco despu√©s, lanzaron una nueva versi√≥n a todo el parque de servidores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los resultados se muestran a continuaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El gr√°fico p√∫rpura es Go, el gr√°fico azul es Rust.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/yb/-v/mi/yb-vmise0bioz33f8yfrockjr_0.png"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aumentar el tama√±o del cach√©</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando el servicio funcion√≥ con √©xito durante varios d√≠as, decidimos aumentar el cach√© de LRU nuevamente. </font><font style="vertical-align: inherit;">Como se mencion√≥ anteriormente, en la versi√≥n Go, esto no se pudo hacer, porque aument√≥ el tiempo para la recolecci√≥n de basura. </font><font style="vertical-align: inherit;">Como ya no hacemos la recolecci√≥n de basura, puede aumentar el cach√© contando con un aumento a√∫n mayor en el rendimiento. </font><font style="vertical-align: inherit;">Por lo tanto, hemos aumentado la memoria en los servidores, optimizado la estructura de datos para un menor uso de memoria (por diversi√≥n) y aumentado el tama√±o de la memoria cach√© a 8 millones de estados de estado de lectura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los resultados a continuaci√≥n hablan por s√≠ mismos. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenga en cuenta que el tiempo promedio ahora se mide en microsegundos, y el retraso m√°ximo </font></font><code>@mention</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se mide en milisegundos.</font></font></b><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/93f/55a/500/93f55a500413c691a4e711e4c90ceada.png"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desarrollo de ecosistemas</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, Rust tiene un ecosistema maravilloso que est√° creciendo r√°pidamente. </font><font style="vertical-align: inherit;">Por ejemplo, recientemente una nueva versi√≥n del tiempo de ejecuci√≥n as√≠ncrono que usamos es Tokio 0.2. </font><font style="vertical-align: inherit;">Actualizamos, y sin ning√∫n esfuerzo de nuestra parte, redujimos autom√°ticamente la carga en la CPU. </font><font style="vertical-align: inherit;">En el gr√°fico a continuaci√≥n, puede ver c√≥mo ha disminuido la carga desde aproximadamente el 16 de enero.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5f/128/490/e5f12849036cfea0b9e9246a1e321ed0.png"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pensamientos finales</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discord actualmente usa Rust en muchas partes de la pila de software: para GameSDK, captura y codificaci√≥n de video en Go Live, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elixir NIF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , varios servicios de back-end y mucho m√°s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al comenzar un nuevo proyecto o componente de software, definitivamente estamos considerando usar Rust. Por supuesto, solo donde tiene sentido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s del rendimiento, Rust ofrece a los desarrolladores muchos otros beneficios. Por ejemplo, su tipo de seguridad y verificador de pr√©stamos simplifican enormemente la refactorizaci√≥n a medida que cambian los requisitos del producto o se introducen nuevas caracter√≠sticas de idioma. El ecosistema y las herramientas son excelentes y se est√°n desarrollando r√°pidamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dato curioso: el equipo de Rust tambi√©n usa Discord para coordinar. Incluso hay un muy √∫til</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor de la comunidad Rust</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donde a veces chateamos.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/webt/br/pc/l_/brpcl_fl4bwj8fcmaeodxotfw5s.png"></div></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notas al pie</font></font></h4><br>
<font color="gray"><ol>
<li><a name="1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√°ficos tomados de Go versi√≥n 1.9.2. </font><font style="vertical-align: inherit;">Probamos las versiones 1.8, 1.9 y 1.10 sin ninguna mejora. </font><font style="vertical-align: inherit;">La migraci√≥n inicial de Go to Rust se complet√≥ en mayo de 2019. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[regresar]</font></font></a><br>
</li>
<li><a name="2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para mayor claridad, no recomendamos reescribir todo en Rust sin ning√∫n motivo. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[regresar]</font></font></a><br>
</li>
<li><a name="3"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cita del sitio oficial. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[regresar]</font></font></a><br>
</li>
<li><a name="4"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por supuesto, hasta que use </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inseguro</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[regresar]</font></font></a></li>
</ol></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es487116/">https://habr.com/ru/post/es487116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es487100/index.html">Estructuras de datos inmutables de √∫ltima generaci√≥n.</a></li>
<li><a href="../es487106/index.html">Analizador PVS-Studio RunUO check</a></li>
<li><a href="../es487108/index.html">Perfil de jugador m√≥vil: MyTracker Research</a></li>
<li><a href="../es487110/index.html">Slurm SRE. Un experimento completo con expertos de Booking.com y Google.com.</a></li>
<li><a href="../es487112/index.html">Edge of Madness: The Basic Circle</a></li>
<li><a href="../es487118/index.html">Loki: recopilaci√≥n de registros utilizando el enfoque de Prometeo</a></li>
<li><a href="../es487120/index.html">C√≥mo distribuir gatitos</a></li>
<li><a href="../es487122/index.html">Traducci√≥n de la Gu√≠a de estilo de JavaScript de Google</a></li>
<li><a href="../es487124/index.html">Entrevista con Borey Yangel sobre Yandex self-drive y la historia de creaci√≥n de Alice</a></li>
<li><a href="../es487126/index.html">C√≥mo los equipos de desarrollo corporativo usan GitLab y Mattermost ChatOps para acelerar el desarrollo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>