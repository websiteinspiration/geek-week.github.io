<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽 🎙️ 🍎 Écrire une application de prise de notes JavaScript 🏚️ ⤴️ 🚴🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour mes amis! 
 
 Aujourd'hui, comme son nom l'indique, nous allons écrire une application simple pour créer et stocker des notes. 
 
 Les fonctio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Écrire une application de prise de notes JavaScript</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500312/"><img src="https://habrastorage.org/webt/gp/x5/y8/gpx5y8qbm8tqiptbm50zpg-3n94.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour mes amis! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, comme son nom l'indique, nous allons écrire une application simple pour créer et stocker des notes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les fonctionnalités de notre application seront les suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez une note.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stockage des notes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supprimez une note.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marquez la tâche.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informations sur la date de fin de la tâche.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rappel pour terminer une tâche.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application sera écrite en JavaScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les notes seront stockées dans une base de données indexée (IndexedDB). </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette bibliothèque</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera utilisée pour faciliter le travail avec IndexedDB </font><font style="vertical-align: inherit;">. Selon les développeurs de cette bibliothèque, c'est "la même chose que IndexedDB, mais avec des promesses". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On suppose que vous connaissez les bases d'IndexedDB. Sinon, je vous recommande de lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avant de continuer </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je comprends que pour résoudre un problème tel que le stockage de notes, LocalStorage suffit. </font><font style="vertical-align: inherit;">Cependant, je voulais explorer certaines des fonctionnalités d'IndexedDB. </font><font style="vertical-align: inherit;">Ainsi, le choix en faveur de ce dernier a été fait uniquement à partir de considérations épistémologiques. </font><font style="vertical-align: inherit;">À la fin, vous trouverez des liens vers une application similaire où le stockage de données est implémenté à l'aide de LocalStorage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors allons-y.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre balisage ressemble à ceci:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-comment">&lt;!-- head --&gt;</span>
<span class="hljs-comment">&lt;!--  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com/css2?family=Stylish&amp;display=swap"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
<span class="hljs-comment">&lt;!--  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/idb@3.0.2/build/idb.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><font></font>
<font></font>
<span class="hljs-comment">&lt;!-- body --&gt;</span>
<span class="hljs-comment">&lt;!--   --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- - --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://placeimg.com/480/240/nature"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"#"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--      --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Note text: <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
    <span class="hljs-comment">&lt;!--      --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Notification date: <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"date"</span>&gt;</span><font></font>
<font></font>
    <span class="hljs-comment">&lt;!--     --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"add-btn"</span>&gt;</span>add note<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-comment">&lt;!--     --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clear-btn"</span>&gt;</span>clear storage<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remarques:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les champs de saisie peuvent être créés à l'aide des balises «figure» et «figcaption». </font><font style="vertical-align: inherit;">Ce serait plus sémantique, pour ainsi dire.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme il s'est avéré plus tard, choisir la balise "input" avec le type "date" n'était pas la meilleure solution. </font><font style="vertical-align: inherit;">À ce sujet ci-dessous.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans une application, des rappels (notifications) sont implémentés à l'aide de l'API Notifications. </font><font style="vertical-align: inherit;">Cependant, il m'a semblé étrange de demander à l'utilisateur la permission d'afficher les notifications et d'ajouter la possibilité de les désactiver, car, d'une part, lorsque nous parlons de l'application pour les notes (tâches), les rappels sont implicites, et d'autre part, ils peuvent être implémentés afin de ne pas gêner l'utilisateur lors d'apparitions répétées, c'est-à-dire </font><font style="vertical-align: inherit;">discrètement.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au départ, l'application permettait d'indiquer non seulement la date, mais aussi l'heure du rappel. </font><font style="vertical-align: inherit;">Par la suite, j'ai décidé que la date était suffisante. </font><font style="vertical-align: inherit;">Cependant, si vous le souhaitez, il est facile à ajouter.</font></font></li>
</ol><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous connectons les styles:</font></font></b>
                        <div class="spoiler_text"><pre><code class="css hljs">* {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">box-sizing</span>: border-box;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">radial-gradient</span>(circle, skyblue, steelblue);
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-wrap</span>: wrap;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Stylish'</span>, sans-serif;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2em</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.box</span>,
<span class="hljs-selector-class">.list</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> .<span class="hljs-number">4em</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">320px</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(lightyellow, darkorange);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
    <span class="hljs-attribute">padding</span>: .<span class="hljs-number">6em</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">6</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">img</span> {
    <span class="hljs-attribute">padding</span>: .<span class="hljs-number">4em</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">h3</span> {
    <span class="hljs-attribute">user-select</span>: none;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">p</span> {
    <span class="hljs-attribute">margin</span>: .<span class="hljs-number">2em</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.1em</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">textarea</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">80px</span>;
    <span class="hljs-attribute">padding</span>: .<span class="hljs-number">4em</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1em</span>;
    <span class="hljs-attribute">resize</span>: none;
    <span class="hljs-attribute">margin-bottom</span>: .<span class="hljs-number">7em</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"date"</span>]</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;
    <span class="hljs-attribute">text-align</span>: center;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">3em</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">button</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">140px</span>;
    <span class="hljs-attribute">padding</span>: .<span class="hljs-number">4em</span>;
    <span class="hljs-attribute">margin</span>: .<span class="hljs-number">4em</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(lightgreen, darkgreen);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
    <span class="hljs-attribute">font-family</span>: inherit;
    <span class="hljs-attribute">font-size</span>: .<span class="hljs-number">8em</span>;
    <span class="hljs-attribute">text-transform</span>: uppercase;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">5</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:active</span> {
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">1px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">7</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:focus</span>,
<span class="hljs-selector-tag">textarea</span><span class="hljs-selector-pseudo">:focus</span>,
<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:focus</span> {
    <span class="hljs-attribute">outline</span>: none;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.note</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-wrap</span>: wrap;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">font-style</span>: italic;
    <span class="hljs-attribute">user-select</span>: none;
    <span class="hljs-attribute">word-break</span>: break-all;
    <span class="hljs-attribute">position</span>: relative;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.note</span> <span class="hljs-selector-tag">p</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">240px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1em</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.note</span> <span class="hljs-selector-tag">span</span> {
    <span class="hljs-attribute">display</span>: block;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">font-weight</span>: bold;
    <span class="hljs-attribute">font-style</span>: normal;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.info</span> {
    <span class="hljs-attribute">color</span>: blue;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.notify</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ddd</span>;
    <span class="hljs-attribute">font-size</span>: .<span class="hljs-number">9em</span>;
    <span class="hljs-attribute">font-weight</span>: normal <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">text-align</span>: center;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">25px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">130px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">25px</span>;
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: -<span class="hljs-number">10px</span>;
    <span class="hljs-attribute">left</span>: -<span class="hljs-number">65px</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">6</span>);
    <span class="hljs-attribute">transition</span>: .<span class="hljs-number">2s</span>;
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.show</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.info</span><span class="hljs-selector-class">.null</span>,
<span class="hljs-selector-class">.notify</span><span class="hljs-selector-class">.null</span> {
    <span class="hljs-attribute">display</span>: none;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.complete</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> .<span class="hljs-number">4em</span>;
    <span class="hljs-attribute">color</span>: green;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.delete</span> {
    <span class="hljs-attribute">padding-left</span>: .<span class="hljs-number">4em</span>;
    <span class="hljs-attribute">color</span>: red;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-class">.line-through</span> {
    <span class="hljs-attribute">text-decoration</span>: line-through;<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ne leur prêtez pas encore beaucoup d'attention. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous passons au script. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recherchez les champs de saisie et créez un conteneur pour les notes:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> textarea = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'textarea'</span>)
<span class="hljs-keyword">let</span> dateInput = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'input[type="date"]'</span>)<font></font>
<font></font>
<span class="hljs-keyword">let</span> list = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>)<font></font>
list.classList.add(<span class="hljs-string">'list'</span>)
<span class="hljs-built_in">document</span>.body.appendChild(list)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez une base de données et un stockage:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> db;
<span class="hljs-comment">// IIFE</span>
<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
    <span class="hljs-comment">//   </span>
    <span class="hljs-comment">// , ...</span>
    db = <span class="hljs-keyword">await</span> idb.openDb(<span class="hljs-string">'db'</span>, <span class="hljs-number">1</span>, db =&gt; {
        <span class="hljs-comment">//  </span>
        db.createObjectStore(<span class="hljs-string">'notes'</span>, {
            <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'id'</span><font></font>
        })<font></font>
    })<font></font>
<font></font>
    <span class="hljs-comment">//  </span><font></font>
    createList()<font></font>
})();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez la fonction d'ajouter des notes afin de comprendre ce qu'est une seule note ou, plus précisément, ce qu'elle contient. </font><font style="vertical-align: inherit;">Cela vous aidera à comprendre comment la liste est formée:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//         ""</span>
<span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.add-btn'</span>).onclick = addNote<font></font>
<font></font>
<span class="hljs-keyword">const</span> addNote = <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">//      ,   </span>
    <span class="hljs-keyword">if</span> (textarea.value === <span class="hljs-string">''</span>) <span class="hljs-keyword">return</span><font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">let</span> text = textarea.value<font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-comment">//    </span>
    <span class="hljs-comment">//    null    </span>
    <span class="hljs-keyword">let</span> date<font></font>
    dateInput.value === <span class="hljs-string">''</span> ? date = <span class="hljs-literal">null</span> : date = dateInput.value<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">let</span> note = {
        <span class="hljs-attr">id</span>: id,
        <span class="hljs-attr">text</span>: text,
        <span class="hljs-comment">//  </span>
        <span class="hljs-attr">createdDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleDateString(),
        <span class="hljs-comment">//  </span>
        <span class="hljs-attr">completed</span>: <span class="hljs-string">''</span>,
        <span class="hljs-comment">//  </span>
        <span class="hljs-attr">notifyDate</span>: date<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> db.transaction(<span class="hljs-string">'notes'</span>, <span class="hljs-string">'readwrite'</span>)<font></font>
            .objectStore(<span class="hljs-string">'notes'</span>)<font></font>
            .add(note)<font></font>
        <span class="hljs-comment">//  </span>
        <span class="hljs-keyword">await</span> createList()
            <span class="hljs-comment">//   </span>
            .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
                textarea.value = <span class="hljs-string">''</span>
                dateInput.value = <span class="hljs-string">''</span><font></font>
            })<font></font>
    } <span class="hljs-keyword">catch</span> { }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous allons créer une liste:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> id<font></font>
<font></font>
<span class="hljs-keyword">const</span> createList = <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">//  </span>
    <span class="hljs-comment">//     API </span>
    list.innerHTML = <span class="hljs-string">`&lt;h3&gt;Today is <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.DateTimeFormat(<span class="hljs-string">'en'</span>, { year: <span class="hljs-string">'numeric'</span>, month: <span class="hljs-string">'long'</span>, day: <span class="hljs-string">'numeric'</span> }</span>).format()}&lt;/h3&gt;`</span><font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">let</span> notes = <span class="hljs-keyword">await</span> db.transaction(<span class="hljs-string">'notes'</span>)<font></font>
        .objectStore(<span class="hljs-string">'notes'</span>)<font></font>
        .getAll()<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">let</span> dates = []<font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">if</span> (notes.length) {
        <span class="hljs-comment">//   "id"   </span><font></font>
        id = notes.length<font></font>
<font></font>
        <span class="hljs-comment">//   </span>
        notes.map(<span class="hljs-function"><span class="hljs-params">note</span> =&gt;</span> {
           <span class="hljs-comment">//    </span>
            list.insertAdjacentHTML(<span class="hljs-string">'beforeend'</span>,
            <span class="hljs-comment">//    "data-id"</span>
            <span class="hljs-string">`&lt;div class = "note" data-id="<span class="hljs-subst">${note.id}</span>"&gt;
            //  
            &lt;span class="notify <span class="hljs-subst">${note.notifyDate}</span>"&gt;<span class="hljs-subst">${note.notifyDate}</span>&lt;/span&gt;
            //  ()  
            //  ,     
            //        
            //    
            //       (CSS: .info.null, .notify.null)
            &lt;span class="info <span class="hljs-subst">${note.notifyDate}</span>"&gt;?&lt;/span&gt;

            //  ()  
            &lt;span class="complete"&gt;V&lt;/span&gt;
            //         
            &lt;p class="<span class="hljs-subst">${note.completed}</span>"&gt;Text: <span class="hljs-subst">${note.text}</span>, &lt;br&gt; created: <span class="hljs-subst">${note.createdDate}</span>&lt;/p&gt;
            //  ()  
            &lt;span class="delete"&gt;X&lt;/span&gt;
        &lt;/div&gt;`</span>)
            <span class="hljs-comment">//     </span>
            <span class="hljs-comment">//    </span>
            <span class="hljs-keyword">if</span> (note.notifyDate === <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span>
            <span class="hljs-comment">//   </span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//  </span><font></font>
                dates.push({<font></font>
                    <span class="hljs-attr">id</span>: note.id,
                    <span class="hljs-attr">date</span>: note.notifyDate.replace(<span class="hljs-regexp">/(\d+)-(\d+)-(\d+)/</span>, <span class="hljs-string">'$3.$2.$1'</span>)<font></font>
                })<font></font>
            }<font></font>
        })<font></font>
    <span class="hljs-comment">//      </span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//   "id"  0</span>
        id = <span class="hljs-number">0</span><font></font>
<font></font>
        <span class="hljs-comment">//       </span>
        list.insertAdjacentHTML(<span class="hljs-string">'beforeend'</span>, <span class="hljs-string">'&lt;p class="note"&gt;empty&lt;/p&gt;'</span>)<font></font>
    }<font></font>
    <span class="hljs-comment">// ...to be continued</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tableau d'objets pour stocker les dates de rappel a deux champs: "id" pour identifier les notes et "date" pour comparer les dates. </font><font style="vertical-align: inherit;">En écrivant la valeur de la date de rappel dans le champ "date", nous sommes obligés de convertir cette valeur, car inputDate.value renvoie des données au format "aaaa-mm-jj", et nous allons comparer ces données avec les données au format auquel nous sommes habitués, c'est-à-dire </font><font style="vertical-align: inherit;">"Jj.mm.aaaa". </font><font style="vertical-align: inherit;">Par conséquent, nous utilisons la méthode «replace» et l'expression régulière, où, en utilisant le regroupement, nous inversons les blocs et remplaçons les tirets par des points. </font><font style="vertical-align: inherit;">Il peut y avoir une solution plus polyvalente ou élégante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous travaillons avec des notes:</font></font><br>
<br>
<pre><code class="javascript hljs">       <span class="hljs-comment">// ...</span>
       <span class="hljs-comment">//          ""</span>
       <span class="hljs-comment">//       </span>
       <span class="hljs-comment">//     /   </span>
       <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'.note'</span>).forEach(<span class="hljs-function"><span class="hljs-params">note</span> =&gt;</span> note.addEventListener(<span class="hljs-string">'click'</span>, event =&gt; {
        <span class="hljs-comment">//        "complete" (  )</span>
        <span class="hljs-keyword">if</span> (event.target.classList.contains(<span class="hljs-string">'complete'</span>)) {
            <span class="hljs-comment">// /    ( )  "line-through",    </span>
            event.target.nextElementSibling.classList.toggle(<span class="hljs-string">'line-through'</span>)<font></font>
<font></font>
            <span class="hljs-comment">//     </span>
            <span class="hljs-comment">//      "complete"</span>
            note.querySelector(<span class="hljs-string">'p'</span>).classList.contains(<span class="hljs-string">'line-through'</span>)<font></font>
                ? notes[note.dataset.id].completed = <span class="hljs-string">'line-through'</span>
                : notes[note.dataset.id].completed = <span class="hljs-string">''</span><font></font>
<font></font>
            <span class="hljs-comment">//    </span>
            db.transaction(<span class="hljs-string">'notes'</span>, <span class="hljs-string">'readwrite'</span>)<font></font>
                .objectStore(<span class="hljs-string">'notes'</span>)<font></font>
                .put(notes[note.dataset.id])<font></font>
<font></font>
        <span class="hljs-comment">//        "delete" (  )</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.target.classList.contains(<span class="hljs-string">'delete'</span>)) {
            <span class="hljs-comment">//          </span>
            <span class="hljs-comment">//  ,     id  </span><font></font>
            deleteNote(+note.dataset.id)<font></font>
<font></font>
        <span class="hljs-comment">//        "info" (   )</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.target.classList.contains(<span class="hljs-string">'info'</span>)) {
            <span class="hljs-comment">// /    ( )  "show",   </span>
            event.target.previousElementSibling.classList.toggle(<span class="hljs-string">'show'</span>)<font></font>
        }<font></font>
    }))<font></font>
<font></font>
    <span class="hljs-comment">//   </span><font></font>
    checkDeadline(dates)<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction pour supprimer une note de la liste et du stockage ressemble à ceci:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> deleteNote = <span class="hljs-keyword">async</span> key =&gt; {
    <span class="hljs-comment">//        ()</span>
    <span class="hljs-keyword">await</span> db.transaction(<span class="hljs-string">'notes'</span>, <span class="hljs-string">'readwrite'</span>)<font></font>
        .objectStore(<span class="hljs-string">'notes'</span>)<font></font>
        .delete(key)<font></font>
    <span class="hljs-keyword">await</span> createList()<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre application n'a pas la possibilité de supprimer la base de données, mais la fonction correspondante pourrait ressembler à ceci:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.delete-btn'</span>).onclick = <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">await</span> idb.deleteDb(<span class="hljs-string">'dataBase'</span>)
        <span class="hljs-comment">//  </span><font></font>
        .then(location.reload())<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction de vérification des rappels compare la date actuelle et les dates de rappel saisies par l'utilisateur:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> checkDeadline = <span class="hljs-keyword">async</span> dates =&gt; {
    <span class="hljs-comment">//      ".."</span>
    <span class="hljs-keyword">let</span> today = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleDateString()}</span>`</span><font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    dates.forEach(<span class="hljs-function"><span class="hljs-params">date</span> =&gt;</span> {
        <span class="hljs-comment">//         </span>
        <span class="hljs-keyword">if</span> (date.date === today) {
            <span class="hljs-comment">//      "?"  "!"</span>
            <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">`div[data-id="<span class="hljs-subst">${date.id}</span>"] .info`</span>).textContent = <span class="hljs-string">'!'</span><font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, ajoutez un gestionnaire d'erreurs à l'objet Window qui n'a pas été traité dans les blocs de code correspondants:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'unhandledrejection'</span>, event =&gt; {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'error: '</span> + event.reason.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat ressemble à ceci:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://codepen.io/igor_agapov/embed/preview/VwvrVxq" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ Code sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Voici une application similaire sur le stockage local:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://codepen.io/igor_agapov/embed/preview/KKdyNMY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ Le code de cette application sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
je serai heureux de tout commentaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de votre attention.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr500294/index.html">5 outils gratuits de productivité pour les développeurs Web</a></li>
<li><a href="../fr500300/index.html">Traçage du silicium au format hackathon. Sans conception physique, pas d'iPhone</a></li>
<li><a href="../fr500304/index.html">Comprendre la grille CSS (partie 2): lignes de grille</a></li>
<li><a href="../fr500308/index.html">Événements numériques à Moscou du 4 au 10 mai</a></li>
<li><a href="../fr500310/index.html">Automatisation de l'identification des modifications à l'image des documents contractuels à l'aide du modèle N-gramme</a></li>
<li><a href="../fr500314/index.html">PHP Digest n ° 179 (21 avril - 4 mai 2020)</a></li>
<li><a href="../fr500316/index.html">Nouvelle version d'Apple et de Google Contact Tracing Protocol</a></li>
<li><a href="../fr500318/index.html">HP Elite Dragonfly - quel type d'ordinateur portable Athena êtes-vous?</a></li>
<li><a href="../fr500320/index.html">Propres moteurs de jeu: un peu de recherche</a></li>
<li><a href="../fr501090/index.html">K8S Multicluster Journey</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>