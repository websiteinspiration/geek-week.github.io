<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüè≠ üë®‚Äçüé® üçì Otimiza√ß√£o de string no ClickHouse. Relat√≥rio Yandex ü¶è üå† üêñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O mecanismo de banco de dados anal√≠tico ClickHouse processa muitas linhas diferentes, consumindo recursos. Para acelerar o sistema, novas otimiza√ß√µes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Otimiza√ß√£o de string no ClickHouse. Relat√≥rio Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/492868/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mecanismo de banco de dados anal√≠tico ClickHouse processa muitas linhas diferentes, consumindo recursos. </font><font style="vertical-align: inherit;">Para acelerar o sistema, novas otimiza√ß√µes s√£o adicionadas constantemente. </font><font style="vertical-align: inherit;">Nikolay Kochetov, desenvolvedor do ClickHouse, fala sobre o tipo de dados da string, incluindo o novo tipo, LowCardinality, e explica como acelerar o trabalho com strings.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/rqf-ILRgBdY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Primeiro, vamos ver como voc√™ pode armazenar strings. </font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ch/9s/zs/ch9szsqfnkkvpmjjxoo0lmpacno.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos tipos de dados de string. </font><font style="vertical-align: inherit;">A string funciona bem por padr√£o, deve ser usada quase sempre. </font><font style="vertical-align: inherit;">Possui uma pequena sobrecarga - 9 bytes por linha. </font><font style="vertical-align: inherit;">Se queremos que o tamanho da linha seja corrigido e conhecido com anteced√™ncia, √© melhor usar o FixedString. </font><font style="vertical-align: inherit;">Nele, voc√™ pode definir o n√∫mero de bytes que precisamos; √© conveniente para dados como endere√ßos IP ou fun√ß√µes de hash. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/lx/mo/rdlxmobm0ch5l88ab74sszn_fps.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, √†s vezes algo diminui a velocidade. </font><font style="vertical-align: inherit;">Suponha que voc√™ esteja fazendo uma consulta em uma tabela. </font><font style="vertical-align: inherit;">O ClickHouse l√™ uma quantidade bastante grande de dados, digamos, a uma velocidade de 100 GB / s, com poucas linhas sendo processadas. </font><font style="vertical-align: inherit;">Temos duas tabelas que armazenam quase os mesmos dados. </font><font style="vertical-align: inherit;">O ClickHouse l√™ os dados da segunda tabela em uma velocidade mais alta, mas l√™ tr√™s vezes menos linhas por segundo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/tz/6l/ndtz6l6-1pwaycgcoxhslfj2hcm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se observarmos o tamanho dos dados compactados, ser√° quase igual. De fato, os mesmos dados s√£o gravados nas tabelas - o primeiro bilh√£o de n√∫meros - somente na primeira coluna s√£o gravados na forma de UInt64 e na segunda coluna em String. Por esse motivo, a segunda consulta l√™ os dados do disco por mais tempo e os descompacta. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i8/a2/vf/i8a2vfterxcfto5foypz6tig3zy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° outro exemplo. Suponha que exista um conjunto predeterminado de linhas, que esteja limitado a uma constante de 1000 ou 10.000 e quase nunca mude. Nesse caso, o tipo de dados Enum √© adequado para n√≥s, no ClickHouse existem dois deles - Enum8 e Enum16. Devido ao armazenamento no Enum, processamos solicita√ß√µes rapidamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ClickHouse possui acelera√ß√µes para GROUP BY, IN, DISTINCT e otimiza√ß√µes para algumas fun√ß√µes, por exemplo, para compara√ß√£o com uma string constante. Obviamente, os n√∫meros na string n√£o s√£o convertidos, mas, pelo contr√°rio, a string constante √© convertida no valor Enum. Depois disso, tudo √© comparado rapidamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas tamb√©m h√° desvantagens. Mesmo que conhe√ßamos o conjunto exato de linhas, √†s vezes ele precisa ser reabastecido. Chegou uma nova linha - temos que fazer ALTER. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b0/ay/sz/b0ayszedkf252ktki2xizo2fxfm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ALTER para Enum no ClickHouse √© implementado de maneira ideal. N√£o sobrescrevemos os dados no disco, mas ALTER pode ficar lento devido ao fato de que as estruturas Enum s√£o armazenadas no esquema da pr√≥pria tabela. Portanto, devemos aguardar solicita√ß√µes de leitura da tabela, por exemplo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A quest√£o √©: algu√©m pode fazer melhor? Talvez sim. Voc√™ pode salvar a estrutura Enum n√£o no esquema da tabela, mas no ZooKeeper. No entanto, podem ocorrer problemas de sincroniza√ß√£o. Por exemplo, uma r√©plica recebeu dados, a outra n√£o, e se tiver um Enum antigo, algo ser√° interrompido. (No ClickHouse, quase conclu√≠mos as solicita√ß√µes ALTER sem bloqueio. Quando as conclu√≠mos completamente, n√£o precisamos aguardar solicita√ß√µes de leitura.) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yf/rc/vj/yfrcvjamitxxi5taditsaouvrl4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o mexer com o ALTER Enum, voc√™ pode usar dicion√°rios ClickHouse externos. Deixe-me lembr√°-lo de que essa √© uma estrutura de dados de valor-chave dentro do ClickHouse, com a qual voc√™ pode obter dados de fontes externas, por exemplo, de tabelas MySQL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No dicion√°rio ClickHouse, armazenamos muitas linhas diferentes e, na tabela, seus identificadores na forma de n√∫meros. Se precisamos obter uma string, chamamos a fun√ß√£o dictGet e trabalhamos com ela. Depois disso, n√£o devemos fazer ALTER. Para adicionar algo ao Enum, inserimos isso na mesma tabela MySQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas existem outros problemas. Em primeiro lugar, a sintaxe estranha. Se queremos obter uma string, devemos chamar dictGet. Em segundo lugar, a falta de algumas otimiza√ß√µes. A compara√ß√£o com a cadeia constante de dicion√°rios tamb√©m n√£o √© r√°pida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainda pode haver problemas com a atualiza√ß√£o. Suponha que solicitamos uma linha no dicion√°rio de cache, mas ela n√£o entrou no cache. Ent√£o temos que esperar at√© que os dados sejam carregados de uma fonte externa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/4z/ii/em4ziibqzsukh-mvfu2o8dpncv0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma desvantagem comum de ambos os m√©todos √© que armazenamos todas as chaves em um √∫nico local e as sincronizamos. </font><font style="vertical-align: inherit;">Ent√£o, por que n√£o armazenar dicion√°rios localmente? </font><font style="vertical-align: inherit;">Sem sincroniza√ß√£o - n√£o h√° problema. </font><font style="vertical-align: inherit;">Voc√™ pode armazenar o dicion√°rio localmente em uma pe√ßa no disco. </font><font style="vertical-align: inherit;">Ou seja, fizemos Inser√ß√£o, gravamos um dicion√°rio. </font><font style="vertical-align: inherit;">Se trabalharmos com dados na mem√≥ria, podemos escrever um dicion√°rio em um bloco de dados ou em um peda√ßo de uma coluna ou em algum cache para acelerar os c√°lculos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codifica√ß√£o de Cadeia de Vocabul√°rio </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o chegamos √† cria√ß√£o de um novo tipo de dados no ClickHouse - LowCardinality. Este √© um formato para armazenar dados: como eles s√£o gravados em disco e como s√£o lidos, como s√£o apresentados na mem√≥ria e o esquema de seu processamento. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/se/5h/5e/se5h5er0yccult4fjfamsksw4rk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem duas colunas no slide. √Ä direita, as strings s√£o armazenadas de maneira padr√£o no tipo String. Pode-se ver que esses s√£o alguns tipos de modelos de telefones celulares. √Ä esquerda, h√° exatamente a mesma coluna, apenas no tipo LowCardinality. Consiste em um dicion√°rio com muitas linhas diferentes (linhas da coluna √† direita) e uma lista de posi√ß√µes (n√∫meros de linhas). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando essas duas estruturas, voc√™ pode restaurar a coluna original. H√° tamb√©m um √≠ndice inverso inverso - uma tabela de hash que ajuda a encontrar a posi√ß√£o no dicion√°rio por linha. √â necess√°rio acelerar algumas consultas. Por exemplo, se quisermos comparar, procure uma linha em nossa coluna ou junte-as.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LowCardinality √© um tipo de dados param√©trico. Pode ser um n√∫mero, ou algo que √© armazenado como um n√∫mero, ou uma sequ√™ncia ou Anul√°vel a partir deles. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/et/r4/h9/etr4h9fjutj5sf6ffxqjmf04xpu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A peculiaridade do LowCardinality √© que ele pode ser salvo para algumas fun√ß√µes. Um exemplo de solicita√ß√£o √© mostrado no slide. Na primeira linha, criei uma coluna do tipo LowCardinality da String, com o nome S. Em seguida, perguntei o nome dela - ClickHouse disse que era LowCardinality da String. Tudo certo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A terceira linha √© quase a mesma, apenas chamamos de fun√ß√£o length. No ClickHouse, a fun√ß√£o length retorna o tipo de dados UInt64. Mas obtivemos LowCardinality do UInt64. Qual √© o objetivo?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/hs/0x/6hhs0xgy2-hnsc8tputwp8ukqqu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dicion√°rio cont√©m os nomes dos telefones celulares, aplicamos a fun√ß√£o length. Agora, temos um dicion√°rio semelhante, composto apenas por n√∫meros, esses s√£o os comprimentos das strings. A coluna com as posi√ß√µes n√£o mudou. Como resultado, processamos menos dados, economizamos no tempo de solicita√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode haver outras otimiza√ß√µes, como adicionar um cache simples. Ao calcular o valor de uma fun√ß√£o, voc√™ pode lembr√°-la e torn√°-la a mesma, n√£o recalcule.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A otimiza√ß√£o de GROUP BY tamb√©m pode ser feita, porque nossa coluna com o dicion√°rio j√° est√° parcialmente agregada - voc√™ pode calcular rapidamente o valor das fun√ß√µes de hash e encontrar aproximadamente o intervalo onde colocar a pr√≥xima linha. Voc√™ tamb√©m pode especializar algumas fun√ß√µes agregadas, por exemplo, uniq, porque voc√™ pode enviar apenas um dicion√°rio para ele e deixar as posi√ß√µes intocadas - dessa forma, tudo funcionar√° mais r√°pido. As duas primeiras otimiza√ß√µes que j√° adicionamos ao ClickHouse.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kc/6u/v4/kc6uv48b2vbsmki20ckwvvbc990.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas e se criarmos uma coluna com nosso tipo de dados e inserirmos muitas linhas diferentes incorretas? Nossa mem√≥ria est√° cheia? N√£o, existem duas configura√ß√µes especiais para isso no ClickHouse. O primeiro √© low_cardinality_max_dictionary_size. Esse √© o tamanho m√°ximo de um dicion√°rio que pode ser gravado no disco. A inser√ß√£o ocorre da seguinte forma: quando inserimos os dados, um fluxo de linhas chega at√© n√≥s, a partir deles formamos um grande dicion√°rio geral. Se o dicion√°rio se tornar maior que o valor definido, gravamos o dicion√°rio atual no disco e o restante das linhas em algum lugar do lado, pr√≥ximo aos √≠ndices. Como resultado, nunca recontaremos um dicion√°rio grande e n√£o obteremos problemas de mem√≥ria.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda configura√ß√£o √© chamada low_cardinality_use_single_dictionary_for_part. Imagine que no esquema anterior, quando inserimos os dados, nosso dicion√°rio estava cheio e os escrevemos em disco. Surge a pergunta: por que n√£o formar outro exatamente exatamente o mesmo dicion√°rio? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando ela estourar, novamente a gravaremos no disco e come√ßaremos a formar uma terceira. Essa configura√ß√£o apenas desativa esse recurso por padr√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, muitos dicion√°rios podem ser √∫teis se quisermos inserir algum conjunto de linhas, mas inserir "lixo" acidentalmente. Digamos que primeiro inserimos as linhas ruins e depois inserimos as boas. Em seguida, o dicion√°rio ser√° dividido em muitos pequenos dicion√°rios. Alguns deles estar√£o com lixo, mas o √∫ltimo estar√° com boas linhas. E se lermos, digamos, apenas o √∫ltimo pellet, tudo tamb√©m funcionar√° rapidamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/jx/jb/jcjxjbo7vmgmexmzxryscvj0lhu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de falar sobre as vantagens do LowCardinality, direi imediatamente que √© improv√°vel que obtenhamos dados reduzidos no disco (embora isso possa acontecer), porque o ClickHouse compacta os dados. Existe uma op√ß√£o padr√£o - LZ4. Voc√™ tamb√©m pode fazer a compacta√ß√£o usando o ZSTD. Como os dois algoritmos j√° implementam a compacta√ß√£o de dicion√°rio, nosso dicion√°rio ClickHouse externo n√£o ajuda muito.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o ser infundado, peguei alguns dados da m√©trica - String, LowCardinality (String) e Enum - e os salvei em diferentes tipos de dados. </font><font style="vertical-align: inherit;">Foram tr√™s colunas, onde um bilh√£o de linhas √© gravado. </font><font style="vertical-align: inherit;">A primeira coluna, CodePage, possui um total de 62 valores. </font><font style="vertical-align: inherit;">E voc√™ pode ver que em LowCardinality (String), eles os pressionavam melhor. </font><font style="vertical-align: inherit;">A string √© um pouco pior, mas isso provavelmente ocorre porque as strings s√£o curtas, armazenamos seus comprimentos e elas ocupam muito espa√ßo e n√£o s√£o compactadas bem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ usar o PhoneModel, existem mais de 48 mil e quase n√£o h√° diferen√ßas entre String e LowCardinality (String). </font><font style="vertical-align: inherit;">Para o URL, tamb√©m salvamos apenas 2 GB - acho que voc√™ n√£o deve confiar nisso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estimativa da velocidade do trabalho</font></font></h3> <br>
<img src="https://habrastorage.org/webt/3q/v7/ar/3qv7aronmenayqfhdjait6xo3tw.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora vamos avaliar a velocidade do trabalho. Para avaliar, usei um conjunto de dados descrevendo viagens de t√°xi em Nova York. Est√°</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dispon√≠vel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no GitHub. Tem um pouco mais de um bilh√£o de viagens. Ele mostra a localiza√ß√£o, o hor√°rio de in√≠cio e t√©rmino da viagem, a forma de pagamento, o n√∫mero de passageiros e at√© o tipo de t√°xi - verde, amarelo e Uber.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2o/9n/qb/2o9nqbsb7dodtnoimgnnl66lhlg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fiz a primeira solicita√ß√£o bastante simples - perguntei onde os t√°xis s√£o mais pedidos. Para fazer isso, √© necess√°rio escolher o local de onde voc√™ solicitou, fazer GROUP BY e calcular a fun√ß√£o de contagem. Aqui ClickHouse d√° algo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/te/uy/kz/teuykz6_ucr7tuklbfsnobntncc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para medir a velocidade do processamento de consultas, criei tr√™s tabelas com os mesmos dados, mas usei tr√™s tipos de dados diferentes para a nossa localiza√ß√£o inicial - String, LowCardinality e Enum. LowCardinality e Enum s√£o cinco vezes mais r√°pidos que String. O enum √© mais r√°pido porque funciona com n√∫meros. Baixa cardinalidade - porque a otimiza√ß√£o GROUP BY est√° implementada. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pl/mx/qr/plmxqrgggpwl4xp2quqggej847k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos complicar a solicita√ß√£o - pergunte onde fica o parque mais popular de Nova York. Novamente, mediremos isso onde o t√°xi √© mais frequentemente solicitado, mas, ao mesmo tempo, filtraremos apenas os locais onde a palavra "parque" est√° dispon√≠vel. Adicione tamb√©m uma fun√ß√£o similar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0u/iq/bz/0uiqbzwkh280_wuzn8bccqg2lhi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observamos o momento - vemos que Enum de repente come√ßou a desacelerar. E funciona ainda mais lentamente que o tipo de dados String padr√£o. Isso ocorre porque a fun√ß√£o like n√£o √© totalmente otimizada para o Enum. Temos que converter nossas linhas de Enum em linhas regulares - trabalhamos mais. LowCardinality (String) tamb√©m n√£o √© otimizado por padr√£o, mas funciona como no dicion√°rio, portanto, a consulta √© mais r√°pida em compara√ß√£o com String. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° um problema mais global com o Enum. Se queremos otimiz√°-lo, devemos faz√™-lo em todos os lugares do c√≥digo. Suponha que escrevemos uma nova fun√ß√£o - voc√™ deve definitivamente criar otimiza√ß√µes para o Enum. E no LowCardinality, tudo √© otimizado por padr√£o.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_j/oc/eq/_joceq5ioy66p6gjatm1l5f2rqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos o √∫ltimo pedido, mais artificial. </font><font style="vertical-align: inherit;">Simplesmente calcularemos a fun√ß√£o hash da nossa localiza√ß√£o. </font><font style="vertical-align: inherit;">A fun√ß√£o hash √© uma solicita√ß√£o bastante lenta, leva muito tempo e, portanto, tudo fica mais lento tr√™s vezes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dn/06/x9/dn06x9ujvdxgdpmjcus8qzlccbg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A baixa cardinalidade ainda √© mais r√°pida, embora n√£o haja filtragem. </font><font style="vertical-align: inherit;">Isso se deve ao fato de que nossas fun√ß√µes funcionam apenas no dicion√°rio. </font><font style="vertical-align: inherit;">A fun√ß√£o de c√°lculo de hash possui um argumento - pode processar menos dados e tamb√©m pode retornar LowCardinality. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/63/yt/qz/63ytqzwuufiatce0y8wdy4whn5s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosso plano global √© atingir uma velocidade n√£o inferior √† de String em qualquer caso e economizar acelera√ß√£o. </font><font style="vertical-align: inherit;">E talvez um dia substituamos String por LowCardinality, voc√™ atualize o ClickHouse e tudo funcionar√° um pouco mais r√°pido.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt492850/index.html">Nem todo mundo quer mudar para o trabalho remoto</a></li>
<li><a href="../pt492856/index.html">Covid19, Sua sociedade e voc√™ s√£o do ponto de vista da Ci√™ncia de Dados. Artigo traduzido por Jeremy Howard e Rachel Thomas (fast.ai)</a></li>
<li><a href="../pt492862/index.html">15 melhores dicas de ajuste de desempenho do Oracle APEX para desenvolvedores</a></li>
<li><a href="../pt492864/index.html">Posso invadir um navio?</a></li>
<li><a href="../pt492866/index.html">O livro "Machine Learning sem palavras"</a></li>
<li><a href="../pt492872/index.html">Como organizar o acesso remoto e n√£o sofrer hackers</a></li>
<li><a href="../pt492874/index.html">Otimiza√ß√£o de renderiza√ß√£o para celular</a></li>
<li><a href="../pt492878/index.html">Chinelos geek: procurando resultados positivos em fechamentos tempor√°rios de escrit√≥rios</a></li>
<li><a href="../pt492880/index.html">O que devemos construir uma casa inteligente?</a></li>
<li><a href="../pt492884/index.html">Recebendo mensagens de transmiss√µes do youtube + autoriza√ß√£o do google em PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>