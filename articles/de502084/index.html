<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçü§ù‚Äçüë®üèæ üìÇ üçø √úberpr√ºfung des Portals der regionalen √∂ffentlichen Dienste unter Last durch Puppenspieler ‚ûï üò• ‚õ∫Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Auch Sie beobachten neugierig das "Epos des amerikanischen Wilden Westens √ºber die Verteilung von Grundst√ºcken - gehen Sie zuerst und kleb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>√úberpr√ºfung des Portals der regionalen √∂ffentlichen Dienste unter Last durch Puppenspieler</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502084/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! Auch Sie beobachten neugierig das "Epos des amerikanischen Wilden Westens √ºber die Verteilung von Grundst√ºcken - gehen Sie zuerst und kleben Sie eine Flagge zum Abstecken" oder nehmen Sie vielleicht sogar daran teil. Genauer gesagt in seiner modernen Version - seien Sie der Erste, der √∂ffentliche Dienste beantragt, um Geld f√ºr Kinder zu erhalten, oder erhalten Sie einen Pass, um das Haus zu verlassen. In Anbetracht dessen m√∂chte ich die Erfahrungen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unseres Teams</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beim Testen und bei der Vorbereitung eines regionalen Serviceportals f√ºr die Bereitstellung des Dienstes ‚ÄûFirst Class Record‚Äú </font><font style="vertical-align: inherit;">teilen </font><font style="vertical-align: inherit;">. Es ist auch dem Habra-Effekt sehr √§hnlich und war, glaube ich, dem nahe, was vor ein paar Tagen mit dem Bundesportal gosuslugi.ru passiert ist, aber auf regionaler Ebene.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben diese Herausforderung im Januar dieses Jahres in Chabarowsk bestanden und k√ºrzlich an der Vorbereitung eines √§hnlichen Dienstes f√ºr die Erteilung von Jagdgenehmigungen in einer anderen Region teilgenommen. Im Folgenden finden Sie eine kleine Erfahrung, die Ihnen die M√∂glichkeit gibt, das Thema der Vorbereitung der Arbeit regionaler Portale f√ºr √∂ffentliche Dienste auf Spitzenzeiten aus einer anderen Perspektive zu betrachten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und f√ºr den Anfang - ein Foto eines schwarzen Busses, der drei Tage lang rund um die Uhr in der Schule Dienst hatte, auf dem der Autor dieser Zeilen vor drei Jahren seine Wendung unter den Eltern best√§tigte. Zumindest sind unsere Eltern zusammengekommen. Im Winter in Chabarowsk bei -30 Grad zuzusehen, ist immer noch ein Vergn√ºgen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o8/vh/rb/o8vhrboqvtrufnftfwxsxb1rgm4.png" alt="Bild"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Vorbereitung auf die Spitzenaufnahme in der ersten Klasse arbeiteten mehrere Teams, weil </font><font style="vertical-align: inherit;">Auf die eine oder andere Weise ist es daran beteiligt: ‚Äã‚Äãder Rechenzentrumsbetreiber, der Betreiber und der Entwickler des regionalen Portalinformationssystems, der Betreiber und der Entwickler des integrierten Bildungsinformationssystems, technische Unterst√ºtzung f√ºr die Benutzer des regionalen Portals. </font><font style="vertical-align: inherit;">Wir bei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iondv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºhren die letzte Aufgabe aus, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">indem</font></a><font style="vertical-align: inherit;"> wir den </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Zustand</font></a><font style="vertical-align: inherit;"> des Portals unabh√§ngig √ºberwachen und Benutzer unterst√ºtzen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Rolle bei der Vorbereitung besteht darin, Tests und Empfehlungen zum Zwischenspeichern von Konfigurationen in Nginx zu organisieren. Au√üerdem haben wir Anweisungen f√ºr Benutzer mit dem empfohlenen ‚ÄûVerhalten‚Äú vorbereitet.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr diejenigen, die das Problem des Schreibens in der 1. Klasse nicht kennen</font></font></b>
                        <div class="spoiler_text">         ,    .  .          ,     ,   -     (      ,   ‚Äî      ),    ,  -     ,   ,            .  ,       ,      ,     ‚Äì    ,        .           .<br>
<br>
     1-          ,    .           0:00 ,        10:00 26 . ,    ‚Äì       .        10:00 ,       ‚Äî    ,      - .<br>
<br>
            .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"></a>    .   2017 .     .         ,    ,    .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Service f√ºr eine nachgefragte Ressource als technische Aufgabe</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem bei Diensten wie ‚ÄûSchreiben in die 1. Klasse‚Äú im Integralindikator f√ºr die Last (oder Wahrscheinlichkeit von Abfragen), die zur ‚ÄûDelta-Funktion‚Äú (Œ¥-Funktion, Dirac-Funktion) tendiert, ist in den Diagrammen in Form von Peaks deutlich sichtbar. In diesem Moment gibt es in kurzer Zeit eine mehrfache Zunahme von Anrufen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0l/uc/c6/0lucc67w9pr4uh2ig1swg5tgtq0.png" alt="Œ¥-Funktions- und Peak-Abfragestatistik"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Erfahrung zeigt, dass die Hauptaufgabe des Trainings nicht darin besteht, die Ressourcen zu erh√∂hen. Die Aufgabe besteht darin, die potenzielle Anzahl von Anforderungen pro Sekunde zu minimieren, sie f√ºr einige Zeit zu verl√§ngern und das System auf die verbleibende Last vorzubereiten. In diesem Fall m√ºssen Engp√§sse gefunden und beschleunigt werden - dies ergibt den gr√∂√üten Effekt gem√§√ü den Prinzipien der Theorie der begrenzten Systeme (Goldratt-Prinzipien). Und sonst ist es der Engpass, der scheitern wird. Das ganze System sollte von ihm funktionieren: das Prinzip des "Trommel-Puffer-Seils".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist physikalisch unm√∂glich, das gesamte Volumen in 10 Minuten Sanduhr in 1 Minute zu versch√ºtten - es ist offensichtlich, dass sie zusammenbrechen werden. </font><font style="vertical-align: inherit;">√Ñhnliches gilt f√ºr die Erbringung von Dienstleistungen. </font><font style="vertical-align: inherit;">Es √ºberrascht niemanden - wenn MFC und Skandale an der Reihe sind, Dienste zu erhalten, aber es √ºberrascht alle -, warum das Portal zusammengebrochen ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt verschiedene Muster des Lasthandhabungsverhaltens gegen√ºber der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warteschlangentheorie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen Benutzer in die Warteschleife stellen, d. H. </font><font style="vertical-align: inherit;">Erh√∂hen Sie die Warteschlange.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie k√∂nnen sich einfach weigern, diejenigen zu bedienen, die sp√§ter gekommen sind, bis die vorherigen verarbeitet wurden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie k√∂nnen versuchen, die Produktivit√§t endlos zu steigern.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zweckm√§√üigkeit liegt irgendwo dazwischen. In der Tat ist f√ºr einen Dienst mit einer begrenzten Ressource, die von einer Region oder einem Staat bereitgestellt wird, nicht nur die Geschwindigkeit wichtig, sondern vor allem die Wahrung der sozialen Gerechtigkeit - d. H. gleiche Bedingungen f√ºr alle. Gleichzeitig - wenn der Benutzer nicht das erhalten hat, was er ben√∂tigt, initiiert er eine neue Anfrage. In diesem Fall wachsen die Anforderungen in einer Lawine und bilden ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angriffsmodell f√ºr den ‚Äû</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dog-Pile-Effekt </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">‚Äú</font></a><font style="vertical-align: inherit;"> (Dog-Pile-Effekt, Cache-Stampede, Hit-Miss-Storm). Der Benutzer hat die Anforderung bereits abgebrochen und eine neue initiiert, w√§hrend sich die vorherige noch in der zu verarbeitenden Warteschlange befindet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Prozess verst√§rkt die Tatsache, dass ganze Familien an der Einreichung teilnehmen - Vater und Mutter f√ºllen gleichzeitig Antr√§ge aus und reichen Antr√§ge h√§ufig mehrmals aus Gr√ºnden der Zuverl√§ssigkeit ein. </font><font style="vertical-align: inherit;">Und au√üerdem oft auch in mehreren Registerkarten und mehreren Browsern. </font><font style="vertical-align: inherit;">Daher ist es normalerweise sinnvoll, die erwartete Spitzenlast mit dem 2-3-fachen der Anzahl derjenigen zu multiplizieren, die sich tats√§chlich f√ºr solche Dienste bewerben.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√ºckzug der Gerechtigkeit</font></font></b>
                        <div class="spoiler_text">,   ¬´¬ª,            .   ?  ¬´¬ª    ,    .   .     ‚Äî        ,     .        ¬´ ¬ª.        .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisation der Leistungserbringung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die erwartete Anzahl der Bewerber anhand einer Kombination aus Daten zur Gesamtzahl der im letzten Jahr eingereichten Bewerbungen und Daten pro Minute f√ºr andere Regionen berechnet. </font><font style="vertical-align: inherit;">In der Regel liegt der Spitzenwert der Anwendungen bei 5 bis 10 Minuten, auch weil die Portale in den ersten drei bis f√ºnf Minuten fast nicht reagieren und sp√§tere Benutzer das Formular 1 bis 5 Minuten ausf√ºllen (wundern Sie sich nicht, viele f√ºllen das Telefon auch unter solchen ‚Äûnerv√∂sen‚Äú Bedingungen aus). . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein ungef√§hres Berechnungsmodell f√ºr die bedingten 1000 Anwendungen pro Stunde lautet wie folgt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Spitzenzeit von 5 bis 10 Minuten ab dem Start und 80% der Antr√§ge werden nach der Paretto-Regel eingereicht</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Herk√∂mmlicherweise planen wir 160 Anwendungen pro Minute oder 3 Anwendungen pro Sekunde.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich erfolgte die erste Einreichung nach einer Minute und 45 Sekunden, und die Spitze der Bewerbungen ging von 4 Minuten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Belastung von ESIA und des Systems durch das Generieren von Autorisierungssitzungen zu verringern, wurde in den Anweisungen empfohlen, dass sich Benutzer im Voraus anmelden und die Sitzungslebensdauer verl√§ngern. </font><font style="vertical-align: inherit;">Tats√§chlich wurden 50% in 1 Stunde und ~ 90% in einer halben Stunde genehmigt. </font><font style="vertical-align: inherit;">Wir haben bereits fr√ºher festgestellt, dass sich Benutzer 10 Minuten vor dem Start des Dienstes beim Portal anmelden - und die Autorisierung begann instabil zu funktionieren. </font><font style="vertical-align: inherit;">Es ist schwer zu sagen warum. </font><font style="vertical-align: inherit;">Vielleicht liegt der Grund darin, dass wir in Chabarowsk, wenn nachts technische Arbeiten in Moskau ausgef√ºhrt werden, erst den Beginn des Arbeitstages haben.</font></font><br>
 <br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√ºckzug √ºber Unterricht und organisatorische Vorkehrungen</font></font></b>
                        <div class="spoiler_text">            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"></a>.<br>
<br>
         ,    ¬´ ¬ª     . ..      .       ,   -   .. <br>
<br>
    ,        ,         ,    .        -        .      ,       ,      .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist unm√∂glich, die "Delta-Funktion" zu entfernen, wenn das Formular um 00:00 Uhr neu geladen wird. Der springende Punkt dieses Verfahrens ist, dass der Dienst zu einem bestimmten Zeitpunkt angezeigt wird. Sie k√∂nnen jedoch versuchen, die Anzahl der Browseranforderungen auf allen erwarteten Benutzerrouten zu reduzieren und so das System nur von den erforderlichen zu belasten - Formular, dynamische Verzeichnisse und sendende Anwendungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nginx-Einstellungen selbst sind ziemlich Standard. Hier ist es wichtiger, die Einschr√§nkungen zu w√§hlen, denen das System standhalten kann. Hebe sie auf - d.h. Starten Sie Warteschlangenanforderungen, wenn der Server voraussichtlich an seine Grenzen st√∂√üt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, und vor allem haben wir das Caching (proxy_cache) erzwungen und die Lebensdauer der "abgelaufenen" Daten in nginx f√ºr alle statischen Pfade und, soweit m√∂glich, dynamischen Seiten, auf denen keine Sitzungen vorhanden sind, erh√∂ht. √úbrigens ist dies ein h√§ufiger Fehler beim Caching - beim Schreiben in die Cache-Daten (manchmal sogar in statische Daten), in denen die Sitzung eines anderen gespeichert ist, werden diese Cookies normalerweise aus den Headern gel√∂scht, wenn der Server die Datentypen nicht trennen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Browser f√ºr den Benutzer sieht es so aus, als w√ºrden Seiten aus Dateien aktualisiert, die von der Festplatte oder vom Speicher heruntergeladen wurden. Aber selbst wenn der Benutzer sie vom Server erh√§lt, werden sie aus dem Nginx-Cache entnommen. Die Verzeichnisse selbst werden nat√ºrlich im System selbst zwischengespeichert.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/oq/nv/qioqnv0ofdjd5e0ygculnetdta4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies reduzierte die Anzahl potenzieller Anfragen von 89 Anfragen auf 14 und das Volumen von 2,1 MB (f√ºr 1000 Benutzer, die die Seite aktualisiert haben, ist dies ein potenzieller Spitzenwert von 4 bis 8 Gbit / s) auf 38 KB (wir alle erinnern uns an das Webpack, f√ºr Unternehmensplattformen jedoch nicht immer leicht zu machen). Nach den Ergebnissen der Passage war es weiterhin erforderlich, nicht nur im System, sondern auch in Nginx einige der Verzeichnisse aus den Form- und dynamischen Klassifizierern zwischenzuspeichern, die zum Spitzenzeitpunkt nicht verwendet wurden, und die Lebensdauer f√ºr sie zu erzwingen. Und mit zunehmender Last ist es im Allgemeinen sinnvoll, die vollst√§ndig statische Hauptseite aufzurufen, auf der Benutzer zum gew√ºnschten Dienst weitergeleitet werden, oder eine separate Ressource f√ºr den Dienst zu erstellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Belastung beim Senden zu verringern, wurden Entw√ºrfe und das automatische Ausf√ºllen von Daten f√ºr das Kind deaktiviert. Alle Benutzer haben unterschiedliche Dateneingabegeschwindigkeiten, wodurch das Erscheinen eines Formulars, das vollst√§ndig zur √úbermittlung bereit ist, entf√§llt und die Delta-Funktion zum Senden von Antr√§gen vermieden wird - alle 1000 in einer Minute. Gleichzeitig wird die soziale Gerechtigkeit gewahrt, obwohl nat√ºrlich Beschwerden auftreten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde die Optimierung des Systems selbst nicht beschreiben - w√§hrend der Lasttests wurden Engp√§sse festgestellt - haupts√§chlich in DBMS-Abfragen und die Indizes und Abfragen selbst wurden optimiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die wahrscheinlich wichtigste Optimierung ist die Vereinfachung des Formulars. Was beeinflusst die Geschwindigkeit am meisten, wenn es in einem Formular implementiert wird?</font></font><br>
<br>
<ul>
<li>   ‚Äî   ,        ,      .    ‚Äî       5-10 (   iPhone         )   5-       375 /  (1       10 ,     <code>application/x-www-form-urlencoded </code>‚Äì  20 ),  100      625 /.           100/      ‚Äî        .   ,      ¬´  ¬ª.    ‚Äî     ?     ,     .    ,      ?</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anspruchsvolle F√ºhrer. </font><font style="vertical-align: inherit;">Die Last wird normalerweise mithilfe des FIAS- oder CLADR-Adressverzeichnisses erh√∂ht. </font><font style="vertical-align: inherit;">Die Probleme hier sind auf die Gr√∂√üe zur√ºckzuf√ºhren - FIAS ben√∂tigt bis zu 40 GB in der Datenbank und die Suche dauert einige Zeit. </font><font style="vertical-align: inherit;">Zehntelsekunden, aber multipliziert mit 1000 gleichzeitigen Anforderungen, laden jedes System. </font><font style="vertical-align: inherit;">Ohne besondere Vorbereitung, m√∂glicherweise in Form eines separaten Webdienstes und einer separaten Ressource, ist es schwierig, der Belastung standzuhalten. Daher verwenden sie h√§ufig ein einfaches Textfeld f√ºr die Adresse.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommen wir zu den Tests.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lasttest in Vorbereitung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Tests wurden √ºber Puppenspieler durchgef√ºhrt - indem Benutzeraktionen im Crominium-Browser emuliert wurden. </font><font style="vertical-align: inherit;">Yanedeks.tank und JMeter haben den Schutz vor Angriffen aufgehoben, weil sie viele der gleichen Arten von Anfragen generieren. </font><font style="vertical-align: inherit;">Dar√ºber hinaus stimmen diese Tests nur schwach mit dem Profil realer Abfragen √ºberein, wenn das Verhalten des Systems unter Last ge√§ndert wird. </font><font style="vertical-align: inherit;">Dar√ºber hinaus zwischenspeichern die Server Anforderungen, und es ist schwierig, einen Teil der darin enthaltenen Prozesse zu reproduzieren (z. B. Autorisierung). </font><font style="vertical-align: inherit;">√úbrigens </font><font style="vertical-align: inherit;">haben wir </font><font style="vertical-align: inherit;">von einem der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devDV-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seminare </font><font style="vertical-align: inherit;">eine Pr√§sentation mit einer Pr√§sentation √ºber die Verwendung von Puppenspielern zum Testen, einschlie√ülich </font><font style="vertical-align: inherit;">Laden, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link zum Video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zun√§chst haben wir ein Benutzerverhaltensprofil erstellt und die Prozedur in Schl√ºsselphasen unterteilt:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Massengenehmigung in ESIA</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einmalige Aktualisierung des Serviceformulars,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Massenfutter </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr jede Stufe haben wir einen eigenen Test durchgef√ºhrt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Letztes Jahr gab es in der Zulassungsphase bei ESIA Schwierigkeiten, aber es ist schwierig, sie in vollem Umfang zu testen. Das System ist extern, der Schutz vor Angriffen und Autorisierungsverboten wird ausgel√∂st. Es ist jedoch m√∂glich, ein Testprofil zu formulieren, um die Engp√§sse des zu testenden Systems genau zu testen. In der Regel ist dies die Anzahl gleichzeitig autorisierter Sitzungen und geplanter Autorisierungswerte pro Minute, die durch Empfehlungen geregelt werden k√∂nnen.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Test ist der Wrapper wichtig f√ºr die Organisation mehrerer Threads, wir verwenden den 'Puppenspieler-Cluster'. In der Regel ist es jedoch komplizierter, Ausnahmen zu behandeln und das Verhalten des Portals unter Last zu √§ndern. Oft werden Layoutelemente angezeigt, die zweimal angezeigt werden. Oder die Elemente werden nicht angezeigt, wenn einige Daten nicht wie erwartet geladen wurden. Dies sind alle Fehler, die Benutzer sehen und die Seite neu laden - was bedeutet, dass sie eine zus√§tzliche Last erstellen. Es gibt zwei M√∂glichkeiten: Implementieren der Ausnahmebehandlung im Test. Oder √§ndern Sie das Portal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Test selbst ist einfach. Unten finden Sie ein Fragment vom Klicken auf die Schaltfl√§che "Anmelden" im Serviceportal bis zur Eingabe von Daten in ESIA.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">await</span> page.waitForSelector(AUTH_AVAIL,{<span class="hljs-attr">timeout</span>:OPT_ELEM_WAIT_TIME});
<span class="hljs-keyword">const</span> needAuth = <span class="hljs-keyword">await</span> page.$(ELEM_AUTH_IN);
<span class="hljs-keyword">if</span> (!needAuth) <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`  `</span>));<font></font>
        <font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(AUTH_BUT, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.click(AUTH_BUT);
<span class="hljs-keyword">await</span> waitNewUrl(page, <span class="hljs-string">'https://esia.gosuslugi.ru/idp/rlogin?cc=bp'</span>, OPT_PAGE_WAIT_TIME);
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#mobileOrEmail'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">let</span> text = <span class="hljs-keyword">await</span> elemGetText(page, <span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt; div.detected &gt; div.left &gt; div.this-user'</span>);
<span class="hljs-keyword">if</span> (text) <font></font>
   text = text.replace(<span class="hljs-regexp">/ -\(\)/g</span>, <span class="hljs-string">''</span>);        
<span class="hljs-keyword">if</span> (text &amp;&amp; text.indexOf(user) === <span class="hljs-number">-1</span>) {
  <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'div.click-to-another &gt; a'</span>);
  <span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt;'</span> +
                <span class="hljs-string">' div.detected &gt; div.left &gt; div.this-user'</span>, OPT_ELEMENT_INVISIBLE);<font></font>
}<font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#password'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#mobileOrEmail'</span>, user);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#password'</span>, pwd);
<span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#loginByPwdButton'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√úberpr√ºfung der Aktualisierung des Antragsformulars, bis Benutzer "den Datensatz √∂ffnen". Der Neustarttest besteht im Wesentlichen aus einem Schritt. Es ist jedoch wichtig, die zur√ºckgegebenen Fehlertypen zu √ºberpr√ºfen. Das Netzwerk ist ein Problem, ein Nginx-Fehler, ein Serverfehler und ob das Formular die Kriterien erf√ºllt. Die Schwierigkeit besteht darin, das maximale Anforderungsvolumen in k√ºrzester Zeit zu generieren und nicht unter die Schutzbeschr√§nkungen zu fallen (w√§hrend der Tests kann es jedoch ge√§ndert werden, andererseits wird auch die Einstellung der Netzwerk- und Serverinfrastruktur und der WAF √ºberpr√ºft). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solche Tests an Puppenspielern erfordern eine Menge Ressourcen, um zu arbeiten. De facto stellte sich heraus, dass Sie mindestens 2 Kerne gegen den 1. Kern des Front-End-Subsystems und einen sehr breiten Kanal ben√∂tigen. Aber wenn Sie sie in der Cloud mieten - das ist ziemlich erschwinglich. Wir haben Yandex.cloud verwendet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Test wird die Autorisierung zun√§chst in ESIA f√ºr jeden Stream separat implementiert. </font><font style="vertical-align: inherit;">Danach wird f√ºr jeden Thread ein separater Browser gestartet und im Rahmen einer Instanz eine bestimmte Anzahl von Updates durchgef√ºhrt. </font><font style="vertical-align: inherit;">Danach wird die Instanz neu gestartet. </font><font style="vertical-align: inherit;">Die Pr√ºfung selbst kann einen typischen Pfad enthalten, z. B. die Hauptseite und die Form des Dienstes. </font><font style="vertical-align: inherit;">In den meisten F√§llen reicht es jedoch aus, nur den Dienst vollst√§ndig zu aktualisieren und das erforderliche Verzeichnis zu √ºberpr√ºfen, in dem der Dienst gesendet werden kann - alles wie in den Anweisungen f√ºr Benutzer. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/8w/vk/oe8wvknrrkkw1hn3vb4ke0oh8sw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Fragment des Tests zum √ñffnen der Haupt- und Aktualisierungsseite.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">await</span> page.setViewport(PUP_OPT);
  <span class="hljs-keyword">await</span> page.goto(BASE_URL);
  <span class="hljs-keyword">await</span> page.setCookie(...cookies[worker.id]);
  <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">`<span class="hljs-subst">${BASE_URL}</span>/nd/lk/form/dnv.htm`</span>);<font></font>
  rdyRefresh++;<font></font>
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#       <span class="hljs-subst">${data}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
  getErr++;<font></font>
  <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
}<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_REFRESH - <span class="hljs-number">1</span>; i++) {
  <span class="hljs-keyword">const</span> filenameIter = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
   <span class="hljs-keyword">try</span> {
       <span class="hljs-keyword">await</span> page.reload({<span class="hljs-attr">waitUntil</span>: [<span class="hljs-string">"networkidle0"</span>, <span class="hljs-string">"domcontentloaded"</span>]});<font></font>
        rdyRefresh++;<font></font>
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-keyword">if</span> (!err.message.includes(<span class="hljs-string">'Navigation failed because browser'</span>)) {
           <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
           getErr++;<font></font>
           <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filenameIter});<font></font>
        }<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr das Laden durch Senden von Anwendungen wurde der gesamte √úberpr√ºfungszyklus implementiert - mit einem erneuten Laden des Formulars und einer √úberpr√ºfung der Eingabe aller Daten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fragment.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_RESEND; i++) {
   <span class="hljs-keyword">const</span> filename = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
  <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">'https://uslugi27.ru/nd/lk/form/dnv.htm'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      1  <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
      getErr++;<font></font>
      <span class="hljs-keyword">continue</span>;<font></font>
 }<font></font>
 <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">const</span> FORM_PREF = <span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; '</span>;
     <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data`</span>);
<span class="hljs-comment">// &lt;‚Ä¶&gt;</span>
     <span class="hljs-keyword">await</span> page.type(<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input`</span>, <span class="hljs-string">''</span>);
<span class="hljs-comment">// &lt;‚Ä¶&gt;</span>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});
     <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-primary.pull-right.next'</span>);
      <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(1) &gt; div &gt; div`</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(2) &gt; div &gt; div'</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-success.pull-right.submit'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
    <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
    sendErr++;<font></font>
    <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√úbrigens kann der Test beschleunigt werden, wenn Sie alle Daten, die nicht vom Puppenspieler stammen, √ºber das Konstrukt "wait page.type" eingeben, diese Logik jedoch auf den Browser selbst √ºbertragen. Aber dann nimmt die Komplexit√§t des Abfangens von Fehlern zu. Wie so</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data'</span>).click();
 <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input'</span>).value = <span class="hljs-string">''</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
W√§hrend der Tests haben wir mehrere tausend ESIA-Genehmigungen bereitgestellt und etwa 16.000 Antr√§ge gesendet. Wie war die Wiederherstellung eines produktiven Bildungsinformationssystems nach einer solchen Anzahl von Aussagen - fragen Sie nicht einmal. Dies ist eine ganz andere Geschichte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das wichtigste sichtbare Ergebnis dieses Prozesses war, dass die lokalen Medien in den Tagen der Einschreibung in die erste Klasse gelangweilt waren. Der Dienst hat den Medienbereich verlassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parallel dazu haben wir ein Dashboard zur √úberwachung der Leistung des Formulars basierend auf Grafana erstellt: Anzahl der Anwendungen, Anzahl der Anrufe, Yandex-Metriken usw. Aber wir werden dieses Thema f√ºr das n√§chste Mal verlassen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, ich m√∂chte allen gratulieren, die mit dem Thema der Verbesserung der Qualit√§t der Erbringung staatlicher und kommunaler Dienstleistungen in elektronischer Form verbunden sind. </font><font style="vertical-align: inherit;">Diese endlosen Vorarbeiten waren nicht umsonst - schlie√ülich hat die Zahl der eingereichten Antr√§ge im April und Mai deutlich zugenommen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de502068/index.html">110 Volt an Ihrem Computer</a></li>
<li><a href="../de502070/index.html">Die Geschichte von Pentax (Artikel plus Video)</a></li>
<li><a href="../de502072/index.html">Andocken der ISS mit JavaScript und Kompass</a></li>
<li><a href="../de502076/index.html">Trolley Robot 2.0. Teil 1. Autonome Navigation eines Heimroboters basierend auf ROS</a></li>
<li><a href="../de502080/index.html">Kanban-Methode: Beispiel PNZ Nr. 1, der Messstudienprozess in einem Startup</a></li>
<li><a href="../de502086/index.html">Richten Sie Minio so ein, dass der Benutzer nur mit seinem Eimer arbeiten kann</a></li>
<li><a href="../de502088/index.html">Eine Geschichte von √úberma√ü und Zeitverlust. Nach py3</a></li>
<li><a href="../de502092/index.html">Technologische und regulatorische Unterst√ºtzung f√ºr digitale Vertrauensdienste in der Russischen F√∂deration</a></li>
<li><a href="../de502098/index.html">Wie wir B2B aufgebaut haben</a></li>
<li><a href="../de502102/index.html">AutoML ist gro√üartig und leistungsstark</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>