<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👨🏾 📂 🍿 Überprüfung des Portals der regionalen öffentlichen Dienste unter Last durch Puppenspieler ➕ 😥 ⛺️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Auch Sie beobachten neugierig das "Epos des amerikanischen Wilden Westens über die Verteilung von Grundstücken - gehen Sie zuerst und kleb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Überprüfung des Portals der regionalen öffentlichen Dienste unter Last durch Puppenspieler</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502084/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! Auch Sie beobachten neugierig das "Epos des amerikanischen Wilden Westens über die Verteilung von Grundstücken - gehen Sie zuerst und kleben Sie eine Flagge zum Abstecken" oder nehmen Sie vielleicht sogar daran teil. Genauer gesagt in seiner modernen Version - seien Sie der Erste, der öffentliche Dienste beantragt, um Geld für Kinder zu erhalten, oder erhalten Sie einen Pass, um das Haus zu verlassen. In Anbetracht dessen möchte ich die Erfahrungen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unseres Teams</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beim Testen und bei der Vorbereitung eines regionalen Serviceportals für die Bereitstellung des Dienstes „First Class Record“ </font><font style="vertical-align: inherit;">teilen </font><font style="vertical-align: inherit;">. Es ist auch dem Habra-Effekt sehr ähnlich und war, glaube ich, dem nahe, was vor ein paar Tagen mit dem Bundesportal gosuslugi.ru passiert ist, aber auf regionaler Ebene.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben diese Herausforderung im Januar dieses Jahres in Chabarowsk bestanden und kürzlich an der Vorbereitung eines ähnlichen Dienstes für die Erteilung von Jagdgenehmigungen in einer anderen Region teilgenommen. Im Folgenden finden Sie eine kleine Erfahrung, die Ihnen die Möglichkeit gibt, das Thema der Vorbereitung der Arbeit regionaler Portale für öffentliche Dienste auf Spitzenzeiten aus einer anderen Perspektive zu betrachten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und für den Anfang - ein Foto eines schwarzen Busses, der drei Tage lang rund um die Uhr in der Schule Dienst hatte, auf dem der Autor dieser Zeilen vor drei Jahren seine Wendung unter den Eltern bestätigte. Zumindest sind unsere Eltern zusammengekommen. Im Winter in Chabarowsk bei -30 Grad zuzusehen, ist immer noch ein Vergnügen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o8/vh/rb/o8vhrboqvtrufnftfwxsxb1rgm4.png" alt="Bild"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Vorbereitung auf die Spitzenaufnahme in der ersten Klasse arbeiteten mehrere Teams, weil </font><font style="vertical-align: inherit;">Auf die eine oder andere Weise ist es daran beteiligt: ​​der Rechenzentrumsbetreiber, der Betreiber und der Entwickler des regionalen Portalinformationssystems, der Betreiber und der Entwickler des integrierten Bildungsinformationssystems, technische Unterstützung für die Benutzer des regionalen Portals. </font><font style="vertical-align: inherit;">Wir bei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iondv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> führen die letzte Aufgabe aus, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">indem</font></a><font style="vertical-align: inherit;"> wir den </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Zustand</font></a><font style="vertical-align: inherit;"> des Portals unabhängig überwachen und Benutzer unterstützen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Rolle bei der Vorbereitung besteht darin, Tests und Empfehlungen zum Zwischenspeichern von Konfigurationen in Nginx zu organisieren. Außerdem haben wir Anweisungen für Benutzer mit dem empfohlenen „Verhalten“ vorbereitet.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Für diejenigen, die das Problem des Schreibens in der 1. Klasse nicht kennen</font></font></b>
                        <div class="spoiler_text">         ,    .  .          ,     ,   -     (      ,   —      ),    ,  -     ,   ,            .  ,       ,      ,     –    ,        .           .<br>
<br>
     1-          ,    .           0:00 ,        10:00 26 . ,    –       .        10:00 ,       —    ,      - .<br>
<br>
            .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"></a>    .   2017 .     .         ,    ,    .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Service für eine nachgefragte Ressource als technische Aufgabe</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem bei Diensten wie „Schreiben in die 1. Klasse“ im Integralindikator für die Last (oder Wahrscheinlichkeit von Abfragen), die zur „Delta-Funktion“ (δ-Funktion, Dirac-Funktion) tendiert, ist in den Diagrammen in Form von Peaks deutlich sichtbar. In diesem Moment gibt es in kurzer Zeit eine mehrfache Zunahme von Anrufen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0l/uc/c6/0lucc67w9pr4uh2ig1swg5tgtq0.png" alt="δ-Funktions- und Peak-Abfragestatistik"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Erfahrung zeigt, dass die Hauptaufgabe des Trainings nicht darin besteht, die Ressourcen zu erhöhen. Die Aufgabe besteht darin, die potenzielle Anzahl von Anforderungen pro Sekunde zu minimieren, sie für einige Zeit zu verlängern und das System auf die verbleibende Last vorzubereiten. In diesem Fall müssen Engpässe gefunden und beschleunigt werden - dies ergibt den größten Effekt gemäß den Prinzipien der Theorie der begrenzten Systeme (Goldratt-Prinzipien). Und sonst ist es der Engpass, der scheitern wird. Das ganze System sollte von ihm funktionieren: das Prinzip des "Trommel-Puffer-Seils".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist physikalisch unmöglich, das gesamte Volumen in 10 Minuten Sanduhr in 1 Minute zu verschütten - es ist offensichtlich, dass sie zusammenbrechen werden. </font><font style="vertical-align: inherit;">Ähnliches gilt für die Erbringung von Dienstleistungen. </font><font style="vertical-align: inherit;">Es überrascht niemanden - wenn MFC und Skandale an der Reihe sind, Dienste zu erhalten, aber es überrascht alle -, warum das Portal zusammengebrochen ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt verschiedene Muster des Lasthandhabungsverhaltens gegenüber der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warteschlangentheorie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie können Benutzer in die Warteschleife stellen, d. H. </font><font style="vertical-align: inherit;">Erhöhen Sie die Warteschlange.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie können sich einfach weigern, diejenigen zu bedienen, die später gekommen sind, bis die vorherigen verarbeitet wurden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie können versuchen, die Produktivität endlos zu steigern.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zweckmäßigkeit liegt irgendwo dazwischen. In der Tat ist für einen Dienst mit einer begrenzten Ressource, die von einer Region oder einem Staat bereitgestellt wird, nicht nur die Geschwindigkeit wichtig, sondern vor allem die Wahrung der sozialen Gerechtigkeit - d. H. gleiche Bedingungen für alle. Gleichzeitig - wenn der Benutzer nicht das erhalten hat, was er benötigt, initiiert er eine neue Anfrage. In diesem Fall wachsen die Anforderungen in einer Lawine und bilden ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angriffsmodell für den „</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dog-Pile-Effekt </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">“</font></a><font style="vertical-align: inherit;"> (Dog-Pile-Effekt, Cache-Stampede, Hit-Miss-Storm). Der Benutzer hat die Anforderung bereits abgebrochen und eine neue initiiert, während sich die vorherige noch in der zu verarbeitenden Warteschlange befindet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Prozess verstärkt die Tatsache, dass ganze Familien an der Einreichung teilnehmen - Vater und Mutter füllen gleichzeitig Anträge aus und reichen Anträge häufig mehrmals aus Gründen der Zuverlässigkeit ein. </font><font style="vertical-align: inherit;">Und außerdem oft auch in mehreren Registerkarten und mehreren Browsern. </font><font style="vertical-align: inherit;">Daher ist es normalerweise sinnvoll, die erwartete Spitzenlast mit dem 2-3-fachen der Anzahl derjenigen zu multiplizieren, die sich tatsächlich für solche Dienste bewerben.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rückzug der Gerechtigkeit</font></font></b>
                        <div class="spoiler_text">,   «»,            .   ?  «»    ,    .   .     —        ,     .        « ».        .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisation der Leistungserbringung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die erwartete Anzahl der Bewerber anhand einer Kombination aus Daten zur Gesamtzahl der im letzten Jahr eingereichten Bewerbungen und Daten pro Minute für andere Regionen berechnet. </font><font style="vertical-align: inherit;">In der Regel liegt der Spitzenwert der Anwendungen bei 5 bis 10 Minuten, auch weil die Portale in den ersten drei bis fünf Minuten fast nicht reagieren und spätere Benutzer das Formular 1 bis 5 Minuten ausfüllen (wundern Sie sich nicht, viele füllen das Telefon auch unter solchen „nervösen“ Bedingungen aus). . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein ungefähres Berechnungsmodell für die bedingten 1000 Anwendungen pro Stunde lautet wie folgt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Spitzenzeit von 5 bis 10 Minuten ab dem Start und 80% der Anträge werden nach der Paretto-Regel eingereicht</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Herkömmlicherweise planen wir 160 Anwendungen pro Minute oder 3 Anwendungen pro Sekunde.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich erfolgte die erste Einreichung nach einer Minute und 45 Sekunden, und die Spitze der Bewerbungen ging von 4 Minuten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Belastung von ESIA und des Systems durch das Generieren von Autorisierungssitzungen zu verringern, wurde in den Anweisungen empfohlen, dass sich Benutzer im Voraus anmelden und die Sitzungslebensdauer verlängern. </font><font style="vertical-align: inherit;">Tatsächlich wurden 50% in 1 Stunde und ~ 90% in einer halben Stunde genehmigt. </font><font style="vertical-align: inherit;">Wir haben bereits früher festgestellt, dass sich Benutzer 10 Minuten vor dem Start des Dienstes beim Portal anmelden - und die Autorisierung begann instabil zu funktionieren. </font><font style="vertical-align: inherit;">Es ist schwer zu sagen warum. </font><font style="vertical-align: inherit;">Vielleicht liegt der Grund darin, dass wir in Chabarowsk, wenn nachts technische Arbeiten in Moskau ausgeführt werden, erst den Beginn des Arbeitstages haben.</font></font><br>
 <br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rückzug über Unterricht und organisatorische Vorkehrungen</font></font></b>
                        <div class="spoiler_text">            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"></a>.<br>
<br>
         ,    « »     . ..      .       ,   -   .. <br>
<br>
    ,        ,         ,    .        -        .      ,       ,      .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist unmöglich, die "Delta-Funktion" zu entfernen, wenn das Formular um 00:00 Uhr neu geladen wird. Der springende Punkt dieses Verfahrens ist, dass der Dienst zu einem bestimmten Zeitpunkt angezeigt wird. Sie können jedoch versuchen, die Anzahl der Browseranforderungen auf allen erwarteten Benutzerrouten zu reduzieren und so das System nur von den erforderlichen zu belasten - Formular, dynamische Verzeichnisse und sendende Anwendungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Nginx-Einstellungen selbst sind ziemlich Standard. Hier ist es wichtiger, die Einschränkungen zu wählen, denen das System standhalten kann. Hebe sie auf - d.h. Starten Sie Warteschlangenanforderungen, wenn der Server voraussichtlich an seine Grenzen stößt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, und vor allem haben wir das Caching (proxy_cache) erzwungen und die Lebensdauer der "abgelaufenen" Daten in nginx für alle statischen Pfade und, soweit möglich, dynamischen Seiten, auf denen keine Sitzungen vorhanden sind, erhöht. Übrigens ist dies ein häufiger Fehler beim Caching - beim Schreiben in die Cache-Daten (manchmal sogar in statische Daten), in denen die Sitzung eines anderen gespeichert ist, werden diese Cookies normalerweise aus den Headern gelöscht, wenn der Server die Datentypen nicht trennen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Browser für den Benutzer sieht es so aus, als würden Seiten aus Dateien aktualisiert, die von der Festplatte oder vom Speicher heruntergeladen wurden. Aber selbst wenn der Benutzer sie vom Server erhält, werden sie aus dem Nginx-Cache entnommen. Die Verzeichnisse selbst werden natürlich im System selbst zwischengespeichert.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/oq/nv/qioqnv0ofdjd5e0ygculnetdta4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies reduzierte die Anzahl potenzieller Anfragen von 89 Anfragen auf 14 und das Volumen von 2,1 MB (für 1000 Benutzer, die die Seite aktualisiert haben, ist dies ein potenzieller Spitzenwert von 4 bis 8 Gbit / s) auf 38 KB (wir alle erinnern uns an das Webpack, für Unternehmensplattformen jedoch nicht immer leicht zu machen). Nach den Ergebnissen der Passage war es weiterhin erforderlich, nicht nur im System, sondern auch in Nginx einige der Verzeichnisse aus den Form- und dynamischen Klassifizierern zwischenzuspeichern, die zum Spitzenzeitpunkt nicht verwendet wurden, und die Lebensdauer für sie zu erzwingen. Und mit zunehmender Last ist es im Allgemeinen sinnvoll, die vollständig statische Hauptseite aufzurufen, auf der Benutzer zum gewünschten Dienst weitergeleitet werden, oder eine separate Ressource für den Dienst zu erstellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Belastung beim Senden zu verringern, wurden Entwürfe und das automatische Ausfüllen von Daten für das Kind deaktiviert. Alle Benutzer haben unterschiedliche Dateneingabegeschwindigkeiten, wodurch das Erscheinen eines Formulars, das vollständig zur Übermittlung bereit ist, entfällt und die Delta-Funktion zum Senden von Anträgen vermieden wird - alle 1000 in einer Minute. Gleichzeitig wird die soziale Gerechtigkeit gewahrt, obwohl natürlich Beschwerden auftreten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde die Optimierung des Systems selbst nicht beschreiben - während der Lasttests wurden Engpässe festgestellt - hauptsächlich in DBMS-Abfragen und die Indizes und Abfragen selbst wurden optimiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die wahrscheinlich wichtigste Optimierung ist die Vereinfachung des Formulars. Was beeinflusst die Geschwindigkeit am meisten, wenn es in einem Formular implementiert wird?</font></font><br>
<br>
<ul>
<li>   —   ,        ,      .    —       5-10 (   iPhone         )   5-       375 /  (1       10 ,     <code>application/x-www-form-urlencoded </code>–  20 ),  100      625 /.           100/      —        .   ,      «  ».    —     ?     ,     .    ,      ?</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anspruchsvolle Führer. </font><font style="vertical-align: inherit;">Die Last wird normalerweise mithilfe des FIAS- oder CLADR-Adressverzeichnisses erhöht. </font><font style="vertical-align: inherit;">Die Probleme hier sind auf die Größe zurückzuführen - FIAS benötigt bis zu 40 GB in der Datenbank und die Suche dauert einige Zeit. </font><font style="vertical-align: inherit;">Zehntelsekunden, aber multipliziert mit 1000 gleichzeitigen Anforderungen, laden jedes System. </font><font style="vertical-align: inherit;">Ohne besondere Vorbereitung, möglicherweise in Form eines separaten Webdienstes und einer separaten Ressource, ist es schwierig, der Belastung standzuhalten. Daher verwenden sie häufig ein einfaches Textfeld für die Adresse.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommen wir zu den Tests.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lasttest in Vorbereitung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Tests wurden über Puppenspieler durchgeführt - indem Benutzeraktionen im Crominium-Browser emuliert wurden. </font><font style="vertical-align: inherit;">Yanedeks.tank und JMeter haben den Schutz vor Angriffen aufgehoben, weil sie viele der gleichen Arten von Anfragen generieren. </font><font style="vertical-align: inherit;">Darüber hinaus stimmen diese Tests nur schwach mit dem Profil realer Abfragen überein, wenn das Verhalten des Systems unter Last geändert wird. </font><font style="vertical-align: inherit;">Darüber hinaus zwischenspeichern die Server Anforderungen, und es ist schwierig, einen Teil der darin enthaltenen Prozesse zu reproduzieren (z. B. Autorisierung). </font><font style="vertical-align: inherit;">Übrigens </font><font style="vertical-align: inherit;">haben wir </font><font style="vertical-align: inherit;">von einem der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devDV-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seminare </font><font style="vertical-align: inherit;">eine Präsentation mit einer Präsentation über die Verwendung von Puppenspielern zum Testen, einschließlich </font><font style="vertical-align: inherit;">Laden, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link zum Video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst haben wir ein Benutzerverhaltensprofil erstellt und die Prozedur in Schlüsselphasen unterteilt:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Massengenehmigung in ESIA</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einmalige Aktualisierung des Serviceformulars,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Massenfutter </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für jede Stufe haben wir einen eigenen Test durchgeführt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Letztes Jahr gab es in der Zulassungsphase bei ESIA Schwierigkeiten, aber es ist schwierig, sie in vollem Umfang zu testen. Das System ist extern, der Schutz vor Angriffen und Autorisierungsverboten wird ausgelöst. Es ist jedoch möglich, ein Testprofil zu formulieren, um die Engpässe des zu testenden Systems genau zu testen. In der Regel ist dies die Anzahl gleichzeitig autorisierter Sitzungen und geplanter Autorisierungswerte pro Minute, die durch Empfehlungen geregelt werden können.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Test ist der Wrapper wichtig für die Organisation mehrerer Threads, wir verwenden den 'Puppenspieler-Cluster'. In der Regel ist es jedoch komplizierter, Ausnahmen zu behandeln und das Verhalten des Portals unter Last zu ändern. Oft werden Layoutelemente angezeigt, die zweimal angezeigt werden. Oder die Elemente werden nicht angezeigt, wenn einige Daten nicht wie erwartet geladen wurden. Dies sind alle Fehler, die Benutzer sehen und die Seite neu laden - was bedeutet, dass sie eine zusätzliche Last erstellen. Es gibt zwei Möglichkeiten: Implementieren der Ausnahmebehandlung im Test. Oder ändern Sie das Portal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Test selbst ist einfach. Unten finden Sie ein Fragment vom Klicken auf die Schaltfläche "Anmelden" im Serviceportal bis zur Eingabe von Daten in ESIA.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">await</span> page.waitForSelector(AUTH_AVAIL,{<span class="hljs-attr">timeout</span>:OPT_ELEM_WAIT_TIME});
<span class="hljs-keyword">const</span> needAuth = <span class="hljs-keyword">await</span> page.$(ELEM_AUTH_IN);
<span class="hljs-keyword">if</span> (!needAuth) <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`  `</span>));<font></font>
        <font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(AUTH_BUT, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.click(AUTH_BUT);
<span class="hljs-keyword">await</span> waitNewUrl(page, <span class="hljs-string">'https://esia.gosuslugi.ru/idp/rlogin?cc=bp'</span>, OPT_PAGE_WAIT_TIME);
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#mobileOrEmail'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">let</span> text = <span class="hljs-keyword">await</span> elemGetText(page, <span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt; div.detected &gt; div.left &gt; div.this-user'</span>);
<span class="hljs-keyword">if</span> (text) <font></font>
   text = text.replace(<span class="hljs-regexp">/ -\(\)/g</span>, <span class="hljs-string">''</span>);        
<span class="hljs-keyword">if</span> (text &amp;&amp; text.indexOf(user) === <span class="hljs-number">-1</span>) {
  <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'div.click-to-another &gt; a'</span>);
  <span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt;'</span> +
                <span class="hljs-string">' div.detected &gt; div.left &gt; div.this-user'</span>, OPT_ELEMENT_INVISIBLE);<font></font>
}<font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#password'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#mobileOrEmail'</span>, user);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#password'</span>, pwd);
<span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#loginByPwdButton'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überprüfung der Aktualisierung des Antragsformulars, bis Benutzer "den Datensatz öffnen". Der Neustarttest besteht im Wesentlichen aus einem Schritt. Es ist jedoch wichtig, die zurückgegebenen Fehlertypen zu überprüfen. Das Netzwerk ist ein Problem, ein Nginx-Fehler, ein Serverfehler und ob das Formular die Kriterien erfüllt. Die Schwierigkeit besteht darin, das maximale Anforderungsvolumen in kürzester Zeit zu generieren und nicht unter die Schutzbeschränkungen zu fallen (während der Tests kann es jedoch geändert werden, andererseits wird auch die Einstellung der Netzwerk- und Serverinfrastruktur und der WAF überprüft). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solche Tests an Puppenspielern erfordern eine Menge Ressourcen, um zu arbeiten. De facto stellte sich heraus, dass Sie mindestens 2 Kerne gegen den 1. Kern des Front-End-Subsystems und einen sehr breiten Kanal benötigen. Aber wenn Sie sie in der Cloud mieten - das ist ziemlich erschwinglich. Wir haben Yandex.cloud verwendet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Test wird die Autorisierung zunächst in ESIA für jeden Stream separat implementiert. </font><font style="vertical-align: inherit;">Danach wird für jeden Thread ein separater Browser gestartet und im Rahmen einer Instanz eine bestimmte Anzahl von Updates durchgeführt. </font><font style="vertical-align: inherit;">Danach wird die Instanz neu gestartet. </font><font style="vertical-align: inherit;">Die Prüfung selbst kann einen typischen Pfad enthalten, z. B. die Hauptseite und die Form des Dienstes. </font><font style="vertical-align: inherit;">In den meisten Fällen reicht es jedoch aus, nur den Dienst vollständig zu aktualisieren und das erforderliche Verzeichnis zu überprüfen, in dem der Dienst gesendet werden kann - alles wie in den Anweisungen für Benutzer. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/8w/vk/oe8wvknrrkkw1hn3vb4ke0oh8sw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Fragment des Tests zum Öffnen der Haupt- und Aktualisierungsseite.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">await</span> page.setViewport(PUP_OPT);
  <span class="hljs-keyword">await</span> page.goto(BASE_URL);
  <span class="hljs-keyword">await</span> page.setCookie(...cookies[worker.id]);
  <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">`<span class="hljs-subst">${BASE_URL}</span>/nd/lk/form/dnv.htm`</span>);<font></font>
  rdyRefresh++;<font></font>
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#       <span class="hljs-subst">${data}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
  getErr++;<font></font>
  <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
}<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_REFRESH - <span class="hljs-number">1</span>; i++) {
  <span class="hljs-keyword">const</span> filenameIter = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
   <span class="hljs-keyword">try</span> {
       <span class="hljs-keyword">await</span> page.reload({<span class="hljs-attr">waitUntil</span>: [<span class="hljs-string">"networkidle0"</span>, <span class="hljs-string">"domcontentloaded"</span>]});<font></font>
        rdyRefresh++;<font></font>
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-keyword">if</span> (!err.message.includes(<span class="hljs-string">'Navigation failed because browser'</span>)) {
           <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
           getErr++;<font></font>
           <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filenameIter});<font></font>
        }<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für das Laden durch Senden von Anwendungen wurde der gesamte Überprüfungszyklus implementiert - mit einem erneuten Laden des Formulars und einer Überprüfung der Eingabe aller Daten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fragment.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_RESEND; i++) {
   <span class="hljs-keyword">const</span> filename = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
  <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">'https://uslugi27.ru/nd/lk/form/dnv.htm'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      1  <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
      getErr++;<font></font>
      <span class="hljs-keyword">continue</span>;<font></font>
 }<font></font>
 <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">const</span> FORM_PREF = <span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; '</span>;
     <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data`</span>);
<span class="hljs-comment">// &lt;…&gt;</span>
     <span class="hljs-keyword">await</span> page.type(<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input`</span>, <span class="hljs-string">''</span>);
<span class="hljs-comment">// &lt;…&gt;</span>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});
     <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-primary.pull-right.next'</span>);
      <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(1) &gt; div &gt; div`</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(2) &gt; div &gt; div'</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-success.pull-right.submit'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
    <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
    sendErr++;<font></font>
    <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Übrigens kann der Test beschleunigt werden, wenn Sie alle Daten, die nicht vom Puppenspieler stammen, über das Konstrukt "wait page.type" eingeben, diese Logik jedoch auf den Browser selbst übertragen. Aber dann nimmt die Komplexität des Abfangens von Fehlern zu. Wie so</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data'</span>).click();
 <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input'</span>).value = <span class="hljs-string">''</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während der Tests haben wir mehrere tausend ESIA-Genehmigungen bereitgestellt und etwa 16.000 Anträge gesendet. Wie war die Wiederherstellung eines produktiven Bildungsinformationssystems nach einer solchen Anzahl von Aussagen - fragen Sie nicht einmal. Dies ist eine ganz andere Geschichte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das wichtigste sichtbare Ergebnis dieses Prozesses war, dass die lokalen Medien in den Tagen der Einschreibung in die erste Klasse gelangweilt waren. Der Dienst hat den Medienbereich verlassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parallel dazu haben wir ein Dashboard zur Überwachung der Leistung des Formulars basierend auf Grafana erstellt: Anzahl der Anwendungen, Anzahl der Anrufe, Yandex-Metriken usw. Aber wir werden dieses Thema für das nächste Mal verlassen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, ich möchte allen gratulieren, die mit dem Thema der Verbesserung der Qualität der Erbringung staatlicher und kommunaler Dienstleistungen in elektronischer Form verbunden sind. </font><font style="vertical-align: inherit;">Diese endlosen Vorarbeiten waren nicht umsonst - schließlich hat die Zahl der eingereichten Anträge im April und Mai deutlich zugenommen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de502068/index.html">110 Volt an Ihrem Computer</a></li>
<li><a href="../de502070/index.html">Die Geschichte von Pentax (Artikel plus Video)</a></li>
<li><a href="../de502072/index.html">Andocken der ISS mit JavaScript und Kompass</a></li>
<li><a href="../de502076/index.html">Trolley Robot 2.0. Teil 1. Autonome Navigation eines Heimroboters basierend auf ROS</a></li>
<li><a href="../de502080/index.html">Kanban-Methode: Beispiel PNZ Nr. 1, der Messstudienprozess in einem Startup</a></li>
<li><a href="../de502086/index.html">Richten Sie Minio so ein, dass der Benutzer nur mit seinem Eimer arbeiten kann</a></li>
<li><a href="../de502088/index.html">Eine Geschichte von Übermaß und Zeitverlust. Nach py3</a></li>
<li><a href="../de502092/index.html">Technologische und regulatorische Unterstützung für digitale Vertrauensdienste in der Russischen Föderation</a></li>
<li><a href="../de502098/index.html">Wie wir B2B aufgebaut haben</a></li>
<li><a href="../de502102/index.html">AutoML ist großartig und leistungsstark</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>