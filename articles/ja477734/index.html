<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”ª ğŸ‘¨â€ğŸ’» ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘©ğŸ» å†™çœŸã‚¢ãƒ—ãƒªã§UICollectionViewLayoutã‚’ç†è§£ã™ã‚‹ ğŸ¤³ğŸ¾ ğŸ¥ ğŸ§œğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã‚“ã«ã¡ã¯ã€ãƒãƒ–ãƒ«ï¼ç§ã®åå‰ã¯ãƒ‹ã‚­ãƒ¼ã‚¿ã§ã™ã€‚ABBYYã§ãƒ¢ãƒã‚¤ãƒ«SDKã‚’æ‹…å½“ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§è¤‡æ•°ãƒšãƒ¼ã‚¸ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ç°¡å˜ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚‚æºã‚ã£ã¦ã„ã¾ã™ã€‚ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ABBYY Mobile Captureãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã«åŸºã¥ãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>å†™çœŸã‚¢ãƒ—ãƒªã§UICollectionViewLayoutã‚’ç†è§£ã™ã‚‹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/abbyy/blog/477734/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚“ã«ã¡ã¯ã€ãƒãƒ–ãƒ«ï¼ç§ã®åå‰ã¯ãƒ‹ã‚­ãƒ¼ã‚¿ã§ã™ã€‚ABBYYã§ãƒ¢ãƒã‚¤ãƒ«SDKã‚’æ‹…å½“ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§è¤‡æ•°ãƒšãƒ¼ã‚¸ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ç°¡å˜ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚‚æºã‚ã£ã¦ã„ã¾ã™ã€‚ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABBYY Mobile Captureãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã«</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸºã¥ãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºæ™‚é–“ã‚’çŸ­ç¸®ã—ã€</font><font style="vertical-align: inherit;">ã„ãã¤ã‹ã®éƒ¨åˆ†ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚ã¾ãšã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãŸã‚ã®ã‚«ãƒ¡ãƒ©ã€‚æ¬¡ã«ã€ã‚­ãƒ£ãƒ—ãƒãƒ£çµæœï¼ˆã¤ã¾ã‚Šã€è‡ªå‹•çš„ã«æ’®å½±ã•ã‚ŒãŸå†™çœŸï¼‰ã‚’å«ã‚€ã‚¨ãƒ‡ã‚£ã‚¿ç”»é¢ã¨ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å¢ƒç•Œã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã®ç”»é¢ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é–‹ç™ºè€…ãŒã„ãã¤ã‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ååˆ†ã§ã™-ãã—ã¦ã€ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•çš„ã«ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã‚«ãƒ¡ãƒ©ãŒã™ã§ã«åˆ©ç”¨å¯èƒ½ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€æ§‹æˆæ¸ˆã¿ã®ã‚«ãƒ¡ãƒ©ã«åŠ ãˆã¦ã€ã‚¹ã‚­ãƒ£ãƒ³çµæœã¸ã®ä¾¿åˆ©ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’é¡§å®¢ã«æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">è‡ªå‹•çš„ã«å†™çœŸã‚’æ’®ã£ãŸã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå¥‘ç´„æ›¸ã‚„æ†²ç« ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ãŸå ´åˆã€ãã®ã‚ˆã†ãªå†™çœŸãŒãŸãã•ã‚“ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®è¨˜äº‹ã§ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ã®çµæœã‚’ä½¿ç”¨ã—ã¦ã€ã‚¨ãƒ‡ã‚£ã‚¿ç”»é¢ã®å®Ÿè£…ä¸­ã«ç™ºç”Ÿã—ãŸå•é¡Œã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç”»é¢è‡ªä½“ã¯2ã¤ã§ã™</font></font><code>UICollectionView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯ãã‚Œã‚‰ã‚’å¤§å°ã¨å‘¼ã³ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å¢ƒç•Œç·šã‚’æ‰‹å‹•ã§èª¿æ•´ã—ãŸã‚Šã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã®ä»–ã®ä½œæ¥­ã‚’è¡Œã£ãŸã‚Šã™ã‚‹å¯èƒ½æ€§ã‚’çœç•¥ã—ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸­ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¸‹ã®GIFã§ã€æœ€å¾Œã«ä½•ãŒèµ·ã“ã£ãŸã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒªãƒ³ã‚¯ã¯è¨˜äº‹ã®æœ€å¾Œã«ã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/r2/xs/of/r2xsofivnhzdmlxt67ld_2atq-q.gif"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‚è€ƒã¾ã§ã«ã€ç§ã¯ã‚ˆãAppleã‚·ã‚¹ãƒ†ãƒ ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æ³¨æ„ã‚’æ‰•ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ãã®ä»–ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ³¨æ„æ·±ãè¦‹ã‚‹ã¨ã€ã•ã¾ã–ã¾ãªã•ã•ã„ãªã“ã¨ã«å¯¾ã™ã‚‹å½¼ã‚‰ã®æ³¨æ„æ·±ã„æ…‹åº¦ã«æ„Ÿå¿ƒã—å§‹ã‚ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã“ã§ã€å‚è€ƒã¨ã—ã¦</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†™çœŸ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</font><font style="vertical-align: inherit;">ï¼ˆiOS 12ï¼‰</font><font style="vertical-align: inherit;">ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç‰¹å®šã®æ©Ÿèƒ½ã«æ³¨æ„ã‚’å‘ã‘ã€å®Ÿè£…ã‚’è©¦ã¿ã¾ã™ã€‚</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã®å¯èƒ½æ€§ã®ã»ã¨ã‚“ã©ã‚’ã‚«ãƒãƒ¼ã—</font></font><code>UICollectionViewFlowLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€è¦–å·®ã‚„ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ãªã©ã®ä¸€èˆ¬çš„ãªãƒˆãƒªãƒƒã‚¯ãŒã©ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã—ã€ã‚»ãƒ«ã‚’æŒ¿å…¥ãŠã‚ˆã³å‰Šé™¤ã™ã‚‹ã¨ãã®ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã«é–¢é€£ã™ã‚‹å•é¡Œã«ã¤ã„ã¦ã‚‚èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ©Ÿèƒ½ãƒ¬ãƒ“ãƒ¥ãƒ¼</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è©³ç´°ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã«ã€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†™çœŸ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</font><font style="vertical-align: inherit;">ã§</font><font style="vertical-align: inherit;">ç§ã«å–œã°ã‚ŒãŸå…·ä½“çš„ãªå°ã•ãªã“ã¨ã‚’èª¬æ˜</font><font style="vertical-align: inherit;">ã—ã€é©åˆ‡ãªé †åºã§å®Ÿè£…ã—ã¾ã™ã€‚</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§è¦æ¨¡ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã®è¦–å·®åŠ¹æœ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®è¦ç´ ãŒä¸­å¤®ã«é…ç½®ã•ã‚Œã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ã‚¢ã‚¤ãƒ†ãƒ ã®å‹•çš„ã‚µã‚¤ã‚º</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚»ãƒ«ã®è¦ç´ ã‚’é…ç½®ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã€contentOffsetã ã‘ã§ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã«ã‚‚ä¾å­˜ã—ã¾ã™</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»å‹•ã¨å‰Šé™¤ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Œã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã€ã‚»ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ã€å‘ãã‚’å¤‰æ›´ã—ã¦ã‚‚å¤±ã‚ã‚Œã¾ã›ã‚“</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.è¦–å·®</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦–å·®ã¨ã¯ï¼Ÿ</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦–å·®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯ã€èƒŒæ™¯ç”»åƒãŒå‰æ™¯ç”»åƒã‚ˆã‚Šã‚‚ã‚«ãƒ¡ãƒ©ã‚’é€šéã™ã‚‹é€Ÿåº¦ãŒé…ã„ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®æ‰‹æ³•ã§ã‚ã‚Šã€2Dã‚·ãƒ¼ãƒ³ã«å¥¥è¡Œãã®éŒ¯è¦šã‚’ä½œã‚Šå‡ºã—ã€ä»®æƒ³ä½“é¨“ã«æ²¡å…¥æ„Ÿã‚’åŠ ãˆã¾ã™ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨ã€ã‚»ãƒ«ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãŒãã®ä¸­ã®ç”»åƒã‚ˆã‚Šã‚‚é€Ÿãç§»å‹•ã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9u/qc/7j/9uqc7jfa_e81lg-_9h6uleidmdg.gif"></div><div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/jt/nv/ocjtnvvyckaotg52-tooulyfddq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å§‹ã‚ã¾ã—ã‚‡ã†ï¼</font><font style="vertical-align: inherit;">ã‚»ãƒ«ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã€UIImageViewã‚’ãã®ä¸­ã«é…ç½®ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreviewCollectionViewCell</span>: <span class="hljs-title">UICollectionViewCell</span> </span>{<font></font>
    <font></font>
    <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> imageView = <span class="hljs-type">UIImageView</span>()<font></font>
â€‹<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">init</span>(frame: <span class="hljs-type">CGRect</span>) {
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>(frame: frame)<font></font>
        addSubview(imageView)<font></font>
        clipsToBounds = <span class="hljs-literal">true</span><font></font>
        imageView.snp.makeConstraints {<font></font>
            $<span class="hljs-number">0</span>.edges.equalToSuperview()<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€ã‚·ãƒ•ãƒˆæ–¹æ³•ã‚’ç†è§£</font></font><code>imageView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã—ã€è¦–å·®åŠ¹æœã‚’ä½œæˆ</font><font style="vertical-align: inherit;">ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸­ã®ã‚»ãƒ«ã®å‹•ä½œã‚’å†å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ—æªï¼š</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã‚’é¿ã‘</font></font><code>UICollectionView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ¥ãƒ¼ã®å¤–è¦³ã¯ã»ã¨ã‚“ã©ã¾ãŸã¯ã¾ã£ãŸãã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ä»£ã‚ã‚Šã«ã€ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã™ã¹ã¦ã®ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—ã—ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã™ã¹ã¦ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé–¢é€£æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¢ã‚¤ãƒ†ãƒ ã‚’3æ¬¡å…ƒã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã™ã‚‹å ´åˆã€é©åˆ‡ãªæ–¹æ³•ã¯ã€å„ã‚»ãƒ«ã®3Då¤‰æ›ã‚’è¨­å®šã—ã¦é©åˆ‡ã«è¡¨ç¤ºã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã™ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã¯ã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½œæˆã—ã¾ã—ã‚‡ã†</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã¯</font></font><code>UICollectionView </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€§è³ªãŒã‚ã‚‹</font></font><code>collectionViewLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãã‚ŒãŒç´°èƒã®ä½ç½®ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å­¦ç¿’ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</font></font><code>UICollectionViewFlowLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã‚ã‚‹æŠ½è±¡ã®å®Ÿè£…ã§ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><code>UICollectionViewLayout</code><font style="vertical-align: inherit;"></font><code>collectionViewLayout</code><font style="vertical-align: inherit;"></font><br>
<blockquote><code>UICollectionViewLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èª°ã‹ãŒã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã—ã¦é©åˆ‡ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æä¾›ã™ã‚‹ã®ã‚’å¾…ã£ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚»ãƒ«ãŒã‚°ãƒªãƒƒãƒ‰çŠ¶ã«é…ç½®ã•ã‚Œã‚‹ã‚ˆã†ã«ã€4ã¤ã®ã™ã¹ã¦ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒå®Ÿè£…ã•ã‚Œ</font></font><code>UICollectionViewFlowLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸå…·è±¡ã‚¯ãƒ©ã‚¹ã§ã™</font></font><code>UICollectionViewLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ–ã‚¯ãƒ©ã‚¹</font></font><code>UICollectionViewFlowLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ä½œæˆã—ã¦</font><font style="vertical-align: inherit;">å†å®šç¾©ã—</font></font><code>layoutAttributesForElements(in:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€</font></font><code>UICollectionViewLayoutAttributes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹å®šã®ã‚»ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æä¾›</font><font style="vertical-align: inherit;">ã™ã‚‹é…åˆ—</font><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">è¿”ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</font></font><code>contentOffset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒç„¡åŠ¹ã§ã‚ã‚‹ã¨ãã ã‘ã§ãªãã€</font><font style="vertical-align: inherit;">å¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«å±æ€§ã‚’è¦æ±‚ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚ã•ã‚‰ã«</font></font><code>parallaxValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã‚»ãƒ«ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ç”»åƒã®ãƒ•ãƒ¬ãƒ¼ãƒ ãŒã©ã‚Œã ã‘é…ã‚Œã‚‹ã‹ã‚’æ±ºå®š</font><font style="vertical-align: inherit;">ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</font><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">è¿½åŠ ã—ã¦ã€ã‚«ã‚¹ã‚¿ãƒ å±æ€§ã‚’ä½œæˆã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã®å ´åˆã€å±æ€§ã‚’å†å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font></font><code>NSCopiyng</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æ—æªï¼š</font></font><br>
<blockquote>If you subclass and implement any custom layout attributes, you must also override the inherited isEqual: method to compare the values of your properties. In iOS 7 and later, the collection view does not apply layout attributes if those attributes have not changed. It determines whether the attributes have changed by comparing the old and new attribute objects using the isEqual: method. Because the default implementation of this method checks only the existing properties of this class, you must implement your own version of the method to compare any additional properties. If your custom properties are all equal, call <code>super </code>and return the resulting value at the end of your implementation.<br>
</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã¯</font></font><code>parallaxValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Ÿ</font><font style="vertical-align: inherit;">ã‚»ãƒ«ãŒä¸­å¿ƒã«ç«‹ã¤ã‚ˆã†ã«ã‚»ãƒ«ã®ä¸­å¿ƒã‚’ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚‹é‡ã‚’è¨ˆç®—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">ã“ã®è·é›¢ãŒã‚»ãƒ«ã®å¹…ã‚ˆã‚Šã‚‚å¤§ãã„å ´åˆã¯ã€ãƒãƒ³ãƒãƒ¼ã§å©ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€ã“ã®è·é›¢ã‚’</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚»ãƒ«ã®</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹…ã§å‰²ã‚Š</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®è·é›¢ãŒã‚¼ãƒ­ã«è¿‘ã„ã»ã©ã€è¦–å·®åŠ¹æœã¯å¼±ããªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParallaxLayoutAttributes</span>: <span class="hljs-title">UICollectionViewLayoutAttributes</span> </span>{
    <span class="hljs-keyword">var</span> parallaxValue: <span class="hljs-type">CGFloat?</span><font></font>
}<font></font>
â€‹<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreviewLayout</span>: <span class="hljs-title">UICollectionViewFlowLayout</span> </span>{
    <span class="hljs-keyword">var</span> offsetBetweenCells: <span class="hljs-type">CGFloat</span> = <span class="hljs-number">44</span><font></font>
â€‹<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldInvalidateLayout</span><span class="hljs-params">(forBoundsChange newBounds: CGRect)</span></span> -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><font></font>
    }<font></font>
â€‹<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">var</span> <span class="hljs-title">layoutAttributesClass</span>: <span class="hljs-title">AnyClass</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-type">ParallaxLayoutAttributes</span>.<span class="hljs-keyword">self</span><font></font>
    }<font></font>
â€‹<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">layoutAttributesForElements</span><span class="hljs-params">(<span class="hljs-keyword">in</span> rect: CGRect)</span></span> -&gt; [<span class="hljs-type">UICollectionViewLayoutAttributes</span>]? {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.layoutAttributesForElements(<span class="hljs-keyword">in</span>: rect)?<font></font>
            .<span class="hljs-built_in">compactMap</span> { $<span class="hljs-number">0</span>.copy() <span class="hljs-keyword">as</span>? <span class="hljs-type">ParallaxLayoutAttributes</span> }<font></font>
            .<span class="hljs-built_in">compactMap</span>(prepareAttributes)<font></font>
    }<font></font>
â€‹<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">prepareAttributes</span><span class="hljs-params">(attributes: ParallaxLayoutAttributes)</span></span> -&gt; <span class="hljs-type">ParallaxLayoutAttributes</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> collectionView = <span class="hljs-keyword">self</span>.collectionView <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> attributes }<font></font>
â€‹<font></font>
        <span class="hljs-keyword">let</span> width = itemSize.width
        <span class="hljs-keyword">let</span> centerX = width / <span class="hljs-number">2</span>
        <span class="hljs-keyword">let</span> distanceToCenter = attributes.center.x - collectionView.contentOffset.x
        <span class="hljs-keyword">let</span> relativeDistanceToCenter = (distanceToCenter - centerX) / width<font></font>
â€‹<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(relativeDistanceToCenter) &gt;= <span class="hljs-number">1</span> {<font></font>
            attributes.parallaxValue = <span class="hljs-literal">nil</span><font></font>
            attributes.transform = .identity<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            attributes.parallaxValue = relativeDistanceToCenter<font></font>
            attributes.transform = <span class="hljs-type">CGAffineTransform</span>(translationX: relativeDistanceToCenter * offsetBetweenCells, y: <span class="hljs-number">0</span>)<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> attributes<font></font>
    }<font></font>
}</code></pre> <div style="text-align:center;"><img src="https://habrastorage.org/webt/2u/pw/f3/2upwf3rrqmsjxh-btqrm3zau7tm.png"></div><br>
<br>
<img src="https://habrastorage.org/webt/bz/x_/ol/bzx_olvusogre4usqir2uvl3uxm.png" alt="ç”»åƒ"><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fx/pi/9z/fxpi9zj22hrlkywk5ptjieqq9ma.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªå±æ€§ã‚’å—ã‘å–ã‚‹ã¨ã€ã‚»ãƒ«</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã‚Œã‚‰ã‚’</font><b><font style="vertical-align: inherit;">é©ç”¨</font></b><font style="vertical-align: inherit;">ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã®å‹•ä½œã¯ã€ã‚»ãƒ«ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã«</font></font><code>imageView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿œã˜ãŸé‡ã ã‘</font><font style="vertical-align: inherit;">ã‚·ãƒ•ãƒˆ</font><font style="vertical-align: inherit;">ã—</font></font><code>parallaxValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€ã“ã‚ŒãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«ã¯ã€ç”»åƒã‚’ã“ã‚Œã‹ã‚‰ã‚·ãƒ•ãƒˆã™ã‚‹</font></font><code>contentMode == .aspectFit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã ã‘ã§ã¯ä¸ååˆ†ã§ã™ã€‚ã“ã‚Œã¯ã€ç”»åƒã®ãƒ•ãƒ¬ãƒ¼ãƒ </font></font><code>imageView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒã€ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒãƒˆãƒªãƒŸãƒ³ã‚°ã•ã‚Œã‚‹</font><font style="vertical-align: inherit;">ãƒ•ãƒ¬ãƒ¼ãƒ ã¨ä¸€è‡´ã—ãªã„ãŸã‚</font></font><code>clipsToBounds == true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚</font><font style="vertical-align: inherit;">ç”»åƒã®ã‚µã‚¤ã‚ºã«åˆã£ãŸãƒã‚¹ã‚¯ã‚’é©ç”¨ã—ã€</font></font><code>contentMode </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…è¦ã«å¿œã˜ã¦æ›´æ–°ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä»Šã€ã™ã¹ã¦ãŒã†ã¾ãã„ãã¾ã™ï¼</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">PreviewCollectionViewCell</span> </span>{<font></font>
â€‹<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">layoutSubviews</span><span class="hljs-params">()</span></span> {<font></font>
â€‹<font></font>
        <span class="hljs-keyword">super</span>.layoutSubviews()
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> imageSize = imageView.image?.size <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
        <span class="hljs-keyword">let</span> imageRect = <span class="hljs-type">AVMakeRect</span>(aspectRatio: imageSize, insideRect: bounds)<font></font>
â€‹<font></font>
        <span class="hljs-keyword">let</span> path = <span class="hljs-type">UIBezierPath</span>(rect: imageRect)
        <span class="hljs-keyword">let</span> shapeLayer = <span class="hljs-type">CAShapeLayer</span>()<font></font>
        shapeLayer.path = path.cgPath<font></font>
        layer.mask = shapeLayer<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">apply</span><span class="hljs-params">(<span class="hljs-number">_</span> layoutAttributes: UICollectionViewLayoutAttributes)</span></span> {<font></font>
â€‹<font></font>
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> attrs = layoutAttributes <span class="hljs-keyword">as</span>? <span class="hljs-type">ParallaxLayoutAttributes</span> <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.apply(layoutAttributes)<font></font>
        }<font></font>
        <span class="hljs-keyword">let</span> parallaxValue = attrs.parallaxValue ?? <span class="hljs-number">0</span>
        <span class="hljs-keyword">let</span> transition = -(bounds.width * <span class="hljs-number">0.3</span> * parallaxValue)<font></font>
        imageView.transform = <span class="hljs-type">CGAffineTransform</span>(translationX: transition, y: .zero)<font></font>
    }<font></font>
}</code></pre><div style="text-align:center;"><img src="https://habrastorage.org/webt/j_/9e/-h/j_9e-hdvix9nueitnhf0elsk80o.png"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.å°â€‹â€‹ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®è¦ç´ ãŒä¸­å¤®ã«é…ç½®ã•ã‚Œã‚‹</font></font></h3><br>
 <img src="https://habrastorage.org/getpro/habr/post_images/6cc/d9e/a78/6ccd9ea78faa45a085233d593c6feddb.gif"> <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/c9/ld/ra/c9ldral4qoinyvhoacyfveqbwtm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã“ã§ã¯ã™ã¹ã¦ãŒéå¸¸ã«å˜ç´”ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®åŠ¹æœã¯</font></font><code>inset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€å·¦å³ä¸¡æ–¹ã«</font><font style="vertical-align: inherit;">å¤§ããª</font><font style="vertical-align: inherit;">sã‚’</font><font style="vertical-align: inherit;">è¨­å®šã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å³/å·¦ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹</font></font><code>bouncing </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å ´åˆã€æœ€å¾Œã®ã‚»ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é›¢ã‚ŒãŸã¨ãã«ã®ã¿é–‹å§‹ã™ã‚‹</font><font style="vertical-align: inherit;">å¿…è¦</font><font style="vertical-align: inherit;">ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¤ã¾ã‚Šã€è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ã‚»ãƒ«ã®ã‚µã‚¤ã‚ºã¨ç­‰ã—ããªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ThumbnailFlowLayout</span> </span>{<font></font>
â€‹<font></font>
    <span class="hljs-keyword">var</span> farInset: <span class="hljs-type">CGFloat</span> {
      <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> collection = collectionView <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> .zero }
      <span class="hljs-keyword">return</span> (collection.bounds.width - itemSize.width) / <span class="hljs-number">2</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> insets: <span class="hljs-type">UIEdgeInsets</span> {
        <span class="hljs-type">UIEdgeInsets</span>(top: .zero, <span class="hljs-keyword">left</span>: farInset, bottom: .zero, <span class="hljs-keyword">right</span>: farInset)<font></font>
    }<font></font>
â€‹<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">prepare</span><span class="hljs-params">()</span></span> {<font></font>
        collectionView?.contentInset = insets<font></font>
        <span class="hljs-keyword">super</span>.prepare()<font></font>
    }<font></font>
}</code></pre><div style="text-align:center;"><img src="https://habrastorage.org/webt/vv/me/ty/vvmetyazz7-6mzze8-7knxoasxw.png"></div><br>
<br>
<img src="https://habrastorage.org/webt/hr/qa/k6/hrqak6wkoeqsf7nvy8bky_tauym.jpeg" alt="ç”»åƒ"><div style="text-align:center;"><img src="https://habrastorage.org/webt/he/pk/br/hepkbrq20vpteyatek3hv8pi8mg.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸­å¤®æƒãˆã®è©³ç´°ï¼šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å®Œäº†ã™ã‚‹ã¨ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯</font></font><code>contentOffset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœæ­¢</font><font style="vertical-align: inherit;">ã™ã‚‹</font><font style="vertical-align: inherit;">å ´æ‰€ã‚’</font><font style="vertical-align: inherit;">è¦æ±‚</font><font style="vertical-align: inherit;">ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¾ã™</font></font><code>targetContentOffset(forProposedContentOffset:withScrollingVelocity:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ—æªï¼š</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‹•ä½œã‚’ç‰¹å®šã®å¢ƒç•Œã«ã‚¹ãƒŠãƒƒãƒ—ã•ã›ã‚‹å ´åˆã¯ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ã€ãã‚Œã‚’ä½¿ç”¨ã—ã¦åœæ­¢ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã¨ãˆã°ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ã‚¤ãƒ†ãƒ ã®é€”ä¸­ã§åœæ­¢ã™ã‚‹ã®ã§ã¯ãªãã€å¸¸ã«ã‚¢ã‚¤ãƒ†ãƒ é–“ã®å¢ƒç•Œã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åœæ­¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã¹ã¦ã‚’ç¾ã—ãã™ã‚‹ãŸã‚ã«ã€ç§ãŸã¡ã¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¸ã«</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€ã‚‚è¿‘ã„ã‚»ãƒ«ã®ä¸­å¤®ã«ç«‹ã¡æ­¢ã¾ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">æœ€ã‚‚è¿‘ã„ã‚»ãƒ«ã®ä¸­å¿ƒã‚’è¨ˆç®—ã™ã‚‹ã®ã¯ç°¡å˜ãªä½œæ¥­ã§ã™ãŒã€æ³¨æ„ã—ã¦è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font></font><code>contentInset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">targetContentOffset</span><span class="hljs-params">(forProposedContentOffset proposedContentOffset: CGPoint,
                                  withScrollingVelocity velocity: CGPoint)</span></span> -&gt; <span class="hljs-type">CGPoint</span> {
    <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> collection = collectionView <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.targetContentOffset(forProposedContentOffset: proposedContentOffset,<font></font>
                                         withScrollingVelocity: velocity)<font></font>
    }<font></font>
    <span class="hljs-keyword">let</span> cellWithSpacing = itemSize.width + config.distanceBetween
    <span class="hljs-keyword">let</span> relative = (proposedContentOffset.x + collection.contentInset.<span class="hljs-keyword">left</span>) / cellWithSpacing
    <span class="hljs-keyword">let</span> leftIndex = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, floor(relative))
    <span class="hljs-keyword">let</span> rightIndex = <span class="hljs-built_in">min</span>(ceil(relative), <span class="hljs-type">CGFloat</span>(itemsCount))
    <span class="hljs-keyword">let</span> leftCenter = leftIndex * cellWithSpacing - collection.contentInset.<span class="hljs-keyword">left</span>
    <span class="hljs-keyword">let</span> rightCenter = rightIndex * cellWithSpacing - collection.contentInset.<span class="hljs-keyword">left</span><font></font>
â€‹<font></font>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(leftCenter - proposedContentOffset.x) &lt; <span class="hljs-built_in">abs</span>(rightCenter - proposedContentOffset.x) {
        <span class="hljs-keyword">return</span> <span class="hljs-type">CGPoint</span>(x: leftCenter, y: proposedContentOffset.y)<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-type">CGPoint</span>(x: rightCenter, y: proposedContentOffset.y)<font></font>
    }<font></font>
}</code></pre><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/n4/dj/ed/n4djedqhgual-kqq4o3vg-mjxay.gif"></div><div style="text-align:center;"><img src="https://habrastorage.org/webt/0x/bj/xn/0xbjxn8vk5gxiuwvjvjklvhfusa.png"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.å°ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®è¦ç´ ã®å‹•çš„ã‚µã‚¤ã‚º</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤§ããªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«</font></font><code>contentOffset </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã‚‹ã¨ã€å°ã•ãª</font><font style="vertical-align: inherit;">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«</font><font style="vertical-align: inherit;">å¤‰ã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã•ã‚‰ã«ã€å°ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸­å¤®ã®ã‚»ãƒ«ã¯ä»–ã®ã‚»ãƒ«ã»ã©å¤§ããã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã‚µã‚¤ãƒ‰ã‚»ãƒ«ã®ã‚µã‚¤ã‚ºã¯å›ºå®šã•ã‚Œã¦ãŠã‚Šã€ä¸­å¤®ã®ã‚»ãƒ«ã¯ã€å«ã¾ã‚Œã‚‹ç”»åƒã®ç¸¦æ¨ªæ¯”ã¨åŒã˜ã§ã™ã€‚</font></font><br>
<br>
 <img src="https://habrastorage.org/getpro/habr/post_images/6e3/c61/03e/6e3c6103e3602c9a3cbf0b7553a05386.gif"><div style="text-align:center;"><img src="https://habrastorage.org/webt/hw/8q/ma/hw8qma82pik2sus_ul5rbvu8rbm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦–å·®ã®å ´åˆã¨åŒã˜ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</font></font><code>UICollectionViewFlowLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”¨ã«</font><font style="vertical-align: inherit;">ã‚«ã‚¹ã‚¿ãƒ ã®ã‚‚ã®</font><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ä½œæˆã—ã€</font><font style="vertical-align: inherit;">ãã‚Œã‚’å†å®šç¾©ã—</font></font><code>prepareAttributes(attributes:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚ã•ã‚‰ã«ã€å°ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯ã¯è¤‡é›‘ã«ãªã‚‹ã®ã§ã€ã‚»ãƒ«ã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’æ ¼ç´ãŠã‚ˆã³è¨ˆç®—ã™ã‚‹ãŸã‚ã®å€‹åˆ¥ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Cell</span> </span>{
    <span class="hljs-keyword">let</span> indexPath: <span class="hljs-type">IndexPath</span><font></font>
â€‹<font></font>
    <span class="hljs-keyword">let</span> dims: <span class="hljs-type">Dimensions</span>
    <span class="hljs-keyword">let</span> state: <span class="hljs-type">State</span><font></font>
â€‹<font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updated</span><span class="hljs-params">(new state: State)</span></span> -&gt; <span class="hljs-type">Cell</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-type">Cell</span>(indexPath: indexPath, dims: dims, state: state)<font></font>
    }<font></font>
}<font></font>
â€‹<font></font>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Cell</span> </span>{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Dimensions</span> </span>{<font></font>
â€‹<font></font>
        <span class="hljs-keyword">let</span> defaultSize: <span class="hljs-type">CGSize</span>
        <span class="hljs-keyword">let</span> aspectRatio: <span class="hljs-type">CGFloat</span>
        <span class="hljs-keyword">let</span> inset: <span class="hljs-type">CGFloat</span>
        <span class="hljs-keyword">let</span> insetAsExpanded: <span class="hljs-type">CGFloat</span><font></font>
    }<font></font>
â€‹<font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">State</span> </span>{<font></font>
â€‹<font></font>
        <span class="hljs-keyword">let</span> expanding: <span class="hljs-type">CGFloat</span><font></font>
â€‹<font></font>
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> `<span class="hljs-keyword">default</span>`: <span class="hljs-type">State</span> {
            <span class="hljs-type">State</span>(expanding: .zero)<font></font>
        }<font></font>
    }<font></font>
}</code></pre><div style="text-align:center;"><img src="https://habrastorage.org/webt/0c/ma/im/0cmaim03nqx9dpkohrfumymr11a.png"></div><br>
<code>UICollectionViewFlowLayout </code><font style="vertical-align: inherit;"></font><code>collectionViewContentSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªé ˜åŸŸã®ã‚µã‚¤ã‚ºã‚’æ±ºå®š</font><font style="vertical-align: inherit;">ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚Šã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ã®ç”Ÿæ´»ã‚’è¤‡é›‘ã«ã—ãªã„ãŸã‚ã«ã€ä¸­å¤®ã®ç´°èƒã®ã‚µã‚¤ã‚ºã¨ã¯ç„¡é–¢ä¿‚ã«ã€ãã‚Œã‚’ä¸€å®šã®ã¾ã¾ã«ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">å„ã‚»ãƒ«ã®æ­£ã—ã„ã‚¸ã‚ªãƒ¡ãƒˆãƒªã«ã¤ã„ã¦ã¯ã€</font></font><code>aspectRatio </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”»åƒã¨ã‚»ãƒ«ã®ä¸­å¿ƒã‹ã‚‰ã®è·é›¢</font><font style="vertical-align: inherit;">ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font></font><code>contentOffset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿‘ã„ã‚»ãƒ«ã¯ã€è¿‘ã„ãã‚ŒãŒã‚ã‚‹</font></font><code>size.width / size.height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«</font></font><code>aspectRatio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç‰¹å®šã®ã‚»ãƒ«ã®ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã™ã‚‹å ´åˆã€æ®‹ã‚Šã®ã‚»ãƒ«ã‚’ï¼ˆã‚»ãƒ«ã®å·¦å³ã«ï¼‰ç§»å‹•ã—</font></font><code>affineTransform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç‰¹å®šã®ã‚»ãƒ«ã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’è¨ˆç®—ã™ã‚‹ã«ã¯ã€è¿‘å‚ï¼ˆå¯è¦–ï¼‰ã®å±æ€§ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Cell</span> </span>{<font></font>
â€‹<font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attributes</span><span class="hljs-params">(from layout: ThumbnailLayout,
                    with sideCells: [Cell])</span></span> -&gt; <span class="hljs-type">UICollectionViewLayoutAttributes?</span> {<font></font>
â€‹<font></font>
        <span class="hljs-keyword">let</span> attributes = layout.layoutAttributesForItem(at: indexPath)<font></font>
â€‹<font></font>
        attributes?.size = size<font></font>
        attributes?.center = center<font></font>
â€‹<font></font>
        <span class="hljs-keyword">let</span> translate = sideCells.<span class="hljs-built_in">reduce</span>(<span class="hljs-number">0</span>) { (current, cell) -&gt; <span class="hljs-type">CGFloat</span> <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> indexPath &lt; cell.indexPath {
                <span class="hljs-keyword">return</span> current - cell.additionalWidth / <span class="hljs-number">2</span><font></font>
            }<font></font>
            <span class="hljs-keyword">if</span> indexPath &gt; cell.indexPath {
                <span class="hljs-keyword">return</span> current + cell.additionalWidth / <span class="hljs-number">2</span><font></font>
            }<font></font>
            <span class="hljs-keyword">return</span> current<font></font>
        }<font></font>
        attributes?.transform = <span class="hljs-type">CGAffineTransform</span>(translationX: translate, y: .zero)<font></font>
â€‹<font></font>
        <span class="hljs-keyword">return</span> attributes<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> additionalWidth: <span class="hljs-type">CGFloat</span> {<font></font>
        (dims.defaultSize.height * dims.aspectRatio - dims.defaultSize.width) * state.expanding<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> size: <span class="hljs-type">CGSize</span> {
        <span class="hljs-type">CGSize</span>(width: dims.defaultSize.width + additionalWidth,<font></font>
               height: dims.defaultSize.height)<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> center: <span class="hljs-type">CGPoint</span> {
        <span class="hljs-type">CGPoint</span>(x: <span class="hljs-type">CGFloat</span>(indexPath.row) * (dims.defaultSize.width + dims.inset) + dims.defaultSize.width / <span class="hljs-number">2</span>,<font></font>
                y: dims.defaultSize.height / <span class="hljs-number">2</span>)<font></font>
    }<font></font>
}</code></pre><br>
<code>state.expanding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ã»ã¼åŒã˜ã¨è¦‹ãªã•ã‚Œ</font></font><code>parallaxValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">cell</span><span class="hljs-params">(<span class="hljs-keyword">for</span> index: IndexPath, offsetX: CGFloat)</span></span> -&gt; <span class="hljs-type">Cell</span> {<font></font>
â€‹<font></font>
    <span class="hljs-keyword">let</span> cell = <span class="hljs-type">Cell</span>(<font></font>
        indexPath: index,<font></font>
        dims: <span class="hljs-type">Cell</span>.<span class="hljs-type">Dimensions</span>(<font></font>
            defaultSize: itemSize,<font></font>
            aspectRatio: dataSource(index.row),<font></font>
            inset: config.distanceBetween,<font></font>
            insetAsExpanded: config.distanceBetweenFocused),<font></font>
        state: .<span class="hljs-keyword">default</span>)<font></font>
â€‹<font></font>
    <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> attribute = cell.attributes(from: <span class="hljs-keyword">self</span>, with: []) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> cell }<font></font>
â€‹<font></font>
    <span class="hljs-keyword">let</span> cellOffset = attribute.center.x - itemSize.width / <span class="hljs-number">2</span>
    <span class="hljs-keyword">let</span> widthWithOffset = itemSize.width + config.distanceBetween
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(cellOffset - offsetX) &lt; widthWithOffset {
        <span class="hljs-keyword">let</span> expanding = <span class="hljs-number">1</span> - <span class="hljs-built_in">abs</span>(cellOffset - offsetX) / widthWithOffset
        <span class="hljs-keyword">return</span> cell.updated(by: .expand(expanding))<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> cell<font></font>
}<font></font>
â€‹<font></font>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">layoutAttributesForElements</span><span class="hljs-params">(<span class="hljs-keyword">in</span> rect: CGRect)</span></span> -&gt; [<span class="hljs-type">UICollectionViewLayoutAttributes</span>]? {
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span> ..&lt; itemsCount)<font></font>
        .<span class="hljs-built_in">map</span> { <span class="hljs-type">IndexPath</span>(row: $<span class="hljs-number">0</span>, section: <span class="hljs-number">0</span>) }<font></font>
        .<span class="hljs-built_in">map</span> { cell(<span class="hljs-keyword">for</span>: $<span class="hljs-number">0</span>, offsetX: offsetWithoutInsets.x) }<font></font>
        .<span class="hljs-built_in">compactMap</span> { $<span class="hljs-number">0</span>.attributes(from: <span class="hljs-keyword">self</span>, with: cells) }<font></font>
}</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚»ãƒ«ã®è¦ç´ ã‚’é…ç½®ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã€contentOffsetã ã‘ã§ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã«ã‚‚ä¾å­˜ã—ã¾ã™ã€‚</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå°ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ã‚»ãƒ«ãŒåŒã˜ã‚µã‚¤ã‚ºã«ãªã‚Šã¾ã™ã€‚å¤§ããªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹å ´åˆã€ã“ã‚Œã¯ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ ï¼ˆ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gif 3ãŠã‚ˆã³5ã‚’å‚ç…§</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ›´æ–°ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†</font></font><code>ThumbnailLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚¿ã¯è‡ªåˆ†è‡ªèº«ã«ä¿å­˜ã—ã€</font></font><code>DisplayLink </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1ç§’ã‚ãŸã‚Š60å›ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‘¼ã³å‡ºã—ã€ç¾åœ¨ã®é€²è¡ŒçŠ¶æ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«æ§˜ã€…ãªç· ã‚ä»˜ã‘ãŒç°¡å˜</font></font><code>easing functions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚å®Ÿè£…ã¯ã€æŠ•ç¨¿ã®æœ€å¾Œã®ãƒªãƒ³ã‚¯ã«ã‚ã‚‹githubã§ç¢ºèªã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">èª°ã‚‚</font><font style="vertical-align: inherit;">ãŒæ›ã‘ç®—</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã‚‹</font></font><code>ThumbnailLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</font><font style="vertical-align: inherit;">ã«å…¥ã‚Šã¾ã—ã‚‡ã†</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç‰¹å®šã®ç”»åƒãŒä¸­å¤®ã«é…ç½®ã•ã‚Œã‚‹ã¨ã€ãã®ã‚µã‚¤ã‚ºã«</font><font style="vertical-align: inherit;">ã©ã®ç¨‹åº¦</font><font style="vertical-align: inherit;">å½±éŸ¿</font><font style="vertical-align: inherit;">ã™ã‚‹ã‹ã‚’ç¤ºã—</font><font style="vertical-align: inherit;">ã¦ã„ã‚‹ã“ã¨</font><font style="vertical-align: inherit;">ãŒã‚ã‹ã‚Š</font><font style="vertical-align: inherit;">ã¾ã™ã€‚ã§</font></font><code>expandingRate</code><font style="vertical-align: inherit;"></font><code>expanding </code><font style="vertical-align: inherit;"></font><code>Cell</code><font style="vertical-align: inherit;"></font><code>expandingRate </code><font style="vertical-align: inherit;"></font><code>aspectRatio </code><font style="vertical-align: inherit;"></font><code>expandingRate == 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã¹ã¦ã®ã‚»ãƒ«ã¯åŒã˜ã‚µã‚¤ã‚ºã«ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">å°ã•ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®é–‹å§‹æ™‚ã«ã€</font></font><code>expandingRate </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0ã«</font><font style="vertical-align: inherit;">å¤‰æ›ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å®Ÿè¡Œ</font><font style="vertical-align: inherit;">ã—ã€é€†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®æœ€å¾Œã«1ã«å®Ÿè¡Œã—ã¾ã™ã€‚å®Ÿéš›ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ›´æ–°ã™ã‚‹ã¨ã€ä¸­å¤®ã®ã‚»ãƒ«ã¨</font></font><code>transform </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µã‚¤ãƒ‰ã®</font><font style="vertical-align: inherit;">ã‚»ãƒ«ã®ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã‚Š</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><code>contentOffset </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‘ã„ã‚Œã‚“ã§</font><font style="vertical-align: inherit;">æ··ä¹±ã—ãªã„ã§</font><font style="vertical-align: inherit;">ãã ã•ã„ï¼</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScrollAnimation</span>: <span class="hljs-title">NSObject</span> </span>{<font></font>
â€‹<font></font>
    <span class="hljs-class"><span class="hljs-keyword">enum</span> `<span class="hljs-title">Type</span>` </span>{
        <span class="hljs-keyword">case</span> begin
        <span class="hljs-keyword">case</span> end<font></font>
    }<font></font>
â€‹<font></font>
    <span class="hljs-keyword">let</span> type: <span class="hljs-type">Type</span><font></font>
â€‹<font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">run</span><span class="hljs-params">(completion: @escaping <span class="hljs-params">()</span></span></span> -&gt; <span class="hljs-type">Void</span>) {
        <span class="hljs-keyword">let</span> toValue: <span class="hljs-type">CGFloat</span> = <span class="hljs-keyword">self</span>.type == .begin ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>
        <span class="hljs-keyword">let</span> currentExpanding = thumbnails.config.expandingRate
        <span class="hljs-keyword">let</span> duration = <span class="hljs-type">TimeInterval</span>(<span class="hljs-number">0.15</span> * <span class="hljs-built_in">abs</span>(currentExpanding - toValue))<font></font>
â€‹<font></font>
        <span class="hljs-keyword">let</span> animator = <span class="hljs-type">Animator</span>(onProgress: { current, <span class="hljs-number">_</span> <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">let</span> rate = currentExpanding + (toValue - currentExpanding) * current
            <span class="hljs-keyword">self</span>.thumbnails.config.expandingRate = rate
            <span class="hljs-keyword">self</span>.thumbnails.invalidateLayout()<font></font>
        }, easing: .easeInOut)<font></font>
â€‹<font></font>
        animator.animate(duration: duration) { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span><font></font>
            completion()<font></font>
        }<font></font>
    }<font></font>
}</code></pre><div style="text-align:center;"><img src="https://habrastorage.org/webt/sy/sz/ff/syszffr_19xmccnvyw-do9lcqhy.png"></div><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">scrollViewWillBeginDragging</span><span class="hljs-params">(<span class="hljs-number">_</span> scrollView: UIScrollView)</span></span> {
    <span class="hljs-keyword">if</span> scrollView == thumbnails.collectionView {<font></font>
        handle(event: .beginScrolling) <span class="hljs-comment">// call ScrollAnimation.run(type: .begin)</span><font></font>
    }<font></font>
}<font></font>
â€‹<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">scrollViewDidEndDragging</span><span class="hljs-params">(<span class="hljs-number">_</span> scrollView: UIScrollView, willDecelerate decelerate: Bool)</span></span> {
    <span class="hljs-keyword">if</span> scrollView == thumbnails.collectionView &amp;&amp; !decelerate {<font></font>
        thumbnailEndScrolling()<font></font>
    }<font></font>
}<font></font>
â€‹<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">scrollViewDidEndDecelerating</span><span class="hljs-params">(<span class="hljs-number">_</span> scrollView: UIScrollView)</span></span> {
    <span class="hljs-keyword">if</span> scrollView == thumbnails.collectionView {<font></font>
        thumbnailEndScrolling()<font></font>
    }<font></font>
}<font></font>
â€‹<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">thumbnailEndScrolling</span><span class="hljs-params">()</span></span> {<font></font>
    handle(event: .endScrolling) <span class="hljs-comment">// call ScrollAnimation.run(type: .end)</span>
}</code></pre><div style="text-align:center;"><img src="https://habrastorage.org/webt/nu/v0/x7/nuv0x7phez1lg2osumphtri1wao.png"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.ç§»å‹•ã¨å‰Šé™¤ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ã‚»ãƒ«ã‚’æ›´æ–°ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã™ã‚‹è¨˜äº‹ã¯ãŸãã•ã‚“ã‚ã‚Šã¾ã™ãŒã€ç§ãŸã¡ã®å ´åˆã¯å½¹ã«ç«‹ã¡ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">è¨˜äº‹ã¨ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€æ›´æ–°ã•ã‚ŒãŸã‚»ãƒ«ã®å±æ€§ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€å‰Šé™¤ã•ã‚ŒãŸã‚»ãƒ«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã¨å‰¯ä½œç”¨ãŒç™ºç”Ÿã—ã¾ã™- </font></font><code>expanding </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éš£æ¥ã™ã‚‹ã‚»ãƒ«</font><font style="vertical-align: inherit;">ãŒå¤‰æ›´</font><font style="vertical-align: inherit;">ã•ã‚Œã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã«å‰Šé™¤ã•ã‚ŒãŸã‚»ãƒ«ã®ä»£ã‚ã‚Šã«ãªã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ›´æ–°</font></font><code>UICollectionViewFlowLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯æ¬¡ã®ã‚ˆã†</font><font style="vertical-align: inherit;">ã«</font><font style="vertical-align: inherit;">æ©Ÿèƒ½ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚»ãƒ«ã‚’å‰Šé™¤/è¿½åŠ ã—ãŸå¾Œã€</font><font style="vertical-align: inherit;">ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒã©ã®ã‚»ãƒ«ã§æ›´æ–°/å‰Šé™¤/è¿½åŠ ã•ã‚ŒãŸã‹ã‚’çŸ¥ã‚‰ã›ã‚‹</font></font><code>prepare(forCollectionViewUpdates:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é…åˆ—</font></font><code>UICollectionViewUpdateItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">æä¾›ã™ã‚‹</font><font style="vertical-align: inherit;">ãƒ¡ã‚½ãƒƒãƒ‰ãŒèµ·å‹•</font><font style="vertical-align: inherit;">ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã«ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‘¼ã³å‡ºã—ã¾ã™</font></font><br>
<br>
<pre><code class="swift hljs">finalLayoutAttributesForDisappearingItem(at:)<font></font>
initialLayoutAttributesForAppearingDecorationElement(ofKind:at:)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¨è£…é£¾/è£œè¶³ãƒ“ãƒ¥ãƒ¼ã®ãŸã‚ã®å½¼ã‚‰ã®å‹äººã€‚</font><font style="vertical-align: inherit;">æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å±æ€§ã‚’å—ã‘å–ã‚‹ã¨ã€ã¨å‘¼ã°ã‚Œ</font></font><code>finalizeCollectionViewUpdates</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ—æªï¼š</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ¥ãƒ¼ã¯ã€å¤‰æ›´ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒ–ã™ã‚‹å‰ã®æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€æŒ¿å…¥ã€å‰Šé™¤ã€ç§»å‹•ã®ã™ã¹ã¦ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ–ãƒ­ãƒƒã‚¯å†…ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦è¿½åŠ ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€ãã‚Œã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹æƒ…å ±ã®ç®¡ç†ã«é–¢é€£ã™ã‚‹ç›´å‰ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚</font></font><br>
</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•é¡Œã¯ã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ–°ã•ã‚ŒãŸ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚»ãƒ«</font><font style="vertical-align: inherit;">ã«å¯¾ã—ã¦ã®ã¿å±æ€§ã‚’ç‰¹åŒ–ã§ã</font><font style="vertical-align: inherit;">ã€ã™ã¹ã¦ã®ã‚»ãƒ«ã«å¯¾ã—ã¦ã€ã•ã¾ã–ã¾ãªæ–¹æ³•ã§</font><font style="vertical-align: inherit;">å±æ€§</font><font style="vertical-align: inherit;">ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã§ã™ã€‚</font><font style="vertical-align: inherit;">æ–°ã—ã„ä¸­å¤®ã‚»ãƒ«ãŒå¤‰æ›´ã•ã‚Œ</font></font><code>aspectRatio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã‚»ã‚«ãƒ³ãƒ€ãƒª</font><font style="vertical-align: inherit;">ã‚»ãƒ«ãŒå¤‰æ›´ã•ã‚Œ</font></font><code>transform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br>
 <img src="https://habrastorage.org/getpro/habr/post_images/223/6ad/9e0/2236ad9e0cff5fac58a4b490570340c4.gif"> <div style="text-align:center;"><img src="https://habrastorage.org/webt/1b/wa/pf/1bwapfugwecsrwjnnw3imlnviyk.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‰Šé™¤/æŒ¿å…¥æ™‚ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚»ãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã™ã‚‹ã‹ã‚’èª¿ã¹ãŸã¨ã“ã‚ã€ã‚»ãƒ«å†…ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚»ãƒ«ã«ã¯</font><font style="vertical-align: inherit;">ã€æ®‹ã‚Šã®ã‚»ãƒ«ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å ´åˆã«å¤‰æ›´ã§ãã‚‹</font><font style="vertical-align: inherit;">ã‚»ãƒ«</font></font><code>finalizeCollectionViewUpdates</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒå«ã¾ã‚Œ</font></font><code>CABasicAnimation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¦ã„ã‚‹ã“ã¨ãŒ</font><font style="vertical-align: inherit;">ã‚ã‹ã‚Šã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒ­ã‚°ãŒé–“ã“ã¨ãŒç¤ºã•ã‚ŒãŸã¨ãã€ã™ã¹ã¦ãŒæ‚ªåŒ–ã—ãŸ</font></font><code>performBatchUpdates </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ã¯</font></font><code>prepare(forCollectionViewUpdates:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘¼ã°ã‚Œ</font></font><code>prepareAttributes(attributes:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã™ã§ã«å½¼ã‚‰ã¯ã‚‚ã®ã®ã€ç´°èƒã®æ•°ãŒé–“é•ã£ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„</font></font><code>collectionViewUpdates </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã å§‹ã¾ã£ã¦ã„ãªã„ã€ã“ã‚Œã‚’ç¶­æŒã—ã€ç†è§£ã™ã‚‹ã“ã¨ã¯éå¸¸ã«å›°é›£ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã«ã¤ã„ã¦ä½•ãŒã§ãã¾ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">ã“ã‚Œã‚‰ã®çµ„ã¿è¾¼ã¿ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹ã«ã§ãã¾ã™ï¼</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">prepare</span><span class="hljs-params">(forCollectionViewUpdates updateItems: [UICollectionViewUpdateItem])</span></span> {
    <span class="hljs-keyword">super</span>.prepare(forCollectionViewUpdates: updateItems)
    <span class="hljs-type">CATransaction</span>.begin()
    <span class="hljs-type">CATransaction</span>.setDisableActions(<span class="hljs-literal">true</span>)<font></font>
}<font></font>
â€‹<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">finalizeCollectionViewUpdates</span><span class="hljs-params">()</span></span> {
    <span class="hljs-type">CATransaction</span>.commit()<font></font>
}<font></font>
</code></pre><div style="text-align:center;"><img src="https://habrastorage.org/webt/69/ja/x4/69jax4yhfpsjyr5jej-xxpb6pkc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã§ã«è¨˜è¿°ã•ã‚ŒãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æº–å‚™ã—ã¦ã€å‰Šé™¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦å¿…è¦ãªã™ã¹ã¦ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</font></font><code>dataSource </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®æœ€å¾Œã«</font><font style="vertical-align: inherit;">æ›´æ–°</font><font style="vertical-align: inherit;">ã‚’é–‹å§‹ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ã‚»ãƒ«ã®æ•°ãŒã„ã¤å¤‰åŒ–ã™ã‚‹ã‹ã¯è‡ªåˆ†ã§åˆ¶å¾¡ã™ã‚‹ãŸã‚ã€æ›´æ–°æ™‚ã«ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å˜ç´”åŒ–ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">delete</span><span class="hljs-params">(
    at indexPath: IndexPath,
    dataSourceUpdate: @escaping <span class="hljs-params">()</span></span></span> -&gt; <span class="hljs-type">Void</span>,<font></font>
    completion: (() -&gt; <span class="hljs-type">Void</span>)?) {<font></font>
â€‹<font></font>
    <span class="hljs-type">DeleteAnimation</span>(thumbnails: thumbnails, preview: preview, index: indexPath).run {
        <span class="hljs-keyword">let</span> previousCount = <span class="hljs-keyword">self</span>.thumbnails.itemsCount
        <span class="hljs-keyword">if</span> previousCount == indexPath.row + <span class="hljs-number">1</span> {
            <span class="hljs-keyword">self</span>.activeIndex = previousCount - <span class="hljs-number">1</span><font></font>
        }<font></font>
        dataSourceUpdate()<font></font>
        <span class="hljs-keyword">self</span>.thumbnails.collectionView?.deleteItems(at: [indexPath])
        <span class="hljs-keyword">self</span>.preview.collectionView?.deleteItems(at: [indexPath])<font></font>
        completion?()<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®ã‚ˆã†ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã¾ã™ã‹ï¼Ÿ</font></font><code>ThumbnailLayout </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹å®šã®ã‚»ãƒ«ã®å½¢çŠ¶ã‚’æ›´æ–°ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆã‚’ä¿å­˜ã—ã¦</font><font style="vertical-align: inherit;">ã¿ã¾ã—ã‚‡ã†</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThumbnailLayout</span> </span>{<font></font>
â€‹<font></font>
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">CellUpdate</span> = (<span class="hljs-type">Cell</span>) -&gt; <span class="hljs-type">Cell</span>
    <span class="hljs-keyword">var</span> updates: [<span class="hljs-type">IndexPath</span>: <span class="hljs-type">CellUpdate</span>] = [:]<font></font>
    <font></font>
    <span class="hljs-comment">// ...</span><font></font>
    <font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">layoutAttributesForElements</span><span class="hljs-params">(<span class="hljs-keyword">in</span> rect: CGRect)</span></span> -&gt; [<span class="hljs-type">UICollectionViewLayoutAttributes</span>]? {<font></font>
â€‹<font></font>
        <span class="hljs-keyword">let</span> cells = (<span class="hljs-number">0</span> ..&lt; itemsCount)<font></font>
            .<span class="hljs-built_in">map</span> { <span class="hljs-type">IndexPath</span>(row: $<span class="hljs-number">0</span>, section: <span class="hljs-number">0</span>) }<font></font>
            .<span class="hljs-built_in">map</span> { cell(<span class="hljs-keyword">for</span>: $<span class="hljs-number">0</span>, offsetX: offsetWithoutInsets.x) }<font></font>
            .<span class="hljs-built_in">map</span> { cell -&gt; <span class="hljs-type">Cell</span> <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> update = <span class="hljs-keyword">self</span>.config.updates[cell.indexPath] {
                    <span class="hljs-keyword">return</span> update(cell)<font></font>
                }<font></font>
                <span class="hljs-keyword">return</span> cell<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> cells.<span class="hljs-built_in">compactMap</span> { $<span class="hljs-number">0</span>.attributes(from: <span class="hljs-keyword">self</span>, with: cells) <font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Œã°ã€ã‚»ãƒ«ã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ä½¿ã£ã¦ä½•ã§ã‚‚ã§ãã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ä½œæ¥­ä¸­ã«æ›´æ–°ã‚’ã‚¹ãƒ­ãƒ¼ã—ã€ãŠä¸–è¾ã«ãã‚Œã‚‰ã‚’å‰Šé™¤ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’çµ„ã¿åˆã‚ã›ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="swift hljs">updates[index] = newUpdate(updates[index])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å‰Šé™¤ã‚³ãƒ¼ãƒ‰ã¯ã‹ãªã‚Šæ‰±ã„ã«ãã</font><font style="vertical-align: inherit;">ã€ãƒªãƒã‚¸ãƒˆãƒªã®</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DeleteAnimation.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«</font><font style="vertical-align: inherit;">ã«ã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚»ãƒ«é–“ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹åˆ‡ã‚Šæ›¿ãˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚åŒæ§˜ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
 <img src="https://habrastorage.org/getpro/habr/post_images/001/d8d/ca0/001d8dca06df6b68773652760a019bf3.gif"> <div style="text-align:center;"><img src="https://habrastorage.org/webt/mi/6q/bs/mi6qbskcng_u5ehyixy1q0xp_ce.png"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.å‘ãã‚’å¤‰ãˆã¦ã‚‚ã€Œã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã€ã‚»ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯å¤±ã‚ã‚Œã¾ã›ã‚“</font></font></h3><br>
<code>scrollViewDidScroll(_ scrollView:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã¯</font></font><code>contentOffset </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€å‘ãã‚’å¤‰ãˆãŸã¨ãã ã‘ã§ãªãã€ä½•ã‚‰ã‹ã®å€¤ã‚’å–å¾—</font><font style="vertical-align: inherit;">ã—ãŸå ´åˆã§ã‚‚å‘¼ã³å‡ºã•</font><font style="vertical-align: inherit;">ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">2ã¤ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åŒæœŸã™ã‚‹ã¨ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ›´æ–°ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä»¥ä¸‹ã®ãƒˆãƒªãƒƒã‚¯ãŒã§ãã¾ã™ï¼šæ›´æ–°ã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½</font></font><code>scrollView.delegate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«</font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ScrollSynchronizer</span> </span>{<font></font>
â€‹<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">bind</span><span class="hljs-params">()</span></span> {<font></font>
        preview.collectionView?.delegate = <span class="hljs-keyword">self</span>
        thumbnails.collectionView?.delegate = <span class="hljs-keyword">self</span><font></font>
    }<font></font>
â€‹<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">unbind</span><span class="hljs-params">()</span></span> {<font></font>
        preview.collectionView?.delegate = <span class="hljs-literal">nil</span>
        thumbnails.collectionView?.delegate = <span class="hljs-literal">nil</span><font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–¹å‘å¤‰æ›´æ™‚ã«ã‚»ãƒ«ã‚µã‚¤ã‚ºã‚’æ›´æ–°ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">PhotosViewController</span> </span>{<font></font>
â€‹<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewWillTransition</span><span class="hljs-params">(to size: CGSize, with coordinator: UIViewControllerTransitionCoordinator)</span></span> {
        <span class="hljs-keyword">super</span>.viewWillTransition(to: size, with: coordinator)<font></font>
â€‹<font></font>
        contentView.synchronizer.unbind()<font></font>
        coordinator.animate(alongsideTransition: <span class="hljs-literal">nil</span>) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-number">_</span> <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">self</span>?.contentView.synchronizer.bind()<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‘ãã‚’å¤‰æ›´ã™ã‚‹éš›ã«å¿…è¦ãªã‚’å¤±ã‚ãªã„ãŸã‚ã«ã¯</font></font><code>contentOffset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã‚ãªãŸãŒæ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™</font></font><code>targetIndexPath </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«</font></font><code>scrollView.delegate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å‘ãã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå†å®šç¾©ã•ã‚Œã‚‹ã¨ç„¡åŠ¹ã«ãªã‚Šã¾ã™</font></font><code>shouldInvalidateLayout(forBoundsChange:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¤‰æ›´ã™ã‚‹ã¨ã€</font></font><code>bounds </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯æ˜ç¢ºã«ã™ã‚‹ã‚ˆã†ã«æ±‚ã‚ã¾ã™ã€‚æ˜ç¢º</font></font><code>contentOffset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«ã™ã‚‹ãŸã‚ã«ã€å†å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font></font><code>targetContentOffset(forProposedContentOffset:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ—æªï¼š</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ›´æ–°ä¸­ã€ã¾ãŸã¯ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé–“ã§ã®ç§»è¡Œæ™‚ã«ã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ¥ãƒ¼ã¯ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€å¾Œã«ä½¿ç”¨ã™ã‚‹ææ¡ˆã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å¤‰æ›´ã™ã‚‹æ©Ÿä¼šã‚’æä¾›ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¾ãŸã¯ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã‚¢ã‚¤ãƒ†ãƒ ãŒãƒ‡ã‚¶ã‚¤ãƒ³ã«æœ€é©ã§ãªã„æ–¹æ³•ã§é…ç½®ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹å ´åˆã¯ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ¥ãƒ¼ã¯ã€</font></font><code>prepare()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‚ˆã³</font></font><code>collectionViewContentSize </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ã‚½ãƒƒãƒ‰ã‚’</font><font style="vertical-align: inherit;">å‘¼ã³å‡ºã—ãŸå¾Œã«ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></blockquote><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">targetContentOffset</span><span class="hljs-params">(forProposedContentOffset proposedContentOffset: CGPoint)</span></span> -&gt; <span class="hljs-type">CGPoint</span> {
    <span class="hljs-keyword">let</span> targetOffset = <span class="hljs-keyword">super</span>.targetContentOffset(forProposedContentOffset: proposedContentOffset)
    <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> layoutHandler = layoutHandler <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> targetOffset<font></font>
    }<font></font>
    <span class="hljs-keyword">let</span> offset = <span class="hljs-type">CGFloat</span>(layoutHandler.targetIndex) / <span class="hljs-type">CGFloat</span>(itemsCount)
    <span class="hljs-keyword">return</span> <span class="hljs-type">CGPoint</span>(<font></font>
        x: collectionViewContentSize.width * offset - farInset,<font></font>
        y: targetOffset.y)<font></font>
}</code></pre><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i5/5r/sf/i55rsfdujvblk7om3yq2yerabhu.gif"></div><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/ls/6w/ngls6wjfkhkajrg3706i_g11lyo.png"></div><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
èª­ã‚“ã§ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/YetAnotherRzmn/PhotosAppã«ã‚ã‚Šã¾ã™</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja477722/index.html">C ++ã®Googleã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã€‚ãƒ‘ãƒ¼ãƒˆ8</a></li>
<li><a href="../ja477724/index.html">HRãƒ–ãƒ©ãƒ³ãƒ‰habraseminarï¼šæ‰èƒ½ã€ç‹©çŒŸã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã¤ã„ã¦</a></li>
<li><a href="../ja477728/index.html">ãƒãƒ¼ãƒ ãŒç‡ƒãˆå°½ããªã„ã‚ˆã†ã«ãƒ†ã‚£ãƒ ãƒªãƒ€ã‚’ã©ã†ã™ã‚‹ã‹</a></li>
<li><a href="../ja477730/index.html">ChipWhispererï¼šãƒã‚°ãƒã¸ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼æ”»æ’ƒ</a></li>
<li><a href="../ja477732/index.html">æ°´ä¸­ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã®èª¤ã£ãŸæŒ‡åˆ†é¡</a></li>
<li><a href="../ja477736/index.html">ãƒ†ã‚¹ã‚¿ãƒ¼ã®é“ï¼šã€Œãƒãƒ³ãƒ‰ãƒ–ãƒ¬ãƒ¼ã‚­ã€ã‹ã‚‰è‡ªå‹•åŒ–ã¾ã§</a></li>
<li><a href="../ja477738/index.html">iKassaã€ã¾ãŸã¯ã€Œãƒ‡ã‚¸ã‚¿ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ£ãƒ¼ã€ã®æ‰‹å…¥ã‚Œæ–¹æ³•</a></li>
<li><a href="../ja477740/index.html">ãã—ã¦ã€ã‚ãªãŸã®ç›®ã§ã“ã®æœ›é é¡ã‚’ã©ã“ã«è¦‹ã‚‹ã®ã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja477742/index.html">ã€Œã“ã‚“ã«ã¡ã¯ã€Checkmarxï¼ã€Checkmarx SASTã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã€ã‚¯ãƒ¼ãƒ«ãªè„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja477744/index.html">ãªãœå°‚é–€å®¶ã¯æ™‚ã€…æ‚ªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã®ã§ã™ã‹ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>