<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ¿ ğŸ•• â˜˜ï¸ C ++ vtablesã€‚ãƒ‘ãƒ¼ãƒˆ2ï¼ˆä»®æƒ³ç¶™æ‰¿+ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ç”Ÿæˆã‚³ãƒ¼ãƒ‰ï¼‰ ğŸ˜œ ğŸ‘¨ğŸ¾â€ğŸ« ğŸ¤šğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¨˜äº‹ã®ç¿»è¨³ã¯ã€ã‚³ãƒ¼ã‚¹ã€ŒC ++ Developerã€ã®å­¦ç”Ÿã®ãŸã‚ã«ç‰¹åˆ¥ã«æº–å‚™ã•ã‚Œã¾ã—ãŸã€‚ã“ã®æ–¹å‘ã«ç™ºå±•ã™ã‚‹ã“ã¨ã¯èˆˆå‘³æ·±ã„ã§ã™ã‹ï¼ŸGoogle Test Frameworkå®Ÿè·µã‚¯ãƒ©ã‚¹ã®è¨˜éŒ²ã‚’ã”è¦§ãã ã•ã„ï¼
 


 ãƒ‘ãƒ¼ãƒˆ3-ä»®æƒ³ç¶™æ‰¿
 

   , vtables , . .
 

 , , , ,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C ++ vtablesã€‚ãƒ‘ãƒ¼ãƒˆ2ï¼ˆä»®æƒ³ç¶™æ‰¿+ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ç”Ÿæˆã‚³ãƒ¼ãƒ‰ï¼‰</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/480610/"><p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨˜äº‹ã®ç¿»è¨³ã¯ã€ã‚³ãƒ¼ã‚¹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ŒC ++ Developerã€ã®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­¦ç”Ÿã®ãŸã‚ã«ç‰¹åˆ¥ã«æº–å‚™ã•ã‚Œã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã®æ–¹å‘ã«ç™ºå±•ã™ã‚‹ã“ã¨ã¯èˆˆå‘³æ·±ã„ã§ã™ã‹ï¼Ÿ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Test Frameworkå®Ÿè·µ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚¹ã®è¨˜éŒ²ã‚’ã”è¦§</font><font style="vertical-align: inherit;">ãã ã•ã„ï¼</font></font></em></p><br>
<p><img src="https://habrastorage.org/webt/tk/dp/8n/tkdp8nfahc7sglqks8sl_tazk1o.png"></p><br>
<h2 id="chast-3---virtualnoe-nasledovanie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ãƒ¼ãƒˆ3-ä»®æƒ³ç¶™æ‰¿</font></font></h2><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>      ,  vtables    ,     .      .<a name="habracut"></a></p><br>
<p> , , ,   ,          . :</p><br>
<pre><code class="plaintext hljs">class ios ...<font></font>
class istream : virtual public ios ...<font></font>
class ostream : virtual public ios ...<font></font>
class iostream : public istream, public ostream</code></pre><br>
<p>     <code>virtual</code>,  , <code>iostream</code>      <code>ios</code>,             .</p><br>
<p>   ,     :</p><br>
<pre><code class="plaintext hljs">#include &lt;iostream&gt;<font></font>
using namespace std;<font></font>
<font></font>
class Grandparent {<font></font>
 public:<font></font>
  virtual void grandparent_foo() {}<font></font>
  int grandparent_data;<font></font>
};<font></font>
<font></font>
class Parent1 : virtual public Grandparent {<font></font>
 public:<font></font>
  virtual void parent1_foo() {}<font></font>
  int parent1_data;<font></font>
};<font></font>
<font></font>
class Parent2 : virtual public Grandparent {<font></font>
 public:<font></font>
  virtual void parent2_foo() {}<font></font>
  int parent2_data;<font></font>
};<font></font>
<font></font>
class Child : public Parent1, public Parent2 {<font></font>
 public:<font></font>
  virtual void child_foo() {}<font></font>
  int child_data;<font></font>
};<font></font>
<font></font>
int main() {<font></font>
  Child child;<font></font>
}</code></pre><br>
<p>  <code>child</code>.         ,   <code>vtable Child</code>,       ,    .           ,     .</p><br>
<pre><code class="plaintext hljs">(gdb) p child<font></font>
$1 = {&lt;Parent1&gt; = {&lt;Grandparent&gt; = {_vptr$Grandparent = 0x400998 &lt;vtable for Child+96&gt;, grandparent_data = 0}, _vptr$Parent1 = 0x400950 &lt;vtable for Child+24&gt;, parent1_data = 0}, &lt;Parent2&gt; = {_vptr$Parent2 = 0x400978 &lt;vtable for Child+64&gt;, parent2_data = 4195888}, child_data = 0}<font></font>
(gdb) x/600xb 0x400938<font></font>
0x400938 &lt;vtable for Child&gt;:    0x20    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400940 &lt;vtable for Child+8&gt;:  0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400948 &lt;vtable for Child+16&gt;: 0x00    0x0b    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400950 &lt;vtable for Child+24&gt;: 0x70    0x08    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400958 &lt;vtable for Child+32&gt;: 0xa0    0x08    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400960 &lt;vtable for Child+40&gt;: 0x10    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400968 &lt;vtable for Child+48&gt;: 0xf0    0xff    0xff    0xff    0xff    0xff    0xff    0xff<font></font>
0x400970 &lt;vtable for Child+56&gt;: 0x00    0x0b    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400978 &lt;vtable for Child+64&gt;: 0x90    0x08    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400980 &lt;vtable for Child+72&gt;: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400988 &lt;vtable for Child+80&gt;: 0xe0    0xff    0xff    0xff    0xff    0xff    0xff    0xff<font></font>
0x400990 &lt;vtable for Child+88&gt;: 0x00    0x0b    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400998 &lt;vtable for Child+96&gt;: 0x80    0x08    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009a0 &lt;VTT for Child&gt;:   0x50    0x09    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009a8 &lt;VTT for Child+8&gt;: 0xf8    0x09    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009b0 &lt;VTT for Child+16&gt;:    0x18    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009b8 &lt;VTT for Child+24&gt;:    0x98    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009c0 &lt;VTT for Child+32&gt;:    0xb8    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009c8 &lt;VTT for Child+40&gt;:    0x98    0x09    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009d0 &lt;VTT for Child+48&gt;:    0x78    0x09    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009d8:   0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009e0 &lt;construction vtable for Parent1-in-Child&gt;:    0x20    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009e8 &lt;construction vtable for Parent1-in-Child+8&gt;:  0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009f0 &lt;construction vtable for Parent1-in-Child+16&gt;: 0x50    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x4009f8 &lt;construction vtable for Parent1-in-Child+24&gt;: 0x70    0x08    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a00 &lt;construction vtable for Parent1-in-Child+32&gt;: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a08 &lt;construction vtable for Parent1-in-Child+40&gt;: 0xe0    0xff    0xff    0xff    0xff    0xff    0xff    0xff<font></font>
0x400a10 &lt;construction vtable for Parent1-in-Child+48&gt;: 0x50    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a18 &lt;construction vtable for Parent1-in-Child+56&gt;: 0x80    0x08    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a20 &lt;typeinfo name for Parent1&gt;:   0x37    0x50    0x61    0x72    0x65    0x6e    0x74    0x31<font></font>
0x400a28 &lt;typeinfo name for Parent1+8&gt;: 0x00    0x31    0x31    0x47    0x72    0x61    0x6e    0x64<font></font>
0x400a30 &lt;typeinfo name for Grandparent+7&gt;: 0x70    0x61    0x72    0x65    0x6e    0x74    0x00    0x00<font></font>
0x400a38 &lt;typeinfo for Grandparent&gt;:    0x50    0x10    0x60    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a40 &lt;typeinfo for Grandparent+8&gt;:  0x29    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a48:   0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a50 &lt;typeinfo for Parent1&gt;:    0xa0    0x10    0x60    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a58 &lt;typeinfo for Parent1+8&gt;:  0x20    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a60 &lt;typeinfo for Parent1+16&gt;: 0x00    0x00    0x00    0x00    0x01    0x00    0x00    0x00<font></font>
0x400a68 &lt;typeinfo for Parent1+24&gt;: 0x38    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a70 &lt;typeinfo for Parent1+32&gt;: 0x03    0xe8    0xff    0xff    0xff    0xff    0xff    0xff<font></font>
0x400a78:   0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a80 &lt;construction vtable for Parent2-in-Child&gt;:    0x10    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a88 &lt;construction vtable for Parent2-in-Child+8&gt;:  0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a90 &lt;construction vtable for Parent2-in-Child+16&gt;: 0xd0    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400a98 &lt;construction vtable for Parent2-in-Child+24&gt;: 0x90    0x08    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400aa0 &lt;construction vtable for Parent2-in-Child+32&gt;: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400aa8 &lt;construction vtable for Parent2-in-Child+40&gt;: 0xf0    0xff    0xff    0xff    0xff    0xff    0xff    0xff<font></font>
0x400ab0 &lt;construction vtable for Parent2-in-Child+48&gt;: 0xd0    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400ab8 &lt;construction vtable for Parent2-in-Child+56&gt;: 0x80    0x08    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400ac0 &lt;typeinfo name for Parent2&gt;:   0x37    0x50    0x61    0x72    0x65    0x6e    0x74    0x32<font></font>
0x400ac8 &lt;typeinfo name for Parent2+8&gt;: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400ad0 &lt;typeinfo for Parent2&gt;:    0xa0    0x10    0x60    0x00    0x00    0x00    0x00    0x00<font></font>
0x400ad8 &lt;typeinfo for Parent2+8&gt;:  0xc0    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400ae0 &lt;typeinfo for Parent2+16&gt;: 0x00    0x00    0x00    0x00    0x01    0x00    0x00    0x00<font></font>
0x400ae8 &lt;typeinfo for Parent2+24&gt;: 0x38    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400af0 &lt;typeinfo for Parent2+32&gt;: 0x03    0xe8    0xff    0xff    0xff    0xff    0xff    0xff<font></font>
0x400af8 &lt;typeinfo name for Child&gt;: 0x35    0x43    0x68    0x69    0x6c    0x64    0x00    0x00<font></font>
0x400b00 &lt;typeinfo for Child&gt;:  0xa0    0x10    0x60    0x00    0x00    0x00    0x00    0x00<font></font>
0x400b08 &lt;typeinfo for Child+8&gt;:    0xf8    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400b10 &lt;typeinfo for Child+16&gt;:   0x02    0x00    0x00    0x00    0x02    0x00    0x00    0x00<font></font>
0x400b18 &lt;typeinfo for Child+24&gt;:   0x50    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400b20 &lt;typeinfo for Child+32&gt;:   0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400b28 &lt;typeinfo for Child+40&gt;:   0xd0    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400b30 &lt;typeinfo for Child+48&gt;:   0x02    0x10    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400b38 &lt;vtable for Grandparent&gt;:  0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00<font></font>
0x400b40 &lt;vtable for Grandparent+8&gt;:    0x38    0x0a    0x40    0x00    0x00    0x00    0x00    0x00<font></font>
0x400b48 &lt;vtable for Grandparent+16&gt;:   0x80    0x08    0x40    0x00    0x00    0x00    0x00    0x00</code></pre><br>
<p>,   .      :   <code>VTT</code>    construction <code>vtable for X-in-Child</code>?      .<br>
     <code>Child</code>:</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>8 </td>
<td>_vptr$Parent1</td>
</tr>
<tr>
<td>4 </td>
<td>parent1_data (+ 4  )</td>
</tr>
<tr>
<td>8 </td>
<td>_vptr$Parent2</td>
</tr>
<tr>
<td>4 </td>
<td>parent2_data</td>
</tr>
<tr>
<td>4 </td>
<td>child_data</td>
</tr>
<tr>
<td>8 </td>
<td>_vptr$Grandparent</td>
</tr>
<tr>
<td>4 </td>
<td>grandparent_data (+ 4  )</td>
</tr>
</tbody>
</table></div><br>
<p>,  <code>Child</code>   1  Grandparent.     ,     ,       .<br>
  <code>vtable</code>:</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>0x400938</td>
<td>0x20 (32)</td>
<td>virtual-base offset (   )</td>
</tr>
<tr>
<td>0x400940</td>
<td>0</td>
<td>top_offset</td>
</tr>
<tr>
<td>0x400948</td>
<td>0x400b00</td>
<td>typeinfo for Child</td>
</tr>
<tr>
<td>0x400950</td>
<td>0x400870</td>
<td>Parent1::parent1_foo().  vtable Parent1  .</td>
</tr>
<tr>
<td>0x400958</td>
<td>0x4008a0</td>
<td>Child::child_foo()</td>
</tr>
<tr>
<td>0x400960</td>
<td>0x10 (16)</td>
<td>virtual-base offset</td>
</tr>
<tr>
<td>0x400968</td>
<td>-16</td>
<td>top_offset</td>
</tr>
<tr>
<td>0x4009</td>
<td>0x400b</td>
<td>typeinfo for Child</td>
</tr>
<tr>
<td>70</td>
<td>00</td>
<td></td>
</tr>
<tr>
<td>0x400978</td>
<td>0x400890</td>
<td>Parent2::parent2_foo().  vtable Parent2  .</td>
</tr>
<tr>
<td>0x400980</td>
<td>0</td>
<td>virtual-base offset</td>
</tr>
<tr>
<td>0x400988</td>
<td>-32</td>
<td>top_offset</td>
</tr>
<tr>
<td>0x400990</td>
<td>0x400b00</td>
<td>typeinfo for Child</td>
</tr>
<tr>
<td>0x400998</td>
<td>0x400880</td>
<td>Grandparent::grandparent_foo().  vtable Grandparent  .</td>
</tr>
</tbody>
</table></div><br>
<p>    â€” <code>virtual-base offset</code>.   ,    .<br>
      <code>construction vtables</code>.  construction <code>vtable for Parent1-in-Child</code>:</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>0x20 (32)</td>
<td>virtual-base offset</td>
</tr>
<tr>
<td>0</td>
<td>top-offset</td>
</tr>
<tr>
<td>0x400a50</td>
<td>typeinfo for Parent1</td>
</tr>
<tr>
<td>0x400870</td>
<td>Parent1::parent1_foo()</td>
</tr>
<tr>
<td>0</td>
<td>virtual-base offset</td>
</tr>
<tr>
<td>-32</td>
<td>top-offset</td>
</tr>
<tr>
<td>0x400a50</td>
<td>typeinfo for Parent1</td>
</tr>
<tr>
<td>0x400880</td>
<td>Grandparent::grandparent_foo()</td>
</tr>
</tbody>
</table></div><br>
<p>    ,       ,         . :</p><br>
<p>,   <code>Child</code>.        .    <code>Grandparent</code>  (    ),        (      ,     <code>Parent1</code>, ,   ,    <code>Grandparent</code>).   <code>this += 32</code> ,       <code>Grandparent</code>,   .  .</p><br>
<p>    <code>Parent1</code>. <code>Parent1</code>    ,    ,    , <code>Grandparent</code>   ,   , ,       <code>Grandparent</code>.  ,    ,    ?         <code>Parent1</code>!</p><br>
<p>   <code>construction table for Parent1-in-Child</code>.      <code>Parent1</code>,    ,      . <code>this</code>    <code>Parent1</code>. <code>virtual-base offset</code> ,     Grandparent:   32    this,     <code>Grandparent</code>. ? virtual-base offset  top_offset,    .</p><br>
<p>,    ,  <code>Parent2</code>    ,    <code>construction table for Parent2-in-Child</code>.  , <code>Parent2-in-Child</code>  <code>virtual-base offset</code>  16 .</p><br>
<p>   .   ? .<br>
    <code>VTT</code>.   <code>VTT</code>:</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>0x4009a0</td>
<td>0x400950</td>
<td>vtable for Child + 24</td>
<td> Parent1  vtable Child</td>
</tr>
<tr>
<td>0x4009a8</td>
<td>0x4009f8</td>
<td>construction vtable for Parent1-in-Child + 24</td>
<td> Parent1  Parent1-in-Child</td>
</tr>
<tr>
<td>0x4009b0</td>
<td>0x400a18</td>
<td>construction vtable for Parent1-in-Child + 56</td>
<td> Grandparent  Parent1-in-Child</td>
</tr>
<tr>
<td>0x4009b8</td>
<td>0x400a98</td>
<td>construction vtable for Parent2-in-Child + 24</td>
<td> Parent2  Parent2-in-Child</td>
</tr>
<tr>
<td>0x4009c0</td>
<td>0x400ab8</td>
<td>construction vtable for Parent2-in-Child + 56</td>
<td>` Grandparent  Parent2-in-Child</td>
</tr>
<tr>
<td>0x4009c8</td>
<td>0x400998</td>
<td>vtable for Child + 96</td>
<td>` Grandparent  vtable Child</td>
</tr>
<tr>
<td>0x4009d0</td>
<td>0x400978</td>
<td>vtable for Child + 64</td>
<td>` Parent2  vtable Child</td>
</tr>
</tbody>
</table></div><br>
<p><code>VTT</code>   <code>virtual-table table</code> (  ),  ,    vtable-.   ,  , ,    <code>Parent1</code>   ,   <code>Parent1-in-Child</code>   <code>Parent1-in-SomeOtherObject</code>.      <code>vtable</code>,   ,   .         .</p><br>
<p>â€¦  ,   ,    ,    .        <code>vtables</code>   .  ,   , ,      !</p><br>
<h2 id="chast-4---kod-sgenerirovannyy-kompilyatorom"> 4 â€” ,  </h2><br>
<p>       ,   <code>vtables</code>  <code>typeinfo</code>          .     ,      .</p><br>
<h4 id="konstruktory"></h4><br>
<p>      :</p><br>
<ul>
<li>  ,   ;</li>
<li>  vtable,   ;</li>
<li>      ;</li>
<li>    .</li>
</ul><br>
<p>      :</p><br>
<ul>
<li>     ,    ;</li>
<li>   ,            ;</li>
<li>     = default;</li>
<li>  vtable  .</li>
</ul><br>
<p> :</p><br>
<pre><code class="plaintext hljs">#include &lt;iostream&gt;<font></font>
#include &lt;string&gt;<font></font>
using namespace std;<font></font>
<font></font>
class Parent {<font></font>
public:<font></font>
    Parent() { Foo(); }<font></font>
    virtual ~Parent() = default;<font></font>
    virtual void Foo() { cout &lt;&lt; "Parent" &lt;&lt; endl; }<font></font>
    int i = 0;<font></font>
};<font></font>
<font></font>
class Child : public Parent {<font></font>
public:<font></font>
    Child() : j(1) { Foo(); }<font></font>
    void Foo() override { cout &lt;&lt; "Child" &lt;&lt; endl; }<font></font>
    int j;<font></font>
};<font></font>
<font></font>
class Grandchild : public Child {<font></font>
public:<font></font>
    Grandchild() { Foo(); s = "hello"; }<font></font>
    void Foo() override { cout &lt;&lt; "Grandchild" &lt;&lt; endl; }<font></font>
    string s;<font></font>
};<font></font>
<font></font>
int main() {<font></font>
    Grandchild g;<font></font>
}</code></pre><br>
<p>      :</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>Parent</th>
<th>Child</th>
<th>Grandchild</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. vtable = vtable Parent;</td>
<td>1.     Parent;</td>
<td>1.     Child;</td>
</tr>
<tr>
<td>2. i = 0;</td>
<td>2. vtable = vtable Child;</td>
<td>2. vtable = vtable Grandchild;</td>
</tr>
<tr>
<td>3.  Foo();</td>
<td>3. j = 1;</td>
<td>3.,     s;</td>
</tr>
<tr>
<td></td>
<td>4.  Foo();</td>
<td>4.  Foo();</td>
</tr>
<tr>
<td></td>
<td></td>
<td>5.   =  s;</td>
</tr>
</tbody>
</table></div><br>
<p> , ,      vtable   vtable   ,      .  ,     ,     .  , </p><br>
<pre><code class="plaintext hljs">Parent<font></font>
Child<font></font>
Grandchild</code></pre><br>
<p>     ?     (,      ,     ?), , , (  )    segfault.    ,  .</p><br>
<h4 id="destruktory"></h4><br>
<p>    ,     ,  ,    .</p><br>
<p>    :     vtable,      ,       ? :           .     â€”   ,    .</p><br>
<h4 id="neyavnoe-privedenie"> </h4><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>,             (    ).</p><br>
<p>  ,   ()      ,    .  ,     <code>this</code>,         .</p><br>
<h4 id="dinamicheskoe-privedenie-rtti">  (RTTI)</h4><br>
<p>     <code>typeinfo</code>,      .      ,   <code>typeinfo</code>     ,     <code>vtable</code>,    ,  ,   .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> dynamic_cast</a>   .</p><br>
<h4 id="ukazateli-na-metody">  </h4><br>
<p>          .      ,    ,    ,      (     ,   ).</p><br>
<pre><code class="plaintext hljs">// TODO:  ,    </code></pre><br>
<h4 id="proverte-sebya"> !</h4><br>
<p>    ,       ,    :</p><br>
<pre><code class="plaintext hljs">#include &lt;iostream&gt;<font></font>
using namespace std;<font></font>
<font></font>
class FooInterface {<font></font>
public:<font></font>
    virtual ~FooInterface() = default;<font></font>
    virtual void Foo() = 0;<font></font>
};<font></font>
<font></font>
class BarInterface {<font></font>
public:<font></font>
    virtual ~BarInterface() = default;<font></font>
<font></font>
    virtual void Bar() = 0;<font></font>
};<font></font>
<font></font>
class Concrete : public FooInterface, public BarInterface {<font></font>
public:<font></font>
    void Foo() override { cout &lt;&lt; "Foo()" &lt;&lt; endl; }<font></font>
    void Bar() override { cout &lt;&lt; "Bar()" &lt;&lt; endl; }<font></font>
};<font></font>
<font></font>
int main() {<font></font>
    Concrete c;<font></font>
    c.Foo();<font></font>
    c.Bar();<font></font>
<font></font>
    FooInterface* foo = &amp;c;<font></font>
    foo-&gt;Foo();<font></font>
<font></font>
    BarInterface* bar = (BarInterface*)(foo);<font></font>
    bar-&gt;Bar(); //  "Foo()" - WTF?<font></font>
}</code></pre><br>
<p>        .  ,    - ,     .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480594/index.html">å‰å¾Œï¼šæœ‰åãªãƒ“ãƒ‡ã‚ªã‚²ãƒ¼ãƒ ã®è¦–è¦šçš„é€²åŒ–</a></li>
<li><a href="../ja480596/index.html">é©æ–°çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ArubaOS-CXã§ã‚ãªãŸã‚’å¾…ã£ã¦ã„ã‚‹ã‚‚ã®</a></li>
<li><a href="../ja480598/index.html">...ãƒ‘ã‚ºãƒ«ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åŸºç¤</a></li>
<li><a href="../ja480606/index.html">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã¨ã—ã¦ã®ã‚¹ã‚­ãƒ«ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•ã«é–¢ã™ã‚‹5ã¤ã®ã‚¢ã‚¤ãƒ‡ã‚¢ï¼ˆ2019å¹´12æœˆï¼‰</a></li>
<li><a href="../ja480608/index.html">RustãŒC ++ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚²ãƒ¼ãƒ ã®çµæœã§ä¸Šå›ã‚‹</a></li>
<li><a href="../ja480612/index.html">Webãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£åŸºæº–ã‚’æº€ãŸã™ã‚ˆã†ã«ã“ã‚Œã‚‰ã®å¤‰æ›´ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</a></li>
<li><a href="../ja480614/index.html">é«˜é€ŸENUM</a></li>
<li><a href="../ja480618/index.html">é›»å­ã‚²ãƒ¼ãƒ Tic Tac Toeã€‚ç§ã¯ä½•ã«æ¥ã¾ã—ãŸã‹</a></li>
<li><a href="../ja480620/index.html">ç®¡ç†è€…ã‚’æ”¯æ´ã™ã‚‹SD-WANã¨DNAï¼šã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´ã¨å®Ÿè·µ</a></li>
<li><a href="../ja480622/index.html">åˆ©ç”¨å¯èƒ½ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã‚’æ­£ã—ãä½¿ç”¨ã™ã‚‹æ–¹æ³•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>