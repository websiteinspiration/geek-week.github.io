<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😍 🗯️ 🔟 当我用php编写html解析器时，它产生了什么。第一部分 👤 ⛷️ 🤶🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="嘿。
 
 今天，我想告诉大家如何编写html解析器，以及在php中开发类似解析器时遇到的问题。但是有很多问题。在第一部分中，我将讨论解析器的设计以及遇到的问题，因为html解析器与每个人都熟悉的编程语言的解析器不同。
 
 介绍
 我试图尽可能清楚地写出本文的文字，以便所有甚至不熟悉解析器常规设备...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>当我用php编写html解析器时，它产生了什么。第一部分</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505264/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嘿。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今天，我想告诉大家如何编写html解析器，以及在php中开发类似解析器时遇到的问题。</font><font style="vertical-align: inherit;">但是有很多问题。</font><font style="vertical-align: inherit;">在第一部分中，我将讨论解析器的设计以及遇到的问题，因为html解析器与每个人都熟悉的编程语言的解析器不同。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我试图尽可能清楚地写出本文的文字，以便所有甚至不熟悉解析器常规设备的人都可以理解html解析器的工作原理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文的下文中，我将包含html的文档简称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ Document”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
位于元素中的dom树将称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ Subarray”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析器应该做什么？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们首先决定解析器应该做什么，以便将来以此为基础。</font><font style="vertical-align: inherit;">即，解析器应：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设计基于文档的dom树</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果文档中有错误，那么他必须解决它们。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在dom树中查找项目 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找儿童用品 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找文字 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是解析器应该做的最简单的列表。</font><font style="vertical-align: inherit;">如果原始文档中发现任何错误，它仍应以一种很好的方式发送有关错误的信息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，这些都是琐事。</font><font style="vertical-align: inherit;">基本的功能足以让您在几个晚上内沉迷于头部。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是我立即遇到了一个问题：HTML不仅仅是一种语言，它还是一种超文本语言。</font><font style="vertical-align: inherit;">这种语言具有自己的语法，普通的解析器将无法工作。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分而治之</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，您需要将解析器的工作分为两个阶段：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将纯文本与标签分开</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对dom树中所有收到的标签进行排序</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这直接适用于解析文档。我将在本章稍后讨论搜索元素。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了描述第一阶段，我绘制了一个图表，清楚地显示了第一阶段如何处理数据：</font></font><br>
<br>
<img src="https://hsto.org/webt/vi/da/ma/vidama0m4yfx28z5lpj9n9c7ado.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我决定省略所有小细节。例如，如何区分在开头的“ &lt;”之后是标签而不是文本？我将在以下部分中对此进行讨论。现在就足够了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这也值得澄清。逻辑上，在文档中，除了标签之外，还包含文本。简而言之，如果解析器找到了一个开始标记，并且其中包含文本，它将在开始标记之后作为一个单独的标记写入。这样的标签将被视为单个标签，并且不会参与解析器的进一步工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，第二阶段。</font><font style="vertical-align: inherit;">从设计的角度来看，最困难的是，从理解的角度看，乍一看是最简单的：</font></font><br>
<br>
<img src="https://hsto.org/webt/cl/mw/wt/clmwwtchiuag_bey_qkr0c4dwjk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这种情况下，级别表示递归级别。</font><font style="vertical-align: inherit;">也就是说，如果解析器找到了一个开始标记，它会称自己为“进入较低级别”，并且将继续进行直到找到结束标记。</font><font style="vertical-align: inherit;">在这种情况下，递归会产生结果“ Goes a Level Up”。</font><font style="vertical-align: inherit;">但是单个标签呢？</font><font style="vertical-align: inherit;">此类标签既不作为打开也不作为关闭而被视为递归。</font><font style="vertical-align: inherit;">他们只是按原样去dom。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，我们得到这样的东西：</font></font><br>
<br>
<pre><code class="php hljs">[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt;<font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">215</span><font></font>
[tag] =&gt; div<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">// </span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt;<font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">238</span><font></font>
[tag] =&gt; div<font></font>
[id] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; tjojo<font></font>
)<font></font>
<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">// </span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">//     </span><font></font>
(<font></font>
[tag] =&gt; __TEXT<font></font>
[<span class="hljs-number">0</span>] =&gt; !<font></font>
<font></font>
)<font></font>
<font></font>
[<span class="hljs-number">1</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt; <span class="hljs-number">1</span><font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">268</span><font></font>
[tag] =&gt; div<font></font>
)<font></font>
<font></font>
)<font></font>
)<font></font>
)<font></font>
)<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那寻找元素呢？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在让我们谈谈寻找元素。但是在这里，并非所有事情都像您想象的那样清晰。首先，您需要弄清楚我们正在寻找哪些标准。这里的一切都很简单，我们根据与Javascript相同的条件来寻找它们：标记，类和标识符。但这是问题所在。事实是，只能有一个标签，但是一个元素的类和标识符很多，或者根本没有。因此，按标签搜索项目将不同于按类或标识符搜索。我为标签绘制了搜索方案，但是请放心：按类别或标识符进行的搜索差别不大。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/qs/w2/j4qsw2kzjw9bzaxen6mozm6gc0i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一点澄清。</font><font style="vertical-align: inherit;">原始值是指标记的名称，例如“ div”。</font><font style="vertical-align: inherit;">同样，如果一个元素不等于初始值，但是它有一个带有合适元素的子数组，那么如果存在，则结果将被精确地写入带有它的子数组的合适元素。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值得一提的是，解析器将具有允许您在文档中搜索特定元素的功能。</font><font style="vertical-align: inherit;">这将显着提高解析器的性能，从而使其能够更快地执行。</font><font style="vertical-align: inherit;">例如，可以根据需要仅采用找到的第一个元素或第五个元素。</font><font style="vertical-align: inherit;">您必须承认，在这种情况下，解析器更容易搜索元素。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索儿童用品</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好了，整理了对元素的搜索，但是子元素呢？</font><font style="vertical-align: inherit;">在这里，一切也很简单：我们的解析器将获取在此之前找到的元素的所有嵌套子数组（如果有）。</font><font style="vertical-align: inherit;">如果没有，解析器将输出一个空结果并继续：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y0/4a/wy/y04awyfodd4cs4c9n5pijqetnkm.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字搜寻</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
没有什么可谈的。</font><font style="vertical-align: inherit;">解析器将简单地从子数组中获取所有接收到的文本并将其输出。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失误</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该文档可能包含我们的脚本必须成功处理的错误，或者如果该错误很严重，请在屏幕上显示该错误。</font><font style="vertical-align: inherit;">在这里，您将找到我们将来讨论的所有可能错误的列表：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找不到“&gt;”符号。</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
如果解析器到达文档的末尾，但未找到结束的“&gt;”符号，则会发生这种错误。</font></font><br>
</li>
<li><b>  </b><br>
    ,            .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">some</span> =&gt;</span><span class="hljs-comment">&lt;!--   ?    ,   --&gt;</span></code></pre><br>
</li>
<li><b> html </b><br>
     :        "&lt;",    "="  ,      .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">some</span> = =<span class="hljs-string">'something'</span>&gt;</span><span class="hljs-comment">&lt;!-- ,    --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tag</span> &lt;<span class="hljs-attr">some</span> =<span class="hljs-string">'something'</span>&gt;</span><span class="hljs-comment">&lt;!--  ?  ,    ? --&gt;</span></code></pre><br>
</li>
<li><b>   </b><br>
     ,     ,    ,  .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = =<span class="hljs-string">'wefwe'</span>&gt;</span><font></font>
!<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-comment">&lt;!--   &lt;/div&gt;?--&gt;</span>
</code></pre><br>
        .<br>
</li>
<li><b>   </b><br>
  ,    ,  .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = =<span class="hljs-string">'wefwe'</span>&gt;</span><font></font>
!<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--    ?--&gt;</span>
</code></pre><br>
     .<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找不到children元素，</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在这种情况下，解析器将只输出一个空数组。</font></font><br>
</li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本，样式和注释</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在解析器中，脚本和样式标签将被立即跳过，因为我看不到编写它们的意义。</font><font style="vertical-align: inherit;">情况因评论而异。</font><font style="vertical-align: inherit;">如果要写入，则可以启用单独的脚本功能，然后它将编写它们。</font><font style="vertical-align: inherit;">注释将以与文本相同的方式记录，即作为单独的标签。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
相反，本文应被视为与html解析器主题无关的一小部分。</font><font style="vertical-align: inherit;">我为那些正在考虑编写自己的解析器的人或仅为那些感兴趣的人而写。</font><font style="vertical-align: inherit;">相信我，这真的很有趣！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文是本文的第一部分。</font><font style="vertical-align: inherit;">在本系列的下一部分中，代码将直接参与，并且使用算法的图片将更少（这很好，因为我不知道如何绘制它们）。</font><font style="vertical-align: inherit;">敬请关注！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN505252/index.html">Avokado项目</a></li>
<li><a href="../zh-CN505254/index.html">蛇糖或用JavaScript编写范围</a></li>
<li><a href="../zh-CN505256/index.html">成功启动。从年初开始第39。美国第14位。Starlink SpaceX卫星</a></li>
<li><a href="../zh-CN505258/index.html">牙科：期望与现实</a></li>
<li><a href="../zh-CN505260/index.html">使用光学传感器测量从键盘到光子的延迟</a></li>
<li><a href="../zh-CN505268/index.html">个人经验：从前端开发人员到领导者</a></li>
<li><a href="../zh-CN505274/index.html">站点安全的致命罪过：我们从当年的漏洞扫描器统计中学到的信息</a></li>
<li><a href="../zh-CN505276/index.html">我们如何教ABBYY FineReader PDF编辑整个段落</a></li>
<li><a href="../zh-CN505278/index.html">适用于初学者和市场营销人员的39种英文缩写</a></li>
<li><a href="../zh-CN505280/index.html">Magento 2：关键CSS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>