<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïô üõ∑ üßñüèø Dangerous SHA-1 algorithm removed from SSH libraries üêπ ‚û∞ ü§µüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The complexity of attacks on SHA-1. The price is based on the calculation of the rental price of one GTX 1060 at $ 35 / month.
 
 Much later than all ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Dangerous SHA-1 algorithm removed from SSH libraries</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/504950/"><img src="https://habrastorage.org/webt/uo/if/ea/uoifeawbumobjqpqu-f_gc7god4.png"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The complexity of attacks on SHA-1. The price is based on the calculation of the rental price of one GTX 1060 at $ 35 / month.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Much later than all the others, but the developers of the libraries for SSH decided to finally disable the outdated SHA-1 crypto function by default. Today, the selection of the server authentication key SHA-1, that is, a conflict with the selected prefix, on a rented GPU cluster</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will cost $ 45 thousand</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as indicated in the table above. This makes the attack accessible not only for state intelligence services, but also for commercial clients.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Disabling SHA-1 by default was simultaneously announced by the developers of the OpenSSH openSSH (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> release notes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and libssh (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> code change</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">libraries</font><font style="vertical-align: inherit;">.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Secure Hash Algorithm (SHA) was developed by the NSA in collaboration with NIST. The first version of SHA-0 was introduced in 1993, but soon the NSA withdrew this version, citing an error they discovered that was never disclosed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fixed version of the NSA was published in 1995, it was called SHA-1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The SHA-1 (Secure Hash Algorithm 1) cryptographic hash function generates a 160-bit string called a hash digest. Theoretically, digests should be unique for each file, message, or other input to the function. As an input value, SHA-1 accepts a message no more than</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>64</mn></mrow></msup><mo>&amp;#x2212;</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.042ex" height="2.634ex" viewBox="0 -970.7 3031.8 1134.2" role="img" focusable="false" style="vertical-align: -0.38ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/dcmiran/blog/504950/&amp;usg=ALkJrhiN050CvGZW1bQw-YmHg8BxjuDkwQ#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/dcmiran/blog/504950/&amp;usg=ALkJrhiN050CvGZW1bQw-YmHg8BxjuDkwQ#MJMAIN-36"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/dcmiran/blog/504950/&amp;usg=ALkJrhiN050CvGZW1bQw-YmHg8BxjuDkwQ#MJMAIN-34" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/dcmiran/blog/504950/&amp;usg=ALkJrhiN050CvGZW1bQw-YmHg8BxjuDkwQ#MJMAIN-2212" x="1530" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/dcmiran/blog/504950/&amp;usg=ALkJrhiN050CvGZW1bQw-YmHg8BxjuDkwQ#MJMAIN-31" x="2531" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mn>64</mn></mrow></msup><mo>‚àí</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-1">2^{64}-1</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit, i.e. approximately 2 exabytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is clear that the range of digest values ‚Äã‚Äãis smaller than the range of input values. </font><font style="vertical-align: inherit;">But in practice, digest collisions should not be feasible, given the performance capabilities of existing computing resources. </font><font style="vertical-align: inherit;">Unfortunately, SHA-1 no longer meets this criterion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2017, employees at Google and the Center for Mathematics and Computer Science in Amsterdam introduced the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first way to generate collisions for SHA-1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They published a proof: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two PDF documents</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with different contents but the same digital signatures SHA-1.</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://shattered.it/static/shattered-1.pdf</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://shattered.it/static/shattered-2.pdf</font></font></a></li>
</ul><br>
<pre><code class="plaintext hljs">  $ls -l sha*.pdf <font></font>
  -rw-r--r--@ 1 amichal  staff  422435 Feb 23 10:01 shattered-1.pdf<font></font>
  -rw-r--r--@ 1 amichal  staff  422435 Feb 23 10:14 shattered-2.pdf<font></font>
  $shasum -a 1 sha*.pdf<font></font>
  38762cf7f55934b34d179ae6a4c80cadccbb7f0a  shattered-1.pdf<font></font>
  38762cf7f55934b34d179ae6a4c80cadccbb7f0a  shattered-2.pdf</code></pre><br>
<img src="https://habrastorage.org/getpro/habr/post_images/576/780/0bf/5767800bfd2c7d5bb07d164e3f5b519e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shattered.it</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website, </font><font style="vertical-align: inherit;">you can check any file for whether it is included in the space of possible collisions. That is, is it possible to pick up another data set (file) with the same hash. The attack vector is clear: an attacker can replace a ‚Äúgood‚Äù file with his copy with a bookmark, a malicious macro or a trojan downloader. And this ‚Äúbad‚Äù file will have the same hash or digital signature. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In recent years, many programs and services have stopped using SHA-1 after researchers have shown practical ways to counterfeit digital signatures using SHA-1. The unanimous opinion of experts is that this algorithm is now not safe in almost all security contexts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google has long expressed its distrust of SHA-1, especially as using this feature to sign TLS certificates. Back in 2014, the Chrome development team </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">announced</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the phasing out of SHA-1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2017, researchers used the Google infrastructure to perform calculations and check theoretical calculations of how much the search for collision would take. Developers say this was one of the largest computing ever done by Google. In total, nine quintillion SHA-1 calculations were performed (9,223,372,036,854,775,808), which required 6,500 processor years in the first phase and 110 years of GPU in the second phase of the attack. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Message blocks with the same SHA-1 hash</font></font></b><br>
<img src="https://habrastorage.org/files/b4f/fcb/97a/b4ffcb97a3ad4ca8975e6c69e9a81719.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2019, researchers Gaetan Laurent and Thomas Peyrin demonstrated an attack on finding a conflict with a chosen-prefix, which makes practical sense for selecting specific PGP / GnuPG encryption keys. Finally, in January 2020, the authors managed to optimize the attack by an order of magnitude and reduce its theoretical cost to a commercially acceptable price (see table above and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). To demonstrate, they created a pair of different PGP / GnuPG keys with the same SHA-1 certificates. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a defense against an attack on finding SHA-1 collisions, it is recommended to switch to better cryptographic hash functions SHA-256 and SHA-3.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenSSH developers, who wrote in the notes for the latest release, cite this study from January 2020: ‚ÄúNow you can perform attacks with the selected prefix using the SHA-1 algorithm for less than 50 thousand US dollars. For this reason, in the near future we will disable the default ssh-rsa public key signing algorithm. Unfortunately, this algorithm is still widely used. Despite the existence of better alternatives, it has long remained the only public key signature algorithm defined by the original SSH RFC. ‚Äù </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Among the best alternatives, OpenSSH developers call the RFC8332 RSA SHA-2 algorithms (supported from OpenSSH 7.2 and already used by default if the server and client support it), ssh-ed25519 (supported from 6.5) and RFC5656 ECDSA (from version 5.7) .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To verify that the server uses the weak SHA-1 algorithm when generating the public key for authentication, try connecting to it after removing the ssh-rsa algorithm from the list of allowed in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh (1)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">ssh -oHostKeyAlgorithms=-ssh-rsa user@host</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the verification fails and other types of keys are not available, then the server software should be updated. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In future versions of OpenSSH, the UpdateHostKeys option will be enabled by default, in which the client will automatically switch to the best algorithms. It can be activated manually. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apparently, the complete shutdown of SHA-1 will take a lot of time. Gaetan Laurent of the National Institute for Research in Informatics and Automation (France), one of the co-authors of the January study, does not expect OpenSSH developers to quickly do this: ‚ÄúWhen they completely disable SHA-1, it will be impossible to connect from the new version of OpenSSH to the device with the old SSH server, - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">he. </font><font style="vertical-align: inherit;">- Probably, before this they will take a series of gradual steps (with loud warnings). </font><font style="vertical-align: inherit;">On the other hand, in embedded systems with SSH that have not been updated for many years, there are probably many security problems, so it might not be too bad to disrupt their work ... Anyway, I am quite pleased with this move, this exactly what we wanted to achieve :-) ‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After OpenSSH and libssh announced plans to disable SHA-1, the list of SHA-1 users became shorter, but did not disappear. </font><font style="vertical-align: inherit;">The feature is still supported in the latest versions of the OpenSSL library, which many websites and Internet services use to implement HTTPS and other encryption protocols. </font><font style="vertical-align: inherit;">The latest version of the GNU Collection compiler, released earlier this month, is digitally signed with the SHA-1 hash. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linus Torvalds</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">said</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that in Git repositories hash collisions do not pose a security risk. He explained that there is a big difference between using a cryptographic hash for digital signatures in encryption systems and for generating ‚Äúcontent identification‚Äù in a system like Git. When all the data is in the public domain, then a real attack is almost impossible. The authors of the scientific work give an example of an attack on documents with the same prefix. This attack is successful because the prefix itself is ‚Äúclosed‚Äù inside the document, like a blob. If we have open source in the repository, then this is a completely different matter. It is hardly possible to make such a prefix from the source code (only from blob). In other words, to create an identical prefix and then generate code branches with the same SHA-1 hashes, you will have to inject some random data into the code, which will be noticed right away. Linus saysthat there are places where you can hide the data, but</font></font><code>git fsck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">already catches such tricks. </font><font style="vertical-align: inherit;">However, Linus has a plan to get away from using SHA-1 so that no one even has to convert their repositories.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504926/index.html">How to choose the best automation tool for your work in Revit. Designers vs programmers</a></li>
<li><a href="../en504936/index.html">TechTrain 2020: free "festival on the fly"</a></li>
<li><a href="../en504938/index.html">Mom, I'm a streamer now</a></li>
<li><a href="../en504940/index.html">How PostgreSQL works with disk. Ilya Kosmodemyansky</a></li>
<li><a href="../en504944/index.html">‚ÄúIdeally, we would like to replace Spring with Micronaut altogether‚Äù - an interview with Graham Rocher on Micronaut's development prospects</a></li>
<li><a href="../en504954/index.html">How to write your own processor or expand functionality in NiFi</a></li>
<li><a href="../en504956/index.html">The book ‚ÄúGenerative deep learning. The creative potential of neural networks ‚Äù</a></li>
<li><a href="../en504960/index.html">School of testers. How it was</a></li>
<li><a href="../en504964/index.html">5 claims to Deno</a></li>
<li><a href="../en504966/index.html">5 Pitfalls to Personal Effectiveness</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>