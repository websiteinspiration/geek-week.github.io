<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÑ üßëüèø‚Äçü§ù‚Äçüßëüèº ‚ôàÔ∏è ¬øC√≥mo funciona Ryuk ransomware que ataca a las empresas? ‚úçüèæ üë¶üèº üó®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ryuk es una de las opciones de ransomware m√°s conocidas en los √∫ltimos a√±os. Desde que apareci√≥ por primera vez en el verano de 2018, ha compilado una...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>¬øC√≥mo funciona Ryuk ransomware que ataca a las empresas?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497696/"><img src="https://habrastorage.org/webt/wc/6r/b3/wc6rb3xxu-e_aw_mg1pxcy_23yq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryuk es una de las opciones de ransomware m√°s conocidas en los √∫ltimos a√±os. </font><font style="vertical-align: inherit;">Desde que apareci√≥ por primera vez en el verano de 2018, ha compilado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una impresionante lista de v√≠ctimas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , especialmente en el entorno empresarial, que es el objetivo principal de sus ataques.</font></font><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Informaci√≥n General</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este documento contiene un an√°lisis de la opci√≥n de ransomware Ryuk, as√≠ como del gestor de arranque responsable de descargar el malware al sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ransomware Ryuk apareci√≥ por primera vez en el verano de 2018. Una de las diferencias entre Ryuk y otros ransomware es que tiene como objetivo atacar entornos corporativos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A mediados de 2019, los grupos de delitos cibern√©ticos atacaron a una gran cantidad de empresas espa√±olas con la ayuda de este criptor. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x5/ax/et/x5axetxacru5kb7h6er1vagmdqy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/oc/kn/ee/ockneevf4elmwczdwsmimtsvnuk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura </font></font><br>
</i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">1: Extracto de El Confidencial sobre el ataque del ransomware Ryuk [1] </font></i><i><font style="vertical-align: inherit;">2: Extracto de El Pa√≠s sobre un ataque de ransomware Ryuk [2]</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Este a√±o, Ryuk atac√≥ a un gran n√∫mero de empresas en diferentes pa√≠ses. Como puede ver en las siguientes figuras, Alemania, China, Argelia e India fueron las que m√°s sufrieron.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al comparar la cantidad de ataques cibern√©ticos, podemos ver que millones de usuarios se vieron afectados por Ryuk y la gran cantidad de datos se vio comprometida, lo que result√≥ en un grave da√±o econ√≥mico. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/4u/y-/-p4uy-fnectlv0mqwtvupfa--vc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 3: Ilustraci√≥n de la actividad global de Ryuk. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/sq/oe/hm/sqoehmto6enrwgz6kjt4_sdpgz0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 4: 16 pa√≠ses m√°s afectados por Ryuk </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/qj/1_/d2/qj1_d2eze5bigcd0gqvvrwiw9ns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 5: El n√∫mero de usuarios atacados por el ransomware Ryuk (en millones)</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De acuerdo con el principio habitual del funcionamiento de tales amenazas, este ransomware despu√©s del cifrado muestra a la v√≠ctima una notificaci√≥n de rescate que debe pagarse en bitcoins a la direcci√≥n especificada para restaurar el acceso a los archivos cifrados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este malware ha cambiado desde que apareci√≥ por primera vez.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se descubri√≥ una variante de esta amenaza analizada en este documento durante un intento de lanzar un ataque en enero de 2020. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido a su complejidad, este malware a menudo se atribuye a los cibercriminales organizados, tambi√©n conocidos como grupos APT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parte del c√≥digo de Ryuk tiene una notable semejanza con el c√≥digo y la estructura de otro conocido cript√≥grafo de Hermes, con el que tienen varias funciones id√©nticas. Es por eso que Ryuk se asoci√≥ inicialmente con el grupo norcoreano Lazarus, que en ese momento se sospechaba que estaba detr√°s del ransomware Hermes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posteriormente, el Halc√≥n X de CrowdStrike se√±al√≥ que Ryuk fue creado por WIZARD SPIDER [4].</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay alguna evidencia para apoyar esta suposici√≥n. En primer lugar, este ransomware se promocion√≥ en el sitio web exploit.in, que es un conocido mercado ruso de malware y que anteriormente estaba asociado con algunos grupos APT rusos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este hecho excluye la teor√≠a de que Ryuk podr√≠a ser desarrollado por el grupo APT Lazarus, como esto no coincide con la forma en que act√∫a el grupo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, Ryuk fue promocionado como un encriptador que no funcionar√° en sistemas rusos, ucranianos y bielorrusos. Este comportamiento est√° determinado por la funci√≥n que se encuentra en algunas versiones de Ryuk, donde comprueba el idioma del sistema en el que se ejecuta este cifrador y detiene su funcionamiento si el sistema tiene ruso, ucraniano o bielorruso. Finalmente, al realizar un an√°lisis experto de una m√°quina que fue pirateada por el grupo WIZARD SPIDER, se descubrieron varios "artefactos" que supuestamente se utilizaron en el desarrollo de Ryuk como una variante del ransomware Hermes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por otro lado, los expertos Gabriela Nicolao y Luciano Martins sugirieron que el cript√≥grafo podr√≠a haber sido desarrollado por el equipo CryptoTech APT [5].</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto se desprende del hecho de que unos meses antes de la aparici√≥n de Ryuk, este grupo public√≥ informaci√≥n en el foro del mismo sitio donde hab√≠an desarrollado una nueva versi√≥n del ransomware Hermes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Varios usuarios del foro se han preguntado si CryptoTech realmente cre√≥ Ryuk. </font><font style="vertical-align: inherit;">Despu√©s de eso, este grupo se defendi√≥ y declar√≥ que ten√≠a evidencia de que hab√≠an desarrollado el 100% de este encriptador.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Caracter√≠sticas</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenzamos con el gestor de arranque, cuya tarea es identificar el sistema en el que se encuentra, para que pueda ejecutar la versi√≥n "correcta" del encriptador Ryuk. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El hash del gestor de arranque es el siguiente: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MD5 A73130B0E379A989CBA3D695A157A495 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA256 EF231EE1A2481B7E627921468E79BB4369CCFAEB19A575748DD2B664ABC4F469 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las caracter√≠sticas de este gestor de arranque es que no contiene ning√∫n dato. Los creadores de este malware no incluyeron ninguna informaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces incluyen datos err√≥neos para que el usuario piense que supuestamente est√° lanzando una aplicaci√≥n leg√≠tima. </font><font style="vertical-align: inherit;">Sin embargo, como veremos m√°s adelante, en el caso de que la infecci√≥n no implique interacci√≥n con el usuario (como es el caso con este encriptador), los atacantes no consideran necesario utilizar metadatos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/zx/yu/rjzxyuaec1nfxajxzwufks4hb0w.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">6: metadatos de muestra La muestra</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
se compil√≥ en formato de 32 bits para que pueda ejecutarse tanto en sistemas de 32 bits como de 64 bits.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Vector de penetraci√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La muestra que descarga y lanza Ryuk ingres√≥ a nuestro sistema a trav√©s de una conexi√≥n remota, y los par√°metros de acceso se obtuvieron gracias a un ataque RDP preliminar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/jd/bj/ptjdbj8ce7mgfuy8vowq8gogitm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 7: Registro de ataques Un</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
atacante logr√≥ iniciar sesi√≥n en un sistema de forma remota. Despu√©s de eso, cre√≥ un archivo ejecutable con nuestra muestra. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este archivo ejecutable fue bloqueado por una soluci√≥n antivirus antes del lanzamiento. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ez/gj/gq/ezgjgq4iagc2lep3pebhom5cox0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 8: Bloqueo de la muestra </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/tg/zv/-k/tgzv-keet96r81465eywpeahn8a.jpeg"><br>
<img src="https://habrastorage.org/webt/c_/0j/wz/c_0jwzu0madpx1t-pmfdznt-xny.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 9: Bloqueo de muestra</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cuando se bloque√≥ un archivo malicioso, el atacante intent√≥ descargar una versi√≥n cifrada del archivo ejecutable, que tambi√©n fue bloqueado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/f8/mh/zaf8mhwwbu4rr9u_elmazc9cmns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 10: Un conjunto de muestras que un atacante intent√≥ ejecutar</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Finalmente, intent√≥ descargar otro archivo malicioso a trav√©s de una consola encriptada</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShell para evitar la protecci√≥n antivirus. </font><font style="vertical-align: inherit;">Pero tambi√©n fue bloqueado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/4b/mj/lw4bmjqpqtkf1zrqhhe0zb-4rzm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">11: PowerShell con el contenido malicioso bloqueado </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/eu/dj/he/eudjheox40zpaop3cphprkuc-5c.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. </font><font style="vertical-align: inherit;">12: PowerShell con contenido malicioso bloqueado</font></font><br>
 </i><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Cargador de arranque</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se ejecuta, escribe el archivo L√©ame en la carpeta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% temp%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que es t√≠pico de Ryuk. Este archivo - una demanda de rescate, que contiene la direcci√≥n de correo electr√≥nico del dominio protonmail, que es bastante com√∫n en esta familia de malware: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msifelabem1981@protonmail.com </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/qt/pg/zm/qtpgzmcdohk4siulk9nuayvwhqm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bk/wa/u9/bkwau9on8kixa8bsmiikectemqu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 13: Requisito de canje</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Durante la ejecuci√≥n del gestor de arranque, puede ver que lanza varios archivos ejecutables con nombres aleatorios. Se almacenan en una carpeta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P√öBLICA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oculta </font><font style="vertical-align: inherit;">, pero si la opci√≥n </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mostrar archivos y carpetas ocultos"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font><b><font style="vertical-align: inherit;">est√°</font></b><font style="vertical-align: inherit;"> activa en el sistema operativo </font><font style="vertical-align: inherit;">, permanecer√°n ocultos. Adem√°s, estos archivos son de 64 bits a diferencia del archivo principal, que es de 32 bits.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/ko/z3/8bkoz3_hgnilr-2i7sytnv5g2ik.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/fe/fb/z-/fefbz-5_yiuoiftotqmnei2hrvq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 14: Archivos ejecutables lanzados por la muestra</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como puede ver en la figura anterior, Ryuk lanza icacls.exe, que se utilizar√° para modificar todas las ACL (lista de control de acceso), garantizando as√≠ el acceso y el cambio de banderas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los usuarios obtienen acceso completo a todos los archivos del dispositivo (/ T) independientemente de los errores (/ C) y sin mostrar ning√∫n mensaje (/ Q). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mf/bt/nc/mfbtnclxe4usjepbuizjzknslmu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. Figura 15: Opciones de ejecuci√≥n para icacls.exe iniciadas por la muestra.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es importante tener en cuenta que Ryuk verifica qu√© versi√≥n de Windows se est√° ejecutando. Para hacer esto, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
verifica la versi√≥n usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetVersionExW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en el cual verifica el valor del indicador </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lpVersionInformation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mostrando si la versi√≥n actual de Windows es posterior a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/iv/yv/lcivyvqvjmm8jximv35wbo_v8ps.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/g8/t_/da/g8t_dabeoemyz2v0u93a8ivfilk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependiendo de si est√° ejecutando una versi√≥n posterior a Windows XP, el gestor de arranque escribir√° en la carpeta de usuario local, en este caso, la carpeta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Public%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/gr/at/gggrateobojjggmubdykjordzy4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 17: Verificaci√≥n de la versi√≥n del sistema operativo El</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
archivo grabado es Ryuk. Luego lo inicia, pasando su propia direcci√≥n como par√°metro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/0f/ct/hh0fctenv0yqswmtw9rhmhjjwv0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 18: Ejecutar Ryuk a trav√©s de ShellExecute</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lo primero que hace Ryuk es obtener los par√°metros de entrada. Esta vez hay dos par√°metros de entrada (el archivo ejecutable en s√≠ y la direcci√≥n del cuentagotas), que se utilizan para eliminar sus propios rastros. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/wu/vo/1rwuvoxtlg3lmusyoiem1v-e3da.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/op/wf/f7/opwff7lstsb0iq-nbvfqipywy6y.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 19: Crear un proceso</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n puede ver que tan pronto como lanz√≥ sus archivos ejecutables, se elimina a s√≠ mismo, sin dejar rastro de su presencia en la carpeta donde fue ejecutado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/ui/af/tpuiafv8uy2rmzsuememmnkaxxa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">20: eliminaci√≥n de archivos</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. RYUK</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 Presencia</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ryuk, como otro malware, intenta permanecer en el sistema el mayor tiempo posible. Como se muestra arriba, una forma de lograr este objetivo es crear y ejecutar secretamente archivos ejecutables. Para esto, la pr√°ctica m√°s com√∫n es modificar la clave de registro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CurrentVersion \ Run</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, puede ver que para este prop√≥sito, el primer archivo ejecutable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VWjRF.exe</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(el nombre del archivo se genera aleatoriamente) inicia </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/8b/g2/sd8bg232guhntext0cy-exeh3be.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nn/og/fo/nnogfoscybmwjhn9xnwd0gw7118.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 21: Ejecutando el archivo VWjRF.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Luego se ingresa un comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el nombre " </font><b><font style="vertical-align: inherit;">svchos</font></b><font style="vertical-align: inherit;"> "</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Por lo tanto, si desea verificar las claves de registro en cualquier momento, no puede notar f√°cilmente este cambio, dada la similitud de este nombre con svchost. Gracias a esta clave, Ryuk asegura su presencia en el sistema. Si el sistema a√∫n no ha sido infectado luego, cuando reinicie el sistema, el ejecutable volver√° a intentarlo </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/my/42/tamy42jg8mihxlgmxgzfjzqvfui.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 22: La muestra asegura la presencia de la clave de registro</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tambi√©n podemos ver que este ejecutable detiene los dos servicios: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audioendpointbuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", que, como su nombre lo indica, coincide con el sistema audio, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h-/28/g8/h-28g8z69elv6rzdsjo2xuvrok4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 23: La muestra detiene el audio del sistema</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
y el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servicio samss</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que es un servicio de administraci√≥n de cuentas. Detener estos dos servicios es una caracter√≠stica de Ryuk. En este caso, si el sistema est√° conectado al sistema SIEM, el encriptador intenta dejar de enviar </font><font style="vertical-align: inherit;">advertencias </font><font style="vertical-align: inherit;">a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIEM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por lo tanto, defiende sus pr√≥ximos pasos, ya que algunos servicios de SAM no podr√°n comenzar su trabajo correctamente despu√©s de que se ejecute Ryuk. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/fn/l1/wjfnl14it7llrkny9xpfvrs30di.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 24: La muestra detiene el servicio Samss. </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 Privilegios</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En t√©rminos generales, Ryuk comienza con un movimiento horizontal dentro de la red o es lanzado por otro programa malicioso, como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emotet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trickbot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que en caso de escalada de privilegios transfiere estos derechos elevados al encriptador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De antemano, como preludio del proceso de implementaci√≥n, vemos que ejecuta el proceso </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImpersonateSelf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que significa que el contenido de seguridad del token de acceso se transferir√° a la secuencia, donde se recibir√° inmediatamente usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCurrentThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/nm/ut/9ynmutmaqq2wovbdswheiipajcc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 25: Llamar a ImpersonateSelf</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Luego vemos que asociar√° el token de acceso con la secuencia. Tambi√©n vemos que uno de los indicadores es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DesiredAccess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se puede usar para controlar el acceso que tendr√° la transmisi√≥n. En este caso, el valor que recibir√° edx debe ser </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_ALL_ACESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_WRITE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/vc/a_/uivca_yeyyvr5m-hwyolmei6k3u.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/tm/gy/yg/tmgyygvshjspnungxwqitl_jqm0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 26: Crear un token de flujo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Luego usar√°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeDebugPrivilege</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tambi√©n realizar√° una llamada para obtener los derechos de depuraci√≥n de depuraci√≥n en relaci√≥n con la secuencia, como resultado de lo cual, al especificar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROCESS_ALL_ACCESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , podr√° acceder a cualquier proceso requerido. Ahora, dado que el encriptador ya tiene una secuencia preparada, solo queda pasar a la etapa final. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/lf/ki/0mlfkifvdv7hk7rizfyus_7oco4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 27: Llamar a SeDebugPrivilege y la funci√≥n de escalar derechos</font></font><br>
 </i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por un lado, tenemos LookupPrivilegeValueW, que nos proporciona la informaci√≥n necesaria sobre los privilegios que queremos aumentar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/wd/db/tswddbwi0jyghyqjpniu6rphmpe.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 28: Solicitud de informaci√≥n sobre privilegios para su escalado.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por otro lado, tenemos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdjustTokenPrivileges</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que nos permite obtener los derechos necesarios para nuestra transmisi√≥n. En este caso, lo m√°s importante es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewState.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuya bandera otorgar√° privilegios. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/sx/pa/kisxpam9ymp6ivk8remgfwfx4aq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/9m/0s/sa/9m0ssakqkkjd4wzm4wqfav-mn7g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. Figura 29: Establecer derechos para el token </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3 Implementaci√≥n</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En esta secci√≥n, mostraremos c√≥mo la muestra realiza el proceso de implementaci√≥n mencionado anteriormente en este informe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El objetivo principal del proceso de implementaci√≥n, as√≠ como la escalada, es obtener acceso a las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instant√°neas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Para hacer esto, necesita trabajar con la transmisi√≥n con privilegios m√°s altos que los del usuario local. Tan pronto como obtenga esos derechos m√°s altos, eliminar√° las copias y realizar√° cambios en otros procesos para que sea imposible regresar a un punto de restauraci√≥n anterior en el sistema operativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como suele ser el caso con este tipo de malware, utiliza </font><b><font style="vertical-align: inherit;">CreateToolHelp32Snapshot</font></b><font style="vertical-align: inherit;"> para completar la implementaci√≥n</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por lo que toma una instant√°nea de los procesos que se est√°n ejecutando actualmente e intenta acceder a estos procesos utilizando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tan pronto como tiene acceso al proceso, tambi√©n abre un token con su informaci√≥n para obtener los par√°metros del proceso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/do/xz/dcdoxzczq1ti1kf5fu_5y_rikc8.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Figura </font><i><font style="vertical-align: inherit;">30: Recepci√≥n de procesos desde una computadora</font></i><font style="vertical-align: inherit;"> Podemos ver din√°micamente c√≥mo recibe una lista de procesos en ejecuci√≥n en la rutina 140002D9C usando CreateToolhelp32Snapshot. Despu√©s de recibirlos, revisa la lista e intenta abrir los procesos uno por uno usando OpenProcess hasta que pueda hacerlo. En este caso, el primer proceso que pudo abrir fue </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"taskhost.exe"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k0/24/og/k024ogcd6ioxwnjbfuhjuefrce4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 31: Ejecuci√≥n din√°mica de un procedimiento para obtener un proceso.</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos ver que posteriormente lee el token del proceso, por lo que es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcessToken</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con la " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20008</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/zl/kn/8jzlkngsiwxlyol93ozqx8ebjrm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 32: Leer la informaci√≥n del token del proceso</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tambi√©n verifica que el proceso en el que se incrustar√° no sea </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explorer.exe, lsaas.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o que tenga un conjunto de permisos de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autoridad NT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/xr/9k/hrxr9kefgjfbtsex5awxtlqmjcm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. Figura 33: Procesos excluidos.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Podemos ver din√°micamente c√≥mo se verifica primero usando la informaci√≥n de token de proceso en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">140002D9C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para averiguar si la cuenta cuyos derechos se utilizan para ejecutar el proceso es una cuenta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/_v/-c/4v_v-cloz4ndee9gs0qbihghn9k.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 34: Verificaci√≥n de NT AUTHORITY</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Y luego, fuera del procedimiento, verifica que no sea </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe, explorer.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsaas.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wa/uy/gg/wauyggzhisvonm1cyqr3cahfdc0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 35: Verificaci√≥n de la AUTORIDAD DE NT</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Despu√©s de tomar una instant√°nea de los procesos, abrir los procesos y verificar que ninguno de ellos est√© excluido, est√° listo para anotar los procesos que se implementar√°n en la memoria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, primero reserva una regi√≥n en memoria ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), le escribe ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriteProcessmemory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) y crea una secuencia ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRemoteThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Para trabajar con estas funciones, utiliza los PID de los procesos seleccionados, que obtuvo previamente con </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateToolhelp32Snapshot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s7/zp/pl/s7zpplpua6q4w1mgpurwvgtzyxy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 36: Incrustar c√≥digo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aqu√≠ podemos observar din√°micamente c√≥mo utiliza el PID del proceso para llamar a la funci√≥n </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx. </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/7n/k1/j-/7nk1j-saztq--oxfo2xwzyiowgk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. Figura 37: Invocaci√≥n de VirtualAllocEx </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4 Cifrado</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En esta secci√≥n, veremos parte de esta muestra relacionada con el cifrado. En la siguiente figura, puede ver dos rutinas llamadas " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary_EncodeString</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " y " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encode_Func</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", que son responsables de realizar el procedimiento de cifrado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/iu/1r/o5iu1rimo3qfnbgpnl4mvwcpwug.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 38: Procedimientos de encriptaci√≥n</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Al principio podemos ver c√≥mo carga una cadena que luego se usar√° para desofuscar todo lo que se necesita: importaciones, DLL, comandos, archivos y CSP. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/x6/te/dux6tehj_i7jcqkupvfdb3hlcfw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 39: Cadena de desofuscaci√≥n</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente figura muestra la primera importaci√≥n que se desofusca en el registro R4, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Esto se usar√° m√°s tarde para cargar las DLL necesarias. Tambi√©n podemos ver otra l√≠nea en el registro R12, que se utiliza junto con la l√≠nea anterior para realizar la desofuscaci√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/oo/to/laootohjrpgt3fa-yeetqz6rxzo.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 40: Desofuscaci√≥n din√°mica.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Contin√∫a cargando comandos que ejecutar√° m√°s tarde para deshabilitar las copias de seguridad, los puntos de restauraci√≥n y los modos de arranque seguro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/qt/le/ceqtleaezfngmfgtrlhpgxl-vbw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 41: Descarga de comandos</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Luego carga la ubicaci√≥n donde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soltar√°</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 archivos: </font><b><font style="vertical-align: inherit;">Windows.bat, run.sct</font></b><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start.bat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/wj/9f/efwj9fcrtd5vai-3jjp6kblwsu0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/jx/sg/sa/jxsgsaqyu0omqswv0-eseu5aeok.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yq/g4/ur/yqg4urwb1wqlo52wgoocuccbi00.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/i2/fc/2t/i2fc2t2mcj6qrwau7gikqb4ohf4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 42: Ubicaciones de archivos</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos 3 archivos se utilizan para verificar los privilegios que tiene cada ubicaci√≥n. Si los privilegios requeridos no est√°n disponibles, Ryuk detiene la ejecuci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contin√∫a cargando l√≠neas correspondientes a tres archivos. El primero, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DECRYPT_INFORMATION.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contiene la informaci√≥n necesaria para restaurar archivos. El segundo, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contiene la clave p√∫blica RSA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vf/w1/do/vfw1doq6ayau0i8pkniuc-rd5mk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 43: String DECRYPT INFORMATION.html</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tercero, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIQUE_ID_DO_NOT_REMOVE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contiene la clave cifrada que se usar√° en la pr√≥xima rutina para realizar el cifrado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u_/1l/s1/u_1ls1stszk23gkrsh2mwonnvgi.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 44: ID √öNICO NO RETIRE Cadena</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Finalmente, carga las bibliotecas requeridas junto con las importaciones requeridas y CSP ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Enhanced RSA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proveedor criptogr√°fico AES</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7d/b9/q1/7db9q1wjr1k_y1bfsefiewsc-6g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 45: Descarga de bibliotecas</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Despu√©s de completar toda la desofuscaci√≥n, procede a realizar las acciones necesarias para el cifrado: iterar sobre todas las unidades l√≥gicas, realizar lo que se carg√≥ en la subrutina anterior, fortalecer la presencia en el sistema, soltar el archivo RyukReadMe.html, cifrar, iterar todas las unidades de red, cambiando a dispositivos descubiertos y su encriptaci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo comienza con la descarga de " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " y la escritura de la clave p√∫blica RSA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_n/me/r-/_nmer-jvdpleozaujmoemqo7u9s.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 46: Preparaci√≥n para el cifrado</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Luego, recupera todas las unidades l√≥gicas utilizando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetLogicalDrives</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y deshabilita todas las copias de seguridad, puntos de recuperaci√≥n y modos de arranque seguro.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fa/ov/f8/faovf8myihdrkrtulhzcu_50e8q.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 47: Desactivar las herramientas de recuperaci√≥n</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Despu√©s de eso, √©l fortalece su presencia en el sistema, como vimos anteriormente, y escribe el primer archivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RyukReadMe.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TEMP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/7u/at/x87uatt-xtzmrn0un3-jqt5o0hw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Figura </font><i><font style="vertical-align: inherit;">48: Publicaci√≥n de una notificaci√≥n de recompra</font></i><font style="vertical-align: inherit;"> En la siguiente figura, puede ver c√≥mo crea un archivo, descarga el contenido y lo escribe: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/5o/2n/vu5o2nliyrqgsmugbe9jpx0-1mc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura. Figura 49: Descargar y grabar el contenido de un archivo.</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para poder realizar las mismas acciones en todos los dispositivos, utiliza </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " como mostramos anteriormente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/6a/qb/bd6aqbnkrrba-polrck91kh53w0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 50: Uso de icalcls.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y finalmente, comienza a encriptar archivos con la excepci√≥n de los archivos "* .exe", "* .dll", archivos del sistema y otras ubicaciones especificadas como una lista blanca encriptada. </font><font style="vertical-align: inherit;">Para esto, utiliza las importaciones: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptAcquireContextW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (donde se indica el uso de AES y RSA), </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDeriveKey, CryptGenKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDestroyKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font><font style="vertical-align: inherit;">Tambi√©n se est√° intentando expandir su efecto en los dispositivos de red detectados usando WNetEnumResourceW y luego encriptarlos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9j/yn/mj/9jynmjtzu26dwvfg3ugrthcxo0o.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">51: Cifrado de archivos del sistema</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Importaciones y banderas relacionadas</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente es una tabla que enumera las importaciones y los indicadores m√°s relevantes utilizados por la muestra:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/bn/he/ribnhe9istspdndifpecxgnzljc.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. COI</font></font></h4><br>
<img src="https://habrastorage.org/webt/bf/gu/cr/bfgucrrkqw-l2jurn09ovgljhas.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referencias</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usuarios \ Public \ run.sct</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Men√∫ Inicio \ Programas \ Inicio \ start.bat AppData \ Roaming \ Microsoft \ Windows \ Start</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Men√∫ \ Programas Inicio \ inicio.bat</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/ld/od/e2/ldode2_iiqa4jqw4ol46ch5dov4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informe t√©cnico de Ryuk ransomware compilado por expertos en laboratorios antivirus de PandaLabs.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Referencias</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. "Everis y Prisa Radio sufren un grave ciberataque que secuestra sus sistemas". Https: // www. elconfidencial.com/tecnologia/2019-11-04/ everis-la-ser-ciberataque-ransomware-15_2312019 /, Publicada el 04/11/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. ‚ÄúUn virus de origen ruso ataca a importantes empresas espa√±olas‚Äù. Https: //elpais.com/ tecnologia / 2019/11/04 / actualidad / 1572897654_ 251312.html, Publicada el 04/11/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. ‚ÄúDocumento VB2019: La venganza de Shinigami: la larga cola del malware Ryuk‚Äù. Https://securelist.com/ story-of-the-year-2019-cities-under-ransomware-siege / 95456 /, Publicada el 11 / </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12/2019 4. "Big Game Hunting con Ryuk: otro ransomware basado en Lucrative". Https: // www. crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/, publicado el 01/10/2019.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. ‚ÄúDocumento VB2019: la venganza de Shinigami: la larga cola del malware Ryuk‚Äù. Https: // www. </font><font style="vertical-align: inherit;">virusbulletin.com/virusbulletin/2019/10/ vb2019-paper-shinigamis-revenge-long-tail-r</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es497680/index.html">Tu telegrama parece estar fluyendo</a></li>
<li><a href="../es497682/index.html">Pavel Klemenkov, NVIDIA: Estamos tratando de reducir la brecha entre lo que un cient√≠fico de datos puede hacer y lo que necesita poder hacer.</a></li>
<li><a href="../es497684/index.html">Curva de bombo: qu√© tecnolog√≠as de TI est√°n en su apogeo y qu√© seguir√° siendo una demanda estable</a></li>
<li><a href="../es497686/index.html">Material de implante que mata las bacterias</a></li>
<li><a href="../es497688/index.html">C√≥mo funciona la escuela vespertina Kubernetes</a></li>
<li><a href="../es497700/index.html">Mitaps semanales en l√≠nea sobre respaldo y DevOps, seguridad y robots desde el 17 de abril</a></li>
<li><a href="../es497702/index.html">Cinco tendencias en el almacenamiento de datos a las que debe prestar atenci√≥n en 2020</a></li>
<li><a href="../es497708/index.html">Te invitamos a una serie de seminarios web de Fujitsu en abril y mayo.</a></li>
<li><a href="../es497714/index.html">C√≥mo proteger procesos y extensiones de kernel en macOS</a></li>
<li><a href="../es497724/index.html">Preparaci√≥n de un servidor para publicar una aplicaci√≥n web en Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>