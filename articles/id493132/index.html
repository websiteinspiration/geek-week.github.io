<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👰🏻 👨‍👧‍👧 🖖🏻 Sekitar data.tabel 🚹 🏇🏼 👩🏽‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Catatan ini akan menarik bagi mereka yang menggunakan pustaka pemrosesan data tabel untuk R - data. Tabel, dan, mungkin, akan senang melihat fleksibil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sekitar data.tabel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493132/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan ini akan menarik bagi mereka yang menggunakan pustaka pemrosesan data tabel untuk R - data. Tabel, dan, mungkin, akan senang melihat fleksibilitas aplikasinya dengan berbagai contoh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terinspirasi oleh contoh yang baik dari seorang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kolega</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan berharap Anda telah membaca artikelnya, saya sarankan menggali lebih dalam untuk mengoptimalkan kode dan kinerja berdasarkan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data.table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendahuluan: dari mana data.tabel berasal?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara terbaik untuk mulai berkenalan dengan perpustakaan sedikit dari jauh, yaitu, dari struktur data dari mana data.tabel objek (selanjutnya, DT) dapat diperoleh.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Himpunan</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## arrays ---------</span><font></font>
<font></font>
arrmatr &lt;- array(<span class="hljs-number">1</span>:<span class="hljs-number">20</span>, c(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>))<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">typeof</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">array</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">matrix</span>(<span class="hljs-params">arrmatr</span>)

</span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu struktur ini adalah array ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Base :: array</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Seperti dalam bahasa lain, array bersifat multidimensi di sini. Namun, menarik bahwa, misalnya, array dua dimensi mulai mewarisi properti dari kelas matriks </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(? Basis :: matriks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), dan array satu dimensi, yang juga penting, tidak mewarisi dari vektor ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Basis :: vektor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harus dipahami bahwa tipe data yang terkandung dalam fasilitas harus diperiksa fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dasarnya :: typeof</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengembalikan deskripsi internal dari tipe tersebut sesuai dengan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R Internals</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - protokol bahasa umum yang terkait dengan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C yang</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pertama kali lahir </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perintah lain untuk menentukan kelas suatu objek adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base :: class</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mengembalikan dalam kasus vektor tipe vektor (berbeda dari nama internal, tetapi juga memungkinkan Anda untuk memahami tipe data).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daftar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari array dua dimensi, ini adalah matriks, Anda dapat pergi ke daftar ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Basis :: daftar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## lists ------------------</span><font></font>
<font></font>
mylist &lt;- <span class="hljs-keyword">as</span>.list(arrmatr)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.vector(mylist)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.list(mylist)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, beberapa hal terjadi sekaligus:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dimensi kedua dari matriks itu runtuh, yaitu, kita mendapatkan daftar dan vektor. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daftar demikian mewarisi dari kelas-kelas ini. </font><font style="vertical-align: inherit;">Harus diingat bahwa nilai (skalar) tunggal dari sel array matriks akan sesuai dengan item daftar.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kenyataan bahwa daftar tersebut juga merupakan vektor, beberapa fungsi untuk vektor dapat diterapkan padanya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerangka data</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari daftar, matriks atau vektor, Anda dapat pergi ke bingkai data ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Base :: data.frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## data.frames ------------</span><font></font>
<font></font>
df &lt;- <span class="hljs-keyword">as</span>.data.frame(arrmatr)<font></font>
df2 &lt;- <span class="hljs-keyword">as</span>.data.frame(mylist)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.list(df)<font></font>
<font></font>
df$V6 &lt;- df$V1 + df$V2<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang menarik di dalamnya: bingkai data mewarisi dari daftar! </font><font style="vertical-align: inherit;">Kolom bingkai data adalah sel daftar. </font><font style="vertical-align: inherit;">Ini akan menjadi penting di masa mendatang ketika kami menggunakan fungsi yang diterapkan pada daftar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tabel data</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda bisa mendapatkan DT ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Data.table :: data.table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bingkai data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , daftar, vektor atau matriks. </font><font style="vertical-align: inherit;">Misalnya, seperti ini (di tempat).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## data.tables -----------------------</span><font></font>
library(data.table)<font></font>
<font></font>
data.table::setDT(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.list(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.data.frame(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.data.table(df)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berguna bahwa, seperti kerangka data, DT mewarisi properti daftar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DT dan memori</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak seperti semua objek lain dalam basis R, DT dilewatkan dengan referensi. </font><font style="vertical-align: inherit;">Jika Anda perlu menyalin ke area memori baru, Anda memerlukan fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data.table :: copy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau Anda perlu memilih dari objek yang lama.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs">df2 &lt;- df<font></font>
<font></font>
df[V1 == <span class="hljs-number">1</span>, V2 := <span class="hljs-number">999</span>]<font></font>
<font></font>
data.table::fsetdiff(df, df2)<font></font>
<font></font>
df2 &lt;- data.table::copy(df)<font></font>
<font></font>
df[V1 == <span class="hljs-number">2</span>, V2 := <span class="hljs-number">999</span>]<font></font>
<font></font>
data.table::fsetdiff(df, df2)<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentang pengantar ini berakhir. </font><font style="vertical-align: inherit;">DT adalah kelanjutan dari pengembangan struktur data dalam R, yang terutama terjadi karena ekspansi dan percepatan operasi yang dilakukan pada objek-objek kelas bingkai data. </font><font style="vertical-align: inherit;">Dalam hal ini, warisan dari primitif lain dipertahankan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa contoh menggunakan properti data.table</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti daftar ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iterasi di atas baris bingkai data atau DT bukan ide yang baik, karena kode loop dalam bahasa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jauh lebih lambat daripada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan sangat mungkin untuk berjalan melalui kolom dalam kolom yang biasanya jauh lebih sedikit. </font><font style="vertical-align: inherit;">Berjalan melalui kolom, ingat bahwa setiap kolom adalah item daftar, yang biasanya berisi vektor. </font><font style="vertical-align: inherit;">Dan operasi pada vektor dengan baik vektor dalam fungsi dasar bahasa. </font><font style="vertical-align: inherit;">Anda juga dapat menggunakan operator pemilihan khusus untuk daftar dan vektor: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`[[`, `$`</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## operations on data.tables ------------</span><font></font>
<font></font>
<span class="hljs-comment">#using list properties</span><font></font>
<font></font>
df$<span class="hljs-string">'V1'</span>[<span class="hljs-number">1</span>]<font></font>
<font></font>
df[[<span class="hljs-string">'V1'</span>]]<font></font>
<font></font>
df[[<span class="hljs-number">1</span>]][<span class="hljs-number">1</span>]<font></font>
<font></font>
sapply(df, <span class="hljs-class"><span class="hljs-keyword">class</span>)

<span class="hljs-title">sapply</span>(<span class="hljs-params">df, function(<span class="hljs-params">x</span>) sum(<span class="hljs-params">is.na(<span class="hljs-params">x</span>)</span>)</span>)
</span></code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vektorisasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika ada kebutuhan untuk melewati garis-garis DT besar, menulis fungsi dengan vektorisasi adalah solusi terbaik. </font><font style="vertical-align: inherit;">Tetapi jika tidak bekerja, harus diingat bahwa siklus </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DT masih siklus lebih cepat di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena berjalan pada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita coba contoh yang lebih besar dengan 100 ribu baris. </font><font style="vertical-align: inherit;">Kami akan menarik huruf pertama dari kata-kata yang termasuk dalam vektor kolom </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diperbarui</font></font></i><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs">library(magrittr)<font></font>
library(microbenchmark)<font></font>
<font></font>
<span class="hljs-comment">## Bigger example ----</span><font></font>
<font></font>
rown &lt;- <span class="hljs-number">100000</span><font></font>
<font></font>
dt &lt;- <font></font>
	data.table(<font></font>
		w = sapply(seq_len(rown), function(x) paste(sample(letters, <span class="hljs-number">3</span>, replace = T), collapse = <span class="hljs-string">' '</span>))<font></font>
		, a = sample(letters, rown, replace = T)<font></font>
		, b = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, c = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, e = rnorm(rown)<font></font>
	) %&gt;%<font></font>
	.[, d := <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
<span class="hljs-comment"># vectorization</span><font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := unlist(strsplit(w, split = <span class="hljs-string">' '</span>, fixed = T))[<span class="hljs-number">1</span>]<font></font>
		, by = <span class="hljs-number">1</span>:nrow(dt)<font></font>
	   ]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># second</span><font></font>
<font></font>
first_l_f &lt;- function(sd)<font></font>
{<font></font>
	strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T) %&gt;%<font></font>
		do.call(rbind, .) %&gt;%<font></font>
		`[`(,<span class="hljs-number">1</span>)<font></font>
}<font></font>
<font></font>
dt[, first_l := NULL]<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := .(first_l_f(w))<font></font>
		]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># third</span><font></font>
<font></font>
first_l_f2 &lt;- function(sd)<font></font>
{<font></font>
	strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T) %&gt;%<font></font>
		unlist %&gt;%<font></font>
		matrix(nrow = <span class="hljs-number">3</span>) %&gt;%<font></font>
		`[`(<span class="hljs-number">1</span>,)<font></font>
}<font></font>
<font></font>
dt[, first_l := NULL]<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := .(first_l_f2(w))<font></font>
		]<font></font>
})<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run pertama iterates melalui baris:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Satuan: milidetik </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 expr min </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 {dt [, `: =` (first_l, unlist (strsplit (w, split = "", fixed = T)) [1]), dengan = 1: nrow (dt)]} 439.6217 lq </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 mean median uq maks neval </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 451.9998 460.1593 456.2505 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">460.9147</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 621.4042 100</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan kedua, di mana vektorisasi dilakukan dengan mengubah daftar menjadi matriks dan mengambil elemen pada slice dengan indeks 1 </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(yang terakhir sebenarnya vektorisasi)</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saya akan memulihkan: vektorisasi pada tingkat fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strsplit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang dapat mengambil vektor sebagai input. </font><font style="vertical-align: inherit;">Ternyata proses mengubah daftar menjadi matriks jauh lebih sulit daripada vektorisasi itu sendiri, tetapi dalam hal ini jauh lebih cepat daripada versi non-vektor.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unit: milidetik </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 expr mnt lq berarti median uq maks neval </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 {dt [, `: =` (first_l ,. (First_l_f (w)))]} 93.07916 112.1381 161.9267 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.6863</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 185.9893 442.5199 100</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akselerasi median adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 kali</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan ketiga, di mana skema transformasi menjadi matriks diubah.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unit: milidetik, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 expr, min lq, berarti median uq maks neval </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 {dt [, `: =` (first_l ,. (First_l_f2 (w)))]} 32.60481 34.13679 40.4544 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35.57115</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 42.11975 222.972 100</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akselerasi median adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13 kali</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda harus bereksperimen dengan masalah ini, semakin banyak - semakin baik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh lain dengan vektorisasi, di mana ada juga teks, tetapi dekat dengan kondisi nyata: panjang kata berbeda, jumlah kata berbeda. </font><font style="vertical-align: inherit;">Diperlukan untuk mendapatkan 3 kata pertama. </font><font style="vertical-align: inherit;">Seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i_/sp/y_/i_spy_ok37lu1k5f6syb7db8kw8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini fungsi sebelumnya tidak berfungsi, karena vektor-vektor memiliki panjang yang berbeda, dan kami mengatur ukuran matriks. </font><font style="vertical-align: inherit;">Ulangi ini dengan mempelajari Internet.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># fourth</span><font></font>
<font></font>
rown &lt;- <span class="hljs-number">100000</span><font></font>
<font></font>
words &lt;-<font></font>
	sapply(<font></font>
		seq_len(rown)<font></font>
		, function(x){<font></font>
			nwords &lt;- rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>)<font></font>
			paste(<font></font>
				sapply(<font></font>
					seq_len(nwords)<font></font>
					, function(x){<font></font>
						paste(sample(letters, rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>), replace = T), collapse = <span class="hljs-string">''</span>)<font></font>
					}<font></font>
				)<font></font>
				, collapse = <span class="hljs-string">' '</span><font></font>
			)<font></font>
		}<font></font>
	)<font></font>
<font></font>
dt &lt;- <font></font>
	data.table(<font></font>
		w = words<font></font>
		, a = sample(letters, rown, replace = T)<font></font>
		, b = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, c = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, e = rnorm(rown)<font></font>
	) %&gt;%<font></font>
	.[, d := <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
first_l_f3 &lt;- function(sd, n)<font></font>
{<font></font>
	l &lt;- strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T)<font></font>
	<font></font>
	maxl &lt;- max(lengths(l))<font></font>
	<font></font>
	sapply(l, <span class="hljs-string">"length&lt;-"</span>, maxl) %&gt;%<font></font>
		`[`(n,) %&gt;%<font></font>
		<span class="hljs-keyword">as</span>.character<font></font>
}<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, (paste0(<span class="hljs-string">'w_'</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>)) := lapply(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, function(x) first_l_f3(w, x))<font></font>
		]<font></font>
})<font></font>
<font></font>
dt[<font></font>
	, (paste0(<span class="hljs-string">'w_'</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>)) := lapply(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, function(x) first_l_f3(w, x))<font></font>
	]<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unit: milidetik, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 expr, min lq, berarti median</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{dt [, `: =` ((paste0 ("w_", 1: 3)), strsplit (w, split = "", fixed = T))]} 851.7623 916.071 1054.5 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1035.199</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 uq max neval </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 1178.738 1356.816 100</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Script berjalan dengan kecepatan rata-rata 1 detik. </font><font style="vertical-align: inherit;">Tidak buruk. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara lain yang lebih ekonomis ditemukan</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kablag</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># fifth</span><font></font>
<font></font>
rown &lt;- <span class="hljs-number">100000</span><font></font>
<font></font>
words &lt;-<font></font>
	sapply(<font></font>
		seq_len(rown)<font></font>
		, function(x){<font></font>
			nwords &lt;- rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>)<font></font>
			paste(<font></font>
				sapply(<font></font>
					seq_len(nwords)<font></font>
					, function(x){<font></font>
						paste(sample(letters, rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>), replace = T), collapse = <span class="hljs-string">''</span>)<font></font>
					}<font></font>
				)<font></font>
				, collapse = <span class="hljs-string">' '</span><font></font>
			)<font></font>
		}<font></font>
	)<font></font>
<font></font>
dt &lt;- <font></font>
	data.table(<font></font>
		w = words<font></font>
		, a = sample(letters, rown, replace = T)<font></font>
		, b = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, c = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, e = rnorm(rown)<font></font>
	) %&gt;%<font></font>
	.[, d := <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
microbenchmark({<font></font>
	<font></font>
	w_split &lt;- dt[<font></font>
		, data.table::tstrsplit(w, split = <span class="hljs-string">' '</span>, fixed = T, keep = <span class="hljs-number">1L</span>:<span class="hljs-number">3L</span>)<font></font>
		]<font></font>
	<font></font>
	dt[<font></font>
		, `:=` (<font></font>
			w_1 = <span class="hljs-keyword">as</span>.character(w_split[[<span class="hljs-number">1</span>]])<font></font>
			, w_2 = <span class="hljs-keyword">as</span>.character(w_split[[<span class="hljs-number">2</span>]])<font></font>
			, w_3 = <span class="hljs-keyword">as</span>.character(w_split[[<span class="hljs-number">3</span>]])<font></font>
		)<font></font>
		]<font></font>
<font></font>
})<font></font>
</code></pre><br>
</div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Median 186, 5 kali lebih murah ...</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terhubung oleh satu rantai ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat bekerja dengan objek DT menggunakan rantai. </font><font style="vertical-align: inherit;">Sepertinya mengaitkan sintaks kurung ke kanan, pada kenyataannya, gula.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># chaining</span><font></font>
<font></font>
res1 &lt;- dt[a == <span class="hljs-string">'a'</span>][sample(.N, <span class="hljs-number">100</span>)]<font></font>
<font></font>
res2 &lt;- dt[, .N, a][, N]<font></font>
<font></font>
res3 &lt;- dt[, coefficients(lm(e ~ d))[<span class="hljs-number">1</span>], a][, .(letter = a, coef = V1)]<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengalir melalui pipa ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Operasi yang sama dapat dilakukan melalui perpipaan, terlihat serupa, tetapi secara fungsional lebih kaya, karena Anda dapat menggunakan metode apa pun, bukan hanya DT. </font><font style="vertical-align: inherit;">Kami memperoleh koefisien regresi logistik untuk data sintetis kami dengan sejumlah filter pada bahan bakar diesel.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># piping</span><font></font>
<font></font>
samplpe_b &lt;- dt[a %<span class="hljs-keyword">in</span>% head(letters), sample(b, <span class="hljs-number">1</span>)]<font></font>
<font></font>
res4 &lt;- <font></font>
	dt %&gt;%<font></font>
	.[a %<span class="hljs-keyword">in</span>% head(letters)] %&gt;%<font></font>
	.[, <font></font>
	  {<font></font>
	  	dt0 &lt;- .SD[<span class="hljs-number">1</span>:<span class="hljs-number">100</span>]<font></font>
	  	<font></font>
	  	quants &lt;- <font></font>
	  		dt0[, c] %&gt;%<font></font>
	  		quantile(seq(<span class="hljs-number">0.1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.1</span>), na.rm = T)<font></font>
	  	<font></font>
	  	.(q = quants)<font></font>
	  }<font></font>
	  , .(cond = b &gt; samplpe_b)<font></font>
	  ] %&gt;%<font></font>
	glm(<font></font>
		cond ~ q <span class="hljs-number">-1</span>
		, family = binomial(link = <span class="hljs-string">"logit"</span>)<font></font>
		, data = .<font></font>
	) %&gt;%<font></font>
	summary %&gt;%<font></font>
	.[[<span class="hljs-number">12</span>]]
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statistik, pembelajaran mesin, dll. Di dalam DT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat menggunakan fungsi lambda, tetapi kadang-kadang lebih baik untuk membuatnya secara terpisah, mendaftarkan seluruh pipa analisis data, dan kemudian mereka bekerja di dalam DT. </font><font style="vertical-align: inherit;">Contoh diperkaya dengan semua fitur di atas, ditambah beberapa hal yang berguna dari arsenal DT (seperti mengakses DT itu sendiri di dalam DT dengan referensi, kadang-kadang tidak dimasukkan secara berurutan, tetapi menjadi).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># function</span><font></font>
<font></font>
rm(lm_preds)<font></font>
<font></font>
lm_preds &lt;- function(<font></font>
	sd, by, n<font></font>
)<font></font>
{<font></font>
	<font></font>
	<span class="hljs-keyword">if</span>(<font></font>
		n &lt; <span class="hljs-number">100</span> | <font></font>
		!by[[<span class="hljs-string">'a'</span>]] %<span class="hljs-keyword">in</span>% head(letters, <span class="hljs-number">4</span>)<font></font>
	   )<font></font>
	{<font></font>
		<font></font>
		res &lt;-<font></font>
			list(<font></font>
				low = NA<font></font>
				, mean = NA<font></font>
				, high = NA<font></font>
				, coefs = NA<font></font>
			)<font></font>
		<font></font>
	} <span class="hljs-keyword">else</span> {<font></font>
<font></font>
		lmm &lt;- <font></font>
			lm(<font></font>
				d ~ c + b<font></font>
				, data = sd<font></font>
			)<font></font>
		<font></font>
		preds &lt;- <font></font>
			stats::predict.lm(<font></font>
				lmm<font></font>
				, sd<font></font>
				, interval = <span class="hljs-string">"prediction"</span><font></font>
				)<font></font>
		<font></font>
		res &lt;-<font></font>
			list(<font></font>
				low = preds[, <span class="hljs-number">2</span>]<font></font>
				, mean = preds[, <span class="hljs-number">1</span>]<font></font>
				, high = preds[, <span class="hljs-number">3</span>]<font></font>
				, coefs = coefficients(lmm)<font></font>
			)<font></font>
	}<font></font>
<font></font>
	res<font></font>
	<font></font>
}<font></font>
<font></font>
res5 &lt;- <font></font>
	dt %&gt;%<font></font>
	.[e &lt; <span class="hljs-number">0</span>] %&gt;%<font></font>
	.[.[, .I[b &gt; <span class="hljs-number">0</span>]]] %&gt;%<font></font>
	.[, `:=` (<font></font>
		low = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">1</span>]])<font></font>
		, mean = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">2</span>]])<font></font>
		, high = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">3</span>]])<font></font>
		, coef_c = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">1</span>])<font></font>
		, coef_b = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">2</span>])<font></font>
		, coef_int = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">3</span>])<font></font>
	)<font></font>
	, a<font></font>
	] %&gt;%<font></font>
	.[!<span class="hljs-keyword">is</span>.na(mean), -<span class="hljs-string">'e'</span>, <span class="hljs-keyword">with</span> = F]<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># plot</span><font></font>
<font></font>
plo &lt;- <font></font>
	res5 %&gt;%<font></font>
	ggplot +<font></font>
	facet_wrap(~ a) +<font></font>
	geom_ribbon(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, ymin = low<font></font>
			, ymax = high<font></font>
			, fill = a<font></font>
		)<font></font>
		, size = <span class="hljs-number">0.1</span>
		, alpha = <span class="hljs-number">0.1</span><font></font>
	) +<font></font>
	geom_point(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, y = mean<font></font>
			, color = a<font></font>
		)<font></font>
		, size = <span class="hljs-number">1</span><font></font>
	) +<font></font>
	geom_point(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, y = d<font></font>
		)<font></font>
		, size = <span class="hljs-number">1</span>
		, color = <span class="hljs-string">'black'</span><font></font>
	) +<font></font>
	theme_minimal()<font></font>
<font></font>
print(plo)<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya berharap bahwa saya dapat membuat gambar yang lengkap, tetapi, tentu saja, tidak lengkap, dari objek seperti data. </font><font style="vertical-align: inherit;">Saya harap ini membantu Anda untuk lebih belajar dan menggunakan perpustakaan ini untuk bekerja dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bersenang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><i><font style="vertical-align: inherit;">senang</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/xl/km/fhxlkmndxsdm4gcfyiymozut1vg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terima kasih!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode lengkap</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## load libs ----------------</span><font></font>
<font></font>
library(data.table)<font></font>
library(ggplot2)<font></font>
library(magrittr)<font></font>
library(microbenchmark)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">## arrays ---------</span><font></font>
<font></font>
arrmatr &lt;- array(<span class="hljs-number">1</span>:<span class="hljs-number">20</span>, c(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>))<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">typeof</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">array</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">matrix</span>(<span class="hljs-params">arrmatr</span>)


## <span class="hljs-title">lists</span> ------------------

<span class="hljs-title">mylist</span> &lt;- <span class="hljs-title">as</span>.<span class="hljs-title">list</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">vector</span>(<span class="hljs-params">mylist</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">list</span>(<span class="hljs-params">mylist</span>)


## <span class="hljs-title">data</span>.<span class="hljs-title">frames</span> ------------

<span class="hljs-title">df</span> &lt;- <span class="hljs-title">as</span>.<span class="hljs-title">data</span>.<span class="hljs-title">frame</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">list</span>(<span class="hljs-params">df</span>)

<span class="hljs-title">df</span>$<span class="hljs-title">V6</span> &lt;- <span class="hljs-title">df</span>$<span class="hljs-title">V1</span> + <span class="hljs-title">df</span>$<span class="hljs-title">V2</span>


## <span class="hljs-title">data</span>.<span class="hljs-title">tables</span> -----------------------

<span class="hljs-title">data</span>.<span class="hljs-title">table</span>:</span>:setDT(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.list(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.data.frame(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.data.table(df)<font></font>
<font></font>
df2 &lt;- df<font></font>
<font></font>
df[V1 == <span class="hljs-number">1</span>, V2 := <span class="hljs-number">999</span>]<font></font>
<font></font>
data.table::fsetdiff(df, df2)<font></font>
<font></font>
df2 &lt;- data.table::copy(df)<font></font>
<font></font>
df[V1 == <span class="hljs-number">2</span>, V2 := <span class="hljs-number">999</span>]<font></font>
<font></font>
data.table::fsetdiff(df, df2)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">## operations on data.tables ------------</span><font></font>
<font></font>
<span class="hljs-comment">#using list properties</span><font></font>
<font></font>
df$<span class="hljs-string">'V1'</span>[<span class="hljs-number">1</span>]<font></font>
<font></font>
df[[<span class="hljs-string">'V1'</span>]]<font></font>
<font></font>
df[[<span class="hljs-number">1</span>]][<span class="hljs-number">1</span>]<font></font>
<font></font>
sapply(df, <span class="hljs-class"><span class="hljs-keyword">class</span>)

<span class="hljs-title">sapply</span>(<span class="hljs-params">df, function(<span class="hljs-params">x</span>) sum(<span class="hljs-params">is.na(<span class="hljs-params">x</span>)</span>)</span>)


## <span class="hljs-title">Bigger</span> <span class="hljs-title">example</span> ----

<span class="hljs-title">rown</span> &lt;- 100000

<span class="hljs-title">dt</span> &lt;- 
	<span class="hljs-title">data</span>.<span class="hljs-title">table</span>(<span class="hljs-params">
		w = sapply(<span class="hljs-params">seq_len(<span class="hljs-params">rown</span>), function(<span class="hljs-params">x</span>) paste(<span class="hljs-params">sample(<span class="hljs-params">letters, <span class="hljs-number">3</span>, replace = T</span>), collapse = <span class="hljs-string">' '</span></span>)</span>)
		, a = sample(<span class="hljs-params">letters, rown, replace = T</span>)
		, b = runif(<span class="hljs-params">rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span></span>)
		, c = runif(<span class="hljs-params">rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span></span>)
		, e = rnorm(<span class="hljs-params">rown</span>)
	</span>) %&gt;%
	.[, <span class="hljs-title">d</span> :</span>= <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
<span class="hljs-comment"># vectorization</span><font></font>
<font></font>
<span class="hljs-comment"># zero - for loop</span><font></font>
<font></font>
microbenchmark({<font></font>
	<span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:nrow(dt))<font></font>
		{<font></font>
		dt[<font></font>
			i<font></font>
			, first_l := unlist(strsplit(w, split = <span class="hljs-string">' '</span>, fixed = T))[<span class="hljs-number">1</span>]<font></font>
		]<font></font>
	}<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># first</span><font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := unlist(strsplit(w, split = <span class="hljs-string">' '</span>, fixed = T))[<span class="hljs-number">1</span>]<font></font>
		, by = <span class="hljs-number">1</span>:nrow(dt)<font></font>
	   ]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># second</span><font></font>
<font></font>
first_l_f &lt;- function(sd)<font></font>
{<font></font>
	strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T) %&gt;%<font></font>
		do.call(rbind, .) %&gt;%<font></font>
		`[`(,<span class="hljs-number">1</span>)<font></font>
}<font></font>
<font></font>
dt[, first_l := NULL]<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := .(first_l_f(w))<font></font>
		]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># third</span><font></font>
<font></font>
first_l_f2 &lt;- function(sd)<font></font>
{<font></font>
	strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T) %&gt;%<font></font>
		unlist %&gt;%<font></font>
		matrix(nrow = <span class="hljs-number">3</span>) %&gt;%<font></font>
		`[`(<span class="hljs-number">1</span>,)<font></font>
}<font></font>
<font></font>
dt[, first_l := NULL]<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := .(first_l_f2(w))<font></font>
		]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># fourth</span><font></font>
<font></font>
rown &lt;- <span class="hljs-number">100000</span><font></font>
<font></font>
words &lt;-<font></font>
	sapply(<font></font>
		seq_len(rown)<font></font>
		, function(x){<font></font>
			nwords &lt;- rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>)<font></font>
			paste(<font></font>
				sapply(<font></font>
					seq_len(nwords)<font></font>
					, function(x){<font></font>
						paste(sample(letters, rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>), replace = T), collapse = <span class="hljs-string">''</span>)<font></font>
					}<font></font>
				)<font></font>
				, collapse = <span class="hljs-string">' '</span><font></font>
			)<font></font>
		}<font></font>
	)<font></font>
<font></font>
dt &lt;- <font></font>
	data.table(<font></font>
		w = words<font></font>
		, a = sample(letters, rown, replace = T)<font></font>
		, b = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, c = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, e = rnorm(rown)<font></font>
	) %&gt;%<font></font>
	.[, d := <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
first_l_f3 &lt;- function(sd, n)<font></font>
{<font></font>
	l &lt;- strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T)<font></font>
	<font></font>
	maxl &lt;- max(lengths(l))<font></font>
	<font></font>
	sapply(l, <span class="hljs-string">"length&lt;-"</span>, maxl) %&gt;%<font></font>
		`[`(n,) %&gt;%<font></font>
		<span class="hljs-keyword">as</span>.character<font></font>
}<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, (paste0(<span class="hljs-string">'w_'</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>)) := lapply(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, function(x) first_l_f3(w, x))<font></font>
		]<font></font>
})<font></font>
<font></font>
dt[<font></font>
	, (paste0(<span class="hljs-string">'w_'</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>)) := lapply(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, function(x) first_l_f3(w, x))<font></font>
	]<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># chaining</span><font></font>
<font></font>
res1 &lt;- dt[a == <span class="hljs-string">'a'</span>][sample(.N, <span class="hljs-number">100</span>)]<font></font>
<font></font>
res2 &lt;- dt[, .N, a][, N]<font></font>
<font></font>
res3 &lt;- dt[, coefficients(lm(e ~ d))[<span class="hljs-number">1</span>], a][, .(letter = a, coef = V1)]<font></font>
<font></font>
<span class="hljs-comment"># piping</span><font></font>
<font></font>
samplpe_b &lt;- dt[a %<span class="hljs-keyword">in</span>% head(letters), sample(b, <span class="hljs-number">1</span>)]<font></font>
<font></font>
res4 &lt;- <font></font>
	dt %&gt;%<font></font>
	.[a %<span class="hljs-keyword">in</span>% head(letters)] %&gt;%<font></font>
	.[, <font></font>
	  {<font></font>
	  	dt0 &lt;- .SD[<span class="hljs-number">1</span>:<span class="hljs-number">100</span>]<font></font>
	  	<font></font>
	  	quants &lt;- <font></font>
	  		dt0[, c] %&gt;%<font></font>
	  		quantile(seq(<span class="hljs-number">0.1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.1</span>), na.rm = T)<font></font>
	  	<font></font>
	  	.(q = quants)<font></font>
	  }<font></font>
	  , .(cond = b &gt; samplpe_b)<font></font>
	  ] %&gt;%<font></font>
	glm(<font></font>
		cond ~ q <span class="hljs-number">-1</span>
		, family = binomial(link = <span class="hljs-string">"logit"</span>)<font></font>
		, data = .<font></font>
	) %&gt;%<font></font>
	summary %&gt;%<font></font>
	.[[<span class="hljs-number">12</span>]]<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># function</span><font></font>
<font></font>
rm(lm_preds)<font></font>
<font></font>
lm_preds &lt;- function(<font></font>
	sd, by, n<font></font>
)<font></font>
{<font></font>
	<font></font>
	<span class="hljs-keyword">if</span>(<font></font>
		n &lt; <span class="hljs-number">100</span> | <font></font>
		!by[[<span class="hljs-string">'a'</span>]] %<span class="hljs-keyword">in</span>% head(letters, <span class="hljs-number">4</span>)<font></font>
	   )<font></font>
	{<font></font>
		<font></font>
		res &lt;-<font></font>
			list(<font></font>
				low = NA<font></font>
				, mean = NA<font></font>
				, high = NA<font></font>
				, coefs = NA<font></font>
			)<font></font>
		<font></font>
	} <span class="hljs-keyword">else</span> {<font></font>
<font></font>
		lmm &lt;- <font></font>
			lm(<font></font>
				d ~ c + b<font></font>
				, data = sd<font></font>
			)<font></font>
		<font></font>
		preds &lt;- <font></font>
			stats::predict.lm(<font></font>
				lmm<font></font>
				, sd<font></font>
				, interval = <span class="hljs-string">"prediction"</span><font></font>
				)<font></font>
		<font></font>
		res &lt;-<font></font>
			list(<font></font>
				low = preds[, <span class="hljs-number">2</span>]<font></font>
				, mean = preds[, <span class="hljs-number">1</span>]<font></font>
				, high = preds[, <span class="hljs-number">3</span>]<font></font>
				, coefs = coefficients(lmm)<font></font>
			)<font></font>
	}<font></font>
<font></font>
	res<font></font>
	<font></font>
}<font></font>
<font></font>
res5 &lt;- <font></font>
	dt %&gt;%<font></font>
	.[e &lt; <span class="hljs-number">0</span>] %&gt;%<font></font>
	.[.[, .I[b &gt; <span class="hljs-number">0</span>]]] %&gt;%<font></font>
	.[, `:=` (<font></font>
		low = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">1</span>]])<font></font>
		, mean = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">2</span>]])<font></font>
		, high = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">3</span>]])<font></font>
		, coef_c = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">1</span>])<font></font>
		, coef_b = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">2</span>])<font></font>
		, coef_int = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">3</span>])<font></font>
	)<font></font>
	, a<font></font>
	] %&gt;%<font></font>
	.[!<span class="hljs-keyword">is</span>.na(mean), -<span class="hljs-string">'e'</span>, <span class="hljs-keyword">with</span> = F]<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># plot</span><font></font>
<font></font>
plo &lt;- <font></font>
	res5 %&gt;%<font></font>
	ggplot +<font></font>
	facet_wrap(~ a) +<font></font>
	geom_ribbon(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, ymin = low<font></font>
			, ymax = high<font></font>
			, fill = a<font></font>
		)<font></font>
		, size = <span class="hljs-number">0.1</span>
		, alpha = <span class="hljs-number">0.1</span><font></font>
	) +<font></font>
	geom_point(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, y = mean<font></font>
			, color = a<font></font>
		)<font></font>
		, size = <span class="hljs-number">1</span><font></font>
	) +<font></font>
	geom_point(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, y = d<font></font>
		)<font></font>
		, size = <span class="hljs-number">1</span>
		, color = <span class="hljs-string">'black'</span><font></font>
	) +<font></font>
	theme_minimal()<font></font>
<font></font>
print(plo)<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id493118/index.html">Ikhtisar Ekstensi Penandaan Memori (Armv8.5-A)</a></li>
<li><a href="../id493122/index.html">Kantor Banzai Games: Jepang di pusat kota Moskow</a></li>
<li><a href="../id493124/index.html">Lakukan-sendiri-Bare-Metal Provisioning, atau persiapan server otomatis dari awal</a></li>
<li><a href="../id493126/index.html">Antipatterns dari arsitektur berorientasi peristiwa</a></li>
<li><a href="../id493130/index.html">Почему не стоит бояться коронавируса: мифы и почти правда о COVID-2019</a></li>
<li><a href="../id493136/index.html">VP CEPAT dalam Penyimpanan Persatuan: Cara Kerja</a></li>
<li><a href="../id493138/index.html">Bicaralah padaku: apa yang dapat dilakukan oleh robot suara hari ini</a></li>
<li><a href="../id493140/index.html">Petualangan Cipollino: Karantina IT Quest dari Flant</a></li>
<li><a href="../id493142/index.html">"Ayo gunakan Kubernet!" Anda sekarang memiliki 8 masalah</a></li>
<li><a href="../id493146/index.html">Proyek sampingan menarik yang dapat Anda lakukan hari ini</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>