<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☹️ 🤶🏾 ♊️ グローバルな状態：それらを回避する理由と方法 👆🏻 ☎️ ◽️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="グローバルな状態。このフレーズは、この現象に直面する不幸を抱えていたすべての開発者の心に恐怖と痛みを引き起こします。多くの頭を持つハイドラを殺そうとする不幸な騎士のように、その理由を理解せずに、予期しないアプリケーションの動作にすでに遭遇しましたか？あなたは試行錯誤の無限のサイクルに終わり、何が起こ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>グローバルな状態：それらを回避する理由と方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454946/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/il/xm/yl/ilxmyllyrjl50zu_shop-i-3fus.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバルな状態。</font><font style="vertical-align: inherit;">このフレーズは、この現象に直面する不幸を抱えていたすべての開発者の心に恐怖と痛みを引き起こします。</font><font style="vertical-align: inherit;">多くの頭を持つハイドラを殺そうとする不幸な騎士のように、その理由を理解せずに、予期しないアプリケーションの動作にすでに遭遇しましたか？</font><font style="vertical-align: inherit;">あなたは試行錯誤の無限のサイクルに終わり、何が起こっているのだろうと思っている時間の90％は？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはすべて、グローバルの厄介な結果になる可能性があります。まだ理解していない理由により、未知の場所で状態を変更する隠し変数です。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたがアプリケーションを変更しようとしている間、あなたは暗闇の中をさまようのが好きですか？</font><font style="vertical-align: inherit;">もちろん好きではありません。</font><font style="vertical-align: inherit;">幸いなことに、私はキャンドルを用意しています：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、私たちが最も頻繁にグローバルステートと呼ぶものについて説明します。</font><font style="vertical-align: inherit;">この用語は常に正確に使用されているわけではないため、明確にする必要があります。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、グローバルがコードベースに有害である理由を確認します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、グローバルのスコープをトリミングしてローカル変数に変換する方法について説明します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後に、カプセル化と、グローバル変数に対する十字軍が大きな問題の一部にすぎない理由について説明します。</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事で、グローバルステートについて知っておく必要のあるすべてが説明されているといいのですが。</font><font style="vertical-align: inherit;">私が多くのことを逃したと思っていて、あなたがこれを嫌っていて、もう私に会いたくない場合は、コメントでそれについて書いてください。</font><font style="vertical-align: inherit;">私、私の読者、そしてこのページに思いがけなく登場した皆さんにとって、それは楽しいことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読者の皆さん、馬に飛び乗って敵を知る準備はできていますか？</font><font style="vertical-align: inherit;">さあ、これらのグローバルを見つけて、私たちの剣の鋼を味わわせてください！</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件とは何ですか？</font></font></h1><br>
<img src="https://habrastorage.org/getpro/habr/post_images/7dd/561/59c/7dd56159c2c3d32176e249ea71ed13ad.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者がお互いを理解できるように、基本から始めましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状態は、システムまたはエンティティの定義です。</font><font style="vertical-align: inherit;">状態は実生活で見つかります：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンピューターの電源がオフになると、その状態はオフになります。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一杯のお茶が熱くなっているとき、彼女の状態は熱くなっています。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソフトウェア開発では、一部の構造体（変数など）に状態がある場合があります。</font><font style="vertical-align: inherit;">文字列「hello」または数値11は状態とは見なされず、値です。</font><font style="vertical-align: inherit;">それらは、変数にアタッチされてメモリに配置されると状態になります。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">"hello"</span>; <span class="hljs-comment">// No state here!</span>
$lala = <span class="hljs-string">"hello"</span>; <span class="hljs-comment">// The variable $lala has the state 'hello'.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのタイプの状態を区別できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数の状態：初期化後、アプリケーションの実行中にいつでも状態を変更できます。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
$lala = <span class="hljs-string">"hello"</span>; <span class="hljs-comment">// Initialisation of the variable.</span>
$lala = <span class="hljs-string">"hallo"</span>; <span class="hljs-comment">// The state of the variable $lala can be changed at runtime.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不変の状態：実行中は変更できません。最初の状態を変数に割り当て、その値はその後変更されません。日常生活の「定数」は不変状態の例と呼ばれます。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
define(<span class="hljs-string">"GREETING"</span>, <span class="hljs-string">"hello"</span>); <span class="hljs-comment">// Constant definition.</span>
<span class="hljs-keyword">echo</span> GREETING; <font></font>
GREETING = <span class="hljs-string">"hallo"</span>; <span class="hljs-comment">// This line will produce an error!</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、仲間の開発者であるDenisとVasilyの間の架空の会話を聞いてみましょう：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -Dan！どこにでもグローバル変数を作成しました！すべてを壊さずに変更することはできません！あなたを殺します！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -ニフィガ、ヴァセク！私の世界の運勢は素晴らしいです！私はそれらに私の魂を入れました、これらは傑作です！私は私のグローバルを崇拝します！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどの場合、開発者はグローバル状態、グローバル変数、またはグローバルと呼ばれるものをグローバル可変状態と呼びます。つまり、</font><font style="vertical-align: inherit;">アプリケーション全体で、</font><font style="vertical-align: inherit;">利用可能な最大の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スコープで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更できる状態</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数がアプリケーション全体をスコープとして持たない場合、ローカル変数またはロケールについて話していることになります。</font><font style="vertical-align: inherit;">それらは、アプリケーション全体の領域よりも少ない、特定の可視領域に存在します。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Ecommerce</span>;<font></font>
<font></font>
$global = <span class="hljs-string">"I'm a mutable global variable!"</span>; <span class="hljs-comment">// global variable</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shipment</span>
</span>{
    <span class="hljs-keyword">public</span> $warehouse; <span class="hljs-comment">// local variable existing in the whole class</span><font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)
    </span>{<font></font>
        $info = <span class="hljs-string">"You're creating a shipment object!"</span>; <span class="hljs-comment">// local variable bound to the constructor scope</span>
        <span class="hljs-keyword">echo</span> $info;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">global</span> $global;<font></font>
        $global = <span class="hljs-string">"I change the state now 'cause I can!"</span>; 
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"You're creating a product object!"</span>; <span class="hljs-comment">// no state here</span><font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたは考えるかもしれません：どこからでもアクセスできる変数を持ち、それらを変更することはどれほど便利ですか！</font><font style="vertical-align: inherit;">アプリケーションのある部分から別の部分に状態を転送できます！</font><font style="vertical-align: inherit;">それらを関数に渡し、それほど多くのコードを書く必要はありません！</font><font style="vertical-align: inherit;">あられ、グローバルな可変状態！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本当にそう思っていたら、読み続けることを強くお勧めします。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルな状態はペストやコレラよりも悪いですか？</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大のリンク図</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事実：グローバルがなく、スコープが小さく定義されたロケールのみが含まれている場合は、正確なアプリケーション接続図を作成する方が簡単です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうして？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバル変数を持つ大規模なアプリケーションがあるとします。</font><font style="vertical-align: inherit;">何かを変更する必要があるたびに、次のことを行う必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの変更可能なグローバル状態が存在することを思い出してください。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更するスコープに影響するかどうかを見積もります。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、他のスコープにあるローカル変数について考える必要はありませんが、すべてのスコープに影響を与える可能性があるため、グローバルな変更可能な状態については、常に疲れた脳の中で場所を保つ必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、グローバルな変更可能な状態は、アプリケーションのどこでも変更できます。通常、彼らは彼らの現在の状態が何であるか疑問に思う必要があります。つまり、変更可能なスコープでグローバルの値を計算しようとして、アプリケーション全体を検索する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それがすべてではありません。グローバルの状態を変更する必要がある場合、それがどのスコープに影響するかは想像できません。これにより、別のクラス、メソッド、または関数の予期しない動作が発生しますか？検索に成功しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、同じグローバル状態を使用するすべてのクラス、メソッド、および関数を組み合わせます。</font><font style="vertical-align: inherit;">忘れないでください。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存関係により複雑さが大幅に増大します</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">怖いですか？</font><font style="vertical-align: inherit;">そのはず。</font><font style="vertical-align: inherit;">可視性の小さな特定の領域は非常に便利です。アプリケーション全体を覚えておく必要はありません。作業している領域についてのみ覚えておけば十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
人々はすぐに大量の情報を追跡しません。</font><font style="vertical-align: inherit;">これを行おうとすると、すぐに認知能力の供給が枯渇し、集中することが困難になり、バグや愚かなことを作り始めます。</font><font style="vertical-align: inherit;">これが、アプリケーションのグローバルスコープで動作することが非常に不愉快な理由です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバル名の衝突</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サードパーティライブラリの使用には問題があります。</font><font style="vertical-align: inherit;">各キャラクターをランダムにフリッカー効果で着色する、その超クールなライブラリを使用したいと想像してください。</font><font style="vertical-align: inherit;">すべての開発者の夢！</font><font style="vertical-align: inherit;">このライブラリが自分と同じ名前のグローバルも使用している場合は、名前の衝突が発生します。</font><font style="vertical-align: inherit;">アプリケーションがクラッシュし、おそらく長い間、その理由を推測します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、ライブラリがグローバル変数を使用していることを確認する必要があります。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、実行時に使用された変数を計算する必要があります-あなたのものですか、それともライブラリですか？</font><font style="vertical-align: inherit;">それはそれほど単純ではありません、名前は同じです！</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3番目に、ライブラリを自分で変更することはできないため、グローバルな可変変数の名前を変更する必要があります。</font><font style="vertical-align: inherit;">アプリケーション全体で使用すると、泣きます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各段階であなたは怒りと絶望からあなたの髪を引き裂きます。</font><font style="vertical-align: inherit;">まもなく櫛は必要なくなります。</font><font style="vertical-align: inherit;">そのようなシナリオに誘惑される可能性はほとんどありません。</font><font style="vertical-align: inherit;">おそらく誰かがJavaScriptライブラリーMootools、Underscore、およびjQueryが、より小さなスコープに配置されていない場合、常に互いに衝突したことを思い出すでしょう。</font><font style="vertical-align: inherit;">ああ、</font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jQueryの</font><font style="vertical-align: inherit;">有名なグローバルオブジェクト</font><font style="vertical-align: inherit;">！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストは悪夢に変わります</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まだ納得していない場合は、単体テストの観点から状況を見てみましょう。グローバル変数の存在下でテストをどのように記述しますか？</font><font style="vertical-align: inherit;">テストはグローバルを変更する可能性があるため、状態がどのテストだったかはわかりません。</font><font style="vertical-align: inherit;">テストを互いに分離する必要があり、グローバルな状態はそれらを結合します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分離テストで問題なく機能し、パッケージ全体を実行したときにテストが失敗することはありませんか？</font><font style="vertical-align: inherit;">番号？</font><font style="vertical-align: inherit;">そして私はそれを持っていました。</font><font style="vertical-align: inherit;">これを思い出すたびに、私は苦しみます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同時実行の問題</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時実行性が必要な場合、可変グローバル状態は多くの問題を引き起こす可能性があります。</font><font style="vertical-align: inherit;">実行のいくつかのスレッドでグローバルの状態を変更する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、レースの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">強力な</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">状態で</font></a><font style="vertical-align: inherit;">すぐに対処できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHP開発者であれば、並列処理を作成できるライブラリを使用しない限り、これで問題が発生することはありません。</font><font style="vertical-align: inherit;">しかし、</font><font style="vertical-align: inherit;">並列処理が実装しやすい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい言語</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">学ぶ</font></a><font style="vertical-align: inherit;">とき</font><font style="vertical-align: inherit;">は、私の散文を思い出してください。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルな変更可能な状態を回避する</font></font></h1><br>
<img src="https://habrastorage.org/getpro/habr/post_images/6df/acf/801/6dfacf801044e2e081ffd24ed7502a98.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバルな変更可能な状態は多くの問題を引き起こす可能性がありますが、回避することが難しい場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REST APIを使用してください。エンドポイントは、パラメーターを含むある種のHTTPリクエストを受信し、応答を送信します。サーバーに送信されるこれらのHTTPパラメーターは、アプリケーションの多くのレベルで要求されます。 HTTP要求を受信するときにこれらのパラメーターをグローバルにして、応答を送信する前に変更するのは非常に魅力的です。各リクエストに並列処理を追加すると、災害レシピが完成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
言語の実装では、グローバルな可変状態を直接サポートすることもできます。たとえば、PHPには</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スーパーグローバル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバルがどこかから来た場合、それらにどのように対処しますか？</font><font style="vertical-align: inherit;">過去20年間、開発について何も読んでいないので、可能な限りグローバルを作成した開発者仲間のDenisのアプリケーションをリファクタリングする方法は？</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の引数</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバルを回避する最も簡単な方法は、関数の引数を使用して変数を渡すことです。</font><font style="vertical-align: inherit;">簡単な例を見てみましょう：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Router</span>\<span class="hljs-title">HttpRequest</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Product</span>\<span class="hljs-title">ProductData</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exceptions</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createAction</span>(<span class="hljs-params">HttpRequest $httpReq</span>)
    </span>{<font></font>
        $productData = $httpReq-&gt;get(<span class="hljs-string">"productData"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;productModel-&gt;validateProduct($productData)) {
            <span class="hljs-keyword">return</span> ValidationException(sprintf(<span class="hljs-string">"The product %d is not valid"</span>, $productData[<span class="hljs-string">"id"</span>]));<font></font>
        }<font></font>
<font></font>
        $product = <span class="hljs-keyword">$this</span>-&gt;productModel-&gt;createProduct($productData);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createProduct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $productData</span>): <span class="hljs-title">Product</span>
    </span>{<font></font>
        $productData[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"SuperProduct"</span>.$productData[<span class="hljs-string">"name"</span>]; <span class="hljs-comment">// This is not what you should do; I talk about it later in the article.</span><font></font>
<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            $product = <span class="hljs-keyword">$this</span>-&gt;productDao-&gt;find($productData[<span class="hljs-string">"id"</span>]);
            <span class="hljs-keyword">return</span> product;<font></font>
        } <span class="hljs-keyword">catch</span> (NotFoundException $e) {<font></font>
            $product = <span class="hljs-keyword">$this</span>-&gt;productDao-&gt;save($productData);
            <span class="hljs-keyword">return</span> $product;<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductDao</span>
</span>{
    <span class="hljs-keyword">private</span> $db;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> $id</span>): <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;db-&gt;find([<span class="hljs-string">'product'</span> =&gt; $id]);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $productData</span>): <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;db-&gt;saveProduct($productData);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり</font></font><code>$productData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、コントローラーから</font><font style="vertical-align: inherit;">の配列</font><font style="vertical-align: inherit;">は、HTTPリクエストを介して、さまざまなレベルを通過します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラはHTTPリクエストを受信しました。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルに渡されるパラメーター。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DAOに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渡されるパラメーター</font><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータはアプリケーションデータベースに保存されます。</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTPリクエストから取得するときに、このパラメーター配列をグローバルにすることができます。</font><font style="vertical-align: inherit;">それはとても簡単に見えます：4つの異なる機能にデータを転送する必要はありません。</font><font style="vertical-align: inherit;">ただし、パラメータを関数の引数として渡すと、次のようになります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの関数が配列を使用していることは明らか</font></font><code>$productData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それは明らかにどの関数がどのパラメーターを使用するかを示します。</font><font style="vertical-align: inherit;">のためにあることがわかる</font></font><code>ProductDao::find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列される</font></font><code>$productData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみ必要</font></font><code>$id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのものではなく。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバルは、コードを理解しにくくし、メソッドを相互に関連付けます。これは、ほとんど完全に利点がないため、非常に高額です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デニスの抗議はすでに聞いています。「関数に3つ以上の引数がある場合、さらに追加する必要がある場合は、関数の複雑さが増します！そして、どこでも必要な変数、オブジェクト、その他の構成要素はどうでしょうか？それらをアプリケーションの各関数に渡しますか？」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
質問は公平で親愛なる読者です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">優れた開発者</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として、</font><font style="vertical-align: inherit;">コミュニケーションスキルを使用してデニスに次のように説明する必要があります。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「デニス。関数の引数が多すぎる場合、関数自体に問題がある可能性があります。彼らはおそらくあまりにも多くを行い、あまりにも多くのことに責任があります。それらを小さな機能に分割することを考えていませんでしたか？」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アテネのアクロポリスのスピーカーのように感じます。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「可視性の多くのフィールドに変数が必要な場合、これは問題であり、すぐにそれについて話します。</font><font style="vertical-align: inherit;">しかし、本当に必要な場合は、関数の引数を介してそれらを渡すことの何が問題になっていますか？</font><font style="vertical-align: inherit;">はい、キーボードで入力する必要がありますが、私たちは開発者です。コードを書くのが私たちの仕事です。」</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
引数の数が多いと（おそらくそうなるかもしれませんが）より複雑に見えるかもしれませんが、ここでも利点は欠点よりも優れています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテキストオブジェクト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテキストオブジェクトは、いくつかのコンテキストによって定義されたデータを含むオブジェクトです。通常、このデータは、PHPの連想配列などのキーペア構造として保存されます。そのようなオブジェクトには</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、値オブジェクト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と同様</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">に、</font></a><font style="vertical-align: inherit;">動作はなく、データのみがあり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテキストオブジェクトは、グローバルな可変状態を置き換えることができます。前のコード例に戻ります。リクエストからレベルを介してデータを渡す代わりに、このデータをカプセル化するオブジェクトを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテキストはクエリ自体になります。別のクエリ-別のコンテキスト-別のデータセット。次に、コンテキストオブジェクトは、このデータを必要とするすべてのメソッドに渡されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたは言う：「それは素晴らしい、そしてそれだけですが、それは何を与えるのですか？」</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データはオブジェクトにカプセル化されます。</font><font style="vertical-align: inherit;">ほとんどの場合、タスクはデータを不変にすることです。つまり、状態（初期化後のオブジェクト内のデータの値）を変更できないようにします。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテキストは、このデータを必要とするすべての関数（またはメソッド）に転送されるため、コンテキストオブジェクトのデータを必要とします。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これにより、同時実行性の問題が解決されます。各リクエストに独自のコンテキストオブジェクトがある場合、独自の実行スレッドで安全に書き込みまたは読み取りできます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、開発中のすべてのものには価格があります。</font><font style="vertical-align: inherit;">コンテキストオブジェクトは有害な場合があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の引数を見ると、コンテキストオブジェクト内のデータがわかりません。</font></font><br>
</li>
<li>      . ,    , ,   ,       .     : <code>$context-&gt;getSession()-&gt;getUser()-&gt;getProfil()-&gt;getUsername()</code>.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,      .<br>
</li>
<li>   ,   ,         .<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、私はコンテキストオブジェクトをできるだけ使用しないようにします。</font><font style="vertical-align: inherit;">彼らは多くの疑いを引き起こす可能性があります。</font><font style="vertical-align: inherit;">データの不変性は大きなプラスですが、欠点を忘れてはなりません。</font><font style="vertical-align: inherit;">コンテキストオブジェクトを使用している場合は、十分に小さいことを確認し、慎重に定義された小さなスコープに渡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムを実行する前に、関数に渡される状態の数（たとえば、HTTPリクエストからのパラメーター）がわからない場合は、コンテキストオブジェクトが役立ちます。</font><font style="vertical-align: inherit;">したがって、それらの一部はそれらを使用します</font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、</font><font style="vertical-align: inherit;">Symfonyの</font><font style="vertical-align: inherit;">オブジェクト</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">思い出してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存性注入</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバルな変更可能な状態の別の良い代替手段は、オブジェクトを作成するときに、必要なデータをオブジェクトに直接埋め込むことです。</font><font style="vertical-align: inherit;">これは、依存性注入の定義です。コンポーネント（クラス）にオブジェクトを埋め込むための一連の手法です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜ依存性注入なのか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目的は、変数、オブジェクト、またはその他の構成要素の使用を制限し、それらを制限されたスコープに配置することです。</font><font style="vertical-align: inherit;">埋め込まれている依存関係があり、したがってオブジェクトのスコープ内でのみ機能できる場合は、依存関係がどのコンテキストで使用されているのか、およびその理由を簡単に見つけることができます。</font><font style="vertical-align: inherit;">苦痛と苦痛はありません！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
依存性注入は、アプリケーションのライフサイクルを2つの重要なフェーズに分割します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションオブジェクトの作成とその依存関係の実装。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトを使用して目標を達成します。</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチにより、コードがより明確になります。ランダムな場所ですべてをインスタンス化する必要はなく、さらに悪いことに、どこでもグローバルオブジェクトを使用する必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのフレームワークは、構成ファイルと依存関係注入コンテナ（DIC）を使用して、依存関係注入を、場合によってはかなり複雑なスキームで使用します。</font><font style="vertical-align: inherit;">しかし、物事を複雑にする必要はまったくありません。</font><font style="vertical-align: inherit;">依存関係を1つのレベルで作成し、それを下位レベルで実装するだけです。</font><font style="vertical-align: inherit;">たとえば、囲碁の世界では、DICを使用する人を知りません。</font><font style="vertical-align: inherit;">コード（main.go）を使用してメインファイルに依存関係を作成し、次のレベルに転送するだけです。</font><font style="vertical-align: inherit;">「依存性注入フェーズ」をこの特定のレベルでのみ実行する必要があることを明確に示すために、すべてを異なるパッケージでインスタンス化することもできます。</font><font style="vertical-align: inherit;">Goでは、パッケージのスコープによってPHPよりも簡単にできます。DICは、SymfonyやLaravelを含め、私が知っているすべてのフレームワークで広く使用されています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターまたはセッターによる実装</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
依存関係を注入する方法は2つあります。コンストラクタまたはセッターを使用する方法です。</font><font style="vertical-align: inherit;">可能であれば、最初の方法を使用することをお勧めします。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスの依存関係を知る必要がある場合は、コンストラクタを見つけるだけです。</font><font style="vertical-align: inherit;">クラス全体に散らばっているメソッドを探す必要はありません。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストール中に依存関係を設定すると、オブジェクトを使用する際の安全性が保証されます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のポイントについて少しお話しましょう。これは「不変条件の強制」と呼ばれています。</font><font style="vertical-align: inherit;">オブジェクトのインスタンスを作成してその依存関係を実装することにより、オブジェクトが何を必要としても、正しく構成されていることがわかります。</font><font style="vertical-align: inherit;">また、セッターを使用する場合、オブジェクトの使用時に依存関係がすでに設定されていることをどのようにして知るのでしょうか。</font><font style="vertical-align: inherit;">スタックに移動して、セッターが呼び出されたかどうかを確認することができますが、これを実行したくないと確信しています。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カプセル化違反</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局のところ、ローカル状態とグローバル状態の唯一の違いは、それらのスコープです。</font><font style="vertical-align: inherit;">それらは地方の州では制限されており、世界では、アプリケーション全体が利用可能です。</font><font style="vertical-align: inherit;">ただし、ローカル状態を使用すると、グローバル状態固有の問題が発生する可能性があります。</font><font style="vertical-align: inherit;">どうして？</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カプセル化と言いましたか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバル状態を使用すると、ローカル状態でカプセル化を解除できるのと同じように、最終的にカプセル化が解除されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初からやり直してください。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィキペディア</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はカプセル化の定義について</font><font style="vertical-align: inherit;">何を教えて</font><font style="vertical-align: inherit;">いますか？</font><font style="vertical-align: inherit;">オブジェクトの一部のコンポーネントへの直接アクセスを制限するための言語メカニズム。</font><font style="vertical-align: inherit;">アクセス制限？</font><font style="vertical-align: inherit;">何のために？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、上で見たように、グローバルよりもローカルスコープで推論する方がはるかに簡単です。</font><font style="vertical-align: inherit;">グローバルな変更可能な状態は、定義により、どこでも使用でき、これはカプセル化と矛盾します！</font><font style="vertical-align: inherit;">アクセス制限はありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡大するスコープと状態の漏洩</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/0a4/466/ed1/0a4466ed1a0cb8710127f819e160be0f.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自の小さなスコープの状態を想像してみましょう。残念ながら、アプリケーションは時間とともに成長します。このローカル状態は、アプリケーション全体で関数の引数として渡されます。現在、ロケールは可視性の多くの領域で使用されており、そのすべてでロケールへの直接アクセスが許可されています。ロケールが存在し、変更可能な場所をすべて確認しないと、ロケールの正確な状態を計算することは困難です。これらすべては、グローバルな可変状態ですでに見ています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例をとる：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">貧血領域モデル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更可能なモデルの可視性を高めることができます。実際、Anemic Domain Modelは、ドメインオブジェクトのデータと動作を2つのグループに分割します。モデル（データのみのオブジェクト）とサービス（動作のみのオブジェクト）です。ほとんどの場合、これらのモデルはすべてのサービスで使用されます。したがって、ある種のモデルは常に範囲を拡大する可能性があります。どのモデルがどのコンテキストで使用されているかを理解できず、その状態が変化し、同じ問題がすべて発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は重要なアイデアを伝えたいと思います。グローバルな変更可能な状態を回避するということは、リラックスして片方の手でカクテルを持ち、もう一方の手でボタンを押して、人生と伝説のコードを楽しむことができるという意味ではありません。まず、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://res.cloudinary.com/practicaldev/image/fetch/s--CWGA3Ax4--/c_limit%252Cf_auto%252Cfl_progressive%252Cq_auto%252Cw_880/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アルコールとプログラミングの互換性は低いです。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二に、本当の危険はカプセル化の欠如です。つまり、変更可能な状態がアプリケーションのさまざまなレベルに浸透し始めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの広大な状態をリファクタリングする必要がある場合は、それらを限られた範囲に配置してみてください。グローバルな変更可能な状態を制限しようとするのと同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなスコープを定義する方法は？あなたの会社のビジネスモデルに従ってください。アプリケーションはビジネスのミラーである必要があります。つまり、スコープにはビジネスモデルを反映する状態と動作を含める必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、オンラインストアが倉庫に関連するすべてを含む領域を作成するのは賢明でしょう。</font><font style="vertical-align: inherit;">しかし、このソリューションは普遍的なものではなく、あるビジネスにとって、それは別のビジネスにとって恩恵となるでしょう-大きな間違いです。</font><font style="vertical-align: inherit;">これを除いて、魔法の公式はありません。あなたが働いている会社のビジネスについて可能な限り多くを学んでください。</font><font style="vertical-align: inherit;">その後、データとアプリケーションの動作を正しくインテリジェントにカプセル化できます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィキペディアで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これについてもっと読んで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態コピー機能</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの場合、状態を直接変更せずにコピーすることは良い解決策です。</font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より正確には、このメソッドの</font><font style="vertical-align: inherit;">例に戻りましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createProduct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $productData</span>): <span class="hljs-title">Product</span>
    </span>{<font></font>
        $productData[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"SuperProduct"</span>.$productData[<span class="hljs-string">"name"</span>]; <span class="hljs-comment">// This is not what you should do; I talk about it later in the article.</span><font></font>
<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            $product = <span class="hljs-keyword">$this</span>-&gt;productDao-&gt;find($productData[<span class="hljs-string">"id"</span>]);
            <span class="hljs-keyword">return</span> product;<font></font>
        } <span class="hljs-keyword">catch</span> (NotFoundException $e) {<font></font>
            $product = <span class="hljs-keyword">$this</span>-&gt;productDao-&gt;save($productData);
            <span class="hljs-keyword">return</span> $product;<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列は</font></font><code>$productData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更しないで</font><font style="vertical-align: inherit;">おくのが</font><font style="vertical-align: inherit;">最適です。直接その状態を変更し、それを他の関数に渡すと、すぐにこの配列の状態を知ることができなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、名前の値は一度だけ変更されていますが、これは許容範囲です。しかし、他の開発者がこのコードを見るとどうなりますか？彼らは、可変変数の状態を直接変更することは正常であると考えるかもしれません。そして、あなたは未知の状態の大きな混乱を待つことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードを書くときは、それを読む人のためのマニュアルも書きます。これは覚えておく必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うことをお勧めします：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createProduct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $productData</span>): <span class="hljs-title">Product</span>
    </span>{
        <span class="hljs-comment">// Since $productData is passed to other variable, it has to be immutable.</span>
        $name = <span class="hljs-string">"SuperProduct"</span>.$productData[<span class="hljs-string">"name"</span>];<font></font>
<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            $product = <span class="hljs-keyword">$this</span>-&gt;productDao-&gt;find($productData[<span class="hljs-string">"id"</span>]);
            <span class="hljs-keyword">return</span> product;<font></font>
        } <span class="hljs-keyword">catch</span> (NotFoundException $e) {<font></font>
            $product = <span class="hljs-keyword">$this</span>-&gt;productDao-&gt;save($name, $productData);
            <span class="hljs-keyword">return</span> $product;<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
製品名がアレイの元の製品名と同じでないことを明確に示しました</font></font><code>$productData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">状態が変更されたことを示しました。</font></font><code>$productData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のメソッド</font><font style="vertical-align: inherit;">を渡す必要がある場合</font><font style="vertical-align: inherit;">は、HTTPリクエストからのソースデータが常に含まれていることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この状態変化を別の方法で分離することもできるので、「注意、私は今、この状態を変更しています。」</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルな不変状態はどうですか？</font></font></h1><br>
<img src="https://habrastorage.org/getpro/habr/post_images/0cd/d30/a3f/0cdd30a3fbd1097b15e7f5457d3d5c55.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どのアプリケーションでも、グローバルな不変状態を見つけることができます。</font><font style="vertical-align: inherit;">たとえば、定数にはこの状態があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらを使用しても安全ですか？</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバルの状態を考える必要はありません。アプリケーション全体で同じです。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果として、不変変数の状態を見つけるには、変数の最初の割り当て（できれば、定義の後に指定する必要があります）を確認するだけで済みます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、それでも、グローバルな不変状態は完全に無害であると見なすことはできません。</font><font style="vertical-align: inherit;">アプリケーションのどの部分がどの状態を使用するかを慎重に決定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、定数</font></font><code>ShipmentDelay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は商品の出荷のロジックが実装されている場所でのみ使用されると思います。</font><font style="vertical-align: inherit;">そして、あなたの仲間の開発者であるデニス</font></font><code>ShipmentDelay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が出荷に関係のない別の遅延の</font><font style="vertical-align: inherit;">ためにそれを使い始めた場合</font><font style="vertical-align: inherit;">、あなたのグローバルはそれが意味をなさないところに使われます。</font><font style="vertical-align: inherit;">ばかですか？</font><font style="vertical-align: inherit;">私は、神聖な</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DRY原則の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名の下にそのような奇妙なことをする多くの開発者を見てきました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーション全体でグローバルな不変状態が意味のある形で使用されている場合、これは、まとめる必要のある動作の分離を示している可能性があります。</font><font style="vertical-align: inherit;">この問題は、リファクタリングの助けを借りて解決できます。すべてのパーツを1つのクラス、一連のクラス、パッケージなどの便利なデザインにアセンブルします。</font><font style="vertical-align: inherit;">したがって、定数またはその他のグローバルな不変状態を使用する場合は、注意して、アプリケーション全体に忍び寄らないように注意してください。</font><font style="vertical-align: inherit;">どこからでもグローバルな不変コンストラクトにアクセスできる場合、これはどこからでもアクセスする必要があるという意味ではありません。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのグローバルな状態を見つけて破壊する必要がありますか？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつものように、小さなアプリケーション（たとえば、プラグインやライブラリ）を開発していて、それが大きくならないことがわかっている場合は、グローバルな変更可能な状態をいくつでも適用できます。</font><font style="vertical-align: inherit;">アプリケーションのスコープはまだ小さいので、グローバルがどこで使用されているか、状態が変更されたかどうかなどを見つけるのは難しくありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、アプリケーションは大きくなる傾向があります。</font><font style="vertical-align: inherit;">したがって、覚えておいてください：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能な限り、グローバルな変更可能な状態は避けるべきです。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の引数、依存関係の注入、およびコンテキストオブジェクトを使用して、グローバルな可変状態のスコープを縮小できます。 </font></font><br>
</li>
<li>  —   :         ,    ,        .<br>
</li>
<li>    ,        .<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソフトウェア開発において、他に類を見ないほど良い決定や明確でない決定はありません。</font><font style="vertical-align: inherit;">状況に応じてすべてが役立つ可能性があり、最も難しい作業の1つは、状況に応じて適切な決定を行うことです。</font><font style="vertical-align: inherit;">したがって、実験し、プロトタイプを作成し、結果について考えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、グローバルな可変国家は、たいていの場合、善よりも害を及ぼすことが多いと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のすべての問題の原因は、ローカルまたはグローバルな状態自体、およびそれらの可変性です。</font><font style="vertical-align: inherit;">すべてが不変である場合、ほとんどのアプリケーションでは問題の発生頻度は低くなります。</font><font style="vertical-align: inherit;">しかし、アプリケーションが必要に応じて機能するように、状態を変更する必要があることは明らかです。</font><font style="vertical-align: inherit;">したがって、常に変更可能性を回避することをお勧めします。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja454932/index.html">投資とソフトウェア：取引所で取引するための5つの取引端末</a></li>
<li><a href="../ja454936/index.html">Vivaldi：広告のブロックはユーザーの選択であるべきです</a></li>
<li><a href="../ja454938/index.html">FPGAベースのプロセッサシステムに埋め込むための独自のコアの開発</a></li>
<li><a href="../ja454940/index.html">旅行医療保険：詳細な手順</a></li>
<li><a href="../ja454944/index.html">JPEG形式の仕組み</a></li>
<li><a href="../ja454958/index.html">Inside View：EPFLの大学院。パート4.1：日常生活</a></li>
<li><a href="../ja454960/index.html">微生物相。薬が腸内細菌に与える影響</a></li>
<li><a href="../ja454962/index.html">世界中のIT企業は、元従業員によって競合他社からどのように保護されていますか？</a></li>
<li><a href="../ja454964/index.html">海洋調査におけるコンピュータービジョンの使用、または死者の胸に12人がいる</a></li>
<li><a href="../ja454966/index.html">UnityでGoogle Play Instantのインスタントゲームを作成する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>