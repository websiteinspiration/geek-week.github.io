<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚗 🙎🏿 👩🏾‍🍳 Métodos para optimizar consultas LINQ en C # .NET 💅 🛡️ 🕹️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducción
 En este artículo discutimos algunas técnicas de optimización de consultas LINQ . 
 Aquí hay algunos enfoques de optimización de código m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Métodos para optimizar consultas LINQ en C # .NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489226/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducción</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este artículo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> discutimos algunas técnicas de optimización </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí hay algunos enfoques de optimización de código más relacionados con las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se sabe que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Language-Integrated Query) es un lenguaje simple y conveniente para consultar una fuente de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ to SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una tecnología de acceso a datos en un DBMS. Esta es una herramienta poderosa para trabajar con datos, donde las consultas se construyen a través de un lenguaje declarativo, que luego </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plataforma </font><font style="vertical-align: inherit;">convertirá en </font><b><font style="vertical-align: inherit;">consultas SQL</font></b><font style="vertical-align: inherit;"> y enviará al servidor de la base de datos para su ejecución. En nuestro caso, por DBMS nos referimos a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no se convierten en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escritas de manera óptima </font><font style="vertical-align: inherit;">que un DBA experimentado podría escribir con todos los matices de la optimización de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las consultas SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexiones óptimas ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) y filtrado de resultados ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DONDE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muchos matices en el uso de compuestos y condiciones grupales</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muchas variaciones al reemplazar las condiciones </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , &lt;&gt; con </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">almacenamiento en caché intermedio de resultados a través de tablas temporales, CTE, variables de tabla</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilizando una cláusula ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPCIÓN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) con instrucciones y sugerencias de tabla </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CON</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (...)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El uso de vistas indexadas, como uno de los medios para deshacerse de las lecturas redundantes de datos en muestras</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los principales cuellos de botella de rendimiento de las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultantes </font><font style="vertical-align: inherit;">al compilar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consolidación de todo el mecanismo de selección de datos en una sola solicitud</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duplicación de bloques de código idénticos, lo que finalmente lleva a múltiples lecturas adicionales de datos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grupos de condiciones multicomponentes (lógico "y" y "o") - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , combinados en condiciones difíciles, conducen al hecho de que el optimizador, que tiene índices no agrupados adecuados, por los campos necesarios, finalmente comienza a escanear por el índice de agrupación ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESCANEO DE ÍNDICE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) por grupo de condiciones</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El anidamiento profundo de las subconsultas hace que sea muy problemático analizar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las declaraciones SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y analizar los planes de consulta de los desarrolladores y los </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBA</font></font></b></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Métodos de optimización</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora pasamos directamente a los métodos de optimización.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) indexación adicional</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es mejor tener en cuenta los filtros en las tablas de muestreo principales, ya que muy a menudo la consulta completa se basa en una o dos tablas principales (aplicaciones-personas-operaciones) y con un conjunto estándar de condiciones (cerrado, cancelado, habilitado, estado). Es importante que las muestras identificadas creen los índices correspondientes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta solución tiene sentido cuando elegir entre estos campos limita significativamente el conjunto devuelto a la consulta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, tenemos 500,000 aplicaciones. Sin embargo, solo hay 2.000 entradas activas. Luego, un índice seleccionado correctamente nos salvará de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESCANEO DE ÍNDICE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre una tabla grande y nos permitirá seleccionar rápidamente los datos a través de un índice no agrupado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La falta de índices también se puede detectar a través de indicaciones para analizar planes de consulta o recopilar estadísticas para vistas del sistema</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor MS SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_groups</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_group_stats</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_details</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los datos de vista contienen información sobre índices faltantes, con la excepción de los índices espaciales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, los índices y el almacenamiento en caché a menudo son métodos para tratar los efectos de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mal escritas </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como muestra la dura práctica de la vida para el negocio, a menudo es importante implementar las características del negocio en una fecha determinada. Y, por lo tanto, a menudo las consultas pesadas se ponen en segundo plano con el almacenamiento en caché. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto está parcialmente justificado, ya que el usuario no siempre necesita los datos más recientes y se produce un nivel aceptable de respuesta de la interfaz de usuario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este enfoque le permite resolver las necesidades comerciales, pero en última instancia reduce la eficiencia del sistema de información, simplemente retrasando la solución de problemas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
También vale la pena recordar que en el proceso de búsqueda necesario para agregar nuevos índices, las propuestas de </font><font style="vertical-align: inherit;">optimización de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pueden ser incorrectas, incluso bajo las siguientes condiciones:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si ya existen índices con un conjunto similar de campos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si los campos de la tabla no pueden ser indexados debido a las restricciones de indexación (más sobre esto se describe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Fusionar atributos en un nuevo atributo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces, algunos campos de la misma tabla en la que se produce un grupo de condiciones se pueden reemplazar por la introducción de un nuevo campo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es especialmente cierto para los campos de estado, que por tipo generalmente son bit a bit o enteros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Cancelled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se reemplaza por </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí ingresa el atributo entero Estado, que se proporciona al completar estos estados en la tabla. </font><font style="vertical-align: inherit;">El siguiente paso es indexar este nuevo atributo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una solución fundamental para el problema de rendimiento, porque estamos pidiendo datos sin cálculos innecesarios.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Materialización de envío</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no pueden usar directamente tablas temporales, CTE y variables de tabla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, hay otra forma de optimizar para este caso: las vistas indexadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un grupo de condiciones (del ejemplo anterior) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Cancelled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o un conjunto de otras condiciones similares) se convierte en una buena opción para usarlas en una vista indexada, almacenando en caché una pequeña porción de datos de un conjunto grande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero existen varias limitaciones al materializar una vista:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando subconsultas, las cláusulas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deben reemplazarse usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN</font></font></b></li>
<li><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">No</font></b><font style="vertical-align: inherit;"> se </font><b><font style="vertical-align: inherit;">pueden</font></b><font style="vertical-align: inherit;"> usar las </font><b><font style="vertical-align: inherit;">cláusulas </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION ALL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXCEPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERSECT</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no puede usar sugerencias de tabla y cláusulas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPTION</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sin capacidad de trabajar con ciclos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es imposible mostrar datos en una vista desde diferentes tablas</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es importante recordar que los beneficios reales de usar una vista indizada en realidad solo se pueden obtener indizándola. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero al invocar una vista, estos índices no pueden usarse, y para usarlos explícitamente, debe especificar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITH (NOEXPAND)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como </font><font style="vertical-align: inherit;">es imposible definir sugerencias de tabla </font><font style="vertical-align: inherit;">en las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , debe hacer otra representación: un "contenedor" de la siguiente forma:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> _ <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> MAT_VIEW <span class="hljs-keyword">WITH</span> (NOEXPAND);
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Usar funciones de tabla</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A menudo, en las </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> los bloques de subconsultas grandes o los bloques que usan representaciones con una estructura compleja forman la consulta final con una estructura de ejecución muy compleja y no óptima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beneficios clave del uso de funciones de tabla en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consultas LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La capacidad, como en el caso de las vistas, de usar y especificar como un objeto, pero puede pasar un conjunto de parámetros de entrada: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESDE LA FUNCIÓN (@ param1, @ param2 ...)</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
al final, puede lograr un muestreo de datos flexible</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se utiliza una función de tabla, no existen restricciones tan fuertes como en el caso de las vistas indizadas descritas anteriormente:</font></font><br>
<br>
<ol>
<li> :<br>
 <b>LINQ</b>             .<br>
     .<br>
        ,          </li>
<li>  ,     , :<br>
<br>
<ul>
<li>    (   )</li>
<li>     </li>
<li> <b>UNION</b>  <b>EXISTS</b></li>
</ul></li>
</ol><br>
</li>
<li> <b>OPTION</b>  ,       <b>OPTION(MAXDOP N)</b>,    . :<br>
<br>
<ul>
<li>      <b>OPTION (RECOMPILE)</b></li>
<li>         ,    <b>OPTION (FORCE ORDER)</b></li>
</ul><br>
   <b>OPTION</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>.<br>
</li>
<li>      :<br>
        (     ),         .<br>
,  ,     <b>WHERE</b>    <b>(a, b, c)</b>.<br>
<br>
       <b>a = 0 and b = 0</b>.<br>
<br>
,    <b>c</b>  .<br>
<br>
  <b>a = 0 and b = 0</b>          ,    <b></b>      .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí la función de tabla puede ser una mejor opción. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además, la función de tabla es más predecible y constante en el tiempo de ejecución.</font></font><br>
</li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consideremos un ejemplo de implementación utilizando el ejemplo de la base de datos de Preguntas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una consulta </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que combina varias tablas y utiliza una vista (OperativeQuestions), que verifica por correo electrónico la afiliación (a través de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) de "Consultas activas" ([OperativeQuestions]):</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitud No. 1</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId],<font></font>
[Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]) <span class="hljs-keyword">AND</span> ( <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1]
<span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestions] <span class="hljs-keyword">AS</span> [Extent5]
<span class="hljs-keyword">WHERE</span> (([Extent5].[Email] = @p__linq__0) <span class="hljs-keyword">OR</span> (([Extent5].[Email] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) 
<span class="hljs-keyword">AND</span> (@p__linq__0 <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>))) <span class="hljs-keyword">AND</span> ([Extent5].[<span class="hljs-keyword">Id</span>] = [Extent1].[<span class="hljs-keyword">Id</span>])<font></font>
));<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vista tiene una estructura bastante complicada: tiene uniones de subconsulta y el uso de la clasificación </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISTINCT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que en el caso general es una operación bastante intensiva en recursos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una selección de aproximadamente diez mil registros de OperativeQuestions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El principal problema de esta consulta es que para los registros de una consulta externa, se realiza una subconsulta interna en la vista [OperativeQuestions], que debería limitar la muestra de salida (a través de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) a cientos de registros </font><font style="vertical-align: inherit;">para [Email] = @ p__linq__0 </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y puede parecer que la subconsulta debería calcular los registros una vez por [Correo electrónico] = @ p__linq__0, y luego estos doscientos registros deberían estar conectados por Id c Preguntas, y la consulta será rápida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, todas las tablas están conectadas en serie: las preguntas de identificación y la identificación de las preguntas operativas se verifican para verificar el cumplimiento y el correo electrónico se filtra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, la solicitud funciona con todas las decenas de miles de registros de preguntas operativas, y solo necesita datos de interés en el correo electrónico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Texto de vista de preguntas operativas:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitud No. 2</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"> 
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> [dbo].[OperativeQuestions]
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Q.Id, USR.email <span class="hljs-keyword">AS</span> Email
<span class="hljs-keyword">FROM</span>            [dbo].Questions <span class="hljs-keyword">AS</span> Q <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].ProcessUserAccesses <span class="hljs-keyword">AS</span> BPU <span class="hljs-keyword">ON</span> BPU.ProcessId = CQ.Process_Id 
<span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">APPLY</span>
                     (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> HasNoObjects
                      <span class="hljs-keyword">WHERE</span>   <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>
                                    (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                                     <span class="hljs-keyword">FROM</span>     [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU
                                     <span class="hljs-keyword">WHERE</span>   BOU.ProcessUserAccessId = BPU.[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>)<font></font>
) <span class="hljs-keyword">AS</span> BO <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].Users <span class="hljs-keyword">AS</span> USR <span class="hljs-keyword">ON</span> USR.Id = BPU.UserId
<span class="hljs-keyword">WHERE</span>        CQ.[<span class="hljs-keyword">Exp</span>] = <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> CQ.AnswerId <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> BPU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> 
<span class="hljs-keyword">AND</span> (BO.HasNoObjects = <span class="hljs-number">1</span> <span class="hljs-keyword">OR</span>
              <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                           <span class="hljs-keyword">FROM</span>   [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                                      [dbo].ObjectQuestions <span class="hljs-keyword">AS</span> QBO 
                                                  <span class="hljs-keyword">ON</span> QBO.[Object_Id] =BOU.ObjectId
                               <span class="hljs-keyword">WHERE</span>  BOU.ProcessUserAccessId = BPU.Id 
                               <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> QBO.Question_Id = CQ.Id));
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Representación de mapeo original en DbContext (EF Core 2)</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulta LINQ original</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .Where(x =&gt; x.Email == Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso particular, se considera una solución a este problema sin cambios de infraestructura, sin introducir una tabla separada con resultados listos ("Consultas activas"), para lo cual se necesitaría un mecanismo para completar sus datos y mantenerlos actualizados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque esta es una buena solución, hay otra opción para optimizar esta tarea. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El objetivo principal es almacenar en caché las entradas por [Email] = @ p__linq__0 desde la vista OperativeQuestions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingresamos la función de tabla [dbo]. [OperativeQuestionsUserMail] en la base de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al enviar el correo electrónico como parámetro de entrada, recuperamos la tabla de valores:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitud No. 3</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> [dbo].[OperativeQuestionsUserMail]<font></font>
(<font></font>
    @Email  <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">RETURNS</span>
@tbl <span class="hljs-keyword">TABLE</span><font></font>
(<font></font>
    [<span class="hljs-keyword">Id</span>]           uniqueidentifier,<font></font>
    [Email]      <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">BEGIN</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> @tbl ([<span class="hljs-keyword">Id</span>], [Email])
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, @Email
        <span class="hljs-keyword">FROM</span> [OperativeQuestions]  <span class="hljs-keyword">AS</span> [x] <span class="hljs-keyword">WHERE</span> [x].[Email] = @Email;<font></font>
     <font></font>
    RETURN;<font></font>
<span class="hljs-keyword">END</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto devuelve una tabla de valores con una estructura de datos predefinida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que las consultas a OperativeQuestionsUserMail sean óptimas, para tener planes de consulta óptimos, se requiere una estructura estricta y no la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TABLA DE DEVOLUCIONES COMO DEVOLUCIÓN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, la Solicitud 1 deseada se convierte en la Solicitud 4:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitud No. 4</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, Email <span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestionsUserMail] (@p__linq__0)<font></font>
) <span class="hljs-keyword">AS</span> [Extent0]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1] <span class="hljs-keyword">ON</span>([Extent0].Id=[Extent1].Id)
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id], [Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId], [Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]);
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asignación de vistas y funciones en DbContext (EF Core 2)</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
 <font></font>
public static class FromSqlQueries<font></font>
{<font></font>
    public static IQueryable&lt;OperativeQuestion&gt; GetByUserEmail(this DbQuery&lt;OperativeQuestion&gt; source, string Email)<font></font>
        =&gt; source.FromSql($"SELECT Id, Email FROM [dbo].[OperativeQuestionsUserMail] ({Email})");<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulta final de LINQ</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .GetByUserEmail(Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El orden del tiempo de ejecución disminuyó de 200 a 800 ms, a 2 a 20 ms, etc., es decir, diez veces más rápido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tomamos un promedio más, entonces en lugar de 350 ms tenemos 8 ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De las ventajas obvias, también obtenemos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reducción general en la carga de lectura,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reducción significativa en la probabilidad de bloqueo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reducción del tiempo de bloqueo promedio a valores aceptables</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusión</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La optimización y el ajuste fino de las llamadas a la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base de datos MS SQL a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> través de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un problema que se puede resolver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este trabajo, el cuidado y la consistencia son muy importantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al comienzo del proceso:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es necesario verificar los datos con los que trabaja la consulta (valores, tipos de datos seleccionados)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexar adecuadamente estos datos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verificar la corrección de las condiciones de conexión entre las tablas</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la próxima iteración, la optimización revela:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se define la base de la solicitud y el filtro de solicitud principal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repetir bloques de consulta similares y condiciones de intersección</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el SSMS u otra GUI para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta SQL en</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sí misma está optimizada </font><font style="vertical-align: inherit;">(asignación de un almacén de datos intermedio, construcción de la consulta resultante utilizando este almacén (puede haber varios))</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la última etapa, tomando como base la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultante </font><font style="vertical-align: inherit;">, se reconstruye la estructura de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta LINQ</font></font></b></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultante </font><font style="vertical-align: inherit;">debería tener una estructura idéntica a la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> óptima identificada </font><font style="vertical-align: inherit;">del párrafo 3.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expresiones de gratitud</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muchas gracias a los colegas. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bolsa de trabajo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alex_ozr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por ayudarme con este artículo.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es489206/index.html">Historias de bloqueo con Patroni, o Cómo soltar un clúster PostgreSQL</a></li>
<li><a href="../es489210/index.html">Prueba de rendimiento del código de Linux con ejemplos</a></li>
<li><a href="../es489212/index.html">1C-Bitrix evita la cancelación de la suscripción al boletín por el requisito de enviar sus datos personales</a></li>
<li><a href="../es489214/index.html">Enfoque moderno para probar la localización en iOS</a></li>
<li><a href="../es489218/index.html">Es ingenuo. Super: código y arquitectura de un juego simple</a></li>
<li><a href="../es489228/index.html">Speech bot en el banco: la peor experiencia de usuario jamás vista</a></li>
<li><a href="../es489230/index.html">¿Qué es el rendimiento de la aplicación web?</a></li>
<li><a href="../es489232/index.html">Regreso al futuro de los teléfonos móviles II</a></li>
<li><a href="../es489234/index.html">Cómo pasar con éxito cualquier pentest (mal consejo)</a></li>
<li><a href="../es489236/index.html">Primavera: buscando contexto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>