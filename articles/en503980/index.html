<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíá üë®üèø‚Äçüåæ üé≠ Monitoring temperature at a remote site by ‚Äúimprovised‚Äù means üïû üÜó üêá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Back in 2019, when it was possible to go outside without a pass, I was asked to do remote monitoring of the temperature in the village house. The cond...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Monitoring temperature at a remote site by ‚Äúimprovised‚Äù means</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503980/"><img src="https://habrastorage.org/webt/sz/sx/wa/szsxwal5ggvev3m8b6_gdflrqic.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Back in 2019, when it was possible to go outside without a pass, I was asked to do remote monitoring of the temperature in the village house. The conditions were as follows. There is a private house with internet, in the house there is a gas boiler for heating. The boiler maintains a certain temperature in the heating system, periodically turning it on and off. In the off state, the standby wick is on. The hood is installed with errors, so a strong wind from outside periodically blows the wick and the heating stops working. So that in winter the water in the heating system does not freeze, you need to manually light the wick. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this house, people appear once a month, so you can‚Äôt do without a monitoring system. Next, the statement of the problem and its implementation in the most ‚Äúlazy" way that I found in 2 months.</font></font><br>
<a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problem statement</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
If the wick goes out, then the temperature in the house begins to gradually drop. When it drops below 15 degrees, send an ‚Äúemail‚Äù notification to the ‚Äúclient‚Äù. The ‚Äúclient‚Äù himself makes a decision, either to go by himself or to call the neighbors who light the wick. Main condition: ‚ÄúNo configuration. I brought it, turned it on and everything works. ‚Äù </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Element base selection</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I had 2 months for development (the task was set in the fall, it was far from frost). In this situation, the ESP8266 begs for itself. There is Wi-fi in the house, libraries for measuring temperature are written for various sensors. I had both an ESP and a DS18b20 temperature sensor, so I postponed this project for a while due to work on the main job. Almost 2 months passed and it was time to turn in a ready-made solution, but I did not start. I looked around and decided to use a ready-made solution with some modifications. I had a free Z-Wave based smart home controller. It consists of RaspberryPi and an expansion board for it, which makes it a smart home controller. RaspberryPi bought on Avito for 1500r. half a year ago, and I had a used expansion board. New costs 6000r.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ak/gn/wx/akgnwxiuscrrzzz9vm1vwiuamle.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you buy everything in the store, then the price is about 13000r. and is called the "RaZberry Controller." </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I did not have a ready temperature sensor compatible with Z-wave. </font></font><br>
<img src="https://habrastorage.org/webt/4w/bh/yj/4wbhyjjyjfqh1o89gr4ppmbkkt4.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I made it on the basis of ZUNo (in the store about 3000r., I got one of the prototypes for free) and a sealed temperature sensor DS18B20. </font></font><br>
<img src="https://habrastorage.org/webt/bg/un/da/bgundabhtaylxrckn99nicuoqt0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZUNo is an Arduino compatible board with a built-in radio transceiver. The sketch for her took without changes from the manufacturer's website ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://z-uno.z-wave.me/examples/1-wire-ds18b20-temperature-sensor/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) From this sketch, ZUNo polls the temperature sensor every 30 seconds and sends a notification to the controller via radio. ZUNo does not sleep while waiting. It‚Äôs me that the sketch is primitive, it does not save resources either on the microcontroller itself or on electricity. But he does exactly as much as I need! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZUNo ‚Äúneatly‚Äù filled with hot melt adhesive in a plastic case. </font></font><br>
<img src="https://habrastorage.org/webt/2g/3q/ts/2g3qtsd1dgzhkaxgjikfykhqsfg.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He brought 2 wires out of the case: powered by USB and a temperature sensor. It turned out reliably, so it's not scary to drop it and it looks decent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The controller connected via Ethernet cable to the router. The cable could not be used. RaspberryPi can use Wi-fi. But since the main requirement was ‚Äúturned on and forgot‚Äù, I did not take risks with pre-setting the wi-fi network on raspberryPi.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RaspberryPi was connected to a 2 amp ‚Äúcharge‚Äù from the phone. The temperature sensor consumes up to 50 mA so it is connected to the RaspberryPi USB connector. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry setup</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 The image was taken from here </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">storage.z-wave.me/z-way-server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> called "razberry.img.zip". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, I </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">installed the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> image on the SD card for RaspberryPi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If RaspberryPi has started, the Z-way server (smart home software) will also be launched. But it is an old version, it needs to be updated. In the settings there is a button for updating, but no one uses it and it does not work. </font></font><br>
<img src="https://habrastorage.org/webt/oj/md/ob/ojmdobj0ypyg4f2rt59m0uqtvu0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 It is much more ‚Äúconvenient‚Äù to use the instructions for updating. She is at this </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">address</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">To enter the commands described in this manual you need to open a terminal on RaspberryPi. </font><font style="vertical-align: inherit;">This can be done via ssh or by connecting a monitor with a keyboard. </font><font style="vertical-align: inherit;">The second monitor and keyboard are always with me, unlike the router, so I chose the second option. </font><font style="vertical-align: inherit;">Since I‚Äôm developing an unattended embedded system, you need to provide a watchdog timer to increase reliability. </font><font style="vertical-align: inherit;">All the same, RaspberryPi is not an industrial controller and the Z-wave system, it is also not recommended to use it in critical decisions; I will count on periodic freezes, which can only be exited by restarting the software or the entire operating system on RaspberryPi. </font><font style="vertical-align: inherit;">I will restart the entire operating system every day at 12:00. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, I added a line to the file executed after the start of the operating system.</font></font><br>
<pre><code class="python hljs"><span class="hljs-comment">#sudo vi /etc/rc.local</span>
shutdown -r <span class="hljs-number">12</span>:<span class="hljs-number">00</span></code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basic vi commands</font></font></b>
                        <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if I want to repeat and forget </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚Äúi‚Äù - start typing in vi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚Äú: wq!‚Äù </font><font style="vertical-align: inherit;">- save and exit vi</font></font><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The assembled ZUNo-based temperature sensor is also not ideal, if you connect it to the RaspberryPi it will reboot on power every day. This greatly improves the reliability of the system as a whole. The operating system remains the weak point, if it freezes and does not restart at 12:00 there is nothing to be done. Have to call a "specialist" to distort the food. However, this operating system has been tested and debugged better than the other components of this project (I hope). You have to take this risk. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setting up the Z-way server software</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
To enter the graphical part of the Z-way server software, it energized the equipment and after a few minutes used the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This service looks for RaspberryPi with a Z-way server running on the local network and displays their ip addresses. You can also connect to a remote RaspberryPi here. To configure this, I chose a local RaspberryPi. Set a username and password and remembered the six-digit ID. This is enough for a remote connection. </font></font><br>
<img src="https://habrastorage.org/webt/rj/ag/bu/rjagbunwspmpbw10-zydr2hhfza.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ID for remote connection. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Added a temperature sensor. This is a standard action. </font></font><br>
<img src="https://habrastorage.org/webt/cl/fh/s2/clfhs2ni524ui0knrehemt9jbm4.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Added Applications-&gt; Local Applications-&gt; Email ME </font></font><br>
<img src="https://habrastorage.org/webt/8w/bp/sn/8wbpsnhpnnt3wbduvmo-mnothse.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Specified the name of the element and email address with the text of the letter </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Added the condition under which the letter will be sent. Nothing too complicated. </font></font><br>
<img src="https://habrastorage.org/webt/ya/gb/iy/yagbiy4qxnhipjy-ibhbjoxgily.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Final check </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connected RaspberryPi to a router through a cable, applied power, connected a thermal sensor.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I cooled the temperature sensor and received a letter, then one more, and another. While the temperature is below 15 degrees, the "client" will receive letters. It‚Äôs good, you won‚Äôt be able to miss it. (Looking ahead, I‚Äôll say that the client didn‚Äôt have mail either, so I received several hundred letters from my ‚Äúbrainchild.‚Äù My mail client conveniently put them in chains and did not cause any discomfort). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To quickly see the temperature in the house on the phone, I installed the Z-way application. </font></font><br>
<img src="https://habrastorage.org/webt/ep/l7/-x/epl7-xz8vc3g2yfhvps2-jmnrda.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I can‚Äôt say that it is fast, convenient, but it allows you to remotely connect to the Z-way server on RaspberryPi and watch the temperature. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For 2 evenings, looking around, I assembled a temperature monitoring system for a remote object. Previously, ZUNo and the Razberry controller were considered expensive toys. But after the solemn removal of my equipment from the "combat" post, where it several times in time determined the malfunction of the heating system during the winter season, I was respected by these products. And there is something to respect. The Internet and the light periodically disappeared, but after the resumption of filing, communication was restored. Now I disassembled this ‚Äúcomplex‚Äù into spare parts and understood its main strength. Having a Razberry controller board that can be inserted into RaspberryPi, or via an UART adapter to any computer, one or two ZUNo, a basic set of sensors and simple actuators, you can quickly solve the problem.I don‚Äôt like the word ‚Äúeasy‚Äù and do not have the experience of using ‚Äúsmart‚Äù equipment from other manufacturers, but in 2 days I received a ready-made set of equipment that is enough to connect to power, as well as an application on a smartphone, a web application on a computer and notifications by e-mail.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en503964/index.html">DataStore - CRUD (Create Read Update Delete)</a></li>
<li><a href="../en503966/index.html">The Social Monitoring app was made from a garbage truck tracker</a></li>
<li><a href="../en503968/index.html">How to make the robot move accurately? Studuino Platform Robotics Overview and Features</a></li>
<li><a href="../en503970/index.html">PuppetConf 2016. Kubernetes for system administrators. Part 1</a></li>
<li><a href="../en503972/index.html">Streaming test in 4 social networks and choosing the best option</a></li>
<li><a href="../en503982/index.html">About orcs and frameworks</a></li>
<li><a href="../en503988/index.html">How "swirling light" got into optical networks</a></li>
<li><a href="../en503990/index.html">I'm tired of the fact that ordinary programmers impersonate developers and dishonor the industry. They make the world worse</a></li>
<li><a href="../en503992/index.html">How to give a cool lecture / webinar: 16 tips from three serial lecturers. Leader-IT events # 2</a></li>
<li><a href="../en503994/index.html">Quest Software Webinar Announcement for Remote Workstation and Cybersecurity Management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>