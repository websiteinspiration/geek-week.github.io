<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôéüèº üö™ ‚õ≤Ô∏è Measuring the UVA UVB üëõ üëø ‚ùì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We all love the sun and of course we know about the dangers of ultraviolet radiation for human skin. Obviously, you cannot sunbathe on the beach for a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Measuring the UVA UVB</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499966/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We all love the sun and of course we know about the dangers of ultraviolet radiation for human skin. </font><font style="vertical-align: inherit;">Obviously, you cannot sunbathe on the beach for a long time. </font><font style="vertical-align: inherit;">But it‚Äôs not at all obvious, is it possible to walk in the T-shirt under the sun, and swim, walk in the mountains? </font><font style="vertical-align: inherit;">After another ‚Äúburning‚Äù from the sun in the mountains in Krasnaya Polyana, the question arose - how to measure the instant index of ultraviolet radiation and know when it is time to hide in the shade. </font><font style="vertical-align: inherit;">As a result, this small device was born - a UV radiation sensor with a number of additional functions.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lp/o8/0g/lpo80gvoszy35k9hzmltwzls640.png"></div><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What should the device be able to</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main function is to measure the UV radiation index. </font><font style="vertical-align: inherit;">In addition, I wanted to measure the air temperature and the water temperature, with an accuracy of at least 0.5 degrees (especially when I took a dip in the pool with ice water and looked at a Chinese thermometer that was swimming there - 28 degrees, and was not around). </font><font style="vertical-align: inherit;">And of course, battery power.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Main components: VEML6075 + MCP3421 + STM8</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are not many sensors for measuring the UV index. </font><font style="vertical-align: inherit;">A commonly used UV probe is a phototransistor. </font><font style="vertical-align: inherit;">But it turned out to be quite difficult to calibrate. </font><font style="vertical-align: inherit;">The choice fell on the digital sensor - VEML6075. </font><font style="vertical-align: inherit;">He turned out to be very good. </font><font style="vertical-align: inherit;">The only negative is that it‚Äôs difficult to buy, delivery had to wait about a month through official channels - ‚ÄúThe Fifth Element‚Äù (China did not consider it - it‚Äôs unpleasant to guess quality in a one-time device). </font><font style="vertical-align: inherit;">Sensor Advantages:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">easy calibration at home</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cosine response of the sensor surface - accounting for the incidence of rays</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accurate index readings in two ranges - UVA UVB</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">low consumption</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I2C communication - fully digital sensor</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, the sensor size was scary 2x2 mm, there was no hot air gun, I thought it would be difficult to solder such a trifle with an ordinary soldering iron - but it turned out fine.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2g/rf/34/2grf34roitfitmtsmw0fbuwirkw.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second question - the measurement of water temperature, decided with a thermocouple. For accurate data reading from this sensor, use a very accurate ADC, with an integrated reference voltage source - MCP3421. 18-bit resolution + 8x signal amplification for a K-type thermocouple gives 0.01 degree temperature resolution - more than enough. Given the need to measure the temperature of the compound, the accuracy was in the region of 0.2 degrees. Checked by measuring boiling water and ice. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As the microcontroller - the simplest and cheapest option - STM8S003F3. Everything is on board - timers, I2C - needed for the sensor, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since the device should work in the sun, an LCD screen is used as an indicator. I wanted compactness - I chose this one:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hq/xp/mm/hqxpmmnlgkhbuyw75ngmqkkemag.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With management had to torment. </font><font style="vertical-align: inherit;">Multiplexing the LCD pins on a conventional microcontroller is still that task, but in general everything turned out fine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The case chose a small, compact from the company Sanhe model "20-31". </font><font style="vertical-align: inherit;">External size - 35x45x18 mm. </font><font style="vertical-align: inherit;">Everything fit - the board, indicator and battery. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not give the circuit and board, everything is on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UV Sensor Calibration</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After receiving readings from the sensor - they were not very pleased, they were not similar to the readings of the "hydro-center". I had to learn how to properly calibrate the sensor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to correctly calculate the UV radiation index according to the sensor readings, it is necessary to use several constants. How to calculate them without special equipment? Here is the full formula for calculating the index: The </font></font><br>
<img src="https://habrastorage.org/webt/kn/l0/45/knl045dun5ltafhqfxurbbhbhhu.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
constants k1 and k2 cannot be calculated without equipment. But they are necessary for the most accurate calculation, so that they can be taken as a unit. The sensitivity constants of the sensor can be taken from the table:</font></font><br>
<img src="https://habrastorage.org/webt/m-/qw/gz/m-qwgzn9s3emcnggn5mwlivxpum.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need the constants from the first line, since the sensor is not covered by Teflon (we could not buy optical Teflon, so the sensor is finally open). UVAresp and UVBresp. But the constants a, b, c, d must be calculated. I did this with a debugger. It is necessary to obtain the data uva, uvb, uvcomp1, uvcomp2, and calculate the constants in Excel. It is inconvenient to display them on the display - there are too few digits. This is where the debugger is needed. Set a breakpoint after receiving the data and see the calculated values. You can also use the ability to disconnect ST-link from STM8 during debugging and reverse connection. In this case, the debugging session is not interrupted! Another option is to use STM8 STUDIO. This special program allows you to get variables at any given time.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To calculate the constants without special equipment, let's use this (this is described in the application note to the sensor). Sunlight in its spectrum has UV radiation, IR radiation and visible radiation. To calculate the intensity of UV radiation, it is necessary to subtract the excess data about IR radiation and visible radiation. To do this, use the data uvcomp1 (responsible for visible radiation) and uvcomp2 (responsible for IR radiation). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To calculate the constants in the formula used, two artificial light sources are needed: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚Ä¢ an ordinary incandescent lamp - it emits in the IR spectrum and visible radiation, there is no UV radiation </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ‚Ä¢ LED lamp - it emits only in visible radiation, there is no UV and IR radiation</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We start with the LED lamp. Since there is no UV radiation, the corresponding index will be zero. </font></font><br>
<img src="https://habrastorage.org/webt/bq/z5/5w/bqz55wsnzk-wkzmntjp6uhyi-ou.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The LED lamp does not have IR radiation, so UVcomp2 will be 0. And in this case, you can find the coefficients </font></font><br>
<img src="https://habrastorage.org/webt/ka/-7/vn/ka-7vnca8jipxdomakrheh53_ok.gif"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having these coefficients, it is not difficult to find the coefficients b and d when using a conventional lamp, when UVcomp2 is not equal to zero. </font></font><br>
<img src="https://habrastorage.org/webt/hk/s-/0-/hks-0-eysabxkag42fy15lz8b2c.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using this simple method you can get the necessary constants. Such calibration should be carried out in the evening when there is no sunlight and other light sources. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A correctly calibrated sensor is very easy to check. On a sunny day, at noon, when there are no clouds in the sky, you need to measure the intensity by pointing the sensor exactly at the sun. The readings must match the transmitted data on the weather sites.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When tanning, to accurately measure radiation, the sensor must be kept parallel to the surface of the body. </font><font style="vertical-align: inherit;">To obtain the maximum current index, the sensor must be directed to the sun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The sensor began to show the best results with the maximum data averaging time (the sensor has the ability to set this parameter - the time during which it itself averages the indicators) - 800ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to make the readings absolutely perfect, we also had to follow the developer's recommendations - to paint the board black so that it would not reflect and surround the sensor with a black funnel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use experience</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I‚Äôll say right away about consumption - it is extremely small, it is about 2 mA when all sensors and the microcontroller are working. With infrequent use, the battery lasts for about 3 months on a single charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I consider the accuracy of the readings to be very high. I checked in several regions (Moscow, Sochi, Crimea) - the readings coincide at noon with weather sites. Therefore, I believe that in cloudy weather he can also be trusted. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the manufacture of the sensor, I had to study what UV radiation is, and how it is still harmful. What kinds of it are. How does it affect the skin. How does the position of the sun on the horizon and whether UV radiation is harmful to the eyes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Personally, I checked all the articles about ‚Äúburning‚Äù on myself. The sensor proved to be excellent. Now, having seen index 13 on the sensor in the mountains, I put on a tight shirt and cover all parts of the body. And in the evening, when index 5 - I walk calmly and bask under the warm rays of the sun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I learned that on a sunny day, you can get a good sunburn in Moscow - the index reaches 9 at noon. And also, that when swimming, the time spent in the sun doubles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For me, this device was very useful, I still use it, the whole family trusts the testimony.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the moment, he added a very accurate humidity sensor - HTS221. </font><font style="vertical-align: inherit;">It also works on I2C, so I just made a mini-board and pasted it inside. </font><font style="vertical-align: inherit;">Soldered with a varnished wire 0.15mm. </font><font style="vertical-align: inherit;">So, now it also shows humidity, much more accurately than Chinese meters sold on the market. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I‚Äôll write a little about the big fat minus - according to the recommendations of the developer, it is better to close the sensor with optical Teflon to isolate the sensor from dust and dirt. </font><font style="vertical-align: inherit;">It did not work to find such teflon in the rail, so the sensor becomes dusty and sometimes I wipe it with a cotton swab.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499950/index.html">A lot of free RAM, NVMe Intel P4500 and everything slows down - the story of the unsuccessful addition of the swap partition</a></li>
<li><a href="../en499954/index.html">Storacle - decentralized file storage</a></li>
<li><a href="../en499960/index.html">JanusGraph graph DBMS experiment to solve the problem of finding suitable paths</a></li>
<li><a href="../en499962/index.html">Some facts about cascading classifiers, which are rarely seriously considered in scientific articles.</a></li>
<li><a href="../en499964/index.html">NASA has selected three firms that will participate in the program to create a ship for landing on the moon</a></li>
<li><a href="../en499968/index.html">List of the most persistent online mitaps that take place even in May</a></li>
<li><a href="../en499970/index.html">We study the Mediastreamer2 VoIP engine. Part 12</a></li>
<li><a href="../en499972/index.html">May online events digest</a></li>
<li><a href="../en499974/index.html">3D games on Instagram Javascript, or sausage flight path</a></li>
<li><a href="../en499978/index.html">Translation of Andrew Un's book, Passion for Machine Learning, Chapters 36 and 37</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>