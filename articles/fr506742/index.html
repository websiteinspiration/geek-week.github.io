<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜🏻 ⤵️ 👸🏿 Pourquoi le centre du pixel doit être à (0,5; 0,5) 👩🏻‍🏭 🧔 🏀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, lorsque le lancer de rayons effectué à partir de «l'œil» de la caméra devient de plus en plus populaire, cette leçon doit être réapprise:...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pourquoi le centre du pixel doit être à (0,5; 0,5)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506742/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aujourd'hui, lorsque le lancer de rayons effectué à partir de «l'œil» de la caméra devient de plus en plus populaire, cette leçon doit être réapprise: le code s'améliore et la vie est plus facile si le centre du pixel est aux coordonnées (0,5; 0,5). Si vous êtes sûr de tout bien faire, continuez dans la même veine; pour vous, l'article n'est pas nouveau. Lisez mieux </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c'est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sentiment de placer le centre du pixel à (0,5; 0,5) a d'abord été expliqué (au moins pour moi) par le mignon petit article de Paul Huckbert "Quelles sont les coordonnées des pixels?" extrait du livre de 1990 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphics Gems</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pp. 246-248.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, cet article est difficile à trouver, je vais donc en résumer brièvement l'essence. Supposons que nous ayons un écran d'une largeur et d'une hauteur de 1000. Considérons uniquement l'axe X. Il peut être tentant d'affecter 0,0 au centre du pixel le plus à gauche d'une rangée, 1,0 au centre du suivant, etc. Vous pouvez même utiliser l'arrondi, dans lequel les coordonnées à virgule flottante 73,6 et 74,4 sont transférées au centre 74,0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, cela vaut la peine d'être considéré. Avec cette comparaison, le bord gauche sera à la coordonnée -0,5 et le bord droit à 999,5. Il n'est pas pratique de travailler avec un tel système. Pire encore, si différents opérateurs aiment </font></font><code>abs()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font><font style="vertical-align: inherit;">sont appliqués aux coordonnées des pixels </font></font><code>mod()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une telle comparaison peut entraîner des erreurs mineures sur les bords.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est plus facile de travailler avec un intervalle de 0,0 à 1000,0, dans lequel le centre de chaque pixel a une partie fractionnaire de 0,5. Par exemple, alors le pixel entier 43 aura une belle plage de valeurs des valeurs de ses sous-pixels de 43,0 à 43,99999. Voici le dessin de l'article de Paul:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcf/16a/79e/fcf16a79ea636a04f37b2259a034a954.png"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL, le</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> centre du pixel a toujours eu une partie fractionnaire (0,5; 0,5). Au début, DirectX n'a ​​pas adhéré à cela, mais dans DirectX 10, il </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> emparé de l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">esprit</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les opérations de conversion des coordonnées entières en coordonnées d'un pixel à virgule flottante doivent ajouter 0,5; pour convertir float en entier suffit d'utiliser </font></font><code>floor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais c'est une longue histoire. Après tout, tout le monde le fait aujourd'hui, non? Je suis revenu sur ce sujet parce que dans mes exemples, je suis tombé sur un (pseudo) code pour générer la direction d'une caméra en perspective pour le lancer de rayons:</font></font><br>
<br>
<pre><code class="cpp hljs"> float3 ray_origin = camera-&gt;eye;<font></font>
 float2 d = <span class="hljs-number">2.0</span> * <font></font>
     ( float2(idx.x, idx.y) / <font></font>
       float2(width, height) ) - <span class="hljs-number">1.0</span>;<font></font>
 float3 ray_direction =<font></font>
     d.x*camera-&gt;U + d.y*camera-&gt;V + camera-&gt;W;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le vecteur </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est l'emplacement entier du pixel, la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">largeur</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hauteur</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont la résolution d'écran. Le vecteur </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est calculé et utilisé pour générer un vecteur dans l' </font><font style="vertical-align: inherit;">espace du monde en </font><font style="vertical-align: inherit;">utilisant la multiplication de deux vecteurs, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ensuite, le vecteur </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">ajouté </font><font style="vertical-align: inherit;">- la direction de la caméra dans l'espace mondial. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> désignent les directions positives des axes </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du </font><font style="vertical-align: inherit;">plan d'affichage à une distance </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de l'œil. Dans le code ci-dessus, tout est beau et symétrique; il en est ainsi pour la plupart.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d8d/cb1/563/d8dcb1563f2b9b2c440d51ca0e0aa5fe.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le vecteur </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit indiquer une paire de valeurs de -1,0 à 1,0 en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordonnées de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> périphérique normalisées (Coordonnées de périphérique normalisées, NDC) pour les points sur l'écran. Cependant, le </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code échoue ici</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Continuons notre exemple: l'emplacement du pixel entier (0; 0) est transféré vers (-1.0; -1.0). Cela semble bien, non? Mais l'emplacement de pixel entier maximum est (999; 999), ce qui se traduit par (0.998; 0.998). La différence totale de 0,002 est due au fait que cette superposition incorrecte décale l'image entière d'un demi-pixel. Ces centres de pixels doivent être à 0,001 de chacun des bords. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxième ligne de code devrait ressembler à ceci:</font></font><br>
<br>
<pre><code class="cpp hljs">    float2 d = <span class="hljs-number">2.0</span> *<font></font>
        ( ( float2(idx.x, idx.y) + float2(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>) ) / <font></font>
            float2(width, height) ) - <span class="hljs-number">1.0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous obtenons l'intervalle NDC correct pour les centres des pixels, de -0,999 à 0,999. Si nous convertissons à la place les valeurs angulaires avec un point flottant (0,0; 0,0) et (1000,0; 1000,0) de cette manière (nous n'ajoutons pas 0,5, car nous travaillons déjà avec un point flottant), nous obtenons ensuite l'intervalle NDC complet, de -1,0 à 1,0, d'un bord à l'autre; cela prouve l'exactitude du code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si 0,5 vous ennuie et que vous manquez de symétrie, alors pour générer des valeurs aléatoires à l'intérieur d'un pixel, c'est-à-dire lorsque vous effectuez un lissage en émettant des rayons aléatoires à travers chaque pixel, vous pouvez utiliser cette formulation élégante:</font></font><br>
<br>
<pre><code class="cpp hljs">    float2 d = <span class="hljs-number">2.0</span> *<font></font>
        ( ( float2(idx.x, idx.y) + <font></font>
                float2( rand(seed), rand(seed) ) ) /<font></font>
            float2(width, height) ) - <span class="hljs-number">1.0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ajoutons simplement un nombre aléatoire de l'intervalle [0.0,1.0) à chaque valeur entière de l'emplacement du pixel. </font><font style="vertical-align: inherit;">La moyenne de cette valeur aléatoire sera de 0,5, c'est-à-dire le centre du pixel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je dirai donc brièvement: soyez prudent. </font><font style="vertical-align: inherit;">Implémentez correctement le demi-pixel. </font><font style="vertical-align: inherit;">D'après mon expérience, de telles erreurs d'un demi-pixel apparaissent dans de nombreux endroits différents (caméras, échantillonnage de texture, etc.) au fil des années de mon travail sur le code rasterizer dans Autodesk. </font><font style="vertical-align: inherit;">Plus bas sur la chaîne de montage, ils n'apportent que de la douleur. </font><font style="vertical-align: inherit;">Si nous ne faisons pas attention, ils peuvent également apparaître dans les traceurs de rayons.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr506730/index.html">Snort ou Suricata. Partie 1: choisissez un IDS / IPS gratuit pour protéger le réseau d'entreprise</a></li>
<li><a href="../fr506732/index.html">Réutilisation à l'échelle de l'organisation des composants de l'interface utilisateur</a></li>
<li><a href="../fr506734/index.html">Calculs transitoires dans les réseaux électriques</a></li>
<li><a href="../fr506736/index.html">Combien de méthodes devraient être dans une classe?</a></li>
<li><a href="../fr506740/index.html">Comment utiliser Microsoft SQL pour les rapports dans Power BI. Sur l'exemple de Mindbox</a></li>
<li><a href="../fr506748/index.html">Qui a augmenté ses ventes en quarantaine?</a></li>
<li><a href="../fr506758/index.html">Products a organisé une conférence sur le principe de l'open source, et pendant 10 ans chaque participant est organisateur</a></li>
<li><a href="../fr506762/index.html">Semaine de la sécurité 25: ensemble de correctifs record de Microsoft</a></li>
<li><a href="../fr506766/index.html">Nous refusons des plateformes RPA payantes et sommes basées sur OpenSource (OpenRPA)</a></li>
<li><a href="../fr506772/index.html">Créer ou refuser - un test d'idées de force</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>