<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛒 🌳 🏀 Razorページ機能を標準.NETに追加する 👺 👨‍❤️‍💋‍👨 👦🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RazorページはCore.Net 2.0で導入された新機能です。 Razorページは、標準のレイアウト（ビュー）とバックエンドクラスで構成されるページです。ある意味では、ステートフルサポートがない場合にのみWebフォームに似ています。このようなソリューションの利点は明白です-不要なレイヤー-ページ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Razorページ機能を標準.NETに追加する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464831/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RazorページはCore.Net 2.0で導入された新機能です。 Razorページは、標準のレイアウト（ビュー）とバックエンドクラスで構成されるページです。ある意味では、ステートフルサポートがない場合にのみWebフォームに似ています。このようなソリューションの利点は明白です-不要なレイヤー-ページモデル（たとえば、エンティティ自体の形式のデータモデル）を取り除きます。ページのバックエンドは、コントローラーとモデルの両方です-OOPクラシック-データとそれらを1つのオブジェクトで操作するメソッドをカプセル化します。結局、ページモデルは単なるクラスであり、コントローラーをこのクラスにすることができない理由はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
言い換えれば、Razor PagesはMVCよりも健全なWebソリューションです。現在では、プロジェクト全体に散在するコントローラーやモデルではなく、「ページ」の従来の論理的な概念を扱っています。</font><font style="vertical-align: inherit;">しかし、.NETはCore.Netの方向に発展するため、今後数年間でほとんどのプロジェクトが標準の.NETに留まるという事実にもかかわらず、Razor Pageが標準のフレームワークに登場することはほとんどありません。</font><font style="vertical-align: inherit;">それにもかかわらず、Razorページの機能を標準フレームワークで表すことができます。</font></font><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソリューションは実際には非常に取るに足らないものに見えます-次のデザインをコントローラーに追加する必要があります：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnActionExecuting</span>(<span class="hljs-params">ActionExecutingContext Context</span>)</span><font></font>
{<font></font>
       UpdateModel(<span class="hljs-keyword">this</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OnActionExecutingメソッドは、コントローラーメソッドが実行される前に呼び出されるライフサイクルのイベントです（つまり、要求ハンドラー-アクション）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UpdateModelは、要求パラメーターをモデルのプロパティ（この場合はコントローラークラスのプロパティ）に直接バインドします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追加の利便性-モデルタイプやその他のパラメーターを明示的に受け入れる必要がなくなりました。</font><font style="vertical-align: inherit;">これを妨げるものは何もありませんが、パラメーターが純粋にローカル変数として使用される単純なIDである場合、コントローラーのプロパティとしてパラメーターをバインドする必要があります。たとえば、ページの永続性を確保する必要がある場合などです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単な例：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのフィールドを持つ通常のログインフォームがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マークアップしても意味がありません。コントローラコードのみを指定します</font></font><br>
<br>
<pre><code class="cs hljs"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AccountController</span> : <span class="hljs-title">Controller</span><font></font>
 {<font></font>
     <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> username{ <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
     <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> userpass{ <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
     [<span class="hljs-meta">HttpPost</span>]
     <span class="hljs-function"><span class="hljs-keyword">public</span> ActionResult <span class="hljs-title">OnLogin</span>(<span class="hljs-params"> </span>)</span><font></font>
     {<font></font>
              <span class="hljs-comment">//    </span><font></font>
               checklogin(username,userpass);<font></font>
<font></font>
               <span class="hljs-keyword">return</span> View(<span class="hljs-string">"Index"</span>,<span class="hljs-keyword">this</span>);<font></font>
     }<font></font>
<font></font>
     <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnActionExecuting</span>(<span class="hljs-params">ActionExecutingContext Context</span>)</span><font></font>
    {<font></font>
   <font></font>
            UpdateModel(<span class="hljs-keyword">this</span>);<font></font>
     }<font></font>
 }<font></font>
<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、イベントがトリガーされた時点では、入力データは既にバインドされており、使用する準備ができています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、今度はコントローラーもActionResultとして返す必要があることを覚えておく必要があります。テンプレートには、@ Model AccountControllerなどのコントローラーのクラス名を登録します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このソリューションの結果として、リクエスト間でページの状態を保持するタスクも簡素化されます。特定のテーブルを含むページがあり、列とページネーションでソートするフィルターがあるとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィルターをクリックすると、モデルがビューに戻り、すべて正常ですが、並べ替えをクリックすると、フィルターは自然にリセットされます。ページ編集者は、並べ替えとフィルタの両方をリセットします。 WebFormsでは、ページの状態は自動的に保存されました。MVCでは、さまざまな面倒な決定を適用する必要があります。たとえば、すべてのパラメーターを接着し、要求ごとにそれらを駆動する必要があります。つまり、これより前に来たすべてのパラメーターを並べ替えリンクのフィルターから掛ける必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような困難は、ロジックとデータをブラウザーにドラッグし、ブラウザーブレーキ（特にモバイルデバイス）、ページのジャンプとマウスの動きごとのジャーク、および作業の複雑さとコストの増加を伴うSPAやその他のJavaScriptの狂気の理由の1つです-バックエンドがすべて同じであるためajaxを介して送信されたデータをパック、アンパック、プラスcallbac hell、デバッグの複雑化など、何らかの形で記述します。これはすべて、ページの記述方法を気にしないサイト訪問者にとって実用的なメリットはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も論理的な解決策は、セッションでページの状態を保存することです。必要なパラメーターはすべてコントローラープロパティの形で手元にあるので、必要なのは、要求の処理後に呼び出されるOnActionExecutedメソッドを再定義し、必要なプロパティをセッションにパックすることです（セッションキーは明らかにコントローラーの名前を指す必要があります）。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnActionExecuted</span> (<span class="hljs-params">ActionExecutedContext Context</span>)</span><font></font>
{<font></font>
      <span class="hljs-comment">// </span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメーターは、コントローラーコンストラクターのセッションから、またはUpdateModel（this）を呼び出す前に復元されます。たとえば、並べ替えなどのリクエストが届くと、新しいパラメータが変更され、残りはそのまま残り、ビューは送信時と同じ形式で表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなソリューションにはもう1つの便利な機能があります。たとえば、ユーザーがテーブルを並べ替え、別のページを開いて要素を編集することにしました。当然、彼は残したリストの状態に戻りたいと考えています。ページの状態はセッションにあるため、ページは自動的に復元されます。よくあることですが、パラメータの「餃子」全体を編集ページに転送したり、その逆を行ったりする必要はありません。ページ間で状態を保存する必要がない場合は、ページの状態をセッションではなくTempDataに保存できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの「ライフハック」は、些細なことのように見えますが、インターネットでより不快で面倒な解決策を探し、他に方法がないと判断するまで、初心者にとって役立つことを願っています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464811/index.html">開発者向けApple Music</a></li>
<li><a href="../ja464813/index.html">Punto Switcher、Birmanレイアウトをautohotkeyのスクリプトに置き換える</a></li>
<li><a href="../ja464819/index.html">ハイクでの6日目：リソース、アイコン、パッケージの内部</a></li>
<li><a href="../ja464823/index.html">「データサイエントロジスト」の平均給与を考慮します。パンダ/パイソンを使用したパーシムhh.ru</a></li>
<li><a href="../ja464825/index.html">Android Q用のアプリケーションの準備。パート2</a></li>
<li><a href="../ja464833/index.html">Scoring de la Ferを数えるか、視野を広げる一環としてのクレジットスコアリングに関する研究。パート2</a></li>
<li><a href="../ja464837/index.html">ガンジス川からヴォルガ川へ：河川を汚染から守るには？</a></li>
<li><a href="../ja464839/index.html">テスラモーターズの特許について</a></li>
<li><a href="../ja464841/index.html">Habr Weekly＃15 /良い物語の力について（そしてフライドチキンについて少し）</a></li>
<li><a href="../ja464843/index.html">C ++でのASIOの有用または開発に満足</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>