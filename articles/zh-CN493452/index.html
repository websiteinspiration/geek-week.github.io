<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤹🏾 💞 🙎🏿 Unity背景图片模糊 👩‍⚖️ 🙆🏿 👩‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity应用程序开发人员可能会遇到的任务之一是将当前图像放在后台，以便将用户的注意力切换到新的事物上，例如出现的菜单或消息。本文介绍了具有Unity基本知识的开发人员无需使用外部资源或其他Unity许可证即可解决此问题的经验。我希望这些材料对那些面临类似问题但在不同阶段找不到有效解决方案的人有用。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unity背景图片模糊</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493452/"><img src="https://habrastorage.org/webt/jb/sq/go/jbsqgovdy74rajkik0r_o24tre8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unity应用程序开发人员可能会遇到的任务之一是将当前图像放在后台，以便将用户的注意力切换到新的事物上，例如出现的菜单或消息。本文介绍了具有Unity基本知识的开发人员无需使用外部资源或其他Unity许可证即可解决此问题的经验。我希望这些材料对那些面临类似问题但在不同阶段找不到有效解决方案的人有用。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
突出显示重要的界面元素（并删除不必要的界面元素）是改善用户体验的主要工具之一。在使用移动应用程序时，这一点尤其明显。注意力的切换可以通过不同的方式进行-平稳地将按钮移出屏幕边缘，使背景变暗，动态行为等。这些操作包括使图像模糊。一方面，这种效果降低了背景元素的对比度，并且使眼睛难以捕捉。另一方面，当图像失去焦点时，模糊会产生潜意识效果，我们对此有不同的认识。这种方法常用于游戏中，从Unity上著名的游戏示例中，我们可以选择选择《</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">炉石传说》</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务菜单</font><font style="vertical-align: inherit;">或</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决斗完成屏幕</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在想象我们想在我们喜欢的应用程序中做相同或相似的事情。</font><font style="vertical-align: inherit;">我们也不是没有预算并且对Unity经验很少。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一部分-着色器</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出现的第一个想法是，一切都应该已经实现。</font><font style="vertical-align: inherit;">当然使用着色器。</font><font style="vertical-align: inherit;">它当然应该在Unity框中。</font><font style="vertical-align: inherit;">快速搜索和安装尝试表明，Unity中有这样的着色器，但事实证明，它是Standard Assets的一部分，并且无法获得免费许可证。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但这是模糊的！</font><font style="vertical-align: inherit;">数学上简单的基本效果，也应该易于实现并将其集成到项目中。</font><font style="vertical-align: inherit;">即使我们对着色器一无所知。</font><font style="vertical-align: inherit;">接下来，进入Internet，搜索迅速显示出存在用于效果的现成着色器的源代码，甚至是不同的源代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于第一个实现，采用了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此着色器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要对其进行测试，只需将着色器作为源文件添加到项目中，将其与材质关联，将材质绑定到Image。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二部分-用户界面</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果我们关心应用程序的用户，则必须对用户界面给予应有的关注。如果仅在背景上添加模糊效果，而忽略它，那么这并不完全符合创建产品的内部原理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，为了采取进一步的措施，您需要触摸发生的事情，然后进行思考和调整，以引起对用户的必要感知。这一点是高度上下文相关的。根据图像的对比度，各种颜色和其他因素，可以选择各种值和其他工具。在我们的情况下，在此阶段，模糊半径为25（着色器参数），附加的“透明性”为70％（通过单独的Image在着色器外部）可获得良好的结果。但是，这只是最终的背景图像。根据电话上的感觉，过渡本身太尖锐。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
图像中已安装的着色器是在每一帧上计算的，因此，为了平滑切换，足以动态更改模糊半径参数和透明度。</font><font style="vertical-align: inherit;">您可以用不同的方式来组织它，但是实质上，处理是Update处理程序中的更新，具体取决于时间。</font><font style="vertical-align: inherit;">在应用程序的最终版本中，过渡本身为0.2秒，但事实证明，这对于用户的感知至关重要。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三部分-生产力</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
近几个月来，我听到一些不同用户（甚至不是程序员）的抱怨，游戏程序经常闲置无休地使用所有可用的计算机资源。例如，这可以表示为在程序最小化到托盘的情况下最大化使用视频卡，或者不考虑所有内容和一个处理器线程的恒定负载。这样做的原因很直观-开发人员或发布者的收入不依赖于优化（人们在购买时不会关注此类事情），而普通开发者最有可能更关注本地KPI和延迟需求。但是，实际上，我不想属于这一类。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在下一次启动时完成具有背景模糊效果的上一个阶段后，将手机握在手中一段时间​​后，就会出现温暖的感觉。如果您在菜单上花费更多的时间，那么一切都会变得更加糟糕。而且即使菜单中的用户大概并且很可能没有花费太多时间，我也根本不想丢掉电池。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析表明，</font><font style="vertical-align: inherit;">根据所选半径，</font><font style="vertical-align: inherit;">上面选择的着色器具有渐近复杂度</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O（r </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。换句话说，如果将模糊半径从1增加到25，则每个点的计算数量将变为625倍。在这种情况下，计算发生在每一帧上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解决方案的第一步是，并不是所有着色器都同样有用，并且可以以不同方式实现模糊效果。为此，您可以进行单独的模糊处理，其本质是首先仅对水平线进行模糊处理，然后仅对垂直线进行模糊处理。结果，我们获得</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O（r）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而ceteris paribus的复杂度下降了一个数量级。另一种方法是采用较小的mipmap，它已经进行了一些模糊工作。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">以该着色器</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
为基础</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然而，事实证明其模糊效果不足，并且在图形的高对比度下，图像变得“破裂”。</font><font style="vertical-align: inherit;">为了获得更好的效果，更改了分布（GRABPIXEL元素）。</font><font style="vertical-align: inherit;">如果在着色器中，从0.18到0.05，半径4，在我们的版本中，从0.14到0.03，半径6（有效，但总和应为1）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，处理复杂度降低了1-2个数量级。</font><font style="vertical-align: inherit;">但这并不需要停止。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第四部分-静态背景</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，如果我们将着色器保留在现有图像上，那么它将一直在工作，对每帧进行相同的计算。</font><font style="vertical-align: inherit;">如果后台发生了某些事情，那么我们需要这样做。</font><font style="vertical-align: inherit;">但这是完全可选的，如果背景是静态的。</font><font style="vertical-align: inherit;">因此，在动态模糊之后，您可以记住结果，将其放在背景上并关闭着色器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，让我们尝试代码片段。</font><font style="vertical-align: inherit;">为整个屏幕准备目标纹理可能如下所示：</font></font><br>
<br>
<pre><code class="cs hljs">_width = Screen.width / <span class="hljs-number">2</span>;<font></font>
_height = Screen.height / <span class="hljs-number">2</span>;<font></font>
_texture = <span class="hljs-keyword">new</span> Texture2D(_width, _height);<font></font>
<font></font>
<span class="hljs-keyword">var</span> fillColor = Color.white;
<span class="hljs-keyword">var</span> fillColorArray = _texture.GetPixels();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fillColorArray.Length; ++i)<font></font>
{<font></font>
	fillColorArray[i] = fillColor;<font></font>
}<font></font>
_texture.SetPixels(fillColorArray);<font></font>
_texture.Apply();<font></font>
<font></font>
_from.GetComponent&lt;Image&gt;().sprite = Sprite.Create(_texture, <span class="hljs-keyword">new</span> Rect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, _texture.width, _texture.height), <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即，这里准备的纹理在水平方向和垂直方向上比屏幕小2倍。</font><font style="vertical-align: inherit;">由于我们知道设备的屏幕尺寸是2的倍数，因此几乎可以完成此操作，如果完成，这将减小纹理的尺寸并促进模糊。</font></font><br>
<br>
<pre><code class="cs hljs">RenderTexture temp = RenderTexture.GetTemporary(_width, _height);<font></font>
Graphics.Blit(_from_image.mainTexture, temp, _material);<font></font>
RenderTexture.active = temp;<font></font>
<font></font>
_texture.ReadPixels(<span class="hljs-keyword">new</span> Rect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, temp.width, temp.height), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);<font></font>
_texture.Apply();<font></font>
<font></font>
_to_image.sprite = Sprite.Create(_texture, <span class="hljs-keyword">new</span> Rect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, _texture.width, _texture.height), <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>));<font></font>
RenderTexture.ReleaseTemporary(temp);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要使用着色器（在_material上）使用mainTexture捕获图像，将使用Graphics.Blit。接下来，我们将结果存储在准备好的纹理中，并将其放置在目标图像中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切都会好起来；在实践中，他面对这样的效果，根据设备的不同，背景图像会上下颠倒。经过对问题的研究和调试后，原因很清楚- </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">坐标系之间</font></a><font style="vertical-align: inherit;">的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">差异</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity无法隐藏的Direct3D和OpenGL。同时，我们的着色器会检测并正确处理UV，并且反转已在Unity环境（ReadPixels）中发生。网上有很多提示，例如“如果您颠倒了，请将其翻过来”或“更改紫外线信号”。使用UNITY_UV_STARTS_AT_TOP宏无助于对所有被测设备进行良好的概括。另外，例如，我们遇到过这样的情况：如果您准备在iPhone上使用Xcode进行仿真的程序集，而Unity不使用Metal，而仅使用OpenGLES，则您需要拦截诸如在其他软件上运行的设备的仿真之类的情况。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在尝试了多种选择之后，我选择了两种平板电脑。第一个是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制相机渲染</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在图像捕获时设置forceIntoRenderTexture）。</font><font style="vertical-align: inherit;">第二个是通过SystemInfo.graphicsDeviceType即时确定图形系统的类型，这使得可以定义类OpenGL或类Direct3D（第一个组是OpenGLES2，OpenGLES3，OpenGLCore和Vulkan）。</font><font style="vertical-align: inherit;">此外，在类似Direct3D的实现中，我们需要进行翻页，该翻页是按程序进行的（例如，像</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我希望本文对克服未知的问题，改善用户生活和了解Unity的人有用。</font><font style="vertical-align: inherit;">如果您看一下战斗中的效果，那么在Unity中，它看起来像</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在应用程序中，感觉有些不同，但是此动画可以给出足够的想法。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN493442/index.html">个人防护用品提醒</a></li>
<li><a href="../zh-CN493444/index.html">项目“玻璃”。能源效率一次性茶/咖啡杯</a></li>
<li><a href="../zh-CN493446/index.html">周末阅读：10个不寻常的声音故事-从间谍游戏和阴谋论到轻松的ASMR</a></li>
<li><a href="../zh-CN493448/index.html">春季-有效的路由</a></li>
<li><a href="../zh-CN493450/index.html">新手投资者如何合法减税：4种工作方法</a></li>
<li><a href="../zh-CN493458/index.html">免费释放您的Android-Alaverdi</a></li>
<li><a href="../zh-CN493462/index.html">超声波浴。第2部分</a></li>
<li><a href="../zh-CN493468/index.html">不要害怕深呼吸</a></li>
<li><a href="../zh-CN493470/index.html">科学家在海王星外发现新的小行星</a></li>
<li><a href="../zh-CN493478/index.html">砍箱子-演练森林。AS-REP烘焙，DCSync和哈希传递攻击</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>