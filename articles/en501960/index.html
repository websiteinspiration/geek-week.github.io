<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèº üôà üîû Search scaling. Elasticsearch Its advantages and basic requirements for installation üôçüèª üíâ üë®‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon. My name is Roman Larchikov, I am a technical support engineer at Docsvision. This article has been prepared for those who are interest...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Search scaling. Elasticsearch Its advantages and basic requirements for installation</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501960/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good afternoon. </font><font style="vertical-align: inherit;">My name is Roman Larchikov, I am a technical support engineer at Docsvision. </font><font style="vertical-align: inherit;">This article has been prepared for those who are interested in the technical details of the implementation of search scaling and familiarity with the work of Elasticsearch. </font><font style="vertical-align: inherit;">The article will talk about the reasons for using ES, system requirements, as well as the advantages over search from MS SQL Server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are interested in more general terms to learn about how we scaled the search in the latest version of our platform, my colleagues told about this at the webinar ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docsvision ECM. </font><font style="vertical-align: inherit;">Search Scaling ElasticSearch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . "</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why Elasticsearch?</font></font></h2><br>
<img src="https://habrastorage.org/webt/za/8e/mz/za8emzrrpk-rdpv_7ttstrtfcb0.png" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To begin with, it is worth noting that the version of the Docsvision 5.5 platform is fundamentally different from the previous ones in its modular architecture. In this regard, we needed to ensure the possibility of almost unlimited scaling of the system while maintaining the speed of work. In particular, it was required to be able to scale the indexing service even at a high speed of its operation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this regard, the version of Docsvision 5.5 introduced the possibility of using external (satellite) databases. Now there is no need to store all the data in one database, which, with intensive work, grows daily in volumes, which complicates the process of servicing the database, the speed of its recovery during crashes and slows down the overall operation of the database itself.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/mk/o8/8omko8dl8c4d2h71pc-hq4qynvq.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using one database for everything is bad. The ability to transfer data to separate external databases implemented in Docsvision 5.5 allows you to correctly restructure the database. Thus, if we talk about search, indexing data can be stored already outside the main database, eliminating the effect on its size. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ease of customization, flexibility, reliability, scalability, speed of indexing and searching online are all about Elasticsearch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elasticsearch is very document-oriented. After indexing, we can search, sort, filter data, rather than rows of data in columns. Which, in turn, demonstrates a different approach to data retrieval, and indicates that Elasticsearch can perform complex full-text searches.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Documents are represented as JSON objects. </font><font style="vertical-align: inherit;">At the same time, serialization (the process of translating any data structure into a sequence of bits) JSON is supported by most programming languages ‚Äã‚Äãand is already the standard format for NoSQL.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Introducing Elasticsearch</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">What it is?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elasticsearch is an open source scalable full-text search engine using the Lucene library and written in Java. Description of all the advantages of this engine is available on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">official website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is intended for complex searches in the database of documents / files. In the Elasticsearch database, tables are called indexes, and the process of loading documents is called indexing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It can be considered both a non-relational repository of documents in JSON format and a search engine based on Lucene full-text search. Official clients are available in Java, NET (C #), Python, Groovy, JavaScript, PHP, Perl, Ruby. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ES is being developed by Elastic, along with related projects called Elastic Stack - Elasticsearch, Logstash, Beats, and Kibana.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elasticsearch is responsible for storing and searching data (hereinafter, for brevity, we will call it ES).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2. </font><font style="vertical-align: inherit;">Advantages of the Elasticsearch Search Engine Compared to the MS SQL Search Engine</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Docsvision 5.5 has a choice of which search engine to work with. </font><font style="vertical-align: inherit;">In this article I will focus on the use of the Elasticsearch search engine and talk about its advantages over search from MS SQL Server. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Main advantages:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ability of the indexing service to access external data stores. </font><font style="vertical-align: inherit;">At the same time, the data is correctly indexed and correctly displayed during the search. </font><font style="vertical-align: inherit;">When using the SQL Server search engine, it was possible to search only by the data stored in the main database.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ES is an open source project, and many global companies use it to search huge data sets.</font></font></li>
<li>ES    ,      ,     .</li>
<li>       ().    ES,   SQL Server    .</li>
<li>ES   ‚Äî   ,       .</li>
<li>ES      (, , ),    .</li>
<li>  ,  ,  ,    .</li>
<li>   ES        .            .</li>
<li> .    ,     ,  , ,   ,   .</li>
<li>    ,   , , ,    .</li>
<li>ES   (  ).    Docsvision,  ES  ,    SQL .</li>
<li>   ‚Äî     SQL.      ,       ,      ,    .             , ..   ,    .  ,         , ..        .   ES    .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The database does not increase in size when adding languages. </font><font style="vertical-align: inherit;">Unlike ES, when using full-text search in MS SQL, indexed data increases the size of the main database, especially if indexing is configured in different languages, for example, Russian / neutral / English. </font><font style="vertical-align: inherit;">In this case, the growth of indexing tables increases several times already, if only one language for indexing would be chosen, for example, neutral.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Required software and system requirements for installing Elasticsearch</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ES can be deployed not only on high-performance servers, but also on a laptop. </font><font style="vertical-align: inherit;">But if we are talking about a productive environment, then you should use a separate server and adhere to some recommendations that are worth considering.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1. </font><font style="vertical-align: inherit;">RAM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most critical resource for ES is RAM. </font><font style="vertical-align: inherit;">This is the primary resource that will most likely end first. </font><font style="vertical-align: inherit;">The minimum allowable size is 8Gb, the recommended one is from 16 to 64 Gb. </font><font style="vertical-align: inherit;">More is allowed if there really is a need. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pj/uw/gp/pjuwgp8bjv7idpvboyyiyfbhmnu.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sorting and aggregation can consume a large amount of memory, so it is important to have a sufficient supply of it. </font><font style="vertical-align: inherit;">A machine with 64 GB of RAM is an ideal solution, but machines with 32 GB and 16 GB are also common. </font><font style="vertical-align: inherit;">If 8 GB or less is installed on the machine, this may lead to the opposite results (in the end, you may need several such "small" machines). </font><font style="vertical-align: inherit;">Using more than 64 GB also has its own characteristics.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2. </font><font style="vertical-align: inherit;">CPU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ES, as a rule, does not have much processor requirements, so its choice is less important than other resources. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jd/w0/c6/jdw0c6fd1mntgbthosgws0kwgwo.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But you should adhere to the rule. </font><font style="vertical-align: inherit;">You should choose a modern processor with several cores. </font><font style="vertical-align: inherit;">Typically, servers in a cluster use two to eight-core machines. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you have a choice between faster processors or processors with multiple cores, you should choose the latter. </font><font style="vertical-align: inherit;">The additional parallelism offered by several cores will give a greater result than a slightly higher clock frequency.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3. </font><font style="vertical-align: inherit;">Disk</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The disc is also an important resource for the quick operation of ES. It is important when using a cluster and is doubly important for clusters with large volumes of indexed data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Disks are the slowest subsystem on the server, which means that clusters with intensive recording can put a high load on the disks, which, in turn, becomes the bottleneck of the server. If it is possible to use solid-state drives, then it is necessary to use them, because they are far superior to any rotating media. Hosts with SSD support have a noticeable increase in both query and indexing performance. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/sb/pb/cgsbpbni5kahncdruxpl80nqg3u.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you intend to use hard disks (HDD), then it is advisable to use high-performance server disks (disks with a spindle speed of 15,000 rpm).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using RAID 0 is an effective way to increase disk speed for both spinning disks and SSDs. </font><font style="vertical-align: inherit;">There is no need to use RAID options with mirroring or parity, as high availability is built into ES through replicas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4. </font><font style="vertical-align: inherit;">I / O Scheduler</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are using solid state drives, you should make sure that the I / O scheduler of the operating system is configured correctly. When data is being written to disk, the I / O scheduler decides when that data is actually sent to disk. In most cases, the default cfq scheduler is used (a completely honest queue). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This scheduler allocates time slots for each process and then optimizes the delivery of these various queues to disk. It is optimized for working with HDD: the nature of the rotating plates means that it is more efficient to write data to disk depending on the physical location.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, this is ineffective for solid state drives, because they do not use rotating plates. </font><font style="vertical-align: inherit;">Instead, use a deadline or noop. </font><font style="vertical-align: inherit;">The deadline scheduler optimizes depending on how long the recording has been waiting, while noop is just a simple FIFO queue. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These simple changes can significantly improve write throughput with the right scheduler.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5. </font><font style="vertical-align: inherit;">Network</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fast and reliable network is important for performance in a distributed system. </font><font style="vertical-align: inherit;">Low latency ensures that nodes can easily exchange data, and high throughput helps move and recover data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modern data center networks (1 GbE, 10 GbE) are sufficient for the vast majority of clusters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clusters that span multiple data centers should be avoided, even if the data centers are located in close proximity. </font><font style="vertical-align: inherit;">Definitely avoid clusters that span large geographic distances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ES clusters assume that all nodes are equal. </font><font style="vertical-align: inherit;">Long delays tend to exacerbate problems in distributed systems and make debugging and resolution difficult.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.6. </font><font style="vertical-align: inherit;">General recommendations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is worth giving preference to ‚Äúmedium‚Äù and ‚Äúlarge‚Äù machines, avoiding low-performance machines in order to eliminate the costs of simply starting ES. </font><font style="vertical-align: inherit;">At the same time, truly huge machines should be avoided: they often lead to an unbalanced use of resources (for example, all memory is used, but not the central processor) and can add logistical complexity if it is necessary to run several nodes on the machine.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we figure out what Elasticsearch is, its key advantages and installation requirements, we can proceed with the ES installation itself for further configuration in Docsvision. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About how to install it and perform configuration, as well as check indexing, i.e. </font><font style="vertical-align: inherit;">working capacity in Docsvision, read my colleague's publication </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interesting topic? </font><font style="vertical-align: inherit;">Then you can use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and find out even more! </font><font style="vertical-align: inherit;">And </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> you can register for courses.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501940/index.html">A bit about Neutralino.js</a></li>
<li><a href="../en501942/index.html">Kanban Method: Understanding Your Process as a Collective Learning Process</a></li>
<li><a href="../en501948/index.html">How a train travels from station to station: routing features</a></li>
<li><a href="../en501954/index.html">Whether VR awaits Microsoft Kinect or is it the future of gaming - let's talk together</a></li>
<li><a href="../en501956/index.html">Our experience working with data in etcd Kubernetes-cluster directly (without K8s API)</a></li>
<li><a href="../en501964/index.html">What are industrial computers for?</a></li>
<li><a href="../en501968/index.html">MVI Architectural Template in Kotlin Multiplatform, Part 1</a></li>
<li><a href="../en501970/index.html">What do you need to create a good dungeon in RPG?</a></li>
<li><a href="../en501976/index.html">How to learn to test software</a></li>
<li><a href="../en501978/index.html">How does the Prometheus histogram work?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>