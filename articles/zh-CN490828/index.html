<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤵🏾 ✉️ 🎩 从头开始在Unity中创建类rogue 👨🏼‍🔬 🎨 ✋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="关于在Unity中创建“ roguelike”的教程并不多，所以我决定编写它。不是吹牛，而是与那些我已经相当一段时间的人分享知识。
 
 注意：我并不是说这是在Unity中创建“ roguelike” 的唯一方法。他只是其中之一。我通过反复试验中学到了可能不是最好和最有效的方法。我将在创建教程的过程...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>从头开始在Unity中创建类rogue</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490828/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/093/6ab/ad40936ab0dff25fd3214571faf9aa61.png" alt="图片"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于在Unity中创建“ roguelike”的教程并不多，所以我决定编写它。不是吹牛，而是与那些我已经相当一段时间的人分享知识。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意：我并不是说这是</font><font style="vertical-align: inherit;">在Unity中创建“ roguelike” </font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。他只是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中之一</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我通过反复试验中学到了可能不是最好和最有效的方法。我将在创建教程的过程中正确学习一些东西。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
假设您</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至少了解Unity的基础知识</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，例如，如何创建预制件或脚本等。</font><font style="vertical-align: inherit;">不要指望我教您如何创建Sprite工作表，有很多很棒的教程。</font><font style="vertical-align: inherit;">我将不专注于研究引擎，而是专注于如何实现我们将共同创造的游戏。</font><font style="vertical-align: inherit;">如果遇到困难，请访问Discord的一个很棒的社区并寻求帮助：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity开发人员社区</font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roguelikes</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
所以，让我们开始吧！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段0-规划</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
恩，那就对了。首先要制定一个计划。规划您的游戏对我来说很有益，对我而言-规划本教程也将是一件好事，这样一会儿我们就不会分散话题的注意力。就像在流氓地下城中一样，很容易在游戏的功能上感到困惑。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将写roguelike。我们将主要遵循Cogmind开发商乔希戈明智的建议</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。单击链接，阅读文章或观看视频，然后再回来。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本教程的目的是什么？获得扎实简单的基本roguelike，然后您就可以尝试使用。它应该具有地牢生成，在地图上移动的玩家，可见性迷雾，敌人和物体。只有最必要的。因此，玩家应该能够走下几层楼。比方说，增加五分，提高水平，最后与老板搏斗并击败他。或者死。实际上，仅此而已。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遵循Josh Ge的建议，我们将构建游戏功能，以便它们将我们引向目标。</font><font style="vertical-align: inherit;">因此，我们得到了roguelike框架，可以进一步扩展该框架，添加您自己的芯片，从而创造出独特性。</font><font style="vertical-align: inherit;">或将所有东西扔进篮子，利用获得的经验并从头开始。</font><font style="vertical-align: inherit;">无论如何都会很棒。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不会给您任何图形资源。</font><font style="vertical-align: inherit;">自己绘制它们，或使用免费的tileset，可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或通过Google搜索</font><font style="vertical-align: inherit;">来下载它们</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">只是别忘了提及游戏中图形的作者。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，让我们按照实现的顺序列出所有与我们类似的功能：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地牢地图生成</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">玩家角色及其动作</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可见区域</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敌人</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寻找方法</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">战斗，健康与死亡</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">玩家等级提升</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物品（武器和药水）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制台作弊（用于测试）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地牢地板</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存和加载</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终老板</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实施所有这些步骤后，我们将具有强大的流氓风格，您将大大提高自己的游戏开发技能。</font><font style="vertical-align: inherit;">实际上，这是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提高技能的方法：创建代码和实现功能。</font><font style="vertical-align: inherit;">因此，我相信您也可以处理。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段1-MapManager类</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是我们将创建的第一个脚本，它将成为我们游戏的支柱。</font><font style="vertical-align: inherit;">它很简单，但是包含游戏的大部分重要信息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，创建一个名为MapManager的.cs脚本并打开它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
删除“：MonoBehaviour”，因为它不会继承它，也不会附加到任何GameObject。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
删除开始（）和更新（）函数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在MapManager类的末尾，创建一个名为Tile的新公共类。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/431/54e/4c2/43154e4c2708a580bc3838b1fbee573b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tile类将包含单个图块的所有信息。</font><font style="vertical-align: inherit;">到目前为止，我们不需要太多，只需要x和y位置以及位于地图此位置的游戏对象即可。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/405/21e/cd9/40521ecd9e1292e813391181e523b6dc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们有基本的图块信息。</font><font style="vertical-align: inherit;">让我们从此图块创建一个地图。</font><font style="vertical-align: inherit;">很简单，我们只需要一个二维的Tile对象数组。</font><font style="vertical-align: inherit;">听起来很复杂，但是没有什么特别的。</font><font style="vertical-align: inherit;">只需将Tile [，]变量添加到MapManager类中：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f44/2e8/806/f442e88061e77cbbb4c1aa904c73bdfd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
瞧！</font><font style="vertical-align: inherit;">我们有地图！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
是的，它是空的。</font><font style="vertical-align: inherit;">但这是一张地图。</font><font style="vertical-align: inherit;">每当地图上某物移动或更改状态时，此地图上的信息就会更新。</font><font style="vertical-align: inherit;">也就是说，例如，如果玩家尝试切换到新的图块，则班级将检查地图上的目标图块地址，敌人的存在及其通畅程度。</font><font style="vertical-align: inherit;">因此，我们不必每次都检查数千次碰撞，也不需要为每个游戏对象使用对撞机，从而简化并简化了游戏工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
产生的代码如下所示：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MapManager</span> <font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Tile[,] map; <span class="hljs-comment">// the 2-dimensional map with the information for all the tiles</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Tile</span> { <span class="hljs-comment">//Holds all the information for each tile on the map</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> xPosition; <span class="hljs-comment">// the position on the x axis</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> yPosition; <span class="hljs-comment">// the position on the y axis</span>
    <span class="hljs-keyword">public</span> GameObject baseObject; <span class="hljs-comment">// the map game object attached to that position: a floor, a wall, etc.</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第一阶段完成了，让我们继续填写卡片。</font><font style="vertical-align: inherit;">现在我们将开始创建地牢生成器。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2阶段-关于数据结构的几句话</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，在开始之前，让我分享由于第一部分发表后收到的反馈而产生的提示。在创建数据结构时，您需要从一开始就考虑如何保持游戏状态。否则，以后将更加混乱。 Star Shaped Bagel的开发商Discord st33d的用户（您可以</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免费玩此游戏</font><font style="vertical-align: inherit;">）说，起初他创建了游戏，认为它根本不会保存状态。渐渐地，游戏开始变得更大，她的粉丝要求支持已保存的地图。但是由于选择了创建数据结构的方法，因此很难保存数据，因此他无法做到这一点。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82c/b02/858/82cb02858af686ef409ad8a6c0496135.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们确实从错误中学习。尽管我将“保存/加载”部分放在了本教程的最后，但我从一开始就对它们进行了思考，但还没有对其进行解释。在这一部分中，我将对它们进行一些讨论，但以免使经验不足的开发人员超载。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将这些内容保存为存储地图的Tile类的变量数组。除了GameObject类的变量（位于Tile类中）之外，我们将保存所有这些数据。为什么？仅仅因为GameObjects无法通过Unity序列化到存储的数据。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，实际上，我们不需要保存存储在GameObjects内部的数据。所有数据都将存储在诸如Tile之类的类中，然后还会存储在Player，Enemy等类中。然后，我们将具有GameObjects来简化可见性和移动以及在屏幕上绘制精灵之类的事情的计算。因此，在类中将有GameObject变量，但是这些变量的值将不会保存和加载。加载时，我们将强制从保存的数据（位置，子画面等）再次生成GameObject。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
那我们现在需要做什么？好吧，只需在现有的Tile类中添加两行，并在脚本顶部添加一行。首先，我们添加“使用系统”；脚本标题，然后是[Serializable]在整个类的前面，然后是[NonSerialized]在GameObject变量的前面。像这样：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfd/931/aa3/bfd931aa3a4a1b2b7792650cc25cba07.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2e/178/9d3/a2e1789d3663b1530d64d3d900c7f047.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当我们进入有关保存/加载的教程部分时，我将告诉您更多有关此的信息。</font><font style="vertical-align: inherit;">现在，让我们继续前进。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3阶段-有关数据结构的更多信息</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想在这里分享有关数据结构的另一篇评论。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，有很多方法可以在游戏中实现数据。我使用的第一个，将在本教程中实现：所有切片数据都在Tile类中，并且所有它们都存储在一个数组中。这种方法有很多优点：易于阅读，所需的一切都集中在一个地方，数据更易于操作并导出到保存文件。但是从内存的角度来看，它并不是那么有效。您将不得不为游戏中永远不会使用的变量分配大量内存。例如，稍后我们将Enemy GameObject变量放在Tile类中，以便我们可以直接从地图指向站立在此tile上的敌人的GameObject，以简化与战斗有关的所有计算。但这意味着游戏中的每个图块都将为GameObject变量在内存中分配空间，即使在这个方块上没有敌人如果在2500个图块的地图上有10个敌人，那么将有2490个空的，但是分配了GameObject变量-您可以看到浪费了多少内存。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一种替代方法是使用结构存储图块的基本数据（例如，位置和类型），并将所有其他数据存储在hashmap-s中，仅在必要时才会生成。</font><font style="vertical-align: inherit;">这样可以节省大量内存，但是投资回报会稍微复杂一些。</font><font style="vertical-align: inherit;">实际上，它会比我在本教程中想要的要先进一些，但是如果您愿意，将来我可以写一篇更详细的文章。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另外，如果您想阅读有关此主题的讨论，则可以</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Reddit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上完成</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段4-地牢生成算法</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
是的，这是我要讨论的另一部分，我们将不会开始编写任何程序。但这很重要，仔细规划算法将为我们节省大量的工作时间。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有几种创建地牢生成器的方法。我们将共同实施的方法并不是最好的，也不是最有效的……这只是一种简单的初始方法。这很简单，但是效果会很好。主要问题将是许多死胡同的走廊。以后，如果您愿意，我可以发布另一本有关更好算法的教程。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般来说，我们使用的算法的工作原理如下：假设我们有一个充满零值的完整地图-一个由石头组成的水平。</font><font style="vertical-align: inherit;">一开始，我们在中心剪了一个房间。</font><font style="vertical-align: inherit;">从这个房间我们沿着一个方向突破走廊，然后添加其他走廊和房间，这些走廊和房间总是从现有房间或走廊中随机开始，直到达到一开始就给定的最大走廊/房间数量。</font><font style="vertical-align: inherit;">或直到算法可以找到新的位置来添加新的房间/走廊，以先到者为准。</font><font style="vertical-align: inherit;">这样我们就得到了一个地牢。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，让我们以一种更类似于算法的方式逐步描述它。</font><font style="vertical-align: inherit;">为了方便起见，我将地图的每个细节（走廊或房间）称为元素，这样我就不必每次都说“房间/走廊”。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在地图中心剪裁房间</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机选择其中一面墙</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们穿过这堵墙的走廊</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机选择现有元素之一。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机选择此元素的墙之一</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果最后选择的项目是房间，则我们生成一条走廊。</font><font style="vertical-align: inherit;">如果是走廊，则随机选择下一个元素是房间还是另一个走廊</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查所选方向上是否有足够的空间来创建所需的项目</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果存在，请创建一个元素，否则请返回到步骤4</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从第4步开始重复</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就这样。</font><font style="vertical-align: inherit;">我们将获得一张简单的地牢地图，其中只有房间和走廊，没有门和特殊元素，但这将是我们的开始。</font><font style="vertical-align: inherit;">稍后，我们将用箱子，敌人和陷阱将其装满。</font><font style="vertical-align: inherit;">您甚至可以对其进行自定义：我们将学习如何添加所需的有趣元素。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段5-剪裁房间</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后进行编码！</font><font style="vertical-align: inherit;">让我们切开我们的第一个房间。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，创建一个新脚本并将其命名为DungeonGenerator。</font><font style="vertical-align: inherit;">它将从Monobehaviour继承，因此您稍后需要将其附加到GameObject。</font><font style="vertical-align: inherit;">然后，我们将需要在类中声明几个公共变量，以便我们可以从检查器设置地牢的参数。</font><font style="vertical-align: inherit;">这些变量将是地图的宽度和高度，房间的最小和最大高度和宽度，走廊的最大长度以及应该在地图上的元素数量。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/120/331/04d/12033104d1f3fcf270fdc5fd64ffb6bb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们需要初始化地牢生成器。我们这样做是为了初始化将由世代填充的变量。目前，这只是一张地图。并且，还要删除Unity为新脚本生成的Start（）和Update（）函数，我们将不需要它们。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f92/a8f/e5d/f92a8fe5dc2ea241284fe95b8758c289.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad7/841/44b/ad784144b6aeea6aee3967caedaa37eb.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们初始化了MapManager类的地图变量（我们在上一步中创建），传递了地图的宽度和高度，由上面的变量定义为数组的二维尺寸的参数。因此，我们将获得水平x大小（宽度）和垂直y大小（高度）的地图，并且可以通过输入MapManager.map [x，y]访问地图中的任何单元格。当操纵对象的位置时，这将非常有用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们将创建一个渲染第一个房间的函数。我们将其称为FirstRoom（）。我们将InitializeDungeon（）设置为公共功能，因为它将由另一个脚本（我们将很快创建的Game Manager；它将对整个游戏启动过程进行集中管理）启动。我们不需要任何外部脚本即可访问FirstRoom（），因此我们不会将其公开。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，继续，我们将在MapManager脚本中创建三个新类，以便您可以创建一个房间。这些是Feature，Wall和Position类。 Position类将包含x和y位置，以便我们可以跟踪所有内容。墙壁将具有位置列表，相对于房间中心（北，南，东或西）“看”的方向，长度以及从中创建的新元素的存在。元素将具有其所包含的所有位置，元素的类型（房间或走廊），Wall变量数组以及其宽度和高度的列表。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b7/abe/924/3b7abe9241bb1442f3224048384263ff.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/938/8bc/8d7/9388bc8d7dd523b45013fa80d918d8a2.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在让我们进入FirstRoom（）函数。</font><font style="vertical-align: inherit;">让我们回到DungeonGenerator脚本并在InitializeDungeon下面创建一个函数。</font><font style="vertical-align: inherit;">她将不需要接收任何参数，因此我们将其简化为（）。</font><font style="vertical-align: inherit;">接下来，在函数内部，我们首先需要创建并初始化Room变量及其Position列表。</font><font style="vertical-align: inherit;">我们这样做：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/164/b81/b5d/164b81b5dde06f8e996e22a75bf0b947.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在让我们设置房间的大小。</font><font style="vertical-align: inherit;">它将收到脚本开头声明的最小和最大高度和宽度之间的随机值。</font><font style="vertical-align: inherit;">当它们为空时，因为我们没有在检查器中为它们设置值，但是不用担心，我们会尽快完成。</font><font style="vertical-align: inherit;">我们像这样设置随机值：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d77/bbd/389/d77bbd3896dc4c60d93a9e6b1c006729.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们需要声明房间的起点将位于何处，即房间0.0的点将在地图网格中位于何处。我们要使其开始于地图的中心（一半宽度和一半高度），但可能不</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于地图中心。可能需要添加一个小的随机器，使其稍微向左和向下移动。因此，我们将xStartingPoint设置为地图宽度的一半，并将yStartingPoint设置为地图高度的一半，然后采用刚给定的roomWidth和roomHeight，我们从0到此宽度/高度的随机值，然后从初始x和y中减去它。像这样：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50f/3f2/f0e/50f3f2f0ecb267d5283dcd4684019708.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8eb/0e7/f2b/8eb0e7f2bff7d3d08b1b0691885e89cd.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，在相同的功能中，我们将添加墙壁。我们需要初始化新创建的room变​​量中的墙数组，然后初始化该数组中的每个wall变量。然后初始化每个位置列表，将墙的长度设置为0，然后输入每个墙“看”的方向。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数组初始化之后，我们在for（）循环中循环数组的每个元素，初始化每个墙的变量，然后使用开关命名每个墙的方向。它是任意选择的，我们只需要记住它们的含义即可。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3a/f8f/9da/d3af8f9da1ee8f317452d52f9f905536.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们将在放置壁后立即执行两个嵌套的for循环。</font><font style="vertical-align: inherit;">在外循环中，我们在房间中遍历所有y值，在嵌套循环中遍历所有x值。</font><font style="vertical-align: inherit;">这样，我们将检查y行中的每个单元x，以便我们可以实现它。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ee/cb3/695/3eecb3695c59d199fb32064501ce1009.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后要做的第一件事是从房间位置中找到地图比例尺上单元格位置的实际值。</font><font style="vertical-align: inherit;">这很简单：我们有起点x和y。</font><font style="vertical-align: inherit;">它们在房间网格中的位置为0,0。</font><font style="vertical-align: inherit;">然后，如果我们需要从任何局部x，y获取x，y的实际值，则我们将局部x和y与初始位置x和y相加。</font><font style="vertical-align: inherit;">然后我们将这些真实的x，y值保存到Position变量中（来自先前创建的类），然后将它们添加到房间位置的List &lt;&gt;中。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b2/cc4/4a0/0b2cc44a0ae9953a3d49ac0b3c01a6c9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下一步是将此信息添加到地图。</font><font style="vertical-align: inherit;">更改值之前，请记住初始化Tile变量。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1aa/fe5/a43/1aafe5a43a8c30f2c343472ad7f157ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们将更改Tile类。</font><font style="vertical-align: inherit;">让我们转到MapManager脚本，然后在Tile类的定义中添加一行：“ public string type;”。</font><font style="vertical-align: inherit;">这将允许我们通过声明x，y中的图块是墙，地板或其他东西来添加图块类。</font><font style="vertical-align: inherit;">接下来，让我们回到完成工作的周期，并添加一个大型的if-else构造，这不仅使我们能够确定每个墙，墙的长度和在该墙中的所有位置，而且还可以在全局地图上指定特定的图块-墙或性别。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c3/276/28c/7c327628cea73dafe9319a01ac10b72b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且我们已经做了一些事情。如果变量y（外部循环中变量的控制）为0，则图块属于房间中最低的单元格行，即它是南墙。如果x（内部循环变量的控件）为0，则图块属于单元格的最左列，即它是西墙。如果它在最上面，则它属于北墙，而在最右边-东墙。我们从变量roomWidth和roomHeight中减去1，因为这些值是从1开始计算的，而循环的x和y变量是从0开始的，所以我们需要考虑这一差异。所有不符合条件的单元都不是墙，也就是说，它们是地板。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/258/4a6/2c9/2584a62c91fc46205f903cb4283bd1ce.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
太好了，我们几乎已经完成了第一个房间。</font><font style="vertical-align: inherit;">几乎准备就绪，我们只需要将最后的值放入我们创建的变量Feature中即可。</font><font style="vertical-align: inherit;">我们退出循环并结束函数，如下所示：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bd/aaf/a47/2bdaafa47adb2694f360eea850341920.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
精细！</font><font style="vertical-align: inherit;">我们有一个房间！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是我们如何理解一切正常呢？</font><font style="vertical-align: inherit;">需要测试。</font><font style="vertical-align: inherit;">但是如何测试？</font><font style="vertical-align: inherit;">我们可以为此花费时间并添加资产，但这将浪费时间，并且也使我们无法完成算法。</font><font style="vertical-align: inherit;">嗯，但这可以使用ASCII来完成！</font><font style="vertical-align: inherit;">是的，好主意！</font><font style="vertical-align: inherit;">ASCII是一种绘制地图的简单且低成本的方法，因此可以对其进行测试。</font><font style="vertical-align: inherit;">另外，如果您愿意，也可以跳过带有精灵和视觉效果的部分，稍后我们将进行研究，并使用ASCII创建整个游戏。</font><font style="vertical-align: inherit;">因此，让我们看看这是如何完成的。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段6-绘制第一个房间</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实施ASCII卡时首先要考虑的是选择哪种字体。选择ASCII字体时要考虑的主要因素是它是成比例的（可变宽度）还是等宽的（固定宽度）。我们需要等宽字体，以便卡片根据需要显示（请参见下面的示例）。默认情况下，任何新的Unity项目都使用Arial字体，并且它不是等宽的，因此我们需要找到另一个字体。 Windows 10通常具有等距字体的Courier New，Consolas和Lucida Console。从这三个中选择一个，或在所需的位置下载其他任何文件，并将其放置在项目的Assets文件夹内的Fonts文件夹中。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff4/beb/f23/ff4bebf23a4523f4dd348524ac6b0a9f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们为ASCII输出准备场景。对于初学者，请将场景主摄像机的背景色设为黑色。然后，我们将Canvas对象添加到场景中，并将Text对象添加到场景中。将“文本”矩形的变换设置为中间居中并设置为0,0,0。设置Text对象，使其使用您选择的字体和白色，水平和垂直溢出（水平/垂直溢出），选择Overflow，并使垂直和水平对齐居中。然后将Text对象重命名为“ ASCIITest”或类似名称。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在回到代码。在DungeonGenerator脚本中，创建一个名为DrawMap的新函数。我们希望她得到一个参数来告诉要生成的卡-ASCII或精灵，因此创建一个布尔参数并将其称为isASCII。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/387/67a/957/38767a9575270115821d6be36ce97293.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，我们将检查渲染的地图是否为ASCII。</font><font style="vertical-align: inherit;">如果是（现在，我们将仅考虑这种情况），那么我们将在场景中搜索文本对象，将为其提供的名称作为参数传递，并获取其Text组件。</font><font style="vertical-align: inherit;">但是首先，我们需要告诉Unity我们要使用UI。</font><font style="vertical-align: inherit;">使用UnityEngine.UI将行添加到脚本头中：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17c/e18/c24/17ce18c24ec7c286b4390159dc98dab1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
精细。</font><font style="vertical-align: inherit;">现在我们可以获取对象的Text组件。</font><font style="vertical-align: inherit;">地图将是一条巨大的线，它将以文本形式反映在屏幕上。</font><font style="vertical-align: inherit;">这就是为什么它如此容易设置的原因。</font><font style="vertical-align: inherit;">因此，让我们创建一个字符串，并使用值“”对其进行初始化。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d2/7f2/92c/6d27f292c1f519a7b351d7b8d80a8f84.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
精细。因此，每次调用DrawMap时，我们都需要告知卡是否为ASCII。如果是这样（并且我们将始终以这种方式使用它，我们将在以后与其他方法一起使用），则该函数将搜索场景层次以搜索名为“ ASCIITest”的游戏对象。如果是的话，它将接收其Text组件并将其保存到screen变量，然后我们可以在其中轻松编写地图。然后，它创建一个字符串，其值最初为空。我们将用标记有符号的地图填充此行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，我们会从0开始一直到地图长度的末尾循环遍历地图。</font><font style="vertical-align: inherit;">但是要填充这一行，我们从文本的第一行开始，即最顶层。</font><font style="vertical-align: inherit;">因此，在y轴上，我们需要沿相反的方向在循环中移动，即从数组的末端到起点。</font><font style="vertical-align: inherit;">但是数组的x轴与文本一样从左到右，所以这适合我们。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/536/019/f47/536019f479ea1af260d551f342ed46aa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此循环中，我们检查地图的每个单元以找出其中的内容。</font><font style="vertical-align: inherit;">到目前为止，我们仅将单元格初始化为一个新的Tile（），我们将其剪切为整个房间，因此其他所有人在尝试访问时都会返回错误。</font><font style="vertical-align: inherit;">因此，首先我们需要检查</font><font style="vertical-align: inherit;">此单元格中是否</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何东西，然后通过检查该单元格是否为null来进行此操作。</font><font style="vertical-align: inherit;">如果不为null，则继续工作，但是如果为null，则内部没有任何内容，因此我们可以在地图上添加空白区域。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f3/f56/5d9/3f3f565d9e9f7886c3baa600cd1ab99f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，对于每个非空单元格，我们检查其类型，然后添加相应的符号。</font><font style="vertical-align: inherit;">我们希望墙壁用符号“＃”表示，地板用符号“。”表示。</font><font style="vertical-align: inherit;">虽然我们只有这两种类型。</font><font style="vertical-align: inherit;">后来，当我们添加玩家，怪物和陷阱时，一切都会变得更加复杂。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9f/a24/ef0/f9fa24ef002860f5331479f9ac07a6e8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另外，我们需要在到达数组行的末尾时执行换行符，以便具有相同x位置的单元格彼此直接位于下方。</font><font style="vertical-align: inherit;">我们将在循环的每次迭代中检查单元格是否为行中的最后一个单元格，然后添加带有特殊字符“ \ n”的换行符。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c14/7b8/1eb/c147b81eb1f4efa01bafdfa8a4aa092d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就这样。</font><font style="vertical-align: inherit;">然后我们退出循环，以便可以在完成后将这一行添加到场景中的文本对象。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20f/8bb/f4d/20f8bbf4d1c8e5b59afc3163a97d57bb.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcb/83f/a7f/fcb83fa7f923ec53e33696bb8962a1d9.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
恭喜你！您已经完成了创建房间并将其显示在屏幕上的脚本。现在，我们只需要执行这些操作即可。我们不使用DungeonGenerator脚本中的Start（），因为我们希望有一个单独的脚本来控制游戏开始时执行的所有操作，包括生成地图，以及设置玩家，敌人等。因此，该其他脚本将包含Start（）函数，并且，如有必要，将调用我们脚本的函数。 DungeonGenerator脚本具有一个Initialize函数，该函数是公共的，而FirstRoom和DrawMap不是公共的。 Initialize只是简单地初始化变量以自定义地牢生成过程，因此我们需要另一个函数来调用生成过程，该函数必须是公共的，以便可以从其他脚本中调用它。现在，她将只调用FirstRoom（）函数，然后调用DrawMap（）函数，并为其传递一个真值，以便绘制ASCII映射。哦，不是，它甚至更好-让我们创建一个公共变量isASCII，可以将其包含在检查器中，然后只需将此变量作为参数传递给函数即可。精细。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c58/288/502/c58288502f107440def4f803d602662b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，现在让我们创建一个GameManager脚本。</font><font style="vertical-align: inherit;">这将是控制游戏所有高级元素的脚本，例如，创建地图和移动过程。</font><font style="vertical-align: inherit;">让我们删除其中的Update（）函数，添加一个名为DungeonGenerator的DungeonGenerator类型的变量，并在Start（）函数中创建此变量的实例。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5b/8da/424/e5b8da4243c91f887c08213b9ec14953.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，我们只需从dungeonGenerator </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依次</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用InitializeDungeon（）和GenerateDungeon（）函数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这很重要-首先您需要初始化变量，然后才开始基于变量进行构建。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/158/7e6/781/1587e6781595d0ee6661aea7898aa6e4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
至此，代码完成。</font><font style="vertical-align: inherit;">我们需要在层次结构面板中创建一个空的游戏对象，将其重命名为GameManager并将GameManager和DungeonGenerator脚本附加到该对象。</font><font style="vertical-align: inherit;">然后在检查器中设置地牢生成器的值。</font><font style="vertical-align: inherit;">您可以为生成器尝试不同的方案，而我决定这样做：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/41f/495/a1141f4953a6fdeac32cc978ac4a0b05.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，只需单击播放并观看魔术！</font><font style="vertical-align: inherit;">您应该在游戏屏幕上看到类似的内容：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/093/6ab/ad40936ab0dff25fd3214571faf9aa61.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
恭喜，我们现在有房间！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想让我们把玩家的角色放在那里，让他移动，但是这个职位已经很长了。</font><font style="vertical-align: inherit;">因此，在下一部分中，我们可以直接进行其余地牢算法的实现，也可以将玩家放置其中并教其如何移动。</font><font style="vertical-align: inherit;">在原始文章的评论中投票给您最喜欢的东西。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MapManager.cs：</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System; <span class="hljs-comment">// So the script can use the serialization commands</span>
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MapManager</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Tile[,] map; <span class="hljs-comment">// the 2-dimensional map with the information for all the tiles</span><font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>] <span class="hljs-comment">// Makes the class serializable so it can be saved out to a file</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Tile</span> { <span class="hljs-comment">// Holds all the information for each tile on the map</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> xPosition; <span class="hljs-comment">// the position on the x axis</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> yPosition; <span class="hljs-comment">// the position on the y axis</span>
    [<span class="hljs-meta">NonSerialized</span>]
    <span class="hljs-keyword">public</span> GameObject baseObject; <span class="hljs-comment">// the map game object attached to that position: a floor, a wall, etc.</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> type; <span class="hljs-comment">// The type of the tile, if it is wall, floor, etc</span><font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Position</span> { <span class="hljs-comment">//A class that saves the position of any cell</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> x;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> y;<font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Wall</span> { <span class="hljs-comment">// A class for saving the wall information, for the dungeon generation algorithm</span>
    <span class="hljs-keyword">public</span> List&lt;Position&gt; positions;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> direction;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> length;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> hasFeature = <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Feature</span> { <span class="hljs-comment">// A class for saving the feature (corridor or room) information, for the dungeon generation algorithm</span>
    <span class="hljs-keyword">public</span> List&lt;Position&gt; positions;
    <span class="hljs-keyword">public</span> Wall[] walls;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> type;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> width;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> height;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DungeonGenerator.cs：</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DungeonGenerator</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> mapWidth;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> mapHeight;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> widthMinRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> widthMaxRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> heightMinRoom;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> heightMaxRoom;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxCorridorLength;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxFeatures;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> isASCII;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitializeDungeon</span>(<span class="hljs-params"></span>)</span> {<font></font>
        MapManager.map = <span class="hljs-keyword">new</span> Tile[mapWidth, mapHeight];<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GenerateDungeon</span>(<span class="hljs-params"></span>)</span> {<font></font>
        FirstRoom();<font></font>
        DrawMap(isASCII);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FirstRoom</span>(<span class="hljs-params"></span>)</span> {<font></font>
        Feature room = <span class="hljs-keyword">new</span> Feature();<font></font>
        room.positions = <span class="hljs-keyword">new</span> List&lt;Position&gt;();<font></font>
<font></font>
        <span class="hljs-keyword">int</span> roomWidth = Random.Range(widthMinRoom, widthMaxRoom);
        <span class="hljs-keyword">int</span> roomHeight = Random.Range(heightMinRoom, heightMaxRoom);<font></font>
<font></font>
        <span class="hljs-keyword">int</span> xStartingPoint = mapWidth / <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> yStartingPoint = mapHeight / <span class="hljs-number">2</span>;<font></font>
<font></font>
        xStartingPoint -= Random.Range(<span class="hljs-number">0</span>, roomWidth);<font></font>
        yStartingPoint -= Random.Range(<span class="hljs-number">0</span>, roomHeight);<font></font>
<font></font>
        room.walls = <span class="hljs-keyword">new</span> Wall[<span class="hljs-number">4</span>];<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; room.walls.Length; i++) {<font></font>
            room.walls[i] = <span class="hljs-keyword">new</span> Wall();<font></font>
            room.walls[i].positions = <span class="hljs-keyword">new</span> List&lt;Position&gt;();<font></font>
            room.walls[i].length = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">switch</span> (i) {
                <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"South"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"North"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"West"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
                    room.walls[i].direction = <span class="hljs-string">"East"</span>;
                    <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>; y &lt; roomHeight; y++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; roomWidth; x++) {<font></font>
                Position position = <span class="hljs-keyword">new</span> Position();<font></font>
                position.x = xStartingPoint + x;<font></font>
                position.y = yStartingPoint + y;<font></font>
<font></font>
                room.positions.Add(position);<font></font>
<font></font>
                MapManager.map[position.x, position.y] = <span class="hljs-keyword">new</span> Tile();<font></font>
                MapManager.map[position.x, position.y].xPosition = position.x;<font></font>
                MapManager.map[position.x, position.y].yPosition = position.y;<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (y == <span class="hljs-number">0</span>) {<font></font>
                    room.walls[<span class="hljs-number">0</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">0</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y == (roomHeight - <span class="hljs-number">1</span>)) {<font></font>
                    room.walls[<span class="hljs-number">1</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">1</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x == <span class="hljs-number">0</span>) {<font></font>
                    room.walls[<span class="hljs-number">2</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">2</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x == (roomWidth - <span class="hljs-number">1</span>)) {<font></font>
                    room.walls[<span class="hljs-number">3</span>].positions.Add(position);<font></font>
                    room.walls[<span class="hljs-number">3</span>].length++;<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Wall"</span>;<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> {<font></font>
                    MapManager.map[position.x, position.y].type = <span class="hljs-string">"Floor"</span>;<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
<font></font>
        room.width = roomWidth;<font></font>
        room.height = roomHeight;<font></font>
        room.type = <span class="hljs-string">"Room"</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DrawMap</span>(<span class="hljs-params"><span class="hljs-keyword">bool</span> isASCII</span>)</span> {
        <span class="hljs-keyword">if</span> (isASCII) {<font></font>
            Text screen = GameObject.Find(<span class="hljs-string">"ASCIITest"</span>).GetComponent&lt;Text&gt;();<font></font>
<font></font>
            <span class="hljs-keyword">string</span> asciiMap = <span class="hljs-string">""</span>;<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = (mapHeight - <span class="hljs-number">1</span>); y &gt;= <span class="hljs-number">0</span>; y--) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; mapWidth; x++) {
                    <span class="hljs-keyword">if</span> (MapManager.map[x,y] != <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">switch</span> (MapManager.map[x, y].type) {
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"Wall"</span>:<font></font>
                                asciiMap += <span class="hljs-string">"#"</span>;
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-string">"Floor"</span>:<font></font>
                                asciiMap += <span class="hljs-string">"."</span>;
                                <span class="hljs-keyword">break</span>;<font></font>
                        }<font></font>
                    } <span class="hljs-keyword">else</span> {<font></font>
                        asciiMap += <span class="hljs-string">" "</span>;<font></font>
                    }<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> (x == (mapWidth - <span class="hljs-number">1</span>)) {<font></font>
                        asciiMap += <span class="hljs-string">"\n"</span>;<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
<font></font>
            screen.text = asciiMap;<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GameManager.cs：</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GameManager</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    DungeonGenerator dungeonGenerator;<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span> {<font></font>
        dungeonGenerator = GetComponent&lt;DungeonGenerator&gt;();<font></font>
<font></font>
        dungeonGenerator.InitializeDungeon();<font></font>
        dungeonGenerator.GenerateDungeon();<font></font>
    }<font></font>
}</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490816/index.html">电子商务网站如何抵抗AuthBots僵尸网络？</a></li>
<li><a href="../zh-CN490820/index.html">一站式服务所有哈伯</a></li>
<li><a href="../zh-CN490822/index.html">DEF CON 2019-2020破解汽车的最佳材料</a></li>
<li><a href="../zh-CN490824/index.html">Java开发人员眼中的PostgreSQL索引运行状况</a></li>
<li><a href="../zh-CN490826/index.html">生产效率之源</a></li>
<li><a href="../zh-CN490830/index.html">Zimbra Collaboration Suite开源版中的密码管理</a></li>
<li><a href="../zh-CN490832/index.html">鞋标：当我们投入流通时，有200万种标码“ 1C” +“诚实标志”</a></li>
<li><a href="../zh-CN490836/index.html">如何打开评论而不被垃圾邮件淹没</a></li>
<li><a href="../zh-CN490838/index.html">WiFi 6在这里：市场提供什么以及我们为什么需要这种技术</a></li>
<li><a href="../zh-CN490840/index.html">资源规划。第4.1部分。在制定资源计划之前</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>