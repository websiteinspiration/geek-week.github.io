<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🎓 😤 👨🏾‍🏭 Teleport proses ke komputer lain!  ☠️ 🤳🏾 😶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suatu kali, seorang rekan berbagi pemikirannya tentang API untuk cluster komputasi terdistribusi, dan saya bercanda menjawab: "Jelas, API yang ideal a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Teleport proses ke komputer lain! </h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/499422/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suatu kali, seorang rekan berbagi pemikirannya tentang API untuk cluster komputasi terdistribusi, dan saya bercanda menjawab: "Jelas, API yang ideal akan menjadi panggilan sederhana </font></font><code>telefork()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sehingga proses Anda bangun di setiap mesin cluster, mengembalikan nilai instance ID." Tetapi pada akhirnya, ide ini menguasai saya. Saya tidak bisa mengerti mengapa itu sangat bodoh dan sederhana, jauh lebih sederhana daripada API untuk pekerjaan jarak jauh, dan mengapa sistem komputer tampaknya tidak mampu seperti itu. Saya juga tampaknya mengerti bagaimana ini bisa diterapkan, dan saya sudah memiliki nama baik, yang merupakan bagian paling sulit dari setiap proyek. Jadi saya mulai bekerja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama akhir pekan pertama, ia membuat prototipe dasar, dan akhir pekan kedua membawa demo yang bisa</font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memproses ke mesin virtual raksasa di cloud, mengusir rendering lintasan menelusuri pada beberapa core, dan kemudian telefork proses kembali. </font><font style="vertical-align: inherit;">Semua ini dibungkus dengan API sederhana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Video menunjukkan bahwa rendering pada VM 64-core di cloud selesai dalam 8 detik (ditambah 6 detik untuk telefork bolak-balik). </font><font style="vertical-align: inherit;">Render yang sama secara lokal dalam sebuah wadah di laptop saya membutuhkan waktu 40 detik:</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browser Anda tidak mendukung video HTML5.</font></font><source src="https://thume.ca/assets/postassets/telefork/telefork-small.mp4" type="video/mp4"></video></div></div></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana mungkin melakukan proses teleport? </font><font style="vertical-align: inherit;">Inilah yang harus dijelaskan artikel ini! </font><font style="vertical-align: inherit;">Ide dasarnya adalah bahwa pada level rendah, proses Linux hanya memiliki beberapa komponen. </font><font style="vertical-align: inherit;">Anda hanya perlu cara untuk memulihkan masing-masing dari donor, mentransfernya melalui jaringan dan menyalinnya ke proses kloning. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda mungkin berpikir: "Tapi bagaimana cara mereplikasi [sesuatu yang sulit, seperti koneksi TCP]?" </font><font style="vertical-align: inherit;">Betulkah. </font><font style="vertical-align: inherit;">Faktanya, kami tidak mentolerir hal-hal rumit seperti itu untuk menjaga kode tetap sederhana. </font><font style="vertical-align: inherit;">Artinya, itu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hanya demo teknis yang menyenangkan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang mungkin tidak boleh digunakan dalam produksi. </font><font style="vertical-align: inherit;">Tapi dia masih tahu bagaimana cara memindahkan kelas yang luas dari sebagian besar tugas komputasi!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti apa bentuknya</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menerapkan kode sebagai perpustakaan Rust, tetapi secara teoritis Anda dapat membungkus program dalam API C dan kemudian menjalankan melalui ikatan FFI untuk melakukan teleport bahkan proses Python. </font><font style="vertical-align: inherit;">Implementasinya hanya sekitar 500 baris kode (ditambah 200 baris komentar):</font></font><br>
<br>
<pre><code class="rust hljs"><span class="hljs-keyword">use</span> telefork::{telefork, TeleforkLocation};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    <span class="hljs-keyword">let</span> args: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">String</span>&gt; = std::env::args().collect();
    <span class="hljs-keyword">let</span> destination = args.get(<span class="hljs-number">1</span>).expect(<span class="hljs-string">"expected arg: address of teleserver"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> stream = std::net::TcpStream::connect(destination).unwrap();
    <span class="hljs-keyword">match</span> telefork(&amp;<span class="hljs-keyword">mut</span> stream).unwrap() {<font></font>
        TeleforkLocation::Child(val) =&gt; {<font></font>
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"I teleported to another computer and was passed {}!"</span>, val);<font></font>
        }<font></font>
        TeleforkLocation::Parent =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Done sending!"</span>),<font></font>
    };<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya juga menulis bantuan yang disebut </font></font><code>yoyo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teleforks ke server, melakukan penutupan yang ditransmisikan, dan kemudian telefork kembali. </font><font style="vertical-align: inherit;">Ini menciptakan ilusi bahwa Anda dapat dengan mudah menjalankan sepotong kode pada server jarak jauh, misalnya, dengan kekuatan pemrosesan yang jauh lebih besar.</font></font><br>
<br>
<pre><code class="rust hljs"><span class="hljs-comment">// load the scene locally, this might require loading local scene files to memory</span>
<span class="hljs-keyword">let</span> scene = create_scene();
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> backbuffer = <span class="hljs-built_in">vec!</span>[Vec3::new(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>); width * height];<font></font>
telefork::yoyo(destination, || {<font></font>
  <span class="hljs-comment">// do a big ray tracing job on the remote server with many cores!</span>
  render_scene(&amp;scene, width, height, &amp;<span class="hljs-keyword">mut</span> backbuffer);<font></font>
});<font></font>
<span class="hljs-comment">// write out the result to the local file system</span>
save_png_file(width, height, &amp;backbuffer);</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anatomi proses Linux</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat seperti apa prosesnya di Linux (di mana induk OS berjalan </font></font><code>telefork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">):</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/42c/a2e/366/42ca2e366497bb88024cb351a0cb9e62.png"><br>
<br>
<ul>
<li><b> </b> (memory mappings):         ,    .    «»  4 .         <code>/proc/&lt;pid&gt;/maps</code>.        ,   ,    .<br>
<br>
<ul>
<li>     ,         ,          (   ).</li>
</ul></li>
<li><b></b>:      ,       .     , , -  ,    ,      ,   .              ,    .<br>
</li>
<li><b> </b>:     ,         .   -    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>.      ,       ,    ,  TCP-,  .<br>
<ul>
<li>          .      stdin/stdout/stderr,       0, 1  2.<br>
</li>
<li>  ,     ,    ,     .</li>
</ul></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lain-lain</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Ada beberapa bagian lain dari proses yang bervariasi dalam kompleksitas replikasi. </font><font style="vertical-align: inherit;">Tetapi dalam kebanyakan kasus mereka tidak masalah, misalnya, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">brk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (heap pointer). </font><font style="vertical-align: inherit;">Beberapa di antaranya dapat dipulihkan hanya dengan bantuan trik aneh atau panggilan sistem khusus seperti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PR_SET_MM_MAP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mempersulit pemulihan.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, implementasi dasar </font></font><code>telefork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dapat dilakukan dengan pemetaan memori sederhana dan register dari utas utama. </font><font style="vertical-align: inherit;">Ini harus cukup untuk program sederhana yang terutama melakukan perhitungan tanpa berinteraksi dengan sumber daya OS, seperti file (pada prinsipnya, untuk melakukan teleportasi sudah cukup untuk membuka file dalam sistem dan menutupnya sebelum memanggil </font></font><code>telefork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara Telefork suatu proses</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya bukan orang pertama yang berpikir tentang menciptakan kembali proses di komputer lain. Jadi, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debugging rr dan merekam debugger</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> melakukan hal yang sangat mirip </font><font style="vertical-align: inherit;">. Saya mengirim </font><font style="vertical-align: inherit;">beberapa pertanyaan </font><font style="vertical-align: inherit;">kepada penulis program ini </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@rocallahan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan dia memberi tahu saya tentang sistem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRIU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk migrasi "panas" kontainer antar host. CRIU dapat mentransfer proses Linux ke sistem lain, mendukung pemulihan semua jenis deskriptor file dan status lainnya, namun kode ini sangat kompleks dan menggunakan banyak panggilan sistem yang memerlukan rakitan kernel khusus dan izin root. Menggunakan tautan dari halaman wiki CRIU, saya menemukan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMTCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dibuat untuk snapshot dari tugas yang didistribusikan pada superkomputer sehingga mereka dapat dimulai kembali nanti, dan program ini</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode itu ternyata lebih sederhana</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh-contoh ini tidak memaksa saya untuk meninggalkan upaya untuk mengimplementasikan sistem saya sendiri, karena ini adalah program yang sangat kompleks yang memerlukan pelari dan infrastruktur khusus, dan saya ingin menerapkan teleportasi proses yang paling sederhana sebagai panggilan perpustakaan. Jadi saya mempelajari fragmen kode sumber </font></font><code>rr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, CRIU, DMTCP, dan beberapa contoh ptrace - dan mengumpulkan prosedur saya sendiri </font></font><code>telefork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Metode saya bekerja dengan caranya sendiri, ini adalah campuran berbagai teknik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan teleport suatu proses, Anda perlu melakukan beberapa pekerjaan dalam proses asli yang memanggil </font></font><code>telefork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan beberapa bekerja di sisi panggilan fungsi, yang menerima proses streaming di server dan membuatnya kembali dari aliran (fungsi</font></font><code>telepad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">Mereka dapat terjadi pada saat yang sama, tetapi semua serialisasi juga dapat dilakukan sebelum mengunduh, misalnya, menjatuhkannya ke file, dan kemudian mengunduhnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah ikhtisar yang disederhanakan dari kedua proses. </font><font style="vertical-align: inherit;">Jika Anda ingin memahami secara detail, saya sarankan membaca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kode sumber</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Itu terkandung dalam satu file dan sangat erat berkomentar untuk membaca agar dan memahami bagaimana semuanya bekerja.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirimkan proses menggunakan </font></font><code>telefork</code></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi </font></font><code>telefork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menerima aliran dengan kemampuan menulis, yang digunakan untuk mentransfer seluruh keadaan prosesnya.</font></font><br>
<br>
<ol>
<li><b> </b>  «» .       ,        ,   .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">fork</a>       .<br>
</li>
<li><b>   </b>.  <code>/proc/&lt;pid&gt;/maps</code> ,    .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proc_maps crate</a>.<br>
</li>
<li><b>     </b>.    DMTCP,         ,        ,       .   ,   <code>[vdso]</code>,      , ,    .<br>
</li>
<li><b>         </b>   .    ,    ,           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">process_vm_readv</a>        ,       .<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daftar Transfer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saya menggunakan opsi </font></font><code>PTRACE_GETREGS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk panggilan sistem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ptrace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ini memungkinkan Anda untuk mendapatkan semua nilai register dari proses anak. </font><font style="vertical-align: inherit;">Lalu saya hanya menuliskannya di pesan di saluran.</font></font></li>
</ol><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menjalankan panggilan sistem dalam proses anak</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengubah proses target menjadi salinan dari proses masuk, Anda harus memaksa proses untuk mengeksekusi sekelompok panggilan sistem itu sendiri, tanpa akses ke kode apa pun, karena kami telah menghapus semuanya. </font><font style="vertical-align: inherit;">Kami membuat panggilan sistem jarak jauh menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ptrace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , panggilan sistem universal untuk memanipulasi dan memeriksa proses lain:</font></font><br>
<br>
<ol>
<li><b>  syscall</b>.        syscall   ,      .    ,      <code>process_vm_readv</code>      <code>[vdso]</code> , ,   ,      syscall    Linux,       .         ,    <code>[vdso]</code>.<br>
</li>
<li><b> </b>    ,  <code>PTRACE_SETREGS</code>.      syscall,  <code>rax</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">    Linux</a>,      <code>rdi, rsi, rdx, r10, r8, r9</code>.<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ambil satu langkah</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menggunakan parameter </font></font><code>PTRACE_SINGLESTEP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk menjalankan perintah syscall.</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baca register</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan </font></font><code>PTRACE_GETREGS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk mengembalikan nilai pengembalian syscall dan lihat apakah itu berhasil.</font></font></li>
</ol><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proses penerimaan di </font></font><code>telepad</code></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan menggunakan ini dan primitif yang sudah dijelaskan, kita dapat membuat ulang proses:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Garpu proses anak yang beku</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mirip dengan pengiriman, tetapi kali ini kita membutuhkan proses anak yang dapat kita manipulasi untuk mengubahnya menjadi klon dari proses yang ditransfer.</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Periksa kartu alokasi memori</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kali ini kita perlu mengetahui semua kartu alokasi memori yang ada untuk menghapusnya dan memberikan ruang untuk proses yang masuk.</font></font><br>
</li>
<li><b>  </b>.         ,    <code>munmap</code>.<br>
</li>
<li><b>   </b>.        <code>mremap</code>,      .<br>
</li>
<li><b>    </b>.   <code>mmap</code>   ,   <code>process_vm_writev</code>      .<br>
</li>
<li><b> </b>.  <code>PTRACE_SETREGS</code>     ,   ,   <code>rax</code>.     <code>raise(SIGSTOP)</code>,    .     ,    <code>telepad</code>.<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nilai arbitrer digunakan sehingga server telefork dapat mentransfer deskriptor file dari koneksi TCP yang dimasukkan proses, dan dapat mengirim data kembali atau, jika </font></font><code>yoyo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, teleport kembali ke koneksi yang sama.</font></font></li>
</ul></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mulai ulang proses</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan konten baru menggunakan </font></font><code>PTRACE_DETACH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ol><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementasi yang lebih kompeten</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa bagian dari implementasi telefork saya tidak dirancang dengan sempurna. </font><font style="vertical-align: inherit;">Saya tahu cara memperbaikinya, tetapi dalam bentuk saat ini saya suka sistemnya, dan terkadang mereka sangat sulit untuk memperbaikinya. </font><font style="vertical-align: inherit;">Berikut ini beberapa contoh menarik:</font></font><br>
<br>
<ul>
<li>      (vDSO).   <code>mremap</code>  vDSO   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> DMTCP</a>,  ,            .      vDSO,            .        -  ,      CPU  glibc      vDSO   .      ,      vDSO,     syscall,    <code>rr</code>,     vDSO     vDSO   .<br>
</li>
<li> <code>brk</code>   .      DMTCP,       ,   <code>brk</code> ,  <code>brk</code> .  ,      ,&nbsp;—  <code>PR_SET_MM_MAP</code>,          .<br>
</li>
<li>   .     Rust « », ,     FS  GS, ,   ,  -  <code>glibc</code>  pid  tid,         .    CRIU,        PID  TID    .<br>
</li>
<li>   .             , , ,       /   ,     /       FUSE.           ,    TCP-,  DMTCP  CRIU          ,    <code>perf_event_open</code>.<br>
</li>
<li>  .  <code>fork()</code>  Unix   ,           ,           .</li>
</ul><br>
<h1>   </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya pikir Anda sudah mengerti bahwa dengan antarmuka tingkat rendah yang tepat, Anda dapat menerapkan beberapa hal gila yang tampaknya mustahil bagi seseorang. </font><font style="vertical-align: inherit;">Berikut adalah beberapa pemikiran tentang bagaimana mengembangkan ide-ide dasar telefork. </font><font style="vertical-align: inherit;">Meskipun banyak dari hal di atas mungkin dapat sepenuhnya diimplementasikan hanya pada kernel yang sama sekali baru atau tetap:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telefork klaster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sumber awal inspirasi untuk telefork adalah ide untuk mengalirkan suatu proses ke semua mesin dalam sebuah cluster komputasi. </font><font style="vertical-align: inherit;">Bahkan dapat berubah untuk mengimplementasikan metode UDP-multicast atau peer-to-peer untuk mempercepat distribusi di seluruh cluster. </font><font style="vertical-align: inherit;">Anda mungkin juga ingin memiliki komunikasi primitif.</font></font><br>
</li>
<li><b>  </b>. CRIU    ,   -   <code>userfaultfd</code>.              ,   <code>SIGSEGV</code>  <code>mmap</code>.        ,    ,        &nbsp;—     .<br>
</li>
<li><b> !</b>      ,        .    <code>userfaultfd</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">      userfaultfd,       </a>,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MESI</a>,        .         ,     ,          .  &nbsp;—    ,            .    ,       ,    ,    .      :     syscall,     -,   syscall,     .      ,           .    ,      ,     ,    .  ,       ,         .          ,     ,  (   ,      )        ,       .</li>
</ul><br>
<h1></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya sangat menyukainya, karena di sini adalah contoh dari salah satu teknik favorit saya - menyelam ke lapisan abstraksi yang kurang dikenal, yang relatif mudah memenuhi apa yang kami pikir hampir mustahil. Perhitungan teleportasi mungkin tampak tidak mungkin atau sangat sulit. Anda mungkin berpikir bahwa itu akan memerlukan metode seperti membuat serial seluruh negara, menyalin biner yang dapat dieksekusi ke mesin jarak jauh, dan meluncurkannya di sana dengan bendera baris perintah khusus untuk memuat ulang negara. Tapi tidak, semuanya jauh lebih sederhana. Di bawah bahasa pemrograman favorit Anda adalah lapisan abstraksi di mana Anda dapat memilih subset fungsi yang cukup sederhana - dan selama akhir pekan menerapkan teleportasi perhitungan paling murni dalam bahasa pemrograman apa pun dalam 500 baris kode. kupikirbahwa penyelaman seperti itu ke tingkat abstraksi lain sering kali mengarah pada solusi yang lebih sederhana dan lebih universal. Proyek saya yang lain seperti ini</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Numderline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sepintas, proyek-proyek semacam itu tampaknya merupakan peretasan ekstrem, dan sebagian besar memang demikian. Mereka melakukan hal-hal yang tidak diharapkan oleh siapa pun, dan ketika mereka rusak, mereka melakukannya pada tingkat abstraksi, di mana program serupa seharusnya tidak berfungsi - misalnya, deskriptor file Anda menghilang secara misterius. Tetapi kadang-kadang Anda dapat dengan tepat mengatur tingkat abstraksi dan menyandikan segala situasi yang mungkin terjadi, sehingga pada akhirnya semuanya akan bekerja dengan lancar dan ajaib. Saya pikir contoh yang baik di sini adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (walaupun Telefork berhasil memecatnya) dan migrasi cloud dari mesin virtual secara real time (pada kenyataannya, Telefork pada level hypervisor).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya juga suka menyajikan hal-hal ini sebagai ide untuk cara alternatif bekerja sistem komputer. </font><font style="vertical-align: inherit;">Mengapa API komputasi cluster kami jauh lebih rumit daripada program sederhana yang menerjemahkan fungsi menjadi sebuah cluster? </font><font style="vertical-align: inherit;">Mengapa pemrograman sistem jaringan jauh lebih rumit daripada multithreaded? </font><font style="vertical-align: inherit;">Tentu saja, Anda dapat memberikan segala macam alasan bagus, tetapi biasanya didasarkan pada seberapa sulitnya membuat contoh sistem yang ada. </font><font style="vertical-align: inherit;">Atau mungkin dengan abstraksi yang tepat atau dengan upaya yang memadai, semuanya akan bekerja dengan mudah dan mulus? </font><font style="vertical-align: inherit;">Pada dasarnya, tidak ada yang mustahil.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/0i/q1/3c/0iq13ceb1rqhy6ymre4-xvedsfu.jpeg"><br>
</a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499404/index.html">Manajemen beban PostgreSQL, ketika satu server tidak cukup. Andrey Salnikov</a></li>
<li><a href="../id499408/index.html">Jebakan dalam menguji Streaming Kafka</a></li>
<li><a href="../id499410/index.html">Pembuatan file konfigurasi MySQL yang dioptimalkan untuk kinerja otomatis</a></li>
<li><a href="../id499412/index.html">Asuransi kesehatan terbaik adalah berpikir dengan kepala Anda. Ide aplikasi</a></li>
<li><a href="../id499418/index.html">Futurisme yang pantas kita dapatkan</a></li>
<li><a href="../id499426/index.html">Sepertinya saya bahwa hosting VPS / VDS Rusia berasal dari neraka (dan ya, kami juga memotong)</a></li>
<li><a href="../id499428/index.html">Tablet Manajemen Awan Morpheus Merah</a></li>
<li><a href="../id499430/index.html">Di-google juga?</a></li>
<li><a href="../id499432/index.html">Otonomi Tes Unit di PHPUnit</a></li>
<li><a href="../id499434/index.html">Bagaimana menerapkan manajemen pengetahuan: manfaat "kantong", "duri burung beo" dan pemikiran klip</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>