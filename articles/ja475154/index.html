<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😄 👳 🕺🏿 IPEYEクラウド監視サービスによる社内タイムラプス 🏘️ 🎥 🤙🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、IPEYEに接続された2台のCCTVカメラでタイムラプスを形成するタスクが毎日表示されました。Pythonの最小限の知識を持つ人がこれをどのように処理したかに興味がある場合、または私の間違いを私に指摘したい場合は、ようこそ…
 
 はじめに
 父は別の地域に引っ越して家を建てることにしました。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IPEYEクラウド監視サービスによる社内タイムラプス</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475154/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、IPEYEに接続された2台のCCTVカメラでタイムラプスを形成するタスクが毎日表示されました。</font><font style="vertical-align: inherit;">Pythonの最小限の知識を持つ人がこれをどのように処理したかに興味がある場合、または私の間違いを私に指摘したい場合は、ようこそ…</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はじめに</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
父は別の地域に引っ越して家を建てることにしました。</font><font style="vertical-align: inherit;">彼は私にビデオ監視を手伝うように頼んだ。</font><font style="vertical-align: inherit;">入力：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テクニカルルームはありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機器が盗まれる可能性があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高品質の画像が必要です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カメラは屋外でなければなりません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なのは2台のカメラだけです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ズーム付きのPTZカメラが本当に必要です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モバイルアプリが欲しいのですが。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブランド機器の店頭での価格を見て、アリのすべてのパンを備えたnoname PoEカメラを購入することが決定されました。</font><font style="vertical-align: inherit;">カメラの価格はかなり安く、1台あたり約5,000枚です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DVRを建設現場に置きたくなかったため、クラウドソリューションを使用することにしました。</font><font style="vertical-align: inherit;">カメラが到着した後、PTZを含むすべてが機能するように、さまざまなサービスで友達を作ろうとしました。</font><font style="vertical-align: inherit;">私が試したすべてのサービスの中で、IPEYEだけで中国のカメラの友達を作ることがわかりました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでイントロが終了します。</font><font style="vertical-align: inherit;">今では、このサービスについて会話する理由は誰にとっても明らかだと思います。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPEYEの経験</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスとしてのサービス。</font><font style="vertical-align: inherit;">約束されたすべてが満たされます。</font><font style="vertical-align: inherit;">テクニカルサポートが質問に答えます。</font><font style="vertical-align: inherit;">重要な点は、rstpストリームへのリンクを指定し、PTZ設定を変更すると、すべてが機能することです。</font><font style="vertical-align: inherit;">Androidモバイルアプリケーションが機能します。</font><font style="vertical-align: inherit;">カメラのゲストユーザーを作成し、各親族にアクセス権を与えることができます。</font><font style="vertical-align: inherit;">Vivaldiのウェブインターフェースは時々バグがあり、Chromeではそのような不具合はあまり一般的ではありません。</font><font style="vertical-align: inherit;">アーカイブの閲覧が少し鈍い。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カメラからのアーカイブはダウンロードできますが、最長3時間です。</font><font style="vertical-align: inherit;">手順は非常に時間がかかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが元気であるように見えますが、何かがおかしいとあなたの魂で感じています。</font><font style="vertical-align: inherit;">そして、アーカイブの深さが十分ではありません。</font><font style="vertical-align: inherit;">あなたは深さを増やすことができますが、最も高価なオプション-12か月は1台のカメラに対して1年間に25千ルーブルの費用がかかります（検出して記録する場合）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何か考え出そうか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはまさに父が私に尋ねた質問です。父は建設のすべての段階を捉えたかった。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を解決するためのオプションは何ですか？毎日Webインターフェイスにアクセスして、各カメラからいくつかのビデオをエクスポートできます。誰がそのような退屈な仕事をするでしょうか？無し！ 1日に数回、放送用カメラを開いてスクリーンショットを撮りますか？まあ、また狂気。アーカイブの深さを1年に増やしますか？まあ、非常に安価なソリューションです。このサービスにはTimeLapse関数がすでに組み込まれているとGoogleから言われましたが、解像度が低く、今後のアーカイブにダウンロードすることはできません:( </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元のタイムラプスをダウンロードできます。これを行うには、Webインターフェイスでタイムラプスを開きます。開発者のツールを使用して、Webページを調べ、リンクを見つけますリンク形式：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sr &lt;server_number&gt; .ipeye.ru / api / v1 / stream / &lt;uuid&gt; / nvr / timelapse / 0 / &lt;unixtimestamp&gt; /100/video.mjpeg </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何とかスクリーンショットを保存するために何かを書くことが決定されましたカメラから、最終的なビデオを形成します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免責事項</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この作品の作者はプログラマーではなく、プログラマーになることを目指していません。</font><font style="vertical-align: inherit;">OOPは表面的に基本を知っています。</font><font style="vertical-align: inherit;">アジャイルなど </font><font style="vertical-align: inherit;">研究されていません。</font><font style="vertical-align: inherit;">1か月前、彼はpythonの短いビデオコースを見て、現在の問題を解決するためにそれを使用することにしました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPEYEサービスが公開されている</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIである</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことを知って良かったです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">APIはPHPの例のみを提供しますが、有用であることが証明されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンピュータがオフにならないという事実に基づいて、次の概念が開発されました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windowsスケジューラは、30分ごとにスクリプトを実行します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIを介したスクリプトは、カメラのUUIDを決定します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIを介したスクリプトは、カメラから写真を受け取り、ディレクトリに保存します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトは1日1回、各カメラのビデオファイルを生成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース写真と最終的なビデオを含むカタログは、クラウドに関連付けられて共有されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">親戚がタイムラプスを見て、好きなようにファイルを操作したい場合。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIを操作するために、APIサーバーへの要求のロギングと実行の関数をいくつか作成しました。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writeLog（）</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">writeLog</span>(<span class="hljs-params">logdata</span>):</span>
	<span class="hljs-keyword">if</span> LogEnable == <span class="hljs-number">1</span>:<font></font>
		log_time = datetime.now()<font></font>
		log_time = log_time.isoformat(timespec=<span class="hljs-string">'seconds'</span>)<font></font>
		log_file = open(log_file_path, <span class="hljs-string">"a+"</span>)<font></font>
		log_file.write(log_time + <span class="hljs-string">": "</span> + str(logdata) + <span class="hljs-string">"\n"</span>)<font></font>
		log_file.close<font></font>
	<span class="hljs-keyword">else</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getApiResponse（）</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getApiResponse</span>(<span class="hljs-params">method, api_uri</span>):</span>
	<span class="hljs-keyword">if</span> method == <span class="hljs-string">"GET"</span>:
		<span class="hljs-keyword">try</span>:<font></font>
			r = requests.get(api_url + api_uri, timeout = api_timeout)<font></font>
			r.raise_for_status() <span class="hljs-comment">#   HTTP   </span>
		<span class="hljs-keyword">except</span> requests.exceptions.Timeout:<font></font>
			writeLog(<span class="hljs-string">"Error. Timeout. Request Uri:"</span> + api_uri)
		<span class="hljs-keyword">except</span> requests.exceptions.TooManyRedirects:<font></font>
			writeLog(<span class="hljs-string">"Error. TooManyRedirects or bad URL. Request Uri:"</span> + api_uri) 
		<span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:<font></font>
			writeLog(<span class="hljs-string">"Error. Fatal error: "</span> + str(e) + <span class="hljs-string">" Request Uri:"</span> + api_uri) <font></font>
			sys.exit(<span class="hljs-number">1</span>)
		<span class="hljs-keyword">except</span> requests.exceptions.HTTPError <span class="hljs-keyword">as</span> e:<font></font>
			writeLog(<span class="hljs-string">"Error. HTTP error: "</span> + str(e) + <span class="hljs-string">" Request Uri:"</span> + api_uri)
	<span class="hljs-keyword">if</span> method == <span class="hljs-string">"POST"</span>:
		<span class="hljs-keyword">try</span>:<font></font>
			r = requests.post(api_url + api_uri, timeout = api_timeout)<font></font>
			r.raise_for_status() <span class="hljs-comment">#   HTTP   </span>
		<span class="hljs-keyword">except</span> requests.exceptions.Timeout:<font></font>
			writeLog(<span class="hljs-string">"Error. Timeout. Request Uri:"</span> + api_uri)
		<span class="hljs-keyword">except</span> requests.exceptions.TooManyRedirects:<font></font>
			writeLog(<span class="hljs-string">"Error. TooManyRedirects or bad URL. Request Uri:"</span> + api_uri) 
		<span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:<font></font>
			writeLog(<span class="hljs-string">"Error. Fatal error: "</span> + str(e) + <span class="hljs-string">" Request Uri:"</span> + api_uri) <font></font>
			sys.exit(<span class="hljs-number">1</span>)
		<span class="hljs-keyword">except</span> requests.exceptions.HTTPError <span class="hljs-keyword">as</span> e:<font></font>
			writeLog(<span class="hljs-string">"Error. HTTP error: "</span> + str(e) + <span class="hljs-string">" Request Uri:"</span> + api_uri)
	<span class="hljs-keyword">return</span> r
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIによると、/デバイス/すべてにアクセスし、すべてのスレッドの情報を取得する機能があります。</font><font style="vertical-align: inherit;">APIのドキュメントを信じている場合は、認証が必要ないことをすぐに混乱しました... /デバイス/すべてを要求すると、エラーが発生しました：</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致命的なエラー：401クライアントエラー：次のURLは許可されてい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ません</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">api.ipeye.ru</font></a><font style="vertical-align: inherit;">：8111 /デバイス/すべて</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資格情報を送信するようにgetApiResponse関数を変更しましたが、401エラーも発生しました。関数をリストしていません。</font><font style="vertical-align: inherit;">将来は役に立ちませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これについてテクニカルサポートに連絡する必要がありました。</font><font style="vertical-align: inherit;">サポートチームは、承認付きのAPIを使用するには、最初にIPEYEと契約を結び、Webサーバーを構成する必要があると説明しました。</font><font style="vertical-align: inherit;">どのような種類のウェブサーバーで、なぜ説明されなかったのですか。同時に、uuidカメラを入手し、許可なしにAPIにアクセスするためのヒントを提供しました。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サポートとの対応</font></font></b><div class="spoiler_text"><blockquote>:  .    API? uuid   web   .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">api.ipeye.ru</a>:8111/devices/all    /  .<br>
<br>
IPEYE:   /     API,      .<br>
<br>
         ,     API .<br>
<br>
:      API  ?<br>
<br>
IPEYE:   ,          API        .<br>
     2- ?<br>
<br>
: ,  ,    API        .    .<br>
<br>
IPEYE:        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">api.ipeye.ru/doc#AppDeviceJPEGOnline</a>?<br>
<br>
:     UUID  ?<br>
<br>
IPEYE:    , .   UUID   «  »   devcode.<br>
<br>
</blockquote><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
乾燥残留物には何がありますか？</font><font style="vertical-align: inherit;">実際、GETパラメータを見れば、アカウントにuuidカメラが見つかります。</font><font style="vertical-align: inherit;">スクリーンショットを取るためのメソッド/デバイス/ jpeg / online /：uuid /：nameがあり、uuidがあり、カメラの名前はすでに知っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストリームから画像を保存する関数を作成します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saveJpegFromStream（）</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">saveJpegFromStream</span>(<span class="hljs-params">uuid, name</span>):</span>
	<span class="hljs-comment"># api_uri = "/device/thumb/online/" + uuid + "/1920/" + name</span>
	api_uri = <span class="hljs-string">"/device/jpeg/online/"</span> + uuid + <span class="hljs-string">"/"</span> + name<font></font>
	writeLog(<span class="hljs-string">"Trying save Stream screenshot for camera: "</span> + name)<font></font>
	response = getApiResponse(<span class="hljs-string">"GET"</span>, api_uri)<font></font>
	content_type = response.headers.get(<span class="hljs-string">'content-type'</span>)
	<span class="hljs-keyword">if</span> content_type <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
		writeLog(<span class="hljs-string">"Nothing to save"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
	<span class="hljs-keyword">if</span> <span class="hljs-string">'text'</span> <span class="hljs-keyword">in</span> content_type.lower() <span class="hljs-keyword">or</span> <span class="hljs-string">'html'</span> <span class="hljs-keyword">in</span> content_type.lower():<font></font>
		writeLog(<span class="hljs-string">"Received text data: "</span> + response.content.decode(<span class="hljs-string">"utf-8"</span>)) 
		<span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
	<span class="hljs-keyword">else</span>:<font></font>
		filename = dirToSave + <span class="hljs-string">"\\"</span> + name + <span class="hljs-string">"-"</span> + today.strftime(<span class="hljs-string">"%Y-%m-%d-%H-%M-%S"</span>) + <span class="hljs-string">".jpg"</span>
		screenshot = open(filename, <span class="hljs-string">"wb"</span>)<font></font>
		screenshot.write(response.content)<font></font>
		screenshot.close()<font></font>
		writeLog(<span class="hljs-string">"File saved as: "</span> + filename)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストしましたが、何かが正しくないことを理解しています...ファイルを受け取りました。</font><font style="vertical-align: inherit;">私のカメラからの画像ですが、サイズが疑わしいほど小さくなっています-66Kb。</font><font style="vertical-align: inherit;">私は特性を見て、608 * 342が1920 * 1080ではないことを理解しています。</font><font style="vertical-align: inherit;">/ device / thumb / online / uuid / 1920 / nameを要求すると、1920 * 1080というファイルが得られますが、これは以前のファイル608 * 342を必要なスケールに引き伸ばしたものです。</font><font style="vertical-align: inherit;">もちろん、この状況は私には向いていませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、実験中に、名前パラメーターがチェックされたり、使用されたりしないことが発見されました。</font><font style="vertical-align: inherit;">あなたが好きなものを送ることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、私は最も有用なコマンド/デバイス/ url / rtsp /はRTSPストリームへのリンクを取得することであると結論付けました。</font><font style="vertical-align: inherit;">私はグーグルに目を向けなければならなかった、なぜなら </font><font style="vertical-align: inherit;">RTSPの操作方法が理解できませんでした。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getStreamRTSP（）</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getStreamRTSP</span>(<span class="hljs-params">uuid, name</span>):</span>
	api_uri = <span class="hljs-string">"/device/url/rtsp/"</span> + uuid<font></font>
	writeLog(<span class="hljs-string">"Trying get stream RTSP link for "</span> + name + <span class="hljs-string">" "</span> + uuid)<font></font>
	response = json.loads(getApiResponse(<span class="hljs-string">"GET"</span>, api_uri).text)<font></font>
	writeLog(<span class="hljs-string">"Stream RTSP link for "</span> + name + <span class="hljs-string">": "</span> + str(response[<span class="hljs-string">"message"</span>]))
	<span class="hljs-keyword">return</span> str(response[<span class="hljs-string">"message"</span>])
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saveJpegFromRTSP</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">saveJpegFromRTSP</span>(<span class="hljs-params">name, rtspLink</span>):</span>
	writeLog(<span class="hljs-string">"Trying save RTSP screenshot for camera: "</span> + name)<font></font>
	rtspClient = cv2.VideoCapture(rtspLink)<font></font>
	<font></font>
	<span class="hljs-keyword">if</span> rtspClient.isOpened():<font></font>
		_,frame = rtspClient.read()<font></font>
		rtspClient.release() <span class="hljs-comment">#      </span>
		<span class="hljs-keyword">if</span> _ <span class="hljs-keyword">and</span> frame <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
			filename = dirToSave + <span class="hljs-string">"\\"</span> + name + <span class="hljs-string">"-"</span> + today.strftime(<span class="hljs-string">"%Y-%m-%d-%H-%M-%S"</span>) + <span class="hljs-string">".jpg"</span><font></font>
			cv2.imwrite(filename, frame)<font></font>
			writeLog(<span class="hljs-string">"File saved as: "</span> + filename)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
	<span class="hljs-keyword">else</span>:<font></font>
		writeLog(<span class="hljs-string">"Can't read RTSP stream"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のいくつかの関数を書いた後、最初のタスクにAPIを使用する必要はまったくないことに気付きました。カメラのrtspストリームへの直接リンクがあり、最後の関数でカメラから画像をキャプチャできます。</font><font style="vertical-align: inherit;">しかし、私はこの段階でコンセプトを変更し始めませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIを介して作業する場合、2つの利点があります。IPEYEサーバーはカメラよりもはるかに高速にストリームを初期化し、rtspカメラストリームはファイアウォールによって閉じることができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jpg2mp4</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のステップは、1台のカメラのすべての画像をビデオに追加することです。</font><font style="vertical-align: inherit;">mp4vコーデックを選択しました。</font><font style="vertical-align: inherit;">MEGAでは、これらのビデオファイルをWebインターフェイスで再生できます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makeVideoFile（）</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">makeVideoFile</span>(<span class="hljs-params">name</span>):</span><font></font>
<font></font>
	height = <span class="hljs-number">1080</span>
	width = <span class="hljs-number">1920</span><font></font>
	<font></font>
	<span class="hljs-comment"># video = cv2.VideoWriter(dirToSave + "\\Video" + name + ".avi", cv2.VideoWriter_fourcc(*'DIVX'), 1,(width,height))</span>
	video = cv2.VideoWriter(dirToSave + <span class="hljs-string">"\\Video"</span> + name + <span class="hljs-string">".mp4"</span>, cv2.VideoWriter_fourcc(*<span class="hljs-string">'mp4v'</span>), <span class="hljs-number">1</span>,(width,height))<font></font>
<font></font>
	files = os.listdir(dirToSave)<font></font>
	screenshots = list(filter(<span class="hljs-keyword">lambda</span> x: x.startswith(name + <span class="hljs-string">"-"</span>), files))<font></font>
<font></font>
	<span class="hljs-keyword">for</span> screenshot <span class="hljs-keyword">in</span> screenshots:<font></font>
		origImage = cv2.imread(dirToSave + <span class="hljs-string">"\\"</span> + screenshot)
		<span class="hljs-comment">#  ,    ,      -   ...  </span>
		<span class="hljs-comment">#  ,        FullHD ?           API</span><font></font>
		heightOrig, widthOrig, channelsOrig = origImage.shape<font></font>
		<span class="hljs-keyword">if</span> height != heightOrig <span class="hljs-keyword">or</span> width != widthOrig:<font></font>
			img = cv2.resize(origImage, (width, height))<font></font>
			video.write(img)<font></font>
		<span class="hljs-keyword">else</span>:<font></font>
			video.write(origImage)<font></font>
	cv2.destroyAllWindows()<font></font>
	video.release()<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参考までに、ビデオ形式で合計37.3 MBの45個のjpgファイルは16.9 MBを占めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の最初の公開記事を読んでくれてありがとう。</font><font style="vertical-align: inherit;">途中で乾いた記事を読みたくなかったので、ストーリーの形式ですべてを説明しようとしましたが、簡単ではありませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pythonに出会ってから1か月も経っていないので、コメントをいただければ幸いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
拡張コメント付きの完全なスクリプトは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubにあり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このスクリプトは、タイムゾーンの違いも考慮に入れており、残りのすべての関数は、異なる数のカメラにすばやくスケーリングするように記述されています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja475140/index.html">トップ物理学者が弱い量子測定を疑似科学と考える理由</a></li>
<li><a href="../ja475142/index.html">睡眠、リラクゼーション、音楽：プロのアスリートがどのように疲労を克服し、それに対して何ができるか</a></li>
<li><a href="../ja475144/index.html">Laravelをコンポーネントに分割する</a></li>
<li><a href="../ja475146/index.html">1回のデータ復旧試行の苦痛または長い歴史</a></li>
<li><a href="../ja475152/index.html">偽善のグーグル。PageSpeed Insights</a></li>
<li><a href="../ja475158/index.html">Playme P570モノレビュー：要点</a></li>
<li><a href="../ja475162/index.html">Xマクロを最新のC ++コードで使用する</a></li>
<li><a href="../ja475164/index.html">議論：インターネットはオープンソースに依存しています-批評家はどんな議論を持っていますか</a></li>
<li><a href="../ja475166/index.html">エレクトロニクス開発。例のプロジェクト監査。暖かい床をすべてのhabrで保存します</a></li>
<li><a href="../ja475168/index.html">低リスクの為替投資：銀行預金の代わりにIIA口座と債券を使用する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>