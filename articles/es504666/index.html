<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∞ ‚è∞ ü§û DEVOXX Reino Unido. Kubernetes en producci√≥n: implementaci√≥n azul / verde, autoescalado y automatizaci√≥n de implementaci√≥n. Parte 1 üéç üöë üò¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetes es una gran herramienta para ejecutar contenedores Docker en un entorno de producci√≥n en cl√∫ster. Sin embargo, hay tareas que Kubernetes no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DEVOXX Reino Unido. Kubernetes en producci√≥n: implementaci√≥n azul / verde, autoescalado y automatizaci√≥n de implementaci√≥n. Parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/504666/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes es una gran herramienta para ejecutar contenedores Docker en un entorno de producci√≥n en cl√∫ster. Sin embargo, hay tareas que Kubernetes no puede resolver. Con implementaciones frecuentes en un entorno de producci√≥n, necesitamos una implementaci√≥n Azul / Verde totalmente automatizada para evitar el tiempo de inactividad en este proceso, que tambi√©n requiere solicitudes HTTP externas y descarga SSL. Esto requiere integraci√≥n con un equilibrador de carga como ha-proxy. Otra tarea es el escalado semiautom√°tico del cl√∫ster Kubernetes en s√≠ mismo cuando se trabaja en la nube, por ejemplo, la reducci√≥n parcial de la escala del cl√∫ster por la noche.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque Kubernetes no tiene estas caracter√≠sticas listas para usar, proporciona una API que se puede utilizar para resolver estos problemas. Las herramientas de escalado y despliegue automatizado azul / verde de Kubernetes se desarrollaron como parte del proyecto de c√≥digo abierto Cloud RTI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta transcripci√≥n del video describe c√≥mo configurar Kubernetes junto con otros componentes de c√≥digo abierto para obtener un entorno listo para la producci√≥n que acepte el c√≥digo del git commit change commit sin tiempo de inactividad en la producci√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/4y/jm/cy4yjm9zwmpfpvtfwhwfigavpkw.jpeg"><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy hablaremos sobre Kubernetes, en particular, sobre su automatizaci√≥n. Echaremos un vistazo a los conceptos b√°sicos de este sistema y luego veremos c√≥mo integrar Kubernetes en los proyectos en la etapa de desarrollo. Mi nombre es Paul, soy de los Pa√≠ses Bajos, trabajo para una compa√±√≠a llamada Luminis Technologies y soy el autor de los libros "Dise√±o de aplicaciones en la nube con OSGi" y "Modulaci√≥n de Java 9". De lo que hablar√© es muy diferente del tema de estos libros. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el √∫ltimo a√±o, pas√© la mayor parte de mi tiempo trabajando en una plataforma de infraestructura basada en Kubernetes y creando herramientas para ello, principalmente en Golang. Adem√°s, sigo trabajando en el libro de Java 9. Mi pasatiempo es el levantamiento de pesas. As√≠ que vamos al grano.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øPor qu√© cuidar a Kubernetes? En primer lugar, porque le permite ejecutar Docker en cl√∫steres. Si no usa Docker, entonces no est√° en el tema. Si trabaja con Docker, sabe que est√° dise√±ado principalmente para ejecutar contenedores en su propia m√°quina. Mejora el trabajo con muchas redes, sin embargo, todo esto est√° limitado a una m√°quina, por lo que no hay forma de ejecutar contenedores en un cl√∫ster. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-j/vz/o4/-jvzo4f26dwscphdsorfnczffik.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los creadores de Docker est√°n expandiendo constantemente sus capacidades, pero si realmente necesita ejecutar contenedores en producci√≥n, necesitar√° algo como Kubernetes, porque Docker con su l√≠nea de comando no ayudar√°.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hablemos de los conceptos b√°sicos de Kubernetes. Antes de analizar el uso de la API para la automatizaci√≥n, debemos comprender el concepto de c√≥mo funciona esta plataforma. Un cl√∫ster t√≠pico incluye los siguientes elementos. El nodo maestro gestiona y controla el funcionamiento de todo el cl√∫ster y decide d√≥nde se planificar√°n los contenedores y c√≥mo se lanzar√°n. Lanza el servidor API, que es el elemento m√°s importante del trabajo de la plataforma, luego consideraremos este problema en detalle.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/rr/af/vvrraf7malypw8vgucqll1-p3ec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un mont√≥n de nodos de trabajo de Nodo que contienen pods Pods con contenedores Docker y almacenamiento distribuido, etc. Nodes es el lugar donde se ejecutar√°n sus contenedores. Kubernetes no funciona con contenedores Docker directamente, pero utiliza una abstracci√≥n llamada Pod para esto. Los nodos de trabajo lanzan un mont√≥n de contenedores, y el nodo maestro se asegura de que funcionen. Adem√°s, hay un almacenamiento distribuido de tipo clave-valor, etc., que almacena toda la informaci√≥n sobre el cl√∫ster. Etcd es tolerante a fallas, por lo que al menos consta de 3 nodos independientes. Esto garantiza que el asistente funcione sin perder el estado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de iniciar Kubernetes con todos los componentes anteriores, se implementan los contenedores de programaci√≥n. La implementaci√≥n significa que los contenedores comienzan a funcionar en un cl√∫ster. Para hacer esto, antes que nada, necesita un objeto llamado Replication Controller, lanzado en el servidor maestro, que le permite crear y monitorear el estado de varias instancias de hogares.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u-/to/g0/u-tog08sgexmcjn4mn8hkuxdo7s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para configurar el controlador de replicaci√≥n para crear, por ejemplo, 5 r√©plicas de contenedores en cinco nodos de trabajo diferentes, debe tener tantos nodos. Adem√°s del hecho de que el controlador inicia la operaci√≥n de estos contenedores, monitorea su estado. Si por falta de memoria falla uno de los contenedores, el controlador registrar√° una disminuci√≥n en el n√∫mero de 5 a 4 e iniciar√° un nuevo contenedor en uno de los nodos disponibles. Esto significa que cuando Kubernetes se est√° ejecutando, no inicia los contenedores en ning√∫n nodo espec√≠fico, sino que establece el estado requerido: configure la plataforma para implementar 5 contenedores y transfiera el control al controlador de replicaci√≥n, que se encarga de mantener este estado. Por lo tanto, el controlador de replicaci√≥n es un concepto muy importante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dije, Kubernetes no funciona con contenedores directamente. Lo hace a trav√©s de Pod, una abstracci√≥n en la parte superior de los contenedores. Es importante que Kubernetes funcione no solo con contenedores Docker, sino tambi√©n, por ejemplo, con sus contenedores alternativos: rkt. Esto no es soporte oficial, porque si miras la documentaci√≥n t√©cnica de Kubernetes, solo habla de los contenedores Docker. Sin embargo, a medida que se desarrolla la plataforma, se le agrega compatibilidad con contenedores de otros formatos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/bv/m2/qlbvm22buned0-bj3_bvef6ub8e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada parte inferior puede contener muchos contenedores con el mismo ciclo de vida. Esto significa que no podremos ejecutar contenedores para varios prop√≥sitos en el mismo pod, porque todos ellos pueden existir solo en el mismo per√≠odo de tiempo. Comienzan simult√°neamente y simult√°neamente detienen su trabajo. Entonces, si trabaja con microservicios, no puede ponerlos a todos en el mismo sub. Los contenedores dentro del hogar se "ven" entre s√≠ en el host local.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si, por ejemplo, est√° implementando un servicio web, el pod para esta aplicaci√≥n contendr√° el contenedor nginx, y nginx no se modifica, sino que se saca directamente de la caja. Para que este nginx funcione, necesitaremos agregar nuestros propios archivos HTML y colocarlos en un contenedor separado para los archivos web. Ambos contenedores se colocan en un subcom√∫n com√∫n y comienzan a funcionar juntos, como si existieran en la misma m√°quina f√≠sica, por lo que ven archivos del mismo sistema de archivos ubicados en el mismo host local. Los servicios que proporcionan la interacci√≥n de los componentes del cl√∫ster operan utilizando variables de entorno env vars.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo siguiente que proporciona debajo es la creaci√≥n de redes. Si ejecuta varios contenedores en la misma m√°quina f√≠sica, que tambi√©n se pueden ubicar en la nube, y todos estos contenedores usan puertos, por ejemplo, usamos 3 aplicaciones Java que funcionan con el mismo puerto 8080, entonces esto est√° lleno de conflictos. Para evitarlo, necesitar√° la asignaci√≥n de puertos, lo que complicar√° en gran medida el proceso de implementaci√≥n de aplicaciones. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qm/wt/vs/qmwtvs3ose470fyu5kyhkzsnxoq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, ser√≠a genial si cada contenedor lanzado tuviera su propia direcci√≥n IP virtual con acceso a todos los puertos disponibles, sin pensar en su posible conflicto. Esto es exactamente lo que ofrece Kubernetes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada vez que crea un pod, crea su propia direcci√≥n IP virtual. Los puertos no se comparten entre el resto de los pods, por lo que no hay conflicto. Lo √∫nico que funciona en esta direcci√≥n IP es lo que hace este contenedor. Todo se simplifica.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, esto plantea un nuevo problema: si su direcci√≥n IP virtual cambia cada vez que reinicia los contenedores, lo que sucede a menudo, ¬øc√≥mo puede usar estos contenedores? Supongamos que tenemos 2 m√≥dulos diferentes que se comunican entre s√≠, pero sus direcciones IP cambian todo el tiempo. Kubernetes utiliza un concepto llamado servicios para resolver este problema. Estos servicios configuran proxies en la parte superior de sus hogares y contin√∫an usando direcciones IP virtuales de cierto rango, pero estas son direcciones fijas que no cambian todo el tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, cuando los pods quieren comunicarse entre s√≠, lo hacen no directamente, sino a trav√©s de los servicios, utilizando estas direcciones IP fijas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7z/jy/ry/7zjyryqkf6iwxdiyer2_ctwmskm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos servicios organizan el tr√°fico de todas las r√©plicas intercambiadas entre los componentes del cl√∫ster. Por lo tanto, los servicios son muy importantes para garantizar la comunicaci√≥n entre los componentes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El concepto de Servicios facilita enormemente el proceso de implementaci√≥n de m√∫ltiples componentes cuando varios componentes son parte de una aplicaci√≥n m√°s grande, como la arquitectura de microservicios, aunque personalmente no me gusta tratar con microservicios.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k2/qq/7d/k2qq7dl7sikpjzngr_cyukdv68e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada componente que tiene se puede implementar como un sub independiente con su propio ciclo de vida. Son independientes entre s√≠ y tienen espacios de nombres separados, sus propias direcciones IP y rangos de n√∫meros de puerto, se pueden actualizar y escalar de forma independiente. El uso de servicios facilita enormemente la comunicaci√≥n entre componentes. La siguiente diapositiva muestra un ejemplo de aplicaci√≥n de varios componentes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s4/ig/bq/s4igbqyg-ml1e0bpzq07_oslduu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera en Frontend es una interfaz de usuario que utiliza varios servicios de back-end o r√©plicas de servicios de back-end. Ver√° un paquete de varios pods para los cuales los servicios se utilizan como proxy. No debe preocuparse por el rendimiento de cada pod, porque si uno de ellos falla, Kubernetes reiniciar√° autom√°ticamente el nuevo. El servicio de back-end utiliza otros servicios ubicados en diferentes pods, y todos utilizan el concepto de servicios para la interacci√≥n. Todo esto funciona muy bien, por lo que si usa esta arquitectura, Kubernetes puede implementarla f√°cilmente. Si la arquitectura se basa en un principio diferente, puede tener problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente concepto importante a introducir es el espacio de nombres de espacios de nombres.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/kf/nq/mhkfnqcy6wbrez8clmhjedh9se0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos son espacios aislados dentro de Kubernetes que contienen hogares, controladores de replicaci√≥n y servicios. Aislamiento significa, por ejemplo, que cuando el entorno de desarrollo est√° en un espacio de nombres y la producci√≥n est√° en otro, se utilizan servicios con el mismo nombre para evitar conflictos entre diferentes espacios de nombres. De esta manera, puede colocar f√°cilmente diferentes entornos en el mismo cl√∫ster Kubernetes f√≠sico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La implementaci√≥n de la aplicaci√≥n es un paso necesario antes de lanzar la aplicaci√≥n en producci√≥n. La documentaci√≥n de Kubernetes establece que debe usar la herramienta de l√≠nea de comandos kubectl para completar la implementaci√≥n. Esta herramienta se mejora constantemente y es perfecta para implementar cualquier cosa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/xx/kx/_pxxkxumpyndwztbngvhezit08u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ver√° los archivos de configuraci√≥n de yaml que necesita crear para la API utilizando el comando kubectl. La siguiente diapositiva muestra c√≥mo se ve un archivo yaml t√≠pico. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/e2/3u/3ge23une8cdkvl9xhjou_knhpfo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este archivo configuramos el controlador de replicaci√≥n. La primera parte importante es la l√≠nea con el n√∫mero de r√©plicas que queremos replicar: 3. Este n√∫mero es igual al n√∫mero de nodos que se utilizar√°n. En este caso, el n√∫mero 3 significa que queremos ejecutar pods en 3 m√°quinas diferentes en nuestro cl√∫ster. El controlador de replicaci√≥n supervisa el estado del sistema y, si es necesario, reinicia autom√°ticamente los pods para garantizar el funcionamiento continuo de un n√∫mero determinado de r√©plicas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la parte inferior del c√≥digo hay l√≠neas que representan la especificaci√≥n del hogar. Describe los puertos, los nodos de almacenamiento, el nombre y la imagen del servidor web y otra informaci√≥n necesaria para nuestro contenedor Docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, hay un mont√≥n de metadatos aqu√≠, como etiquetas. Las etiquetas son pares clave-valor y se agregan a objetos como pods. Se utilizan para agrupar y seleccionar subconjuntos de objetos. Son muy importantes para organizar las interacciones API, vinculando controladores, pods y servicios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El pod no sabe qu√© controlador de replicaci√≥n lo cre√≥, y el controlador de replicaci√≥n no conoce la lista de pods que crea. Pero tanto los pods como el controlador tienen etiquetas, cuya coincidencia indica que un sub espec√≠fico pertenece a un controlador espec√≠fico. Esta es una conexi√≥n bastante d√©bil, pero flexible, que garantiza el funcionamiento estable de la API y las cosas automatizadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora ver√° una breve demostraci√≥n que muestra el trabajo de kubectl, y luego profundizaremos en el trabajo del equilibrador de carga y el uso de la API. Entonces, entro en el comando kubectl get pods, pero el sistema no muestra hogares porque todav√≠a no hemos ejecutado nada. Luego, ingreso el comando ls para ver una lista de los archivos disponibles.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o-/hk/ep/o-hkep7n2cltgoxhavqlehq_l5i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora ingreso el nombre del primer archivo de la lista y se muestra el archivo de configuraci√≥n yaml, similar al que acabamos de ver. Usemos este archivo para crear un hogar escribiendo kubectl create ‚Äìf nginx-controller.yaml. Como resultado, habremos creado bajo. Al repetir el comando kubectl get pods, puede ver que este funciona. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pq/ke/hb/pqkehb1prgianxodc101qscmbgi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero este es solo uno debajo. Intentemos escalar nuestro controlador creando varias r√©plicas. Para hacer esto, ingreso el comando kubectl scale rc nginx - replicas = 5, donde rc es el controlador de replicaci√≥n, y 5 es el n√∫mero requerido de instancias o r√©plicas de este controlador. Ver√° el progreso de la creaci√≥n de contenedores, y si vuelve a ingresar el comando kubectl get pods despu√©s de un par de segundos, puede ver que la mayor√≠a de los contenedores creados ya han comenzado a funcionar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/rv/bb/curvbbj-qsapsqlbja8jz8ywmu0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, aumentamos el n√∫mero de hogares o r√©plicas que trabajan en nuestro cl√∫ster a 5 copias. </font><font style="vertical-align: inherit;">Adem√°s, por ejemplo, puede echar un vistazo a la direcci√≥n IP creada para la primera r√©plica ingresando el comando kubectl describe pod nginx-772ia. </font><font style="vertical-align: inherit;">Esta es la direcci√≥n IP virtual que se adjunta a este contenedor en particular.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xj/nu/lw/xjnulwtnrrzytonpkxak_chgsy8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Su trabajo ser√° proporcionado por los servicios mencionados anteriormente. </font><font style="vertical-align: inherit;">Veamos qu√© sucede si destruye una de las r√©plicas de trabajo, porque en cualquier caso, debemos garantizar el trabajo de un n√∫mero determinado de copias. </font><font style="vertical-align: inherit;">Entro en el comando kubectl delete pod nginx-772ia y el sistema informa que con ese identificador se ha eliminado. </font><font style="vertical-align: inherit;">Usando el comando kubectl get pods, vemos que 5 instancias de controlador est√°n funcionando nuevamente, y en lugar de la r√©plica remota nginx-772ia, ha aparecido una nueva con el identificador nginx-sunfn.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wo/bx/xj/wobxxjfzhq9y2x-u-bilv6cmw4s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto sucedi√≥ porque Kubernetes not√≥ la falla de una de las r√©plicas. En realidad, esto no fue un mal funcionamiento accidental, sino una acci√≥n deliberada, hasta donde personalmente lo elimin√©. Pero dado que el n√∫mero de r√©plicas especificadas por la configuraci√≥n del cl√∫ster permaneci√≥ sin cambios, el controlador de replicaci√≥n not√≥ la desaparici√≥n de una de las instancias e inmediatamente restaur√≥ el estado requerido del cl√∫ster creando e iniciando un nuevo contenedor con una nueva ID. Por supuesto, este es un ejemplo est√∫pido cuando elimino una r√©plica y espero que el controlador la restaure, pero situaciones similares ocurren en la vida real debido a una falla del contenedor, por ejemplo, debido a la falta de memoria. En este caso, el controlador tambi√©n se reiniciar√° en.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tenemos varios escenarios de producci√≥n en los que la aplicaci√≥n Java no est√° configurada correctamente, por ejemplo, no hay suficiente memoria instalada, esto puede provocar un bloqueo tanto unas pocas horas como una semana despu√©s de que se inicie el programa. En tales casos, Kubernetes se encarga de que el flujo de trabajo no se interrumpa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perm√≠tame recordarle una vez m√°s que todo lo anterior no es aplicable en la etapa de producci√≥n, cuando no debe usar la l√≠nea de comando kubectl y otras cosas ingresadas desde el teclado para garantizar el funcionamiento del producto. Entonces, antes de comenzar a implementar la automatizaci√≥n, necesitamos resolver otro gran problema. Supongamos que tengo un contenedor nginx ejecut√°ndose en este momento, pero no tengo acceso a √©l desde el "mundo exterior". Sin embargo, si se trata de una aplicaci√≥n web, puedo acceder a ella a trav√©s de Internet. Para garantizar la estabilidad de este proceso, se utiliza un equilibrador de carga, que se encuentra en frente del cl√∫ster.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Necesitamos poder administrar los servicios de Kubernetes desde el mundo exterior, y esta caracter√≠stica no se admite autom√°ticamente desde el primer momento. Por ejemplo, para garantizar el equilibrio de HTTP, debe usar la descarga SSL o la carga SSL. Este es el proceso de eliminar el cifrado basado en SSL del tr√°fico entrante que recibe el servidor web para liberar al servidor del descifrado de datos. Para equilibrar el tr√°fico, tambi√©n puede usar la compresi√≥n Gzip de p√°ginas web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las versiones recientes de Kubernetes, como 1.02, tienen una nueva caracter√≠stica llamada Ingress. Sirve para configurar el equilibrador de carga. Este es un nuevo concepto en la API donde puede escribir un complemento que configurar√° cualquier balanceador de carga externo que use.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/ly/ic/nwlyicpw6nmt0chuu48t9a7zlbs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, hoy este concepto no est√° finalizado y se ofrece en la versi√≥n alfa. Puede demostrar c√≥mo funcionar√° en el futuro, pero no coincidir√° con la forma en que funciona hoy. Utilizo el equilibrador proporcionado por Google Cloud Engine, sin embargo, si no trabaja con este servicio, tendr√° que hacer algo usted mismo, al menos en este momento. En el futuro, probablemente en un mes, ser√° mucho m√°s f√°cil: puede usar la funci√≥n de ingreso para equilibrar el tr√°fico.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy, este problema se resuelve creando un equilibrador de tr√°fico personalizado. En primer lugar, puede usar el proxy ha ubicado frente al cl√∫ster de Kubernetes. Se ejecuta fuera del cl√∫ster en una m√°quina externa o un conjunto de m√°quinas. A continuaci√≥n, es necesario proporcionar una configuraci√≥n din√°mica autom√°tica del proxy ha, para no configurarlo manualmente al crear cada nuevo hogar. Se debe realizar un trabajo similar para nginx, Apache y otros servidores, y el ha-proxy act√∫a como una herramienta f√°cil de integrar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente diapositiva muestra c√≥mo el nodo del equilibrador de carga maneja el tr√°fico HTTPS entrante, y el proxy ha se encuentra en una m√°quina externa o grupo de m√°quinas ubicadas fuera del grupo Kubernetes. La carga SSL tambi√©n se encuentra aqu√≠. El proxy detecta las direcciones solicitadas y luego pasa el tr√°fico a los servicios de Kubernetes, sin estar interesado en las direcciones IP de los hogares que pueden cambiar con el tiempo. A continuaci√≥n, los servicios pasan el tr√°fico a pods en ejecuci√≥n con direcciones IP din√°micas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qk/wc/a2/qkwca2qqlvbk3scsv5em8qhhowc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si usa AWS, puede usar el concepto de equilibrador de carga ELB. Elastic Load Balancing redirige el tr√°fico a instancias saludables de Amazon para garantizar la estabilidad de la aplicaci√≥n. Este mecanismo es especialmente bueno si necesita escalabilidad del equilibrador de carga.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/27/au/6v/27au6v9dwa5zljlmv8rjsuynh6m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, el tr√°fico se env√≠a primero al servicio de AWS, donde se descarga SSL, luego de lo cual ingresa al nodo del equilibrador de carga de proxy ha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede hacer lo mismo si sus cl√∫steres est√°n completamente dentro de una red VPN virtual privada. En este caso, el uso de AWS ELB garantiza por completo la seguridad del sistema. No necesita implementar SSL entre varios componentes fuera del cl√∫ster. Lo √∫nico que se conectar√° con el mundo exterior es nuestro proxy proxy.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/kn/gi/gakngiqkuudm2sdiv7txownahuc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conceptualmente, parece bastante simple, pero ¬øc√≥mo funciona en realidad? ¬øC√≥mo configuro un proxy ha para que conozca los servicios de Kubernetes? Si observa ha-proxy de la misma manera que consideramos nginx, notar√° que todav√≠a utiliza archivos de configuraci√≥n est√°ticos. Entonces, si desea agregarle un nuevo back-end, que en este caso son nuestros servicios de Kubernetes, debemos cambiar el archivo de configuraci√≥n, volver a cargar ha-proxy y solo despu√©s de eso todo funcionar√° como deber√≠a. Por supuesto, no queremos hacer esto manualmente. Por lo tanto, puede usar una peque√±a herramienta de c√≥digo abierto llamada Confd, que administra los archivos de configuraci√≥n de la aplicaci√≥n local utilizando datos de etcd. Si se producen cambios en el almac√©n de metadatos, etc., Confd genera autom√°ticamente una plantilla de configuraci√≥n,que reconfigura el proxy ha de acuerdo con las nuevas condiciones de trabajo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede parecer que este enfoque requiere esfuerzos adicionales, sin embargo, es una herramienta muy simple que funciona con plantillas, por lo que su uso es una tarea bastante trivial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
26:00 min. La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
continuaci√≥n ser√° muy pronto ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-Ci4vd4rh4M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco de publicidad :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por estar con nosotros. ¬øTe gustan nuestros art√≠culos? ¬øQuieres ver m√°s materiales interesantes? Ap√≥yenos haciendo un pedido o recomendando a sus amigos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS en la nube para desarrolladores desde $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an√°logo √∫nico de servidores de nivel b√°sico que inventamos para usted: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o c√≥mo dividir el servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 veces m√°s barato en el centro de datos Equinix Tier IV en Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solo tenemos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los Pa√≠ses Bajos.</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - ¬°desde $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lea sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥mo construir un edificio de infraestructura. </font><font style="vertical-align: inherit;">clase c con servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es504656/index.html">Abr√≥chense los cinturones de seguridad: c√≥mo cambiar√° la industria de la nube</a></li>
<li><a href="../es504658/index.html">Por qu√© Yota es un operador inconveniente y qu√© se puede hacer mejor</a></li>
<li><a href="../es504660/index.html">Princess Frog 2.0, tambi√©n conocido como Pelophylax ridibundus</a></li>
<li><a href="../es504662/index.html">Dibujar m√∫sica: baile de ata√∫d en Pure Data</a></li>
<li><a href="../es504664/index.html">Adici√≥n inteligente de grupos musicales a Google Sheets a trav√©s de VK API, Tampermonkey y Telegram bot</a></li>
<li><a href="../fr486176/index.html">M√©mo de correspondance par e-mail d'entreprise</a></li>
<li><a href="../fr486178/index.html">FOSS News No. 1 - revue des nouvelles gratuites et open source du 27 janvier au 2 f√©vrier 2020</a></li>
<li><a href="../fr486180/index.html">Conseils et sources pour cr√©er des applications sans serveur</a></li>
<li><a href="../fr486184/index.html">Comment utiliser efficacement la recherche</a></li>
<li><a href="../fr486186/index.html">Nuage catastrophique: comment cela fonctionne</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>