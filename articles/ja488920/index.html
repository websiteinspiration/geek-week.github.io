<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌟 👨🏽‍⚕️ 🖕 KubernetesのKafkaクラスターの適切なサイズを決定する 🍥 🍭 👸🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="注意ペレフ。：この記事では、Banzai Cloudが、Kubernetes内でのKafkaの操作を容易にするための特別なユーティリティの使用例を紹介しています。これらの手順は、最適なインフラストラクチャサイズを決定し、必要なスループットを達成するためにKafka自体を構成する方法を示しています。
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>KubernetesのKafkaクラスターの適切なサイズを決定する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/488920/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意ペレフ。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：この記事では、Banzai Cloudが、Kubernetes内でのKafkaの操作を容易にするための特別なユーティリティの使用例を紹介しています。これらの手順は、最適なインフラストラクチャサイズを決定し、必要なスループットを達成するためにKafka自体を構成する方法を示しています。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/hw/a_/x4/hwa_x4pat6hztyyuh8lorl015pq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apache Kafkaは、信頼性が高く、スケーラブルで高性能なリアルタイムストリーミングシステムを作成するための分散ストリーミングプラットフォームです。その印象的な機能は、Kubernetesで拡張できます。これを行うために、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kafka Open Sourceオペレーター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"> Supertubes</font></a><font style="vertical-align: inherit;">というツール</font><font style="vertical-align: inherit;">を開発し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらを使用すると、KubernetesでKafkaを実行し、ブローカーの構成の微調整、リバランスを伴うメトリックに基づくスケーリング、ラック認識（ハードウェアリソースの認識）、「ソフト」</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（優雅な）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローリング更新</font><font style="vertical-align: inherit;">などのさまざまな機能を使用できます</font><font style="vertical-align: inherit;">。</font></font><a name="habracut"></a><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスタでSupertubesを試してください：</font></font><br>
<br>
<pre><code class="bash hljs">curl https://getsupertubes.sh | sh  supertubes install -a --no-democluster --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">SupertubesとKafkaオペレーターの助けを借りて自動化されているKafkaのいくつかの機能について読むこともできます。</font><font style="vertical-align: inherit;">それらについてはブログですでに書いています：</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大野！</font><font style="vertical-align: inherit;">Kubernetesのさらに別のKafkaオペレーター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheusメトリックスに基づいてKafkaを監視および操作します</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubernetesでのKafkaラックの認識</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Istio上でのApache Kafkaの実行-ベンチマーク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー認証され、Kafkaオペレーターを使用してクラスターをアクセス制御し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KafkaのローリングアップグレードとKubernetesでの動的構成</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッシュ化されたKafkaのEnvoyプロトコルフィルター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KafkaクラスターをKubernetesにデプロイすることを決定した場合、基盤となるインフラストラクチャの最適なサイズを決定する問題と、帯域幅要件を満たすためにKafka構成を微調整する必要が生じる可能性があります。</font><font style="vertical-align: inherit;">各ブローカーの最大パフォーマンスは、メモリー、プロセッサー、ディスク速度、ネットワーク帯域幅など、コアのインフラストラクチャコンポーネントのパフォーマンスによって決まります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理想的には、ブローカーの構成は、インフラストラクチャーのすべての要素がその機能を最大限に活用できるようにする必要があります。ただし、実際には、この設定は非常に複雑です。ユーザーは、1つまたは2つのコンポーネント（ディスク、メモリ、またはプロセッサ）の使用を最大化するようにブローカーを構成する可能性が高くなります。一般的に言って、ブローカーは、その構成で最も遅いコンポーネントを「完全に」使用できる場合に、最大のパフォーマンスを示します。したがって、1つのブローカーが処理できる負荷の概算を得ることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理論的には、特定の負荷で作業するために必要なブローカーの数を推定することもできます。ただし、実際には、さまざまなレベルで非常に多くの構成オプションがあるため、特定の構成の潜在的なパフォーマンスを評価することは（不可能ではないにしても）非常に困難です。つまり、特定のパフォーマンスから始めて構成を計画することは非常に困難です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supertubesユーザーの場合、通常、次のアプローチを使用します。いくつかの構成（インフラストラクチャ+設定）から始めて、そのパフォーマンスを測定し、ブローカー設定を調整して、プロセスを繰り返します。これは、最も遅いインフラストラクチャコンポーネントの可能性が十分に活用されるまで発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようにして、特定の負荷に対処するためにクラスターが必要とするブローカーの数が明確になります（ブローカーの数は、安定性を確保するためのメッセージレプリカの最小数、パーティションリーダーの数など、他の要因にも依存します）。さらに、どのインフラストラクチャコンポーネントの垂直スケーリングが必要であるかというアイデアが得られます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、初期構成で最も遅いコンポーネントから「すべてを絞り込み」、Kafkaクラスターのスループットを測定するために実行する手順について説明します。復元力の高い構成には、少なくとも3つのブローカーが必要です（</font></font><code>min.insync.replicas=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）3つの異なるアクセシビリティゾーンで間隔を空けます。</font><font style="vertical-align: inherit;">-構成し、規模やKubernetesインフラを監視するために、我々は我々自身のハイブリッドのクラウドコンテナ管理プラットフォームを使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パイプラインを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">オンプレミス（ベアメタル、VMware）と5種類のクラウド（Alibaba、AWS、Azure、Google、Oracle）、およびそれらの任意の組み合わせをサポートしています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kafkaクラスターのインフラストラクチャーと構成についての考え</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下の例では、クラウドサービスプロバイダーとしてAWSを、KubernetesディストリビューションとしてEKSを選択しました。</font><font style="vertical-align: inherit;">CNCFによって認定されたBanzai CloudのKubernetesディストリビューションである</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">して</font></a><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">同様の構成を実装できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスク</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amazonは、さまざまな</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプのEBSボリュームを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供しています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">SSDは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基盤です</font><font style="vertical-align: inherit;">が、高いスループットを確保するために、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は累積されたローン</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（I / Oクレジット）を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消費する</font><font style="vertical-align: inherit;">ため</font><font style="vertical-align: inherit;">、安定した高いスループットを提供</font><font style="vertical-align: inherit;">する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプを優先し</font><i><font style="vertical-align: inherit;">ました</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスタイプ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kafkaのパフォーマンスはオペレーティングシステムのページキャッシュに大きく依存するため、ブローカー（JVM）とページキャッシュに十分なメモリを備えたインスタンスが必要です。インスタンス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.2xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、16 GBのメモリを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">備え、EBSでの作業用に最適化されているため</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、良いスタート</font><font style="vertical-align: inherit;">です。その欠点は、最大のパフォーマンスを24時間ごとに30分以下で提供できることです。ワークロードが長期間にわたって最大のパフォーマンスを必要とする場合は、他のタイプのインスタンスを確認してください。ちょうどそれを行い、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で停止し</font><i><font style="vertical-align: inherit;">ました</font></i><font style="vertical-align: inherit;">。最大スループットは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">593.75 Mb /秒です。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">EBS </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1ボリューム</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の最大スループットは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンス</font><font style="vertical-align: inherit;">の最大スループット</font><font style="vertical-align: inherit;">よりも高い</font><font style="vertical-align: inherit;">ため、最も遅いインフラストラクチャ要素は、おそらくこのタイプのインスタンスのI / Oスループットです（これは、負荷テストの結果でも確認する必要があります）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通信網</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワーク帯域幅は、VMインスタンスやディスクのパフォーマンスと比べてかなり大きいはずです。そうしないと、ネットワークがボトルネックになります。</font><font style="vertical-align: inherit;">今回のケースでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークインターフェイス</font><font style="vertical-align: inherit;">は最大10 Gb /秒の速度をサポートします。これは、VMのI / Oインスタンスの帯域幅よりも大幅に高い速度です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブローカーの配置</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブローカーは、プロセッサー、メモリ、ネットワーク、ディスクリソースに関する他のプロセスとの競合を回避するために、専用ノードにデプロイ（Kubernetesで計画）する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javaバージョン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
論理的な選択はJava 11です。これは、ブローカーが実行されるコンテナーで使用可能なプロセッサーとメモリーをJVMが正しく決定するという意味で、Dockerと互換性があるためです。</font><font style="vertical-align: inherit;">プロセッサの制限が重要であることを知って、JVMはGCスレッドとJITコンパイラスレッドの数を内部的かつ透過的に設定します。</font></font><code>banzaicloud/kafka:2.13-2.4.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 11では、Kafkaバージョン2.4.0（Scala 2.13）を含む</font><font style="vertical-align: inherit;">Kafkaイメージを使用しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubernetesでのJava / JVMの詳細については、以下の出版物をご覧ください。</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜJavaアプリケーションがOOMKilledです</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 10アプリケーションのコンテナーのサイズを正しく設定する方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブローカーのメモリ設定</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブローカーのメモリの設定には、JVMとKubernetesポッドの2つの重要な側面があります。</font><font style="vertical-align: inherit;">ポッドに設定されたメモリ制限は、JVMが独自のメモリ内のJavaメタスペースとKafkaがアクティブに使用しているオペレーティングシステムのページキャッシュに十分なスペースを確保できるように、最大​​ヒープサイズよりも大きくする必要があります。</font><font style="vertical-align: inherit;">テストでは、パラメーターを使用してKafkaブローカーを実行しまし</font></font><code>-Xmx4G -Xms2G</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た</font></font><code>10 Gi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ポッドのメモリ制限はでした</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">JVMのメモリ設定</font><font style="vertical-align: inherit;">は、ポッドのメモリ制限に基づいて、</font></font><code>-XX:MaxRAMPercentage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font><font style="vertical-align: inherit;">を使用</font><font style="vertical-align: inherit;">して</font><font style="vertical-align: inherit;">自動的に取得できることに注意してください</font></font><code>-X:MinRAMPercentage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブローカープロセッサの設定</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に言えば、Kafkaが使用するスレッドの数を増やすことで同時実行性を高めることにより、生産性を高めることができます。</font><font style="vertical-align: inherit;">Kafkaで使用できるプロセッサーの数が多いほど、優れています。</font><font style="vertical-align: inherit;">テストでは、6つのプロセッサの制限から始め、徐々に（反復して）その数を15に増やしました。さらに</font></font><code>num.network.threads=12</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ネットワークからデータを受信して​​送信するストリームの数を増やすようにブローカー設定を設定しました。</font><font style="vertical-align: inherit;">フォロワーブローカーはレプリカを十分に速く受信できないことをすぐに発見したため、フォロワーブローカーが</font></font><code>num.replica.fetchers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リーダーからのメッセージを複製する速度を</font><font style="vertical-align: inherit;">上げる</font><font style="vertical-align: inherit;">ために4に引き上げました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負荷生成ツール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
選択したロードジェネレーターのポテンシャルが、ベンチマークが実行されているKafkaクラスターが最大ロードに達する前に実行されないようにしてください。</font><font style="vertical-align: inherit;">つまり、負荷生成ツールの機能を事前に評価し、十分な数のプロセッサとメモリを備えたインスタンスタイプを選択する必要があります。</font><font style="vertical-align: inherit;">この場合、私たちのツールは、Kafkaクラスターが消化できるよりも多くの負荷を生成します。</font><font style="vertical-align: inherit;">多くの実験の後、私たちは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlargeの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3つのコピーに</font><i><font style="vertical-align: inherit;">落ち着き</font></i><font style="vertical-align: inherit;">、それぞれにジェネレーターが起動されました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベンチマーク</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンス測定は、次の手順を含む反復プロセスです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> インフラストラクチャのセットアップ（EKSクラスター、Kafkaクラスター、負荷生成ツール、PrometheusおよびGrafana）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 収集されたパフォーマンスインジケーターのランダムな偏差をフィルターするために、特定の期間の負荷生成。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 観察されたパフォーマンス指標に基づいて、ブローカーのインフラストラクチャーと構成を微調整します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なレベルのKafkaクラスター帯域幅に達するまでこのプロセスを繰り返します。</font><font style="vertical-align: inherit;">同時に、安定した再現性があり、帯域幅の変動が最小限である必要があります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のセクションでは、ベンチマークテストクラスター中に実行された手順について説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のツールを使用して、基本構成、負荷生成、およびパフォーマンス測定をすばやく展開しました。</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Banzai Cloud Pipeline</a>    EKS  Amazon c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Prometheus</a> (   Kafka  )  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Grafana</a> (   ).   <b></b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Pipeline</a> ,    ,   ,  ,   ,      .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Sangrenel</a> —      Kafka.</li>
<li>  Grafana    Kafka  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Kubernetes Kafka</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Node Exporter</a>.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubernetesでKafkaクラスターを構成する最も簡単な方法のためのSupertubes CLI。</font><font style="vertical-align: inherit;">Zookeeper、Kafkaオペレーター、Envoy、およびその他の多くのコンポーネントがインストールされ、Kubernetesで本番稼働の準備ができているKafkaクラスターを実行するように適切に構成されています。</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supertubes CLI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をインストールする</font><i><font style="vertical-align: inherit;">に</font></i><font style="vertical-align: inherit;">は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記載さ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">れて</font></a><font style="vertical-align: inherit;">いる手順を使用し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font></li>
</ul></li>
</ul><br>
<img src="https://habrastorage.org/webt/98/xv/7i/98xv7iy-cxitdjo3xakipblgp5u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EKSクラスター</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kafkaブローカーを備えたポッドのさまざまな可用性ゾーンに</font><font style="vertical-align: inherit;">
専用の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c5.4xlarge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作業ノードを備えたEKSクラスターと</font><font style="vertical-align: inherit;">、負荷ジェネレーターとモニタリングインフラストラクチャ用の専用ノードを</font><font style="vertical-align: inherit;">準備し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">banzai cluster create -f https://raw.githubusercontent.com/banzaicloud/kafka-operator/master/docs/benchmarks/infrastructure/cluster_eks_202001.json</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EKSクラスターが稼働しているときに、その統合</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監視サービスを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有効</font><font style="vertical-align: inherit;">にします。クラスターにPrometheusとGrafanaがデプロイされます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kafkaシステムコンポーネント</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supertubes CLIを使用して、Kafkaシステムコンポーネント（Zookeeper、kafka-operator）をEKSにインストールします。</font></font><br>
<br>
<pre><code class="bash hljs">supertubes install -a --no-democluster --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カフカクラスター</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトでは、EKSは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gp2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBS </font><i><font style="vertical-align: inherit;">ボリューム</font></i><font style="vertical-align: inherit;">を使用する</font><font style="vertical-align: inherit;">ため、Kafkaクラスターの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボリューム</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">基づいて別のストレージクラスを作成する必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="plaintext hljs">kubectl create -f - &lt;&lt;EOF<font></font>
apiVersion: storage.k8s.io/v1<font></font>
kind: StorageClass<font></font>
metadata:<font></font>
  name: fast-ssd<font></font>
provisioner: kubernetes.io/aws-ebs<font></font>
parameters:<font></font>
  type: io1<font></font>
  iopsPerGB: "50"<font></font>
  fsType: ext4<font></font>
volumeBindingMode: WaitForFirstConsumer<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブローカーのパラメーターを設定し、</font></font><code>min.insync.replicas=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3つの異なる可用性ゾーンのノードにブローカーポッドをデプロイします。</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f https://raw.githubusercontent.com/banzaicloud/kafka-operator/master/docs/benchmarks/infrastructure/kafka_202001_3brokers.yaml --<span class="hljs-built_in">wait</span> --timeout 600</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トピック</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Load Generatorの3つのインスタンスを同時に起動しました。</font><font style="vertical-align: inherit;">それぞれが独自のトピックで書き込みます。つまり、必要なのは3つのトピックだけです。</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
  name: perftest1<font></font>
spec:<font></font>
  name: perftest1<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF<font></font>
<font></font>
supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
    name: perftest2<font></font>
spec:<font></font>
  name: perftest2<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF<font></font>
<font></font>
supertubes cluster topic create -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt; -f -&lt;&lt;EOF<font></font>
apiVersion: kafka.banzaicloud.io/v1alpha1<font></font>
kind: KafkaTopic<font></font>
metadata:<font></font>
  name: perftest3<font></font>
spec:<font></font>
  name: perftest3<font></font>
  partitions: 12<font></font>
  replicationFactor: 3<font></font>
  retention.ms: <span class="hljs-string">'28800000'</span><font></font>
  cleanup.policy: delete<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各トピックのレプリケーション係数は3です。これは、高可用性の運用システムの最小推奨値です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負荷生成ツール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Load Generatorの3つのインスタンスを起動しました（それぞれ別のトピックで書きました）。</font><font style="vertical-align: inherit;">Load Generatorのポッドについては、それらに割り当てられたノードでのみ計画されるように、ノードアフィニティを登録する必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: extensions/v1beta1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  labels:<font></font>
    app: loadtest<font></font>
  name: perf-load1<font></font>
  namespace: kafka<font></font>
spec:<font></font>
  progressDeadlineSeconds: 600<font></font>
  replicas: 1<font></font>
  revisionHistoryLimit: 10<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      app: loadtest<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      creationTimestamp: null<font></font>
      labels:<font></font>
        app: loadtest<font></font>
    spec:<font></font>
      affinity:<font></font>
        nodeAffinity:<font></font>
          requiredDuringSchedulingIgnoredDuringExecution:<font></font>
            nodeSelectorTerms:<font></font>
            - matchExpressions:<font></font>
              - key: nodepool.banzaicloud.io/name<font></font>
                operator: In<font></font>
                values:<font></font>
                - loadgen<font></font>
      containers:<font></font>
      - args:<font></font>
        - -brokers=kafka-0:29092,kafka-1:29092,kafka-2:29092,kafka-3:29092<font></font>
        - -topic=perftest1<font></font>
        - -required-acks=all<font></font>
        - -message-size=512<font></font>
        - -workers=20<font></font>
        image: banzaicloud/perfload:0.1.0-blog<font></font>
        imagePullPolicy: Always<font></font>
        name: sangrenel<font></font>
        resources:<font></font>
          limits:<font></font>
            cpu: 2<font></font>
            memory: 1Gi<font></font>
          requests:<font></font>
            cpu: 2<font></font>
            memory: 1Gi<font></font>
        terminationMessagePath: /dev/termination-log<font></font>
        terminationMessagePolicy: File<font></font>
      dnsPolicy: ClusterFirst<font></font>
      restartPolicy: Always<font></font>
      schedulerName: default-scheduler<font></font>
      securityContext: {}<font></font>
      terminationGracePeriodSeconds: 30</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意すべきいくつかのポイント：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 負荷ジェネレーターは512バイトのメッセージを生成し、それらを500メッセージのバッチでKafkaに公開します。</font></font></li>
<li>    <code>-required-acks=all</code>   ,          Kafka.  ,          ,  ,    ,  .           <i>(consumers)</i>   ,       ,       ,   .</li>
<li>     20 worker' (<code>-workers=20</code>).  worker  5 producer',     worker'   Kafka.      100 producer',        Kafka.</li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスター監視</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kafkaクラスターのストレステスト中に、ポッドの再起動、非同期レプリカ、および最小限の変動による最大スループットがないことを確認するために、その状態も監視しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負荷ジェネレーターは、パブリッシュされたメッセージの数とエラーのレベルに関する標準統計を書き込みます。</font><font style="vertical-align: inherit;">エラーのパーセンテージはこの値のままにする必要があります</font></font><code>0,00%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kafka-operatorによってデプロイされた</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Cruise Control</font></a><font style="vertical-align: inherit;">は、クラスターの状態を監視できるダッシュボードを提供します。</font><font style="vertical-align: inherit;">このパネルを表示するには、次のようにします。</font></font><br>
<br>
<pre><code class="bash hljs">supertubes cluster cruisecontrol show -n kafka --kubeconfig &lt;path-to-eks-cluster-kubeconfig-file&gt;</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">縮小と拡張</font><font style="vertical-align: inherit;">のISRレベル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（同期レプリカ数）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は0です。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">測定結果</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3つのブローカー、メッセージサイズ-512バイト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
均等に3つのブローカに分散パーティションで、我々はのパフォーマンスを達成するために管理</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">〜500メガビット/秒（毎秒約99万のメッセージ）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/5s/kk/ql5skk9eq59vw1dxiptnpv5baoo.png"><br>
<br>
<img src="https://habrastorage.org/webt/ye/cg/rc/yecgrcrh-mrdchebbysisw4mg3a.png"><br>
<br>
<img src="https://habrastorage.org/webt/5i/t6/it/5it6itlq4hfnndz2f-refjm1sbq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JVM仮想マシンのメモリ消費が2 GBを超えることはできませんでした：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pc/_s/-f/pc_s-fapugnsmx114p1rssgst8m.png"><br>
<br>
<img src="https://habrastorage.org/webt/2e/1-/qw/2e1-qwc0rb2fqk_bw_hkgr0jbl8.png"><br>
<br>
<img src="https://habrastorage.org/webt/m-/tr/nw/m-trnwodxrqpftqhnrnp35f25cy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスク帯域幅が最大に達したのI / O帯域幅ブローカーが取り組んだ3つのインスタンスすべてのノード：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/tx/tg/trtxtgaqntrbc_bwrxmxmxh9opu.png"><br>
<br>
<img src="https://habrastorage.org/webt/_k/ns/dh/_knsdhmjkkc2245qffym_pnkxge.png"><br>
<br>
<img src="https://habrastorage.org/webt/rq/xo/8x/rqxo8xwg5dualnt3uqt2jxmfeta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ノードによるメモリ使用量のデータから、システムのバッファリングとキャッシュに約10〜15 GBを使用したことがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p3/ls/r6/p3lsr6ixa3wx0zfeowuqo_qlpq0.png"><br>
<br>
<img src="https://habrastorage.org/webt/aq/tn/fd/aqtnfdsjnp33e3buy5dxkrvojg4.png"><br>
<br>
<img src="https://habrastorage.org/webt/pi/aa/iv/piaaivarggmqsqiopmtx_doi4tg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3つのブローカー、メッセージサイズ-100バイト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メッセージサイズが減少すると、スループットは約15〜20％減少します。各メッセージの処理に費やされる時間が影響を受けます。</font><font style="vertical-align: inherit;">さらに、プロセッサの負荷はほぼ2倍になりました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mp/9l/9l/mp9l9lcmuwuh866dce_v0puzrt0.png"><br>
<br>
<img src="https://habrastorage.org/webt/z0/ck/hd/z0ckhdrst6iqql9i5drcksb7y7i.png"><br>
<br>
<img src="https://habrastorage.org/webt/hu/dg/dp/hudgdpo3e8s0ft0zxd7tngwne3y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブローカーノードにはまだ未使用のカーネルがあるため、Kafkaの構成を変更することでパフォーマンスを向上させることができます。</font><font style="vertical-align: inherit;">これは簡単な作業ではないため、スループットを向上させるには、より大きなメッセージで作業することをお勧めします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4つのブローカー、メッセージサイズ-512バイト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいブローカーを追加してパーティションのバランスを維持するだけで、Kafkaクラスターのパフォーマンスを簡単に向上させることができます（これにより、ブローカー間の負荷分散も保証されます）。</font><font style="vertical-align: inherit;">私たちの場合、ブローカーを追加した後、クラスターのスループットは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">約580 Mb / s（1秒あたり約110万メッセージ）に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">増加しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">成長は予想よりも小さいことが判明しました。これは主にパーティションの不均衡が原因です（すべてのブローカーが機会のピークで機能するわけではありません）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8x/cs/nq/8xcsnqeafi6tom_rxrbb5jz1zmk.png"><br>
<br>
<img src="https://habrastorage.org/webt/_2/qm/2j/_2qm2jqmcig_qwnypgirtzwcnw0.png"><br>
<br>
<img src="https://habrastorage.org/webt/zn/vx/jm/znvxjmy9hpxm3c29l-x616hfyfa.png"><br>
<br>
<img src="https://habrastorage.org/webt/gm/mt/sc/gmmtscxckvpwqr3ypzmkz45jscu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JVMマシンによるメモリ消費量は2 GB未満のままです：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/a7/w7/qh/a7w7qh73p6ug6ozgqksh224fanc.png"><br>
<br>
<img src="https://habrastorage.org/webt/pe/cn/gs/pecngsl4nhacfu1drnmevl3p96q.png"><br>
<br>
<img src="https://habrastorage.org/webt/ee/vh/ei/eevheiyiaf_sxnw8epxlsnizxak.png"><br>
<br>
<img src="https://habrastorage.org/webt/lz/gj/lb/lzgjlblbytxjujal32u1nmgjixo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーティションの不均衡は、ドライブを備えたブローカーの操作に影響しました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4w/ga/3j/4wga3j3ogq8d_pesoite7ln9alk.png"><br>
<br>
<img src="https://habrastorage.org/webt/jb/sh/rl/jbshrlplduwv4xrnfdhab65auy8.png"><br>
<br>
<img src="https://habrastorage.org/webt/3r/dw/ox/3rdwox-qntdekifec-vuoooozuc.png"><br>
<br>
<img src="https://habrastorage.org/webt/oz/ux/cd/ozuxcdtsqz-rfgwmun8iljtgxcq.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の反復アプローチは、数百のコンシューマー、パーティションの分割、ローリング更新、ポッドの再起動などを含む、より複雑なシナリオをカバーするように拡張できます。これらすべてにより、さまざまな条件でのKafkaクラスターの機能の制限を評価し、その作業のボトルネックを特定し、それらに対処する方法を見つけることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはSupertubeを開発して、クラスターを迅速かつ簡単にデプロイし、それを構成し、ブローカーとトピックを追加/削除し、アラートに応答し、Kafbernetes全体でKafkaが適切に機能するようにしました。私たちの目標は、メインタスク（「生成」と「消費」のKafkaメッセージ）に集中できるようにし、SupertubesとKafkaオペレーターにすべてのハードワークを提供することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バンザイクラウドテクノロジーとオープンソースプロジェクトに興味がある場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinkedIn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitterで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会社に登録して</font><font style="vertical-align: inherit;">ください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳者からのPS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのブログも読んでください：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K8sのRedisオペレーターと、このデータベースからのデータを分析するためのユーティリティのミニオーバービュー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesへの妨げのないRabbitMQの移行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoreOSのZetcd：ZooKeeperを...ストレージetcdに置き換え</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。"</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja488908/index.html">KPIコピーライター、またはスタッフとフリーランサーに関するリモート作成者の作業評価の機能</a></li>
<li><a href="../ja488910/index.html">本「愛と数学。隠された現実の中心</a></li>
<li><a href="../ja488912/index.html">Python Newsビットコイン価格予測</a></li>
<li><a href="../ja488916/index.html">カスケード：落ちる猫の問題</a></li>
<li><a href="../ja488918/index.html">データエンジニアか死ぬか：単一の開発者ストーリー</a></li>
<li><a href="../ja488926/index.html">Microsoft AIエンジニア向けの5つの無料コース</a></li>
<li><a href="../ja488928/index.html">「自分でグーグルイット」するのが私たちの方法ではなく、テクニカルサポートのためにナレッジベースをアップグレードする方法</a></li>
<li><a href="../ja488930/index.html">コンピュータの電源が入らない？視覚障害者および聴覚障害者のためのテクニカルサポート</a></li>
<li><a href="../ja488936/index.html">ファンの沈黙。Google Colab、Javascript、TensorflowJS</a></li>
<li><a href="../ja488942/index.html">UXイーターとチームのためのアーティファクト：それは何か、なぜそれらが必要で、どのように選択するか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>