<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📎 🚴🏼 🧓🏿 I am an Android developer and I didn’t like to do manual work. 🚚 🐧 👩🏽‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I settled in Skyeng, the sun was shining a little brighter, the grass was not greener (it was the same early spring), and the team leader asked m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>I am an Android developer and I didn’t like to do manual work.</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skyeng/blog/490784/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When I settled in Skyeng, the sun was shining a little brighter, the grass was not greener (it was the same early spring), and the team leader asked me to write to Jira how much time was spent on coding, and how much talk and review. At least once every two weeks. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p0/gd/rw/p0gdrwyypbzz6wn81ybvknbmohq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Based on these data, we are trying to understand whether it is necessary to adjust the estimates and whether there are problems in communication in the team,” they said. But who such a “babayka” was never told.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we are all remote workers, the idea sounded reasonable. And it became interesting to me where these eight hours had gone: here they were, but for what exactly? However, logging was unusual. And in general laziness. Then I decided to look for something that would keep working for me. And in the process of research, I got a little carried away and wrote my plugin for IntelliJ IDEA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Below you will find</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subjective review of finished tools and my bike</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (with source).</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I study the solutions that the team uses</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing I did was go to find out from my colleagues who uses what. </font><font style="vertical-align: inherit;">The options are approximately the following:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clockify</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - one button to rule everything</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do you need time for coding or writing docks? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will add a button (a fairly unobtrusive gray pacman) almost anywhere.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yy/9-/ic/yy9-icorb-pi37wptn9yh7wxtxk.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So it looks in Google Docs</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/1k/tf/m0/1ktfm0ax7-xl9rmwtlq9jvwtgec.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And on GitHub</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
you can admire Natrekannyi on a dashboard, or you can import into a table and drop it into Jira. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/js/bf/6h/jsbf6htyizodd76lwvq5hbzuqhy.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration into Jira is supplied separately, also by </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">browser extension.</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
However, it is possible to upload a table with worklogs obtained from Clockify to your working calendar. </font><font style="vertical-align: inherit;">And for time tracking offline there are desktop applications for windows, linux and mac. </font><font style="vertical-align: inherit;">Mobile apps too. </font><font style="vertical-align: inherit;">The main functionality is free, but there are several tariff plans with goodies like privacy, reminders and templates for projects.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toggl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , just Toggl</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is about the same, but a little more goodies - for example, in a desktop application, you can set yourself reminders about time logging, turn on pomodoro mode, there is even the opportunity to link a specific application to a specific project and set up auto tracking.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hl/yp/sv/hlypsvcpl66hldse0c4ayfhkmzi.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But there is a nuance: on the first day of use I was amazed by this window and notifications with reminders. </font><font style="vertical-align: inherit;">Although the theory sounded cool)</font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Toggl + </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python script</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : when just a button is no longer enough</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The invention of my colleague. </font><font style="vertical-align: inherit;">Somehow, he decided to reduce the gestures for exporting tables to Jira and shifted the unloading of taxation in Toggl to a script. </font><font style="vertical-align: inherit;">You can put in a cron and enjoy life.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wakatime</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - where we go, no buttons needed</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Logs everything himself. Therefore, the first thing to remember when connecting its browser extension is blacklist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to extensions, it provides several integrations and a decent number of plugins for the most common IDEs and editors. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xz/4u/uk/xz4uuk51xsdjdkemxh-ichx8ceg.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plugins for the IDE track the time spent both in a specific git branch and in a specific file. On the screen, the list of available ones is very impressive. Serenyk - “in the plans”, for their speedy implementation, you can vote. Some plugins in a paid subscription for $ 9 per month.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, on the dashboard, you can see how much time is spent as a percentage on writing code in different languages: if you remember that a regular android project involves the use of Kotlin, Java, Groovy and xml - this makes sense to itself). </font><font style="vertical-align: inherit;">And if you work with the installed plugin for a while, you will notice that it is rather ruthless: the dashboard gets the time of active reading and writing code. </font><font style="vertical-align: inherit;">And sticking does not get into the monitor with a glass look. </font><font style="vertical-align: inherit;">Needless to say, an amateur.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hmm, the source code for WakaTime is open: you can try to understand how it works ...</font></font></b><div class="spoiler_text">  , ?           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">   IDE  JetBrains</a>. <br>
<br>
 .     WakaTime.java.    ,         ,    Heartbeat (),   WakaTime CLI    .      , , ,       . <br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Writing your bike by analogy</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhaps a potato gun would be more useful, but you won’t do anything for research purposes. After meditating on the WakaTime sources, I decided to create my own plug-in that can track activity in the IDE, log the time for writing, and send it all to Jira (in our flow, the branches are named after the tasks in Jira, so it looks quite realistic). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And in order not to fill the server with requests while working on the code, we will send the logs when Android Studio is closed, and until that moment store it locally.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. What entities can we find in the source code of the plugin (and use in our own)?</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We do not use Components (this is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legacy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which previously were the main structural units of the plugin. May be application level, project level, or module level. There is an ApplicationComponent in the WakaTime source, but they can, the source code is already five years old and it should maintain backward compatibility. Components are tied to the life cycle of the level with which they are associated. So, for example, ApplicationComponent is loaded when the IDE starts. When used, they will block the plugin from restarting without restarting the IDE and generally behave unpleasantly. Therefore, it is better to use services instead. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We use Services</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- current main structural units. </font><font style="vertical-align: inherit;">They are divided into the same levels of the application, project and module, they will help us encapsulate the logic at the appropriate levels and store the state of the plugin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unlike components, Services must be loaded on its own using the ServiceManager.getService () method. </font><font style="vertical-align: inherit;">The platform ensures that every service is a singleton. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add Actions</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - they can be a shortcut, an additional menu item - in a word, they are responsible for everything that somehow affects user actions in the IDE. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We use Extensions</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - any extension of functionality that will be more complicated than Actions: for example, get connected to the IDE life cycle and do something while showing a splash screen or before exiting.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this should be declared in the file /META_INF/plugin.xml.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Plugin.xml and build.gradle</font></font></h4><br>
<img src="https://habrastorage.org/webt/ap/ia/vz/apiavzht769ipgzd8ltqaobce4o.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project creation window. </font><font style="vertical-align: inherit;">We will write our plugin in Kotlin, and use Gradle for the assembly.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This is the first thing we see after creating the plugin blank in IDEA (File -&gt; New -&gt; Project ... -&gt; Gradle -&gt; IntelliJ Platform Plugin). </font><font style="vertical-align: inherit;">It contains information about the dependencies of the plugin and its brief description. </font><font style="vertical-align: inherit;">It should declare plug-in components - the previously mentioned components, services, actions and extensions. </font><font style="vertical-align: inherit;">There will be no specific entry point — it will be a custom action or IDE lifecycle event, depending on our needs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will need these dependencies - after all, we want to write a plugin for the studio and so that it can work with Git.</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">depends</span>&gt;</span>Git4Idea<span class="hljs-tag">&lt;/<span class="hljs-name">depends</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">depends</span>&gt;</span>com.intellij.modules.androidstudio<span class="hljs-tag">&lt;/<span class="hljs-name">depends</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Git4Idea is a plug-in for the virtual file system (VCS) and provides topics, thanks to which we can later listen to git events - such as checkouts, for example. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we also want the plugin to be able to work with Jira, we will connect through the gradle a kindly provided library with a rest client. </font><font style="vertical-align: inherit;">To do this, add the Atlassian maven repository there:</font></font><br>
<br>
<pre><code class="kotlin hljs">repositories {<font></font>
   mavenCentral()<font></font>
   maven {<font></font>
       url <span class="hljs-string">"https://packages.atlassian.com/maven/repository/public"</span><font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And actually the libraries:</font></font><br>
<br>
<pre><code class="kotlin hljs">implementation <span class="hljs-string">"joda-time:joda-time:2.10.4"</span>
implementation(<span class="hljs-string">"com.atlassian.jira:jira-rest-java-client-core:4.0.0"</span>) {<font></font>
   exclude group: <span class="hljs-string">'org.slf4j'</span><font></font>
   dependencies {<font></font>
       implementation <span class="hljs-string">"com.atlassian.fugue:fugue:2.6.1"</span><font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we determine the version of the IDE that interests us and the path to it (oh, if the real Android Studio started and worked as fast as its lightweight version for debugging plugins):</font></font><br>
<br>
<pre><code class="kotlin hljs">intellij {<font></font>
   version <span class="hljs-string">'2019.1'</span>
   plugins <span class="hljs-string">'git4idea'</span>
   alternativeIdePath <span class="hljs-string">'E:\\Android Studio'</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here, perhaps, someday we will write about a new, improved functionality. </font><font style="vertical-align: inherit;">But not now.</font></font><br>
<br>
<pre><code class="kotlin hljs">patchPluginXml {<font></font>
   changeNotes <span class="hljs-string">"""
     Add change notes here.&lt;br&gt;
     &lt;em&gt;most HTML tags may be used&lt;/em&gt;"""</span>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Creating a UI</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To push something into Jira, you first need to log in. </font><font style="vertical-align: inherit;">It is logical to do this right after the opening of the project. </font><font style="vertical-align: inherit;">It looks like we need an extension, and we will not hesitate to declare it in plugin.xml:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">postStartupActivity</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">"Heartbeat"</span>/&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and show the dialogue in it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UI components are mainly components from Swing with some extensions from platform sdk. </font><font style="vertical-align: inherit;">All this has recently been wrapped in kotlin ui dsl. </font><font style="vertical-align: inherit;">At the time of writing, the documentation noted that dsl can change very much between major versions, so we use it with a slight fear:</font></font><br>
<br>
<pre><code class="kotlin hljs">
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createCenterPanel</span><span class="hljs-params">()</span></span>: JComponent? {<font></font>
<font></font>
   title = <span class="hljs-string">"Jira credentials"</span>
   setOKButtonText(<span class="hljs-string">"Save"</span>)<font></font>
<font></font>
   <span class="hljs-keyword">return</span> panel {<font></font>
       row {<font></font>
           JLabel(<span class="hljs-string">"Jira hostname"</span>)()<font></font>
           hostname = JTextField(<span class="hljs-string">"https://"</span>)<font></font>
           hostname()<font></font>
       }<font></font>
       row {<font></font>
           JLabel(<span class="hljs-string">"Username:"</span>)()<font></font>
           username = JTextField()<font></font>
           username()<font></font>
       }<font></font>
       row {<font></font>
           JLabel(<span class="hljs-string">"Password:"</span>)()<font></font>
           password = JPasswordField()<font></font>
           password()<font></font>
       }<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We created a dialogue, showed it, received credentials from Jira. </font><font style="vertical-align: inherit;">Now we need to save them, and preferably safely, as much as possible. </font><font style="vertical-align: inherit;">PersistingStateComponent will come to the rescue.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. PersistingStateComponent device (not very complicated)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PersistingStateComponent can do two things - saveState and loadState: serialize and save the object passed to it and retrieve it from storage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where exactly he should save the data, he learns from the State annotation. </font><font style="vertical-align: inherit;">Two simplest options are mentioned in the documentation - specify your file or store everything in the workspace settings:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Storage(<span class="hljs-meta-string">"yourName.xml"</span>)</span>
<span class="hljs-meta">@Storage(StoragePathMacros.WORKSPACE_FILE)</span> 
<span class="hljs-meta">@State(
   name = <span class="hljs-meta-string">"JiraSettings"</span>,
   storages = [
       Storage(<span class="hljs-meta-string">"trackerSettings.xml"</span>)</span>
   ])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we have a special case, we turn to the documentation for the storage of sensitive data.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getState</span><span class="hljs-params">()</span></span>: Credentials? {
   <span class="hljs-keyword">if</span> (credentials == <span class="hljs-literal">null</span>)  {
       <span class="hljs-keyword">val</span> credentialAttributes = createCredentialAttributes()<font></font>
       credentials = PasswordSafe.instance.<span class="hljs-keyword">get</span>(credentialAttributes)<font></font>
   }<font></font>
   <span class="hljs-keyword">return</span> credentials<font></font>
}<font></font>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadState</span><span class="hljs-params">(state: <span class="hljs-type">Credentials</span>)</span></span> {<font></font>
   credentials = state<font></font>
   <span class="hljs-keyword">val</span> credentialAttributes = createCredentialAttributes()<font></font>
   PasswordSafe.instance.<span class="hljs-keyword">set</span>(credentialAttributes, credentials)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another PersistingStateComponent will deal with storing the time logged for different branches. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jira figured out the login. </font><font style="vertical-align: inherit;">With the storage of user data, too. </font><font style="vertical-align: inherit;">Now you need to somehow track the checkout event on the branch to start the countdown.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Subscribe to events</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IntelliJ Platform provides an opportunity to hang Observer on events of interest to us by subscribing to their topics in the messageBus of the desired level. </font><font style="vertical-align: inherit;">Here's the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dock</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , it's pretty interesting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A topic is a certain endpoint, a representation of an event. </font><font style="vertical-align: inherit;">All you need to do is subscribe and implement a listener that should handle what is happening. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, I need to listen to checkouts in Git ...</font></font><br>
<br>
<pre><code class="kotlin hljs">subscribeToProjectTopic(project, GitRepository.GIT_REPO_CHANGE) {<font></font>
    GitRepositoryChangeListener {<font></font>
        currentBranch = it.currentBranch<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... closing the application (to happily pawn time) ...</font></font><br>
<br>
<pre><code class="kotlin hljs">subscribeToAppTopic(AppLifecycleListener.TOPIC) {
    <span class="hljs-keyword">object</span>: AppLifecycleListener {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">appWillBeClosed</span><span class="hljs-params">(isRestart: <span class="hljs-type">Boolean</span>)</span></span> {
            <span class="hljs-keyword">if</span> (!isRestart) {<font></font>
                JiraClient.logTime(entry.key, DateTime.now(), entry.value)<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... and saving documents (just so that it was).</font></font><br>
<br>
<pre><code class="kotlin hljs">subscribeToAppTopic(AppTopics.FILE_DOCUMENT_SYNC) {<font></font>
    CustomSaveListener()<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This, in principle, is already enough (if not, you can always write your own). </font><font style="vertical-align: inherit;">But what if we want to hear the slightest scroll and mouse movement?</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. EditorEventMulticaster</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It collects everything that happens in the open editor windows - editing, changing the visible area, mouse movements - and allows you to subscribe to it in one place and immediately. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we have everything we need. </font><font style="vertical-align: inherit;">We can select the name of the task in Jira from the current branch (if it is there), calculate the time spent working on it, and immediately exit the studio to add it to the task.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Code and details </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To run, you need the latest Android Studio (3.6.1). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To test the performance - git and a branch with a name that is at least remotely similar to the task in Jira. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So that the plugin does not just output time to the console, but tracks it - uncomment the corresponding line in Heartbeat.kt.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Useful links</font></font></h4><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A series of plugin development articles</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another interesting article about developing a plugin from an Android developer</font></font></a></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS And what did you choose in the end?</font></font></h4><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Damn, it's kind of too evil. </font><font style="vertical-align: inherit;">And if I do not write code? </font><font style="vertical-align: inherit;">And if I pick my nose and try hard to understand what is happening in it? </font><font style="vertical-align: inherit;">In the code, in the sense of. </font><font style="vertical-align: inherit;">After all, this takes most of the time. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Then at least scroll it. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- So it’s not far from simulating violent activity. </font><font style="vertical-align: inherit;">And then, I can not shut down the studio for weeks and not reboot. </font><font style="vertical-align: inherit;">Maybe we do not need such happiness? </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 “Definitely not necessary.” </font><font style="vertical-align: inherit;">Then another reason is needed, otherwise I liked writing plugins. </font><font style="vertical-align: inherit;">And I still did not really understand VCS. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Do you use it yourself?” </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Nope. </font><font style="vertical-align: inherit;">I somehow learned to log with my hands, imperceptibly for myself.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490772/index.html">How to write and publish a smart contract in the Telegram Open Network (TON)</a></li>
<li><a href="../en490774/index.html">Responsive</a></li>
<li><a href="../en490778/index.html">People who understand the work of a programmer can be found anywhere</a></li>
<li><a href="../en490780/index.html">Intel Xeon Scalable Gen2: Big Sale of Cores</a></li>
<li><a href="../en490782/index.html">AnalogBytes Conference: Roskomnadzor, media, highload and all-all-all</a></li>
<li><a href="../en490786/index.html">Second order leak analysis: when it leaks from those who steal data from a bank</a></li>
<li><a href="../en490788/index.html">Useless REPL. Yandex Report</a></li>
<li><a href="../en490790/index.html">Zip Files: History, Explanation, and Implementation</a></li>
<li><a href="../en490792/index.html">VXLAN in NSX-V - Troubled Underlay</a></li>
<li><a href="../en490796/index.html">How to automate the security of containers in the style of Policy as Code using CRD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>