<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚮 ☦️ 👩‍❤️‍👩 Learning to deploy microservices. Part 3. Helm 🕔 🦒 👩🏻‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr!
 

This is the third part in a series of articles “Learning to Deploy Microservices ,” and today we will talk about Helm 3. In the last p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Learning to deploy microservices. Part 3. Helm</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490302/"><p><img src="https://habrastorage.org/webt/m-/vr/tx/m-vrtxtrajsojffpookrbcljlmo.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr!</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is the third part in a series of articles “Learning to </font><font style="vertical-align: inherit;">Deploy Microservices </font><font style="vertical-align: inherit;">,” and today we will talk about Helm 3. In the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">last part,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we created Kubernetes configuration for a training project of 2 microservices (backend and gateway) and deployed all this in Google Kubernetes Engine. </font><font style="vertical-align: inherit;">In this article, we will write a Helm chart for our system, create a repository for it based on GitHub Pages, and deploy a project in GKE using Helm.</font></font></p><a name="habracut"></a><br>
<p>  :</p><br>
<ol>
<li><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">   Spring Boot,   Docker</a></p><br>
<p><strong><em> : Java 11, Spring Boot, Docker, image optimization</em></strong></p><br>
</li>
<li><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> Kubernetes      Google Kubernetes Engine</a></p><br>
<p><strong><em> : Kubernetes, GKE, resource management, autoscaling, secrets</em></strong></p><br>
</li>
<li><p>    Helm 3     </p><br>
<p><strong><em> : Helm 3, chart deployment</em></strong></p><br>
</li>
<li><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> Jenkins        </a></p><br>
<p><strong><em> : Jenkins configuration, plugins, separate configs repository</em></strong></p><br>
</li>
</ol><br>
<p>Helm —   ,   ,      Kubernetes.  Helm      —  yaml-   ,     .              Helm-.           .</p><br>
<p>Helm     Kubernetes   ,     .       <em>values.yaml</em>,        Kubernetes-.        ,         .</p><br>
<p>    GitHub  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>.</p><br>
<h2 id="struktura-charta"> </h2><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">helm create &lt;chart-name&gt;</code></pre><br>
<p>         Helm.       msvc-chart    :</p><br>
<pre><code class="bash hljs">.<font></font>
└── msvc-chart<font></font>
    ├── charts<font></font>
    ├── Chart.yaml<font></font>
    ├── templates<font></font>
    │   ├── backend.yaml<font></font>
    │   ├── gateway.yaml<font></font>
    │   ├── _helpers.tpl<font></font>
    │   ├── NOTES.txt<font></font>
    │   ├── secrets.yaml<font></font>
    │   ├── service-account.yaml<font></font>
    │   ├── tests<font></font>
    │   │   └── interaction-test.yaml<font></font>
    │   └── urls-config.yaml<font></font>
    ├── values.schema.json<font></font>
    └── values.yaml</code></pre><br>
<ul>
<li><p><strong><em>charts/</em></strong> —      .    ,          .</p><br>
</li>
<li><p><strong><em>Chart.yaml</em></strong> —        ,   .</p><br>
</li>
<li><p>*<strong>templates/*.yaml*</strong> —     Kuberenetes.</p><br>
</li>
<li><p><strong><em>templates/NOTES.txt</em></strong> —     ,       .</p><br>
</li>
<li><p>*<strong>templates/tests/*.yaml*</strong> —      Helm.</p><br>
</li>
<li><p><strong><em>templates/_helpers.tpl</em></strong> —    ,      .             tpl.</p><br>
</li>
<li><p><strong><em>values.yaml</em></strong> —       .</p><br>
</li>
<li><p><strong><em>values.schema.json</em></strong> — JSON-     <em>values.yaml</em>.</p><br>
</li>
</ul><br>
<h2 id="valuesyaml">values.yaml</h2><br>
<p>     —   <em>values.yaml</em>.        .         .</p><br>
<pre><code class="plaintext hljs">backend:<font></font>
  deployment:<font></font>
    name:<font></font>
    replicas: 2<font></font>
  container:<font></font>
    name:<font></font>
    resources: {}<font></font>
#      limits:<font></font>
#        memory: 1024Mi<font></font>
#        cpu: 500m<font></font>
#      requests:<font></font>
#        memory: 512Mi<font></font>
#        cpu: 100m<font></font>
  service:<font></font>
    name:<font></font>
    port: 8080<font></font>
  image:<font></font>
    name: anshelen/microservices-backend<font></font>
    tag: latest<font></font>
    pullPolicy: IfNotPresent<font></font>
  hpa:<font></font>
    enabled: false<font></font>
    name:<font></font>
    minReplicas: 1<font></font>
    maxReplicas: 3<font></font>
    targetCPUUtilizationPercentage: 50<font></font>
<font></font>
gateway:<font></font>
  deployment:<font></font>
    name:<font></font>
    replicas: 2<font></font>
  container:<font></font>
    name:<font></font>
    resources: {}<font></font>
#      limits:<font></font>
#        memory: 1024Mi<font></font>
#        cpu: 500m<font></font>
#      requests:<font></font>
#        memory: 512Mi<font></font>
#        cpu: 100m<font></font>
  service:<font></font>
    name:<font></font>
    port: 80<font></font>
#   Can be one of ClusterIP, NodePort or LoadBalancer<font></font>
    type: LoadBalancer<font></font>
  image:<font></font>
    name: anshelen/microservices-gateway<font></font>
    tag: latest<font></font>
    pullPolicy: IfNotPresent<font></font>
  hpa:<font></font>
    enabled: false<font></font>
    name:<font></font>
    minReplicas: 1<font></font>
    maxReplicas: 3<font></font>
    targetCPUUtilizationPercentage: 50<font></font>
<font></font>
secrets:<font></font>
  secret: default-secret<font></font>
<font></font>
serviceAccount:<font></font>
  # Specifies whether a service account should be created<font></font>
  create: true<font></font>
  # The name of the service account to use.<font></font>
  # If not set and create is true, a name is generated using the release and<font></font>
  # chart names<font></font>
  name:<font></font>
</code></pre><br>
<p>        ,    .       ,         (№ <em>gateway.service.type</em>).     ,           Kubernetes- (№ <em>gateway.container.resources</em>).</p><br>
<p>       <em>values.schema.json</em>  JSON-,          .     , ,     .</p><br>
<div class="spoiler"><b class="spoiler_title">values.schema.json</b><div class="spoiler_text"><pre><code class="json hljs">{
  <span class="hljs-attr">"$schema"</span>: <span class="hljs-string">"https://json-schema.org/draft-07/schema#"</span>,
  <span class="hljs-attr">"properties"</span>: {
    <span class="hljs-attr">"backend"</span>: {
      <span class="hljs-attr">"properties"</span>: {
        <span class="hljs-attr">"deployment"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
            },<font></font>
            <span class="hljs-attr">"replicas"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"container"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
            },<font></font>
            <span class="hljs-attr">"resources"</span>: {
              <span class="hljs-attr">"properties"</span>: {
                <span class="hljs-attr">"limits"</span>: {
                  <span class="hljs-attr">"properties"</span>: {
                    <span class="hljs-attr">"memory"</span>: {
                      <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"number"</span>]<font></font>
                    },<font></font>
                    <span class="hljs-attr">"cpu"</span>: {
                      <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"number"</span>]<font></font>
                    }<font></font>
                  },<font></font>
                  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
                },<font></font>
                <span class="hljs-attr">"requests"</span>: {
                  <span class="hljs-attr">"properties"</span>: {
                    <span class="hljs-attr">"memory"</span>: {
                      <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
                    },<font></font>
                    <span class="hljs-attr">"cpu"</span>: {
                      <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
                    }<font></font>
                  },<font></font>
                  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
                }<font></font>
              },<font></font>
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"service"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
            },<font></font>
            <span class="hljs-attr">"port"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"image"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"tag"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"pullPolicy"</span>: {
              <span class="hljs-attr">"enum"</span>: [<span class="hljs-string">"IfNotPresent"</span>, <span class="hljs-string">"Always"</span>, <span class="hljs-string">"Never"</span>]<font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"hpa"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"enabled"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"boolean"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
            },<font></font>
            <span class="hljs-attr">"minReplicas"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"maxReplicas"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"targetCPUUtilizationPercentage"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"maximum"</span>: <span class="hljs-number">99</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        }<font></font>
      },<font></font>
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
    },<font></font>
    <span class="hljs-attr">"gateway"</span>: {
      <span class="hljs-attr">"properties"</span>: {
        <span class="hljs-attr">"deployment"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
            },<font></font>
            <span class="hljs-attr">"replicas"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"container"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
            },<font></font>
            <span class="hljs-attr">"resources"</span>: {
              <span class="hljs-attr">"properties"</span>: {
                <span class="hljs-attr">"limits"</span>: {
                  <span class="hljs-attr">"properties"</span>: {
                    <span class="hljs-attr">"memory"</span>: {
                      <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"number"</span>]<font></font>
                    },<font></font>
                    <span class="hljs-attr">"cpu"</span>: {
                      <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"number"</span>]<font></font>
                    }<font></font>
                  },<font></font>
                  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
                },<font></font>
                <span class="hljs-attr">"requests"</span>: {
                  <span class="hljs-attr">"properties"</span>: {
                    <span class="hljs-attr">"memory"</span>: {
                      <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
                    },<font></font>
                    <span class="hljs-attr">"cpu"</span>: {
                      <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
                    }<font></font>
                  },<font></font>
                  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
                }<font></font>
              },<font></font>
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"service"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
            },<font></font>
            <span class="hljs-attr">"port"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"type"</span>: {
              <span class="hljs-attr">"enum"</span>: [<span class="hljs-string">"ClusterIP"</span>, <span class="hljs-string">"NodePort"</span>, <span class="hljs-string">"LoadBalancer"</span>]<font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"image"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"tag"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"string"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"pullPolicy"</span>: {
              <span class="hljs-attr">"enum"</span>: [<span class="hljs-string">"IfNotPresent"</span>, <span class="hljs-string">"Always"</span>, <span class="hljs-string">"Never"</span>]<font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"hpa"</span>: {
          <span class="hljs-attr">"properties"</span>: {
            <span class="hljs-attr">"enabled"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"boolean"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"name"</span>: {
              <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
            },<font></font>
            <span class="hljs-attr">"minReplicas"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"maxReplicas"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            },<font></font>
            <span class="hljs-attr">"targetCPUUtilizationPercentage"</span>: {
              <span class="hljs-attr">"minimum"</span>: <span class="hljs-number">1</span>,
              <span class="hljs-attr">"maximum"</span>: <span class="hljs-number">99</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"integer"</span><font></font>
            }<font></font>
          },<font></font>
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
        }<font></font>
      },<font></font>
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
    },<font></font>
    <span class="hljs-attr">"secrets"</span>: {
      <span class="hljs-attr">"properties"</span>: {
        <span class="hljs-attr">"secret"</span>: {
          <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"number"</span>, <span class="hljs-string">"string"</span>]<font></font>
        }<font></font>
      },<font></font>
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
    },<font></font>
    <span class="hljs-attr">"createAccount"</span>: {
      <span class="hljs-attr">"properties"</span>: {
        <span class="hljs-attr">"create"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"boolean"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"name"</span>: {
          <span class="hljs-attr">"type"</span>: [<span class="hljs-string">"string"</span>, <span class="hljs-string">"null"</span>]<font></font>
        }<font></font>
      },<font></font>
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span><font></font>
    }<font></font>
  },<font></font>
  <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Values"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"object"</span>
}</code></pre></div></div><br>
<h2 id="mehanizm-shablonov"> </h2><br>
<p> Helm            ,         Kubernetes.</p><br>
<p>      —      .  Helm     ,     (<code>Release</code>),  (<code>Values</code>)     (<code>Chart</code>).  ,      <em>secrets.secret</em>   <code>{{ .Values.secrets.secret }}</code>. </p><br>
<p>   ,     "" ("pipeline") —         . ,        : <code>{{ .Chart.AppVersion | quote }}</code>.        .</p><br>
<p>    ,          .      <code>define</code>:</p><br>
<pre><code class="plaintext hljs">{{- define "msvc-chart.someFragment" -}}<font></font>
...<font></font>
{{- end -}}</code></pre><br>
<p>          <code>include</code>:</p><br>
<pre><code class="plaintext hljs">{{ include "msvc-chart.someFragment" . }}</code></pre><br>
<p> <code>{{-</code>   <code>{{</code> ,          .         . ,  <code>{{- include "msvc-chart.someFragment" . | nindent 4 }}</code>     4 .</p><br>
<p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>.</p><br>
<h2 id="_helperstpl">_helpers.tpl</h2><br>
<p>    Helm       .    Kubernetes    ,       .    ,            . ,  ,             .   —       ,     ,    .           <code>Release.Name</code>.</p><br>
<h4 id="metki"></h4><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">{{- define "msvc-chart.selectorLabels" -}}<font></font>
app.kubernetes.io/name: {{ .Chart.Name }}<font></font>
app.kubernetes.io/instance: {{ .Release.Name }}<font></font>
{{- end -}}</code></pre><br>
<p><code>.Chart.Name</code>    ('msvc-chart'   ).     ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a> Helm.</p><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">{{- define "msvc-chart.chart" -}}<font></font>
{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" -}}<font></font>
{{- end -}}</code></pre><br>
<p>       ,   ,   63  (    Kubernetes)    .         Helm.         Kubernetes- (         DNS ).</p><br>
<p>,    -Kubernetes:</p><br>
<pre><code class="plaintext hljs">{{- define "msvc-chart.labels" -}}<font></font>
helm.sh/chart: {{ include "msvc-chart.chart" . }}<font></font>
{{ include "msvc-chart.selectorLabels" . }}<font></font>
{{- if .Chart.AppVersion }}<font></font>
app.kubernetes.io/version: {{ .Chart.AppVersion | quote }}<font></font>
{{- end }}<font></font>
app.kubernetes.io/managed-by: {{ .Release.Service }}<font></font>
{{- end -}}</code></pre><br>
<p>,    'msvc-project',     :</p><br>
<pre><code class="plaintext hljs">helm.sh/chart: msvc-chart-1.0.0<font></font>
app.kubernetes.io/name: msvc-chart<font></font>
app.kubernetes.io/instance: msvc-project<font></font>
app.kubernetes.io/version: 1.0.0<font></font>
app.kubernetes.io/managed-by: Helm</code></pre><br>
<h4 id="imena-obektov-kubernetes">  Kubernetes</h4><br>
<p>         Kubernetes   ServiceAccount.            .       ,  ,   .   ServiceAccount     .    ServiceAccount    ,      Jenkins   .</p><br>
<p>       : </p><br>
<ul>
<li>  <em>serviceAccount.create=true</em>,       <em>serviceAccount.name</em>.    .</li>
<li> <em>serviceAccount.create=false</em>,       <em>serviceAccount.name</em>   'default',    .</li>
</ul><br>
<pre><code class="plaintext hljs">{{- define "msvc-chart.serviceAccountName" -}}<font></font>
{{- if .Values.serviceAccount.create -}}<font></font>
    {{ default (printf "%s-%s" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-") .Values.serviceAccount.name }}<font></font>
{{- else -}}<font></font>
    {{ default "default" .Values.serviceAccount.name }}<font></font>
{{- end -}}<font></font>
{{- end -}}</code></pre><br>
<p>      <code>if</code>    <code>default</code>,    ,    <code>null</code>.</p><br>
<p>   Kubernetes    ,        .</p><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">{{- define "msvc-chart.gateway.defaultName" -}}<font></font>
{{- printf "gateway-%s" .Release.Name -}}<font></font>
{{- end -}}<font></font>
<font></font>
{{- define "msvc-chart.gateway.deployment.name" -}}<font></font>
{{- default (include "msvc-chart.gateway.defaultName" .) .Values.gateway.deployment.name | trunc 63 | trimSuffix "-" -}}<font></font>
{{- end -}}</code></pre><br>
<h4 id="obnovlenie-podov-pri-izmenenii-konfiguracionnyh-svoystv">     </h4><br>
<p>,             .    ,   ,  Helm   Kubernetes-  .         ,      .          .  Helm        <em>checksum/config</em>,     ,    .   Helm ,      ,      .</p><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">{{- define "msvc-chart.propertiesHash" -}}<font></font>
{{- $secrets := include (print $.Template.BasePath "/secrets.yaml") . | sha256sum -}}<font></font>
{{- $urlConfig := include (print $.Template.BasePath "/urls-config.yaml") . | sha256sum -}}<font></font>
{{ print $secrets $urlConfig | sha256sum }}<font></font>
{{- end -}}</code></pre><br>
<p> <code>print</code>     ,  <code>$.Template.BasePath</code>      (<em>_helpers.tpl</em>).  <code>include</code>       ,    -      <code>$secrets</code>.    ConfigMap,          .</p><br>
<p>  ,    <code>include</code>     '. ',       '\$'   Template.  Helm  '. '    (scope),  '\$' — ,    .      ,      .         .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>.</p><br>
<h2 id="shablony"></h2><br>
<h4 id="secret-secretsyaml">Secret (secrets.yaml)</h4><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Secret<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.secrets.defaultName" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
type: Opaque<font></font>
stringData:<font></font>
  secret: {{ .Values.secrets.secret }}</code></pre><br>
<h4 id="configmap-urls-configyaml">ConfigMap (urls-config.yaml)</h4><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.urlConfig.defaultName" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
data:<font></font>
  BACKEND_URL: "http://{{ include "msvc-chart.backend.service.name" . }}:{{ .Values.backend.service.port }}/"<font></font>
</code></pre><br>
<h4 id="serviceaccount-service-accountyaml">ServiceAccount (service-account.yaml)</h4><br>
<pre><code class="plaintext hljs">{{- if .Values.serviceAccount.create -}}<font></font>
apiVersion: v1<font></font>
kind: ServiceAccount<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.serviceAccountName" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: rbac.authorization.k8s.io/v1<font></font>
kind: RoleBinding<font></font>
metadata:<font></font>
  name: "{{ include "msvc-chart.serviceAccountName" . }}-binding"<font></font>
  labels:  <font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
subjects:<font></font>
- kind: ServiceAccount<font></font>
  name: {{ include "msvc-chart.serviceAccountName" . }}<font></font>
  namespace: {{ .Release.Namespace }}<font></font>
roleRef:<font></font>
  kind: ClusterRole<font></font>
  name: admin<font></font>
  apiGroup: rbac.authorization.k8s.io<font></font>
{{- end -}}</code></pre><br>
<p>  <em>serviceAccount.create=true</em>,             .</p><br>
<h4 id="deployments-backendyaml-i-gatewayyaml">Deployments (backend.yaml  gateway.yaml)</h4><br>
<p>  <em>gateway.yaml</em>   ,    ,   <em>backend.yaml</em> —  .      ,   HorizontalPodAutoscaler',      .    ,          <em>gateway.container.resources.requests.cpu</em> —       .      Kubernetes     .</p><br>
<p><strong>gateway.yaml</strong>:</p><br>
<pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.gateway.deployment.name" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
    tier: gateway<font></font>
spec:<font></font>
  replicas: {{ .Values.gateway.deployment.replicas }}<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      {{- include "msvc-chart.selectorLabels" . | nindent 6 }}<font></font>
      tier: gateway<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      annotations:<font></font>
        checksum/config: {{ include "msvc-chart.propertiesHash" . }}<font></font>
      labels:<font></font>
        {{- include "msvc-chart.selectorLabels" . | nindent 8 }}<font></font>
        tier: gateway<font></font>
    spec:<font></font>
      serviceAccountName: {{ include "msvc-chart.serviceAccountName" . }}<font></font>
      containers:<font></font>
        - name: {{ include "msvc-chart.gateway.container.name" . }}<font></font>
          image: "{{ .Values.gateway.image.name }}:{{ .Values.gateway.image.tag }}"<font></font>
          imagePullPolicy: {{ .Values.gateway.image.pullPolicy }}<font></font>
          envFrom:<font></font>
            - configMapRef:<font></font>
                name: {{ include "msvc-chart.urlConfig.defaultName" . }}<font></font>
          env:<font></font>
            - name: SECRET<font></font>
              valueFrom:<font></font>
                secretKeyRef:<font></font>
                  name: {{ include "msvc-chart.secrets.defaultName" . }}<font></font>
                  key: secret<font></font>
          readinessProbe:<font></font>
            httpGet:<font></font>
              path: /actuator/health<font></font>
              port: 8080<font></font>
            initialDelaySeconds: 5<font></font>
            periodSeconds: 3<font></font>
          ports:<font></font>
            - containerPort: 8080<font></font>
              protocol: TCP<font></font>
          resources:<font></font>
            {{- toYaml .Values.gateway.container.resources | nindent 12 }}<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.gateway.service.name" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
    tier: gateway<font></font>
spec:<font></font>
  type: {{ .Values.gateway.service.type }}<font></font>
  ports:<font></font>
    - port: {{ .Values.gateway.service.port }}<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
      name: http<font></font>
  selector:<font></font>
    {{- include "msvc-chart.selectorLabels" . | nindent 4 }}<font></font>
    tier: gateway<font></font>
<font></font>
---<font></font>
<font></font>
{{- if .Values.gateway.hpa.enabled -}}<font></font>
apiVersion: autoscaling/v1<font></font>
kind: HorizontalPodAutoscaler<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.gateway.hpa.name" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
    tier: gateway<font></font>
spec:<font></font>
  scaleTargetRef:<font></font>
    apiVersion: apps/v1<font></font>
    kind: Deployment<font></font>
    name: {{ include "msvc-chart.gateway.deployment.name" . }}<font></font>
  minReplicas: {{ .Values.gateway.hpa.minReplicas }}<font></font>
  maxReplicas: {{ .Values.gateway.hpa.maxReplicas }}<font></font>
  targetCPUUtilizationPercentage: {{ .Values.gateway.hpa.targetCPUUtilizationPercentage }}<font></font>
{{- end -}}</code></pre><br>
<p>     "checksum/config",    ,        ServiceAccount (<em>spec.template.spec.serviceAccountName</em>).      <em>toYaml</em>     <em>backend.container.resources</em>   <em>values.yaml</em>  .</p><br>
<p>   .</p><br>
<div class="spoiler"><b class="spoiler_title">backend.yaml</b><div class="spoiler_text"><pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.backend.deployment.name" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
    tier: backend<font></font>
spec:<font></font>
  replicas: {{ .Values.backend.deployment.replicas }}<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      {{- include "msvc-chart.selectorLabels" . | nindent 6 }}<font></font>
      tier: backend<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        {{- include "msvc-chart.selectorLabels" . | nindent 8 }}<font></font>
        tier: backend<font></font>
    spec:<font></font>
      serviceAccountName: {{ include "msvc-chart.serviceAccountName" . }}<font></font>
      containers:<font></font>
        - name: {{ include "msvc-chart.backend.container.name" . }}<font></font>
          image: "{{ .Values.backend.image.name }}:{{ .Values.backend.image.tag }}"<font></font>
          imagePullPolicy: {{ .Values.backend.image.pullPolicy }}<font></font>
          ports:<font></font>
            - containerPort: 8080<font></font>
              protocol: TCP<font></font>
          readinessProbe:<font></font>
            httpGet:<font></font>
              path: /actuator/health<font></font>
              port: 8080<font></font>
            initialDelaySeconds: 5<font></font>
            periodSeconds: 3<font></font>
          resources:<font></font>
            {{- toYaml .Values.backend.container.resources | nindent 12 }}<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.backend.service.name" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
    tier: backend<font></font>
spec:<font></font>
  ports:<font></font>
    - port: {{ .Values.backend.service.port }}<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
      name: http<font></font>
  selector:<font></font>
    {{- include "msvc-chart.selectorLabels" . | nindent 4 }}<font></font>
    tier: backend<font></font>
<font></font>
---<font></font>
<font></font>
{{- if .Values.backend.hpa.enabled -}}<font></font>
apiVersion: autoscaling/v1<font></font>
kind: HorizontalPodAutoscaler<font></font>
metadata:<font></font>
  name: {{ include "msvc-chart.backend.hpa.name" . }}<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
    tier: backend<font></font>
spec:<font></font>
  scaleTargetRef:<font></font>
    apiVersion: apps/v1<font></font>
    kind: Deployment<font></font>
    name: {{ include "msvc-chart.backend.deployment.name" . }}<font></font>
  minReplicas: {{ .Values.backend.hpa.minReplicas }}<font></font>
  maxReplicas: {{ .Values.backend.hpa.maxReplicas }}<font></font>
  targetCPUUtilizationPercentage: {{ .Values.backend.hpa.targetCPUUtilizationPercentage }}<font></font>
{{- end -}}</code></pre></div></div><br>
<h2 id="notestxt">NOTES.txt</h2><br>
<p> <em>NOTES.txt</em>   ,       ,       (<code>helm status &lt;name&gt;</code>).</p><br>
<p>           URL-  .  , ,        .    ,        .</p><br>
<pre><code class="plaintext hljs">1. Get the application URL by running these commands:<font></font>
{{- if contains "NodePort" .Values.gateway.service.type }}<font></font>
  export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "msvc-chart.gateway.service.name" . }})<font></font>
  export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")<font></font>
  echo http://$NODE_IP:$NODE_PORT<font></font>
{{- else if contains "LoadBalancer" .Values.gateway.service.type }}<font></font>
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.<font></font>
           You can watch the status of by running 'kubectl get --namespace {{ .Release.Namespace }} svc -w {{ include "msvc-chart.gateway.service.name" . }}'<font></font>
  export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "msvc-chart.gateway.service.name" . }} -o jsonpath="{.status.loadBalancer.ingress[0].ip}")<font></font>
  echo http://$SERVICE_IP:{{ .Values.gateway.service.port }}<font></font>
{{- else if contains "ClusterIP" .Values.gateway.service.type }}<font></font>
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name= {{ .Chart.Name }},app.kubernetes.io/instance={{ .Release.Name }},tier=gateway" -o jsonpath="{.items[0].metadata.name}")<font></font>
  echo "Visit http://127.0.0.1:8080 to use your application"<font></font>
  kubectl --namespace {{ .Release.Namespace }} port-forward $POD_NAME 8080:8080<font></font>
{{- end }}<font></font>
2. Get service account token:<font></font>
  export TOKEN=$(kubectl get serviceaccount {{ include "msvc-chart.serviceAccountName" . }} -n {{ .Release.Namespace }} -o go-template --template='{{`{{range .secrets}}{{.name}}{{"\n"}}{{end}}`}}')<font></font>
  export TOKEN_DECODED=$(kubectl get secrets "$TOKEN" -n {{ .Release.Namespace }} -o go-template --template '{{`{{index .data "token"}}`}}' | base64 -d)<font></font>
  echo $TOKEN_DECODED</code></pre><br>
<h2 id="chartyaml">Chart.yaml</h2><br>
<p>    .   — <em>version</em>  <em>appVersion</em>. <em>version</em> —  ,         . <em>appVersion</em> —    .  <em>type</em>    'application'  'library' —      .</p><br>
<pre><code class="plaintext hljs">apiVersion: v2<font></font>
name: msvc-chart<font></font>
version: 1.0.0<font></font>
description: Microservices project<font></font>
type: application<font></font>
sources:<font></font>
  - https://github.com/Anshelen/microservices-backend<font></font>
  - https://github.com/Anshelen/microservices-gateway<font></font>
  - https://github.com/Anshelen/microservices-deploy<font></font>
maintainers:<font></font>
  - name: Anton Shelenkov<font></font>
    email: anshelen@yandex.ru<font></font>
    url: https://shelenkov.herokuapp.com<font></font>
appVersion: 1.0.0</code></pre><br>
<h2 id="testy"></h2><br>
<p>Helm    .     <code>helm test &lt;name&gt;</code>             (№  ).         Kubernetes-,      ,  http-.    ,    .</p><br>
<p>      ,     .     Kubernetes- Job —    ,       .   , Job        3  ( <em>backoffLimit</em>).     helm.sh/hook  helm.sh/hook-delete-policy.   Helm,     ,         .</p><br>
<p><strong>interaction-test.yaml</strong>:</p><br>
<pre><code class="plaintext hljs">apiVersion: batch/v1<font></font>
kind: Job<font></font>
metadata:<font></font>
  name: "{{ .Release.Name }}-interaction-test"<font></font>
  labels:<font></font>
    {{- include "msvc-chart.labels" . | nindent 4 }}<font></font>
  annotations:<font></font>
    "helm.sh/hook": test<font></font>
    "helm.sh/hook-delete-policy": hook-succeeded,hook-failed<font></font>
spec:<font></font>
  template:<font></font>
    spec:<font></font>
      containers:<font></font>
      - name: test<font></font>
        image: busybox<font></font>
        command: ['wget']<font></font>
        args:  ['{{ include "msvc-chart.gateway.service.name" . }}:{{ .Values.gateway.service.port }}/']<font></font>
      restartPolicy: Never<font></font>
  backoffLimit: 3</code></pre><br>
<h2 id="rabota-s-helm">  Helm</h2><br>
<p>   Helm    : <strong><em> ,  ,     Helm,      kubectl</em></strong>. Helm      ,    .     kubectl,  Helm   ,    .</p><br>
<h4 id="ustanovka-charta"> </h4><br>
<p>         ,      Kubernetes-:</p><br>
<pre><code class="plaintext hljs">helm install --dry-run --debug &lt;name&gt; &lt;chart-folder&gt;</code></pre><br>
<p> ,   ,    ,     <code>&lt;name&gt;</code>:</p><br>
<pre><code class="plaintext hljs">helm install &lt;name&gt; &lt;chart-folder&gt;</code></pre><br>
<p>       values.yaml,    <code>--set &lt;key&gt;=&lt;value&gt;</code>.       .    ,         yaml-     <code>-f &lt;overriden-values.yaml&gt;</code>.  <code>-n &lt;namespace&gt;</code>   ,     .</p><br>
<h4 id="obnovlenie-installyacii"> </h4><br>
<p> :</p><br>
<pre><code class="plaintext hljs">helm upgrade &lt;name&gt; &lt;chart-folder&gt;</code></pre><br>
<p>      <code>-f &lt;file&gt;</code>  <code>--set &lt;key&gt;=&lt;value&gt;</code>.  Helm        ,        .     ,    <code>--reuse-values</code>.  ,     Helm  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>,     <code>--set</code>  <code>--reuse-values</code>  ,   - .         :</p><br>
<pre><code class="plaintext hljs">helm install &lt;name&gt; &lt;chart-folder&gt;<font></font>
helm upgrade &lt;name&gt; &lt;chart-folder&gt; --set key=value --reuse-values</code></pre><br>
<p>  ,   ,  -  , , :</p><br>
<pre><code class="plaintext hljs">helm install &lt;name&gt; &lt;chart-folder&gt; --set _=null</code></pre><br>
<h4 id="poluchenie-informacii-ob-installyaciyah">   </h4><br>
<p><code>helm list</code> —    Helm' .<br>
<code>helm status &lt;name&gt;</code> —     .<br>
<code>helm history &lt;name&gt;</code> —   .           .          .<br>
<code>helm get values &lt;name&gt;</code> —    .   <code>--revision n</code>,      n- .<br>
<code>helm show values &lt;chart-folder&gt;</code> —      .     <em>values.yaml</em>.<br>
<code>helm get manifest &lt;name&gt;</code> —   Helm'    .</p><br>
<h4 id="prochie-komandy"> </h4><br>
<p><code>helm rollback &lt;name&gt; &lt;revision-num&gt;</code> —    .<br>
<code>helm uninstall &lt;name&gt;</code> —  .</p><br>
<h2 id="publikaciya-repozitoriya"> </h2><br>
<p>Helm-      .        HTTP-    S3-.       GitHub Pages.</p><br>
<p>    index.yaml     ,      .      —       . </p><br>
<p>   GitHub   docs    :</p><br>
<pre><code class="plaintext hljs">helm package msvc-chart/ -d docs/<font></font>
helm repo index docs/ --url https://&lt;github-username&gt;.github.io/&lt;github-repo-name&gt;/</code></pre><br>
<p>            docs.     index.yaml    .   url    URL-   .  ,        .    ,       GitHub Pages,    'Source'  'master branch /docs folder'.</p><br>
<h2 id="deploy-sistemy"> </h2><br>
<p>    ,     GKE,       Helm.</p><br>
<p>       :</p><br>
<pre><code class="plaintext hljs">kubectl create namespace msvc-ns<font></font>
kubectl config set-context --current --namespace=msvc-ns</code></pre><br>
<p>         .      Helm   msvc-repo      (URL    ,       Helm-):</p><br>
<pre><code class="plaintext hljs">helm repo add msvc-repo https://anshelen.github.io/microservices-deploy/<font></font>
helm repo update</code></pre><br>
<p> :</p><br>
<pre><code class="plaintext hljs">helm install msvc-project msvc-repo/msvc-chart \<font></font>
--set backend.container.resources.requests.cpu=50m \<font></font>
--set backend.hpa.enabled=true \<font></font>
--set gateway.container.resources.requests.cpu=50m \<font></font>
--set gateway.hpa.enabled=true \<font></font>
--set secrets.secret=secret</code></pre><br>
<p>        URL-  .    ,   ,   .</p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">helm test msvc-project </code></pre><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">helm upgrade msvc-project msvc-repo/msvc-chart \<font></font>
--set secrets.secret=new-secret \<font></font>
--reuse-values</code></pre><br>
<p> -          ,    .</p><br>
<h2 id="zaklyuchenie"></h2><br>
<p>     Helm-     ,          GKE.  Helm     ,      Git           —   ,     Docker,       Helm. </p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to automate the process of delivering code to the cluster, in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we will configure the Jenkins continuous integration server and create a pipeline for our project.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490292/index.html">Big red-blue sell</a></li>
<li><a href="../en490294/index.html">Puddle interview</a></li>
<li><a href="../en490296/index.html">Window functions with a “window” or how to use a frame</a></li>
<li><a href="../en490298/index.html">Sealed types in Java</a></li>
<li><a href="../en490300/index.html">Let's Encrypt issued a billion certificates</a></li>
<li><a href="../en490306/index.html">How we made space technology mockups for the Moscow Aviation Institute</a></li>
<li><a href="../en490310/index.html">Faraday law or how a magnet gets stuck in a copper pipe</a></li>
<li><a href="../en490314/index.html">RE: 23 minutes. Justification of the slow-witted</a></li>
<li><a href="../en490318/index.html">Bionic prostheses nowadays</a></li>
<li><a href="../en490320/index.html">Making Faster POSTGRESQL COUNT (*)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>