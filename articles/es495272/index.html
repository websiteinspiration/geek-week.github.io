<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåõ üôà üéûÔ∏è Emuladores SNES a pocos p√≠xeles de la perfecci√≥n absoluta ‚úâÔ∏è üå™Ô∏è üåÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Estamos tan cerca de crear un emulador que pueda recrear perfectamente todas las funciones del hardware real y el software SNES. 
 
 En los √∫ltimos 15...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Emuladores SNES a pocos p√≠xeles de la perfecci√≥n absoluta</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495272/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/44b/f3b/e14/44bf3be14304180044d2e7deb216f07d.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estamos tan cerca de crear un emulador que pueda recrear perfectamente todas las funciones del hardware real y el software SNES. </font></font></i><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En los √∫ltimos 15 a√±os,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como codificador del emulador </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bsnes,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intent√© perfeccionar la emulaci√≥n de Super Nintendo, pero ahora nos enfrentamos al √∫ltimo problema: la sincronizaci√≥n precisa de los ciclos de reloj de los procesadores de video SNES. </font><font style="vertical-align: inherit;">Para alcanzar esta etapa final de precisi√≥n de la emulaci√≥n, se requiere la ayuda de toda la comunidad, y espero su apoyo. </font><font style="vertical-align: inherit;">Pero primero, te dir√© lo que ya hemos logrado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estado actual</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy, la situaci√≥n con la emulaci√≥n SNES es muy buena. Adem√°s de los perif√©ricos inusuales que resisten la emulaci√≥n (por ejemplo, un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">club de golf con un sensor de luz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simulador de bicicleta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y un m√≥dem de acceso telef√≥nico, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilizado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en Jap√≥n </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">para las apuestas de carreras de caballos en</font></a><font style="vertical-align: inherit;"> Jap√≥n), todos los juegos SNES con licencia oficial son totalmente jugables, y ning√∫n juego tiene problemas obvios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La emulaci√≥n SNES se volvi√≥ tan precisa que incluso tuve que dividir el emulador en dos versiones: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">higan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se esfuerza por lograr una precisi√≥n absoluta y coherencia con la documentaci√≥n del hardware, y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bsnes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se esfuerza por la velocidad, amplias capacidades y facilidad de uso.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recientemente, en el campo de la emulaci√≥n SNES, se han recibido muchos logros interesantes, que incluyen:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulaci√≥n de bajo nivel de todos los coprocesadores SNES</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte para modo HD 7</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desmontaje de frenos</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte de pantalla ancha</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSU1 para CD-audio y FMV</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecuci√≥n preliminar para reducir demoras</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control din√°mico de velocidad de datos para una perfecta sincronizaci√≥n de audio y video</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¶ ¬°y mucho m√°s! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ¬øest√° hecho? ¬øTodos trabajaron bien, adi√≥s, y gracias por el pescado? Bueno, no del todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy en d√≠a, hemos logrado precisi√≥n en el nivel de ritmo de casi todos los componentes SNES. Las √∫nicas excepciones fueron los PPU (unidad de procesamiento de im√°genes, m√≥dulos de procesamiento de im√°genes) utilizados para generar cuadros de video transmitidos a la pantalla. Tenemos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre todo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saber c√≥mo funcionan PPU, pero para algunas funciones que tenemos que utilizar conjeturas, lo que conduce a una precisi√≥n imperfecta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En una escala general, los problemas restantes son bastante menores. Si no se esfuerza por lograr la idealidad absolutamente perfecta de la emulaci√≥n por amor al arte, entonces no puedo convencerlo de la necesidad de mejorar a√∫n m√°s la emulaci√≥n de PPU. Como en cualquier campo, cuanto m√°s cerca estemos del ideal, menor ser√° el rendimiento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero puedo decir por qu√© esto es importante para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√≠</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : este es el trabajo de toda mi vida, y no quiero que diga que estuve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cerca de terminar sin dar el √∫ltimo paso. </font><font style="vertical-align: inherit;">Estoy envejeciendo y no soy eterno. </font><font style="vertical-align: inherit;">Quiero que se resuelva la √∫ltima pieza del rompecabezas, de modo que, una vez retirado, est√© seguro de que el legado de SNES es confiable y est√° completamente preservado gracias a la emulaci√≥n. </font><font style="vertical-align: inherit;">Quiero decir que el problema est√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resuelto</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si todav√≠a est√° intrigado, contin√∫e leyendo para familiarizarse con los antecedentes de un problema y las soluciones que le ofrezco.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelado de arquitectura SNES</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos enumerando los componentes que componen SNES:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3c/f4f/e25/c3cf4fe250fbbed2b897e46ef58628bd.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama del sistema Super NES. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las flechas indican las direcciones en las que varios procesadores SNES pueden intercambiar datos entre s√≠, y las l√≠neas punteadas indican las conexiones a los chips de memoria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s importante para nosotros ahora es notar que la salida de video y sonido se transmite directamente desde PPU y DSP. </font><font style="vertical-align: inherit;">Esto significa que act√∫an como "cajas negras", y no podemos ver lo que sucede dentro de ellos. </font><font style="vertical-align: inherit;">M√°s tarde ser√° importante para nosotros.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exactitud</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine que emulamos el comando de CPU "multiplicar", que toma dos registros (variables), los multiplica, recibe el resultado y varios indicadores que indican el estado del resultado (por ejemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desbordamiento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos escribir un programa que multiplique cualquier valor posible de 0 a 255 como factor y multiplicador. Entonces podemos derivar los resultados de multiplicaci√≥n num√©rica y de bandera. Por lo tanto, obtenemos dos tablas de 65 536 elementos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al analizar estas tablas, podemos determinar con precisi√≥n c√≥mo y d√≥nde se establecen los resultados de los c√°lculos de la CPU de una manera determinada. Luego podemos modificar los emuladores para que al ejecutar la misma prueba obtengamos exactamente las mismas tablas al mismo tiempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora digamos que la CPU puede hacer una multiplicaci√≥n de 16 bits x 16 bits. Al probar todos los valores posibles, se generar√°n 4 mil millones de resultados, que son casi imposibles de probar en un per√≠odo de tiempo razonable. Si la CPU tiene multiplicaciones de 32 bits x 32 bits, en la pr√°ctica no ser√° posible probar todas las combinaciones de valores de entrada antes de la muerte t√©rmica del Universo (al menos en el nivel actual de tecnolog√≠a). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tales casos, actuamos en las pruebas de forma m√°s selectiva e intentamos determinar cu√°ndo las banderas pueden cambiar exactamente, cu√°ndo pueden desbordarse los resultados, etc. De lo contrario, tendr√≠amos que ejecutar pruebas que nunca terminar√≠an.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La multiplicaci√≥n es una operaci√≥n bastante trivial, pero el mismo principio puede extenderse a todo el proceso de ingenier√≠a inversa, incluidas las operaciones m√°s complejas, por ejemplo, la transmisi√≥n de datos a trav√©s de DMA (acceso directo a la memoria) durante el retorno horizontal del haz. </font><font style="vertical-align: inherit;">Creamos pruebas que intentan determinar qu√© sucede en casos l√≠mite y luego verificamos si nuestra emulaci√≥n se comporta de manera id√©ntica al comportamiento de SNES real.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generadores de se√±al y latidos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNES tiene dos generadores de se√±al (osciladores): un oscilador de cristal que funciona a una frecuencia de aproximadamente 21 MHz (controla los m√≥dulos CPU y PPU), y un resonador cer√°mico que opera a una frecuencia de aproximadamente 24 MHz, que controla SMP y DSP. </font><font style="vertical-align: inherit;">En los coprocesadores de cartucho, a veces se usa un oscilador de cristal de 21 MHz y, a veces, sus propios generadores de se√±al que funcionan con otras frecuencias.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97d/ecb/bc1/97decbbc1161fcf170f063d2fd42795d.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recrear esta placa de circuito Super Famicom en c√≥digo es m√°s dif√≠cil de lo que parece.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El reloj es el elemento b√°sico de la sincronizaci√≥n de cualquier sistema, y ‚Äã‚ÄãSNES est√° dise√±ado para realizar diversas tareas con ciertas frecuencias e intervalos de tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si imagina un reloj de 100 hertzios, ser√° un dispositivo con una salida binaria que cambia a un estado l√≥gico alto de la se√±al (por ejemplo, +5 V), y luego a un estado bajo de la se√±al (0 V o tierra) 100 veces por segundo. Es decir, cada segundo el voltaje en la salida fluctuar√° 200 veces: aumentar√° 100 veces y bajar√° 100 veces la parte frontal de la se√±al del reloj.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un ciclo de reloj generalmente se considera una transici√≥n completa, es decir, un ciclo de 100 Hz generar√° 100 ciclos de reloj por segundo. </font><font style="vertical-align: inherit;">Algunos sistemas requieren una distinci√≥n entre los bordes ascendente y descendente, y para ellos dividimos el ciclo en semiciclos para indicar cada fase (alta o baja) de la se√±al del reloj. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tarea m√°s importante de un emulador preciso es completar las tareas exactamente de la misma manera y exactamente al mismo tiempo que en un equipo real. </font><font style="vertical-align: inherit;">Sin embargo, no es muy importante </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥mo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se realizan </font><i><font style="vertical-align: inherit;">las</font></i><font style="vertical-align: inherit;"> tareas. </font><font style="vertical-align: inherit;">Lo √∫nico importante es que el emulador, que recibe las mismas se√±ales de entrada, genera las mismas se√±ales de salida al mismo tiempo que en el hardware real.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiempos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces las operaciones llevan tiempo. Tomemos, por ejemplo, la multiplicaci√≥n en la CPU SNES. En lugar de pausar y esperar a que se complete la multiplicaci√≥n, la CPU SNES calcula el resultado de la multiplicaci√≥n un bit a la vez en segundo plano durante ocho ciclos de reloj de los c√≥digos de operaci√≥n de la CPU. Potencialmente, esto permite que el c√≥digo realice otras tareas mientras espera que se complete la multiplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s probable es que cualquier software comercial espere estos ocho ciclos, porque si intenta leer el resultado antes de que est√© listo, obtendremos un resultado parcialmente completado. Sin embargo, antes de que los emuladores de SNES proporcionaran resultados correctos al </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sin esperar estos ciclos de reloj adicionales.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando los fan√°ticos de las consolas comenzaron a crear y probar software auto-escrito en emuladores, esta discrepancia comenz√≥ a causar ciertos problemas. Parte del software, por ejemplo, muchos de los primeros hacks de ROM de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Super Mario World</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , funcionaban correctamente solo en estos viejos emuladores, pero no en el hardware SNES real. Esto sucedi√≥ porque se desarrollaron teniendo en cuenta la obtenci√≥n instant√°nea (no confiable desde el punto de vista del equipo real) de los resultados de la multiplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el proceso de mejorar los emuladores, se rompi√≥ la compatibilidad del software anterior y, por lo tanto, tuvimos que agregar opciones de compatibilidad a los nuevos emuladores para no perder estos programas. S√≠, no importa cu√°n surrealista suene, ¬°pero hoy los emuladores deben emular a otros emuladores!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conveniencia de este retraso de la multiplicaci√≥n en la CPU radica en el hecho de que es muy predecible: ocho ciclos de c√°lculos de reloj comienzan inmediatamente despu√©s de la solicitud de la operaci√≥n de multiplicaci√≥n. </font><font style="vertical-align: inherit;">Al escribir un c√≥digo que lee los resultados despu√©s de cada ciclo, pudimos verificar que la CPU SNES utiliza </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el algoritmo Booth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para la multiplicaci√≥n </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sincronizaci√≥n de reloj</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otras operaciones no son f√°ciles de modelar porque se ejecutan de forma as√≠ncrona en segundo plano. Uno de estos casos es la actualizaci√≥n DRAM del procesador central SNES. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante la representaci√≥n de cada l√≠nea r√°ster, toda la CPU SNES en una determinada etapa suspende su funcionamiento durante un corto per√≠odo de tiempo mientras se actualiza el contenido del chip RAM. Esto es necesario porque para reducir el costo en SNES, se us√≥ RAM din√°mica (en lugar de est√°tica) como memoria principal de la CPU. Para guardar el contenido de la RAM din√°mica, debe actualizarse peri√≥dicamente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d61/cb1/ab9/d61cb1ab914186314069b09f88218fcf.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear un emulador verdaderamente perfecto no es suficiente para garantizar la jugabilidad de los tres mil quinientos juegos de SNES. Tambi√©n es necesario lograr la simulaci√≥n de cada funci√≥n del sistema con una precisi√≥n t√°ctil perfecta.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El factor clave en el an√°lisis de los tiempos exactos de estas operaciones fue la posibilidad de utilizar contadores de PPU horizontales y verticales. Estos contadores realizan incrementos y se reinician despu√©s de cada recorrido de haz horizontal y vertical inverso. Sin embargo, su precisi√≥n es solo una cuarta parte de la frecuencia del generador de se√±al de CPU SNES; en otras palabras, el contador horizontal aumenta cada cuatro ciclos de reloj.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leyendo varias veces los valores de los contadores, pude determinar con qu√© cuarto del ciclo del reloj est√° alineado el contador. Combinando este conocimiento con funciones especialmente creadas que pueden dar un paso hacia el n√∫mero exacto de ciclos de reloj indicado por el usuario, pude hacer coincidir perfectamente la CPU SNES con cualquier posici√≥n exacta del ciclo de reloj que necesito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias a un recorrido iterativo de muchos ciclos de reloj, pude determinar cu√°ndo ciertas operaciones est√°n sucediendo exactamente (por ejemplo, actualizar DRAM, transmitir HDMA, interrumpir el sondeo, etc.). Despu√©s de eso, podr√≠a recrear exactamente todo esto en emulaci√≥n. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chip SMP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La consola SNES tambi√©n tiene sus propios temporizadores, y tambi√©n se realiz√≥ una ingenier√≠a inversa exitosa para este procesador. </font><font style="vertical-align: inherit;">Puedo dedicar un art√≠culo completo solo al registro SMP TEST, que permite a los programadores controlar el divisor de frecuencia SMP y su temporizador, sin mencionar otras cosas terribles. </font><font style="vertical-align: inherit;">Bastar√° decir que no fue un proceso f√°cil y r√°pido, pero al final ganamos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recopilamos coprocesadores</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ce/8ec/80c/1ce8ec80c157a980c0222eb7462679e9.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El chip SuperFX es solo uno de los muchos coprocesadores de cartucho que el emulador SNES puede manejar.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hay un mont√≥n de coprocesadores SNES utilizados dentro de varios cartuchos de juegos que tambi√©n necesitamos domesticar. Desde CPU individuales de uso general como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuperFX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA-1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , procesadores de se√±al digital como DSP-1 y Cx4 hasta aceleradores de descompresi√≥n como S-DD1 y SPC7110, o relojes en tiempo real Sharp y Epson, y mucho m√°s ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto significa que el emulador SNES debe hacer frente a la instrucci√≥n SuperFX y los cach√©s de p√≠xeles; con el esquema de resoluci√≥n de conflictos del bus de memoria SA-1 (que permite que las CPU SNES y SA-1 utilicen los mismos chips ROM y RAM simult√°neamente); con firmware integrado DSP-1 y Cx4; con codificadores aritm√©ticos basados ‚Äã‚Äãen predicci√≥n S-DD1 y SPC7110; as√≠ como con casos l√≠mite impares de BCD (decimal codificado en binario) en generadores en tiempo real. Lento pero seguro, utilizando todas las t√©cnicas para determinar la correcci√≥n y los tiempos descritos anteriormente, logramos aprender a emular todos estos chips casi a la perfecci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se necesit√≥ mucho esfuerzo y miles de d√≥lares para quitar las cubiertas de los chips y el firmware de los procesadores de se√±al digital utilizados en diferentes juegos. En un caso, la emulaci√≥n NEC uPD772x permitida</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°usa el c√≥digo de higan para salvar la voz del difunto Stephen Hawking! </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En otro caso, necesit√°bamos aplicar ingenier√≠a inversa a un conjunto completo de instrucciones para la arquitectura Hitachi HG51B, porque nadie hab√≠a publicado la documentaci√≥n para esta arquitectura. </font><font style="vertical-align: inherit;">En otro caso, result√≥ que un juego ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hayazashi Nidan Morita Shougi 2</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) tiene una poderosa CPU ARM6 de 32 bits con una frecuencia de 21 MHz, que acelera el juego shogi japon√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salvar todos los coprocesadores SNES result√≥ ser un proceso a largo plazo, lleno de dificultades y sorpresas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Procesamiento de se√±ales digitales</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El chip Sony S-DSP (Procesador de se√±al digital), que no debe confundirse con el coprocesador de cartucho DSP-1, gener√≥ un sonido SNES √∫nico. En este chip, se conectaron ocho canales de audio con codificaci√≥n ADPCM de 4 bits, lo que asegur√≥ la creaci√≥n de una se√±al est√©reo de 16 bits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exteriormente, y del diagrama del sistema presentado anteriormente, al principio parece que el DSP es una "caja negra": ajustamos los canales de sonido y los par√°metros del mezclador, despu√©s de lo cual el chip genera el sonido transmitido a los altavoces.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero una funci√≥n importante permiti√≥ al desarrollador bajo el apodo blargg realizar una ingenier√≠a inversa completa de este chip: era un b√∫fer de eco. </font><font style="vertical-align: inherit;">El SNES DSP tiene una funci√≥n que mezcla la salida de muestras anteriores para crear un efecto de eco. </font><font style="vertical-align: inherit;">Esto sucede al final del proceso de generaci√≥n de sonido (aparte del √∫ltimo indicador de bloqueo de sonido, que se puede usar para apagar toda la salida de sonido). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al escribir el c√≥digo con la sincronizaci√≥n correcta de las medidas y rastrear el eco resultante, pudimos determinar el orden exacto de las operaciones realizadas por el DSP para generar de cada muestra y creando un sonido perfecto y precisi√≥n de ritmo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guardar PPU</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo esto nos llev√≥ a la √∫ltima parte del esquema arquitect√≥nico SNES: chips PPU-1 y PPU-2. </font><font style="vertical-align: inherit;">Gracias a John McMaster, tenemos escaneos de los chips S-PPU1 (revisi√≥n 1) y S-PPU2 (revisi√≥n 3) con un aumento de veinte veces.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/678/641/68e/67864168e9f383375b8e081ffff1606f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veinte veces el escaneo del cristal del primer PPU SNES ...</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fad/524/a23/fad524a235729831ae880c3edf1bb4b8.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... y el segundo PPU.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ambos escaneos de cristal nos permiten saber que los chips obviamente no son CPU de uso general, ni son arquitecturas especializadas que ejecutan c√≥digos de operaci√≥n desde la ROM interna del programa de firmware. Estos son circuitos l√≥gicos separados con l√≥gica codificada que reciben se√±ales entrantes de diferentes registros y memoria, y crean una se√±al de video para el monitor, una l√≠nea de trama a la vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las PPU siguen siendo el √∫ltimo obst√°culo para emular SNES porque, a diferencia de todos los componentes descritos anteriormente, las PPU </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son en realidad</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una caja negra. Podemos configurarlos en cualquier estado, pero la CPU SNES no puede monitorear directamente lo que generan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si utilizamos nuestro ejemplo anterior con la multiplicaci√≥n como analog√≠a, imagine que solicit√≥ el resultado 3 * 7, pero en lugar de la respuesta binaria, obtendr√° una imagen anal√≥gica difusa de los n√∫meros "21" en la pantalla. Cualquiera que ejecute su software podr√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ver</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 21, pero no puede escribir un programa de prueba para verificar autom√°ticamente si ve la respuesta correcta. La verificaci√≥n manual de una persona de dichos resultados no se puede escalar a m√°s de varios miles de pruebas, y se necesitar√°n millones para maximizar el comportamiento de la PPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√© lo que pensaba: "¬øPero es m√°s f√°cil usar una tarjeta de captura, realizar el procesamiento de im√°genes, compararlas aproximadamente con la imagen en la pantalla digital del emulador y realizar pruebas basadas en esto?"</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pues s√≠, es posible! </font><font style="vertical-align: inherit;">Especialmente si la prueba es verificar dos grandes n√∫meros que ocupan toda la pantalla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, ¬øqu√© pasa si las pruebas tienen muchos matices y estamos tratando de reconocer la diferencia de color de un medio tono de un p√≠xel? </font><font style="vertical-align: inherit;">¬øQu√© sucede si queremos ejecutar un mill√≥n de pruebas en orden, y no siempre sabemos lo que vamos a generar, pero aun as√≠ queremos comparar el resultado con el resultado de nuestra emulaci√≥n? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nada supera la conveniencia y precisi√≥n con los datos digitales: un flujo preciso de bits que solo pueden coincidir o no coincidir. </font><font style="vertical-align: inherit;">La naturaleza anal√≥gica de una se√±al CRT no puede proporcionarnos esto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© es importante?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la excepci√≥n de un juego ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), todo el software SNES con licencia oficial (deber√≠a haberse basado) en cadenas r√°ster. Estos juegos no intentan cambiar el estado de representaci√≥n de PPU en el medio de la l√≠nea r√°ster renderizada actual (un truco de los programadores se llama "efecto r√°ster"). Esto significa que los tiempos de ejecuci√≥n de la gran mayor√≠a de los juegos no tienen que ser particularmente precisos; Si tiene tiempo para la siguiente l√≠nea r√°ster completa, entonces todo est√° en orden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero esto es importante para un solo juego.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/c75/08c/349c7508c9724e946a687c60881e77fc.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a4/7ee/5b2/3a47ee5b2b9ceacabcf2c4f1c34a1fe3.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/77e/149/23c/77e14923ce342dc49287fa908aea5b93.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta serie de im√°genes muestra un complejo efecto de emulaci√≥n utilizado en el mensaje "Buena suerte" de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En las im√°genes de arriba, puede ver el texto cuadro por cuadro "Buena suerte" de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El juego lo implementa cambiando la posici√≥n de desplazamiento vertical de la capa de fondo 3 (BG3). Sin embargo, la pantalla del tablero a la izquierda (donde puedes ver que el jugador tiene 39 misiles) tambi√©n est√° en la misma capa de fondo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El juego logra realizar esta separaci√≥n cambiando la posici√≥n del desplazamiento BG3 en cada l√≠nea de trama despu√©s de mostrar el tablero izquierdo, pero antes de que el texto "Buena suerte" comience a reproducirse. Esto se puede hacer porque fuera del tablero y el texto, BG3 es transparente y no hay nada que dibujar entre estos dos puntos, independientemente del valor del registro de desplazamiento vertical. Este comportamiento nos muestra que los registros de desplazamiento </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se pueden</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cambiar en cualquier etapa de la representaci√≥n.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/880/658/047/8806580479dcbbaf6671fc971c12ba8b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta peque√±a sombra debajo del avi√≥n caus√≥ muchos dolores de cabeza al desarrollador de emuladores obsesionado con la precisi√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La imagen de arriba muestra la infame sombra de un avi√≥n. Este efecto se representa cambiando el registro de brillo de la pantalla con ondas cortas sobre cinco l√≠neas de trama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante el juego, puedes ver que esta sombra es bastante ca√≥tica. En la imagen de arriba, se parece un poco a la letra "c", pero su forma en cada l√≠nea de trama cambia en longitud y punto de inicio con cada cuadro. Los desarrolladores de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simplemente describieron aproximadamente d√≥nde deber√≠a aparecer la sombra y resolvieron este problema directamente. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la mayor√≠a de los casos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esto funciona.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La correcta emulaci√≥n de tal comportamiento requiere un tiempo perfecto, lo cual es absolutamente </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extremadamente</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dif√≠cil de </font><font style="vertical-align: inherit;">obtener en el emulador </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c5/b7f/fa2/1c5b7ffa2601b6480209321b60a131a1.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la pantalla de pausa de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se usan efectos de trama que no se usaron intencionalmente en ning√∫n otro juego de SNES.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ahora hablemos de la pantalla de pausa. Enciende BG3 mientras dibuja un borde amarillo-negro a la izquierda y lo apaga nuevamente durante el mismo borde a la derecha para dibujar l√≠neas grises en la pantalla. Tambi√©n alterna alternativamente a trav√©s del marco las l√≠neas de trama en las que se muestran estas l√≠neas grises para crear el efecto de una fluctuaci√≥n de fase superpuesta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si ampl√≠a la imagen emulada que se muestra arriba, notar√° que durante el par de l√≠neas de trama en la esquina izquierda de estas l√≠neas grises hay varios p√≠xeles faltantes. Sucedi√≥ porque mi emulaci√≥n PPU es 100% imperfecta en ciclos de reloj. En este caso, provoca el efecto de habilitar BG3 un poco m√°s tarde de lo que deber√≠a.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedo cambiar f√°cilmente los tiempos para que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagen se muestre correctamente. Pero es probable que </font><font style="vertical-align: inherit;">dicho cambio </font><font style="vertical-align: inherit;">afecte negativamente a </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">otros</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> juegos que cambian los registros de visualizaci√≥n de PPU en el medio de la l√≠nea de trama. Aunque </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el √∫nico juego que hace esto a prop√≥sito, hay al menos una docena de juegos en los que esto sucede por casualidad (tal vez IRQ se dispara en ellos demasiado pronto o m√°s tarde). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces, esto provoca da√±os notables breves en la imagen, a los que no se presta atenci√≥n durante el desarrollo (por ejemplo, en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Full Throttle Racing</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">durante la transici√≥n entre la tienda y el juego). A veces, la grabaci√≥n se realiza mientras la pantalla es transparente y, por lo tanto, no causa anomal√≠as visuales (por ejemplo, como en el caso de mostrar el estado de HP en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dai Kaijuu Monogatari II</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Pero incluso estos casos de borde "invisibles" pueden causar problemas en la representaci√≥n menos precisa de las l√≠neas de trama que se utilizan en los emuladores m√°s productivos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso si ignora </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , todos estos efectos de trama aleatorios (pero v√°lidos) en el software SNES no le permiten dise√±ar funcionalmente un renderizador PPU que genere la l√≠nea de trama completa con una precisi√≥n de reloj perfecta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el caso de bsnes durante los a√±os de prueba y error, hemos creado una lista de dichos juegos con "efectos raster". </font><font style="vertical-align: inherit;">Tambi√©n creamos posiciones de representaci√≥n individuales que permiten una representaci√≥n mucho m√°s r√°pida basada en l√≠neas de trama para mostrar correctamente todos estos juegos (a excepci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , por supuesto). </font><font style="vertical-align: inherit;">Pero, en esencia, este es un mont√≥n de trucos desagradables para nosotros, dise√±ados para juegos espec√≠ficos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n tengo un procesador de PPU basado en reloj que no necesita todos estos hacks, pero de vez en cuando crea peque√±as diferencias (de uno a cuatro p√≠xeles) con la representaci√≥n de este equipo, como en la captura de pantalla anterior de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Air Strike Patrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registros de cierre interno</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La raz√≥n de todas estas peque√±as fallas se reduce a sincronizar tiempos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Digamos que SNES representa su </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">famoso modo 7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que es una transformaci√≥n de textura afinada con cambios de par√°metros en cada l√≠nea de trama. </font><font style="vertical-align: inherit;">Para determinar cualquier p√≠xel de la pantalla, debe realizar c√°lculos similares:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">px = a * clip (hoffset - hcenter) + b * clip (voffset - vcenter) +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
b * y + (centro &lt;&lt; 8)</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
py = c * clip (hoffset - hcenter) + d * clip (voffset - vcenter) +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
d * y + (vcenter &lt;&lt; 8)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNES real no podr√° completar todas estas seis multiplicaciones lo suficientemente r√°pido para cada p√≠xel que se representa en el cuadro. </font><font style="vertical-align: inherit;">Pero ninguno de estos valores cambia para cada p√≠xel (o, al menos, no deber√≠a cambiar), por lo que solo necesitamos calcular px y py una vez al comienzo de cada l√≠nea de trama. </font><font style="vertical-align: inherit;">Es decir, PPU almacena en cach√© resultados est√°ticos en pestillos, que son esencialmente copias de registros PPU. </font><font style="vertical-align: inherit;">En el futuro, pueden transformarse o permanecer sin cambios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, las coordenadas x, y se transforman en el modo 7 de la siguiente manera:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ox = (px + a * x) &gt;&gt; 8</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
oy = (py + c * x) &gt;&gt; 8</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque x var√≠a para cada p√≠xel, sabemos que el incremento se realiza en uno cada vez. Gracias al almacenamiento de unidades internas, simplemente podemos agregar valores constantes a y c a ox y oy para cada p√≠xel, en lugar de realizar dos multiplicaciones para cada p√≠xel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces surge la pregunta ante nosotros: ¬øen qu√© posici√≥n particular del ciclo del reloj lee la PPU los valores de a y c de los registros externos de PPU a los que tiene acceso la CPU? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si los tomamos demasiado pronto, esto puede romper algunos juegos. Si lo tomamos demasiado tarde, puede romper otros juegos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La forma m√°s f√°cil es esperar los informes de errores y ajustar estas posiciones para solucionar problemas en cada juego espec√≠fico. Pero en este caso, nunca encontraremos las </font><font style="vertical-align: inherit;">posiciones </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exactas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , solo sus aproximaciones.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y cada vez que cambiamos una de estas variables, no es realista volver a probar los tres mil quinientos juegos de la biblioteca SNES para detectar el deterioro que podr√≠an provocar nuestros cambios.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuera de la sart√©n al fuego</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0a/741/b84/c0a741b84071dd0252021ae422277c1a.jpg"></div> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interpretaci√≥n art√≠stica del proceso de eliminaci√≥n de errores de emulaci√≥n.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Un estilo similar de metodolog√≠a de prueba, "haremos que el juego en el que estamos interesados ‚Äã‚Äãtrabajemos a cualquier costo" conduzca al fen√≥meno, al que llamo emulaci√≥n "desde el fuego, pero hacia el fuego". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al comienzo del desarrollo de la emulaci√≥n SNES, cuando surgieron problemas en el juego, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cualquier</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correcci√≥n en este juego que permiti√≥ que funcionara fue aceptada y agregada al emulador. Esta soluci√≥n necesariamente rompi√≥ alg√∫n otro juego. Y luego corrigieron </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> juego, despu√©s del cual se rompi√≥ el tercero. Arreglar el tercer juego nuevamente rompi√≥ el primero. Esto continu√≥ por muchos a√±os.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El error aqu√≠ fue que los desarrolladores intentaron tener en cuenta solo una variable a la vez. Supongamos que tenemos un juego, y para que funcione, los eventos deben ocurrir entre las medidas 20 y 120. No sabemos la medida exacta, as√≠ que simplemente elija 70, exactamente en el medio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√°s tarde, recibimos un informe de error en otro juego, y determinamos que para que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> juego </font><font style="vertical-align: inherit;">funcione </font><font style="vertical-align: inherit;">, el valor de la medida debe estar entre 10 y 60. As√≠ que ahora lo cambiamos a 40, que funciona para ambos juegos. ¬°Suena l√≥gico! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Pero luego aparece el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tercer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> juego, en el que el evento deber√≠a funcionar entre las medidas 80 y 160! Ahora no podemos hacer que los tres juegos funcionen al mismo tiempo con el mismo valor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto oblig√≥ a los desarrolladores de emuladores a crear hacks para juegos espec√≠ficos. </font><font style="vertical-align: inherit;">Los codificadores no quieren lanzar un emulador en el que no puedas ejecutar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mario</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zelda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metroid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por lo tanto, para el caso general, se usa el ciclo de reloj 40, pero al cargar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metroid,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> forzamos el valor de tiempo a 100. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo es esto posible? ¬øPor qu√© dos juegos necesitan valores diferentes? </font><font style="vertical-align: inherit;">Esto sucede porque no solo una variable est√° involucrada aqu√≠. </font><font style="vertical-align: inherit;">El tiempo que utiliz√≥ anteriormente para desencadenar otro evento puede afectar el valor de tiempo que se requiere para el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√≥ximo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> evento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine esto en forma de una expresi√≥n algebraica simple:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2x + y = 120</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedes resolverlo tomando x = 10, y = 100. O x = 20, y = 80. O x = 30, y = 60. Si solo pensamos en el valor de x, que le permite ejecutar simult√°neamente un conjunto de juegos, entonces perdemos el hecho de que, de hecho, el problema puede estar en la y incorrecta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las primeras versiones de emuladores para aumentar la compatibilidad simplemente redefinieron el valor de x dependiendo del juego en ejecuci√≥n. Tales hacks de juegos individuales persistieron, incluso si luego se descubri√≥ el valor √∫nico correcto de x. Por lo que el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> problema </font><font style="vertical-align: inherit;">nunca ser√° resuelto!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, en el caso de SNES, no hay una o dos variables involucradas simult√°neamente. La consola SNES PPU solo tiene 52 registros externos, que son aproximadamente 130 par√°metros. En el proceso de renderizar una sola l√≠nea de trama, est√°n involucrados los 130 de estos par√°metros y un n√∫mero desconocido de registros internos y pestillos. Esta es demasiada informaci√≥n para que alguien externo pueda darse cuenta del estado completo de la PPU en un momento determinado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este aspecto de la emulaci√≥n no es obvio para los no iniciados, pero es muy justo: la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precisi√≥n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font><em><font style="vertical-align: inherit;">es</font></em><font style="vertical-align: inherit;"> igual a la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compatibilidad</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Podemos crear un emulador con una precisi√≥n del 99 por ciento, capaz de ejecutar el 10% de los juegos. </font><font style="vertical-align: inherit;">Y puedes escribir un emulador con una precisi√≥n del 80% que ejecute el 98% de los juegos. </font><font style="vertical-align: inherit;">A veces, una implementaci√≥n correcta a corto plazo rompe los juegos populares. </font><font style="vertical-align: inherit;">Este es un sacrificio necesario si est√° tratando de lograr una precisi√≥n del </font><font style="vertical-align: inherit;">100% </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una compatibilidad del 100%.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resolver el problema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Llegamos a la etapa actual de la emulaci√≥n de PPU gracias al razonamiento deductivo y los resultados en el mundo real. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sabemos que dos PPU tienen acceso a dos chips VRAM. </font><font style="vertical-align: inherit;">Sabemos que pueden leer de cada chip un n√∫mero conocido de bytes de datos por l√≠nea de trama. </font><font style="vertical-align: inherit;">Conocemos los detalles aproximados de c√≥mo funciona cada uno de los modos de video SNES. </font><font style="vertical-align: inherit;">Y en base a esto, podemos esbozar un patr√≥n generalizado de c√≥mo se ver√≠a la arquitectura. </font><font style="vertical-align: inherit;">Por ejemplo, aqu√≠ hay un breve ejemplo de c√≥mo pueden funcionar los primeros tres modos de video SNES:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (io.bgMode == 0) {</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg4.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg3.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg4.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg3.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
if (io.bgMode == 1) {</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg3.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg3.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchCharacter (1);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchCharacter (0);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchCharacter (1);</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
if (io.bgMode == 2) {</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg2.fetchNameTable ();</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bg1.fetchNameTable ();</font></font><font></font>
<font></font>
bg3.fetchOffset(0);<font></font>
<font></font>
bg3.fetchOffset(8);<font></font>
<font></font>
bg2.fetchCharacter(0);<font></font>
<font></font>
bg2.fetchCharacter(1);<font></font>
<font></font>
bg1.fetchCharacter(0);<font></font>
<font></font>
bg1.fetchCharacter(1);<font></font>
<font></font>
}</pre></blockquote><br>
<h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPU revela a un observador externo solo una peque√±a parte de su estado: banderas horizontales y verticales hacia atr√°s (supresi√≥n horizontal / vertical), recuentos de p√≠xeles horizontales y verticales y banderas de superposici√≥n de mosaicos en el intervalo para sprites. Esto no es tanto, pero repito: cada peque√±o elemento del estado accesible para el observador nos ayuda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La VRAM (RAM de video, memoria de video) del chip PPU durante el renderizado est√° cerrada para las CPU SNES, incluso para la lectura. Pero result√≥ que OAM (memoria de sprites) y CGRAM (memoria de paleta) est√°n abiertas. El truco es que en este momento, la PPU controla el bus de direcciones. Por lo tanto, al leer OAM y CGRAM durante el renderizado de pantalla, puedo observar lo que la PPU obtiene de estos dos bloques de memoria en un momento tan cr√≠tico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas no son todas las piezas del rompecabezas, pero son suficientes para que pueda implementar los patrones pr√°cticamente correctos para obtener sprites. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizando patrones de acceso para OAM y CGRAM abiertos, indicadores de PPU, observaciones generales (es decir, conjeturas) de informes de error para diferentes juegos y razonamiento deductivo, pudimos crear procesadores de PPU basados ‚Äã‚Äãen reloj que pueden </font><font style="vertical-align: inherit;">lanzar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">casi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> perfectamente </font><font style="vertical-align: inherit;">todos los juegos lanzados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero la situaci√≥n sigue siendo precaria: si alguien comienza a crear juegos caseros utilizando el tiempo preciso de los ticks y los efectos de trama, entonces todos nuestros emuladores modernos no podr√°n manejar esto. Incluyendo implementaciones de software y hardware basadas en FPGA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debo decir claramente: hoy </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solo conocen el orden interno de operaciones y el comportamiento de ajuste en los chips PPU de la consola SNES. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nadie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sabe c√≥mo emularlos perfectamente. </font><font style="vertical-align: inherit;">Por ahora.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soluciones posibles</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© haremos con esto? </font><font style="vertical-align: inherit;">¬øC√≥mo determinar el orden exacto de las operaciones en una PPU si, desde el punto de vista de la CPU SNES, es una "caja negra"? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veo cuatro opciones posibles: analizadores l√≥gicos, salida de video digital en modo de prueba, elevadores y extracci√≥n de cubiertas de chips.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analizadores l√≥gicos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si observa los escaneos de cristales de PPU que se muestran arriba, notar√° √°reas negras en los bordes del chip. Estas son las plataformas que se conectan a los contactos de los chips. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos pines almacenan el estado de los chips PPU durante cada ciclo de reloj. Aqu√≠ puede encontrar la direcci√≥n actual a la que los chips acceden al chip de memoria de video, los valores de los datos transferidos de una PPU a la segunda y mucho m√°s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta informaci√≥n no est√° disponible para el c√≥digo que se ejecuta en la CPU SNES, pero proporciona observaciones valiosas sobre el orden interno de las operaciones de PPU.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c8/157/c0d/2c8157c0df8caaebd7e24f620bf2c60f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conectar las PPU de la consola Super NES a un analizador l√≥gico similar puede ser la clave de la caja negra. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema cr√≠tico de los analizadores l√≥gicos es que no son muy convenientes de administrar: si intenta muestrear datos en vivo de un sistema en funcionamiento, obtendremos una secuencia de resultados que es bastante dif√≠cil de descifrar. </font><font style="vertical-align: inherit;">Encontrar√° el mismo problema si intenta analizar la salida RGB anal√≥gica del sistema: para capturar estos datos, deber√° realizar manualmente cada una de las pruebas. </font><font style="vertical-align: inherit;">Tal sistema no es muy bueno para crear pruebas de regresi√≥n automatizadas reproducibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salida de video digital en modo de prueba</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recientemente, a trav√©s de un escaneo de rodajas de cristal con un aumento de 20x, se descubri√≥ un modo de prueba secreto en los chips PPU de la consola SNES. Si realiza una peque√±a modificaci√≥n de hardware, ¬° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la PPU comenzar√° a emitir una se√±al RGB digital de 15 bits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Esto es casi lo que necesitamos! Sin embargo, este modo tiene problemas, porque el famoso modo 7 no puede mostrar la imagen correcta. Parece que esta funci√≥n no se ha completado completamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, para implementar este m√©todo, a√∫n se requieren modificaciones manuales de las consolas SNES y un mecanismo apropiado para capturar y analizar la salida en modo de prueba. </font><font style="vertical-align: inherit;">Sin embargo, a diferencia de la soluci√≥n con la captura de una se√±al RGB anal√≥gica, dicha se√±al digital puede someterse a pruebas autom√°ticas, lo que nos permite completar r√°pidamente una gran cantidad de trabajo en ingenier√≠a inversa PPU.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que las PPU son est√°ticas, podr√≠amos eliminar los chips PPU de una consola SNES en funcionamiento y conectarlos a una placa de prototipos o una placa de circuito personalizada junto con dos chips VRAM. </font><font style="vertical-align: inherit;">Despu√©s de eso, puede colocar un microcontrolador entre la PPU y la interfaz USB, y conectar la interfaz a la PC, lo que permitir√° que el codificador programe todos los registros de memoria de video y PPU externos. </font><font style="vertical-align: inherit;">Adem√°s, el codificador podr√° controlar manualmente los ciclos de reloj de PPU y leer las se√±ales resultantes en los conectores de E / S, registros y en la memoria de PPU en cada ciclo de reloj.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al modificar el emulador de software para que genere los mismos valores internos de los conectores de E / S, podr√≠amos comparar directamente el hardware real con la emulaci√≥n, incluso en tiempo real. </font><font style="vertical-align: inherit;">Sin embargo, este ser√° un trabajo muy duro porque todav√≠a no podemos ver las operaciones internas de PPU.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminaci√≥n de la cubierta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por √∫ltimo, la soluci√≥n m√°s extrema es seguir estudiando el cristal quitando la cubierta del chip. </font><font style="vertical-align: inherit;">Ya tenemos escaneos de cristal con un aumento de 20x, pero su resoluci√≥n no es suficiente para analizar y recrear circuitos l√≥gicos individuales, como se hizo en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el proyecto Visual 6502</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si podemos obtener los escaneos de cristal de ambas PPU con un aumento de 100x, entonces podemos comenzar el arduo trabajo de compilar circuitos PPU y convertirlos en tablas de conexi√≥n o c√≥digo VHDL. </font><font style="vertical-align: inherit;">Luego pueden usarse directamente en FPGA, as√≠ como portarse a C ++ u otro lenguaje de programaci√≥n, aplicable para crear emuladores de software.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un especialista que hab√≠a hecho esto antes me dio una estimaci√≥n aproximada: tomar√≠a aproximadamente 600 horas mapear ambas PPU. </font><font style="vertical-align: inherit;">Esta tarea es mucho m√°s alta que el nivel de "Vamos a recaudar dinero recaudando fondos y pag√°ndole a alguien", e idealmente cae en la categor√≠a "Esperemos que alguien muy talentoso con un conjunto √∫nico de habilidades quiera ayudarnos voluntariamente". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, esto no significa que no estar√≠a contento de recompensar financieramente a alguien por su ayuda, puedo pagar los detalles necesarios y el trabajo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitud de ayuda</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resumir: llegu√© lo m√°s lejos posible en mi proyecto de emulador SNES, y necesito ayuda para completar esta tarea final. </font><font style="vertical-align: inherit;">Si has le√≠do hasta el final, ¬°entonces quiz√°s quieras ayudar! </font><font style="vertical-align: inherit;">¬°Cualquier apoyo, incluida la participaci√≥n en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el proyecto bsnes en GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o cualquier documentaci√≥n de investigaci√≥n sobre el funcionamiento interno de los chips PPU, ser√° de gran valor para nosotros! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Gracias por leer y por su apoyo! </font><font style="vertical-align: inherit;">Ha sido un honor para m√≠ durante quince a√±os ser miembro de la comunidad de emulaci√≥n SNES.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495256/index.html">Sobre puertos y encriptaci√≥n en servidores de correo</a></li>
<li><a href="../es495258/index.html">C√≥mo Zoom se convirti√≥ en la compa√±√≠a m√°s importante en la era del coronavirus</a></li>
<li><a href="../es495262/index.html">Pr√°ctica de actualizaci√≥n de la versi√≥n PostgreSQL. Andrey Salnikov</a></li>
<li><a href="../es495266/index.html">Renacimiento e-learning. Por qu√© 2020 mostrar√° todas las ventajas del aprendizaje a distancia</a></li>
<li><a href="../es495268/index.html">Caso UI / UX: automatizaci√≥n del estacionamiento del aeropuerto</a></li>
<li><a href="../es495274/index.html">C√≥mo arreglar fugas de ruta</a></li>
<li><a href="../es495276/index.html">Y demuestre, o c√≥mo pasamos la auditor√≠a de sostenibilidad operativa en Uptime Institute</a></li>
<li><a href="../es495278/index.html">Bases de datos, tarjetas, listas de verificaci√≥n o por qu√© un administrador de conocimiento empresarial</a></li>
<li><a href="../es495280/index.html">Max Patrol SIEM. Descripci√≥n general del sistema de gesti√≥n de eventos de seguridad de la informaci√≥n</a></li>
<li><a href="../es495282/index.html">Validaci√≥n de XML utilizando XSD, JAXB y Spring Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>