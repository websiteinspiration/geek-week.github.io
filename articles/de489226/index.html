<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🔬 🖇️ 🧛🏻 Methoden zum Optimieren von LINQ-Abfragen in C # .NET ⛩️ 🛌 🔨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einführung
 In diesem Artikel haben wir einige Optimierungstechniken für LINQ-Anfragen besprochen . 
 Hier sind einige weitere Ansätze zur Codeoptimie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Methoden zum Optimieren von LINQ-Abfragen in C # .NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489226/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem Artikel haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir einige Optimierungstechniken für </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-Anfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> besprochen </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sind einige weitere Ansätze zur Codeoptimierung im Zusammenhang mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist bekannt, dass </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Language-Integrated Query) eine einfache und bequeme Sprache zum Abfragen einer Datenquelle ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ to SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist eine Datenzugriffstechnologie in einem DBMS. Dies ist ein leistungsstarkes Tool für die Arbeit mit Daten, bei dem Abfragen in einer deklarativen Sprache erstellt werden, die dann </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">von der</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plattform </font><font style="vertical-align: inherit;">in </font><b><font style="vertical-align: inherit;">SQL-Abfragen</font></b><font style="vertical-align: inherit;"> konvertiert </font><font style="vertical-align: inherit;">und bereits zur Ausführung an den Datenbankserver gesendet werden. In unserem Fall meinen wir mit DBMS </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allerdings </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ - </font><font style="vertical-align: inherit;">Abfragen sind</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht optimal geschrieben konvertieren </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL - </font><font style="vertical-align: inherit;">Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dass ein erfahrener DBA mit allen Nuancen zu optimieren schreiben konnte </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL - </font><font style="vertical-align: inherit;">Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimale Verbindungen ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) und Filterung der Ergebnisse ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viele Nuancen bei der Verwendung von Verbindungen und Gruppenbedingungen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Viele Variationen beim Ersetzen der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bedingungen </font><font style="vertical-align: inherit;">durch </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , &lt;&gt; durch </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zwischen-Caching von Ergebnissen über temporäre Tabellen, CTE, Tabellenvariablen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwenden einer Klausel ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) mit Anweisungen und Tabellenhinweisen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (...)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Verwendung von indizierten Ansichten als eines der Mittel, um redundante Messwerte von Daten in Stichproben zu beseitigen</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die wichtigsten Leistungsengpässe der resultierenden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL-Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beim Kompilieren von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konsolidierung des gesamten Datenauswahlmechanismus in einer Anfrage</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duplizieren identischer Codeblöcke, was letztendlich zu mehreren zusätzlichen Datenlesungen führt</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gruppen von Mehrkomponentenbedingungen (logisch "und" und "oder") - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UND</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ODER</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die unter schwierigen Bedingungen kombiniert werden, führen dazu, dass der Optimierer mit geeigneten nicht gruppierten Indizes anhand der erforderlichen Felder schließlich beginnt, nach dem Clusterindex zu scannen ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEX SCAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) nach Bedingungsgruppe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiefere Verschachtelung von Unterabfragen macht es sehr problematisch zu analysieren </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL - </font><font style="vertical-align: inherit;">Anweisungen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Parse - </font><font style="vertical-align: inherit;">Abfragepläne von Entwicklern und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBAs</font></font></b></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimierungsmethoden</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun gehen wir direkt zu den Optimierungsmethoden über.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Zusätzliche Indizierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist am besten, Filter in den Hauptstichproben-Tabellen zu berücksichtigen, da die gesamte Abfrage sehr oft um eine oder zwei Haupttabellen (Anwendungen-Personen-Operationen) und mit einem Standardsatz von Bedingungen (IsClosed, Cancelled, Enabled, Status) erstellt wird. Für die identifizierten Stichproben ist es wichtig, die entsprechenden Indizes zu erstellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Lösung ist sinnvoll, wenn die Auswahl aus diesen Feldern den zurückgegebenen Satz für die Abfrage erheblich einschränkt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Beispiel haben wir 500.000 Bewerbungen. Es gibt jedoch nur 2.000 aktive Einträge. Ein korrekt ausgewählter Index speichert uns dann </font><font style="vertical-align: inherit;">über eine große Tabelle </font><font style="vertical-align: inherit;">vor </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEX SCAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ermöglicht uns die schnelle Auswahl von Daten über einen nicht gruppierten Index. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fehlende Indizes können auch durch Eingabeaufforderungen zum Parsen von Abfrageplänen oder durch das Sammeln von Statistiken für Systemansichten erkannt werden</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_groups</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_group_stats</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_details</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Ansichtsdaten enthalten Informationen zu fehlenden Indizes mit Ausnahme von räumlichen Indizes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indizes und Caching sind jedoch häufig Methoden, um mit den Auswirkungen schlecht geschriebener </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL-Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> umzugehen </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie die harte Lebenspraxis für das Unternehmen zeigt, ist es oft wichtig, Geschäftsfunktionen bis zu einem bestimmten Datum zu implementieren. Daher werden beim Caching häufig umfangreiche Abfragen in den Hintergrund gestellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist teilweise gerechtfertigt, da der Benutzer nicht immer die neuesten Daten benötigt und eine akzeptable Antwort der Benutzeroberfläche auftritt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Ansatz ermöglicht es Ihnen, geschäftliche Anforderungen zu lösen, verringert jedoch letztendlich die Effizienz des Informationssystems und verzögert lediglich die Lösung von Problemen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist auch zu beachten, dass bei dem Suchvorgang, der zum Hinzufügen neuer Indizes erforderlich ist, die Vorschläge zur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Optimierung möglicherweise falsch sind, auch unter den folgenden Bedingungen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn bereits Indizes mit einem ähnlichen Satz von Feldern vorhanden sind</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn die Felder in der Tabelle aufgrund von Indizierungsbeschränkungen nicht indiziert werden können (mehr dazu wird </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beschrieben </font><font style="vertical-align: inherit;">).</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Zusammenführen von Attributen zu einem neuen Attribut</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal können einige Felder aus derselben Tabelle, in denen eine Gruppe von Bedingungen auftritt, durch die Einführung eines neuen Felds ersetzt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies gilt insbesondere für Statusfelder, die nach Typ normalerweise entweder bitweise oder ganzzahlig sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispiel: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Cancelled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird durch </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status = 1 ersetzt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier geben Sie das Integer-Attribut Status ein, das durch Ausfüllen dieser Status in der Tabelle bereitgestellt wird. </font><font style="vertical-align: inherit;">Der nächste Schritt ist die Indizierung dieses neuen Attributs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine grundlegende Lösung für das Leistungsproblem, da wir Daten ohne unnötige Berechnungen anfordern.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Materialisierung der Einreichung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider können </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> temporäre Tabellen, CTEs und Tabellenvariablen nicht direkt verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt jedoch eine andere Möglichkeit zur Optimierung für diesen Fall - dies sind indizierte Ansichten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Gruppe von Bedingungen (aus dem obigen Beispiel) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Cancelled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (oder eine Reihe anderer ähnlicher Bedingungen) ist eine gute Option, um sie in einer indizierten Ansicht zu verwenden und einen kleinen Datenabschnitt aus einer großen Menge zwischenzuspeichern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt jedoch eine Reihe von Einschränkungen beim Materialisieren einer Ansicht:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei Verwendung von Unterabfragen sollten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klauseln </font><font style="vertical-align: inherit;">mit </font><b><font style="vertical-align: inherit;">JOIN</font></b><font style="vertical-align: inherit;"> ersetzt werden</font></font><b><font style="vertical-align: inherit;"></font></b></li>
<li><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">Kann die Klauseln </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION ALL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXCEPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">INTERSECT</font></b><font style="vertical-align: inherit;"> nicht verwenden</font></font><b><font style="vertical-align: inherit;"></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie können keine Tabellenhinweise und </font><b><font style="vertical-align: inherit;">OPTION-</font></b><font style="vertical-align: inherit;"> Klauseln verwenden</font></font><b><font style="vertical-align: inherit;"></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keine Fähigkeit, mit Zyklen zu arbeiten</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist unmöglich, Daten in einer Ansicht aus verschiedenen Tabellen anzuzeigen</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wichtig zu bedenken, dass die tatsächlichen Vorteile der Verwendung einer indizierten Ansicht nur durch Indizierung erzielt werden können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Aufrufen einer Ansicht werden diese Indizes jedoch möglicherweise nicht verwendet. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sie explizit zu verwenden, müssen Sie </font><b><font style="vertical-align: inherit;">WITH (NOEXPAND)</font></b><font style="vertical-align: inherit;"> angeben </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da </font><font style="vertical-align: inherit;">es unmöglich ist, Tabellenhinweise </font><font style="vertical-align: inherit;">in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu definieren, müssen Sie eine andere Darstellung erstellen - einen „Wrapper“ der folgenden Form:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> _ <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> MAT_VIEW <span class="hljs-keyword">WITH</span> (NOEXPAND);
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Verwenden von Tabellenfunktionen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-Abfragen bilden häufig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> große Unterabfrageblöcke oder Blöcke, die Darstellungen mit einer komplexen Struktur verwenden, die endgültige Abfrage mit einer sehr komplexen und nicht optimalen Ausführungsstruktur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hauptvorteile der Verwendung von Tabellenfunktionen in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-Abfragen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Möglichkeit, wie im Fall von Ansichten, als Objekt zu verwenden und anzugeben, aber Sie können eine Reihe von Eingabeparametern übergeben: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM FUNCTION (@ param1, @ param2 ...)</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
am Ende können Sie eine flexible </font><b><font style="vertical-align: inherit;">Datenabtastung</font></b><font style="vertical-align: inherit;"> erzielen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei Verwendung einer Tabellenfunktion gibt es keine so starken Einschränkungen wie bei den oben beschriebenen indizierten Ansichten:</font></font><br>
<br>
<ol>
<li> :<br>
 <b>LINQ</b>             .<br>
     .<br>
        ,          </li>
<li>  ,     , :<br>
<br>
<ul>
<li>    (   )</li>
<li>     </li>
<li> <b>UNION</b>  <b>EXISTS</b></li>
</ul></li>
</ol><br>
</li>
<li> <b>OPTION</b>  ,       <b>OPTION(MAXDOP N)</b>,    . :<br>
<br>
<ul>
<li>      <b>OPTION (RECOMPILE)</b></li>
<li>         ,    <b>OPTION (FORCE ORDER)</b></li>
</ul><br>
   <b>OPTION</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>.<br>
</li>
<li>      :<br>
        (     ),         .<br>
,  ,     <b>WHERE</b>    <b>(a, b, c)</b>.<br>
<br>
       <b>a = 0 and b = 0</b>.<br>
<br>
,    <b>c</b>  .<br>
<br>
  <b>a = 0 and b = 0</b>          ,    <b></b>      .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier kann die Tabellenfunktion eine bessere Option sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem ist die Tabellenfunktion vorhersehbarer und in der Ausführungszeit konstanter.</font></font><br>
</li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiele</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten wir eine Beispielimplementierung am Beispiel der Fragendatenbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abfrage </font><font style="vertical-align: inherit;">, die mehrere Tabellen kombiniert und eine Ansicht (OperativeQuestions) verwendet, die per E-Mail die Zugehörigkeit (über </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) von "Active Queries" ([OperativeQuestions]) </font><font style="vertical-align: inherit;">überprüft </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfrage Nr. 1</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId],<font></font>
[Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]) <span class="hljs-keyword">AND</span> ( <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1]
<span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestions] <span class="hljs-keyword">AS</span> [Extent5]
<span class="hljs-keyword">WHERE</span> (([Extent5].[Email] = @p__linq__0) <span class="hljs-keyword">OR</span> (([Extent5].[Email] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) 
<span class="hljs-keyword">AND</span> (@p__linq__0 <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>))) <span class="hljs-keyword">AND</span> ([Extent5].[<span class="hljs-keyword">Id</span>] = [Extent1].[<span class="hljs-keyword">Id</span>])<font></font>
));<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ansicht hat eine ziemlich komplizierte Struktur: Sie hat Unterabfrage-Verknüpfungen und die Verwendung der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISTINCT-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sortierung </font><font style="vertical-align: inherit;">, was im allgemeinen Fall eine ziemlich ressourcenintensive Operation ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Auswahl von ungefähr zehntausend Datensätzen aus OperativeQuestions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Hauptproblem dieser Abfrage besteht darin, dass für Datensätze aus einer externen Abfrage eine interne Unterabfrage in der Ansicht [OperativeQuestions] ausgeführt wird, die das Ausgabebeispiel (über </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) auf Hunderte von Datensätzen </font><font style="vertical-align: inherit;">für [Email] = @ p__linq__0 beschränken sollte </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und es könnte den Anschein haben, dass die Unterabfrage die Datensätze einmal mit [Email] = @ p__linq__0 berechnen sollte, und dann sollten diese paar hundert Datensätze mit ID c-Fragen verbunden werden, und die Abfrage wird schnell sein.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich sind alle Tabellen in Reihe geschaltet: ID-Fragen und ID von OperativeQuestions werden auf Konformität überprüft und E-Mail wird gefiltert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich funktioniert die Anforderung mit allen Zehntausenden von OperativeQuestions-Datensätzen, und Sie benötigen nur Daten von Interesse per E-Mail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OperativeQuestions Text anzeigen:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfrage Nr. 2</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"> 
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> [dbo].[OperativeQuestions]
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Q.Id, USR.email <span class="hljs-keyword">AS</span> Email
<span class="hljs-keyword">FROM</span>            [dbo].Questions <span class="hljs-keyword">AS</span> Q <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].ProcessUserAccesses <span class="hljs-keyword">AS</span> BPU <span class="hljs-keyword">ON</span> BPU.ProcessId = CQ.Process_Id 
<span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">APPLY</span>
                     (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> HasNoObjects
                      <span class="hljs-keyword">WHERE</span>   <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>
                                    (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                                     <span class="hljs-keyword">FROM</span>     [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU
                                     <span class="hljs-keyword">WHERE</span>   BOU.ProcessUserAccessId = BPU.[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>)<font></font>
) <span class="hljs-keyword">AS</span> BO <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].Users <span class="hljs-keyword">AS</span> USR <span class="hljs-keyword">ON</span> USR.Id = BPU.UserId
<span class="hljs-keyword">WHERE</span>        CQ.[<span class="hljs-keyword">Exp</span>] = <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> CQ.AnswerId <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> BPU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> 
<span class="hljs-keyword">AND</span> (BO.HasNoObjects = <span class="hljs-number">1</span> <span class="hljs-keyword">OR</span>
              <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                           <span class="hljs-keyword">FROM</span>   [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                                      [dbo].ObjectQuestions <span class="hljs-keyword">AS</span> QBO 
                                                  <span class="hljs-keyword">ON</span> QBO.[Object_Id] =BOU.ObjectId
                               <span class="hljs-keyword">WHERE</span>  BOU.ProcessUserAccessId = BPU.Id 
                               <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> QBO.Question_Id = CQ.Id));
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ursprüngliche Mapping-Darstellung in DbContext (EF Core 2)</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ursprüngliche LINQ-Abfrage</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .Where(x =&gt; x.Email == Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem speziellen Fall wird eine Lösung für dieses Problem ohne infrastrukturelle Änderungen in Betracht gezogen, ohne dass eine separate Tabelle mit vorgefertigten Ergebnissen („aktive Abfragen“) eingeführt wird, unter der ein Mechanismus erforderlich wäre, um die Daten auszufüllen und auf dem neuesten Stand zu halten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl dies eine gute Lösung ist, gibt es eine andere Möglichkeit, diese Aufgabe zu optimieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Hauptziel besteht darin, Einträge in der Ansicht OperativeQuestions mit [Email] = @ p__linq__0 zwischenzuspeichern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir geben die Tabellenfunktion [dbo]. [OperativeQuestionsUserMail] in die Datenbank ein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie E-Mail als Eingabeparameter senden, erhalten Sie die Wertetabelle zurück:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfrage Nr. 3</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> [dbo].[OperativeQuestionsUserMail]<font></font>
(<font></font>
    @Email  <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">RETURNS</span>
@tbl <span class="hljs-keyword">TABLE</span><font></font>
(<font></font>
    [<span class="hljs-keyword">Id</span>]           uniqueidentifier,<font></font>
    [Email]      <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">BEGIN</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> @tbl ([<span class="hljs-keyword">Id</span>], [Email])
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, @Email
        <span class="hljs-keyword">FROM</span> [OperativeQuestions]  <span class="hljs-keyword">AS</span> [x] <span class="hljs-keyword">WHERE</span> [x].[Email] = @Email;<font></font>
     <font></font>
    RETURN;<font></font>
<span class="hljs-keyword">END</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies gibt eine Wertetabelle mit einer vordefinierten Datenstruktur zurück. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit die Abfragen an OperativeQuestionsUserMail optimal sind und optimale Abfragepläne haben, ist eine strikte Struktur erforderlich und nicht </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RETURNS TABLE AS RETURN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall wird die gewünschte Anforderung 1 in Anforderung 4 konvertiert:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfrage Nr. 4</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, Email <span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestionsUserMail] (@p__linq__0)<font></font>
) <span class="hljs-keyword">AS</span> [Extent0]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1] <span class="hljs-keyword">ON</span>([Extent0].Id=[Extent1].Id)
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id], [Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId], [Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]);
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuordnen von Ansichten und Funktionen in DbContext (EF Core 2)</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
 <font></font>
public static class FromSqlQueries<font></font>
{<font></font>
    public static IQueryable&lt;OperativeQuestion&gt; GetByUserEmail(this DbQuery&lt;OperativeQuestion&gt; source, string Email)<font></font>
        =&gt; source.FromSql($"SELECT Id, Email FROM [dbo].[OperativeQuestionsUserMail] ({Email})");<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Letzte LINQ-Abfrage</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .GetByUserEmail(Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Reihenfolge der Ausführungszeit verringerte sich von 200 bis 800 ms auf 2 bis 20 ms usw., dh zehnmal schneller. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir mehr gemittelt nehmen, haben wir statt 350 ms 8 ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus den offensichtlichen Pluspunkten erhalten wir auch:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allgemeine Reduzierung der Leselast,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signifikante Verringerung der Wahrscheinlichkeit einer Blockierung</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduzierung der durchschnittlichen Blockierzeit auf akzeptable Werte</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Optimierung und Feinabstimmung von Aufrufen der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL-Datenbank</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Problem, das gelöst werden kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei dieser Arbeit sind Sorgfalt und Beständigkeit sehr wichtig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu Beginn des Prozesses:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist notwendig, die Daten zu überprüfen, mit denen die Abfrage arbeitet (Werte, ausgewählte Datentypen).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indizieren Sie diese Daten ordnungsgemäß</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überprüfen Sie die Richtigkeit der Verbindungsbedingungen zwischen den Tabellen</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der nächsten Iteration zeigt die Optimierung:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Basis der Anfrage und den Hauptanforderungsfilter</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiederholen ähnlicher Abfrageblöcke und sich überschneidender Bedingungen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In SSMS oder einer anderen GUI für </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL-Abfrage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selbst optimiert </font><font style="vertical-align: inherit;">(Zuweisung eines Zwischendatenspeichers, </font><font style="vertical-align: inherit;">Erstellen </font><font style="vertical-align: inherit;">der resultierenden Abfrage mithilfe dieses Speichers (möglicherweise mehrere).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der letzten Phase wird </font><font style="vertical-align: inherit;">die </font><b><font style="vertical-align: inherit;">LINQ-Abfragestruktur auf der</font></b><font style="vertical-align: inherit;"> Grundlage der resultierenden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL-Abfrage neu erstellt</font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen sollte die resultierende </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-Abfrage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in ihrer Struktur mit der identifizierten optimalen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL-Abfrage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus Absatz 3 </font><font style="vertical-align: inherit;">identisch sein </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Danksagung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank an die Kollegen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jobgemws</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alex_ozr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für die Hilfe bei diesem Artikel.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489204/index.html">Ein Einblick in die Zuverlässigkeit von Facebook-Diensten</a></li>
<li><a href="../de489210/index.html">Testen der Linux-Codeleistung anhand von Beispielen</a></li>
<li><a href="../de489212/index.html">1C-Bitrix verhindert das Abbestellen des Newsletters durch die Verpflichtung zur Übermittlung ihrer persönlichen Daten</a></li>
<li><a href="../de489214/index.html">Moderner Ansatz zum Testen der Lokalisierung unter iOS</a></li>
<li><a href="../de489218/index.html">Es ist naiv. Super: Code und Architektur eines einfachen Spiels</a></li>
<li><a href="../de489228/index.html">Sprachbot in der Bank - die schlechteste UX aller Zeiten</a></li>
<li><a href="../de489230/index.html">Was ist die Leistung von Webanwendungen?</a></li>
<li><a href="../de489232/index.html">Zurück in die Zukunft der Handys II</a></li>
<li><a href="../de489234/index.html">Wie man einen Pentest erfolgreich besteht (schlechter Rat)</a></li>
<li><a href="../de489236/index.html">Frühling: Kontext suchen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>