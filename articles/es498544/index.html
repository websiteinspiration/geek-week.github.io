<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∫ üîÖ üò¢ T√°cticas del equipo rojo: t√©cnicas avanzadas de monitoreo de procesos en operaciones ofensivas ü§Ø üë®üèΩ‚Äç‚öïÔ∏è ü§∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola de nuevo. En la v√≠spera del Pentest. Pr√°ctica de prueba de penetraci√≥n ‚Äù tradujo otro material interesante para usted.
 
 
 
 En este art√≠culo, c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>T√°cticas del equipo rojo: t√©cnicas avanzadas de monitoreo de procesos en operaciones ofensivas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/498544/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola de nuevo. </font><font style="vertical-align: inherit;">En la v√≠spera del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pentest. </font><font style="vertical-align: inherit;">Pr√°ctica de prueba de penetraci√≥n ‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tradujo otro material interesante para usted.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/av/qe/wo/avqewourhsmerqakgy0q9hqbk-e.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este art√≠culo, comprenderemos las capacidades de las conocidas utilidades de monitoreo de procesos y demostraremos c√≥mo usar la tecnolog√≠a subyacente a estas herramientas para las operaciones ofensivas del Equipo Rojo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una buena comprensi√≥n t√©cnica del sistema en el que confiamos es un criterio clave para tomar decisiones sobre cu√°l ser√° el pr√≥ximo paso de la operaci√≥n. La recopilaci√≥n y el an√°lisis de datos sobre procesos en ejecuci√≥n en sistemas comprometidos nos brinda una gran cantidad de informaci√≥n y nos ayuda a comprender c√≥mo funciona la infraestructura de TI de la organizaci√≥n objetivo. Adem√°s, los datos de proceso solicitados peri√≥dicamente nos ayudan a responder a los cambios ambientales y a recibir se√±ales de activaci√≥n cuando comienza una investigaci√≥n.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para poder recopilar datos detallados sobre procesos en puntos finales comprometidos, creamos un conjunto de herramientas que reunieron el poder de las utilidades de procesos avanzadas y los marcos C2 (como Cobalt Strike). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las herramientas (y su c√≥digo fuente) se pueden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encontrar aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilidades internas del sistema de Windows</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar, descubriremos qu√© utilidades se pueden usar para recopilar informaci√≥n sobre procesos inform√°ticos en Windows. </font><font style="vertical-align: inherit;">Luego aprendemos c√≥mo estas utilidades recopilan informaci√≥n para que luego puedan usarse en los kits de herramientas de Red Team.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sistema operativo Windows est√° equipado con muchas utilidades preparadas para administrar el sistema. Aunque la mayor√≠a de las herramientas proporcionadas son adecuadas para fines de administraci√≥n b√°sica del sistema, algunas de ellas no tienen las funciones necesarias para la resoluci√≥n avanzada de problemas y el monitoreo. Por ejemplo, el administrador de tareas de Windows nos brinda informaci√≥n b√°sica sobre todos los procesos que se ejecutan en el sistema, pero ¬øqu√© sucede si necesitamos informaci√≥n m√°s detallada, como descriptores de objetos, conexiones de red o m√≥dulos cargados como parte de un proceso espec√≠fico? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para recopilar dicha informaci√≥n hay una herramienta m√°s avanzada. Por ejemplo, las utilidades del sistema del paquete </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysinternals</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como miembro del Equipo Rojo con amplia experiencia en administraci√≥n de redes y sistemas, siempre he sido un gran admirador de Sysinternals. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando soluciono problemas de un sistema de servidor de ejecuci√≥n lenta o una computadora cliente infectada, a menudo comenc√© a solucionar problemas usando herramientas como Process Explorer o Procmon. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el punto de vista del an√°lisis forense digital, estas herramientas tambi√©n parecen muy √∫tiles para realizar an√°lisis din√°micos b√°sicos de muestras de malware y buscar artefactos en sistemas infectados. Entonces, ¬øpor qu√© estas herramientas son tan populares entre los administradores de sistemas y los profesionales de seguridad? Vamos a resolverlo, profundizando en cierta informaci√≥n del proceso que podemos obtener utilizando la herramienta Process Explorer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando Process Explorer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo primero que vemos al iniciar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Explorer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una lista / √°rbol de todos los procesos en ejecuci√≥n del sistema. </font><font style="vertical-align: inherit;">Esto nos brinda informaci√≥n sobre los nombres de los procesos, sus identificadores, el contexto del usuario y el nivel de integridad del proceso y la informaci√≥n de la versi√≥n. </font><font style="vertical-align: inherit;">La informaci√≥n adicional tambi√©n se puede reflejar ajustando las columnas en consecuencia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/9s/fk/9d9sfkhmwl222wp8vlzcuhcw85y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si utilizamos el panel inferior, podremos ver todos los m√≥dulos cargados por un proceso en particular, o pasar a ver descriptores para familiarizarnos con todos los objetos descriptores nombrados que utiliza el proceso:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/ss/ei/bassei2hnk4jg_kuyl2xd3maihg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los m√≥dulos de navegaci√≥n pueden ser √∫tiles al buscar bibliotecas maliciosas cargadas en el proceso o para Red Team, es un producto de seguridad activo (por ejemplo, EDR) que ha implementado un m√≥dulo de conexi√≥n API en modo de usuario. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/f0/sn/lyf0snflh_begeau_5pjbtwhtis.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Cambiar a descriptores de visualizaci√≥n le permite familiarizarse con el tipo y el nombre de todos los objetos con nombre utilizados en el proceso. Esto puede ser √∫til para averiguar qu√© archivos y claves de registro est√°n abiertos, qu√© canalizaciones con nombre se utilizan para la comunicaci√≥n entre procesos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Si hace doble clic en el nombre del proceso, aparecer√° una ventana con informaci√≥n m√°s detallada. Veamos algunas pesta√±as para conocer las propiedades adicionales del objeto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mx/cr/k-/mxcrk-tik-hny6ailuno3pksvs4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pesta√±a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muestra informaci√≥n sobre la ruta binaria, el directorio de trabajo y las opciones de l√≠nea de comandos. Adem√°s, muestra informaci√≥n sobre el contexto del usuario, el proceso principal, el tipo de imagen (x86 o x64) y mucho m√°s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-i/_o/bu/-i_obubvbxw47snh32g2ysmp7yg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 El </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hilos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pesta√±a </font><font style="vertical-align: inherit;">contiene informaci√≥n sobre c√≥mo ejecutar las discusiones en el proceso. Cuando selecciona una secuencia y luego hace clic en ella, el bot√≥n de pila reflejar√° la pila de llamadas para esta secuencia en particular. Para ver subprocesos / llamadas iniciadas en modo kernel, Process Explorer usa el controlador kernel, que se instala cuando se trabaja en modo elevado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el punto de vista de DFIR, la informaci√≥n de hilos es √∫til para detectar inyecciones en la memoria, por ejemplo, cuando existe una amenaza de virus sin archivos. </font><font style="vertical-align: inherit;">Por lo tanto, las transmisiones que no est√°n respaldadas por archivos en el disco pueden indicar un comportamiento sospechoso. </font><font style="vertical-align: inherit;">Para obtener m√°s informaci√≥n sobre hilos y memoria, le recomiendo que preste atenci√≥n a la herramienta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Hacker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/_s/0s/3w_s0sra5w6xq4_jf56lbg7czu4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Otra pesta√±a interesante en Process Explorer es la pesta√±a TCP / IP. </font><font style="vertical-align: inherit;">En √©l ver√° todas las conexiones de red asociadas con este proceso. </font><font style="vertical-align: inherit;">Desde el punto de vista del ataque, esto puede ser √∫til para comprender cu√°ndo se realiza una conexi√≥n desde un sistema comprometido. </font><font style="vertical-align: inherit;">Una sesi√≥n remota entrante de PowerShell o una sesi√≥n RDP puede indicar que una investigaci√≥n ya ha comenzado.</font></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando los m√©todos discutidos para el ataque</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ahora que hemos aprendido algunas cosas interesantes sobre los procesos y sobre la informaci√≥n que podemos recopilar sobre ellos utilizando Process Explorer, puede preguntarse c√≥mo acceder a esta informaci√≥n desde nuestros marcos C2 favoritos. Por supuesto, podr√≠amos usar PowerShell, ya que esto nos dar√≠a la oportunidad de usar un poderoso lenguaje de scripting y API de Windows. Sin embargo, hoy PowerShell est√° bajo la supervisi√≥n constante del servicio de seguridad, por lo que intentamos evitar este m√©todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cobalt Strike,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podemos usar el comando ps en el contexto de las balizas. Este comando muestra informaci√≥n b√°sica sobre el proceso en funci√≥n de todos los procesos que se ejecutan en el sistema. En combinaci√≥n con un script </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@r3dQu1nn ProcessColor</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, es probable que este m√©todo sea el mejor para obtener datos del proceso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resultado del comando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font><font style="vertical-align: inherit;">√∫til para ordenar r√°pidamente los procesos en ejecuci√≥n, pero no contienen informaci√≥n detallada que pueda ayudarlo a comprender mejor el sistema. </font><font style="vertical-align: inherit;">Para recopilar informaci√≥n m√°s detallada, creamos nuestras propias utilidades para obtener informaci√≥n sobre los procesos. </font><font style="vertical-align: inherit;">Con su ayuda, podemos recopilar y enriquecer la informaci√≥n obtenida de los sistemas comprometidos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ps herramientas </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 No es f√°cil replicar la funcionalidad y la informaci√≥n proporcionadas por una herramienta como Process Explorer. Primero necesitamos descubrir c√≥mo funcionan estas herramientas bajo el cap√≥ (y en modo de usuario), luego debemos entender c√≥mo reflejar mejor esta informaci√≥n en la consola y no en la interfaz gr√°fica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de analizar el c√≥digo fuente, qued√≥ claro que muchas herramientas de bajo nivel para proporcionar informaci√≥n del sistema se basan en gran medida en la API nativa </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Aunque la API y sus estructuras asociadas no est√°n completamente documentadas, esta API le permite recopilar mucha informaci√≥n sobre el sistema Windows. Entonces, usando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como punto de partida para recopilar informaci√≥n sobre los procesos que se ejecutan en el sistema, utilizaremos el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEB de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> procesos individuales para recopilar informaci√≥n detallada sobre cada uno de ellos. </font><font style="vertical-align: inherit;">Usando la API </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQueryInformationProcess,</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podemos leer la estructura </font></font><code>PROCESS_BASIC_INFORMATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando el descriptor de proceso y encontrarla </font></font><code>PebBaseAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Luego usamos la </font></font><code>NtReadVirtualMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API para leer la estructura </font></font><code>RTL_USER_PROCESS_PARAMETERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, lo que nos permitir√° conocer los par√°metros </font></font><code>ImagePathName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y el </font></font><code>CommandLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proceso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizando estas API como base de nuestro c√≥digo, hemos escrito las siguientes herramientas para obtener informaci√≥n sobre procesos:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : muestra una lista detallada de todos los procesos que se ejecutan en el sistema.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : muestra informaci√≥n del kernel, incluidos los controladores cargados.</font></font></li>
<li><i>Psc</i>:        TCP-.</li>
<li><i>Psm</i>:          (    , ).</li>
<li><i>Psh</i>:         (,  ,  ).</li>
<li><i>Psw</i>:        .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Todas estas herramientas est√°n escritas en C como DLL reflectantes y pueden integrarse reflexivamente en un proceso generado utilizando un marco C2 como Cobalt Strike (o cualquier otro marco que admita inyecciones reflectantes de DLL). </font><font style="vertical-align: inherit;">Para Cobalt Strike, hemos agregado un script de agresor que puede usarse para cargar herramientas usando el administrador de script de Cobalt Strike. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos cada herramienta espec√≠fica lanzada en Cobalt Strike para demostrar la funcionalidad y mostrar qu√© informaci√≥n se puede recopilar al usarla:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Esta herramienta muestra una lista detallada de todos los procesos que se ejecutan en el sistema. La salida se puede comparar con la informaci√≥n en la pantalla principal de Process Explorer. Psx muestra el nombre del proceso, su identificaci√≥n, PID padre, tiempo de creaci√≥n e informaci√≥n relacionada con los archivos binarios del proceso (arquitectura, nombre de la compa√±√≠a, versi√≥n, etc.). Como puede ver, tambi√©n muestra informaci√≥n interesante del n√∫cleo activo del sistema, por ejemplo, la direcci√≥n base del n√∫cleo, que es √∫til cuando se opera el n√∫cleo (por ejemplo, para calcular las compensaciones de los dispositivos ROP). Toda esta informaci√≥n se puede recopilar desde un contexto de usuario normal (sin elevaci√≥n de privilegios).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ni/jt/be/nijtbefsyhpct-kkpkxpwdp4pvc.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Si tenemos suficientes permisos para abrir el descriptor de proceso, puede leer informaci√≥n adicional, como el contexto del usuario y el nivel de integridad de su token. </font><font style="vertical-align: inherit;">Enumerar PEB y las estructuras relacionadas le permite obtener informaci√≥n sobre la ruta de la imagen y los par√°metros de la l√≠nea de comando: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-d/hu/bm/-dhubmeevabpdhf1_-f_wpq8q9c.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Como habr√° notado, leemos y mostramos informaci√≥n de la versi√≥n de las im√°genes de procesos binarios, por ejemplo, el nombre y la descripci√≥n de la compa√±√≠a. </font><font style="vertical-align: inherit;">Conociendo el nombre de la empresa, puede enumerar f√°cilmente todos los productos de seguridad activos en el sistema. </font><font style="vertical-align: inherit;">Con esta herramienta, comparamos los nombres de empresas de todos los procesos activos con una lista de proveedores conocidos de productos de seguridad y mostramos los resultados:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xv/c4/nf/xvc4nflmu_fzxkgjq8wuq5zkd0m.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Esta herramienta refleja informaci√≥n sobre el n√∫cleo en ejecuci√≥n, incluidos todos los m√≥dulos de controladores cargados. </font><font style="vertical-align: inherit;">Al igual que la herramienta Psx, tambi√©n proporciona un resumen de todos los m√≥dulos de kernel cargados de productos de seguridad conocidos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/mr/ii/oemrii004bpzkatpi1solktzfvq.png"><br>
 <br>
 <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psc</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Esta herramienta utiliza los mismos m√©todos para mostrar informaci√≥n sobre procesos activos que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , excepto que muestra solo procesos con una conexi√≥n de red activa (IPv4, IPv6 TCP, RDP, ICA):</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/m9/gf/su/m9gfsulxhhfcacdvaofmpmxvdpy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Puede usar esta herramienta para obtener informaci√≥n detallada sobre un proceso espec√≠fico. </font><font style="vertical-align: inherit;">Mostrar√° una lista de todos los m√≥dulos (DLL) utilizados por el proceso y la conexi√≥n de red:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/5x/wc/yu5xwczhban43kmlv5kjjg7o8v8.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psh</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Lo mismo que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero en lugar de m√≥dulos cargados, muestra una lista de descriptores de proceso:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-q/ok/nt/-qokntyj-1pdgaetariouoyi15a.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 La √∫ltima pero no menos importante herramienta </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta herramienta mostrar√° una lista de procesos con identificadores de ventana activos, aquellos que est√°n abiertos en el escritorio del usuario, incluidos los t√≠tulos de las ventanas. </font><font style="vertical-align: inherit;">Esto es √∫til para determinar qu√© interfaces de aplicaciones gr√°ficas abre el usuario sin tener que tomar capturas de pantalla del escritorio:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/ah/zg/tjahzg3ck9ed8-9of7hvv0krrl4.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Casos de uso</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Te preguntar√°s: "¬øY c√≥mo nos ayuda todo esto en las operaciones ofensivas?" </font><font style="vertical-align: inherit;">Despu√©s de obtener acceso a un activo comprometido, usualmente usamos esta informaci√≥n para los siguientes prop√≥sitos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecta herramientas de seguridad en un activo comprometido. </font><font style="vertical-align: inherit;">No solo por informaci√≥n de proceso, sino tambi√©n por m√≥dulos cargados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n de motores de gancho personalizados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Busque oportunidades de maniobras (a trav√©s de sesiones de red) y escalada de privilegios.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s del primer compromiso, puede solicitar peri√≥dicamente informaci√≥n similar sobre los procesos y comenzar a crear desencadenantes. </font><font style="vertical-align: inherit;">Por ejemplo, ingresamos autom√°ticamente esta informaci√≥n en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RedELK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Luego puede crear alertas sobre cambios sospechosos en la informaci√≥n del proceso, tales como:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicie una herramienta de auditor√≠a de seguridad o instale un nuevo producto de seguridad de punto final.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexiones de red entrantes desde el departamento de seguridad a trav√©s de una sesi√≥n RDP o PowerShell remoto.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abrir un identificador por otro proceso en uno de nuestros artefactos maliciosos (por ejemplo, un archivo utilizado para preservar la presencia).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este art√≠culo, mostramos c√≥mo se pueden utilizar herramientas como Sysinternals Process Explorer para obtener informaci√≥n detallada sobre los procesos que se ejecutan en el sistema, y ‚Äã‚Äãc√≥mo esta informaci√≥n puede ayudar a los administradores y profesionales de seguridad a solucionar y verificar el sistema en busca de problemas de seguridad o actuaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La misma informaci√≥n tambi√©n es relevante y √∫til para Red Team, que tiene acceso a sistemas comprometidos durante la operaci√≥n. Ayuda a comprender mejor el sistema y la infraestructura de TI de su objetivo, y el cuestionamiento peri√≥dico de dicho sistema permite que el Equipo Rojo responda a posibles cambios en el entorno (por ejemplo, un desencadenante de investigaci√≥n).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hemos replicado algunas de las funcionalidades proporcionadas por herramientas como Process Explorer, por lo que podemos usar la misma informaci√≥n en operaciones ofensivas. </font><font style="vertical-align: inherit;">Para hacer esto, se han creado varias herramientas de monitoreo de procesos que pueden usarse como parte del marco C2, por ejemplo, Cobalt Strike. </font><font style="vertical-align: inherit;">Mostramos c√≥mo usar estas herramientas y qu√© informaci√≥n puede usar para recopilarlas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas herramientas est√°n disponibles en nuestra </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p√°gina de GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y est√°n listas para usar como parte de Cobalt Strike.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprende m√°s sobre el curso.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es498534/index.html">Reconocimiento de documentos y personas: ¬øuna uni√≥n en nombre de la libertad o un paso hacia una dictadura digital?</a></li>
<li><a href="../es498536/index.html">¬øC√≥mo reutilizar el c√≥digo con los paquetes de Symfony 5? Parte 2. Sacamos el c√≥digo en el paquete</a></li>
<li><a href="../es498538/index.html">Mi hermoso sapo</a></li>
<li><a href="../es498540/index.html">Infograf√≠a con Excel y PowerPoint. Parte 2</a></li>
<li><a href="../es498542/index.html">Clase pr√°ctica "B√∫squeda de malware en IoT"</a></li>
<li><a href="../es498548/index.html">Creando su propio paquete para Laravel Nova: OptimalImage</a></li>
<li><a href="../es498552/index.html">¬øQu√© errores cometen los gerentes en un sitio remoto?</a></li>
<li><a href="../es498556/index.html">Hans Peter Lun y el nacimiento del algoritmo hash</a></li>
<li><a href="../es498560/index.html">Componentes web en un proyecto real</a></li>
<li><a href="../es498562/index.html">Contrariamente a la cuarentena: c√≥mo transferimos nuestras pasant√≠as a un formato remoto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>