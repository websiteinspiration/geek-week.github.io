<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙅🏻 🧝 🤫 Erstellen Sie C ++ mit Bazel 👍🏻 🔗 🕚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einführung und Motivation
 Kürzlich sind auf Habr Beiträge erschienen, in denen cmake und c ++ Freunde sind. Es werden Beispiele dafür gegeben, wie ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Erstellen Sie C ++ mit Bazel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489566/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung und Motivation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kürzlich sind auf Habr Beiträge erschienen, in denen cmake und c ++ Freunde sind. Es werden Beispiele dafür gegeben, wie man nur Header-Bibliotheken sammelt und nicht nur, aber es gibt keinen Überblick über zumindest einige neue Build-Systeme - bazel, buck, gn und andere. </font><font style="vertical-align: inherit;">Wenn Sie wie ich in 2k20 in C ++ schreiben, sollten Sie sich mit bazel als Build-System für ein C ++ - Projekt vertraut machen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden die Frage hinterlassen, wofür cmake und andere vorhandene Systeme schlecht sind, und uns darauf konzentrieren, was Bazel selbst tun kann. </font><font style="vertical-align: inherit;">Um zu entscheiden, was speziell für Sie am besten ist, überlasse ich es speziell für Sie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit Definition und Motivation. </font><font style="vertical-align: inherit;">Bazel ist ein mehrsprachiges Google-Build-System, mit dem C ++ - Projekte erstellt werden können. </font><font style="vertical-align: inherit;">Warum sollten wir uns überhaupt ein anderes Build-System ansehen? </font><font style="vertical-align: inherit;">Erstens, da einige große Projekte bereits an sie gehen, zum Beispiel Tensorflow, Kubernetes und Gtest, und dementsprechend müssen Sie Bazel bereits verwenden können, um sich in sie zu integrieren. </font><font style="vertical-align: inherit;">Zweitens verwendet Google Bazel neben Google noch SpaceX, NVIDIA und andere Unternehmen, gemessen an ihren Leistungen auf Bazelcon. </font><font style="vertical-align: inherit;">Schließlich ist bazel ein ziemlich beliebtes Open-Source-Projekt auf Github, also ist es definitiv einen Blick wert und probieren Sie es aus.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 1. Trivial</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt main.cc und Sie müssen es kompilieren: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
main.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, habr"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles beginnt mit einer Arbeitsbereichserklärung. In Bezug auf den Bazel-Arbeitsbereich ist dies das Verzeichnis, in dem sich alle Ihre Quelldateien befinden. Um diesen Arbeitsbereich zu bestimmen, müssen Sie eine leere Datei mit dem Namen WORKSPACE in dem von uns benötigten Verzeichnis erstellen. In der Regel ist dies das src-Verzeichnis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Mindesteinheit für die Organisation von Code in Bazel ist ein Paket. Das Paket wird durch das Quellverzeichnis und eine spezielle BUILD-Datei definiert, die beschreibt, wie diese Quellen zusammengesetzt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie das Hauptpaket zu unserem Projekt hinzu: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/dq/7l/wqdq7lk5ecrf91hqc2u7og0y3do.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der BUILD-Datei müssen wir nun beschreiben, was wir aus unserem Hauptpaket erstellen möchten. Natürlich möchten wir eine ausführbare Binärdatei kompilieren, daher verwenden wir die Regel cc_binary. Bazel unterstützt C ++ bereits ab Werk, daher gibt es bereits bestimmte Regeln für die Erstellung von C ++ - Zielen. Den Rest werden wir später kennenlernen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie der BUILD-Datei die Regel cc_binary hinzu. Sie enthält einen Namen mit einer ausführbaren Datei und ein Array von Quellen, die an den Compiler übergeben werden. </font><font style="vertical-align: inherit;">All dies wird in Starlark beschrieben, einer abgeschnittenen Python.</font></font><br>
<br>
<pre><code class="python hljs">cc_binary(<font></font>
  name = <span class="hljs-string">"hello_world"</span>,<font></font>
  srcs = <span class="hljs-string">"main.cc"</span><font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel basiert im Gegensatz zu cmake nicht auf Befehlen, sondern ermöglicht die deklarative Beschreibung von Abhängigkeiten durch Regeln. </font><font style="vertical-align: inherit;">Im Wesentlichen ordnen Regeln einer bestimmten Operation mehrere Artefakte zu. </font><font style="vertical-align: inherit;">Mit ihnen erstellt bazel ein Befehlsdiagramm, das dann zwischengespeichert und ausgeführt wird. </font><font style="vertical-align: inherit;">In unserem Fall ist die Quelldatei main.cc einer Kompilierungsoperation zugeordnet, deren Ergebnis das Artefakt hello_world ist - eine binäre ausführbare Datei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um unsere ausführbare Datei zu erhalten, müssen wir in das Verzeichnis mit dem Arbeitsbereich gehen und Folgendes eingeben:</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //main:hello_world
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Build-System akzeptiert den Build-Befehl und den Pfad zu unserem Ziel, beginnend mit der Wurzel unseres Projekts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die resultierende Binärdatei befindet sich unter bazel-bin / main / hello_world.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 2. Erstellen Sie mit Ihrer Bibliothek</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Glücklicherweise braucht niemand so einfache Projekte. Lassen Sie uns sehen, wie wir unserem Projekt Funktionen hinzufügen können. </font><font style="vertical-align: inherit;">Fügen Sie eine Bibliothek hinzu, die separat erstellt und mit unserer Hauptbibliothek verknüpft wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sei es Square, eine Bibliothek, die eine eindeutige Quadrierungsfunktion bietet. </font><font style="vertical-align: inherit;">Das Hinzufügen einer neuen Bibliothek bedeutet das Hinzufügen eines neuen Pakets. Nennen wir es auch Quadrat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/kr/0o/kvkr0o7nryy4fddsibmtge2dabo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
square.h</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SQUQRE_SQUARE_H_</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SQUQRE_SQUARE_H_</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Square</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// SQUQRE_SQUARE_H_</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
square.cc</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Square</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>{
  <span class="hljs-keyword">return</span> x * x;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Achten Sie auf die Verbindung der Header-Datei, ich mache es über den Pfad vom Arbeitsbereich, obwohl sich die Datei im selben Verzeichnis befindet. Dieser Ansatz wird im Chromcode-Styleguide übernommen, der vom Google C ++ - Styleguide übernommen wurde. Mit dieser Methode können Sie sofort nachvollziehen, von wo aus die Header-Datei verbunden ist. Keine Sorge, es wird eine Datei geben. Bazel fügt Pfade hinzu, um nach Header-Dateien zu suchen. Wenn Sie diese Regel jedoch nicht befolgen, werden Header-Dateien möglicherweise während des Bazel-Builds nicht gefunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der BUILD-Datei unserer Bibliothek beschreiben wir die Regel zum Erstellen der cc_library-Bibliotheken:</font></font><br>
<br>
<pre><code class="python hljs">cc_library(<font></font>
  name = <span class="hljs-string">"square"</span>,<font></font>
  srcs = [<span class="hljs-string">"square.cc"</span>],<font></font>
  hdrs = [<span class="hljs-string">"square.h"</span>],<font></font>
  visibility = [<span class="hljs-string">"//visibility:public"</span>]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier listen wir die Quell- und Header-Dateien getrennt auf und geben auch die Sichtbarkeit in der Öffentlichkeit an. </font><font style="vertical-align: inherit;">Letzteres ist notwendig, damit wir uns überall in unserem Projekt auf unsere Bibliothek verlassen können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In main.cc verwenden wir unsere Bibliothek:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, bazel!"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; Square(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich mache erneut darauf aufmerksam, dass wir die Header-Datei der Bibliothek über den Pfad vom Arbeitsbereich einschließen. </font><font style="vertical-align: inherit;">Dies ist hier bereits unbedingt erforderlich, da bazel Linux-Container unter der Haube verwendet, um ein Mindestmaß an Dichtheit der Baugruppe sicherzustellen, und dementsprechend die quadratischen Bibliotheksheaderdateien so bereitstellt, dass sie sich über den Pfad vom Arbeitsbereich befinden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir beschreiben die Abhängigkeit in der Assembly-Regel für main von der quadratischen Bibliothek.</font></font><br>
<br>
<pre><code class="python hljs">cc_binary(<font></font>
  name = <span class="hljs-string">"hello_world"</span>,<font></font>
  srcs = [<span class="hljs-string">"main.cc"</span>],<font></font>
  deps = [<span class="hljs-string">"//square:square"</span>]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser gesamtes Programm wird auf die gleiche Weise zusammengestellt wie ohne Verwendung der Bibliothek. Bazel selbst wird verstehen, worauf es ankommt, ein Diagramm erstellen, die Ergebnisse zwischenspeichern und nur das neu erstellen, was neu erstellt werden muss.</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //main:hello_world
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 3. Verbindungstests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie kann man ohne Tests leben? </font><font style="vertical-align: inherit;">Auf keinen Fall! </font><font style="vertical-align: inherit;">Um eine Verbindung zu bazel GTest herzustellen, das übrigens bereits die Montage mit bazel unterstützt, müssen Sie eine externe Abhängigkeit hinzufügen. </font><font style="vertical-align: inherit;">Dies erfolgt in der WORKSPACE-Datei:</font></font><br>
<br>
<pre><code class="python hljs">load(<span class="hljs-string">"@bazel_tools//tools/build_defs/repo:git.bzl"</span>, <span class="hljs-string">"git_repository"</span>)<font></font>
<font></font>
git_repository(<font></font>
  name = <span class="hljs-string">"googletest"</span>,<font></font>
  remote = <span class="hljs-string">"https://github.com/google/googletest"</span>,<font></font>
  tag = <span class="hljs-string">"release-1.8.1"</span><font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Genau wie Hipster haben sie die git_repository-Regel verbunden und bazel mitgeteilt, welche Version heruntergeladen werden soll. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Nächstes erstellen wir ein separates Paket für </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testtests </font><font style="vertical-align: inherit;">und fügen unserer Bibliothek Tests hinzu: </font><font style="vertical-align: inherit;">square_unittest.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"gtest/gtest.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
TEST(SquareTests, Basics) {<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">-1</span>), <span class="hljs-number">1</span>);<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<font></font>
    EXPECT_EQ(Square(<span class="hljs-number">2</span>), <span class="hljs-number">4</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ist es an der Zeit, eine Regel für Tests zu definieren.</font></font><br>
<br>
<pre><code class="python hljs">cc_test(<font></font>
  name = <span class="hljs-string">"unittests"</span>,<font></font>
  srcs = [<span class="hljs-string">"square_unittest.cc"</span>],<font></font>
  deps = [<font></font>
   <span class="hljs-string">"//square:square"</span>,
   <span class="hljs-string">"@googletest//:gtest_main"</span><font></font>
  ]<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben Abhängigkeiten von unserer Bibliothek und von gtest_main hinzugefügt, damit die gtest-Bibliothek selbst uns eine Launcher-Implementierung bietet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tests werden mit dem folgenden Befehl ausgeführt:</font></font><br>
<br>
<pre><code class="bash hljs">bazel <span class="hljs-built_in">test</span> //<span class="hljs-built_in">test</span>:unittests
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel wird GTest selbst herunterladen und erstellen, alles verknüpfen, was für die Tests benötigt wird, und die Tests selbst ausführen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich erwähne, dass bazel auch weiß, wie man Code abdeckt:</font></font><br>
<br>
<pre><code class="bash hljs">bazel coverage //<span class="hljs-built_in">test</span>:unittests
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn Sie Tests debuggen müssen, können Sie alles im Debug-Modus mit folgenden Zeichen kompilieren:</font></font><br>
<br>
<pre><code class="bash hljs">bazel build //<span class="hljs-built_in">test</span>:unittests --compilation_mode=dbg -s
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 4. Anschließen anderer Bibliotheken, die nicht wissen, wie man bazelt</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich ist die Welt nicht nur auf Bazel aufgebaut, daher müssen Sie auch andere Bibliotheken verbinden können. </font><font style="vertical-align: inherit;">Kürzlich brauchte ich in meinem Projekt eine Bibliothek, um Befehlszeilenargumente zu analysieren. </font><font style="vertical-align: inherit;">Nun, um mir in 2k20 nicht deine eigene solche Bibliothek zu schreiben und dich von der Hauptarbeit ablenken zu lassen. </font><font style="vertical-align: inherit;">Ich möchte wirklich keine halben Sachen wie getops verwenden und Boost in mein Projekt ziehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nicht für Werbung, wir verbinden die CLI11-Bibliothek, die nur den Standard-Standard C ++ 11 verwendet und eine mehr oder weniger bequeme Oberfläche bietet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Bibliothek ist nur für Header gedacht, was das Verbinden besonders einfach macht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verbinden Sie die externe Abhängigkeit in WORKSPACE:</font></font><br>
<br>
<pre><code class="python hljs">load(<span class="hljs-string">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="hljs-string">"http_file"</span>)<font></font>
<font></font>
http_file(<font></font>
  name = <span class="hljs-string">"CLI11"</span>,<font></font>
  downloaded_file_path = <span class="hljs-string">"CLI11.hpp"</span>,<font></font>
  urls = [<span class="hljs-string">"https://github.com/CLIUtils/CLI11/releases/download/v1.9.0/CLI11.hpp"</span>],<font></font>
  sha256 = <span class="hljs-string">"6f0a1d8846ed7fa4c2b66da3eb252aa03d27170258df..."</span>,<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir fügen das Verzeichnis eines Drittanbieters hinzu und fügen das CLI11-Paket hinzu, um Abhängigkeiten von dieser Bibliothek zu erstellen:</font></font><br>
<br>
<pre><code class="python hljs">cc_library(<font></font>
  name = <span class="hljs-string">"CLI11"</span>,<font></font>
  hdrs = [<span class="hljs-string">"@CLI11//file"</span>],<font></font>
  strip_include_prefix = <span class="hljs-string">"/external/CLI11/file"</span>,<font></font>
  include_prefix = <span class="hljs-string">"CLI11"</span>,<font></font>
  linkstatic = <span class="hljs-literal">True</span>,<font></font>
  visibility = [<span class="hljs-string">"//visibility:public"</span>],<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bazel sucht standardmäßig nach der Bibliotheksdatei entlang des Pfads / external / CLI11, sodass wir die Pfade ein wenig ändern, um sie über CLI11 / zu verbinden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
main.cc</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CLI11/CLI11.hpp"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"square/square.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello, bazel!"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; Square(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie je nach Haupt "// Drittanbieter / CLI11: CLI11" hinzu, und alles beginnt zu funktionieren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich weiß nichts über Sie, aber das Verbinden einer unbekannten Bibliothek und deren Verwendung in einem C ++ - Projekt in dieser Form freut mich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, mit der Nur-Header-Bibliothek werden Sie sagen, dass alles einfach ist, aber mit einer Nicht-Header-Bibliothek, die noch nicht mit Bazel erstellt wurde, ist alles genauso einfach. </font><font style="vertical-align: inherit;">Sie laden es einfach über http_archive oder git_repository herunter und fügen eine externe BUILD-Datei im Verzeichnis eines Drittanbieters hinzu, in der Sie beschreiben, wie Sie Ihre Bibliothek erstellen. </font><font style="vertical-align: inherit;">Bazel unterstützt das Aufrufen von cmd und sogar das Aufrufen von cmake über die Regel cmake_external.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 5. Skripte und Automatisierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wer braucht ein Projekt in Bare C ++ in 2k20 ohne Skripte zur Automatisierung? </font><font style="vertical-align: inherit;">In der Regel werden solche Skripte benötigt, um Perf-Tests auszuführen oder Ihre Artefakte irgendwo in CI bereitzustellen. </font><font style="vertical-align: inherit;">Normalerweise sind sie in Python geschrieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hierfür eignet sich auch Bazel, da es in fast allen gängigen Sprachen verwendet werden kann und dazu dient, solche Solyanka aus verschiedenen Programmiersprachen zu sammeln, die so häufig in realen Projekten vorkommen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verbinden wir das Python-Skript, mit dem unser Main ausgeführt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie das Perf-Test-Paket hinzu:</font></font><br>
<br>
<pre><code class="python hljs">py_binary(<font></font>
  name = <span class="hljs-string">"perf_tests"</span>,<font></font>
  srcs = [<span class="hljs-string">"perf_tests.py"</span>],<font></font>
  data = [<font></font>
    <span class="hljs-string">"//main:hello_world"</span>,<font></font>
  ],<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie als Datenabhängigkeit die binäre Abhängigkeit hello_world hinzu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
perf_tests.py</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
start_time = time.time()<font></font>
process = subprocess.run([<span class="hljs-string">'main/hello_world, '</span>param1<span class="hljs-string">', ],
                         stdout=subprocess.PIPE,
                         universal_newlines=True)
end_time = time.time()
print("--- %s seconds ---" % (end_time - start_time))
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um unsere Tests durchzuführen, schreiben wir einfach:</font></font><br>
<pre><code class="bash hljs">bazel run //perf-tests:perf_tests
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit und was nicht berührt wird</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben uns kurz mit bazel und seinen Hauptfunktionen zum Zusammenstellen ausführbarer Dateien und Bibliotheken befasst, sowohl von Drittanbietern als auch von uns. </font><font style="vertical-align: inherit;">Für meinen Geschmack fällt es ziemlich prägnant und sehr schnell aus. </font><font style="vertical-align: inherit;">Sie müssen nicht leiden und nach einem cmake-Tutorial suchen, um etwas Triviales zu tun und CmakeCache zu bereinigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie interessiert sind, bleibt noch viel übrig: Verbinden von Protokollpuffern, Desinfektionsprogrammen, Einrichten einer Toolkette zum Kompilieren für verschiedene Plattformen / Architekturen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danke fürs Lesen und ich hoffe, ich war nützlich für Sie.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489554/index.html">Kleine Feinheiten von java.lang.String</a></li>
<li><a href="../de489556/index.html">Geben Sie Threads aus ThreadPool beim Debuggen in VS keine Namen</a></li>
<li><a href="../de489558/index.html">Über Samsung hat das Flaggschiff TV aktualisiert: Q950 - Änderungen, Pfosten sowie Prognosen für das neue Gerät</a></li>
<li><a href="../de489560/index.html">Reagieren Sie auf das native Feedback-Formular mit AWS + Telegram</a></li>
<li><a href="../de489562/index.html">Testen in Kotlin mit Spock</a></li>
<li><a href="../de489568/index.html">DEFCON 27 Konferenz. Vervielfältigung von mechanischen Schlüsseln mit eingeschränktem Zugriff. Teil 1</a></li>
<li><a href="../de489576/index.html">Die Nuancen der modernen Medizin</a></li>
<li><a href="../de489582/index.html">Auf der Suche nach Godzilla. Neuronale Netze und Prognoseangebote basierend auf Austausch- und "externen" Daten</a></li>
<li><a href="../de489584/index.html">So verbessern Sie Ihren API-Service auf node.js. Teil 1</a></li>
<li><a href="../de489586/index.html">Klangvisualisierung auf Vintage-Lampen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>