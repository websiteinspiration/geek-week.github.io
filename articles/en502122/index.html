<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôãüèø üëÇüèΩ ü¶í Thanos - Scalable Prometheus üßëüèΩ‚Äçü§ù‚ÄçüßëüèΩ üéå üì¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The translation of the article was prepared specifically for students of the course "DevOps Practices and Tools" .
 
 
 
  (Fabian Reinartz) ‚Äî , Go . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Thanos - Scalable Prometheus</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/502122/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The translation of the article was prepared specifically for students of the course </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"DevOps Practices and Tools"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/hn/yb/6z/hnyb6zs1kjgdaigpvcdypntr4yo.png"><br>
<hr><br>
<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  (Fabian Reinartz)</a> ‚Äî   ,  Go     .    Prometheus   Kubernetes SIG instrumentation.     production-  SoundCloud      CoreOS.      Google.<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  (Bartek Plotka)</a> ‚Äî    Improbable.       .      Intel,    Mesos  production- SRE    Improbable.    .   : Golang, open source  .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Looking at our flagship SpatialOS product, you can guess that Improbable needs a highly dynamic global cloud infrastructure with dozens of Kubernetes clusters. We were one of the first to use the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> monitoring system </font><font style="vertical-align: inherit;">. Prometheus is capable of tracking millions of metrics in real time and comes with a powerful query language to retrieve the necessary information. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplicity and reliability Prometheus is one of its main advantages. However, having passed a certain scale, we encountered several drawbacks. To solve these problems, we developed </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- An open source project created by Improbable to seamlessly transform existing Prometheus clusters into a single monitoring system with an unlimited repository of historical data. </font><font style="vertical-align: inherit;">Thanos is available on github </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stay up to date with the latest news from Improbable.</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Our goals with Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At a certain scale, problems arise that go beyond the capabilities of the vanilla Prometheus. </font><font style="vertical-align: inherit;">How to reliably and economically store petabytes of historical data? </font><font style="vertical-align: inherit;">Can this be done without prejudice to the response time to the request? </font><font style="vertical-align: inherit;">Is it possible to access all metrics located on different Prometheus servers with a single API request? </font><font style="vertical-align: inherit;">Is it possible to somehow combine the replicated data collected using Prometheus HA? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To address these issues, we created Thanos. </font><font style="vertical-align: inherit;">The following sections describe how we approached these issues and explained the goals we pursued.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querying data from multiple instances of Prometheus (global query)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus offers a functional approach to sharding. Even one Prometheus server provides sufficient scalability to free users from the difficulties of horizontal sharding in almost all use cases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although this is an excellent deployment model, it is often required to access data on different Prometheus servers through a single API or UI - global view. Of course, it is possible to display several requests in one Grafana panel, but each request can be executed only on one Prometheus server. On the other hand, with Thanos, you can query and aggregate data from multiple Prometheus servers, as they are all accessible from one endpoint. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Previously, to get a global view of Improbable, we organized our Prometheus instances into a multi-level</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hierarchical Federation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This meant creating one Prometheus meta server that collects a portion of the metrics from each leaf server, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pv/0j/w3/pv0jw3yhsdl31rqexmamjdx4tiy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
which proved problematic, complicating the configuration, adding an additional potential point of failure and applying complex rules to provide the federated endpoint with just the right data. In addition, federation of this kind does not allow you to get a real global view, since not all data is accessible from one API request.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Closely related to this is the single presentation of data collected on the Prometheus high-availability (HA) servers. The Prometheus HA model independently collects data twice, which is so simple that it couldn't be simpler. However, using a combined and deduplicated representation of both threads would be much more convenient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, there is a need for highly available Prometheus servers. At Improbable, we are really serious about monitoring data every minute, but having one instance of Prometheus per cluster is a single point of failure. Any configuration error or hardware failure can potentially result in the loss of important data. Even simple deployments can lead to minor glitches in the collection of metrics, since restarting can be significantly longer than the scraping interval.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reliable storage of historical data</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cheap, fast and long-term metrics storage is our dream (shared by most Prometheus users). </font><font style="vertical-align: inherit;">In Improbable, we were forced to set the storage period for the metrics to nine days (for Prometheus 1.8). </font><font style="vertical-align: inherit;">This adds obvious limitations to how far we can look back. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus 2.0 is better in this regard, as the number of time series no longer affects the overall server performance (see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubeCon keynote about Prometheus 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">However, Prometheus stores data on a local drive. </font><font style="vertical-align: inherit;">Although highly efficient data compression can significantly reduce the use of a local SSD, there is still a limitation on the amount of historical data that is saved.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At Improbable, we also care about reliability, simplicity and cost. </font><font style="vertical-align: inherit;">Large local drives are more difficult to operate and back up. </font><font style="vertical-align: inherit;">They are more expensive and require more backup tools, which leads to unnecessary complexity.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Downsampling</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As soon as we started working with historical data, we realized that there are fundamental difficulties with O-big that make queries slower and slower if we work with data for weeks, months and years. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A standard solution to this problem will be </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">downsampling</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äî downsampling the signal. </font><font style="vertical-align: inherit;">By downsampling, we can ‚Äúscale down‚Äù to a larger time range and maintain the same number of samples, which allows us to maintain responsiveness of requests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Downsampling old data is an inevitable requirement of any long-term storage solution and goes beyond vanilla Prometheus.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Additional goals</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the initial goals of the Thanos project was to seamlessly integrate with any existing Prometheus installations. </font><font style="vertical-align: inherit;">The second goal was simple operation with a minimum entry barrier. </font><font style="vertical-align: inherit;">Any dependencies should be easily satisfied for both small and large users, which also implies a low base cost.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos Architecture</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After our goals were listed in the previous section, let's work on them and see how Thanos solves these problems.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Global view</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get a global view on top of existing instances of Prometheus, we need to associate a single request entry point with all servers. This is exactly what the Thanos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sidecar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> component does </font><font style="vertical-align: inherit;">. It is deployed next to each Prometheus server and acts as a proxy, serving local Prometheus data through the Store API's gRPC interface, allowing you to select time series data by label and time range. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the other hand, there is a stateless horizontally scalable Querier component that does a bit more than just responding to PromQL requests through the standard Prometheus HTTP API. Components Querier, Sidecar, and other Thanos communicate via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the gossip protocol</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1p/zn/ts/1pzntsrxrwhxxvdou57tpxhypwm.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When receiving a request, Querier connects to the corresponding Store API server, that is, to our Sidecar, and receives time series data from the corresponding Prometheus servers.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After that, it combines the answers and performs a PromQL query on them. </font><font style="vertical-align: inherit;">Querier can combine both disjoint data and duplicate data from Prometheus HA servers.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This solves the bulk of our puzzle - combining data from isolated Prometheus servers into a single view. </font><font style="vertical-align: inherit;">In fact, Thanos can only be used for this opportunity. </font><font style="vertical-align: inherit;">Existing Prometheus servers do not need to make any changes!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unlimited shelf life!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, sooner or later we will want to save data that goes beyond the normal storage time of Prometheus. To store historical data, we have chosen object storage. It is widely available in any cloud, as well as in local data centers and is very economical. In addition, almost any object storage is accessible through the well-known S3 API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus writes data from RAM to disk approximately every two hours. The block of stored data contains all the data for a fixed period of time and is immutable. This is very convenient, since Thanos Sidecar can simply look at the Prometheus data catalog and, as new blocks appear, load them into the object storage buckets.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ss/l6/lh/ssl6lhmk5kyfwe0luqcsbpe8z9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Downloading to the object storage immediately after writing to a disk also allows you to keep the simplicity of a ‚Äúscraper‚Äù (Prometheus and Thanos Sidecar) simple. Which simplifies the support, cost and system design. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, backing up data is very simple. But what about querying data in object storage? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Thanos Store component acts as a proxy for retrieving data from object storage. Like Thanos Sidecar, it participates in the gossip cluster and implements the Store API. Thus, existing Querier can consider it as Sidecar, as another source of time series data - no special configuration is required.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/n_/pl/vqn_pl2z-oq1-m1yiix-y-tgvwc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Time series data blocks are made up of several large files. Downloading them on demand would be quite inefficient, and local caching required huge memory and disk space. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead, Store Gateway knows how to handle the Prometheus storage format. Thanks to the clever query planner and caching of only the necessary index parts of the blocks, it became possible to reduce complex queries to the minimum number of HTTP requests to object storage files. Thus, it is possible to reduce the number of requests by four to six orders of magnitude and achieve response times that are generally difficult to distinguish from data requests on a local SSD.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/c-/hv/qxc-hvkg1llfi9oaoee6uxtla9c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As shown in the diagram above, Thanos Querier significantly reduces the cost of a single data request in the object storage by using the Prometheus storage format and placing related data side by side. </font><font style="vertical-align: inherit;">Using this approach, we can combine many single queries into a minimum number of bulk operations.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compaction and downsampling</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the new time series data block has been successfully loaded into the object storage, we consider it as ‚Äúhistorical‚Äù data that immediately becomes available through the Store Gateway. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, after a while, blocks from one source (Prometheus with Sidecar) accumulate and no longer use the full indexing potential. To solve this problem, we introduced another component called Compactor. It simply applies the local Prometheus compaction mechanism to historical data in the object store and can be run as a simple periodic batch job.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/wt/sy/lpwtsym1qftrslmkks3fre9q2o8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks to efficient compression, a query to the repository over a long period of time does not present problems in terms of data size. However, the potential cost of unpacking a billion values ‚Äã‚Äãand running them through a query processor will inevitably lead to a sharp increase in query execution time. On the other hand, since there are hundreds of data points per pixel of the screen, it becomes impossible to even visualize the data in full resolution. Thus, downsampling is not only possible, but will not lead to a noticeable loss of accuracy.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/ju/gh/xmjughzg4svkzo0behzid9tt02s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For downsampling data, Compactor continuously aggregates data with a resolution of five minutes and one hour. For each raw fragment encoded using TSDB XOR compression, various types of aggregated data are stored, such as min, max or sum for one block. This allows Querier to automatically select the aggregate that is suitable for this PromQL query. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To use data with reduced accuracy, the user does not need any special configuration. Querier automatically switches between different resolutions and raw data as the user zooms in and out. If desired, the user can control this directly through the ‚Äústep‚Äù parameter in the request.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since the cost of storing one GB is small, by default Thanos saves the original data, data with a resolution of five minutes and one hour. </font><font style="vertical-align: inherit;">There is no need to delete the original data.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recording rules</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even with Thanos recording rules are an essential part of the monitoring stack. </font><font style="vertical-align: inherit;">They reduce the complexity, latency and cost of requests. </font><font style="vertical-align: inherit;">They are also convenient for users to obtain aggregated metric data. </font><font style="vertical-align: inherit;">Thanos is based on vanilla instances of Prometheus, so it‚Äôs perfectly acceptable to store recording rules and alerting rules on an existing Prometheus server. </font><font style="vertical-align: inherit;">However, in some cases this may not be enough:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Global alerts and rules (for example, alerts when a service is down on more than two of the three clusters).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rule for data outside of local storage.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The desire to keep all the rule and alert in one place.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/wu/da/bf/wudabfepzgopbamehs1hqzx5s7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For all of these cases, Thanos includes a separate component called Ruler, which computes rule and alert through Thanos Queries. </font><font style="vertical-align: inherit;">By providing the well-known StoreAPI, the Query node can access freshly computed metrics. </font><font style="vertical-align: inherit;">Later, they are also stored in the object store and made available through the Store Gateway.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The power of Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanos is flexible enough to be customized to your requirements. </font><font style="vertical-align: inherit;">This is especially useful when migrating from simple Prometheus. </font><font style="vertical-align: inherit;">Let's take a quick look at what we learned about the components of Thanos. </font><font style="vertical-align: inherit;">Here's how to transfer your vanilla Prometheus to the world of ‚Äúunlimited metrics storage":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d-/y0/cn/d-y0cnjpddmhvlfbw-8c7fvqt7o.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add Thanos Sidecar to your Prometheus servers - for example, the adjacent container in the Kubernetes pod.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expand multiple Thanos Querier replicas to view data. </font><font style="vertical-align: inherit;">At this point, it‚Äôs easy to set up gossip between Scraper and Querier. </font><font style="vertical-align: inherit;">Use the metric 'thanos_cluster_members' to test component interactions.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Only these two steps are enough to provide a global view and seamless data deduplication from potential Prometheus HA replicas! </font><font style="vertical-align: inherit;">Just connect your dashboards to the Querier HTTP endpoint or use the Thanos UI interface directly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, if you need to back up metrics and long-term storage, you will need to perform three more steps:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build an AWS S3 or GCS Bucket. </font><font style="vertical-align: inherit;">Configure Sidecar to copy data to these buckets. </font><font style="vertical-align: inherit;">Now you can minimize local data storage.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expand the Store Gateway and connect it to an existing gossip cluster. </font><font style="vertical-align: inherit;">Now you can send data requests in backups!</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy Compactor to improve query performance over long periods of time using compaction and downsampling.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to know more, feel free to look at our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples of the manifest kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getting started</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In just five steps, we have turned Prometheus into a reliable monitoring system with global view, unlimited storage time and potential high availability of metrics.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pull request: we need you!</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was an open source project from the start. </font><font style="vertical-align: inherit;">Seamless integration with Prometheus and the ability to use only part of Thanos makes it an excellent choice for scaling a monitoring system without any extra effort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We always welcome GitHub Pull Request and Issues. </font><font style="vertical-align: inherit;">At the same time, do not hesitate to contact us through Github Issues or slack </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Improbable-eng #thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> if you have questions or feedback, or want to share your experience! </font><font style="vertical-align: inherit;">If you like what we do at Improbable, feel free to contact us - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we always have vacancies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Learn more about the course.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502104/index.html">The secretary robot, bot informant, bot therapist and other projects of the online hackathon VirusHack</a></li>
<li><a href="../en502114/index.html">Game of Motivations. Part 1</a></li>
<li><a href="../en502116/index.html">Overview of PVS-Studio version 7.07 features</a></li>
<li><a href="../en502118/index.html">Design at the system level. Part 3: Linking System Composer and the MathWorks Toolchain</a></li>
<li><a href="../en502120/index.html">Remote monitoring and diagnostics of production equipment</a></li>
<li><a href="../en502124/index.html">2019 venture results for Ukraine</a></li>
<li><a href="../en502126/index.html">How to Improve Your English Programmer Resume</a></li>
<li><a href="../en502132/index.html">How to transfer OpenVZ 6 container to KVM server without headache</a></li>
<li><a href="../en502134/index.html">Enough to be afraid of subjectively beautiful decisions in the code - you are not robots</a></li>
<li><a href="../en502136/index.html">Data compression in Apache Ignite. Sberbank Experience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>