<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👩‍👧 🌭 👩🏼‍🚀 Docker Compose: simplifiez l'utilisation de Makefile 🕗 🙅🏼 🍔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Toutes les quelques années, un changement de paradigme se produit dans l'industrie du développement logiciel. L'un de ces phénomènes est l'intérêt cro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Docker Compose: simplifiez l'utilisation de Makefile</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/486682/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les quelques années, un changement de paradigme se produit dans l'industrie du développement logiciel. </font><font style="vertical-align: inherit;">L'un de ces phénomènes est l'intérêt croissant pour le concept de microservices. </font><font style="vertical-align: inherit;">Bien que les microservices ne soient pas la dernière technologie, ce n'est que récemment que sa popularité a littéralement explosé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les grands services monolithiques sont aujourd'hui remplacés par des microservices autonomes indépendants. </font><font style="vertical-align: inherit;">Un microservice peut être considéré comme une application qui sert un objectif unique et très spécifique. </font><font style="vertical-align: inherit;">Par exemple, il peut s'agir d'un SGBD relationnel, d'une application Express, d'un service Solr. </font><font style="vertical-align: inherit;">
De nos jours, il est difficile d'imaginer le développement d'un nouveau système logiciel sans l'utilisation de microservices. </font><font style="vertical-align: inherit;">Et cette situation, à son tour, nous conduit à la plate-forme Docker.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/xj/7x/qr/xj7xqrze4d6ijidic1zuonqbr1c.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plate </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">forme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans le développement et le déploiement de microservices, est devenue une norme presque industrielle. </font><font style="vertical-align: inherit;">Sur le site Web du projet, vous pouvez découvrir que Docker est la seule plate-forme de conteneurisation indépendante qui permet aux organisations de créer sans effort des applications, ainsi que de les distribuer et de les exécuter dans n'importe quel environnement - des nuages ​​hybrides aux systèmes frontaliers.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker compose</font></font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
technologie </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Docker Compose</font></a><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">conçue pour configurer des applications multi-conteneurs. </font><font style="vertical-align: inherit;">Un projet Docker Compose peut inclure autant de conteneurs Docker que le créateur de ce projet en a besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous travaillez avec Docker Compose, un fichier YAML est utilisé pour configurer les services d'application et organiser leur interaction les uns avec les autres. </font><font style="vertical-align: inherit;">Docker Compose est donc un outil pour décrire et exécuter des applications multi-conteneurs Docker.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49c/b5a/9bf/49cb5a9bf3288a6cd933c6210f8a56bf.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux conteneurs fonctionnant sur le système hôte</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU Make</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un programme </font></font><code>make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est essentiellement un outil pour automatiser l'assemblage de programmes et de bibliothèques à partir du code source. En général, nous pouvons dire qu'il est </font></font><code>make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">applicable à tout processus qui comprend l'exécution de commandes arbitraires pour convertir certains matériaux source en une certaine forme résultante, dans un certain but. Dans notre cas, les équipes </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seront converties en objectifs abstraits ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cibles bidon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de dire au programme </font></font><code>make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce que nous en attendons, nous avons besoin d'un fichier </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La nôtre </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiendra les commandes habituelles </font></font><code>docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui sont conçus pour résoudre de nombreux problèmes. </font><font style="vertical-align: inherit;">À savoir, nous parlons d'assembler le conteneur, de le démarrer, de l'arrêter, de le redémarrer, d'organiser la connexion de l'utilisateur au conteneur, de travailler avec les journaux du conteneur et de résoudre d'autres problèmes similaires.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisations typiques de Docker Compose</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez une application Web standard qui comprend les composants suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base de données TimescaleDB (Postgres).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application Express.js.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ping (juste un conteneur qui ne fait rien de spécial).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette application aura besoin de 3 conteneurs Docker et d'un fichier </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contenant des instructions pour gérer ces conteneurs. </font><font style="vertical-align: inherit;">Chacun des conteneurs aura différents points d'interaction. </font><font style="vertical-align: inherit;">Par exemple, </font></font><code>timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez travailler </font><font style="vertical-align: inherit;">avec un conteneur de </font><font style="vertical-align: inherit;">la même manière que vous travaillez avec des bases de données. </font><font style="vertical-align: inherit;">À savoir, il vous permet d'effectuer les actions suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez-vous au shell Postgres.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importer et exporter des tableaux.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez une </font></font><code>pg_dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table ou une base de données.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le conteneur d'une application Express.js ,, </font></font><code>expressjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut avoir les fonctionnalités suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La sortie de nouvelles données du journal système.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entrez dans le shell pour exécuter certaines commandes.</font></font></li>
</ul><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interaction avec les conteneurs</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir configuré la connexion entre les conteneurs à l'aide de Docker Compose, il est temps d'établir une interaction avec ces conteneurs. </font><font style="vertical-align: inherit;">Dans le cadre du système Docker Compose, une commande </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend en charge une option </font></font><code>-f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui vous permet de transférer un fichier sur le système </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant les capacités de cette option, vous pouvez limiter l'interaction avec le système uniquement aux conteneurs mentionnés dans le fichier </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetez un œil à l'apparence des interactions de conteneur lors de l'utilisation de commandes </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si nous imaginons que nous devons entrer dans le shell </font></font><code>psql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, les commandes correspondantes peuvent ressembler à ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker-compose -f docker-compose.yml exec timescale psql -Upostgres</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La même commande pour laquelle non </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais est utilisée </font></font><code>docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, peut ressembler à ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker exec -it&nbsp; edp_timescale_1 psql -Upostgres</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que dans de tels cas, il est toujours préférable d'utiliser non pas une commande </font></font><code>docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais une commande </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car cela élimine la nécessité de se souvenir des noms de conteneurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux commandes ci-dessus ne sont pas si compliquées. </font><font style="vertical-align: inherit;">Mais si nous utilisions un «wrapper» sous une forme </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui nous donnerait une interface sous forme de commandes simples et appellerait nous-mêmes de telles commandes, alors les mêmes résultats pourraient être obtenus comme ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">make db-shell</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est évident que l'utilisation </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplifie grandement le travail avec des conteneurs!</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de travail</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la base du diagramme de projet ci-dessus, créez le fichier suivant </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">version: '3.3'<font></font>
services:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;api:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;build: .<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image: mywebimage:0.0.1<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ports:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 8080:8080<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volumes:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /app/node_modules/<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depends_on:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- timescale<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command: npm run dev<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networks:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- webappnetwork<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;timescale:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image: timescale/timescaledb-postgis:latest-pg11<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;environment:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- POSTGRES_USER=postgres<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- POSTGRES_PASSWORD=postgres<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command: ["postgres", "-c", "log_statement=all", "-c", "log_destination=stderr"]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volumes:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ./create_schema.sql:/docker-entrypoint-initdb.d/create_schema.sql<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networks:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- webappnetwork<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ping:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image: willfarrell/ping<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;environment:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOSTNAME: "localhost"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIMEOUT: 300<font></font>
networks:<font></font>
&nbsp;&nbsp;&nbsp;webappnetwork:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;driver: bridge</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour gérer la configuration Docker Compose et interagir avec les conteneurs qu'elle décrit, créez le fichier suivant </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">THIS_FILE := $(lastword $(MAKEFILE_LIST))<font></font>
.PHONY: help build up start down destroy stop restart logs logs-api ps login-timescale login-api db-shell<font></font>
help:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make -pRrq&nbsp; -f $(THIS_FILE) : 2&gt;/dev/null | awk -v RS= -F: '/^# File/,/^# Finished Make data base/ {if ($$1 !~ "^[#.]") {print $$1}}' | sort | egrep -v -e '^[^[:alnum:]]' -e '^$@$$'<font></font>
build:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml build $(c)<font></font>
up:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml up -d $(c)<font></font>
start:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml start $(c)<font></font>
down:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml down $(c)<font></font>
destroy:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml down -v $(c)<font></font>
stop:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml stop $(c)<font></font>
restart:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml stop $(c)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml up -d $(c)<font></font>
logs:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml logs --tail=100 -f $(c)<font></font>
logs-api:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml logs --tail=100 -f api<font></font>
ps:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml ps<font></font>
login-timescale:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml exec timescale /bin/bash<font></font>
login-api:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml exec api /bin/bash<font></font>
db-shell:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml exec timescale psql -Upostgres</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des commandes décrites ici s'appliquent à tous les conteneurs, mais l'utilisation de l'option </font></font><code>c=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous permet de limiter la portée de la commande à un seul conteneur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prêt, vous pouvez l'utiliser comme ceci:</font></font><br>
<br>
<ul>
<li><code>make help</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- émission d'une liste de toutes les commandes disponibles pour </font></font><code>make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c92/808/916/c92808916bcd3d861c25a47c22cc1694.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aide sur les commandes disponibles</font></font></font></i><br>
 <br>
<ul>
<li><code>make build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- assemblage de l'image à partir de </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans notre exemple, nous avons utilisé des images existantes </font></font><code>timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>ping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais </font></font><code>api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous voulons collecter l' </font><font style="vertical-align: inherit;">image </font><font style="vertical-align: inherit;">localement. </font><font style="vertical-align: inherit;">C'est exactement ce qui sera fait après l'exécution de cette commande.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a5/23f/8fc/8a523f8fca803a9b2c21411d7e3ad037.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensemble conteneur Docker</font></font></font></i><br>
 <br>
<ul>
<li><code>make start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- lancement de tous les conteneurs. </font><font style="vertical-align: inherit;">Pour démarrer un seul conteneur, vous pouvez utiliser la commande du formulaire </font></font><code>make start c=timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/087/f72/559/087f725597d994d7929e50da56dd2d4d.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancer le conteneur de l'échelle de temps</font></font></font></i><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ee/a13/4e3/1eea134e39cf2c8d58dac881c143c135.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancer le conteneur ping</font></font></font></i><br>
<br>
<ul>
<li><code>make login-timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- entrée dans la session bash du conteneur </font></font><code>timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b87/63a/66c/b8763a66cdb78760244cb41ea6c26c6e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exécution de bash dans un conteneur d'échelle de temps</font></font></font></i><br>
<br>
<ul>
<li><code>make db-shell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Connectez-vous </font></font><code>psql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au conteneur </font></font><code>timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour exécuter des requêtes SQL dans la base de données.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac6/669/3e8/ac66693e81e9adefdbf14b2541ba176d.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exécution de psql dans le conteneur timescaledb</font></font></font></i><br>
<br>
<ul>
<li><code>make stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - arrêt des conteneurs.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf9/0f8/cb0/bf90f8cb006ba2ec136a4bdf6b956de3.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arrêt du conteneur de l'échelle de temps</font></font></font></i><br>
<br>
<ul>
<li><code>make down</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- arrêtez et retirez les conteneurs. </font><font style="vertical-align: inherit;">Pour supprimer un conteneur spécifique, vous pouvez utiliser cette commande avec le conteneur spécifié. </font><font style="vertical-align: inherit;">Par exemple - </font></font><code>make down c=timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>make down c=api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/779/ede/fd8/779edefd85df7dcedec4ead9b0bae09f.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arrêtez et supprimez tous les conteneurs</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgré le fait que le système Docker Compose nous donne un ensemble complet de commandes conçues pour gérer les conteneurs, parfois ces commandes deviennent longues et, par conséquent, elles peuvent être difficiles à retenir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La méthodologie d'utilisation </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous a permis d'établir une interaction rapide et facile avec les conteneurs du fichier </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">À savoir, nous parlons de ce qui suit:</font></font><br>
<br>
<ul>
<li>     ,   <code>docker-compose.yml</code>,      .</li>
<li>  ,    ,    <code>make help</code>      .</li>
<li>         ,         . ,   <code>docker-compose -f docker-compose.yml exec timescale psql -Upostgres</code>   <code>make db-shell</code>.</li>
<li> <code>Makefile</code> ,    ,    . ,                 .</li>
<li>         <code>Makefile</code>,        .</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sur notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marché,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il y a une image </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est installée en un clic. </font><font style="vertical-align: inherit;">Vous pouvez vérifier le fonctionnement des conteneurs sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tous les nouveaux clients bénéficient de 3 jours gratuits pour les tests. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment automatisez-vous le travail avec Docker Compose?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr486682/">https://habr.com/ru/post/fr486682/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486672/index.html">OpenVINO Hackathon: reconnaître la voix et l'émotion sur le Raspberry Pi</a></li>
<li><a href="../fr486674/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 400 (27 janvier - 2 février 2020)</a></li>
<li><a href="../fr486676/index.html">Inévitabilité de la pénétration du FPGA dans les centres de données</a></li>
<li><a href="../fr486678/index.html">Quartz dans ASP.NET Core</a></li>
<li><a href="../fr486680/index.html">ML, VR & Robots (et un peu de cloud)</a></li>
<li><a href="../fr486684/index.html">Ma réponse à ceux qui croient que la valeur du TDD est exagérée</a></li>
<li><a href="../fr486686/index.html">À propos de l'implémentation d'une bibliothèque d'apprentissage en profondeur dans Python</a></li>
<li><a href="../fr486688/index.html">Node.js, Tor, Puppeteer et Cheerio: grattage web anonyme</a></li>
<li><a href="../fr486690/index.html">5 conseils pour écrire des fonctions fléchées de qualité</a></li>
<li><a href="../fr486692/index.html">Fonctionnalités de la console Chrome que vous n'avez peut-être jamais utilisées</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>