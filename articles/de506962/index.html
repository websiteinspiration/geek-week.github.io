<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤹🏽 👨🏾‍🎨 😂 Async / warte in Unity 🍃 ♥️ 🏐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gruß, Chabrowsk. Bis zum Beginn des Kurses "Game Developer on Unity" bleibt nur sehr wenig Zeit. In diesem Zusammenhang haben wir für Sie eine weitere...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Async / warte in Unity</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/506962/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gruß, Chabrowsk. </font><font style="vertical-align: inherit;">Bis zum Beginn des Kurses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Game Developer on Unity"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bleibt nur sehr wenig Zeit. </font><font style="vertical-align: inherit;">In diesem Zusammenhang haben wir für Sie eine weitere interessante Übersetzung vorbereitet.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/37/kv/yt/37kvytgqxylnrra818g7eckd5ly.png"><br>
<hr><br>
<code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity funktioniert bereits </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ohne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plugins oder </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corutin-Wrapper, die asynchrones Verhalten simulieren und die Fertigstellung für jeden Frame überprüfen. </font><font style="vertical-align: inherit;">Aber es ist immer noch eine Art Magie. </font><font style="vertical-align: inherit;">Gehen wir etwas tiefer in dieses Thema ein. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Hinweis: Derzeit habe ich kein ideales Verständnis für alle Details der Motorhaube </font></font><code>async/await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in C #, daher werde ich versuchen, das Vorstehende zu ergänzen, da sich mein Verständnis vertieft.)</font></font></i><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel</font></font></h4><br>
<img src="https://habrastorage.org/webt/ps/8i/so/ps8isowfho7xsjl99bnyzfh_5fo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, ich benötige eine Schaltfläche, die beim Klicken eine klassische Boxanimation wiedergibt. Es gibt jedoch einen Haken: Die Schaltfläche muss in einen inaktiven Zustand versetzt werden (Verdunkeln um </font></font><code>.interactable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bis die</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Box die Drehung beendet hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus Gründen der Code-Sauberkeit möchte ich eine verwenden </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die auf den Abschluss der Drehung der Box wartet, und sofort eine Zeile hinzufügen, die wiederhergestellt wird </font></font><code>interactable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, anstatt ein Objekt mit Coroutine zu erstellen, und den Status in jedem Frame überprüfen, um diese Aufgabe zu starten. Ein offensichtlicher linearer Code an einer Stelle ist ein großes Plus an Lesbarkeit. Solcher Code ist schön zu schreiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der folgende einfache, kompakte Code implementiert die erforderliche Aufgabe. (</font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methoden werden auch in der Unity-Delegatenliste angezeigt, keine Sorge.)</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpinBox</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Button button;
    <span class="hljs-keyword">public</span> Animation ani;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpinAndDisableButton</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        ani.Play();<font></font>
        button.interactable = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">while</span> (ani.isPlaying == <span class="hljs-literal">true</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> Task.Yield();<font></font>
        }<font></font>
        button.interactable = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}</code></pre><br>
<br>
<img src="https://habrastorage.org/webt/m-/or/ad/m-orad9ixe4ebtae_f6hm0ast1w.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sind einige Fragen, die Sie hätten stellen sollen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Wer" "führt" den </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rest der Methode aus? </font><font style="vertical-align: inherit;">Wie magisch es im nächsten Frame überprüft wird, während der Anruf </font></font><code>SpinAndDisableButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nur einmal getätigt wird und keine </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coroutinen neu gestartet werden müssen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist der Zeitpunkt für jeden Lauf?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">Dies scheint der Schlüssel zu allem zu sein, was hier passiert. </font><font style="vertical-align: inherit;">Ich nehme an, Sie sind an </font></font><code>yield return null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coroutinen gewöhnt. </font><font style="vertical-align: inherit;">Eine gute Vermutung wäre, es im nächsten Frame erneut zu versuchen, aber Sie sagen dies über den C # -Enumerator. </font><font style="vertical-align: inherit;">Der Wortlaut für Ertrag ist ähnlich, und sogar das Verhalten ist ähnlich.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kontext synchronisieren</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erfahren </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie, </font><font style="vertical-align: inherit;">wie der Rest des Programms nach </font><font style="vertical-align: inherit;">Belieben </font><font style="vertical-align: inherit;">erfasst und fortgesetzt werden kann (z. B. in welchem ​​Thread? Im aufrufenden Thread oder in dem Thread, der die Aufgabe startet?). </font><font style="vertical-align: inherit;">Dann werden Sie feststellen, dass es auch Unity gibt ein solches Konzept, aber es ist für uns auf den ersten Blick nicht sichtbar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Vergleich zu einem normalen C # -Programm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist nicht alles das gleiche wie in regulären C # -Programmen. Ein Blick auf die offizielle Dokumentation </font></font><code>await. await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impliziert eine Rückkehr zum Aufrufer des Objekts </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Anrufer kann fortfahren, bis er das Ergebnis der Ausführung benötigt, und er kann es sich zu diesem Zeitpunkt nicht mehr leisten, etwas anderes zu tun (es spielt keine Rolle, ob die Aufgabe Multithreading ist oder nicht), außer </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Diese Kette kann fortgesetzt werden, bis Sie endlich dazu kommen </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wenn wir uns auch treffen </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vom Compiler eine </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">weitere Wartezeit</font></a><font style="vertical-align: inherit;"> generiert, die das Ergebnis sofort anfordert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun zurück zu uns </font></font><code>SpinAndDisableButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wohin geht die Rückkehr </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? In der Einheit haben wir nicht</font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, da es tief im Motorcode verborgen ist. Die Frage ist in der Tat dieselbe wie die </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">die auftritt </font><font style="vertical-align: inherit;">, </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und so weiter. Dies ist eine </font></font><code>PlayerLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API, die den Engine-Code innerhalb des Spielzyklus unterstützt, um ein geordnetes Rendern von Objekten und allem, was im Frame ausgeführt wird, bereitzustellen. Aber vorher hat uns das nicht gestört, da diese Einstiegspunkte bisher zurückgekehrt sind </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt wird </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der Ausführungspunkt an jemanden zurückgegeben, in der Hoffnung, dass er von diesem Punkt aus später an einem bestimmten Punkt automatisch fortfahren kann. Dann geht die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spielschleife weiter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bis</font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wartet. </font><font style="vertical-align: inherit;">Andernfalls würden wir die rotierende Box überhaupt nicht sehen, wenn wir wirklich warten würden, bis die Box die Animation beendet hat, da die Animation nicht enden könnte, wenn der Rahmenwechsel nicht fortgesetzt würde. </font><font style="vertical-align: inherit;">Was wird also im nächsten Frame passieren? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist der Pseudocode, den wir in einem anderen Frame empfangen möchten als dem, in dem wir die Taste gedrückt und dadurch deaktiviert haben:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">for</span> ( )<font></font>
{<font></font>
    <span class="hljs-keyword">if</span>(  )<font></font>
    {<font></font>
    	 .<font></font>
    }<font></font>
  <font></font>
     .<font></font>
         .<font></font>
        .<font></font>
}</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debuggen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie weitere Protokolle in den Code ein, und wir werden versuchen, das Debuggen Schritt für Schritt durchzuführen.</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpinBox</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Button button;
    <span class="hljs-keyword">public</span> Animation ani;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpinAndDisableButton</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Started async <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
        ani.Play();<font></font>
        button.interactable = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">while</span> (ani.isPlaying == <span class="hljs-literal">true</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> Task.Yield();<font></font>
        }<font></font>
        button.interactable = <span class="hljs-literal">true</span>;<font></font>
        Debug.Log(<span class="hljs-string">$"Finished async <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Update <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LateUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Late Update <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Aktualisierungsvorgang ist wie folgt:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ku/rp/b7/kurpb70kzx35oellcgqqwor5eow.png"><br>
<br>
<img src="https://habrastorage.org/webt/1c/k8/ef/1ck8ef1r0hmycnkfcubqfa4kwec.png"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dem Frame, in dem wir die Animation starten, geht voraus, </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weil der Mausklick von </font></font><code>EventSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und zu </font></font><code>GraphicRaycaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UGUI Unity kommt, das, wie sich herausstellte, die Ausführungsreihenfolge in </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einem Ihrer obigen Skripte hat.</font></font></li>
<li><code>while</code>   <b> </b>      ,   <b></b> <code>Update</code>,   <code>LateUpdate</code>.     ,     !</li>
<li>      ,    ,      ,   <code>Awaiting</code>,    UGUI   ,   ,  <code>await</code> ,        -   </li>
<li>         <code>Update</code>  -   . <code>await</code>     .</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt zu entmystifizieren das "ausstehende Objekt", das ich nicht vollständig gelöst habe, aber zumindest sehe ich, wie es funktioniert, weil es absichtlich codiert wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im ersten Frame, in dem ich auf die Schaltfläche geklickt habe, ist nichts Seltsames. </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(das gleiche magische </font></font><code>MonoBehaviour Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><code>EventSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verwendet die </font></font><code>Input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API und sieht meinen Klick. Danach scannt es meine Schaltfläche auf der Leinwand und sieht, dass es etwas tun kann. Dann wird es aufgerufen </font></font><code>public async void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und erreicht diese Linie. (Sie können diese auch </font></font><code>ExecuteEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manuell verwenden! Dies ist eine Hilfsklasse </font></font><code>static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/6q/yb/ut6qybougoh8yuhav3o2gpn8hly.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im nächsten Frame, in dem die Magie auftritt, kann der Aufrufstapel uns alle paar Frames genau anzeigen, wer die Prüfung für uns abwickelt. Ich verstehe nicht ganz, was hier passiert. (obwohl das funktioniert) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fr/gw/uj/frgwujptlworykklroix5o0m4sk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich nachgesehen habe</font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus dem Motorcode scheint viel aufgerufen zu werden, also kann ich nur raten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/qh/vm/reqhvmmgmoxuzm6i-e-9ts49txm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber es gibt dort etwas </font></font><code>WorkRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, das jedes Ihrer erwarteten unvollendeten Geschäfte repräsentiert. </font><font style="vertical-align: inherit;">Ich gehe davon aus, dass die Rücksendung </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ordnungsgemäß „spielerisch“ registriert ist, was mit dem Personalparadigma kompatibel ist und sicherstellt, dass der gesamte sichere Code im Hauptthread gesperrt ist, sodass Sie nach jedem Vorgang vollständig etwas tun können </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, da dies zum richtigen Zeitpunkt im Frame erfolgt .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task.Yield ()</font></font></h4><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Methode hat eine sehr verwirrende Beschreibung: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task.yield?view=netframework-4.8</font></font></a></i><br>
<blockquote><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">YieldAwaitable</a><br>
<br>
 ,  ,          .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SynchronizationContext</a>   NULL,     .     ,     ,    .<br>
<br>
<b></b><br>
<br>
   <code>await Task.Yield()</code>;   ,     .      ( SynchronizationContext),         .   ,  ,         ,    .  ,    UI     UI,    ,    ,     .     ,  <code>await Task.Yield()</code>;   UI .      « ,    ContinueWith»   «   .NET».</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Englisch ist nicht meine Muttersprache, und ich denke, dass weder C # </font></font><code>yield return</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noch </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Funktion widerspiegeln, die sie ausführen. Kommen wir jedoch zur Definition der Methode. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6k/-f/oi/6k-foipgostpw8fxs9c9znoz7jo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der beabsichtigte Anwendungsfall in der Notiz scheint darauf hinzudeuten, dass die Methode nicht wirklich ist </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aber Sie möchten sie in verwandeln </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, also müssen Sie </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">irgendwo </font><font style="vertical-align: inherit;">darin </font><font style="vertical-align: inherit;">(erwarten), daher </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist sie ein idealer Sündenbock. Anstatt die Methode sofort zu beenden (denken Sie daran, dass Async die Methode nicht auf magische Weise in Asynchron umwandelt, sondern vom Inhalt der Methode abhängt), </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erzwingen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie </font><font style="vertical-align: inherit;">jetzt, dass </font><font style="vertical-align: inherit;">sie asynchron ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall ist der Empfänger des Kontexts jedoch kein gewöhnlicher Kontext, sondern </font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Jetzt</font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hat eine nützlichere Funktion, die im nächsten Frame effektiv weiterarbeitet. </font><font style="vertical-align: inherit;">Wenn es normal wäre </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, könnte es in unserem Beispiel eine Endlosschleife erzeugen, da es immer wieder geradeaus weitergeht </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt zurück, mit </font></font><code>YieldAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dem der Anrufer fortfahren kann. </font><font style="vertical-align: inherit;">Wie aus unserem Protokoll hervorgeht, wurde zu Beginn jedes Frames „Erwartet“ aufgezeichnet, da der Kontext (der Code daneben </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) in diesem Aviator gespeichert wurde. </font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macht etwas Magie, wartet auf den Rahmen und benutzt diesen Aveyter, um fortzufahren, dann erreicht er </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen neuen und gibt ihn zurück </font></font><code>YieldAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies wird wahrscheinlich weiterhin neuen </font></font><code>WorkRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code früher in jedem Frame als wartende Aufgabe </font><font style="vertical-align: inherit;">hinzufügen, </font><font style="vertical-align: inherit;">bis </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">er wird</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UniTask</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt ein beliebtes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UniTask-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Paket </font><font style="vertical-align: inherit;">, </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das eine neue Art von leichteren Aufgaben </font></font><code>UniTask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die direkt an die </font></font><code>PlayerLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">gebunden</font></a><font style="vertical-align: inherit;"> sind </font><font style="vertical-align: inherit;">, vollständig eliminiert </font><font style="vertical-align: inherit;">und einführt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dann können Sie den Zeitpunkt auswählen, zu dem die Prüfung im nächsten Frame erfolgen soll. </font><font style="vertical-align: inherit;">(Initialisierung? Spätes Update?) Aber tatsächlich wissen Sie, was </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ohne Plugin funktioniert. </font><font style="vertical-align: inherit;">Dies ist bei Adressablen nach </font></font><code>AsyncOperationHandle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Möglichkeit </font><font style="vertical-align: inherit;">hilfreich </font><font style="vertical-align: inherit;">. </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit denen Sie verwenden können </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sehen</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/7eKi6NKri6I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist ein gutes Gespräch, das zeigt, dass es </font></font><code>Await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bereits gut funktioniert, aber es gibt Vorteile für die vernünftigerweise verwendete Coroutine. </font><font style="vertical-align: inherit;">Sie können dieser Folie mehr Aufmerksamkeit schenken, um sie ein wenig zu sortieren, wenn Sie immer noch verwirrt sind.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8c/md/kw/8cmdkwfptrr0hr-y6twos_oto7u.png"><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erstellen in anderthalb Stunden einen Netzwerk-Shooter im Weltraum.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de506940/index.html">Der Weg zum Ideal: eine kurze Anleitung für Programmierer und ihre Führungskräfte</a></li>
<li><a href="../de506950/index.html">Was ist Schule 21 und warum ist sie so gestaltet?</a></li>
<li><a href="../de506952/index.html">API-Portal: Worauf Sie beim Entwerfen achten müssen. Wrike Erfahrung</a></li>
<li><a href="../de506954/index.html">Ein weiterer Artikel über Rails und ELK</a></li>
<li><a href="../de506956/index.html">Quantentechnologie und Gesundheit</a></li>
<li><a href="../de506964/index.html">Android-Entwicklung: Karrierebericht für Mai 2020</a></li>
<li><a href="../de506976/index.html">Übersicht über die 3D-Scanner Solutionix D500 und D700</a></li>
<li><a href="../de506980/index.html">HackTheBox-Endspiel. Exemplarische Vorgehensweise Xen Lab. Pentest Active Directory</a></li>
<li><a href="../en486014/index.html">SLAC Tour: US Department of Energy National Accelerator Laboratory at Stanford</a></li>
<li><a href="../en486018/index.html">Session Survey Results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>