<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💱 🚐 🛡️ Connexion du capteur de mouvement et de l'alarme et de l'enregistrement vidéo dans Home Assistant sur Raspberry Pi ✋ 👳🏿 🍮</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux parler de ma petite expérience de travail avec Home Assistant (ci-après dénommé HA) sur le Raspberry pi et de la connexion de la fonction d'en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Connexion du capteur de mouvement et de l'alarme et de l'enregistrement vidéo dans Home Assistant sur Raspberry Pi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486654/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux parler de ma petite expérience de travail avec Home Assistant (ci-après dénommé HA) sur le Raspberry pi et de la connexion de la fonction d'enregistrement vidéo, du capteur de mouvement et, en conséquence, de la fonction de sécurité à domicile pour recevoir des images par courrier en cas d'opération de «sécurité». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, l'une des raisons est le désir de comprendre à partir de vos commentaires que ce que j'ai fait «a mal fait» après tout, en mettant en œuvre ce scénario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe trois façons de configurer les fonctionnalités ci-dessus: «sans problème», «court» et «indépendant». Dans le premier cas, vous, après avoir téléchargé l'image finie depuis le site </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://ViaMyBox.com/downloadpage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour votre Raspberry pi, vous pouvez voir à quoi tout ressemble sous la forme déjà configurée. Dans le second cas, vous pouvez télécharger le zip à partir du site Web ou du projet github, installer et installer l'image HA docker via l'utilitaire (sudo via-setup.sh) pour voir comment tout est configuré. Et enfin, la troisième façon est de mettre en place «tout à votre façon»: prendre quelque chose d'utile sur le site ou githab du projet, ou dans ce tutoriel. Liens vers tout à la fin de l'article.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que vous disposiez déjà d'un Home Assistant (HA) fonctionnel. Dans cet article, nous ne considérerons que les aspects de la formation des configurations yaml et une description de la séquence de règles et conditions qui conduisent à une action spécifique, dans notre cas, la connexion de la «sécurité de la maison» et un script qui commence à prendre des photos dans les 5 secondes après le déclenchement du capteur de mouvement. Et en conséquence, Home Assistant envoie les photos prises par courrier. Je ne suis pas un spécialiste du yaml ou de la création de configurations pour Home Assistant, mais, en suivant les exemples de travail, j'ai obtenu une configuration de travail que je souhaite partager.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les fichiers auxquels nous ferons référence, je les disposerai à la fin de l'article pour une revue plus pratique. Je ne traiterai pas ici du travail des scripts d'enregistrement de vidéo en bash ou en python dans cet exemple. Seul Home Assistant. Mais si vous avez des questions - Bienvenue! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au final, tout ressemble à ça pour moi (surligné en rouge que nous allons considérer dans l'article): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3u/ol/s8/3uols87hy7mnocdgbj-k-mfbp-a.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/v9/ib/8s/v9ib8sthumy5p5hphabioyvr1ie.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'utilise Raspberry pi comme plateforme. Et mon chemin vers les fichiers de configuration est / usr / share / hassio / homeassistant /. Le chemin d'accès à vos fichiers de configuration peut être différent de mon chemin d'accès. À cette époque, j'avais Home Assistant 0.101.3. Nous serons intéressés par les fichiers de configuration de ce répertoire: configuration.yaml et automation.yaml.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après chaque modification de ces fichiers, il est important de se rappeler qu'il sera nécessaire de vérifier la configuration après nos modifications pour détecter toute erreur qui s'y serait produite. Cela se fait dans l'onglet Tableau de bord Home Assistant -&gt; Configuration -&gt; Contrôles du serveur -&gt; Vérifier la configuration. Et puis, au même endroit, nous effectuons le rechargement des automatisations et le rechargement des scripts, si la vérification a réussi. Et, en cas de doute, - Le redémarrage de la gestion du serveur dans le même onglet met à jour avec précision la configuration.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le capteur de mouvement HC-SR501 est connecté au bus GPIO Raspberry pi. Il est nécessaire de connecter correctement les trois fils de contact au GPIO, et nous pouvons utiliser notre capteur en action. Le capteur a trois contacts: puissance gcc (+), zéro gnd (-), contact de commande (données). Après avoir lu la description du GPIO, je les ai connectés à ma framboise comme suit. J'ai connecté hc-sr501 au connecteur GPIO: broche # 2 - 5.5vvcc; broche n ° 26 (13e rangée) - contact de données et broche n ° 6 - gnd (-) du capteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'utilise un appareil photo USB ou un appareil photo csi conjointement avec mjpg-streamer comme source de la photo. Comment installer et configurer mjpg-streamer sur Raspberry pi, nous ne considérerons pas ici. Exemples d'installation rapide sur Internet beaucoup. Cependant, je tiens à dire que j'utilise les données de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce projet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'installation de ce module y est également décrite en détail. </font><font style="vertical-align: inherit;">Ou utilisez une méthode qui vous convient pour prendre des photos et des vidéos. </font><font style="vertical-align: inherit;">Après tout, c'est vous qui décidez du script bash à attacher à HA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant décrire notre capteur dans configuration.yaml, disons, via la ligne de commande:</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo nano /usr/share/hassio/homeassistant/configuration.yaml</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bien que l'utilisation de notepad ++ avec winscp puisse être plus pratique ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous décrivons la séquence de paramètres pour le HC-SR501 comme ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">binary_sensor:<font></font>
  - platform: rpi_gpio<font></font>
    #name: HC-SR501<font></font>
    ports:<font></font>
      7: Sensor HC-SR501<font></font>
    invert_logic: false<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter qu'ici, l'important est les paramètres dans les lignes qui décrivent la connexion aux contacts de contrôle (données) des capteurs: broches # 7 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ports: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7: Capteur HC-SR501 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le Home Assistant dispose d'un outil intégré pour activer la fonction de sécurité domestique. </font><font style="vertical-align: inherit;">Nous le décrirons dans notre configuration.yaml, en utilisant la description: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.home-assistant.io/integrations/manual</font></font></a><br>
<br>
<pre><code class="plaintext hljs">alarm_control_panel:<font></font>
  - platform: manual<font></font>
    name: Home Alarm<font></font>
    pending_time: 60<font></font>
     delay time 40<font></font>
     triggered:<font></font>
    pending_time: 0<font></font>
    code: 1234<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce paramètre signifie que nous avons 60 secondes pour quitter la maison (après cette heure, l'alarme se déclenchera) et 40 secondes pour la désactiver (avec le mot de passe 1234) à notre retour à la maison. Pour une raison quelconque, vous partez toujours plus longtemps que vous venez.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant décrire le mécanisme d'activation et de désactivation des photos par le fonctionnement du capteur de mouvement dans notre configuration.yaml (plus d'informations sur le commutateur - la plate-forme command_line peut être trouvée </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="plaintext hljs"> - platform: command_line<font></font>
   switches:<font></font>
      start_stop_motion_rec_timelapse:<font></font>
        friendly_name: 'Record motion timelapse video'<font></font>
        command_on: 'curl http://localhost/start_mjpgstrm.php  &amp;&amp; curl http://localhost//rec-motion-mjpg.php'<font></font>
        command_off: 'curl http://localhost/stop_mjpgstrm.php &amp;&amp; curl http://localhost/rec-motion-mjpg-stop.php'<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous avons lié les commandes enable enable command_on et command_off off à nos scripts qui contrôlent l'enregistrement de la caméra. Dans ce cas, lorsque la commande_on est exécutée, 2 scripts sont exécutés séquentiellement. Cela lance mjpg-streamer et déclenche l'enregistrement du capteur de mouvement. L'accès aux scripts bash passe par le fichier php du site de travail sur Raspberry pi. Pour ce faire, j'ai configuré l'accès nginx et web, et lors de l'accès via le navigateur sous la forme http: // &lt;adresse ip de votre Raspberry pi&gt; /start_mjpgstrm.php, notre script php doit être exécuté. Ce script exécute mjpg-streamer dans cette situation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ne considérons pas la configuration de l'accès Web dans cet article. Ce n'est certainement pas de la sécurité, mais étant donné que j'ai HA sur docker, j'ai été confronté au fait que j'ai un environnement de docker isolé et le «monde extérieur» du système d'exploitation que je peux voir en contactant mon site via php. Il existe probablement un tas de bonnes solutions de la part des gourous docker ou HA. Ecrivez, il serait intéressant de savoir! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais laisser une liste de ces scripts sous l'article, nous ne nous attarderons pas sur eux. Dans cet article, je souhaite retracer uniquement la formation de la séquence d'actions dans l'assistant d'accueil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela est placé dans l'objet start_stop_motion_rec_timelapse Ce sera notre interrupteur visuel, avec lequel nous contrôlerons l'enregistrement des photos lorsque le capteur de mouvement sera déclenché.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/jb/kz/j4jbkzlnslehtgai7ak93blgqnm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons visualiser ces objets créés par nos soins dans l'onglet Home Assistant -&gt; Overwiew, en basculant l'activation du mode de configuration Configure UI dans le coin supérieur droit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s5/r8/31/s5r831pi5yqbp6zpph6gy_yen2g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redémarrez HA dans le navigateur dans l'onglet «Configuration -&gt; Server Control» pour récupérer notre configuration.yaml. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, sélectionnez le jaune plus au bas de la fenêtre du navigateur, cliquez sur la carte Entités et attachez nos objets créés aux cartes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t5/6c/i_/t56ci_fwyo5z_vojj6iywesnwno.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour notre capteur, sélectionnez la carte du capteur. Cela ressemblera à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hi/h-/9d/hih-9d8acqpf9lxmub8pqpxbm2y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir sur l'image, dans le deuxième champ de l'entité, le commutateur ci-dessus est: switch.start_stop_motion_rec_timelapse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il nous permet d'activer et de désactiver notre enregistrement sur le capteur de mouvement, indépendamment de l'inclusion de la fonction «sécurité à domicile». Et, en général, cela devrait déjà fonctionner après toutes les actions ci-dessus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, et en conséquence, la carte du panneau d'alarme: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m-/om/ob/m-omobeh7bj-auliurl9abujbhw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un autre point intéressant. J'utilise Home Assistant comme conteneur Docker. À cet égard, le chemin d'accès à notre script sera différent du chemin d'accès réel au fichier de script. Après tout, la structure de fichiers à l'intérieur du conteneur est virtualisée et connectée à la structure de fichiers réelle via des volumes de docker montés. Il ressemble à ceci: Chemin à l'intérieur du conteneur: / config / scripts / Chemin à l'intérieur du système d'exploitation: / usr / share / hassio / homeassiatnt / scripts. Regardez donc les paramètres de votre conteneur, comment ces volumes sont configurés dans le champ Binds. Si vous en avez.</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo docker inspect homeassistant|less
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le détecteur de mouvement est déclenché, au moment où l'alarme est activée: je veux, en plus du fait que nous commençons la photographie rapide (instantanés instantanés), je recevrais un avertissement par mail et un instantané. J'ai parallélisé les processus. Sur la première photo, la journalisation (instantanés instantanés) se produit quelques secondes après le déclenchement du capteur. Pour ce faire, j'exécute mjpg-streamer curl </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localhost / start_mjpgstrm.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lancez php: surl </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: //localhost/rec-motion-mjpg.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . À son tour, il exécute le script python mov.py. Tous les fichiers et liens décrits se trouvent à la fin de l'article par référence. Et un autre script takeSnapshotWebcam.sh prend un instantané, que j'envoie dans un e-mail. Je décris ces scripts dans notre configuration.yaml comme ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">shell_command:<font></font>
#      <font></font>
  take_snapshot_webcam: '/config/scripts/takeSnapshotWebcam.sh'<font></font>
#  mjpg-streamer <font></font>
  start_mgpg_streamer: 'curl http://localhost/start_mjpgstrm.php'<font></font>
# mjpg-streamer<font></font>
  stop_mgpg_streamer: 'curl http://localhost/stop_mjpgstrm.php'<font></font>
#      5 <font></font>
  start_motion_rec: 'curl http://localhost/rec-motion-mjpg.php'<font></font>
# <font></font>
  stop_motion_rec: 'curl http://localhost/rec-motion-mjpg-stop.php'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Là, dans configuration.yaml, nous décrivons notre objet de mailing:</font></font><br>
<br>
<pre><code class="plaintext hljs">notify:<font></font>
  - name: ha_sendmail<font></font>
    platform: smtp<font></font>
#    gmail<font></font>
    server: smtp.gmail.com<font></font>
    port: 587<font></font>
    timeout: 15<font></font>
#  <font></font>
    sender: user@gmail.com<font></font>
    encryption: starttls<font></font>
    username: user@gmail.com<font></font>
    password: passwd<font></font>
#  (       ,    )<font></font>
    recipient:<font></font>
      - user@gmail.com<font></font>
    sender_name: My Home Assistant<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un point important! </font><font style="vertical-align: inherit;">Pour que notre HA se connecte et envoie des lettres (champ expéditeur), nous devons autoriser gmail à utiliser cette case pour notre service HA. </font><font style="vertical-align: inherit;">Comment faire est le lien ici: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myaccount.google.com/lesssecureapps</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Et puis, nous décrivons le mécanisme d'automatisation lui-même lorsque l'alarme home_alarm est activée dans automation.yaml:</font></font><br>
<br>
<pre><code class="plaintext hljs">#   (alias) “  ,   ”<font></font>
- alias: 'Trigger alarm while armed away'<font></font>
#alias ,     “on”<font></font>
  trigger: <font></font>
    - platform: state<font></font>
      entity_id: binary_sensor.sensor_hc_sr501<font></font>
      to: 'on'<font></font>
# ,         “armed away”<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
      state: armed_away<font></font>
#     <font></font>
  action:<font></font>
# mjpg-streamer ( )<font></font>
    - service: shell_command.start_mgpg_streamer<font></font>
# ,   <font></font>
    - service: shell_command.start_motion_rec<font></font>
#    “  ”   HA   “ ”<font></font>
    - service: alarm_control_panel.alarm_trigger<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le groupe de conditions et d'actions suivant consiste à envoyer un message de console lors de la désactivation de la «sécurité» et à désactiver nos scripts d'enregistrement de mouvement:</font></font><br>
<br>
<pre><code class="plaintext hljs">- alias: 'Send notification when alarm is Disarmed'<font></font>
  trigger:<font></font>
    - platform: state<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
      to: 'disarmed'<font></font>
  action:<font></font>
    - service: shell_command.stop_mgpg_streamer<font></font>
    - service: shell_command.stop_motion_rec<font></font>
    - service: persistent_notification.create<font></font>
      data:<font></font>
       message: The alarm is Disarmed at {{ states('sensor.date_time') }}"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et enfin, le troisième groupe - nous envoyons une lettre avec une photo:</font></font><br>
<br>
<pre><code class="plaintext hljs">- alias: 'Send notification when alarm triggered'<font></font>
  trigger: <font></font>
   - platform: state<font></font>
     entity_id: alarm_control_panel.home_alarm<font></font>
     to: 'triggered'<font></font>
  action:<font></font>
    - service: persistent_notification.create<font></font>
      data:<font></font>
       message: Notification when alarm triggered. Motion sensor HC-SR501 detected.<font></font>
    - delay:<font></font>
       seconds: 4<font></font>
#     <font></font>
    - service: script.webcam_snapshot<font></font>
#      configuration.yaml: notify.ha_sendmail<font></font>
    - service: notify.ha_sendmail<font></font>
      data:<font></font>
        title: 'Intruder alert'<font></font>
        message: '{{now().strftime("%H:%M %Y-%m-%d")}}:Notification when alarm triggered. Motion sensor HC-SR501 detected.'<font></font>
        data:<font></font>
           images:<font></font>
#      script.webcam_snapshot  <font></font>
              - /config/camera/snapshot.jpg<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas que la disposition des lignes est importante dans les fichiers yaml et que les caractères d'espace avant les commandes jouent un rôle important dans la formation des blocs de code, leur structure. </font><font style="vertical-align: inherit;">Vérifiez toutes les modifications apportées à votre yaml via la configuration Home Assistant (HA) -&gt; Contrôles du serveur -&gt; Vérifier la configuration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout semble être, et votre Raspberry pi devient élégant ... si la foudre n'est pas restée!) La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
voici - une automatisation HA fonctionnelle, sur mesure! </font><font style="vertical-align: inherit;">N'oubliez pas de m'écrire ce que vous en pensez! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et, si vous lisez toujours jusqu'au bout, je vous propose les liens promis: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://viamybox.com/downloadpage </font></font><br>
</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/viatc/viamybox Les</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
fichiers de configuration décrits ici: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automation.yaml, configuration.yaml, takeSnapshotWebcam. sh, rec-motion-mjpg.php, mov.py</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr486654/">https://habr.com/ru/post/fr486654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486644/index.html">Antenne DIY en 5 minutes</a></li>
<li><a href="../fr486646/index.html">Éloignez-vous de jQuery à Svelte, pas de douleur</a></li>
<li><a href="../fr486648/index.html">AWS Lambda en action dans Java 11. Passer à la production sans serveur</a></li>
<li><a href="../fr486650/index.html">Mémoire dynamique dans les systèmes durs en temps réel</a></li>
<li><a href="../fr486652/index.html">«Critique de la raison pure» pour les programmeurs</a></li>
<li><a href="../fr486656/index.html">Comment ajouter de nouveaux personnages à Unicode: l'expérience du profane</a></li>
<li><a href="../fr486658/index.html">Plugin de stratégie Moxy</a></li>
<li><a href="../fr486660/index.html">Idées de table: combinaison spatiale Metro</a></li>
<li><a href="../fr486664/index.html">Hack The Box. Passage RE. Metasploit, chargement de document de bureau, attaque Zip Slip, un peu sur PowerSploit et les jetons</a></li>
<li><a href="../fr486666/index.html">Motoneiges, bière et dérivés météorologiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>