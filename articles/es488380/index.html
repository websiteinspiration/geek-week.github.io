<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèß üö® üßëüèø‚Äçü§ù‚Äçüßëüèª El comienzo m√°s f√°cil en STM a trav√©s de "un lugar" ‚ö±Ô∏è üôèüèæ üëºüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probablemente, el tiempo de las guerras religiosas de AVR contra STM ya ha pasado, pero no, no, s√≠, hay brotes de enfrentamientos entre los dos campos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>El comienzo m√°s f√°cil en STM a trav√©s de "un lugar"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488380/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probablemente, el tiempo de las guerras religiosas de AVR contra STM ya ha pasado, pero no, no, s√≠, hay brotes de enfrentamientos entre los dos campos. Casi cualquier publicaci√≥n sobre manualidades AVR definitivamente tendr√° un comentario como "S√≠, cu√°nto puede follar a su abuela, ya es hora de cambiar a STM", luego las variaciones en el tema del precio, el n√∫mero de piernas y los temporizadores. Si el STMshcher es m√°s avanzado, ciertamente habr√° una indicaci√≥n de que no hay DMA en el AVR y no lo har√°, por lo tanto, el AVR deber√≠a morir. Por qu√© un simple term√≥metro-volt√≠metro-parpadeo DMA, una monta√±a de temporizadores de 16 bits, 100 patas y un ADC de 12 bits, generalmente nadie lo explica. ¬øPor qu√© necesitamos una cosechadora en un dispositivo que Tiny13 pueda sacar f√°cilmente, que al mismo tiempo no se carga ni en un tercio de sus recursos? Nadie lo entender√°. Solo tiene que cambiar a STM32, y eso es todo. Por aqu√≠.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y debo decir que la gente tiene ansias de novedad. Pero realmente, ¬øpuedo intentarlo? ¬øY si te gusta? Estos son solo el Manual de referencia para el popular STM32F103C8T6, en el que se basa la tableta azul de 1126 p√°ginas m√°s masiva, de alguna manera realmente no tiene un "inicio r√°pido". Incluso una utilidad separada, tan odiada por los ancianos "kalokub", y eso debe ser estudiado, qu√© es qu√©. S√≠, y habiendo profundizado en Cube, es poco probable que comience en 5 minutos, el pie generado por √©l no es el material de lectura m√°s accesible para la noche, es solo para meterse en la frente, de lo que no todos pueden hablar all√≠.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Numerosos art√≠culos, similares a este, sobre un inicio r√°pido y f√°cil en STM merecen una discusi√≥n por separado. Para todos esos art√≠culos, al principio estaba muy confundido por una circunstancia. En ninguna parte hay una explicaci√≥n detallada de lo que en realidad estamos escribiendo aqu√≠. Un mont√≥n de capturas de pantalla de c√≥mo crear un proyecto, luego inmediatamente un muro de c√≥digo, ¬°hazlo as√≠! Y qu√© hay all√≠, por qu√© es as√≠, por qu√© es as√≠, de d√≥nde obtener todas estas palabras aparentemente entendibles, nadie profundiza en ello, porque las fuerzas se quedaron sin escribir al escribir un manual sobre la instalaci√≥n de Cale y Cuba, y al lanzar el proyecto. Solo despu√©s de un tiempo, individual para cada uno, la comprensi√≥n de lo que est√° sucediendo y por qu√© viene. A su vez, propongo una forma de comenzar no desde el principio, como todos los dem√°s, sino desde el final. Ahora haremos lo contrario, no configuremos el controlador, escribamos c√≥digo y debutamos, sino que procedemos inmediatamente a la depuraci√≥n,y registrar nuestras acciones en forma de c√≥digo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, instalamos Keil como un entorno libre (c√≥digo de hasta 32 KB). No describiremos esta acci√≥n, esto est√° en Internet, y el instalador debe ser dominado por la persona que acude a STM. Comenzamos el proyecto: Proyecto-Nuevo Proyecto uVision, creamos una carpeta y un archivo de proyecto. Se abre la ventana de selecci√≥n del controlador, ingrese 103C8 en la b√∫squeda y acepte el √∫nico modelo seleccionado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, llegamos a la ventana de selecci√≥n de biblioteca:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/ox/yf/4voxyfdppukch2gamrnsguvzbfk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ ponemos tres daws: CMSIS-CORE, Device-Startup y Device-GPIO. Este conjunto es suficiente para rebotar una pierna, iluminando el LED. Entonces todav√≠a tiene que configurar, no puede obtener nada de esto. Alt + F7 inicia la ventana de configuraci√≥n ubicada en Proyecto-Opciones para Target, donde en la pesta√±a "Salida" debe marcar la casilla de verificaci√≥n "Crear archivo HEX" para crear un archivo de firmware que cargaremos al controlador. A continuaci√≥n, en la pesta√±a "Depurar", seleccionamos ST-Link, que, de hecho, cargar√° el firmware y debutar√°: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/uw/6l/kduw6ltbrav_uadgbbrp93w5oke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mediante el bot√≥n "Configuraci√≥n" al lado de la ventana de selecci√≥n del programador, llegaremos a la ventana "Configuraci√≥n del controlador de destino Cortex-M", donde en la ventana " Descarga Flash "poner un daw" Restablecer y ejecutar ".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el √°rbol del proyecto, haga clic derecho en la carpeta "Grupo de origen 1", en el asistente que se abre, cree el archivo main.c, en el que pronto escribiremos el c√≥digo. En el main.c abierto, haga clic con el bot√≥n derecho en la primera y m√°s importante inclusi√≥n: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qc/zp/ju/qczpjupur2s0vqx-reffsuzy5qo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
agregue el c√≥digo que consta de main y sin fin mientras:</font></font><br>
<br>
<pre><code class="plaintext hljs">#include "stm32f10x.h"                  // Device header<font></font>
int main(){<font></font>
	while(1){<font></font>
	}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, esto es todo por ahora, este es un programa listo y comprensible que compila y carga correctamente en el controlador. Presionamos F7 y vemos que el firmware se ha ensamblado correctamente, no hay errores ni advertencias. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4b/bs/d3/4bbsd3ca51m6nmrx4gon6a_rwyw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir de este momento, el controlador est√° completamente accesible para nosotros, podemos ingresarlo debajo de la l√≠nea de depuraci√≥n y girarlo en todas las direcciones, y responder√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las teclas Ctrl + F5 nos llevan a la depuraci√≥n, y el bot√≥n "System Viewer Windows" le permite abrir las ventanas para controlar los registros y las patas del GPIO. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1e/ri/u1/1eriu1hhnribtydyhsaq-i36lr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, le sugiero que siga utilizando el Manual de referencia, especialmente porque ni siquiera necesita descargarlo, est√° disponible haciendo clic en la pesta√±a "Libros" del men√∫ "Ver":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fx/4j/hm/fx4jhmgymzqzczhfcqto1wusr2m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora propongo usar el siguiente razonamiento. Desde el pinout en la tableta azul, se puede ver que el LED se cuelga en la pata del puerto 13. Numerosos recursos de Internet y discusiones siempre mencionan que antes de hacer algo en STM, debe habilitar algo, de lo contrario, configure el reloj. Sin m√°s pre√°mbulos, escribimos en el cuadro de b√∫squeda del lector de pdf lo que necesitamos, a saber, habilitar el puerto C: "ACTIVAR EL RELOJ DEL PUERTO C". Entramos en la siguiente imagen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/lh/vs/qflhvsoyc3fhyds54-clxwq0eqo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De esto podemos concluir que el reloj del puerto C est√° habilitado en el registro IOPCEN. Con este conocimiento, vamos a la pesta√±a RCC en modo de depuraci√≥n e ingresamos este nombre en la barra de b√∫squeda: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z0/x4/3q/z0x43qbnbga_-q0voxoajotxuqs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
marque la casilla de verificaci√≥n requerida con una marca de verificaci√≥n, y desde este momento consideramos que el puerto C est√° habilitado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, recordando el AVR sufrido, buscaremos la configuraci√≥n del pin real. Para que funcione, es necesario explicar qu√© es exactamente lo que queremos de √©l. Y queremos saltar con el pie n√∫mero 13 del puerto C, para esto necesitamos establecer el modo de su operaci√≥n. En la barra de b√∫squeda en el Manual de referencia, conducimos en "Configuraci√≥n de bit de puerto", que expresa nuestro deseo de leer d√≥nde est√°n ocultos los ajustes de la pierna. La b√∫squeda nos lleva a una tabla a partir de la cual se deduce que para asignar un tramo como salida, es necesario configurar los registros MODE y CNF: de la </font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/c4/ot/odc4oti0osjwy9qvuax79slsqv4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tabla No. 20 est√° claro que para asignar un tramo como salida Push-Pull, es necesario restablecer los registros CNF0 y CNF1, y el estado del par MODE0 y MODE1 se describen en la tabla No. 21, elegir√© la opci√≥n superior, hasta 10MHz, MODE0 = 1, MODE1 = 0. Esto es lo que har√© en la ventana GPIOC para los registros CNF13 y MODE13</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-n/x5/y3/-nx5y33grvntsdchwf7emhxlgnc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora hemos configurado el reloj y el modo de operaci√≥n del puerto. Es hora de descubrir exactamente c√≥mo saltar una pierna. En ingl√©s, establezca que el bit de puerto se escribe como "Conjunto de bit de puerto", y buscaremos esta frase en el manual: La </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/l8/r2/nwl8r2ne5djl9o3hmpwxg2eigg0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
b√∫squeda nos lleva a una p√°gina con una tabla, que muestra claramente que el registro BSRR, que consiste en pares BS y BR, es responsable de establecer el estado del tramo del puerto , Bit set y Bit reset, respectivamente. Encontramos estos registros en la ventana GPIOC en modo de depuraci√≥n y disfrutamos del control del tramo n√∫mero 13 directamente metiendo grajillas con el mouse en las casillas correspondientes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ob/vj/c3/obvjc3gnvzem1sh6tecfly7quyk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un LED en el tablero de pastillas azul cuelga entre la pata y el VCC, por lo tanto, lo controla de nuevo al nombre del registro. El Bit Set (registro BS13) lo extingue y el Bit Reset (registro BR13) lo enciende. Estos son registros de operaciones at√≥micas, se restablecen despu√©s de configurar la casilla de verificaci√≥n. Es posible controlar el pie a trav√©s del registro ODR (cl√°usula 9.2.4 Registro de datos de salida del puerto (GPIOx_ODR) en el manual de referencia), muestra claramente a qu√© conduce la instalaci√≥n y el restablecimiento de la grajilla. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nv/rd/ou/nvrdouc1ano_fn8gdpdplk2v5rq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un LED verde verde y atenuado indica que todo funciona correctamente. Solo queda escribir todo esto en forma de c√≥digo en main.c. Aqu√≠ es donde aparecen las pasas que distinguen este m√©todo de comprender el controlador STM a trav√©s de la depuraci√≥n del resto, que est√° lleno de Internet. Sugiero simplemente reescribir lo que vemos en la ventana de depuraci√≥n en el c√≥digo. Ejemplo:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kq/f9/ww/kqf9wwqdt2ydqoz9ovv1f9k2xt0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Establezca el modo de operaci√≥n del puerto y habilite la sincronizaci√≥n; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/a-/fk/iua-fkaw0im1tjbpxqm4kwpruio.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encendieron la pata de babor, esperaron, la apagaron, y as√≠ sucesivamente:</font></font><br>
<br>
<pre><code class="plaintext hljs">#include "stm32f10x.h"                  // Device header<font></font>
<font></font>
int main(){<font></font>
	RCC-&gt;APB2ENR=0x00000010;			//  <font></font>
	GPIOC-&gt;CRH=0x44144444;			//   Push-Pull  10MHz<font></font>
	int i;								//     / <font></font>
	while(1){<font></font>
		GPIOC-&gt;ODR=0x00002000;		//  LED,      <font></font>
		i=2000000;					//    <font></font>
		while (i) i--;					// <font></font>
		GPIOC-&gt;ODR=0x00000000;		//  LED<font></font>
		i=2000000;					//  <font></font>
		while (i) i--;					<font></font>
	}<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, este m√©todo est√° lejos de ser el mejor y no es correcto, pero en mi opini√≥n es el m√°s comprensible y simple. Adem√°s, comienza a trabajar con una hoja de datos (manual de referencia) y no lo asusta, como leer man√° y escribir pa√±os de c√≥digo de varias p√°ginas para Blink. S√≠, no hay capas de abstracciones, se ha perdido mucho, pero creo que puedes perdonar esto para el comienzo de la primaria. Leer man√° y trabajar correctamente con los registros es entonces, ahora tenemos un LED parpadeante y b√°sicamente entendemos c√≥mo y qu√© hicimos, y lo m√°s importante, de d√≥nde provienen todas estas abreviaturas. Si me hubieran mostrado esta forma de estudiar STM antes, tal vez no habr√≠a reunido m√°s de 9000 programadores diferentes para AVR en los que no hab√≠a depuraci√≥n, pero habr√≠a tomado el Cortex de inmediato. De hecho, en AVR no hay una depuraci√≥n inteligible y accesible, pero de todos modos, es demasiado pronto para olvidar a Tiny13. Ella saca sus tareas.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488368/index.html">Lo que aprend√≠ mientras trabajaba en mi primer proyecto a gran escala</a></li>
<li><a href="../es488370/index.html">TDD para microcontroladores. Parte 2: c√≥mo los esp√≠as eliminan las adicciones</a></li>
<li><a href="../es488374/index.html">Telegram + 1C + Webhooks + Apache + Certificado autofirmado</a></li>
<li><a href="../es488376/index.html">Cuando el principio "al diablo con todo, t√≥malo y hazlo!" no funciona: notas de procrastinator</a></li>
<li><a href="../es488378/index.html">Brevemente sobre nombrar en JS</a></li>
<li><a href="../es488382/index.html">A√±ado 3-25 segundos de retraso a los sitios que visito</a></li>
<li><a href="../es488386/index.html">Casos para aplicar herramientas de an√°lisis de anomal√≠as de red: ataques a trav√©s de complementos del navegador</a></li>
<li><a href="../es488388/index.html">Volver a iniciar y autenticaci√≥n b√°sica HTTP</a></li>
<li><a href="../es488390/index.html">C√≥mo hacer amigos de Telegram bot con OpenId Connect</a></li>
<li><a href="../es488392/index.html">Im√°genes listas para producci√≥n para k8s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>