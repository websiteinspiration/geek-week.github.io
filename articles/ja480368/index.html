<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎖️ 👨🏿‍💻 🎽 C / C ++でメモリリークをキャッチする 👆🏼 🤙🏻 🤹🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ハブロフキアン、あなたに挨拶します！
 

今日は、CまたはC ++でのメモリリークの処理方法について少し説明します。
 

Habréにはすでに2つの記事があります。つまり、メモリリーク（C ++ CRT）とC ++でのメモリリークに対処します：Visual Leak Detector。ただし、十...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C / C ++でメモリリークをキャッチする</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480368/"><p><img src="https://habrastorage.org/webt/u4/5k/td/u45ktd0wvbjglbnusjeg-pwyrmq.jpeg"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハブロフキアン、あなたに挨拶します！</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日は、CまたはC ++でのメモリリークの処理方法について少し説明します。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habréにはすでに2つの記事があります。つまり</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、メモリリーク（C ++ CRT）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">C ++でのメモリリークに対処します</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Visual Leak Detector</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ただし、十分に開示されていないか、またはこれらの方法では必要な結果が得られない可能性があるため、可能な限りすべての方法を理解し、生活を楽にしたいと思います。</font></font></p><a name="habracut"></a><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windowsの-開発</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
のWindows、Visual Studio用すなわち開発とレッツ・スタートは、ほとんどの初心者プログラマは、このIDEのために特別に記述するので。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/me/gj/vd/megjvd674_ifi-0fywxd_g3xefy.jpeg"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何が起こっているのかを理解するために、私は実際の例を適用します。</font></font></p><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Main.c</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function">struct Student <span class="hljs-title">create_student</span><span class="hljs-params">()</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ControlMenu</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
    ControlMenu();<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ShowListMenu</span><span class="hljs-params">(<span class="hljs-keyword">int</span> kX)</span>
</span>{
    <span class="hljs-keyword">char</span> listMenu[COUNT_LIST_MENU][<span class="hljs-number">55</span>] = { {<span class="hljs-string">"Read students from file"</span>}, {<span class="hljs-string">"Input student and push"</span>},<font></font>
    {<span class="hljs-string">"Input student and push it back"</span>}, {<span class="hljs-string">"Input student and push it after student"</span>},<font></font>
    {<span class="hljs-string">"Delete last student"</span>}, {<span class="hljs-string">"Write students to file"</span>}, {<span class="hljs-string">"Find student"</span>}, {<span class="hljs-string">"Sort students"</span>},<font></font>
    {<span class="hljs-string">"Show list of students"</span>}, {<span class="hljs-string">"Exit"</span>} };
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; COUNT_LIST_MENU; i++)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (i == kX)<font></font>
        {<font></font>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s"</span>, listMenu[i]);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">" &lt;=\n"</span>);<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, listMenu[i]);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ControlMenu</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ListOfStudents</span>* <span class="hljs-title">list</span> = <span class="hljs-title">NULL</span>;</span>
    <span class="hljs-keyword">int</span> kX = <span class="hljs-number">0</span>, key;
    <span class="hljs-keyword">int</span> <span class="hljs-built_in">exit</span> = FALSE;<font></font>
    ShowListMenu(kX);<font></font>
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        key = _getch();<font></font>
        <span class="hljs-keyword">switch</span> (key)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> <span class="hljs-number">72</span>: <span class="hljs-comment">//up</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">0</span>)<font></font>
                kX = COUNT_LIST_MENU<span class="hljs-number">-1</span>;
            <span class="hljs-keyword">else</span><font></font>
                kX--;<font></font>
        }<span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">80</span>: <span class="hljs-comment">//down</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (kX == COUNT_LIST_MENU<span class="hljs-number">-1</span>)<font></font>
                kX = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">else</span><font></font>
                kX++;<font></font>
        }<span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">13</span>:<font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">0</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">int</span> sizeStudents = <span class="hljs-number">0</span>;
                <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Student</span>* <span class="hljs-title">students</span> = (<span class="hljs-title">struct</span> <span class="hljs-title">Student</span>*)<span class="hljs-title">malloc</span>(1 * <span class="hljs-title">sizeof</span>(<span class="hljs-title">struct</span> <span class="hljs-title">Student</span>));</span>
                <span class="hljs-keyword">char</span>* path = (<span class="hljs-keyword">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">255</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>));
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Put the path to file with students: "</span>);
                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, path);
                <span class="hljs-keyword">int</span> size = <span class="hljs-number">0</span>;<font></font>
                students = read_students(path, &amp;size);<font></font>
                <span class="hljs-keyword">if</span> (students == <span class="hljs-literal">NULL</span>)<font></font>
                {<font></font>
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Can't open this file.\n"</span>);<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span><font></font>
                {<font></font>
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++)<font></font>
                    {<font></font>
                        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>)<font></font>
                        {<font></font>
                            <span class="hljs-built_in">list</span> = init(students[i]);<font></font>
                        }<font></font>
                        <span class="hljs-keyword">else</span><font></font>
                        {<font></font>
                            <span class="hljs-built_in">list</span> = add_new_elem_to_start(<span class="hljs-built_in">list</span>, students[i]);<font></font>
                        }<font></font>
                    }<font></font>
                }<font></font>
                                <span class="hljs-built_in">free</span>(students);
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                getchar();<font></font>
                getchar();<font></font>
                <span class="hljs-built_in">free</span>(path);<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">1</span> || kX == <span class="hljs-number">2</span> || kX == <span class="hljs-number">3</span> || kX == <span class="hljs-number">6</span>)<font></font>
            {<font></font>
                struct Student student = create_student();<font></font>
                <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">1</span>)<font></font>
                {<font></font>
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">list</span> == <span class="hljs-literal">NULL</span>)<font></font>
                    {<font></font>
                        <span class="hljs-built_in">list</span> = init(student);<font></font>
                    }<font></font>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        <span class="hljs-built_in">list</span> = add_new_elem_to_start(<span class="hljs-built_in">list</span>, student);<font></font>
                    }<font></font>
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                    getchar();<font></font>
                    getchar();<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">2</span>)<font></font>
                {<font></font>
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">list</span> == <span class="hljs-literal">NULL</span>)<font></font>
                    {<font></font>
                        <span class="hljs-built_in">list</span> = init(student);<font></font>
                    }<font></font>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        <span class="hljs-built_in">list</span> = add_new_elem_to_end(<span class="hljs-built_in">list</span>, student);<font></font>
                    }<font></font>
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                    getchar();<font></font>
                    getchar();<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">3</span>)<font></font>
                {<font></font>
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">list</span> == <span class="hljs-literal">NULL</span>)<font></font>
                    {<font></font>
                        <span class="hljs-built_in">list</span> = init(student);
                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"The list was empty, so, list have been created.\n"</span>);<font></font>
                    }<font></font>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        <span class="hljs-keyword">int</span> position;
                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Put the position: "</span>);
                        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;position);
                        <span class="hljs-built_in">list</span> = add_new_elem_after_pos(<span class="hljs-built_in">list</span>, student, position);<font></font>
                    }<font></font>
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                    getchar();<font></font>
                    getchar();<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span><font></font>
                {<font></font>
                    <span class="hljs-keyword">if</span> (find_elem(<span class="hljs-built_in">list</span>, student))
                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Student exist"</span>);
                    <span class="hljs-keyword">else</span>
                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Student doesn't exist"</span>);
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                    getchar();<font></font>
                    getchar();<font></font>
                }<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">4</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">list</span> == <span class="hljs-literal">NULL</span>)<font></font>
                {<font></font>
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"List is empty.\n"</span>);<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span><font></font>
                {<font></font>
                    <span class="hljs-built_in">list</span> = delete_elem(<span class="hljs-built_in">list</span>);<font></font>
                }<font></font>
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                getchar();<font></font>
                getchar();<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">5</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">char</span>* path = (<span class="hljs-keyword">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">255</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>));
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Put the path to file with students: "</span>);
                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, path);
                <span class="hljs-keyword">if</span> (write_students(<span class="hljs-built_in">list</span>, path) == <span class="hljs-number">0</span>)<font></font>
                {<font></font>
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Can't write"</span>);
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                    getchar();<font></font>
                    getchar();<font></font>
                }<font></font>
                <span class="hljs-built_in">free</span>(path);<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">7</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">list</span> == <span class="hljs-literal">NULL</span>)<font></font>
                {<font></font>
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"List is empty.\n"</span>);<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span><font></font>
                {<font></font>
                    <span class="hljs-built_in">list</span> = sort_list(<span class="hljs-built_in">list</span>);<font></font>
                }<font></font>
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nThe list was successfully sorted"</span>);
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                getchar();<font></font>
                getchar();<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kX == <span class="hljs-number">8</span>)<font></font>
            {<font></font>
                system(<span class="hljs-string">"cls"</span>);<font></font>
                show_list(<span class="hljs-built_in">list</span>);
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nPress any key to continue..."</span>);<font></font>
                getchar();<font></font>
                getchar();<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span>
                <span class="hljs-built_in">exit</span> = TRUE;<font></font>
        }<span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">27</span>:<font></font>
        {<font></font>
            <span class="hljs-built_in">exit</span> = TRUE;<font></font>
        }<span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
        system(<span class="hljs-string">"cls"</span>);<font></font>
        ShowListMenu(kX);<font></font>
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">exit</span> == FALSE);
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">list</span> != <span class="hljs-literal">NULL</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">list</span> = delete_elem(<span class="hljs-built_in">list</span>);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function">struct Student <span class="hljs-title">create_student</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Student</span> <span class="hljs-title">new_student</span>;</span>
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Write the name of student\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, new_student.first_name);<font></font>
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strlen</span>(new_student.first_name) == <span class="hljs-number">0</span>);
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Write the last name of student\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, new_student.last_name);<font></font>
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strlen</span>(new_student.last_name) == <span class="hljs-number">0</span>);
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Write the patronyminc of student\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, new_student.patronyminc);<font></font>
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strlen</span>(new_student.patronyminc) == <span class="hljs-number">0</span>);
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Write the city of student\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, new_student.city);<font></font>
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strlen</span>(new_student.city) == <span class="hljs-number">0</span>);
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Write the district of student\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, new_student.disctrict);<font></font>
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strlen</span>(new_student.disctrict) == <span class="hljs-number">0</span>);
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Write the country of student\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, new_student.country);<font></font>
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strlen</span>(new_student.country) == <span class="hljs-number">0</span>);
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Write the phone number of student\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, new_student.phoneNumber);<font></font>
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strlen</span>(new_student.phoneNumber) != <span class="hljs-number">13</span>);
    <span class="hljs-keyword">char</span>* choose = (<span class="hljs-keyword">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">255</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>));
    <span class="hljs-keyword">while</span> (TRUE)<font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Does student live in hostel? Y - yes, N - no\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, choose);
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(choose, <span class="hljs-string">"y"</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(choose, <span class="hljs-string">"Y"</span>) == <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            new_student.is_live_in_hostel = TRUE;<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(choose, <span class="hljs-string">"n"</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(choose, <span class="hljs-string">"n"</span>) == <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            new_student.is_live_in_hostel = FALSE;<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">while</span> (TRUE)<font></font>
    {<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Does student get scholarship? Y - yes, N - no\n"</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, choose);
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(choose, <span class="hljs-string">"y"</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(choose, <span class="hljs-string">"Y"</span>) == <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            new_student.is_live_in_hostel = TRUE;<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(choose, <span class="hljs-string">"n"</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(choose, <span class="hljs-string">"n"</span>) == <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            new_student.is_live_in_hostel = FALSE;<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-built_in">free</span>(choose);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)<font></font>
    {<font></font>
        <span class="hljs-keyword">char</span> temp[<span class="hljs-number">10</span>];
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Write the %d mark of ZNO\n"</span>, i + <span class="hljs-number">1</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, temp);<font></font>
        new_student.mark_zno[i] = atof(temp);<font></font>
        <span class="hljs-keyword">if</span> (new_student.mark_zno[i] == <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            i--;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> new_student;<font></font>
}</code></pre></div></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、そこで</font></font><code>Student.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も、</font></font><code>Student.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構造や機能が宣言されています。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリリークがないことを示すタスクがあります。</font><font style="vertical-align: inherit;">最初に頭に浮かぶのはCRTです。</font><font style="vertical-align: inherit;">ここではすべてが非常に単純です。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mainが置かれているファイルの先頭に、次のコードを追加します。</font></font></p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __CRTDBG_MAP_ALLOC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;crtdbg.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_NEW new(_NORMAL_BLOCK, __FILE__, __LINE__)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> new DEBUG_NEW</span></code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、前に</font></font><code>return 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、あなたはそれを登録する必要があります</font></font><code>_CrtDumpMemoryLeaks();</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その結果、デバッグモードでは、スタジオは次のように出力します。</font></font></p><br>
<pre><code class="plaintext hljs">Detected memory leaks!<font></font>
<font></font>
Dumping objects -&gt;<font></font>
{79} normal block at 0x00A04410, 376 bytes long.<font></font>
 Data: &lt;                &gt; CD CD CD CD CD CD CD CD CD CD CD CD CD CD CD CD <font></font>
Object dump complete.</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素晴らしい！</font><font style="vertical-align: inherit;">これで、メモリリークがあることがわかりました。</font><font style="vertical-align: inherit;">これを排除する必要があるので、メモリをクリアするのを忘れた場所を見つける必要があります。</font><font style="vertical-align: inherit;">そして、ここで問題が発生します：実際、このメモリはどこに割り当てられましたか？</font></font></p><br>
<p><img src="https://habrastorage.org/webt/y4/wb/tz/y4wbtze5lwwwph735qztx0kokaw.gif"></p><br>
<p> ,     ,  ,    - :</p><br>
<pre><code class="plaintext hljs">if (kX == 0)<font></font>
            {<font></font>
                int sizeStudents = 0;<font></font>
                struct Student* students = (struct Student*)malloc(1 * sizeof(struct Student));<font></font>
                char* path = (char*)malloc(255 * sizeof(char));<font></font>
                printf("Put the path to file with students: ");<font></font>
                scanf("%s", path);<font></font>
                int size = 0;<font></font>
                students = read_students(path, &amp;size);<font></font>
                if (students == NULL)<font></font>
                {<font></font>
                    printf("Can't open this file.\n");<font></font>
                }<font></font>
                else<font></font>
                {<font></font>
                    for (int i = 0; i &lt; size; i++)<font></font>
                    {<font></font>
                        if (i == 0)<font></font>
                        {<font></font>
                            list = init(students[i]);<font></font>
                        }<font></font>
                        else<font></font>
                        {<font></font>
                            list = add_new_elem_to_start(list, students[i]);<font></font>
                        }<font></font>
                    }<font></font>
                }<font></font>
                free(students);<font></font>
                printf("\nPress any key to continue...");<font></font>
                getchar();<font></font>
                getchar();<font></font>
                free(path);<font></font>
            }</code></pre><br>
<p>   — ?    ?  ?</p><br>
<p>      Valgrind,    ...</p><br>
<p> ,  15  ,    Valgrind — <strong>Visual Leak Detector</strong>.   ,   CRT,    !  ,   .</p><br>
<p>  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>   assets  <code>vld-2.5.1-setup.exe</code></p><br>
<p>,      Visual Studio 2015,      Visual Studio 2019.  ,   .</p><br>
<p>  VLD,   <code>#include &lt;vld.h&gt;</code>. </p><br>
<p>     ,       debug (F5),     .      :</p><br>
<pre><code class="plaintext hljs">Visual Leak Detector read settings from: C:\Program Files (x86)\Visual Leak Detector\vld.ini<font></font>
Visual Leak Detector Version 2.5.1 installed.</code></pre><br>
<p> ,      :</p><br>
<pre><code class="plaintext hljs">WARNING: Visual Leak Detector detected memory leaks!<font></font>
---------- Block 1 at 0x01405FD0: 376 bytes ----------<font></font>
  Leak Hash: 0x555D2B67, Count: 1, Total 376 bytes<font></font>
  Call Stack (TID 8908):<font></font>
    ucrtbased.dll!malloc()<font></font>
    test.exe!0x00F41946()<font></font>
    test.exe!0x00F42E1D()<font></font>
    test.exe!0x00F44723()<font></font>
    test.exe!0x00F44577()<font></font>
    test.exe!0x00F4440D()<font></font>
    test.exe!0x00F447A8()<font></font>
    KERNEL32.DLL!BaseThreadInitThunk() + 0x19 bytes<font></font>
    ntdll.dll!RtlGetAppContainerNamedObjectPath() + 0xED bytes<font></font>
    ntdll.dll!RtlGetAppContainerNamedObjectPath() + 0xBD bytes<font></font>
  Data:<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
    CD CD CD CD    CD CD CD CD    CD CD CD CD    CD CD CD CD     ........ ........<font></font>
<font></font>
Visual Leak Detector detected 1 memory leak (412 bytes).<font></font>
Largest number used: 3115 bytes.<font></font>
Total allocations: 3563 bytes.<font></font>
Visual Leak Detector is now exiting.</code></pre><br>
<p>,   ! ,    ?    ?</p><br>
<p><img src="https://habrastorage.org/webt/dz/ui/q8/dzuiq8addahp5zcgp-p3nuarvqq.png"></p><br>
<p>,  ,     ,   .</p><br>
<p>  ,     :   .   :   debug,    return 0,        " "    " ". ,      ,    .   ,   . </p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/8y/e9/0p/8ye90pv8sqcl7ta-whe19khp5_a.jpeg"></p></div></div><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ez/ry/z6/ezryz6ugleg0jll99hb2pj65rmg.jpeg"></p></div></div><br>
<p> ,    ,      .  ,          .    .    ,     ,     .    ,        "   Foo".</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/10/uh/ms/10uhmsb4afebqpruq1vlsnsp-mo.jpeg"> </p></div></div><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/1j/9o/mt/1j9omtinhnzrgtfbvmxalgs90f0.jpeg"></p></div></div><br>
<p>!  !     !  ,    . </p><br>
<p><strong>Linux — </strong><br>
, ,    Linux.<br>
<img src="https://habrastorage.org/webt/xj/zs/m8/xjzsm8buie-rrb4m66fristpsda.jpeg"><br>
 Linux   valgrind.   valgrind,     <code>sudo apt install valgrind</code> ( Debian-). </p><br>
<p>   ,    ,   ,   :</p><br>
<div class="spoiler"><b class="spoiler_title">main.c</b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 10</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">int</span> * mas = (<span class="hljs-keyword">int</span> *)<span class="hljs-built_in">malloc</span>(N * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++)<font></font>
    {<font></font>
        *(mas+i) = i;<font></font>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\t"</span>, *(mas+i));<font></font>
    }<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre></div></div><br>
<p>    CLang,   .out ,    valgrind'.</p><br>
<p>   <code>valgrind ./a.out</code>.   valgrind, ,      ,  ,   , valgrind  :</p><br>
<pre><code class="plaintext hljs">==2342== HEAP SUMMARY:<font></font>
==2342==     in use at exit: 40 bytes in 1 blocks<font></font>
==2342==   total heap usage: 2 allocs, 1 frees, 1,064 bytes allocated<font></font>
==2342== <font></font>
==2342== Searching for pointers to 1 not-freed blocks<font></font>
==2342== Checked 68,984 bytes<font></font>
==2342== <font></font>
==2342== LEAK SUMMARY:<font></font>
==2342==    definitely lost: 40 bytes in 1 blocks<font></font>
==2342==    indirectly lost: 0 bytes in 0 blocks<font></font>
==2342==      possibly lost: 0 bytes in 0 blocks<font></font>
==2342==    still reachable: 0 bytes in 0 blocks<font></font>
==2342==         suppressed: 0 bytes in 0 blocks<font></font>
==2342== Rerun with --leak-check=full to see details of leaked memory<font></font>
==2342== <font></font>
==2342== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)<font></font>
==2342== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)</code></pre><br>
<p> , valgrind  ,    .  ,    ,   <code>--leak-check=full</code>,  , valgrind,   ,  :</p><br>
<pre><code class="plaintext hljs">==2348== 40 bytes in 1 blocks are definitely lost in loss record 1 of 1<font></font>
==2348==    at 0x4C2FB0F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)<font></font>
==2348==    by 0x40053A: main (in /home/hunterlan/Habr/a.out)</code></pre><br>
<p>,    ,    ,     . </p><br>
<p>  valgrind’,   strace  Dr.Memory,     ,       ,  valgrind .</p><br>
<p><strong></strong></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くの新しいツールをいつ、どのように使用するかを学び、これらのツールがどのように機能するかを理解し始めたため、Visual Studioでメモリリークを見つけるという問題に直面したことを嬉しく思います。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたの注意、あなたに良いコードを書いてくれてありがとう！</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480354/index.html">JavaScript配列メソッド.map（）、. filter（）、. reduce（）の概要</a></li>
<li><a href="../ja480356/index.html">あなたが会ったことがない有用なPythonのヒント</a></li>
<li><a href="../ja480358/index.html">ReactアプリケーションでのCSS-in-JSライブラリの隠れた価格</a></li>
<li><a href="../ja480362/index.html">ロシアのドイツ枯渇六フッ化ウランの冒険。パート1.歴史と濃縮技術</a></li>
<li><a href="../ja480364/index.html">依存性注入の形而上学</a></li>
<li><a href="../ja480370/index.html">DEFCONカンファレンス19.ボスはハッカーもExcelを愛しています</a></li>
<li><a href="../ja480374/index.html">React RoboticsのDogBotは建設業界で革命を追求します</a></li>
<li><a href="../ja480376/index.html">コンピュータゲームから秘密のメッセージまで：ビニールリリースでイースターエッグについて話し合う</a></li>
<li><a href="../ja480378/index.html">データサイエンススキルを高めるための14のオープンソースプロジェクト（簡単、通常、難しい）</a></li>
<li><a href="../ja480386/index.html">バージョン管理システムでのネットワーク機器とそのストレージの自動バックアップ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>