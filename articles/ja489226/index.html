<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👴🏼 ✌🏿 👨‍✈️ C＃.NETでLINQクエリを最適化する方法 🤴🏿 🌋 😱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前書き
 で、この記事で我々はいくつかの最適化手法で議論LINQ-問い合わせを。
 ここでは、LINQクエリに関連するいくつかのコード最適化アプローチを紹介します。
 
LINQ（Language-Integrated Query）は、データソースをクエリするためのシンプルで便利な言語で あることが...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C＃.NETでLINQクエリを最適化する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489226/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、この記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我々はいくつかの最適化手法で議論</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ-問い合わせを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQクエリに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関連するいくつかのコード最適化アプローチを</font><b><font style="vertical-align: inherit;">紹介し</font></b><font style="vertical-align: inherit;">ます。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Language-Integrated Query）は、データソースをクエリするためのシンプルで便利な言語で</font><font style="vertical-align: inherit;">
あることが知られて</font><font style="vertical-align: inherit;">います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQ to SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、DBMSのデータアクセステクノロジーです。これは、データを操作するための強力なツールです。クエリは宣言型言語によって構築</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">され、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラットフォーム</font><b><font style="vertical-align: inherit;">によってSQLクエリに</font></b><font style="vertical-align: inherit;">変換さ</font><font style="vertical-align: inherit;">れて、データベースサーバーに送信されて実行されます。私たちの場合、DBMSとは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を意味し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQクエリは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、経験豊富なDBAが</font><b><font style="vertical-align: inherit;">SQLクエリ</font></b><font style="vertical-align: inherit;">を最適化するすべてのニュアンスを</font><b><font style="vertical-align: inherit;">使用し</font></b><font style="vertical-align: inherit;">て作成できる、</font><font style="vertical-align: inherit;">最適に作成された</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLクエリに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変換されません</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適な接続（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）と結果のフィルタリング（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">化合物およびグループ条件の使用における多くのニュアンス</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTSで</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT IN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、&lt;&gt;を</font><b><font style="vertical-align: inherit;">EXISTS</font></b><font style="vertical-align: inherit;">で置き換える際の多くのバリエーション</font></font><b><font style="vertical-align: inherit;"></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一時テーブル、CTE、テーブル変数による結果の中間キャッシュ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令とテーブルヒント</font><b><font style="vertical-align: inherit;">WITH</font></b><font style="vertical-align: inherit;">（...）</font><font style="vertical-align: inherit;">を含む句（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の</font><font style="vertical-align: inherit;">使用</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サンプル内のデータの冗長な読み取りを取り除く手段の1つとしてのインデックス付きビューの使用</font></font></li>
</ol><br><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">LINQクエリの</font></b><font style="vertical-align: inherit;">コンパイル時に</font><font style="vertical-align: inherit;">
結果として生じる</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLクエリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の主なパフォーマンスボトルネック</font><font style="vertical-align: inherit;">は次のとおり</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ選択メカニズム全体を1つのリクエストに統合</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同一のコードブロックの複製。最終的には、データの複数の追加読み取りにつながります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチコンポーネント条件のグループ（論理的な「and」と「or」）- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、困難な条件で組み合わせると、必要なフィールドによって適切な非クラスター化インデックスを持つオプティマイザーが、最終的にクラスターインデックスによるスキャンを開始するという事実につながります（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEX SCAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）条件グループ別</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブクエリの深い入れ子により、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLステートメントの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析や、開発者や</font><b><font style="vertical-align: inherit;">DBA</font></b><font style="vertical-align: inherit;">からのクエリプランの</font><font style="vertical-align: inherit;">解析が非常に困難になり</font><font style="vertical-align: inherit;">ます。</font></font><b><font style="vertical-align: inherit;"></font></b></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適化方法</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、最適化メソッドに直接渡します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1）追加のインデックス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリ全体が1つまたは2つのメインテーブル（applications-people-operations）を中心に構築され、標準の条件セット（IsClosed、Cancelled、Enabled、Status）で構築されることが多いため、メインサンプリングテーブルのフィルターを検討することをお勧めします。識別されたサンプルが対応するインデックスを作成することが重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのフィールドから選択すると、クエリに返されるセットが大幅に制限されるため、このソリューションは理にかなっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、50万のアプリケーションがあります。ただし、アクティブなエントリは2,000しかありません。次に、正しく選択されたインデックスを</font><font style="vertical-align: inherit;">使用すると、大きなテーブルで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEX SCAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を行う必要が</font><b><font style="vertical-align: inherit;">なくなり</font></b><font style="vertical-align: inherit;">、非クラスター化インデックスを通じてデータをすばやく選択できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インデックスの欠如は、クエリプランの解析またはシステムビューの統計情報の収集を求めるプロンプトからも検出できます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_groups</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_group_stats</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.dm_db_missing_index_details</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのビューデータには、空間インデックスを除いて、欠落しているインデックスに関する情報が含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、インデックスとキャッシュは、多くの場合、不十分に記述された</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQクエリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLクエリの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影響に対処する方法</font><b><font style="vertical-align: inherit;">です</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
厳しい生活習慣がビジネスに現れるように、特定の日付までにビジネス機能を実装することがしばしば重要です。したがって、多くの場合、重いクエリはキャッシングによりバックグラウンドで実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーが常に最新のデータを必要とするわけではなく、許容可能なレベルのユーザーインターフェイス応答が発生するため、これは部分的に正当化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチにより、ビジネスニーズを解決できますが、最終的には情報システムの効率が低下し、問題の解決が遅れます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいインデックスを追加するために必要な検索プロセスでは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適化の</font><font style="vertical-align: inherit;">提案</font><font style="vertical-align: inherit;">が正しくない場合が</font><font style="vertical-align: inherit;">あることを覚えておくと</font><font style="vertical-align: inherit;">よいでしょう。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">類似した一連のフィールドを持つインデックスがすでに存在する場合</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インデックス作成の制限のためにテーブルのフィールドにインデックスを作成できない場合（詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で説明し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">）。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2）属性を1つの新しい属性にマージする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件のグループが発生する同じテーブルの一部のフィールドは、1つの新しいフィールドの導入で置き換えることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、タイプごとに通常ビット単位または整数の状態フィールドに特に当てはまります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Canceled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status = 1に</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">置き換えられ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、整数属性のステータスを入力します。これは、これらのステータスをテーブルに入力することで提供されます。</font><font style="vertical-align: inherit;">次のステップは、この新しい属性にインデックスを付けることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不要な計算をせずにデータを求めているため、これはパフォーマンスの問題の根本的な解決策です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3）提出物の具体化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQクエリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は一時テーブル、CTE、およびテーブル変数を直接使用できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、この場合に最適化する別の方法があります。これはインデックス付きビューです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件のグループ（上記の例から）</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsClosed = 0 AND Canceled = 0 AND Enabled = 0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（または他の同様の条件のセット）は、インデックス付きビューでそれらを使用して、大きなセットからの小さなデータスライスをキャッシュするのに適したオプションになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、ビューの具体化にはいくつかの制限があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サブクエリを使用する場合、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">句</font><font style="vertical-align: inherit;">は</font><b><font style="vertical-align: inherit;">JOIN</font></b><font style="vertical-align: inherit;">を使用して置き換える必要があります</font></font><b><font style="vertical-align: inherit;"></font></b></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION ALL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXCEPTION</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">INTERSECT句</font></b><font style="vertical-align: inherit;">は使用</font><b><font style="vertical-align: inherit;">でき</font></b><font style="vertical-align: inherit;">ません</font></font><b><font style="vertical-align: inherit;"></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テーブルヒントと</font><b><font style="vertical-align: inherit;">OPTION</font></b><font style="vertical-align: inherit;">句は使用できません</font></font><b><font style="vertical-align: inherit;"></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイクルを操作する能力がない</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるテーブルの1つのビューにデータを表示することは不可能です</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インデックス付きビューを使用することの実際の利点は、実際にインデックスを作成することによってのみ得られることを覚えておくことは重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、ビューを呼び出す場合、これらのインデックスは使用されない場合があり、明示的に使用するには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITH（NOEXPAND）を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定する必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以来</font><font style="vertical-align: inherit;">、テーブルヒントを定義することは不可能である</font><font style="vertical-align: inherit;">に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQクエリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を別の表現をしなければならないので、 -次の形式の「ラッパー」：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> _ <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> MAT_VIEW <span class="hljs-keyword">WITH</span> (NOEXPAND);
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4）テーブル関数の使用</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの場合、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQクエリでは、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大きなサブクエリブロックまたは複雑な構造の表現を使用するブロックが、非常に複雑で最適ではない実行構造を持つ最終クエリを形成します。</font><b><font style="vertical-align: inherit;">LINQクエリで</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
テーブル関数を使用する主な利点</font><font style="vertical-align: inherit;">：</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビューの場合のように、オブジェクトとして使用および指定する</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ですが、一連の入力パラメーターを渡すことができます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に</font><b><font style="vertical-align: inherit;">FROM FUNCTION（@ param1、@ param2 ...）</font></b><font style="vertical-align: inherit;">を使用すると、柔軟なデータサンプリングを実現できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テーブル関数を使用する場合、上記のインデックス付きビューの場合のような強力な制限はありません。</font></font><br>
<br>
<ol>
<li> :<br>
 <b>LINQ</b>             .<br>
     .<br>
        ,          </li>
<li>  ,     , :<br>
<br>
<ul>
<li>    (   )</li>
<li>     </li>
<li> <b>UNION</b>  <b>EXISTS</b></li>
</ul></li>
</ol><br>
</li>
<li> <b>OPTION</b>  ,       <b>OPTION(MAXDOP N)</b>,    . :<br>
<br>
<ul>
<li>      <b>OPTION (RECOMPILE)</b></li>
<li>         ,    <b>OPTION (FORCE ORDER)</b></li>
</ul><br>
   <b>OPTION</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.<br>
</li>
<li>      :<br>
        (     ),         .<br>
,  ,     <b>WHERE</b>    <b>(a, b, c)</b>.<br>
<br>
       <b>a = 0 and b = 0</b>.<br>
<br>
,    <b>c</b>  .<br>
<br>
  <b>a = 0 and b = 0</b>          ,    <b></b>      .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、テーブル関数の方が適している場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、テーブル関数は実行時間がより予測可能で一定です。</font></font><br>
</li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
質問データベースの例を使用した実装例を考えてみましょう。</font><font style="vertical-align: inherit;">複数のテーブルを組み合わせ、1つのビュー（OperativeQuestions）を使用</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエリがあります。これは、</font><font style="vertical-align: inherit;">「アクティブクエリ」（[OperativeQuestions]）</font><font style="vertical-align: inherit;">の所属を（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を介して</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">電子メールで確認します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストNo.1</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId],<font></font>
[Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]) <span class="hljs-keyword">AND</span> ( <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1]
<span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestions] <span class="hljs-keyword">AS</span> [Extent5]
<span class="hljs-keyword">WHERE</span> (([Extent5].[Email] = @p__linq__0) <span class="hljs-keyword">OR</span> (([Extent5].[Email] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) 
<span class="hljs-keyword">AND</span> (@p__linq__0 <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>))) <span class="hljs-keyword">AND</span> ([Extent5].[<span class="hljs-keyword">Id</span>] = [Extent1].[<span class="hljs-keyword">Id</span>])<font></font>
));<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビューの構造はかなり複雑です。ビューにはサブクエリ結合と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISTINCT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソートの使用があり</font><b><font style="vertical-align: inherit;">ます。</font></b><font style="vertical-align: inherit;">これは、一般に、リソースを大量に消費する操作です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OperativeQuestionsからの約1万件のレコードの選択。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクエリの主な問題は、外部クエリからのレコードの場合、[OperativeQuestions]ビューで内部サブクエリが実行されることです。これにより、出力サンプルが（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を介して</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">[Email] = @ p__linq__0の</font><font style="vertical-align: inherit;">数百のレコード</font><font style="vertical-align: inherit;">に制限され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、サブクエリは[Email] = @ p__linq__0によってレコードを一度計算する必要があるように見え、これらの数百のレコードがId c Questionsによって接続され、クエリが高速になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、すべてのテーブルは直列に接続されています。Idの質問とOperativeQuestionsのIdのコンプライアンスがチェックされ、Eメールがフィルタリングされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、リクエストは何万ものOperativeQuestionsレコードで機能し、必要なのはメールのデータのみです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OperativeQuestionsビューテキスト：</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストNo.2</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"> 
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> [dbo].[OperativeQuestions]
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Q.Id, USR.email <span class="hljs-keyword">AS</span> Email
<span class="hljs-keyword">FROM</span>            [dbo].Questions <span class="hljs-keyword">AS</span> Q <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].ProcessUserAccesses <span class="hljs-keyword">AS</span> BPU <span class="hljs-keyword">ON</span> BPU.ProcessId = CQ.Process_Id 
<span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">APPLY</span>
                     (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> HasNoObjects
                      <span class="hljs-keyword">WHERE</span>   <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>
                                    (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                                     <span class="hljs-keyword">FROM</span>     [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU
                                     <span class="hljs-keyword">WHERE</span>   BOU.ProcessUserAccessId = BPU.[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>)<font></font>
) <span class="hljs-keyword">AS</span> BO <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                         [dbo].Users <span class="hljs-keyword">AS</span> USR <span class="hljs-keyword">ON</span> USR.Id = BPU.UserId
<span class="hljs-keyword">WHERE</span>        CQ.[<span class="hljs-keyword">Exp</span>] = <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> CQ.AnswerId <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> BPU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> 
<span class="hljs-keyword">AND</span> (BO.HasNoObjects = <span class="hljs-number">1</span> <span class="hljs-keyword">OR</span>
              <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span>   <span class="hljs-number">1</span>
                           <span class="hljs-keyword">FROM</span>   [dbo].ObjectUserAccesses <span class="hljs-keyword">AS</span> BOU <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
                                      [dbo].ObjectQuestions <span class="hljs-keyword">AS</span> QBO 
                                                  <span class="hljs-keyword">ON</span> QBO.[Object_Id] =BOU.ObjectId
                               <span class="hljs-keyword">WHERE</span>  BOU.ProcessUserAccessId = BPU.Id 
                               <span class="hljs-keyword">AND</span> BOU.[<span class="hljs-keyword">To</span>] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> QBO.Question_Id = CQ.Id));
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DbContextの元のマッピング表現（EF Core 2）</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元のLINQクエリ</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .Where(x =&gt; x.Email == Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この特定のケースでは、インフラストラクチャを変更せず、既製の結果（「アクティブクエリ」）を含む別のテーブルを導入せずに、この問題の解決策を検討します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは良い解決策ですが、このタスクを最適化するための別のオプションがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主な目標は、OperativeQuestionsビューから[Email] = @ p__linq__0によってエントリをキャッシュすることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースにテーブル関数[dbo]。[OperativeQuestionsUserMail]を入力します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
入力パラメーターとしてメールを送信すると、値のテーブルが返されます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストNo.3</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> [dbo].[OperativeQuestionsUserMail]<font></font>
(<font></font>
    @Email  <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">RETURNS</span>
@tbl <span class="hljs-keyword">TABLE</span><font></font>
(<font></font>
    [<span class="hljs-keyword">Id</span>]           uniqueidentifier,<font></font>
    [Email]      <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">4000</span>)<font></font>
)<font></font>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">BEGIN</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> @tbl ([<span class="hljs-keyword">Id</span>], [Email])
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, @Email
        <span class="hljs-keyword">FROM</span> [OperativeQuestions]  <span class="hljs-keyword">AS</span> [x] <span class="hljs-keyword">WHERE</span> [x].[Email] = @Email;<font></font>
     <font></font>
    RETURN;<font></font>
<span class="hljs-keyword">END</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、事前定義されたデータ構造を持つ値のテーブルを返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OperativeQuestionsUserMailへのクエリを最適化し、最適なクエリプランを作成するには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RETURNS TABLE AS RETURN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では</font><font style="vertical-align: inherit;">なく、厳密な構造が必要</font><font style="vertical-align: inherit;">です</font><font style="vertical-align: inherit;">。この場合、目的のリクエスト1はリクエスト4に変換されます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストNo.4</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">(@p__linq__0 nvarchar(4000))<span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> [C1],<font></font>
[Extent1].[<span class="hljs-keyword">Id</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Id</span>],<font></font>
[Join2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id],<font></font>
[Join2].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id],<font></font>
[Join2].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>],<font></font>
[Join2].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId]
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, Email <span class="hljs-keyword">FROM</span> [dbo].[OperativeQuestionsUserMail] (@p__linq__0)<font></font>
) <span class="hljs-keyword">AS</span> [Extent0]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Questions] <span class="hljs-keyword">AS</span> [Extent1] <span class="hljs-keyword">ON</span>([Extent0].Id=[Extent1].Id)
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> [Extent2].[Object_Id] <span class="hljs-keyword">AS</span> [Object_Id], [Extent2].[Question_Id] <span class="hljs-keyword">AS</span> [Question_Id], [Extent3].[ExternalId] <span class="hljs-keyword">AS</span> [ExternalId], [Extent3].[ObjectType_Id] <span class="hljs-keyword">AS</span> [ObjectType_Id], [Extent4].[<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">AS</span> [<span class="hljs-keyword">Name</span>]
<span class="hljs-keyword">FROM</span> [dbo].[ObjectQuestions] <span class="hljs-keyword">AS</span> [Extent2]
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> [dbo].[Objects] <span class="hljs-keyword">AS</span> [Extent3] <span class="hljs-keyword">ON</span> [Extent2].[Object_Id] = [Extent3].[<span class="hljs-keyword">Id</span>]
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> [dbo].[ObjectTypes] <span class="hljs-keyword">AS</span> [Extent4] 
<span class="hljs-keyword">ON</span> [Extent3].[ObjectType_Id] = [Extent4].[<span class="hljs-keyword">Id</span>] ) <span class="hljs-keyword">AS</span> [Join2] 
<span class="hljs-keyword">ON</span> [Extent1].[<span class="hljs-keyword">Id</span>] = [Join2].[Question_Id]
<span class="hljs-keyword">WHERE</span> ([Extent1].[AnswerId] <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">AND</span> (<span class="hljs-number">0</span> = [Extent1].[<span class="hljs-keyword">Exp</span>]);
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DbContextでのビューと関数のマッピング（EF Core 2）</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">public class QuestionsDbContext : DbContext<font></font>
{<font></font>
    //...<font></font>
    public DbQuery&lt;OperativeQuestion&gt; OperativeQuestions { get; set; }<font></font>
    //...<font></font>
    protected override void OnModelCreating(ModelBuilder modelBuilder)<font></font>
    {<font></font>
        modelBuilder.Query&lt;OperativeQuestion&gt;().ToView("OperativeQuestions");<font></font>
    }<font></font>
}<font></font>
 <font></font>
public static class FromSqlQueries<font></font>
{<font></font>
    public static IQueryable&lt;OperativeQuestion&gt; GetByUserEmail(this DbQuery&lt;OperativeQuestion&gt; source, string Email)<font></font>
        =&gt; source.FromSql($"SELECT Id, Email FROM [dbo].[OperativeQuestionsUserMail] ({Email})");<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終LINQクエリ</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">var businessObjectsData = await context<font></font>
    .OperativeQuestions<font></font>
    .GetByUserEmail(Email)<font></font>
    .Include(x =&gt; x.Question)<font></font>
    .Select(x =&gt; x.Question)<font></font>
    .SelectMany(x =&gt; x.ObjectQuestions,<font></font>
                (x, bo) =&gt; new<font></font>
                {<font></font>
                    Id = x.Id,<font></font>
                    ObjectId = bo.Object.Id,<font></font>
                    ObjectTypeId = bo.Object.ObjectType.Id,<font></font>
                    ObjectTypeName = bo.Object.ObjectType.Name,<font></font>
                    ObjectExternalId = bo.Object.ExternalId<font></font>
                })<font></font>
    .ToListAsync();<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行時間の順序は、200〜800ミリ秒から2〜20ミリ秒など、10倍高速になりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに平均化すると、350ミリ秒ではなく8ミリ秒になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかなプラスから、以下も取得します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読み取り負荷の一般的な削減</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロッキングの可能性を大幅に低減</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平均ブロッキング時間を許容値に短縮</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">LINQ</font></b><font style="vertical-align: inherit;">を介し</font><font style="vertical-align: inherit;">
た</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQLデータベース</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への呼び出しの最適化と微調整</font><font style="vertical-align: inherit;">は、解決できる問題です。</font><font style="vertical-align: inherit;">
この作業では、注意と一貫性が非常に重要です。</font><font style="vertical-align: inherit;">
プロセスの初めに：</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエリが機能するデータ（値、選択したデータ型）を確認する必要があります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このデータに適切にインデックスを付ける</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テーブル間の接続条件の正確さを確認します</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の反復では、最適化によって次のことが明らかになります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストのベースとリクエストのメインフィルターが決定されます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同様のクエリブロックの繰り返しと条件の交差</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSMSまたは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Serverの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のGUI </font><font style="vertical-align: inherit;">では、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLクエリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自体が最適化され</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">（中間データストアの割り当て、このストアを使用して結果のクエリを作成します（複数ある場合があります））。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終段階で、結果の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLクエリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を基礎</font><font style="vertical-align: inherit;">として、</font><b><font style="vertical-align: inherit;">LINQクエリ</font></b><font style="vertical-align: inherit;">構造が再構築されます。</font></font><b><font style="vertical-align: inherit;"></font></b></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果として、結果の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINQクエリの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構造は、</font><font style="vertical-align: inherit;">段落3で</font><font style="vertical-align: inherit;">特定された最適な</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLクエリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と同じになり</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">謝辞</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同僚に感謝します </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jobgemws</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> そして </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alex_ozr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事を手伝ってくれた</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja489208/index.html">オンライン取引のための仮想サーバー</a></li>
<li><a href="../ja489210/index.html">Linuxコードのパフォーマンステストと例</a></li>
<li><a href="../ja489212/index.html">1C-Bitrixは、個人データの送信を要求することにより、ニュースレターの配信停止を防ぎます</a></li>
<li><a href="../ja489214/index.html">iOSでローカリゼーションをテストするための最新のアプローチ</a></li>
<li><a href="../ja489218/index.html">初心者です。スーパー：シンプルなゲームのコードとアーキテクチャ</a></li>
<li><a href="../ja489228/index.html">銀行のスピーチボット-史上最悪のUX</a></li>
<li><a href="../ja489230/index.html">Webアプリケーションのパフォーマンスとは何ですか？</a></li>
<li><a href="../ja489232/index.html">携帯電話の未来に戻るII</a></li>
<li><a href="../ja489234/index.html">ペンテストに合格する方法（悪いアドバイス）</a></li>
<li><a href="../ja489236/index.html">春：コンテキストを探す</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>