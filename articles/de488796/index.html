<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👦 ➕ 💪🏻 Lernen, Microservices bereitzustellen. Teil 2. Kubernetes 👺 👨‍👦 🙎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr!
 

Dies ist der zweite Teil einer Artikelserie "Lernen, wie man Microservices bereitstellt". Im vorherigen Teil haben wir zwei einfache Mi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Lernen, Microservices bereitzustellen. Teil 2. Kubernetes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488796/"><p><img src="https://habrastorage.org/webt/iu/kn/ul/iuknulmsnhmtr6n6gcuojiax5vi.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr!</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist der zweite Teil einer Artikelserie "Lernen, wie man Microservices bereitstellt". </font><font style="vertical-align: inherit;">Im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vorherigen Teil haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir zwei einfache Microservices geschrieben - ein Backend und ein Gateway - und herausgefunden, wie man sie in Docker-Bilder packt. </font><font style="vertical-align: inherit;">Im selben Artikel werden wir die Orchestrierung unserer Docker-Container mithilfe von Kubernetes organisieren. </font><font style="vertical-align: inherit;">Wir werden das System konsequent so konfigurieren, dass es in Minikube gestartet und dann für die Bereitstellung in der Google Kubernetes Engine angepasst wird.</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serienplan:</font></font></p><br>
<ol>
<li><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie Dienste mit Spring Boot und arbeiten Sie mit Docker</font></font></a></p><br>
<p><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlüsselwörter: Java 11, Spring Boot, Docker, Bildoptimierung</font></font></em></strong></p><br>
</li>
<li><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwicklung des Kubernetes-Konfigurations- und Bereitstellungssystems in Google Kubernetes Engine</font></font></p><br>
<p><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlüsselwörter: Kubernetes, GKE, Ressourcenmanagement, Autoscaling, Geheimnisse</font></font></em></strong></p><br>
</li>
<li><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen eines Diagramms mit Helm 3 für eine effizientere Clusterverwaltung</font></font></a></p><br>
<p><strong><em> : Helm 3, chart deployment</em></strong></p><br>
</li>
<li><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> Jenkins        </a></p><br>
<p><strong><em> : Jenkins configuration, plugins, separate configs repository</em></strong></p><br>
</li>
</ol><br>
<p>       Kubernetes:</p><br>
<ul>
<li>.          ,     .      ,     .</li>
<li>.   ,     ,       .</li>
<li> .                .           .</li>
<li> .    -   ,   Docker-,  Kubernetes       ,       .</li>
<li>.        ().</li>
</ul><br>
<p>Kubernetes —  ,     ,     .        .         Kubernetes-    .</p><br>
<p>    GitHub  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"></a>.</p><br>
<h2 id="sreda-kubernetes"> Kubernetes</h2><br>
<p>Minikube —       Kubernetes   .          .   ,    ,     GKE. Google Cloud Platform   -  300$     .          2+   (n1-standard-1).</p><br>
<p>   :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> Minikube</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">   GKE</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">   kubectl (  Kubernetes)</a></li>
</ul><br>
<h2 id="obekty-kubernetes"> Kubernetes</h2><br>
<p>   Kubernetes            .           .    ,     . </p><br>
<p>   Kubernetes:</p><br>
<ul>
<li><p><strong>Namespace</strong> —  .   ,      .           .</p><br>
</li>
<li><p><strong>Pod</strong> —   .        .       , ,  ,  ,  .</p><br>
</li>
<li><p><strong>ReplicaSet</strong> — ,         ,    .    ,        .            ReplicaSet  —    Deployment.</p><br>
</li>
<li><p><strong>Deployment</strong> —  ,       ReplicaSet'.     .</p><br>
</li>
<li><p><strong>Service</strong> —      .        ,       IP-.    ,      .          -  ,  Service  .</p><br>
<p>         ""      Kubernetes,    .</p><br>
<p>   .        ,  .         .     ,     .  :</p><br>
<ul>
<li>ClusterIP —   .        IP-,    .</li>
<li>NodePort —  IP-  (  ClusterIP)      ,     .      <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>.</li>
<li>LoadBalancer —   NodePort     ,   .       IP-   .</li>
</ul><br>
<p> Kubernetes     DNS  ,       .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>.</p><br>
</li>
<li><p><strong>ConfigMap</strong> —    ,  , ,       .</p><br>
</li>
<li><p><strong>Secret</strong> —     .     (№ SSL-),    ,   base64- ,      .       .</p><br>
</li>
<li><p><strong>HorizontalPodAutoscaler</strong> — ,           .</p><br>
</li>
</ul><br>
<h2 id="minikube-configuration">Minikube configuration</h2><br>
<h5 id="namespace">Namespace:</h5><br>
<p> :</p><br>
<pre><code class="plaintext hljs">kubectl create namespace msvc-ns</code></pre><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">kubectl config set-context --current --namespace=msvc-ns</code></pre><br>
<p>       'msvc-ns'.    ,     'default'.</p><br>
<p>   Kubernetes    yaml-   ,          CLI.        yaml-.</p><br>
<h5 id="configmap">ConfigMap</h5><br>
<p>,    .            URL-  .  ConfigMap       ,          (     ).</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: urls-config<font></font>
data:<font></font>
  BACKEND_URL: "http://backend:8080/"</code></pre><br>
<p>   ,   Kubernetes     .    ,      'backend'   8080 .</p><br>
<h5 id="secret">Secret</h5><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Secret<font></font>
metadata:<font></font>
  name: msvc-secret<font></font>
type: Opaque<font></font>
stringData:<font></font>
  secret: secret</code></pre><br>
<p> Opaque ,      -.   , ,   Docker-,   .            <em>stringData</em>.       base64,      .       :</p><br>
<pre><code class="plaintext hljs">data:<font></font>
  secret: c2VjcmV0 </code></pre><br>
<h5 id="deployments">Deployments</h5><br>
<p>     —    .</p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: gateway<font></font>
  labels:<font></font>
    tier: gateway<font></font>
    app: microservices<font></font>
spec:<font></font>
  replicas: 3<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      tier: gateway<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        tier: gateway<font></font>
    spec:<font></font>
      containers:<font></font>
        - name: gateway<font></font>
          image: anshelen/microservices-gateway:latest<font></font>
          envFrom:<font></font>
            - configMapRef:<font></font>
                name: urls-config<font></font>
          env:<font></font>
            - name: SECRET<font></font>
              valueFrom:<font></font>
                secretKeyRef:<font></font>
                  name: msvc-secret<font></font>
                  key: secret<font></font>
          readinessProbe:<font></font>
              httpGet:<font></font>
                path: /actuator/health<font></font>
                port: 8080<font></font>
              initialDelaySeconds: 5<font></font>
              periodSeconds: 3<font></font>
          ports:<font></font>
            - containerPort: 8080<font></font>
              protocol: TCP<font></font>
          resources:<font></font>
            limits:<font></font>
              memory: "256Mi"<font></font>
              cpu: "200m"<font></font>
            requests:<font></font>
              memory: "128Mi"<font></font>
              cpu: "50m"</code></pre><br>
<ul>
<li><p><strong><em>metadata.labels</em></strong><br>
       ,      .     ,        'microservices'   'gateway'.<br>
       <em>metadata.annotations</em> —      ,      .</p><br>
</li>
<li><p><strong><em>spec.replicas</em></strong><br>
       .</p><br>
</li>
<li><p><strong><em>spec.selector.matchLabels</em></strong><br>
        .          ,     tier,  'backend'.   <em>spec.template</em>      ,           <em>metadata.labels</em>     ,   .</p><br>
</li>
<li><p><strong><em>spec.strategy</em></strong><br>
 <em>spec.strategy</em>    .  'rollingUpdate' ,     ReplicaSet,        ReplicaSet',     .    (  /    )    <em>maxSurge</em>  <em>maxUnavailable</em>.      ,  .     <em>spec.strategy</em>     ,       . </p><br>
</li>
<li><p><strong><em>spec.templates</em></strong><br>
 <em>spec.templates</em>      .</p><br>
</li>
<li><p><strong><em>spec.templates.metadata.labels</em></strong><br>
    ,      <em>spec.selector.matchLabels</em>,      "" .</p><br>
</li>
<li><p><strong><em>spec.templates.spec.containers.image</em></strong><br>
 .  latest   Docker-,      ,     .          ,    —     Kubernetes.           ,       .         .      'latest'      4    ,      Jenkins. </p><br>
</li>
<li><p><strong><em>spec.templates.spec.containers.envFrom.configMapRef</em></strong><br>
    ConfigMap         .</p><br>
</li>
<li><p><strong><em>spec.templates.spec.containers.env</em></strong><br>
      'SECRET',     -   'secret'.</p><br>
</li>
<li><p><strong><em>spec.templates.spec.containers.readinessProbe</em></strong><br>
    .    ,     . Kubernetes       ,   3       200,        .</p><br>
<p><em>initialDelaySeconds</em> —    .<br>
<em>periodSeconds</em> —   .</p><br>
<p>     <em>livenessProbe</em>,         ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>   ).</p><br>
</li>
<li><p><strong><em>spec.templates.spec.containers.ports</em></strong><br>
  <em>ports</em>       .     (      <code>-p 8080:8080</code>).</p><br>
</li>
<li><p><strong><em>spec.templates.spec.containers.resources</em></strong><br>
   . <strong><em>limits</em></strong> —   ,  <strong><em>requests</em></strong> —  ,     . 200m — 200  (  ), Mi — . </p><br>
</li>
</ul><br>
<p>     ,   ,          .</p><br>
<h5 id="services">Services</h5><br>
<p> :</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  labels:<font></font>
    tier: backend<font></font>
  name: backend<font></font>
spec:<font></font>
  ports:<font></font>
    - port: 8080<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
  selector:<font></font>
    tier: backend</code></pre><br>
<p><strong><em>spec.ports.targetPort</em></strong> —   , <strong><em>spec.ports.port</em></strong> —   .  <strong><em>spec.selector</em></strong>  ,       ,   tier,  'backend'.       ,     ClusterIP,          <code>http://backend:8080</code>.</p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  labels:<font></font>
    tier: gateway<font></font>
  name: gateway<font></font>
spec:<font></font>
  ports:<font></font>
    - nodePort: 30500<font></font>
      port: 80<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
  selector:<font></font>
    tier: gateway<font></font>
  type: NodePort</code></pre><br>
<p>     Minikube,       ,     NodePort. <strong><em>spec.ports.nodePort</em></strong> —   .    ,        30000-32767.</p><br>
<h5 id="itogovyy-fayl-konfiguracii-dlya-minikube">    Minikube</h5><br>
<div class="spoiler"><b class="spoiler_title">deploy.yaml</b><div class="spoiler_text"><pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: urls-config<font></font>
data:<font></font>
  BACKEND_URL: "http://backend:8080/"<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: v1<font></font>
kind: Secret<font></font>
metadata:<font></font>
  name: msvc-secret<font></font>
type: Opaque<font></font>
stringData:<font></font>
  secret: secret<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  labels:<font></font>
    tier: backend<font></font>
  name: backend<font></font>
spec:<font></font>
  ports:<font></font>
    - port: 8080<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
  selector:<font></font>
    tier: backend<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  labels:<font></font>
    tier: gateway<font></font>
  name: gateway<font></font>
spec:<font></font>
  ports:<font></font>
    - nodePort: 30500<font></font>
      port: 80<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
  selector:<font></font>
    tier: gateway<font></font>
  type: NodePort<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: backend<font></font>
  labels:<font></font>
    tier: backend<font></font>
    app: microservices<font></font>
spec:<font></font>
  replicas: 3<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      tier: backend<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        tier: backend<font></font>
    spec:<font></font>
      containers:<font></font>
        - name: backend<font></font>
          image: anshelen/microservices-backend:latest<font></font>
          envFrom:<font></font>
            - configMapRef:<font></font>
                name: urls-config<font></font>
          ports:<font></font>
            - containerPort: 8080<font></font>
              protocol: TCP<font></font>
          readinessProbe:<font></font>
            httpGet:<font></font>
              path: /actuator/health<font></font>
              port: 8080<font></font>
            initialDelaySeconds: 5<font></font>
            periodSeconds: 3<font></font>
          resources:<font></font>
            limits:<font></font>
              memory: "256Mi"<font></font>
              cpu: "200m"<font></font>
            requests:<font></font>
              memory: "128Mi"<font></font>
              cpu: "50m"<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: gateway<font></font>
  labels:<font></font>
    tier: gateway<font></font>
    app: microservices<font></font>
spec:<font></font>
  replicas: 3<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      tier: gateway<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        tier: gateway<font></font>
    spec:<font></font>
      containers:<font></font>
        - name: gateway<font></font>
          image: anshelen/microservices-gateway:latest<font></font>
          envFrom:<font></font>
            - configMapRef:<font></font>
                name: urls-config<font></font>
          env:<font></font>
            - name: SECRET<font></font>
              valueFrom:<font></font>
                secretKeyRef:<font></font>
                  name: msvc-secret<font></font>
                  key: secret<font></font>
          readinessProbe:<font></font>
              httpGet:<font></font>
                path: /actuator/health<font></font>
                port: 8080<font></font>
              initialDelaySeconds: 5<font></font>
              periodSeconds: 3<font></font>
          ports:<font></font>
            - containerPort: 8080<font></font>
              protocol: TCP<font></font>
          resources:<font></font>
            limits:<font></font>
              memory: "256Mi"<font></font>
              cpu: "200m"<font></font>
            requests:<font></font>
              memory: "128Mi"<font></font>
              cpu: "50m"</code></pre></div></div><br>
<h5 id="zapusk"></h5><br>
<p> :</p><br>
<pre><code class="plaintext hljs">kubectl apply -f deploy.yaml</code></pre><br>
<p>    Kubernetes    URL  :</p><br>
<pre><code class="plaintext hljs">minikube service gateway --url -n msvc-ns</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">for i in `seq 50`; do curl $(minikube service gateway --url -n msvc-ns) &amp;&amp; echo; done</code></pre><br>
<p>  (    ):</p><br>
<pre><code class="plaintext hljs">Number of requests 1 (gateway 544429797, secret secret)<font></font>
Number of requests 1 (gateway 1543772618, secret secret)<font></font>
Number of requests 2 (gateway 544429797, secret secret)<font></font>
Number of requests 3 (gateway 544429797, secret secret)<font></font>
Number of requests 4 (gateway 544429797, secret secret)<font></font>
Number of requests 1 (gateway -1940767433, secret secret)<font></font>
Number of requests 2 (gateway -1940767433, secret secret)<font></font>
Number of requests 2 (gateway 1543772618, secret secret)<font></font>
Number of requests 5 (gateway 544429797, secret secret)<font></font>
...<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><pre><code class="plaintext hljs">Number of requests 1 (gateway 544429797, secret secret)<font></font>
Number of requests 1 (gateway 1543772618, secret secret)<font></font>
Number of requests 2 (gateway 544429797, secret secret)<font></font>
Number of requests 3 (gateway 544429797, secret secret)<font></font>
Number of requests 4 (gateway 544429797, secret secret)<font></font>
Number of requests 1 (gateway -1940767433, secret secret)<font></font>
Number of requests 2 (gateway -1940767433, secret secret)<font></font>
Number of requests 2 (gateway 1543772618, secret secret)<font></font>
Number of requests 5 (gateway 544429797, secret secret)<font></font>
Number of requests 3 (gateway 1543772618, secret secret)<font></font>
Number of requests 6 (gateway 544429797, secret secret)<font></font>
Number of requests 3 (gateway -1940767433, secret secret)<font></font>
Number of requests 4 (gateway 1543772618, secret secret)<font></font>
Number of requests 7 (gateway 544429797, secret secret)<font></font>
Number of requests 4 (gateway -1940767433, secret secret)<font></font>
Number of requests 8 (gateway 544429797, secret secret)<font></font>
Number of requests 9 (gateway 544429797, secret secret)<font></font>
Number of requests 10 (gateway 544429797, secret secret)<font></font>
Number of requests 5 (gateway 1543772618, secret secret)<font></font>
Number of requests 5 (gateway -1940767433, secret secret)<font></font>
Number of requests 6 (gateway -1940767433, secret secret)<font></font>
Number of requests 7 (gateway -1940767433, secret secret)<font></font>
Number of requests 6 (gateway 1543772618, secret secret)<font></font>
Number of requests 8 (gateway -1940767433, secret secret)<font></font>
Number of requests 7 (gateway 1543772618, secret secret)<font></font>
Number of requests 11 (gateway 544429797, secret secret)<font></font>
Number of requests 12 (gateway 544429797, secret secret)<font></font>
Number of requests 8 (gateway 1543772618, secret secret)<font></font>
Number of requests 9 (gateway -1940767433, secret secret)<font></font>
Number of requests 10 (gateway -1940767433, secret secret)<font></font>
Number of requests 11 (gateway -1940767433, secret secret)<font></font>
Number of requests 9 (gateway 1543772618, secret secret)<font></font>
Number of requests 10 (gateway 1543772618, secret secret)<font></font>
Number of requests 11 (gateway 1543772618, secret secret)<font></font>
Number of requests 12 (gateway -1940767433, secret secret)<font></font>
Number of requests 12 (gateway 1543772618, secret secret)<font></font>
Number of requests 13 (gateway 544429797, secret secret)<font></font>
Number of requests 13 (gateway 1543772618, secret secret)<font></font>
Number of requests 13 (gateway -1940767433, secret secret)<font></font>
Number of requests 14 (gateway 1543772618, secret secret)<font></font>
Number of requests 14 (gateway -1940767433, secret secret)<font></font>
Number of requests 15 (gateway -1940767433, secret secret)<font></font>
Number of requests 14 (gateway 544429797, secret secret)<font></font>
Number of requests 15 (gateway 544429797, secret secret)<font></font>
Number of requests 16 (gateway 544429797, secret secret)<font></font>
Number of requests 17 (gateway 544429797, secret secret)<font></font>
Number of requests 15 (gateway 1543772618, secret secret)<font></font>
Number of requests 16 (gateway 1543772618, secret secret)<font></font>
Number of requests 16 (gateway -1940767433, secret secret)<font></font>
Number of requests 17 (gateway 1543772618, secret secret)</code></pre></div></div><br>
<p>   ,         . ,     ,    .      - ,         -,   ,        .    ,      ,   . ,      1   ,   1000,     ""   ,         1000 . , ,     ,          .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"></a>.</p><br>
<h5 id="upravlenie-klasterom"> </h5><br>
<p>        .</p><br>
<p><strong><em> </em></strong></p><br>
<p><code>kubectl get &lt;object-type&gt;</code> —     .      'pod', 'service', 'deployment'  .        'all'.<br>
<code>kubectl get &lt;object-type&gt; &lt;object-name&gt; -o yaml</code> —      yaml-.<br>
<code>kubectl describe &lt;object-type&gt; &lt;object-name&gt;</code> —    .<br>
<code>kubectl cluster-info</code> —   .<br>
<code>kubectl top pod/node</code> —   /.</p><br>
<p><strong><em>  </em></strong></p><br>
<p><code>kubectl apply -f &lt;file/directory&gt;</code> —         .<br>
<code>kubectl delete &lt;object-type&gt; &lt;object-name&gt;</code> —  .<br>
<code>kubectl scale deployment &lt;deployment-name&gt; --replicas=n</code> —  .     :  n = 0,     n,      .<br>
<code>kubectl edit &lt;object-type&gt; &lt;object-name&gt;</code> —     .<br>
<code>kubectl rollout undo deployment &lt;deployment-name&gt;</code> —      .</p><br>
<p><strong><em></em></strong></p><br>
<p><code>kubectl logs &lt;pod-name&gt;</code> —   .  <code>-f</code>       .<br>
<code>kubectl port-forward &lt;pod-name&gt; &lt;host-port&gt;:&lt;container-port&gt;</code> —      .      .<br>
<code>kubectl exec -it &lt;pod-name&gt; -- /bin/sh</code> —     .<br>
<code>kubectl run curl --image=radial/busyboxplus:curl -i --tty</code> —   .        curl,     , ,   .<br>
<code>kubectl get events --sort-by='.metadata.creationTimestamp'</code> —     Kubernetes.    , ,  ,     .</p><br>
<h2 id="gke-configuration">GKE configuration</h2><br>
<p>   ,   ,    ,     Google Kubernetes Engine.</p><br>
<h5 id="services-1">Services</h5><br>
<p> GKE     ,        IP-.   ,      LoadBalancer:</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  labels:<font></font>
    tier: gateway<font></font>
  name: gateway<font></font>
spec:<font></font>
  selector:<font></font>
    tier: gateway<font></font>
  ports:<font></font>
    - port: 80<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
  type: LoadBalancer</code></pre><br>
<p>    ,       ,    .   ,      GCP ( VPC -&gt;  IP-)    ,   ,       <strong><em>spec.loadBalancerIp</em></strong>.</p><br>
<h5 id="horizontalpodautoscalers">HorizontalPodAutoscalers</h5><br>
<p>HorizontalPodAutoscaler           .         Minikube (-     ),   GKE    .</p><br>
<pre><code class="plaintext hljs">apiVersion: autoscaling/v1<font></font>
kind: HorizontalPodAutoscaler<font></font>
metadata:<font></font>
  name: backend<font></font>
spec:<font></font>
  scaleTargetRef:<font></font>
    apiVersion: apps/v1<font></font>
    kind: Deployment<font></font>
    name: backend<font></font>
  minReplicas: 1<font></font>
  maxReplicas: 3<font></font>
  targetCPUUtilizationPercentage: 50</code></pre><br>
<p> <strong><em>spec.scaleTargetRef</em></strong>  ,        backend.  ,     1  3        50%. ,       (     ),     <strong><em>requests.cpu</em></strong>   .</p><br>
<p> HorizontalPodAutoscaler'  .</p><br>
<h5 id="quotas">Quotas</h5><br>
<p>       .   ,       (multitenant environment).   ,    :</p><br>
<pre><code class="plaintext hljs">apiVersion: v1  <font></font>
kind: ResourceQuota  <font></font>
metadata:  <font></font>
  name: msvc-quota  <font></font>
spec:  <font></font>
  hard:<font></font>
    limits.cpu: "2"  <font></font>
    limits.memory: 4Gi</code></pre><br>
<p>       - ,          .    , ,     CLI (. <code>kubectl run</code>),        LimitRange:</p><br>
<pre><code class="plaintext hljs">apiVersion: v1  <font></font>
kind: LimitRange  <font></font>
metadata:  <font></font>
  name: msvc-default-resources  <font></font>
spec:  <font></font>
  limits: <font></font>
    - default:<font></font>
        memory: "512Mi"  <font></font>
        cpu: "250m"  <font></font>
      defaultRequest:  <font></font>
        memory: "256Mi"  <font></font>
        cpu: "50m"  <font></font>
      type: Container</code></pre><br>
<p>         ,       .</p><br>
<h5 id="itogovye-fayly-konfiguracii-dlya-gke">    GKE</h5><br>
<p>     <code>scripts_gke/</code>.</p><br>
<div class="spoiler"><b class="spoiler_title">create_quotas.yaml</b><div class="spoiler_text"><pre><code class="plaintext hljs">apiVersion: v1  <font></font>
kind: ResourceQuota  <font></font>
metadata:  <font></font>
  name: msvc-quota  <font></font>
spec:  <font></font>
  hard:<font></font>
    limits.cpu: "2"  <font></font>
    limits.memory: 4Gi<font></font>
<font></font>
---  <font></font>
<font></font>
apiVersion: v1  <font></font>
kind: LimitRange  <font></font>
metadata:  <font></font>
  name: msvc-default-resources  <font></font>
spec:  <font></font>
  limits: <font></font>
    - default:<font></font>
        memory: "512Mi"  <font></font>
        cpu: "250m"  <font></font>
      defaultRequest:  <font></font>
        memory: "256Mi"  <font></font>
        cpu: "50m"  <font></font>
      type: Container</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">deploy.yaml</b><div class="spoiler_text"><pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: urls-config<font></font>
data:<font></font>
  BACKEND_URL: "http://backend:8080/"<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: v1<font></font>
kind: Secret<font></font>
metadata:<font></font>
  name: msvc-secret<font></font>
type: Opaque<font></font>
stringData:<font></font>
  secret: secret<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  labels:<font></font>
    tier: backend<font></font>
  name: backend<font></font>
spec:<font></font>
  ports:<font></font>
    - port: 8080<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
  selector:<font></font>
    tier: backend<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  labels:<font></font>
    tier: gateway<font></font>
  name: gateway<font></font>
spec:<font></font>
  selector:<font></font>
    tier: gateway<font></font>
  ports:<font></font>
    - port: 80<font></font>
      protocol: TCP<font></font>
      targetPort: 8080<font></font>
  type: LoadBalancer<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: backend<font></font>
  labels:<font></font>
    tier: backend<font></font>
    app: microservices<font></font>
spec:<font></font>
  replicas: 2<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      tier: backend<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        tier: backend<font></font>
    spec:<font></font>
      containers:<font></font>
        - name: backend<font></font>
          image: anshelen/microservices-backend:latest<font></font>
          envFrom:<font></font>
            - configMapRef:<font></font>
                name: urls-config<font></font>
          ports:<font></font>
            - containerPort: 8080<font></font>
              protocol: TCP<font></font>
          readinessProbe:<font></font>
            httpGet:<font></font>
              path: /actuator/health<font></font>
              port: 8080<font></font>
            initialDelaySeconds: 5<font></font>
            periodSeconds: 3<font></font>
          resources:<font></font>
            limits:<font></font>
              memory: "512Mi"<font></font>
              cpu: "250m"<font></font>
            requests:<font></font>
              memory: "256Mi"<font></font>
              cpu: "50m"<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: autoscaling/v1<font></font>
kind: HorizontalPodAutoscaler<font></font>
metadata:<font></font>
  name: backend<font></font>
spec:<font></font>
  scaleTargetRef:<font></font>
    apiVersion: apps/v1<font></font>
    kind: Deployment<font></font>
    name: backend<font></font>
  minReplicas: 1<font></font>
  maxReplicas: 3<font></font>
  targetCPUUtilizationPercentage: 50<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: gateway<font></font>
  labels:<font></font>
    tier: gateway<font></font>
    app: microservices<font></font>
spec:<font></font>
  replicas: 2<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      tier: gateway<font></font>
  strategy:<font></font>
    rollingUpdate:<font></font>
      maxSurge: 25%<font></font>
      maxUnavailable: 25%<font></font>
    type: RollingUpdate<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        tier: gateway<font></font>
    spec:<font></font>
      containers:<font></font>
        - name: gateway<font></font>
          image: anshelen/microservices-gateway:latest<font></font>
          envFrom:<font></font>
            - configMapRef:<font></font>
                name: urls-config<font></font>
          env:<font></font>
            - name: SECRET<font></font>
              valueFrom:<font></font>
                secretKeyRef:<font></font>
                  name: msvc-secret<font></font>
                  key: secret<font></font>
          readinessProbe:<font></font>
              httpGet:<font></font>
                path: /actuator/health<font></font>
                port: 8080<font></font>
              initialDelaySeconds: 5<font></font>
              periodSeconds: 3<font></font>
          ports:<font></font>
            - containerPort: 8080<font></font>
              protocol: TCP<font></font>
          resources:<font></font>
            limits:<font></font>
              memory: "512Mi"<font></font>
              cpu: "250m"<font></font>
            requests:<font></font>
              memory: "256Mi"<font></font>
              cpu: "50m"<font></font>
<font></font>
---<font></font>
<font></font>
apiVersion: autoscaling/v1<font></font>
kind: HorizontalPodAutoscaler<font></font>
metadata:<font></font>
  name: gateway<font></font>
spec:<font></font>
  scaleTargetRef:<font></font>
    apiVersion: apps/v1<font></font>
    kind: Deployment<font></font>
    name: gateway<font></font>
  minReplicas: 1<font></font>
  maxReplicas: 3<font></font>
  targetCPUUtilizationPercentage: 50</code></pre></div></div><br>
<h5 id="zapusk-1"></h5><br>
<p>      scripts_gke:</p><br>
<pre><code class="plaintext hljs">kubectl apply -f scripts_gke/</code></pre><br>
<p>        ,        . URL  :</p><br>
<pre><code class="plaintext hljs">kubectl get svc gateway -o jsonpath='{.status.loadBalancer.ingress[0].ip}'</code></pre><br>
<p>   HorizontalPodAutoscaler'           .</p><br>
<h2 id="zaklyuchenie"></h2><br>
<p>     Kubernetes-       Google Kubernetes Engine.</p><br>
<p>,     ,  ,               .                  ,           …     -           ,    Kubernetes.   (  )     Helm.</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dritten Teil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dieser Artikelserie berühren wir Helm 3, erstellen ein Helmdiagramm für unser System und legen es in einem Repository ab, das auf der Grundlage von GitHub-Seiten erstellt wurde.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488782/index.html">Wie gefällt Ihnen diese Option zur Abhängigkeitsverwaltung in Python?</a></li>
<li><a href="../de488784/index.html">Kommerzialisierung von Verbesserungen der freien Software unter Copyleft-Lizenzen</a></li>
<li><a href="../de488786/index.html">Wie detailliert sollte eine User Story sein?</a></li>
<li><a href="../de488792/index.html">Überwachung der Standortverfügbarkeit in Russland am Knie</a></li>
<li><a href="../de488794/index.html">Golang + Phaser3 = MMORPG - Client und Server</a></li>
<li><a href="../de488800/index.html">Agil: 9 schlechte Tipps</a></li>
<li><a href="../de488806/index.html">Ist das nicht konstruktiv oder dienen Sie dem König die Petition?</a></li>
<li><a href="../de488808/index.html">Programmierer, lassen Sie uns die Quellen klassischer Programme untersuchen</a></li>
<li><a href="../de488810/index.html">Wir beleben den Hexapod wieder. Teil eins</a></li>
<li><a href="../de488812/index.html">Mehr SoC, gut und anders. Intel öffnet AIB für Entwickler und Hersteller</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>