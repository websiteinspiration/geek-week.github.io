<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😈 🤜🏽 🕰️ Créez et personnalisez votre CDN 🤶🏼 🧑🏼 👩🏼‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les réseaux de distribution de contenu (CDN) sont utilisés sur les sites et dans les applications principalement pour accélérer le chargement des élém...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Créez et personnalisez votre CDN</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496910/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les réseaux de distribution de contenu (CDN) sont utilisés sur les sites et dans les applications principalement pour accélérer le chargement des éléments statiques. Cela se produit en raison de la mise en cache des fichiers sur les serveurs CDN situés dans différentes régions géographiques. Après avoir demandé des données via CDN, l'utilisateur les reçoit du serveur le plus proche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principe de fonctionnement et de fonctionnalité de tous les réseaux de diffusion de contenu est à peu près le même. Ayant reçu une demande de téléchargement d'un fichier, le serveur CDN le prend une fois du serveur d'origine et le remet à l'utilisateur, en même temps la mise en cache pendant une durée donnée. Toutes les demandes suivantes reçoivent une réponse du cache. Tous les CDN ont des options pour le préchargement de fichiers, l'effacement du cache, la définition de sa période de rétention, et bien plus encore.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il arrive que pour une raison ou une autre, il soit nécessaire d'organiser notre propre réseau de diffusion de contenu, puis - laissez-nous vous aider à construire un autre vélo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/rw/ss/qfrwss0k86-bdbbbpztdh3d0nkq.jpeg"><br>
<font color="#B1B1B1"><sup><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vecteur infographique créé par pikisuperstar - www.freepik.com</font></font></a></i></sup></font><a name="habracut"></a><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous avez besoin de votre propre CDN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenez compte des cas lors du démarrage de votre propre CDN:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lorsque vous voulez économiser de l'argent et que les coûts de fonctionnement même en utilisant des CDN peu coûteux comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BunnyCDN</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont de plusieurs centaines de dollars par mois</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si nous voulons obtenir un cache permanent ou un cache sans voisins sur le serveur et le canal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la région dont vous avez besoin, les services CDN n'ont pas de points de présence</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tout paramètre de diffusion de contenu spécial requis</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous voulons accélérer la livraison de contenu dynamique en nous rapprochant des utilisateurs du serveur de production</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il existe une crainte qu'un service CDN tiers puisse collecter ou utiliser illégalement des informations sur le comportement des utilisateurs (accès aux services sans GDPR) ou se livrer à d'autres actions illégales</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la plupart des autres cas, il est préférable d'utiliser des solutions prêtes à l'emploi existantes.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce dont vous avez besoin pour courir</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est merveilleux si vous avez votre propre système autonome (AS). </font><font style="vertical-align: inherit;">Avec lui, vous pouvez attribuer la même IP à plusieurs serveurs et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suivre cette instruction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au niveau du réseau pour diriger les utilisateurs vers le plus proche. </font><font style="vertical-align: inherit;">Il faut dire que même avec le bloc d'adresses / 24, il est possible de construire un réseau de diffusion de contenu. </font><font style="vertical-align: inherit;">Certains fournisseurs de serveurs vous permettent de faire une annonce à utiliser dans toutes les régions à leur disposition. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous n'êtes pas un heureux propriétaire d'un bloc d'adresses IP, alors pour exécuter un simple CDN, vous aurez besoin de:</font></font><br>
<br>
<ul>
<li>   </li>
<li>     .     ,   </li>
<li>geoDNS .    ,   ,     </li>
</ul><br>
<br>
<h2>    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec l'enregistrement de domaine, tout est simple - inscrivez-vous dans n'importe quelle zone avec n'importe quel registraire. Vous pouvez également utiliser un sous-domaine pour un CDN, tel que quelque chose comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.namedomain.com</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En fait, dans notre exemple, nous le ferons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant aux serveurs de commande, ils doivent être loués dans les régions et pays où se trouve votre audience d'utilisateurs. Si le projet est intercontinental, il est pratique de choisir immédiatement des hébergeurs qui proposent des serveurs partout dans le monde. Exemples: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OVH</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaseweb</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 To</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les serveurs dédiés, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vultr</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DigitalOcean</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour le cloud virtuel *. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour notre CDN privé, nous commandons 3 serveurs virtuels sur différents continents. À </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vultr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur le serveur pour </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 $ / mois,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous obtenons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25 Go d'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> espace </font><b><font style="vertical-align: inherit;">SSD</font></b><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 To de trafic</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lors de l'installation, sélectionnez la dernière Debian. </font><font style="vertical-align: inherit;">Nos serveurs: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/di/f1/jydif1phgm45zpwjbety-fw_d-g.png" width="30"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Francfort</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ip: 199.247.18.199 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/wh/v1/ukwhv1lwwsr8snoiqc_yyzquo5s.png" width="30"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chicago</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ip: 149.28.121.123 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/qk/6e/3fqk6endcgzeybs-yjlkkphep50.png" width="30"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Singapour</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ip: 157.230.240.216 </font></font><br>
<br>
<font color="#B1B1B1"><sup><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Vultr et DigitalOcean promettent un prêt de 100 $ aux utilisateurs enregistrés en utilisant les liens dans l'article immédiatement après l'ajout d'un mode de paiement. </font><font style="vertical-align: inherit;">L'auteur en reçoit également un petit compliment, ce qui est très important pour lui maintenant. </font><font style="vertical-align: inherit;">Soyez compréhensif.</font></font></i></sup></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurer geoDNS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour qu'un utilisateur accède à un domaine ou sous-domaine CDN, il soit dirigé vers le serveur souhaité (le plus proche de lui), nous avons besoin d'un serveur DNS avec fonction geoDNS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principe et la procédure de geoDNS sont les suivants:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Définit l'IP du client qui a envoyé la demande DNS ou l'IP du serveur DNS récursif utilisé pour traiter la demande client. </font><font style="vertical-align: inherit;">Ces serveurs récursifs sont généralement des fournisseurs DNS.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par IP, le client connaît son pays ou sa région. </font><font style="vertical-align: inherit;">Pour cela, des bases GeoIP sont utilisées, dont il existe aujourd'hui un grand nombre. </font><font style="vertical-align: inherit;">Il existe de bonnes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">options gratuites</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fonction de l'emplacement du client, il lui donne l'adresse IP du serveur CDN le plus proche.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">créer vous-même un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> serveur DNS avec la fonction geoDNS </font><font style="vertical-align: inherit;">, mais il est préférable d'utiliser des solutions prêtes à l'emploi avec un réseau de serveurs DNS dans le monde entier et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anycast</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prêt à l'emploi </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">louDNS à</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de 9,95 $ / mois</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tarif GeoDNS, par défaut il y a un basculement DNS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zilore à</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de 25 $ / mois</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , basculement DNS activé</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Route 53 à</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de 35 $ / mois</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour 50 millions de requêtes géographiques nettes. </font><font style="vertical-align: inherit;">Le basculement DNS est facturé séparément</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS Made Easy à</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de 125 $ / mois</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il y a 10 basculements DNS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudflare</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , fonction de pilotage géographique disponible dans les tarifs d'entreprise</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la commande de geoDNS, vous devez faire attention au nombre de demandes incluses dans le tarif et tenir compte du fait que le nombre réel d'appels vers le domaine peut dépasser plusieurs fois les attentes. Des millions d'araignées, de scanners, de spammeurs et d'autres mauvais esprits travaillent sans relâche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presque tous les services DNS incluent un indispensable pour la création d'un service CDN - le basculement DNS. En l'utilisant, vous pouvez configurer la surveillance de vos serveurs et, en l'absence de signes de vie, remplacer automatiquement l'adresse du serveur qui ne fonctionne pas par un serveur de sauvegarde dans les réponses DNS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour construire notre CDN, nous utiliserons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClouDNS</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le tarif GeoDNS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez une nouvelle zone DNS dans votre compte, en indiquant votre domaine. </font><font style="vertical-align: inherit;">Si nous allons créer le CDN sur un sous-domaine et que le domaine principal est déjà utilisé, alors immédiatement après l'ajout de la zone, n'oubliez pas d'ajouter les enregistrements DNS existants. </font><font style="vertical-align: inherit;">L'étape suivante consiste à créer pour le domaine / sous-domaine CDN plusieurs enregistrements A, dont chacun sera appliqué à la région que nous avons définie. </font><font style="vertical-align: inherit;">Vous pouvez spécifier des continents ou des pays comme régions; des sous-régions sont disponibles pour les États-Unis et le Canada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, le CDN sera porté sur la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sous - </font><font style="vertical-align: inherit;">domaine </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En ajoutant la zone </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sayt.in</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , créez le premier enregistrement A pour le sous-domaine et dirigez toute l'Amérique du Nord vers le serveur de Chicago:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0x/z_/zt/0xz_ztazcrmz8wqlruylrz4iqh4.png" width="500"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Répétez l'opération pour les autres régions, en vous rappelant de créer une entrée pour les régions par défaut. </font><font style="vertical-align: inherit;">Voici le résultat:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/io/js/zy/iojszykgez_pu7wf3mzd8lvmffa.jpeg" width="600"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dernier enregistrement par défaut dans la capture d'écran signifie que toutes les régions tacites (c'est-à-dire l'Europe, l'Afrique, les utilisateurs d'Internet par satellite, etc.) seront envoyées à un serveur à Francfort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceci termine la configuration DNS de base. </font><font style="vertical-align: inherit;">Reste à aller sur le site du registraire de domaine et à remplacer les NS de domaine actuels par ceux émis par ClouDNS. </font><font style="vertical-align: inherit;">Et tandis que les NS seront mis à jour, nous préparerons le serveur.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installer des certificats SSL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre CDN fonctionnera sur HTTPS, donc si vous avez déjà des certificats SSL pour un domaine ou un sous-domaine, téléchargez-les sur tous les serveurs, par exemple, dans le répertoire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / ssl / yourdomain /</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
S'il n'y a pas de certificats, vous pouvez en obtenir un gratuitement auprès de Let's Encrypt. Le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script ACME Shell est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parfait pour cela </font><font style="vertical-align: inherit;">. Le client est pratique et facile à configurer, et surtout - vous permet de valider le domaine / sous-domaine pour DNS via l'API de ClouDNS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'installerons acme.sh que sur l'un des serveurs - European 199.247.18.199, à partir duquel les certificats seront copiés sur tous les autres. Pour installer, faites:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# wget -O - https://get.acme.sh | bash; source ~/.bashrc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant l'installation du script, une tâche CRON sera créée pour le renouvellement ultérieur des certificats sans notre participation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vérification du domaine lors de la délivrance d'un certificat sera effectuée à l'aide de DNS à l'aide de l'API.Par conséquent, dans le compte personnel ClouDNS du menu API du revendeur, vous devez créer une nouvelle API utilisateur et définir un mot de passe pour celle-ci. </font><font style="vertical-align: inherit;">L'auth-id résultant avec le mot de passe est écrit dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ / .acme.sh / dnsapi / dns_cloudns.sh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (à ne pas confondre avec le </font><i><font style="vertical-align: inherit;">fichier </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dns_clou </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dns.sh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Voici les lignes pour décommenter et modifier:</font></font><br>
<br>
<pre><code class="plaintext hljs">CLOUDNS_AUTH_ID=&lt;auth-id&gt;<font></font>
CLOUDNS_AUTH_PASSWORD="&lt;&gt;"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous </font><b><font style="vertical-align: inherit;">demandons</font></b><font style="vertical-align: inherit;"> un certificat SSL pour </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></b><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# acme.sh --issue --dns dns_cloudns -d cdn.sayt.in --reloadcmd "service nginx reload"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les paramètres pour l'avenir, nous avons spécifié une commande pour recharger automatiquement la configuration du serveur Web après chaque renouvellement de la période de validité du certificat à l'avenir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ensemble du processus d'obtention d'un certificat peut prendre jusqu'à 2 minutes, ne l'interrompez pas. </font><font style="vertical-align: inherit;">Si une erreur de validation de domaine se produit, essayez à nouveau d'exécuter la commande. </font><font style="vertical-align: inherit;">À la fin, nous verrons où les certificats ont été téléchargés: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l6/qv/16/l6qv16mchqhhaokxuvbwmnnw6xu.png" width="952"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rappelez </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">vous ces chemins, ils devront être spécifiés lors de la copie du certificat sur d'autres serveurs, ainsi que dans les paramètres du serveur Web. </font><font style="vertical-align: inherit;">Nous ne prêtons pas attention à l'erreur de rechargement des fichiers de configuration Nginx - sur un serveur entièrement configuré, il ne sera pas présent lors du renouvellement des certificats.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne nous reste plus que SSL à copier le certificat reçu sur deux autres serveurs en enregistrant le chemin d'accès aux fichiers. </font><font style="vertical-align: inherit;">Créez les mêmes répertoires sur chacun d'eux et faites une copie:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# mkdir -p /root/.acme.sh/cdn.sayt.in/<font></font>
root@cdn:~# scp -r root@199.247.18.199:/root/.acme.sh/cdn.sayt.in/* /root/.acme.sh/cdn.sayt.in/<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que le renouvellement du certificat soit régulier, nous allons créer une tâche CRON quotidienne sur les deux serveurs avec la commande:</font></font><br>
<blockquote><code>scp -r root@199.247.18.199:/root/.acme.sh/cdn.sayt.in/* /root/.acme.sh/cdn.sayt.in/ &amp;&amp; service nginx reload</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, l'accès au serveur source distant doit être configuré </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par clé</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-à-dire </font><font style="vertical-align: inherit;">sans saisir de mot de passe. </font><font style="vertical-align: inherit;">N'oubliez pas de le faire.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installer et configurer Nginx</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour renvoyer du contenu statique, nous utiliserons Nginx, configuré comme serveur proxy de mise en cache. </font><font style="vertical-align: inherit;">Mettez à jour la liste des packages et installez-la sur les trois serveurs:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# apt update<font></font>
root@cdn:~# apt install nginx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de la valeur par défaut, utilisez la configuration du spoiler ci-dessous:</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginx.conf</font></font></b><div class="spoiler_text"><pre><code class="nginx hljs"><span class="hljs-attribute">user</span> www-data;
<span class="hljs-attribute">worker_processes</span> auto;
<span class="hljs-attribute">pid</span> /run/nginx.pid;<font></font>
<font></font>
<span class="hljs-section">events</span> {
    <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">4096</span>;
    <span class="hljs-attribute">multi_accept</span> <span class="hljs-literal">on</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-section">http</span> {
    <span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">tcp_nopush</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">tcp_nodelay</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">types_hash_max_size</span> <span class="hljs-number">2048</span>;<font></font>
<font></font>
    <span class="hljs-attribute">include</span> /etc/nginx/mime.types;
    <span class="hljs-attribute">default_type</span> application/octet-stream;<font></font>
<font></font>
    <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;
    <span class="hljs-attribute">error_log</span> /var/log/nginx/error.log;<font></font>
<font></font>
    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">"msie6"</span>;
    <span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;
    <span class="hljs-attribute">gzip_proxied</span> any;
    <span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;
    <span class="hljs-attribute">gzip_types</span> text/plain application/javascript text/javascript text/css application/json application/xml text/xml application/rss+xml;
    <span class="hljs-attribute">gunzip</span> <span class="hljs-literal">on</span>;            <font></font>
<font></font>
    <span class="hljs-attribute">proxy_temp_path</span>    /var/cache/tmp;
    <span class="hljs-attribute">proxy_cache_path</span>   /var/cache/cdn levels=<span class="hljs-number">1</span>:<span class="hljs-number">2</span> keys_zone=cdn:<span class="hljs-number">64m</span> max_size=<span class="hljs-number">20g</span> inactive=<span class="hljs-number">7d</span>;
    <span class="hljs-attribute">proxy_cache_bypass</span> <span class="hljs-variable">$http_x_update</span>;<font></font>
<font></font>
<span class="hljs-section">server</span> {
  <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;
  <span class="hljs-attribute">server_name</span> cdn.sayt.in;<font></font>
<font></font>
  <span class="hljs-attribute">ssl_certificate</span> /root/.acme.sh/cdn.sayt.in/cdn.sayt.in.cer;
  <span class="hljs-attribute">ssl_certificate_key</span> /root/.acme.sh/cdn.sayt.in/cdn.sayt.in.key;<font></font>
<font></font>
  <span class="hljs-attribute">location</span> / {
    <span class="hljs-attribute">proxy_cache</span> cdn;
    <span class="hljs-attribute">proxy_cache_key</span> <span class="hljs-variable">$uri</span><span class="hljs-variable">$is_args</span><span class="hljs-variable">$args</span>;
    <span class="hljs-attribute">proxy_cache_valid</span> <span class="hljs-number">90d</span>;
    <span class="hljs-attribute">proxy_pass</span> https://sayt.in;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la config, éditez:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la taille du cache ne dépasse pas l'espace disque disponible</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inactif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">durée de</font></b><font style="vertical-align: inherit;"> stockage des données en cache auxquelles personne n'a accédé</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssl_certificate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssl_certificate_key</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - chemins d'accès aux certificats SSL et aux fichiers de clés</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxy_cache_valid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">durée de</font></b><font style="vertical-align: inherit;"> stockage des données mises en cache</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxy_pass</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'adresse du serveur d'origine à partir de laquelle le CDN demandera des fichiers pour la mise en cache. </font><font style="vertical-align: inherit;">Dans notre exemple, c'est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sayt.in</font></font></i></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, tout est simple. </font><font style="vertical-align: inherit;">La complexité ne peut survenir que dans la définition du temps de cache en raison de la similitude des </font><i><font style="vertical-align: inherit;">directives </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inactive</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxy_cache_valid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous les analyserons dans notre exemple. </font><font style="vertical-align: inherit;">Voici ce qui se passe avec </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inactive = 7d</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxy_cache_valid 90d</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si la demande n'est pas répétée dans les 7 jours, les données seront supprimées du cache après cette période</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si la demande est répétée au moins une fois tous les 7 jours, les données du cache seront considérées comme obsolètes après 90 jours et à la prochaine demande, Nginx la mettra à jour en la récupérant du serveur d'origine</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">édité nginx.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , rechargez la configuration:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# service nginx reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre CDN est complètement prêt. </font><font style="vertical-align: inherit;">Pour 15 $ / mois </font><font style="vertical-align: inherit;">nous avons des points de présence sur trois continents et 3 To de trafic: 1 To à chaque endroit.</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vérification du fonctionnement de CDN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardons les pings vers notre CDN à partir de différents emplacements géographiques. </font><font style="vertical-align: inherit;">Pour cela, tous les services de ping conviennent.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Point de lancement</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hôte</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temps moyen, ms</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allemagne Berlin</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199.247.18.199</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9,6</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pays-Bas, Amsterdam</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199.247.18.199</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">France Paris</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199.247.18.199</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16,3</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grande-Bretagne, Londres</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199.247.18.199</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14,9</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canada Toronto</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16,2</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">États-Unis, San Francisco</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52,7</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">États-Unis, Dallas</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23,1</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">États-Unis, Chicago</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.6</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">États-Unis, New York</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.28.121.123</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19,8</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Singapour</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">157.230.240.216</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,7</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Japon Tokyo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">157.230.240.216</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">74,8</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Australie, Sydney</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cdn.sayt.in</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">157.230.240.216</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">95,9</font></font></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les résultats sont bons. </font><font style="vertical-align: inherit;">Nous allons maintenant placer l'image test </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test.jpg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à la racine du site principal </font><font style="vertical-align: inherit;">et vérifier la vitesse de son téléchargement via CDN. </font><font style="vertical-align: inherit;">Aussitôt dit, aussitôt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fait</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le contenu est livré rapidement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons écrire un petit script au cas où nous voudrions vider le cache sur le point CDN.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">purge.sh</font></font></b><div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Purging all cache"</span><font></font>
    rm -rf /var/cache/cdn/*<font></font>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Purging <span class="hljs-variable">$1</span>"</span>
    FILE=`<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | md5sum | awk <span class="hljs-string">'{print $1}'</span>`<font></font>
    FULLPATH=/var/cache/cdn/<span class="hljs-variable">${FILE:31:1}</span>/<span class="hljs-variable">${FILE:29:2}</span>/<span class="hljs-variable">${FILE}</span>
    rm -f <span class="hljs-string">"<span class="hljs-variable">${FULLPATH}</span>"</span>
<span class="hljs-keyword">fi</span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour supprimer l'intégralité du cache, il suffit de l'exécuter, un fichier séparé peut être nettoyé comme ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">root@cdn:~# ./purge.sh /test.jpg</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au lieu de conclusions</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, je veux donner quelques conseils utiles afin de franchir immédiatement le râteau, ce qui m'a un jour fait mal à la tête:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour augmenter la tolérance aux pannes CDN, il est recommandé de configurer le basculement DNS, ce qui permet de modifier rapidement un enregistrement A en cas de défaillance du serveur. </font><font style="vertical-align: inherit;">Cela se fait dans le panneau de contrôle des enregistrements DNS du domaine</font></font></li>
<li>           CDN,    .            CDN,      6-7 : ,   (),   (), , ,   </li>
<li>         CDN. ,          ,       -</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">  </a>,  ,           </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essayez de vérifier les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pings de différents endroits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers vos serveurs. </font><font style="vertical-align: inherit;">Ainsi, vous pouvez voir les régions les plus proches des points CDN et configurer correctement GeoDNS</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selon les tâches, il n'est pas déplacé de configurer Nginx pour des exigences de mise en cache spécifiques et en tenant compte de la charge sur le serveur. </font><font style="vertical-align: inherit;">Les articles sur le cache Nginx - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et l'accélération du travail sous de lourdes charges: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">ici</font></a><font style="vertical-align: inherit;"> m'ont beaucoup aidé.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496886/index.html">Elon Musk a révélé le but de la caméra sur le rétroviseur de Tesla Model 3</a></li>
<li><a href="../fr496888/index.html">Une startup utilise l'IA pour rechercher des molécules qui aideront à combattre le coronavirus</a></li>
<li><a href="../fr496892/index.html">Tous Habr dans une seule base. Commentaires et application web</a></li>
<li><a href="../fr496894/index.html">Carnet de produit parfait</a></li>
<li><a href="../fr496900/index.html">Importez USRLE au moyen d'Apache NiFi. Étape 1 - Télécharger des fichiers via HTTPS</a></li>
<li><a href="../fr496912/index.html">ThinkPad E480 Intel sous Windows VS ThinkPad E495 AMD sur Ubuntu y a-t-il une différence?</a></li>
<li><a href="../fr496914/index.html">Le programme décimal le plus court</a></li>
<li><a href="../fr496916/index.html">Enseignement, négociation et consultation à distance - Partie 3: Serveur de réunion Yealink et 4 offres spéciales</a></li>
<li><a href="../fr496920/index.html">Faire une maison intelligente avec ASP.NET Core et Arduino</a></li>
<li><a href="../fr496922/index.html">Guide sur l'apk client-serveur inverse sur l'exemple du job NeoQUEST-2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>