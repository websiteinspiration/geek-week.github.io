<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🤝‍👨🏼 🚕 ↪️ Warum verwende ich SharedViewModel nicht für Fragmente? 🏂🏾 🤰🏾 🙍🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habr, hallo! 
 
 Die Aufgabe, die Interaktion zwischen Fragmenten zu organisieren, ist sehr verbreitet. ShareViewModel eignet sich auf den ersten Blic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Warum verwende ich SharedViewModel nicht für Fragmente?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504712/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habr, hallo! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Aufgabe, die Interaktion zwischen Fragmenten zu organisieren, ist sehr verbreitet. ShareViewModel eignet sich auf den ersten Blick hervorragend dafür. Wir erstellen ein ViewModel mit owner = our activity, in dem unsere Fragmente angezeigt werden, und erhalten dieses ViewModel in jedem Fragment. weil Der Eigentümer des ViewModel ist die Aktivität. Die Fragmente erhalten dieselbe Instanz des ViewModel, mit der sie Daten, Aufrufmethoden usw. austauschen können. Hier ist der Link aus der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgende Abbildung zeigt das Interaktionsschema von 3 Fragmenten. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/367/ad4/04f/367ad404f3bf81ec55692ad5c7fc7ac7.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jene. Was wir tun: In jedem Fragment erhalten wir das SharedViewModel der Fragmente, mit denen wir interagieren müssen ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dies ist meiner Meinung nach nicht die beste Lösung. Weil:</font></font><br>
<a name="habracut"></a><br>
<ol>
<li>    *VM.   ViewModel   View. ViewModel   LiveData,   View,    .. ViewModel    - ,   View.</li>
<li>  SharedViewModel —     .   ,    SharedViewModel ,    ,     .     - . </li>
<li>       SharedViewModel,         .       ,     ,        . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SharedViewModel kann nur verwendet werden, wenn mehrere vollständig identische Fragmente mit denselben Daten vorhanden sind. In meiner Praxis gab es kein solches Szenario. Es kann zwei identische Fragmente geben, aber der Status des ViewModels ist unterschiedlich. Das SharedViewModel ist für sie ungültig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SharedViewModel bringt eine Menge Probleme mit sich. Sie werden langsam verwirrt, alles ist mit Abhängigkeiten überwachsen, der Code ist kompliziert. Es ist viel einfacher zu arbeiten, wenn Fragment + ViewModel eine Black Box ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welche Lösung kann angeboten werden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein einfacher Dienst, mit dem jedes Fragment auf seine Weise interagiert.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/de9/a92/247/de9a92247d6d9f0cd0c1d9bbdf7bbe6c.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Dienst muss in jedem ViewModel übergeben werden. Dank DI und Scope (Dagger, Koin, alle anderen) kann dies einfach und unkompliziert durchgeführt werden. Wenn der Dienst im Kontext einer Aktivität ausgeführt werden soll, erstellen Sie ihn im Bereich dieser Aktivität und übergeben Sie ihn an jedes ViewModel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sehen Sie, was passiert ist: Wir haben alle SharedViewModel aus Fragmenten entfernt. Jedes Fragment weiß jetzt nichts über die anderen Fragmente. Wenn wir diesem Schema ein neues Fragment hinzufügen möchten, müssen wir nur viewModel D mit unserem Service verbinden und fertig. Wenn das Fragment auf eine Änderung einer Eigenschaft des Dienstes reagieren soll, abonnieren Sie es einfach. Wir müssen die ViewModels anderer Leute nicht mehr verstehen. Und dieser Dienst ist viel einfacher als jedes ViewModel, es wird einfacher sein, den Dienst zu verstehen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass sich nicht so viele interagierende Fragmente auf einem Bildschirm befinden. </font><font style="vertical-align: inherit;">Am Telefon - vielleicht. </font><font style="vertical-align: inherit;">Auf dem Tablet - das kann man nicht mehr sagen. </font><font style="vertical-align: inherit;">Und FragmentContainerView hilft bei der Verwendung von Fragmenten in beliebigen Layouts. Dies ist sehr praktisch, wenn die Anwendung viele gemeinsame Komponenten mit einem Lebenszyklus enthält.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus: Wie erstelle ich Fragmente?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So: SomeFragment () </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und was ist mit den Parametern? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem Aufkommen von ViewModel verwende ich keine Parameter. </font><font style="vertical-align: inherit;">Ich übergebe nichts per Bundle an das Fragment (Android Studio bietet weiterhin an, ein Fragment mit Argumenten zu erstellen und ein Fragment mithilfe der statischen Methode zu erstellen). Ich verwende </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safety NavArgs nicht für die Navigationskomponente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All diese Dinge machen das Fragment konditioniert. Wir können ein solches Fragment beispielsweise nicht einfach zum ViewPager hinzufügen. Man muss sich überlegen, wie man die Parameter übergibt. Oder ein anderes Beispiel: Sie haben ein Fragment mit Parametern erstellt, arbeiten daran, die Daten haben sich geändert, das Fragment zeigt bereits etwas anderes. Wir haben die Gerätekonfiguration geändert (umgedreht), das Fragment wurde mit veralteten Parametern neu erstellt, während das ViewModel bereits andere Daten enthält. Und die Aktualisierung der Parameter usw. beginnt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe das alles im ViewModel entfernt. Ich benutze den gleichen Dienst, über den ich die Parameter übergebe. Es funktioniert wie Safety NavArgs. ViewModel fordert vom Dienst Parameter nach dem Typ der Parameterklasse an. Nach dem erfolgreichen Abrufen des Parameters löscht der Dienst diese (funktioniert wie Push / Pop).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies löst sofort das Problem der Änderung der Konfiguration: Das Fragment wurde erneut erstellt, und das ViewModel enthält bereits die aktuellen Daten. Sie müssen sie lediglich mit der Ansicht verbinden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch ein Problem beim Übergeben von Parametern durch das Bündel - dies ist ein Überschuss der zulässigen Menge. </font><font style="vertical-align: inherit;">Wenn die übertragene Datenmenge mehr als 500 KB beträgt, kann die Anwendung aufgrund einer Ausnahme in Binder.java abstürzen. </font><font style="vertical-align: inherit;">Dies führte zur Schaffung verschiedener Bibliotheken, die Parameter über SD übertragen, was im Vergleich zur Verwendung von RAM nicht sehr schnell ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen sind die Werkzeuge cool, alles ist flexibel, aber Sie müssen vorsichtig sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles, danke fürs Zuschauen!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de504700/index.html">Sowjetische Grafiktafel "Skizze"</a></li>
<li><a href="../de504702/index.html">Die Leute wollen kein Englisch</a></li>
<li><a href="../de504706/index.html">Automatische Wi-Fi-Energieverwaltung</a></li>
<li><a href="../de504708/index.html">Ausstellung des Sectigo-Zertifikats nach dem 30. Mai 2020 und Lösungsmethode</a></li>
<li><a href="../de504710/index.html">FOSS News Nr. 18 - eine Überprüfung der kostenlosen und Open Source-Nachrichten für den 25. bis 31. Mai 2020</a></li>
<li><a href="../de504714/index.html">Gehen Sie Software-Messwerkzeuge</a></li>
<li><a href="../de504716/index.html">Sicherer Zugang zu einem Smart Home ohne öffentliche IP (Teil 1)</a></li>
<li><a href="../de504718/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends für die letzte Woche Nr. 417 (25. - 31. Mai 2020)</a></li>
<li><a href="../de504720/index.html">Die schnellste Template Engine für PHP</a></li>
<li><a href="../de504722/index.html">HLS in MP4 mit ffmpeg in einem Browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>