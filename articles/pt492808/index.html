<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🤝‍👨🏿 🛌🏾 🙌🏿 Sensor de posição do interruptor da luz de emergência 👨🏻‍🚀 🤛🏿 👨‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antes de todos que projetam um sistema autônomo de iluminação de emergência, mais cedo ou mais tarde, surge o problema de ligar e desligar as luzes de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sensor de posição do interruptor da luz de emergência</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de todos que projetam um sistema autônomo de iluminação de emergência, mais cedo ou mais tarde, surge o problema de ligar e desligar as luzes de emergência. </font><font style="vertical-align: inherit;">Como fazer isso da maneira mais conveniente e transparente, para não estragar o design dos quartos com interruptores adicionais?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f4/90/kp/f490kpxmliwuhfpeeuf-lhmjhou.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das soluções sob o corte.</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fundo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No mundo moderno, muitas coisas estão ligadas à fonte de alimentação ininterrupta. A maioria dos tipos de atividade intelectual já é inconcebível sem um computador e comunicações operando 24 horas por dia, 7 dias por semana. Isso não é bom nem ruim, e você precisa viver com isso. Especialmente se o seu local de trabalho não estiver em um escritório moderno, repleto de UPS e geradores a diesel de reserva, mas em um apartamento de um prédio residencial comum. E aconteceu que a confiabilidade do suprimento energético de moradias na maioria das cidades da ex-URSS deixa muito a desejar. Como resultado, o fio que conecta a tomada doméstica e a central elétrica mais próxima tem o péssimo hábito de quebrar periodicamente. Quando uma vez a cada seis meses, e quando e três vezes ao dia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É por isso que, ao iniciar os reparos em um novo apartamento, eu inicialmente coloquei a fiação paralela no projeto para fornecimento ininterrupto de energia e iluminação. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu gostaria muito de ter à minha disposição um gerador poderoso com o ICE, capaz de fornecer energia normal a todo o apartamento, mas tive que abandonar essa idéia. Em uma casa particular, a questão não teria sido levantada, mas um apartamento é outro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro problema é a remoção dos gases de escape, que não são absolutamente suficientes para colocar no apartamento de uma casa com aquecimento central. Bem, você não jogará fora a mangueira do lado de fora da janela, onde a fumaça é instantaneamente sugada pela janela do vizinho aberto mais próximo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo problema é o ruído. Sim, os geradores modernos de quatro tempos do inversor, quando você os ouve na rua, podem parecer muito silenciosos. E se você pendurar um silenciador adicional, ficará completamente silencioso. Mas acredite em mim, em um ambiente desenergizado, o que significa um prédio de apartamentos completamente silencioso, mesmo um estrondo tão silencioso será perfeitamente audível para todos os vizinhos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em suma, a idéia com o gerador morreu, tão claramente e não nasceu. Das restantes opções reais, apenas as pilhas permaneciam.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, permito-me uma narrativa simples de minhas provações emocionais e das decisões tomadas na primeira pessoa sem nenhuma pretensão à verdade universal. </font><font style="vertical-align: inherit;">E imediatamente aviso que meus argumentos para alguém podem parecer pouco convincentes e que as decisões tomadas são controversas. </font><font style="vertical-align: inherit;">Mas, no entanto, tudo o que é descrito aqui é atualmente implementado em hardware e executa as tarefas com êxito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se alguém estiver interessado no lado puramente prático da questão e não importa como cheguei a essa vida, ele pode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pular muitas cartas e ir direto para a descrição da solução pronta.</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brevemente sobre como escolher o tipo de bateria</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E embora essa edição não tenha nada a ver com o tópico do artigo, eu gostaria de inserir aqui também meus cinco centavos. Além disso, que inevitavelmente surgem em tais declarações discussões muitas vezes carrega um monte </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de lulz</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informações úteis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje, no século do rápido desenvolvimento da energia alternativa, começaram a surgir sistemas ininterruptos de fornecimento de energia fabricados industrialmente relativamente acessíveis para o lar, combinados com mini-usinas solares ou eólicas. Os mais avançados deles usam baterias de íon de lítio com um monte de "aprimoradores" eletrônicos da eficácia de todo o sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No meu caso, não se pode falar em nenhuma mini-usina por motivos objetivos, e apenas a fonte de backup, renovável a partir de uma tomada comum durante a "iluminação", foi interessante. Portanto, foi decidido cultivar coletivamente todo o material eletrônico do apartamento UPS por conta própria. E como minhas mãos estavam completamente desamarradas, a primeira coisa que precisava ser decidida foi que tipo de bateria usar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No começo, pensei assim: “Por que não o lítio? </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juventude na moda elegante</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Selado, energeticamente eficiente, durável ". Mas quando olhei para os preços, meu fervor de lítio diminuiu visivelmente. Uma pesquisa rápida em combinação com a aritmética escolar mostrou que mesmo 26650 bancos chineses "muito burros" com (é claro) os mais honestos 5000 mAH custarão cinco vezes mais do que uma bateria ácida da mesma intensidade energética. E se você escolher algo que não esteja na parte inferior do preço classificado por preço, a diferença chegará facilmente de 8 a 10 vezes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E como você pode compensar uma diferença tão grande em valor? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sim, o lítio armazena energia de forma mais eficiente a cada quilograma e metro cúbico, e uma bateria do tamanho de um bloco de cigarro dedica facilmente uma bateria de 10 kg de ácido-chumbo. Mas esse fato é tão importante para o uso estacionário?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, um bom "lítio", mas com a abordagem correta, durará mais tempo. Mas dez vezes? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao mesmo tempo, do outro lado da balança, a potencial explosão de baterias de origem desconhecida, um algoritmo de carregamento mais complexo, problemas de descarte (todo sem-teto sabe onde usar uma bateria de chumbo para obter lucro, enquanto o lítio é muito mais complicado). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo, pela soma dos fatores, decidi adiar a idéia de lítio até a próxima iteração. Talvez daqui a alguns anos algo mude, mas, por enquanto, o chumbo é o nosso tudo.</font></font><br>
<br>
<blockquote>,      ,        .    ,    ,           ,           .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto às baterias de chumbo, também existem várias opções. A opção "certa" são as baterias de reserva especializadas, usadas no no-break, nas estações de base celulares e em outros locais semelhantes onde é necessário que sejam capazes de receber e fornecer grandes correntes, ocasionalmente sofrer uma descarga forte e, de fato, trabalhar sem distrair as pessoas. a serviço. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra opção "certa" são as baterias de tração para carregadeiras elétricas ou, o que diabos, um submarino a diesel. Essas baterias têm alta durabilidade e boa tolerância a descargas profundas, sem tirar do proprietário a oportunidade de "encher um pouco de água".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, a opção "errada" é a bateria inicial da loja de carros mais próxima. Uma bateria assim pode ceder brevemente um quilowatt de energia à montanha, mas qualquer descarga é estressante para ela, como o trabalho para uma pessoa preguiçosa. E a glória das baterias descartáveis ​​está geralmente enraizada nas modernas baterias de cálcio: "descarregadas - troque".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, espero que ninguém duvide de qual opção eu finalmente selecionei para implementação? Certo, terceiro. E as razões aqui estão não apenas no conhecido anfíbio verruga, mas também em um cálculo pragmático simples. As baterias iniciais são várias vezes mais baratas que todas as outras opções, às vezes se aproximando do lítio. E, em vez de sacudir uma bateria cara, você se sente muito mais livre em uma situação de indiferença saudável, quando a substituição resulta em perdas na quantidade de comida consumida por algumas semanas. Além disso, se você não deixar essas baterias esgotarem antes de perder o pulso, a vida útil delas no papel de backups é calculada por muitos anos. Você sempre pode colocar uma bateria com uma capacidade maior, ajustar o limite de descarga mais suavemente e ainda obter uma melhor relação preço / capacidade do que a bateria “certa”,sofrendo uma descarga profunda.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O principal nesta questão é fornecer ventilação pelo menos no nível do “orifício na parede” no local de instalação das baterias. </font><font style="vertical-align: inherit;">Bem, organize a proteção banal contra curtos-circuitos, porque a baixa tensão da fonte de corrente diminui a vigilância e tudo pode terminar muito mal.</font></font><br>
<br>
<h3><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guerra atual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em um único apartamento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após alguma garantia moral causada pela decisão final sobre o tipo de bateria, um novo motivo apareceu imediatamente para pensar com cuidado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me lembrá-lo que, inicialmente, eu queria um gerador de corrente alternada de 230 V. No entanto, depois de me reconciliar com a realidade objetiva e mudar mentalmente para as baterias, a inércia do pensamento já me levou ao conhecido mercado on-line chinês para escolher um conversor CC / CA adequado. E, no processo de estudar as características, o termo “onda senoidal modificada”, que foi esquecida, surgiu primeiro e depois o senso comum começou a levantar questões desconfortáveis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A essência das perguntas foi a seguinte. Para cobrir todas as necessidades de energia do apartamento com uma bateria pequena, ainda não funcionará. Caldeiras, microondas, máquina de lavar, um poderoso computador de mesa ainda serão insuportáveis ​​em termos de energia. E a geladeira, o capô e até o ventilador banal não funcionarão adequadamente por causa dessa onda senoidal muito modificada. Obviamente, existem inversores com uma verdadeira onda senoidal, mas eles não são apenas mais caros, mas também menos eficientes. E a questão dos consumidores poderosos ainda não está resolvida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quais consumidores permanecem dentro do orçamento? Não existem muitos deles: eletrônicos de consumo, como laptops e telefones / tablets, um roteador, um servidor ARM, o clima é uma TV e, é claro, a iluminação. Além disso, a mensagem inicial do artigo (e minha motivação pessoal) é precisamente garantir o funcionamento da estação de trabalho de backup na forma de um laptop e o mínimo de conforto doméstico, como luz no banheiro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quase todos esses dispositivos exigem uma tensão constante de 5 a 21 V para sua operação e não há necessidade objetiva de aumentar primeiro a tensão da bateria para 230 V CA, depois abaixá-la e endireitá-la novamente para mais ou menos o nível inicial. Nessas transformações, é fácil perder até 50% de energia, o que eu não sorri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo, foi assim que surgiu a ideia de usar uma rede de corrente contínua de baixa tensão como alternativa. </font><font style="vertical-align: inherit;">E após um cálculo aproximado das perdas nos fios, os 12 (13,8) V iniciais se transformaram em 24 (27,6) V. mais práticos</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No começo, eu queria tirar até 36 (41,4) B, mas depois de estudar as características de alguns componentes eletrônicos que planejava usar para trabalhar com toda essa economia, tive que moderar meu apetite.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, em uma fiação alternativa com uma seção transversal de 3,5 mm </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 de</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cobre puro, a tensão foi aplicada em última análise a partir de duas baterias de carro conectadas em série.</font></font><br>
<br>
<blockquote>,        .           (   )   .                ,      .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para permitir aos consumidores nos quartos, mais uma tomada foi adicionada a cada bloco “grande” de tomadas. E para que ninguém confundisse uma tomada comum com uma de reserva, os produtos do tipo "americano" com contatos planos de diferentes larguras foram instalados como o último. Isso, em primeiro lugar, não permitirá que o aspirador seja conectado à rede DC e, em segundo lugar, uma tomada diferente da européia, sempre usa a mesma polaridade ao usar o plugue “correto”.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/sm/th/blsmthnmtxqcekbdftv8dfg3u2a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para essas tomadas, foram feitos adaptadores para laptop, diminuindo a tensão para os 18-20 V desejados e equipados com os conectores correspondentes. </font><font style="vertical-align: inherit;">É claro que os saltos foram feitos com as habituais cargas USB de cinco volts para cada pequena coisa. </font><font style="vertical-align: inherit;">Bem, apenas no caso, um par de pequenos conversores de 24/230 V foi comprado, com uma potência de 50 e 200 watts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Casos para carregar com um plugue americano, os mesmos cabos de alimentação e placas prontas de conversores de pulso foram encomendados da China. </font><font style="vertical-align: inherit;">Um ferro de solda era necessário apenas para conectar os fios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não falarei sobre a usina neste artigo, especialmente porque não há nada de interessante, então irei direto a um dos problemas "inferiores", a saber, a questão da utilização da energia acumulada pela bateria para fins de iluminação.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iluminação</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, ao conectar o apartamento em paralelo à fiação principal, foram desenhados fios de uma rede CC alternativa com tensão de 24 (27,6) V. Entre outras coisas, um laço consistindo em um par desses fios foi enrolado em cada caixa de comutação e, em seguida, juntamente com os fios da rede de 230 V levou às luzes do teto (se houvesse várias na sala, o fio alternativo levaria a apenas uma).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que fazer com a saída da rede DC no campo da lâmpada é uma questão de abordagem individual. Como fonte de luz, uma faixa regular de LED de 24 volts foi escolhida. Seus segmentos de diferentes comprimentos (na proporção da área da sala), dependendo do design dos acessórios, eram montados diretamente em suas caixas ou colados nas superfícies das quais brilhava bem e de onde não seria muito impressionante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De qualquer forma, isso é um problema mais estético do que técnico, e agora é outra coisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, na caixa de cada comutador, tenho um loop de um fio de fase de uma rede de 230 V para ligar a luz "comum" e um loop de ambos os fios de uma rede DC para iluminação de emergência. Disto e dance.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, o desafio diante de mim era criar um determinado dispositivo que pudesse separar três estados um do outro:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rede elétrica OK → apague as luzes de emergência.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A rede CA está desenergizada, os contatos do interruptor estão fechados → acenda a luz de emergência. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A rede CA está desenergizada, os contatos do interruptor estão abertos → apague a luz de emergência.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consideramos que as ações são unilaterais, ou seja, desligar a iluminação já desligada não muda nada. </font><font style="vertical-align: inherit;">Esses estados podem ser diferenciados entre si se as tarefas de determinar a operação da rede CA e a posição dos contatos do comutador forem resolvidas. </font><font style="vertical-align: inherit;">Ao mesmo tempo, tive as seguintes condições iniciais:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O gerenciamento da iluminação principal e da iluminação de emergência deve ser completamente transparente a partir de um órgão diretivo, sem “fazenda coletiva” dos botões adicionais.</font></font></li>
<li> ,  ,   ,        .</li>
<li>      ,        .</li>
<li>      –    ,  .</li>
<li>-        .</li>
<li>        (    ),  .</li>
<li>      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, a ausência de rede elétrica CA nas caixas zero acabou sendo um erro de cálculo muito complicado do projeto. </font><font style="vertical-align: inherit;">Sem ele, a determinação da presença de tensão na entrada do comutador se torna impossível. </font><font style="vertical-align: inherit;">Tecnicamente, seria possível usar o fio negativo de uma rede de corrente contínua como zero, mas isso contradiz o parágrafo 5 completamente indestrutível dos meus termos de referência.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, existe uma alternativa para medir a tensão da rede. Não é necessário determinar a presença de tensão, basta determinar a presença de corrente no fio da fase com os contatos do interruptor fechados. Afinal, se houver corrente, haverá tensão. Além disso, a “leitura” exata da corrente permite que a iluminação de emergência seja ativada não apenas no caso de falta de energia, mas também no caso de queima de lâmpadas banais. Este método não permite determinar o estado da rede CA quando o comutador está desligado, mas esse estado não me incomoda, porque Quando o interruptor é desligado, a iluminação de emergência também não deve funcionar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Determinar a presença de corrente no fio é bastante simples, especialmente se essa corrente estiver alternada. </font><font style="vertical-align: inherit;">Aqui você pode aplicar, por exemplo, um sensor Hall que detecta o campo magnético ao redor do fio. </font><font style="vertical-align: inherit;">Mas você pode conviver com um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transformador de corrente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comum </font><font style="vertical-align: inherit;">, que consiste em um circuito magnético de anel com um enrolamento. </font><font style="vertical-align: inherit;">Um fio de corrente alternada é passado através do anel, o que cria um campo magnético no circuito magnético. </font><font style="vertical-align: inherit;">Este campo, por sua vez, induz uma corrente secundária no enrolamento, proporcional à corrente primária no fio. </font><font style="vertical-align: inherit;">Assim, este dispositivo simples permite medir a força da corrente alternada em qualquer fio, sem quebrá-lo e geralmente sem nenhuma conexão galvânica com o circuito primário.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O trabalho das pinças de corrente, uma ferramenta muito útil para qualquer eletricista, baseia-se no mesmo princípio.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se houver um transformador próximo ao comutador, basta medir a tensão em seu enrolamento secundário para descobrir se alguma corrente está fluindo no circuito da lâmpada. A presença de corrente, como eu disse, em uma primeira aproximação indica dois fatos: existe uma tensão na rede 230 V e o comutador está fechado. O primeiro desses fatos é essencial para a operação do dispositivo de ativação da iluminação de emergência. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo "parâmetro de entrada" do meu futuro dispositivo deve ser a posição dos contatos do comutador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O “brainstorming” iniciado entre colegas de hobby trouxe várias opções para determinar a posição do comutador, que se resumia principalmente à modificação do design, a fim de adicionar outro par de contatos a ele. Aqui o escopo da imaginação é bastante amplo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Era possível pegar um duplo em vez de um único interruptor e "paralelizar" mecanicamente suas metades para que elas se tornassem um todo. Essa opção não diferia na estética externa e não solucionava o problema naquelas salas em que a iluminação era de circuito duplo e o interruptor era duplo inicialmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outras opções envolviam a introdução de um microinterruptor ou um interruptor reed com um ímã no mecanismo do comutador. Mas, depois de estudar os projetos dos disjuntores aplicados, essas opções também desapareceram. A base de cerâmica monolítica de um bom comutador simplesmente não deixa chance, mesmo para um microinterruptor compacto, e o ímã e a palheta não funcionavam devido ao toque muito pequeno da tecla e à histerese na curva de operação / liberação do comutador de palheta.</font></font><br>
<br>
<blockquote> «»        ,     . , ,       ,  .  ,   ,    ,               .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo, era necessário criar um método que não exigisse modificação do comutador. E este método foi encontrado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descrevi acima um transformador de corrente, que permite determinar a presença de corrente alternada em um fio sem ruptura e contato galvânico. Mas qualquer transformador é um dispositivo bidirecional (em contraste com o mesmo sensor Hall), seus enrolamentos primário e secundário são intercambiáveis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se aplicarmos corrente alternada ao enrolamento secundário de um transformador, ele induzirá tensão nas extremidades do fio rosqueado no anel. E, o mais importante, a energia consumida pelo enrolamento da fonte dependerá de a corrente secundária no fio encontrar seu caminho para o movimento circular.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui fica mais interessante. </font><font style="vertical-align: inherit;">Um fio passa através do anel, que é imediatamente, em alguns centímetros, conectado a um dos contatos do comutador. </font><font style="vertical-align: inherit;">Resta apenas fornecer a essa corrente um caminho de retorno do outro lado do comutador para obter um dispositivo para "detectar" a posição dos contatos. </font><font style="vertical-align: inherit;">E pela razão de que essa corrente é alternada, um capacitor convencional pode se tornar uma ponte para ela.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gs/tr/g1/gstrg12mwdwhgu0qmbnl3twrfjc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em princípio, para fechar este circuito sob certas condições, um capacitor não é necessário. </font><font style="vertical-align: inherit;">Se uma corrente de frequência suficientemente alta for "bombeada" para o transformador, a capacitância perdida entre os fios será suficiente para passar.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/up/yp/ws/upypwscprb9xjbrlaye26xfkry8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, o que é necessário para organizar esse detector:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transformador de corrente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medidor de tensão de saída do transformador.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte de corrente alternada de alta frequência.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medidor de corrente que flui através do enrolamento de um transformador invertido.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais difícil em termos de seleção dos parâmetros ideais é um transformador, que no modo transformador de corrente deve fornecer uma tensão aceitável com uma frequência de 50 Hz e, no modo ativo de "detecção" do estado do disjuntor, ter um coeficiente de transmissão aceitável a uma frequência de centenas de KHz. </font><font style="vertical-align: inherit;">Não é possível simular esse elemento em um programa de modelagem de circuitos eletrônicos, e mesmo com o cálculo matemático tudo se tornou muito difícil. </font><font style="vertical-align: inherit;">Eu tive que pegar um ferro de soldar nas mãos e passar horas dirigindo várias opções em busca dos melhores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O número de voltas e a resistência ideal à carga foram selecionados empiricamente e não o fato de eu não ter perdido a melhor relação. </font><font style="vertical-align: inherit;">Como resultado das experiências, a seguinte construção apareceu:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Núcleo de ferrite com uma permeabilidade de 10.000, tamanho 10x6x4 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enrolamento 30 voltas com fio esmaltado de 0,25 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A carga ativa do enrolamento é de 1 kOhm.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A permeabilidade magnética é bastante grande, provavelmente, faria sentido usar um anel para 5000 ou até 2000 unidades, mas em quantidades suficientes eu tinha esses anéis. </font><font style="vertical-align: inherit;">Em geral, a permeabilidade nesse caso é um valor de compromisso. </font><font style="vertical-align: inherit;">Muito baixo torna o transformador inadequado para operação a uma frequência de 50 Hz e muito alto estraga tudo em frequências acima de centenas de quilohertz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vários experimentos confirmaram a realidade da ideia e os seguintes resultados foram obtidos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No modo de transformador de corrente, o coeficiente de transmissão acabou por ser de cerca de um milivolt por watt de potência de fluxo (tensão 220-230 V).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No modo apalpador, dependendo da frequência e capacitância do vazamento, a diferença de corrente nos contatos fechados e abertos do comutador alcançou duas a três vezes.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso é tudo. </font><font style="vertical-align: inherit;">Ambos os valores são mais que suficientes para uma fixação confiável da corrente de fluxo e para determinar a posição dos contatos do interruptor. </font><font style="vertical-align: inherit;">Depende apenas da implementação específica.</font></font><br>
<br>
<a name="Solution"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em ferro</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao contrário da maioria de seus outros projetos, aqui já nos estágios iniciais da deliberação, foi decidido usar imediatamente o microcontrolador. </font><font style="vertical-align: inherit;">Com base nas necessidades e na experiência, a escolha recaiu sobre o ATtiny13A. </font><font style="vertical-align: inherit;">Este chip possui um ADC e pode usar uma fonte de referência interna de 1,1 V em vez da tensão de alimentação. </font><font style="vertical-align: inherit;">Existe um PWM ótimo para gerar um sinal sonoro. </font><font style="vertical-align: inherit;">E, que mais tarde se mostrou importante, existe uma EEPROM que permite armazenar dados de calibração.</font></font><br>
<br>
<blockquote>,          «  ,       ,       - «» ,  ».<br>
<br>
      .         .           .   ,   ,  ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui você precisa combinar pelo menos um gerador, um medidor de tensão e algum tipo de gatilho para armazenar o estado atual entre as medições. Em geral, qualquer esboço especulativo exigia pelo menos três casos apenas no "núcleo", e o controlador era muito mais prático. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tensão do transformador de corrente com uma carga de 10 a 20 W é de 10 a 20 mV e é muito pequena para fornecê-la à entrada DAC com um limite de 1,1 V. Portanto, além do controlador, você também precisa de um amplificador com um coeficiente de transferência de cerca de 100 para aumentar a tensão de sinal mínima. até centenas de milivolts.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, a tensão do sinal de saída de um transformador de corrente depende não apenas da potência da carga, mas também de sua natureza. </font><font style="vertical-align: inherit;">Uma carga puramente ativa, como a lâmpada de Ilyich, por exemplo, produz uma onda senoidal de nível de milivolt. </font><font style="vertical-align: inherit;">Uma lâmpada LED da mesma potência, com uma simples pulsação, produz rajadas curtas a volts e acima. </font><font style="vertical-align: inherit;">Poderíamos brincar disso, mas, primeiro, eu queria fazer um dispositivo universal e, em segundo lugar, no apartamento havia uma lâmpada com uma fonte de alimentação externa equipada com um circuito PFC (ou seja, com uma característica de consumo próxima a ativa).</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não atormentarei o leitor com opções intermediárias e darei imediatamente o diagrama final do dispositivo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/at/a-/vdata-spt78rd_pzv7s5awoobya.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, a tensão CC através do regulador linear econômico LM2931-5.0 alimenta o controlador. Em termos de alojamento, funcionalidade e pinagem, esse estabilizador é semelhante ao popular 78L05, mas difere dele em menor consumo intrínseco (cerca de 500 μA a uma carga de 10 mA) e maior tolerância a rajadas curtas de tensão de entrada. Se você planeja trabalhar com uma tensão não superior a 20 V, pode usar um análogo ainda mais econômico do LP2950-5.0.</font></font><br>
<br>
<blockquote>   LP2950-5.0        30 .      24      .    -      ,     ,       ,     ,   .          50%,   100%.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O transformador não é mostrado no diagrama, mas seu enrolamento está conectado aos pinos TR1 e TR2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como elemento chave para alternar a carga, é usado um transistor MOS de canal P de baixa corrente 2SJ196 (uma corrente de até 1 A deve ser suficiente para qualquer lâmpada de LED), mas qualquer outro adequado para a pinagem, a corrente máxima e a tensão de drenagem máxima podem ser usadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além do controlador e da chave dos elementos ativos, dois transistores são usados. Um é necessário para controlar o obturador da chave, operando sob a tensão da fonte de emergência. O segundo atua como um sinal de amplificador da saída do transformador de corrente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse ponto, você poderia usar amplificadores operacionais, mas em termos de detalhes o ganho era mínimo e você teria que esquecer de trabalhar em frequências acima de várias centenas de quilohertz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não é o sinal amplificado do próprio transformador que é alimentado ao ADC, mas seu envelope, que pode ser medido por uma única amostra e não por "streaming" da digitalização por algum tempo. Para isolar o envelope, são utilizados dois diodos Schottky, conectados de acordo com o circuito de duplicação de tensão. Essa inclusão forma um detector de amplitude clássico, no qual a queda de tensão nos próprios diodos é amplamente compensada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O princípio de operação do sensor é simples. Primeiro, considere o algoritmo de ações necessárias para medir a corrente no fio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No modo de medição atual, o pino PB0 é colocado no modo de saída e é aterrado por um zero lógico. Isso evita que quaisquer sinais do controlador sejam enviados para o ponto TR1. Em paralelo, as mesmas ações são realizadas no pino PB3, como resultado do qual a saída superior do capacitor C2 é aterrada. Esse capacitor, juntamente com o resistor R1, cria um filtro passa-baixo com uma frequência de corte de cerca de 1500 Hz. Graças a esse filtro, o papel de vários ruídos de alta frequência na formação do sinal medido é bastante reduzido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, um nível alto é aplicado ao PB4 para alimentar o amplificador de sinal. Após a conclusão dos transientes, uma corrente de 50 Hz da saída do transformador é amplificada e chega ao retificador, onde carrega o capacitor C8.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A carga do capacitor C8 é medida usando ADC1 e, a partir do valor de tensão obtido, é tirada uma conclusão sobre a corrente “primária” que flui através do transformador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A detecção ativa é realizada de maneira diferente. Primeiro, o pino PB0 é convertido em um solucionador de PWM e um sinal é alimentado com uma frequência de centenas de quilohertz para unidades de megahertz. Este sinal é um pouco atenuado por um divisor resistivo e alimentado ao enrolamento do transformador de corrente no ponto TR1. O capacitor C1, junto com um braço do divisor R4, cria um filtro passa-baixo com uma frequência de corte de cerca de 1,5 MHz, o que reduz o nível de harmônicos de alta frequência de pulsos retangulares.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de passar pelo enrolamento do transformador, o sinal da sonda do ponto TR2 chega ao mesmo amplificador e detector, da mesma forma, no final, carrega o capacitor C8 a uma tensão proporcional à carga no circuito "externo" do transformador. Da mesma forma, a carga do capacitor é medida usando o ADC do microcontrolador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora explicações para alguns "soltos". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O resistor R5 é projetado para limitar a tensão no portão do interruptor de energia, que para MOSFETs de baixa tensão geralmente não deve exceder 20 V. No meu caso, a rede DC tem uma tensão de até 30 V, o que determinou a necessidade de um divisor 1: 3, obtido em conjunto com R3. Quando alimentado por uma fonte inferior a 20 V, o resistor R5 não é necessário (substituído por um jumper).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os capacitores C4 e C5 são conectados em paralelo para obter uma capacitância de 2 μF. Este par de capacitores é digno de nota, pois deve transmitir igualmente bem os sinais das frequências baixa e alta. Aqui seria possível usar uma conexão paralela de um capacitor eletrolítico de várias microfarads e uma cerâmica de cem ou duas nanofarads, mas um "eletrólito" de capacidade tão pequena não gera ganho de tamanho quando comparado com a "cerâmica" de microfarads. É verdade que não era possível comprar um capacitor de cerâmica em duas microfarads, então coloquei duas da mesma.</font></font><br>
<br>
<blockquote>,   50     2  ,      .   ,        .               .    100   , ,   .       .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os resistores R4 e R1 formam uma divisão de tensão, que iguala mais ou menos a tensão alternada de cinco volts na saída PWM com a tensão de saída do transformador de corrente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O capacitor C8, como mencionado anteriormente, acumula a tensão a ser medida. É melhor se for um capacitor de alta qualidade com uma corrente de fuga mínima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menção especial merece o “pente” TP1 / TP2 de dois pinos conectado à perna de reset do microcontrolador. Esses contatos são usados ​​não apenas para reiniciar, mas para entrar no modo de calibração, descrito abaixo. Simplesmente, após a implementação de toda a lista de desejos, o controlador não tinha mais pinos livres e a necessidade de adicionar um controle simples apareceu durante a depuração do firmware. Então eu tive que usar o pé de reset do controlador para esse fim.</font></font><br>
<br>
<blockquote> «»  AVR     RESET       GPIO.         ,       .         ,        .   ,        ,      ,      ,            RESET.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, o circuito acabou sendo bastante simples e toda a "mágica" é implementada no firmware do microcontrolador. No entanto, após a fabricação do protótipo, descobriu-se que a capacitância da fiação para operação confiável da "sonda" geralmente não é suficiente. A diferença de corrente através do transformador simplesmente se compara ao nível de interferência e a operação do circuito se torna não confiável. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, tive que abandonar o anel de ferrite pendurado livremente nos fios e adicionar um circuito de alta tensão diretamente à placa em uma nova revisão do dispositivo, a fim de facilitar a tarefa de sondagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O objetivo aqui é adicionar um capacitor dedicado, ativado para que o caminho mais curto para fechar o caminho para a corrente de RF através dos contatos do comutador.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i-/_f/63/i-_f636miltufzwifkx4xaxnab0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O capacitor C10 deve ser projetado para uma tensão de pelo menos kilovolts, e sua capacitância deve ser escolhida de acordo com um princípio de compromisso, para que a confiabilidade da operação seja suficiente para uso prático e que a corrente capacitiva perdida através da lâmpada não seja muito grande. </font><font style="vertical-align: inherit;">Na prática, você pode tentar "brincar" com essa denominação, se necessário.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De qualquer forma, um interruptor equipado com esse sensor não pode mais ser percebido como ideal. </font><font style="vertical-align: inherit;">Pelo contrário, é semelhante a um interruptor com um indicador; portanto, em primeiro lugar, pode causar luz dispersa ou tremulação de lâmpadas LED de baixa qualidade e, em segundo lugar, pode causar um choque elétrico, embora não seja forte. </font><font style="vertical-align: inherit;">Portanto, você nunca precisa trabalhar com a fiação de iluminação, contando apenas com o interruptor na parede, sempre desligue o “interruptor” na entrada.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, como eu ainda tinha que adicionar parte da rede CA à placa, adicionei dois bloqueadores de fechamento lá, o que não permitirá que a corrente de sondagem de alta frequência passe para a fiação. O valor prático da frequência da tensão de sondagem pode atingir vários MHz e eu, como radioamador, estou muito cansado da ideia de aumentar a quantidade de interferência na rede com minhas próprias mãos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As bobinas L1 e L2 devem ser energizadas, enroladas com um fio de espessura perceptível nos núcleos do tipo haltere ou anel. Os choques de sinal no projeto axial do "resistor" não podem ser usados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A volta principal do transformador de corrente agora é um pedaço de fio rosqueado através do anel e soldado aos pontos TR3 e TR4 na placa. É melhor se esse fio estiver blindado enquanto conecta a tela ao TR5 e TR6 nos dois lados do anel.</font></font><br>
<br>
<blockquote> TR6       ,   .    -   ,           .          ,          .</blockquote><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O código do firmware e o arquivo HEX montado são anexados no final do artigo, juntamente com o circuito e o layout da placa de circuito impresso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O algoritmo do detector sintonizado é simples. A cada três segundos, o controlador acorda do sono profundo, faz medições e, se necessário, altera o estado da tecla de controle em uma direção ou outra. Assim, a reação a uma mudança na posição do comutador pode ter um atraso de até três segundos. Não é muito conveniente, mas isso é feito, em primeiro lugar, para economizar energia da fonte de backup e, em segundo lugar, para reduzir significativamente o intervalo de pesquisa, não permite a duração dos transientes em diferentes estágios de medição. O intervalo mínimo pode ser considerado igual a um segundo, mas o circuito estará no modo de consumo ativo quase o tempo todo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, em conclusão, sobre a configuração. Devido ao fato de que diferentes sensores precisam trabalhar em condições completamente diferentes, de acordo com a corrente consumida pela lâmpada, o comprimento e outras características da fiação, o nível de interferência e similares, era impossível colocar um conjunto universal de parâmetros adaptativos no firmware. Portanto, cada sensor após a instalação requer uma única calibração no local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sensor entra no modo de calibração cada vez que é ligado, enquanto não há dados de calibração ou após o fechamento dos contatos TP1 e TP2. A entrada do primeiro estágio da calibração é indicada por uma lâmpada de emergência que pisca cinco vezes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de piscar cinco vezes, são dados 7,5 segundos para colocar o interruptor na posição “desligado”, se já tiver sido ligado antes. Após esse período, o nível de interferência sempre presente na rede CA é medido. O valor obtido é usado como ponto de partida para medições no ciclo de serviço. Também neste momento, o disjuntor é detectado em diferentes frequências para a seleção subsequente da frequência mais "contrastada".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, o segundo estágio de calibração começa e a lâmpada de emergência pisca duas vezes. São necessários 7,5 segundos para colocar o interruptor na posição "ligado" e, após o tempo limite, o programa mede a corrente consumida pela lâmpada. Se a lâmpada tiver vários níveis de brilho, depois de ligar, você deve imediatamente mudá-la para um mínimo, para que no futuro o sensor funcione corretamente com qualquer um dos níveis disponíveis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O início do terceiro e último estágio de calibração é marcado por três vezes piscando a luz de emergência e requer que o interruptor permaneça no modo “ligado” e a rede de iluminação seja desenergizada em um nível mais alto (ou seja, com o disjuntor principal ou secundário no painel) o mais tardar pelos mesmos 7,5 segundos Nesse caso, é realizada uma segunda sonda do disjuntor já ativada em diferentes frequências e, levando em consideração os valores obtidos no primeiro estágio, a frequência é selecionada na qual a diferença de corrente através do interruptor ligado e desligado é máxima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A conclusão bem-sucedida da calibração é indicada por um único piscar da lâmpada de emergência e, se a rede de iluminação após o terceiro estágio ainda estiver desenergizada, ligando a iluminação de emergência no próximo ciclo de operação de votação.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se os valores medidos de correntes e resistências em diferentes condições estiverem muito próximos e não puderem ser usados ​​para uma detecção confiável, a calibração falhará. </font><font style="vertical-align: inherit;">Nesse caso, a lâmpada de iluminação de emergência pisca duas vezes quando a posição do interruptor não é bem-sucedida ou três vezes quando o consumo padrão da lâmpada de iluminação é muito baixo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso de falta de vontade persistente do sensor em calibrar com um piscar duplo no final, tente aumentar a capacidade do C10.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dispositivo acabou sendo bastante simples, compacto o suficiente para caber em uma caixa de comutação, mas sem dizer que é muito fácil de configurar. </font><font style="vertical-align: inherit;">Obviamente, ele não se baseia no componente de uma "casa inteligente" moderna, porque não possui 5G, controle de nuvem e até WiFi WiFi banal com GPS não é fornecido. </font><font style="vertical-align: inherit;">No entanto, oito desses dispositivos desempenham sua única função e nada mais é necessário em condições de blecaute.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código fonte do firmware (Atmel Studio 7)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 9600000 <span class="hljs-comment">//   (  : avrdude.exe -U lfuse:w:0x7a:m -U hfuse:w:0xff:m)</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/io.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/wdt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/sleep.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/interrupt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;util/delay.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/eeprom.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//#define PROTEUS</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">bool</span>; <span class="hljs-comment">//   </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> true  (0 == 0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> false (0 != 0)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_U10BIT 0b0000001111111111 <span class="hljs-comment">//      </span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTERVAL         3   <span class="hljs-comment">//  , </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUR_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RES_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_DIV_OFFSET  2   <span class="hljs-comment">//     </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_MAXIMAL_DIV 6   <span class="hljs-comment">//     </span></span><font></font>
<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_cur_edge;<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_res_edge; <font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> EEPROM_frequency_dividor;<font></font>
<font></font>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_edge, res_edge; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> frequency_dividor; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> clk = <span class="hljs-number">0</span>; <span class="hljs-comment">//   watchdog</span>
<span class="hljs-keyword">bool</span> tp_reset = <span class="hljs-literal">false</span>; <span class="hljs-comment">//   TP1  TP2</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_vars</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">if</span>(MCUSR &amp; (<span class="hljs-number">1</span> &lt;&lt; EXTRF)) { <span class="hljs-comment">// ,       TP1  TP2</span>
    tp_reset = <span class="hljs-literal">true</span>;<font></font>
    MCUSR &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; EXTRF); <span class="hljs-comment">//  EXTRF       ,   </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_pins</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB0) | (<span class="hljs-number">1</span> &lt;&lt; PB1) | (<span class="hljs-number">1</span> &lt;&lt; PB2) | (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//       </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    watchdog</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_interrupts</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  sleep_enable(); <span class="hljs-comment">//   </span><font></font>
<font></font>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDCE) | (<span class="hljs-number">1</span> &lt;&lt; WDE); <span class="hljs-comment">//  watchdog</span>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDTIE) | WDTO_1S; <span class="hljs-comment">// watchdog      ,  1 </span><font></font>
<font></font>
  sei(); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_settings</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  cur_edge = eeprom_read_word(&amp;EEPROM_cur_edge); <span class="hljs-comment">//   </span>
  res_edge = eeprom_read_word(&amp;EEPROM_res_edge); <span class="hljs-comment">//   </span>
  frequency_dividor = eeprom_read_byte(&amp;EEPROM_frequency_dividor); <span class="hljs-comment">//   </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_load</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">blink_load</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> count)</span> </span>{
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i = <span class="hljs-number">0</span>; i &lt; count; ++i) {<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">true</span>);<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">false</span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   (   )</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) sleep_cpu();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_amp</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//     PB4</span>
    _delay_ms(<span class="hljs-number">250</span>);      <span class="hljs-comment">//       200 .</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB4);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_lpf</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    (  "0")     C2</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    ( )   C2  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_gen</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    TCCR0A |= (<span class="hljs-number">1</span> &lt;&lt; COM0A0) | (<span class="hljs-number">1</span> &lt;&lt; WGM01); <span class="hljs-comment">//    ( )    OC0A      OCR0A</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> PROTEUS</span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00); <span class="hljs-comment">//    1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00) | (<span class="hljs-number">1</span> &lt;&lt; CS02); <span class="hljs-comment">//    1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
    OCR0A = FREQ_DIV_OFFSET + frequency_dividor; <span class="hljs-comment">//   ,         OC0A</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    TCCR0A = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_adc</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    ( )</span>
    ADMUX = <span class="hljs-number">0b01</span> | (<span class="hljs-number">1</span> &lt;&lt; REFS0); <span class="hljs-comment">// PB2, 1.1v reference</span>
    ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADPS0) | (<span class="hljs-number">1</span> &lt;&lt; ADPS1) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2) | <span class="hljs-comment">//       = 128 (75 )</span>
             (<span class="hljs-number">1</span> &lt;&lt; ADIE) |  <span class="hljs-comment">//    </span>
             (<span class="hljs-number">1</span> &lt;&lt; ADEN);   <span class="hljs-comment">//  </span>
  } <span class="hljs-keyword">else</span> {<font></font>
    ADCSRA = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    (  "0")   C8</span>
    _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//      C8</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">do_adc</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_ADC); <span class="hljs-comment">//   "" </span>
  <span class="hljs-keyword">do</span> {<font></font>
    sleep_cpu(); <span class="hljs-comment">//      ,      ,   </span>
  } <span class="hljs-keyword">while</span>(ADCSRA &amp; (<span class="hljs-number">1</span> &lt;&lt; ADSC)); <span class="hljs-comment">//        ,  </span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> ADC;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
//  
static void blink_bin(unsigned int value, unsigned char count) {
  for(unsigned char i = 0; i &lt; count; ++i) {
    _delay_ms(1000);
    toggle_load(true);
    if(value &amp; (1 &lt;&lt; (count - i - 1))) {
      _delay_ms(500);
    } else {
      _delay_ms(50);
    }
    toggle_load(false);
  }
}
*/</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur;<font></font>
<font></font>
  toggle_lpf(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  cur = do_adc(); <span class="hljs-comment">//  </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
  toggle_lpf(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> cur;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_resistance</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> res;<font></font>
<font></font>
  toggle_gen(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  toggle_gen(<span class="hljs-literal">false</span>); <span class="hljs-comment">//   ,   C8     </span>
  res = do_adc(); <span class="hljs-comment">//     </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> MAX_U10BIT - res; <span class="hljs-comment">//      ,      </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_current() &gt;= cur_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_toggled_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_resistance() &lt;= res_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">do_main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is_current()) {<font></font>
    toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span>(is_toggled_on()) {<font></font>
      toggle_load(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  ,  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span><font></font>
    }<font></font>
  }<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">first_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (frequency_dividor == <span class="hljs-number">0xff</span>); <span class="hljs-comment">//   EEPROM   0xFF,        FREQ_MAXIMAL_DIV</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">calibrate</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_off, cur_on, res_off, res_on, res_on_tmp, res_off_array[FREQ_MAXIMAL_DIV + <span class="hljs-number">1</span>], diff, max_diff, frequency_dividor_tmp;<font></font>
<font></font>
  blink_load(<span class="hljs-number">5</span>); <span class="hljs-comment">//    ,    </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  cur_off = get_current(); <span class="hljs-comment">//      ( )</span><font></font>
<font></font>
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_off_array[frequency_dividor] = get_resistance();<font></font>
  }<font></font>
<font></font>
  blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  cur_on = get_current(); <span class="hljs-comment">//     </span><font></font>
<font></font>
  blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  <font></font>
  res_off = MAX_U10BIT;<font></font>
  res_on = MAX_U10BIT;<font></font>
  frequency_dividor_tmp = <span class="hljs-number">0</span>;<font></font>
  max_diff = <span class="hljs-number">0</span>;
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_on_tmp = get_resistance();<font></font>
<font></font>
    <span class="hljs-comment">//   ,      </span>
    <span class="hljs-keyword">if</span>(res_off_array[frequency_dividor] &gt; res_on_tmp) {<font></font>
      diff = res_off_array[frequency_dividor] - res_on_tmp;<font></font>
      <span class="hljs-keyword">if</span>(diff &gt; max_diff) {<font></font>
        res_off = res_off_array[frequency_dividor];<font></font>
        res_on = res_on_tmp;<font></font>
        frequency_dividor_tmp = frequency_dividor;<font></font>
        max_diff = diff;<font></font>
      }    <font></font>
    }<font></font>
  }<font></font>
  frequency_dividor = frequency_dividor_tmp;<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(cur_on &gt; cur_off + CUR_MINIMAL_DIFF) { <font></font>
    cur_edge = cur_off + (cur_on - cur_off) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,     </span><font></font>
 <font></font>
    <span class="hljs-keyword">if</span>(res_on + RES_MINIMAL_DIFF &lt; res_off) {<font></font>
      res_edge = res_off - (res_off - res_on) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,      </span><font></font>
<font></font>
      <span class="hljs-comment">//   </span><font></font>
      eeprom_write_word(&amp;EEPROM_cur_edge, cur_edge);<font></font>
      eeprom_write_word(&amp;EEPROM_res_edge, res_edge);<font></font>
      eeprom_write_byte(&amp;EEPROM_frequency_dividor, frequency_dividor);<font></font>
      <font></font>
      blink_load(<span class="hljs-number">1</span>); <span class="hljs-comment">//  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
  }<font></font>
}<font></font>
<font></font>
ISR(WDT_vect) {<font></font>
  WDTCR |= (<span class="hljs-number">1</span> &lt;&lt; WDTIE); <span class="hljs-comment">//    watchdog   ""    </span><font></font>
}<font></font>
<font></font>
EMPTY_INTERRUPT(ADC_vect); <span class="hljs-comment">//     ,     </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  init_vars();<font></font>
  init_pins();       <font></font>
  init_interrupts(); <font></font>
  init_settings();<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(tp_reset || first_on()) {<font></font>
    calibrate(); <span class="hljs-comment">//          </span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {<font></font>
    set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
    sleep_cpu(); <span class="hljs-comment">//   watchdog</span><font></font>
<font></font>
    <span class="hljs-keyword">if</span>(++clk &gt;= INTERVAL) {<font></font>
      do_main(); <span class="hljs-comment">//  </span>
      clk = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquive com diagrama, fiação e o projeto completo do Atmel Studio 7</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt492788/index.html">Cansado, mas: a Alemanha parou completamente a primeira onda de COVID-19</a></li>
<li><a href="../pt492798/index.html">As pessoas foram conversar na Internet, mas agora novamente sonham com o modo offline. O que está acontecendo?</a></li>
<li><a href="../pt492800/index.html">Fornecedor de IoT GSM em habitação e serviços públicos (parte 1)</a></li>
<li><a href="../pt492804/index.html">Sobre a questão da replicação da atividade social na Internet como chave para minimizar o aumento da incidência durante uma pandemia</a></li>
<li><a href="../pt492806/index.html">Como vincular o engajamento à monetização em jogos e aplicativos para celular</a></li>
<li><a href="../pt492810/index.html">[COVID-19] Sua tarefa é suavizar o pico</a></li>
<li><a href="../pt492812/index.html">Tentando executar redes GAN no OpenVINO</a></li>
<li><a href="../pt492816/index.html">Dicas e truques do IntelliJ IDEA: 4. Sincronize e compartilhe configurações</a></li>
<li><a href="../pt492820/index.html">.Net Core Api: obtendo dados em uma solicitação de diferentes fontes</a></li>
<li><a href="../pt492822/index.html">Desenvolvedores de CSS - por que o mundo precisa deles?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>