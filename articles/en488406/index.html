<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤶🏽 👐 👝 IPv6 - you are doing it wrong 🧑🏻‍🤝‍🧑🏻 🈳 🔟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are a lot of misconceptions and myths around IPv6. Often, hosting providers misunderstand how to use it and think outdated approaches from the w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IPv6 - you are doing it wrong</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/488406/"><img src="https://habrastorage.org/webt/gg/-1/kx/gg-1kxivqjrehg1_oidyoqkphos.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are a lot of misconceptions and myths around IPv6. Often, hosting providers misunderstand how to use it and think outdated approaches from the world of IPv4. For example, having octillions of IPv6 addresses, the hoster sells addresses to clients individually, instead of allocating a full-fledged network / 64, as follows from the recommendations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It happens that hosters assign IPv6 addresses to different clients within the same / 64 network. At the same time, large services, such as Google, perceive all addresses within the / 64 range as one client. As a result, customers may suffer due to the activities of a bandmate.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The availability of IPv6 addresses allows you to assign full external addresses to internal resources, such as containers or VPN clients. </font><font style="vertical-align: inherit;">To do this, the host must provide the client with a separate routed network. </font><font style="vertical-align: inherit;">Unfortunately, almost no one can do this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, we will analyze the main errors in the use of IPv6 providers.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Storyline: RFC 3177</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 In 2001, the recommendations on the allocation of addresses recommended (sorry for the tautology, this is important) to highlight:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ 48 in general</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ 64 if behind it one and only one subnet</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ 128 if one and only one device</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The offensive document RFC 2119, which governs the application of various levels of compulsory compliance with instructions, defines “recommended” as follows: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The words “Should” or “Recommended” mean that there may be reasonable reasons in certain circumstances not to act in this way, however, the choice of a different line of behavior must be a balanced decision made with full understanding of the consequences. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhaps no one had a full understanding of the consequences at that time, maybe “certain circumstances” were not defined, but, one way or another, everyone followed the recommendations.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, at the time of writing the document, IPv6 traffic was extremely rare and was found, for the most part, in institutes and personal networks of curious enthusiasts. </font><font style="vertical-align: inherit;">Some real problems began to accumulate and analyze, but it took a lot of time. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rethinking began in 2005. </font><font style="vertical-align: inherit;">Finally, these recommendations were deprecated in 2011.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awareness of the problem: RFC 6177</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The new addressing policy explicitly states that / 48 is just a wish, not a requirement. No indication of specific numbers is given, however, it is indicated that / 64 or shorter works under normal conditions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main logic in recommending the size of the issuance of the block / 48 to the final consumer pursued three goals. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, the assigned address space should be sufficient for consumer purposes and easily extensible, without barbell squats. Yes, that's exactly what it says, only in the English version - jump through hoops. One of the important reasons for switching to IPv6 is to change the existing destination size from "single address" to "multiple subnets."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secondly, the change of provider should have been held with a minimum of problems. </font><font style="vertical-align: inherit;">If you can save the old subnet address scheme when moving to a new address space, then this will save a lot of work </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. Thirdly, the allocation of block / 48 should cover the increase in the needs of the address space of a developing consumer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although all these conditions were fulfilled, it became apparent that recommendation / 48 was, to put it mildly, redundant.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pin / 64 as units of issue</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the distribution order, there were other points. </font><font style="vertical-align: inherit;">It turned out that many features of IPv6 do not work if the network prefix is ​​not / 64. </font><font style="vertical-align: inherit;">Namely, they do not work:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neighbor Discovery (ND)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secure Neighborship Discovery (SEND)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some parts of Mobile IPv6</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site Multihoming by IPv6 Intermediation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">many different little things</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An additional factor was the fact that many of the technologies being designed relied precisely on such a network prefix. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not only the threat to break the newfound standard was the reason for writing new recommendations. </font><font style="vertical-align: inherit;">Two opinions of dubious validity were also very popular. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, many devices implement IPv6 routing programmatically, with crutches and bicycles, and therefore are not ready for a full transition to it. </font><font style="vertical-align: inherit;">A possible increase in the delay due to this can increase many times, if not an order of magnitude. </font><font style="vertical-align: inherit;">The default definition of the / 64 subnet would greatly reduce these delays. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Second, switching to a new standard is always a pain for tech support and system administrators. </font><font style="vertical-align: inherit;">A single / 64 prefix was supposed to reduce this pain to an acceptable value.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The situation on the fronts</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As already happened earlier back in 2001, recommendation / 64 is perceived by many large Internet players as a standard. On the one hand it’s good, on the other hand, not so good. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For many rating systems, for example, for spam recognition, all addresses from one block will be considered as belonging to one spammer. In theory, this should make life easier for the user, in fact, just the opposite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Often, providers do not bother with things like learning about common practices. Addresses can be issued according to any principle, at least even according to the horoscope. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several typical problems, and all of them stem from the violation of the recommendations by the provider on the one hand, and the strict adherence to them by some other organizations on the other.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Issuing addresses from one block to several users can lead to the fact that they will all be considered as one actual user, for example, machines in the organization’s network. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If several people from this block start looking for cats at the same time, Google may decide that this botnet will send requests for search scam or some other not very good things. From his point of view, this is all one user. The logical result is an increasingly complicated captcha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This, as you know, is the most harmless answer to a hypothetical scam.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The reverse situation is the issuance to one user of addresses from different blocks. </font><font style="vertical-align: inherit;">If users of these blocks fall into someone’s blacklist, then the addresses of an honest user will fall with them. </font><font style="vertical-align: inherit;">Particularly interesting story: some of your addresses were banned by one ad network, some were banned by another. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, other unpleasant surprises are possible. </font><font style="vertical-align: inherit;">For example, you received the / 64 block for your use, but this is a dynamic block, as a dynamic address - today 2001: DA8: 1D01: FA13 :: / 64, tomorrow 2001: DA8: 1D01: FC15 :: / 64. </font><font style="vertical-align: inherit;">New adventures every day! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a considerable chance to meet various combinations of these problems and other fancifully curved rakes in the appendage.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Issue IPv6 from our server</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we have a quintillion IP addresses, then why not give real IP addresses, for example, to VPN clients so that they go to the Internet without NAT and can accept incoming connections from the world. </font><font style="vertical-align: inherit;">It sounds great, but in practice it’s not so easy. </font><font style="vertical-align: inherit;">This will require a separate IPv6 network routed </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">through the</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> IP address assigned to the server interface. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose a server is assigned an address </font></font><code>2a01:baba::c0fee:dead/64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then VPN clients will need a separate network, such </font></font><code>2a01:baba:fafa:0f0f::/64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as routed through the address </font></font><code>2a01:baba::c0fee:dead/64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, very few hosting providers have the tools to issue such networks to clients, which is why you have to use crutches like </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ND Proxy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reading IETF recommendations is not the most interesting activity, but it is extremely useful. </font><font style="vertical-align: inherit;">Filling them with long winter evenings is clearly not worth it, but also neglecting to read sections that are important to you is also undesirable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When choosing a provider, make sure that he shares this point of view. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to understand that the wrong approach to the allocation of addresses does not harm the provider in any way, and under most contracts it cannot even be the basis for receiving compensation for damage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, this may turn out to be a key factor for you, although you yourself do not suspect it yet.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488386/index.html">Cases for applying network anomaly analysis tools: attacks through browser plug-ins</a></li>
<li><a href="../en488388/index.html">Relogin and HTTP Basic Auth</a></li>
<li><a href="../en488390/index.html">How to make Telegram bot friends with OpenId Connect</a></li>
<li><a href="../en488392/index.html">Production-ready images for k8s</a></li>
<li><a href="../en488404/index.html">Games worth waiting for in 2020</a></li>
<li><a href="../en488408/index.html">STM32 Ethernet-RS485 IoT Gateway</a></li>
<li><a href="../en488410/index.html">7 lessons that I learned in ten years in development</a></li>
<li><a href="../en488412/index.html">Creating a Discord bot based on discord.js</a></li>
<li><a href="../en488416/index.html">SLAE - Security Linux Assembly Expert Exam</a></li>
<li><a href="../en488418/index.html">REST API Authentication with Spring Security and MongoDB</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>