<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👦🏿 🍡 🤴 Comment analyser l'intégralité d'Internet 👏🏿 ☁️ 🐢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La gamme complète d'adresses IPv4 est de 4 milliards d'adresses IP. Cela semble énorme, mais tout Internet IPv4 peut être complètement analysé pour un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment analyser l'intégralité d'Internet</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/499750/"><img src="https://habrastorage.org/webt/el/co/px/elcopxpoohabrp6fvgfwqu5rdgu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La gamme complète d'adresses IPv4 est de 4 milliards d'adresses IP. Cela semble énorme, mais tout Internet IPv4 peut être complètement analysé pour un port TCP </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en 40 minutes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , par exemple, pour trouver tous les serveurs Web du monde ou tous les ports SSH ouverts. Dans ce cas, un serveur et un canal gigabit suffisent. Cela est utile pour la recherche, par exemple, si vous collectez des statistiques sur les technologies utilisées dans le monde ou estimez le pourcentage de services vulnérables ouverts sur l'extérieur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Programme </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zmap</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(à ne pas confondre avec nmap) vous permet de numériser d'énormes gammes de réseaux beaucoup plus rapidement que n'importe quel scanner en raison de l'architecture spéciale. </font><font style="vertical-align: inherit;">Dans cet article, nous verrons un exemple de la façon de compiler une liste de tous les serveurs Web dans le monde en utilisant zmap. </font><font style="vertical-align: inherit;">Ayant une liste d'hôtes avec un port HTTP ouvert, vous pouvez déjà utiliser un scanner plus intelligent, en lui passant une liste précise de cibles.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est mauvais nmap</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la numérisation de petits sous-réseaux, Nmap est traditionnellement utilisé - un outil multifonction open source populaire avec beaucoup de petits pains Pentester à l'intérieur. Il est bien adapté pour balayer de petites plages et des hôtes sélectifs. Nmap a son propre moteur pour écrire des scripts personnalisés dans lua (Nmap Script Engine) et de nombreux scripts prêts à l'emploi. Mais nmap n'est pas bien adapté pour analyser de grands réseaux, tels que des millions voire des milliards d'adresses. Ces tâches prendront plusieurs jours, voire plusieurs semaines. Le fait est que nmap utilise le sous-système réseau du système d'exploitation et qu'un socket complet est ouvert pour chaque requête. Vous ne pouvez pas vous en passer pour une connexion TCP complète lorsque vous devez discuter avec le service, par exemple, faire une demande GET à un serveur Web. Mais cela réduit considérablement les performances lorsqu'un balayage SYN rapide est requis,où la tâche consiste uniquement à savoir si le port est ouvert.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zmap et Masscan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les scanners asynchrones Zmap et Masscan nous conviennent mieux: les deux fonctionnent beaucoup plus rapidement, utilisent le pilote </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PF_RING</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (un socket qui accélère considérablement la capture des paquets) et randomisent les adresses pour éviter un DoS mortel. </font><font style="vertical-align: inherit;">Contrairement à Nmap, ils n'utilisent pas le système TCP / IP: le premier génère des trames Ethernet nues, le second utilise une pile TCP auto-écrite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masscan est considéré comme le scanner Internet le plus rapide qui peut parcourir toute la plage IPv4 en six minutes, mais avec seulement quelques adaptateurs physiques connectés en parallèle, le trafic sortant avec les paquets SYN est généré par l'un et les réponses arrivent par l'autre. Dans les conditions d'une seule connexion, le Zmap modifié était presque une fois et demie plus rapide. Ces records, bien sûr, ont été établis sur le fer supérieur sur les canaux de 10 Gbit / s, et il sera difficile et coûteux de les répéter vous-même. Sur une connexion gigabit beaucoup plus abordable, Zmap fonctionne également plus rapidement que Masscan en raison d'une utilisation plus efficace des ressources de canal et de processeur et peut être achevé en 45 à 50 minutes environ. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ge/fz/jb/gefzjbxxkce6p47gclddui5o-1e.png"><br>
<font color="999999"><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flux de travail simplifié de Zmap et Masscan. Le générateur de trafic sortant et le processeur de réponse entrant fonctionnent séparément</font></font></sup></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sans entrer dans les détails techniques, Zmap et Masscan utilisent deux entités: un générateur de trafic sortant contenant des requêtes SYN et un processeur de réponse entrant distinct. </font><font style="vertical-align: inherit;">Les performances ici ne sont limitées que par la largeur du canal et les performances de l'interface réseau, à savoir la limite PPS (paquets par seconde). </font><font style="vertical-align: inherit;">Par conséquent, le processus d'analyse peut être divisé en plusieurs interfaces ou même plusieurs hôtes physiques s'il est possible de remplacer l'IP source par l'adresse du gestionnaire de paquets entrant.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scan Prep</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il faut garder à l'esprit que le scanner charge le système et en particulier les interfaces réseau, en utilisant tout le canal disponible. Si vous commencez l'analyse sans avertir l'hôte, cela ressemblera à DDoS et vous serez très probablement déconnecté du réseau très rapidement. Vous devez également être préparé à ce que l'analyse de tout Internet provoquera une réponse - ils commenceront à se plaindre de vous. Autrement dit, l'hôte recevra un tas de lettres automatiques se plaignant "vous nous numérisez." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de démarrer votre projet, il est donc préférable de préparer:</font></font><br>
<br>
<ul>
<li><b>    </b> —             ( -     ). ,          .        .</li>
<li><b> PTR-</b> —        ,      .   ,   ,  . ,   PTR   IP-,     , - :<br>
 <code>scanner-for-educational-project.ivan-ivanov.com</code></li>
<li><b>   User-Agent</b> —       - HTTP-,     User-Agent,      .       ,   .</li>
<li><b>  </b> —      ,       .     . </li>
</ul><br>
<h2>NAT,   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est important de comprendre que zmap génère des millions de requêtes TCP en même temps. </font><font style="vertical-align: inherit;">Si un routeur avec NAT, un pare-feu avec suivi des connexions, une protection DDoS ou tout autre système avec un pare-feu dynamique essayant de suivre les connexions est installé entre Internet et le serveur de numérisation, il tombera en panne car il ne peut pas digérer autant de connexions. </font><font style="vertical-align: inherit;">Par conséquent, vous ne pouvez pas exécuter zmap dans le NAT, par exemple, derrière un routeur WiFi domestique.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essayer Zmap</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez le test Zmap ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sur quelque chose de simple, consultez les serveurs Web voisins de habr.com:</font></font><br>
<br>
<pre><code class="bash hljs">$ zmap -p 80 178.248.237.0/24 -B 100M -o habr.txt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Options:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p 80</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - port TCP 80, c'est-à-dire que nous recherchons uniquement des serveurs HTTP</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">178.248.237.0/24</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la plage d'adresses cible. </font><font style="vertical-align: inherit;">Si vous ne le spécifiez pas, l'intégralité d'Internet sera analysée.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-B 100M</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la largeur de canal maximale utilisée par zmap. </font><font style="vertical-align: inherit;">Si cette option n'est pas spécifiée, la totalité du canal disponible sera supprimée.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o habr.txt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - écrit les résultats dans un fichier texte. </font><font style="vertical-align: inherit;">Il obtiendra les adresses qui ont répondu à la demande, c'est-à-dire sur lesquelles il y a un serveur HTTP</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/at/ip/r7/atipr7puts2n4o9n0ravsjti4s0.png"><br>
<font color="999999"><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La numérisation de 254 adresses avec zmap a pris quelques secondes</font></font></sup></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formats de sortie Zmap</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par défaut, zmap ajoute simplement les adresses trouvées à un fichier texte, en les séparant par des sauts de ligne. </font><font style="vertical-align: inherit;">Mais il peut également écrire des résultats au format json et xml. </font><font style="vertical-align: inherit;">L'option </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--output-fields</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous permet de spécifier des champs supplémentaires qui seront ajoutés à la sortie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons par exemple un format de sortie plus avancé dans json, indiquant le port sur lequel la demande de réponse et le TTL du paquet sont arrivés:</font></font><br>
<br>
<pre><code class="bash hljs">$ zmap -p80  --output-module=json --output-fields=ttl,sport,dport,saddr 178.248.237.68 -o habr.com.json<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
$ cat habr.com.json<font></font>
{ <span class="hljs-string">"ttl"</span>: 58, <span class="hljs-string">"sport"</span>: 80, <span class="hljs-string">"dport"</span>: 51309, <span class="hljs-string">"saddr"</span>: <span class="hljs-string">"178.248.237.68"</span> }
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scannez tout Internet!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai essayé d'exécuter une analyse sur VPS, et après quelques minutes, j'ai été banni avec l'obligation de vérifier le serveur pour les virus. </font><font style="vertical-align: inherit;">C'est tout à fait logique, car une telle analyse ressemble à DDoS de l'hôte. </font><font style="vertical-align: inherit;">Mais après avoir discuté de ma tâche avec le support, on m'a proposé de prendre un serveur dédié et de le scanner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble la numérisation sur l'interface 200Mbit / s, le temps prévu est d'environ six heures: </font></font><br>
<img src="https://habrastorage.org/webt/-d/no/k2/-dnok2gjfb79j9svvcocytliin8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
même avec un canal de 100 Mbit / s, tout Internet peut être scanné du jour au lendemain.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que faire ensuite</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous pouvons dire combien d'adresses mondiales écoutent sur le port 80 et en collecter une liste. </font><font style="vertical-align: inherit;">Il peut être envoyé au scanner L7 pour analyser la couche application pour les vulnérabilités. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, obtenez le titre HTML de tous les serveurs Web dans le monde en utilisant nmap. </font><font style="vertical-align: inherit;">À l'entrée nmap, nous transférons le fichier reçu de zmap au format habituel:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
$ nmap -sV -p 80 -v -n  --script http-title  -iL habr.txt<font></font>
</code></pre><br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr499728/index.html">Emplois chez Google. De l'Ukraine à la Silicon Valley</a></li>
<li><a href="../fr499736/index.html">Ce qui est enseigné au Master en génie logiciel à Saint-Pétersbourg HSE</a></li>
<li><a href="../fr499740/index.html">"Fuite" d'une base de spécialistes Habr Carrières</a></li>
<li><a href="../fr499742/index.html">Type de déni de service: progression du DDoS</a></li>
<li><a href="../fr499744/index.html">Hub de sécurité Cloud Security Alarm</a></li>
<li><a href="../fr499752/index.html">Quand est-ce que tout le monde conduira des voitures électriques?</a></li>
<li><a href="../fr499754/index.html">Les rues gelées de la ville en mode d'urgence: il est temps de faire revivre la ville du designer</a></li>
<li><a href="../fr499756/index.html">En combien de secondes un site Web devrait-il se charger en 2020, qu'est-ce qui est «rapide» et où se trouvent les miroirs dans les ascenseurs?</a></li>
<li><a href="../fr499758/index.html">Modèles architecturaux pratiques</a></li>
<li><a href="../fr499762/index.html">Améliorez vos compétences dans DevSecOps: 5 webinaires avec théorie et pratique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>