<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛀 🐇 🧜🏿 Jagdtechniken und -taktiken von Angreifern, die Prefetch-Dateien verwenden ◀️ 👨‍👩‍👧‍👦 👅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Trace-Dateien oder Prefetch-Dateien werden seit XP unter Windows angezeigt. Seitdem haben sie Spezialisten für digitale Forensik und Reaktion auf Comp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Jagdtechniken und -taktiken von Angreifern, die Prefetch-Dateien verwenden</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/487516/"><img src="https://habrastorage.org/webt/qz/fo/tx/qzfotx-ph1-q-7z411gspmuocm8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trace-Dateien oder Prefetch-Dateien werden seit XP unter Windows angezeigt. Seitdem haben sie Spezialisten für digitale Forensik und Reaktion auf Computervorfälle dabei geholfen, Spuren von Softwarestarts, einschließlich Malware, zu finden. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oleg Skulkin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">führender Spezialist für Computerforensik bei Group-IB, </font><b><font style="vertical-align: inherit;">spricht</font></b><font style="vertical-align: inherit;"> darüber, was Sie mit Prefetch-Dateien finden und wie Sie dies tun können.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prefetch-Dateien werden im Verzeichnis </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% SystemRoot% \ Prefetch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gespeichert </font><font style="vertical-align: inherit;">und dienen dazu, das Starten von Programmen zu beschleunigen. Wenn wir uns eine dieser Dateien ansehen, werden wir sehen, dass ihr Name aus zwei Teilen besteht: dem Namen der ausführbaren Datei und der Prüfsumme vom Pfad zu ihr, bestehend aus acht Zeichen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prefetch-Dateien enthalten viele Informationen, die aus forensischer Sicht nützlich sind: den Namen der ausführbaren Datei, die Anzahl der Starts, Listen der Dateien und Verzeichnisse, mit denen die ausführbare Datei interagiert hat, und natürlich Zeitstempel. In der Regel verwendet die Forensik das Erstellungsdatum einer bestimmten Prefetch-Datei, um das Datum zu bestimmen, an dem das Programm zum ersten Mal gestartet wird. Darüber hinaus speichern diese Dateien das Datum des letzten Starts und ab Version 26 (Windows 8.1) die Zeitstempel der letzten sieben Starts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nehmen wir eine der Prefetch-Dateien, extrahieren die Daten mit Eric Zimmermans PECmd daraus und schauen uns die einzelnen Teile an. </font><font style="vertical-align: inherit;">Zur Demonstration werde ich die Daten aus der Datei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CCLEANER64.EXE-DE05DBE1.pf extrahieren</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fangen wir also von oben an. </font><font style="vertical-align: inherit;">Natürlich haben wir Zeitstempel zum Erstellen, Ändern und Zugreifen auf die Datei:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/u1/gh/uj/u1ghujj7plvhk5wwcrlwrvkxol4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ihnen folgen der Name der ausführbaren Datei, die Prüfsumme des Pfads dazu, die Größe der ausführbaren Datei sowie die Version der Prefetch-Datei:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/99/b1/af/99b1afl_ahgisejuyetwy5u8oha.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da es sich um Windows 10 handelt, werden die Anzahl der Starts, das Datum und die Uhrzeit des letzten Starts sowie sieben weitere Zeitstempel mit den vorherigen Startdaten angezeigt:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_n/n6/lq/_nn6lqn99py-wbkorga_2k6xr2e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darauf folgen Informationen zum Volume, einschließlich Seriennummer und Erstellungsdatum:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/f7/ur/zof7urr3spmk8fowq19tlm1dtms.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und zu guter Letzt eine Liste der Verzeichnisse und Dateien, mit denen die ausführbare Datei interagiert hat: </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sj/ut/uc/sjutucejd0bdtl7lqj4jyxvn3bu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verzeichnisse und Dateien, mit denen die ausführbare Datei interagiert hat, sind genau das, worauf ich mich heute konzentrieren möchte. Mit diesen Daten können Spezialisten für digitale Forensik, die auf Computervorfälle oder proaktive Bedrohungssuchen reagieren, nicht nur die Tatsache der Ausführung einer Datei feststellen, sondern in einigen Fällen auch bestimmte Taktiken und Techniken von Angreifern rekonstruieren. Heutzutage verwenden Angreifer häufig Tools zum dauerhaften Löschen von Daten, z. B. SDelete. Daher ist die Fähigkeit, zumindest Spuren des Einsatzes bestimmter Taktiken und Techniken wiederherzustellen, für jeden modernen Verteidiger einfach erforderlich - ein Computerforensiker, ein Spezialist für die Reaktion auf Vorfälle oder ein Experte von ThreatHunter.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit der Initial Access-Taktik (TA0001) und der beliebtesten Technik - Spearphishing Attachment (T1193). Einige Cyberkriminelle sind sehr kreativ bei der Auswahl solcher Anhänge. Beispielsweise verwendete die Silence-Gruppe hierfür CHM-Dateien (Microsoft Compiled HTML Help). Somit haben wir noch eine andere Technik - Kompilierte HTML-Datei (T1223). Solche Dateien werden mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hh.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gestartet. </font><font style="vertical-align: inherit;">Wenn wir also die Daten aus der Prefetch-Datei extrahieren, finden wir heraus, welche Datei das Opfer geöffnet hat:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rz/u-/qs/rzu-qs_1gqkqozlylsktzgbixeq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir arbeiten weiterhin mit Beispielen aus der Praxis und fahren mit der nächsten Ausführungstaktik (TA0002) und der CSMTP-Technik (T1191) fort. </font><font style="vertical-align: inherit;">Das Microsoft Connection Manager-Profilinstallationsprogramm (CMSTP.exe) kann von Angreifern zum Ausführen schädlicher Skripts verwendet werden. </font><font style="vertical-align: inherit;">Ein gutes Beispiel ist die Cobalt Band. </font><font style="vertical-align: inherit;">Wenn wir die Daten aus der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prefetch-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><b><font style="vertical-align: inherit;">cmstp.exe</font></b><font style="vertical-align: inherit;"> extrahieren </font><font style="vertical-align: inherit;">, können wir erneut herausfinden, was genau gestartet wurde:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_a/d6/w6/_ad6w6l4kie1jzvqlghmofdjkmy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine andere beliebte Technik ist Regsvr32 (T1117). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regsvr32.exe wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auch häufig von Angreifern zum Starten verwendet. </font><font style="vertical-align: inherit;">Hier ist ein weiteres Beispiel aus der Cobalt-Gruppe: Wenn wir Daten aus der Prefetch-Datei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regsvr32.exe extrahieren</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sehen wir erneut, was gestartet wurde:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9e/z5/qi/9ez5qisulx1rhfpgpph2lqsg2io.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgenden Taktiken sind Persistenz (TA0003) und Privilegieneskalation (TA0004) sowie Application Shimming (T1138) als Technik. Diese Technik wurde von Carbanak / FIN7 verwendet, um das System zu sichern. Normalerweise wird bei der Arbeit mit Datenbanken mit Informationen zur Programmkompatibilität (.sdb) die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datei</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sdbinst.exe verwendet </font><font style="vertical-align: inherit;">. Daher kann uns die Prefetch-Datei dieser ausführbaren Datei helfen, die Namen solcher Datenbanken und ihren Speicherort herauszufinden:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ps/40/rj/ps40rjgtsih7brdssonnfi05ug0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie in der Abbildung sehen können, haben wir nicht nur den Namen der für die Installation verwendeten Datei, sondern auch den Namen der installierten Datenbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns eines der häufigsten Beispiele für Netzwerkreisen (TA0008) an, PsExec, das gemeinsam genutzte Verwaltungsressourcen verwendet (T1077). Auf dem Zielsystem wird ein Dienst mit dem Namen PSEXECSVC erstellt (natürlich kann jeder andere Name verwendet werden, wenn die Angreifer die Option </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-r verwendet haben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Wenn wir also die Daten aus der Prefetch-Datei extrahieren, sehen wir, dass er gestartet wurde:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fb/x6/oq/fbx6oqbuwsqjx4n7rlwxepbokg0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde vielleicht mit dem fertig werden, womit ich angefangen habe - Dateien löschen (T1107). </font><font style="vertical-align: inherit;">Wie bereits erwähnt, verwenden viele Angreifer SDelete, um Dateien in verschiedenen Phasen des Angriffslebenszyklus dauerhaft zu löschen. </font><font style="vertical-align: inherit;">Wenn wir uns die Daten aus der Prefetch-Datei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sdelete.exe ansehen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , werden wir sehen, was genau gelöscht wurde:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_s/7r/ow/_s7rowf7rwit15k0or2byyp0gkk.jpeg"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich ist dies keine erschöpfende Liste von Techniken, die während der Analyse von Prefetch-Dateien gefunden werden können, aber dies sollte ausreichen, um zu verstehen, dass solche Dateien nicht nur Spuren des Starts finden, sondern auch spezifische Taktiken und Techniken der Angreifer rekonstruieren können.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487504/index.html">Bis zum Tag der russischen Wissenschaft werden die besten Leistungen der einheimischen Wissenschaftler von 2019 benannt</a></li>
<li><a href="../de487508/index.html">Messen der Entfernung zu Objekten mit RealSense D435</a></li>
<li><a href="../de487510/index.html">Radioaktive Produkte. Gammaspektrometer. Teil 1</a></li>
<li><a href="../de487512/index.html">Wie implementiere ich ignorierte blockierte Benutzer in Telegrammgruppen?</a></li>
<li><a href="../de487514/index.html">Jährlicher Bericht zur Netzwerksicherheit und -verfügbarkeit von Qrator Labs</a></li>
<li><a href="../de487518/index.html">Radioaktive Produkte. Gammaspektrometer. Teil 2</a></li>
<li><a href="../de487522/index.html">Wir lassen das Terminal fliegen (Teil 1)</a></li>
<li><a href="../de487524/index.html">Warum braucht ein Hardware-Startup-Hackathon?</a></li>
<li><a href="../de487528/index.html">Изменения в пользовательском соглашении и политике конфиденциальности на сервисах Хабра</a></li>
<li><a href="../de487534/index.html">etcd 3.4.3: Speicherzuverlässigkeits- und Sicherheitsforschung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>