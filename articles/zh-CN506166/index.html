<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕵🏽 💪🏿 🐊 配置神经网络以检测必要的对象 😢 ◽️ 🚅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="神经网络是帮助解决各种问题的复杂数学算法。在使用之前，必须对其进行设置和培训。神经网络训练是相当长的时间并且昂贵的计算过程。但是，有一些工具可以简化这些问题。今天，我们将考虑重新训练神经网络以检测图像中特定对象的过程。
 
 例如，我们将使用YOLOv3算法来检测对象。您可以在github页面上的文...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>配置神经网络以检测必要的对象</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506166/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/8f/2g/g2/8f2gg2qg7j-d7tzt-iykqfgc0qo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
神经网络是帮助解决各种问题的复杂数学算法。在使用之前，必须对其进行设置和培训。神经网络训练是相当长的时间并且昂贵的计算过程。但是，有一些工具可以简化这些问题。今天，我们将考虑重新训练神经网络以检测图像中特定对象的过程。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，我们将使用YOLOv3算法来检测对象。您可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github页面</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的文章中找到其他材料</font><font style="vertical-align: inherit;">。在Windows 10上进行安装和配置的示例。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们需要从此</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github页面</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载或克隆必要的材料，以为特定类型的对象重新训练神经网络</font><font style="vertical-align: inherit;">。为了避免访问或权限问题，最好将资料放在您的帐户目录中，例如：C：\ Users \ user_name \ Documents \ NN \。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.转到yolov3-master文件夹，调用终端（命令行）并执行pip install -U -r requirements.txt命令。运行命令时，未安装某些软件包，因为在Windows的pip存储库中，不存在具有该名称的软件包。为了使安装成功，在requirements.txt中，我们需要注释掉几个软件包（“ torch&gt; = 1.5”和“ pycocotools”）。然后使用以下命令安装pytorch：</font></font><a name="habracut"></a><br>
<br>
<pre><code class="python hljs">pip install torch==<span class="hljs-number">1.5</span><span class="hljs-number">.0</span> torchvision==<span class="hljs-number">0.6</span><span class="hljs-number">.0</span> -f https://download.pytorch.org/whl/torch_stable.html</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的情况下，不需要pycocotools软件包。还必须下载并安装</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CUDA工具</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以便您的计算在视频卡上进行，这有时会提高重新训练的速度。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.安装成功完成后，我们可以开始准备数据。为了使算法更好地工作，必须从将在其上进行处理的材料上拍摄训练照片。例如，有必要处理来自安装在大角度放置物体的房间中的监视摄像机的视频资料。在这种情况下，很难训练一种算法来检测与训练有神经网络的Internet上的图片截然不同的对象。因此，可以使用视频材料从屏幕截图中或使用相机手动拍摄中来编译训练样本。训练样本的大小可以相差很大，这完全取决于任务的性质。在此示例中，数据集包含46张图像，这些图像描述了三种类型的对象（笔，铅笔，记号笔）。在桌子和A4纸的背景下进行摄影。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.下一步是标记图像中的对象。</font><font style="vertical-align: inherit;">但是，在开始标记之前，有必要使用几种增强方法来增加训练样本。</font><font style="vertical-align: inherit;">这对于提高神经网络识别各种变化对象的能力很重要。</font><font style="vertical-align: inherit;">可以在此</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记本中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到一些增强的示例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">扩充完成后，我们会将原始图像和扩充结果合并到一个文件夹中（重要的是图像应位于yolov3_master文件夹的根目录中，例如：C：\ Users \ user_name \ Documents \ NN \ yolov3_master \ images \）。</font><font style="vertical-align: inherit;">接下来，使用labelImg程序标记对象，依次执行以下步骤：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/kt/dd/z5ktddwmvl-ulta3vsbva2macvs.png"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择包含图像的文件夹（... \ yolov3_master \ images \）；</font></font></li>
<li>    .       labels,       (….\yolov3_master\labels\);</li>
<li>   c PascalVOC  YOLO;</li>
<li>    ;</li>
<li>   ,     ;</li>
<li>       (Pen, Pencil, Marker),            ;</li>
<li>;</li>
<li> ;</li>
<li>       4 – 8.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，带有图像名称的文本文档出现在标签文件夹中，其中包含类标签和四个坐标-标准化值x，y，w，h，它们描述了图像中每个对象的矩形位置（1是Notepad ++编辑器中的行号，不适用于该文档的内容）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7c/t8/ws/7ct8wsuqhzfhzkupfd1ntjyc3j0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.接下来，我们需要将准备好的样本分为训练样本和测试样本。在这种情况下，有必要创建2个文本文档（train_112.txt和test_24.txt），这将指示每个图像的完整位置路径。在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记本中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以找到创建文档的示例</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.为了命名所需的对象，您必须创建一个扩展名为.names的文件，例如objects.names，该文件按照标签文件夹中classes.txt中指定的顺序列出名称。看起来像这样：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ex/0h/g1/ex0hg17zt5nnqgyxn-qoeasf9ak.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，您需要创建一个扩展名为.data的文件，例如conf.data，该文件指示类的数量（在本示例中为3），带有对象名称的文件以及带有训练和测试样本的图像位置的</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i-/e8/z6/i-e8z6pmganhasy40yick2wjhx8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
文件</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">Files对象。名称，conf.data和后续文件必须放置在以下目录中：yolov3_master \ data \，之前已从其中删除了所有文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.要进行再培训，您需要配置配置文件，为此，从文件夹（... \ yolov3_master \ cfg）复制文件yolov3-spp.cfg到文件夹（... \ yolov3_master \ data）。接下来，您需要为三层中的每一层编辑行（636,643-722,729-809,816）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gn/ef/w5/gnefw5t095nq8jgbxkopwlmh1um.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中，filters =（5 + n）* 3，</font><font style="vertical-align: inherit;">classs </font><font style="vertical-align: inherit;">= n。 n是类数（在此示例中为3）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.接下来，您需要下载已配置的配置文件的权重。为此，请从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页面</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载yolov3-spp.pt文件并将其放在（... \ yolov3_master \ data）中。例如，使用yolov3-spp算法。但是，算法有多种变体，例如yolov3-tiny，它是yolov3-spp的轻型版本。轻型版本的准确性较差，但材料处理速度要高得多。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8.我们将直接针对您的对象类型进行算法的再培训。为此，请在文件夹... \ yolov3_master \中运行命令行并输入以下命令：</font></font><br>
<br>
<pre><code class="python hljs">python train.py --cfg data/yolov3-spp.cfg --data data/conf.data --weights data/yolov3-spp.pt --nosave</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
运行该命令后，可能会发生以下性质的错误：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/or/bg/hk/orbghkbzcmnaktnvp6fhpsnlwgy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要解决此问题，必须在utils文件夹中的utils.py文件中注释掉行：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y3/k1/51/y3k151rlmya3guveav5c8o2xk8i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在check_git_status函数的主体中，我们注释掉除了print以外的所有行，我们将在其中传递任何行，例如“ ss”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也可能会出现以下类型的错误：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0v/t7/1w/0vt71wd0snopl_cvxl17tyyl0gu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此错误表明没有足够的视频卡内存来构建计算图。解决此问题的一种方法是在训练期间减小批次的大小。为此，在文件（... \ yolov3_master \ train.py）中，您需要更改batch_size参数，默认值为16，更改为4的较低值（8或4）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/gk/yy/r3gkyy0ua0bfoyae5dmduxn3qtg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您还可以在初始化期间使用参数值显式传递此值：</font></font><br>
<br>
<pre><code class="python hljs">python train.py --cfg data/yolov3-spp.cfg --data data/conf.data --weights data/yolov3-spp.pt --batch-size <span class="hljs-number">4</span> --nosave</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在上面的示例中，我们指定了一个配置文件，一个包含有关训练集，权重和保存选项的信息的文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--nosave参数指示仅保存带有比例的最终文件。您还可以在train.py文件中设置保存模式，例如，如果要每400个时间段保存一次重量：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s3/di/ax/s3diaxobwljgntbmhpnj3lxzoda.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
指定--epochs参数也很重要，纪元数取决于对象的类型，训练样本的大小和其他因素。在此示例中，最初有46张图像，使用增强方法将数据集增加到136张，其中112张是训练样本，24张是测试样本。计算是在GTX 1060 6 GB图形卡上进行的。第一次尝试进行了300个时代，训练时间约为2.5个小时。揭示了该算法的准确性很差。第二次尝试进行了1200个时代，培训花费了大约12个小时。训练完成后，权重将保存在文件夹last.pt中（... \ yolov3_master \ weights \）文件夹中。为了检查算法的可操作性，请运行以下命令：</font></font><br>
<br>
<pre><code class="python hljs">python detect.py --weights weights/last.pt --cfg data/yolov3-spp.cfg --names data/objects.names</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在运行命令之前，必须将要通过算法处理的图像放在文件夹中（... \ yolov3_master \ data \ samples \）。</font><font style="vertical-align: inherit;">结果将显示在文件夹中（... \ yolov3_master \ output \）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/vo/bd/nwvobdpaqfbon5cnxlog7hebkgq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，对完成的神经网络进行了重新训练，它能够为该列表中未包括的3种新对象确定80种对象。</font><font style="vertical-align: inherit;">对于标记对象，该算法并不完全准确；置信度小于0.5。</font><font style="vertical-align: inherit;">原因之一可能是训练样本太小，因为 </font><font style="vertical-align: inherit;">在此示例中，带有标记的图像占26％，其余为钢笔和铅笔。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN506148/index.html">色彩感知科学改变了我们与屏幕的关系</a></li>
<li><a href="../zh-CN506150/index.html">击中SETI：为怀疑论者，乐观主义者和精明的操作者提供自愿计算</a></li>
<li><a href="../zh-CN506152/index.html">使用jmx和javaassist作为javaagent从“外国”类收集指标</a></li>
<li><a href="../zh-CN506158/index.html">useSWR是我最喜欢的React库</a></li>
<li><a href="../zh-CN506164/index.html">#nodesigndev：由开发人员设计</a></li>
<li><a href="../zh-CN506168/index.html">Google趋势的绝佳指南：如何阅读所有这些统计数据以及学习如何捕捉趋势</a></li>
<li><a href="../zh-CN506170/index.html">抽象数据类型。第1部分：数据（数据类型）</a></li>
<li><a href="../zh-CN506176/index.html">Creaform 3D扫描仪概述</a></li>
<li><a href="../zh-CN506178/index.html">趋势改变了软件测试的未来：专家观点</a></li>
<li><a href="../zh-CN506180/index.html">如何为您的UPS选择合适的电源。我们以伊顿为例进行分析</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>