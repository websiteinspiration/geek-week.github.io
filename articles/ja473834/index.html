<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🚒 🤭 🤘 Closネットワークでのブラックボックスモニタリング。Yandexレポート 🔠 🍕 📗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="現代のデータセンターとその中のデバイスのトポロジでは、ホワイトボックスモニタリングだけでコンテンツを処理できなくなりました。時間の経過とともに、Closネットワーク内のどこかにトラフィック（データプレーン）が転送される実際の状況に基づいて、特定のデバイスのパフォーマンスを表示するツールが必要になりま...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Closネットワークでのブラックボックスモニタリング。Yandexレポート</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/473834/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現代のデータセンターとその中のデバイスのトポロジでは、</font></font><abbr title="デバイス上のアプリケーションから取得したメトリックに基づく監視の一種。 たとえば、ホワイトボックスの監視には、ログの収集とセッションのステータスの確認が含まれます。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホワイトボックスモニタリング</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だけでコンテンツを処理できなくなりました</font><font style="vertical-align: inherit;">。時間の経過とともに、</font></font><abbr title="Closネットワーク（確立された名前は「Closネットワーク」）は、Charles Closによって記述されたマルチステージスイッチングネットワークの一種です。 データセンターで広く使用されています。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Closネットワーク</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内のどこかにトラフィック（データプレーン）が転送される実際の状況に基づいて、特定のデバイスのパフォーマンスを表示するツールが必要になりました</font><font style="vertical-align: inherit;">。数週間前の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネクストホップ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会議で、</font><font style="vertical-align: inherit;">Yandexネットワークエンジニアのアレクサンダークリメンコは、この問題の解決における彼の経験を共有しました。</font></font><br>
<a name="academy"></a><h2> </h2><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/o3/kv/n3/o3kvn3oecpuipgvx68yuzfib4t4.jpeg"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-私はYandexネットワークの運用開発部門で働いています。時々、チラシに美しい雲を描いたり、明るい未来を生み出したりする代わりに、いくつかの問題を解決せざるを得ません。人々は来て、何かがうまくいかないと言います。この問題が監視されている場合、当直のエンジニアがそれが機能しないことを確認すると、私にとっては簡単になります。したがって、この30分は監視に費やされます。</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/wi/m7/gn/wim7gnm9iv9s50sfcujeemna250.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遅かれ早かれ、誰もが監視のアイデアを思いつきます。つまり、最初はユーザー自身のアピールを集めることができます。彼らはあなたをノックして何かが彼らのために働いていないと言うでしょう。しかし、そのようなシステムはうまく拡張できないことは明らかです。複数のスイッチを使用している場合、十分に大きなネットワークを使用している場合、この監視オプションでは遠くまで行くことはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして遅かれ早かれ、すべてが機器からいくつかのデータを収集する必要があるという結論に達します。これが最初のステップです。ログ、SNMPのさまざまなデータ、ドロップ、LLDPに従ってトポロジを構築できます。明確なマイナス点があります。デバイス自体がこのすべての情報を提供します。それは何かを過小評価している、あなたをだましているなどの可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
監視の開発における論理的な段階は、ホストでの監視です。小さな枝があると言えます。ネットワークを1つのベンダーで使用できるのが幸運であるかどうかは、ベンダーが独自の監視オプションの1つを提供できるようにします。しかし、昨年ネクストホップで、ディマエルショフ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、私たちの工場は2つの基本的なベンダーから製造されたものであり、そのような贅沢を買う余裕はないと述べました。または可能ですが、部分的にしかできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、最後のオプションは、誰もが何らかの形でネットワークの開発で到達する最後のオプションです。これはエンドホストで監視しています。 Yandexにはそのような監視があります。 Netmonと呼ばれます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/kj/_w/8jkj_whnq8eze73jzmmc_w_c-_q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スライドの下部に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">詳細なプレゼンテーションへのリンク</font></a><font style="vertical-align: inherit;">があります</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netmonの仕組み。文字通り1枚のスライドでお伝えします。誰かが望むなら、別のNetmon会議の講演を読んでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Netmonは、ネットワーク上のほとんどすべてのホストにインストールされるエージェントです。タスクはエージェントに送信されます。いくつかのパケットをいくつかのネットワークノードに送信します。それらは完全に異なる場合があります：UDP、TCP、ICMP。これは、異なるペイント、つまりDSCPと宛先の両方にすることができます。送信元ポートと宛先ポートも異なる場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデータは集計され、別のストレージにアップロードされ、図の右側にあるようなスライスがここに表示されます。スライスは、何を表示したいかに応じて、より多くまたはより少なくすることができます。たとえば、ここでは、私が見る限り、すべてのデータセンター間、つまりすべてのデータセンター間を接続しています。四角形に深く入り込むことができます-POD間または1つのデータセンターの建物内の接続を確認してください。さらに深い-ラック間のPODの内側。さらに深く-ラック内でも。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ea/iq/to/eaiqtolvrecwgo0apgnxdc2rgy0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで何が問題になるのでしょうか？昨年のネクストホップを見ていなかった人のための小さな余談。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ToRごとに400ギガビットを使用しました。このファクトリの実装の最初の時点では、より重要なタスクがあったため、200のみを含めました。どうしても。彼らは200をオンにした、サービスが来て言った：なぜ200？ 400が欲しい！それをオンにし始めました。それで、私たちが含めた工場の第二部は、カードの記憶の中である種の結婚をしていました。結果として、工場の電源を入れて、次の画像を確認します。これ</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-m/mt/vb/-mmtvbpckx_kmr42-u3dwoditz4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
と同じNetmon、赤い四角があります。すべてが失われていることを理解しています。私たちはホーマーのような頭をつかんで、必死に何かを押し出そうとします。そして何を押すか、何をオフにするか、私たちは理解していません。つまり、Netmonは問題の存在を示しますが、実際には問題がネットワーク上のどこにあるのかを示しません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/sg/tu/efsgtu9frnrwu4mcwoajkhqtw4m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完了する必要のあるタスクに到達しました。何をすべきか？ネットワーク内のどのデバイスに問題があるかを特定し、それをサービスから外します-自動的に、または例えば当番エンジニアなどの力によって。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、初期条件は、かなり規則的なトポロジーが存在するようなものです。つまり、第2レベルのスピン間またはトーラス間に奇妙なリンクはありません。ほとんどのトラフィックがあります-TCP、中心的な場所があり、それについてはすでに説明されており、サーバーは多かれ少なかれ集中管理されています。私たちはこの中心的な場所に来て、合理的に宣言できます：みんな、そうしたいのですが、そうしてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どのようなオプションを検討しましたか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y-/cx/1m/y-cx1mnilmeqpxmlibivrgychbq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に頭に浮かぶのは、トレースです。どうして？同じNetmonが、失敗したソースと宛先のペアを別のコレクターにアンロードするためです。したがって、この5タプルを取得し、それを見て、同じパラメーターでトレースを作成できます。また、どのリンクまたはどのデバイスを介して、最大数のトレースが通過するかについてのデータを集約します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、残念ながら、MPLSは工場で使用されています（現在、MPLSとは反対の方向に移動していますが、古い工場を何らかの方法で監視する必要がありますが、実際にはそれらを捨てないでください）。工場にはMPLSがあり、MPLSとトレースの問題は、トレースの基礎となるTTLを超えたICMPメッセージをトンネリングする必要があることです。入力から出力へのそのようなメッセージを失ったので、監視そのものを失う可能性があります。つまり、このメッセージがどのノードを通過したかはわかりません。これは監視には適していませんでした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xl/bg/fr/xlbgfroj02orrytuqectvxi-n18.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECMPに関連する2番目のオプションがあります。 source-port destination-portに加えて、同じ送信元と宛先のペアを使用します。 APIを介して、またはCLIを介して1つの鉄片に到達し、この鉄片を鉄片に供給して、出力インターフェイスを取得します。多くのデバイスがこの種の出力をサポートしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ToRに移動します。ToRが左または右のリンクを選択したことを確認します。この場合、左側のリンクは左側のS1に向かっています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pf/k1/fq/pfk1fq3l3zpso1b0dtteib-ip5a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはこのS1に来て、正しいS2を見たので、道路は準備ができていました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lb/gu/7r/lbgu7r5ogih0uzo4zoazcczuuya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの欠点があります。まず、すべてのデバイスが通常、これらの入力データを受け入れることができるわけではありません。これは、IPv6とMPLSを使用しているという事実と、一部のベンダーがこれを実装していないという事実によるものです。この解決策の2番目のマイナス点：ホストで何が行われているのかを確認するのではなく、鉄片が再び何を教えてくれるかに依存します。そして最後に、3番目のマイナス-そこに行って何が起こるかを確認している間、何かがネットワーク上ですでに変更されている可能性があり、データは関係ありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dy/he/_s/dyhe_sdybz_8nsum0uce40pjg2c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、Facebookによる興味深いプレゼンテーションに出会いました。 Facebookが提案したアイデアが気に入ったので、同様のことをすることにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主なアイデアは何でしたか？ホストでeBPFプログラムを使用してTCP再送信に色を付け、そのようなパケットの数を計算します。残念ながら、私たちはFacebookのようにそれを行うことができませんでした。自分たちの自転車を発明する必要がありました。私たちが経験した痛みと苦しみの道についてお話ししようと思います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/5l/5e/bt5l5e9el6kbhutnjsamv3hpo5u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは何をしましたか？念のため、TCP再送信は確認されなかったため、数回繰り返されるTCPメッセージであることを指摘しておきます。ホストにeBPFプログラムをインストールし、このTCPメッセージが再送信されているかどうかを調べます。シーケンス番号で-それは正しく行われます。同じシーケンス番号がTCPセッションで送信される場合、これは再送信です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなパッケージをどうするか？ DSCPフィールドの最後のビットを1に設定して、全体をさらに計算します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rk/nh/qm/rknhqmvuhuu9vss_juaqyzlxtza.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に言って、DSCPはQoSに何らかの関係がありますよね？また、QoSを使用すると、ネットワークの履歴は非常に複雑で長年にわたります。 ToRスイッチで監視される特定のポリシーがあります。これらのポリシーに、数を増やす必要性とこれらのカラーパケットを追加しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、カラーパケットの場合（読み取り：ホストからのTCP再送信パケットの場合）、別のQoSキューを追加しただけです。まだ無料の回線があったので、これは十分に簡単でした。さらに、これは便利です。工場でのIPv6とMPLS間の移行の段階、つまりパケットがS1を通過して工場のMPLS部分に送信される段階で、特定の各キューのMPLSパケットヘッダーでEXP / TCを取得して再ペイントすると便利です。 。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n1/jz/yy/n1jzyyspbgw39b3zv1xngyavgwm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデータで何をしますか？標準のACLフィルター、トラフィッククラスでそれらを収集します。つまり、原則として、どのベンダーでも機能します。そのようなパッケージの数はどこでも収集して計算できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、PODでのこのようなパケットの不均一な分布を確認します。その中で、例えば、写真のように4つの背骨。黄色のリンク、青、緑、赤のパケット数が同じである場合、すべてが多かれ少なかれ良好であると考えています。ある時点で、たとえば1番目のレベルの最も右のスパインで増加が見られる場合、このデバイスが再送信を引き付けていることがわかりますが、何か問題があります。次に、それを廃止するか、少なくともリースするようにします。少なくともNetmonで問題が発生すると、どのデバイスで問題が発生するかがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ky/9t/8u/ky9t8uf1v57wlbqmqsxmmtusipc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単純な生データはどのように見えますか？ここに2つのグラフがあります。実際、これらはToRを第1レベルの脊椎に向けた再送信チャートです。例では、モジュール内の2つのスパイン。上のグラフは最初のスパインの集合体、下のグラフは2番目のスパインです。この形式でこれを見るのはあまり便利ではないため、この情報の集計を追加しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/pu/-o/abpu-on4l0cwiglpfdftt7mzykc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんな感じです。何らかの理由で3つのスパインがどちらでも問題にならないモジュールがあります。ここでは、3つのスパインへの再送信のこのような合計の分布がわかります。原則としてかなり均一です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ar/m0/cm/arm0cmbz77k8bpdu8qqerqsttto.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第2レベルの脊椎には、さまざまな偏差がある可能性があります。それをそれらと呼びましょう。トポロジは依然として通常のままですが、データセンターによっては、プレート状のアーキテクチャを使用する場合と使用しない場合があります。ここでのポイントはまったく同じです。あるレベルでは、カラーパッケージの配布はほぼ同じになるはずです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/if/od/og/ifodogqs86mqbfgahucjzo_wrgi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例を見てみましょう。誰かがそのようなチャートで問題を見ていますか？ここに問題がありますが、同時にはありません。はい、これはシュレーディンガーの問題です。なぜ彼女はそこにいていないのですか？再送信の数が増えるので、何かが起こったことは明らかです。しかし同時に、この成長は非常に均一であることがわかります。つまり、3つのスパインブルー、レッド、ブルー、さらにはそれらすべてに分布しています。これは何を意味するのでしょうか？ネットワークになんらかの問題がありましたが、このレベルのデータ集約とは関係ありません。彼女はどこかにいます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たぶん、誰かがファイアウォールのポートを閉じて、いくつかのクラスターを切断しました、つまり、何かが起こりました。しかし、そこに何があったのか、またその理由にはまったく関心がありません。つまり、そのような問題さえ考慮していません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ie/_4/tz/ie_4tzqchudv3zrxi6vi_mcwxgm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ここでは、おそらくそれほど明確ではありませんが、問題は目に見えています。モジュールには2つのスパインがあり、1つは46色のパケット、もう1つは少しだけ飛んだ。ネットワーク上のある種のスパインに問題があることを理解しています。それについて何かしなければなりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜ私は最初に痛みと苦しみの道について話しましたか？そのような解決策には多くの問題があるからです。主な問題はもちろん、監視の問題です。これは誤検知です。誤検知はかなり多かった。主に、DSCPを使用しており、一般にQoSに関連付けられているためです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ht/md/rb/htmdrbopskl2febbslxadjbqtlw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他の人の荷物がペンキの中を飛んでいることを発見し、私たちの監視を警告しています。つまり、これは再送信であり、他の誰かがそこにパッケージを置いて、一般に、画像を台無しにします。当然、私たちは理解し始め、それがうまくいくと思った場所をたくさん見つけましたが、実際には私たちの考えているようにうまくいきません。たとえば、ネットワークに入るトラフィックは一見再描画されるべきであり、境界にクラスCS6およびCS7を持つトラフィックはネットワークに到達しないはずです。しかし、いくつかの場所では、たとえば欠陥があり、私たちはそれらをうまく処理しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部の製造元は、このようなパケットの発信方向でカウンターをカウントするという形で驚きを示しました。チップは、実際には発信アクセスリストを処理するためにトラフィックを再びラップし、チップ帯域幅の半分をかき消すように動作します。チップあたり900ギガビットで、半分になりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ホストの設定が異なる可能性があるため、いくつかの改善を行いました。つまり、一部のホストは再送信をより頻繁に送信でき、一部のホストはより少ない頻度で送信でき、一部は2つ、一部は5つであり、これらすべてが監視に警告を発します。これはすべて誤検知です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、すべてのTCP再送信をペイントするという考えを放棄しました。問題がどこにあるのかを理解するために、原則としてすべての再送信が必要なわけではないことに気付きました。 SYN再送信のみをペイントし始めました。 SYNはセッションの最初のパケットであり、信号を受信するにはこれで十分です。 SYN-ACLもペイントします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とにかく、それはいくつかの偽陽性を与えました。私たちはもう少し進んだ。セッションの最初のTCP SYN再送信のみをペイントし始めました。つまり、実際にはそれらのいくつかが送信され、それぞれをペイントしました-ペイントされ始めたのは1つだけです。これで、現在の状況に到達しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
合計はNetmonであり、セッションには最初のSYN再送信に色を付けるエージェントがホストにあり、ネットワーク内のほぼすべてのリンク上のすべてのデバイスでこれらの再送信をカウントします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/pn/y1/bkpny1rbllgxlz8nf4v6wynm6ro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、私がかつて見せた写真を目で見るのはあまり便利ではありませんでした。つまり、各セクションですべてを目で評価する必要があるため、担当役員に販売することはできません。そして、私はアラートが欲しいという事実に行き着きました。ライトを点灯させたい：デバイスなどが問題である。別のデバイスに問題があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの数学的統計を思い出してみましょう。警告のアイデアは、各デバイスが本質的にバスケットであるということです。 4つのデバイスについて、成功の確率と失敗の確率があります。バスケットに再送信される確率、つまり成功は¼です。二項分布がわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでアラートを出す難しさは何ですか？しきい値を静的にすることができないという事実は、私たちは言うことはできません。10個の再送信が1つのデバイスに到着し、9個が別のデバイスに到着する場合、問題はありません。 10と5の場合、問題があります。それを千PPSにスケーリングすると、そのようなデータはもはや意味がなくなります。異なるデバイス間の1000 PPSと800 PPSは間違いなく問題です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
静的しきい値をPPSまたはバイト単位で設定することはできません。パーセンテージとして設定することはできません-それらと同じ問題。したがって、パケット数に応じてこのしきい値を多少動的にするソリューションが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、二項分布の魅力は、PPSの増加時に正規化する傾向があることです。正規分布の場合、期待値、分散、および信頼区間を計算できます。私たちの信頼区間は3NPQです。つまり、デバイスを通過するパケット数に依存します。その結果、動的なシフトしきい値があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが信号が画像でどのように見えるかです。一部のデバイスがディストリビューションからノックアウトされた場合、そのデバイスにフラグを立てます-何かが間違っています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0e/bo/c_/0eboc_4g2lwamtfgsdus0o-tqzi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どこでさらに発展させたいのか、もちろん、誤検知との戦いに加えて、ここで何を改善したいのか？まず最初に、問題が発生したときに何があったかを確認したいと思いますか？これを行うには、エージェントにそのようなオプションがあります-デバッグ。再送信されたもの、たとえば5タプルのパケットを別のコレクターに正確にアップロードしてから、それを見ることができます。ただし、これによりホストに負荷がかかるため、禁止する場合があります。 ERSPANを固定し、そのようなパッケージをハードウェア自体からコレクターにアンロードしたいと考えています。これは、ハードウェアでこれを行うことを禁じられていないためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディマ・アファナシエフ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は言った</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのように工場を開発するか、そしてポイントの1つはMPLSファクトリーからIPv6のみへの移行でした。これは私たちに何を与えますか？ MPLSには、QoSマーキング用の3ビットがあります。 IPv6では、少なくとも6つ。現在、ネットワークで実際に使用されているのは3ビットだけです。つまり、ホストからの情報を実際に配置できるビットが3つ残っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、セッションの最初のSYN再送信のみをペイントしています。また、たとえば、パケットが外部ネットワークに送信される場合は、2番目のビットに色を付けることができます。そして、再送信することができます。つまり、別の信号を強調表示し、個別に検討します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、エッジポッドを使用した設計への移行は、特定の場所でDCIを実行したときに、diffservドメインをより正確に制御できるという事実を脅かします。</font><font style="vertical-align: inherit;">つまり、塗料を塗り直して何かを行うことで、誤検知をカットします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果として、上記のすべてを実行することはかなり面倒ですが興味深いものであることがわかりました。</font><font style="vertical-align: inherit;">心配することは何もありませんでした。</font><font style="vertical-align: inherit;">実際、私たちは誰もが使用できるソリューションを開発しました。</font><font style="vertical-align: inherit;">事実上すべてのベンダーでテストされており、機能し、難しくありません。</font><font style="vertical-align: inherit;">また、ネットワーク上のどのデバイスに問題があるかを実際に示しています。</font><font style="vertical-align: inherit;">したがって、私のメッセージは-同じことをすることを恐れないでください、そしてあなたの監視を緑のままにさせてください。</font><font style="vertical-align: inherit;">聞いてくれてありがとう。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja473822/index.html">1日での求人：同じ日に面接してフィードバックを提供した方法</a></li>
<li><a href="../ja473824/index.html">単一システムで販売計画のためのビジネス技術を構築する方法</a></li>
<li><a href="../ja473826/index.html">Apache WebサーバーでのOTP認証</a></li>
<li><a href="../ja473828/index.html">オフィスパスの代替としてのコンピュータビジョン</a></li>
<li><a href="../ja473832/index.html">ShIoTiny：アップデートと通知</a></li>
<li><a href="../ja473838/index.html">DJI Mavic Mini：最軽量の折りたたみ式クワドロコプター</a></li>
<li><a href="../ja473840/index.html">JAVAアプリケーションでUDPを介してAndroidデバイスからビデオをストリーミングする</a></li>
<li><a href="../ja473842/index.html">10月の機械学習と人工知能のニュースダイジェスト</a></li>
<li><a href="../ja473844/index.html">単純な数値クラッシャーでC ++ 20からの範囲が必要なのはなぜですか？</a></li>
<li><a href="../ja473846/index.html">ブロックチェーンネットワークのパフォーマンスを測定する方法。主要な指標</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>