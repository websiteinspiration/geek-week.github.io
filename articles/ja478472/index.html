<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘‰ğŸ¿ ğŸ‘©â€âš–ï¸ ğŸ¤¨ Linuxã‚«ãƒ¼ãƒãƒ«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼šsoã¾ãŸã¯dllãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã®Linuxã‚«ãƒ¼ãƒãƒ« ğŸ¤ğŸ¼ ğŸš¡ ğŸ™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã€Œã©ã“ã§ã‚‚ã©ã“ã§ã‚‚æ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®é¸æŠã«é–¢ã™ã‚‹è¨˜äº‹ã‚’èª­ã‚“ã å¾Œã€Ext4ã¯ç´ æ™´ã‚‰ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã¨ã„ã†ä¸æº€ã‚’ã‚‚ã†ä¸€åº¦è¦‹ã¾ã—ãŸãŒã€Windowsã§ã¯æ›²ç·šä¸æ­£ç¢ºãªå°‚æœ‰ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã€‚ã—ã‹ã—ã€HabrÃ©ï¼ˆå½“æ™‚ã¯Giktaymseï¼‰ãŒ Libos ã«ã¤ã„ã¦ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’é£›ã°ã—ãŸã‚‚ã†2å¹´å‰...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linuxã‚«ãƒ¼ãƒãƒ«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼šsoã¾ãŸã¯dllãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã®Linuxã‚«ãƒ¼ãƒãƒ«</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478472/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Œã©ã“ã§ã‚‚ã©ã“ã§ã‚‚æ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®é¸æŠ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«é–¢ã™ã‚‹è¨˜äº‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’èª­ã‚“ã å¾Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ã€</font></a><font style="vertical-align: inherit;">Ext4ã¯ç´ æ™´ã‚‰ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã¨ã„ã†ä¸æº€ã‚’ã‚‚ã†ä¸€åº¦è¦‹ã¾ã—ãŸãŒã€Windowsã§ã¯</font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›²ç·š</font></font></del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ­£ç¢ºãªå°‚æœ‰ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã€‚ã—ã‹ã—ã€HabrÃ©ï¼ˆå½“æ™‚ã¯Giktaymseï¼‰</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Libos </font><font style="vertical-align: inherit;">ã«ã¤ã„ã¦ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">é£›ã°ã—</font></a><font style="vertical-align: inherit;">ãŸ</font><font style="vertical-align: inherit;">ã‚‚ã†2å¹´å‰ã®ãƒ†ãƒ¼ãƒ—ã‚’å·»ãæˆ»ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚ã“ã‚Œã¯ã€é€šå¸¸ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§Linuxã‚«ãƒ¼ãƒãƒ«ã‚’å¤‰æ›ã™ã‚‹è©¦ã¿ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ç©ºé–“ã§ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚¿ãƒƒã‚¯ã®å‰Šé™¤ã«é‡ç‚¹ãŒç½®ã‹ã‚Œã¾ã—ãŸã€‚ã‹ã¤ã¦ã€ç§ã¯ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒç”Ÿãã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’èª¿ã¹ã¦ã¿ã‚‹ã“ã¨ã«æ±ºã‚ã¾ã—ãŸã€‚å½¼ã‚‰ã®ãƒ–ãƒ­ã‚°ã§ã€ã‚ã‚‹ç¨®ã®ãƒ©ã‚¤ãƒãƒ«ã§ã‚ã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux Kernel Libraryï¼ˆLKLï¼‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ãƒªãƒ³ã‚¯ã‚’è¦‹ã¤ã‘ã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚å®Ÿéš›ã€ã“ã‚Œã¯ã„ã‚ã°ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ŒPOSIX / Win32ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã¸ã®ã‚«ãƒ¼ãƒãƒ«ãƒãƒ¼ãƒˆã§ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èˆˆå‘³æ·±ã„LKLã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">ã¾ãšã€ã‚«ãƒ¼ãƒãƒ«ã®ã‚³ã‚¢ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã¯ãªãã¦ã‚‚ã€å½¼å¥³ãŒä½ã‚“ã§ã„ã‚‹ã¨ã„ã†äº‹å®Ÿã«ã‚ˆã£ã¦ã€‚</font><font style="vertical-align: inherit;">ç¬¬äºŒã«ã€ã‚«ãƒ¼ãƒãƒ«ã®å¤§éƒ¨åˆ†ã‚’è‡ªå‹•çš„ã«åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ã€Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã«å¯¾ã™ã‚‹å¤šã‹ã‚Œå°‘ãªã‹ã‚Œæ­£ç›´ãªã‚µãƒãƒ¼ãƒˆã§ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸã€ç›´æ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£-ä¾‹ãŒå«ã¾ã‚Œã¾ã™ï¼š</font></font><code>cptofs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>cpfromfs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font><code>fs2tar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font><code>lklfuse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€ãƒ›ã‚¹ãƒˆLinuxã§LKLã‚’ãƒ†ã‚¹ãƒˆã—ã€ãƒ«ãƒ¼ãƒˆãŠã‚ˆã³ä»®æƒ³ãƒã‚·ãƒ³ãªã—ã§Ext4ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆBtrfsã€XFSãªã©ï¼‰ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã€Windowsã§ã©ã®ã‚ˆã†ã«è©¦ã™ã“ã¨ãŒã§ãã‚‹ã‹ã«ã¤ã„ã¦ç°¡å˜ã«èª¬æ˜ã—ã¾ã™ã€‚</font></font></p><a name="habracut"></a><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è²¬äº‹é …1ï¼š</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è©¦ã—ã¦ã¿ãŸã„-ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã“ã‚Œã‚’è¡Œã†å ´åˆ-è‡ªåˆ†ã®å±é™ºã¨ãƒªã‚¹ã‚¯ã§ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€ã“ã“ã§ã¯å°‘ãªãã¨ã‚‚ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æœ¬å½“ã«ãƒã‚¤ãƒ†ã‚£ãƒ–ã§ã™ã€‚</font></font></p><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è²¬äº‹é …2ï¼š</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’å°Šé‡ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">LKLãƒªãƒ³ã‚¯ã¯</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠãã‚‰ã</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GPLãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font></p><br>
<h2 id="pervichnoe-znakomstvo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸»ãªçŸ¥äºº</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LKLãƒªãƒã‚¸ãƒˆãƒªï¼ˆ</font><font style="vertical-align: inherit;">GitHubã®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lkl / linux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã¯ã€é€šå¸¸ã®Linuxã‚«ãƒ¼ãƒãƒ«ã®ãƒ•ã‚©ãƒ¼ã‚¯ã§ã‚ã‚Šã€åˆ¥ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚µãƒãƒ¼ãƒˆãŒè¿½åŠ ã•ã‚Œã¦ã„</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ä¸»ã«</font></font><code>arch/lkl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‚ˆã³</font><font style="vertical-align: inherit;">ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚Š</font></font><code>tools/lkl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆã—ã€æŒ‡ç¤ºã«å¾“ã£ã¦ã‚¢ã‚»ãƒ³ãƒ–ãƒ«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">å®Ÿé¨“ã§ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã®å±¥æ­´å…¨ä½“ã§ã¯ãªãã€æŒ‡å®šã•ã‚ŒãŸæ•°ã®æœ€è¿‘ã®ã‚³ãƒŸãƒƒãƒˆã®ã¿ãŒå«ã¾ã‚Œã‚‹æµ…ã„ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font></p><br>
<pre><code class="plaintext hljs">$ git clone https://github.com/lkl/linux.git lkl-linux --depth 10<font></font>
$ cd lkl-linux<font></font>
$ patch -p 1 &lt;&lt;EOF<font></font>
diff --git a/tools/lkl/lib/hijack/xlate.c b/tools/lkl/lib/hijack/xlate.c<font></font>
index 03ccc6294..75368dcc2 100644<font></font>
--- a/tools/lkl/lib/hijack/xlate.c<font></font>
+++ b/tools/lkl/lib/hijack/xlate.c<font></font>
@@ -3,6 +3,7 @@<font></font>
 #include &lt;fcntl.h&gt;<font></font>
 #include &lt;sys/ioctl.h&gt;<font></font>
 #include &lt;sys/socket.h&gt;<font></font>
+#include &lt;linux/sockios.h&gt;<font></font>
 #undef st_atime<font></font>
 #undef st_mtime<font></font>
 #undef st_ctime<font></font>
EOF<font></font>
$ make -C tools/lkl -j4</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚½ãƒ¼ã‚¹ã‚’å°‘ã—ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€æœ€çµ‚çš„ã«ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</font></font><code>tools/lkl/lib/liblkl.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆãã—ã¦é™çš„</font><font style="vertical-align: inherit;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</font></font><code>tools/lkl/liblkl.a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">ã‚‚</font><font style="vertical-align: inherit;">å–å¾—ã—ã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nm -D tools / lkl / lib / liblkl.so</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">                 U __assert_fail<font></font>
                 U bind<font></font>
                 U calloc<font></font>
                 U clock_gettime<font></font>
                 U close<font></font>
                 w __cxa_finalize<font></font>
0000000000063b30 T dbg_entrance<font></font>
0000000000063f30 T dbg_handler<font></font>
                 U __errno_location<font></font>
                 U fcntl<font></font>
                 U fdatasync<font></font>
0000000000639580 D fd_net_ops<font></font>
                 U fgets<font></font>
                 U __fprintf_chk<font></font>
                 U free<font></font>
                 U fwrite<font></font>
                 U getc<font></font>
                 U getenv<font></font>
                 w __gmon_start__<font></font>
                 U if_nametoindex<font></font>
                 U inet_pton<font></font>
                 U ioctl<font></font>
                 U __isoc99_scanf<font></font>
                 w _ITM_deregisterTMCloneTable<font></font>
                 w _ITM_registerTMCloneTable<font></font>
0000000000061750 T jmp_buf_longjmp<font></font>
0000000000061720 T jmp_buf_set<font></font>
0000000000065470 T jsmn_init<font></font>
0000000000065060 T jsmn_parse<font></font>
0000000000065490 T jsmn_strerror<font></font>
00000000000614c0 T lkl_add_gateway<font></font>
0000000000061290 T lkl_add_neighbor<font></font>
00000000000621a0 T lkl_bug<font></font>
000000000005f070 T lkl_closedir<font></font>
0000000000639520 D lkl_dev_blk_ops<font></font>
000000000005fa10 T lkl_dirfd<font></font>
0000000000062640 T lkl_disk_add<font></font>
0000000000062780 T lkl_disk_remove<font></font>
000000000005ec50 T lkl_encode_dev_from_sysfs<font></font>
000000000005f9f0 T lkl_errdir<font></font>
000000000005ef80 T lkl_fdopendir<font></font>
0000000000067f10 T lkl_get_free_irq<font></font>
000000000005f2c0 T lkl_get_virtio_blkdev<font></font>
00000000006395c0 D lkl_host_ops<font></font>
00000000000614b0 T lkl_if_add_gateway<font></font>
00000000000613e0 T lkl_if_add_ip<font></font>
00000000000614a0 T lkl_if_add_linklocal<font></font>
0000000000061520 T lkl_if_add_rule_from_saddr<font></font>
0000000000061480 T lkl_if_del_ip<font></font>
0000000000060d70 T lkl_if_down<font></font>
0000000000060b10 T lkl_ifname_to_ifindex<font></font>
0000000000061400 T lkl_if_set_ipv4<font></font>
0000000000061530 T lkl_if_set_ipv4_gateway<font></font>
0000000000061430 T lkl_if_set_ipv6<font></font>
00000000000615b0 T lkl_if_set_ipv6_gateway<font></font>
0000000000060ef0 T lkl_if_set_mtu<font></font>
0000000000060bf0 T lkl_if_up<font></font>
0000000000061160 T lkl_if_wait_ipv6_dad<font></font>
000000000005fba0 T lkl_iomem_access<font></font>
000000000005fb50 T lkl_ioremap<font></font>
0000000000067730 T lkl_is_running<font></font>
0000000000066150 T lkl_load_config_env<font></font>
0000000000065950 T lkl_load_config_json<font></font>
0000000000066880 T lkl_load_config_post<font></font>
0000000000066510 T lkl_load_config_pre<font></font>
000000000005f470 T lkl_mount_dev<font></font>
000000000005eae0 T lkl_mount_fs<font></font>
00000000000642a0 T lkl_netdev_add<font></font>
00000000000645c0 T lkl_netdev_free<font></font>
0000000000061030 T lkl_netdev_get_ifindex<font></font>
0000000000064e70 T lkl_netdev_macvtap_create<font></font>
0000000000064ed0 T lkl_netdev_pipe_create<font></font>
0000000000064ce0 T lkl_netdev_raw_create<font></font>
00000000000644c0 T lkl_netdev_remove<font></font>
0000000000064c60 T lkl_netdev_tap_create<font></font>
0000000000064a10 T lkl_netdev_tap_init<font></font>
000000000005eea0 T lkl_opendir<font></font>
0000000000062170 T lkl_perror<font></font>
00000000000620b0 T lkl_printf<font></font>
0000000000067f90 T lkl_put_irq<font></font>
0000000000061620 T lkl_qdisc_add<font></font>
0000000000061630 T lkl_qdisc_parse_add<font></font>
000000000005f0f0 T lkl_readdir<font></font>
0000000000063f80 T lkl_register_dbg_handler<font></font>
0000000000064930 T lkl_register_netdev_fd<font></font>
000000000005efe0 T lkl_rewinddir<font></font>
000000000005fa20 T lkl_set_fd_limit<font></font>
00000000000614e0 T lkl_set_ipv4_gateway<font></font>
0000000000061500 T lkl_set_ipv6_gateway<font></font>
0000000000065f60 T lkl_show_config<font></font>
00000000004f51ad T lkl_start_kernel<font></font>
0000000000062080 T lkl_strerror<font></font>
00000000000685f0 T lkl_syscall<font></font>
0000000000062270 T lkl_sysctl<font></font>
0000000000062410 T lkl_sysctl_parse_write<font></font>
0000000000067770 T lkl_sys_halt<font></font>
00000000000680e0 T lkl_trigger_irq<font></font>
000000000005f870 T lkl_umount_dev<font></font>
000000000005edc0 T lkl_umount_timeout<font></font>
0000000000066ed0 T lkl_unload_config<font></font>
00000000008186a0 B lkl_virtio_devs<font></font>
                 U __longjmp_chk<font></font>
                 U lseek64<font></font>
                 U malloc<font></font>
                 U memchr<font></font>
                 U memcpy<font></font>
                 U memset<font></font>
                 U open<font></font>
                 U perror<font></font>
                 U pipe<font></font>
                 U poll<font></font>
0000000000064070 T poll_thread<font></font>
                 U pread64<font></font>
                 U __printf_chk<font></font>
                 U pthread_create<font></font>
                 U pthread_detach<font></font>
                 U pthread_exit<font></font>
                 U pthread_getspecific<font></font>
                 U pthread_join<font></font>
                 U pthread_key_create<font></font>
                 U pthread_key_delete<font></font>
                 U pthread_mutexattr_init<font></font>
                 U pthread_mutexattr_settype<font></font>
                 U pthread_mutex_destroy<font></font>
                 U pthread_mutex_init<font></font>
                 U pthread_mutex_lock<font></font>
                 U pthread_mutex_unlock<font></font>
                 U pthread_self<font></font>
                 U pthread_setspecific<font></font>
                 U puts<font></font>
                 U pwrite64<font></font>
                 U read<font></font>
                 U readv<font></font>
00000000008196a0 B registered_devs<font></font>
000000000005fa90 T register_iomem<font></font>
                 U sem_destroy<font></font>
                 U sem_init<font></font>
                 U sem_post<font></font>
                 U sem_wait<font></font>
                 U _setjmp<font></font>
                 U setsockopt<font></font>
                 U sigaction<font></font>
                 U sigemptyset<font></font>
                 U __snprintf_chk<font></font>
                 U socket<font></font>
                 U __stack_chk_fail<font></font>
                 U stderr<font></font>
                 U stdin<font></font>
                 U stpcpy<font></font>
                 U strchr<font></font>
                 U strcpy<font></font>
                 U __strcpy_chk<font></font>
                 U strdup<font></font>
                 U strerror<font></font>
                 U strlen<font></font>
                 U strncat<font></font>
                 U __strncat_chk<font></font>
                 U strncmp<font></font>
                 U strncpy<font></font>
                 U strrchr<font></font>
                 U strtok<font></font>
                 U strtok_r<font></font>
                 U strtol<font></font>
                 U strtoul<font></font>
                 U syscall<font></font>
                 U timer_create<font></font>
                 U timer_delete<font></font>
                 U timer_settime<font></font>
000000000005fb00 T unregister_iomem<font></font>
                 U usleep<font></font>
0000000000063110 T virtio_dev_cleanup<font></font>
0000000000062ee0 T virtio_dev_setup<font></font>
0000000000063100 T virtio_get_num_bootdevs<font></font>
0000000000062c10 T virtio_process_queue<font></font>
0000000000062af0 T virtio_req_complete<font></font>
0000000000062ec0 T virtio_set_queue_max_merge_len<font></font>
                 U __vsnprintf_chk<font></font>
                 U write<font></font>
                 U writev</code></pre></div></div><br>
<p>    ,  .  ,       <code>lkl_syscall</code>.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>syscall</code></a>  LKL.             <code>lkl_sys_&lt;name&gt;</code>.        Â«Â»,     ,     Â«Â»  ,     libc. ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>getdents</code></a>, â€¦ Â«These are not the interfaces you are interested in.Â» â€”     man-.          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>readdir (3)</code></a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>readdir (2)</code></a> â€”   ,   x86_64   .      LKL    <code>lkl_opendir</code> / <code>lkl_readdir</code> / <code>lkl_closedir</code>.</p><br>
<h2 id="poprobuem-chto-nibud-napisat"> - </h2><br>
<p><strong>,  .  Linux kernel   GPL2,   ,      LKL    â€”   .</strong></p><br>
<p> ,     . ,   <code>$LKL</code>       LKL.</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"lkl_host.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"lkl.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// lkl_host_ops      </span>
    <span class="hljs-comment">//     "-" : `printk`, `panic`, ...</span>
    <span class="hljs-comment">// ,    --    </span>
    lkl_start_kernel(&amp;lkl_host_ops, <span class="hljs-string">"mem=128M"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br>
<p>:</p><br>
<pre><code class="plaintext hljs">$ gcc test.c -o test -I$LKL/tools/lkl/include -L$LKL/tools/lkl/lib -llkl</code></pre><br>
<p>  !</p><br>
<pre><code class="plaintext hljs">$ ./test<font></font>
./test: error while loading shared libraries: liblkl.so: cannot open shared object file: No such file or directory<font></font>
$ LD_LIBRARY_PATH=$LKL/tools/lkl/lib ./test<font></font>
[    0.000000] Linux version 5.3.0+ (trosinenko@trosinenko-pc) (gcc version 9.2.1 20191008 (Ubuntu 9.2.1-9ubuntu2)) #1 Tue Dec 3 14:37:02 MSK 2019<font></font>
[    0.000000] memblock address range: 0x7fba8c000000 - 0x7fba93fff000<font></font>
[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 32319<font></font>
[    0.000000] Kernel command line: mem=128M<font></font>
[    0.000000] Dentry cache hash table entries: 16384 (order: 5, 131072 bytes, linear)<font></font>
[    0.000000] Inode-cache hash table entries: 8192 (order: 4, 65536 bytes, linear)<font></font>
[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off<font></font>
[    0.000000] Memory available: 129044k/131068k RAM<font></font>
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<font></font>
[    0.000000] NR_IRQS: 4096<font></font>
[    0.000000] lkl: irqs initialized<font></font>
[    0.000000] clocksource: lkl: mask: 0xffffffffffffffff max_cycles: 0x1cd42e4dffb, max_idle_ns: 881590591483 ns<font></font>
[    0.000000] lkl: time and timers initialized (irq1)<font></font>
[    0.000003] pid_max: default: 4096 minimum: 301<font></font>
[    0.000019] Mount-cache hash table entries: 512 (order: 0, 4096 bytes, linear)<font></font>
[    0.000022] Mountpoint-cache hash table entries: 512 (order: 0, 4096 bytes, linear)<font></font>
[    0.003622] random: get_random_bytes called from _etext+0xbcdb/0x14b05 with crng_init=0<font></font>
[    0.003692] printk: console [lkl_console0] enabled<font></font>
[    0.003707] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns<font></font>
[    0.003714] xor: automatically using best checksumming function   8regs<font></font>
[    0.003783] NET: Registered protocol family 16<font></font>
[    0.171647] raid6: int64x8  gen()  4489 MB/s<font></font>
[    0.343119] raid6: int64x8  xor()  3165 MB/s<font></font>
[    0.514836] raid6: int64x4  gen()  4668 MB/s<font></font>
[    0.689529] raid6: int64x4  xor()  3256 MB/s<font></font>
[    0.861155] raid6: int64x2  gen()  6283 MB/s<font></font>
[    1.032668] raid6: int64x2  xor()  3793 MB/s<font></font>
[    1.206752] raid6: int64x1  gen()  5185 MB/s<font></font>
[    1.378219] raid6: int64x1  xor()  2901 MB/s<font></font>
[    1.378225] raid6: using algorithm int64x2 gen() 6283 MB/s<font></font>
[    1.378227] raid6: .... xor() 3793 MB/s, rmw enabled<font></font>
[    1.378229] raid6: using intx1 recovery algorithm<font></font>
[    1.378333] clocksource: Switched to clocksource lkl<font></font>
[    1.378427] NET: Registered protocol family 2<font></font>
[    1.378516] tcp_listen_portaddr_hash hash table entries: 256 (order: 0, 4096 bytes, linear)<font></font>
[    1.378521] TCP established hash table entries: 1024 (order: 1, 8192 bytes, linear)<font></font>
[    1.378527] TCP bind hash table entries: 1024 (order: 1, 8192 bytes, linear)<font></font>
[    1.378532] TCP: Hash tables configured (established 1024 bind 1024)<font></font>
[    1.378596] UDP hash table entries: 128 (order: 0, 4096 bytes, linear)<font></font>
[    1.378618] UDP-Lite hash table entries: 128 (order: 0, 4096 bytes, linear)<font></font>
[    1.379286] workingset: timestamp_bits=62 max_order=16 bucket_order=0<font></font>
[    1.380271] SGI XFS with ACLs, security attributes, no debug enabled<font></font>
[    1.380864] io scheduler mq-deadline registered<font></font>
[    1.380872] io scheduler kyber registered<font></font>
[    1.383396] NET: Registered protocol family 10<font></font>
[    1.383763] Segment Routing with IPv6<font></font>
[    1.383779] sit: IPv6, IPv4 and MPLS over IPv4 tunneling driver<font></font>
[    1.384091] Btrfs loaded, crc32c=crc32c-generic<font></font>
[    1.384223] Warning: unable to open an initial console.<font></font>
[    1.384237] This architecture does not have kernel memory protection.<font></font>
[    1.384239] Run /init as init process</code></pre><br>
<p>    timestamp',     Â«Â»    ,     <del> </del>.</p><br>
<h2 id="uslozhnyaem-eksperiment"> </h2><br>
<p>   - -    â€” -   !    user space    Ext4-.  Â«Â» !    <code>tools/lkl/cptofs.c</code>      ( ):</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> NDEBUG</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;assert.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"lkl_host.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"lkl.h"</span></span><font></font>
<font></font>
<span class="hljs-comment">//        ,</span>
<span class="hljs-comment">//     --     :)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> fsimage = argv[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> fstype = argv[<span class="hljs-number">2</span>];
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> file_to_dump = argv[<span class="hljs-number">3</span>];<font></font>
<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">lkl_disk</span> <span class="hljs-title">disk</span>;</span>
  <span class="hljs-keyword">int</span> disk_id, ret;
  <span class="hljs-keyword">char</span> mpoint[<span class="hljs-number">128</span>];<font></font>
<font></font>
  <span class="hljs-comment">//     </span>
  <span class="hljs-built_in">memset</span>(&amp;disk, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(disk));<font></font>
  disk.fd = open(fsimage, O_RDONLY);<font></font>
  assert(disk.fd &gt;= <span class="hljs-number">0</span>);<font></font>
<font></font>
  <span class="hljs-comment">//     </span><font></font>
  disk_id = lkl_disk_add(&amp;disk);<font></font>
  assert(disk_id &gt;= <span class="hljs-number">0</span>);<font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  lkl_start_kernel(&amp;lkl_host_ops, <span class="hljs-string">"mem=128M"</span>);<font></font>
<font></font>
  <span class="hljs-comment">//     </span>
  ret = lkl_mount_dev(disk_id, <span class="hljs-number">0</span> <span class="hljs-comment">/* part */</span>, fstype,<font></font>
                      LKL_MS_RDONLY, <span class="hljs-literal">NULL</span>,<font></font>
                      mpoint, <span class="hljs-keyword">sizeof</span>(mpoint));<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"lkl_mount_dev failed: %s\n"</span>, lkl_strerror(ret));<font></font>
    close(disk.fd);<font></font>
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// ,    ...</span>
  <span class="hljs-comment">// ( -libc )</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">lkl_dir</span> *<span class="hljs-title">dir</span> = <span class="hljs-title">lkl_opendir</span>(<span class="hljs-title">mpoint</span>, &amp;<span class="hljs-title">ret</span>);</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">lkl_linux_dirent64</span> *<span class="hljs-title">dent</span>;</span>
  <span class="hljs-keyword">while</span> ((dent = lkl_readdir(dir)) != <span class="hljs-literal">NULL</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Directory entry: %s\n"</span>, dent-&gt;d_name);<font></font>
  }<font></font>
  <span class="hljs-comment">//     : NULL --     ...</span><font></font>
  lkl_closedir(dir);<font></font>
<font></font>
  <span class="hljs-comment">//   -</span>
  <span class="hljs-comment">//       </span>
  <span class="hljs-keyword">char</span> tmp[<span class="hljs-number">256</span>];
  <span class="hljs-keyword">uint8_t</span> buffer[<span class="hljs-number">65536</span>];
  <span class="hljs-built_in">snprintf</span>(tmp, <span class="hljs-keyword">sizeof</span>(tmp), <span class="hljs-string">"%s/%s"</span>, mpoint, file_to_dump);
  <span class="hljs-keyword">int</span> fd = lkl_sys_open(tmp, LKL_O_RDONLY, <span class="hljs-number">0</span>);
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"fd = %d\n"</span>, fd);<font></font>
  assert(fd &gt;= <span class="hljs-number">0</span>);
  <span class="hljs-keyword">int</span> count = lkl_sys_read(fd, buffer, <span class="hljs-keyword">sizeof</span>(buffer));
  <span class="hljs-comment">/*  */</span> write(STDERR_FILENO, buffer, count);<font></font>
  lkl_sys_close(fd);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
<p>    define'   <code>LKL_</code> (, <code>LKL_O_RDONLY</code>):  Linux- ,  ,   ,   ,      â€”  .</p><br>
<pre><code class="plaintext hljs">$ mke2fs ext4.img -t ext4 32M<font></font>
$ sudo mount ext4.img /mnt<font></font>
$ echo -e "Hello world\!\nTEST" | sudo tee /mnt/test.txt<font></font>
$ sudo umount /mnt<font></font>
$ LD_LIBRARY_PATH=$LKL/tools/lkl/lib ./read-file ext4.img ext4 test.txt<font></font>
[    0.000000] Linux version 5.3.0+ (trosinenko@trosinenko-pc) (gcc version 9.2.1 20191008 (Ubuntu 9.2.1-9ubuntu2)) #1 Tue Dec 3 14:37:02 MSK 2019<font></font>
// ... //<font></font>
[    1.378960] Warning: unable to open an initial console.<font></font>
[    1.378975] This architecture does not have kernel memory protection.<font></font>
[    1.378977] Run /init as init process<font></font>
[    1.379852] EXT4-fs (vda): mounted filesystem with ordered data mode. Opts:<font></font>
Directory entry: test.txt<font></font>
Directory entry: ..<font></font>
Directory entry: lost+found<font></font>
Directory entry: .<font></font>
fd = 0<font></font>
Hello world\!<font></font>
TEST</code></pre><br>
<p> , !  -  ?</p><br>
<pre><code class="plaintext hljs">$ mksquashfs test.c read-file.c squashfs.img<font></font>
$ LD_LIBRARY_PATH=$LKL/tools/lkl/lib ./read-file squashfs.img squashfs test.c<font></font>
[    0.000000] Linux version 5.3.0+ (trosinenko@trosinenko-pc) (gcc version 9.2.1 20191008 (Ubuntu 9.2.1-9ubuntu2)) #1 Tue Dec 3 14:37:02 MSK 2019<font></font>
// ... //<font></font>
[    1.378472] This architecture does not have kernel memory protection.<font></font>
[    1.378474] Run /init as init process<font></font>
lkl_mount_dev failed: No such device</code></pre><br>
<p>! , ,  , ,      -  SquashFS!</p><br>
<h2 id="nastraivaem-parametry-sborki-lkl">   LKL</h2><br>
<p>      ,    LKL â€” ,       <code>make defconfig</code>, <code>make menuconfig</code>, <code>make</code>.</p><br>
<pre><code class="plaintext hljs">$ make defconfig ARCH=lkl<font></font>
$ make menuconfig ARCH=lkl<font></font>
////   SquashFS     <font></font>
$ cp .config arch/lkl/configs/defconfig<font></font>
$ make mrproper<font></font>
$ make -C tools/lkl -j4 #    </code></pre><br>
<p> !</p><br>
<pre><code class="plaintext hljs">$ gcc read-file.c -o read-file -I$LKL/tools/lkl/include -L$LKL/tools/lkl/lib -llkl<font></font>
$ LD_LIBRARY_PATH=$LKL/tools/lkl/lib ./read-file squashfs.img squashfs test.c<font></font>
[    0.000000] Linux version 5.3.0+ (trosinenko@trosinenko-pc) (gcc version 9.2.1 20191008 (Ubuntu 9.2.1-9ubuntu2)) #1 Wed Dec 4 12:07:50 MSK 2019<font></font>
// ... //<font></font>
[    1.378346] This architecture does not have kernel memory protection.<font></font>
[    1.378348] Run /init as init process<font></font>
Directory entry: .<font></font>
Directory entry: ..<font></font>
Directory entry: read-file.c<font></font>
Directory entry: test.c<font></font>
fd = 0<font></font>
#include &lt;stdio.h&gt;<font></font>
<font></font>
#include "lkl_host.h"<font></font>
#include "lkl.h"<font></font>
<font></font>
int main()<font></font>
{<font></font>
    lkl_start_kernel(&amp;lkl_host_ops, "mem=128M");<font></font>
<font></font>
    return 0;<font></font>
}</code></pre><br>
<p>  , ,   <code>read-file.c</code>     â€” - .</p><br>
<h2 id="pozvolte-a-gde-obeschannye-gotovye-programmki">,     ?</h2><br>
<p> ,   <code>tools/lkl</code>  <code>cptofs.c</code>, <code>fs2tar.c</code>    ,    !   Makefile'  ,    <code>Makefile.autoconf</code>,     ,  <code>Makefile.conf</code>,    .</p><br>
<p>-, -  <code>libarchive</code>, - <code>libfuse</code> â€”   ,  <code>libarchive-dev</code>, <code>libfuse-dev</code> (  Ubuntu)  .    â€¦    <code>Makefile.conf</code>â€¦ , !</p><br>
<p>,      ?    <code>tools/lkl</code>    <code>cptofs</code>, <code>fs2tar</code>  <code>lklfuse</code>.</p><br>
<p>   <code>cptofs</code>   <code>cpfromfs</code>:</p><br>
<pre><code class="plaintext hljs">$ $LKL/tools/lkl/cptofs --help<font></font>
Usage: cptofs [OPTION...] -t fstype -i fsimage path... fs_path<font></font>
Copy files to a filesystem image<font></font>
<font></font>
  -i, --filesystem-image=string   path to the filesystem image - mandatory<font></font>
  -p, --enable-printk        show Linux printks<font></font>
  -P, --partition=int        partition number<font></font>
  -s, --selinux=string       selinux attributes for destination<font></font>
  -t, --filesystem-type=string   select filesystem type - mandatory<font></font>
  -?, --help                 Give this help list<font></font>
      --usage                Give a short usage message<font></font>
<font></font>
Mandatory or optional arguments to long options are also mandatory or optional<font></font>
for any corresponding short options.<font></font>
$ cp $LKL/tools/lkl/cp{to,from}fs<font></font>
$ $LKL/tools/lkl/cpfromfs --help<font></font>
Usage: cpfromfs [OPTION...] -t fstype -i fsimage fs_path... path<font></font>
Copy files from a filesystem image<font></font>
<font></font>
  -i, --filesystem-image=string   path to the filesystem image - mandatory<font></font>
  -p, --enable-printk        show Linux printks<font></font>
  -P, --partition=int        partition number<font></font>
  -s, --selinux=string       selinux attributes for destination<font></font>
  -t, --filesystem-type=string   select filesystem type - mandatory<font></font>
  -?, --help                 Give this help list<font></font>
      --usage                Give a short usage message<font></font>
<font></font>
Mandatory or optional arguments to long options are also mandatory or optional<font></font>
for any corresponding short options.</code></pre><br>
<p> , Â«   ...Â». ...</p><br>
<pre><code class="plaintext hljs">$ $LKL/tools/lkl/cpfromfs -t ext4 -i ext4.img test.txt .<font></font>
error processing entry /mnt/0000fe00/test.txt, aborting</code></pre><br>
<p>â€¦  â€¦ ,       ,  <strong></strong>     ,   .  <code>fs2tar</code>   :</p><br>
<pre><code class="plaintext hljs">$ $LKL/tools/lkl/fs2tar -t ext4 ext4.img ext4.tar<font></font>
$ tar -tf ext4.tar<font></font>
tar:   `/'   <font></font>
/test.txt<font></font>
/lost+found/</code></pre><br>
<p>        â€”  <code>lklfuse</code>:</p><br>
<pre><code class="plaintext hljs">$ mkdir mountpoint<font></font>
$ $LKL/tools/lkl/lklfuse -o type=ext4 ext4.img mountpoint/<font></font>
$ ls mountpoint/<font></font>
lost+found  test.txt<font></font>
$ mount<font></font>
sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime)<font></font>
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)<font></font>
...   ,      <font></font>
/dev/fuse on /run/user/1000/doc type fuse (rw,nosuid,nodev,relatime,user_id=1000,group_id=1000)<font></font>
lklfuse on /path/to/mountpoint type fuse.lklfuse (rw,nosuid,nodev,relatime,user_id=1000,group_id=1000)<font></font>
$ echo ABC &gt; mountpoint/ABC.XYZ<font></font>
$ umount mountpoint<font></font>
$ sudo mount ext4.img /mnt<font></font>
$ ls /mnt<font></font>
$ cat /mnt/ABC.XYZ<font></font>
ABC</code></pre><br>
<p>-, :    (     )     FUSE,   ,  â€”       (  )  ,      .</p><br>
<p> ,  <code>lklfuse</code>          .           .    ,  ,         OS X.</p><br>
<h2 id="nemnogo-pro-kross-platformennost">  -</h2><br>
<p>           ?  OS X, ,  : -   UNIX,    FUSE, , .    ,     .  ,       ,      LKL     <code>LKL_</code>,     .</p><br>
<p> Windows  : -,          UNIX  (,     ). -,  ,       .     â€”    FUSE. , -   Dokan,   - ,   . ,   LKL  Windows ,   ,    64-  <code>long</code>    64- ,      (  ,     readme ).</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478460/index.html">é›¨ãŒé™ã‚‰ãªã„ã§ãã ã•ã„ã€‚çµ„ã¿ç«‹ã¦ãƒ¢ãƒ‡ãƒ«ã€‚ç¥çµŒæŠ€è¡“è€…ï¼ƒ1å·¥èŠ¸å“ç ”ç©¶æ‰€ã§ä½œã‚‰ã‚ŒãŸãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒã‚¤ã‚¹</a></li>
<li><a href="../ja478462/index.html">æš—å·é€šè²¨ ICOã€IEOã€STOã€‚é‰±æ¥­ ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ï¼šãƒ­ã‚·ã‚¢ã®è¦åˆ¶ã€‚å…¨æ–‡ï¼š2014-2019</a></li>
<li><a href="../ja478464/index.html">ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã€Œãƒ™ãƒ¬ã‚·ã‚¿ã€ã‚’åˆ†æã€ã¾ãŸã¯2019å¹´4æœˆ11æ—¥ã«æœˆã®è¿‘ãã§ä½•ãŒèµ·ã“ã£ãŸã®ã‹</a></li>
<li><a href="../ja478466/index.html">ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«1,100ä¸‡ãƒ‰ãƒ«ã‚’æŠ•è³‡</a></li>
<li><a href="../ja478470/index.html">ã‚¤ãƒ³ãƒ†ãƒ«ãƒ‹ãƒ¥ãƒ¼ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã€å¤§è³-ã‚¤ãƒ³ãƒ†ãƒ«NUC</a></li>
<li><a href="../ja478474/index.html">ãƒ‘ãƒ–ãƒ­ãƒ»ã‚¨ã‚¹ã‚³ãƒãƒ¼å…„å¼Ÿã‚‚æŸ”è»Ÿãªã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸ</a></li>
<li><a href="../ja478480/index.html">äººå·¥çŸ¥èƒ½ã€ITSMã€ãã—ã¦ä¸€èˆ¬çš„ã«ã€LEANã¯ã©ã“ã«ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja478482/index.html">é–‹ç™ºè€…ã¯é–‹ç™ºè€…å‘ã‘ã«ãƒãƒ¼ã‚’é–‹ãã€Angularã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€PHPã«é–¢ã™ã‚‹ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ãƒ›ã‚¹ãƒˆã—ã¾ã™</a></li>
<li><a href="../ja478484/index.html">ãƒ©ã‚ºãƒ™ãƒªãƒ¼ã®SCADAï¼šç¥è©±ã‹ç¾å®Ÿã‹ï¼Ÿ</a></li>
<li><a href="../ja478486/index.html">10nmãƒãƒƒãƒ—ã®æ™‚ä»£-èª°ãŒãã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’é–‹ç™ºã—ã€å°†æ¥æ¥­ç•Œã«å¾…ã¡å—ã‘ã¦ã„ã‚‹ã‚‚ã®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>