<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçØ ‚ôüÔ∏è üèë Zur Frage von Apophenia, Telegonia und Time Travel (und funktioniert mit _ am Anfang) ‚öíÔ∏è ü§ï üë®‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1958 pr√§gte der deutsche Neuropsychologe Klaus Konrad den Begriff ‚ÄûApophenie‚Äú (vom lateinischen Apophen - ausdr√ºckliches Urteil, machen Sie es explizi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Zur Frage von Apophenia, Telegonia und Time Travel (und funktioniert mit _ am Anfang)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505926/"><blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1958 pr√§gte der deutsche Neuropsychologe Klaus Konrad den Begriff ‚ÄûApophenie‚Äú (vom lateinischen Apophen - ausdr√ºckliches Urteil, machen Sie es explizit; der Begriff geht auf Texte religi√∂ser Offenbarungen zur√ºck, wo er Wissen bedeutet, das au√üerhalb des Erkenntnisprozesses erlangt wurde) und implizierte damit die Eigenschaft der Psyche, die in der F√§higkeit besteht Sehen Sie Beziehungen in bedeutungslosen oder zuf√§lligen Fakten oder Daten und finden Sie Bedeutung in Zuf√§llen. Die Illusion einer sinnvollen Kommunikation. Unser Gehirn sucht st√§ndig nach Mustern, macht aber oft Fehler und es besteht ein irrationaler Wunsch, Muster dort zu sehen, wo sie nicht existieren. Ein besonderer Wunsch, Zuf√§llen und Eventualit√§ten zu gehorchen. Dies nennt man Apophenie. In der mathematischen Statistik ist dies ein Standardfehler der ersten Art. </font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nepryakhin N. "Ich manipuliere dich"</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum habe ich mich an diesen Begriff erinnert, insbesondere an eine IT-Ressource? </font><font style="vertical-align: inherit;">Denn die Suche nach Beziehungen zwischen unterschiedlichen Fakten beim Debuggen von Programmen ist einer der Hauptfaktoren f√ºr den Erfolg. </font><font style="vertical-align: inherit;">Eine Reihe von zuf√§lligen Ungenauigkeiten in der Arbeit, von denen jede nicht die Gr√ºnde f√ºr ihr Auftreten aufzeigt und die Funktionsweise des gesamten Programms nicht beeintr√§chtigt, mag chaotisch erscheinen. </font><font style="vertical-align: inherit;">Wenn Sie jedoch versuchen, eine Beziehung zwischen ihnen zu finden, k√∂nnen Sie viele Probleme sofort mit einer Codezeile l√∂sen ... Oder stellen Sie sicher, dass die Beziehung nichts anderes als ein Gedankenspiel ist, ein Produkt der Fantasie des Entwicklers.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 1. "Agent und Koordinator"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles begann w√§hrend der Entwicklung eines Agentenprogramms, das eine Reihe von Aufgaben auf einem Remote-Server ausf√ºhrt und √ºber einen Client-Server-Mechanismus eine Liste von Aufgaben empf√§ngt. Der Agent hat den Server an Port 34002 angehoben, einen lokalen Koordinator, der mit ihm verbunden ist. Er hat die gegenseitige Autorisierung √ºberpr√ºft. Wenn alles gut gelaufen ist, hat der Agent die erforderlichen Aktionen ausgef√ºhrt und sich an die Spitze gemeldet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/mz/kl/trmzklssjskomt-sxqhxfdpbihq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vereinfachtes Schema des Programms</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ein offensichtlicher Schritt des Agenten bestand darin, eine eigene Verzweigung zu erstellen, in der alle Funktionen der exec-Familie ausgef√ºhrt werden k√∂nnen, um den Prozess durch das gestartete Programm zu ersetzen. In diesem Fall erhielt der Agent die PID des Prozesses, die es ihm erm√∂glichte, auf seinen Abschluss zu warten oder ihn gewaltsam zu beenden. Damit der Koordinator jedoch einen Bericht √ºber die geleistete Arbeit erhalten konnte, war es gut, die Schlussfolgerungen von stdout und stderr zur√ºckzugeben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Problem kann durch verschiedene Methoden gel√∂st werden: √úbergeben Sie den Prozess new (dup2) FD f√ºr stdout und stderr und lesen Sie sie dann im √ºbergeordneten Prozess. leite stderr nach stdout um und benutze popen; √úberschreiben Sie die Deskriptoren stdout und stderr als Dateien und lesen Sie sie, wenn Sie fertig sind. Wir haben uns f√ºr die letztere Methode entschieden, da das Lesen mit der ersten Methode zus√§tzlichen Code und Synchronisation erfordert (und wenn Sie diese nach Erreichen von 2 MB nicht kontinuierlich lesen, wird die Aufzeichnung gestoppt, wenn der Pipe-Puffer ersch√∂pft ist), und mit der zweiten haben wir die Unterscheidung zwischen stdout und stderr verloren. Daher wurde die einfachste Methode gew√§hlt - stdout und stderr f√ºr einen neuen Prozess zu schlie√üen und dann Dateien √ºber open zu √∂ffnen, wo wir unsere Ausgabe √ºberschreiben m√∂chten. Laut der Dokumentation f√ºr open wird der minimal verf√ºgbare FD-Index verwendet, weshalb der Code einfach und elegant ist:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> pid = fork();
<span class="hljs-keyword">switch</span> (pid) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">-1</span> :
        <span class="hljs-keyword">return</span> BADFORK;
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span> :<font></font>
        close(<span class="hljs-built_in">stdout</span>);<font></font>
        close(<span class="hljs-built_in">stderr</span>);<font></font>
        open(fileout, O_CREAT | O_WRONLY, <span class="hljs-number">0777</span>);<font></font>
        open(fileerr, O_CREAT | O_WRONLY, <span class="hljs-number">0777</span>);<font></font>
        execve(arguments[<span class="hljs-number">0</span>], arguments, environ);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    <span class="hljs-keyword">default</span> :
        <span class="hljs-keyword">return</span> pid;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der vereinfachte Code sieht folgenderma√üen aus (Fehlerpr√ºfung auf Lesbarkeit entfernt). </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code wurde gestartet, die Befehlsausgabe wurde erfolgreich in die Datei geschrieben, sie wurde abgeschlossen und war bereit, an "Kampf" -Systemen zu arbeiten. </font><font style="vertical-align: inherit;">Oder nicht? </font><font style="vertical-align: inherit;">In der Testphase trat ein kleiner Fehler auf, der die M√∂glichkeit einer Zeitreise (oder zumindest einer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegraphie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">"bewies" </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 2. "Telegonia"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Sache war folgende: Nach Abschluss des Programms und auch nach Abschluss des Agenten selbst wurde in der Datei die folgende Zeile gefunden, die die Ausgabe des gestarteten Programms enthalten sollte (zu dem wir die Standardausgabe des untergeordneten Programms umleiten):</font></font><br>
<br>
<pre><code class="plaintext hljs">[2020-06-05 16:58:49]      :34002</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warte eine Minute! Dies ist jedoch eine Zeile aus der Ausgabe des Agenten selbst - dem √ºbergeordneten Prozess, der fork () aufgerufen hat! Dar√ºber hinaus zeigt der Agent diese Zeile einige Zeit nach dem Ende des aufgerufenen Programms an! Wie kann der Rest der Ausgabe des Agenten in stdout geschrieben werden, und eine der Zeilen kann in eine Datei gelangen. Die Arbeit des Agenten besteht darin, sie zu lesen, nachdem waitpid abgeschlossen ist. Vielleicht f√ºhrt ein Fehler beim Lesen einer Datei zu einem besch√§digten Speicher?</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _exec_readfile(struct frs_json * target, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * filename) {<font></font>
    FILE * fp;<font></font>
    <span class="hljs-keyword">char</span> linebuff[VEN_PIPE_READ_SIZE + <span class="hljs-number">1</span>] = { <span class="hljs-number">0</span> };<font></font>
    fp = fopen(filename, <span class="hljs-string">"r"</span>);
    <span class="hljs-keyword">if</span> (!fp)<font></font>
        frs_err(<span class="hljs-string">" \"%s\"    "</span>, filename);
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">while</span>(fgets(linebuff, VEN_PIPE_READ_SIZE, fp))<font></font>
            frs_json_string(target, <span class="hljs-literal">NULL</span>, bxi_strtrimr(linebuff));<font></font>
    }<font></font>
    fclose(fp);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint nichts zu sein, was die Erinnerung √ºbertreffen k√∂nnte (frs_ * werden durch Tests abgedeckt). </font><font style="vertical-align: inherit;">Wie wirkt sich dieser fp auf die Agentenausgabe aus, die einige Minuten nach Ausf√ºhrung dieser Funktion erfolgt? </font><font style="vertical-align: inherit;">Nat√ºrlich eine Art Telegraphie - sie haben die Datei zum Lesen ber√ºhrt, und nach 9 Monaten erhalten wir eine Zeile vom "ersten Partner". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9g/pv/c7/9gpvc7fjwrn55pggacmexfxbohm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mein FD wurde von einem Zebra ber√ºhrt.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Valgrind fand keine Probleme, was uns etwas ver√§rgerte. </font><font style="vertical-align: inherit;">Schlie√ülich sahen seine allm√§chtigen Analysatoren keinen Speicherzugriffsfehler, sondern verbrachten nur viel Zeit vergeblich mit der Analyse. </font><font style="vertical-align: inherit;">Oder nicht umsonst? </font><font style="vertical-align: inherit;">Wenn kein Speicherzugriffsfehler vorliegt, handelt es sich um einen logischen Fehler. </font><font style="vertical-align: inherit;">Aber welcher logische Fehler k√∂nnte zu einem solchen Effekt f√ºhren?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 3. "Zwei Server"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Zwischenzeit wurde ein zweiter Fehler gefunden. </font><font style="vertical-align: inherit;">W√§hrend des Starts unter QtCreator-Debugging (wir verwenden es als Entwicklungsumgebung, das C-Projekt selbst) wurden alle mit dem Programm verbundenen Prozesse erfolgreich abgeschlossen, und dieser Fehler trat nicht auf. </font><font style="vertical-align: inherit;">Es hat sich jedoch gelohnt, das Programm direkt zu starten und dann (mit legalen Methoden) zu beenden, da es ein zweites Mal nicht mehr gestartet wurde.</font></font><br>
<br>
<pre><code class="plaintext hljs">^C[2020-06-05 16:58:46]    "Interrupt",   <font></font>
[2020-06-05 16:58:49]      :34002<font></font>
[2020-06-05 16:58:49]      :34002<font></font>
[2020-06-05 16:58:49]      :34002<font></font>
[2020-06-05 16:58:49]     <font></font>
[2020-06-05 16:58:50]      </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war genau richtig, an kleine Gremlins zu denken, die den Programmmechanismus von innen zerst√∂ren und einen Teil des Programms und dann den anderen brechen. </font><font style="vertical-align: inherit;">Aber das Flair des Programmierers deutete darauf hin, dass es eine Beziehung zwischen diesen Fehlern gab. </font><font style="vertical-align: inherit;">Welcher? </font><font style="vertical-align: inherit;">Wer wei√ü, aber deshalb ist es nicht umsonst! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellte sich heraus, dass es einfach war, die Ursache f√ºr den Startfehler zu finden. </font><font style="vertical-align: inherit;">Es gen√ºgte, sich die Systemprotokolle des Programms anzusehen, in denen der Grund klar und deutlich definiert war:</font></font><br>
<br>
<pre><code class="plaintext hljs">[2020-06-06 14:40:12] frs_socket_bind  :34002   ("Address already in use" (98))<font></font>
[2020-06-06 14:40:12]      :34002<font></font>
[2020-06-06 14:40:12] ven_server_start     </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie ist es bereits gestartet? </font><font style="vertical-align: inherit;">Wer hat gestartet? </font><font style="vertical-align: inherit;">Du bist vor einer Minute zu Ende gegangen!</font></font><br>
<br>
<pre><code class="plaintext hljs">$ ps aux | grep vento<font></font>
alex     14144  0.0  0.0 156780  7212 pts/0    Sl+  14:39   0:00 ./vento</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wirklich ins Leben gerufen. </font><font style="vertical-align: inherit;">Aber vielleicht nur ein Unfall?</font></font><br>
<br>
<pre><code class="plaintext hljs">kill -9 14144</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wieder startet das Programm, aber nach dem Ende des Programms bleibt der Prozess, der Port 34002 besitzt, bestehen:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ lsof -i | grep 34002<font></font>
vento     14144 alex    3u  IPv4 12275384      0t0  TCP *:34002 (LISTEN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wer endet dann? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie die Ausgabe von lsof -i zur Laufzeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir starten:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ lsof -i | grep 34002<font></font>
vento     151640 alex    3u  IPv4 12275384      0t0  TCP *:34002 (LISTEN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, ein Socket, ein Server </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ein Reich</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="plaintext hljs">$ lsof -i | grep 34002<font></font>
_Postman  25078 alex  104u  IPv4 12885232      0t0  TCP localhost:46154-&gt;localhost:34002 (ESTABLISHED)<font></font>
vento     27468 alex    3u  IPv4 12890254      0t0  TCP *:34002 (LISTEN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist der Client damit verbunden und setzt einen Befehl ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber was ist das?</font></font><br>
<br>
<pre><code class="plaintext hljs">$ lsof -i | grep 34002<font></font>
_Postman  25078 alex  104u  IPv4 12885232      0t0  TCP localhost:46154-&gt;localhost:34002 (ESTABLISHED)<font></font>
vento     27468 alex    3u  IPv4 12890254      0t0  TCP *:34002 (LISTEN)<font></font>
vento     27506 alex    3u  IPv4 12890254      0t0  TCP *:34002 (LISTEN)<font></font>
vento     27506 alex    4u  IPv4 12890329      0t0  TCP localhost:34002-&gt;localhost:46154 (ESTABLISHED)</code></pre><br>
<img src="https://habrastorage.org/webt/wp/wq/62/wpwq62hwasqdflzz9bxomgjvebq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterhaltsame Tatsache # 197766: Fr√ºher oder sp√§ter sollte ein Verweis auf Star Wars erscheinen.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Zwei Server-Ports? </font><font style="vertical-align: inherit;">Trotz der Tatsache, dass unser Server das REUSEPORT-Flag nicht verwendet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 4. ‚ÄúCLOEXEC‚Äù</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm ... Vielleicht fehlt das CLOEXEC-Flag in der Server-Implementierung? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns die Flagge genauer an:</font></font><br>
<br>
<pre><code class="plaintext hljs">$man fork<font></font>
       *  The child process is created  with  a  single  thread‚Äîthe  one  that<font></font>
          called  fork().   The  entire virtual address space of the parent is<font></font>
          replicated in the child, including the states of mutexes,  condition<font></font>
          variables,  and other pthreads objects; the use of pthread_atfork(3)<font></font>
          may be helpful for dealing with problems that this can cause.<font></font>
<font></font>
       *  The child inherits copies of the parent's set of open file  descrip‚Äê<font></font>
          tors.   Each  file  descriptor  in the child refers to the same open<font></font>
          file description (see open(2)) as the corresponding file  descriptor<font></font>
          in  the parent.  This means that the two file descriptors share open<font></font>
          file status flags, file offset,  and  signal-driven  I/O  attributes<font></font>
          (see the description of F_SETOWN and F_SETSIG in fcntl(2)).<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durch Aufrufen der Funktion fork () wird eine Kopie des aktuellen Threads des Prozesses und eine Kopie jedes ge√∂ffneten Prozessdeskriptors erstellt (und da auf UNIX [-√§hnlichen] Systemen ‚Äûalles eine Datei ist‚Äú, werden Netzwerkdeskriptoren zusammen mit Dateideskriptoren geneigt).</font></font><br>
<br>
<pre><code class="plaintext hljs">$man exec<font></font>
       The exec() family of functions replaces the current process image with a new process image.  The functions described in<font></font>
       this manual page are front-ends for execve(2).  (See the manual page  for  execve(2)  for  further  details  about  the<font></font>
       replacement of the current process image.)</code></pre><br>
<pre><code class="plaintext hljs">$man execve<font></font>
       *  By  default,  file  descriptors  remain open across an execve().  File descriptors that are marked close-on-exec are<font></font>
          closed; see the description of FD_CLOEXEC in fcntl(2).  (If a file descriptor is closed, this will cause the release<font></font>
          of  all record locks obtained on the underlying file by this process.  See fcntl(2) for details.)  POSIX.1 says that<font></font>
          if file descriptors 0, 1, and 2 would otherwise be closed after a successful execve(), and the  process  would  gain<font></font>
          privilege because the set-user-ID or set-group_ID mode bit was set on the executed file, then the system may open an<font></font>
          unspecified file for each of these file descriptors.  As a general principle, no portable  program,  whether  privi‚Äê<font></font>
          leged or not, can assume that these three file descriptors will remain closed across an execve().</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der aufgerufene Prozess keine Kopie des Deskriptors erhalten soll, m√ºssen wir das Flag FD_CLOEXEC / SOCK_CLOEXEC darauf setzen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Allgemeinen w√§re es logisch, wenn es mit Tags markiert wurde , </font><font style="vertical-align: inherit;">dass man , </font><font style="vertical-align: inherit;">um zu vermeiden Leckage in root-Zugriff auf </font><font style="vertical-align: inherit;">Dateien, aber die Fahne erscheint kopieren will in POSIX-2001, so jetzt ist es unser Erbe, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obwohl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">umstritten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br>
<pre><code class="cpp hljs">server-&gt;socket = socket(AF_INET, SOCK_STREAM | SOCK_CLOEXEC, <span class="hljs-number">0</span>);</code></pre><br>
<pre><code class="cpp hljs">fcntl(client, F_SETFD, FD_CLOEXEC);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nein, unsere Flags sind jedoch so gesetzt, wie sie sollten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was passiert dann? </font><font style="vertical-align: inherit;">Ignoriert der Kernel das Flag? </font><font style="vertical-align: inherit;">Jemand, der ihn fallen l√§sst? </font><font style="vertical-align: inherit;">Und vor allem, warum bleibt der Prozess, der den Port belegt, nach Abschluss der Anwendung im System? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, den Hauptserver zu schlie√üen und mit gdb eine Verbindung zum verbleibenden Prozess herzustellen:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ sudo gdb -p 27506<font></font>
GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git<font></font>
[...]<font></font>
Reading symbols from /lib/x86_64-linux-gnu/libgcc_s.so.1...(no debugging symbols found)...done.<font></font>
0x00007f503d50c9f3 in futex_wait_cancelable (private=[optimized out], expected=0, futex_word=0x55f485d383b8)<font></font>
    at ../sysdeps/unix/sysv/linux/futex-internal.h:88<font></font>
88	../sysdeps/unix/sysv/linux/futex-internal.h:     .<font></font>
(gdb) bt<font></font>
#0  0x00007f503d50c9f3 in futex_wait_cancelable (private=[optimized out], expected=0, futex_word=0x55f485d383b8)<font></font>
    at ../sysdeps/unix/sysv/linux/futex-internal.h:88<font></font>
#1  __pthread_cond_wait_common (abstime=0x0, mutex=0x55f485d38368, cond=0x55f485d38390) at pthread_cond_wait.c:502<font></font>
#2  __pthread_cond_wait (cond=0x55f485d38390, mutex=0x55f485d38368) at pthread_cond_wait.c:655<font></font>
#3  0x00007f503d948097 in _frs_signal_wait (signal=0x55f485d38340, filename=0x7f503d7315c8 "fen_server.c", fileline=298)<font></font>
    at ./projects/shared/libforseti/code/thread/frs_signal.c:250<font></font>
#4  0x00007f503d728044 in _server_wait (server=0x55f485d38270) at ./projects/shared/libfenrir/code/server/fen_server.c:298<font></font>
#5  0x00007f503d72822d in fen_server_free (server=0x55f485d38270) at ./projects/shared/libfenrir/code/server/fen_server.c:351</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stop stop stop, welcher server_free? </font><font style="vertical-align: inherit;">Haben wir den falschen Prozess abgeschlossen? </font><font style="vertical-align: inherit;">Immerhin sollte hier der Start der Echo-Anwendung sein! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oder sollte es nicht sein?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel 5. "Ein Zeichen"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir senden das String-Echo, aber Sie m√ºssen den vollst√§ndigen Pfad zur Anwendung in exec angeben, da wir ihn im Gegensatz zum gleichen System nicht in der Shell-Umgebung ausf√ºhren. </font><font style="vertical-align: inherit;">Wechseln Sie zu / bin / echo und stellen Sie fest, dass das Problem behoben ist. </font><font style="vertical-align: inherit;">Aber dann stellt sich heraus, dass wir, wenn wir den Befehl geben, der aus Sicht von exec falsch ist, weiterhin im selben Prozess arbeiten und ihn nicht durch eine laufende Anwendung ersetzen, was bedeutet, dass ...</font></font><br>
<br>
<pre><code class="cpp hljs">        execve(arguments[<span class="hljs-number">0</span>], arguments, environ);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun ja, der Ausgang ist fertig. </font><font style="vertical-align: inherit;">Aber wie wird der Server dadurch heruntergefahren?</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*! \brief   */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _free(<span class="hljs-keyword">void</span>) __attribute__((destructor));
<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _free(<span class="hljs-keyword">void</span>) {<font></font>
    fen_server_free(g_server);<font></font>
    frs_inf(<span class="hljs-string">"   "</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt passte alles zusammen. </font><font style="vertical-align: inherit;">Diese beiden Fehler waren wirklich miteinander verbunden, und jetzt k√∂nnen Sie sogar genau sagen, wie: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g0/sk/-s/g0sk-sf74ratdovfkkoqny7ongu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, es bleibt, das falsch funktionierende System zu beheben. </font><font style="vertical-align: inherit;">Und wir werden es wie in einem Witz √ºber den Fernsehmeister und einem Treffer mit einem Hammer tun: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dem Wort exit </font><b><font style="vertical-align: inherit;">ein</font></b><font style="vertical-align: inherit;"> "_" </font><b><font style="vertical-align: inherit;">-Symbol hinzu</font></b><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> pid = fork();
<span class="hljs-keyword">switch</span> (pid) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">-1</span> :
        <span class="hljs-keyword">return</span> BADFORK;
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span> :<font></font>
        close(<span class="hljs-built_in">stdout</span>);<font></font>
        close(<span class="hljs-built_in">stderr</span>);<font></font>
        open(fileout, O_CREAT | O_WRONLY, <span class="hljs-number">0777</span>);<font></font>
        open(fileerr, O_CREAT | O_WRONLY, <span class="hljs-number">0777</span>);<font></font>
        execve(arguments[<span class="hljs-number">0</span>], arguments, environ);<font></font>
        _exit(EXIT_FAILURE);<font></font>
    <span class="hljs-keyword">default</span> :
        <span class="hljs-keyword">return</span> pid;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was passiert gerade? </font><font style="vertical-align: inherit;">Nichts Besonderes, au√üer dass der Beendigungsprozess jetzt endet, ohne die √ºber atexit registrierten Funktionen aufzurufen. </font><font style="vertical-align: inherit;">Bei √§lteren glibc-Implementierungen ist dies ein Aufruf des Systemaufrufs _exit, bei neueren wird exit_group aufgerufen, um alle Programmthreads korrekter abzuschlie√üen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, beide Bugs wurden besiegt und Sie sagten "Apofenia", "Sie wundern sich nur", "es gibt keine Verbindung". </font><font style="vertical-align: inherit;">Ich werde </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kiste im Regal </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">bewegen</font></a><font style="vertical-align: inherit;"> , sonst fliegt die Menschheit nicht mehr in den Weltraum.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de505896/index.html">Sicherheitswoche 24: Zoom und mutiger Browser-Datenschutz</a></li>
<li><a href="../de505898/index.html">Claude Shannon: Allesk√∂nner, Joker und Vater der Informationstheorie</a></li>
<li><a href="../de505900/index.html">Pers√∂nliche Sucht: 40 mm in voller Gr√∂√üe, ohne Draht, 72 Stunden lang f√ºr 8000 Rubel</a></li>
<li><a href="../de505904/index.html">JUG Ru Group # 5 Online Stream Woche</a></li>
<li><a href="../de505906/index.html">Walkthrough Bandit von offenhewire.org</a></li>
<li><a href="../de505928/index.html">Warum funktionale Programmierung so kompliziert ist</a></li>
<li><a href="../de505946/index.html">Speichern von Bildern mit Django / Django REST</a></li>
<li><a href="../de505954/index.html">Alpine.js - Ereignisse und globales Data Warehouse</a></li>
<li><a href="../en486014/index.html">SLAC Tour: US Department of Energy National Accelerator Laboratory at Stanford</a></li>
<li><a href="../en486018/index.html">Session Survey Results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>