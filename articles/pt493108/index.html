<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤵🏼 👨‍🚀 🏛️ Cloudflare seleciona processadores AMD para servidores de ponta da décima geração 🤱🏽 🥨 🏰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mais de um bilhão de endereços IP exclusivos passam diariamente pela Cloudflare Network; Atende a mais de 11 milhões de solicitações HTTP por segundo;...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cloudflare seleciona processadores AMD para servidores de ponta da décima geração</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493108/"><img src="https://habrastorage.org/getpro/habr/post_images/536/952/a76/536952a764f14e82b44b8765e9c63737.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais de um bilhão de endereços IP exclusivos passam diariamente pela Cloudflare Network; Atende a mais de 11 milhões de solicitações HTTP por segundo; está localizado a uma distância não superior a 100 ms de 95% da população da Internet. Nossa rede abrange 200 cidades em mais de 90 países e nossa equipe de engenharia construiu uma infraestrutura extremamente rápida e confiável. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos muito orgulho do nosso trabalho e estamos comprometidos em ajudar a tornar a Internet melhor e mais segura. Os engenheiros da Cloudflare, cujo trabalho está relacionado ao hardware, são versados ​​em servidores e seus componentes, a fim de entender e escolher o melhor equipamento para maximizar sua eficiência.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa pilha de software lida com computação de alta carga e depende muito da velocidade da CPU, e é por isso que nossos engenheiros precisam otimizar constantemente a eficiência e a confiabilidade do Cloudflare em todos os níveis da pilha. </font><font style="vertical-align: inherit;">No lado do servidor, a maneira mais fácil é aumentar o poder da computação adicionando núcleos de CPU. </font><font style="vertical-align: inherit;">Quanto mais núcleos você puder caber em um servidor, mais ele poderá processar dados. </font><font style="vertical-align: inherit;">Isso é importante para nós, pois a diversidade de nossos produtos e clientes cresce com o tempo e o crescimento de solicitações exige que os servidores aumentem a produtividade. </font><font style="vertical-align: inherit;">Para aumentar sua produtividade, precisávamos aumentar a densidade dos núcleos - e é exatamente isso que realizamos. </font><font style="vertical-align: inherit;">Abaixo, fornecemos detalhes dos dados do processador para servidores que implantamos desde 2015, incluindo o número de núcleos:</font></font><br>
<a name="habracut"></a><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 6</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 7</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 8</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 9</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Início do trabalho</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2015</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2016</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2017</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon E5-2630 v3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon E5-2630 v4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon Silver 4116</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon Platinum 6162</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Núcleos físicos</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 10</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 12</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 24</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 150W</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP por núcleo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10,65W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8,50W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.08W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,25W</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2018, demos um grande salto no número total de núcleos por servidor com a 9ª geração. </font><font style="vertical-align: inherit;">O impacto ambiental foi reduzido em 33% em comparação com a 8ª geração, o que nos deu a oportunidade de aumentar o volume e a capacidade de computação por rack. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> requisitos de projeto </font><font style="vertical-align: inherit;">TDP ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Thermal Design Power</font></a><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">são </font><font style="vertical-align: inherit;">mencionados para enfatizar que nossa eficiência energética também aumentou ao longo do tempo. </font><font style="vertical-align: inherit;">Este indicador é importante para nós: primeiro, queremos emitir menos carbono na atmosfera; </font><font style="vertical-align: inherit;">segundo, queremos fazer o melhor uso da energia dos data centers. </font><font style="vertical-align: inherit;">Mas sabemos o que devemos nos esforçar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa principal métrica de definição é o número de solicitações por watt. Podemos aumentar o número de solicitações por segundo adicionando núcleos, mas precisamos permanecer dentro do nosso orçamento de energia. Estamos limitados pela infraestrutura de energia dos datacenters, que, juntamente com nossos módulos de distribuição de energia selecionados, nos fornece um certo limite superior para cada rack de servidor. Adicionar servidores a um rack aumenta o consumo de energia. Os custos operacionais aumentarão drasticamente se formos além do limite de energia de um rack e precisarmos adicionar novos racks. Precisamos aumentar o poder de computação, permanecendo na mesma faixa de energia, o que aumentará o número de solicitações por watt - nossa principal métrica.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você deve ter adivinhado, estudamos cuidadosamente o consumo de energia na fase de projeto. </font><font style="vertical-align: inherit;">A tabela acima mostra que não devemos perder tempo implantando CPUs com maior consumo de energia, se o TDP por núcleo for superior à geração atual - isso afetará negativamente nossa métrica, o número de solicitações por watt. </font><font style="vertical-align: inherit;">Examinamos cuidadosamente os sistemas prontos para operação de nossa geração X no mercado e tomamos uma decisão. </font><font style="vertical-align: inherit;">Estamos saindo do nosso circuito com 48 núcleos Intel Xeon Platinum 6162 e dois soquetes para um AMD EPYC 7642 de 48 núcleos com um soquete.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d3c/162/8f5/d3c1628f5dfb45681f0fb25abce76b3e.jpg"><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AMD</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xeon Platinum 6162</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPYC 7642</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microarquitetura</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Skylake" </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Zen 2"</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nome de código</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skylake SP é seu negócio?</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Roma" </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processo tecnológico</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14nm</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7nm</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cores</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 24</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48.</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frequência</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,9 GHz</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,4 GHz</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache / soquete L3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24 x 1.375MiB</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16 x 16MiB</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memória / soquete</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 canais, até DDR4-2400</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 canais, até DDR4-3200</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 150W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">225W</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCIe / soquete</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48 pistas</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 pistas</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É UM</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86-64</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86-64</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelas especificações, fica claro que o chip da AMD nos permitirá deixar o mesmo número de núcleos, diminuindo o TDP. </font><font style="vertical-align: inherit;">Na 9a geração, o TDP por núcleo foi de 6,25 watts e na Xa geração será de 4,69 watts. </font><font style="vertical-align: inherit;">Uma redução de 25%. </font><font style="vertical-align: inherit;">Devido ao aumento da frequência e, possivelmente, um circuito mais simples com um soquete, podemos assumir que o chip da AMD se mostrará melhor nos negócios. </font><font style="vertical-align: inherit;">Enquanto estamos realizando vários testes e simulações para entender o desempenho da AMD.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto isso, observamos que o TDP é uma métrica simplificada das especificações do fabricante, que usamos nos estágios iniciais do design do servidor e da seleção da CPU. </font><font style="vertical-align: inherit;">Uma rápida pesquisa no Google demonstra que a AMD e a Intel têm abordagens diferentes para a definição de TDP, razão pela qual essa especificação não é confiável. </font><font style="vertical-align: inherit;">O consumo real de energia da CPU e, mais importante, o consumo de energia do servidor, é o que realmente usamos quando tomamos a decisão final.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparação do ecossistema</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No início de nossa jornada para escolher o próximo processador, estudamos uma grande variedade de CPUs de diferentes fabricantes que eram adequadas para a nossa pilha e serviços de software (escritos em C, LuaJIT e Go). Já descrevemos em detalhes um conjunto de ferramentas para medir a velocidade </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em um artigo em nosso blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nesse caso, usamos o mesmo conjunto - ele permite avaliar a eficácia da CPU em um tempo razoável, após o qual nossos engenheiros podem começar a adaptar nossos programas a um processador específico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testamos vários processadores com um número diversificado de núcleos, soquetes e frequências. Como estamos descrevendo o motivo pelo qual optamos pelo AMD EPYC 7642 neste artigo, todos os gráficos deste blog se concentram no desempenho dos processadores AMD em comparação com o Intel Xeon Platinum 6162 da</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nossa 9ª geração</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os resultados correspondem às medições da operação de um servidor com cada variante de processador - ou seja, com dois processadores de 24 núcleos da Intel ou com um processador de 48 núcleos da AMD (servidor para Intel com dois soquetes e servidor para AMD EPYC com um). </font><font style="vertical-align: inherit;">No BIOS, definimos os parâmetros correspondentes aos servidores em funcionamento. </font><font style="vertical-align: inherit;">Estes são 3,03 GHz para AMD e 2,5 GHz para Intel. </font><font style="vertical-align: inherit;">Simplificando bastante, esperamos que, com o mesmo número de núcleos, a AMD mostre resultados 21% melhores que a Intel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criptografia</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/eb4/843/287/eb484328713741f6688d81c15a9c5920.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/598/82b/416/59882b416feabd9eea86ea9d99d1e1df.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece promissor para a AMD. </font><font style="vertical-align: inherit;">Funciona 18% melhor na criptografia de chave pública. </font><font style="vertical-align: inherit;">Com uma chave simétrica, perde para as opções de criptografia AES-128-GCM, mas em geral se mostra comparável.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compressão</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos servidores de borda, compactamos muitos dados para economizar largura de banda e aumentar a velocidade da entrega de conteúdo. </font><font style="vertical-align: inherit;">Passamos dados pelas bibliotecas zlib e brotli C. </font><font style="vertical-align: inherit;">Todos os testes foram realizados no arquivo HTML blog.cloudflare.com na memória. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fdc/bf7/ae1/fdcbf7ae1109d02a45b2ca40fe353376.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ccc/427/983/ccc427983ceb85dbf63bab614850692f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A AMD ganhou uma média de 29% ao usar o gzip. </font><font style="vertical-align: inherit;">No caso do brotli, os resultados são ainda melhores em testes com qualidade 7, que usamos para compactação dinâmica. </font><font style="vertical-align: inherit;">Ocorre uma queda acentuada no teste brotli-9 - atribuímos isso ao fato de que Brotli consome muita memória e sobrecarrega o cache. </font><font style="vertical-align: inherit;">No entanto, a AMD vence por uma ampla margem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitos de nossos serviços estão escritos em Go. </font><font style="vertical-align: inherit;">Nos gráficos a seguir, verificamos novamente as taxas de criptografia e compactação no Go with RegExp em linhas de 32 KB usando a biblioteca de strings.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir criptografia</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/78a/ab0/495/78aab0495309cefee6f30bac835ee961.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vá compressão</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/f99/2cb/95d/f992cb95d4913a2d19808d4bd15b5b54.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/850/e7c/f55/850e7cf5586f693dd14d62f70510f681.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir regexp</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/b58/798/6cb/b587986cbab94ca7087364a949f09aa4.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/444/e76/f72/444e76f72c1ec2e93c4cae0c5bd386f2.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir strings</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/3e9/984/19a/3e998419adb450f598e0f3d82de01aa1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A AMD mostra os melhores resultados em todos os testes com o Go, exceto o sinal ECDSA P256, onde está 38% atrás - o que é estranho, considerando que apresentou resultados 24% melhores em C. </font><font style="vertical-align: inherit;">Vale a pena descobrir o que está acontecendo lá. </font><font style="vertical-align: inherit;">Mas, em geral, a AMD não ganha muito, mas ainda mostra os melhores resultados.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luajit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Costumamos usar LuaJIT na pilha. </font><font style="vertical-align: inherit;">Esta é a cola que contém todas as partes do Cloudflare. </font><font style="vertical-align: inherit;">E estamos felizes que a AMD tenha vencido aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, os testes mostram que o EPYC 7642 tem desempenho melhor que dois Xeon Platinum 6162. A AMD perde em um par de testes - por exemplo, AES-128-GCM e Go OpenSSL ECDSA-P256 Sign - no entanto, vence em todos os outros, em média, 25% .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulação de carga de trabalho</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após nossos testes expressos, executamos o servidor através de outro conjunto de simulações em que a carga sintética é aplicada à pilha de borda do software. Aqui simulamos uma carga de trabalho de scripts com vários tipos de consultas que podem ser encontradas no trabalho real. As solicitações variam em termos de volume de dados, protocolos HTTP ou HTTPS, WAF, fontes Workers e outras de uma variedade de variáveis. Abaixo está uma comparação da taxa de transferência das duas CPUs para os tipos de solicitações que encontramos com mais freqüência.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/594/dbb/4cf/594dbb4cf570a1c22ff666d592884ef7.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os resultados no diagrama são medidos pelos indicadores básicos da 9ª geração de máquinas com processadores Intel, normalizados para um valor de 1,0 ao longo do eixo x. </font><font style="vertical-align: inherit;">Por exemplo, aceitando solicitações simples de 10 KiB via HTTPS, podemos ver que a AMD é 1,5 vezes melhor que a Intel em termos do número de solicitações por segundo. </font><font style="vertical-align: inherit;">Em média, a AMD teve um desempenho 34% melhor nos testes apresentados do que a Intel. </font><font style="vertical-align: inherit;">Considerando que o TDP para o único AMD EPYC 7642 é de 225 W e para dois processadores Intel - 300 W, verifica-se que, em termos de "solicitações por watt", a AMD mostra resultados 2 vezes melhores que a Intel!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse ponto, estávamos claramente inclinados para a opção de um soquete para o AMD EPYC 7642 como nossos futuros processadores para a geração X. Estávamos muito interessados ​​em saber como os servidores AMD EPYC se comportam no trabalho real e imediatamente enviamos vários servidores para alguns dos data centers.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalho real</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira coisa, é claro, foi preparar o servidor para o trabalho em condições reais. </font><font style="vertical-align: inherit;">Todas as máquinas da nossa frota trabalham com os mesmos processos e serviços, o que torna uma ótima oportunidade para comparar corretamente o desempenho. </font><font style="vertical-align: inherit;">Como na maioria dos datacenters, temos várias gerações de servidores implantados e montamos nossos servidores em clusters para que cada classe contenha servidores de aproximadamente a mesma geração. </font><font style="vertical-align: inherit;">Em alguns casos, isso pode resultar em curvas de utilização variando entre os clusters. </font><font style="vertical-align: inherit;">Mas não conosco. </font><font style="vertical-align: inherit;">Nossos engenheiros otimizaram a utilização da CPU para todas as gerações, de modo que, independentemente de a CPU possuir 8 núcleos em uma máquina específica ou 24, o uso da CPU geralmente não é diferente do resto.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9b9/ea2/a9b/9b9ea2a9b8b70ad4e6e8f3b4e72200a3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O gráfico ilustra nosso comentário sobre a similaridade de utilização - não há diferença significativa entre o uso de CPUs AMD em servidores Gen X e o uso de processadores Intel em servidores Gen 9. Isso significa que os servidores de teste e núcleo são carregados igualmente. Bem. É exatamente isso que alcançamos no trabalho de nossos servidores e precisamos disso para uma comparação honesta. Os dois gráficos abaixo mostram o número de solicitações processadas por um núcleo da CPU e todos os núcleos no nível do servidor. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/075/8a6/91c/0758a691c0287281bd4c70bc1625d631.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consultas para o </font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0a2/c5d/206/0a2c5d206c83c98cc06b910118a03a17.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor Consultas para o servidor</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode-se observar que, em média, a AMD processa 23% mais solicitações. Nada mal! Muitas vezes escrevemos em nosso blog sobre maneiras de aumentar o desempenho da geração 9. E aqui temos o mesmo número de núcleos, mas a AMD está trabalhando mais com menos energia. Imediatamente a partir das especificações para o número de núcleos e TDP, pode-se ver que a AMD oferece mais velocidade com maior eficiência energética. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, como já mencionamos, o TDP não é uma especificação padrão e não é a mesma para todos os fabricantes, portanto, vejamos o uso real de energia. Ao medir o consumo de energia do servidor em paralelo com o número de solicitações por segundo, obtivemos o seguinte gráfico:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/eac/f1a/a0f/eacf1aa0fcbee9f35c376bf52a7f37d1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelo número de solicitações por segundo gasto por watt, o servidor Gen X nos processadores AMD é 28% mais eficiente. Poder-se-ia esperar mais, dado que o TDP da AMD é 25% menor, no entanto, deve-se lembrar que o TDP é uma característica ambígua. Vimos que o consumo real de energia da AMD quase coincide com o TDP indicado em uma frequência bem acima da base; A Intel não tem isso. Essa é outra razão pela qual o TDP não é uma estimativa confiável do consumo de energia. As CPUs Intel em nossos servidores Gen 9 são integradas ao sistema multicode, enquanto as CPUs AMD trabalham em servidores de fator de forma padrão de 1U. Isso não é favorável à AMD, já que os servidores multinode devem fornecer maior densidade com menor consumo de energia por nó, porém a AMD ainda está à frente da Intel em termos de consumo de energia por nó.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na maioria das comparações de especificações, simulações de teste e trabalho real, a configuração do 1P AMD EPYC 7642 provou ser muito melhor que o 2P Intel Xeon 6162. Em algumas condições, a AMD pode funcionar 36% melhor, e acreditamos que, ao otimizar o hardware e os programas, podemos obter essa melhoria continuamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que a AMD venceu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gráficos adicionais mostram o atraso médio e o atraso p99 na operação do NGINX por 24 horas. </font><font style="vertical-align: inherit;">Em média, os processos da AMD foram 25% mais rápidos. </font><font style="vertical-align: inherit;">Na p99, ele roda 20-50% mais rápido, dependendo da hora do dia.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os engenheiros de hardware e desempenho da Cloudflare fazem uma quantidade significativa de testes e pesquisas para selecionar a melhor configuração de servidor para nossos clientes. Gostamos de trabalhar aqui porque podemos resolver tarefas grandiosas e também ajudá-lo a resolver seus problemas com serviços como computação de borda sem servidor e uma variedade de soluções para problemas de segurança, em particular proteção contra trânsito mágico, túnel Argo e DDoS . Todos os servidores da rede Cloudflare estão configurados para uma operação confiável, e estamos sempre tentando tornar cada próxima geração de servidores melhor que a anterior. Acreditamos que o AMD EPYC 7642 é a resposta para a pergunta sobre a escolha de processadores para a geração X.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando o serviço Cloudflare Workers, os desenvolvedores implantam seus aplicativos em nossa rede, expandindo-se em todo o mundo. Temos orgulho em oferecer a nossos clientes a oportunidade de nos concentrarmos na criação de código enquanto trabalhamos em segurança e confiabilidade na nuvem. E hoje temos o prazer de anunciar que o trabalho deles será implantado em nossos servidores da geração Gen X executando processadores AMD EPYC de segunda geração. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7de/304/54d/7de30454d5b87e7a32fceda1e3f7ca49.jpg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processadores EPYC 7642, codinome “Rome” [Rome]</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Usando o EPYC 7642 da AMD, conseguimos aumentar nossa velocidade e facilitar a expansão da rede para novas cidades. Roma não foi construída em um dia, mas em breve estará mais perto de muitos de vocês.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos últimos anos, experimentamos muitos chips x86 da Intel e AMD, bem como processadores da ARM. </font><font style="vertical-align: inherit;">Esperamos que, no futuro, esses fabricantes de CPU trabalhem conosco, para que possamos construir juntos uma Internet aprimorada.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493096/index.html">Adicionar um tema sombrio no iOS</a></li>
<li><a href="../pt493098/index.html">Implante o conjunto de balanceamento de carga da VPN ASA</a></li>
<li><a href="../pt493100/index.html">Como encontrar maneiras fáceis ajuda as startups a alcançar um crescimento agressivo</a></li>
<li><a href="../pt493102/index.html">Tendências da automação global: desenvolvimento de RPA</a></li>
<li><a href="../pt493106/index.html">Quanto há de novo na Dúzia do Diabo?</a></li>
<li><a href="../pt493110/index.html">Como delegar no trabalho remoto - um guia para o líder da equipe e muito mais</a></li>
<li><a href="../pt493112/index.html">Como iniciar um novo negócio em 6 meses em vez de 3 anos</a></li>
<li><a href="../pt493114/index.html">Como o engenheiro de dados assistiu os dados</a></li>
<li><a href="../pt493116/index.html">"Mais interatividade!" ou Como foi o TeamLead Conf 2020</a></li>
<li><a href="../pt493118/index.html">Visão geral da extensão de marcação de memória (Armv8.5-A)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>