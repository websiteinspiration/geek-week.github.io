<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèº üë®‚ÄçüöÄ üèõÔ∏è Cloudflare seleciona processadores AMD para servidores de ponta da d√©cima gera√ß√£o ü§±üèΩ ü•® üè∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mais de um bilh√£o de endere√ßos IP exclusivos passam diariamente pela Cloudflare Network; Atende a mais de 11 milh√µes de solicita√ß√µes HTTP por segundo;...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cloudflare seleciona processadores AMD para servidores de ponta da d√©cima gera√ß√£o</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493108/"><img src="https://habrastorage.org/getpro/habr/post_images/536/952/a76/536952a764f14e82b44b8765e9c63737.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais de um bilh√£o de endere√ßos IP exclusivos passam diariamente pela Cloudflare Network; Atende a mais de 11 milh√µes de solicita√ß√µes HTTP por segundo; est√° localizado a uma dist√¢ncia n√£o superior a 100 ms de 95% da popula√ß√£o da Internet. Nossa rede abrange 200 cidades em mais de 90 pa√≠ses e nossa equipe de engenharia construiu uma infraestrutura extremamente r√°pida e confi√°vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos muito orgulho do nosso trabalho e estamos comprometidos em ajudar a tornar a Internet melhor e mais segura. Os engenheiros da Cloudflare, cujo trabalho est√° relacionado ao hardware, s√£o versados ‚Äã‚Äãem servidores e seus componentes, a fim de entender e escolher o melhor equipamento para maximizar sua efici√™ncia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa pilha de software lida com computa√ß√£o de alta carga e depende muito da velocidade da CPU, e √© por isso que nossos engenheiros precisam otimizar constantemente a efici√™ncia e a confiabilidade do Cloudflare em todos os n√≠veis da pilha. </font><font style="vertical-align: inherit;">No lado do servidor, a maneira mais f√°cil √© aumentar o poder da computa√ß√£o adicionando n√∫cleos de CPU. </font><font style="vertical-align: inherit;">Quanto mais n√∫cleos voc√™ puder caber em um servidor, mais ele poder√° processar dados. </font><font style="vertical-align: inherit;">Isso √© importante para n√≥s, pois a diversidade de nossos produtos e clientes cresce com o tempo e o crescimento de solicita√ß√µes exige que os servidores aumentem a produtividade. </font><font style="vertical-align: inherit;">Para aumentar sua produtividade, precis√°vamos aumentar a densidade dos n√∫cleos - e √© exatamente isso que realizamos. </font><font style="vertical-align: inherit;">Abaixo, fornecemos detalhes dos dados do processador para servidores que implantamos desde 2015, incluindo o n√∫mero de n√∫cleos:</font></font><br>
<a name="habracut"></a><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 6</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 7</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 8</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 9</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In√≠cio do trabalho</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2015</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2016</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2017</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon E5-2630 v3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon E5-2630 v4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon Silver 4116</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon Platinum 6162</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫cleos f√≠sicos</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 10</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 12</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 24</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 150W</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP por n√∫cleo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10,65W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8,50W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.08W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,25W</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2018, demos um grande salto no n√∫mero total de n√∫cleos por servidor com a 9¬™ gera√ß√£o. </font><font style="vertical-align: inherit;">O impacto ambiental foi reduzido em 33% em compara√ß√£o com a 8¬™ gera√ß√£o, o que nos deu a oportunidade de aumentar o volume e a capacidade de computa√ß√£o por rack. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> requisitos de projeto </font><font style="vertical-align: inherit;">TDP ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Thermal Design Power</font></a><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">s√£o </font><font style="vertical-align: inherit;">mencionados para enfatizar que nossa efici√™ncia energ√©tica tamb√©m aumentou ao longo do tempo. </font><font style="vertical-align: inherit;">Este indicador √© importante para n√≥s: primeiro, queremos emitir menos carbono na atmosfera; </font><font style="vertical-align: inherit;">segundo, queremos fazer o melhor uso da energia dos data centers. </font><font style="vertical-align: inherit;">Mas sabemos o que devemos nos esfor√ßar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa principal m√©trica de defini√ß√£o √© o n√∫mero de solicita√ß√µes por watt. Podemos aumentar o n√∫mero de solicita√ß√µes por segundo adicionando n√∫cleos, mas precisamos permanecer dentro do nosso or√ßamento de energia. Estamos limitados pela infraestrutura de energia dos datacenters, que, juntamente com nossos m√≥dulos de distribui√ß√£o de energia selecionados, nos fornece um certo limite superior para cada rack de servidor. Adicionar servidores a um rack aumenta o consumo de energia. Os custos operacionais aumentar√£o drasticamente se formos al√©m do limite de energia de um rack e precisarmos adicionar novos racks. Precisamos aumentar o poder de computa√ß√£o, permanecendo na mesma faixa de energia, o que aumentar√° o n√∫mero de solicita√ß√µes por watt - nossa principal m√©trica.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ deve ter adivinhado, estudamos cuidadosamente o consumo de energia na fase de projeto. </font><font style="vertical-align: inherit;">A tabela acima mostra que n√£o devemos perder tempo implantando CPUs com maior consumo de energia, se o TDP por n√∫cleo for superior √† gera√ß√£o atual - isso afetar√° negativamente nossa m√©trica, o n√∫mero de solicita√ß√µes por watt. </font><font style="vertical-align: inherit;">Examinamos cuidadosamente os sistemas prontos para opera√ß√£o de nossa gera√ß√£o X no mercado e tomamos uma decis√£o. </font><font style="vertical-align: inherit;">Estamos saindo do nosso circuito com 48 n√∫cleos Intel Xeon Platinum 6162 e dois soquetes para um AMD EPYC 7642 de 48 n√∫cleos com um soquete.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d3c/162/8f5/d3c1628f5dfb45681f0fb25abce76b3e.jpg"><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AMD</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xeon Platinum 6162</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPYC 7642</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microarquitetura</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Skylake" </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Zen 2"</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nome de c√≥digo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skylake SP √© seu neg√≥cio?</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Roma" </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processo tecnol√≥gico</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14nm</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7nm</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cores</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 24</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48.</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frequ√™ncia</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,9 GHz</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,4 GHz</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache / soquete L3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24 x 1.375MiB</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16 x 16MiB</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mem√≥ria / soquete</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 canais, at√© DDR4-2400</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 canais, at√© DDR4-3200</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 150W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">225W</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCIe / soquete</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48 pistas</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 pistas</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â UM</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86-64</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86-64</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelas especifica√ß√µes, fica claro que o chip da AMD nos permitir√° deixar o mesmo n√∫mero de n√∫cleos, diminuindo o TDP. </font><font style="vertical-align: inherit;">Na 9a gera√ß√£o, o TDP por n√∫cleo foi de 6,25 watts e na Xa gera√ß√£o ser√° de 4,69 watts. </font><font style="vertical-align: inherit;">Uma redu√ß√£o de 25%. </font><font style="vertical-align: inherit;">Devido ao aumento da frequ√™ncia e, possivelmente, um circuito mais simples com um soquete, podemos assumir que o chip da AMD se mostrar√° melhor nos neg√≥cios. </font><font style="vertical-align: inherit;">Enquanto estamos realizando v√°rios testes e simula√ß√µes para entender o desempenho da AMD.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto isso, observamos que o TDP √© uma m√©trica simplificada das especifica√ß√µes do fabricante, que usamos nos est√°gios iniciais do design do servidor e da sele√ß√£o da CPU. </font><font style="vertical-align: inherit;">Uma r√°pida pesquisa no Google demonstra que a AMD e a Intel t√™m abordagens diferentes para a defini√ß√£o de TDP, raz√£o pela qual essa especifica√ß√£o n√£o √© confi√°vel. </font><font style="vertical-align: inherit;">O consumo real de energia da CPU e, mais importante, o consumo de energia do servidor, √© o que realmente usamos quando tomamos a decis√£o final.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepara√ß√£o do ecossistema</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No in√≠cio de nossa jornada para escolher o pr√≥ximo processador, estudamos uma grande variedade de CPUs de diferentes fabricantes que eram adequadas para a nossa pilha e servi√ßos de software (escritos em C, LuaJIT e Go). J√° descrevemos em detalhes um conjunto de ferramentas para medir a velocidade </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em um artigo em nosso blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nesse caso, usamos o mesmo conjunto - ele permite avaliar a efic√°cia da CPU em um tempo razo√°vel, ap√≥s o qual nossos engenheiros podem come√ßar a adaptar nossos programas a um processador espec√≠fico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testamos v√°rios processadores com um n√∫mero diversificado de n√∫cleos, soquetes e frequ√™ncias. Como estamos descrevendo o motivo pelo qual optamos pelo AMD EPYC 7642 neste artigo, todos os gr√°ficos deste blog se concentram no desempenho dos processadores AMD em compara√ß√£o com o Intel Xeon Platinum 6162 da</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nossa 9¬™ gera√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os resultados correspondem √†s medi√ß√µes da opera√ß√£o de um servidor com cada variante de processador - ou seja, com dois processadores de 24 n√∫cleos da Intel ou com um processador de 48 n√∫cleos da AMD (servidor para Intel com dois soquetes e servidor para AMD EPYC com um). </font><font style="vertical-align: inherit;">No BIOS, definimos os par√¢metros correspondentes aos servidores em funcionamento. </font><font style="vertical-align: inherit;">Estes s√£o 3,03 GHz para AMD e 2,5 GHz para Intel. </font><font style="vertical-align: inherit;">Simplificando bastante, esperamos que, com o mesmo n√∫mero de n√∫cleos, a AMD mostre resultados 21% melhores que a Intel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criptografia</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/eb4/843/287/eb484328713741f6688d81c15a9c5920.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/598/82b/416/59882b416feabd9eea86ea9d99d1e1df.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece promissor para a AMD. </font><font style="vertical-align: inherit;">Funciona 18% melhor na criptografia de chave p√∫blica. </font><font style="vertical-align: inherit;">Com uma chave sim√©trica, perde para as op√ß√µes de criptografia AES-128-GCM, mas em geral se mostra compar√°vel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compress√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos servidores de borda, compactamos muitos dados para economizar largura de banda e aumentar a velocidade da entrega de conte√∫do. </font><font style="vertical-align: inherit;">Passamos dados pelas bibliotecas zlib e brotli C. </font><font style="vertical-align: inherit;">Todos os testes foram realizados no arquivo HTML blog.cloudflare.com na mem√≥ria. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fdc/bf7/ae1/fdcbf7ae1109d02a45b2ca40fe353376.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ccc/427/983/ccc427983ceb85dbf63bab614850692f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A AMD ganhou uma m√©dia de 29% ao usar o gzip. </font><font style="vertical-align: inherit;">No caso do brotli, os resultados s√£o ainda melhores em testes com qualidade 7, que usamos para compacta√ß√£o din√¢mica. </font><font style="vertical-align: inherit;">Ocorre uma queda acentuada no teste brotli-9 - atribu√≠mos isso ao fato de que Brotli consome muita mem√≥ria e sobrecarrega o cache. </font><font style="vertical-align: inherit;">No entanto, a AMD vence por uma ampla margem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitos de nossos servi√ßos est√£o escritos em Go. </font><font style="vertical-align: inherit;">Nos gr√°ficos a seguir, verificamos novamente as taxas de criptografia e compacta√ß√£o no Go with RegExp em linhas de 32 KB usando a biblioteca de strings.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir criptografia</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/78a/ab0/495/78aab0495309cefee6f30bac835ee961.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√° compress√£o</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/f99/2cb/95d/f992cb95d4913a2d19808d4bd15b5b54.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/850/e7c/f55/850e7cf5586f693dd14d62f70510f681.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir regexp</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/b58/798/6cb/b587986cbab94ca7087364a949f09aa4.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/444/e76/f72/444e76f72c1ec2e93c4cae0c5bd386f2.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir strings</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/3e9/984/19a/3e998419adb450f598e0f3d82de01aa1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A AMD mostra os melhores resultados em todos os testes com o Go, exceto o sinal ECDSA P256, onde est√° 38% atr√°s - o que √© estranho, considerando que apresentou resultados 24% melhores em C. </font><font style="vertical-align: inherit;">Vale a pena descobrir o que est√° acontecendo l√°. </font><font style="vertical-align: inherit;">Mas, em geral, a AMD n√£o ganha muito, mas ainda mostra os melhores resultados.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luajit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Costumamos usar LuaJIT na pilha. </font><font style="vertical-align: inherit;">Esta √© a cola que cont√©m todas as partes do Cloudflare. </font><font style="vertical-align: inherit;">E estamos felizes que a AMD tenha vencido aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, os testes mostram que o EPYC 7642 tem desempenho melhor que dois Xeon Platinum 6162. A AMD perde em um par de testes - por exemplo, AES-128-GCM e Go OpenSSL ECDSA-P256 Sign - no entanto, vence em todos os outros, em m√©dia, 25% .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simula√ß√£o de carga de trabalho</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s nossos testes expressos, executamos o servidor atrav√©s de outro conjunto de simula√ß√µes em que a carga sint√©tica √© aplicada √† pilha de borda do software. Aqui simulamos uma carga de trabalho de scripts com v√°rios tipos de consultas que podem ser encontradas no trabalho real. As solicita√ß√µes variam em termos de volume de dados, protocolos HTTP ou HTTPS, WAF, fontes Workers e outras de uma variedade de vari√°veis. Abaixo est√° uma compara√ß√£o da taxa de transfer√™ncia das duas CPUs para os tipos de solicita√ß√µes que encontramos com mais freq√º√™ncia.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/594/dbb/4cf/594dbb4cf570a1c22ff666d592884ef7.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os resultados no diagrama s√£o medidos pelos indicadores b√°sicos da 9¬™ gera√ß√£o de m√°quinas com processadores Intel, normalizados para um valor de 1,0 ao longo do eixo x. </font><font style="vertical-align: inherit;">Por exemplo, aceitando solicita√ß√µes simples de 10 KiB via HTTPS, podemos ver que a AMD √© 1,5 vezes melhor que a Intel em termos do n√∫mero de solicita√ß√µes por segundo. </font><font style="vertical-align: inherit;">Em m√©dia, a AMD teve um desempenho 34% melhor nos testes apresentados do que a Intel. </font><font style="vertical-align: inherit;">Considerando que o TDP para o √∫nico AMD EPYC 7642 √© de 225 W e para dois processadores Intel - 300 W, verifica-se que, em termos de "solicita√ß√µes por watt", a AMD mostra resultados 2 vezes melhores que a Intel!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse ponto, est√°vamos claramente inclinados para a op√ß√£o de um soquete para o AMD EPYC 7642 como nossos futuros processadores para a gera√ß√£o X. Est√°vamos muito interessados ‚Äã‚Äãem saber como os servidores AMD EPYC se comportam no trabalho real e imediatamente enviamos v√°rios servidores para alguns dos data centers.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalho real</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira coisa, √© claro, foi preparar o servidor para o trabalho em condi√ß√µes reais. </font><font style="vertical-align: inherit;">Todas as m√°quinas da nossa frota trabalham com os mesmos processos e servi√ßos, o que torna uma √≥tima oportunidade para comparar corretamente o desempenho. </font><font style="vertical-align: inherit;">Como na maioria dos datacenters, temos v√°rias gera√ß√µes de servidores implantados e montamos nossos servidores em clusters para que cada classe contenha servidores de aproximadamente a mesma gera√ß√£o. </font><font style="vertical-align: inherit;">Em alguns casos, isso pode resultar em curvas de utiliza√ß√£o variando entre os clusters. </font><font style="vertical-align: inherit;">Mas n√£o conosco. </font><font style="vertical-align: inherit;">Nossos engenheiros otimizaram a utiliza√ß√£o da CPU para todas as gera√ß√µes, de modo que, independentemente de a CPU possuir 8 n√∫cleos em uma m√°quina espec√≠fica ou 24, o uso da CPU geralmente n√£o √© diferente do resto.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9b9/ea2/a9b/9b9ea2a9b8b70ad4e6e8f3b4e72200a3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O gr√°fico ilustra nosso coment√°rio sobre a similaridade de utiliza√ß√£o - n√£o h√° diferen√ßa significativa entre o uso de CPUs AMD em servidores Gen X e o uso de processadores Intel em servidores Gen 9. Isso significa que os servidores de teste e n√∫cleo s√£o carregados igualmente. Bem. √â exatamente isso que alcan√ßamos no trabalho de nossos servidores e precisamos disso para uma compara√ß√£o honesta. Os dois gr√°ficos abaixo mostram o n√∫mero de solicita√ß√µes processadas por um n√∫cleo da CPU e todos os n√∫cleos no n√≠vel do servidor. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/075/8a6/91c/0758a691c0287281bd4c70bc1625d631.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consultas para o </font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0a2/c5d/206/0a2c5d206c83c98cc06b910118a03a17.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor Consultas para o servidor</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode-se observar que, em m√©dia, a AMD processa 23% mais solicita√ß√µes. Nada mal! Muitas vezes escrevemos em nosso blog sobre maneiras de aumentar o desempenho da gera√ß√£o 9. E aqui temos o mesmo n√∫mero de n√∫cleos, mas a AMD est√° trabalhando mais com menos energia. Imediatamente a partir das especifica√ß√µes para o n√∫mero de n√∫cleos e TDP, pode-se ver que a AMD oferece mais velocidade com maior efici√™ncia energ√©tica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, como j√° mencionamos, o TDP n√£o √© uma especifica√ß√£o padr√£o e n√£o √© a mesma para todos os fabricantes, portanto, vejamos o uso real de energia. Ao medir o consumo de energia do servidor em paralelo com o n√∫mero de solicita√ß√µes por segundo, obtivemos o seguinte gr√°fico:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/eac/f1a/a0f/eacf1aa0fcbee9f35c376bf52a7f37d1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelo n√∫mero de solicita√ß√µes por segundo gasto por watt, o servidor Gen X nos processadores AMD √© 28% mais eficiente. Poder-se-ia esperar mais, dado que o TDP da AMD √© 25% menor, no entanto, deve-se lembrar que o TDP √© uma caracter√≠stica amb√≠gua. Vimos que o consumo real de energia da AMD quase coincide com o TDP indicado em uma frequ√™ncia bem acima da base; A Intel n√£o tem isso. Essa √© outra raz√£o pela qual o TDP n√£o √© uma estimativa confi√°vel do consumo de energia. As CPUs Intel em nossos servidores Gen 9 s√£o integradas ao sistema multicode, enquanto as CPUs AMD trabalham em servidores de fator de forma padr√£o de 1U. Isso n√£o √© favor√°vel √† AMD, j√° que os servidores multinode devem fornecer maior densidade com menor consumo de energia por n√≥, por√©m a AMD ainda est√° √† frente da Intel em termos de consumo de energia por n√≥.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na maioria das compara√ß√µes de especifica√ß√µes, simula√ß√µes de teste e trabalho real, a configura√ß√£o do 1P AMD EPYC 7642 provou ser muito melhor que o 2P Intel Xeon 6162. Em algumas condi√ß√µes, a AMD pode funcionar 36% melhor, e acreditamos que, ao otimizar o hardware e os programas, podemos obter essa melhoria continuamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que a AMD venceu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√°ficos adicionais mostram o atraso m√©dio e o atraso p99 na opera√ß√£o do NGINX por 24 horas. </font><font style="vertical-align: inherit;">Em m√©dia, os processos da AMD foram 25% mais r√°pidos. </font><font style="vertical-align: inherit;">Na p99, ele roda 20-50% mais r√°pido, dependendo da hora do dia.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os engenheiros de hardware e desempenho da Cloudflare fazem uma quantidade significativa de testes e pesquisas para selecionar a melhor configura√ß√£o de servidor para nossos clientes. Gostamos de trabalhar aqui porque podemos resolver tarefas grandiosas e tamb√©m ajud√°-lo a resolver seus problemas com servi√ßos como computa√ß√£o de borda sem servidor e uma variedade de solu√ß√µes para problemas de seguran√ßa, em particular prote√ß√£o contra tr√¢nsito m√°gico, t√∫nel Argo e DDoS . Todos os servidores da rede Cloudflare est√£o configurados para uma opera√ß√£o confi√°vel, e estamos sempre tentando tornar cada pr√≥xima gera√ß√£o de servidores melhor que a anterior. Acreditamos que o AMD EPYC 7642 √© a resposta para a pergunta sobre a escolha de processadores para a gera√ß√£o X.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando o servi√ßo Cloudflare Workers, os desenvolvedores implantam seus aplicativos em nossa rede, expandindo-se em todo o mundo. Temos orgulho em oferecer a nossos clientes a oportunidade de nos concentrarmos na cria√ß√£o de c√≥digo enquanto trabalhamos em seguran√ßa e confiabilidade na nuvem. E hoje temos o prazer de anunciar que o trabalho deles ser√° implantado em nossos servidores da gera√ß√£o Gen X executando processadores AMD EPYC de segunda gera√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7de/304/54d/7de30454d5b87e7a32fceda1e3f7ca49.jpg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processadores EPYC 7642, codinome ‚ÄúRome‚Äù [Rome]</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Usando o EPYC 7642 da AMD, conseguimos aumentar nossa velocidade e facilitar a expans√£o da rede para novas cidades. Roma n√£o foi constru√≠da em um dia, mas em breve estar√° mais perto de muitos de voc√™s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos √∫ltimos anos, experimentamos muitos chips x86 da Intel e AMD, bem como processadores da ARM. </font><font style="vertical-align: inherit;">Esperamos que, no futuro, esses fabricantes de CPU trabalhem conosco, para que possamos construir juntos uma Internet aprimorada.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493096/index.html">Adicionar um tema sombrio no iOS</a></li>
<li><a href="../pt493098/index.html">Implante o conjunto de balanceamento de carga da VPN ASA</a></li>
<li><a href="../pt493100/index.html">Como encontrar maneiras f√°ceis ajuda as startups a alcan√ßar um crescimento agressivo</a></li>
<li><a href="../pt493102/index.html">Tend√™ncias da automa√ß√£o global: desenvolvimento de RPA</a></li>
<li><a href="../pt493106/index.html">Quanto h√° de novo na D√∫zia do Diabo?</a></li>
<li><a href="../pt493110/index.html">Como delegar no trabalho remoto - um guia para o l√≠der da equipe e muito mais</a></li>
<li><a href="../pt493112/index.html">Como iniciar um novo neg√≥cio em 6 meses em vez de 3 anos</a></li>
<li><a href="../pt493114/index.html">Como o engenheiro de dados assistiu os dados</a></li>
<li><a href="../pt493116/index.html">"Mais interatividade!" ou Como foi o TeamLead Conf 2020</a></li>
<li><a href="../pt493118/index.html">Vis√£o geral da extens√£o de marca√ß√£o de mem√≥ria (Armv8.5-A)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>