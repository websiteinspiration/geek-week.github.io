<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👆🏿 💃🏼 ➰ Control an external device in the car using the buttons on the steering wheel 🛏️ 🌽 👩🏼‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone. 
 
 Sometimes it becomes necessary to control some external device in the car, for example, a video recorder or a winch. In this case,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Control an external device in the car using the buttons on the steering wheel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505026/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello everyone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometimes it becomes necessary to control some external device in the car, for example, a video recorder or a winch. In this case, usually, additional buttons are installed. But sometimes I want to make a hidden installation, so that the interior of the car remains unchanged. We’ll do this today, as a car there will be a VW Polo Sedan with an installed Vega MTX monitoring unit, and as a load there will be an emergency button. Let’s make sure that while holding the “ok” button on the steering wheel, the “emergency light” blinked 3 times. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under the cut, a large number of pictures and videos.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Once I was asked to make a thank you button on a 2012 Renault Kaptur. By clicking on this button the car should blink “emergency gang” 3 times. This car had an analog steering column joystick. I connected one of the buttons on the steering column joystick to a time relay that gave an impulse 3 seconds long to the emergency gang button. Later, the owner spoke very well about the new function of his car and I decided to try to repeat it on my Polo Sedan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unlike Renault Kaptur, I do not have analog buttons, but the signal from all the buttons on the steering wheel can be found in the CAN bus. As the button, the “ok” button on the steering wheel of the car was selected. In my configuration, this button is almost never used. So far, I have found that with it you can set the operation of the "limiter" when the tidy beeps when exceeding the set speed. In any other cases, clicking on this button does nothing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was possible to implement our plans with the help of home-made electronics, but in my car there was already a Vega MTX telematics unit, so it was decided to try to implement this functionality using it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pressing this button can be found in the CAN bus, which is located behind the radio. I described in detail the search for such sensors in</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">his previous article about decrypting the CAN bus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our case, the data was found at 5BF. When you click on the "ok" button in the zero byte, the figure 40 appears in decimal format. When the buttons are not pressed, the zero byte will be 0. It will be necessary to make a sensor in which these changes will be displayed. In my case, this is a button on the steering wheel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/2b/wi/j72bwiuv_uhzh2kbt9crf7pb6tc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's figure out how to control the emergency gang button. Unfortunately, Polo Sedan cannot control the emergency gang via the CAN bus, so you will have to manage it by analogy. To do this, you will have to stretch the wire from the white-blue wire from the connector of the emergency gang button. If a ground signal is applied to this wire with a short-term pulse, then the emergency gang turns on. Similarly, it turns off.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Serve the "ground" will be using the digital output Vega MTX. Here we have 4 digital outputs, we will use the third output (blue wire). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/-o/ae/uz-oaegurh5p-8r1fczln8hiyrw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you need to set the algorithms by which the button will work. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Firstly, I don’t want the emergency gang to turn on immediately by pressing the ok button, I want it to turn on after holding the button for a second. I do this to protect against accidental pressing and to save the functionality of this button. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secondly, you need to turn off the emergency gang after 3 flashes. 3 flashes "emergency gang" makes in 2 seconds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To enter all these algorithms, go to the Vega MTX settings, then go to the "Scripts" tab. Here you can set the conditions under which any actions are performed. For implementation I had to use 3 scenarios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, the scenarios are not intended for such operations, so I had to experiment for a long time until the desired result was obtained. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/np/tb/dmnptb-c9bmonjlmutgpskje2fs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first scenario serves to create a delay per second after clicking on the “ok” button. It works if in the CAN sensor the value becomes 40 and the external digital output 1 is 0.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0n/2-/gh/0n2-gh3y6v3d9w4p8v-wpaflbdw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here I will explain about external digital outputs. If the task requires more than 4 digital outputs, then you can connect an additional external module to Vega MTX, which will have 15 digital outputs and many more other inputs and outputs. Since we do not have this external unit, we can use these outputs as variables, putting 0 or 1 there (on or off). By default, all outputs are turned off. External digital output 1 will be a variable that indicates that one second has elapsed since pressing the ok button. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our script should read like this: now the ok button is pressed, and it is pressed for less than one second. If these conditions coincide, then the action is performed: the external digital output 1 is turned off for 1 second. It means that it goes into the “off” state, but after a second it will go into the “on” state.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/qw/v_/laqwv_wowjb0zzhvkkm9eiijnro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's move on to the second scenario. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/al/xc/gwalxcku5ectsxnsikszjeqkncu.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unlike the first scenario, it will work with the “Buttons on the steering wheel” sensor equal to 40 and with an external digital input equal to 1. That is, the “ok” button is pressed and the external digital output 1 is 1. And the external digital output will become 1 only after a second after triggering the first scenario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we will analyze what happens after the second scenario is triggered. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-n/vw/mp/-nvwmpbzqfua5nwiizr2llgqgyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here a pulse of 1 second long is given to digital output 3, to which the output from the emergency gang button is connected, thereby we turn it on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, we need to reset 0 the external digital output 1. Therefore, we turn on the external digital output 1 for 1 second. That is, 1 second after the script is triggered, the external digital output 1 will become 0.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last item, we transfer 2 seconds 15 to position 0. After 2 seconds after the script is triggered, the external digital output 15 will be 1. The external digital output 15 is used as a variable, that the emergency light was turned on using the button on the steering wheel. 2 seconds is the time during which the car blinks “emergency gang” 3 times. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the last scenario, which should send an impulse, to turn off the emergency gang. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vy/g1/or/vyg1orbca6pqu-u3ufjcjr20ism.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This scenario will work when the external digital output 15 becomes 1, that is, 2 seconds after the second scenario is triggered. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/ke/8n/0mke8ngoswhi9jn9ject-paeftw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the third script is triggered, we send an impulse to turn off the emergency gang, and reset the external digital output 15 to zero (off).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This ends the work with scripts, save the result in Vega MTX and check the operation of the device. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, you can control any device using the CAN bus of the car. </font><font style="vertical-align: inherit;">Management is not limited to buttons on the steering wheel. </font><font style="vertical-align: inherit;">For example, you can set the device to turn on by vehicle speed, by opening a window or door, by starting the engine, by engine speed, by engine temperature, etc. </font><font style="vertical-align: inherit;">You can lock the doors at a certain speed (if the manufacturer has not provided such an opportunity), turn on the camera when you open the window, and many other options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All of the above is in the video format, and also there is an example of enabling emergency lights when reverse gear.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/70KNs2freow" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504988/index.html">Interview with Analyst - Denis Sobolev, Product Manager, Head of B2B analytics Skyeng</a></li>
<li><a href="../en504996/index.html">BazarBackdoor: New Entry Point to Enterprise Systems</a></li>
<li><a href="../en505016/index.html">Free Education Courses: Administration</a></li>
<li><a href="../en505018/index.html">How Selenium Works: Episodes 1 - 2</a></li>
<li><a href="../en505024/index.html">YouTrack now with a knowledge base</a></li>
<li><a href="../en505034/index.html">LED aging test</a></li>
<li><a href="../en505036/index.html">Avalonia Tutorial: Implementing MVVM Step by Step with Examples</a></li>
<li><a href="../en505046/index.html">What do first-class content and pub rock have in common? The story of the “failure” of one project that led to success</a></li>
<li><a href="../en505052/index.html">Rapid testing of Motionia.js and Consoleimg.js</a></li>
<li><a href="../en505060/index.html">Insert numpy array into MySQL database via Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>