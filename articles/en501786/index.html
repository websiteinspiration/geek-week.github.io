<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöΩ üßôüèæ üòØ New application "Jellyfish". Why flutter? üß¶ üë®üèº‚Äçüî¨ üîΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Technical Director Boris Goryachev talks about how Medusa worked on it for a year and why it was written in Flutter
 On May 12, the release of the new...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>New application "Jellyfish". Why flutter?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/meduza/blog/501786/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technical Director Boris Goryachev talks about how Medusa worked on it for a year and why it was written in Flutter</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On May 12, the release of the new Medusa mobile applications ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) took place - almost two years after we decided to rewrite them. Why so long? Why not native apps? Why Flutter? All this is told by the technical director of Medusa Boris Goryachev.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eo/pz/1h/eopz1h3vjl99b6ajisv1upsi56q.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unlike our old applications, we decided not to make new ones native. Firstly, writing the same code twice is tedious. Secondly, it will never work out so that in two different projects written by different people, everything is synchronous and the same. Usually someone works slower, someone goes on vacation, someone has a technical debt that needs to be closed. All our experience in creating and supporting native applications has prompted us - either we are doing something wrong, or this is simply not our way. And we began to look for ours. We tried React Native and Ionic, thought about the Basecamp approach - everything in the web + a thin native layer, even tried to go towards the Progressive Web App and stay on-line.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Around the same time, I attended a Google I / O conference and met people who make Flutter there. I immediately tried Dart and worked a bit on Flutter, but at that time the technology was not yet ready for Medusa: it was impossible to embed various interactive materials and embeds inside our materials, but this is critical for the media. So I decided to wait until Flutter grew up. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During the wait, we did a lot of things on the web side: rewrote the site, wrote a new version of AMP. We wrote and transferred all the projects of Medusa to ui-kit - a single library of components that the site uses and thanks to which a huge number of our game mechanics are possible. We divided desktop and mobile versions of the site, so that the distributing pages (main and section pages) began to be formed in two different places according to their own rules.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In parallel with the work on the site, we were thinking about a new application - we came up with its navigation, meanings, screens, features and so on. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yr/hj/qg/yrhjqguulxpberajes84cgyl-h0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In parallel, important changes took place in the structure of the technical department. </font><font style="vertical-align: inherit;">We began to actively use the Google calendar and other meeting planning tools, and we switched from Trello to Basecamp. </font><font style="vertical-align: inherit;">It is so obvious that it‚Äôs even strange to talk about it. </font><font style="vertical-align: inherit;">But it took a lot of time and effort to streamline the chaos. </font><font style="vertical-align: inherit;">A clear agenda of meetings, a quick follow-up, files that are not lost, and hill chart scopes made it possible to cope with a huge stream of tasks and not die.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why is it still Flutter. </font><font style="vertical-align: inherit;">And a little about Dart</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When people learn about Flutter, they inevitably learn about Dart. It seems that it is considered the biggest drawback of Flutter, but exactly until you try to write on it. He is really cool. Following JavaScript is so special. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dart is a programming language that was developed by Google. It was announced in 2011, that is, it is still a young language. It has not become a major programming language (at least for now), but at the same time it is very actively used in the company itself. In addition to Google, there are other large companies, for example, Wrike, which use Dart and write full stack on it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since both Dart and Flutter are supported by the same company, this makes it possible to change the language to the needs of Flutter. As far as I know, both teams actively interact with each other, so chips constantly appear in the language, allowing you to write more pleasant code on Flutter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not try to explain what Flutter consists of - Wikipedia will cope with this task better, but I will only say that among the authors there are people who have rendered in Chromium. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In December 2018, the Flutter team released the Webview embed library in Flutter. It was raw and, by the way, still has not left the Developers Preview Status, but this fact did not stop to begin to estimate the structure of the future application. For several months I experimented in my free time, and then a final decision was made.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first I sat down to write a new version of the API specifically for the application. The ideology of this API can be formulated as follows: if something can be done on the backend, then you need to do it on the backend. And not because it is difficult to do something on the client. The fact is that releases on the App Store and Google Play are a laborious and lengthy process. You need to adapt to their work schedules and remember that not all users will immediately update the application. This can be avoided when the main logic happens on your server. Need to move the title 10 pixels down? You are welcome. Quickly remove or add a component? No problems!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/tj/rm/odtjrmjdtepy8foek0qqtoaa7na.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the same reason, the API for a mobile application contains the simplest components possible, from which almost any material is recursively collected. I say ‚Äúalmost‚Äù because we show games through WebView. The application does not matter what to show - a card, podcast, news or "Big Top". Everything is processed by one code, and the task of the application is to take the component and render it (or go to the list of its children and call it recursively). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another important argument in favor of Flutter: the developer "controls all the pixels." When you need to make sure that everywhere there are correct shadows, as in the layout in Sketch, or you want transparency to change along curves, or you want font sizes and all typography to be customizable, everything in Flutter is simple and realistic.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another killer feature of Flutter is development comfort. </font><font style="vertical-align: inherit;">Hot-reload, which I am so used to in web development, and the fast speed of reloading the application without losing state make the job as easy as possible. </font><font style="vertical-align: inherit;">You do not need to sit and wait until the application is rebuilt, then wait until the new code is working, and repeat the state in which you are working. </font><font style="vertical-align: inherit;">Everything happens really fast and cool.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ecosystem </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although Flutter and Dart are not very popular technologies yet, we had no problems finding libraries. </font><font style="vertical-align: inherit;">Most of what is needed in the application is either in the framework itself or on pub.dev. </font><font style="vertical-align: inherit;">The community is very pleasant and ready to help. </font><font style="vertical-align: inherit;">This communication is a real breath of fresh air, very supportive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, Google itself supports Flutter well. </font><font style="vertical-align: inherit;">We use Firebase for pushing, analytics, profiles and storing user data (reading history, episode positions, bookmarks), and everything ‚Äújust works‚Äù there. </font><font style="vertical-align: inherit;">Of course, as a person who has never written native applications before, sometimes it‚Äôs wild to climb into gradle files or put properties in info.plist. </font><font style="vertical-align: inherit;">But usually everything is googled, and there is nothing incredibly complicated.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Platform differences</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can talk endlessly about the difference between iOS and Android. As a rule, they immediately remember that patterns should be familiar to the user and that design guidelines must be followed. We agree with this, but not quite. It is important to remember about your corporate identity, and about common sense, and about the logic of behavior of users already familiar to you. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you look at the history of the platforms themselves, we see that some patterns change with the devices, while others flow from the system to the system. These are not tablets, nothing stands still. There are dozens of cool examples where companies deviate from the recommendations of Google and Apple and do what they think is right.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/ez/ab/o6ezabqrmtj2y1ewz1silon9wom.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The simplest and most vivid example is swipe back in iOS. The area of ‚Äã‚Äãthe screen that accepts swipe is super small by default, about 20 pixels. This is how the Mail application works on iPhones, and it is very inconvenient. On Twitter, this area is slightly expanded, while on Telegram, it is simply huge! Telegram on Android has its own special type of navigation from the chat list to chat, it is a cross between iOS and Android. Yes, the guidelines are cool, but on the iPhone XR, reaching your finger to the upper left edge of the device is very inconvenient. So we decided (of course, relying on data) that in the "Medusa" application, the "Back" button on iOS will be below. But on Android it will not be at all. To do this, there are svaypas (both our own and the new Android svaypas) and a system button "Back". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Says my colleague, art director of Medusa Nastya Yarovaya:</font></font></b><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I have small hands and a big phone. </font><font style="vertical-align: inherit;">It seems ridiculous, but it affected two important decisions in the development process. </font><font style="vertical-align: inherit;">First, I proposed to significantly increase the swipe zone back (increased to 50%) - the first deviation from the guidelines. </font><font style="vertical-align: inherit;">Then, when we worked on navigation and function buttons inside the material, I suggested putting the back button in the general menu below - this is another deviation from the usual pattern in the interface. </font><font style="vertical-align: inherit;">Now you can reach it with your thumb, because they are mainly scrolled by it.</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We know that we will definitely fly for the fact that we have violated a number of recommendations of Apple and Google. </font><font style="vertical-align: inherit;">But, if anything, we also use telephones and understand that many patterns are outdated, since they were invented for the devices by half.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A little practice: how it works in Flutter</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After React and other reactive frameworks, you can build a prototype on Flutter in a couple of days. General idea of ‚Äã‚ÄãFlutter - everything is a widget. Flutter gives two (actually three) paradigms: you can use material widgets that follow the concept of material design. You can use Cupertino widgets - widgets that look and behave like on iOS. And you can write everything yourself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Roughly speaking, there are two types of widgets that a developer interacts with: stateless and stateful. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stateless widgets are plus or minus widgets that do not contain logic inside them that should change the state of the widget. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stateful widgets have a setState function (hello, react!). You change state, and the widget is redrawn.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But of course, a large application on simple setState will not go far, so a state management solution is needed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several solutions for Flutter. For example, there is a BloC pattern in which streams and events from data sources are used, they contain business logic that provokes the birth of new events. These events are heard by widgets, and widgets respond to changes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Those who come after React may want to try Redux. In theory, there should not be a problem if you wrote in React using this approach.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I tried both approaches and ended up choosing a third. The Jellyfish app uses Provider. This is a library that was not written by Google, but it is interesting that Google, having tried Provider at home, began to abandon its BloC and even decided to repeat Provider as a separate library. But in the end, he abandoned the idea of ‚Äã‚Äãrepeating someone else's code and began to use and maintain what was born as open source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Provider device is pretty simple. This is a widget within which there is a state. This state is changed by functions that internally call notifyListeners (). Those widgets that must respond to changes are in the widget tree - they are either direct children of the widget provider or children of its children. When notifyListeners () is called, children get new values ‚Äã‚Äãthrough the context and rebuild occurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typically, providers are advertised at the very "top" of the application, and you can use many providers at once - each is responsible for its own business logic. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we use eight providers who are ‚Äúlistening‚Äù in different places of the application. For example, here‚Äôs how the bookmark provider works, thanks to which readers can save their favorite materials, read them offline and from the same place on different devices. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The reaction is added to the instance to changes to the document from Firebase, which contains keys to materials bookmarked by readers. For each onChange of this document, the associated variable in the provider is updated and notifyListeners is called. As a result, all widgets that listen to this provider show the correct icon.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Through providers, the application theme has also been switched. </font><font style="vertical-align: inherit;">The application has ThemeProvider, which within itself contains two instances of themes - and, in fact, it's just a Map with our naming of colors and the colors themselves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the correct color comes to the widget like this:</font></font><br>
<br>
<pre><code class="dart hljs">TextSpan(<font></font>
	text: block[<span class="hljs-string">'data'</span>][<span class="hljs-string">'first'</span>],<font></font>
	style: TextStyle(<font></font>
		color: Provider.of&lt;ThemeProvider&gt;(context)<font></font>
        .current<font></font>
        .bodyFontColor,                            <font></font>
  fontFamily: <span class="hljs-string">'Proxima Nova'</span>,<font></font>
));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provider code, if simplified, would be:</font></font><br>
<br>
<pre><code class="dart hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThemeProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChangeNotifier</span> </span>{<font></font>
  CustomThemeData current;<font></font>
  <font></font>
  CustomThemeData blackTheme = CustomThemeData(<font></font>
    name: <span class="hljs-string">'black'</span>,<font></font>
    bodyFontColor: Color.fromRGBO(<span class="hljs-number">184</span>, <span class="hljs-number">184</span>, <span class="hljs-number">184</span>, <span class="hljs-number">1</span>),<font></font>
    ...<font></font>
  );<font></font>
  <font></font>
  CustomThemeData lightTheme = CustomThemeData(<font></font>
    name: <span class="hljs-string">'black'</span>,<font></font>
    bodyFontColor: Color.fromRGBO(<span class="hljs-number">184</span>, <span class="hljs-number">184</span>, <span class="hljs-number">184</span>, <span class="hljs-number">1</span>),<font></font>
    ...<font></font>
  );<font></font>
  <font></font>
  ThemeProvider(withTheme, withFontMultiplier, withAutoTheme) {<font></font>
    theme = withTheme;<font></font>
    autoTheme = withAutoTheme;<font></font>
    current = withTheme == <span class="hljs-string">'light'</span> ? lightTheme : blackTheme;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accordingly, when you change the current variable, all widgets that take colors from the theme will be displayed correctly without exception.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What's next</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In recent weeks, we have been actively testing the new application on a group of several hundred readers of Medusa. </font><font style="vertical-align: inherit;">We will tell you how the testing went in a separate article, but I will only note that Flutter met all my expectations. </font><font style="vertical-align: inherit;">Yes, he has a way to develop, yes, not all feature-rich libraries, but, observing the speed with which it all moves, I, at least for myself, conclude that Flutter with Medusa will last a long time.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501768/index.html">Scantech KSCAN20 3D Scanner Review</a></li>
<li><a href="../en501772/index.html">Trading the stock market: how not to lose, safety precautions</a></li>
<li><a href="../en501774/index.html">Why clouds become thunderclouds: cloud deployment failures</a></li>
<li><a href="../en501782/index.html">DeepPavlov: Keras for Natural Language Processing helps answer questions about COVID-2019</a></li>
<li><a href="../en501784/index.html">If my car gets in the way</a></li>
<li><a href="../en501788/index.html">Creating parametric objects in nanoCAD Design BIM</a></li>
<li><a href="../en501790/index.html">Nontrivial animations in SwiftUI</a></li>
<li><a href="../en501792/index.html">How FinFET's father helped save Moore's law</a></li>
<li><a href="../en501796/index.html">7 dangerous mistakes that are easy to make in C # /. NET</a></li>
<li><a href="../en501798/index.html">C++/Qt: –ø–æ—Ä–∞ –≤–∞–ª–∏—Ç—å?.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>