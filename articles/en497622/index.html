<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äç‚öñÔ∏è üöÉ üåî Automated COVID-19 Detector from Fluorography Images üö∂üèª üòã üìñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this guide, you will learn how to automatically detect COVID-19 in a specially selected dataset using Keras, TensorFlow, and deep learning. 
 
 Lik...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Automated COVID-19 Detector from Fluorography Images</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497622/"><img src="https://habrastorage.org/getpro/habr/post_images/e21/f41/a1d/e21f41a1d483179326c7822160c6beb8.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this guide, you will learn how to automatically detect COVID-19 in a specially selected dataset using Keras, TensorFlow, and deep learning. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Like most people in the world right now, I am sincerely concerned about COVID-19. </font><font style="vertical-align: inherit;">I notice that I began to constantly analyze my personal health and suspect that I have already become infected. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The more I worry about this, the more a painful combination of real symptoms with hypochondria manifests itself:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I woke up in the morning, I feel a little overwhelmed.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When I got out of bed, I already had a leak from my nose (although it is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">now known</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that a runny nose is not a symptom of COVID-19).</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">While he reached the bathroom to take a napkin, he also coughed.</font></font></li>
</ul><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first I did not attach much importance to this - I am allergic to pollen, and due to warm weather on the east coast, spring came early this year. Most likely, my allergy just broke out. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the symptoms did not improve all day. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here I am sitting here, writing this manual with a thermometer in my mouth; and looking down shows 37.4 ¬∞ C. The temperature is higher than my usual 36.3 ¬∞ C. Everything above 37.2 ¬∞ C, I already consider a slight fever. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cough and a little fever? It could be COVID-19 ... or just my allergy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is impossible to find out without a test, and it is precisely this ‚Äúignorance‚Äù that makes this situation so dangerous for mental balance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For people there is nothing more terrible than the unknown.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite all the fears, I try to get rid of them in a rational way. I'm over thirty, I'm in great shape, my immune system is very strong. I‚Äôll go to quarantine (just in case), I‚Äôll rest and recover normally. COVID-19 does not scare me in terms of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my personal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> health (at least I keep saying this to myself). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, I worry about my elderly relatives, including those who have chronic illnesses, and those in a nursing home or hospital. They are vulnerable, and it will be truly sad if we lose them due to this infection. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order not to sit idly by and not succumb to weakness (be it allergy, COVID-19 or just anxiety), I decided to do what I do best -</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serve the entire community of machine vision and deep learning by writing code, conducting experiments, and teaching others how to use computer vision and deep learning in practical, real-world applications</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, to be honest, this is not the most scientific article I have ever written. </font><font style="vertical-align: inherit;">In fact, far from the most. </font><font style="vertical-align: inherit;">The methods and data sets used do not deserve publication. </font><font style="vertical-align: inherit;">But they can be the starting point for those who want to help. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But I want to do everything in my power. </font><font style="vertical-align: inherit;">This article is simply my way to mentally overcome difficult times and at the same time help others in a similar situation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope you understand me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In today's lesson we will do the following:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will collect a set of open data from fluorograms of patients with a positive test for COVID-19.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We collect a selection of fluorograms of healthy patients.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will train the convolutional neural network to automatically detect COVID-19 in the images from the created set.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will evaluate the results obtained from an educational point of view.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Disclaimer: I have already hinted, but I‚Äôll say it bluntly. </font><font style="vertical-align: inherit;">The methods and techniques in this article are for educational purposes only. </font><font style="vertical-align: inherit;">This is not a real scientific study, and it will not be published in a journal. </font><font style="vertical-align: inherit;">The article is intended for readers who are interested in (1) computer vision / deep learning and want to learn using practical methods, and (2) are concerned about current events. </font><font style="vertical-align: inherit;">I beg you to relate to this in this way.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COVID-19 on fluorograms</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the first part, we discuss how COVID-19 can be detected on chest radiographs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then consider our data set. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then I'll show you how to train the deep learning model using Keras and TensorFlow to define COVID-19 in our image dataset. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My task is to inspire you and show that the study of computer vision / deep learning, and then applying this knowledge in the medical field can have a big impact on the world. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simply put: you do not need a medical degree to contribute to medicine. Deep learning specialists who work closely with doctors and healthcare providers can solve complex problems, save lives, and make the world a better place. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope this guide inspires you to do just that.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But with all this said, scientific journals and expert assessment systems are </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">full of</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> materials with forecasting models of COVID-19 of dubious quality. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Please do not take the code / model from this article and do not send it to the journal or put it in the public domain on scientific sites - you will only add some noise.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In addition, if you intend to use this article (or any other COVID-19 article from the Internet) in your own research, be sure to check the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TRIPOD rules for creating forecast reporting models</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you probably know, the use of AI in medicine leads to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">very real consequences</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Publish or use such models only after close consultation with a medical expert.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f74/c2b/450/f74c2b450fa7308154dca67ad2692309.jpg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 1. An example of a fluorogram from a patient with a positive test for COVID-19. Using Keras and TensorFlow in such images, it is possible to train the classifier to detect COVID-19. COVID-19</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
tests are currently difficult to find -</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> they simply are not enough</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and they cannot be made fast enough, which causes panic.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When there is a panic, some vile people take advantage of this and</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sell fake test kits COVID-19</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> finding victims on social networks and instant messengers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Given that the number of COVID-19 test kits is limited, you should rely on other diagnostic methods.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Doctors often rely on chest x-rays (commonly called fluorograms) to diagnose pneumonia, pneumonia, abscesses, and / or enlarged lymph nodes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COVID-19 attacks the epithelium of the respiratory tract, and X-rays help to examine the patient‚Äôs lung condition. X-ray machines are installed in most hospitals, so it is logical to use fluorography to test COVID-19 without special test kits. The disadvantage is that such an analysis requires a specialist in radiology and takes considerable time. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, the development of an automated system will be very valuable to save the valuable time of medical professionals around the world. </font></font></b><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Some more recent publications suggest that computed tomography is better for diagnosing COVID-19, but in this lesson we only work with fluorograms.</font></font></i> <br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data set</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/855/213/e50/855213e505792a063cef8c831820dd7a.png"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. </font><font style="vertical-align: inherit;">2. On the left are positive samples (from infected patients), and on the right are negative. </font><font style="vertical-align: inherit;">These images are used to train a model to automatically predict the presence of a disease.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Our data set was compiled by</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dr. Joseph Cohen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a graduate student at the University of Montreal. </font><font style="vertical-align: inherit;">In early March, he began collecting fluorograms of patients with COVID-19, MERS, SARS and SARS and publishing them in the</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> repository on GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need to download a file from the repository</font></font><code>metadata.csv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and select the lines from it where it is indicated</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positive result on COVID-19.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type of lungs 'posterior-anterior' (PA). </font><font style="vertical-align: inherit;">As far as I understand, this is the type of image used in ‚Äúhealthy‚Äù images.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A total of 25 fluorograms were found with positive cases of COVID-19 (Fig. 2, left). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For healthy patients, I used the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuggle dataset (pneumonia)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and selected 25 images of healthy patients (Fig. 2, right). </font><font style="vertical-align: inherit;">This data set has a number of problems, namely noisy / incorrect labels, but it will do for a conceptual check of the COVID-19 automatic detector.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project structure</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the Downloads section of my website, you can enter your email address and find out a link to the archive with code, scripts and other files for this project. </font><font style="vertical-align: inherit;">Extract the files and you will see the directory structure:</font></font><br>
<br>
<pre><code class="bash hljs">$ tree --dirsfirst --filelimit 10<font></font>
.<font></font>
‚îú‚îÄ‚îÄ dataset<font></font>
‚îÇ   ‚îú‚îÄ‚îÄ covid [25 entries]<font></font>
‚îÇ   ‚îî‚îÄ‚îÄ normal [25 entries]<font></font>
‚îú‚îÄ‚îÄ build_covid_dataset.py<font></font>
‚îú‚îÄ‚îÄ sample_kaggle_dataset.py<font></font>
‚îú‚îÄ‚îÄ train_covid19.py<font></font>
‚îú‚îÄ‚îÄ plot.png<font></font>
‚îî‚îÄ‚îÄ covid19.model<font></font>
3 directories, 5 files</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fluorograms are in a directory </font></font><code>dataset/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">where two data classes are divided into directories </font></font><code>covid/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>normal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Both scripts are presented for building a data set, but we will not consider them today. </font><font style="vertical-align: inherit;">Instead, consider a script </font></font><code>train_covid19.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that teaches our COVID-19 detector.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's move on to setting up a convolutional neural network. </font><font style="vertical-align: inherit;">Open the file </font></font><code>train_covid19.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and paste the following code:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># import the necessary packages</span>
<span class="hljs-keyword">from</span> tensorflow.keras.preprocessing.image <span class="hljs-keyword">import</span> ImageDataGenerator
<span class="hljs-keyword">from</span> tensorflow.keras.applications <span class="hljs-keyword">import</span> VGG16
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> AveragePooling2D
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Dropout
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Flatten
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Dense
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Input
<span class="hljs-keyword">from</span> tensorflow.keras.models <span class="hljs-keyword">import</span> Model
<span class="hljs-keyword">from</span> tensorflow.keras.optimizers <span class="hljs-keyword">import</span> Adam
<span class="hljs-keyword">from</span> tensorflow.keras.utils <span class="hljs-keyword">import</span> to_categorical
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelBinarizer
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> confusion_matrix
<span class="hljs-keyword">from</span> imutils <span class="hljs-keyword">import</span> paths
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> os</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This script uses a number of deep learning libraries from TensorFlow 2.0 and Keras. </font><font style="vertical-align: inherit;">In addition, we use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scikit-learn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the standard Python library for machine learning, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matplotlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for graphing, and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for loading and processing images. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To install TensorFlow 2.0 (including the appropriate scikit-learn, OpenCV, and matplotlib libraries), just follow my instructions for </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubuntu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we will analyze the command line arguments and initialize the hyperparameters:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># construct the argument parser and parse the arguments</span><font></font>
ap = argparse.ArgumentParser()<font></font>
ap.add_argument(<span class="hljs-string">"-d"</span>, <span class="hljs-string">"--dataset"</span>, required=<span class="hljs-literal">True</span>,<font></font>
	help=<span class="hljs-string">"path to input dataset"</span>)<font></font>
ap.add_argument(<span class="hljs-string">"-p"</span>, <span class="hljs-string">"--plot"</span>, type=str, default=<span class="hljs-string">"plot.png"</span>,<font></font>
	help=<span class="hljs-string">"path to output loss/accuracy plot"</span>)<font></font>
ap.add_argument(<span class="hljs-string">"-m"</span>, <span class="hljs-string">"--model"</span>, type=str, default=<span class="hljs-string">"covid19.model"</span>,<font></font>
	help=<span class="hljs-string">"path to output loss/accuracy plot"</span>)<font></font>
args = vars(ap.parse_args())<font></font>
<span class="hljs-comment"># initialize the initial learning rate, number of epochs to train for,</span>
<span class="hljs-comment"># and batch size</span>
INIT_LR = <span class="hljs-number">1e-3</span>
EPOCHS = <span class="hljs-number">25</span>
BS = <span class="hljs-number">8</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Three </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">command line arguments</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><code>--dataset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: path to the input dataset</font></font><br>
</li>
<li><code>--plot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: An optional path to the exit schedule for your learning history. </font><font style="vertical-align: inherit;">Unless otherwise specified, the default is</font></font><code>plot.png</code><br>
</li>
<li><code>--model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: optional path to the output model; </font><font style="vertical-align: inherit;">default</font></font><code>covid19.model</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next lines initialize the initial learning speed, the number of eras, and the hyperparameters of the packet size. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we are ready to download and pre-process the fluorograms:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># grab the list of images in our dataset directory, then initialize</span>
<span class="hljs-comment"># the list of data (i.e., images) and class images</span>
print(<span class="hljs-string">"[INFO] loading images..."</span>)<font></font>
imagePaths = list(paths.list_images(args[<span class="hljs-string">"dataset"</span>]))<font></font>
data = []<font></font>
labels = []<font></font>
<span class="hljs-comment"># loop over the image paths</span>
<span class="hljs-keyword">for</span> imagePath <span class="hljs-keyword">in</span> imagePaths:
	<span class="hljs-comment"># extract the class label from the filename</span>
	label = imagePath.split(os.path.sep)[<span class="hljs-number">-2</span>]
	<span class="hljs-comment"># load the image, swap color channels, and resize it to be a fixed</span>
	<span class="hljs-comment"># 224x224 pixels while ignoring aspect ratio</span><font></font>
	image = cv2.imread(imagePath)<font></font>
	image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)<font></font>
	image = cv2.resize(image, (<span class="hljs-number">224</span>, <span class="hljs-number">224</span>))
	<span class="hljs-comment"># update the data and labels lists, respectively</span><font></font>
	data.append(image)<font></font>
	labels.append(label)<font></font>
<span class="hljs-comment"># convert the data and labels to NumPy arrays while scaling the pixel</span>
<span class="hljs-comment"># intensities to the range [0, 1]</span>
data = np.array(data) / <span class="hljs-number">255.0</span>
labels = np.array(labels)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To load data, we capture all the paths to the images in the catalog </font></font><code>--dataset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Then for each </font></font><code>imagePath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We retrieve the class label ( </font></font><code>covid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>normal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">from the path </font><font style="vertical-align: inherit;">.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We load </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and pre-process it, converting it to RGB and resizing to 224 √ó 224 pixels, so that it is ready for the neural network.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Updating lists </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>labels</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then scale the pixel intensity to the range [0, 1] and convert the data and labels to the NumPy array format. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we perform direct encoding </font></font><code>labels</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with dividing the data into sets for training / testing:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># perform one-hot encoding on the labels</span><font></font>
lb = LabelBinarizer()<font></font>
labels = lb.fit_transform(labels)<font></font>
labels = to_categorical(labels)<font></font>
<span class="hljs-comment"># partition the data into training and testing splits using 80% of</span>
<span class="hljs-comment"># the data for training and the remaining 20% for testing</span><font></font>
(trainX, testX, trainY, testY) = train_test_split(data, labels,<font></font>
	test_size=<span class="hljs-number">0.20</span>, stratify=labels, random_state=<span class="hljs-number">42</span>)
<span class="hljs-comment"># initialize the training data augmentation object</span><font></font>
trainAug = ImageDataGenerator(<font></font>
	rotation_range=<span class="hljs-number">15</span>,<font></font>
	fill_mode=<span class="hljs-string">"nearest"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Direct encoding means that the data is converted into the following format:</font></font><br>
<br>
<pre><code class="python hljs">[[<span class="hljs-number">0.</span> <span class="hljs-number">1.</span>]<font></font>
 [<span class="hljs-number">0.</span> <span class="hljs-number">1.</span>]<font></font>
 [<span class="hljs-number">0.</span> <span class="hljs-number">1.</span>]<font></font>
 ...<font></font>
 [<span class="hljs-number">1.</span> <span class="hljs-number">0.</span>]<font></font>
 [<span class="hljs-number">1.</span> <span class="hljs-number">0.</span>]<font></font>
 [<span class="hljs-number">1.</span> <span class="hljs-number">0.</span>]]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each encoded label consists of an array with two elements: 'hot' (1) or 'not' (0). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then the following lines separate our data, leaving 80% for training and 20% for testing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To make sure the model is generalized, we perform augmentation of the data by setting the image to randomly rotate 15 ¬∞ clockwise or counterclockwise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last three lines initialize the data augmentation generator object. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now initialize our VGGNet model and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fine-tune it</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># load the VGG16 network, ensuring the head FC layer sets are left</span>
<span class="hljs-comment"># off</span>
baseModel = VGG16(weights=<span class="hljs-string">"imagenet"</span>, include_top=<span class="hljs-literal">False</span>,<font></font>
	input_tensor=Input(shape=(<span class="hljs-number">224</span>, <span class="hljs-number">224</span>, <span class="hljs-number">3</span>)))
<span class="hljs-comment"># construct the head of the model that will be placed on top of the</span>
<span class="hljs-comment"># the base model</span><font></font>
headModel = baseModel.output<font></font>
headModel = AveragePooling2D(pool_size=(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>))(headModel)<font></font>
headModel = Flatten(name=<span class="hljs-string">"flatten"</span>)(headModel)<font></font>
headModel = Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">"relu"</span>)(headModel)<font></font>
headModel = Dropout(<span class="hljs-number">0.5</span>)(headModel)<font></font>
headModel = Dense(<span class="hljs-number">2</span>, activation=<span class="hljs-string">"softmax"</span>)(headModel)
<span class="hljs-comment"># place the head FC model on top of the base model (this will become</span>
<span class="hljs-comment"># the actual model we will train)</span><font></font>
model = Model(inputs=baseModel.input, outputs=headModel)<font></font>
<span class="hljs-comment"># loop over all layers in the base model and freeze them so they will</span>
<span class="hljs-comment"># *not* be updated during the first training process</span>
<span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> baseModel.layers:<font></font>
	layer.trainable = <span class="hljs-literal">False</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first two lines create an instance of the VGG16 network with weights previously trained on ImageNet without touching the fully connected layer (FC). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we build a new fully connected layer, consisting of layers </font></font><code>POOL =&gt; FC = SOFTMAX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and add it on top of VGG16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we freeze the weights </font></font><code>CONV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for VGG16, so </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the FC layer </font><font style="vertical-align: inherit;">will be trained </font><font style="vertical-align: inherit;">. This completes the setup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we are ready to compile and train our deep learning model for COVID-19:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># compile our model</span>
print(<span class="hljs-string">"[INFO] compiling model..."</span>)<font></font>
opt = Adam(lr=INIT_LR, decay=INIT_LR / EPOCHS)<font></font>
model.compile(loss=<span class="hljs-string">"binary_crossentropy"</span>, optimizer=opt,<font></font>
	metrics=[<span class="hljs-string">"accuracy"</span>])
<span class="hljs-comment"># train the head of the network</span>
print(<span class="hljs-string">"[INFO] training head..."</span>)<font></font>
H = model.fit_generator(<font></font>
	trainAug.flow(trainX, trainY, batch_size=BS),<font></font>
	steps_per_epoch=len(trainX) // BS,<font></font>
	validation_data=(testX, testY),<font></font>
	validation_steps=len(testX) // BS,<font></font>
	epochs=EPOCHS)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first lines compile the neural network with the option to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reduce learning speed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the optimizer </font></font><code>Adam</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Given that this is a two-class problem, we use loss </font></font><code>"binary_crossentropy"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rather than cross entropy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To start the learning process, we call the fit_generator </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">method in Keras</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , passing the fluorograms through our data augmentation object. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We evaluate the model:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># make predictions on the testing set</span>
print(<span class="hljs-string">"[INFO] evaluating network..."</span>)<font></font>
predIdxs = model.predict(testX, batch_size=BS)<font></font>
<span class="hljs-comment"># for each image in the testing set we need to find the index of the</span>
<span class="hljs-comment"># label with corresponding largest predicted probability</span>
predIdxs = np.argmax(predIdxs, axis=<span class="hljs-number">1</span>)
<span class="hljs-comment"># show a nicely formatted classification report</span>
print(classification_report(testY.argmax(axis=<span class="hljs-number">1</span>), predIdxs,<font></font>
	target_names=lb.classes_))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To evaluate, we first make forecasts on the test set, preserving the forecast indices. </font><font style="vertical-align: inherit;">Then we create and display a classification report using scikit-learn, where there is such an auxiliary function. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we calculate the matrix of inaccuracies for further statistical evaluation:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># compute the confusion matrix and and use it to derive the raw</span>
<span class="hljs-comment"># accuracy, sensitivity, and specificity</span>
cm = confusion_matrix(testY.argmax(axis=<span class="hljs-number">1</span>), predIdxs)<font></font>
total = sum(sum(cm))<font></font>
acc = (cm[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] + cm[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]) / total<font></font>
sensitivity = cm[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] / (cm[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] + cm[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>])<font></font>
specificity = cm[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] / (cm[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>] + cm[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
<span class="hljs-comment"># show the confusion matrix, accuracy, sensitivity, and specificity</span><font></font>
print(cm)<font></font>
print(<span class="hljs-string">"acc: {:.4f}"</span>.format(acc))<font></font>
print(<span class="hljs-string">"sensitivity: {:.4f}"</span>.format(sensitivity))<font></font>
print(<span class="hljs-string">"specificity: {:.4f}"</span>.format(specificity))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we do the following:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We generate a matrix of inaccuracies.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With its help, we calculate accuracy, sensitivity and specificity by printing all these metrics.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For self-testing, we generate a graph with a history of training accuracy and losses, output it to a graphic file:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># plot the training loss and accuracy</span><font></font>
N = EPOCHS<font></font>
plt.style.use(<span class="hljs-string">"ggplot"</span>)<font></font>
plt.figure()<font></font>
plt.plot(np.arange(<span class="hljs-number">0</span>, N), H.history[<span class="hljs-string">"loss"</span>], label=<span class="hljs-string">"train_loss"</span>)<font></font>
plt.plot(np.arange(<span class="hljs-number">0</span>, N), H.history[<span class="hljs-string">"val_loss"</span>], label=<span class="hljs-string">"val_loss"</span>)<font></font>
plt.plot(np.arange(<span class="hljs-number">0</span>, N), H.history[<span class="hljs-string">"accuracy"</span>], label=<span class="hljs-string">"train_acc"</span>)<font></font>
plt.plot(np.arange(<span class="hljs-number">0</span>, N), H.history[<span class="hljs-string">"val_accuracy"</span>], label=<span class="hljs-string">"val_acc"</span>)<font></font>
plt.title(<span class="hljs-string">"Training Loss and Accuracy on COVID-19 Dataset"</span>)<font></font>
plt.xlabel(<span class="hljs-string">"Epoch #"</span>)<font></font>
plt.ylabel(<span class="hljs-string">"Loss/Accuracy"</span>)<font></font>
plt.legend(loc=<span class="hljs-string">"lower left"</span>)<font></font>
plt.savefig(args[<span class="hljs-string">"plot"</span>])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, save the classifier model </font></font><code>tf.keras</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to disk:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># serialize the model to disk</span>
print(<span class="hljs-string">"[INFO] saving COVID-19 detector model..."</span>)<font></font>
model.save(args[<span class="hljs-string">"model"</span>], save_format=<span class="hljs-string">"h5"</span>)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detector training</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After downloading all the files from the archive with the sources and scripts mentioned above, open the console and run the following command to train the detector:</font></font><br>
<br>
<pre><code class="bash hljs">$ python train_covid19.py --dataset dataset<font></font>
[INFO] loading images...<font></font>
[INFO] compiling model...<font></font>
[INFO] training head...<font></font>
Epoch 1/25<font></font>
5/5 [==============================] - 20s 4s/step - loss: 0.7169 - accuracy: 0.6000 - val_loss: 0.6590 - val_accuracy: 0.5000<font></font>
Epoch 2/25<font></font>
5/5 [==============================] - 0s 86ms/step - loss: 0.8088 - accuracy: 0.4250 - val_loss: 0.6112 - val_accuracy: 0.9000<font></font>
Epoch 3/25<font></font>
5/5 [==============================] - 0s 99ms/step - loss: 0.6809 - accuracy: 0.5500 - val_loss: 0.6054 - val_accuracy: 0.5000<font></font>
Epoch 4/25<font></font>
5/5 [==============================] - 1s 100ms/step - loss: 0.6723 - accuracy: 0.6000 - val_loss: 0.5771 - val_accuracy: 0.6000<font></font>
...<font></font>
Epoch 22/25<font></font>
5/5 [==============================] - 0s 99ms/step - loss: 0.3271 - accuracy: 0.9250 - val_loss: 0.2902 - val_accuracy: 0.9000<font></font>
Epoch 23/25<font></font>
5/5 [==============================] - 0s 99ms/step - loss: 0.3634 - accuracy: 0.9250 - val_loss: 0.2690 - val_accuracy: 0.9000<font></font>
Epoch 24/25<font></font>
5/5 [==============================] - 27s 5s/step - loss: 0.3175 - accuracy: 0.9250 - val_loss: 0.2395 - val_accuracy: 0.9000<font></font>
Epoch 25/25<font></font>
5/5 [==============================] - 1s 101ms/step - loss: 0.3655 - accuracy: 0.8250 - val_loss: 0.2522 - val_accuracy: 0.9000<font></font>
[INFO] evaluating network...<font></font>
              precision    recall  f1-score   support<font></font>
       covid       0.83      1.00      0.91         5<font></font>
      normal       1.00      0.80      0.89         5<font></font>
    accuracy                           0.90        10<font></font>
   macro avg       0.92      0.90      0.90        10<font></font>
weighted avg       0.92      0.90      0.90        10<font></font>
[[5 0]<font></font>
 [1 4]]<font></font>
acc: 0.9000<font></font>
sensitivity: 1.0000<font></font>
specificity: 0.8000<font></font>
[INFO] saving COVID-19 detector model...</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatic diagnosis of COVID-19 according to the results of fluorography</font></font></h2><br>
<i><b>  :</b>      ,  ¬´¬ª   COVID-19.        .              ,        ,    ,    (  ,        ).  ,  /       COVID-19.</i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As can be seen from the above results, our automatic detector has an accuracy of about 90-92% on an existing set of samples. </font><font style="vertical-align: inherit;">This rating is based on image analysis only. </font><font style="vertical-align: inherit;">During training, no more data was used, including geographical location, population density, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The sensitivity was 100%, and the specificity was 80%, which means:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Truly infected patients are recognized in 100% of cases.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Healthy patients are recognized as healthy with a probability of 80%.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As the training history graph shows, our network is not too retrained, despite a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">very limited</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> data set: The </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/cf5/53a/b9f/cf553ab9faf7bf72c58b885e016809c8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ability to recognize COVID-19 with absolute accuracy is great, although the rate of false positives is a little worrying, because many healthy people will be sent to quarantine with really infected patients. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Balancing sensitivity and specificity is incredibly difficult when it comes to medical applications, especially in the case of infectious diseases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When it comes to computer vision and deep training in medicine, you should always remember that our predictive models can have very real consequences - a missed diagnosis can cost a living.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Again, these results are collected for educational purposes only. </font><font style="vertical-align: inherit;">This article and the accompanying results are not intended for publication in a scientific journal and do not comply </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the TRIPOD rules for the creation of forecast reporting models</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitations, improvements and future work</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/cc9/625/a5c/cc9625a5cdbe14b0b74d42eed54945cc.jpg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4. Currently, artificial intelligence (AI) specialists and deep learning specialists suffer from a lack of quality data for the effective training of COVID-19 automatic detection systems on images ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
One of the main limitations for creating such systems is data. We simply do not have enough (reliable) data to train the COVID-19 detector. Hospitals are crowded with COVID-19 patients, but given their rights and privacy, it is becoming</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> even more difficult</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to collect quality sets of medical images in a timely manner.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I suppose that in the next 12-18 months the problem will be solved, but for now we are content with what we have. I did my best (considering my current mental and physical condition) to compile a guide for those who are interested in using computer vision and deep learning in the fight against COVID-19, taking into account time and resource limitations. But I must remind you that I am not a medical expert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A true COVID-19 detector must undergo rigorous testing by trained medical professionals working hand in hand with experienced deep learning practitioners. The method described here, of course, is not suitable for practical use and is intended only for educational purposes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, we must wonder what this model actually ‚Äúlearns‚Äù.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As I said in</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by the Grad-CAM guide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> last week, it is entirely possible that our model studies patterns that are not related to COVID-19, but simply are variations between two data sets (i.e., between patients with and without COVID-19). To confirm the results, thorough testing and expert assistance is required. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, future (and best) detectors will be multimodal.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Now we </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consider </font><font style="vertical-align: inherit;">images (for example, x-rays). The best COVID-19 automated detectors should use several data sources, not limited to images, including patient vital signs, population density, geographical location, etc. Images alone are usually not enough for this type of application.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope this guide serves as a starting point for anyone interested in using computer vision and deep learning to automatically detect COVID-19.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What's next?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I usually end my blog articles with a recommendation from one of my books or courses so you can learn more about using computer vision and deep learning. </font><font style="vertical-align: inherit;">Out of respect for the seriousness of the coronavirus, I'm not going to do this - now is not the time or the place. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead, I will say that we are now in a very terrible period of life. </font><font style="vertical-align: inherit;">Like the seasons, everything will pass, but for now you need to squat down and prepare for the cold winter - it is likely that the worst is yet to come. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I received several letters from PyImageSearch readers who want to use this downtime to study computer vision and deep learning, rather than go crazy in their homes. </font><font style="vertical-align: inherit;">This is a useful thought.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this guide, you learned how to use Keras and TensorFlow to train the COVID-19 automatic detector on a fluorogram set. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are no high-quality, peer-reviewed image datasets for COVID-19 (yet), so we had to work with what we had, namely, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joseph Cohen's repository on GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We selected 25 images from the Cohen dataset, selecting only the posterior-anterior (PA) view and a confirmed diagnosis.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then 25 images of healthy patients were selected from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a data set with Kaggle fluorography images (pneumonia)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We used Keras and TensorFlow to train the COVID-19 detector, which demonstrates 90-92% accuracy, 100% sensitivity and 80% specificity on the test set (given our limited data set). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keep in mind that the COVID-19 detector described is for educational purposes only.</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497612/index.html">The story of how the invisible hand of the market transferred me to a remote place</a></li>
<li><a href="../en497614/index.html">Thought experiments, paradoxes and boundaries of logic // We are doomed # 2</a></li>
<li><a href="../en497616/index.html">Interview with Alexander Makarov (Yii) about Opensource, conferences and Yii</a></li>
<li><a href="../en497618/index.html">Implementation of the concept of highly secure remote access</a></li>
<li><a href="../en497620/index.html">Writing a chrome telegram alert plugin</a></li>
<li><a href="../en497624/index.html">Digital Banking Campus - internship program results</a></li>
<li><a href="../en497628/index.html">How to kill a lot of time on a small script or the history of one pull request</a></li>
<li><a href="../en497632/index.html">Web HighLoad - how we manage the traffic of tens of thousands of domains</a></li>
<li><a href="../en497634/index.html">Rainbow Coloring Are Mathematicians' Best Friends</a></li>
<li><a href="../en497636/index.html">How the lack of computing power affected naval battles in world wars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>