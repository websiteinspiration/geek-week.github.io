<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è© ü§ôüèª ‚ö´Ô∏è PHP: array_key_exists sucht 500-mal schneller als in_array üí± üåï üíÖüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="2014 haben sie bereits √ºber die Suche nach dem Array geschrieben , aber kaum jemand hat es verstanden.
 
 Seitdem wurden viele Versionen von PHP ver√∂f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PHP: array_key_exists sucht 500-mal schneller als in_array</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490664/"><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014 haben sie bereits √ºber die Suche nach dem Array geschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aber kaum jemand hat es verstanden.</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Seitdem wurden viele Versionen von PHP ver√∂ffentlicht und nicht behoben, was bedeutet, dass das Feedback schlecht ist und nur wenige Menschen davon wissen. Auf Python ist es dasselbe und in 3 * schlechter als in 2.7.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Manchmal m√ºssen Sie eine Zeichenfolge in einem Array von Zeichenfolgen finden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - eine sehr h√§ufige Operation in verschiedenen Algorithmen. Wenn das Array klein ist und ein wenig und nicht in einer Schleife aussieht, wirkt sich in_array normal auf die Gesamtgeschwindigkeit aus. Wenn Sie jedoch gro√üe Datenmengen ben√∂tigen und nach einem Array mit einer Milliarde Zeilen und einer Milliarde suchen , dann ist das entscheidend: bessere Stunde statt Woche.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein einfacher Test zeigt:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in_array sucht in 6-9 Sekunden nach</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideone.com/Yb1mDa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6600ms</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und array_key_exists sucht nach demselben, aber schneller als 250 (php5.6 / py3. *) 400+ mal (php7.3 / py2.7)</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideone .com / gwSmFc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Zyklus um das 100-fache erh√∂ht) 12 ms (6600/12 = 550-fache + -10% Streuung aufgrund von Last und Cache) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum geschieht dies? </font><font style="vertical-align: inherit;">Betrachten Sie im Detail:</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Um Strings in reinen Assemblern zu finden, wird ein Array von Strings (schnell oder blasig) sortiert und anschlie√üend bin√§r gesucht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Anzahl der Schritte in einem bin√§ren Suchprotokoll (n) h√§ngt von der Gr√∂√üe des Arrays ab und ist viel kleiner als eine einfache Suche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen ein Array von Zeichenfolgen im Voraus einmal sortieren und zwischenspeichern und dann eine Milliarde Suchvorg√§nge durchf√ºhren. </font><font style="vertical-align: inherit;">Das hilft aber nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Standardm√§√üig erfolgt die Sortierung jedes Mal erneut, obwohl sie geschrieben haben, dass sie sich in 7.2 in_array durch einen Hash verbessert haben, aber nicht viel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Suchen Sie den Index / Schl√ºssel (als Zeichenfolge) in der Zuordnung. Array / W√∂rterbuch erfolgt durch Hash von Strings und Kollisionsverarbeitung (Hash-Suchfehler). Ein Hash ist der numerische Index des Arrays und wird in 2 Schritten als (Adresse des Nullelements) + Offset * die Gr√∂√üe des Zeigers auf das Array von Zeichenfolgen mit diesem Hash abgerufen. + Brute-Force-Kollisionen, Schritte im Durchschnitt weniger als die bin√§re Suche. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Index-Hash wird beim Erstellen des W√∂rterbuchelements $ m [key] = val automatisch einmal im Voraus ausgef√ºhrt und zwischengespeichert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Gr√∂√üe des Hashs, der Hash-Algorithmus, ist in die PHP-Engine eingen√§ht und kann nicht ge√§ndert werden. Obwohl der Quellcode ge√∂ffnet ist, k√∂nnen Sie ihn herunterladen, um ihn zu √§ndern und zu kompilieren, wenn Ihr Server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen nicht weiter lesen, in_array in array_combine + array_key_exists √§ndern und fertig.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Anzahl der Schritte bei der Suche nach Hash h√§ngt von der Anzahl der Kollisionen und der Anzahl der Zeilen mit demselben Hash ab. Sie m√ºssen aussortiert oder auch sortiert und bin√§r gesucht werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um Kollisionen zu reduzieren, k√∂nnen Sie mehr Speicher zuweisen, wenn es m√∂glich ist, dass dies jetzt kein Problem mehr ist wie vor 50 Jahren, als 1 KB Speicher auf Magnetspulen wie ein Flugzeug kostet. Und dann wurden alle grundlegenden Algorithmen erfunden: sort / zip / gif / jpg / etc. - sie brauchen nicht viel Speicher, aber sie sind schlecht, jetzt sind sie viel besser, aber sie brauchen viel Speicher 1-16 MB. Ja, es gibt Server mit 256 MB und jeder hat einen eigenen Stream und 16 MB sind bereits viel, aber auf dem Ger√§t eines durchschnittlichen Benutzers mindestens 1 GB und 16 MB ist ein Tropfen auf den hei√üen Stein.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen noch mehr Wirkung erzielen, wenn Sie den Aufruf der Funktion array_key_exists durch das Konstrukt isset ($ m [key]) ersetzen, die Befehlswarteschlange und den Cache nicht l√∂schen, den Stapel nicht verwenden und um etwa 20% schneller sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen es auch beschleunigen, wenn Sie ein Array aus den ersten beiden Buchstaben - 4 * 16 KB - erstellen und zuerst den Versatz (Index = Code des 1. Zeichens + 2. * 256) eines Zeigers auf das Hash-Array f√ºr den Rest der Zeile betrachten und dann nach einem kleinen Array von ‚ÄûSchw√§nzen‚Äú von Zeichenfolgen suchen und Kollisionen sind viel kleiner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ben√∂tigt noch mehr Speicher und der Algorithmus ist komplizierter, aber die Suche ist mehr als 30-mal schneller. Dies ist jedoch nicht in PHP implementiert. Sie k√∂nnen Ihre so / dll-Bibliothek schreiben und aufrufen oder Entwickler bitten, sie in 7.5 hinzuzuf√ºgen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen mySQL durchsuchen, aber Sie m√ºssen Abfragen gruppieren, und es wird immer noch langsamer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS: Diese Methode wurde versehentlich durch Tippen, Intuition und Erfahrung gefunden, als ich eine gro√üe langsame Website beschleunigte. Es gibt viele solche Feinheiten und Tricks. Ich habe es geschafft, die zu exportierenden Daten von 40 Sekunden auf 0,8 Sekunden zu bringen, Listen mit Sortierung und Filtern auszugeben und viele andere Dinge, bei denen Standardtechniken, Frameworks und Frameworks alles zu langsam machen, obwohl sie nat√ºrlich praktisch sind und die Entwicklung beschleunigen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490650/index.html">Die Hauptfehler bei der Erstellung eines Lebenslaufs durch IT-Anf√§nger</a></li>
<li><a href="../de490652/index.html">Logistik. Einf√ºhrung Fast kompliziert</a></li>
<li><a href="../de490654/index.html">Punktierung √ºber Gassensoren der MQ-Serie - tiefes Verst√§ndnis des Datenblattes und der Abstimmung</a></li>
<li><a href="../de490656/index.html">Externe Aufgaben von Camunda - ein leistungsstarkes Tool zum Erstellen von Anwendungen mit einer stabilen und skalierbaren Architektur</a></li>
<li><a href="../de490660/index.html">Wie haben wir das Wachstum von CityMobile sichergestellt?</a></li>
<li><a href="../de490668/index.html">Die Geschichte der Transformation vom Produkt zum Projekt und umgekehrt (am Beispiel der G√ºte in der Region Moskau)</a></li>
<li><a href="../de490670/index.html">Wie man ein Auto dazu bringt, Tests aus Code f√ºr Sie zu schreiben</a></li>
<li><a href="../de490674/index.html">Habr Wickley # 41 / Autonomere Autos, prof. Fortran, Yandex, der Schmerz des Roboters, wie man die Website eines Konkurrenten blockiert</a></li>
<li><a href="../de490676/index.html">Unit Testing, Naturwissenschaften und Mathematik</a></li>
<li><a href="../de490678/index.html">Verwenden von RabbitMQ mit MonsterMQ Teil 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>