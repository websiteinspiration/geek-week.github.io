<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ—„ï¸ ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ‘¶ åˆ›å»ºä¸€ä¸ªä¼ª3Dèµ›è½¦æ¸¸æˆï¼šå®ç°ä¸˜é™µå¹¶å®Œæˆæ¸¸æˆ ğŸ’†ğŸ¼ ğŸš¾ ğŸ§”ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬3éƒ¨åˆ†ã€‚ä¸˜é™µ
 
 åœ¨ä¸Šä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ä¼ªä¸‰ç»´èµ›è½¦æ¸¸æˆï¼Œåœ¨å…¶ä¸­å®ç°äº†ç›´çº¿é“è·¯å’Œå¼¯é“ã€‚
 
 è¿™æ¬¡æˆ‘ä»¬è¦ç…§é¡¾å±±ä¸˜ï¼›å¹¸è¿çš„æ˜¯ï¼Œè¿™æ¯”åˆ›å»ºå¼¯æ›²çš„é“è·¯è¦å®¹æ˜“å¾—å¤šã€‚
 
 åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸ä¼¼ä¸‰è§’å½¢çš„å®šå¾‹åˆ›å»ºäº†ä¸‰ç»´é€è§†æŠ•å½±ï¼š
 
 
 ...å¯¼è‡´æˆ‘ä»¬è·å¾—äº†å°†3dä¸–ç•Œçš„åæ ‡æŠ•å½±åˆ°2då±å¹•çš„å...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>åˆ›å»ºä¸€ä¸ªä¼ª3Dèµ›è½¦æ¸¸æˆï¼šå®ç°ä¸˜é™µå¹¶å®Œæˆæ¸¸æˆ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499442/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬3éƒ¨åˆ†ã€‚ä¸˜é™µ</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/892/231/4e8/8922314e8acebdd3ae14fba511d17294.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸Šä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ä¼ªä¸‰ç»´</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èµ›è½¦æ¸¸æˆ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåœ¨å…¶ä¸­å®ç°äº†ç›´çº¿é“è·¯å’Œå¼¯é“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ¬¡æˆ‘ä»¬è¦ç…§é¡¾å±±ä¸˜ï¼›</font><font style="vertical-align: inherit;">å¹¸è¿çš„æ˜¯ï¼Œè¿™æ¯”åˆ›å»ºå¼¯æ›²çš„é“è·¯è¦å®¹æ˜“å¾—å¤šã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸ä¼¼ä¸‰è§’å½¢çš„å®šå¾‹åˆ›å»ºäº†ä¸‰ç»´é€è§†æŠ•å½±ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/949/0ab/47b/9490ab47bb570b61218e46e5913c18bb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...å¯¼è‡´æˆ‘ä»¬è·å¾—äº†å°†3dä¸–ç•Œçš„åæ ‡æŠ•å½±åˆ°2då±å¹•çš„åæ ‡çš„æ–¹ç¨‹å¼ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/edb/246/e18/edb246e187e7fe0eb027b53c58790c34.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...ä½†æ˜¯ä»é‚£æ—¶èµ·ï¼Œæˆ‘ä»¬åªä½¿ç”¨ç›´è¡Œé“è·¯ï¼Œå› æ­¤ä¸–ç•Œåæ ‡åªéœ€è¦</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ†é‡</font><font style="vertical-align: inherit;">ï¼Œå› ä¸º</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éƒ½ç­‰äºé›¶ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™å¾ˆé€‚åˆæˆ‘ä»¬ï¼Œå› ä¸ºæ·»åŠ å±±è¶³ä»¥ä¸ºè·¯æ®µèµ‹äºˆå¯¹åº”çš„éé›¶åæ ‡</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç„¶åç°æœ‰åŠŸèƒ½å°†</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¥å¥‡åœ°èµ·ä½œç”¨ã€‚</font></font><a name="habracut"></a><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ede/dc6/295/ededc629516e6f0d2c7f1ca6b111e17d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ˜¯çš„ï¼Œè¿™è¶³ä»¥ä½¿äººä¸Šå±±ã€‚</font><font style="vertical-align: inherit;">åªéœ€å°†</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ†é‡æ·»åŠ åˆ°æ¯ä¸ªè·¯æ®µçš„ä¸–ç•Œåæ ‡</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“è·¯å‡ ä½•å½¢çŠ¶çš„å˜åŒ–</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ä¿®æ”¹ç°æœ‰æ–¹æ³•ï¼Œ</font></font><code>addSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä½¿è°ƒç”¨å®ƒçš„å‡½æ•°å¯ä»¥ä¼ é€’</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2.world.y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè€Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1.world.y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ä¸ä¸Š</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€æ®µçš„</font></font></strong><font style="vertical-align: inherit;"><strong><font style="vertical-align: inherit;">p2.world.y</font></strong><font style="vertical-align: inherit;">ç›¸å¯¹åº”</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSegment</span>(<span class="hljs-params">curve, y</span>) </span>{
  <span class="hljs-keyword">var</span> n = segments.length;<font></font>
  segments.push({<font></font>
     <span class="hljs-attr">index</span>: n,
        <span class="hljs-attr">p1</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">y</span>: lastY(), <span class="hljs-attr">z</span>:  n   *segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
        <span class="hljs-attr">p2</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">y</span>: y,       <span class="hljs-attr">z</span>: (n+<span class="hljs-number">1</span>)*segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
     <span class="hljs-attr">curve</span>: curve,
     <span class="hljs-attr">color</span>: <span class="hljs-built_in">Math</span>.floor(n/rumbleLength)%<span class="hljs-number">2</span> ? COLORS.DARK : COLORS.LIGHT<font></font>
  });<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lastY</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> (segments.length == <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : segments[segments.length<span class="hljs-number">-1</span>].p2.world.y;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ·»åŠ å¸¸æ•°ä»¥è¡¨ç¤ºä½ï¼ˆ</font></font><code>LOW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ï¼Œä¸­ï¼ˆ</font></font><code>MEDIUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰å’Œé«˜ï¼ˆ</font></font><code>HIGH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰å¡åº¦ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> ROAD = {
  <span class="hljs-attr">LENGTH</span>: { <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">SHORT</span>:  <span class="hljs-number">25</span>, <span class="hljs-attr">MEDIUM</span>:  <span class="hljs-number">50</span>, <span class="hljs-attr">LONG</span>:  <span class="hljs-number">100</span> },
  <span class="hljs-attr">HILL</span>:   { <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">LOW</span>:    <span class="hljs-number">20</span>, <span class="hljs-attr">MEDIUM</span>:  <span class="hljs-number">40</span>, <span class="hljs-attr">HIGH</span>:   <span class="hljs-number">60</span> },
  <span class="hljs-attr">CURVE</span>:  { <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">EASY</span>:    <span class="hljs-number">2</span>, <span class="hljs-attr">MEDIUM</span>:   <span class="hljs-number">4</span>, <span class="hljs-attr">HARD</span>:    <span class="hljs-number">6</span> }<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ›´æ”¹ç°æœ‰æ–¹æ³•</font></font><code>addRoad()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½¿å…¶æ¥æ”¶å‚æ•°</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¯¥</font><font style="vertical-align: inherit;">å‚æ•°</font><font style="vertical-align: inherit;">å°†ä¸å¹³æ»‘å‡½æ•°ä¸€èµ·ç”¨äºä»å±±ä¸Šé€æ¸ä¸Šå‡å’Œä¸‹é™çš„æƒ…å†µï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRoad</span>(<span class="hljs-params">enter, hold, leave, curve, y</span>) </span>{
  <span class="hljs-keyword">var</span> startY   = lastY();
  <span class="hljs-keyword">var</span> endY     = startY + (Util.toInt(y, <span class="hljs-number">0</span>) * segmentLength);
  <span class="hljs-keyword">var</span> n, total = enter + hold + leave;
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; enter ; n++)<font></font>
    addSegment(Util.easeIn(<span class="hljs-number">0</span>, curve, n/enter), Util.easeInOut(startY, endY, n/total));
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; hold  ; n++)<font></font>
    addSegment(curve, Util.easeInOut(startY, endY, (enter+n)/total));<font></font>
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; leave ; n++)<font></font>
    addSegment(Util.easeInOut(curve, <span class="hljs-number">0</span>, n/leave), Util.easeInOut(startY, endY, (enter+hold+n)/total));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤å¤–ï¼Œç±»ä¼¼äºæˆ‘ä»¬åœ¨ç¬¬2éƒ¨åˆ†ä¸­æ‰€åšçš„</font></font><code>addSCurves()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåŠ æˆ‘ä»¬æ„é€ å‡ ä½•æ‰€éœ€çš„ä»»ä½•æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addLowRollingHills</span>(<span class="hljs-params">num, height</span>) </span>{<font></font>
  num    = num    || ROAD.LENGTH.SHORT;<font></font>
  height = height || ROAD.HILL.LOW;<font></font>
  addRoad(num, num, num,  <span class="hljs-number">0</span>,  height/<span class="hljs-number">2</span>);<font></font>
  addRoad(num, num, num,  <span class="hljs-number">0</span>, -height);<font></font>
  addRoad(num, num, num,  <span class="hljs-number">0</span>,  height);<font></font>
  addRoad(num, num, num,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>);<font></font>
  addRoad(num, num, num,  <span class="hljs-number">0</span>,  height/<span class="hljs-number">2</span>);<font></font>
  addRoad(num, num, num,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>);<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹æ›´æ–°æ–¹æ³•</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æˆ‘ä»¬åˆ›å»ºçš„è¡—æœºæ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šå°è¯•æ¨¡æ‹Ÿç°å®ï¼Œå› æ­¤ä¸˜é™µä¸ä¼šä»¥ä»»ä½•æ–¹å¼å½±å“ç©å®¶æˆ–æ¸¸æˆä¸–ç•Œï¼Œè¿™æ„å‘³ç€è¯¥æ–¹æ³•</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸éœ€è¦æ›´æ”¹ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸Œå°”æ¸²æŸ“</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ–¹æ³•</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿä¸éœ€è¦æ›´æ”¹ï¼Œå› ä¸ºæŠ•å½±æ–¹ç¨‹æœ€åˆæ˜¯ä¸ºäº†æ­£ç¡®æŠ•å½±å…·æœ‰éé›¶</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åæ ‡çš„è·¯æ®µè€Œç¼–å†™çš„</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§†å·®æ»šåŠ¨èƒŒæ™¯</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†å°†</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åæ ‡æ·»åŠ åˆ°æ‰€æœ‰è·¯æ®µå¤–</font><font style="vertical-align: inherit;">ï¼Œå”¯ä¸€çš„å˜åŒ–å°†æ˜¯èƒŒæ™¯å›¾å±‚ä¸ä¸˜é™µçš„å‚ç›´ä½ç§»çš„å®ç°ï¼ˆå°±åƒå®ƒä»¬éšæ›²çº¿æ°´å¹³ç§»åŠ¨ä¸€æ ·ï¼‰ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨è¾…åŠ©å‡½æ•°çš„å¦ä¸€ä¸ªå‚æ•°æ¥å®ç°è¿™ä¸€ç‚¹</font></font><code>Render.background</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€ç®€å•çš„æœºåˆ¶æ˜¯ç›¸å¯¹äºä½ç½®çš„é€šå¸¸èƒŒæ™¯ä½ç§»</font></font><code>playerY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆåº”ä»</font><font style="vertical-align: inherit;">å½“å‰ç©å®¶ç»†åˆ†çš„</font><font style="vertical-align: inherit;">ä¸–ç•Œä½ç½®</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†…æ’</font><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ä¸æ˜¯æœ€ç°å®çš„è¡Œä¸ºï¼Œå› ä¸ºå¯èƒ½å€¼å¾—è€ƒè™‘ç©å®¶å½“å‰è·¯æ®µçš„å¡åº¦ï¼Œä½†æ˜¯è¿™ç§æ•ˆæœå¾ˆç®€å•ï¼Œå¹¶ä¸”å¯¹äºç®€å•çš„æ¼”ç¤ºæ¥è¯´æ•ˆæœå¾ˆå¥½ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°±æ˜¯è¿™æ ·ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨çœŸå®çš„å±±ä¸˜æ¥è¡¥å……å‡æ›²çº¿äº†ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/892/231/4e8/8922314e8acebdd3ae14fba511d17294.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­æ‰€åšçš„å·¥ä½œï¼ŒåŒ…æ‹¬æ·»åŠ çœŸå®çš„3Dä¸˜é™µçš„åŸºç¡€è®¾æ–½ï¼Œæˆ‘ä¹‹å‰æ²¡æœ‰å‘Šè¯‰è¿‡æ‚¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æœ¬æ–‡çš„æœ€åä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åœ¨é“è·¯è¾¹ç¼˜æ·»åŠ ç²¾çµï¼Œæ ‘æœ¨å’Œå¹¿å‘Šç‰Œã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å°†æ·»åŠ å…¶ä»–å¯ä»¥ä¸ä¹‹ç«äº‰çš„èµ›è½¦ï¼Œè¯†åˆ«ç¢°æ’å¹¶ä¿®å¤ç©å®¶çš„â€œåœˆæ•°è®°å½•â€ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬4éƒ¨åˆ†ã€‚å°±ç»ªç‰ˆæœ¬</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/103/563/0d1/1035630d19106de2f85edebb24d0421f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ·»åŠ ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¿å‘Šç‰Œå’Œæ ‘æœ¨</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ä»–è½¦</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¢°æ’è¯†åˆ«</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ±½è½¦çš„åŸºæœ¬AI</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å•åœˆè®¡æ—¶å™¨å’Œå•åœˆè®°å½•æ¥å£</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â€¦â€¦è¿™å°†ä¸ºæˆ‘ä»¬æä¾›è¶³å¤Ÿçš„äº¤äº’æ€§ï¼Œæœ€ç»ˆå°†æˆ‘ä»¬çš„é¡¹ç›®ç§°ä¸ºâ€œæ¸¸æˆâ€ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰å…³ä»£ç ç»“æ„çš„æ³¨æ„äº‹é¡¹</font></font></h2><br>
<blockquote><em>     ,            /,         Javascript.</em></blockquote><br>
<blockquote><em>                .     () ,             ...</em></blockquote><br>
<blockquote><em>â€¦      ,       ,           ,  ,         .</em></blockquote><br>
<h2></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6f/111/acc/f6f111accbba448459e25c6fe761ff05.png"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç¬¬1éƒ¨åˆ†ä¸­ï¼Œåœ¨æ¸¸æˆå‘¨æœŸå¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸Šä¼ äº†ä¸€ä¸ªç²¾çµè¡¨ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰çš„æ±½è½¦ï¼Œæ ‘æœ¨å’Œå¹¿å‘Šç‰Œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥åœ¨ä»»ä½•å›¾åƒç¼–è¾‘å™¨ä¸­æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªç²¾çµè¡¨ï¼Œä½†æ˜¯æœ€å¥½å°†å›¾åƒçš„å­˜å‚¨å’Œåæ ‡çš„è®¡ç®—å§”æ‰˜ç»™è‡ªåŠ¨åŒ–å·¥å…·ã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œç²¾çµè¡¨æ˜¯ç”±ä¸€ä¸ªå°çš„Rakeä»»åŠ¡ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruby Gem sprite-factoryç”Ÿæˆçš„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ä»»åŠ¡ä»å•ç‹¬çš„å›¾åƒæ–‡ä»¶ç”Ÿæˆç»„åˆçš„Spritesheetsï¼Œå¹¶è®¡ç®—åæ ‡xï¼Œyï¼Œwï¼Œhï¼Œè¿™äº›åæ ‡å°†å­˜å‚¨åœ¨å¸¸é‡ä¸­</font></font><code>SPRITES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> SPRITES = {
  <span class="hljs-attr">PALM_TREE</span>:   { <span class="hljs-attr">x</span>:    <span class="hljs-number">5</span>, <span class="hljs-attr">y</span>:    <span class="hljs-number">5</span>, <span class="hljs-attr">w</span>:  <span class="hljs-number">215</span>, <span class="hljs-attr">h</span>:  <span class="hljs-number">540</span> },
  <span class="hljs-attr">BILLBOARD08</span>: { <span class="hljs-attr">x</span>:  <span class="hljs-number">230</span>, <span class="hljs-attr">y</span>:    <span class="hljs-number">5</span>, <span class="hljs-attr">w</span>:  <span class="hljs-number">385</span>, <span class="hljs-attr">h</span>:  <span class="hljs-number">265</span> },<font></font>
<font></font>
  <span class="hljs-comment">// ... etc</span><font></font>
<font></font>
  <span class="hljs-attr">CAR04</span>:       { <span class="hljs-attr">x</span>: <span class="hljs-number">1383</span>, <span class="hljs-attr">y</span>:  <span class="hljs-number">894</span>, <span class="hljs-attr">w</span>:   <span class="hljs-number">80</span>, <span class="hljs-attr">h</span>:   <span class="hljs-number">57</span> },
  <span class="hljs-attr">CAR01</span>:       { <span class="hljs-attr">x</span>: <span class="hljs-number">1205</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">1018</span>, <span class="hljs-attr">w</span>:   <span class="hljs-number">80</span>, <span class="hljs-attr">h</span>:   <span class="hljs-number">56</span> },<font></font>
};</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ å¹¿å‘Šç‰Œå’Œæ ‘æœ¨</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨é“è·¯çš„æ¯ä¸ªè·¯æ®µä¸Šæ·»åŠ ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å°†åŒ…å«æ²¿é“è·¯è¾¹ç¼˜çš„å¯¹è±¡ç²¾çµã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¯ä¸ªå­å›¾ç”±</font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»é›†åˆ</font><font style="vertical-align: inherit;">ä¸­</font><font style="vertical-align: inherit;">è·å–çš„</font></font><code>SPRITES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥åŠæ°´å¹³åç§»é‡ç»„æˆ</font></font><code>offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">æ°´å¹³åç§»é‡</font><font style="vertical-align: inherit;">å·²å½’ä¸€åŒ–ï¼Œå› æ­¤-1è¡¨ç¤ºé“è·¯çš„å·¦è¾¹ç¼˜ï¼Œè€Œ+1è¡¨ç¤ºå³è¾¹ç¼˜ï¼Œè¿™ä½¿æˆ‘ä»¬ä¸å¿…ä¾èµ–äºå€¼</font></font><code>roadWidth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰äº›ç²¾çµæ˜¯æœ‰æ„æ”¾ç½®çš„ï¼Œæœ‰äº›åˆ™æ˜¯éšæœºçš„ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSegment</span>(<span class="hljs-params"></span>) </span>{<font></font>
  segments.push({<font></font>
    ...<font></font>
    sprites: [],<font></font>
    ...<font></font>
  });<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSprite</span>(<span class="hljs-params">n, sprite, offset</span>) </span>{<font></font>
  segments[n].sprites.push({ <span class="hljs-attr">source</span>: sprite, <span class="hljs-attr">offset</span>: offset });<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetSprites</span>(<span class="hljs-params"></span>) </span>{<font></font>
<font></font>
  addSprite(<span class="hljs-number">20</span>,  SPRITES.BILLBOARD07, <span class="hljs-number">-1</span>);<font></font>
  addSprite(<span class="hljs-number">40</span>,  SPRITES.BILLBOARD06, <span class="hljs-number">-1</span>);<font></font>
  addSprite(<span class="hljs-number">60</span>,  SPRITES.BILLBOARD08, <span class="hljs-number">-1</span>);<font></font>
  addSprite(<span class="hljs-number">80</span>,  SPRITES.BILLBOARD09, <span class="hljs-number">-1</span>);<font></font>
  addSprite(<span class="hljs-number">100</span>, SPRITES.BILLBOARD01, <span class="hljs-number">-1</span>);<font></font>
  addSprite(<span class="hljs-number">120</span>, SPRITES.BILLBOARD02, <span class="hljs-number">-1</span>);<font></font>
  addSprite(<span class="hljs-number">140</span>, SPRITES.BILLBOARD03, <span class="hljs-number">-1</span>);<font></font>
  addSprite(<span class="hljs-number">160</span>, SPRITES.BILLBOARD04, <span class="hljs-number">-1</span>);<font></font>
  addSprite(<span class="hljs-number">180</span>, SPRITES.BILLBOARD05, <span class="hljs-number">-1</span>);<font></font>
<font></font>
  addSprite(<span class="hljs-number">240</span>, SPRITES.BILLBOARD07, <span class="hljs-number">-1.2</span>);<font></font>
  addSprite(<span class="hljs-number">240</span>, SPRITES.BILLBOARD06,  <span class="hljs-number">1.2</span>);<font></font>
<font></font>
  <font></font>
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">250</span> ; n &lt; <span class="hljs-number">1000</span> ; n += <span class="hljs-number">5</span>) {<font></font>
    addSprite(n, SPRITES.COLUMN, <span class="hljs-number">1.1</span>);<font></font>
    addSprite(n + Util.randomInt(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>), SPRITES.TREE1, <span class="hljs-number">-1</span> - (<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">2</span>));<font></font>
    addSprite(n + Util.randomInt(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>), SPRITES.TREE2, <span class="hljs-number">-1</span> - (<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">2</span>));<font></font>
  }<font></font>
<font></font>
  ...<font></font>
}</code></pre><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼šå¦‚æœè¦åˆ›å»ºçœŸå®çš„æ¸¸æˆï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™é“è·¯ç¼–è¾‘å™¨ä»¥å¯è§†åŒ–æ–¹å¼åˆ›å»ºå…·æœ‰ä¸˜é™µå’Œæ›²çº¿çš„åœ°å›¾ï¼Œå¹¶æ·»åŠ æ²¿é“è·¯å¸ƒç½®ç²¾çµçš„æœºåˆ¶...ä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼è¿›è¡Œ</font></font><code>addSprite()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠ æ–™æœº</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†é“è·¯è¾¹ç¼˜çš„å¯¹è±¡ç²¾çµå¤–ï¼Œæˆ‘ä»¬è¿˜å°†æ·»åŠ ä¸€ä¸ªå°†å æ®æ¯ä¸ªè·¯æ®µ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ±½è½¦</font><font style="vertical-align: inherit;">é›†åˆï¼Œ</font><font style="vertical-align: inherit;">ä»¥åŠé«˜é€Ÿå…¬è·¯ä¸Š</font><strong><font style="vertical-align: inherit;">æ‰€æœ‰</font></strong><font style="vertical-align: inherit;">æ±½è½¦</font><font style="vertical-align: inherit;">çš„å•ç‹¬é›†åˆ</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> cars      = [];  <span class="hljs-comment">// array of cars on the road</span>
<span class="hljs-keyword">var</span> totalCars = <span class="hljs-number">200</span>; <span class="hljs-comment">// total number of cars on the road</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSegment</span>(<span class="hljs-params"></span>) </span>{<font></font>
  segments.push({<font></font>
    ...<font></font>
    cars: [], <span class="hljs-comment">// array of cars within this segment</span><font></font>
    ...<font></font>
  });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡å­˜å‚¨ä¸¤ä¸ªæ±½è½¦æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä»¥ä¸€ç§æ–¹æ³•è¿­ä»£åœ°éå†æ‰€æœ‰æ±½è½¦</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶åœ¨å¿…è¦æ—¶å°†å®ƒä»¬ä»ä¸€ä¸ªåŒºæ®µç§»åŠ¨åˆ°å¦ä¸€ä¸ªåŒºæ®µã€‚</font><font style="vertical-align: inherit;">åŒæ—¶ï¼Œè¿™å…è®¸æˆ‘ä»¬</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…åœ¨å¯è§æ®µä¸Š</font><font style="vertical-align: inherit;">æ‰§è¡Œ</font><font style="vertical-align: inherit;">æœºå™¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¯å°æœºå™¨éƒ½æœ‰ä¸€ä¸ªéšæœºçš„æ°´å¹³ä½ç§»ï¼Œzä½ç½®ï¼Œå­ç”»é¢æºå’Œé€Ÿåº¦ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetCars</span>(<span class="hljs-params"></span>) </span>{<font></font>
  cars = [];<font></font>
  <span class="hljs-keyword">var</span> n, car, segment, offset, z, sprite, speed;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span> ; n &lt; totalCars ; n++) {<font></font>
    offset = <span class="hljs-built_in">Math</span>.random() * Util.randomChoice([<span class="hljs-number">-0.8</span>, <span class="hljs-number">0.8</span>]);<font></font>
    z      = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * segments.length) * segmentLength;<font></font>
    sprite = Util.randomChoice(SPRITES.CARS);<font></font>
    speed  = maxSpeed/<span class="hljs-number">4</span> + <span class="hljs-built_in">Math</span>.random() * maxSpeed/(sprite == SPRITES.SEMI ? <span class="hljs-number">4</span> : <span class="hljs-number">2</span>);<font></font>
    car = { <span class="hljs-attr">offset</span>: offset, <span class="hljs-attr">z</span>: z, <span class="hljs-attr">sprite</span>: sprite, <span class="hljs-attr">speed</span>: speed };<font></font>
    segment = findSegment(car.z);<font></font>
    segment.cars.push(car);<font></font>
    cars.push(car);<font></font>
  }<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸Œå°”æ¸²æŸ“ï¼ˆè¿”å›ï¼‰</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å‰é¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘è®¨è®ºäº†æ¸²æŸ“é“è·¯æ®µï¼ˆåŒ…æ‹¬æ›²çº¿å’Œå±±ä¸˜ï¼‰çš„è¿‡ç¨‹ï¼Œä½†æ˜¯å…¶ä¸­æœ‰å‡ è¡Œæˆ‘æ²¡æœ‰è€ƒè™‘è¿‡ã€‚ä»–ä»¬å…³å¿ƒçš„æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒ</font></font><code>maxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»å±å¹•åº•éƒ¨å¼€å§‹ï¼Œä½†æ˜¯åœ¨æ¸²æŸ“æ¯ä¸ªæ®µä»¥ç¡®å®šæˆ‘ä»¬å·²ç»æ¸²æŸ“äº†å±å¹•çš„å“ªä¸€éƒ¨åˆ†æ—¶é€’å‡ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; drawDistance ; n++) {<font></font>
<font></font>
  ...<font></font>
<font></font>
  if ((segment.p1.camera.z &lt;= cameraDepth) || <span class="hljs-comment">// behind us</span>
      (segment.p2.screen.y &gt;= maxy))          <span class="hljs-comment">// clip by (already rendered) segment</span>
    <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
  ...<font></font>
<font></font>
  maxy = segment.p2.screen.y;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™å°†ä½¿æˆ‘ä»¬å¯ä»¥è£å‰ªå·²è¢«æ¸²æŸ“çš„å±±ä¸˜è¦†ç›–çš„éƒ¨åˆ†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‰ºæœ¯å®¶çš„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼ ç»Ÿ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ç®—æ³•ä¸­ï¼Œ</font></a><font style="vertical-align: inherit;">æ¸²æŸ“é€šå¸¸å‘ç”Ÿåœ¨èƒŒé¢ï¼Œè€Œè¾ƒè¿‘çš„éƒ¨åˆ†åˆ™ä¸è¾ƒè¿œçš„éƒ¨åˆ†é‡å ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½èŠ±æ—¶é—´æ¸²æŸ“æœ€ç»ˆä¼šè¢«è¦†ç›–çš„å¤šè¾¹å½¢ï¼Œå› æ­¤ï¼Œå¦‚æœæŠ•å½±åæ ‡è¾ƒå°ï¼Œåˆ™ä»å‰å‘åæ¸²æŸ“å’Œè£å‰ªå·²è¢«æ¸²æŸ“çš„è¿‘æ®µè¦†ç›–çš„é¥è¿œæ®µå˜å¾—å®¹æ˜“</font></font><code>maxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸²æŸ“å¹¿å‘Šç‰Œï¼Œæ ‘æœ¨å’Œæ±½è½¦</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œæ¸²æŸ“å­ç”»é¢æ—¶ï¼Œä»å‰åˆ°åçš„é“è·¯æ®µè¿­ä»£éå†å°†ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸ç›¸äº’é‡å ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨è‰ºæœ¯å®¶çš„ç®—æ³•è¿›è¡Œæ¸²æŸ“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ä½¿æˆ‘ä»¬çš„æ–¹æ³•å˜å¾—å¤æ‚ï¼Œ</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶è¿«ä½¿æˆ‘ä»¬åˆ†ä¸¤ä¸ªé˜¶æ®µç»•è¿‡è·¯æ®µï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»å‰åˆ°åè¿›è¡Œé“è·¯æ¸²æŸ“</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åé€€ä»¥æ¸²æŸ“ç²¾çµ</font></font></li>
</ol><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8db/7d3/347/8db7d3347ac49621e67b7bbe2028fc6e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†éƒ¨åˆ†é‡å çš„ç²¾çµå¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤„ç†ç”±äºå±±é¡¶çš„åœ°å¹³çº¿è€Œâ€œç•¥å¾®çªå‡ºâ€çš„ç²¾çµã€‚å¦‚æœå­ç”»é¢è¶³å¤Ÿé«˜ï¼Œåˆ™å³ä½¿å®ƒæ‰€åœ¨çš„è·¯æ®µä½äºå±±å¡çš„åéƒ¨ï¼Œå› æ­¤ä¹Ÿä¸ä¼šå‘ˆç°ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥çœ‹åˆ°å…¶ä¸Šéƒ¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿å­˜çš„å€¼è§£å†³è¿™ä¸ªæœ€åçš„é—®é¢˜</font></font><code>maxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªæ®µä¸ºçº¿</font></font><code>clip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¥éª¤1ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥è£å‰ªæ²¿çº¿æœ¬æ®µçš„ç²¾çµ</font></font><code>clip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¥éª¤2ä¸­</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼Œå‘ˆç°é€»è¾‘çš„å…¶ä½™éƒ¨åˆ†ç¡®å®šå¦‚ä½•æ¯”ä¾‹å’Œä½ç½®åŸºäºç³»æ•°ç²¾çµ</font></font><code>scale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œåæ ‡</font></font><code>screen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„é“è·¯æ®µçš„ï¼ˆè®¡ç®—é˜¶æ®µ1ï¼‰ï¼Œå› æ­¤åœ¨è¯¥æ–¹æ³•çš„ç¬¬äºŒé˜¶æ®µï¼Œ</font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// back to front painters algorithm</span>
<span class="hljs-keyword">for</span>(n = (drawDistance<span class="hljs-number">-1</span>) ; n &gt; <span class="hljs-number">0</span> ; n--) {<font></font>
  segment = segments[(baseSegment.index + n) % segments.length];<font></font>
<font></font>
  <span class="hljs-comment">// render roadside sprites</span>
  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span> ; i &lt; segment.sprites.length ; i++) {<font></font>
    sprite      = segment.sprites[i];<font></font>
    spriteScale = segment.p1.screen.scale;<font></font>
    spriteX     = segment.p1.screen.x + (spriteScale * sprite.offset * roadWidth * width/<span class="hljs-number">2</span>);<font></font>
    spriteY     = segment.p1.screen.y;<font></font>
    Render.sprite(ctx, width, height, resolution, roadWidth, sprites, sprite.source, spriteScale, spriteX, spriteY, (sprite.offset &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">0</span>), <span class="hljs-number">-1</span>, segment.clip);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// render other cars</span>
  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span> ; i &lt; segment.cars.length ; i++) {<font></font>
    car         = segment.cars[i];<font></font>
    sprite      = car.sprite;<font></font>
    spriteScale = Util.interpolate(segment.p1.screen.scale, segment.p2.screen.scale, car.percent);<font></font>
    spriteX     = Util.interpolate(segment.p1.screen.x,     segment.p2.screen.x,     car.percent) + (spriteScale * car.offset * roadWidth * width/<span class="hljs-number">2</span>);<font></font>
    spriteY     = Util.interpolate(segment.p1.screen.y,     segment.p2.screen.y,     car.percent);<font></font>
    Render.sprite(ctx, width, height, resolution, roadWidth, sprites, car.sprite, spriteScale, spriteX, spriteY, <span class="hljs-number">-0.5</span>, <span class="hljs-number">-1</span>, segment.clip);<font></font>
  }<font></font>
<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å¹¿å‘Šç‰Œå’Œæ ‘æœ¨çš„ç¢°æ’</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æˆ‘ä»¬å¯ä»¥æ²¿é“è·¯è¾¹ç¼˜æ·»åŠ å’Œæ¸²æŸ“å¯¹è±¡ç²¾çµï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹æ–¹æ³•</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ç¡®å®šç©å®¶åœ¨å½“å‰æ®µä¸­æ˜¯å¦é‡åˆ°äº†è¿™äº›ç²¾çµä¸­çš„ä»»ä½•</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€ä¸ª</font><font style="vertical-align: inherit;">ï¼š</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨è¾…åŠ©æ–¹æ³•</font></font><code>Util.overlap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥å®ç°å¯¹çŸ©å½¢ç›¸äº¤çš„å¹¿ä¹‰è¯†åˆ«ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ£€æµ‹åˆ°äº¤å‰è·¯å£ï¼Œæˆ‘ä»¬å°†åœè½¦ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> ((playerX &lt; <span class="hljs-number">-1</span>) || (playerX &gt; <span class="hljs-number">1</span>)) {
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; playerSegment.sprites.length ; n++) {<font></font>
    sprite  = playerSegment.sprites[n];<font></font>
    spriteW = sprite.source.w * SPRITES.SCALE;<font></font>
    <span class="hljs-keyword">if</span> (Util.overlap(playerX, playerW, sprite.offset + spriteW/<span class="hljs-number">2</span> * (sprite.offset &gt; <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>), spriteW)) {
      <span class="hljs-comment">// stop the car</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼šå¦‚æœæ‚¨å­¦ä¹ çœŸå®çš„ä»£ç ï¼Œæ‚¨ä¼šå‘ç°å®é™…ä¸Šæˆ‘ä»¬ä¸æ˜¯åœ¨åœè½¦ï¼Œå› ä¸ºé‚£æ ·ä¸€æ¥ï¼Œå®ƒå°†æ— æ³•ä¾§å‘ç§»åŠ¨ä»¥é¿å¼€éšœç¢ç‰©ï¼›</font><font style="vertical-align: inherit;">ä½œä¸ºä¸€ä¸ªç®€å•çš„æŠ€å·§ï¼Œæˆ‘ä»¬å›ºå®šå®ƒä»¬çš„ä½ç½®ï¼Œå¹¶å…è®¸æ±½è½¦â€œæ»‘åŠ¨â€åˆ°ç²¾çµå‘¨å›´ã€‚</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ±½è½¦ç›¸æ’</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†æ²¿é“è·¯è¾¹ç¼˜ä¸å°ç²¾çµç¢°æ’å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¯†åˆ«ä¸å…¶ä»–æ±½è½¦çš„ç¢°æ’ï¼Œå¦‚æœæ£€æµ‹åˆ°äº¤å‰è·¯å£ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡å°†ç©å®¶â€œæ¨â€å›ä¸ä¹‹ç¢°æ’çš„æœºå™¨åé¢æ¥å‡æ…¢ç©å®¶çš„é€Ÿåº¦ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; playerSegment.cars.length ; n++) {<font></font>
  car  = playerSegment.cars[n];<font></font>
  carW = car.sprite.w * SPRITES.SCALE;<font></font>
  <span class="hljs-keyword">if</span> (speed &gt; car.speed) {
    <span class="hljs-keyword">if</span> (Util.overlap(playerX, playerW, car.offset, carW, <span class="hljs-number">0.8</span>)) {
      <span class="hljs-comment">// slow the car</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœºå™¨æ›´æ–°</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†è®©å…¶ä»–æ±½è½¦æ²¿ç€é“è·¯è¡Œé©¶ï¼Œæˆ‘ä»¬å°†ä¸ºä»–ä»¬æä¾›æœ€ç®€å•çš„AIï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥æ’å®šçš„é€Ÿåº¦éª‘</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¶…è½¦æ—¶è‡ªåŠ¨ç»•è¿‡ç©å®¶</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¶…è½¦æ—¶è‡ªåŠ¨ç»•è¿‡å…¶ä»–æ±½è½¦</font></font></li>
</ul><br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼šæˆ‘ä»¬ä¸å¿…æ‹…å¿ƒåœ¨é“è·¯ä¸Šæ²¿ç€å¼¯é“è½¬å¼¯å…¶ä»–æ±½è½¦ï¼Œå› ä¸ºè¿™äº›å¼¯é“ä¸æ˜¯çœŸå®çš„ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬ä½¿æ±½è½¦ä»…æ²¿é“è·¯æ®µç§»åŠ¨ï¼Œå®ƒä»¬å°†è‡ªåŠ¨æ²¿æ›²çº¿é€šè¿‡ã€‚</font></font></em></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€æœ‰è¿™ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¯</font><font style="vertical-align: inherit;">æœŸé—´çš„æ¸¸æˆå‘¨æœŸä¸­ï¼Œ</font><font style="vertical-align: inherit;">åœ¨æ­¤é€šè¯</font></font><code>updateCars()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­ï¼Œæˆ‘ä»¬å°†æ¯è¾†æ±½è½¦ä»¥æ’å®šé€Ÿåº¦å‘å‰ç§»åŠ¨ï¼Œå¦‚æœåœ¨æ­¤å¸§ä¸­å®ƒä»¬ç§»åŠ¨äº†è¶³å¤Ÿçš„è·ç¦»ï¼Œåˆ™ä»ä¸€ä¸ªæ®µåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ®µã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateCars</span>(<span class="hljs-params">dt, playerSegment, playerW</span>) </span>{
  <span class="hljs-keyword">var</span> n, car, oldSegment, newSegment;
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; cars.length ; n++) {<font></font>
    car         = cars[n];<font></font>
    oldSegment  = findSegment(car.z);<font></font>
    car.offset  = car.offset + updateCarOffset(car, oldSegment, playerSegment, playerW);<font></font>
    car.z       = Util.increase(car.z, dt * car.speed, trackLength);<font></font>
    car.percent = Util.percentRemaining(car.z, segmentLength); <span class="hljs-comment">// useful for interpolation during rendering phase</span><font></font>
    newSegment  = findSegment(car.z);<font></font>
    <span class="hljs-keyword">if</span> (oldSegment != newSegment) {<font></font>
      index = oldSegment.cars.indexOf(car);<font></font>
      oldSegment.cars.splice(index, <span class="hljs-number">1</span>);<font></font>
      newSegment.cars.push(car);<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ–¹æ³•</font></font><code>updateCarOffset()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æä¾›äº†</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œäººå·¥æ™ºèƒ½â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„å®ç°</font><font style="vertical-align: inherit;">ï¼Œä½¿æœºå™¨å¯ä»¥ç»•è¿‡æ’­æ”¾å™¨æˆ–å…¶ä»–æœºå™¨ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä»£ç åº“ä¸­æœ€å¤æ‚çš„æ–¹æ³•ä¹‹ä¸€ï¼Œåœ¨å®é™…æ¸¸æˆä¸­ï¼Œå®ƒåº”è¯¥æ›´åŠ å¤æ‚ï¼Œä»¥ä½¿æœºå™¨çœ‹ä¸Šå»æ¯”ç®€å•çš„æ¼”ç¤ºæ›´ä¸ºçœŸå®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¹¼ç¨šçš„AIè›®åŠ›ï¼Œè¿«ä½¿æ¯å°æœºå™¨ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœŸå¾…20ä¸ªç»†åˆ†å¸‚åœº</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå¥¹å‘ç°å‰æ–¹æœ‰è¾ƒæ…¢çš„æ±½è½¦æ¨ªç©¿è‡ªå·±çš„å°è·¯ï¼Œåˆ™ç»•è¿‡å¥¹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»é“è·¯å·¦ä¾§çš„éšœç¢ç‰©å‘å³è½¬</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨é“è·¯çš„å³ä¾§å‘å·¦æ‹å¼¯</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¬å¼¯è¶³ä»¥é¿å…åœ¨å‰©ä½™è·ç¦»å†…å‰æ–¹çš„éšœç¢ç‰©</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬è¿˜å¯ä»¥ç”¨é‚£äº›ç©å®¶çœ‹ä¸è§çš„æ±½è½¦ä½œå¼Šï¼Œä»è€Œä½¿å®ƒä»¬ä¸èƒ½ç›¸äº’ç»•è¿‡å¹¶é€šè¿‡ã€‚</font><font style="vertical-align: inherit;">ä»–ä»¬åº”è¯¥åªåœ¨ç©å®¶çš„è§†é‡èŒƒå›´å†…æ‰æ˜¾å¾—â€œèªæ˜â€ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateCarOffset</span>(<span class="hljs-params">car, carSegment, playerSegment, playerW</span>) </span>{<font></font>
<font></font>
  <span class="hljs-keyword">var</span> i, j, dir, segment, otherCar, otherCarW, lookahead = <span class="hljs-number">20</span>, carW = car.sprite.w * SPRITES.SCALE;<font></font>
<font></font>
  <span class="hljs-comment">// optimization, dont bother steering around other cars when 'out of sight' of the player</span>
  <span class="hljs-keyword">if</span> ((carSegment.index - playerSegment.index) &gt; drawDistance)
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">1</span> ; i &lt; lookahead ; i++) {<font></font>
    segment = segments[(carSegment.index+i)%segments.length];<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ((segment === playerSegment) &amp;&amp; (car.speed &gt; speed) &amp;&amp; (Util.overlap(playerX, playerW, car.offset, carW, <span class="hljs-number">1.2</span>))) {
      <span class="hljs-keyword">if</span> (playerX &gt; <span class="hljs-number">0.5</span>)<font></font>
        dir = <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (playerX &lt; <span class="hljs-number">-0.5</span>)<font></font>
        dir = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">else</span>
        dir = (car.offset &gt; playerX) ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">return</span> dir * <span class="hljs-number">1</span>/i * (car.speed-speed)/maxSpeed; <span class="hljs-comment">// the closer the cars (smaller i) and the greater the speed ratio, the larger the offset</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span> ; j &lt; segment.cars.length ; j++) {<font></font>
      otherCar  = segment.cars[j];<font></font>
      otherCarW = otherCar.sprite.w * SPRITES.SCALE;<font></font>
      <span class="hljs-keyword">if</span> ((car.speed &gt; otherCar.speed) &amp;&amp; Util.overlap(car.offset, carW, otherCar.offset, otherCarW, <span class="hljs-number">1.2</span>)) {
        <span class="hljs-keyword">if</span> (otherCar.offset &gt; <span class="hljs-number">0.5</span>)<font></font>
          dir = <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (otherCar.offset &lt; <span class="hljs-number">-0.5</span>)<font></font>
          dir = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span>
          dir = (car.offset &gt; otherCar.offset) ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">return</span> dir * <span class="hljs-number">1</span>/i * (car.speed-otherCar.speed)/maxSpeed;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥ç®—æ³•æ•ˆæœå¾ˆå¥½ï¼Œä½†æ˜¯åœ¨å‰é¢æœ‰å¤§é‡æ±½è½¦çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°æ±½è½¦åœ¨ä»å·¦å‘å³å’Œå‘åç§»åŠ¨ï¼Œè¯•å›¾æŒ¤å…¥å…¶ä»–ä¸¤å°æœºå™¨ä¹‹é—´çš„ç¼éš™ã€‚</font><font style="vertical-align: inherit;">æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥æé«˜AIçš„å¯é æ€§ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ±½è½¦å‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥é¿å¼€éšœç¢ç‰©ï¼Œåˆ™å¯ä»¥è®©æ±½è½¦å‡é€Ÿã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥å£</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„HTMLç•Œé¢ï¼š</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;div id =â€œ hudâ€&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;span id =â€œ speedâ€ class =â€œ hudâ€&gt; &lt;span id =â€œ speed_valueâ€ class =â€œ valueâ€&gt; 0 &lt;/ span&gt; mph &lt;/ span&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;span id =â€œ current_lap_timeâ€ class =â€œ hudâ€&gt;æ—¶é—´ï¼š&lt;span id =â€œ current_lap_time_valueâ€ class =â€œ valueâ€&gt; 0.0 &lt;/ span&gt; &lt;/ span&gt; </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;span id =â€œ last_lap_timeâ€ class =â€œ hudâ€&gt;æœ€åä¸€åœˆï¼š&lt;span id =â€œ last_lap_time_valueâ€ class =â€œ valueâ€&gt; 0.0 &lt;/ span&gt; &lt;/ span&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;span id =â€œ fast_lap_timeâ€ class =â€œ hudâ€&gt;æœ€å¿«åœˆï¼š&lt;span id =â€œ fast_lap_time_valueâ€ class =â€œ valueâ€&gt; 0.0 &lt;/ span&gt; &lt;/ span&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;/ div&gt;</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...å¹¶ä¸ºå…¶æ·»åŠ CSSæ ·å¼</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-id">#hud</span>                   { <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">width</span>: <span class="hljs-number">640px</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">0</span>; <span class="hljs-attribute">font-family</span>: Verdana, Geneva, sans-serif; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8em</span>; <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.4</span>); <span class="hljs-attribute">color</span>: black; <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid black; <span class="hljs-attribute">box-sizing</span>: border-box; <span class="hljs-attribute">-moz-box-sizing</span>: border-box; <span class="hljs-attribute">-webkit-box-sizing</span>: border-box; }
<span class="hljs-selector-id">#hud</span> <span class="hljs-selector-class">.hud</span>              { <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0.6</span>); <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>; <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">5px</span>; <span class="hljs-attribute">transition-property</span>: background-color; <span class="hljs-attribute">transition-duration</span>: <span class="hljs-number">2s</span>; <span class="hljs-attribute">-webkit-transition-property</span>: background-color; <span class="hljs-attribute">-webkit-transition-duration</span>: <span class="hljs-number">2s</span>; }
<span class="hljs-selector-id">#hud</span> <span class="hljs-selector-id">#speed</span>            { <span class="hljs-attribute">float</span>: right; }
<span class="hljs-selector-id">#hud</span> <span class="hljs-selector-id">#current_lap_time</span> { <span class="hljs-attribute">float</span>: left;  }
<span class="hljs-selector-id">#hud</span> <span class="hljs-selector-id">#last_lap_time</span>    { <span class="hljs-attribute">float</span>: left; <span class="hljs-attribute">display</span>: none;  }
<span class="hljs-selector-id">#hud</span> <span class="hljs-selector-id">#fast_lap_time</span>    { <span class="hljs-attribute">display</span>: block; <span class="hljs-attribute">width</span>: <span class="hljs-number">12em</span>;  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto; <span class="hljs-attribute">text-align</span>: center; <span class="hljs-attribute">transition-property</span>: background-color; <span class="hljs-attribute">transition-duration</span>: <span class="hljs-number">2s</span>; <span class="hljs-attribute">-webkit-transition-property</span>: background-color; <span class="hljs-attribute">-webkit-transition-duration</span>: <span class="hljs-number">2s</span>; }
<span class="hljs-selector-id">#hud</span> <span class="hljs-selector-class">.value</span>            { <span class="hljs-attribute">color</span>: black; <span class="hljs-attribute">font-weight</span>: bold; }
<span class="hljs-selector-id">#hud</span> <span class="hljs-selector-class">.fastest</span>          { <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">215</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>); }</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...ï¼Œæˆ‘ä»¬å°†åœ¨æ¸¸æˆå‘¨æœŸå†…æ‰§è¡Œå…¶updateï¼ˆï¼‰ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (position &gt; playerZ) {
  <span class="hljs-keyword">if</span> (currentLapTime &amp;&amp; (startPosition &lt; playerZ)) {<font></font>
    lastLapTime    = currentLapTime;<font></font>
    currentLapTime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (lastLapTime &lt;= Util.toFloat(Dom.storage.fast_lap_time)) {<font></font>
      Dom.storage.fast_lap_time = lastLapTime;<font></font>
      updateHud(<span class="hljs-string">'fast_lap_time'</span>, formatTime(lastLapTime));<font></font>
      Dom.addClassName(<span class="hljs-string">'fast_lap_time'</span>, <span class="hljs-string">'fastest'</span>);<font></font>
      Dom.addClassName(<span class="hljs-string">'last_lap_time'</span>, <span class="hljs-string">'fastest'</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {<font></font>
      Dom.removeClassName(<span class="hljs-string">'fast_lap_time'</span>, <span class="hljs-string">'fastest'</span>);<font></font>
      Dom.removeClassName(<span class="hljs-string">'last_lap_time'</span>, <span class="hljs-string">'fastest'</span>);<font></font>
    }<font></font>
    updateHud(<span class="hljs-string">'last_lap_time'</span>, formatTime(lastLapTime));<font></font>
    Dom.show(<span class="hljs-string">'last_lap_time'</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> {<font></font>
    currentLapTime += dt;<font></font>
  }<font></font>
}<font></font>
<font></font>
updateHud(<span class="hljs-string">'speed'</span>,            <span class="hljs-number">5</span> * <span class="hljs-built_in">Math</span>.round(speed/<span class="hljs-number">500</span>));<font></font>
updateHud(<span class="hljs-string">'current_lap_time'</span>, formatTime(currentLapTime));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¾…åŠ©æ–¹æ³•</font></font><code>updateHud()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è®¸æˆ‘ä»¬ä»…åœ¨å€¼æ›´æ”¹æ—¶æ›´æ–°DOMå…ƒç´ ï¼Œå› ä¸ºè¿™æ ·çš„æ›´æ–°å¯èƒ½æ˜¯ä¸€ä¸ªç¼“æ…¢çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”å¦‚æœå€¼æœ¬èº«ä¸æ›´æ”¹ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ä»¥60fpsçš„é€Ÿåº¦æ‰§è¡Œå®ƒã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateHud</span>(<span class="hljs-params">key, value</span>) </span>{ <span class="hljs-comment">// accessing DOM can be slow, so only do it if value has changed</span>
  <span class="hljs-keyword">if</span> (hud[key].value !== value) {<font></font>
    hud[key].value = value;<font></font>
    Dom.set(hud[key].dom, value);<font></font>
  }<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/103/563/0d1/1035630d19106de2f85edebb24d0421f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼</font><font style="vertical-align: inherit;">æœ€åä¸€éƒ¨åˆ†å¾ˆé•¿ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å®Œæˆäº†ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæˆçš„ç‰ˆæœ¬</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°è¾¾äº†å¯ä»¥ç§°ä¸ºæ¸¸æˆçš„é˜¶æ®µã€‚</font><font style="vertical-align: inherit;">å¥¹è·ç¦»</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæˆçš„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯”èµ›</font><font style="vertical-align: inherit;">è¿˜å¾ˆé¥è¿œ</font><font style="vertical-align: inherit;">ï¼Œä½†è¿™ä»ç„¶æ˜¯ä¸€åœºæ¯”èµ›ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡å¦‚æ­¤ç®€å•ï¼Œä½†æˆ‘ä»¬ç¡®å®è®¾æ³•åˆ›å»ºäº†ä¸€ä¸ªæ¸¸æˆï¼Œè¿™çœŸæ˜¯ä»¤äººæƒŠè®¶ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä¸æ‰“ç®—å°†è¿™ä¸ªé¡¹ç›®å¸¦å…¥ä¸€ä¸ªå®Œæ•´çš„çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">å®ƒä»…åº”è§†ä¸º</font><font style="vertical-align: inherit;">å¯¹ä¼ªä¸‰ç»´èµ›è½¦æ¸¸æˆä¸»é¢˜</font><font style="vertical-align: inherit;">çš„</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»‹ç»</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ä»£ç </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±githubå‘å¸ƒ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæ‚¨å¯ä»¥å°è¯•å°†å…¶è½¬å˜ä¸ºæ›´é«˜çº§çš„èµ›è½¦æ¸¸æˆã€‚</font><font style="vertical-align: inherit;">æ‚¨ä¹Ÿå¯ä»¥å°è¯•ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ±½è½¦å¢åŠ éŸ³æ•ˆ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¹å–„éŸ³ä¹åŒæ­¥</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¨å±å®æ–½</font></font></li>
<li>   (   , ,    ,  ..)</li>
<li>    </li>
<li>   (,   ..)</li>
<li>       </li>
<li> ,     </li>
<li> ,          -</li>
<li> ,     </li>
<li>   (   ,     ..)</li>
<li>    drawDistance</li>
<li>         x,y</li>
<li>     </li>
<li>      (   ,  )</li>
<li> </li>
<li> </li>
<li>     </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰å­å’Œå…¬è·¯è¿æ¥</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¼å¤œçš„å˜åŒ–</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤©æ°”çŠ¶å†µ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éš§é“ï¼Œæ¡¥æ¢ï¼Œäº‘å±‚ï¼Œå¢™å£ï¼Œå»ºç­‘ç‰©</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸå¸‚ï¼Œæ²™æ¼ ï¼Œæµ·æ´‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†è¥¿é›…å›¾å’Œå¤ªç©ºé’ˆå¡”æ·»åŠ åˆ°èƒŒæ™¯ä¸­</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œæ¶æ£â€-å¢åŠ ç«äº‰å¯¹æ‰‹ä¸ä¹‹ç«äº‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸¸æˆæ¨¡å¼-æœ€å¿«åœˆé€Ÿï¼Œä¸€å¯¹ä¸€æ¯”èµ›ï¼ˆæ¡ç¡¬å¸ï¼Ÿå‘å°äººå°„å‡»ï¼Ÿï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§é‡çš„æ¸¸æˆè‡ªå®šä¹‰é€‰é¡¹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç­‰ç­‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è‡³æ­¤å°±å®Œæˆäº†ã€‚</font><font style="vertical-align: inherit;">å¦ä¸€ä¸ªâ€œå‘¨æœ«é¡¹ç›®â€èŠ±è´¹çš„æ—¶é—´æ¯”é¢„æœŸçš„è¦é•¿å¾—å¤šï¼Œä½†æœ€ç»ˆç»“æœè¿˜æ˜¯ä¸é”™çš„ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚è€ƒæ–‡çŒ®</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ç³»åˆ—æ–‡ç« ï¼Œç›´çº¿é“è·¯å’Œæ›²çº¿çš„å¼€å§‹</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥¼çš„ä¼ª3dé¡µé¢</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èµ„æº</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯æ’­æ”¾æ¼”ç¤ºçš„é“¾æ¥ï¼š</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›´è·¯æ¼”ç¤º</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›²çº¿æ¼”ç¤º</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸Œå°”æ–¯æ¼”ç¤º</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆå“ç‰ˆ</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN499432/index.html">PHPUnitä¸­å•å…ƒæµ‹è¯•çš„è‡ªæ²»</a></li>
<li><a href="../zh-CN499434/index.html">å¦‚ä½•å®æ–½çŸ¥è¯†ç®¡ç†ï¼šå—ç›Šäºâ€œé‚®è¢‹â€ï¼Œâ€œé¹¦é¹‰ç½šæ¬¾â€å’Œå‰ªè¾‘æ€ç»´</a></li>
<li><a href="../zh-CN499436/index.html">é¥æ§é…¶å°†åŠ é€Ÿä¸­é£å’Œè„ŠæŸ±æŸä¼¤çš„æ²»ç–—</a></li>
<li><a href="../zh-CN499438/index.html">æµå‘æµ‹è¯•äººå‘˜ï¼Œè€Œä¸ä»…ä»…æ˜¯</a></li>
<li><a href="../zh-CN499440/index.html">å½“æˆ‘ä»¬ä¸ºè°ƒè½¦æœºè½¦ç¼–å†™ä¸–ç•Œä¸Šæœ€é…·çš„è‡ªåŠ¨é©¾é©¶ä»ªæ—¶</a></li>
<li><a href="../zh-CN499444/index.html">Postgresï¼šè†¨èƒ€ï¼Œpg_repackå’Œå»¶è¿Ÿçº¦æŸ</a></li>
<li><a href="../zh-CN499446/index.html">æµ‹è¯•ç”¨äºVRçš„STEPæ ¼å¼å¼•å¯¼åŠ è½½ç¨‹åº</a></li>
<li><a href="../zh-CN499448/index.html">ä½¿ç”¨TypeScriptå’ŒInversifyJSåœ¨Node.jsä¸­å®ç°SOLIDå’Œåˆ†å±‚æ¶æ„</a></li>
<li><a href="../zh-CN499450/index.html">ä½¿ç”¨Pythonä¸­çš„é—ä¼ å­¦/è¿›åŒ–è®ºä¸ºæ³¢æ–¯æ¸¸æˆé€‰æ‹©è®¾å¤‡</a></li>
<li><a href="../zh-CN499452/index.html">è¯Šæ‰€çœ¼ç§‘åŒ»ç”Ÿçš„æ—¥å¸¸å·¥ä½œï¼šåŒ»ç”Ÿä¸è¶³æ—¶</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>