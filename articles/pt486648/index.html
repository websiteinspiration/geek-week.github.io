<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍⚕️ ❕ 🙋🏼 AWS Lambda em ação no Java 11. Indo sem servidor para produção 🧥 🏳️‍🌈 🧔🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo é um guia sobre como começar de maneira rápida e indolor usando o AWS Lambda com um exemplo simples. Adequado para um desenvolvedor que nã...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda em ação no Java 11. Indo sem servidor para produção</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/486648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este artigo é um guia sobre como começar de maneira rápida e indolor usando o AWS Lambda com um exemplo simples. </font><font style="vertical-align: inherit;">Adequado para um desenvolvedor que não trabalhou com o Lambda e que conhecia a Cloud para avaliar outra visão para o desenvolvimento de aplicativos sem servidor.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/y8/lu/bdy8luzeox9qq09msokx8yzoba4.jpeg" alt="imagem"><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdução</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Olá a todos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meu nome é Alexander Gruzdev, sou Java Team Lead no DINS. Por mais de dois anos, trabalho em estreita colaboração com a infraestrutura da AWS e tenho experiência tanto na criação de aplicativos para a AWS quanto na implantação desses mesmos aplicativos. No meu trabalho, tive que usar o ElasticBeanstalk, ECS, Fargate, EKS e, é claro, o AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada um desses serviços é bom à sua maneira e, dentro da estrutura deste artigo, não insistirei em usar apenas o AWS Lambda como substituto de todas as outras opções. Eu só quero mostrar como é fácil começar a usar o Lambda e em quais casos você terá os benefícios de usá-lo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos, de desenvolvedores a gerentes, desejam um processo claro para entregar alterações aos clientes. </font><font style="vertical-align: inherit;">Quanto mais transparente for esse caminho e menos esforço for necessário, mais lucrativo. </font><font style="vertical-align: inherit;">Na maioria das vezes, os desenvolvedores e testadores não querem saber onde o aplicativo será implantado, qual hardware escolher, em que região você deseja colocar réplicas etc. </font><font style="vertical-align: inherit;">No diagrama a seguir, você pode ver a classe de serviços “aaS” (como um serviço), em que o AWS Lambda representa a categoria FaaS.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z8/nj/wl/z8njwlqjrgatljwptthtqe9ealu.png" alt="imagem"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FaaS em poucas palavras</font></font></b>
                        <div class="spoiler_text">FaaS ,            .     ,  , CRUD   C, R, U, D     Create   Read.      ,   —  .<br>
</div>
                    </div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Idéia</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para demonstrar o que é o desenvolvimento de uma solução sem servidor, decidi dar um exemplo bastante banal. </font><font style="vertical-align: inherit;">Acho que você já viu o formulário de comentários Fale conosco em muitos sites, onde você pode deixar seu e-mail ou telefone e fazer uma pergunta para ser respondida mais tarde. </font><font style="vertical-align: inherit;">Na tela abaixo, o formulário não é super, mas o assunto deste artigo não é o design do material. </font></font><br>
<img src="https://habrastorage.org/webt/gv/5g/iv/gv5givju7glj8vftkb1cdhupdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao preencher este formulário, um cliente em potencial estará aguardando uma ligação ou carta sua. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do lado técnico, você precisa:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salve dados do formulário no banco de dados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envie uma carta a um agente que responderá à pergunta;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">talvez escreva outro serviço em que o agente marque o trabalho realizado com base no mesmo banco de dados (não incluído no escopo do artigo).</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A implementação da ideia está disponível no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitetura</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira coisa que vem à mente durante a implementação é o que precisamos:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">máquina nas costas, frente, imagens, etc.,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carro com base</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">máquina com serviço de e-mail.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/9a/7h/83/9a7h83iyieeicpht4-bcwy8l-ja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A parte traseira e a base, no bom sentido, precisam ser replicadas, mas suponha que façamos isso para nossa mini-loja e a carga nesse formulário seja mínima. </font><font style="vertical-align: inherit;">Portanto, todas essas máquinas podem ser combinadas em uma e implantadas em um único conjunto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, como estamos considerando o Serverless, vamos construir a arquitetura inteiramente em componentes sem servidor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não importa o quão promissor o Serverless possa parecer, todos entendemos que os servidores ainda estão aqui, eles simplesmente desapareceram do seu campo de visão. </font><font style="vertical-align: inherit;">E agora essa nuvem funciona e você pode fazer as tarefas que você pode fazer por conta própria. </font><font style="vertical-align: inherit;">Mas vamos tentar usar apenas esses componentes sem servidor: </font></font><br>
<img src="https://habrastorage.org/webt/mf/iw/6i/mfiw6if-6nlss4pl-brkgxenxuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O diagrama mostra uma separação muito clara da funcionalidade de cada componente.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O AWS Lambda é o principal componente que contém código / lógica,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O S3 é responsável por armazenar recursos estáticos e scripts JS,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFront - para mecanismos de cache e suporte multi-regional,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SES - serviço de e-mail,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamoDB - a base para armazenar dados do formulário (de quem, qual pergunta, para onde enviar a resposta),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de gateway - API HTTP para nossa lambda,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route53 - necessário se você deseja adicionar um belo nome de domínio.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nem todos esses componentes serão usados ​​em nosso próximo guia, para não esticar o artigo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Route53 e o CloudFront são componentes bastante simples sobre os quais você pode ler separadamente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns spoilers que nos darão uma solução:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estamos nos afastando do suporte a máquinas EC2, sem depuração via ssh,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuração fácil: configure a otimização / armazenamento em cache / acessos em um clique,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oferece suporte a políticas de acesso: restrinja direitos e conceda acesso,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Log / monitoramento fora da caixa,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pague apenas pelos recursos / solicitações usadas.</font></font></li>
</ul><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demo</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Treinamento</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para começar a desenvolver nossa solução sem servidor, você deve atender aos seguintes requisitos:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conta ativa da AWS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-cli</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam-cli</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jdk 11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de instalar todas as ferramentas acima, você precisa configurar o aws-cli para acesso remoto à AWS. </font><font style="vertical-align: inherit;">Siga as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruções</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Isso exigirá a criação de um novo usuário e o descarregamento de sua Chave de acesso e Chave secreta.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagem do projeto</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Crie um projeto a partir de um modelo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra o diretório para o projeto futuro e, a partir dele, inicie o SAM CLI. </font><font style="vertical-align: inherit;">Siga as instruções: </font></font><br>
<img src="https://habrastorage.org/webt/kn/gu/7f/kngu7fr3q_h_7t7bq-ygr7baccs.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: Dependendo da versão do SAM-CLI, os comandos podem ser um pouco diferentes, mas todos permanecem intuitivos. </font><font style="vertical-align: inherit;">Basta escolher os mais semelhantes aos que foram usados ​​acima. </font><font style="vertical-align: inherit;">Você também pode escolher uma ferramenta de compilação diferente se o Gradle não for adequado para você. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O projeto "Olá, mundo!" </font><font style="vertical-align: inherit;">pronto. </font><font style="vertical-align: inherit;">Agora você pode trabalhar no nome do projeto e pacotes, dependências e código fonte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Vamos lidar com vícios</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione as seguintes dependências ao build.gradle:</font></font><br>
<pre><code class="javascript hljs">dependencies {
    <span class="hljs-comment">// AWS</span>
    implementation group: <span class="hljs-string">'com.amazonaws.serverless'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-serverless-java-container-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.4'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.2.0'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-ses'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-dynamodb'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-log4j2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.1.0'</span><font></font>
<font></font>
    <span class="hljs-comment">// Utils</span>
    implementation group: <span class="hljs-string">'com.fasterxml.jackson.core'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'jackson-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.10.0'</span>
    implementation group: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.6'</span><font></font>
<font></font>
    <span class="hljs-comment">// Test</span>
    testImplementation group: <span class="hljs-string">'org.mockito'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'mockito-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'3.1.0'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-api-mockito2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-module-junit4'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'4.12'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os principais são o AWS SDK. </font><font style="vertical-align: inherit;">Eles permitirão que você trabalhe com serviços específicos, como SES, DynamoDB, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Nós escrevemos uma lambda</font></font></h3><br>
<ul>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alteramos as classes de solicitação e resposta do modelo para RequestHandler para AwsProxyRequest e ContactUsProxyResponse.</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span>&lt;<span class="hljs-title">AwsProxyRequest</span>, <span class="hljs-title">ContactUsProxyResponse</span>&gt;
...
<span class="hljs-title">public</span> <span class="hljs-title">ContactUsProxyResponse</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-title">AwsProxyRequest</span> <span class="hljs-title">request</span>, <span class="hljs-title">Context</span> <span class="hljs-title">context</span>) </span></code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  AwsClientFactory   AWS SDK-.</b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">/**
 * Just an util class for an eager initialization of sdk clients.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsClientFactory</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LogManager.getLogger(AwsClientFactory.class);<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AmazonSimpleEmailService sesClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DynamoDB dynamoDB;<font></font>
<font></font>
    /**<font></font>
     * AWS regions should be env variables <span class="hljs-keyword">if</span> you want to generalize the solution.<font></font>
     */<font></font>
    AwsClientFactory() {<font></font>
        LOG.debug("AWS clients factory initialization.");<font></font>
        sesClient = AmazonSimpleEmailServiceClient.builder().withRegion(Regions.EU_WEST_1).build();<font></font>
        AmazonDynamoDB dynamoDBClient = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.EU_WEST_1).build();<font></font>
        dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(dynamoDBClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">DynamoDB <span class="hljs-title">getDynamoDB</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> dynamoDB;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">AmazonSimpleEmailService <span class="hljs-title">getSesClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sesClient;<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    ObjectMapper   .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ObjectMapper OBJECT_MAPPER = <span class="hljs-keyword">new</span> ObjectMapper();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AwsClientFactory AWS_CLIENT_FACTORY = <span class="hljs-keyword">new</span> AwsClientFactory();
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
 <span class="hljs-function"><span class="hljs-keyword">private</span> SendEmailResult <span class="hljs-title">sendEmail</span><span class="hljs-params">(ContactUsRequest contactUsRequest)</span> </span>{<font></font>
        String emailTemplate = getEmailTemplate();<font></font>
        String email = fillTemplate(emailTemplate, contactUsRequest);<font></font>
<font></font>
        SendEmailRequest sendEmailRequest =<font></font>
                <span class="hljs-keyword">new</span> SendEmailRequest(<font></font>
                        System.getenv(<span class="hljs-string">"SENDER_EMAIL"</span>),
                        <span class="hljs-keyword">new</span> Destination(List.of(System.getenv(<span class="hljs-string">"RECIPIENT_EMAIL"</span>))),
                        <span class="hljs-keyword">new</span> Message()<font></font>
                                .withSubject(<font></font>
                                        <span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(contactUsRequest.getSubject()))<font></font>
                                .withBody(<span class="hljs-keyword">new</span> Body()<font></font>
                                        .withHtml(<span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(email))));<font></font>
        LOG.info(<span class="hljs-string">"Email template is ready"</span>);
        <span class="hljs-keyword">return</span> AWS_CLIENT_FACTORY.getSesClient().sendEmail(sendEmailRequest);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fillTemplate</span><span class="hljs-params">(String emailTemplate, ContactUsRequest contactUsRequest)</span> </span>{
        <span class="hljs-keyword">return</span> String.format(<font></font>
                emailTemplate,<font></font>
                contactUsRequest.getUsername(),<font></font>
                contactUsRequest.getEmail(),<font></font>
                contactUsRequest.getPhone(),<font></font>
                contactUsRequest.getQuestion());<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getEmailTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> IOUtils.toString(<font></font>
                    Objects.requireNonNull(<span class="hljs-keyword">this</span>.getClass().getClassLoader()<font></font>
                                               .getResourceAsStream(<span class="hljs-string">"email_template.html"</span>)),<font></font>
                    UTF_8);<font></font>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Loading an email template failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmailDetailsToDb</span><span class="hljs-params">(ContactUsRequest contactUsRequest, SendEmailResult sendEmailResult)</span> </span>{<font></font>
        AWS_CLIENT_FACTORY.getDynamoDB().getTable(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                          .putItem(<span class="hljs-keyword">new</span> Item()<font></font>
                                  .withPrimaryKey(<span class="hljs-string">"Id"</span>, sendEmailResult.getMessageId())<font></font>
                                  .withString(<span class="hljs-string">"Subject"</span>, contactUsRequest.getSubject())<font></font>
                                  .withString(<span class="hljs-string">"Username"</span>, contactUsRequest.getUsername())<font></font>
                                  .withString(<span class="hljs-string">"Phone"</span>, contactUsRequest.getPhone())<font></font>
                                  .withString(<span class="hljs-string">"Email"</span>, contactUsRequest.getEmail())<font></font>
                                  .withString(<span class="hljs-string">"Question"</span>, contactUsRequest.getQuestion()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">private</span> ContactUsProxyResponse <span class="hljs-title">buildResponse</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode, String body)</span> </span>{<font></font>
        ContactUsProxyResponse awsProxyResponse =<font></font>
                <span class="hljs-keyword">new</span> ContactUsProxyResponse();<font></font>
        awsProxyResponse.setStatusCode(statusCode);<font></font>
        awsProxyResponse.setBody(getBodyAsString(body));<font></font>
        awsProxyResponse.addHeader(CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());<font></font>
        awsProxyResponse.addHeader(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
        <span class="hljs-keyword">return</span> awsProxyResponse;<font></font>
}<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getBodyAsString</span><span class="hljs-params">(String body)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> OBJECT_MAPPER.writeValueAsString(<span class="hljs-keyword">new</span> ContactUsResponseBody(body));<font></font>
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Writing ContactUsResponseBody as string failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    .      «// WARMING UP».</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         handleRequest()</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ContactUsProxyResponse <span class="hljs-title">handleRequest</span><span class="hljs-params">(AwsProxyRequest request, Context context)</span> </span>{<font></font>
        LOG.info(<span class="hljs-string">"Request was received"</span>);<font></font>
        LOG.debug(getAsPrettyString(request));<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
        }<font></font>
<font></font>
        ContactUsRequest contactUsRequest = getContactUsRequest(request);<font></font>
<font></font>
        SendEmailResult sendEmailResult = sendEmail(contactUsRequest);<font></font>
        LOG.info(<span class="hljs-string">"Email was sent"</span>);<font></font>
<font></font>
        addEmailDetailsToDb(contactUsRequest, sendEmailResult);<font></font>
        LOG.info(<span class="hljs-string">"DB is updated"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">200</span>,<font></font>
                String.format(<span class="hljs-string">"Message %s has been sent successfully."</span>, sendEmailResult.getMessageId()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lógica básica é bastante simples, então não acho que valha a pena descrevê-la em detalhes. Vale a pena prestar atenção em vários pontos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro é o log. Um dos argumentos do método lambda Context contém muitas informações auxiliares, além de um criador de logs. Portanto, você não pode criar um criador de logs separado, mas use o contexto lambda fornecido. Para fazer isso, basta ligar antes do uso:</font></font><br>
<blockquote><code>LambdaLogger logger = context.getLogger(); </code></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto está esquentando. Como criar um ambiente executável para um lambda é lento, iniciar a JVM, carregar o caminho de classe e executar o código leva algum tempo. A primeira chamada pode levar alguns segundos, o que não é bom se você escrever APIs síncronas diferentes. Para esses casos, você mesmo pode informar à AWS que precisa manter várias instâncias lambda em alerta. Mas isso exige que alguém chame um lambda. Se fizermos isso com a versão básica do código, enviaremos uma carta e escreveremos alguns dados imprecisos no banco de dados.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar isso, podemos adicionar algum tipo de processamento de solicitação para distinguir a solicitação real da solicitação de aquecimento. Por exemplo, podemos adicionar um cabeçalho especial à solicitação. No nosso caso, o cabeçalho “X-WARM-UP” será usado com qualquer valor - para entender que essa é uma solicitação de aquecimento e precisamos apenas retornar algum tipo de resposta sem executar a lógica de negócios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A última coisa que gostaria de chamar a atenção é o uso de variáveis ​​estáticas. </font><font style="vertical-align: inherit;">Isso não cria a instância lambda com estado no nosso caso, simplesmente permite reutilizar objetos existentes e inicializados. </font><font style="vertical-align: inherit;">Se os objetos que você deseja inicializar mudar estaticamente durante a execução do código, tente pensar novamente se isso interferirá na operação de chamadas subseqüentes ao lambda. </font><font style="vertical-align: inherit;">Além disso, se esses objetos usarem variáveis ​​de ambiente durante a inicialização, você não deve torná-los estáticos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Nós escrevemos testes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O código Lambda pode ser coberto pelos mesmos tipos de testes usados ​​na maioria dos casos. </font><font style="vertical-align: inherit;">Mas, para impedir que o artigo cresça ainda mais, abordarei o teste de aplicativos sem servidor no próximo artigo sobre o teste do AWS Lambda e o desenvolvimento local. </font><font style="vertical-align: inherit;">Embora os testes de unidade já estejam disponíveis no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositório</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Escrevemos um modelo de recursos SAM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que escrevemos e testamos nossa lambda localmente, precisamos escrever um modelo SAM para implantar todos esses recursos na AWS.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco sobre o SAM</font></font></b>
                        <div class="spoiler_text">Serverless Application Model –     serverless .  ,      CloudFormation DSL,     –   Lambda, Gateway, DynamoDB  . . <br>
SAM, CloudFormation, Terraform –   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IaC-</a>. SAM     Serverless-,   Terraform        . <br>
 Terraform   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">    DINS</a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, vejamos quais recursos precisamos declarar no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modelo SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: Function</font></font></b></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Os principais recursos já serão preenchidos se usarmos o SAM init para criar o projeto. </font><font style="vertical-align: inherit;">Mas aqui está como eles se parecem no meu exemplo:</font></font><br>
<pre><code class="plaintext hljs">CodeUri: contact-us-function<font></font>
Handler: com.gralll.sam.App::handleRequest<font></font>
Runtime: java8<font></font>
MemorySize: 256<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui eu acho que tudo está claro o suficiente. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeUri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é o diretório com nosso </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manipulador</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lambda </font><font style="vertical-align: inherit;">- o caminho completo para o método </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Runtime</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - no qual o lambda </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> está escrito </font><font style="vertical-align: inherit;">- fala por si mesmo </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falando em memória</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : até 3 GB de RAM estão disponíveis no lambda, o que corresponde a um recurso de 2 CPUs. Ou seja, você não pode ajustar a CPU separadamente, apenas aumentando / diminuindo a quantidade de memória.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O próximo bloco é necessário para selecionar o método de implantação.</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoPublishAlias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - permite </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adicionar um alias</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a cada nova versão implantada </font><font style="vertical-align: inherit;">. Isso é necessário para implementar a implantação de canários. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canary10Percent10Minutes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - um tipo de implantação que permitirá a você segurar simultaneamente duas versões do lambda: a antiga e a nova, mas redirecionar apenas 10% do tráfego para a nova. Se em dez minutos não houver problemas, o restante do tráfego também será redirecionado para a nova versão. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode ler mais sobre o uso de recursos avançados </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na página SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, estão as variáveis ​​de ambiente que serão usadas no código. Depois disso, outro bloco para lambda:</font></font><br>
<pre><code class="plaintext hljs">Events:<font></font>
  ContactUs:<font></font>
    Type: Api<font></font>
    Properties:<font></font>
      Path: /contact<font></font>
      Method: post<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nele, devemos descrever os gatilhos para chamar um lambda. No nosso caso, essas serão </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicitações do API Gateway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa é uma forma bastante simplificada de descrever a API, mas é suficiente para a API de gateway recém-criada redirecionar todas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solicitações de </font><b><font style="vertical-align: inherit;">POST / contato</font></b><font style="vertical-align: inherit;"> para nossa lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, precisamos descrever os aspectos de segurança. Fora da caixa, o lambda criado não terá acesso ao banco de dados ou ao serviço de email. Portanto, precisamos prescrever explicitamente o que será permitido. Existem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">várias maneiras</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de conceder acesso à AWS. Usaremos políticas baseadas em recursos:</font></font><br>
<pre><code class="plaintext hljs">Policies:<font></font>
  - AWSLambdaExecute<font></font>
  - Version: '2012-10-17'<font></font>
    Statement:<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - ses:SendEmail<font></font>
          - ses:SendRawEmail<font></font>
        Resource: 'arn:aws:ses:eu-west-1:548476639829:identity/aleksandrgruzdev11@gmail.com'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:List*<font></font>
        Resource: '*'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:Get*<font></font>
          - dynamodb:PutItem<font></font>
          - dynamodb:DescribeTable<font></font>
        Resource: 'arn:aws:dynamodb:*:*:table/ContactUsTable'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que, para a tabela do banco de dados, especificamos um nome específico; portanto, precisaremos criar uma tabela com o mesmo nome. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em relação ao SES: você vê meu endereço de e-mail. No seu caso, deve ser o seu próprio endereço confirmado. Como fazer isso, veja </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Logo em seguida, você poderá encontrar o ARN de identidade desse recurso clicando no endereço criado e substituí-lo pelo email no exemplo acima. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles meio que descobriram a lambda. Agora vamos para o banco de dados. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: SimpleTable</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para nossas tarefas, criaremos apenas uma tabela </font><b><i><font style="vertical-align: inherit;">ContactUsTable</font></i></b><font style="vertical-align: inherit;"> :</font></font><br>
<pre><code class="plaintext hljs">ContactUsTable:<font></font>
  Type: AWS::Serverless::SimpleTable<font></font>
  Properties:<font></font>
    PrimaryKey:<font></font>
      Name: Id<font></font>
      Type: String<font></font>
    TableName: ContactUsTable<font></font>
    ProvisionedThroughput:<font></font>
      ReadCapacityUnits: 2<font></font>
      WriteCapacityUnits: 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos campos obrigatórios - apenas ID, e também indicam ReadCapacityUnits e WriteCapacityUnits. </font><font style="vertical-align: inherit;">Não vamos nos deter em detalhes sobre quais valores escolher, pois esse também é um tópico bastante extenso. </font><font style="vertical-align: inherit;">Você pode ler </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Para um aplicativo de teste, pequenos valores da ordem de 1-2 também são suficientes. </font><font style="vertical-align: inherit;">
Os parâmetros gerais </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">globais</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podem ser removidos neste bloco se, por exemplo, você declarar vários recursos do tipo Função ou API.</font></font><br>
<pre><code class="plaintext hljs">Globals:<font></font>
  Function:<font></font>
    Timeout: 15<font></font>
  Api:<font></font>
    Cors:<font></font>
      AllowOrigin: "'*'"<font></font>
      AllowHeaders: "'Content-Type,X-WARM-UP,X-Amz-Date,Authorization,X-Api-Key'"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usei-o para definir um tempo limite para a função e algumas configurações do Cors para chamar a API do Gateway posteriormente na minha página estática com o formulário ContactUs. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saídas</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esse bloco permite definir dinamicamente algumas variáveis ​​no contexto global do AWS CloudFormation.</font></font><br>
<pre><code class="plaintext hljs">Outputs:<font></font>
  ContactUsApi:<font></font>
    Description: "API Gateway endpoint URL for Prod stage for ContactUs function"<font></font>
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/contact/"<font></font>
  ContactUsFunction:<font></font>
    Description: "ContactUs Lambda Function ARN"<font></font>
    Value: !GetAtt ContactUsFunction.Arn<font></font>
  ContactUsFunctionIamRole:<font></font>
    Description: "Implicit IAM Role created for ContactUs function"<font></font>
    Value: !GetAtt ContactUsFunctionRole.Arn<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, declaramos uma variável ContactUsApi, que será definida como um valor, como o endereço público do nosso terminal de API criado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como estamos usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ {ServerlessRestApi}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a AWS inserirá o identificador exclusivo de nossa nova API de gateway na cadeia de caracteres. Como resultado, qualquer aplicativo que tenha acesso ao CloudFormation poderá obter esse endereço - assim, você não pode codificar a URL de seus serviços. Bem, outra vantagem é que é muito conveniente ver a lista de saídas - algumas informações meta sobre sua pilha. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma lista completa de funções e quais parâmetros você pode usar pode ser encontrada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parâmetros</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Além de todas as opções acima, você pode adicionar um bloco </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parâmetros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Essas opções ajudarão a tornar o modelo mais versátil. </font><font style="vertical-align: inherit;">Em qualquer outro bloco do modelo, você pode fazer referências a esses parâmetros, não codificando alguns valores. </font><font style="vertical-align: inherit;">Por exemplo, no meu modelo, podem ser emails, SES ARN, quantidade de memória etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse é o modelo inteiro. </font><font style="vertical-align: inherit;">Ninguém proíbe adicionar mais alguns recursos por perto, por exemplo, um bucket S3, qualquer outro recurso do CloudFormation ou um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recurso personalizado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em geral </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Prosseguimos com a implantação</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para montar nosso projeto, usaremos não o Gradle, mas o SAM.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagem</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam build<font></font>
Building resource <span class="hljs-string">'ContactUsFunction'</span><font></font>
Running JavaGradleWorkflow:GradleBuild<font></font>
Running JavaGradleWorkflow:CopyArtifacts<font></font>
<font></font>
Build Succeeded<font></font>
<font></font>
Built Artifacts  : .aws-sam\build<font></font>
Built Template   : .aws-sam\build\template.yaml<font></font>
<font></font>
Commands you can use next<font></font>
=========================<font></font>
[*] Invoke Function: sam <span class="hljs-built_in">local</span> invoke<font></font>
[*] Deploy: sam deploy –guided<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A execução do </font><font style="vertical-align: inherit;">comando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam build a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir da raiz do projeto coletará automaticamente </font><font style="vertical-align: inherit;">todos os arquivos necessários </font><font style="vertical-align: inherit;">na </font><font style="vertical-align: inherit;">pasta </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.aws-sam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : classes, dependências, modelo SAM. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, você precisa criar um depósito S3, em que o SAM carrega posteriormente todos os artefatos coletados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso pode ser feito através do console da AWS baseado em navegador ou com o comando</font></font><br>
<blockquote><code>aws s3 mb s3://bucket-name</code></blockquote><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: todos os buckets são criados em um contexto global e são vasculhados entre todas as contas. </font><font style="vertical-align: inherit;">Portanto, você não pode criar um bloco se alguém já o criou na sua conta. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando o bucket estiver pronto, execute o comando:</font></font><br>
<blockquote><code>sam package --output-template-file packaged.yaml --s3-bucket &lt;YOUR_BACKET&gt;</code></blockquote><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado do pacote</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam package --output-template-file packaged.yaml --s3-bucket contact-us-sam-app<font></font>
Uploading to ea0c122c06a50d9676fbf9000a80a3bf  9212768 / 9212768.0  (100.00%)<font></font>
<font></font>
Successfully packaged artifacts and wrote output template to file packaged.yaml.<font></font>
Execute the following <span class="hljs-built_in">command</span> to deploy the packaged template<font></font>
sam deploy --template-file F:\aws\projects\contact-us-sam-app\packaged.yaml --stack-name &lt;YOUR STACK NAME&gt;<font></font>
</code></pre></div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apontei meu balde entre em contato conosco e o aplicativo e o SAM carregou todos os recursos no local especificado. </font><font style="vertical-align: inherit;">Em seguida, o SAM já informa um comando para criar uma pilha com recursos e, assim, incorporar sua decisão. </font><font style="vertical-align: inherit;">Executamos o comando, finalizando um pouco:</font></font><br>
<blockquote><code>sam deploy --template-file packaged.yaml --region eu-west-1 --capabilities CAPABILITY_IAM --stack-name contact-us-sam-app </code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você pode ver, eu adicionei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--capabilities CAPABILITY_IAM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Isso permitirá que o CloudFormation crie recursos do IAM. </font><font style="vertical-align: inherit;">Caso contrário, você receberá um erro InsufficientCapabilities ao criar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, é apresentado o log do trabalho deste comando (a imagem é clicável). </font><font style="vertical-align: inherit;">Detalhes como o status de cada recurso e os valores das saídas ficaram disponíveis apenas em uma das versões mais recentes do SAM CLI.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/nv/7p/4z/nv7p4zreqati1wd8c8vy3ubuzcm.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Verifique o status do CloudFormation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos esperar a conclusão da implantação no console até aparecer uma mensagem informando que a pilha foi implantada (o comando deploy registra no parágrafo anterior):</font></font><br>
<blockquote><code>Successfully created/updated stack - contact-us-sam-app in eu-west-1</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, no nosso caso, você verá esta mensagem somente após dez minutos devido ao modo de implantação do canário. Portanto, é mais fácil abrir um console do navegador e observar a pilha lá. </font></font><br>
<img src="https://habrastorage.org/webt/97/ki/k8/97kik8apukwxsvqwyvsd_wtmaqo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de algum tempo, o status será alterado para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE_COMPLETE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que significará a conclusão bem-sucedida. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na guia </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">você pode ver o status de todos os recursos. Se sua pilha fracassar, é aqui que você pode encontrar mensagens de erro detalhadas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, este: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE_FAILED</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - se você configurar incorretamente a API do Gateway no modelo.</font></font><br>
<img src="https://habrastorage.org/webt/ce/mh/aq/cemhaqtl6uvdmlvnr0bsvrbokok.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na guia Recursos, você pode encontrar todos os recursos criados. </font><font style="vertical-align: inherit;">Não se surpreenda com a quantidade. </font><font style="vertical-align: inherit;">Embora tenhamos declarado apenas uma função e uma tabela de banco de dados no modelo SAM, o CloudFormation criou muitos outros recursos para nós. </font><font style="vertical-align: inherit;">Se você olhar para o tipo deles, poderá entender a que serviço eles pertencem. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o Api Gateway, ele foi criado implicitamente:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiDeployment</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiProdStage</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Também para o lambda, vários objetos adicionais foram criados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora abra </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saídas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e encontre o URL da nossa API. </font><font style="vertical-align: inherit;">Copie-o, em breve será útil.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Formulário ContactUs HTML</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você se lembra, decidi criar um formulário ContactUs e agora precisamos disponibilizá-lo de alguma forma, não apenas na máquina local. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuração</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quanto ao próprio formulário, por exemplo, decidi usar o formulário HTML mais simples e adicionei chamadas à API do Gateway através do ajax. </font></font><br>
<img src="https://habrastorage.org/webt/ps/e-/4h/pse-4hta3mojfuamij0dhj3bmyg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além do próprio formulário, adicionei alguns botões para depuração e simplificação do preenchimento: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definir padrão</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - substitui, como esperado, os parâmetros padrão especificados dentro do HTML.</font></font><br>
<pre><code class="javascript hljs">$(<span class="hljs-string">"#url-input"</span>).val(<span class="hljs-string">"https://4ykskscuq0.execute-api.eu-west-1.amazonaws.com/Prod/contact"</span>);<font></font>
$(<span class="hljs-string">"#name-input"</span>).val(<span class="hljs-string">"Mike"</span>);<font></font>
$(<span class="hljs-string">"#email-input"</span>).val(<span class="hljs-string">"Mike@somemail.com"</span>);<font></font>
$(<span class="hljs-string">"#phone-input"</span>).val(<span class="hljs-string">"+79999999999"</span>);<font></font>
$(<span class="hljs-string">"#description-input"</span>).val(<span class="hljs-string">"How much does it cost?"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você pretende usar essa funcionalidade, altere a entrada da URL para o caminho da API do Gateway, que você copiou das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saídas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hospedagem</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie um novo bucket S3.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregamos o arquivo HTML no bucket, escolhendo a opção para tornar o arquivo público.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entramos no balde onde carregamos o arquivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vá para Propriedades, ative a hospedagem de site estático e veja seu novo Endpoint disponível ao público.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. Exame de Saúde</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitação padrão</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora você pode seguir o link para seu formulário, clique em Definir padrão e em Enviar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dessa forma, você fará uma solicitação que passará pela API do Gateway para o AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você configurou tudo corretamente depois de um tempo, receberá uma mensagem como:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Êxito: A mensagem 0102016f28b06243-ae897a1e-b805-406b-9987-019f21547682-000000 foi enviada com sucesso.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso significa que a mensagem foi entregue com sucesso. Verifique sua caixa de correio que você especificou no modelo SAM. Se você não alterou o modelo, a letra estará neste formato: </font></font><br>
<img src="https://habrastorage.org/webt/0z/wy/sv/0zwysv5ytv3uzn9fb9az7bsa6lg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você também pode abrir o DynamoDB e verificar se uma nova entrada foi exibida. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Características de um começo frio</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Acho que você percebeu que a mensagem sobre o envio bem-sucedido veio após um longo período de tempo. Isso ocorre porque o serviço AWS Lambda, após receber uma solicitação de processamento, começou a aumentar a instância do seu aplicativo Java, e isso inclui levantar o contêiner com o sistema operacional e o JRE, carregar o caminho de classe, inicializar todas as variáveis ​​e somente depois disso é o início do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handleRequest ( )</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Isso é chamado de partida a frio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tente preencher e enviar o formulário novamente. Desta vez, a resposta veio quase instantaneamente, certo? Se tiverem passado mais de 20 a 30 minutos entre a primeira e a segunda solicitações, o resultado poderá variar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qual é a razão para isto? E com o fato de o AWS Lambda caches já usarem contêineres com lambdas para reutilização. Isso reduz o tempo de inicialização de todo o contexto para iniciar o método. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não há uma correlação clara de quanto tempo as lambdas são armazenadas em cache, dependendo do tipo, mas algumas pessoas descobriram experimentalmente que isso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">depende diretamente do valor escolhido da RAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ou seja, um lambda com 128 MB de memória estará disponível por mais tempo do que com 3 GB. Talvez haja outros parâmetros, por exemplo, a carga média na região na qual suas lambdas são executadas, mas isso é impreciso. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, experimente você mesmo e planeje o tempo de armazenamento em cache se você usar solicitações síncronas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquecimento</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como opção adicional, você pode usar o aquecimento lambda. No código, adicionei uma verificação de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cabeçalho X-WAMP-UP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se houver, o lambda simplesmente retorna uma resposta sem executar nenhuma lógica de negócios, mas o contêiner estará pronto para chamadas subseqüentes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você mesmo pode chamar seu lambda, por exemplo, pelo cronômetro de coroa, usando o CloudWatch. Isso ajudará se você não desejar que seus clientes participem do Cold Start.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No formulário HTML, você pode encontrar o botão do modo WarmUp, que adiciona esse cabeçalho especial à solicitação. </font><font style="vertical-align: inherit;">Você pode verificar se não ocorre o envio de uma carta nem a gravação no banco de dados, mas a resposta do lambda chega e a chamada subsequente à solicitação real não levará muito tempo.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumindo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o artigo, passamos por todas as etapas principais, do design do aplicativo ao seu lançamento na </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chamada produção</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que as pessoas que já ouviram falar sobre Serverless e AWS Lambda, mas que não tiveram experiência prática, possam usar este guia e possam sentir que isso oferece vantagens significativas na velocidade de implantação de algumas soluções de software e não apenas isso. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benefícios</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para mim, identifiquei as vantagens mais valiosas:</font></font><br>
<ul>
<li>     Free Tier      ,     ,       .</li>
<li>           1-2 .        /.</li>
<li>  ,          ,         .</li>
<li>  Serverless      .   ,  —  .   SAM          AWS. AWS    ,         ,   .</li>
<li>      Lambda ,     .</li>
<li>   Serverless    , , .          ELK/Promethes/Grafana      .</li>
<li>   ,             API.          API Key,   IAM ,                      .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, provavelmente a coisa mais básica é sem servidor. </font><font style="vertical-align: inherit;">Não é necessário pensar em qual instância do EC2 você precisa pagar, como configurar o acesso a ela, como configurar alertas no caso de uma falha do aplicativo, configurar o dimensionamento automático, etc.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desvantagens</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Infelizmente, isso não significa que agora você pode pegar esta solução e usá-la como parte de um sistema corporativo, em vez de seus microsserviços favoritos no cubo. </font><font style="vertical-align: inherit;">Muitas vezes, você precisa se aprofundar para determinar uma solução mais adequada em um caso específico. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E também tenho comentários aos quais você deve prestar atenção ao escolher o Lambda:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partida a frio. </font><font style="vertical-align: inherit;">Especialmente significativo ao usar consultas síncronas e linguagens como Java ou C #. </font><font style="vertical-align: inherit;">O problema é moderadamente resolvido com o aquecimento, mas é melhor pensar em uma solução com antecedência e comparar o custo e os possíveis benefícios</font></font></li>
<li>    .       3GB  ,    2   ,    ,     - Fargate,       ,     .</li>
<li>          API,       ,           .</li>
<li>    /   1-2     Serverless,                .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se você já possui a infraestrutura para desenvolver microsserviços e CI / CD na Coober, será problemático novamente argumentar (especialmente para gerentes) a necessidade de oferecer suporte a outro processo de CI / CD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, onde sem testes. </font><font style="vertical-align: inherit;">E testar o lambda quanto à taxa de transferência é bastante difícil, porque ainda é diferente do teste de desempenho usual e muitos fatores devem ser levados em consideração.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em geral, o uso do AWS Lambda e de outros serviços sem servidor se encaixa muito bem com os princípios de desenvolvimento assíncrono e orientado a eventos. </font><font style="vertical-align: inherit;">E é usando o processamento assíncrono que os melhores resultados podem ser alcançados tanto em termos de desempenho quanto de custo. </font><font style="vertical-align: inherit;">Aqui está uma lista de soluções nas quais as soluções Serveress desempenharão um papel significativo:</font></font><br>
<img src="https://habrastorage.org/webt/i6/ov/y6/i6ovy6ha2pszsiui5jvyewbf-dk.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o artigo acabou sendo bastante extenso e não quero aumentar ainda mais, provavelmente prepararei uma sequência em que mostrarei como conduzir o desenvolvimento com mais eficiência usando todos os recursos do console da AWS, estrutura SAM e até IntelljIDEA. </font><font style="vertical-align: inherit;">Bem, como omiti a parte de teste, tentarei descrever esse aspecto do desenvolvimento em mais detalhes. </font><font style="vertical-align: inherit;">Além disso, se você deseja saber o que adicionar ao próximo artigo, ou perguntas, sinta-se à vontade para escrever nos comentários ou em mensagens privadas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionado: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda em ação. </font><font style="vertical-align: inherit;">Parte 2</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alguns links importantes e úteis do artigo:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projeto GitHub</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faça o download do AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baixar SAM-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuração da AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infraestrutura como código</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experiência usando o Terraform</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descrição dos recursos do SAM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aliases de função do AWS Lambda</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementação avançada de lambda</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuração de recurso da API do SAM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AWS IAM   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">       SES</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Read/Write capacity  DynamoDB </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SAM/CloudFormation  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Parameters   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  CloudFormation </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">      </a></li>
</ul></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt486648/">https://habr.com/ru/post/pt486648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486634/index.html">Atualizações de back-end do MSVC no Visual Studio 2019 versão 16.3 e 16.4</a></li>
<li><a href="../pt486638/index.html">O Blazor WebAssembly 3.2.0 Preview 1 já está disponível</a></li>
<li><a href="../pt486640/index.html">Resumo de materiais interessantes para o desenvolvedor móvel # 331 (27 de janeiro a 2 de fevereiro)</a></li>
<li><a href="../pt486644/index.html">Antena DIY em 5 minutos</a></li>
<li><a href="../pt486646/index.html">Afaste-se do jQuery para Svelte, sem dor</a></li>
<li><a href="../pt486650/index.html">Memória dinâmica em sistemas rígidos em tempo real</a></li>
<li><a href="../pt486652/index.html">"Crítica à razão pura" para programadores</a></li>
<li><a href="../pt486654/index.html">Sensor de movimento e conexão de registro de alarme e vídeo no Home Assistant no Raspberry pi</a></li>
<li><a href="../pt486656/index.html">Como adicionar novos personagens ao Unicode: a experiência do leigo</a></li>
<li><a href="../pt486658/index.html">Moxy Strategy plugin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>