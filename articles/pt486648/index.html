<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äç‚öïÔ∏è ‚ùï üôãüèº AWS Lambda em a√ß√£o no Java 11. Indo sem servidor para produ√ß√£o üß• üè≥Ô∏è‚Äçüåà üßîüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo √© um guia sobre como come√ßar de maneira r√°pida e indolor usando o AWS Lambda com um exemplo simples. Adequado para um desenvolvedor que n√£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda em a√ß√£o no Java 11. Indo sem servidor para produ√ß√£o</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/486648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este artigo √© um guia sobre como come√ßar de maneira r√°pida e indolor usando o AWS Lambda com um exemplo simples. </font><font style="vertical-align: inherit;">Adequado para um desenvolvedor que n√£o trabalhou com o Lambda e que conhecia a Cloud para avaliar outra vis√£o para o desenvolvimento de aplicativos sem servidor.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/y8/lu/bdy8luzeox9qq09msokx8yzoba4.jpeg" alt="imagem"><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√° a todos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meu nome √© Alexander Gruzdev, sou Java Team Lead no DINS. Por mais de dois anos, trabalho em estreita colabora√ß√£o com a infraestrutura da AWS e tenho experi√™ncia tanto na cria√ß√£o de aplicativos para a AWS quanto na implanta√ß√£o desses mesmos aplicativos. No meu trabalho, tive que usar o ElasticBeanstalk, ECS, Fargate, EKS e, √© claro, o AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada um desses servi√ßos √© bom √† sua maneira e, dentro da estrutura deste artigo, n√£o insistirei em usar apenas o AWS Lambda como substituto de todas as outras op√ß√µes. Eu s√≥ quero mostrar como √© f√°cil come√ßar a usar o Lambda e em quais casos voc√™ ter√° os benef√≠cios de us√°-lo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos, de desenvolvedores a gerentes, desejam um processo claro para entregar altera√ß√µes aos clientes. </font><font style="vertical-align: inherit;">Quanto mais transparente for esse caminho e menos esfor√ßo for necess√°rio, mais lucrativo. </font><font style="vertical-align: inherit;">Na maioria das vezes, os desenvolvedores e testadores n√£o querem saber onde o aplicativo ser√° implantado, qual hardware escolher, em que regi√£o voc√™ deseja colocar r√©plicas etc. </font><font style="vertical-align: inherit;">No diagrama a seguir, voc√™ pode ver a classe de servi√ßos ‚ÄúaaS‚Äù (como um servi√ßo), em que o AWS Lambda representa a categoria FaaS.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z8/nj/wl/z8njwlqjrgatljwptthtqe9ealu.png" alt="imagem"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FaaS em poucas palavras</font></font></b>
                        <div class="spoiler_text">FaaS ,            .     ,  , CRUD   C, R, U, D     Create   Read.      ,   ‚Äî  .<br>
</div>
                    </div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Id√©ia</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para demonstrar o que √© o desenvolvimento de uma solu√ß√£o sem servidor, decidi dar um exemplo bastante banal. </font><font style="vertical-align: inherit;">Acho que voc√™ j√° viu o formul√°rio de coment√°rios Fale conosco em muitos sites, onde voc√™ pode deixar seu e-mail ou telefone e fazer uma pergunta para ser respondida mais tarde. </font><font style="vertical-align: inherit;">Na tela abaixo, o formul√°rio n√£o √© super, mas o assunto deste artigo n√£o √© o design do material. </font></font><br>
<img src="https://habrastorage.org/webt/gv/5g/iv/gv5givju7glj8vftkb1cdhupdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao preencher este formul√°rio, um cliente em potencial estar√° aguardando uma liga√ß√£o ou carta sua. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do lado t√©cnico, voc√™ precisa:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salve dados do formul√°rio no banco de dados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envie uma carta a um agente que responder√° √† pergunta;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">talvez escreva outro servi√ßo em que o agente marque o trabalho realizado com base no mesmo banco de dados (n√£o inclu√≠do no escopo do artigo).</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A implementa√ß√£o da ideia est√° dispon√≠vel no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitetura</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira coisa que vem √† mente durante a implementa√ß√£o √© o que precisamos:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√°quina nas costas, frente, imagens, etc.,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carro com base</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√°quina com servi√ßo de e-mail.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/9a/7h/83/9a7h83iyieeicpht4-bcwy8l-ja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A parte traseira e a base, no bom sentido, precisam ser replicadas, mas suponha que fa√ßamos isso para nossa mini-loja e a carga nesse formul√°rio seja m√≠nima. </font><font style="vertical-align: inherit;">Portanto, todas essas m√°quinas podem ser combinadas em uma e implantadas em um √∫nico conjunto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, como estamos considerando o Serverless, vamos construir a arquitetura inteiramente em componentes sem servidor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o importa o qu√£o promissor o Serverless possa parecer, todos entendemos que os servidores ainda est√£o aqui, eles simplesmente desapareceram do seu campo de vis√£o. </font><font style="vertical-align: inherit;">E agora essa nuvem funciona e voc√™ pode fazer as tarefas que voc√™ pode fazer por conta pr√≥pria. </font><font style="vertical-align: inherit;">Mas vamos tentar usar apenas esses componentes sem servidor: </font></font><br>
<img src="https://habrastorage.org/webt/mf/iw/6i/mfiw6if-6nlss4pl-brkgxenxuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O diagrama mostra uma separa√ß√£o muito clara da funcionalidade de cada componente.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O AWS Lambda √© o principal componente que cont√©m c√≥digo / l√≥gica,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O S3 √© respons√°vel por armazenar recursos est√°ticos e scripts JS,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFront - para mecanismos de cache e suporte multi-regional,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SES - servi√ßo de e-mail,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamoDB - a base para armazenar dados do formul√°rio (de quem, qual pergunta, para onde enviar a resposta),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de gateway - API HTTP para nossa lambda,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route53 - necess√°rio se voc√™ deseja adicionar um belo nome de dom√≠nio.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nem todos esses componentes ser√£o usados ‚Äã‚Äãem nosso pr√≥ximo guia, para n√£o esticar o artigo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Route53 e o CloudFront s√£o componentes bastante simples sobre os quais voc√™ pode ler separadamente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns spoilers que nos dar√£o uma solu√ß√£o:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estamos nos afastando do suporte a m√°quinas EC2, sem depura√ß√£o via ssh,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o f√°cil: configure a otimiza√ß√£o / armazenamento em cache / acessos em um clique,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oferece suporte a pol√≠ticas de acesso: restrinja direitos e conceda acesso,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Log / monitoramento fora da caixa,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pague apenas pelos recursos / solicita√ß√µes usadas.</font></font></li>
</ul><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demo</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Treinamento</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar a desenvolver nossa solu√ß√£o sem servidor, voc√™ deve atender aos seguintes requisitos:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conta ativa da AWS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-cli</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam-cli</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jdk 11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de instalar todas as ferramentas acima, voc√™ precisa configurar o aws-cli para acesso remoto √† AWS. </font><font style="vertical-align: inherit;">Siga as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instru√ß√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Isso exigir√° a cria√ß√£o de um novo usu√°rio e o descarregamento de sua Chave de acesso e Chave secreta.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagem do projeto</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Crie um projeto a partir de um modelo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra o diret√≥rio para o projeto futuro e, a partir dele, inicie o SAM CLI. </font><font style="vertical-align: inherit;">Siga as instru√ß√µes: </font></font><br>
<img src="https://habrastorage.org/webt/kn/gu/7f/kngu7fr3q_h_7t7bq-ygr7baccs.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: Dependendo da vers√£o do SAM-CLI, os comandos podem ser um pouco diferentes, mas todos permanecem intuitivos. </font><font style="vertical-align: inherit;">Basta escolher os mais semelhantes aos que foram usados ‚Äã‚Äãacima. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m pode escolher uma ferramenta de compila√ß√£o diferente se o Gradle n√£o for adequado para voc√™. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O projeto "Ol√°, mundo!" </font><font style="vertical-align: inherit;">pronto. </font><font style="vertical-align: inherit;">Agora voc√™ pode trabalhar no nome do projeto e pacotes, depend√™ncias e c√≥digo fonte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Vamos lidar com v√≠cios</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione as seguintes depend√™ncias ao build.gradle:</font></font><br>
<pre><code class="javascript hljs">dependencies {
    <span class="hljs-comment">// AWS</span>
    implementation group: <span class="hljs-string">'com.amazonaws.serverless'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-serverless-java-container-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.4'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.2.0'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-ses'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-dynamodb'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-log4j2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.1.0'</span><font></font>
<font></font>
    <span class="hljs-comment">// Utils</span>
    implementation group: <span class="hljs-string">'com.fasterxml.jackson.core'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'jackson-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.10.0'</span>
    implementation group: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.6'</span><font></font>
<font></font>
    <span class="hljs-comment">// Test</span>
    testImplementation group: <span class="hljs-string">'org.mockito'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'mockito-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'3.1.0'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-api-mockito2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-module-junit4'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'4.12'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os principais s√£o o AWS SDK. </font><font style="vertical-align: inherit;">Eles permitir√£o que voc√™ trabalhe com servi√ßos espec√≠ficos, como SES, DynamoDB, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. N√≥s escrevemos uma lambda</font></font></h3><br>
<ul>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alteramos as classes de solicita√ß√£o e resposta do modelo para RequestHandler para AwsProxyRequest e ContactUsProxyResponse.</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span>&lt;<span class="hljs-title">AwsProxyRequest</span>, <span class="hljs-title">ContactUsProxyResponse</span>&gt;
...
<span class="hljs-title">public</span> <span class="hljs-title">ContactUsProxyResponse</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-title">AwsProxyRequest</span> <span class="hljs-title">request</span>, <span class="hljs-title">Context</span> <span class="hljs-title">context</span>) </span></code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  AwsClientFactory   AWS SDK-.</b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">/**
 * Just an util class for an eager initialization of sdk clients.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsClientFactory</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LogManager.getLogger(AwsClientFactory.class);<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AmazonSimpleEmailService sesClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DynamoDB dynamoDB;<font></font>
<font></font>
    /**<font></font>
     * AWS regions should be env variables <span class="hljs-keyword">if</span> you want to generalize the solution.<font></font>
     */<font></font>
    AwsClientFactory() {<font></font>
        LOG.debug("AWS clients factory initialization.");<font></font>
        sesClient = AmazonSimpleEmailServiceClient.builder().withRegion(Regions.EU_WEST_1).build();<font></font>
        AmazonDynamoDB dynamoDBClient = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.EU_WEST_1).build();<font></font>
        dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(dynamoDBClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">DynamoDB <span class="hljs-title">getDynamoDB</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> dynamoDB;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">AmazonSimpleEmailService <span class="hljs-title">getSesClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sesClient;<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    ObjectMapper   .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ObjectMapper OBJECT_MAPPER = <span class="hljs-keyword">new</span> ObjectMapper();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AwsClientFactory AWS_CLIENT_FACTORY = <span class="hljs-keyword">new</span> AwsClientFactory();
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
 <span class="hljs-function"><span class="hljs-keyword">private</span> SendEmailResult <span class="hljs-title">sendEmail</span><span class="hljs-params">(ContactUsRequest contactUsRequest)</span> </span>{<font></font>
        String emailTemplate = getEmailTemplate();<font></font>
        String email = fillTemplate(emailTemplate, contactUsRequest);<font></font>
<font></font>
        SendEmailRequest sendEmailRequest =<font></font>
                <span class="hljs-keyword">new</span> SendEmailRequest(<font></font>
                        System.getenv(<span class="hljs-string">"SENDER_EMAIL"</span>),
                        <span class="hljs-keyword">new</span> Destination(List.of(System.getenv(<span class="hljs-string">"RECIPIENT_EMAIL"</span>))),
                        <span class="hljs-keyword">new</span> Message()<font></font>
                                .withSubject(<font></font>
                                        <span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(contactUsRequest.getSubject()))<font></font>
                                .withBody(<span class="hljs-keyword">new</span> Body()<font></font>
                                        .withHtml(<span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(email))));<font></font>
        LOG.info(<span class="hljs-string">"Email template is ready"</span>);
        <span class="hljs-keyword">return</span> AWS_CLIENT_FACTORY.getSesClient().sendEmail(sendEmailRequest);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fillTemplate</span><span class="hljs-params">(String emailTemplate, ContactUsRequest contactUsRequest)</span> </span>{
        <span class="hljs-keyword">return</span> String.format(<font></font>
                emailTemplate,<font></font>
                contactUsRequest.getUsername(),<font></font>
                contactUsRequest.getEmail(),<font></font>
                contactUsRequest.getPhone(),<font></font>
                contactUsRequest.getQuestion());<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getEmailTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> IOUtils.toString(<font></font>
                    Objects.requireNonNull(<span class="hljs-keyword">this</span>.getClass().getClassLoader()<font></font>
                                               .getResourceAsStream(<span class="hljs-string">"email_template.html"</span>)),<font></font>
                    UTF_8);<font></font>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Loading an email template failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmailDetailsToDb</span><span class="hljs-params">(ContactUsRequest contactUsRequest, SendEmailResult sendEmailResult)</span> </span>{<font></font>
        AWS_CLIENT_FACTORY.getDynamoDB().getTable(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                          .putItem(<span class="hljs-keyword">new</span> Item()<font></font>
                                  .withPrimaryKey(<span class="hljs-string">"Id"</span>, sendEmailResult.getMessageId())<font></font>
                                  .withString(<span class="hljs-string">"Subject"</span>, contactUsRequest.getSubject())<font></font>
                                  .withString(<span class="hljs-string">"Username"</span>, contactUsRequest.getUsername())<font></font>
                                  .withString(<span class="hljs-string">"Phone"</span>, contactUsRequest.getPhone())<font></font>
                                  .withString(<span class="hljs-string">"Email"</span>, contactUsRequest.getEmail())<font></font>
                                  .withString(<span class="hljs-string">"Question"</span>, contactUsRequest.getQuestion()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">private</span> ContactUsProxyResponse <span class="hljs-title">buildResponse</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode, String body)</span> </span>{<font></font>
        ContactUsProxyResponse awsProxyResponse =<font></font>
                <span class="hljs-keyword">new</span> ContactUsProxyResponse();<font></font>
        awsProxyResponse.setStatusCode(statusCode);<font></font>
        awsProxyResponse.setBody(getBodyAsString(body));<font></font>
        awsProxyResponse.addHeader(CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());<font></font>
        awsProxyResponse.addHeader(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
        <span class="hljs-keyword">return</span> awsProxyResponse;<font></font>
}<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getBodyAsString</span><span class="hljs-params">(String body)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> OBJECT_MAPPER.writeValueAsString(<span class="hljs-keyword">new</span> ContactUsResponseBody(body));<font></font>
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Writing ContactUsResponseBody as string failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    .      ¬´// WARMING UP¬ª.</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         handleRequest()</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ContactUsProxyResponse <span class="hljs-title">handleRequest</span><span class="hljs-params">(AwsProxyRequest request, Context context)</span> </span>{<font></font>
        LOG.info(<span class="hljs-string">"Request was received"</span>);<font></font>
        LOG.debug(getAsPrettyString(request));<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
        }<font></font>
<font></font>
        ContactUsRequest contactUsRequest = getContactUsRequest(request);<font></font>
<font></font>
        SendEmailResult sendEmailResult = sendEmail(contactUsRequest);<font></font>
        LOG.info(<span class="hljs-string">"Email was sent"</span>);<font></font>
<font></font>
        addEmailDetailsToDb(contactUsRequest, sendEmailResult);<font></font>
        LOG.info(<span class="hljs-string">"DB is updated"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">200</span>,<font></font>
                String.format(<span class="hljs-string">"Message %s has been sent successfully."</span>, sendEmailResult.getMessageId()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l√≥gica b√°sica √© bastante simples, ent√£o n√£o acho que valha a pena descrev√™-la em detalhes. Vale a pena prestar aten√ß√£o em v√°rios pontos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro √© o log. Um dos argumentos do m√©todo lambda Context cont√©m muitas informa√ß√µes auxiliares, al√©m de um criador de logs. Portanto, voc√™ n√£o pode criar um criador de logs separado, mas use o contexto lambda fornecido. Para fazer isso, basta ligar antes do uso:</font></font><br>
<blockquote><code>LambdaLogger logger = context.getLogger(); </code></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto est√° esquentando. Como criar um ambiente execut√°vel para um lambda √© lento, iniciar a JVM, carregar o caminho de classe e executar o c√≥digo leva algum tempo. A primeira chamada pode levar alguns segundos, o que n√£o √© bom se voc√™ escrever APIs s√≠ncronas diferentes. Para esses casos, voc√™ mesmo pode informar √† AWS que precisa manter v√°rias inst√¢ncias lambda em alerta. Mas isso exige que algu√©m chame um lambda. Se fizermos isso com a vers√£o b√°sica do c√≥digo, enviaremos uma carta e escreveremos alguns dados imprecisos no banco de dados.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar isso, podemos adicionar algum tipo de processamento de solicita√ß√£o para distinguir a solicita√ß√£o real da solicita√ß√£o de aquecimento. Por exemplo, podemos adicionar um cabe√ßalho especial √† solicita√ß√£o. No nosso caso, o cabe√ßalho ‚ÄúX-WARM-UP‚Äù ser√° usado com qualquer valor - para entender que essa √© uma solicita√ß√£o de aquecimento e precisamos apenas retornar algum tipo de resposta sem executar a l√≥gica de neg√≥cios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A √∫ltima coisa que gostaria de chamar a aten√ß√£o √© o uso de vari√°veis ‚Äã‚Äãest√°ticas. </font><font style="vertical-align: inherit;">Isso n√£o cria a inst√¢ncia lambda com estado no nosso caso, simplesmente permite reutilizar objetos existentes e inicializados. </font><font style="vertical-align: inherit;">Se os objetos que voc√™ deseja inicializar mudar estaticamente durante a execu√ß√£o do c√≥digo, tente pensar novamente se isso interferir√° na opera√ß√£o de chamadas subseq√ºentes ao lambda. </font><font style="vertical-align: inherit;">Al√©m disso, se esses objetos usarem vari√°veis ‚Äã‚Äãde ambiente durante a inicializa√ß√£o, voc√™ n√£o deve torn√°-los est√°ticos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. N√≥s escrevemos testes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo Lambda pode ser coberto pelos mesmos tipos de testes usados ‚Äã‚Äãna maioria dos casos. </font><font style="vertical-align: inherit;">Mas, para impedir que o artigo cres√ßa ainda mais, abordarei o teste de aplicativos sem servidor no pr√≥ximo artigo sobre o teste do AWS Lambda e o desenvolvimento local. </font><font style="vertical-align: inherit;">Embora os testes de unidade j√° estejam dispon√≠veis no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reposit√≥rio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Escrevemos um modelo de recursos SAM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que escrevemos e testamos nossa lambda localmente, precisamos escrever um modelo SAM para implantar todos esses recursos na AWS.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco sobre o SAM</font></font></b>
                        <div class="spoiler_text">Serverless Application Model ‚Äì     serverless .  ,      CloudFormation DSL,     ‚Äì   Lambda, Gateway, DynamoDB  . . <br>
SAM, CloudFormation, Terraform ‚Äì   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IaC-</a>. SAM     Serverless-,   Terraform        . <br>
 Terraform   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">    DINS</a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, vejamos quais recursos precisamos declarar no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modelo SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: Function</font></font></b></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Os principais recursos j√° ser√£o preenchidos se usarmos o SAM init para criar o projeto. </font><font style="vertical-align: inherit;">Mas aqui est√° como eles se parecem no meu exemplo:</font></font><br>
<pre><code class="plaintext hljs">CodeUri: contact-us-function<font></font>
Handler: com.gralll.sam.App::handleRequest<font></font>
Runtime: java8<font></font>
MemorySize: 256<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui eu acho que tudo est√° claro o suficiente. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeUri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o diret√≥rio com nosso </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manipulador</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lambda </font><font style="vertical-align: inherit;">- o caminho completo para o m√©todo </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Runtime</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - no qual o lambda </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° escrito </font><font style="vertical-align: inherit;">- fala por si mesmo </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falando em mem√≥ria</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : at√© 3 GB de RAM est√£o dispon√≠veis no lambda, o que corresponde a um recurso de 2 CPUs. Ou seja, voc√™ n√£o pode ajustar a CPU separadamente, apenas aumentando / diminuindo a quantidade de mem√≥ria.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O pr√≥ximo bloco √© necess√°rio para selecionar o m√©todo de implanta√ß√£o.</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoPublishAlias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - permite </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adicionar um alias</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a cada nova vers√£o implantada </font><font style="vertical-align: inherit;">. Isso √© necess√°rio para implementar a implanta√ß√£o de can√°rios. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canary10Percent10Minutes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - um tipo de implanta√ß√£o que permitir√° a voc√™ segurar simultaneamente duas vers√µes do lambda: a antiga e a nova, mas redirecionar apenas 10% do tr√°fego para a nova. Se em dez minutos n√£o houver problemas, o restante do tr√°fego tamb√©m ser√° redirecionado para a nova vers√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ler mais sobre o uso de recursos avan√ßados </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na p√°gina SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, est√£o as vari√°veis ‚Äã‚Äãde ambiente que ser√£o usadas no c√≥digo. Depois disso, outro bloco para lambda:</font></font><br>
<pre><code class="plaintext hljs">Events:<font></font>
  ContactUs:<font></font>
    Type: Api<font></font>
    Properties:<font></font>
      Path: /contact<font></font>
      Method: post<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nele, devemos descrever os gatilhos para chamar um lambda. No nosso caso, essas ser√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicita√ß√µes do API Gateway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© uma forma bastante simplificada de descrever a API, mas √© suficiente para a API de gateway rec√©m-criada redirecionar todas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solicita√ß√µes de </font><b><font style="vertical-align: inherit;">POST / contato</font></b><font style="vertical-align: inherit;"> para nossa lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, precisamos descrever os aspectos de seguran√ßa. Fora da caixa, o lambda criado n√£o ter√° acesso ao banco de dados ou ao servi√ßo de email. Portanto, precisamos prescrever explicitamente o que ser√° permitido. Existem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√°rias maneiras</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de conceder acesso √† AWS. Usaremos pol√≠ticas baseadas em recursos:</font></font><br>
<pre><code class="plaintext hljs">Policies:<font></font>
  - AWSLambdaExecute<font></font>
  - Version: '2012-10-17'<font></font>
    Statement:<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - ses:SendEmail<font></font>
          - ses:SendRawEmail<font></font>
        Resource: 'arn:aws:ses:eu-west-1:548476639829:identity/aleksandrgruzdev11@gmail.com'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:List*<font></font>
        Resource: '*'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:Get*<font></font>
          - dynamodb:PutItem<font></font>
          - dynamodb:DescribeTable<font></font>
        Resource: 'arn:aws:dynamodb:*:*:table/ContactUsTable'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que, para a tabela do banco de dados, especificamos um nome espec√≠fico; portanto, precisaremos criar uma tabela com o mesmo nome. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em rela√ß√£o ao SES: voc√™ v√™ meu endere√ßo de e-mail. No seu caso, deve ser o seu pr√≥prio endere√ßo confirmado. Como fazer isso, veja </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Logo em seguida, voc√™ poder√° encontrar o ARN de identidade desse recurso clicando no endere√ßo criado e substitu√≠-lo pelo email no exemplo acima. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles meio que descobriram a lambda. Agora vamos para o banco de dados. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: SimpleTable</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para nossas tarefas, criaremos apenas uma tabela </font><b><i><font style="vertical-align: inherit;">ContactUsTable</font></i></b><font style="vertical-align: inherit;"> :</font></font><br>
<pre><code class="plaintext hljs">ContactUsTable:<font></font>
  Type: AWS::Serverless::SimpleTable<font></font>
  Properties:<font></font>
    PrimaryKey:<font></font>
      Name: Id<font></font>
      Type: String<font></font>
    TableName: ContactUsTable<font></font>
    ProvisionedThroughput:<font></font>
      ReadCapacityUnits: 2<font></font>
      WriteCapacityUnits: 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos campos obrigat√≥rios - apenas ID, e tamb√©m indicam ReadCapacityUnits e WriteCapacityUnits. </font><font style="vertical-align: inherit;">N√£o vamos nos deter em detalhes sobre quais valores escolher, pois esse tamb√©m √© um t√≥pico bastante extenso. </font><font style="vertical-align: inherit;">Voc√™ pode ler </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Para um aplicativo de teste, pequenos valores da ordem de 1-2 tamb√©m s√£o suficientes. </font><font style="vertical-align: inherit;">
Os par√¢metros gerais </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">globais</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podem ser removidos neste bloco se, por exemplo, voc√™ declarar v√°rios recursos do tipo Fun√ß√£o ou API.</font></font><br>
<pre><code class="plaintext hljs">Globals:<font></font>
  Function:<font></font>
    Timeout: 15<font></font>
  Api:<font></font>
    Cors:<font></font>
      AllowOrigin: "'*'"<font></font>
      AllowHeaders: "'Content-Type,X-WARM-UP,X-Amz-Date,Authorization,X-Api-Key'"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usei-o para definir um tempo limite para a fun√ß√£o e algumas configura√ß√µes do Cors para chamar a API do Gateway posteriormente na minha p√°gina est√°tica com o formul√°rio ContactUs. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sa√≠das</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esse bloco permite definir dinamicamente algumas vari√°veis ‚Äã‚Äãno contexto global do AWS CloudFormation.</font></font><br>
<pre><code class="plaintext hljs">Outputs:<font></font>
  ContactUsApi:<font></font>
    Description: "API Gateway endpoint URL for Prod stage for ContactUs function"<font></font>
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/contact/"<font></font>
  ContactUsFunction:<font></font>
    Description: "ContactUs Lambda Function ARN"<font></font>
    Value: !GetAtt ContactUsFunction.Arn<font></font>
  ContactUsFunctionIamRole:<font></font>
    Description: "Implicit IAM Role created for ContactUs function"<font></font>
    Value: !GetAtt ContactUsFunctionRole.Arn<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, declaramos uma vari√°vel ContactUsApi, que ser√° definida como um valor, como o endere√ßo p√∫blico do nosso terminal de API criado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como estamos usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ {ServerlessRestApi}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a AWS inserir√° o identificador exclusivo de nossa nova API de gateway na cadeia de caracteres. Como resultado, qualquer aplicativo que tenha acesso ao CloudFormation poder√° obter esse endere√ßo - assim, voc√™ n√£o pode codificar a URL de seus servi√ßos. Bem, outra vantagem √© que √© muito conveniente ver a lista de sa√≠das - algumas informa√ß√µes meta sobre sua pilha. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma lista completa de fun√ß√µes e quais par√¢metros voc√™ pode usar pode ser encontrada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par√¢metros</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Al√©m de todas as op√ß√µes acima, voc√™ pode adicionar um bloco </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par√¢metros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Essas op√ß√µes ajudar√£o a tornar o modelo mais vers√°til. </font><font style="vertical-align: inherit;">Em qualquer outro bloco do modelo, voc√™ pode fazer refer√™ncias a esses par√¢metros, n√£o codificando alguns valores. </font><font style="vertical-align: inherit;">Por exemplo, no meu modelo, podem ser emails, SES ARN, quantidade de mem√≥ria etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse √© o modelo inteiro. </font><font style="vertical-align: inherit;">Ningu√©m pro√≠be adicionar mais alguns recursos por perto, por exemplo, um bucket S3, qualquer outro recurso do CloudFormation ou um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recurso personalizado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em geral </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Prosseguimos com a implanta√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para montar nosso projeto, usaremos n√£o o Gradle, mas o SAM.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagem</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam build<font></font>
Building resource <span class="hljs-string">'ContactUsFunction'</span><font></font>
Running JavaGradleWorkflow:GradleBuild<font></font>
Running JavaGradleWorkflow:CopyArtifacts<font></font>
<font></font>
Build Succeeded<font></font>
<font></font>
Built Artifacts  : .aws-sam\build<font></font>
Built Template   : .aws-sam\build\template.yaml<font></font>
<font></font>
Commands you can use next<font></font>
=========================<font></font>
[*] Invoke Function: sam <span class="hljs-built_in">local</span> invoke<font></font>
[*] Deploy: sam deploy ‚Äìguided<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A execu√ß√£o do </font><font style="vertical-align: inherit;">comando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam build a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir da raiz do projeto coletar√° automaticamente </font><font style="vertical-align: inherit;">todos os arquivos necess√°rios </font><font style="vertical-align: inherit;">na </font><font style="vertical-align: inherit;">pasta </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.aws-sam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : classes, depend√™ncias, modelo SAM. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, voc√™ precisa criar um dep√≥sito S3, em que o SAM carrega posteriormente todos os artefatos coletados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso pode ser feito atrav√©s do console da AWS baseado em navegador ou com o comando</font></font><br>
<blockquote><code>aws s3 mb s3://bucket-name</code></blockquote><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: todos os buckets s√£o criados em um contexto global e s√£o vasculhados entre todas as contas. </font><font style="vertical-align: inherit;">Portanto, voc√™ n√£o pode criar um bloco se algu√©m j√° o criou na sua conta. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando o bucket estiver pronto, execute o comando:</font></font><br>
<blockquote><code>sam package --output-template-file packaged.yaml --s3-bucket &lt;YOUR_BACKET&gt;</code></blockquote><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado do pacote</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam package --output-template-file packaged.yaml --s3-bucket contact-us-sam-app<font></font>
Uploading to ea0c122c06a50d9676fbf9000a80a3bf  9212768 / 9212768.0  (100.00%)<font></font>
<font></font>
Successfully packaged artifacts and wrote output template to file packaged.yaml.<font></font>
Execute the following <span class="hljs-built_in">command</span> to deploy the packaged template<font></font>
sam deploy --template-file F:\aws\projects\contact-us-sam-app\packaged.yaml --stack-name &lt;YOUR STACK NAME&gt;<font></font>
</code></pre></div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apontei meu balde entre em contato conosco e o aplicativo e o SAM carregou todos os recursos no local especificado. </font><font style="vertical-align: inherit;">Em seguida, o SAM j√° informa um comando para criar uma pilha com recursos e, assim, incorporar sua decis√£o. </font><font style="vertical-align: inherit;">Executamos o comando, finalizando um pouco:</font></font><br>
<blockquote><code>sam deploy --template-file packaged.yaml --region eu-west-1 --capabilities CAPABILITY_IAM --stack-name contact-us-sam-app </code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, eu adicionei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--capabilities CAPABILITY_IAM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Isso permitir√° que o CloudFormation crie recursos do IAM. </font><font style="vertical-align: inherit;">Caso contr√°rio, voc√™ receber√° um erro InsufficientCapabilities ao criar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, √© apresentado o log do trabalho deste comando (a imagem √© clic√°vel). </font><font style="vertical-align: inherit;">Detalhes como o status de cada recurso e os valores das sa√≠das ficaram dispon√≠veis apenas em uma das vers√µes mais recentes do SAM CLI.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/nv/7p/4z/nv7p4zreqati1wd8c8vy3ubuzcm.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Verifique o status do CloudFormation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos esperar a conclus√£o da implanta√ß√£o no console at√© aparecer uma mensagem informando que a pilha foi implantada (o comando deploy registra no par√°grafo anterior):</font></font><br>
<blockquote><code>Successfully created/updated stack - contact-us-sam-app in eu-west-1</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, no nosso caso, voc√™ ver√° esta mensagem somente ap√≥s dez minutos devido ao modo de implanta√ß√£o do can√°rio. Portanto, √© mais f√°cil abrir um console do navegador e observar a pilha l√°. </font></font><br>
<img src="https://habrastorage.org/webt/97/ki/k8/97kik8apukwxsvqwyvsd_wtmaqo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de algum tempo, o status ser√° alterado para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE_COMPLETE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que significar√° a conclus√£o bem-sucedida. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na guia </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">voc√™ pode ver o status de todos os recursos. Se sua pilha fracassar, √© aqui que voc√™ pode encontrar mensagens de erro detalhadas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, este: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE_FAILED</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - se voc√™ configurar incorretamente a API do Gateway no modelo.</font></font><br>
<img src="https://habrastorage.org/webt/ce/mh/aq/cemhaqtl6uvdmlvnr0bsvrbokok.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na guia Recursos, voc√™ pode encontrar todos os recursos criados. </font><font style="vertical-align: inherit;">N√£o se surpreenda com a quantidade. </font><font style="vertical-align: inherit;">Embora tenhamos declarado apenas uma fun√ß√£o e uma tabela de banco de dados no modelo SAM, o CloudFormation criou muitos outros recursos para n√≥s. </font><font style="vertical-align: inherit;">Se voc√™ olhar para o tipo deles, poder√° entender a que servi√ßo eles pertencem. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o Api Gateway, ele foi criado implicitamente:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiDeployment</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiProdStage</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m para o lambda, v√°rios objetos adicionais foram criados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora abra </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sa√≠das</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e encontre o URL da nossa API. </font><font style="vertical-align: inherit;">Copie-o, em breve ser√° √∫til.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Formul√°rio ContactUs HTML</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ se lembra, decidi criar um formul√°rio ContactUs e agora precisamos disponibiliz√°-lo de alguma forma, n√£o apenas na m√°quina local. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quanto ao pr√≥prio formul√°rio, por exemplo, decidi usar o formul√°rio HTML mais simples e adicionei chamadas √† API do Gateway atrav√©s do ajax. </font></font><br>
<img src="https://habrastorage.org/webt/ps/e-/4h/pse-4hta3mojfuamij0dhj3bmyg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do pr√≥prio formul√°rio, adicionei alguns bot√µes para depura√ß√£o e simplifica√ß√£o do preenchimento: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definir padr√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - substitui, como esperado, os par√¢metros padr√£o especificados dentro do HTML.</font></font><br>
<pre><code class="javascript hljs">$(<span class="hljs-string">"#url-input"</span>).val(<span class="hljs-string">"https://4ykskscuq0.execute-api.eu-west-1.amazonaws.com/Prod/contact"</span>);<font></font>
$(<span class="hljs-string">"#name-input"</span>).val(<span class="hljs-string">"Mike"</span>);<font></font>
$(<span class="hljs-string">"#email-input"</span>).val(<span class="hljs-string">"Mike@somemail.com"</span>);<font></font>
$(<span class="hljs-string">"#phone-input"</span>).val(<span class="hljs-string">"+79999999999"</span>);<font></font>
$(<span class="hljs-string">"#description-input"</span>).val(<span class="hljs-string">"How much does it cost?"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ pretende usar essa funcionalidade, altere a entrada da URL para o caminho da API do Gateway, que voc√™ copiou das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sa√≠das</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hospedagem</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie um novo bucket S3.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregamos o arquivo HTML no bucket, escolhendo a op√ß√£o para tornar o arquivo p√∫blico.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entramos no balde onde carregamos o arquivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√° para Propriedades, ative a hospedagem de site est√°tico e veja seu novo Endpoint dispon√≠vel ao p√∫blico.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. Exame de Sa√∫de</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicita√ß√£o padr√£o</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora voc√™ pode seguir o link para seu formul√°rio, clique em Definir padr√£o e em Enviar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dessa forma, voc√™ far√° uma solicita√ß√£o que passar√° pela API do Gateway para o AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ configurou tudo corretamente depois de um tempo, receber√° uma mensagem como:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√äxito: A mensagem 0102016f28b06243-ae897a1e-b805-406b-9987-019f21547682-000000 foi enviada com sucesso.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso significa que a mensagem foi entregue com sucesso. Verifique sua caixa de correio que voc√™ especificou no modelo SAM. Se voc√™ n√£o alterou o modelo, a letra estar√° neste formato: </font></font><br>
<img src="https://habrastorage.org/webt/0z/wy/sv/0zwysv5ytv3uzn9fb9az7bsa6lg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ tamb√©m pode abrir o DynamoDB e verificar se uma nova entrada foi exibida. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caracter√≠sticas de um come√ßo frio</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Acho que voc√™ percebeu que a mensagem sobre o envio bem-sucedido veio ap√≥s um longo per√≠odo de tempo. Isso ocorre porque o servi√ßo AWS Lambda, ap√≥s receber uma solicita√ß√£o de processamento, come√ßou a aumentar a inst√¢ncia do seu aplicativo Java, e isso inclui levantar o cont√™iner com o sistema operacional e o JRE, carregar o caminho de classe, inicializar todas as vari√°veis ‚Äã‚Äãe somente depois disso √© o in√≠cio do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handleRequest ( )</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Isso √© chamado de partida a frio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tente preencher e enviar o formul√°rio novamente. Desta vez, a resposta veio quase instantaneamente, certo? Se tiverem passado mais de 20 a 30 minutos entre a primeira e a segunda solicita√ß√µes, o resultado poder√° variar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qual √© a raz√£o para isto? E com o fato de o AWS Lambda caches j√° usarem cont√™ineres com lambdas para reutiliza√ß√£o. Isso reduz o tempo de inicializa√ß√£o de todo o contexto para iniciar o m√©todo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o h√° uma correla√ß√£o clara de quanto tempo as lambdas s√£o armazenadas em cache, dependendo do tipo, mas algumas pessoas descobriram experimentalmente que isso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">depende diretamente do valor escolhido da RAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ou seja, um lambda com 128 MB de mem√≥ria estar√° dispon√≠vel por mais tempo do que com 3 GB. Talvez haja outros par√¢metros, por exemplo, a carga m√©dia na regi√£o na qual suas lambdas s√£o executadas, mas isso √© impreciso. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, experimente voc√™ mesmo e planeje o tempo de armazenamento em cache se voc√™ usar solicita√ß√µes s√≠ncronas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquecimento</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como op√ß√£o adicional, voc√™ pode usar o aquecimento lambda. No c√≥digo, adicionei uma verifica√ß√£o de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cabe√ßalho X-WAMP-UP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se houver, o lambda simplesmente retorna uma resposta sem executar nenhuma l√≥gica de neg√≥cios, mas o cont√™iner estar√° pronto para chamadas subseq√ºentes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ mesmo pode chamar seu lambda, por exemplo, pelo cron√¥metro de coroa, usando o CloudWatch. Isso ajudar√° se voc√™ n√£o desejar que seus clientes participem do Cold Start.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No formul√°rio HTML, voc√™ pode encontrar o bot√£o do modo WarmUp, que adiciona esse cabe√ßalho especial √† solicita√ß√£o. </font><font style="vertical-align: inherit;">Voc√™ pode verificar se n√£o ocorre o envio de uma carta nem a grava√ß√£o no banco de dados, mas a resposta do lambda chega e a chamada subsequente √† solicita√ß√£o real n√£o levar√° muito tempo.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumindo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o artigo, passamos por todas as etapas principais, do design do aplicativo ao seu lan√ßamento na </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chamada produ√ß√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que as pessoas que j√° ouviram falar sobre Serverless e AWS Lambda, mas que n√£o tiveram experi√™ncia pr√°tica, possam usar este guia e possam sentir que isso oferece vantagens significativas na velocidade de implanta√ß√£o de algumas solu√ß√µes de software e n√£o apenas isso. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benef√≠cios</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para mim, identifiquei as vantagens mais valiosas:</font></font><br>
<ul>
<li>     Free Tier      ,     ,       .</li>
<li>           1-2 .        /.</li>
<li>  ,          ,         .</li>
<li>  Serverless      .   ,  ‚Äî  .   SAM          AWS. AWS    ,         ,   .</li>
<li>      Lambda ,     .</li>
<li>   Serverless    , , .          ELK/Promethes/Grafana      .</li>
<li>   ,             API.          API Key,   IAM ,                      .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, provavelmente a coisa mais b√°sica √© sem servidor. </font><font style="vertical-align: inherit;">N√£o √© necess√°rio pensar em qual inst√¢ncia do EC2 voc√™ precisa pagar, como configurar o acesso a ela, como configurar alertas no caso de uma falha do aplicativo, configurar o dimensionamento autom√°tico, etc.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desvantagens</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Infelizmente, isso n√£o significa que agora voc√™ pode pegar esta solu√ß√£o e us√°-la como parte de um sistema corporativo, em vez de seus microsservi√ßos favoritos no cubo. </font><font style="vertical-align: inherit;">Muitas vezes, voc√™ precisa se aprofundar para determinar uma solu√ß√£o mais adequada em um caso espec√≠fico. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E tamb√©m tenho coment√°rios aos quais voc√™ deve prestar aten√ß√£o ao escolher o Lambda:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partida a frio. </font><font style="vertical-align: inherit;">Especialmente significativo ao usar consultas s√≠ncronas e linguagens como Java ou C #. </font><font style="vertical-align: inherit;">O problema √© moderadamente resolvido com o aquecimento, mas √© melhor pensar em uma solu√ß√£o com anteced√™ncia e comparar o custo e os poss√≠veis benef√≠cios</font></font></li>
<li>    .       3GB  ,    2   ,    ,     - Fargate,       ,     .</li>
<li>          API,       ,           .</li>
<li>    /   1-2     Serverless,                .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ j√° possui a infraestrutura para desenvolver microsservi√ßos e CI / CD na Coober, ser√° problem√°tico novamente argumentar (especialmente para gerentes) a necessidade de oferecer suporte a outro processo de CI / CD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, onde sem testes. </font><font style="vertical-align: inherit;">E testar o lambda quanto √† taxa de transfer√™ncia √© bastante dif√≠cil, porque ainda √© diferente do teste de desempenho usual e muitos fatores devem ser levados em considera√ß√£o.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em geral, o uso do AWS Lambda e de outros servi√ßos sem servidor se encaixa muito bem com os princ√≠pios de desenvolvimento ass√≠ncrono e orientado a eventos. </font><font style="vertical-align: inherit;">E √© usando o processamento ass√≠ncrono que os melhores resultados podem ser alcan√ßados tanto em termos de desempenho quanto de custo. </font><font style="vertical-align: inherit;">Aqui est√° uma lista de solu√ß√µes nas quais as solu√ß√µes Serveress desempenhar√£o um papel significativo:</font></font><br>
<img src="https://habrastorage.org/webt/i6/ov/y6/i6ovy6ha2pszsiui5jvyewbf-dk.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o artigo acabou sendo bastante extenso e n√£o quero aumentar ainda mais, provavelmente prepararei uma sequ√™ncia em que mostrarei como conduzir o desenvolvimento com mais efici√™ncia usando todos os recursos do console da AWS, estrutura SAM e at√© IntelljIDEA. </font><font style="vertical-align: inherit;">Bem, como omiti a parte de teste, tentarei descrever esse aspecto do desenvolvimento em mais detalhes. </font><font style="vertical-align: inherit;">Al√©m disso, se voc√™ deseja saber o que adicionar ao pr√≥ximo artigo, ou perguntas, sinta-se √† vontade para escrever nos coment√°rios ou em mensagens privadas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionado: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda em a√ß√£o. </font><font style="vertical-align: inherit;">Parte 2</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alguns links importantes e √∫teis do artigo:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projeto GitHub</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa o download do AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baixar SAM-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o da AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infraestrutura como c√≥digo</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experi√™ncia usando o Terraform</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descri√ß√£o dos recursos do SAM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aliases de fun√ß√£o do AWS Lambda</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementa√ß√£o avan√ßada de lambda</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o de recurso da API do SAM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AWS IAM   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">       SES</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Read/Write capacity  DynamoDB </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SAM/CloudFormation  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Parameters   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  CloudFormation </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">      </a></li>
</ul></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt486648/">https://habr.com/ru/post/pt486648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486634/index.html">Atualiza√ß√µes de back-end do MSVC no Visual Studio 2019 vers√£o 16.3 e 16.4</a></li>
<li><a href="../pt486638/index.html">O Blazor WebAssembly 3.2.0 Preview 1 j√° est√° dispon√≠vel</a></li>
<li><a href="../pt486640/index.html">Resumo de materiais interessantes para o desenvolvedor m√≥vel # 331 (27 de janeiro a 2 de fevereiro)</a></li>
<li><a href="../pt486644/index.html">Antena DIY em 5 minutos</a></li>
<li><a href="../pt486646/index.html">Afaste-se do jQuery para Svelte, sem dor</a></li>
<li><a href="../pt486650/index.html">Mem√≥ria din√¢mica em sistemas r√≠gidos em tempo real</a></li>
<li><a href="../pt486652/index.html">"Cr√≠tica √† raz√£o pura" para programadores</a></li>
<li><a href="../pt486654/index.html">Sensor de movimento e conex√£o de registro de alarme e v√≠deo no Home Assistant no Raspberry pi</a></li>
<li><a href="../pt486656/index.html">Como adicionar novos personagens ao Unicode: a experi√™ncia do leigo</a></li>
<li><a href="../pt486658/index.html">Moxy Strategy plugin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>