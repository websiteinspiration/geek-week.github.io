<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òëÔ∏è üöí üêú De la vie avec Kubernetes: comment nous avons supprim√© le SGBD (et pas seulement) des environnements de r√©vision aux statiques üë®üèº‚Äçüîß üïõ üßîüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Remarque : cet article ne pr√©tend pas √™tre une meilleure pratique. Il d√©crit l'exp√©rience d'une impl√©mentation sp√©cifique d'une t√¢che d'infrastructure...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>De la vie avec Kubernetes: comment nous avons supprim√© le SGBD (et pas seulement) des environnements de r√©vision aux statiques</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/501424/"><img src="https://habrastorage.org/webt/ae/yu/zw/aeyuzw9pz0k6d0pbc0g86pxkfd0.png"><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : cet article ne pr√©tend pas √™tre une meilleure pratique. </font><font style="vertical-align: inherit;">Il d√©crit l'exp√©rience d'une impl√©mentation sp√©cifique d'une t√¢che d'infrastructure en termes d'utilisation de Kubernetes et Helm, qui peut √™tre utile pour r√©soudre des probl√®mes connexes. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation d'environnements de r√©vision dans CI / CD peut √™tre tr√®s utile, √† la fois pour les d√©veloppeurs et les ing√©nieurs syst√®me. </font><font style="vertical-align: inherit;">Synchronisons d'abord les id√©es g√©n√©rales √† leur sujet:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les environnements de r√©vision peuvent √™tre cr√©√©s √† partir de branches distinctes dans des r√©f√©rentiels Git d√©finis par les d√©veloppeurs (les soi-disant branches de fonctionnalit√©s).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ils peuvent avoir des instances SGBD distinctes, des processeurs de file d'attente, des services de mise en cache, etc. </font><font style="vertical-align: inherit;">- en g√©n√©ral, tout pour la reproduction int√©grale de l'environnement de production.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ils permettent un d√©veloppement parall√®le, acc√©l√©rant consid√©rablement la sortie de nouvelles fonctionnalit√©s dans l'application. </font><font style="vertical-align: inherit;">Dans le m√™me temps, des dizaines de ces environnements peuvent √™tre n√©cessaires chaque jour, c'est pourquoi la vitesse de leur cr√©ation est critique.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l'intersection des deuxi√®me et troisi√®me points, des difficult√©s surviennent souvent: l'infrastructure √©tant tr√®s diff√©rente, ses composants peuvent √™tre d√©ploy√©s longtemps. </font><font style="vertical-align: inherit;">Ce temps pass√©, par exemple, comprend la restauration de la base de donn√©es √† partir d'une sauvegarde d√©j√† pr√©par√©e *. </font><font style="vertical-align: inherit;">L'article traite de la mani√®re fascinante dont nous avons utilis√© une fois pour r√©soudre un tel probl√®me.</font></font><a name="habracut"></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Soit dit en passant, en particulier sur les grands vidages de base de donn√©es dans ce contexte, nous avons d√©j√† √©crit dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">document sur l'acc√©l√©ration de la base de donn√©es d'amor√ßage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .)</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le probl√®me et la fa√ßon de le r√©soudre</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'un des projets, nous avons √©t√© charg√©s de ¬´cr√©er un point d'entr√©e unique pour les d√©veloppeurs et les ing√©nieurs d'assurance qualit√©¬ª. </font><font style="vertical-align: inherit;">Cette formulation cache techniquement les √©l√©ments suivants:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour simplifier le travail des ing√©nieurs QA et de certains autres employ√©s, supprimez toutes les bases de donn√©es (et les h√¥tes correspondants) utilis√©es dans la revue, dans un environnement s√©par√© - statique -. </font><font style="vertical-align: inherit;">Pour des raisons qui pr√©valaient dans le projet, cette fa√ßon d'interagir avec eux √©tait optimale.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©duisez le temps de cr√©ation de l'environnement de r√©vision. </font><font style="vertical-align: inherit;">Tout le processus de leur cr√©ation √† partir de z√©ro est impliqu√©, c'est-√†-dire </font><font style="vertical-align: inherit;">y compris le clonage de bases de donn√©es, les migrations, etc.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue de la mise en ≈ìuvre, le probl√®me principal se r√©sume √† assurer l'idempotence lors de la cr√©ation et de la suppression des environnements de r√©vision. Pour y parvenir, nous avons modifi√© le m√©canisme de cr√©ation d'environnements de r√©vision en migrant d'abord les services </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL, MongoDB et RabbitMQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers un environnement statique. Statique fait r√©f√©rence √† un tel environnement ¬´permanent¬ª qui ne sera pas cr√©√© √† la demande de l'utilisateur (comme c'est le cas avec les environnements de r√©vision). </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'approche avec un environnement statique est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loin d'√™tre id√©ale</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour ses d√©fauts sp√©cifiques, voir la fin de l'article. Cependant, nous partageons cette exp√©rience en d√©tail, car elle peut √™tre plus ou moins applicable √† d'autres t√¢ches, et en m√™me temps servir d'argument lors de l'examen des probl√®mes de conception d'infrastructure.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la s√©quence d'actions dans la mise en ≈ìuvre:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la cr√©ation d'un environnement de r√©vision, les op√©rations suivantes doivent se produire une fois: la cr√©ation de bases de donn√©es dans deux SGBD (MongoDB et PostgreSQL), la restauration de bases de donn√©es √† partir d'une sauvegarde / d'un mod√®le et la cr√©ation de vhost dans RabbitMQ. </font><font style="vertical-align: inherit;">Cela n√©cessitera un moyen pratique de charger les d√©charges de courant. </font><font style="vertical-align: inherit;">(Si vous aviez d√©j√† examin√© des environnements, vous avez probablement d√©j√† une solution pr√™te √† l'emploi pour cela.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une fois l'environnement d'examen termin√©, vous devez supprimer la base de donn√©es et l'h√¥te virtuel dans RabbitMQ.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, l'infrastructure fonctionne dans le cadre de Kubernetes (utilisant Helm). </font><font style="vertical-align: inherit;">Par cons√©quent, pour la mise en ≈ìuvre des t√¢ches ci-dessus, les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crochets de barre √©taient</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> excellents </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils peuvent √™tre effectu√©s √† la fois avant la cr√©ation de tous les autres composants de la version Helm et / ou apr√®s leur suppression. </font><font style="vertical-align: inherit;">Donc:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour la t√¢che d'initialisation, nous utiliserons un hook </font></font><code>pre-install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour le lancer avant de cr√©er toutes les ressources dans la version;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour la t√¢che de suppression, un crochet </font></font><code>post-delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons aux d√©tails de l'impl√©mentation.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise en ≈ìuvre pratique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la version originale, ce projet utilisait un seul Job, compos√© de trois conteneurs. </font><font style="vertical-align: inherit;">Bien s√ªr, ce n'est pas tout √† fait pratique, car le r√©sultat est un grand manifeste difficile √† lire. </font><font style="vertical-align: inherit;">Par cons√©quent, nous l'avons divis√© en trois petits emplois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui suit est une liste pour PostgreSQL, et les deux autres (MongoDB et RabbitMQ) sont identiques dans la structure du manifeste:</font></font><br>
<br>
<pre><code class="plaintext hljs">{{- if .Values.global.review }}<font></font>
---<font></font>
apiVersion: batch/v1<font></font>
kind: Job<font></font>
metadata:<font></font>
  name: db-create-postgres-database<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "5"<font></font>
spec:<font></font>
  template:<font></font>
    metadata:<font></font>
      name: init-db-postgres<font></font>
    spec:<font></font>
      volumes:<font></font>
      - name: postgres-scripts<font></font>
        configMap:<font></font>
          defaultMode: 0755<font></font>
          name: postgresql-configmap<font></font>
      containers:<font></font>
      - name: init-postgres-database<font></font>
        image: private-registry/postgres <font></font>
        command: ["/docker-entrypoint-initdb.d/01-review-load-dump.sh"]<font></font>
        volumeMounts:<font></font>
        - name: postgres-scripts<font></font>
          mountPath: /docker-entrypoint-initdb.d/01-review-load-dump.sh<font></font>
          subPath: review-load-dump.sh<font></font>
        env:<font></font>
{{- include "postgres_env" . | indent 8 }}<font></font>
      restartPolicy: Never<font></font>
{{- end }}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commentaires sur le contenu du manifeste:</font></font><br>
<br>
<ol>
<li> Job    review-.  review   CI/CD       Helm- (. <code>if</code>  <code>.Values.global.review</code>    ).</li>
<li>  Job      ‚Äî , ConfigMap.       ,  ,       .       ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>hook-weight</code></a>.</li>
<li>      cURL   ,        PostgreSQL,       .</li>
<li>      PostgreSQL    :     ,     shell- .</li>
</ol><br>
<h3>PostgreSQL</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus int√©ressant est dans le script shell ( </font></font><code>review-load-dump.sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">d√©j√† mentionn√© dans la liste </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Quelles sont les options g√©n√©rales pour restaurer une base de donn√©es dans PostgreSQL?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R√©cup√©ration "standard" √† partir d'une sauvegarde;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©cup√©ration √† l'aide de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mod√®les</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, la diff√©rence entre les deux approches r√©side principalement dans la vitesse de cr√©ation d'une base de donn√©es pour le nouvel environnement. </font><font style="vertical-align: inherit;">Dans le premier - nous chargeons le vidage de la base de donn√©es et le restaurons avec </font></font><code>pg_restore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Et avec nous, cela se produit plus lentement que la deuxi√®me m√©thode, donc le choix correspondant a √©t√© fait. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisation de la deuxi√®me option ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©cup√©ration avec des mod√®les</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), vous pouvez cloner la base de donn√©es au niveau physique sans lui envoyer de donn√©es √† distance depuis le conteneur dans un autre environnement, ce qui r√©duit le temps de r√©cup√©ration. </font><font style="vertical-align: inherit;">Cependant, il existe une limitation: vous ne pouvez pas cloner une base de donn√©es dans laquelle les connexions actives restent. </font><font style="vertical-align: inherit;">√âtant donn√© que nous utilisons stage comme environnement statique (et non un environnement d'examen s√©par√©), nous devons cr√©er une deuxi√®me base de donn√©es et la convertir en mod√®le, en la mettant √† jour quotidiennement (par exemple, le matin). </font><font style="vertical-align: inherit;">Un petit CronJob a √©t√© pr√©par√© pour cela:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: batch/v1beta1<font></font>
kind: CronJob<font></font>
metadata:<font></font>
  name: update-postgres-template<font></font>
spec:<font></font>
  schedule: "50 4 * * *"<font></font>
  concurrencyPolicy: Forbid<font></font>
  successfulJobsHistoryLimit: 3<font></font>
  failedJobsHistoryLimit: 3<font></font>
  startingDeadlineSeconds: 600<font></font>
  jobTemplate:<font></font>
    spec:<font></font>
      template:<font></font>
        spec:<font></font>
          restartPolicy: Never<font></font>
          imagePullSecrets:<font></font>
          - name: registrysecret<font></font>
          volumes:<font></font>
          - name: postgres-scripts<font></font>
            configMap:<font></font>
              defaultMode: 0755<font></font>
              name: postgresql-configmap-update-cron<font></font>
          containers:<font></font>
          - name: cron<font></font>
            command: ["/docker-entrypoint-initdb.d/update-postgres-template.sh"]<font></font>
          image: private-registry/postgres <font></font>
            volumeMounts:<font></font>
            - name: postgres-scripts<font></font>
              mountPath: /docker-entrypoint-initdb.d/update-postgres-template.sh<font></font>
              subPath: update-postgres-template.sh<font></font>
            env:<font></font>
{{- include "postgres_env" . | indent 8 }}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le manifeste ConfigMap complet contenant le script n'a probablement pas beaucoup de sens (signalez-le dans les commentaires si ce n'est pas le cas). </font><font style="vertical-align: inherit;">Au lieu de cela, je vais donner la chose la plus importante - un script bash:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#!/bin/bash -x</span><font></font>
<font></font>
CREDENTIALS=<span class="hljs-string">"postgresql://<span class="hljs-variable">${POSTGRES_USER}</span>:<span class="hljs-variable">${POSTGRES_PASSWORD}</span>@<span class="hljs-variable">${POSTGRES_HOST}</span>/postgres"</span><font></font>
<font></font>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"REVOKE CONNECT ON DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span> FROM public"</span>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE pg_stat_activity.datname = '<span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span>'"</span><font></font>
<font></font>
curl --fail -vsL <span class="hljs-variable">${HOST_FORDEV}</span>/latest_<span class="hljs-variable">${POSTGRES_DB_STAGE}</span>.psql -o /tmp/<span class="hljs-variable">${POSTGRES_DB}</span>.psql<font></font>
<font></font>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"ALTER DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span> WITH is_template false allow_connections true;"</span>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"DROP DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span>;"</span> || <span class="hljs-literal">true</span>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"CREATE DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span>;"</span> || <span class="hljs-literal">true</span>
pg_restore -U <span class="hljs-variable">${POSTGRES_USER}</span> -h <span class="hljs-variable">${POSTGRES_HOST}</span> -w -j 4 -d <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span> /tmp/<span class="hljs-variable">${POSTGRES_DB}</span>.psql<font></font>
<font></font>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"ALTER DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span> WITH is_template true allow_connections false;"</span><font></font>
<font></font>
rm -v /tmp/<span class="hljs-variable">${POSTGRES_DB}</span>.psql</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez restaurer plusieurs bases de donn√©es √† la fois √† partir d'un mod√®le sans aucun conflit. </font><font style="vertical-align: inherit;">L'essentiel est que les connexions √† la base de donn√©es soient interdites et que la base de donn√©es elle-m√™me soit un mod√®le. </font><font style="vertical-align: inherit;">Cela se fait √† l'avant-derni√®re √©tape. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le manifeste contenant le script shell pour restaurer la base de donn√©es s'est av√©r√© comme ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: postgresql-configmap<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded<font></font>
data:<font></font>
  review-load-dump.sh: |<font></font>
    #!/bin/bash -x<font></font>
    <font></font>
 <font></font>
 <font></font>
    CREDENTIALS="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/postgres"<font></font>
<font></font>
    if [ "$( psql -d "${CREDENTIALS}" -tAc "SELECT CASE WHEN EXISTS (SELECT * FROM pg_stat_activity WHERE datname = '${POSTGRES_DB}' LIMIT 1) THEN 1 ELSE 0 END;" )" = '1' ]<font></font>
      then<font></font>
          echo "Open connections has been found in ${POSTGRES_DB} database, will drop them"<font></font>
          psql -d "${CREDENTIALS}" -c "SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE pg_stat_activity.datname = '${POSTGRES_DB}' -- AND pid &lt;&gt; pg_backend_pid();"<font></font>
      else<font></font>
          echo "No open connections has been found ${POSTGRES_DB} database, skipping this stage"<font></font>
    fi<font></font>
<font></font>
    psql -d "${CREDENTIALS}" -c "DROP DATABASE ${POSTGRES_DB}"<font></font>
<font></font>
    if [ "$( psql -d "${CREDENTIALS}" -tAc "SELECT 1 FROM pg_database WHERE datname='${POSTGRES_DB}'" )" = '1' ]<font></font>
      then<font></font>
          echo "Database ${POSTGRES_DB} still exists, delete review job failed"<font></font>
          exit 1<font></font>
      else<font></font>
          echo "Database ${POSTGRES_DB} does not exist, skipping"<font></font>
    fi<font></font>
<font></font>
<font></font>
    psql ${CREDENTIALS} -d postgres -c 'CREATE DATABASE ${POSTGRES_DB} TEMPLATE "loot-stage-copy"'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apparemment, ils sont impliqu√©s ici </font></font><code>hook-delete-policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Les d√©tails sur l'application de ces politiques sont √©crits </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans le manifeste donn√©, nous utilisons </font></font><code>before-hook-creation,hook-succeeded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce qui permet de remplir les conditions suivantes: supprimer l'objet pr√©c√©dent avant de cr√©er un nouveau hook et supprimer uniquement lorsque le hook a r√©ussi. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous supprimerons la base de donn√©es de ce ConfigMap:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: postgresql-configmap-on-delete<font></font>
  annotations:<font></font>
    "helm.sh/hook": "post-delete, pre-delete"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation<font></font>
data:<font></font>
  review-delete-db.sh: |<font></font>
    #!/bin/bash -e<font></font>
<font></font>
    CREDENTIALS="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/postgres"<font></font>
<font></font>
    psql -d "${CREDENTIALS}" -w postgres -c "DROP DATABASE ${POSTGRES_DB}"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que nous l'avons d√©plac√© vers une ConfigMap distincte, il peut √™tre plac√© dans une ConfigMap r√©guli√®re </font></font><code>command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Apr√®s tout, il peut √™tre fabriqu√© en un seul rev√™tement sans compliquer l'apparence du manifeste lui-m√™me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'option avec les mod√®les PostgreSQL pour une raison quelconque ne convient pas ou ne convient pas, vous pouvez revenir au </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chemin de r√©cup√©ration "standard"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mentionn√© ci-dessus en </font><b><font style="vertical-align: inherit;">utilisant la sauvegarde</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'algorithme sera trivial:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chaque nuit, une sauvegarde de la base de donn√©es est effectu√©e afin de pouvoir la t√©l√©charger depuis le r√©seau local du cluster.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Au moment de la cr√©ation de l'environnement de r√©vision, la base de donn√©es est charg√©e et restaur√©e √† partir du vidage.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lorsque le vidage est d√©ploy√©, toutes les autres actions sont effectu√©es.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, le script de r√©cup√©ration deviendra approximativement comme suit:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: postgresql-configmap<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded<font></font>
data:<font></font>
  review-load-dump.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    CREDENTIALS="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/postgres"<font></font>
    psql -d "${CREDENTIALS}" -w -c "DROP DATABASE ${POSTGRES_DB}" || true<font></font>
    psql -d "${CREDENTIALS}" -w -c "CREATE DATABASE ${POSTGRES_DB}"<font></font>
<font></font>
    curl --fail -vsL ${HOST_FORDEV}/latest_${POSTGRES_DB_STAGE}.psql -o /tmp/${POSTGRES_DB}.psql<font></font>
<font></font>
    psql psql -d "${CREDENTIALS}" -w -c "CREATE EXTENSION ip4r;"<font></font>
    pg_restore -U ${POSTGRES_USER} -h ${POSTGRES_HOST} -w -j 4 -d ${POSTGRES_DB} /tmp/${POSTGRES_DB}.psql<font></font>
    rm -v /tmp/${POSTGRES_DB}.psql</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La proc√©dure correspond √† ce qui a d√©j√† √©t√© d√©crit ci-dessus. Le seul changement est la suppression du fichier psql apr√®s que tout le travail a √©t√© ajout√©. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : √† la fois dans le script de r√©cup√©ration et dans le script de d√©sinstallation, la base de donn√©es est supprim√©e √† chaque fois. Ceci est fait pour √©viter d'√©ventuels conflits lors de la recr√©ation de la revue: vous devez vous assurer que la base de donn√©es est r√©ellement supprim√©e. En outre, ce probl√®me peut potentiellement √™tre r√©solu en ajoutant un indicateur </font></font><code>--clean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans l'utilitaire </font></font><code>pg_restore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais soyez prudent: cet indicateur efface uniquement les donn√©es des √©l√©ments qui se trouvent dans le vidage lui-m√™me, donc dans notre cas, cette option ne fonctionne pas.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, nous avons obtenu un m√©canisme de travail qui n√©cessite d'autres am√©liorations (jusqu'√† remplacer les scripts Bash par du code plus √©l√©gant). </font><font style="vertical-align: inherit;">Nous les laisserons en dehors du champ de l'article (bien que les commentaires sur le sujet, bien s√ªr, soient les bienvenus).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mongodb</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le composant suivant est MongoDB. </font><font style="vertical-align: inherit;">La principale difficult√© est que pour ce SGBD, l'option de copier la base de donn√©es (comme dans PostgreSQL) existe plut√¥t nominalement, car:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un √©tat d√©pr√©ci√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selon les r√©sultats de nos tests, nous n'avons pas trouv√© de grande diff√©rence dans le temps de r√©cup√©ration de la base de donn√©es par rapport √† l'habituel </font></font><code>mongo_restore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, je note que les tests ont √©t√© effectu√©s dans le cadre d'un projet - dans votre cas, les r√©sultats peuvent √™tre compl√®tement diff√©rents.</font></font></i></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que dans le cas d'un grand volume de base de donn√©es, un probl√®me grave peut survenir: nous gagnons du temps sur la restauration de la base de donn√©es dans PgSQL, mais en m√™me temps, nous restaurons le vidage dans Mongo pendant tr√®s longtemps. </font><font style="vertical-align: inherit;">Au moment de la r√©daction, et dans le cadre de l'infrastructure existante, nous avons vu trois fa√ßons (d'ailleurs, elles peuvent √™tre combin√©es):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La r√©cup√©ration peut prendre du temps, par exemple, si votre SGBD se trouve sur un syst√®me de fichiers r√©seau (pour les cas qui </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne sont pas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec un environnement de production). </font><font style="vertical-align: inherit;">Ensuite, vous pouvez simplement transf√©rer le SGBD de l'√©tape vers un n≈ìud distinct et utiliser le stockage local. </font><font style="vertical-align: inherit;">Comme il ne s'agit pas de production, la vitesse de cr√©ation d'une revue est plus critique pour nous.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez prendre chaque r√©cup√©ration de travail dans un module distinct, ce qui vous permet de pr√©-ex√©cuter les migrations et d'autres processus qui d√©pendent du fonctionnement du SGBD. </font><font style="vertical-align: inherit;">Nous gagnons donc du temps en les compl√©tant √† l'avance.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parfois, vous pouvez r√©duire la taille du vidage en supprimant les donn√©es anciennes / non pertinentes - au point qu'il suffit de ne laisser que la structure de la base de donn√©es. </font><font style="vertical-align: inherit;">Bien s√ªr, ce n'est pas pour les cas o√π un vidage complet est requis (par exemple, pour les t√¢ches de test d'assurance qualit√©).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous n'avez pas besoin de cr√©er rapidement des environnements de r√©vision, toutes les difficult√©s d√©crites peuvent √™tre ignor√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous, n'√©tant pas en mesure de copier la base de donn√©es de la m√™me mani√®re que PgSQL, irons dans le premier sens, c'est-√†-dire </font><font style="vertical-align: inherit;">r√©cup√©ration standard √† partir d'une sauvegarde. </font><font style="vertical-align: inherit;">L'algorithme est le m√™me qu'avec PgSQL. </font><font style="vertical-align: inherit;">C'est facile √† voir si vous regardez les manifestes:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: mongodb-scripts-on-delete<font></font>
  annotations:<font></font>
    "helm.sh/hook": "post-delete, pre-delete"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation<font></font>
data:<font></font>
  review-delete-db.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    mongo ${MONGODB_NAME} --eval "db.dropDatabase()" --host ${MONGODB_REPLICASET}/${MONGODB_HOST}<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: mongodb-scripts<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded<font></font>
data:<font></font>
  review-load-dump.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    curl --fail -vsL ${HOST_FORDEV}/latest_${MONGODB_NAME_STAGE}.gz -o /tmp/${MONGODB_NAME}.gz<font></font>
<font></font>
    mongo ${MONGODB_NAME} --eval "db.dropDatabase()" --host ${MONGODB_REPLICASET}/${MONGODB_HOST}<font></font>
    mongorestore --gzip --nsFrom "${MONGODB_NAME_STAGE}.*" --nsTo "${MONGODB_NAME}.*" --archive=/tmp/${MONGODB_NAME}.gz --host ${MONGODB_REPLICASET}/${MONGODB_HOST}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un d√©tail important ici. Dans notre cas, MongoDB est dans le cluster et vous devez vous assurer que la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connexion se produit toujours au n≈ìud principal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si vous sp√©cifiez, par exemple, le premier h√¥te du quorum, il peut, apr√®s un certain temps, basculer du principal au secondaire, ce qui emp√™chera la cr√©ation d'une base de donn√©es. Par cons√©quent, vous devez vous connecter non pas √† un h√¥te, mais imm√©diatement √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReplicaSet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en r√©pertoriant tous les h√¥tes qu'il </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">contient</font></a><font style="vertical-align: inherit;"> . Pour cette seule raison, vous devez faire de MongoDB un StatefulSet afin que les noms d'h√¥te soient toujours les m√™mes (sans mentionner que MongoDB est une application avec √©tat par nature). Dans cette option, vous √™tes assur√© de vous connecter au n≈ìud principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour MongoDB, nous supprimons √©galement la base de donn√©es avant de cr√©er la revue - cela se fait pour les m√™mes raisons que dans PostgreSQL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Derni√®re nuance: la base de donn√©es √† r√©viser se trouvant dans le m√™me environnement que la sc√®ne, un nom distinct est requis pour la base de donn√©es clon√©e. </font><font style="vertical-align: inherit;">Si le vidage n'est pas un fichier BSON, l'erreur suivante se produit:</font></font><br>
<br>
<pre><code class="plaintext hljs">the --db and --collection args should only be used when restoring from a BSON file. Other uses are deprecated and will not exist in the future; use --nsInclude instead</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, dans l'exemple ci-dessus, </font></font><code>--nsFrom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font><font style="vertical-align: inherit;">sont utilis√©s </font></font><code>--nsTo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'avons pas rencontr√© d'autres probl√®mes de r√©cup√©ration. </font><font style="vertical-align: inherit;">Au final, j'ajouterai seulement que la documentation de </font></font><code>copyDatabase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoDB est disponible </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - au cas o√π vous voudriez essayer cette option.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rabbitmq</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La derni√®re application sur notre liste d'exigences √©tait RabbitMQ. </font><font style="vertical-align: inherit;">C'est simple: vous devez cr√©er un nouveau vhost au nom de l'utilisateur avec lequel l'application se connectera. </font><font style="vertical-align: inherit;">Et puis supprimez-le. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manifeste pour cr√©er et supprimer des vhosts:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: rabbitmq-configmap<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded<font></font>
data:<font></font>
  rabbitmq-setup-vhost.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    /usr/local/bin/rabbitmqadmin -H ${RABBITMQ_HOST} -u ${RABBITMQ_USER} -p ${RABBITMQ_PASSWORD} declare vhost name=${RABBITMQ_VHOST}<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: rabbitmq-configmap-on-delete<font></font>
  annotations:<font></font>
    "helm.sh/hook": "post-delete, pre-delete"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation<font></font>
data:<font></font>
  rabbitmq-delete-vhost.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    /usr/local/bin/rabbitmqadmin -H ${RABBITMQ_HOST} -u ${RABBITMQ_USER} -p ${RABBITMQ_PASSWORD} delete vhost name=${RABBITMQ_VHOST}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec de grosses difficult√©s dans RabbitMQ nous (jusqu'√† pr√©sent?) N'avons pas rencontr√©. </font><font style="vertical-align: inherit;">En g√©n√©ral, la m√™me approche peut s'appliquer √† tous les autres services qui n'ont pas de lien critique pour les donn√©es.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©savantages</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi cette d√©cision ne pr√©tend-elle pas √™tre des ¬´meilleures pratiques¬ª?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il se r√©v√®le un seul point de d√©faillance sous la forme d'un environnement sc√©nique.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si une application dans un environnement de sc√®ne ne s'ex√©cute que dans une seule r√©plique, nous devenons encore plus d√©pendants de l'h√¥te sur lequel cette application s'ex√©cute. </font><font style="vertical-align: inherit;">En cons√©quence, avec une augmentation du nombre d'environnements d'examen, la charge sur le n≈ìud augmente proportionnellement sans la capacit√© d'√©quilibrer cette charge.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'a pas √©t√© possible de r√©soudre compl√®tement ces deux probl√®mes, compte tenu des capacit√©s de l'infrastructure d'un projet particulier, cependant, les dommages potentiels peuvent √™tre minimis√©s par le clustering (ajout de nouveaux n≈ìuds) et la mise √† l'√©chelle verticale. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au fur et √† mesure que l'application se d√©veloppe et avec l'augmentation du nombre de d√©veloppeurs, t√¥t ou tard, la charge sur les environnements de r√©vision augmente et de nouvelles exigences leur sont ajout√©es. Il est important que les d√©veloppeurs apportent les prochains changements de production le plus rapidement possible, mais pour ce faire, nous avons besoin d'environnements de r√©vision dynamiques qui rendent le d√©veloppement ¬´parall√®le¬ª. En cons√©quence, la charge sur l'infrastructure augmente et le temps de cr√©ation de tels environnements augmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article a √©t√© √©crit sur la base d'une exp√©rience r√©elle et plut√¥t sp√©cifique. Ce n'est que dans des cas exceptionnels que nous isolons des services dans des environnements statiques, et ici, il s'agissait sp√©cifiquement de lui. Une telle mesure n√©cessaire nous a permis d'acc√©l√©rer le d√©veloppement et le d√©bogage de l'application - gr√¢ce √† la possibilit√© de cr√©er rapidement des environnements de r√©vision √† partir de z√©ro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous avons commenc√© √† faire cette t√¢che, cela semblait tr√®s simple, mais en y travaillant, nous avons trouv√© de nombreuses nuances. </font><font style="vertical-align: inherit;">Ce sont eux qui ont √©t√© rassembl√©s dans l'article final: bien qu'ils ne soient pas universels, ils peuvent servir d'exemple pour la base / l'inspiration de leurs propres d√©cisions sur l'acc√©l√©ration des environnements de r√©vision.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lisez aussi dans notre blog:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trucs et astuces de Kubernetes: acc√©l√©rer le bootstrap des grandes bases de donn√©es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration sans obstacle de RabbitMQ vers Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration non obstru√©e de MongoDB vers Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diriger des √©quipes en train de fournir une nouvelle version d'application √† Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .¬ª</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr501412/index.html">Eye-tracking mobile sur PyTorch</a></li>
<li><a href="../fr501414/index.html">Configurer Debian, Nginx et Gunicorn pour un projet Django</a></li>
<li><a href="../fr501416/index.html">Un peu sur WebRTC: quoi utiliser et le cas de la pratique</a></li>
<li><a href="../fr501418/index.html">Semaine 4 Marathon: Motivation</a></li>
<li><a href="../fr501420/index.html">Mitapas et √©missions en ligne sur YouTube: semaine de diffusion du groupe JUG Ru</a></li>
<li><a href="../fr501426/index.html">Unison: configuration et automatisation de la synchronisation bidirectionnelle des r√©pertoires sur deux serveurs</a></li>
<li><a href="../fr501430/index.html">Excellent guide de conception et de planification de contenu de site Web</a></li>
<li><a href="../fr501432/index.html">Deux alternatives √† JDBC</a></li>
<li><a href="../fr501434/index.html">Semaine de la s√©curit√© 20: piratage d'un ordinateur via Thunderbolt</a></li>
<li><a href="../fr501436/index.html">Algorithme de reconnaissance des nombres sur l'image avec une faible probabilit√© du deuxi√®me type d'erreur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>