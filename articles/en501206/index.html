<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æüèΩ üé∑ üë∏üèΩ Briefly about where to put Repository in Onion Architeckture and DDD ü¶ñ üë©‚Äçüë¶‚Äçüë¶ ‚úäüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr. I want to talk about where, in the figure above, put the repository. A little more about DIP, IoC and project structure. There is a stand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Briefly about where to put Repository in Onion Architeckture and DDD</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501206/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/md/vn/g-mdvngslazcpacsfe-hx_pbk-q.png" width="400"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hello, Habr. I want to talk about where, in the figure above, put the repository. A little more about DIP, IoC and project structure. There is a standard approach according to which the IRepository interfaces must be interfered with in the domain layer to DomainServices and the implementation in Infrastructure. Here we are talking about standard Repositories which are just an abstract collection of objects that does not know about transactions and UnitOfWork and so on (for example, IList and its generic version are the typical interface of an abstract repository). I personally disagree with him because usually repositories are overgrown with behavior specific to a particular application, so I put their interfaces to ApplicationServices. The implementation of course remains in the Infrastructure layer. If you are interested, then welcome to cat.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Often many are confused by the old picture from Robert Martin: </font></font><br>
<img src="https://habrastorage.org/webt/7i/ju/xd/7ijuxdes-9r_6r-cmyrr_mx_cik.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He has the words in the article</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entities encapsulate Enterprise wide business rules. </font><font style="vertical-align: inherit;">An entity can be an object with methods, or it can be a set of data structures and functions. </font><font style="vertical-align: inherit;">It doesn't matter so long as the entities could be used by many different applications in the enterprise.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, it turns out that it simply assigns DomainServices to the Entities layer. </font><font style="vertical-align: inherit;">Well, UseCases == ApplicationServices. </font><font style="vertical-align: inherit;">Gateways == UserPepository, EmailService, Logger. </font><font style="vertical-align: inherit;">Read more </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serivice is any stateless class. </font><font style="vertical-align: inherit;">InfrastructureService is an anti-corruption laer that isolates you from the file system, the library for working with SMTP and, of course, from ORM or the library for working with the Database, etc.</font></font></li>
<li>Repository  .         .   List  Repository       T[]     ValueObject     Entities.      Repository  InfrastructureService    InfrastructureService   Repository. : Logger, EmailSender. </li>
<li>Repository     InfrastructureService    - EmailSender  EmailService, FileService (       File.Open(‚Ä¶ )  . .)     .</li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To understand where to place abstractions, we need to remember Dependency Inversion and Inversion of Control. </font><font style="vertical-align: inherit;">According to them, our ApplicationService can use Infrastructure, I don‚Äôt know what its implementation is in such ways as:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Define the interface that will implement the Infrastructure and interact with it.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Just accept delegates like Action and Func.</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Via interfaces:</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">interface</span> <span class="hljs-title">IRepository</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationService</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IRepository _repository;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApplicationService</span>(<span class="hljs-params">IRepository repository</span>)</span><font></font>
        {<font></font>
            _repository = repository;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetInt</span>(<span class="hljs-params"></span>)</span> =&gt; _repository.Get();<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Through delegates:</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationService</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Func&lt;<span class="hljs-keyword">int</span>&gt; _getIntFromDb;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApplicationService</span>(<span class="hljs-params">Func&lt;<span class="hljs-keyword">int</span>&gt; getIntFromDb</span>)</span><font></font>
        {<font></font>
            _getIntFromDb = getIntFromDb;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetInt</span>(<span class="hljs-params"></span>)</span> =&gt; _getIntFromDb();<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now about how to structure the code. </font><font style="vertical-align: inherit;">There are two cases to consider:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is divided into folders.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is divided into libraries. </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Details of the terminology can </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">be found here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Folders within the same application</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SnakeGame Code Example</font></font></a><br>
<img src="https://habrastorage.org/webt/5p/gr/ht/5pgrhtkhtbexrhodcuora6q9bni.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By libraries</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We put the InfrastructureServices (IRepository) interfaces in the ApplicationServices library, and the implementation (Repository) in the Infrastructure library. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fz/5z/vb/fz5zvbdvpvwqvwq9fmce7v07i0g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The final picture from an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article by a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> person with much more development experience than mine and who also thinks that IRepository should be placed in the Application Layer to ApplicationServices (the Repository implementations themselves also have Infrastructure).</font></font><br>
<img src="https://habrastorage.org/webt/cf/gk/2z/cfgk2zwfiypetfyh-utmgp1yimq.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">findings</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The infrastructure services interface (IRepository, IEmailSender) can be placed in the ApplicationServices.dll library, and their specific implementation (Repository, EMailSender) in the Infrastructure.dll library.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501194/index.html">In the wake of the hot particles. Wilson's Chamber</a></li>
<li><a href="../en501198/index.html">Understanding (all) ‚Äúmodular‚Äù JavaScript formats and tools</a></li>
<li><a href="../en501200/index.html">Discussion: 172 Tbit / s - a new record for data transmission speed for multicore optics</a></li>
<li><a href="../en501202/index.html">Universal event in Google Tag Manager</a></li>
<li><a href="../en501204/index.html">Money Games: PlaykeyPro Service Deployment Experience</a></li>
<li><a href="../en501208/index.html">"Up to 30 thousand": more than 10 reviews of audio systems</a></li>
<li><a href="../en501212/index.html">Realization of skeletal animation for three-dimensional models</a></li>
<li><a href="../en501214/index.html">Groupby aggregation in pandas</a></li>
<li><a href="../en501220/index.html">Parsing: can a company have too much money?</a></li>
<li><a href="../en501222/index.html">Application of COBIT when developing an IT strategy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>