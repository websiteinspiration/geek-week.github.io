<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙍🏾 👨🏿‍💼 ✍🏾 Cupedを使用したA / Bテストの感度の向上。Yandexでのレポート 🏄 😞 👨🏻‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CUPED（事前実験データを使用した制御実験）は、比較的最近生産で使用されているA / B実験手法です。以前に取得したデータを使用して、メトリックの感度を高めることができます。感度が高いほど、実験で微妙な変化に気づき、考慮することができます。CUPEDを最初に紹介した会社はマイクロソフトでした。現在...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cupedを使用したA / Bテストの感度の向上。Yandexでのレポート</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/497804/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CUPED（事前実験データを使用した制御実験）は、比較的最近生産で使用されているA / B実験手法です。</font><font style="vertical-align: inherit;">以前に取得したデータを使用して、メトリックの感度を高めることができます。</font><font style="vertical-align: inherit;">感度が高いほど、実験で微妙な変化に気づき、考慮することができます。</font><font style="vertical-align: inherit;">CUPEDを最初に紹介した会社はマイクロソフトでした。</font><font style="vertical-align: inherit;">現在、多くの国際企業がこの手法を使用しています。</font><font style="vertical-align: inherit;">彼の報告では、ヴァレリー・バブシキン</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">venheads</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CUPEDの意味と達成できる結果について説明し、その前に、感度を向上させる層化法を検討しました。</font></font><br>
<br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://youtu.be/pZpUM08mv-E</font></font></a></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-私の名前はValery Babushkinです。X5Retail Groupのモデリングとデータ分析のディレクターであり、Yandex.Marketのアドバイザーです。</font><font style="vertical-align: inherit;">私の自由な時間に、私は高等経済学院で教え、しばしばカザフスタンに飛んでいます、私はカザフスタン国立銀行で教えています。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、以前は競争の激しい機械学習を楽しんでいました。</font><font style="vertical-align: inherit;">Kaggleプラットフォームでは、コンペティショングランドマスターの称号と、世界で12万の23位を獲得しました。</font><font style="vertical-align: inherit;">Kaggleは非常にシンプルな方法で設計されています。実行しなければ、ランキングに落ちます。</font><font style="vertical-align: inherit;">だから、私はこれらの数字を見ないように、もうそこに行かないようにしています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eo/ex/zc/eoexzc-xqa0cfwpsbxkrqmfabjc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のプレゼンテーションには、層別化と制御変量の2つの段階があります。</font><font style="vertical-align: inherit;">ほとんどの場合、あなたはA / Bテストが何であるか、そしてなぜそれらが必要なのか知っています。</font><font style="vertical-align: inherit;">ただし、この式は省略しません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j9/ub/e1/j9ube1aeuee7fmscqqqbchgoqim.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A / Bテストでは、さまざまなアプローチがあります。原則として、これらは統計における2つの主要なアプローチです。それらの1つは周波数と呼ばれ、2つ目はベイジアンです。たとえば、いくつかの本では、エフロンでは、3番目のアプローチであるフィッシャーのアプローチが選択されていますが、それについても、ベイジアンアプローチについても触れません。周波数アプローチについて話しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
周波数アプローチには1つの単純な式があります。 2つありますが、1つは離散分布、もう1つは連続分布の場合を考慮しているため、これを1つの式と見なします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この式は、いくつの観測が必要かを示します。無限の量のデータを収集する余裕があれば、各分布の真の値を取得し、単純にそれらのポイント推定値を比較します。無数のデータのポイント推定値を比較することはできますが、これは問題ですが、それでもなおです。私たちは真の分布を得て、それらを比較し、どちらが良いかを言います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、これを行うことはできません。収集できるデータの量には常に制限があります。これは、ユーザーの数、このデータを収集できる時間、またはユーザーができるだけ早く結果を取得したいという事実が原因です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、nの非常に単純な式を示しています。nは、各グループで必要な観測数です。</font><font style="vertical-align: inherit;">分子内</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>z</mi><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.145ex" height="2.384ex" viewBox="0 -916.9 923.4 1026.6" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMATHI-7A" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMAIN-32" x="663" y="513"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>z</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">z^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どこ </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>z</mi><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.145ex" height="2.384ex" viewBox="0 -916.9 923.4 1026.6" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMATHI-7A" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMAIN-32" x="663" y="513"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>z</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-2">z^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-信頼区間。結果を出したい信頼度。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは明らかです</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>z</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.088ex" height="1.509ex" viewBox="0 -540.2 468.5 649.8" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMATHI-7A" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">z</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一度修正してそれ以上変更することはできません。</font><font style="vertical-align: inherit;">もちろん、結果の信頼度はゼロであり、観測値はゼロであると言えます。</font><font style="vertical-align: inherit;">それは非常に便利ですが、通常はそうではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに分子で、離散式を見ると、</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>p</mi><mo stretchy=&quot;false&quot;>&amp;#x005E;</mo></mover></mrow><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo>&amp;#x2212;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>p</mi><mo stretchy=&quot;false&quot;>&amp;#x005E;</mo></mover></mrow><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.62ex" height="2.634ex" viewBox="-38.5 -809.3 3711.5 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMATHI-70" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMAIN-5E" x="84" y="-6"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMAIN-28" x="585" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMAIN-31" x="974" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMAIN-2212" x="1697" y="0"></use><g transform="translate(2698,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMATHI-70" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMAIN-5E" x="84" y="-6"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/yandex/blog/497804/&amp;usg=ALkJrhgyJmY7gVB-udBmARlCJi6w6IozcA#MJMAIN-29" x="3283" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">\hat{p}(1-\hat{p})</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これは二項分布の分散に等しい。連続する場合には、同じことを、σ </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、分散です。そして、分散が大きいほど、より多くの観察が必要になるのは当然のようです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分母には​​m </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはエラーのマージンが</font><font style="vertical-align: inherit;">含まれてい</font><font style="vertical-align: inherit;">ます。これは、キャッチしたい最小の差であり、ここでは状況が逆になります。キャッチしたい差が小さいほど、必要な観測が多くなります。つまり、エラーのようなものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0.01の誤差が必要な場合、0.1の誤差が必要な場合よりも100倍多くの観測が必要です。それらは10倍異なりますが、2次依存性があり、100倍以上の観測が必要であることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
線形化についての報告がありました。今日はどのように分散を減らすことができるかを話し、やがてmを増やす方法を話しました。 mを半分に増やすと、計算に必要なデータ量が4分の1に減るため、mを増やす方が適切な戦略のようです。増加は私たちが作ることができるエラーを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、分散を半分に減らす場合、必要な観測は2倍です。したがって、分母で何かを4倍減らすことは、16倍のゲインであり、分子で4倍のゲインです-4だけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、各アプローチには長所と短所があります。その後、詳細を確認できます。次に、分散の減少に移ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
層別化。ちなみに、最後の各セクションでは、実際の環境で実際のデータを取得した実験結果を示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/au/vg/r7auvglpkmo9b1a84skfarfrcdc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、層別について話しましょう。私たちは何を知っていますか？分散を減らすと、観測数が減ることを知っています。分析に使用する目的のメトリックを、グループ化によっていくつかの地域に分類できるとします。すでに尋ねられている非常に良い質問：それを分割する方法？国によって？または多分ブラウザで？たぶんオペレーティングシステムに行く？ Mac、Windows、Linuxでログインするユーザーは、3つの異なるタイプのユーザーである可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループに分割できる値または記号が見つかった場合は、次のようにします。K個のグループに分割します。ここで、Kは、グループの数と等しい一意の数量の数です。オペレーティングシステムの場合-3つ、国-国の数など。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、各グループに分類される確率は、分母のすべての観測値の数と分子の各グループの観測値の数に等しくなります。つまり、おおよその重みを事前に見積もることができ、ユーザーの総数がある場合、多くのユーザーがMacから、非常に多くがWindowsから、非常に多くがLinuxから来ており、新しいユーザーの重みと確率がすぐに計算できます。このオペレーティングシステム。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、メトリックの層別化された平均は、非常に単純な式で表されます。これは、層内のメトリックの値に層の重みを掛けた値なので、すべての層を合計します。式は非常に明白です。具体的に分析する必要はないと思います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g2/_5/ky/g2_5kymmtfbgqokweutvqcdvkni.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、それはもう少し複雑になる可能性があります。これらの数式を解析するために数分を費やしますが、突然何かを理解できなくても、心配する必要はありません。一度に3時間かけて解析しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここには何が見えますか？層別メトリックの平均値は、ランダムサンプリングの平均値と同じです。これを証明することは難しくありません。それは単に加重バランスであり、最終的にはグループ全体の加重と等しくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、分散はもう少し興味深いです。実際、2つの量の分散である分散の合計は、それらの分散と、ある種の係数を持つ独立でない場合は共変量の合計です。そして、これらの分散の合計自体も係数を持ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、注意を払うと、これらの係数が提示されるのはまさにここです。これが層に入る確率です。したがって、層別化された全体の分散は、いくつかの重みを持つ各層の分散です。そして重量はこの層に入る確率です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、すべてがかなり合理的です。そして最終的に、層別化全体の分散はこの式に等しくなります。なぜ今理解できなくてもかまいません。主なことは覚えておくことです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n5/ms/zk/n5mszke6uzik-09q1cxjokosed4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ランダムサンプリングの平均と分散について説明します。 SRSは単純なランダムサンプリング、つまりランダムサンプリングです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご想像のとおり、ランダムサンプリングの平均値は平均値と同じです。ここでは、特に、何かに深く入り込む必要はないと思います。しかし、古典的な公式を見ると、ランダムサンプリングの分散は非常に明確です。 σこれは</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍の一方がNで割りました。標準誤差の公式を思い出すと、これはσをnの根で割ったものになります。これは平均の分散です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、私はそれをコンポーネントに分解したいと思います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/xg/g1/gpxgg1_ucnwmuaa6rxhk-ud1xww.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、それをコンポーネントに分解して、以下の単純な一連の計算を見ると、2つのメンバーで構成されていることがわかります（信じてください。これらすべての行を通過するわけではありませんが、ここではそれほど複雑ではありません）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g2/_5/ky/g2_5kymmtfbgqokweutvqcdvkni.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを覚えて。これは層別化の場合の分散です、私を信じてください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/xg/g1/gpxgg1_ucnwmuaa6rxhk-ud1xww.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ランダムサンプリングの分散を構成する要素に注意を払うと、2つのメンバーで構成されます。最初のメンバーは層別化の分散に等しく、2番目のメンバーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポイントは？簡単に考えると、ランダムサンプリングの分散は、層別グループ内および層別グループ間の分散の合計として表すことができます。 n個のグループがあり、グループ内にaの分散があり、bはグループ間の分散です。誰かが覚えている場合、それは分析とほぼ同じです。グループ内のばらつきとグループ間のばらつきがあります。論理的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最良の場合のランダムサンプリングの分散は、層別化の分散に等しいか、それ以上であることがわかります。どうして？この項がゼロに等しい場合（そして、正方形があり、確率が負になることはないため、ゼロ未満にすることはできません）、明らかにゼロ以上のものが存在します。ここでは、層別化で見たものと同じです。少なくともこのメンバーにとって、私たちは勝利し、分散を減らしていることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/3u/a8/du3ua8hb-zrby4bzwzclzmq3vec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは私が今言ったことと同じなので、スキップしましょう。しかし、あなたはおそらく私が話したことを理解することに興味を持つでしょう。ちなみに、各スライドの下部には、この公式が採用された記事の名前があります。このプレゼンテーションには3つの記事が含まれていたため、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を読むことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事を読んだり話したりしたのですが、あまり面白くありません。何かが実際の生活の中でどのように機能するかを見るのは興味深いです。これについて-次のスライド。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j9/nr/oe/j9nroey8dwylvveixhdprv-qrxq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はデータを取り、それが実際の生活でどのように機能するかを見始めました。実生活では、私の差異は1パーセントも下がっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大量のデータがあり、一般的には層の間の分散がそれほど大きくないという理由だけで、成長が非常に小さいという疑いがあります。彼らはすでに平準化されており、かなり代表的です。しかし、データが不十分であるか、サンプルに何らかの違反があるか、または完全にランダムではない場合（偶発的に非常に頻繁に発生します）、増加が大きくなる可能性があるようです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、このメソッドは実装が非常に簡単です。注意してください、複雑なことは何もありません。つまり、サンプル全体でこの層に入る確率に比例する量を各層からサンプリングします。すべてがかなり合理的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のパートに移りましょう。カップ状。正確な発音方法が正確にわかりません。実際、これらは共変量であり、実験データを使用しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/ul/q8/gpulq8fgy0dm9s60p9dtfsnmegg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポイントも非常にシンプルです。変数Xに実験的な影響がないという意味で、Yとは無関係にランダムな変数Xを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを達成する方法は？最も簡単な方法は、実験の開始前に取得された変数Xを取得することです。次に、実験がそれに影響を与えなかったことを確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遠く。 YとθXの差として計算する新しいメトリックを導入できます。これは式で表されます。新しいメトリック（Ycupedと呼びましょう）は、目的のメトリックからθ×Xを引いた</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ものです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これについては既に説明しました。 2つの量の差の分散を計算できる単純な式。これは、最初の大きさの分散です。これには1の係数1 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2があるため</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、削除します。さらに、2番目の量の係数は、Xの分散であるθ2です。ただし、これは減算なので、YとXの間の共分散である2θを減算します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらが独立した量である場合、それはどうなりますか？ゼロ。独立した数量間の共分散はゼロです。私たちが独立した価値観をとれば、それは間違いなく私たちと一緒に良くならないでしょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/5d/ea/xr5deaqpxv_odszbaqpcrwdbqvm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、依存する量を取得する必要があります。ハイパーパラメータがもう1つあります。これをθと呼びます。いつ分散を最小化できますか？ θがYとXの間の共分散をXの分散で割った値に等しい場合。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/ul/q8/gpulq8fgy0dm9s60p9dtfsnmegg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがそうである理由を詳しく説明することはしませんが、この単純な方程式を見れば、推論することもできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/5d/ea/xr5deaqpxv_odszbaqpcrwdbqvm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うと、非常に便利な単純な変換が得られ、結果の分散は分散Yとして表され、1からメトリックYとメトリックXの間の2乗の相関を引いたものとして乗算されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜこれが機能するのですか？ 2つの要因または2つの理由により、メトリックYの分散があると仮定します。これは、いくつかの共変量Xとその他すべてによるものです。できるよね？そして、私たちは言う：みんな、Xのために持っているものを削除し、他のすべての理由のためにそれだけを残します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kb/y2/im/kby2imem4c2a-jjpeeza9fd2bug.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のスライドのグラフから、これが機能する理由が明らかになります。これが機能する理由について何か考えはありますか？私が書いた式に加えて、その前に、式もありました。うまくいかないことがわかりました。結局のところ、最終的な結果は見ていません。また、機能しないことも判明しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A / Bテストを実行するとき、まず何に興味がありますか？違いは平均です。ほとんどの場合、分位点は確認しません。ちなみに、Uberは四分位数を見ることが非常に好きですが、四分位数を見ることが非常に重要な場合もありますが、平均値は変更されないままで、分位数は劇的に変化する可能性があり、99％の分位数を増やしたユーザーは落ちます。 Uberにはこの待ち時間があります。これはホステスのメモです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、平均の違いに関心があることがよくあります。そして、この平均の違いを変えない方法を使いたいのです。なぜなら線形化について話しているのであれば、新しい属性空間に移動しているからです。はい、すべてがクールです。いくつかのA / Bテストを64倍速くカウントできます。はい、それは比例しますが、平均のこの違いが実際にどれほど同じであるかは言えません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
平均の違いを計算し、すべてについて結論を出すには、すべてのグループで均一なθが必要です。グループは、A1、A2、B、Cなどです。これらは、A / Bテストのテストセルまたはバリエーションです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メトリックXの選択方法は？メトリックXの論理的な選択は同じメトリックYですが、実験期間の前の期間です。たとえば、これがユーザーの平均セッション継続時間である場合、ある期間の実験前のユーザーセッションの平均継続時間を計算し、実験中に、一方を他方から差し引き、それらの間の偏差のみを確認できます。おそらくもっと興味があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、ところで、興味深い質問が発生します-メトリックXをどの期間にとるべきですか？ 1日で、1週間で、2週間で？理論的な答えはありませんが、実際的な答えは、2週間がプラスまたはマイナスの最適値であることを示しています。原則として、Xの所要時間に応じて、分散がどの程度減少し、テストの収束が速くなるかに関する実験データを取得してプロットすることが可能</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mx/d4/s1/mxd4s15egumju8ajecevajeenj0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">なぜ機能するのですか？見てください、これは非常に単純なグラフ、非常に単純な画像です。 XとYの値、実験の前と後の期間におけるユーザーのメトリックの値を示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何してるの？ θを選択します。同様に、最小二乗法を使用してそれを選択できます。つまり、これは特定の中間線であり、残高の最小量を示します。残りは何であるかと何が線上にあるかの違いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、何らかの方法で平均化し、それでもメトリックの平均値を取得しようとしています。メトリックの平均値は変化しません。私自身は今私が言ったことを完全に理解していなかったように思われます、そして私はすでにこれを見たのであなたはおそらくもっと難しくしなければなりませんでした。もう一度やってみましょう。 X軸とY軸があります。X軸には実験前の値をマークし、Y軸には実験中の対応する値をマークできます。つまり、XY座標の特定のポイントを取得します。チャートにマークを付けることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変化がなければ、これらの点は私たちと一致します。これが二等分になります。 XはYと等しいためです。しかし、実際にはこれは起こりません。同意しますか？場合によっては、メトリックYの値が大きくなり、場合によっては小さくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはこの違いを正確に理解して取得したいと考えています。他のすべてが私たちにとってそれほど興味深いものではないためです。たとえば、違いがない場合、実験を行ったところ、XとYが等しくなりました。これは、実験が影響を与えなかった可能性が高いことを意味します。実験を行って、YがどこでもこのXの上に安定しているだけであることがわかった場合、これは何かに影響を与えた可能性があると考える機会です。 Xの下に安定したYがある場合も、あまり良くありません。おそらく、私たちは悪影響を及ぼしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XとYの関係を表す特定の線を引いて、この差を最小限に抑えようとしていることがわかりました。線形回帰も行われます。 1つの独立変数と1つの従属変数の線形回帰があることに同意してください。できるだけ正確に説明したい。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが私たちの線であり、これが新しいカップメトリックです。これが、平均カップ値が変化しない理由です。 Ycuped値は、平均のY値から変化しません。どうして？なぜなら。これをすぐに説明する必要がありました。 :)ちなみに、元の記事はそう言っています：θの検索と回帰の間には非常に興味深い関連があることに注意してください。これだよ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しますが、実験自体がユーザーの行動にどのように影響したか、基本的な実験と比較してどれだけ変化したかを確認することに関心があります。常に実施され、2人のユーザーがいるとします。1人は常に10分のセッションを持ち、もう1人は100分のセッションを持ちました。若干の変更があり、最初のユーザーは100分を費やし、2番目のユーザーは12分を費やしています。一方の場合の違いはゼロで、もう一方の場合-2です。しかし、単純に12と100を比較するだけでは、あまり合理的ではありません。別が欲しい。これを「正規化」と呼びます。もちろん、これは正しくありませんが、それでもなおです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、実験に移りましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x-/ql/to/x-qltoyiccbmqo-3xinmgnie1nw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が見える？これは私が本当に嫌いなJupyterラップトップのスクリーンショットです（私はPyCharmが大好きです）が、それでも私はそれをしました。カップ型メトリックの分散と標準メトリックの分散はすでにここに示されています。それらがどれだけ異なるか見てください。 Ycupedははるかに小さく、平均も同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より正確には、それらは違いません。小数点以下15桁のどこかで、それらはおそらく異なりますが、これは丸めに関連するエラーであると想定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここには何が見えますか？分散は45％減少しました。これはオンラインからのデータです。 X5で観察されたのは、分散が4倍に低下することです。 X5では、ストア内にある種の動作があります。これは、曜日、時間、時間、曜日の平均です。参照してください、より相関のある共変量を選択できます。月曜日に来た条件付きの人数は次の月曜日に来た人の数と相関しているようです。少し深く見ると、月曜日の夕方6時は、月曜日の夕方6時にさらに強く相関しているはずです。そして日曜日、午後に3つ、別の日曜日に午後に3つ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際に見た分散の最大の低下は19倍でした。プラスとは何ですか？これを行うことも非常に簡単です。まったく考える必要がないことを認めなければなりません。共変量が見つかり、θが見つかりました。ちなみに、θは非常に単純な公式に従って求められ、すべてがすでに行われています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/5d/ea/xr5deaqpxv_odszbaqpcrwdbqvm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
取り、差し引いて、変換されたメトリックを得ました。彼女の平均は変わっていません、これはとても良いです。通常の言語でビジネスに説明することは、なぜこれが起こるのか、可能です。私たちはユーザーの平均的な行動だけでなく、ユーザーの行動が平均からどのように変化したかに関心があると言っています。以上です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
場合によっては、正しい共変量を選択するのが難しいこともありますが、多くの場合、これは問題ではありません。前の実験期間の値を取ることは常に可能です（非常にまれですが、不可能です）。できます。分散が19分の1に減少するとは、A / Bテストに必要なデータの量も19分の1に減少することを意味します。つまり、結果をより早く取得でき、テストの感度が向上します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに特定の数のA / Bテストがある場合は、これを同じ遡及的な方法で実行し、第1種と第2種のエラーを計算できます。 AAテストを実行すると、第1種のエラーをカウントできます。 cupedでは、同じ方法で使用します。同じ方法で、感度がどれだけ向上したかを評価できます。</font></font><br>
<br>
<hr><sub><sup><a name="articles"></a>*  :<br>
— <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Improving the Sensitivity of Online Controlled Experiments by Utilizing Pre-Experiment Data</a><br>
— <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Improving the Sensitivity of Online Controlled Experiments: Case Studies at Netflix</a><br>
— <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">How Booking.com increases the power of online experiments with CUPED</a></sup></sub></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja497790/index.html">DINS QA EVENING：Postmanとテストカバレッジの評価方法について話し合う</a></li>
<li><a href="../ja497792/index.html">初心者の株式投資家のツール：テストアクセス、開始関税、取引端末</a></li>
<li><a href="../ja497794/index.html">ロシアのBIシステムの評価基準</a></li>
<li><a href="../ja497796/index.html">分離とパスタの傾向は、ソバよりも人気があります。エイプリルフールのクエストはIT担当者向けです</a></li>
<li><a href="../ja497800/index.html">裁判所の助けを借りずにオンラインで海賊行為および偽造品と戦う</a></li>
<li><a href="../ja497806/index.html">OSCPのレンタル方法</a></li>
<li><a href="../ja497808/index.html">3Dは自分で行います。パート2：それは3次元です</a></li>
<li><a href="../ja497810/index.html">PVS Studio.VS。GCC 10の統計分析。独立したミニテスト</a></li>
<li><a href="../ja497812/index.html">MITの科学者は、夢を少なくとも部分的に制御できるデバイスを開発しています</a></li>
<li><a href="../ja497814/index.html">不可避を受け入れる5つの段階、または自動プロファイリングのプログラムの開発方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>