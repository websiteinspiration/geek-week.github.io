<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒœ ğŸ”’ ğŸ§”ğŸ» CrÃ©ation de liaisons Python pour les bibliothÃ¨ques C / C ++ Ã  l'aide de SIP. Partie 1 ğŸ± ğŸ“‡ ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parfois, en travaillant sur un projet en Python, on souhaite utiliser une bibliothÃ¨que qui n'est pas Ã©crite en Python, mais, par exemple, en C ou C ++...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CrÃ©ation de liaisons Python pour les bibliothÃ¨ques C / C ++ Ã  l'aide de SIP. Partie 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495480/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parfois, en travaillant sur un projet en Python, on souhaite utiliser une bibliothÃ¨que qui n'est pas Ã©crite en Python, mais, par exemple, en C ou C ++. Les raisons peuvent Ãªtre diffÃ©rentes. PremiÃ¨rement, Python est un langage merveilleux, mais dans certaines situations, il n'est pas assez rapide. Et si vous voyez que les performances sont limitÃ©es par les fonctionnalitÃ©s du langage Python, alors il est logique d'Ã©crire une partie du programme dans un autre langage (dans cet article, nous parlerons de C et C ++), d'organiser cette partie du programme en tant que bibliothÃ¨que, de crÃ©er des liaisons Python (liaisons Python) par dessus et utiliser le module ainsi obtenu comme une bibliothÃ¨que Python normale. DeuxiÃ¨mement, une situation se produit souvent lorsque vous savez qu'il existe une bibliothÃ¨que qui rÃ©sout le problÃ¨me requis, mais, malheureusement, cette bibliothÃ¨que n'est pas Ã©crite en Python, mais dans le mÃªme C ou C ++.Dans ce cas, nous pouvons Ã©galement crÃ©er une liaison Python sur la bibliothÃ¨que et l'utiliser sans penser au fait que la bibliothÃ¨que n'a pas Ã©tÃ© Ã©crite Ã  l'origine en Python.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe diffÃ©rents outils pour crÃ©er des liaisons Python, allant de celles de niveau infÃ©rieur comme l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Python / C</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã  celles de niveau supÃ©rieur comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWIG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'avais pas pour objectif de comparer diffÃ©rentes faÃ§ons de crÃ©er des liaisons Python, mais je voudrais parler des bases de l'utilisation d'un seul outil, Ã  savoir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Initialement, SIP a Ã©tÃ© conÃ§u pour crÃ©er une liaison autour de la bibliothÃ¨que Qt - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyQt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et est Ã©galement utilisÃ© pour dÃ©velopper d'autres grandes bibliothÃ¨ques Python, par exemple, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wxPython</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, gcc sera utilisÃ© comme compilateur pour C, et g ++ sera utilisÃ© comme compilateur C ++. </font><font style="vertical-align: inherit;">Tous les exemples ont Ã©tÃ© testÃ©s sous Arch Linux et Python 3.8. </font><font style="vertical-align: inherit;">Afin de ne pas compliquer les exemples, le sujet de la compilation pour diffÃ©rents systÃ¨mes d'exploitation et l'utilisation de diffÃ©rents compilateurs (par exemple, Visual Studio) n'est pas inclus dans la portÃ©e de cet article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez tÃ©lÃ©charger tous les exemples de cet article depuis le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rÃ©fÃ©rentiel sur github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le rÃ©fÃ©rentiel avec les sources SIP est situÃ© sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.riverbankcomputing.com/hg/sip/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mercurial est utilisÃ© comme systÃ¨me de contrÃ´le de version pour SIP.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Faire une liaison sur une bibliothÃ¨que en C</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã‰crire une bibliothÃ¨que en C</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet exemple se trouve dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la source, mais dans cet article, nous supposerons que nous faisons tout Ã  partir de zÃ©ro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CommenÃ§ons par un exemple simple. </font><font style="vertical-align: inherit;">Tout d'abord, nous allons crÃ©er une bibliothÃ¨que C simple, que nous exÃ©cuterons ensuite Ã  partir d'un script Python. </font><font style="vertical-align: inherit;">Que notre bibliothÃ¨que soit la seule fonction</font></font><br>
<br>
<pre><code class="plaintext hljs">int foo(char*);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
qui prendra une chaÃ®ne et retournera sa longueur multipliÃ©e par 2. Le </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fichier d'en-tÃªte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut ressembler, par exemple, Ã  ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">#ifndef FOO_LIB<font></font>
#define FOO_LIB<font></font>
<font></font>
int foo(char* str);<font></font>
<font></font>
#endif<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le fichier avec l'implÃ©mentation de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">#include &lt;string.h&gt;<font></font>
<font></font>
#include "foo.h"<font></font>
<font></font>
int foo(char* str) {<font></font>
	return strlen(str) * 2;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tester la fonctionnalitÃ© de la bibliothÃ¨que, nous allons Ã©crire un simple programme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">#include &lt;stdio.h&gt;<font></font>
<font></font>
#include "foo.h"<font></font>
<font></font>
int main(int argc, char* argv[]) {<font></font>
	char* str = "0123456789";<font></font>
	printf("%d\n", foo(str));<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus de prÃ©cision, crÃ©ez un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">CC=gcc<font></font>
CFLAGS=-c<font></font>
DIR_OUT=bin<font></font>
<font></font>
all: main<font></font>
<font></font>
main: main.o libfoo.a<font></font>
	$(CC) $(DIR_OUT)/main.o -L$(DIR_OUT) -lfoo -o $(DIR_OUT)/main<font></font>
<font></font>
main.o: makedir main.c<font></font>
	$(CC) $(CFLAGS) main.c -o $(DIR_OUT)/main.o<font></font>
<font></font>
libfoo.a: makedir foo.c<font></font>
	$(CC) $(CFLAGS) foo.c -o $(DIR_OUT)/foo.o<font></font>
	ar rcs $(DIR_OUT)/libfoo.a $(DIR_OUT)/foo.o<font></font>
<font></font>
makedir:<font></font>
	mkdir -p $(DIR_OUT)<font></font>
<font></font>
clean:<font></font>
	rm -rf $(DIR_OUT)/*<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laissez toutes les sources de la bibliothÃ¨que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se </font><i><font style="vertical-align: inherit;">trouver</font></i><font style="vertical-align: inherit;"> dans un sous-dossier de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le dossier source:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â””â”€â”€ Makefile</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et compilons les sources en utilisant la commande</font></font><br>
<br>
<pre><code class="bash hljs">make
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant la compilation, le texte sera affichÃ©.</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p bin<font></font>
gcc -c main.c -o bin/main.o<font></font>
gcc -c foo.c -o bin/foo.o<font></font>
ar rcs bin/libfoo.a bin/foo.o<font></font>
gcc bin/main.o -Lbin -lfoo -o bin/main<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le rÃ©sultat de la compilation sera placÃ© dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã  l'intÃ©rieur du dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ bin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”‚ â”œâ”€â”€ foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”‚ â”œâ”€â”€ libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”‚ â”œâ”€â”€ principal</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”‚ â””â”€â”€ main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    â””â”€â”€ Makefile</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons compilÃ© une bibliothÃ¨que de liens statiques et un programme qui l'utilise sous le nom </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">AprÃ¨s la compilation, vous pouvez vÃ©rifier que le programme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dÃ©marre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faisons une liaison Python sur la bibliothÃ¨que foo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bases SIP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez d'abord installer SIP. </font><font style="vertical-align: inherit;">Cela se fait de maniÃ¨re standard, comme avec toutes les autres bibliothÃ¨ques utilisant pip:</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user sip
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sÃ»r, si vous travaillez dans un environnement virtuel, le paramÃ¨tre --user, indiquant que la bibliothÃ¨que SIP doit Ãªtre installÃ©e dans le dossier utilisateur et non globalement dans le systÃ¨me, ne doit pas Ãªtre spÃ©cifiÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que devons-nous faire pour que la bibliothÃ¨que foo puisse Ãªtre appelÃ©e Ã  partir du code Python? Au minimum, vous devez crÃ©er deux fichiers: l'un au format TOML et nommez-le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et le second est un fichier avec l'extension .sip. Traitons chacun d'eux sÃ©quentiellement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons nous mettre d'accord sur la structure de la source. A l' </font><font style="vertical-align: inherit;">intÃ©rieur du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dossier est le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dossier </font><font style="vertical-align: inherit;">, qui contient la source pour la bibliothÃ¨que. AprÃ¨s la compilation </font><font style="vertical-align: inherit;">, le dossier </font><i><font style="vertical-align: inherit;">bin</font></i><font style="vertical-align: inherit;"> est crÃ©Ã© </font><font style="vertical-align: inherit;">dans le </font><font style="vertical-align: inherit;">dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui contiendra tous les fichiers compilÃ©s. </font><font style="vertical-align: inherit;">Plus tard, nous ajouterons la possibilitÃ© pour l'utilisateur de spÃ©cifier les chemins d'accÃ¨s aux fichiers d'en-tÃªte et d'objet de la bibliothÃ¨que via la ligne de commande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les fichiers requis pour SIP seront situÃ©s dans le mÃªme dossier que le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pyproject.toml</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'est pas une invention des dÃ©veloppeurs SIP, mais le format de description de projet Python dÃ©crit dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 517 Â«Un format indÃ©pendant du systÃ¨me de construction pour les arborescences sourcesÂ»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 518 Â«SpÃ©cification des exigences minimales du systÃ¨me de construction pour les projets PythonÂ»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il s'agit d'un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier TOML</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui peut Ãªtre considÃ©rÃ© comme une version plus avancÃ©e du format ini, dans lequel les paramÃ¨tres sont stockÃ©s sous la forme de "clÃ© = valeur", et les paramÃ¨tres peuvent Ãªtre localisÃ©s non seulement dans des sections comme [foo], appelÃ©es tables en termes TOML, mais et dans les sous-sections du formulaire [foo.bar.spam]. Les paramÃ¨tres peuvent contenir non seulement des chaÃ®nes, mais Ã©galement des listes, des nombres et des valeurs boolÃ©ennes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce fichier est censÃ© dÃ©crire tout ce qui est nÃ©cessaire pour construire un package Python, et pas nÃ©cessairement en utilisant SIP. </font><font style="vertical-align: inherit;">Cependant, comme nous le verrons un peu plus tard, dans certains cas, ce fichier ne sera pas suffisant, et en plus il faudra crÃ©er un petit script Python. </font><font style="vertical-align: inherit;">Mais parlons de tout dans l'ordre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une description complÃ¨te de tous les paramÃ¨tres possibles du fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> liÃ©s Ã  SIP se trouve sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page de documentation SIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour notre exemple, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crÃ©ez le</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fichier </font><i><font style="vertical-align: inherit;">pyproject.toml</font></i><font style="vertical-align: inherit;"> au mÃªme niveau que le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ bin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ principal</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contenu de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera le suivant:</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.1"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
include-dirs = ["foo"]<font></font>
library-dirs = ["foo/bin"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La section </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[build-system]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Â«tableÂ» en termes TOML) est standard et est dÃ©crite dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 518</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il contient deux paramÃ¨tres:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requiert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - une liste des packages nÃ©cessaires pour construire notre package. </font><font style="vertical-align: inherit;">Le format de description de la dÃ©pendance du package est dÃ©crit dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spÃ©cification de dÃ©pendance PEP 508 pour les packages logiciels Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans ce cas, nous n'avons besoin que de la version 5.x du package SIP.</font></font></li>
<li><i>build-backend</i> ,        .  ,          Python-,    .        ,   ,    SIP,     Â«sipbuild.apiÂ».</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'autres paramÃ¨tres sont dÃ©crits dans les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sections [tool.sip. *]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La section </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip.metadata]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient des informations gÃ©nÃ©rales sur le paquet: le nom du paquet Ã  construire (notre paquet s'appellera </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais ne confondez pas ce nom avec le nom du module, que nous importerons plus tard dans Python), le numÃ©ro de version du paquet (dans notre cas numÃ©ro de version Â«0.1Â») et licence (par exemple, Â« </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Â»). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus important du point de vue de l'assemblage est dÃ©crit dans les [tool.sip.bindings. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez le nom du package dans l'en-tÃªte de section. </font><font style="vertical-align: inherit;">Nous avons ajoutÃ© deux paramÃ¨tres Ã  cette section:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">headers</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - une liste des fichiers d'en-tÃªte nÃ©cessaires pour utiliser la bibliothÃ¨que foo.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bibliothÃ¨ques</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - une liste de fichiers objets compilÃ©s pour la liaison statique.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le chemin oÃ¹ chercher des fichiers d' en- </font><font style="vertical-align: inherit;">tÃªte supplÃ©mentaires en </font><font style="vertical-align: inherit;">plus de </font><font style="vertical-align: inherit;">ceux qui sont attachÃ©s au compilateur C. Dans ce cas, oÃ¹ chercher le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fichier </font><font style="vertical-align: inherit;">.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bibliothÃ¨que-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le chemin oÃ¹ rechercher des fichiers objets supplÃ©mentaires en plus de ceux qui sont attachÃ©s au compilateur C. Dans ce cas, il s'agit du dossier dans lequel le fichier de bibliothÃ¨que compilÃ© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo est crÃ©Ã©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc crÃ©Ã© le premier fichier nÃ©cessaire pour SIP. </font><font style="vertical-align: inherit;">Nous passons maintenant Ã  la crÃ©ation du prochain fichier qui dÃ©crira le contenu du futur module Python.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pyfoo.sip</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CrÃ©ez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le mÃªme dossier que le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ bin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ principal</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ pyfoo.sip</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un fichier avec l'extension .sip dÃ©crit l'interface de la bibliothÃ¨que source, qui sera convertie en module en Python. </font><font style="vertical-align: inherit;">Ce fichier a son propre format, que nous allons maintenant considÃ©rer, et ressemble au fichier d'en-tÃªte C / C ++ avec un balisage supplÃ©mentaire, ce qui devrait aider SIP Ã  crÃ©er un module Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre exemple, ce fichier doit s'appeler </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car auparavant, dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous avons crÃ©Ã© le [tool.sip.bindings. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]. Dans le cas gÃ©nÃ©ral, il peut y avoir plusieurs partitions de ce type et, par consÃ©quent, il doit y avoir plusieurs fichiers * .sip. Mais si nous avons plusieurs fichiers SIP, alors c'est un cas particulier du point de vue de SIP, et nous ne le considÃ©rerons pas dans cet article. Veuillez noter que dans le cas gÃ©nÃ©ral, le nom du fichier .sip (et, par consÃ©quent, le nom de la section) peut ne pas coÃ¯ncider avec le nom du package spÃ©cifiÃ© dans le paramÃ¨tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la section </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip.metadata]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ConsidÃ©rez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de notre exemple:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foo, language=<span class="hljs-string">"C"</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*)</span></span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les lignes qui commencent par le caractÃ¨re "%" sont appelÃ©es directives. Ils devraient indiquer Ã  SIP comment assembler et styliser correctement le module Python. Une liste complÃ¨te des directives est dÃ©crite sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette page de documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Certaines directives ont des paramÃ¨tres supplÃ©mentaires. Les paramÃ¨tres peuvent ne pas Ãªtre requis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, nous utilisons deux directives; nous dÃ©couvrirons d'autres directives dans les exemples suivants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commence par la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module (name = foo, language = â€œCâ€)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Veuillez noter que </font><font style="vertical-align: inherit;">nous avons spÃ©cifiÃ© la </font><font style="vertical-align: inherit;">valeur du premier paramÃ¨tre ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) sans guillemets, et la valeur du deuxiÃ¨me paramÃ¨tre ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">langue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) avec des guillemets, comme des chaÃ®nes en C / C ++. </font><font style="vertical-align: inherit;">Il s'agit d'une exigence de cette directive, comme dÃ©crit dans la documentation de la directive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">seul le paramÃ¨tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est requis </font><font style="vertical-align: inherit;">, ce qui dÃ©finit le nom du module Python Ã  partir duquel nous importerons la fonction de bibliothÃ¨que. </font><font style="vertical-align: inherit;">Dans ce cas, le module s'appelle </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il contiendra la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donc aprÃ¨s assemblage et installation nous l'importerons en utilisant le code:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pourrions rendre ce module imbriquÃ© dans un autre module en remplaÃ§ant cette ligne, par exemple, par ceci:</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foo.bar, language=<span class="hljs-string">"C"</span>)<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, importez la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo devrait</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ãªtre comme suit:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> foo.bar <span class="hljs-keyword">import</span> foo
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le paramÃ¨tre </font><font style="vertical-align: inherit;">de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">langue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Module</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique la langue dans laquelle la bibliothÃ¨que source est Ã©crite. </font><font style="vertical-align: inherit;">La valeur de ce paramÃ¨tre peut Ãªtre Â«CÂ» ou Â«C ++Â». </font><font style="vertical-align: inherit;">Si ce paramÃ¨tre n'est pas spÃ©cifiÃ©, SIP supposera que la bibliothÃ¨que est Ã©crite en C ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardez maintenant la derniÃ¨re ligne du fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*)</span></span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une description de l'interface de la fonction de la bibliothÃ¨que que nous voulons mettre dans le module Python. </font><font style="vertical-align: inherit;">Sur la base de cette dÃ©claration, sip crÃ©era une fonction Python. </font><font style="vertical-align: inherit;">Je pense que tout devrait Ãªtre clair ici.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous collectons et vÃ©rifions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, tout est prÃªt pour construire un paquet Python avec une liaison pour une bibliothÃ¨que C. Tout d'abord, vous devez construire la bibliothÃ¨que elle-mÃªme. </font><font style="vertical-align: inherit;">AccÃ©dez au </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dossier pyfoo_c_01 / foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et dÃ©marrez la gÃ©nÃ©ration Ã  l'aide de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande make</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">$ make<font></font>
<font></font>
mkdir -p bin<font></font>
gcc -c main.c -o bin/main.o<font></font>
gcc -c foo.c -o bin/foo.o<font></font>
ar rcs bin/libfoo.a bin/foo.o<font></font>
gcc bin/main.o -Lbin -lfoo -o bin/main<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tout s'est bien passÃ©, le </font><font style="vertical-align: inherit;">dossier </font><i><font style="vertical-align: inherit;">bin</font></i><font style="vertical-align: inherit;"> sera crÃ©Ã© </font><font style="vertical-align: inherit;">Ã  l'intÃ©rieur du </font><font style="vertical-align: inherit;">dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans lequel, entre autres fichiers, il y aura une bibliothÃ¨que </font><i><font style="vertical-align: inherit;">libfoo.a</font></i><font style="vertical-align: inherit;"> compilÃ©e </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Permettez-moi de vous rappeler qu'ici, afin de ne pas Ãªtre distrait du sujet principal, nous ne parlons que de construire sous Linux en utilisant gcc. </font><font style="vertical-align: inherit;">
Retournez dans le dossier </font><i><font style="vertical-align: inherit;">pyfoo_c_01</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est maintenant temps de dÃ©couvrir les Ã©quipes SIP. </font><font style="vertical-align: inherit;">AprÃ¨s l'installation de SIP, les commandes de ligne de commande suivantes seront disponibles ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">page de documentation</font></a><font style="vertical-align: inherit;"> ):</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">CrÃ©e un fichier objet d'extension Python.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">CrÃ©e un fichier objet d'extension Python et l'installe.</font></font></li>
<li><i>sip-sdist</i>.      .tar.gz,      pip.</li>
<li><i>sip-wheel</i>.     wheel (   .whl).</li>
<li><i>sip-module</i>.  ,      ,   SIP.  ,    ,    .         ,       standalone project,      ,     ,     ,    .</li>
<li><i>sip-distinfo</i>.     <i>.dist-info</i>,       wheel.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces commandes doivent Ãªtre exÃ©cutÃ©es Ã  partir du dossier oÃ¹ se trouve le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, pour mieux comprendre le fonctionnement de SIP, exÃ©cutez la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , avec l'option </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--verbose</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour une sortie plus dÃ©taillÃ©e sur la console, et voyez ce qui se passe pendant le processus de construction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build --verbose</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ces liaisons seront construites: pyfoo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GÃ©nÃ©ration des liaisons pyfoo ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compilation du module 'foo' ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
construction de l'extension 'foo' </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
crÃ©ation de build </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
crÃ©ation de build / temp.linux-x86_64-3.8</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non-result-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c sipfoocmodule.c -o build / temp.linux-x86_64-3.8 / sipfoocmodule.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule.c: Dans la fonction </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
func_foo </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">sipfoocmodule .c: 29: 22: avertissement: dÃ©claration de fonction implicite Â«fooÂ» [-Wimplicit-function-declaration] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 29 | sipRes = foo (a0); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non-result-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c array.c -o build / temp.linux-x86_64-3.8 / array.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno -used-result -Wsign -comparer -DNDEBUG -g -fwrapv -O3 -Mur -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fno-sÃ©mantique-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c bool.cpp -o build / temp.linux-x86_64-3.8 / bool.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non-result-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c objmap.c -o build / temp.linux-x86_64-3.8 / objmap.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non-result-result -Wsign -comparer -DNDEBUG -g -fwrapv -O3 -Mur -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fno-sÃ©mantique-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c qtlib.c -o build / temp.linux-x86_64-3.8 / qtlib.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non-result-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c int_convertors.c -o build / temp.linux-x86_64-3.8 / int_convertors.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non utilisÃ©-rÃ©sultat -Wsign -comparer -DNDEBUG -g -fwrapv -O3 -Mur -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fno-sÃ©mantique-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c voidptr.c -o build / temp.linux-x86_64-3.8 / voidptr.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non-result-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c apiversions.c -o build / temp.linux-x86_64-3.8 / apiversions.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non-result-result -Wsign -comparer -DNDEBUG -g -fwrapv -O3 -Mur -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fno-sÃ©mantique-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c descriptors.c -o build / temp.linux-x86_64-3.8 / descriptors.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-non-result-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune = generic -O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c threads.c -o build / temp.linux-x86_64-3.8 / </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
threads.o gcc -pthread -Wno-non utilisÃ©-result -Wsign -comparer -DNDEBUG -g -fwrapv -O3 -Mur -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fno-sÃ©mantique-interposition -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -march = x86-64 -mtune = gÃ©nÃ©rique -O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I. -I ../../ foo -I / usr / include / python3.8 -c siplib.c -o build / temp.linux-x86_64-3.8 / siplib.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: Dans la fonction "slot_richcompare": </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 9536: 16: avertissement: "st" peut Ãªtre utilisÃ© sans initialisation dans cette fonction [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9536 | slot = findSlotInClass (ctd, st); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~~~~~~~~~~~~~~~~~~~~~~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 10671: 19: remarque: "st" a Ã©tÃ© dÃ©clarÃ© ici </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10671 | sipPySlotType st; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: Dans la fonction "parsePass2": </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 5625: 32: avertissement: "propriÃ©taire" peut Ãªtre utilisÃ© sans initialisation dans cette fonction [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 5625 | * propriÃ©taire = arg; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ~~~~~~~ ^ ~</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
g ++ -pthread -shared -Wl, -O1, - sort-common, - as-needed, -z, relro, -z, now -fno-semantic-interposition -Wl, -O1, - sort-common, --as-needed, -z, relro, -z, now build / temp.linux-x86_64-3.8 / sipfoocmodule.o build / temp.linux-x86_64-3.8 / array.o build / temp.linux-x86_64-3.8 /bool.o build / temp.linux-x86_64-3.8 / objmap.o build / temp.linux-x86_64-3.8 / qtlib.o build / temp.linux-x86_64-3.8 / int_convertors.o build / temp.linux-x86_64 -3.8 / voidptr.o build / temp.linux-x86_64-3.8 / apiversions.o build / temp.linux-x86_64-3.8 / descriptors.o build / temp.linux-x86_64-3.8 / threads.o build / temp.linux -x86_64-3.8 / siplib.o -L ../../ foo / bin -L / usr / lib -lfoo -o / home / jenyay / projects / soft / sip-examples / pyfoo_c_01 / build / foo / foo. cpython-38-x86_64-linux-gnu.so </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet a Ã©tÃ© construit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'entrerons pas en profondeur dans le travail de SIP, mais il ressort de la sortie que certaines sources sont en train de compiler. </font><font style="vertical-align: inherit;">Ces sources peuvent Ãªtre vues dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crÃ©Ã© par cette commande </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ construire</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ apiversions.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ array.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ array.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ bool.cpp</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ construire</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ temp.linux-x86_64-3.8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ apiversions.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ array.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ bool.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ descriptors.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ int_convertors.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ objmap.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ qtlib.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ sipfoocmodule.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ siplib.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ threads.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ voidptr.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ descriptors.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.cpython-38-x86_64-linux-gnu.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ int_convertors.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ objmap.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ qtlib.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ sipAPIfoo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ sipfoocmodule.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ sip.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ sipint.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ siplib.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ threads.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ voidptr.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ bin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â”œâ”€â”€ principal</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”‚ â””â”€â”€ main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â”œâ”€â”€ main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”‚ â””â”€â”€ Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â”œâ”€â”€ pyfoo.sip</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â””â”€â”€ pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des sources auxiliaires sont apparues </font><font style="vertical-align: inherit;">
dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par curiositÃ©, regardons le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipfoocmodule.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car il concerne directement le module </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui sera crÃ©Ã©:</font></font><br>
<br>
<pre><code class="plaintext hljs">/*<font></font>
 * Module code.<font></font>
 *<font></font>
 * Generated by SIP 5.1.1<font></font>
 */<font></font>
<font></font>
#include "sipAPIfoo.h"<font></font>
<font></font>
/* Define the strings used by this module. */<font></font>
const char sipStrings_foo[] = {<font></font>
    'f', 'o', 'o', 0,<font></font>
};<font></font>
<font></font>
PyDoc_STRVAR(doc_foo, "foo(str) -&gt; int");<font></font>
<font></font>
static PyObject *func_foo(PyObject *sipSelf,PyObject *sipArgs)<font></font>
{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        char* a0;<font></font>
<font></font>
        if (sipParseArgs(&amp;sipParseErr, sipArgs, "s", &amp;a0))<font></font>
        {<font></font>
            int sipRes;<font></font>
<font></font>
            sipRes = foo(a0);<font></font>
<font></font>
            return PyLong_FromLong(sipRes);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    /* Raise an exception if the arguments couldn't be parsed. */<font></font>
    sipNoFunction(sipParseErr, sipName_foo, doc_foo);<font></font>
<font></font>
    return SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
/* This defines this module. */<font></font>
sipExportedModuleDef sipModuleAPI_foo = {<font></font>
    0,<font></font>
    SIP_ABI_MINOR_VERSION,<font></font>
    sipNameNr_foo,<font></font>
    0,<font></font>
    sipStrings_foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    {SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR,<font></font>
            SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR},<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR<font></font>
};<font></font>
<font></font>
/* The SIP API and the APIs of any imported modules. */<font></font>
const sipAPIDef *sipAPI_foo;<font></font>
<font></font>
/* The Python module initialisation function. */<font></font>
#if defined(SIP_STATIC_MODULE)<font></font>
PyObject *PyInit_foo(void)<font></font>
#else<font></font>
PyMODINIT_FUNC PyInit_foo(void)<font></font>
#endif<font></font>
{<font></font>
    static PyMethodDef sip_methods[] = {<font></font>
        {sipName_foo, func_foo, METH_VARARGS, doc_foo},<font></font>
        {SIP_NULLPTR, SIP_NULLPTR, 0, SIP_NULLPTR}<font></font>
    };<font></font>
<font></font>
    static PyModuleDef sip_module_def = {<font></font>
        PyModuleDef_HEAD_INIT,<font></font>
        "foo",<font></font>
        SIP_NULLPTR,<font></font>
        -1,<font></font>
        sip_methods,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR<font></font>
    };<font></font>
<font></font>
    PyObject *sipModule, *sipModuleDict;<font></font>
    /* Initialise the module and get it's dictionary. */<font></font>
    if ((sipModule = PyModule_Create(&amp;sip_module_def)) == SIP_NULLPTR)<font></font>
        return SIP_NULLPTR;<font></font>
<font></font>
    sipModuleDict = PyModule_GetDict(sipModule);<font></font>
<font></font>
    if ((sipAPI_foo = sip_init_library(sipModuleDict)) == SIP_NULLPTR)<font></font>
        return SIP_NULLPTR;<font></font>
<font></font>
    /* Export the module and publish it's API. */<font></font>
    if (sipExportModule(&amp;sipModuleAPI_foo, SIP_ABI_MAJOR_VERSION, SIP_ABI_MINOR_VERSION, 0) &lt; 0)<font></font>
    {<font></font>
        Py_DECREF(sipModule);<font></font>
        return SIP_NULLPTR;<font></font>
    }<font></font>
    /* Initialise the module now all its dependencies have been set up. */<font></font>
    if (sipInitModule(&amp;sipModuleAPI_foo,sipModuleDict) &lt; 0)<font></font>
    {<font></font>
        Py_DECREF(sipModule);<font></font>
        return SIP_NULLPTR;<font></font>
    }<font></font>
<font></font>
    return sipModule;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez travaillÃ© avec l'API Python / C, vous verrez des fonctions familiÃ¨res. Portez une attention particuliÃ¨re Ã  la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">func_foo Ã </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir de la ligne 18. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ la suite de la compilation de ces sources, le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo / foo.cpython-38-x86_64-linux-gnu.so</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera crÃ©Ã© </font><font style="vertical-align: inherit;">et contient l'extension Python, qui doit encore Ãªtre installÃ©e correctement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de compiler l'extension et de l'installer immÃ©diatement, vous pouvez utiliser la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais nous ne l'utilisons pas, car par dÃ©faut, il essaie d'installer l'extension Python crÃ©Ã©e globalement dans le systÃ¨me. Cette commande a un paramÃ¨tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--target-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, avec lequel vous pouvez spÃ©cifier le chemin oÃ¹ vous souhaitez installer l'extension, mais nous ferons mieux d'utiliser d'autres outils qui crÃ©ent des packages, qui peuvent ensuite Ãªtre installÃ©s Ã  l'aide de pip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, utilisez la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande sip-sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Son utilisation est trÃ¨s simple:</font></font><br>
<br>
<pre><code class="bash hljs">$ sip-sdist<font></font>
<font></font>
The sdist has been built.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s cela, le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo-0.1.tar.gz</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera crÃ©Ã© </font><font style="vertical-align: inherit;">, qui peut Ãªtre installÃ© Ã  l'aide de la commande:</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user pyfoo-0.1.tar.gz
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consÃ©quence, les informations suivantes seront affichÃ©es et le package sera installÃ©:</font></font><br>
<br>
<pre><code class="plaintext hljs">Processing ./pyfoo-0.1.tar.gz<font></font>
  Installing build dependencies ... done<font></font>
  Getting requirements to build wheel ... done<font></font>
    Preparing wheel metadata ... done<font></font>
Building wheels for collected packages: pyfoo<font></font>
  Building wheel for pyfoo (PEP 517) ... done<font></font>
  Created wheel for pyfoo: filename=pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl size=337289 sha256=762fc578...<font></font>
  Stored in directory: /home/jenyay/.cache/pip/wheels/54/dc/d8/cc534fff...<font></font>
Successfully built pyfoo<font></font>
Installing collected packages: pyfoo<font></font>
  Attempting uninstall: pyfoo<font></font>
    Found existing installation: pyfoo 0.1<font></font>
    Uninstalling pyfoo-0.1:<font></font>
      Successfully uninstalled pyfoo-0.1<font></font>
Successfully installed pyfoo-0.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assurons-nous que nous avons rÃ©ussi Ã  crÃ©er une liaison Python. </font><font style="vertical-align: inherit;">Nous dÃ©marrons Python et essayons d'appeler la fonction. </font><font style="vertical-align: inherit;">Permettez-moi de vous rappeler que selon nos paramÃ¨tres, le paquet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient le module </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui a la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">b'123456'</span>)
<span class="hljs-number">12</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter qu'en tant que paramÃ¨tre de la fonction, nous transmettons non seulement une chaÃ®ne, mais une chaÃ®ne d'octets b'123456 '- un analogue direct de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en C. Un peu plus tard, nous ajouterons la conversion de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et vice versa. Le rÃ©sultat Ã©tait attendu. Permettez-moi de vous rappeler que la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renvoie la double taille d'un tableau de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui lui est passÃ©e en paramÃ¨tre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons de passer une </font><font style="vertical-align: inherit;">chaÃ®ne Python rÃ©guliÃ¨re </font><font style="vertical-align: inherit;">Ã  la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au lieu d'une liste d'octets.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">'123456'</span>)<font></font>
<font></font>
Traceback (most recent call last):<font></font>
  File <span class="hljs-string">"&lt;stdin&gt;"</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<font></font>
TypeError: foo(str): argument <span class="hljs-number">1</span> has unexpected type <span class="hljs-string">'str'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La liaison crÃ©Ã©e n'a pas pu convertir la chaÃ®ne en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; nous verrons comment lui apprendre comment procÃ©der dans la section suivante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FÃ©licitations, nous avons crÃ©Ã© la premiÃ¨re liaison sur une bibliothÃ¨que Ã©crite en C. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quittez l'interprÃ©teur Python et assemblez l'assemblage au format roue. Comme vous le savez sans doute, wheel est un format de package relativement nouveau qui a Ã©tÃ© utilisÃ© universellement rÃ©cemment. Le format est dÃ©crit dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 427, Â«The Wheel Binary Package Format 1.0Â»,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mais une description des caractÃ©ristiques du format de roue est un sujet digne d'un grand article sÃ©parÃ©. Il est important pour nous que l'utilisateur puisse facilement installer le package au format roue Ã  l'aide de pip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un package au format roue n'est pas plus compliquÃ© qu'un package au format sdist. Pour ce faire, dans le dossier contenant le fichier</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit exÃ©cuter la commande</font></font><br>
<br>
<pre><code class="bash hljs">sip-wheel
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s avoir exÃ©cutÃ© cette commande, le processus de gÃ©nÃ©ration sera affichÃ© et il peut y avoir des avertissements du compilateur: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$ sip-wheel </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces liaisons seront construites: pyfoo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GÃ©nÃ©ration des liaisons pyfoo ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compilation du module 'foo' ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule.c: Dans la fonction </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
func_foo: sipfoocmodule.c: 29:22: avertissement: dÃ©claration de fonction implicite de la fonction foo [-Wimplicit-function-declaration] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 29 | sipRes = foo (a0); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: Dans la fonction "slot_richcompare": </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 9536: 16: avertissement: "st" peut Ãªtre utilisÃ© sans initialisation dans cette fonction [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9536 | slot = findSlotInClass (ctd, st); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~~~~~~~~~~~~~~~~~~~~~~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 10671: 19: remarque: "st" a Ã©tÃ© dÃ©clarÃ© ici</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10671 | sipPySlotType st; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: Dans la fonction "parsePass2": </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c: 5625: 32: avertissement: "propriÃ©taire" peut Ãªtre utilisÃ© sans initialisation dans cette fonction [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 5625 | * propriÃ©taire = arg; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ~~~~~~~ ^ ~ ~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La roue a Ã©tÃ© construite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque l'assemblage est terminÃ© (notre petit projet se compile rapidement), un fichier avec le nom </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou similaire </font><font style="vertical-align: inherit;">apparaÃ®tra dans le dossier du projet </font><font style="vertical-align: inherit;">. Le nom du fichier gÃ©nÃ©rÃ© peut diffÃ©rer selon votre systÃ¨me d'exploitation et la version de Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous pouvons installer ce package en utilisant pip:</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--upgrade</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est utilisÃ©e </font><i><font style="vertical-align: inherit;">ici</font></i><font style="vertical-align: inherit;"> afin que pip remplace le module pyfoo installÃ© prÃ©cÃ©demment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, le module </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le paquet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peuvent Ãªtre utilisÃ©s, comme indiquÃ© ci-dessus.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajouter des rÃ¨gles de conversion Ã  char *</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la section prÃ©cÃ©dente, nous avons rencontrÃ© un problÃ¨me selon lequel la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne </font><font style="vertical-align: inherit;">peut accepter qu'un ensemble d'octets, mais pas de chaÃ®nes. Nous allons maintenant corriger cette lacune. Pour ce faire, nous utiliserons un autre outil SIP - les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">annotations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les annotations sont utilisÃ©es dans les fichiers .sip et sont appliquÃ©es Ã  certains Ã©lÃ©ments de code: fonctions, classes, arguments de fonction, exceptions, variables, etc. Les annotations sont Ã©crites entre des barres obliques: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ annotation /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une annotation peut fonctionner comme un indicateur, qui peut Ãªtre dans l'Ã©tat dÃ©fini ou non dÃ©fini, par exemple: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ ReleaseGIL /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou certaines annotations doivent Ãªtre affectÃ©es Ã  certaines valeurs, par exemple: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Encoding = "UTF-8" /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si plusieurs annotations doivent Ãªtre appliquÃ©es Ã  un objet, elles sont sÃ©parÃ©es par des virgules dans des barres obliques: / annotation_1, annotation_2 /. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'exemple suivant, qui se trouve dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_02</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ajoutez une </font><font style="vertical-align: inherit;">fonction de paramÃ¨tre d'annotation de </font><font style="vertical-align: inherit;">fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">%Module(name=foo, language="C")<font></font>
<font></font>
int foo(char* /Encoding="UTF-8"/);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique dans quel encodage la chaÃ®ne Ã  passer Ã  la fonction doit Ãªtre encodÃ©e. Les valeurs de cette annotation peuvent Ãªtre: ASCII, Latin-1, UTF-8 ou None. Si l'annotation d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encodage</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'est </font><font style="vertical-align: inherit;">pas spÃ©cifiÃ©e ou Ã©gale Ã  </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">None</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le paramÃ¨tre d'une telle fonction n'est soumis Ã  aucun encodage et est transmis Ã  la fonction telle quelle, mais dans ce cas, le paramÃ¨tre en code Python doit Ãªtre de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">octets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-Ã -dire un tableau d'octets, comme nous l'avons vu dans l'exemple prÃ©cÃ©dent. Si le codage est spÃ©cifiÃ©, ce paramÃ¨tre peut Ãªtre une chaÃ®ne (tapez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en Python). </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation d' </font><i><font style="vertical-align: inherit;">encodage</font></i><font style="vertical-align: inherit;"> ne peut Ãªtre appliquÃ©e qu'aux paramÃ¨tres de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VÃ©rifions comment la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonction </font><font style="vertical-align: inherit;">du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le module </font><font style="vertical-align: inherit;">fonctionne maintenant </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour ce faire, comme prÃ©cÃ©demment, vous devez d'abord compiler la bibliothÃ¨que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font><font style="vertical-align: inherit;">appelant </font><font style="vertical-align: inherit;">la commande </font><i><font style="vertical-align: inherit;">make</font></i><font style="vertical-align: inherit;"> dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis </font><font style="vertical-align: inherit;">appeler la commande, par exemple, </font><i><font style="vertical-align: inherit;">sip-wheel, Ã </font></i><font style="vertical-align: inherit;"> partir du dossier d'exemple </font><i><font style="vertical-align: inherit;">pyfoo_c_02</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le fichier </font><i><font style="vertical-align: inherit;">pyfoo-0.2-cp38-cp38-manylinux1_x86_64.whl</font></i><font style="vertical-align: inherit;"> ou avec un nom similaire </font><font style="vertical-align: inherit;">sera crÃ©Ã© </font><font style="vertical-align: inherit;">, qui peut Ãªtre dÃ©fini Ã  l'aide de la commande:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.2-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tout s'est bien passÃ©, dÃ©marrez l'interprÃ©teur Python et essayez d'appeler la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec un argument de chaÃ®ne:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">b'qwerty'</span>)
<span class="hljs-number">12</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">'qwerty'</span>)
<span class="hljs-number">12</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">''</span>)
<span class="hljs-number">24</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous nous assurons que l'utilisation d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">octets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est toujours possible. AprÃ¨s cela, nous nous assurons que maintenant nous pouvons Ã©galement passer </font><font style="vertical-align: inherit;">des arguments de chaÃ®ne </font><font style="vertical-align: inherit;">Ã  la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Notez que la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour un argument de chaÃ®ne avec des lettres russes a renvoyÃ© une valeur deux fois plus grande que pour une chaÃ®ne contenant uniquement des lettres latines. Cela est arrivÃ© parce que la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne compte pas la longueur de la chaÃ®ne en caractÃ¨res (et la double), mais la longueur du tableau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et comme en UTF-8, le codage des lettres russes occupe 2 octets, puis la taille du tableau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aprÃ¨s la conversion de Les chaÃ®nes Python se sont avÃ©rÃ©es Ãªtre deux fois plus longues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien! Nous avons rÃ©solu le problÃ¨me avec l'argument de fonction</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais que se passe-t-il si nous avons des dizaines ou des centaines de ces fonctions dans notre bibliothÃ¨que, devrez-vous spÃ©cifier l'encodage des paramÃ¨tres pour chacune d'entre elles? Souvent, l'encodage utilisÃ© dans un programme est le mÃªme, et il n'y a aucune raison pour que diffÃ©rentes fonctions indiquent des encodages diffÃ©rents. Dans ce cas, il est possible de spÃ©cifier un encodage par dÃ©faut dans SIP, et si pour une fonction un encodage est nÃ©cessaire pour un autre, alors il peut Ãªtre redÃ©fini en utilisant l'annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour dÃ©finir l'encodage des paramÃ¨tres de fonction par dÃ©faut, la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">utilisÃ©e</font></i><font style="vertical-align: inherit;"> . Son utilisation est illustrÃ©e dans l'exemple situÃ© dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de profiter de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , changez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, son contenu est maintenant le suivant:</font></font><br>
<br>
<pre><code class="plaintext hljs">%Module(name=foo, language="C")<font></font>
%DefaultEncoding "UTF-8"<font></font>
<font></font>
int foo(char*);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, si l'argument est une fonction de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font><font style="vertical-align: inherit;">S'il </font><font style="vertical-align: inherit;">n'y a pas d'annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors l'encodage est tirÃ© de la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et si ce n'est pas le cas, alors la conversion n'est pas effectuÃ©e, et pour tous les paramÃ¨tres </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font><font style="vertical-align: inherit;">il faut transfÃ©rer non pas des lignes, mais des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">octets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple du dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03 est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectÃ© et vÃ©rifiÃ© de la mÃªme maniÃ¨re qu'un exemple du dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_02</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En bref sur project.py. </font><font style="vertical-align: inherit;">Automatisez l'assemblage</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'Ã  prÃ©sent, nous avons utilisÃ© deux fichiers utilitaires pour crÃ©er une liaison Python - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous allons maintenant nous familiariser avec un autre de ces fichiers, qui devrait s'appeler </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Avec ce script, nous pouvons influencer le processus de construction de notre package. Faisons l'automatisation de la construction. Afin de collecter les exemples </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des sections prÃ©cÃ©dentes, vous deviez d'abord aller dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y compiler Ã  l'aide de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande make</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , retourner dans le dossier oÃ¹ se trouve le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puis commencer Ã  construire le package Ã  l'aide de l'un des commandes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip- *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, notre objectif est de nous assurer que lors de l'exÃ©cution des commandes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l'assemblage de la bibliothÃ¨que C </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est dÃ©marrÃ© en premier </font><font style="vertical-align: inherit;">, puis la commande elle-mÃªme est dÃ©jÃ  lancÃ©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple crÃ©Ã© dans cette section se trouve dans le dossier </font><font style="vertical-align: inherit;">source </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour modifier le processus de gÃ©nÃ©ration, nous pouvons </font><font style="vertical-align: inherit;">dÃ©clarer une classe </font><font style="vertical-align: inherit;">dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (le nom de fichier doit Ãªtre juste celui) qui est dÃ©rivÃ©e de la classe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette classe possÃ¨de des mÃ©thodes que nous pouvons remplacer par nous-mÃªmes. </font><font style="vertical-align: inherit;">Actuellement, nous nous intÃ©ressons aux mÃ©thodes suivantes:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">construire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">AppelÃ© lors de l'appel Ã  la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">AppelÃ© lorsque la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande sip-sdist est appelÃ©e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">AppelÃ© lorsque la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP-Wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est appelÃ©e </font><font style="vertical-align: inherit;">.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">installer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">AppelÃ© lorsque la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est invoquÃ©e </font><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, nous pouvons redÃ©finir le comportement de ces commandes. </font><font style="vertical-align: inherit;">Ã€ strictement parler, les mÃ©thodes rÃ©pertoriÃ©es sont dÃ©clarÃ©es dans la classe abstraite </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.AbstractProject</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Ã  partir de laquelle la classe dÃ©rivÃ©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est crÃ©Ã©e </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CrÃ©ez un fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le contenu suivant:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> subprocess<font></font>
<font></font>
<span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_build_foo</span>(<span class="hljs-params">self</span>):</span>
        cwd = os.path.abspath(<span class="hljs-string">'foo'</span>)<font></font>
        subprocess.run([<span class="hljs-string">'make'</span>], cwd=cwd, capture_output=<span class="hljs-literal">True</span>, check=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_sdist</span>(<span class="hljs-params">self, sdist_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_sdist(sdist_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_wheel</span>(<span class="hljs-params">self, wheel_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_wheel(wheel_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().install()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons dÃ©clarÃ© la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dÃ©rivÃ©e de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et y </font><i><font style="vertical-align: inherit;">avons dÃ©fini les </font></i><i><font style="vertical-align: inherit;">mÃ©thodes </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans toutes ces mÃ©thodes, nous appelons les mÃ©thodes du mÃªme nom Ã  partir de la classe de base, avant d'appeler la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_build_foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui dÃ©marre l'exÃ©cution de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande make</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que les </font><i><font style="vertical-align: inherit;">mÃ©thodes </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doivent renvoyer le nom du fichier qu'elles ont crÃ©Ã©. Ceci n'est pas Ã©crit dans la documentation, mais est indiquÃ© dans les sources SIP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous n'avons pas besoin d'exÃ©cuter la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande make</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manuellement pour construire la bibliothÃ¨que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cela se fera automatiquement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous </font><font style="vertical-align: inherit;">exÃ©cutez </font><font style="vertical-align: inherit;">maintenant </font><font style="vertical-align: inherit;">la commande </font><i><font style="vertical-align: inherit;">sip-wheel</font></i><font style="vertical-align: inherit;"> dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un fichier est crÃ©Ã© avec le nom pyfoo-0.4-cp38-cp38-manylinux1_x86_64.whl ou similaire selon votre systÃ¨me d'exploitation et la version de Python. </font><font style="vertical-align: inherit;">
Ce package peut Ãªtre installÃ© Ã  l'aide de la commande:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.4-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s cela, vous pouvez vous assurer que la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonction </font><font style="vertical-align: inherit;">du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le module </font><font style="vertical-align: inherit;">fonctionne toujours.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajouter des options de ligne de commande Ã  construire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exemple suivant se trouve dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le package a un numÃ©ro de version de 0,5 (voir les paramÃ¨tres dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Cet exemple est basÃ© sur un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple de la documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec quelques corrections. Dans cet exemple, nous allons refaire notre fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et ajouter de nouvelles options de ligne de commande pour la build. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans nos exemples, nous construisons une bibliothÃ¨que trÃ¨s simple </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et dans les projets rÃ©els, la bibliothÃ¨que peut Ãªtre assez volumineuse et il ne sera alors pas judicieux de l'inclure dans le code source du projet de liaison Python. Permettez-moi de vous rappeler que SIP a Ã©tÃ© crÃ©Ã© Ã  l'origine pour crÃ©er une liaison pour une bibliothÃ¨que aussi Ã©norme que Qt. Vous pouvez, bien sÃ»r, affirmer que les sous-modules de git peuvent aider Ã  organiser la source, mais ce n'est pas le but. Supposons que la bibliothÃ¨que ne se trouve pas dans le dossier avec la source de liaison. Dans ce cas, la question se pose: oÃ¹ le collecteur SIP doit-il rechercher l'en-tÃªte de bibliothÃ¨que et les fichiers objets? Dans ce cas, diffÃ©rents utilisateurs peuvent avoir leurs propres faÃ§ons de placer la bibliothÃ¨que. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour rÃ©soudre ce problÃ¨me, nous allons ajouter deux nouvelles options de ligne de commande au systÃ¨me de construction, avec lesquelles vous pouvez spÃ©cifier le chemin d'accÃ¨s au fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (paramÃ¨tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo-include-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et au fichier objet de la bibliothÃ¨que (paramÃ¨tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo-library-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). De plus, nous supposerons que si ces paramÃ¨tres ne sont pas spÃ©cifiÃ©s, la bibliothÃ¨que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est toujours localisÃ©e avec les sources de liaison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons recrÃ©er le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et y dÃ©clarer une classe dÃ©rivÃ©e de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Examinons d'abord la nouvelle version du fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis </font><font style="vertical-align: inherit;">voyons </font><font style="vertical-align: inherit;">comment cela fonctionne.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os<font></font>
<font></font>
<span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Option, Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-string">"""        
       foo.
    """</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_options</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-string">"""     . """</span><font></font>
<font></font>
        tools = [<span class="hljs-string">'build'</span>, <span class="hljs-string">'install'</span>, <span class="hljs-string">'sdist'</span>, <span class="hljs-string">'wheel'</span>]<font></font>
<font></font>
        <span class="hljs-comment">#   .</span><font></font>
        options = super().get_options()<font></font>
<font></font>
        <span class="hljs-comment">#   </span>
        inc_dir_option = Option(<span class="hljs-string">'foo_include_dir'</span>,<font></font>
                                help=<span class="hljs-string">"the directory containing foo.h"</span>,<font></font>
                                metavar=<span class="hljs-string">"DIR"</span>,<font></font>
                                default=os.path.abspath(<span class="hljs-string">'foo'</span>),<font></font>
                                tools=tools)<font></font>
        options.append(inc_dir_option)<font></font>
<font></font>
        lib_dir_option = Option(<span class="hljs-string">'foo_library_dir'</span>,<font></font>
                                help=<span class="hljs-string">"the directory containing the foo library"</span>,<font></font>
                                metavar=<span class="hljs-string">"DIR"</span>,<font></font>
                                default=os.path.abspath(<span class="hljs-string">'foo/bin'</span>),<font></font>
                                tools=tools)<font></font>
<font></font>
        options.append(lib_dir_option)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> options<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_user_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        <span class="hljs-string">"""    . """</span><font></font>
<font></font>
        <span class="hljs-comment">#     </span><font></font>
        super().apply_user_defaults(tool)<font></font>
<font></font>
        <span class="hljs-comment">#  ,         </span><font></font>
        self.foo_include_dir = os.path.abspath(self.foo_include_dir)<font></font>
        self.foo_library_dir = os.path.abspath(self.foo_library_dir)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, tool</span>):</span>
        <span class="hljs-string">"""   . """</span><font></font>
<font></font>
        <span class="hljs-comment">#   pyfoo</span>
        <span class="hljs-comment"># (  pyproject.toml  [tool.sip.bindings.pyfoo])</span>
        foo_bindings = self.bindings[<span class="hljs-string">'pyfoo'</span>]<font></font>
<font></font>
        <span class="hljs-comment">#   include_dirs  </span>
        <span class="hljs-keyword">if</span> self.foo_include_dir <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            foo_bindings.include_dirs = [self.foo_include_dir]<font></font>
<font></font>
        <span class="hljs-comment">#   library_dirs  </span>
        <span class="hljs-keyword">if</span> self.foo_library_dir <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            foo_bindings.library_dirs = [self.foo_library_dir]<font></font>
<font></font>
        super().update(tool)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons Ã  nouveau crÃ©Ã© la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dÃ©rivÃ©e de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans cet exemple, l'assemblage automatique de la bibliothÃ¨que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est dÃ©sactivÃ© </font><font style="vertical-align: inherit;">, car il est dÃ©sormais supposÃ© qu'il peut se trouver Ã  un autre endroit et au moment de la crÃ©ation de la liaison, les fichiers d'en-tÃªte et d'objet doivent Ãªtre prÃªts. </font><font style="vertical-align: inherit;">Trois mÃ©thodes sont redÃ©finis </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe </font><font style="vertical-align: inherit;">: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise Ã  </font><font style="vertical-align: inherit;">jour</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ConsidÃ©rez-les plus attentivement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CommenÃ§ons par la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cette mÃ©thode doit renvoyer une liste d'instances de la classe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Option</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Chaque Ã©lÃ©ment de liste est une option de ligne de commande. Dans la mÃ©thode remplacÃ©e, nous obtenons la liste des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par dÃ©faut (la variable </font><i><font style="vertical-align: inherit;">options</font></i><font style="vertical-align: inherit;"> ) en appelant la mÃ©thode de classe de base du mÃªme nom, puis crÃ©ons deux nouvelles options ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo_library_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et les ajoutons Ã  la liste, puis </font><i><font style="vertical-align: inherit;">renvoyons</font></i><font style="vertical-align: inherit;"> cette liste Ã  partir de la fonction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le constructeur de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> accepte un paramÃ¨tre obligatoire (nom de l'option) et un nombre suffisamment important de paramÃ¨tres facultatifs qui dÃ©crivent le type de valeur pour ce paramÃ¨tre, la valeur par dÃ©faut, la description du paramÃ¨tre et quelques autres. Cet exemple utilise les options suivantes pour le constructeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><i>help</i>   ,   ,     <i>sip-wheel -h</i></li>
<li><i>metavar</i> â€”  ,    ,       .     <i>metavar</i>  Â«DIRÂ»,   ,     â€” .</li>
<li><i>default</i> â€”     .    ,          ,   <i>foo</i>   ,      (    ).</li>
<li><i>tools</i> â€”  ,        .        <i>sip-build</i>, <i>sip-install</i>, <i>sip-sdist</i>  <i>sip-wheel</i>,  tools = ['build', 'install', 'sdist', 'wheel'].</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> surchargÃ©e </font><i><font style="vertical-align: inherit;">suivante est</font></i><font style="vertical-align: inherit;"> conÃ§ue pour dÃ©finir des valeurs de paramÃ¨tre que l'utilisateur peut transmettre via la ligne de commande. La mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la classe de base crÃ©e une </font><font style="vertical-align: inherit;">variable (membre de classe) </font><font style="vertical-align: inherit;">pour chaque paramÃ¨tre de ligne de commande crÃ©Ã© dans la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il est donc important d'appeler la mÃ©thode de classe de base du mÃªme nom avant d'utiliser les variables crÃ©Ã©es afin que toutes les variables crÃ©Ã©es Ã  l'aide des paramÃ¨tres de ligne de commande soient crÃ©Ã©es et initialisÃ©es avec des valeurs par dÃ©faut . AprÃ¨s cela, dans notre exemple, les variables </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><i><font style="vertical-align: inherit;">self.foo_library_dir</font></i><font style="vertical-align: inherit;"> seront crÃ©Ã©es</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si l'utilisateur n'a pas spÃ©cifiÃ© les paramÃ¨tres de ligne de commande correspondants, il prendra alors les valeurs par dÃ©faut en fonction des paramÃ¨tres du constructeur de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (paramÃ¨tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par dÃ©faut</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Si le paramÃ¨tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par dÃ©faut</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'est </font><font style="vertical-align: inherit;">pas dÃ©fini, en fonction du type de la valeur de paramÃ¨tre attendue, il sera initialisÃ© soit Aucun, soit une liste vide, ou 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><i><font style="vertical-align: inherit;">nous nous</font></i><font style="vertical-align: inherit;"> assurons que les chemins dans les variables </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir sont</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> toujours absolus. Cela est nÃ©cessaire pour qu'il ne dÃ©pende pas de ce que sera le dossier de travail au moment du dÃ©marrage de l'assemblage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La derniÃ¨re mÃ©thode surchargÃ©e de cette classe est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette mÃ©thode est appelÃ©e lorsqu'il est nÃ©cessaire d'appliquer au projet les modifications apportÃ©es auparavant. Par exemple, modifiez ou ajoutez les paramÃ¨tres spÃ©cifiÃ©s dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans les exemples prÃ©cÃ©dents, nous avons dÃ©fini les chemins d'accÃ¨s aux fichiers d'en-tÃªte et d'objet Ã  l'aide des paramÃ¨tres </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">respectivement, dans la section </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip.bindings.pyfoo]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Maintenant, nous allons dÃ©finir ces paramÃ¨tres Ã  partir du script </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donc dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">nous </font><font style="vertical-align: inherit;">supprimerons ces paramÃ¨tres:</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.3"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise Ã  </font><font style="vertical-align: inherit;">jour</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous du dictionnaire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.bindings</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> clavetÃ© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gat exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Bindings</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le nom de la clÃ© correspond aux [tool.sip.bindings. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] du fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et l'instance de classe ainsi obtenue dÃ©crit les paramÃ¨tres dÃ©crits dans cette section. Ensuite, les membres de cette classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include_dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library_dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les noms des membres correspondent aux paramÃ¨tres </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec un trait d'union remplacÃ© par des traits de soulignement) reÃ§oivent des listes contenant les chemins stockÃ©s dans les membres </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dans cet exemple, pour plus de prÃ©cision, nous vÃ©rifions que les valeurs </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne </font><i><font style="vertical-align: inherit;">sont</font></i><font style="vertical-align: inherit;"> pas Ã©gales Ã  </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">None</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais dans cet exemple, cette condition est toujours remplie car les paramÃ¨tres de ligne de commande que nous avons crÃ©Ã©s ont des valeurs par dÃ©faut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous avons prÃ©parÃ© les fichiers de configuration afin que lors de l'assemblage, il soit possible d'indiquer les chemins d'accÃ¨s aux fichiers d'en-tÃªte et d'objet. VÃ©rifions ce qui s'est passÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, assurez-vous que les valeurs par dÃ©faut fonctionnent. Pour ce faire, accÃ©dez au dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05 / foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><i><font style="vertical-align: inherit;">crÃ©ez</font></i><font style="vertical-align: inherit;"> la bibliothÃ¨que Ã  l'aide de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande make</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car nous avons dÃ©sactivÃ© la gÃ©nÃ©ration automatique de bibliothÃ¨que dans cet exemple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s cela, allez dans le dossier</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et exÃ©cutez la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ã€ la suite de cette commande, le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier pyfoo-0.5-cp38-cp38-manylinux1_x86_64.whl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou avec un nom similaire </font><font style="vertical-align: inherit;">sera crÃ©Ã© </font><font style="vertical-align: inherit;">. </font><i><font style="vertical-align: inherit;">DÃ©placez</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
maintenant le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quelque part en dehors du dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et exÃ©cutez Ã  nouveau la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par consÃ©quent, nous obtenons l'erreur attendue informant que nous n'avons pas de fichier de bibliothÃ¨que d'objets:</font></font><br>
<br>
<pre><code class="plaintext hljs">usr/bin/ld:   -lfoo<font></font>
collect2: :  ld     1<font></font>
sip-wheel: Unable to compile the 'foo' module: command 'g++' failed with exit status 1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s cela, exÃ©cutez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel en</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisant la nouvelle option de ligne de commande:</font></font><br>
<br>
<pre><code class="bash hljs">sip-wheel --foo-include-dir <span class="hljs-string">".../foo"</span> --foo-library-dir <span class="hljs-string">".../foo/bin"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu des points de suspension, vous devez spÃ©cifier le chemin d'accÃ¨s au dossier dans lequel vous avez dÃ©placÃ© le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec la bibliothÃ¨que assemblÃ©e. </font><font style="vertical-align: inherit;">Par consÃ©quent, l'assembly doit rÃ©ussir Ã  crÃ©er le fichier .whl. </font><font style="vertical-align: inherit;">Le module crÃ©Ã© peut Ãªtre installÃ© et testÃ© de la mÃªme maniÃ¨re que dans les sections prÃ©cÃ©dentes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VÃ©rifiez l'ordre des mÃ©thodes d'appel Ã  partir de project.py</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exemple suivant, que nous considÃ©rerons, sera trÃ¨s simple; il montrera l'ordre d'appeler les mÃ©thodes de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que nous avons surchargÃ©es dans les sections prÃ©cÃ©dentes. Cela peut Ãªtre utile pour comprendre quand les variables peuvent Ãªtre initialisÃ©es. Cet exemple se trouve dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_06</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du rÃ©fÃ©rentiel source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'essence de cet exemple est de </font><font style="vertical-align: inherit;">surcharger toutes les mÃ©thodes que nous avons utilisÃ©es auparavant </font><font style="vertical-align: inherit;">dans la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui se trouve dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et de leur ajouter des appels Ã  la fonction d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impression</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui afficheraient le nom de la mÃ©thode dans laquelle il se trouve:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_options</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'get_options()'</span>)<font></font>
        options = super().get_options()<font></font>
        <span class="hljs-keyword">return</span> options<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_user_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'apply_user_defaults()'</span>)<font></font>
        super().apply_user_defaults(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_nonuser_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'apply_nonuser_defaults()'</span>)<font></font>
        super().apply_nonuser_defaults(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'update()'</span>)<font></font>
        super().update(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'build()'</span>)<font></font>
        super().build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_sdist</span>(<span class="hljs-params">self, sdist_directory</span>):</span>
        print(<span class="hljs-string">'build_sdist()'</span>)
        <span class="hljs-keyword">return</span> super().build_sdist(sdist_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_wheel</span>(<span class="hljs-params">self, wheel_directory</span>):</span>
        print(<span class="hljs-string">'build_wheel()'</span>)
        <span class="hljs-keyword">return</span> super().build_wheel(wheel_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'install()'</span>)<font></font>
        super().install()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les lecteurs attentifs doivent noter qu'en plus des mÃ©thodes prÃ©cÃ©demment utilisÃ©es, la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont nous n'avons pas parlÃ© auparavant </font><font style="vertical-align: inherit;">, est surchargÃ©e dans cet exemple </font><font style="vertical-align: inherit;">. Cette mÃ©thode recommande de dÃ©finir des valeurs par dÃ©faut pour toutes les variables qui ne peuvent pas Ãªtre modifiÃ©es via les paramÃ¨tres de ligne de commande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renvoyez le chemin explicite vers la bibliothÃ¨que:</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.4"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
include-dirs = ["foo"]<font></font>
library-dirs = ["foo/bin"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que le projet rÃ©ussisse, vous devez aller dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et y construire la bibliothÃ¨que Ã  l'aide de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande make</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ensuite, retournez dans le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_06</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et exÃ©cutez, par exemple, la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Par consÃ©quent, si vous ignorez les avertissements du compilateur, le texte suivant s'affiche: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options () </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update ()</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ces liaisons seront crÃ©Ã©es: pyfoo. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel ()</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
GÃ©nÃ©ration des liaisons pyfoo ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compilation du module 'foo' ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La roue a Ã©tÃ© construite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des lignes en gras sont affichÃ©es qui sont sorties de notre fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ainsi, nous voyons que la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appelÃ©e plusieurs fois, et cela doit Ãªtre pris en compte si vous allez initialiser une variable membre de la classe dÃ©rivÃ©e de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'est pas le meilleur endroit pour cela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est Ã©galement utile de se rappeler que la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appelÃ©e avant la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-Ã -dire dans la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><i><font style="vertical-align: inherit;">il est</font></i><font style="vertical-align: inherit;"> dÃ©jÃ  possible d'utiliser des variables dont les valeurs sont dÃ©finies dans la mÃ©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s cela, la mÃ©thode de </font><i><font style="vertical-align: inherit;">mise Ã  jour</font></i><font style="vertical-align: inherit;"> est appelÃ©e</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et Ã  la toute fin, la mÃ©thode directement responsable de l'assemblage, dans notre cas, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclusion de la premiÃ¨re partie</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous avons commencÃ© Ã  Ã©tudier l'outil SIP conÃ§u pour crÃ©er des liaisons Python pour des bibliothÃ¨ques Ã©crites en C ou C ++. Dans cette premiÃ¨re partie de l'article, nous avons examinÃ© les bases de l'utilisation de SIP en utilisant l'exemple de crÃ©ation d'une liaison Python pour une bibliothÃ¨que trÃ¨s simple Ã©crite en C. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons dÃ©terminÃ© les fichiers que vous devez crÃ©er pour travailler avec SIP. Le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient des informations sur le package (nom, numÃ©ro de version, licence et chemins d'accÃ¨s aux fichiers d'en-tÃªte et d'objet). En utilisant le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">vous pouvez influencer le processus de construction du package Python, par exemple, commencer Ã  construire la bibliothÃ¨que C ou laisser l'utilisateur spÃ©cifier l'emplacement des fichiers d'en-tÃªte et d'objet de la bibliothÃ¨que. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* .sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©crit l'interface du module Python listant les fonctions et classes qui seront contenues dans le module. </font><font style="vertical-align: inherit;">Des directives et des annotations sont utilisÃ©es </font><font style="vertical-align: inherit;">pour dÃ©crire l'interface dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* .sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la deuxiÃ¨me partie de l'article, nous allons crÃ©er une liaison sur une bibliothÃ¨que orientÃ©e objet Ã©crite en C ++, et sur son exemple, nous Ã©tudierons des techniques qui seront utiles pour dÃ©crire l'interface des classes C ++, et en mÃªme temps nous traiterons de nouvelles directives et annotations pour nous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ suivre.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RÃ©fÃ©rences</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples pour cet article</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page d'accueil SIP</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation pour SIP</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495468/index.html">Algorithme de reconnaissance des Ã©tiquettes de prix qui fonctionne mÃªme sur les terminaux de collecte de donnÃ©es</a></li>
<li><a href="../fr495472/index.html">Le passage au vÃ©gÃ©tarisme n'empÃªchera pas les gens d'Ãªtre infectÃ©s par des maladies comme COVID-19</a></li>
<li><a href="../fr495474/index.html">DataGrip 2020.1: lancement des configurations, exportation vers Excel, rÃ©sultats dans l'Ã©diteur et plus</a></li>
<li><a href="../fr495476/index.html">Pourquoi le succÃ¨s d'Atari DeepMind AI est dÃ©cevant</a></li>
<li><a href="../fr495478/index.html">Testeur de donnÃ©es grandes et petites: tendances, thÃ©orie, mon histoire</a></li>
<li><a href="../fr495484/index.html">Comment les pipelines Unix sont implÃ©mentÃ©s</a></li>
<li><a href="../fr495486/index.html">Nouvelles menaces pour les donnÃ©es confidentielles: rÃ©sultats de l'enquÃªte mondiale Acronis</a></li>
<li><a href="../fr495490/index.html">Section des tests et de l'assurance qualitÃ© lors de la confÃ©rence DUMP 2020. Ã€ quoi s'attendre cette annÃ©e? Spoiler: une paire d'analgÃ©siques et de cerises</a></li>
<li><a href="../fr495492/index.html">FonctionnalitÃ©s de sortie du jeu iOS Unreal Engine 4</a></li>
<li><a href="../fr495494/index.html">CrÃ©ation d'un planificateur de kube supplÃ©mentaire avec un ensemble personnalisÃ© de rÃ¨gles de planification</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>