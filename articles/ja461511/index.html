<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛽️ 🚺 📲 Python依存関係管理：アプローチの比較 ⏫ ☪️ 👂🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私はpythonで約5年間書いており、そのうち3年間は自分のプロジェクトを開発しています。この方法のほとんどは、私のチームがこれを助けてくれます。また、リリースごとに、新機能ごとに、プロジェクトがサポートされていないコードで混乱しないように、ますます努力しています。循環インポート、相互依存関係、再利...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Python依存関係管理：アプローチの比較</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461511/"><img src="http://ftcdn.pw/cd64d5e9-af9a-46cc-868b-c8873c98adb6.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はpythonで約5年間書いており、そのうち3年間は自分のプロジェクトを開発しています。</font><font style="vertical-align: inherit;">この方法のほとんどは、私のチームがこれを助けてくれます。</font><font style="vertical-align: inherit;">また、リリースごとに、新機能ごとに、プロジェクトがサポートされていないコードで混乱しないように、ますます努力しています。</font><font style="vertical-align: inherit;">循環インポート、相互依存関係、再利用可能なモジュールの割り当て、構造の再構築を扱います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、Pythonコミュニティでは、「優れたアーキテクチャ」という普遍的な概念はなく、「Pythonicity」という概念しかないため、私たち自身でアーキテクチャを考え出す必要があります。</font><font style="vertical-align: inherit;">アンダーザカット-アーキテクチャ、そしてまず第一に、依存関係管理を反映したLongridは、Pythonに適用できます。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">django.setup（）</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、dzhangistsへの質問から始めます。</font><font style="vertical-align: inherit;">これらの2行を頻繁に書きますか？</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> django<font></font>
django.setup()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
django Webサーバー自体を起動せずにdjangoオブジェクトを操作する場合は、このファイルからファイルを起動する必要があります。これは、時間（</font></font><code><b>django.utils.timezone</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、URL（</font></font><code><b>django.urls.reverse</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）などを操作</font><font style="vertical-align: inherit;">するためのモデルとツールに適用され</font><font style="vertical-align: inherit;">ます。これを行わないと、エラーが発生します。</font></font><br>
<br>
<pre><code class="plaintext hljs">django.core.exceptions.AppRegistryNotReady: Apps aren't loaded yet.
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は常にこの2行を書いています。</font><font style="vertical-align: inherit;">私は排出コードの大ファンです。</font><font style="vertical-align: inherit;">私は別の</font></font><code><b>.py</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">を作成し、</font><font style="vertical-align: inherit;">その中のいくつかをひねり、理解し、それをプロジェクトに埋め込むのが</font><font style="vertical-align: inherit;">好き</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、この定数は常に私を困らせます</font></font><code><b>django.setup()</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">まず、どこにでもそれを繰り返すのに飽きます。</font><font style="vertical-align: inherit;">次に、djangoの初期化には数秒かかります（大きなモノリスがあります）。同じファイルを10、20、100回再起動すると、開発が遅くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
取り除く方法は</font></font><code><b>django.setup()</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">djangoに最小限依存するコードを記述する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、外部APIのクライアントを作成する場合は、djangoに依存させることができます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> django.conf <span class="hljs-keyword">import</span> settings<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">APIClient</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.api_key = settings.SOME_API_KEY<font></font>
<font></font>
<span class="hljs-comment"># :</span><font></font>
client = APIClient()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
またはそれはdjangoから独立しています：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">APIClient</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, api_key</span>):</span><font></font>
        self.api_key = api_key<font></font>
<font></font>
<span class="hljs-comment"># :</span>
client = APIClient(api_key=<span class="hljs-string">'abc'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のケースでは、コンストラクターはより面倒ですが、このクラスを使用した操作は、すべてのdzhangovskoy機構をロードせずに実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストも簡単になっています。</font><font style="vertical-align: inherit;">設定に依存するコンポーネントをテストする方法は</font></font><code><b>django.conf.settings</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">デコレータ内の唯一の城</font></font><code><b>@override_settings</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして、コンポーネントが何にも依存しない場合、濡れることは何もありません。それは、コンストラクターにパラメーターを渡し、それを駆動しました。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 依存関係管理</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
依存関係の物語</font></font><code><b>django</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、私が毎日直面する問題の最も印象的な例です。Pythonの依存関係管理の問題と、Pythonアプリケーションの全体的なアーキテクチャです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pythonコミュニティの依存関係管理との関係はさまざまです。</font><font style="vertical-align: inherit;">3つの主要なキャンプを区別できます。</font></font><br>
<br>
<ul>
<li> —  .   ,    .    ,        ..<br>
<br>
</li>
<li> —  .         .            ,    .<br>
<br>
<div class="spoiler"><b class="spoiler_title">      </b><div class="spoiler_text">Brandon Rhodes, Dropbox: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Hoist your IO</a>.<br>
<br>
  :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-string">"""          """</span>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"/etc/hosts"</span>) <span class="hljs-keyword">as</span> file:
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> parse_hosts(file):<font></font>
            print(line)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_hosts</span>(<span class="hljs-params">lines</span>):</span>
    <span class="hljs-string">"""    -   """</span>
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
        <span class="hljs-keyword">if</span> line.startswith(<span class="hljs-string">"#"</span>):
            <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">yield</span> line
</code></pre><br>
</div></div><br>
 </li>
<li>  —       .       .   —   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">dry-python</a>.      — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Django structure for scale and longevity</a>,     .<br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pythonの依存関係管理に関する記事はいくつかありますが（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、それらはすべて、誰かの依存性注入フレームワークの宣伝につながります。</font><font style="vertical-align: inherit;">この記事は同じトピックの新しいエントリですが、今回は広告なしの純粋な思考実験です。</font><font style="vertical-align: inherit;">これは、上記の3つのアプローチのバランスをとる試みであり、余分なフレームワークなしで実行し、「pythonic」にするものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は最近</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clean Architectureを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読み</font><font style="vertical-align: inherit;">ました。Pythonでの依存性注入の価値と、それを実装する方法を理解しているようです。</font><font style="vertical-align: inherit;">私自身のプロジェクトの例でこれを見ました。</font><font style="vertical-align: inherit;">簡単に言えば、これは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のコードが変更されたときにコードが壊れないようにすること</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期データ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービス短縮サービスのHTTPリクエストを実行するAPIクライアントがあります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># shortener_client.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> requests<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShortenerClient</span>:</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, api_key</span>):</span><font></font>
        self.api_key = api_key<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shorten_link</span>(<span class="hljs-params">self, url</span>):</span><font></font>
        response = requests.post(<font></font>
            url=<span class="hljs-string">'https://fstrk.cc/short'</span>,<font></font>
            headers={<span class="hljs-string">'Authorization'</span>: self.api_key},<font></font>
            json={<span class="hljs-string">'url'</span>: url}<font></font>
        )<font></font>
        <span class="hljs-keyword">return</span> response.json()[<span class="hljs-string">'url'</span>]<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、テキスト内のすべてのリンクを短くするモジュールがあります。</font><font style="vertical-align: inherit;">これを行うには、短縮APIクライアントを使用します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># text_processor.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> shortener_client <span class="hljs-keyword">import</span> ShortenerClient<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextProcessor</span>:</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, text</span>):</span><font></font>
        self.text = text<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span>(<span class="hljs-params">self</span>):</span><font></font>
        changed_text = self.text<font></font>
        links = re.findall(<font></font>
            <span class="hljs-string">r'https?://[^\r\n\t") ]*'</span>,<font></font>
            self.text,<font></font>
            flags=re.MULTILINE<font></font>
        )<font></font>
        api_client = ShortenerClient(<span class="hljs-string">'abc'</span>)
        <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> links:<font></font>
            shortened = api_client.shorten_link(link)<font></font>
            changed_text = changed_text.replace(link, shortened)<font></font>
        <span class="hljs-keyword">return</span> changed_text
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コード実行のロジックは、別の制御ファイルにあります（コントローラーと呼びましょう）。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># controller.py</span><font></font>
<font></font>
<span class="hljs-keyword">from</span> text_processor <span class="hljs-keyword">import</span> TextProcessor<font></font>
<font></font>
processor = TextProcessor(<span class="hljs-string">"""
     1: https://ya.ru   2: https://google.com
    """</span>)<font></font>
print(processor.process())<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが機能しています。</font><font style="vertical-align: inherit;">プロセッサはテキストを解析し、短縮機能を使用してリンクを短縮し、結果を返します。</font><font style="vertical-align: inherit;">依存関係は次のようになります。</font></font><br>
<br>
<img src="http://ftcdn.pw/58d8aa1d-0024-42c6-918e-05b2d41f126d.png" alt="画像"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに問題があります：クラス</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">クラスに</font><font style="vertical-align: inherit;">依存し</font><b><font style="vertical-align: inherit;">、インターフェイスが変更される</font></b></font><code><b>ShortenerClient</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中断します</font></font></b> <code><b>ShortenerClient</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはどうして起こりますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのプロジェクトで、クリックスルーを追跡することに決め、メソッドに</font></font><code><b>shorten_link</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引数</font><font style="vertical-align: inherit;">を追加したとし</font><font style="vertical-align: inherit;">ます</font></font><code><b>callback_url</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この引数は、リンクをクリックしたときに通知が送信されるアドレスを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッド</font></font><code><b>ShortenerClient.shorten_link</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は次のようになりました。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shorten_link</span>(<span class="hljs-params">self, url, callback_url</span>):</span><font></font>
    response = requests.post(<font></font>
        url=<span class="hljs-string">'https://fstrk.cc/short'</span>,<font></font>
        headers={<span class="hljs-string">'Authorization'</span>: self.api_key},<font></font>
        json={<span class="hljs-string">'url'</span>: url,
              <span class="hljs-string">'callback_on_click'</span>: callback_url}<font></font>
    )<font></font>
    <span class="hljs-keyword">return</span> response.json()[<span class="hljs-string">'url'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、何が起こりますか？</font><font style="vertical-align: inherit;">そして、開始しようとすると、エラーが発生することがわかりました。</font></font><br>
<br>
<pre><code class="python hljs">TypeError: shorten_link() missing <span class="hljs-number">1</span> required positional argument: <span class="hljs-string">'callback_url'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、ショートナーを交換しましたが、破損したのは彼ではなく、クライアントだったの</font></font><br>
<br>
<img src="http://ftcdn.pw/13e9dcd5-7866-4c82-b1d0-e56134650b62.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
です。</font><font style="vertical-align: inherit;">さて、呼び出しファイルが壊れたので、それを修正しました。</font><font style="vertical-align: inherit;">何が問題ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが1分で解決された場合-彼らは行って修正しました-もちろん、これはまったく問題ではありません。</font><font style="vertical-align: inherit;">クラスにコードがほとんどなく、それらを自分でサポートする場合（これはサイドプロジェクトであり、これらは同じサブシステムの2つの小さなクラスであるなど）、そこで停止できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は次の場合に始まります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出しモジュールと呼び出されたモジュールには多くのコードがあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまなモジュールがさまざまな人々/チームによってサポートされています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスを作成し、</font></font><code><b>ShortenerClient</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同僚が</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成すると、攻撃的な状況</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が発生します。コードを変更しましたが、壊れました。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、それはあなたが人生で見たことのない場所で壊れました、そして今、あなたは座って他の誰かのコードを理解する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに興味深いのは、モジュールが1か所ではなく複数の場所で使用されている場合です。</font><font style="vertical-align: inherit;">編集すると、ファイルのヒープ上のコードが壊れます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、問題は次のように定式化できます。インターフェイスが変更されたときに、</font><b><font style="vertical-align: inherit;">そのコンシューマではなく</font></b><font style="vertical-align: inherit;">（多くの場合がある）</font></font><code><b>ShortenerClient</b></code> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブレークダウン</font></font><code><b>ShortenerClient</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しない</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ようにコードを編成する方法は</font><font style="vertical-align: inherit;">？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでの解決策は：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスの消費者とクラス自体は、共通のインターフェースについて合意する必要があります。</font><font style="vertical-align: inherit;">このインターフェースは法律になるはずです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスがそのインターフェースに対応しなくなった場合、これらはその問題であり、消費者の問題ではありません。</font></font></li>
</ul><br>
<img src="http://ftcdn.pw/dbb4d320-2683-4f2e-821e-dea621b54b53.png" alt="画像"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> インターフェースをフリーズ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターフェースの修正はPythonでどのように見えますか？</font><font style="vertical-align: inherit;">これは抽象クラスです：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABC, abstractmethod<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractClient</span>(<span class="hljs-params">ABC</span>):</span><font></font>
<font></font>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, api_key</span>):</span>
        <span class="hljs-keyword">pass</span><font></font>
<font></font>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shorten_link</span>(<span class="hljs-params">self, link</span>):</span>
        <span class="hljs-keyword">pass</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスから継承し、メソッドの実装を忘れると、エラーが発生します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShortenerClient</span>(<span class="hljs-params">AbstractClient</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__ini__</span>(<span class="hljs-params">self, api_key</span>):</span><font></font>
        self.api_key = api_key<font></font>
<font></font>
client = ShortenerClient(<span class="hljs-string">'123'</span>)<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>TypeError: Can<span class="hljs-string">'t instantiate abstract class ShortenerClient with abstract methods __init__, shorten_link
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これでは十分ではありません。</font><font style="vertical-align: inherit;">抽象クラスはメソッドの名前のみをキャプチャし、シグネチャはキャプチャしません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つ目の署名検証ツールが必要です</font></font><code><b>mypy</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この2つ目のツールは</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">継承されたメソッドの署名を検証するのに役立ちます。</font><font style="vertical-align: inherit;">これを行うには、インターフェースに注釈を追加する必要があります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># shortener_client.py</span><font></font>
<font></font>
<span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABC, abstractmethod<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractClient</span>(<span class="hljs-params">ABC</span>):</span><font></font>
<font></font>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, api_key: str</span>) -&gt; <span class="hljs-keyword">None</span>:</span>
        <span class="hljs-keyword">pass</span><font></font>
<font></font>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shorten_link</span>(<span class="hljs-params">self, link: str</span>) -&gt; str:</span>
        <span class="hljs-keyword">pass</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShortenerClient</span>(<span class="hljs-params">AbstractClient</span>):</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, api_key: str</span>) -&gt; <span class="hljs-keyword">None</span>:</span><font></font>
        self.api_key = api_key<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shorten_link</span>(<span class="hljs-params">self, link: str, callback_url: str</span>) -&gt; str:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">'xxx'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードを</font></font><code><b>mypy</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">チェック</font><font style="vertical-align: inherit;">すると、余分な引数が原因でエラーが発生します</font></font><code><b>callback_url</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">mypy shortener_client.py<font></font>
<font></font>
&gt;&gt;&gt; error: Signature of "shorten_link" incompatible with supertype "AbstractClient"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、クラスインターフェイスをコミットする信頼できる方法ができました。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 依存関係の逆転</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターフェースをデバッグしたら、消費者のファイルへの依存を完全になくすために、インターフェースを別の場所に移動する必要があります</font></font><code><b>shortener_client.py</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、インターフェイスを直接コンシューマにドラッグできます-プロセッサのあるファイルに</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># text_processor.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABC, abstractmethod<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractClient</span>(<span class="hljs-params">ABC</span>):</span><font></font>
<font></font>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, api_key: str</span>) -&gt; <span class="hljs-keyword">None</span>:</span>
        <span class="hljs-keyword">pass</span><font></font>
<font></font>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shorten_link</span>(<span class="hljs-params">self, link: str</span>) -&gt; str:</span>
        <span class="hljs-keyword">pass</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextProcessor</span>:</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, text, shortener_client: AbstractClient</span>) -&gt; <span class="hljs-keyword">None</span>:</span><font></font>
        self.text = text<font></font>
        self.shortener_client = shortener_client<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span>(<span class="hljs-params">self</span>) -&gt; str:</span><font></font>
        changed_text = self.text<font></font>
<font></font>
        links = re.findall(<font></font>
            <span class="hljs-string">r'https?://[^\r\n\t") ]*'</span>,<font></font>
            self.text,<font></font>
            flags=re.MULTILINE<font></font>
        )<font></font>
<font></font>
        <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> links:<font></font>
            shortened = self.shortener_client.shorten_link(link)<font></font>
            changed_text = changed_text.replace(link, shortened)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> changed_text
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそれは中毒の方向を変えるでしょう！</font><font style="vertical-align: inherit;">現在、インタラクションインターフェースを所有して</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おり、その結果</font><font style="vertical-align: inherit;">、インタラクションインターフェース</font><font style="vertical-align: inherit;">に</font></font><code><b>ShortenerClient</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存し、その逆はありません。</font></font><br>
<br>
<img src="http://ftcdn.pw/33f3c619-63bf-420d-99d0-67bed0dfa628.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単に言えば、変換の本質を次のように説明できます。</font></font><br>
<br>
<ul>
<li><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">言う：私はプロセッサであり、私はテキスト変換に関与しています。</font><font style="vertical-align: inherit;">短縮メカニズムについて何も知りたくありません。これは私の仕事ではありません。</font><font style="vertical-align: inherit;">メソッドをプルして、</font></font><code><b>shorten_link</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてが短縮されるよう</font><font style="vertical-align: inherit;">にしたい</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">だから、私のルールに従って遊ぶオブジェクトをください。</font><font style="vertical-align: inherit;">私とのやり取りに関する決定は、彼ではなく私が行います。</font></font></li>
<li><code><b>ShortenerClient</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">言う：私は孤立して存在することはできないようであり、特定の行動が私に要求されます。</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壊れない</font><font style="vertical-align: inherit;">ように</font><font style="vertical-align: inherit;">何を合わせる必要があるのか</font><font style="vertical-align: inherit;">聞い</font><font style="vertical-align: inherit;">て</font><font style="vertical-align: inherit;">みます</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複数の消費者</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数のモジュールが短縮リンクを使用する場合、インターフェースはそれらの1つではなく、階層がより高い他のファイルの上にある別のファイルに配置する必要があります。</font></font><br>
<br>
<img src="http://ftcdn.pw/a81ef19a-45aa-4b23-b93a-e9a6b9094670.png" alt="画像"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 制御コンポーネント</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンシューマーがをインポートしない場合</font></font><code><b>ShortenerClient</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それをインポートしてクラスのオブジェクトを作成するのは誰ですか？</font><font style="vertical-align: inherit;">これは制御コンポーネントである必要があります-この場合、これ</font></font><code><b>controller.py</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なアプローチは、単純な依存性注入である「額の」依存性注入です。</font><font style="vertical-align: inherit;">呼び出しコードでオブジェクトを作成し、1つのオブジェクトを別のオブジェクトに転送します。</font><font style="vertical-align: inherit;">利益</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># controller.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> TextProcessor
<span class="hljs-keyword">import</span> ShortenerClient<font></font>
<font></font>
processor = TextProcessor(<font></font>
    text=<span class="hljs-string">' 1: https://ya.ru   2: https://google.com'</span>,<font></font>
    shortener_client=ShortenerClient(api_key=<span class="hljs-string">'123'</span>)<font></font>
)<font></font>
<font></font>
print(processor.process())<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pythonアプローチ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より「Python的な」アプローチは、継承による依存性注入であると考えられています。 </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レイモンドヘッティンガーは、彼のスーパー考慮スーパーレポートでこれについて非常に詳細に述べています。</font></font></b><div class="spoiler_text"><div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://www.youtube.com/watch?v=EiOglTERPEo</a></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードをこのスタイルに適合させるには、少し変更</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して継承</font><font style="vertical-align: inherit;">可能にする必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># text_processor.py</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextProcessor</span>:</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, text: str</span>) -&gt; <span class="hljs-keyword">None</span>:</span><font></font>
        self.text = text<font></font>
        self.shortener_client: AbstractClient = self.get_shortener_client()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_shortener_client</span>(<span class="hljs-params">self</span>) -&gt; AbstractClient:</span>
        <span class="hljs-string">"""      """</span>
        <span class="hljs-keyword">raise</span> NotImplementedError<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、呼び出しコードでそれを継承します：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># controller.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> TextProcessor
<span class="hljs-keyword">import</span> ShortenerClient<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProcessorWithClient</span>(<span class="hljs-params">TextProcessor</span>):</span>
    <span class="hljs-string">"""   ,    """</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_shortener_client</span>(<span class="hljs-params">self</span>) -&gt; ShortenerClient:</span>
    <span class="hljs-keyword">return</span> ShortenerClient(api_key=<span class="hljs-string">'abc'</span>)<font></font>
<font></font>
processor = ProcessorWithClient(<font></font>
    text=<span class="hljs-string">' 1: https://ya.ru   2: https://google.com'</span><font></font>
)<font></font>
<font></font>
print(processor.process())<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の例は、一般的なフレームワークの至る所にあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Djangoでは、私たちは常に受け継がれています。</font><font style="vertical-align: inherit;">クラスベースのビュー、モデル、フォームのメソッドを再定義します。</font><font style="vertical-align: inherit;">つまり、フレームワークのデバッグ済みの作業に依存関係を挿入します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DRFでも同じです。</font><font style="vertical-align: inherit;">ビュー、シリアライザ、権限を拡張しています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等。</font><font style="vertical-align: inherit;">たくさんの例。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の例は、より見栄えがよく、より身近に見えますか？</font><font style="vertical-align: inherit;">それを開発して、この美しさが保たれているのか見てみましょう。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Python開発</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビジネスロジックには、通常2つ以上のコンポーネントがあります。</font><font style="vertical-align: inherit;">私たちの</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスは独立したクラスではなく</font></font><code><b>TextPipeline</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、テキストを処理してメールに送信</font><font style="vertical-align: inherit;">するパイプライン要素の1つにすぎない</font><font style="vertical-align: inherit;">とします。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextPipeline</span>:</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, text, email</span>):</span><font></font>
        self.text_processor = TextProcessor(text)<font></font>
        self.mailer = Mailer(email)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_and_mail</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-keyword">None</span>:</span><font></font>
        processed_text = self.text_processor.process()<font></font>
        self.mailer.send_text(text=processed_text)<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><code><b>TextPipeline</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用するクラス</font><font style="vertical-align: inherit;">
から分離する場合は</font><font style="vertical-align: inherit;">、前と同じ手順に従う必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font></font><code><b>TextPipeline</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、使用されるコンポーネントのインターフェースを宣言します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用されるコンポーネントは、これらのインターフェースに準拠することを強制されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一部の外部コードはすべてをまとめて実行します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
依存関係図は次のようになります。</font></font><br>
<br>
<img src="http://ftcdn.pw/35f207fa-3ad7-4779-92c3-ae8f63401b8e.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これらの依存関係のアセンブリコードはどのようになるでしょうか。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> TextProcessor
<span class="hljs-keyword">import</span> ShortenerClient
<span class="hljs-keyword">import</span> Mailer
<span class="hljs-keyword">import</span> TextPipeline<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProcessorWithClient</span>(<span class="hljs-params">TextProcessor</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_shortener_client</span>(<span class="hljs-params">self</span>) -&gt; ShortenerClient:</span>
        <span class="hljs-keyword">return</span> ShortenerClient(api_key=<span class="hljs-string">'123'</span>)<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PipelineWithDependencies</span>(<span class="hljs-params">TextPipeline</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_text_processor</span>(<span class="hljs-params">self, text: str</span>) -&gt; ProcessorWithClient:</span>
        <span class="hljs-keyword">return</span> ProcessorWithClient(text)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_mailer</span>(<span class="hljs-params">self, email: str</span>) -&gt; Mailer:</span>
        <span class="hljs-keyword">return</span> Mailer(email)<font></font>
<font></font>
pipeline = PipelineWithDependencies(<font></font>
    email=<span class="hljs-string">'abc@def.com'</span>,<font></font>
    text=<span class="hljs-string">' 1: https://ya.ru   2: https://google.com'</span><font></font>
)<font></font>
<font></font>
pipeline.process_and_mail()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
気づいてますか？</font><font style="vertical-align: inherit;">私たちは、最初のクラスが継承し</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それに挿入する</font></font><code><b>ShortenerClient</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">継承し、その後、と</font></font><code><b>TextPipeline</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはオーバーライドされた挿入するために</font></font><code><b>TextProcessor</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（同様に</font></font><code><b>Mailer</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）それに。</font><font style="vertical-align: inherit;">いくつかのレベルの順次再定義があります。</font><font style="vertical-align: inherit;">すでに複雑です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのフレームワークがこのように編成されているのはなぜですか？</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はい、フレームワークにのみ適しているためです。</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームワークのすべてのレベルは明確に定義されており、その数は制限されています。</font><font style="vertical-align: inherit;">たとえば、Djangoでは、オーバーライド</font></font><code><b>FormField</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">してフォームをオーバーライドに挿入したり、フォームをオーバーライド</font></font><code><b>Form</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に挿入したりできます</font></font><code><b>View</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すべて。</font><font style="vertical-align: inherit;">3つのレベル。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各フレームワークは1つの目的を果たします。</font><font style="vertical-align: inherit;">このタスクは明確に定義されています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各フレームワークには、継承する方法と内容を説明する詳細なドキュメントがあります。</font><font style="vertical-align: inherit;">何を何と組み合わせるか。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビジネスロジックを明確かつ明確に識別して文書化できますか？</font><font style="vertical-align: inherit;">特にそれが機能するレベルのアーキテクチャは？</font><font style="vertical-align: inherit;">私じゃない。</font><font style="vertical-align: inherit;">残念ながら、レイモンドヘッティンガーのアプローチはビジネスロジックに対応していません。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 額アプローチに戻る</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
難易度のいくつかのレベルで、単純なアプローチが勝利します。</font><font style="vertical-align: inherit;">見た目はシンプルになり、ロジックが変更されたときに変更するのも簡単です。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> TextProcessor
<span class="hljs-keyword">import</span> ShortenerClient
<span class="hljs-keyword">import</span> Mailer
<span class="hljs-keyword">import</span> TextPipeline<font></font>
<font></font>
pipeline = TextPipeline(<font></font>
    text_processor=TextProcessor(<font></font>
        text=<span class="hljs-string">' 1: https://ya.ru   2: https://google.com'</span>,<font></font>
        shortener_client=ShortenerClient(api_key=<span class="hljs-string">'abc'</span>)<font></font>
    ),<font></font>
    mailer=Mailer(<span class="hljs-string">'abc@def.com'</span>)<font></font>
)<font></font>
<font></font>
pipeline.process_and_mail()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ロジックのレベル数が増えると、そのようなアプローチでさえ不便になります。</font><font style="vertical-align: inherit;">一連のクラスを強制的に開始し、それらを相互に渡す必要があります。</font><font style="vertical-align: inherit;">ネストの多くのレベルを避けたいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の通話を試してみましょう。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> グローバルインスタンスストレージ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要なコンポーネントのインスタンスが配置されるグローバルディクショナリを作成してみましょう。</font><font style="vertical-align: inherit;">そして、これらのコンポーネントがこのディクショナリへのアクセスを通じて相互に取得できるようにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それを呼び出しましょう</font></font><code><b>INSTANCE_DICT</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># text_processor.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> INSTANCE_DICT<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextProcessor</span>(<span class="hljs-params">AbstractTextProcessor</span>):</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, text</span>) -&gt; <span class="hljs-keyword">None</span>:</span><font></font>
        self.text = text<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span>(<span class="hljs-params">self</span>) -&gt; str:</span>
        shortener_client: AbstractClient = INSTANCE_DICT[<span class="hljs-string">'Shortener'</span>]
        <span class="hljs-comment"># ...  </span><font></font>
<font></font>
</code></pre><br>
<pre><code class="python hljs">
<span class="hljs-comment"># text_pipeline.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> INSTANCE_DICT<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextPipeline</span>:</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-keyword">None</span>:</span><font></font>
        self.text_processor: AbstractTextProcessor = INSTANCE_DICT[<font></font>
            <span class="hljs-string">'TextProcessor'</span>]<font></font>
        self.mailer: AbstractMailer = INSTANCE_DICT[<span class="hljs-string">'Mailer'</span>]<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_and_mail</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-keyword">None</span>:</span><font></font>
        processed_text = self.text_processor.process()<font></font>
        self.mailer.send_text(text=processed_text)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
秘訣は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、オブジェクトにアクセスする前に、オブジェクトをこの辞書に入れることです</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは私たちがやります</font></font><code><b>controller.py</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># controller.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> INSTANCE_DICT
<span class="hljs-keyword">import</span> TextProcessor
<span class="hljs-keyword">import</span> ShortenerClient
<span class="hljs-keyword">import</span> Mailer
<span class="hljs-keyword">import</span> TextPipeline<font></font>
<font></font>
INSTANCE_DICT[<span class="hljs-string">'Shortener'</span>] = ShortenerClient(<span class="hljs-string">'123'</span>)<font></font>
INSTANCE_DICT[<span class="hljs-string">'Mailer'</span>] = Mailer(<span class="hljs-string">'abc@def.com'</span>)<font></font>
INSTANCE_DICT[<span class="hljs-string">'TextProcessor'</span>] = TextProcessor(text=<span class="hljs-string">' : https://ya.ru'</span>)<font></font>
<font></font>
pipeline = TextPipeline()<font></font>
pipeline.process_and_mail()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グローバルディクショナリを使用する利点：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンジンフードの魔法や追加のDIフレームワークはありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネストを管理する必要がない依存関係のフラットリスト。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのDIボーナス：簡単なテスト、独立性、他のコンポーネントが変更された場合の故障からのコンポーネントの保護。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、自分で作成する代わりに、</font></font><code><b>INSTANCE_DICT</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある種のDIフレームワークを使用できます。</font><font style="vertical-align: inherit;">しかし、これの本質は変わりません。</font><font style="vertical-align: inherit;">フレームワークはインスタンスのより柔軟な管理を提供します。</font><font style="vertical-align: inherit;">工場のように、シングルトンまたはパックの形式でそれらを作成できるようになります。</font><font style="vertical-align: inherit;">しかし、考え方は同じままです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、ある時点ではこれでは十分ではなく、私はまだ何らかのフレームワークを選択しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、おそらく、これはすべて不要であり、それなしで行う方が簡単です。直接インポートを記述し、不要な抽象インターフェースを作成しないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pythonでの依存関係管理の経験は何ですか？</font><font style="vertical-align: inherit;">そして一般的に-それは必要ですか、それとも私は空から問題を発明していますか？</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja461501/index.html">なぜ米国で大規模なIT企業の仕事を調査しているのか</a></li>
<li><a href="../ja461503/index.html">データベースをリモート接続で使用できるようにする</a></li>
<li><a href="../ja461505/index.html">あなたがプロになるのを妨げる初心者JavaScript開発者の8つのバグ</a></li>
<li><a href="../ja461507/index.html">なぜGazprom NeftコーポレートアクセラレータStartupDriveを発売することにしたのですか？</a></li>
<li><a href="../ja461509/index.html">旅行アシスタント：ガジェットとアクセサリーのセレクション</a></li>
<li><a href="../ja461519/index.html">﻿CおよびC ++に最適なコピーアンドペーストアルゴリズム。Haiku OSレシピコレクション</a></li>
<li><a href="../ja461523/index.html">PostgreSQLのWAL：4.ログのセットアップ</a></li>
<li><a href="../ja461525/index.html">本当にアダプティブなスライダー（カルーセル）をどのように実行したか</a></li>
<li><a href="../ja461527/index.html">DIY音響浮上</a></li>
<li><a href="../ja461531/index.html">Tic Tac Toeパート6：フラスコとセロリ/ RabbitMQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>