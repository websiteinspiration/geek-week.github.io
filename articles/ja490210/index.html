<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛳️ 🏖️ 🕑 フロントエンドの高速化。サーバーリクエストが多い場合 🙆🏼 👆🏽 🌘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、フロントエンドアプリケーションの読み込みを高速化して、応答性の高い高速なユーザーインターフェイスを実装するいくつかの方法について説明します。
 
 フロントエンドの一般的なアーキテクチャ、必要なリソースをプリロードし、それらがキャッシュにある可能性を高める方法について説明します。バック...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>フロントエンドの高速化。サーバーリクエストが多い場合</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/490210/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、フロントエンドアプリケーションの読み込みを高速化して、応答性の高い高速なユーザーインターフェイスを実装するいくつかの方法について説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フロントエンドの一般的なアーキテクチャ、必要なリソースをプリロードし、それらがキャッシュにある可能性を高める方法について説明します。</font><font style="vertical-align: inherit;">バックエンドからリソースを提供する方法と、インタラクティブなクライアントアプリケーションではなく静的なページに制限できる場合について少し説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダウンロードプロセスは3つの段階に分かれています。</font><font style="vertical-align: inherit;">各段階で、生産性を向上させるための一般的な戦略を策定します。</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期レンダリング</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：ユーザーが少なくとも何かを見るのにどのくらい時間がかかりますか</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリングのブロッキング要求を減らす</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">連続したチェーンを避ける</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバー接続を再利用する</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタントレンダリングのサービスワーカー</font></font></li>
</ul></li>
<li><b> </b>:   ,     <br>
<ul>
<li>    .    .    <br>
</li>
<li>,        <br>
</li>
<li>       <br>
</li>
<li>     <br>
</li>
<li>    </li>
</ul></li>
<li><b> </b>:        <br>
<ul>
<li>    ,   <br>
</li>
<li>      </li>
</ul></li>
</ol><a name="habracut"></a><br>
<h1> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のレンダリングまで、ユーザーは画面に何も表示しません。このレンダリングには何が必要ですか？少なくとも、HTMLドキュメントをアップロードし、ほとんどの場合、CSSやJavaScriptファイルなどの追加リソースをアップロードします。それらが利用可能になると、ブラウザはある種のレンダリングを開始できます。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">WebPageTest</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
チャートは、この記事全体で提供されています</font><font style="vertical-align: inherit;">。サイトのクエリシーケンスは、おそらく次のようになります。</font><font style="vertical-align: inherit;">
HTML文書は一連の追加ファイルをロードし、ダウンロード後にページがレンダリングされます。 CSSファイルは互いに並行して読み込まれるため、リクエストを追加するたびに大幅な遅延が発生することはありません。</font><font style="vertical-align: inherit;">
（注：スクリーンショットのgov.ukは、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">HTTP / 2が有効になって</font></a><font style="vertical-align: inherit;">いる例</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">です</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/36a/970/f6e/36a970f6e3069679776958e6e0ef10d8.png"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースドメインが既存の接続を再利用できるようにします。</font><font style="vertical-align: inherit;">サーバー接続については、以下を参照してください。）</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリングのブロッキング要求を減らす</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタイルシートと（デフォルトで）スクリプトは、その下のコンテンツのレンダリングをブロックします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを修正するいくつかのオプションがあります：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトタグを本文の下に移動する </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して非同期モードでスクリプトをダウンロードする </font></font><code>async</code><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSまたはCSSを順次ロードする必要がある場合は、小さなスニペットで埋め込むことをお勧めします</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリングをブロックする順次リクエストとの会話を避けます</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイトのレンダリングの遅延は、レンダリングをブロックする多数のリクエストに必ずしも関連しているわけではありません。</font><font style="vertical-align: inherit;">より重要なのは、各リソースのサイズとダウンロードの開始時間です。</font><font style="vertical-align: inherit;">つまり、ブラウザがこのリソースのダウンロードが必要であることを突然認識した瞬間です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラウザが別のリクエストを完了した後でのみファイルをダウンロードする必要があることを検出した場合、リクエストのチェーンがあります。</font><font style="vertical-align: inherit;">さまざまな理由で形成されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS </font><font style="vertical-align: inherit;">ルール</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSSファイルによって参照されるWebフォント</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウンロード可能なJavaScriptまたはスクリプトタグ</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例を見てみましょう：</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ebe/a1b/e44/ebea1be44487e800d63034b7fb2e9b79.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このサイトのCSSファイルの1つは、ルールを介してGoogleフォントを読み込みます</font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">つまり、ブラウザは次の要求を順番に実行する必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTMLドキュメント</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSSアプリケーション</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GoogleフォントのCSS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Font Woffファイル（図には表示されていません）</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを修正するには、まずGoogle Fonts CSSリクエストをタグ</font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からHTMLドキュメントのリンクに移動します。</font><font style="vertical-align: inherit;">したがって、チェーンを1つのリンクで短くします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらにスピードアップするには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Fonts CSSを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接HTMLまたはCSSファイル</font><font style="vertical-align: inherit;">に</font><b><font style="vertical-align: inherit;">埋め込み</font></b><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（Google FontsサーバーからのCSS応答はユーザーエージェントの行に依存することに注意してください。IE8を使用してリクエストを行うと、CSSはEOTファイルを参照し、IE11ブラウザーはwoffファイルを受け取り、最新のブラウザーはwoff2ファイルを受け取ります。古いブラウザはシステムフォントに限定されます。CSSファイルの内容をコピーして自分に貼り付けることができます）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レンダリングを開始した後でも、テキストを表示するにはフォントをロードする必要があるため、ユーザーはページを操作できません。</font><font style="vertical-align: inherit;">これは、回避したい追加のネットワーク遅延です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swapパラメータ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はここ</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">便利です</font><font style="vertical-align: inherit;">。これを使用すると</font></font><code>font-display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Google Fontsで</font><font style="vertical-align: inherit;">使用して</font><font style="vertical-align: inherit;">、フォントをローカルに保存できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリチェーンを解決できない場合があります。</font><font style="vertical-align: inherit;">このような場合は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プリロードタグまたは事前接続タグを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">検討</font><b><font style="vertical-align: inherit;">する</font></b><font style="vertical-align: inherit;">ことをお</font><b><font style="vertical-align: inherit;">勧めし</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、上記の例のWebサイトは</font></font><code>fonts.googleapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、実際のCSSリクエストが到着する前に</font><font style="vertical-align: inherit;">接続する場合</font><font style="vertical-align: inherit;">があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバー接続を再利用してリクエストを高速化する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーへの新しい接続を確立するには、通常、ブラウザとサーバー間で3つのパケット交換が必要です。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNSルックアップ</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP接続を確立する</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL接続を確立する</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続が確立された後、要求を送信して応答を受信するには、少なくとももう1つのパケット交換が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我々は、4つの異なるサーバーとの接続を開始することを示している下のチャート：</font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>optimizely.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>googletagmanager.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、と</font></font><code>googelapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">後続のサーバー要求で既存の接続が再利用される場合があります</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ダウンロードは</font></font><code>base.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どちらか</font></font><code>index1.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらが同じサーバー上に配置されているので、より速く起こり</font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、接続がすでに確立されています。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/78d/f76/03c/78df7603c84c54788fbec82a7d0622c7.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルサイズを縮小してCDNを使用する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリの実行時間に影響を与える2つの要素、つまりリソー​​スファイルのサイズとサーバーの場所を制御します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
できるだけ少ないデータをユーザーに送信し、それらが圧縮されていることを確認します（たとえば、brotliまたはgzipを使用して）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテンツ配信ネットワーク（CDN）には世界中にサーバーがあります。</font><font style="vertical-align: inherit;">中央サーバーに接続する代わりに、ユーザーはより近いCDNサーバーに接続できます。</font><font style="vertical-align: inherit;">したがって、パケット交換ははるかに高速になります。</font><font style="vertical-align: inherit;">これは、CSS、JavaScript、画像などの静的リソースに特に適しています。これは、CDNを介して簡単に配布できるためです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service Workerでネットワーク遅延を排除</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Service Workersを使用すると、リクエストをネットワークに送信する前にインターセプトできます。</font><font style="vertical-align: inherit;">つまり、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">答えはほぼ瞬時に得られ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c0c/5b2/7bd/c0c5b27bd4df5e42b3b8e57b2dfb02f2.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、これはネットワークからデータを受信する必要がない場合にのみ機能します。</font><font style="vertical-align: inherit;">回答はすでにキャッシュされているはずなので、2回目のアプリケーションのダウンロードからのみメリットが現れます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のService Workerは、ページのレンダリングに必要なHTMLとCSSをキャッシュします。</font><font style="vertical-align: inherit;">アプリケーションが再度ロードされると、キャッシュされたリソース自体を提供しようとします-利用できない場合にのみネットワークにアクセスします。</font></font><br>
<br>
<pre><code class="javascript hljs">self.addEventListener(<span class="hljs-string">"install"</span>, <span class="hljs-keyword">async</span> e =&gt; {<font></font>
 caches.open(<span class="hljs-string">"v1"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cache</span>) </span>{
   <span class="hljs-keyword">return</span> cache.addAll([<span class="hljs-string">"/app"</span>, <span class="hljs-string">"/app.css"</span>]);<font></font>
 });<font></font>
});<font></font>
<font></font>
self.addEventListener(<span class="hljs-string">"fetch"</span>, event =&gt; {<font></font>
 event.respondWith(<font></font>
   caches.match(event.request).then(<span class="hljs-function"><span class="hljs-params">cachedResponse</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> cachedResponse || fetch(event.request);<font></font>
   })<font></font>
 );<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、このガイド、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プリロードとキャッシュのリソースへのサービス勤労者の使用に詳細に説明しました。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションをダウンロード</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ユーザーは画面上に何かを見ます。</font><font style="vertical-align: inherit;">彼がアプリケーションを使用するには、どのような追加の手順が必要ですか？</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションコードのダウンロード（JSおよびCSS）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページに必要なデータをダウンロードします</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加のデータと画像をダウンロードする</font></font></li>
</ol><br>
<img src="https://habrastorage.org/getpro/habr/post_images/175/e7f/810/175e7f810d7e33f9647203ad609b402f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークからデータをダウンロードするだけでなく、レンダリングが遅れることがあることに注意してください。</font><font style="vertical-align: inherit;">コードが読み込まれると、ブラウザはそれを分析、コンパイル、実行します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なコードのみをダウンロードして、キャッシュ内のヒット数を最大化します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「パッケージの分割」とは、アプリケーション全体ではなく、現在のページに必要なコードのみをダウンロードすることを意味します。</font><font style="vertical-align: inherit;">また、他の部分が変更されて再ロードする必要がある場合でも、パッケージの一部をキャッシュできることも意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、コードは次の部分に分かれています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定のページのコード（ページ固有）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的なアプリケーションコード</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほとんど変更されないサードパーティのモジュール（キャッシングに最適！）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webpackは自動的にこの最適化を実行し、コードを中断して、全体的な負荷の重みを減らします。</font><font style="vertical-align: inherit;">コードは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimization.splitChunks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトを使用して細かく分割されています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ランタイム（ランタイム）を別のファイルに分離します。これにより、長期キャッシュのメリットを得ることができます。</font><font style="vertical-align: inherit;">Ivan Akulovは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージを個別のファイルに分割し、Webpackにキャッシュする方法の詳細なガイドを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書きました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定のページにコードを自動的に割り当てることはできません。</font><font style="vertical-align: inherit;">個別にダウンロードできるパーツを手動で識別する必要があります。</font><font style="vertical-align: inherit;">多くの場合、これは特定のパスまたはページのセットです。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動的インポート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">して、このコードを遅延ロードします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージ全体をパーツに分割すると、アプリケーションをダウンロードするリクエストの数が増えます。しかし、リクエストが並行して実行される場合、特にサイトがHTTP / 2プロトコルを使用してロードされる場合、これは大きな問題ではありません。次の図の最初の3つのクエリでこれを確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/995/816/714/9958167144c54dc634d1b7daa03077e3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、</font><font style="vertical-align: inherit;">図に</font><font style="vertical-align: inherit;">は2つの連続したクエリも表示されています。これらのフラグメントは、この特定のページにのみ必要であり、を通じて動的にロードされます</font></font><code>import()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タグプリロード</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プリロードを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">挿入することで、問題の修正を試みることができ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/955/2cf/efc/9552cfefcbb751b50e378a0834320b73.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ページの総読み込み時間が増加していることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リソースのプリロードは、より重要なファイルのロードを遅らせるため、逆効果になる場合があります。読んだ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォントのプリロード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、この手順がページレンダリングの開始をブロックする方法</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">に関するAndy Davisの記事</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページのデータをロードする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションはおそらくいくつかのデータを表示するはずです。</font><font style="vertical-align: inherit;">不必要なレンダリングの遅延なしにこのデータを早期にダウンロードするために使用できるいくつかのヒントを次に示します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データのダウンロードを開始する前に、パッケージの完全なダウンロードを待たないでください。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一連の順次リクエストの特殊なケースを次に示します。アプリケーションパッケージ全体をダウンロードしてから、このコードがページに必要なデータをリクエストします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを回避するには2つの方法があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTMLドキュメントにデータを埋め込む</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント内の組み込みスクリプトを使用してデータリクエストを実行する</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データをHTMLに埋め込むことで、アプリケーションがデータの読み込みを待機することがなくなります。また、起動ステータスを処理する必要がないため、システムの複雑さが軽減されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、このような手法で最初のレンダリングが遅れる場合は、これは良い考えではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、およびService Workerを介してキャッシュされたHTMLドキュメントを送信する場合は、組み込みスクリプトを使用して、このデータを代替としてダウンロードできます。あなたはそれをグローバルオブジェクトとして利用可能にすることができます、これが約束です：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">window</span>.userDataPromise = fetch(<span class="hljs-string">"/me"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データの準備ができていて、そのような状況の場合、アプリケーションはすぐにレンダリングを開始するか、準備ができるまで待つことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
両方の方法を使用する場合は、アプリケーションがレンダリングを開始する前に、ページがロードするデータを事前に知っておく必要があります。</font><font style="vertical-align: inherit;">これは通常、ユーザー関連データ（ユーザー名、通知など）の場合は明白ですが、特定のページに固有のコンテンツの場合はさらに難しくなります。</font><font style="vertical-align: inherit;">おそらく、最も重要なページを強調表示し、それらの独自のロジックを記述することは理にかなっています。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無関係なデータを待っている間、レンダリングをブロックしないでください</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データを生成するために、バックエンドで低速の複雑なロジックを実行する必要がある場合があります。</font><font style="vertical-align: inherit;">このような場合、アプリケーションが機能的でインタラクティブになるのに十分であれば、最初にデータのより単純なバージョンをダウンロードしてみることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、分析ツールは、データをロードする前に、最初にすべてのグラフのリストをダウンロードできます。</font><font style="vertical-align: inherit;">これにより、ユーザーは興味のある図をすぐに検索でき、バックエンド要求を別のサーバーに分散するのにも役立ちます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/996/ab6/613/996ab66136976b0b22d95e7778fb4664.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">連続するデータクエリを回避する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、必須でないデータを別のリクエストで出力する方がよいという前の段落と矛盾する可能性があります。</font><font style="vertical-align: inherit;">したがって、それを明確にする必要があります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完了した各要求がユーザーに詳細情報を表示するという事実につながらない場合</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、順次データ要求を伴うチェーンを避け</font><i><font style="vertical-align: inherit;">てください</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ログインしているユーザーを最初に照会してからグループのリストを要求する代わりに、最初の要求でユーザー情報とともにグループのリストをすぐに返します。</font><font style="vertical-align: inherit;">これ</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用できます</font><font style="vertical-align: inherit;">が、エンドポイント</font></font><code>user?includeTeams=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も正常に機能します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバー側レンダリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバー側のレンダリングとは、アプリケーションを事前にレンダリングすることを意味します。そのため、クライアントのリクエストで全ページHTMLが返されます。クライアントは、追加のコードやデータが読み込まれるのを待たずに、ページが完全にレンダリングされたことを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーはクライアントに静的HTMLのみを送信するため、この時点ではアプリケーションはインタラクティブではありません。アプリケーション自体をダウンロードし、レンダリングロジックを開始して、必要なイベントリスナーをDOMに接続する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非インタラクティブなコンテンツを表示すること自体が価値がある場合は、サーバー側のレンダリングを使用します。レンダリングされたHTMLをサーバーにキャッシュし、遅滞なくすぐにすべてのユーザーに返すのも良い方法です。たとえば、Reactを使用してブログ投稿を表示する場合、サーバー側のレンダリングは優れています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Yanashekによるこの記事では、Service Worker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とサーバー側レンダリングを組み合わせる方法について説明しています。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のページ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある時点で、ユーザーはボタンを押して次のページに移動しようとしています。</font><font style="vertical-align: inherit;">スタートページを開いた瞬間から、ブラウザーで発生することを制御するため、次の対話に備えることができます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースのプリロード</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のページに必要なコードをプリロードすると、ユーザーがナビゲーションを開始したときに遅延がなくなります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プリフェッチタグを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用する</font><font style="vertical-align: inherit;">か</font></font><code>webpackPrefetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、動的インポートに</font><font style="vertical-align: inherit;">使用し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>(
    <span class="hljs-comment">/* webpackPrefetch: true, webpackChunkName: "todo-list" */</span> <span class="hljs-string">"./TodoList"</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特にユーザーがモバイル接続で接続されている場合は、トラフィックと帯域幅の観点からユーザーにどのような負荷をかけるかを検討してください。</font><font style="vertical-align: inherit;">人がサイトのモバイルバージョンをダウンロードし、データストレージモードがアクティブな場合は、あまり積極的にプリロードしない方が合理的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーが以前に必要とするアプリケーションの部分を戦略的に検討します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウンロード済みデータの再利用</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションのデータをローカルにキャッシュし、それを使用して将来のリクエストを回避します。</font><font style="vertical-align: inherit;">ユーザーがグループのリストから[グループの編集]ページに移動した場合、グループについて以前にダウンロードしたデータを再利用することで、すぐに切り替えることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクトが他のユーザーによって頻繁に編集され、ダウンロードされたデータが古くなる場合、これは機能しないことに注意してください。</font><font style="vertical-align: inherit;">これらの場合、更新されたデータのリクエストを同時に実行すると同時に、既存の読み取り専用データを最初に表示するオプションがあります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、読み込みプロセスのさまざまな段階でページの速度を低下させる可能性があるいくつかの要因を示します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome DevTools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lighthouse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのツール</font><font style="vertical-align: inherit;">は、これらの要因のどれがアプリケーションに影響するかを理解するのに役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、最適化がすぐにすべての方向に進むことはめったにありません。ユーザーに最も大きな影響を与えるものを見つけ、それに集中する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事を書いているときに、1つの重要なことに気づきました。個々のサーバー要求の多くはパフォーマンスに悪影響を及ぼすという確信が根強くありました。</font><font style="vertical-align: inherit;">これは、各リクエストが個別の接続を必要とし、ブラウザがドメインごとに少数の接続しか許可しなかった以前のケースです。</font><font style="vertical-align: inherit;">しかし、HTTP / 2と最新のブラウザーでは、これはもはや当てはまりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションを複数の部分に分割すること（クエリを乗算すること）を支持する良い議論があります。</font><font style="vertical-align: inherit;">これにより、必要なリソースのみをダウンロードできます。変更されたファイルのみを再ロードする必要があるため、キャッシュを使用することをお勧めします。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490196/index.html">[Flipper Zero]はRaspberry Piを拒否し、独自のボードを最初から作成します。適切なWiFiチップを見つける</a></li>
<li><a href="../ja490198/index.html">信頼するが検証する！デモホールPult.ruのホームシアター用のエプソンプロジェクターを備えたデモゾーン</a></li>
<li><a href="../ja490202/index.html">クエリのカウント：基本的なDjangoパフォーマンステスト</a></li>
<li><a href="../ja490204/index.html">2020年3月の人事およびIT採用担当者向けイベントのダイジェスト</a></li>
<li><a href="../ja490208/index.html">DUMP2020のバックエンドセクション：banter、fan、fail</a></li>
<li><a href="../ja490222/index.html">死の日標準ライブラリ</a></li>
<li><a href="../ja490224/index.html">おしゃれなステルス</a></li>
<li><a href="../ja490226/index.html">ブレンディングとユニティテレイン：交差点を取り除き、目を傷つけないようにする方法</a></li>
<li><a href="../ja490232/index.html">AWS ELBを使用した負荷分散</a></li>
<li><a href="../ja490234/index.html">Auroraのモバイルバンクをどのように実行したか：国内のモバイルOSの開発機能</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>