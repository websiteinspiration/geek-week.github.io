<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüåæ üöÑ ü¶Ç 10 l√≠neas de c√≥digo para reducir el dolor de su proyecto Vue üí´ üôãüèø üèë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... o familiaridad con los complementos Vue JS como ejemplo de un bus de eventos integrado
 Algunas palabras sobre ...
 ¬°Hola a todos! Har√© una reserv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>10 l√≠neas de c√≥digo para reducir el dolor de su proyecto Vue</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odin_ingram_micro/blog/488422/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... o familiaridad con los complementos Vue JS como ejemplo de un bus de eventos integrado</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunas palabras sobre ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Hola a todos! </font><font style="vertical-align: inherit;">Har√© una reserva de inmediato. </font><font style="vertical-align: inherit;">Realmente amo a VueJS, he estado escribiendo activamente sobre √©l durante m√°s de 2 a√±os y no creo que el desarrollo pueda da√±ar al menos en un grado significativo :)</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por otro lado, siempre estamos tratando de encontrar soluciones universales que ayuden a pasar menos tiempo en trabajos mec√°nicos y m√°s en lo que es realmente interesante. A veces la soluci√≥n es particularmente exitosa. Una de estas que quiero compartir con ustedes. Las 10 l√≠neas que se discutir√°n (spoiler: al final habr√° un poco m√°s) nacieron en el proceso de trabajo en el proyecto Cloud Blue - Connect, que es una aplicaci√≥n bastante grande con m√°s de 400 componentes. La soluci√≥n que encontramos ya est√° integrada en varios puntos del sistema y durante m√°s de medio a√±o nunca ha requerido correcciones, por lo que se puede considerar de forma segura probada con √©xito para determinar la estabilidad.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el √∫ltimo. </font><font style="vertical-align: inherit;">Antes de proceder directamente a la soluci√≥n, me gustar√≠a detenerme un poco m√°s en la descripci√≥n de los tres tipos de interacci√≥n entre los componentes Vue entre ellos: los principios del flujo unidireccional, el patr√≥n de la tienda y el bus de eventos. </font><font style="vertical-align: inherit;">Si esta explicaci√≥n es innecesaria (o aburrida) para usted, vaya directamente a la secci√≥n con la soluci√≥n: todo es lo m√°s breve y t√©cnico posible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco sobre c√≥mo los componentes Vue se comunican entre s√≠</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s la primera pregunta que plantea una persona que escribi√≥ su primer componente es c√≥mo recibir√° los datos para el trabajo y c√≥mo, a su vez, transmitir√° los datos que recibi√≥ "fuera". </font><font style="vertical-align: inherit;">El principio de interacci√≥n adoptado en el marco Vue JS se llama ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flujo de datos unidireccional</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En resumen, este principio suena como "propiedades - abajo, eventos - arriba". Es decir, para recibir datos del exterior ("desde arriba"), registramos una propiedad especial dentro del componente en el que el marco escribe, si es necesario, nuestros datos recibidos "del exterior". Para transferir datos "hacia arriba", dentro del componente en el lugar correcto, llamamos al m√©todo de marco especial $ emit, que pasa nuestros datos al controlador del componente principal. Al mismo tiempo, en Vue JS no podemos simplemente "transmitir" el evento hasta una profundidad ilimitada (como por ejemplo en Angular 1.x). "Emerge" solo un nivel, al padre inmediato. Lo mismo ocurre con los eventos. Para transferirlos al siguiente nivel, para cada uno de ellos tambi√©n debe registrar una interfaz especial: propiedades y eventos que transmitir√°n nuestro "mensaje" a√∫n m√°s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto puede describirse como un edificio de oficinas en el que los trabajadores solo pueden moverse de sus pisos a los vecinos, uno arriba y otro abajo. Entonces, para transferir el "documento de firma" del quinto piso al segundo, se requerir√° una cadena de tres trabajadores que lo entregar√°n del quinto piso al segundo, y luego tres m√°s que lo devolver√°n al quinto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"¬°Pero esto es inconveniente!" Por supuesto, esto no siempre es conveniente desde el punto de vista del desarrollo, pero al observar el c√≥digo de cada componente, podemos ver qu√© y a qui√©n le pasa. No necesitamos tener en cuenta toda la estructura de la aplicaci√≥n para comprender si nuestro componente est√° "en camino" al evento o no. Podemos ver esto desde el componente padre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque las ventajas de este enfoque son comprensibles, tambi√©n tiene desventajas obvias, a saber, la alta cohesi√≥n de los componentes. </font><font style="vertical-align: inherit;">En pocas palabras, para que podamos colocar alg√∫n componente en la estructura, debemos superponerlo con las interfaces necesarias para administrar su estado. </font><font style="vertical-align: inherit;">Para reducir esta conectividad, a menudo usan "herramientas de administraci√≥n de estado". </font><font style="vertical-align: inherit;">Quiz√°s la herramienta m√°s popular para Vue es ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vuex (lado)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continuando con nuestra analog√≠a con un edificio de oficinas, Vuex Stor es un servicio postal interno. Imagine que en cada piso de la oficina hay una ventana para emitir y recibir paquetes. En el quinto piso transfieren el documento No. 11 para su firma, y ‚Äã‚Äãen el segundo preguntan peri√≥dicamente: "¬øHay alg√∫n documento para la firma?", Firme los documentos existentes y devu√©lvalos. En el quinto tambi√©n preguntan: "¬øHay firmantes?" Al mismo tiempo, los empleados pueden trasladarse a otros pisos o a otras habitaciones: el principio del trabajo no cambiar√° mientras el correo est√© funcionando. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aproximadamente por este principio, el patr√≥n llamado Tienda tambi√©n funciona. Mediante la interfaz Vuex, se registra y configura un almac√©n de datos global, y los componentes se suscriben a √©l. Y no importa en qu√© nivel de estructura se produjo la apelaci√≥n, la tienda siempre proporcionar√° la informaci√≥n correcta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que en esto todos los problemas ya han sido resueltos. Pero en alg√∫n momento de nuestro edificio metaf√≥rico, un empleado quiere llamar a otro para almorzar ... o informar alg√∫n tipo de error. Y aqu√≠ comienza lo extra√±o. El mensaje en s√≠ no requiere transmisi√≥n como tal. Pero para usar el correo necesitas transferir algo. Entonces nuestros empleados inventan un c√≥digo. Una bola verde - vaya a almorzar, dos cubos rojos - se produjo un error de aplicaci√≥n E-981273, tres monedas amarillas - revise su correo y as√≠ sucesivamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es f√°cil adivinar que con la ayuda de esta inc√≥moda met√°fora describo situaciones en las que necesitamos asegurar la respuesta de nuestro componente a un evento que ocurri√≥ en otro componente, que en s√≠ mismo no est√° conectado de ninguna manera con el flujo de datos. </font><font style="vertical-align: inherit;">Se ha completado el guardado de un nuevo elemento: debe volver a tomar la colecci√≥n. </font><font style="vertical-align: inherit;">Se ha producido un error no autorizado 403: debe iniciar un cierre de sesi√≥n de usuario, etc. </font><font style="vertical-align: inherit;">La pr√°ctica habitual (y lejos de ser la mejor) en este caso es crear banderas dentro de la tienda o interpretar indirectamente los datos almacenados y sus cambios. </font><font style="vertical-align: inherit;">Esto conduce r√°pidamente a la contaminaci√≥n tanto de la tienda como de la l√≥gica de los componentes que la rodean. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, comenzamos a pensar en c√≥mo pasar eventos directamente, sin pasar por toda la cadena de componentes. </font><font style="vertical-align: inherit;">Y, un poco de google o hurgando en la documentaci√≥n, nos encontramos con un patr√≥n ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bus de eventos</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde un punto de vista t√©cnico, el bus de eventos es un objeto que permite usar un m√©todo especial para lanzar un "evento" y suscribirse a √©l usando otro. En otras palabras, cuando se suscribe al evento eventA, este objeto almacena la funci√≥n del controlador transferido dentro de su estructura, que llamar√° cuando se llame al m√©todo de lanzamiento con la tecla eventA en alg√∫n lugar de la aplicaci√≥n. Para firmar o ejecutar es suficiente acceder a √©l a trav√©s de importaci√≥n o por referencia, y ya est√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metaf√≥ricamente, en nuestro "edificio", un autob√∫s es un chat com√∫n en el messenger. Los componentes se suscriben a un "chat general" al que otros componentes env√≠an mensajes. Tan pronto como aparezca un "mensaje" en el "chat", al que se ha suscrito el componente, se iniciar√° el controlador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchas formas diferentes de crear un bus de eventos. </font><font style="vertical-align: inherit;">Puede escribirlo usted mismo o puede usar soluciones listas para usar, el mismo RxJS, que proporciona una gran funcionalidad para trabajar con secuencias enteras de eventos. </font><font style="vertical-align: inherit;">Pero la mayor√≠a de las veces cuando trabajan con VueJS usan, por extra√±o que parezca, VueJS en s√≠. </font><font style="vertical-align: inherit;">La instancia de Vue creada a trav√©s del constructor (nuevo Vue ()) proporciona una interfaz de eventos hermosa y concisa, descrita en la documentaci√≥n oficial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ nos acercamos a la siguiente pregunta ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© queremos?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y queremos construir un bus de eventos en nuestra aplicaci√≥n. </font><font style="vertical-align: inherit;">Pero tenemos dos requisitos adicionales:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debe ser f√°cilmente accesible en todos los componentes. </font><font style="vertical-align: inherit;">Las importaciones separadas en cada una de las docenas de componentes nos parecen redundantes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debe ser modular. </font><font style="vertical-align: inherit;">No queremos tener en cuenta todos los nombres de eventos para evitar la situaci√≥n en la que el evento "creado por elemento" dispara controladores de toda la aplicaci√≥n. </font><font style="vertical-align: inherit;">Por lo tanto, queremos poder separar f√°cilmente un peque√±o fragmento del √°rbol de componentes en un m√≥dulo separado y transmitir sus eventos dentro y no fuera.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implementar una funcionalidad tan impresionante, utilizamos la potente interfaz de complemento que nos proporciona VueJS. </font><font style="vertical-align: inherit;">Puede familiarizarse con √©l con m√°s detalle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en la p√°gina con documentaci√≥n oficial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Registremos nuestro complemento primero. </font><font style="vertical-align: inherit;">Para hacer esto, justo antes del punto de inicializaci√≥n de nuestra aplicaci√≥n Vue (antes de llamar a Vue. $ Mount ()) colocamos el siguiente bloque:</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { }, <font></font>
});<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, los complementos de Vue son una forma de extender la funcionalidad del marco a todo el nivel de aplicaci√≥n. La interfaz del complemento proporciona varias formas de integrarse en el componente, pero hoy presentaremos la interfaz mixin. Este m√©todo acepta un objeto que ampl√≠a el descriptor de cada componente antes de comenzar el ciclo de vida en la aplicaci√≥n.</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(El c√≥digo de componente que escribimos es m√°s probable que no sea el componente en s√≠, sino una descripci√≥n de su comportamiento y encapsulaci√≥n de una cierta parte de la l√≥gica, que es utilizada por el marco en varias etapas durante el ciclo de vida. La inicializaci√≥n del complemento est√° fuera del ciclo de vida del componente, precedi√©ndolo, por lo tanto, decimos "descriptor", no un componente, para enfatizar que exactamente el c√≥digo que est√° escrito en nuestro archivo, y no alguna entidad que sea el producto del trabajo del marco) ser√° transferido a la secci√≥n mixin del complemento)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({<font></font>
  install(vue) {     <font></font>
    vue.mixin({}); <span class="hljs-comment">// &lt;--</span><font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es este objeto vac√≠o el que contendr√° las extensiones para nuestros componentes. Pero para empezar, otra parada. En nuestro caso, queremos crear una interfaz para acceder al bus en el nivel de cada componente. Agreguemos el campo '$ broadcast' a nuestro descriptor, almacenar√° un enlace a nuestro bus. Para hacer esto, use Vue.prototype:</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <span class="hljs-comment">// &lt;--</span><font></font>
    vue.mixin({}); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora necesitamos crear el bus en s√≠, pero primero, recordemos el requisito de modularidad y supongamos que en el descriptor de componentes declararemos el nuevo m√≥dulo con el campo "$ module" con alg√∫n valor de texto (lo necesitaremos un poco m√°s adelante). </font><font style="vertical-align: inherit;">Si el campo $ module se especifica en el componente mismo, crearemos un nuevo bus para √©l; de lo contrario, pasaremos el enlace al padre a trav√©s del campo $ parent. </font><font style="vertical-align: inherit;">Tenga en cuenta que los campos del descriptor estar√°n disponibles para nosotros a trav√©s del campo $ options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Colocaremos la creaci√≥n de nuestro autob√∫s en la etapa m√°s temprana posible, en el gancho beforeCreate.</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({<font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <font></font>
    vue.mixin({<font></font>
      beforeCreate() {  <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {  <span class="hljs-comment">// &lt;--</span><font></font>
         <font></font>
 	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) {  <span class="hljs-comment">// &lt;--</span><font></font>
         <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, completemos las ramas l√≥gicas. </font><font style="vertical-align: inherit;">Si el descriptor contiene una nueva declaraci√≥n de m√≥dulo, cree una nueva instancia de bus; de lo contrario, tome el enlace de $ parent.</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue();  <span class="hljs-comment">// &lt;--</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast;  <span class="hljs-comment">// &lt;--</span><font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descartamos el anuncio del complemento, consideramos ... 1, 2, 3, 4 ... 10 l√≠neas, como lo promet√≠. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPodemos hacerlo mejor?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto que podemos. </font><font style="vertical-align: inherit;">Este c√≥digo es f√°cilmente extensible. </font><font style="vertical-align: inherit;">Por ejemplo, en nuestro caso, adem√°s de $ broadcast, decidimos agregar la interfaz $ rootBroadcast, que brinda acceso a un solo bus para toda la aplicaci√≥n. </font><font style="vertical-align: inherit;">Los eventos que el usuario ejecuta en el bus $ broadcast se duplican en el bus $ rootBroadcast para que pueda suscribirse a todos los eventos de un m√≥dulo en particular (en este caso, el nombre del evento se pasar√° al controlador como primer argumento) o a todos los eventos de la aplicaci√≥n en general (luego el nombre del m√≥dulo se pasar√° al controlador con el primer argumento, el nombre del evento con el segundo y los datos transmitidos con el evento se pasar√°n con los siguientes argumentos). </font><font style="vertical-align: inherit;">Este dise√±o nos permitir√° establecer la interacci√≥n entre los m√≥dulos, as√≠ como colgar un solo controlador en los eventos de los diferentes m√≥dulos.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// This one emits event  </span>
<span class="hljs-keyword">this</span>.$broadcast.$emit(‚Äòmy-event‚Äô, ‚ÄòPARAM_A‚Äô); 
<span class="hljs-comment">// This is standard subscription inside module </span>
<span class="hljs-keyword">this</span>.$broadcast.$on(‚Äòmy-event‚Äô, (paramA) =&gt; {‚Ä¶}); 
<span class="hljs-comment">// This subscription will work for the same event </span>
<span class="hljs-keyword">this</span>.$rootBroadcast.$on(‚Äòmy-event‚Äô, (<span class="hljs-built_in">module</span>, paramA) =&gt; {‚Ä¶}); 
<span class="hljs-comment">// This subscription will also work for the same event </span>
<span class="hljs-keyword">this</span>.$rootBroadcast.$on(‚Äò*‚Äô, (event, <span class="hljs-built_in">module</span>, paramA) =&gt; {‚Ä¶});
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos c√≥mo podemos lograr esto: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, cree un solo bus, al que se acceder√° a trav√©s de $ rootBroadcast, y el campo en s√≠ con un enlace:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue(); <span class="hljs-comment">// &lt;--</span><font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus; <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue(); <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast; <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora necesitamos la membres√≠a del m√≥dulo en cada componente, as√≠ que ampliemos la definici√≥n de modularidad como esta:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue(); <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast; <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, debemos hacer que el evento en el bus local modular se refleje en la forma en que lo necesitamos para la ra√≠z. </font><font style="vertical-align: inherit;">Para hacer esto, primero tenemos que crear una interfaz proxy simple y colocar el bus en la propiedad condicionalmente privada de $ bus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <span class="hljs-comment">// &lt;--</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };  <span class="hljs-comment">// &lt;--</span><font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y finalmente, agregue m√©todos proxy al objeto, porque ahora el campo $ broadcast no proporciona acceso directo al bus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };<font></font>
        } <font></font>
        <span class="hljs-comment">// &gt;&gt;&gt;</span>
        <span class="hljs-keyword">this</span>.$broadcast.$emit = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$emit(‚Ä¶attrs);           
          <span class="hljs-keyword">const</span> [event, ‚Ä¶attributes] = attrs; 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)); 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(‚Äò*‚Äô, event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)<font></font>
        };<font></font>
        <font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$on = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {           
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$on(‚Ä¶attrs);<font></font>
        };<font></font>
        <span class="hljs-comment">// &lt;&lt;&lt;</span><font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, como toque final, recordemos que tenemos acceso al bus al cerrar, lo que significa que los controladores agregados una vez no se borrar√°n con el componente, sino que vivir√°n durante todo el tiempo de trabajo con la aplicaci√≥n. Esto puede causar efectos secundarios desagradables, as√≠ que agreguemos una funci√≥n de limpieza de escucha a nuestro bus al final del ciclo de vida del componente:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeDestroy() {                               <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">this</span>.$broadcast.$off(<span class="hljs-keyword">this</span>.$broadcastEvents);  <span class="hljs-comment">// &lt;--</span><font></font>
      },<font></font>
<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">this</span>.$broadcastEvents = [];  <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };<font></font>
        } <font></font>
<font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$emit = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {
          <span class="hljs-keyword">this</span>.$broadcastEvents.push(attrs[<span class="hljs-number">0</span>]);   <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$emit(‚Ä¶attrs);           
          <span class="hljs-keyword">const</span> [event, ‚Ä¶attributes] = attrs; 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)); 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(‚Äò*‚Äô, event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)<font></font>
        };<font></font>
        <font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$on = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {           
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$on(‚Ä¶attrs);<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$off =: <span class="hljs-function">(<span class="hljs-params">...attrs</span>) =&gt;</span> {  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$off(...attrs);   <span class="hljs-comment">// &lt;--</span><font></font>
        };<font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, esta opci√≥n proporciona una funcionalidad m√°s interesante, aunque menos concisa. </font><font style="vertical-align: inherit;">Con √©l, puede implementar un sistema completo de comunicaci√≥n alternativa entre componentes. </font><font style="vertical-align: inherit;">Adem√°s, est√° completamente bajo nuestro control y no trae dependencias externas a nuestro proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que despu√©s de leer haya adquirido o actualizado su conocimiento de los complementos de Vue, y tal vez la pr√≥xima vez que necesite agregar alguna funcionalidad gen√©rica a su aplicaci√≥n, pueda implementarlo de manera m√°s eficiente, sin agregar dependencias externas.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488408/index.html">Puerta de enlace IoT Ethernet-RS485 STM32</a></li>
<li><a href="../es488410/index.html">7 lecciones que aprend√≠ en diez a√±os en desarrollo</a></li>
<li><a href="../es488412/index.html">Crear un bot de Discord basado en discord.js</a></li>
<li><a href="../es488416/index.html">SLAE - Examen experto en ensamblaje de Linux de seguridad</a></li>
<li><a href="../es488418/index.html">Autenticaci√≥n API REST con Spring Security y MongoDB</a></li>
<li><a href="../es488424/index.html">¬øQu√© pasar√° con ITSM en 2020?</a></li>
<li><a href="../es488426/index.html">¬øC√≥mo hacer una revisi√≥n de c√≥digo? Parte 2: revisar navegaci√≥n, velocidad, comentarios, conflictos</a></li>
<li><a href="../es488428/index.html">¬øC√≥mo predecimos el futuro en la b√∫squeda de Yandex: desde correcciones de errores hasta consultas de descubrimiento?</a></li>
<li><a href="../es488432/index.html">Snoop Project, una herramienta incre√≠ble para la inteligencia de Internet, que los usuarios de RuNet han estado esperando durante tanto tiempo, est√° disponible</a></li>
<li><a href="../es488436/index.html">Cree r√°pidamente m√∫sica de chiptune de c√≥digo abierto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>