<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌭 🙆 🙏🏽 Assembling an 8-bit computer: how to reduce the number of chips to six 💪🏾 👩‍🏭 🤛🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The combination of the old trick with NTSC color coding and modern hardware allows you to build a surprisingly workable machine.
 
 In 8-bit systems, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Assembling an 8-bit computer: how to reduce the number of chips to six</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/494124/"><img src="https://habrastorage.org/webt/10/p7/70/10p770cfa9wj0aj3xrs0ajhonoq.jpeg"><br>
<font color="99999999"><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The combination of the old trick with NTSC color coding and modern hardware allows you to build a surprisingly workable machine.</font></font></sup></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In 8-bit systems, there is something permanently attractive: you can build an autonomous system powerful enough to support adequate user interaction, but simple enough to assemble and program it yourself. Most modern 8-bit machines created by amateurs are tied to classic processors that lived in the</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> golden age of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> home computers in the 1980s, when millions of TVs were used as displays. Initially, the idea was to build my car based on the</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Motorola 6809 processor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the same era. I tried to use as few chips as possible, but despite my efforts, I still needed 13 additional chips to work with RAM and serial data transfer. Then I thought: what if I use a more modern 8-bit processor? How much can I reduce the number of chips I need?</font></font><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, I assembled a car on it, which was called </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amethyst</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Like any home computer, it has a built-in keyboard and can output audio and video. It also has a high-level built-in programming language so that users can write their own programs on it. I managed to reduce the number of microcircuits to six: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ATMEGA1284P</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CPU, USB-interface and four simple integrated circuits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The 2008 ATMEGA1284P (or 1284P) has 128 kilobytes of flash memory and 16 kilobytes of RAM. It can operate with a frequency of up to 20 megahertz. It has onboard integrated serial controllers and 32 digital inputs / outputs.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/6GKgxBEGH1M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks to the built-in memory and serial interfaces, the need for many auxiliary chips disappeared. </font><font style="vertical-align: inherit;">I could directly generate audio, interrupting and applying a signal to the input / output with different frequencies. </font><font style="vertical-align: inherit;">Thus, I learned to give out a tone that, however, possessed the characteristic sharpness of a square wave. </font><font style="vertical-align: inherit;">But what about generating an analog video signal? </font><font style="vertical-align: inherit;">Will this really require special equipment?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standard trick</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the end of 2018, I saw a trick that Steve Wozniak used in the 1970s to implement color graphics support in Apple II. In the USA, this trick was used for color broadcasting in the NTSC system back in the 1950s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, American television was only black and white and used the fairly simple NTSC standard (developed by the National Committee for Television Systems). To form an image on the screen, an electron beam traced points on its surface, row after row. The amplitude of the received video signal determined the brightness of the beam at any given location along the row. Then in 1953, NTSC </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">was upgraded</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to support color television, while maintaining compatibility with existing black and white TVs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Engineers decided to present color information in the form of a high-frequency sinusoidal signal. For this, the subcarrier was divided into two components with a phase shift of 90 °, each of which underwent modulation. The result was a signal modulated in both amplitude and phase. The amplitude of the signal determined how saturated the color should be. This high-frequency chroma signal was then added to the low-frequency luminance signal to create the so-called composite video signal. This method is still used for many televisions and cheaper displays.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bu/u_/aw/buu_awktun52nw_57p5oi95vopm.png"><br>
<br>
<blockquote><i><b>« »</b>:    ,    [ ],   - ,         [ ].      .         [ ]   ,       :      .             [ ],          .</i></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A black and white TV perceives a color signal as noise and ignores it. But a color TV can separate the color signal from the luminance signal using filter loops.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the 1970s, engineers realized that this filtering scheme could be very useful for home computers because it allows a rectangular digital signal to simulate most of the composite analog signal. The stream of zeros sent by the computer to the TV will be perceived as a constant low-frequency analog voltage, that is, black. The flow of units will be considered as a constant high-frequency voltage, that is, white. But with a sufficiently high bit rate, more complex binary structures will arise that the high-pass filtering schemes recognize as color signals. This trick allowed Apple II to display up to 16 colors.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first, I thought that I needed to switch the input / output pin very quickly in order to directly generate a video signal. However, I soon realized that with my 1284P running at 14.318 MHz, I couldn't switch it fast enough to display more than four colors. The fact is that its built-in serial interfaces would need two clock cycles to send one bit, which would limit my clock frequency to 7.159 MHz. Apple II used fast direct memory access to connect its external chip to the video output, while its CPU was busy with internal processing. But, since the RAM of my computer is integrated into the chip, I could not use this approach.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So I looked into my drawers and pulled out four 7400 series microcircuits - two multiplexers and two parallel-serial shift registers. </font><font style="vertical-align: inherit;">I was able to install eight 1284P pins in parallel and send data from them simultaneously to the multiplexers and shift registers, which convert them into a high-speed serial bit stream. </font><font style="vertical-align: inherit;">Thus, I learned how to generate bits fast enough to display about 215 different colors on the screen. </font><font style="vertical-align: inherit;">However, I had to pay for it with my computing power: video processing constantly eats up 75% of the processor’s resources.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/67/ti/wd/67tiwdceh1mxpre-pg9qypcb43o.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compact computer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amethyst is a single board computer. It is assembled from only six integrated circuits - a processor, a USB interface and four 7400 series microcircuits, which are used to create a 215-color image. The keyboard switches are soldered directly to the board, which also supports audio and four serial I / O connections for peripherals such as game controllers and storage devices. You can write programs and run them thanks to the built-in virtual machine Forth.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I needed a lightweight programming environment for users, which made me choose Forth instead of the traditional Basic. Forth is an old programming language for embedded systems, it supports interactivity and is able to efficiently compile code. With it, you can do quite a lot using the minimum amount of resources. Since the 1284P does not allow compiled machine code to be executed directly from its RAM, user code is instead compiled into intermediate bytecode. This bytecode is then fed as input to a virtual machine running from 1284P flash memory. The virtual machine code was written in assembler and manually optimized to make it as fast as possible.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As an engineer working for a company that produces 3D laser printers, I have access to advanced laser cutting machines. </font><font style="vertical-align: inherit;">So I easily designed and manufactured a wooden case (I spied the wood finish on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atari 2600</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">The mechanical keyboard switches were soldered directly to a single Amethyst circuit board. </font><font style="vertical-align: inherit;">This keyboard has one curious feature - the absence of the usual large gap. </font><font style="vertical-align: inherit;">Instead, just a button, modestly located above the Enter key. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The complete schematic, PCB files for the circuit board, and source code are available in my </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">So you can create your own Amethyst or even improve my project. </font><font style="vertical-align: inherit;">What if you can figure out how to save a couple more chips?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494098/index.html">Imperative approach to reactive data on the example of Jetbrains KTor and R2DBC</a></li>
<li><a href="../en494100/index.html">What you need to create the ideal model of an educational center for training IT-specialists</a></li>
<li><a href="../en494110/index.html">Property-based testing for JavaScript and UI: an unusual approach to automated tests</a></li>
<li><a href="../en494114/index.html">How to reduce the number and increase the readability of code in react-redux, redux-saga</a></li>
<li><a href="../en494118/index.html">COVID-19 Telegram-bot // We answer FAQ questions automatically</a></li>
<li><a href="../en494126/index.html">TOP SCIENCE. February Media Ten: Crab Zombie Feminists, Prehistoric Salamanders and Exaggerated Alcoholics</a></li>
<li><a href="../en494128/index.html">Hackspace Neuron - a meeting place for hackers in Moscow</a></li>
<li><a href="../en494130/index.html">What happens to online events: some of our statistics</a></li>
<li><a href="../en494132/index.html">Befunge compiler in Python</a></li>
<li><a href="../en494136/index.html">What to drip in the eye, so as not to itch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>