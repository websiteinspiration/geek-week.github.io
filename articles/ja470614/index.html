<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👊🏾 👩🏻‍💻 📭 NESグラフィックはどのように配置されましたか？ ☦️ 🏕️ 🕟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1983年に発売されたNintendo Entertainment System（NES）のホームコンソールは、驚異的な成功を収めた安価で強力なマシンでした。画像処理ユニット（PPU）を使用すると、システムはそれらの時代に非常に印象的なグラフィックスを作成でき、今日でも適切なコンテキストで非常によく...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>NESグラフィックはどのように配置されましたか？</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470614/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ad/f22/f28/9adf22f2804a300f6f3e9a98fe15c13b.gif" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1983年に発売されたNintendo Entertainment System（NES）のホームコンソールは、驚異的な成功を収めた安価で強力なマシンでした。画像処理ユニット（PPU）を使用すると、システムはそれらの時代に非常に印象的なグラフィックスを作成でき、今日でも適切なコンテキストで非常によく見えます。最も重要な側面はメモリ効率でした-グラフィックを作成するとき、できるだけ少ないバイト数で管理する必要がありました。しかし、これに加えて、NESは強力で使いやすい機能を開発者に提供し、古いホームコンソールから際立つようにしました。 NESグラフィック作成の原則を理解すると、システムの技術的な完成度を感じ、現代のゲーム開発者にとって作業がいかに簡単になるかを理解できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NESの背景グラフィックスは4つの個別のコンポーネントから組み立てられ、それらの組み合わせにより画面に表示される画像が形成されました。</font><font style="vertical-align: inherit;">各コンポーネントは個別の側面を担当していました。</font><font style="vertical-align: inherit;">色、場所、生のピクセルグラフィックスなど </font><font style="vertical-align: inherit;">このようなシステムは不必要に複雑で扱いにくいように見えるかもしれませんが、最終的にはメモリをはるかに効率的に使用し、少量のコードで単純な効果を作成することができました。</font><font style="vertical-align: inherit;">NESグラフィックを理解したい場合は、これらの4つのコンポーネントが重要な情報になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事は、読者がコンピューター数学に精通していること、特に8ビット= 1バイトであり、8ビットが256の値を表すことができることを前提としています。</font><font style="vertical-align: inherit;">16進表記がどのように機能するかを理解することも必要です。</font><font style="vertical-align: inherit;">しかし、この技術的な知識がなくても、記事は面白く見えるかもしれません。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">短いレビュー</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca1/6f8/9a7/ca16f89a75e658d68c28f81e9794ff86.png" width="512" height="480"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上はキャッスルヴァニア（1986）の最初のシーンの画像です。ゲームが行われる城に通じる門です。この画像のサイズは256×240ピクセルで、10の異なる色を使用します。この画像をメモリに表現するには、限られたカラーパレットを利用し、最小限の情報のみを保存することでスペースを節約する必要があります。素朴なアプローチの1つは、各ピクセルが4ビットのボリュームを持つインデックス付きパレットを使用することです。つまり、2つのピクセルが1バイトに配置されます。これには256 * 240/2 = 30720バイトが必要ですが、すぐにわかるように、NESはこのタスクをより効率的に処理できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NESグラフィックテーマの主な概念は、タイルとブロックです[1]。</font><font style="vertical-align: inherit;">タイルは8×8ピクセルの領域であり、ブロックは16×16ピクセルの領域であり、それぞれが同じセルサイズのグリッドに関連付けられています。</font><font style="vertical-align: inherit;">これらのグリッドを追加すると、グラフィックの構造を確認できます。</font><font style="vertical-align: inherit;">これは、2倍の倍率でグリッドが表示されている城の入り口です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/uz/de/sk/uzdeskry1wkruscxe8xsyephbnc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このグリッドでは、ブロックは薄い緑色で、タイルは濃い緑色で表示されます。</font><font style="vertical-align: inherit;">軸に沿った定規には、位置を見つけるために追加できる16進値があります。</font><font style="vertical-align: inherit;">たとえば、ステータスバーのハートは$ 15 + $ 60 = $ 75で、10進数では117です。各画面には、16×15ブロック（240）と32×30タイル（960）が含まれています。</font><font style="vertical-align: inherit;">次に、この画像がどのように記述されるかを見て、生のピクセルグラフィックスから始めましょう。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHR</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CHR構造は、色や位置のない「生の」ピクセルグラフィックを記述し、タイルで設定されます。</font><font style="vertical-align: inherit;">メモリページ全体には256個のCHRタイルが含まれ、各タイルの深さは2ビットです。</font><font style="vertical-align: inherit;">ここにハートのグラフィックがあります：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad9/d14/fb3/ad9d14fb3cc4321c5ae65e1e7f61dd52.png" width="128" height="128"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これがCHR [2]でどのように記述されているかです：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/162/974/e0f/162974e0fe800447c8edecf9157d1763.png" alt="pixel-heart-chr" width="128" height="128"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような記述はピクセルあたり2ビットを必要とします。つまり、サイズが8×8の場合、8 * 8 * 2 = 128ビット= 16バイトになります。</font><font style="vertical-align: inherit;">次に、ページ全体が16 * 256 = 4096バイトになります。</font><font style="vertical-align: inherit;">キャッスルヴァニアの画像で使用されているすべてのCHRを以下に示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5da/3ef/83d/5da3ef83d0e339ca2d91d799745157e9.png" width="271" height="101"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像の入力に必要なのは960タイルですが、CHRでは256のみを使用できることを思い出してください。これは、ほとんどのタイルが平均3.75回繰り返されることを意味しますが、使用されるタイルの数は少ない場合があります（たとえば、空の背景、モノクロタイル）。または繰り返しパターン）。</font><font style="vertical-align: inherit;">キャッスルヴァニアからの画像は、空のタイルと青一色を多く使用しています。</font><font style="vertical-align: inherit;">タイルがどのように割り当てられるかを確認するには、名前テーブルを使用します。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前付き</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前テーブルは、画面上の各位置にCHRファイルを割り当て、合計で960あります。各位置は1バイトで指定されます。つまり、名前テーブル全体で最大960バイトを使用します。</font><font style="vertical-align: inherit;">タイルは左から右、上から下の順に割り当てられ、上に示したルーラーからの値を追加することによって検出された計算された位置に対応します。</font><font style="vertical-align: inherit;">つまり、左上隅の位置は$ 0で、その右側は$ 1で、その下は$ 20です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前テーブルの値は、CHRが入力される順序によって異なります。</font><font style="vertical-align: inherit;">オプションの1つを次に示します[3]。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/h_/vs/qc/h_vsqc5mxdu8ydb1o8cu4mflf9e.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この場合、心臓（75ドルの位置）の値は13ドルです。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、色を追加するには、パレットを選択する必要があります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パレット</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NESには64色のシステムパレットがあり[4]、そこからレンダリングで使用されるパレットを選択します。</font><font style="vertical-align: inherit;">各パレットには、3つの異なる色と全体的な背景色が含まれています。</font><font style="vertical-align: inherit;">画像には最大4つのパレットがあり、合計で16バイトを占めます。</font><font style="vertical-align: inherit;">キャッスルヴァニアからの画像のパレットは次のとおりです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f03/59a/259/f0359a259c032b5f6c9048c0231ffb85.png" alt="キャッスルヴァニアパル" width="168" height="24"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パレットを任意に使用することはできません。</font><font style="vertical-align: inherit;">ブロックごとに1つのパレットのみが適用されます。</font><font style="vertical-align: inherit;">これは、NESがそのような「ブロック」の外観を持っているため、ゲームのカラーパレットに従って各16×16領域を分離する必要があるためです。</font><font style="vertical-align: inherit;">たとえばCastlevaniaスクリーンセーバーから見事に実行されたグラフィックは、ブロックの端に色を混ぜることで回避でき、グリッドの存在を隠すことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各ブロックのパレットの選択は、最後のコンポーネントの属性を使用して実行されます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の属性</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
属性はブロックごとに2ビットを占有します。</font><font style="vertical-align: inherit;">4つのパレットのどれを使用するかを決定します。</font><font style="vertical-align: inherit;">この画像は、属性で定義されているパレットが異なるブロックを使用していることを示しています[5]：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/k4/kj/3i/k4kj3imqlxxbwnasjcz3t60abym.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、パレットはセクションに分割されていますが、異なる領域で同じ色を使用しているため、これはトリッキーです。</font><font style="vertical-align: inherit;">門の真ん中の赤はそれを囲む壁と融合し、黒の背景は城</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
と門の</font><font style="vertical-align: inherit;">間の線をぼかし</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブロックごとに2ビットまたはバイトごとに4ブロックの場合、画像属性は240/4 = 60バイトしか占有しませんが、それらがエンコードされる方法により、さらに4バイトが浪費されます。つまり、合計で64バイトが取得されます。</font><font style="vertical-align: inherit;">これは、CHR、名前テーブル、パレット、属性を含む画像全体が4096 + 960 + 16 + 64 = 5136バイトを占めることを意味します-上記の30720よりもはるかに優れています。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メーカー</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NESグラフィック用にこれらの4つのコンポーネントを作成することは、通常のビットマップAPIを使用する場合よりも困難ですが、ツールが役に立ちます。</font><font style="vertical-align: inherit;">NES開発者はおそらく何らかのツールチェーンを持っていましたが、それが何であれ、ストーリーはそれを保存しませんでした。</font><font style="vertical-align: inherit;">今日、開発者は通常、グラフィックスを目的のNES形式に変換するプログラムを作成しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この投稿のすべての画像は</font><font style="vertical-align: inherit;">、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Star Versusが</font></a><font style="vertical-align: inherit;">使用する書き換えツール</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makechr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して作成されました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、自動ビルド用に設計されたコマンドラインツールであり、速度、品質のエラーメッセージ、移植性、および包括性を目的としています。</font><font style="vertical-align: inherit;">彼はまた、投稿で使用されているような興味深い視覚化を作成します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考資料</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NESのプログラミングに関するほとんどの知識、特にグラフィックの作成に関する知識は、次のソースから得ました。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任天堂時代のオタクな夜</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NesDevのwiki</font></font></a></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノート</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[1]用語-一部のドキュメントでは、ブロックは「メタタイル」と呼ばれ、個人的にはあまり役に立たないようです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[2] CHRエンコーディング-1ピクセルあたり2ビットは互いに隣接して保存されません。画像全体が最初に下位ビットのみで保存され、次に上位ビットのみで保存されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、ハートは次のように格納され</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/cc5/68c/f95/cc568cf959b148d1d11a408876806ae8.png" alt="ピクセルハートロー" width="128" height="128"> <img src="https://habrastorage.org/getpro/habr/post_images/f87/947/070/f879470703605322e98a2582241b071e.png" alt="ピクセルハートハイ" width="128" height="128"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。各行は1バイトです。つまり、01100110は66ドル、01111111は7fです。合計では、このような心の外観のバイト：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$ 66 $ 7F $ FF $ FF $ FF $ 7E $ 3C $ 18 $ 66 $ 5F $ BF $ BF $ FF $ 7E $ 3C $ 18 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[3]名前テーブル-このゲーム内のチャートでは、名前のテーブルが異なって使用されています。通常、Castlevaniaを含め、アルファベットの文字は近隣の記憶に保持されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[4]システムパレット-NESはRGBパレットを使用せず、レンダリングされる実際の色は特定のTVに依存します。</font><font style="vertical-align: inherit;">エミュレータは通常、完全に異なるRGBパレットを使用します。</font><font style="vertical-align: inherit;">この記事の色は、makechrで綴られたパレットに対応しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[5]属性のエンコード-属性は奇妙な順序で保存されます。</font><font style="vertical-align: inherit;">それらは左から右、上から下に移動しません-2×2ブロック領域は、文字Zの形式で1バイトでエンコードされます。そのため、4バイトが無駄になります。</font><font style="vertical-align: inherit;">一番下の行は完全な8バイトです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71a/951/0db/71a9510db28128bca1841689ce909c27.png" alt="pal-block-group" width="64" height="64"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、$ 308のブロックは、$ 30a、$ 348および$ 34aで保存されます。</font><font style="vertical-align: inherit;">それらのパレット値は1、2、3、3で、最低位置から最高位置、または11 :: 11 :: 10 :: 01 = 11111001の順に格納されます。したがって、これらの属性のバイト値は$ f9です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の部分では、NESバックグラウンドグラフィックスのコンポーネント（CHR、名前テーブル、パレット、属性）について説明しました。</font><font style="vertical-align: inherit;">しかし、これは話の半分にすぎません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、実際には2つの名前テーブルがあります[6]。</font><font style="vertical-align: inherit;">それぞれに色を設定するための独自の属性がありますが、CHRは同じです。</font><font style="vertical-align: inherit;">カートリッジの機器は、それらの位置を決定します：互いに隣り合うか、または上下に重なります。</font><font style="vertical-align: inherit;">以下は、2つの異なるタイプのロケーションの例です。LodeRunner（1984）とBubble Bobble（1988）です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/759/7ef/7c9/7597ef7c97f3e31ed3bb4198727dee37.png" width="512" height="500"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0e7/035/72a/0e703572ad771478c13bffa254a86579.png" alt="泡泡スクロール" width="532" height="480"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクロール</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つの名前テーブルの存在を利用するために、PPUはX軸とY軸に沿って一度にピクセル単位でスクロールする機能をサポートしています。これは、$ 2005のメモリディスプレイを備えたレジスターによって制御されます。このアドレスに2バイトだけ書き込むと、画面全体が目的のピクセル数に移動します[7] 。 NESのリリース当時、これは他のホームコンソールに比べて主な利点でした。スクロールの場合、ビデオメモリ全体を書き換える必要がよくありました。このような使いやすいスキームは、多数のプラットフォーマーやシューティングゲームの登場につながり、システムがこのように大きな成功を収めた主な理由になりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロードランナーなど、フィールドの幅が2画面しかない単純なゲームの場合、両方の名前テーブルに入力し、それに応じてスクロールを変更するだけで十分です。</font><font style="vertical-align: inherit;">しかし、ほとんどのスクロールゲームでは、レベルに任意の幅がありました。</font><font style="vertical-align: inherit;">それらを実装するには、ゲームが画面に表示される前に、名前テーブルの画面外の部分を更新する必要があります。</font><font style="vertical-align: inherit;">スクロール値はループしますが、名前テーブルは常に更新されるため、これにより無限のサイズの錯覚が生じます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/829/936/ab4/829936ab4b2855cd7f824ebd01941bb3.gif" width="512" height="500"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スプライト</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前テーブルをスクロールすることに加えて、NESには、スプライトというグラフィックのまったく異なる側面もありました。グリッドに配置する必要がある名前テーブルとは異なり、スプライトは任意に配置できるため、プレイヤーキャラクター、障害物、発射物、および複雑な動きを持つオブジェクトを表示するために使用できます。たとえば、上記のMega Man（1987）のシーンでは、プレイヤーのキャラクターを表示しています。ポイントとエネルギーストリップはスプライトを使用しているため、画面をスクロールするときに、名前テーブルのグリッドから抜け出すことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スプライトには、独自のCHRページ[8]と4つのパレットのセットがあります。さらに、256バイトのメモリページを占有します。これは、各スプライトの位置と外観をリストします（結局のところ、NESビデオメモリは、記事の最初の部分で述べたものの2.5倍です）。これらのエントリの形式はかなり変わっています-最初にYの位置、次にタイル番号、次に属性、次にXの位置が含まれています[9]。各レコードは4バイトを使用するため、厳格な制限があります。画面上に同時に存在できるスプライトは256/4 = 64以下です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バイトYとXは、描画されるスプライトの左上のピクセルを指定します。</font><font style="vertical-align: inherit;">したがって、画面の右側ではスプライトをトリミングできますが、左側では空のスペースが残ります。</font><font style="vertical-align: inherit;">タイルのバイトは名前テーブルの値に似ていますが、これらのタイルについてのみ、スプライトは独自のCHRを使用します。</font><font style="vertical-align: inherit;">属性バイトは3つのタスクを実行するビットのパケットです。2ビットはパレットに割り当てられ、2ビットはスプライトを水平または垂直にミラーリングするために使用され、1ビットはスプライトを名前テーブルの下でレンダリングするかどうかを決定します[10]。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制限事項</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最新のシステムでは任意のサイズのスプライトを使用できますが、NESではCHRの制限によりスプライトのサイズは8×8でなければなりませんでした[11]。大きなオブジェクトはいくつかのスプライトで構成されており、プログラムは個々のパーツがすべて隣り合ってレンダリングされることを確認する必要があります。たとえば、ロックマンキャラクターのサイズは10スプライトに達する可能性があり、これにより、特に彼の白い目と肌の色合いのために、より多くの色を使用することもできます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd8/fea/3dc/dd8fea3dc4880761b52885c8ff83acdd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スプライトの使用に関連する主な制限は、ラスタラインごとに8個以下のスプライトが存在する必要があることです。</font><font style="vertical-align: inherit;">画面の水平線に8個を超えるスプライトが表示される場合、後で表示されるスプライトはレンダリングされません。</font><font style="vertical-align: inherit;">これが、スプライトの多いゲームでちらつく理由です。</font><font style="vertical-align: inherit;">プログラムは、メモリ内のスプライトのアドレスをスワップして、それぞれが少なくとも時々レンダリングされるようにします。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f0/b67/13c/5f0b6713c1be1837d0da2d8213253932.gif" alt="ロックマンフリッカー" width="332" height="128"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、スクロールはスプライトに影響を与えません。画面上のスプライトの位置は、スクロールの位置に関係なく、YとXの値によって決まります。</font><font style="vertical-align: inherit;">たとえば、レベルがプレーヤーに対して移動したり、インターフェイスが固定位置に留まったりする場合など、これがプラスになることもあります。</font><font style="vertical-align: inherit;">ただし、他の場合では、これはマイナスです。移動するオブジェクトを移動し、スクロールの変化量だけその位置を変更する必要があります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノート</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[6]理論的には、実際には4つの名前テーブルがありますが、2つだけが固有のグラフィックを含むようにミラーリングされています。これを並べて配置する場合は垂直ミラーリングと呼ばれ、名前テーブルが上下に配置される場合は水平ミラーリングと呼ばれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[7]レンダリングを開始する名前テーブルを選択するレジスタもあります。つまり、ミラーリングを検討する場合、スクロールは実際には10ビット値、つまり9ビット値です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[8]これは常に当てはまるわけではありません。 PPUは、スプライトの場合と同じ名前テーブルに同じCHRページを使用するように構成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[9]おそらく、この順序が使用されたのは、効率的なレンダリングのためにPPUが処理する必要があるデータに対応しているためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[10]このビットはスーパーマリオ3の白ブロックの下でマリオを移動させるために、例えば、様々な効果のために使用される、または城3のスプライト上霧をレンダリングするために</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[11] PPUはまた、8×16スプライトを有効にするオプションを有し、これ背の高いキャラクターがいるコントラのようなゲームで使用されます。</font><font style="vertical-align: inherit;">ただし、他のすべての制限が適用されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のパートでは、CHRデータ、名前テーブルに基づく背景、スプライト、およびスクロールについて説明しました。</font><font style="vertical-align: inherit;">さらに、ハードウェアを追加しなくても、シンプルなNESカートリッジでできることはこれですべてです。</font><font style="vertical-align: inherit;">しかし、さらに進むには、レンダリングのしくみを詳細に説明する必要があります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリング</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/12b/0d4/0ad/12b0d40ad74d27ce6d8ff2499c6df163.gif" width="200" height="200"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vblankの一時停止によるラスターレンダリング</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他の古いコンピューターと同様に、NESはCRTテレビで動作するように設計されています。画面上に左から右へ、上から下へ、電子銃を使用して一度に1本ずつスキャンラインを描画します。電子銃は、これらのラインが描画される画面上の点に物理的に移動します。下隅に到達すると、「垂直ブランク」（またはvblank）と呼ばれる期間が発生します。電子銃は左上隅に戻り、次のフレームを描画する準備をします。 NES内では、PPU（画像処理ユニット）が各フレームで自動的にラスターレンダリングを実行し、CPUで動作するコードがゲームが実行する必要のあるすべてのタスクを実行します。 Vblankは、PPUメモリ内のデータを置き換える機能をプログラムに提供します。それ以外の場合、このデータはレンダリングに使用されるためです。ほとんどの場合、名前とPPUパレットのテーブルへの変更は、この小さなウィンドウの間に行われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、画面のレンダリング中にPPUの状態にいくつかの変更を加えることができます。</font><font style="vertical-align: inherit;">それらは「ラスター効果」と呼ばれます。</font><font style="vertical-align: inherit;">画面のレンダリング中に実行される最も一般的なアクションは、スクロール位置を割り当てることです。</font><font style="vertical-align: inherit;">これのおかげで、画像の一部（ゲームインターフェイスなど）は静止したままで、その他はすべてスクロールし続けます。</font><font style="vertical-align: inherit;">この効果を実現するには、スクロール値を変更する時間を正確に選択して、目的のラスターラインで発生するようにする必要があります。</font><font style="vertical-align: inherit;">ゲームコードとPPUの間でこの種の同期を実装するためのテクニックはたくさんあります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面を分割</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36e/4bf/c1e/36e4bfc1e8e92ae1dbfb83225946dc0f.png" width="512" height="480"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レベルがスクロールし、画面上部のインターフェースは動かないまま</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
です。最初に、PPUには、ゼロメモリ位置のスプライトを特別な方法で処理するハードウェアが組み込まれています。このスプライトをレンダリングするときに、そのピクセルの1つが背景の可視部分と重なる場合、「sprite0フラグ」と呼ばれるビットが設定されます。ゲームコードは、最初にこのスプライトを画面分割が発生する場所に配置してから、ループで待機し、sprite0フラグの値を確認します。したがって、ループが終了すると、ゲームは現在レンダリングされているラスターラインを確実に認識します。この手法は、上記の[12]に示すNinja Gaiden（1989）を含む多くのNESゲームで簡単な画面共有を実装するために使用されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/acd/f19/66bacdf196bab83b91ea70c2657dd497.png" alt="忍者フード" width="256" height="240"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sprite0はY $ 26、X $ a0にあります。ピクセルの一番下の行がレンダリングされると、sprite0フラグが設定されます。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
一部のゲームでは、sprite0フラグは別の手法と組み合わせられます-予測可能なタイミングのループ（「予測されるタイミングのサイクル」）：プログラムは、画面がより多くの部分に分割されるようにいくつかの追加のラインがレンダリングされるのを待ちます。たとえば、この手法は多くの忍者外伝のスクリーンセーバーで使用され、風で動くフィールドや遠くにある城のイメージなどの劇的な効果を作成します。ゲームは、音楽の再生やプレーヤーが入るのの待機などのタスクを実行し、フレームのレンダリングの開始時に、sprite0を使用して最初の分割を検索し、その他すべての場合はタイミングループを使用します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf9/19a/bfd/cf919abfdd1c0d786440e0af2c99bb24.gif" alt="忍者インフィールド" width="512" height="480"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f77/fab/d51/f77fabd51c4431db2c98ee1bf64e0eb2.gif" alt="キャッスルビュー" width="512" height="480"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、ほとんどのゲームは、特にCPU時間に金を割く価値があるアクティブなシーンで、サイクルで待機する時間を費やす余裕はありません。そのような場合、カートリッジにインストールされた特別な装置が使用されます（それはメモリ内の独自のマッピング（メモリマッピング）を使用するため、マッパーと呼ばれます）。これは、特定のラスターラインのレンダリングの瞬間に関する通知を受け取ることができ[13]、待機サイクルの必要性を完全に排除します。ゲームコードは、任意のタスクをいつでも実行できるため、プロセッサがより最適に使用されます。分割の多いNES用の最新のゲームのほとんどは、この方法でマッパーを使用します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/618/9c3/f4f/6189c3f4fa79e5c31b80b2c14df75dcb.gif" alt="列車レベル" width="512" height="480"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはNinja Gaiden 2の例です。これは、マッパーを使用して複数のパーティションを実行し、視差スクロールをシミュレートします。これにより、レベルの静的な性質にもかかわらず、素晴らしいスピード感を生み出します。</font><font style="vertical-align: inherit;">個々の可動部分はすべて厳密に水平方向の縞模様であることに注意してください。</font><font style="vertical-align: inherit;">つまり、どの背景レイヤーも他のレイヤーと重複することはできません。</font><font style="vertical-align: inherit;">これは、個々のラスターラインのスクロールを変更することにより、実際に分離が実装されるためです。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">銀行の切り替え</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マッパーは他の多くの機能を実行できますが、最も一般的なのはバンクの切り替えです。これは、アドレス空間のブロック全体がメモリの別の部分を指すように再割り当てされる操作です[14]。バンクの切り替えは、プログラムコード（ゲームで多くのレベルと音楽を作成できる）とCHRデータで実行できるため、名前テーブルまたはスプライトで参照されているタイルを即座に置き換えることができます。フレーム間でバンクの切り替えを使用すると、一度に背景全体をアニメーション化できます。ただし、ラスター効果として使用すると、画面のさまざまな部分にまったく異なるグラフィックを描画できます。忍者外伝シリーズのゲームでは、このアプローチはゲームプロセス中にレベルとは別にインターフェイスをレンダリングするために使用されます。これにより、テキストやビジュアルシーンをさまざまな銀行のCHRに保存できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69f/896/804/69f8968042bded347183e35af32c16ae.gif" alt="goofall-bg" width="512" height="480"></div><br>
<i> ,     </i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/290/882/f90/290882f90bb731af9e98f7ee65b4e64f.png" alt="goofall-nt" width="512" height="480"></div><br>
<i>  ,        </i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf7/077/b23/cf7077b23ea5242b4f27d308b7514077.png" width="512" height="480"></div><br>
<i>      CHR.     ,     </i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a2/335/28e/7a233528e53b01341d21112b3651310e.png" alt="彼らは誰ですか？" width="512" height="480"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下部では、別のCHRバンクが使用されています。バンクを切り替えると、スクロール値もリセットされます。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
バンクの切り替えは、限られた（ただし印象的な）形で視差スクロールにも使用できます。シーンに背景の一部があり、短い繰り返しパターンで構成されている場合、この同じパターンを異なる量のオフセットで複数のバンクに含めることができます。次に、対応するオフセットを持つバンクに切り替えることにより、このパターンを特定の値にスクロールできます。このような手法は、メモリの切り替えの影響を受けないタイルが存在するため、背景が重なっている場合でも視差スクロールに使用できます[15]。この方法の欠点は、全体として、すべての銀行がCHRスペースを大量に占有する必要があることです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/501/6b4/281/5016b4281a88523177dffef3f8de4250.gif" alt="メタルストームbg" width="512" height="464"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metal Storm（1991）は、レイヤーごとのスクロールにバンク切り替えを使用しています</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c05/7d4/6cb/c057d46cbf7f4d2cfb3e401d1658692f.png" alt="メタルストームnt" width="512" height="464"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前テーブルを繰り返すと、</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
バンクを切り替えて</font><i><font style="vertical-align: inherit;">この</font></i><font style="vertical-align: inherit;"> CHR </font><i><font style="vertical-align: inherit;">効果を作成できます。</font></i><font style="vertical-align: inherit;">これは非常に強力なツールですが、制限があります。</font><font style="vertical-align: inherit;">このテクニックは画面全体をアニメーション化するのには役立ちますが、画面のごく一部だけを置き換えるのにはあまり適していません。</font><font style="vertical-align: inherit;">これには、名前テーブルの変更も必要です。</font><font style="vertical-align: inherit;">さらに、カートリッジ内のCHRの量は制限されており、データに切り替えるには、まず存在する必要があります。</font><font style="vertical-align: inherit;">最後に、スクロールベースのラスター効果を除いて、ゲームには常に名前テーブルの厳密なグリッドがあり、グラフィック効果のダイナミックレンジが制限されます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の例</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ad/f22/f28/9adf22f2804a300f6f3e9a98fe15c13b.gif" alt="副火" width="512" height="480"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームVice：Project Doom（1991）は、各ラスターラインのスクロール位置を繰り返し設定することにより、この炎の効果を作成します。</font><font style="vertical-align: inherit;">前景のキャラクターは、スクロールの影響を受けないスプライトから作成されます。</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/25b/9b9/25325b9b935359508dc420aa35ef1748.gif" alt="ソードマスター" width="512" height="480"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sword Master（1990）は、バンクスイッチングを使用して、遠くの山をスクロールし、画面と前景の芝生の画面を分割します。</font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">謝辞</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FCEUXエミュレーターが提供する強力なデバッグ機能なしでは、記事のこのグラフィックスをすべて生成することはできません。</font><font style="vertical-align: inherit;">さらに、NesDevサイトのwikiは、sprite0に関する有用な情報源になりました。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fceux</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NesDev wiki</font></font></a></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノート</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[12]実際、忍者外伝の状況はもう少し複雑です。ゲームは8×16のスプライトスプライトを使用します。これはPPUが提供する特別なモードで、スプライトを垂直方向に重ね合わせたペアとしてレンダリングします。つまり、sprite0は完全に透明で、sprite1は一番下にピクセルの行を持っています。また、これらのスプライトのzレイヤーを設定して、それらがインターフェースの黒の背後にレンダリングされるようにして、すべてを非表示にします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[13]これは実装がかなり難しいです。ゲームコードは、目的のラスターラインをマッパーのアドレス空間に書き込みます。次に、マッパーはPPUメモリアクセスリクエストをインターセプトし、新しいラスターラインがレンダリングされるタイミングをカウントします。目的のラスターラインに到達すると、プログラムコード（IRQ）が生成され、その間にゲームコードが実行され、この特定のラスターライン中に必要な処理が実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[14]切り替えは、機器をメモリにマッピングし、メモリアクセス操作をインターセプトし、データを取得する物理的な場所を再定義することによって実行されます。</font><font style="vertical-align: inherit;">結果は瞬時ですが、フラクショナリティーが大きいため、アドレス範囲は4 KBまたは8 KB異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[15]各タイルに影響を与えずにCHRバンクを切り替える唯一の方法は、バンク間でタイルデータを複製するか、粒度の少ないマッパーを使用することです。</font><font style="vertical-align: inherit;">このマッパーを使用すると、一度に1 KBのみなど、バンクのより小さな部分を切り替えることができます。それ以外はすべて変更されません。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja470602/index.html">三次元の世界でのモスクワのメトロの様子</a></li>
<li><a href="../ja470604/index.html">eコマースでのサイトの読み込み速度：ロシアの上位48のオンラインストアの分析</a></li>
<li><a href="../ja470608/index.html">Unity UIの最適化</a></li>
<li><a href="../ja470610/index.html">開発者の人生のある日</a></li>
<li><a href="../ja470612/index.html">電圧計が示すもの、または数学ソケット</a></li>
<li><a href="../ja470616/index.html">フェルミパラドックスの新しい解決策（私たちが宇宙で一人でいる理由）</a></li>
<li><a href="../ja470618/index.html">因子分析を使用したニュースのテーマ別モデリング</a></li>
<li><a href="../ja470620/index.html">コードとしてのインフラストラクチャ：XPの問題を克服する方法</a></li>
<li><a href="../ja470622/index.html">特徴選択手法の概要</a></li>
<li><a href="../ja470628/index.html">宇宙船シミュレータ造船</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>