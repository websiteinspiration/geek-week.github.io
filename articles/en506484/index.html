<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå± üëéüèº üõë Game engine editor: visualization of the project file structure üíÜüèæ ‚òùüèª üò∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi everyone, my name is Alexander, I'm a frontend developer. My career as a programmer began relatively recently, I do not have a special education an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Game engine editor: visualization of the project file structure</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506484/"><img src="https://imagizer.imageshack.com/img924/4774/30LG0d.gif" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hi everyone, my name is Alexander, I'm a frontend developer. </font><font style="vertical-align: inherit;">My career as a programmer began relatively recently, I do not have a special education and for a long time I worked in a completely different field. </font><font style="vertical-align: inherit;">Since the IT industry is developing very rapidly, I have to constantly study at an accelerated pace to keep up with my colleagues with great experience behind me. </font><font style="vertical-align: inherit;">For self-development, in my free time, I decided to start my pet-project.</font></font><br>
 <a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I have identified important aspects for myself in choosing a project</font></font></h3><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The project should use the maximum number of relevant technologies that should complement and disclose each other (as a basis, you can take a sample of the requirements of employers in the directions Javascript-developer frontend / backend / fullstack). </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It should enable further use of it as a presentation for yourself as a developer (at the current place of work of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The work should have the prospect that it can become not only a pet project, but a full-fledged product that they will be interested in and will use.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since childhood, I always wanted to write my own game, and after the first acquaintance with the online role-playing game "Lineage II", I realized that mine must be multiplayer. </font><font style="vertical-align: inherit;">I decided to try to implement this, and the deadlines in this case are not burning, and the acquisition of necessary hard skills was paramount for me. </font><font style="vertical-align: inherit;">So I started writing my game engine with a built-in editor and server.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article I will describe what difficulties I encountered and how to deal with them</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 When implementing the editor of the game engine, I was faced with the need to display the file structure of the project for subsequent manipulations with it, for example, editing code files, loading / changing pictures, creating new directories, etc., in fact, this requires the skeleton of the structure itself.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Action plan</font></font></h3><br>
<ol>
<li>       ‚Äî           .</li>
<li>     ‚Äî    .</li>
<li>     .</li>
<li> ,    .</li>
<li> ,         .</li>
</ol><br>
<h3></h3><br>
<pre><code class="javascript hljs">    <span class="hljs-comment">/**
     *       ,       
     * <span class="hljs-doctag">@param <span class="hljs-variable">folder</span></span>
     * <span class="hljs-doctag">@param <span class="hljs-variable">arrayOfStructures</span></span>
     * <span class="hljs-doctag">@returns <span class="hljs-type">{[Object]}</span></span>
     */</span><font></font>
<font></font>
    readFolder(folder: string, <span class="hljs-attr">arrayOfStructures</span>: object[]): object[] {
        <span class="hljs-keyword">const</span> projectStructure = {};
        <span class="hljs-keyword">let</span> currentDirectory = fs.readdirSync(folder, <span class="hljs-string">'utf8'</span>);<font></font>
        currentDirectory.forEach(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
            <span class="hljs-keyword">let</span> pathOfCurrentItem = path.join(folder, file);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (fs.statSync(pathOfCurrentItem).isFile()) {<font></font>
                arrayOfStructures.push({<font></font>
                    <span class="hljs-attr">name</span>: file,
                    <span class="hljs-attr">path</span>: folder.concat(<span class="hljs-string">'/'</span> + file),
                    <span class="hljs-attr">extension</span>: path.extname(file),
                    <span class="hljs-attr">type</span>: <span class="hljs-string">'file'</span><font></font>
                });<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span> {<font></font>
                projectStructure[file] = {<span class="hljs-attr">name</span>: file, <span class="hljs-attr">path</span>: folder, <span class="hljs-attr">type</span>: <span class="hljs-string">'directory'</span>, <span class="hljs-attr">arrayOfStructures</span>: []};<font></font>
                arrayOfStructures.push(projectStructure[file]);<font></font>
                <span class="hljs-keyword">this</span>.readFolder(pathOfCurrentItem, projectStructure[file].arrayOfStructures);<font></font>
            }<font></font>
        });<font></font>
        <span class="hljs-keyword">return</span> arrayOfStructures;<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This script receives the directory from which it is necessary to start collecting information about its nested elements, and an empty array into which we will add the received data. For simplicity, we divide the resulting item into two types: files and directories. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fs.readdirSync (folder, 'utf8')</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> returns the result of reading the directory to us, after which we just have to go through it and look at what actually lies in it. If this is a file, then simply add it to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arrayOfStructures</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array </font><font style="vertical-align: inherit;">, but if the received type is directory then we call our </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readFolder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">recursively and start from the beginning, only in this case, we will already transfer the name of the new directory. At the output, we get an array of objects that can already be sent to the client.</font></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-comment">/**
     *        
     * <span class="hljs-doctag">@param <span class="hljs-variable">request</span></span>
     */</span>
    sendDirectoryEngine(request: Context&lt;object&gt;): <span class="hljs-keyword">void</span> {
        <span class="hljs-keyword">const</span> folder = <span class="hljs-string">'/GameEngine/Client'</span>;
        <span class="hljs-keyword">const</span> structure = <span class="hljs-keyword">this</span>.readFolder(folder, [{}]);<font></font>
<font></font>
        request.options.parentCtx.params.res.writeHead(<span class="hljs-number">200</span>, {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span>});<font></font>
        request.options.parentCtx.params.res.end(<span class="hljs-built_in">JSON</span>.stringify({
            <span class="hljs-attr">data</span>: [{
                <span class="hljs-attr">name</span>: <span class="hljs-string">'root'</span>,
                <span class="hljs-attr">type</span>: <span class="hljs-string">'directory'</span>,
                <span class="hljs-attr">arrayOfStructures</span>: structure<font></font>
            }]<font></font>
        }));<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this method, we get the result of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readFolder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">, after which we serialize it using </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON.stringify</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and send it to the client.</font></font><br>
<br>
<pre><code class="javascript hljs">   <span class="hljs-comment">/**
     *      
     * <span class="hljs-doctag">@returns <span class="hljs-type">{Promise&lt;Response&gt;}</span></span>
     */</span>
    <span class="hljs-keyword">static</span>  getDirectoryProject(): <span class="hljs-built_in">Promise</span>&lt;Response&gt; {
        <span class="hljs-keyword">let</span> url = <span class="hljs-string">'http://localhost:3001/api/getProjectStructure'</span>;<font></font>
<font></font>
        <span class="hljs-keyword">return</span> fetch(url, {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">headers</span>: {
                <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json;charset=utf-8'</span><font></font>
            },<font></font>
        });<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the client, we have a simple method that sends a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> request to the server to receive data, the method itself returns a promise.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We get an approximate such structure</font></font></h3><br>
<pre><code class="javascript hljs"><span class="hljs-comment">// arrayOfStructures        </span>
{<span class="hljs-attr">name</span>: <span class="hljs-string">"root"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"directory"</span>, <span class="hljs-attr">arrayOfStructures</span>: <span class="hljs-built_in">Array</span>(<span class="hljs-number">33</span>)}
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now the most interesting</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the client, I use </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typescrypt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-comment">/**
     *           state
     **/</span>
    getDirectory(): <span class="hljs-keyword">void</span> {
        <span class="hljs-keyword">const</span> projectDirectory = BusinessLogic.getDirectoryProject();<font></font>
        projectDirectory.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())<font></font>
            .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {<font></font>
                result.data[<span class="hljs-number">0</span>].arrayOfStructures.sort(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.type === <span class="hljs-string">'directory'</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>);
                <span class="hljs-keyword">this</span>.setState({
                    <span class="hljs-attr">directoryProject</span>: result.data,
                    <span class="hljs-attr">selectedDirectory</span>: result.data[<span class="hljs-number">0</span>]<font></font>
                });<font></font>
            });<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getDirectory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method calls the method of accessing business logic and then works with the received promise, we write the received data to state where:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directoryProject</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implements an object with which we will build a component of visualization of the tree structure of the project.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectedDirectory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implements an array with data for building the visualization component of the selected directory (by default, this is the root of the project).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will render two </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> components </font><font style="vertical-align: inherit;">from the directoryProject data and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detail</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the selectedDirectory. </font></font><br>
<br>
<img src="https://imagizer.imageshack.com/img924/1598/aBMGMV.gif" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Component display structure and components of the selected directory</font></font></i><br>
<br>
<pre><code class="javascript hljs"> <span class="hljs-comment">/**
     *    
     * <span class="hljs-doctag">@param <span class="hljs-variable">directoryProject</span></span>
     * <span class="hljs-doctag">@returns <span class="hljs-type">{[any,any,any,any,any]}</span></span>
     */</span><font></font>
    showDirectoryStructureSelectedFolder(directoryProject): object[] {<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (directoryProject &amp;&amp; directoryProject.type === <span class="hljs-string">'directory'</span>) {<font></font>
            {<font></font>
<font></font>
                directoryProject.arrayOfStructures.sort(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.type === <span class="hljs-string">'directory'</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>);
                <span class="hljs-keyword">return</span> directoryProject.arrayOfStructures.map(<span class="hljs-function">(<span class="hljs-params">directoryItem</span>) =&gt;</span> {
                    <span class="hljs-keyword">return</span> (<font></font>
<font></font>
                        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"project_container-elementContainer_element"</span>
                             <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.getInfo.bind(this,</span> <span class="hljs-attr">directoryItem</span>)}&gt;</span>
                            {directoryItem.type === 'directory' ?
                                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/Client/Editor/Tools/Project/DirectoryItem/icon/directory.png"</span>
                                     <span class="hljs-attr">className</span>=<span class="hljs-string">"project_container-elementContainer_element-image"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>/&gt;</span> :
                                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/Client/Editor/Tools/Project/DirectoryItem/icon/file.png"</span>
                                     <span class="hljs-attr">className</span>=<span class="hljs-string">"project_container-elementContainer_element-image"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>/&gt;</span>}
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                                <span class="hljs-attr">className</span>=<span class="hljs-string">"project_container-elementContainer_element-text"</span>&gt;</span>{directoryItem.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
<font></font>
                    );<font></font>
                })<font></font>
<font></font>
            }<font></font>
<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">showDirectoryStructureSelectedFolder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><b><font style="vertical-align: inherit;">,</font></b><font style="vertical-align: inherit;"> we create the item item of the directory that the user clicked on in the directory tree (sorry for the "butter oil"). </font><font style="vertical-align: inherit;">But since we did not implement sorting on the server, we have to do it on the client to give an aesthetic appearance, respectively, we simply call the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sort</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">on the resulting array of elements and sort by type (if the directory is to the beginning, otherwise to the end). </font></font><br>
<br>
<img src="https://imagizer.imageshack.com/img923/8463/zFCqGO.jpg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Directory structure</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the help of simple manipulations, we were able to visualize the structure of our project and give the user the opportunity to interact with it. </font><font style="vertical-align: inherit;">In the future, based on the data obtained from the structure, we can easily create components of the code editor, preview / image editor, create / edit / delete folders and files, and much more, which is enough for our imagination. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you for your attention, I hope this material can help you! </font></font><br>
<br>
<img src="https://imagizer.imageshack.com/img924/198/YzPHrJ.gif" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some meat</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en506460/index.html">Differences of the male brain from the female: women code better?</a></li>
<li><a href="../en506462/index.html">Pushpools and tachers - how I tested everything I found</a></li>
<li><a href="../en506472/index.html">Business protection for Internet entrepreneurs: where to open a company and account, what to look for</a></li>
<li><a href="../en506478/index.html">Installing and Configuring RTKRCV (RTKLIB) on Windows 10 Using WSL</a></li>
<li><a href="../en506480/index.html">2008 vs 2020: How investor behavior is changing during the crisis</a></li>
<li><a href="../en506486/index.html">About software development timelines</a></li>
<li><a href="../en506488/index.html">Online Conferences: Pros, Cons, Pitfalls</a></li>
<li><a href="../en506490/index.html">How to regularly express yourself in the media</a></li>
<li><a href="../en506494/index.html">Comparison of cold calls and correspondence: How to get 221 sales per month using one of the methods</a></li>
<li><a href="../en506498/index.html">Resources for studying finance in English (USA), or How to evaluate a company</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>