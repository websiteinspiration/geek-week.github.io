<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚ÄçüöÄ üîÖ üîå Ein Einblick in die Zuverl√§ssigkeit von Facebook-Diensten üìå üôâ üï∫üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn Facebook ‚Äûl√ºgt‚Äú, denken die Leute, dass es an Hackern oder DDoS-Angriffen liegt, aber nicht. Alle ‚ÄûSt√ºrze‚Äú in den letzten Jahren wurden durch int...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ein Einblick in die Zuverl√§ssigkeit von Facebook-Diensten</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/489204/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Facebook ‚Äûl√ºgt‚Äú, denken die Leute, dass es an Hackern oder DDoS-Angriffen liegt, aber nicht. Alle ‚ÄûSt√ºrze‚Äú in den letzten Jahren wurden durch interne √Ñnderungen oder Ausf√§lle verursacht. Um neuen Mitarbeitern beizubringen, Facebook nicht mit Beispielen zu brechen, werden alle wichtigen Vorf√§lle mit Namen versehen, z. B. "Call the Cops" oder "CAPSLOCK". Der erste wurde benannt, weil eines Tages, als das soziale Netzwerk ausfiel, Benutzer die Polizei von Los Angeles anriefen und darum baten, das Problem zu beheben, und der Sheriff auf Twitter verzweifelt darum bat, sie nicht zu st√∂ren. W√§hrend des zweiten Vorfalls auf den Cache-Computern fiel die Netzwerkschnittstelle aus und stieg nicht an, und alle Computer wurden von Hand neu gestartet. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elina Lobanova</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arbeitet seit 4 Jahren auf Facebook im Web Foundation-Team. Die Teammitglieder werden als Produktionsingenieure bezeichnet und √ºberwachen die Zuverl√§ssigkeit und Leistung des gesamten Backends, ver√∂ffentlichen Facebook, wenn es eingeschaltet ist, schreiben √úberwachung und Automatisierung, um sich und anderen das Leben zu erleichtern. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/9x/nj/jf9xnjbzmqg3ufk-km_bqmgkrya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einem Artikel, der auf Elinas Bericht √ºber </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++ 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> basiert </font><font style="vertical-align: inherit;">, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">zeigen</font></a><font style="vertical-align: inherit;"> wir </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">,</font></a><font style="vertical-align: inherit;"> wie Produktionsingenieure das Facebook-Backend √ºberwachen, welche Tools sie verwenden, was zu schweren Abst√ºrzen f√ºhrt und wie sie damit umgehen.</font></font><br>
<a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wuV5DLiUuaI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mein Name ist Elina, vor fast 5 Jahren wurde ich als gew√∂hnlicher Entwickler auf Facebook angerufen, wo ich zum ersten Mal auf wirklich stark ausgelastete Systeme stie√ü - dies wird an Instituten nicht gelehrt. </font><font style="vertical-align: inherit;">Das Unternehmen stellt kein Team ein, sondern ein B√ºro. Deshalb bin ich in London angekommen, habe ein Team ausgew√§hlt, das die Arbeit von facebook.com √ºberwacht und unter den Produktionsingenieuren war.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Produktionsingenieure</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zun√§chst m√∂chte ich Ihnen sagen, was wir tun und warum wir als Produktionsingenieure bezeichnet werden und nicht wie Google beispielsweise SRE.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2009. SRE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Standardmodell, das in vielen Unternehmen noch verwendet wird, ist "Entwickler - Tester - Betrieb". </font><font style="vertical-align: inherit;">Oft sind sie geteilt: Sie sitzen auf verschiedenen Etagen, manchmal sogar in verschiedenen L√§ndern, und kommunizieren nicht miteinander. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Jahr 2009 hatte Facebook bereits SRE. </font><font style="vertical-align: inherit;">Bei Google hat SRE fr√ºher begonnen, sie wissen, wie man DevOps erreicht, und haben es in ihrem Buch ‚Äû </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site Reliability Engineering</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äú geschrieben. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/o6/1l/6ho61luejwigg_bb6v_7441tlty.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf Facebook gab es 2009 nichts Vergleichbares. </font><font style="vertical-align: inherit;">Wir hie√üen SRE, aber wir haben die gleiche Arbeit wie Ops im Rest der Welt geleistet: Handarbeit, keine Automatisierung, Bereitstellung aller Dienste mit Ihren H√§nden, √úberwachung irgendwie, Oncall f√ºr alles, eine Reihe von Shell-Skripten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2010. SRO und AppOps</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies alles wurde nicht skaliert, da die Anzahl der Benutzer zu diesem Zeitpunkt dreimal pro Jahr zunahm und die Anzahl der Dienste entsprechend zunahm. </font><font style="vertical-align: inherit;">Im Jahr 2010 wurde die willensstarke Entscheidung Ops in zwei Gruppen aufgeteilt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Gruppe ist die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SRO</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wobei ‚ÄûO‚Äú ‚ÄûBetrieb‚Äú ist und sich mit der Entwicklung, Automatisierung und √úberwachung des Standorts befasst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite Gruppe ist </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppOps</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sie wurden in Teams f√ºr gro√üe Services integriert. </font><font style="vertical-align: inherit;">AppOps steht der Idee von DevOps bereits nahe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Trennung f√ºr eine Weile rettete alle.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2012. Produktionsingenieure</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Jahr 2012 hat AppOps die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Produktionsingenieure</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einfach umbenannt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Neben dem Namen hat sich nichts ge√§ndert, aber es ist bequemer geworden. </font><font style="vertical-align: inherit;">Wie Sie eine Yacht nennen, wird sie segeln, und wir wollten nicht wie Ops segeln. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gab immer noch SROs, Facebook wuchs und die gleichzeitige √úberwachung aller Dienste war schwierig. </font><font style="vertical-align: inherit;">Eine Person, die angerufen wurde, durfte nicht einmal auf die Toilette gehen: Er bat jemanden, ihn zu ersetzen, weil er st√§ndig brannte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014. Schlie√üung der SRO</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Irgendwann haben die Beh√∂rden alle zu einem Anruf weitergeleitet. </font><font style="vertical-align: inherit;">"Jeder" bedeutet auch die Entwickler: Sie schreiben Ihren Code, hier sind Sie und antworten auf diesen Code! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Produktionsingenieure wurden bereits in die wichtigsten Hilfeteams integriert, der Rest hat Pech. </font><font style="vertical-align: inherit;">Wir haben mit gro√üen Teams angefangen und in ein paar Jahren alle auf Facebook auf oncall √ºbertragen. </font><font style="vertical-align: inherit;">Unter den Entwicklern herrschte gro√üe Aufregung: Jemand k√ºndigte, jemand schrieb schlechte Beitr√§ge. </font><font style="vertical-align: inherit;">Aber alles beruhigte sich und 2014 wurde die SRO geschlossen, weil sie nicht mehr ben√∂tigt wurden. </font><font style="vertical-align: inherit;">Wir leben also bis heute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Wort "SRE" im Unternehmen ist ber√ºchtigt, aber wir sehen aus wie SRE bei Google. </font><font style="vertical-align: inherit;">Es gibt Unterschiede.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir sind </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">immer in Teams eingebaut. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben im Allgemeinen keine SRE-Suche, wie bei Google, sondern f√ºr jeden Suchdienst separat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sind nicht in den Produkten</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><strong><font style="vertical-align: inherit;">sondern</font></strong><font style="vertical-align: inherit;"> nur in der Infrastruktur, die das Produkt selbst verwaltet.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir sind </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oncall</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zusammen mit den Entwicklern.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben etwas mehr Erfahrung mit Systemen und Netzwerken, daher konzentrieren wir uns </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">darauf,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dienste </font><strong><font style="vertical-align: inherit;">zu √ºberwachen</font></strong><font style="vertical-align: inherit;"> und zu l√∂schen, wenn sie hell brennen. </font><font style="vertical-align: inherit;">Wir beheben Fehler im Voraus, die von Anfang an zu Abst√ºrzen f√ºhren und die Architektur neuer Dienste beeinflussen k√∂nnen, damit diese sp√§ter in der Produktion reibungslos funktionieren.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úberwachung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist das Wichtigste. </font><font style="vertical-align: inherit;">Wie machen wir das? </font><font style="vertical-align: inherit;">Wie jeder: ohne schwarze Magie, in seinem eigenen Zuhause. </font><font style="vertical-align: inherit;">Aber der Teufel wird Ihnen wie immer ausf√ºhrlich davon erz√§hlen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OBEN AUF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir von unten. Jeder kennt TOP unter Linux, und wir verwenden ATOP, wobei "A" "fortgeschritten" ist - ein Systemleistungsmonitor. Der Hauptvorteil von ATOP besteht darin, dass der Verlauf gespeichert wird: Sie k√∂nnen ihn so konfigurieren, dass Snapshots auf der Festplatte gespeichert werden. Unser ATOP l√§uft alle 5 Sekunden auf allen Maschinen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein Beispielserver, auf dem das PHP-Backend f√ºr facebook.com ausgef√ºhrt wird. Wir haben unsere virtuelle Maschine geschrieben, um PHP-Code auszuf√ºhren. Sie hei√üt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HHVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (HipHop Virtual Machine). Laut exportierten Metriken haben wir festgestellt, dass mehrere Maschinen nicht fast eine einzige Anfrage in einer Minute verarbeitet haben. Mal sehen, warum, √∂ffnen Sie ATOP 30 Sekunden bevor es h√§ngt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p2/vt/wf/p2vtwfqsucdo-shyennmf64opy8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist zu sehen, dass wir bei den Prozessorproblemen zu viel laden. </font><font style="vertical-align: inherit;">Es gibt auch Probleme mit dem Speicher, es sind nur noch 1,5 GB im Cache und nach 5 Sekunden nur noch 800 MB. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dz/q-/_x/dzq-_x7xjizrcgynj3gdayuh8u0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach weiteren 5 Sekunden wird die CPU freigegeben, nichts wird ausgef√ºhrt. </font><font style="vertical-align: inherit;">ATOP sagt, schauen Sie sich das Endergebnis an, wir schreiben auf die Festplatte, aber was? </font><font style="vertical-align: inherit;">Es stellt sich heraus, dass wir Swap schreiben. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/-j/v1/4z-jv12mgthgjnezqlvbznu6ync.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wer macht das? </font><font style="vertical-align: inherit;">Prozesse, die aus dem Speicher 0,5 GB entnommen und in Swap gestellt wurden. </font><font style="vertical-align: inherit;">An ihre Stelle traten zwei verd√§chtige Python-Prozesse, die dann als Befehlszeile angesehen werden k√∂nnen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8y/ej/uk/8yejuk2y3eeswlw7astqbiaaste.jpeg"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ATOP ist wundersch√∂n, wir benutzen es st√§ndig.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie es nicht haben, empfehle ich dringend, es zu verwenden. </font><font style="vertical-align: inherit;">Haben Sie keine Angst um das Laufwerk, ATOP frisst alle 5 Sekunden nur 200-300 MB pro Tag.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malloc HTTP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Den Bahamas und den gro√üen Zwischenf√§llen geben wir Namen. Es gibt einen lustigen Fehler im Zusammenhang mit ATOP namens Malloc HTTP. Wir haben es mit ATOP und Strace deb√ºtiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden Thrift √ºberall als RPC. In den fr√ºhen Versionen des Parsers gab es einen erstaunlichen Fehler, der so funktionierte: Es kam eine Nachricht an, bei der die ersten 4 Bytes der Gr√∂√üe der Daten entsprechen, dann die Daten selbst und die ersten Bytes der n√§chsten Nachricht hinzugef√ºgt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber einmal eines der Programme, anstatt zum Thrift-Dienst zu gehen, ging ich zu HTTP und erhielt eine Antwort ¬´das HTTP Bad the Request¬ª : </font></font><code>HTTP/1.1 400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem es HTTP genommen und mit malloc HTTP die Anzahl der Bytes zugewiesen hat.</font></font><br>
<br>
<pre><code class="bash hljs">Thrift message<font></font>
HTTP/1.1 400<font></font>
<span class="hljs-string">"HTTP"</span> == 0x48545450</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist okay, wir haben Overcommit, lassen Sie uns mehr Speicher zuweisen! </font><font style="vertical-align: inherit;">Wir haben mit malloc zugeteilt, und bis wir dort schreiben und lesen, werden sie uns keine wirkliche Erinnerung geben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber es war nicht da! </font><font style="vertical-align: inherit;">Wenn wir gabeln wollen, gibt die Gabel einen Fehler zur√ºck - es ist nicht genug Speicher vorhanden.</font></font><br>
<br>
<pre><code class="bash hljs">malloc(<span class="hljs-string">"HTTP"</span>)<font></font>
pid = fork(); // errno = ENOMEM</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber warum gibt es eine Erinnerung? </font><font style="vertical-align: inherit;">Beim Verst√§ndnis der Handb√ºcher haben wir festgestellt, dass alles sehr einfach ist: Die aktuelle Overcommit-Konfiguration ist so, dass es sich um eine magische Heuristik handelt, und der Kernel selbst entscheidet, wann viel und wann nicht:</font></font><br>
<br>
<pre><code class="bash hljs">malloc(<span class="hljs-string">"HTTP"</span>)<font></font>
pid = fork(); // errno = ENOMEM<font></font>
<font></font>
// 0: heuristic overcommit<font></font>
vm.overcommit_memory = 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr einen Arbeitsprozess ist dies normal. Sie k√∂nnen malloc bis TB ausw√§hlen, f√ºr einen neuen Prozess jedoch - nein. </font><font style="vertical-align: inherit;">Ein Teil der √úberwachung bei uns war mit der Tatsache verbunden, dass der Hauptprozess kleine Skripte f√ºr die Datenerfassung gabelte. </font><font style="vertical-align: inherit;">Infolgedessen fiel unser √úberwachungsteil aus, weil wir uns nicht mehr gabeln konnten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FB303</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FB303 ist unser grundlegendes √úberwachungssystem. </font><font style="vertical-align: inherit;">Es wurde nach dem 1982er Standard-Bass-Synthesizer benannt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t2/x3/f4/t2x3f4of3j794hnfskzti5lk3va.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Prinzip ist einfach, daher funktioniert es immer noch: Jeder Dienst implementiert die Thrift getCounters-Schnittstelle.</font></font><br>
<br>
<pre><code class="php hljs">Service FacebookService {<font></font>
    map&lt;<span class="hljs-keyword">string</span>, i64&gt; getCounters()<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich implementiert er es nicht, da die Bibliotheken bereits geschrieben sind, alles im Code </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font><font style="vertical-align: inherit;">erledigt ist </font></font><code>set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="php hljs">incrementCounter(<span class="hljs-keyword">string</span>&amp; key);<font></font>
<font></font>
setCounter(<span class="hljs-keyword">string</span>&amp; key, int64_t value);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen exportiert jeder Dienst Z√§hler an den Port, den er bei Service Discovery registriert. Unten sehen Sie ein Beispiel f√ºr eine Maschine, die einen Newsfeed generiert und ungef√§hr 5,5 Tausend Paare (Zeichenfolge, Nummer) exportiert: Speicher, Produktion, alles. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sl/sb/fj/slsbfj9kapkaqsi3quo_do4q64a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Computer f√ºhrt einen Bin√§rprozess aus, der alle Dienste durchl√§uft, diese Z√§hler sammelt und speichert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speicher-GUI</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/lt/li/shltlimradfvsovwo1vp1xzudmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus und Grafana sehr √§hnlich, aber nicht. Der erste FB303-Eintrag auf GitHub war 2009 und Prometheus 2012. Dies ist eine Erkl√§rung f√ºr alle ‚ÄûHeimwerker‚Äú von Facebook: Wir haben sie gemacht, als es in Open Source nichts Normales gab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise wird nach den Namen von Z√§hlern gesucht. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vb/b3/ya/vbb3yabg-lhlypl1y7_zwf9dolw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Grafiken selbst sehen ungef√§hr so ‚Äã‚Äãaus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b7/td/lj/b7tdljhxpmw6d5rt1fpguoon3ru.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Bild aus der inneren Gruppe, in dem wir sch√∂ne Grafiken posten. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein wichtiger Unterschied zwischen unserem √úberwachungsstapel und Prometheus und Grafana besteht darin, dass </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir Daten f√ºr immer speichern</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Unsere √úberwachung wird die Daten erneut abtasten und nach 2 Wochen haben wir alle 5 Minuten einen Punkt und nach einem Jahr f√ºr jede Stunde. </font><font style="vertical-align: inherit;">Daher k√∂nnen sie so viel gespeichert werden. </font><font style="vertical-align: inherit;">Automatisch wird dies nirgendwo konfiguriert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir jedoch √ºber die Funktionen der √úberwachung von Facebook sprechen, w√ºrde ich dies mit einem englischen Wort ‚Äû </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beobachtbarkeit‚Äú beschreiben</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beobachtbarkeit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt eine "Black Box", es gibt eine "White Box" und wir haben eine transparente "Box" aus Glas. </font><font style="vertical-align: inherit;">Dies bedeutet, dass wir beim Schreiben von Code alles M√∂gliche in die Protokolle schreiben und nicht selektiv. </font><font style="vertical-align: inherit;">Das Sampling ist √ºberall gut abgestimmt, sodass das Backend f√ºr Speicher, Z√§hler und alles andere gut funktioniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig k√∂nnen wir unsere Dashboards bereits auf vorhandenen Z√§hlern aufbauen. </font><font style="vertical-align: inherit;">Wenn Sie diese Dashboards studieren, ist dies nicht der Endpunkt mit 10 Diagrammen, sondern der erste, von dem aus wir zu unserer Benutzeroberfl√§che gehen und dort alles finden, was m√∂glich ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tauchen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist der H√∂hepunkt der Idee der Beobachtbarkeit. Dies ist unser ELK-Stack. Das Prinzip ist dasselbe: Wir schreiben in JSON ohne ein bestimmtes Schema und fordern dann in Form einer </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabelle</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Zeitreihen von Daten oder 10 weitere Visualisierungsoptionen an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scuba protokolliert in der Gr√∂√üenordnung von Hunderten von Gigabyte pro Sekunde. Alles wird sehr schnell angefordert, da es sich nicht um Elasticsearch handelt und sich auf leistungsstarken Maschinen alles im Speicher befindet. Ja, daf√ºr wird Geld ausgegeben, aber wie wunderbar ist es! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unterhalb der Benutzeroberfl√§che von Scuba wird beispielsweise eine der beliebtesten Tabellen ge√∂ffnet, in die alle Clients aller Thrift-Dienste Protokolle schreiben. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dj/ah/ad/djahadigvrtru4luney67766slw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Grafik zeigt, dass am Ende im Service ein Fehler aufgetreten ist. Um die Verz√∂gerung herauszufinden, gehen Sie zur Liste der Z√§hler, w√§hlen Sie die Verz√∂gerung und Aggregation aus und klicken Sie auf "Tauchen". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/c-/y8/m2c-y8pfnqyrz4hivxhxyszwvnw.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Antwort kommt in 2 Sekunden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j6/ac/kg/j6ackggq0o7xk93vejg0yfbyrhi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist zu sehen, dass in diesem Moment etwas passiert ist und die Verz√∂gerung erheblich zugenommen hat. </font><font style="vertical-align: inherit;">Um mehr zu erfahren, k√∂nnen Sie nach verschiedenen Parametern gruppieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt Hunderte solcher Tabellen.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Tabelle, die die Versionen von Bin√§rdateien und Paketen zeigt, wie viel Speicher auf allen Millionen von Computern belegt ist. </font><font style="vertical-align: inherit;">Auf jedem Host wird einmal pro Stunde eine PS erstellt und an Scuba gesendet.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle dmesg, alle Speicherabbilder werden an andere Tabellen gesendet. </font><font style="vertical-align: inherit;">Wir f√ºhren Perf einmal alle 10 Minuten auf jedem Computer aus, damit wir wissen, welche Stack-Traces wir auf dem Kernel haben und was die globale CPU laden kann.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP-Debug</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scuba bietet auch ein Backend f√ºr unser Kern-PHP-Debugging-Tool. Tausende von Ingenieuren schreiben PHP-Code, und irgendwie m√ºssen Sie das globale Repository vor schlechten Dingen sch√ºtzen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie funktioniert es? PHP schreibt auch einen Stack-Trace in jedes Protokoll. Scuba (unsere Elasticsearch) kann einfach keine Stapelverfolgung von allen Protokollen von allen Maschinen aufnehmen. Bevor wir das Protokoll in Scuba ablegen, konvertieren wir den Stack-Trace in einen Hash, probieren ihn durch Hashes aus und speichern nur sie. Die Stack-Traces selbst werden an Memcached gesendet. Anschlie√üend k√∂nnen Sie im internen Tool schnell genug eine bestimmte Stapelverfolgung aus Memcached abrufen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/w_/im/chw_im8wjuue2nolmyzgcfappnq.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualisierung mit Hash-Gruppierung aus Protokollen und Stack-Traces.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wir debuggen den Code mit der </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pattern Matching-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">: √ñffnen Sie Scuba und sehen Sie, wie das Fehlerdiagramm aussieht.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/op/nx/ndopnxibxeidsb8cmyy0rokasjm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir gehen zu LogView, dort sind Fehler bereits nach Stack-Traces gruppiert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/0f/t3/yx0ft3lf_mnoskzxba7oqw3wtai.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Stack-Trace wird aus Memcached geladen, und bereits darauf k√∂nnen Sie diff (Commit im PHP-Repository) finden, das ungef√§hr zur gleichen Zeit ver√∂ffentlicht wurde, und es zur√ºcksetzen. </font><font style="vertical-align: inherit;">Jeder kann ein Rollback durchf√ºhren und sich bei uns festlegen. Hierf√ºr sind keine Berechtigungen erforderlich.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/eu/ck/kheuck1w2losbdhiyasysemlvnk.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dashboards</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich beende das √úberwachungsthema mit Dashboards. Wir haben nur wenige davon - nur zwei von drei Indikatoren. Das Dashboard selbst ist eher ungew√∂hnlich. Ich w√ºrde gerne mehr √ºber ihn sprechen. Unten finden Sie ein Standard-Dashboard mit einer Reihe von Grafiken. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/eu/ck/kheuck1w2losbdhiyasysemlvnk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider ist es bei ihm nicht so einfach. Tatsache ist, dass die violette Linie in einem Diagramm derselbe Dienst ist, dem die blaue Linie im anderen Diagramm entspricht, und dass sich ein anderes Diagramm an einem Tag und ein anderes in einem Monat befinden kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden unser auf </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubismus</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> basierendes Dashboard </font><font style="vertical-align: inherit;">- die Open Source JS-Bibliothek. Es wurde auf Square geschrieben und unter der Apache-Lizenz ver√∂ffentlicht. Sie haben integrierte Unterst√ºtzung f√ºr Graphit und W√ºrfel. Aber es ist leicht zu erweitern, was wir getan haben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Dashboard unten zeigt einen Tag mit einem Pixel pro Minute. </font><font style="vertical-align: inherit;">Jede Linie ist eine Region: Rechenzentren in der N√§he. </font><font style="vertical-align: inherit;">Sie zeigen die Anzahl der Protokolle, die das Facebook-Backend schreibt, in Bytes pro Sekunde an. </font><font style="vertical-align: inherit;">Unten finden Sie Anmerkungen f√ºr Teams in Amerika, um zu sehen, was wir bereits von den Ereignissen w√§hrend des Tages behoben haben. </font><font style="vertical-align: inherit;">In diesem Bild ist es leicht, nach Korrelationen zu suchen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fx/3u/8f/fx3u8f42urcs2ernp8cu_gvxj6q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unten ist die Anzahl der Fehler 500 angegeben. Was auf der linken Seite f√ºr die Benutzer nicht wichtig war, und offensichtlich gefiel ihnen der dunkelgr√ºne Streifen in der Mitte nicht. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/dp/g1/jydpg1dmhrcxiirkeba3dhmtxcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes folgt die Latenzzeit des 99. Perzentils. </font><font style="vertical-align: inherit;">Gleichzeitig ist, wie in der obigen Tabelle, zu sehen, dass die Latenz gesunken ist. </font><font style="vertical-align: inherit;">Um einen Fehler zur√ºckzugeben, muss nicht viel Zeit aufgewendet werden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/og/4w/it/og4witypnhr2n091yaiwzjqctsg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie es funktioniert</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einem 120 Pixel hohen Diagramm ist alles sichtbar. Viele davon k√∂nnen jedoch nicht auf einem Dashboard platziert werden, sodass wir uns auf 30 dr√ºcken. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/48/-t/-2/48-t-2gfcbcmotwnkifz2tln_9u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider erhalten wir dann eine Art Boa Constrictor. Gehen wir zur√ºck und sehen, was der Kubismus damit macht. Er zerlegt das Diagramm in vier Teile: Je h√∂her, desto dunkler und dann kollabiert er. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/s-/48/zgs-48iqemvyyyyxuh1g949aoji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt haben wir den gleichen Zeitplan wie zuvor, aber alles ist deutlich sichtbar: Je dunkler das Gr√ºn, desto schlechter. Jetzt ist viel klarer, was passiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Links sieht man die Welle, als sie aufstieg, und in der Mitte, wo sie dunkelgr√ºn ist, ist alles sehr schlecht. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/0f/xu/ql0fxubdkifq0ax-mwhbn00ndxi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubismus ist nur der Anfang. Es wird f√ºr die Visualisierung ben√∂tigt, um zu verstehen, ob jetzt alles schlecht ist oder nicht. F√ºr jede Tabelle gibt es bereits Dashboards mit detaillierten Grafiken.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/zx/u-/_pzxu-sbu9xc5p2gpoyrekvbybc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die √úberwachung selbst hilft, den Status des Systems zu verstehen und zu reagieren, wenn es ausf√§llt. </font><font style="vertical-align: inherit;">Auf Facebook muss jeder Oncall-Mitarbeiter in der Lage sein, alles zu reparieren. </font><font style="vertical-align: inherit;">Wenn es hell brennt, schaltet sich alles ein, vor allem aber Produktionsingenieure mit der Erfahrung eines Systemadministrators, weil sie wissen, wie man das Problem schnell l√∂st.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Facebook lag</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal passieren Vorf√§lle und Facebook l√ºgt. Normalerweise denken die Leute, dass Facebook wegen DDoS l√ºgt oder Hacker angegriffen werden, aber in 5 Jahren ist es nie passiert. Der Grund waren immer unsere Ingenieure. Sie sind nicht absichtlich: Die Systeme sind sehr komplex und k√∂nnen dort ausfallen, wo Sie nicht warten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir geben allen wichtigen Vorf√§llen Namen, damit Neulinge bequem erw√§hnt und dar√ºber informiert werden k√∂nnen, um Fehler in Zukunft nicht zu wiederholen. Der Champion mit dem lustigsten Namen ist der Vorfall </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Call the Cops</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Die Leute riefen die Polizei in Los Angeles an und baten darum, Facebook zu reparieren, weil es l√ºgt. Der Sheriff von Los Angeles hatte es so satt, dass er twitterte: "Bitte rufen Sie uns nicht an!" Wir sind daf√ºr nicht verantwortlich! ‚Äú </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4p/tl/nv/4ptlnvj0sppjmmmdt3zjowumd-u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mein Lieblingsvorfall, an dem ich teilgenommen habe, hie√ü </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAPSLOCK.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es ist insofern interessant, als es zeigt, dass alles passieren kann. Und genau das ist passiert. Es obychnyyIP Adresse : </font></font><code>fd3b:5679:92eb:9ce4::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Facebook verwendet Chef, um das Betriebssystem anzupassen. Service Inventory speichert die Hostkonfiguration in seiner Datenbank, und Chef empf√§ngt eine Konfigurationsdatei vom Service. Sobald der Dienst seine Version ge√§ndert hatte, begann er sofort, IP-Adressen aus der Datenbank im MySQL-Format zu lesen und in eine Datei zu kopieren. Die neue Adresse ist jetzt in Gro√übuchstaben geschrieben : </font></font><code>FD3B:5679:92EB:9CE4::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shef sieht sich die neue Datei an und stellt fest, dass sich die IP-Adresse ‚Äûge√§ndert‚Äú hat, da sie nicht in bin√§rer Form, sondern mit einer Zeichenfolge verglichen wird. Die IP-Adresse ist "neu", was bedeutet, dass Sie die Schnittstelle absenken und die Schnittstelle anheben m√ºssen. Bei allen Millionen Autos in 15 Minuten ging die Schnittstelle auf und ab.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint in Ordnung zu sein - die Kapazit√§t hat abgenommen, w√§hrend das Netzwerk auf einigen Computern lag. </font><font style="vertical-align: inherit;">Im Netzwerktreiber unserer benutzerdefinierten Netzwerkkarten trat jedoch pl√∂tzlich ein Fehler auf: Beim Start ben√∂tigten sie 0,5 GB sequentiellen physischen Speicher. </font><font style="vertical-align: inherit;">Auf Cache-Computern verschwanden diese 0,5 GB, w√§hrend wir die Schnittstelle absenkten und anhoben. </font><font style="vertical-align: inherit;">Daher ist auf Cache-Computern die Netzwerkschnittstelle ausgefallen und nicht gestiegen, und ohne Caches funktioniert nichts. </font><font style="vertical-align: inherit;">Wir setzten uns und starteten diese Maschinen mit unseren H√§nden neu. </font><font style="vertical-align: inherit;">Es hat Spa√ü gemacht.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incident Manager Portal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Facebook ‚Äûbrennt‚Äú, ist es erforderlich, die Arbeit der ‚ÄûFeuerwehr‚Äú zu organisieren und vor allem zu verstehen, wo es brennt, denn in einem gro√üen Unternehmen kann es an einem Ort ‚Äûverbrannt riechen‚Äú, aber das Problem liegt an einem anderen. </font><font style="vertical-align: inherit;">Das UI-Tool namens </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incident Manager Portal</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hilft uns dabei </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es wurde von Produktionsingenieuren geschrieben und steht allen offen. </font><font style="vertical-align: inherit;">Sobald etwas passiert, starten wir dort einen Vorfall: Name, Anfang, Beschreibung.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/px/sm/hjpxsmys_lbno7lkm9r9osacq7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben eine speziell geschulte Person - Incident Manager On-Call (IMOC). </font><font style="vertical-align: inherit;">Dies ist keine unbefristete Stelle, Manager wechseln regelm√§√üig. </font><font style="vertical-align: inherit;">Bei gro√üen Br√§nden organisiert und koordiniert IMOC Personen zur Reparatur, muss diese jedoch nicht selbst reparieren. </font><font style="vertical-align: inherit;">Sobald ein Vorfall mit einem hohen Gef√§hrdungsgrad erstellt wird, empf√§ngt IMOC SMS und hilft bei der Organisation. </font><font style="vertical-align: inherit;">In einem gro√üen System kann auf solche Menschen nicht verzichtet werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verh√ºtung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Facebook ist nicht so verbreitet. </font><font style="vertical-align: inherit;">Meistens l√∂schen wir keine Br√§nde und starten die Cache-Maschinen nicht neu, aber wir beheben Fehler im Voraus und wenn m√∂glich f√ºr alle gleichzeitig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobald wir das "Warteschlangenproblem" gefunden und behoben haben. </font><font style="vertical-align: inherit;">Die Anzahl der Anforderungen erh√∂ht sich um 50% und die Fehler um 100%, da niemand die Drosselung im Voraus implementiert, insbesondere bei kleinen Diensten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ein Beispiel f√ºr mehrere Dienste herausgefunden und ein Verhaltensmodell grob definiert.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unter normaler Last kommt die Anforderung an, wird verarbeitet und an den Client zur√ºckgegeben.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei hoher Auslastung warten Anforderungen in einer Warteschlange, da alle Threads f√ºr die Verarbeitung von Anforderungen ausgelastet sind. </font><font style="vertical-align: inherit;">Die Verz√∂gerung nimmt zu, aber bisher ist alles in Ordnung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Linie w√§chst, die Last steigt. </font><font style="vertical-align: inherit;">Irgendwann endet alles, was der Server auf dem Client ausf√ºhrt, mit einem Antwortzeitlimit, und der Client f√§llt mit einem Fehler aus. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt kann das Ergebnis des Servers einfach weggeworfen werden.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/0b/c1/b1/0bc1b11xgg49wz266m-tvoximls.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Client-Timeout wird rot hervorgehoben. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und der Kunde wiederholt noch einmal! </font><font style="vertical-align: inherit;">Es stellt sich heraus, dass alle von uns ausgef√ºhrten Anforderungen in den Papierkorb geworfen werden und niemand mehr ben√∂tigt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie kann man dieses Problem f√ºr alle gleichzeitig l√∂sen? </font><font style="vertical-align: inherit;">F√ºhren Sie eine Begrenzung der Wartezeit in der Warteschlange ein. </font><font style="vertical-align: inherit;">Wenn sich die Anforderung mehr als erwartet in der Warteschlange befindet, wird sie verworfen und nicht auf dem Server verarbeitet. Wir verschwenden keine CPU darauf. </font><font style="vertical-align: inherit;">Wir bekommen ein ehrliches Spiel: Wir werfen alles weg, was wir nicht verarbeiten k√∂nnen, und alles, was wir k√∂nnen - verarbeitet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Einschr√§nkung erm√∂glichte es, die Last um 50% √ºber das Maximum zu erh√∂hen, aber dennoch 66% der Anfragen zu verarbeiten und nur 33% der Fehler zu erhalten. </font><font style="vertical-align: inherit;">Die Entwickler des Frameworks f√ºr Dispatch haben dies auf der Serverseite implementiert, und wir, die Produktionsingenieure, haben das Zeitlimit von 100 ms in der Warteschlange f√ºr alle sanft festgelegt. </font><font style="vertical-align: inherit;">So erhielten alle Dienste sofort eine g√ºnstige Grunddrosselung.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Werkzeuge</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ideologie von SRE besagt, dass Sie automatisieren m√ºssen, wenn Sie eine gro√üe Flotte von Autos, eine Reihe von Diensten und nichts mit Ihren H√§nden zu tun haben. </font><font style="vertical-align: inherit;">Daher schreiben wir die H√§lfte der Zeit Code und erstellen Tools.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integrierter </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubismus</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in das System.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FBAR ist ein ‚ÄûArbeitstier‚Äú, das kommt und repariert, sodass sich niemand Sorgen um ein kaputtes Auto macht. </font><font style="vertical-align: inherit;">Dies ist die Hauptaufgabe des FBAR, aber jetzt hat es noch mehr Aufgaben.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coredumper</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , den wir mit zwei Kollegen geschrieben haben </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es √ºberwacht Coredumps auf allen Maschinen und legt sie zusammen mit Stack-Traces mit allen Host-Informationen an einem Ort ab: Wo liegt sie, wie findet man welche Gr√∂√üe? </font><font style="vertical-align: inherit;">Vor allem aber sind Stack-Traces kostenlos, ohne GDB mit BPF-Programmen zu starten.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umfragen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Letzte, was wir tun, ist mit Leuten zu reden, sie zu interviewen. </font><font style="vertical-align: inherit;">Dies scheint uns sehr wichtig zu sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine n√ºtzliche Umfrage betrifft die Zuverl√§ssigkeit. </font><font style="vertical-align: inherit;">In den wichtigsten Zitaten unseres Fragebogens fragen wir nach bereits laufenden Diensten:</font></font><br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Die Hauptverantwortung der Systemsoftware muss darin bestehen, weiter zu laufen. </font><font style="vertical-align: inherit;">Die Erbringung von Dienstleistungen sollte als vorteilhafter Nebeneffekt des fortgesetzten Betriebs angesehen werden ¬ª</font></font></em></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies bedeutet, dass die Hauptaufgabe des Systems darin besteht, weiter zu arbeiten, und die Tatsache, dass es irgendeine Art von Service bietet, ist ein zus√§tzlicher Bonus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Umfragen sind nur f√ºr mittlere Dienste gedacht, gro√üe selbst verstehen. </font><font style="vertical-align: inherit;">Wir geben einen Fragebogen, in dem wir grundlegende Fragen zu Architektur, SLO und zum Beispiel zum Testen stellen.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Was passiert, wenn Ihr System 10% der Last erh√§lt?" </font><font style="vertical-align: inherit;">Wenn die Leute denken: "Aber wirklich, was?" </font><font style="vertical-align: inherit;">- Einsichten erscheinen und viele regieren sogar ihre Systeme. </font><font style="vertical-align: inherit;">Fr√ºher haben sie nicht dar√ºber nachgedacht, aber nach der Frage gibt es einen Grund.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Wer ist der erste, der normalerweise Probleme mit Ihrem Dienst bemerkt - Sie oder Ihre Benutzer?" </font><font style="vertical-align: inherit;">Entwickler beginnen sich zu erinnern, wann dies passiert ist und: "... Vielleicht m√ºssen Sie Warnungen hinzuf√ºgen."</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Was ist dein gr√∂√üter Oncall-Schmerz?" </font><font style="vertical-align: inherit;">Dies ist ungew√∂hnlich f√ºr Entwickler, insbesondere f√ºr neue. </font><font style="vertical-align: inherit;">Sie sagen sofort: ‚ÄûWir haben viele Warnungen! </font><font style="vertical-align: inherit;">Lassen Sie uns sie reinigen und diejenigen entfernen, die nicht der Fall sind. ‚Äú</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Wie h√§ufig sind deine Ver√∂ffentlichungen?" </font><font style="vertical-align: inherit;">Zuerst erinnern sie sich daran, dass sie es mit ihren H√§nden freigeben, und dann haben sie ihre eigene benutzerdefinierte Bereitstellung.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Fragebogen enth√§lt keine Kodierung, er ist standardisiert und √§ndert sich alle sechs Monate. </font><font style="vertical-align: inherit;">Dies ist ein zweiseitiges Dokument, das wir in 2-3 Wochen ausf√ºllen k√∂nnen. </font><font style="vertical-align: inherit;">Und dann arrangieren wir eine zweist√ºndige Kundgebung und finden L√∂sungen f√ºr viele Probleme. </font><font style="vertical-align: inherit;">Dieses einfache Tool funktioniert gut mit uns und kann Ihnen helfen.</font></font><br>
<br>
<blockquote>6-7         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Saint HighLoad++</a>,          .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>   (,   ,  ). <br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">telegram-</a>  .   !</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489192/index.html">Smart Engines erreichte im FWCI-Ranking unter den Basisorganisationen von FizTech die ersten drei Pl√§tze</a></li>
<li><a href="../de489194/index.html">Wie OpenShift die Organisationsstruktur einer IT-Organisation ver√§ndert. Die Entwicklung von Organisationsmodellen beim Wechsel zu PaaS</a></li>
<li><a href="../de489196/index.html">Magic Smoke: Mikrocontroller vs. Linearregler</a></li>
<li><a href="../de489198/index.html">Wie Sie sich mit Liquibase nicht in den Fu√ü schie√üen</a></li>
<li><a href="../de489200/index.html">Was Startups f√ºr Y Combinator im Jahr 2020 suchen</a></li>
<li><a href="../de489210/index.html">Testen der Linux-Codeleistung anhand von Beispielen</a></li>
<li><a href="../de489212/index.html">1C-Bitrix verhindert das Abbestellen des Newsletters durch die Verpflichtung zur √úbermittlung ihrer pers√∂nlichen Daten</a></li>
<li><a href="../de489214/index.html">Moderner Ansatz zum Testen der Lokalisierung unter iOS</a></li>
<li><a href="../de489218/index.html">Es ist naiv. Super: Code und Architektur eines einfachen Spiels</a></li>
<li><a href="../de489226/index.html">Methoden zum Optimieren von LINQ-Abfragen in C # .NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>