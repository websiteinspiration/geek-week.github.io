<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✍️ 🧛🏻 👩🏼‍🍳 死の日標準ライブラリ 🚉 🧘 🗽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="プラハで先日、C ++標準化委員会がABIの変更の問題について一連の調査を実施し、最終的には何も変更しないことが決定されました。ホールでは拍手はありませんでした。
 私はこの決定がもたらす結果を完全には認識していなかったと思います、そして、原則として、それが言語の発展にプラスの影響を与えることができ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>死の日標準ライブラリ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490222/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラハで先日、C ++標準化委員会がABIの変更の問題について一連の調査を実施し、最終的には何も変更しないことが決定されました。</font><font style="vertical-align: inherit;">ホールでは拍手はありませんでした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はこの決定がもたらす結果を完全には認識していなかったと思います、そして、原則として、それが言語の発展にプラスの影響を与えることができるとは思いません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7a/j5/al/7aj5al5kxo5gjlw1lbrr0ftlemq.png"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABIとは</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ABI-プログラムがバイナリ形式でどのように表現されるか、名前がどのように宣言されるか、クラスマークアップが定義されるか、関数呼び出し規則が定義される一連の規則。</font><font style="vertical-align: inherit;">実際、これは一種のバイナリプロトコルですが、バージョン管理されていません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用語と混同しないように、ABIの変更に伴う影響とプログラム内での内訳の例を見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のいずれかを行った場合、コンパイルされたライブラリの新しいバージョンでエクスポートされたシンボルを使用できません。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既存のクラスに新しいフィールドを追加しました</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス/関数のテンプレートパラメータを変更し、テンプレート関数を非テンプレートに変更、またはその逆に、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">可変テンプレートを</font></a><font style="vertical-align: inherit;">追加</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インライン</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定子</font><font style="vertical-align: inherit;">を何かに</font><font style="vertical-align: inherit;">適用する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数宣言にデフォルトパラメータを追加</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい仮想メソッドが発表されました</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、はるかに多くのことですが、上記の例は委員会によって言及された主なものであり、それ自体が標準の提案のほとんどがその場で破棄されるおかげです。</font><font style="vertical-align: inherit;">ABIに違反するためのオプションを省略しました。その間に、プログラムのソースコードも破損します（たとえば、関数の削除や変更）。</font><font style="vertical-align: inherit;">ただし、これは常に正しいとは限りません。</font><font style="vertical-align: inherit;">たとえば、関数を削除しても、必ずしもソースコードが破損するわけではありません。</font></font><code>std::string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には変換演算子がありますが</font></font><code>std::string_view</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これは私が喜んで削除します。これを削除するとABIが機能しなくなりますが、ソースコードに重大な問題が発生することはありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜABIを壊すべきか</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、現在のABIを中断した場合に実装できる標準ライブラリの実装には、いくつかの便利な変更があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">連想コンテナを（はるかに）速くする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作業をスピードアップします</font></font><code>std::regex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（現時点では、PHPを実行して正規表現で検索する方が、標準のものを使用するよりも高速です</font></font><code>std::regex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中にいくつかの変更</font></font><code>std::string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>std::vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だけでなく、他のコンテナのレイアウトで</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスインターフェースの統一：現時点では、ABIの安定性のため、一部の実装は意図的に単一のインターフェースに対応していません</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに重要なことに、ABIのセキュリティ問題に遭遇しない限り、ライブラリの設計に変更を加えることはできません。</font><font style="vertical-align: inherit;">上記の理由で現在実行できないすべての不完全なリストを以下に示します。</font></font><br>
<br>
<ul>
<li><code>std::scoped_lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> アビの変化を壊さないために追加されました </font></font><code>lock_guard</code></li>
<li><code>int128_t</code>    ,    <code>intmax_t</code>. ,    ,    ,  <code>intmax_t</code>   <i>deprecated</i></li>
<li><code>std::unique_ptr</code>           ,     <i>zero-overhead</i>     </li>
<li>   <code>error_code</code>     - ,       ABI</li>
<li><code>status_code</code>     ABI</li>
<li>    <code>recursive_directory_iterator</code>  ,     ABI</li>
<li>      <code>&lt;cstring&gt;</code> <code>constexpr</code> ( <code>strlen</code>)     ,   ABI</li>
<li>  UTF-8  <code>std::regex</code> —  ABI</li>
<li><font style="vertical-align: inherit;"></font><code>realloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">割り当てられたメモリに</font><font style="vertical-align: inherit;">サポートを追加して</font><font style="vertical-align: inherit;">そのサイズを返すことは、ポリモーフィックアロケータのABIの内訳です</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多相型の暗黙的な仮想デストラクタの作成</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>push_back</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在のABIが壊れている場合</font><font style="vertical-align: inherit;">、戻り値の型y </font><font style="vertical-align: inherit;">を変更できます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的に、私たちは本当にandを必要と</font></font><code>push_back</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font><code>emplace_back</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ますか？</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code> std::shared_ptr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ABIの内訳も引き起こす</font></font></li>
<li><code>[[no_unique_address]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 現在のABIを保存する必要がない場合、コンパイラーによって出力される可能性があります</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、リストはそこで終わりません。</font><font style="vertical-align: inherit;">WG21はそのようなもののリストを最新に保つように努めるべきだと思います。</font><font style="vertical-align: inherit;">しかし、私は「ABIを壊すだろう」と言っている人全員が同じ部屋にいることに注意します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他に何を変更したいですか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
知りません。</font><font style="vertical-align: inherit;">そして、私は何を知らないのか分かりません。</font><font style="vertical-align: inherit;">しかし、推測を求められたら、次のように言います。</font></font><br>
<br>
<ul>
<li>     C++23      ABI,    -        ,    ABI.          </li>
<li>   ,  ,          ,    ,          ABI</li>
<li>        ABI,       </li>
<li>    ,     ABI</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Tombstone</a>      ABI</li>
</ul><br>
<h2> ABI  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前回のABIディスカッションでは、プラハでいくつかの調査が行われましたが、何もわかりません。</font><font style="vertical-align: inherit;">あなたが悲観論者であるか楽観主義者であるかに応じて、現在の結果はあなたによって異なって解釈されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要な事実：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG21は23でABIを壊したくない</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG21は、C ++の将来のバージョン（C ++ 26以降）でABIを解除する必要があると考えています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG21はABIに違反する提案を検討するのに時間がかかります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG21は永遠の安定を約束しない</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG21は、言語の安定性を損なう場合でも、パフォーマンスの優先度を維持することが重要であると考えています</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのステートメントには多くの重要なポイントがありますが、コンセンサスはありません。</font><font style="vertical-align: inherit;">奇妙なことに、委員会は半分に分かれた。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">占い</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更を待つC ++のバージョン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべての世論調査の明らかな欠点は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、正確</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><i><font style="vertical-align: inherit;">いつ</font></i><font style="vertical-align: inherit;"> ABIを打破する</font><i><font style="vertical-align: inherit;">か</font></i><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">決定していないこと</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C ++ 23で？いいえ、まだです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C ++ 26で？一部の人々は投票するつもりですが、別の部分はC ++ 41に投票するか、退職するときに投票する可能性があり、現在のプロジェクトをサポートする必要はありません。 C ++について述べた質問の1つ- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつか</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。とても快適！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もしABIが今違反されることができないならば、それは後で違反されることができると信じる理由はありません。安定性を必要とする人々は標準より数年遅れています。ですから、今それを壊さなければ、人々は約束されたことのないABIに頼り続けるでしょう、おそらくさらに10年、あるいは20年も。私たちがこの調査を実施したという単純な事実は、最終的にはABIに違反しないように投票したことで、エコシステム全体が次第に石と停滞状態になりつつあることを示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3年後に行われる調査で何かが変わるとは思いません。地球温暖化のようなものです。いつかはこの問題に取り組む必要があることに誰もが同意します。そして、2070年にディーゼルを禁止しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今後5年間で計画されていないことはすべて起こり得ないでしょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABIに違反するオファーについて</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WG21は、現在のABIに違反する提案により多くの時間を割くことに投票しました。</font><font style="vertical-align: inherit;">これはいくつかのことを意味します：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委員会の最も騒々しい部屋の1つでこの問題について話し合うためにより多くの時間を費やし、採択の可能性が高い提案をあまり残さず、結局同じように拒否します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABIを壊さない代替案を探します（これについては以下で説明します）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABIの部分的な変更が導入される可能性があります（以下も参照）</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABIの安定性よりもパフォーマンスが重要</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5歳のお菓子が欲しいかどうかを尋ねるようなものです。</font><font style="vertical-align: inherit;">もちろん、パフォーマンスの重要性について投票します。</font><font style="vertical-align: inherit;">しかし、一部の人がまだ反対票を投じているのではないかと心配しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
委員会は同時に2つの椅子に座りたいと思っているようです。</font><font style="vertical-align: inherit;">そしてこれは不可能です：</font></font><br>
<blockquote><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブライスアデルスタインレル</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッハ</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"> @</font></a></b><font style="vertical-align: inherit;"> blebach-</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 パフォーマンス</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -安定性</font><font style="vertical-align: inherit;">ABI-</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 何かを変更する能力</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
提案されたものから2つのオプションを選択します。</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、言語の安定性とABIは互いに衝突するため、C ++とは何か、その標準ライブラリーとは何かというような根本的な質問をします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、この場合、「パフォーマンス」、「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼロコストの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抽象化」、「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用しないものにお金を払わない</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」という用語</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">記憶されます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして、ABIの安定性は、これらのすべてにわたっています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">広範囲にわたる影響</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/5d7/90b/d50/5d790bd50abd97b45921c4f61a8ef757.webp" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
23年目にABIを破らないという決定は、委員会がこれまでに犯した最大の間違いであると私は強く確信しています。</font><font style="vertical-align: inherit;">そして私は一部の人々が反対を信じていることを知っています。</font><font style="vertical-align: inherit;">しかし、これはすぐに起こりそうなことです：</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学習の悪夢</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正直に言いましょう。 ABIに依存するすべてのプログラムは、どこかで</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ODRの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原則に違反するか</font><font style="vertical-align: inherit;">、互換性のないフラグを使用する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいプログラムはソースコードからコンパイルする必要があります。ソースからのアセンブリで構築されたツールが必要であり、どこかから取得してプロジェクトに挿入されたライブラリのコレクションではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、ソースからビルドすることはそれほど簡単ではありません。しかし、製品へのこのアプローチを奨励し、コンパイラーを定期的に更新して、リリースから1か月後ではなく、リリース後1か月で新しく導入された機能を利用できるようにする必要があります。適切で信頼性が高く、スケーラブルで再現可能なソリューション、オープンソースライブラリ、依存システムを奨励する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
委員会は、ABIへの違反を拒否し、その存続期間を通じて、不十分に記述されたプログラムをサポートすると公然と述べています。</font><font style="vertical-align: inherit;">apt-installを介して取得したライブラリ（実際にはシステムを対象としています）にリンクしていなくても、委員会が彼らに祝福を与えたので、他の人々がいます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは大きな一歩です。</font><font style="vertical-align: inherit;">これを行うインセンティブがない場合、どのようにして他の人に良い言語実践を教えることができますか？</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準ライブラリへの関心の喪失</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ABIに違反する意思がないためにライブラリのパフォーマンスが低下すると推定されるのは、5〜10％と推定されます。</font><font style="vertical-align: inherit;">この数は時間とともに増加します。</font><font style="vertical-align: inherit;">例を見てみましょう：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大企業の場合は、新しいデータセンターを購入するか、独自のライブラリをサポートするプログラマーのチームに支払うことができます</font></font></li>
<li>    ,   5%              ,     </li>
<li>   ,   5-10%  ,               VR-</li>
<li>   ,        —     </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、意地悪に、「C ++とその標準ライブラリを使用する必要があります！」という質問が生じると思います。そして、「多分私は標準ライブラリを使用すべきではないのですか？それとも私は原則としてC ++を使用すべきではないのですか？おそらく.NET、julia、Rustのどちらがより良いソリューションでしょうか？」もちろん、答えに影響を与える多くの要因がありますが、最近何が起こっているかがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのゲーム開発者は、標準ライブラリに非常に懐疑的です。彼らは</font><font style="vertical-align: inherit;">STLを利用するので</font><font style="vertical-align: inherit;">はなく、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EASTL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの独自の代替手段を開発したいと考えてい</font><font style="vertical-align: inherit;">ます。 Facebookは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">愚かであり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Googleは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常軌を逸している</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
雪だるまみたいです。</font><font style="vertical-align: inherit;">標準ライブラリを使用しない場合、標準ライブラリを改善することに関心はありません。</font><font style="vertical-align: inherit;">パフォーマンスは、ライブラリを維持するための重要な要素です。</font><font style="vertical-align: inherit;">パフォーマンスの保証がなければ、はるかに少ない労力で開発が行われます。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://twitter.com/foonathan" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JonathanMüller</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> @foonathan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスが向上しない場合、標準ライブラリのコンテナを使用する意味は何ですか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Titus Winters</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> @TitusWinters </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく一般的で簡単にアクセスできるためでしょうか？</font><font style="vertical-align: inherit;">（これら2つの事実は同じことを意味するものではありません）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ABIを維持するための投票は、標準ライブラリがマクドナルドになるように努力すべきだと言っているようなものです。彼はどこにでもいて、安定していて、技術的にタスクを解決しています。</font></font><br>
</blockquote> <h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委員会はどのようにしてABIを破る提案を検討できますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ABIに違反した場合に申し出を受け入れることができないために生じる痛みの軽減として、いくつかのオプションが提供されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい名前を追加する</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/9db/f42/6f8/9dbf426f89a37d487fb3b446edebc89d.webp" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが最初の明白な解決策です。変更できない場合は</font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、単に追加でき</font></font><code>std::fast_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ますか？これが悪い理由はいくつかあります。標準ライブラリにタイプを追加することは、サポートコストと教育の両方の面でコストがかかります。新しいクラスの導入後、何千もの記事が必然的に表示され、どのコンテナを使用すべきかを説明します。たとえば、</font></font><code>std::scoped_lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font><font style="vertical-align: inherit;">を使用する必要があります</font><font style="vertical-align: inherit;">か</font></font><code>std::lock_guard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？何も思いつきません！毎回グーグルする必要があります。良い名前が遅かれ早かれ終わるという問題もあります。また、すべてのコンテナは常に相互に変換する必要があるため、プログラムの実行中に多少のオーバーヘッドが発生し、クラス内の膨大な数の変換オーバーロードを制御することが困難になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
皮肉なことですが、上記のソリューションをサポートする人々は、C ++は言語が複雑すぎると主張することもできます。</font><font style="vertical-align: inherit;">ライブラリに複製を追加しても、簡単にはなりません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、私たちはこの提案を標準として受け入れることができます！</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のライブラリ開発者は、実際には何も違反していませんが、ABIの失敗を回避するために変更される可能性はありますが、ABI違反のためにオファーが拒否されたと主張しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
皮肉な人間として、私が信じるのは少し難しいです。</font><font style="vertical-align: inherit;">実際には、そのような提案はありませんでしたし、それらを適用できるシナリオは非常に限られています。</font><font style="vertical-align: inherit;">ABIレビューグループ（ARG）はこの問題に役立つ可能性がありますが、クラス/関数に別の名前を再度推奨する可能性があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分的なAbi違反</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主なアイデアは、ABI全体を壊すのではなく、特定のクラスまたは関数に対してのみ変更することです。</font><font style="vertical-align: inherit;">このアプローチの問題は、リンク段階でのエラーの代わりに、プログラムの起動中にすでに問題が発生することであり、私たちを驚かせることは不愉快なことです。</font><font style="vertical-align: inherit;">委員会は、マークアップを変更したとき、C ++ 11でこのアプローチをすでに試みていました</font></font><code>std::string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">良いことは何もありませんでした。</font><font style="vertical-align: inherit;">すべてが非常に悪かったため、この事実は現在のABIを維持するための議論として依然として使用されています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のレベルの索引付け</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ABIのいくつかの問題の解決策は、ポインターを介してクラスのデータにアクセスする機能であり、クラスのマークアップはそのポインターにすぎません。このアイデアは</font><font style="vertical-align: inherit;">、ABIのため</font><font style="vertical-align: inherit;">に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Qtで</font></a><font style="vertical-align: inherit;">積極的に使用され</font><font style="vertical-align: inherit;">ている</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PIMPL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イディオムに非常に近いものです</font><font style="vertical-align: inherit;">。はい、それはクラスメンバーの問題を解決しますが、仮想メソッドで何をすべきか？</font><font style="vertical-align: inherit;">
より重要な観点から問題を考えると、ABIのフレームワークに含まれるすべてのものに対して、1レベルの間接指定（ポインターインデックス）とヒープ内のメモリの追加割り当てを追加することについて話している。実際、STLでは、一般化されたクラスのコレクションであるため、すべてがこのフレームワークに含まれています。</font><font style="vertical-align: inherit;">
その結果、このアプローチの価格は非常に高くなります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題の解決策として、規格にはすでにいくつかの提案があります。</font><font style="vertical-align: inherit;">それらのいくつかは、PIMPLを言語の機能の1つにしたいので、ABIの安定性と高性能のどちらかを選択できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし皮肉なことに、ライブラリタイプをPIPMLタイプに変換するには、ABIを解除する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3年ごとにすべてのコードを再構成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の考えだけで大声で。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準の現在のオファーはすべて破棄する必要があります</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
逆説的に言えば、C ++は今ほど活発になったことはありません。</font><font style="vertical-align: inherit;">プラハでは、250人が彼のために次のような多くのことに取り組みました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数値</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">線形代数</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オーディオ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unicode</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非同期I / O</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2Dおよび3Dグラフィックス</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他の多くの機能</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべての提案は、1つの共通の事実によって統一されています。現在の標準にあるものと比較すると、これらははるかにオプションです。人々は単に彼らの研究や仕事の分野からのもの、あるいは常に進化し変化しているものを標準化しようとしています。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特に、Unicodeアルゴリズムは非常に不安定であり、時間とともに急速に変化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーキングの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ような恐怖が地平線に迫っている</font><font style="vertical-align: inherit;">。セキュリティの問題につながる可能性のあるものを標準化しようとすることは非常に無責任であり、同時にそれを後で変更することはできません（ABIを思い出してください）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C ++はそれを安定させることを決定したため、これらの提案はすべて破棄して書き込む必要があります。私は滅びたくありませんが、これは行われなければなりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、彼らはまだそれをしません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最良のケースでは、C ++の新しいバージョンの1つで間違いを犯したり現在の状態を標準化したりせず、すべてをゆっくりと分解します。これは修正できないためです（Networking TSの場合、何も変更できないように見えるため、 10年前に存在していたものを標準化する必要があります。そうすれば、もちろんライブラリは大幅に改善できますが、この話は別の時間に残しておきましょう）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、もちろん、私たちは多くの間違いを犯します。</font></font><br>
<br>
<blockquote>&gt;&gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><b>Ólafur Waage</b></a> @olafurw<br>
(      ,    )<br>
<br>
 ,  !<br>
<br>
         .       ,      ( : , , )?<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><b>Hyrum Wright</b></a> @hyrumwright<br>
    ,    ,  .       —    ,      .<br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のミスはトレードオフであるため、故意に行われますが、他のミスは何年も気付かれません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時間は経過しますが、標準ライブラリはそのままです。以前に行われたトレードオフは徐々に私たちを悩ませ始めており、後に既存のコードの本当の「ボトルネック」になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIに組み込まれているため、変更が実際に不可能であるものもあります。私たちは皆、既存のAPIを変更することがどれほど難しいかという考えを持っています。しかし、ABIを壊すことができれば、コードの一部を修正して改善することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C ++は今後40年間はまだ浮かぶでしょう。いつでも予測できない方法で変更する必要があることに気付かない場合は、原則としてこのゲームをプレイしないことが唯一の正しい行動です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
標準の連想コンテナが10年未満の使用に適していることは誰もが知っています。</font><font style="vertical-align: inherit;">しかし、なぜ標準でのより大きな提案がより成功すると考えるのでしょうか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
標準への申し出</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破棄され、地雷も同様に破棄されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委員会は原則としてABIを破ることができますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの人は、委員会が原則としてそのような決定を下すことができないと確信しています。それは、ライブラリ開発者が単にそれを無視するからです。</font><font style="vertical-align: inherit;">これらすべては、委員会がプレーしないことを決定した腕相撲に酷く似ています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、実際のところ、どの製品の開発者にも独自のユーザーがいます。</font><font style="vertical-align: inherit;">ユーザーとは、まず何がトレードオフになるかを理解する必要があるユーザーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの人々は、情報に基づく選択をせずに、偶然にABIにかなり依存しています。</font><font style="vertical-align: inherit;">もちろん、誰もが安定性に依存したいので、多くの人々は安定性にも依存しています。</font><font style="vertical-align: inherit;">しかし、他のものと同様に、安定性には代償があり、今ではC ++エコシステム全体がその代償を払っています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490198/index.html">信頼するが検証する！デモホールPult.ruのホームシアター用のエプソンプロジェクターを備えたデモゾーン</a></li>
<li><a href="../ja490202/index.html">クエリのカウント：基本的なDjangoパフォーマンステスト</a></li>
<li><a href="../ja490204/index.html">2020年3月の人事およびIT採用担当者向けイベントのダイジェスト</a></li>
<li><a href="../ja490208/index.html">DUMP2020のバックエンドセクション：banter、fan、fail</a></li>
<li><a href="../ja490210/index.html">フロントエンドの高速化。サーバーリクエストが多い場合</a></li>
<li><a href="../ja490224/index.html">おしゃれなステルス</a></li>
<li><a href="../ja490226/index.html">ブレンディングとユニティテレイン：交差点を取り除き、目を傷つけないようにする方法</a></li>
<li><a href="../ja490232/index.html">AWS ELBを使用した負荷分散</a></li>
<li><a href="../ja490234/index.html">Auroraのモバイルバンクをどのように実行したか：国内のモバイルOSの開発機能</a></li>
<li><a href="../ja490238/index.html">出会い系アプリが私たちを孤独にする方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>