<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏾 💓 🧕🏻 PythonとTextBlobによるプロトタイプ感情分析 😳 🤭 👨🏽‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="機械学習システムの構築を始めたばかりの開発チームにとって重要なことは何ですか？アーキテクチャ、コンポーネント、統合および単体テストを使用したテスト機能により、プロトタイプを作成し、最初の結果を取得します。さらに、労働投入量の評価、開発と実施の計画。
 
 この記事ではプロトタイプに焦点を当てます。プ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PythonとTextBlobによるプロトタイプ感情分析</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457168/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/8l/ir/g2/8lirg2klkrmofom9vhhcgldh-qo.jpeg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
機械学習システムの構築を始めたばかりの開発チームにとって重要なことは何ですか？</font><font style="vertical-align: inherit;">アーキテクチャ、コンポーネント、統合および単体テストを使用したテスト機能により、プロトタイプを作成し、最初の結果を取得します。</font><font style="vertical-align: inherit;">さらに、労働投入量の評価、開発と実施の計画。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事ではプロトタイプに焦点を当てます。</font><font style="vertical-align: inherit;">プロダクトマネージャーとの会話の後に作成されたものです。機械学習を「感じ」てみませんか？</font><font style="vertical-align: inherit;">特に、NLPと感情分析？</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"何故なの？" </font><font style="vertical-align: inherit;">私は答えました。</font><font style="vertical-align: inherit;">それでも、15年以上バックエンド開発に携わってきました。データの操作とパフォーマンスの問題の解決が好きです。</font><font style="vertical-align: inherit;">しかし、「うさぎの穴の深さ」を知る必要がありました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントを選択</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MLカーネルのロジックを実装するコンポーネントのセットの概要を説明するために、GitHubで入手可能な多数の1つである感情分析の実装の簡単な例を見てみましょう。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pythonでの感情分析の一例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> collections
<span class="hljs-keyword">import</span> nltk
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> (<font></font>
    datasets, model_selection, feature_extraction, linear_model<font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_features</span>(<span class="hljs-params">corpus</span>):</span>
    <span class="hljs-string">'''Extract TF-IDF features from corpus'''</span>
    <span class="hljs-comment"># vectorize means we turn non-numerical data into an array of numbers</span><font></font>
    count_vectorizer = feature_extraction.text.CountVectorizer(<font></font>
        lowercase=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># for demonstration, True by default</span>
        tokenizer=nltk.word_tokenize,  <span class="hljs-comment"># use the NLTK tokenizer</span>
        stop_words=<span class="hljs-string">'english'</span>,  <span class="hljs-comment"># remove stop words</span>
        min_df=<span class="hljs-number">1</span>  <span class="hljs-comment"># minimum document frequency, i.e. the word must appear more than once.</span><font></font>
    )<font></font>
    processed_corpus = count_vectorizer.fit_transform(corpus)<font></font>
    processed_corpus = feature_extraction.text.TfidfTransformer().fit_transform(<font></font>
        processed_corpus)<font></font>
<font></font>
    <span class="hljs-keyword">return</span> processed_corpus<font></font>
<font></font>
data_directory = <span class="hljs-string">'movie_reviews'</span>
movie_sentiment_data = datasets.load_files(data_directory, shuffle=<span class="hljs-literal">True</span>)<font></font>
print(<span class="hljs-string">'{} files loaded.'</span>.format(len(movie_sentiment_data.data)))<font></font>
print(<span class="hljs-string">'They contain the following classes: {}.'</span>.format(<font></font>
    movie_sentiment_data.target_names))<font></font>
<font></font>
movie_tfidf = extract_features(movie_sentiment_data.data)<font></font>
<font></font>
X_train, X_test, y_train, y_test = model_selection.train_test_split(<font></font>
    movie_tfidf, movie_sentiment_data.target, test_size=<span class="hljs-number">0.30</span>, random_state=<span class="hljs-number">42</span>)<font></font>
<font></font>
<span class="hljs-comment"># similar to nltk.NaiveBayesClassifier.train()</span><font></font>
model = linear_model.LogisticRegression()<font></font>
model.fit(X_train, y_train)<font></font>
print(<span class="hljs-string">'Model performance: {}'</span>.format(model.score(X_test, y_test)))<font></font>
<font></font>
y_pred = model.predict(X_test)<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<font></font>
    print(<span class="hljs-string">'Review:\n{review}\n-\nCorrect label: {correct}; Predicted: {predict}'</span>.format(<font></font>
        review=X_test[i], correct=y_test[i], predict=y_pred[i]<font></font>
    ))<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような例のソートは、開発者にとって別の課題です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
わずか45行のコード、および4（4、Karl！）の論理ブロックを一度に：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルトレーニング用のデータのダウンロード（25〜26行目）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アップロードされたデータの準備-特徴抽出（31〜34行目）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルの作成とトレーニング（36〜39行目）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トレーニング済みモデルのテストと結果の出力（41〜45行目）</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの各ポイントは、個別の記事に値します。</font><font style="vertical-align: inherit;">そして、それは確かに別のモジュールに登録する必要があります。</font><font style="vertical-align: inherit;">少なくとも単体テストの必要性のために。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それとは別に、データの準備とモデルのトレーニングのコンポーネントを強調する価値があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モデルをより正確にするそれぞれの方法で、何百時間もの科学的および工学的作業が費やされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸いなことに、NLPをすぐに開始するために、既製のソリューション、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NLTK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TextBlobライブラリがあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">2つ目は、雑用を行うNLTKのラッパーです。トレーニングセットからの特徴抽出を行い、最初の分類リクエストでモデルをトレーニングします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、モデルをトレーニングする前に、データを準備する必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データの準備</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データをダウンロードする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトタイプについて話す場合、CSV / TSVファイルからのデータのロードは初歩的なものです。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリから</font><b><font style="vertical-align: inherit;">read_csv</font></b><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">呼び出すだけです</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">import pandas as pd<font></font>
data = pd.read_csv(data_path, delimiter)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、モデルで使用できるデータにはなりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、csv形式を少し無視すると、各ソースが独自の特性を持つデータを提供することが容易に予想できるため、何らかのソース依存のデータ準備が必要になります。</font><font style="vertical-align: inherit;">CSVファイルの最も単純なケースであっても、それを解析するには、区切り文字を知る必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、どのエントリがポジティブでどれがネガティブであるかを決定する必要があります。もちろん、この情報は、使用したいデータセットへの注釈に示されています。しかし、実際には、1つのケースではpos / negの符号は0または1であり、もう1つのケースでは論理True / Falseであり、3番目のケースでは単なるpos / neg文字列であり、場合によっては0〜5の整数のタプルです。後者はマルチクラス分類の場合に関連しますが、そのようなデータセットはバイナリ分類に使用できないと誰が言ったのですか？正と負の値の境界を適切に特定する必要があるだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
異なるデータセットでモデルを試したいのですが、トレーニング後に、モデルが単一の形式で結果を返すことが必要です。そのためには、その異種データを単一の形式にする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、データのロード段階で必要な関数は3つあります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データソースへの接続はCSV用で、この場合はread_csv関数内に実装されています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォーマット機能のサポート。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予備的なデータの準備。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、コードでの表示方法です。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <span class="hljs-comment"># linear algebra</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd <span class="hljs-comment"># data processing, CSV file I/O (e.g. pd.read_csv)</span>
<span class="hljs-keyword">import</span> logging<font></font>
<font></font>
log = logging.getLogger()<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CsvSentimentDataLoader</span>():</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, file_path, delim, text_attr, rate_attr, pos_rates</span>):</span><font></font>
        self.data_path = file_path<font></font>
        self.delimiter = delim<font></font>
        self.text_attr = text_attr<font></font>
        self.rate_attr = rate_attr<font></font>
        self.pos_rates = pos_rates<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_data</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment">#     csv  tsv </span><font></font>
        data = pd.read_csv(self.data_path, self.delimiter)<font></font>
        data.head()<font></font>
<font></font>
       <span class="hljs-comment">#   , </span>
       <span class="hljs-comment">#             </span><font></font>
       data = data[[self.text_attr, self.rate_attr]]<font></font>
<font></font>
       <span class="hljs-comment">#    </span>
       <span class="hljs-comment">#     ‘pos’  ‘neg’</span><font></font>
        data[self.rate_attr] = np.where(<font></font>
            data[self.rate_attr].isin(self.pos_rates), <span class="hljs-string">'pos'</span>, <span class="hljs-string">'neg'</span>)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> data
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CsvSentimentDataLoader</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が作成されました</font><font style="vertical-align: inherit;">。これには、コンストラクターでcsvへのパス、区切り文字、テキストの名前と分類属性、およびテキストの正の値を通知する値のリストが渡されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロード自体は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">load_data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドで行われ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データをテストセットとトレーニングセットに分割します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、データをアップロードしましたが、それでもトレーニングとテストセットに分割する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは</font><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">sklearn</font></b><font style="vertical-align: inherit;">ライブラリの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">train_test_split</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を使用</font><font style="vertical-align: inherit;">して</font><font style="vertical-align: inherit;">行われ</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この関数は、多くのパラメーターを入力として取り、このデータセットがトレーニングとテストにどの程度正確に分割されるかを決定します。</font><font style="vertical-align: inherit;">これらのパラメーターは、結果のトレーニングとテストセットに大きな影響を与えます。これらのパラメーターを管理し、この関数の呼び出しを集約するクラス（SimpleDataSplitterと呼びましょう）を作成すると便利です。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split <span class="hljs-comment"># to split the training and testing data</span>
<span class="hljs-keyword">import</span> logging<font></font>
<font></font>
log = logging.getLogger()<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleDataSplitter</span>():</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, text_attr, rate_attr, test_part_size=<span class="hljs-number">.3</span></span>):</span><font></font>
        self.text_attr = text_attr<font></font>
        self.rate_attr = rate_attr<font></font>
        self.test_part_size = test_part_size<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">split_data</span>(<span class="hljs-params">self, data</span>):</span><font></font>
        x = data[self.text_attr]<font></font>
        y = data[self.rate_attr]<font></font>
<font></font>
        x_train, x_test, y_train, y_test = train_test_split(<font></font>
            x, y, test_size = self.test_part_size)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> x_train, x_test, y_train, y_test 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスには、最も単純な実装が含まれています。これは、分割されたときに1つのパラメーター（テストセットとして使用する必要があるレコードのパーセンテージ）のみを考慮します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データセット</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モデルをトレーニングするために、CSV形式で自由に利用できるデータセットを使用しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Alexa Reviewsデータセット、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Kaggle</font></a><font style="vertical-align: inherit;">で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用可能</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カリフォルニア大学</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">センチメントのラベル付きセンテンスデータセット</font></a></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、さらに便利にするために、データセットごとに、対応するCSVファイルからデータを読み込み、トレーニングセットとテストセットに分割するクラスを作成しました。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> collections
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> web.data.loaders <span class="hljs-keyword">import</span> CsvSentimentDataLoader
<span class="hljs-keyword">from</span> web.data.splitters <span class="hljs-keyword">import</span> SimpleDataSplitter, TdIdfDataSplitter<font></font>
<font></font>
log = logging.getLogger()<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmazonAlexaDataset</span>():</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>
        self.file_path = os.path.normpath(os.path.join(os.path.dirname(__file__), <span class="hljs-string">'amazon_alexa/train.tsv'</span>))<font></font>
        self.delim = <span class="hljs-string">'\t'</span>
        self.text_attr = <span class="hljs-string">'verified_reviews'</span>
        self.rate_attr = <span class="hljs-string">'feedback'</span>
        self.pos_rates = [<span class="hljs-number">1</span>]<font></font>
<font></font>
        self.data = <span class="hljs-literal">None</span>
        self.train = <span class="hljs-literal">None</span>
        self.test = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_data</span>(<span class="hljs-params">self</span>):</span><font></font>
        loader = CsvSentimentDataLoader(self.file_path, self.delim, self.text_attr, self.rate_attr, self.pos_rates)<font></font>
        splitter = SimpleDataSplitter(self.text_attr, self.rate_attr, test_part_size=<span class="hljs-number">.3</span>)<font></font>
<font></font>
        self.data = loader.load_data()<font></font>
        x_train, x_test, y_train, y_test = splitter.split_data(self.data)<font></font>
<font></font>
        self.train = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> zip(x_train, y_train)]<font></font>
        self.test = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> zip(x_test, y_test)] 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、データをロードするために、元の例では5行強のコードが判明しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、今では、データソースとトレーニングセット準備アルゴリズムをジャグリングすることにより、新しいデータセットを作成することが可能になりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、個々のコンポーネントは単体テストにはるかに便利です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルを訓練する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モデルはかなり長い間学習されてきました。</font><font style="vertical-align: inherit;">そして、これはアプリケーションの開始時に一度だけ実行する必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの目的のために、アプリケーションの初期化時にモデルをトレーニングするだけでなく、データをダウンロードして準備できる小さなラッパーが作成されました。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextBlobWrapper</span>():</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.log = logging.getLogger()<font></font>
        self.is_model_trained = <span class="hljs-literal">False</span>
        self.classifier = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_app</span>(<span class="hljs-params">self</span>):</span>
        self.log.info(<span class="hljs-string">'&gt;&gt;&gt;&gt;&gt; TextBlob initialization started'</span>)<font></font>
        self.ensure_model_is_trained()<font></font>
        self.log.info(<span class="hljs-string">'&gt;&gt;&gt;&gt;&gt; TextBlob initialization completed'</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ensure_model_is_trained</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_model_trained:<font></font>
<font></font>
            ds = SentimentLabelledDataset()<font></font>
            ds.load_data()<font></font>
<font></font>
            <span class="hljs-comment"># train the classifier and test the accuracy</span><font></font>
            self.classifier = NaiveBayesClassifier(ds.train)<font></font>
            acr = self.classifier.accuracy(ds.test)<font></font>
            self.log.info(str.format(<span class="hljs-string">'&gt;&gt;&gt;&gt;&gt; NaiveBayesClassifier trained with accuracy {}'</span>, acr))           <font></font>
<font></font>
            self.is_model_trained = <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">return</span> self.classifier
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初にトレーニングデータとテストデータを取得し、次に特徴抽出を行い、最後に分類子をトレーニングしてテストセットの精度をチェックします。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト中</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初期化時に、ログが取得されます。これにより、データがダウンロードされ、モデルが正常にトレーニングされました。そして、非常に優れた（初心者向け）精度-0.8878でトレーニングされています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nl/hw/pt/nlhwptjx8xnwfao2anynttvbr1u.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような数字を受け取って、私は非常に熱心でした。しかし、私の喜びは、残念ながら長くはありませんでした。このセットでトレーニングされたモデルは不可解な楽観主義者であり、原則として否定的なコメントを認識することができません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この理由は、トレーニングセットのデータにあります。セット内の肯定的なレビューの数は90％を超えています。したがって、モデルの精度が約88％の場合、否定的なレビューは予想される12％の誤った分類に該当します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、このようなトレーニングセットでは、否定的なコメントを認識するようにモデルをトレーニングすることは不可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを実際に確認するために、別のデータセットからの100の肯定フレーズと100の否定フレーズの分類を個別に実行する単体テストを行いました。テストには、</font><font style="vertical-align: inherit;">カリフォルニア大学の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">感情ラベル付きの文データセットを使用</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しました。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">    @loggingtestcase.capturelogs(None, level='INFO')</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_classifier_on_separate_set</span>(<span class="hljs-params">self, logs</span>):</span>
        tb = TextBlobWrapper() <span class="hljs-comment"># Going to be trained on Amazon Alexa dataset </span>
        ds = SentimentLabelledDataset() <span class="hljs-comment"># Test dataset</span><font></font>
        ds.load_data()<font></font>
<font></font>
        <span class="hljs-comment"># Check poisitives</span>
        true_pos = <span class="hljs-number">0</span><font></font>
        data = ds.data.to_numpy()<font></font>
<font></font>
        seach_mask = np.isin(data[:, <span class="hljs-number">1</span>], [<span class="hljs-string">'pos'</span>])<font></font>
        data = data[seach_mask][:<span class="hljs-number">100</span>]<font></font>
<font></font>
        <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> data[:]:
            <span class="hljs-comment"># Model train will be performed on first classification call</span>
            r = tb.do_sentiment_classification(e[<span class="hljs-number">0</span>])
            <span class="hljs-keyword">if</span> r == e[<span class="hljs-number">1</span>]:<font></font>
                true_pos += <span class="hljs-number">1</span><font></font>
<font></font>
        self.assertLessEqual(true_pos, <span class="hljs-number">100</span>)<font></font>
        print(str.format(<span class="hljs-string">'\n\nTrue Positive answers - {} of 100'</span>, true_pos))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正の値の分類をテストするためのアルゴリズムは次のとおりです。 </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストデータをダウンロードします。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'pos'のタグが付けられた100件の投稿を取得</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それぞれにモデルを実行し、正しい結果の数を数えます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終結果をコンソールに出力する </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、否定的なコメントについてもカウントされます。 </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/79/lj/px/79ljpxifxo5sl1kpdt_h0q4zd58.png" alt="image"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
予想通り、否定的なコメントはすべて肯定的なものとして認識されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、テストに使用されるデータセットでモデルをトレーニングする場合</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Sentiment Labeled</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">そこでは、否定的および肯定的なコメントの分布はちょうど50から50です。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードを変更してテストし、実行する</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/tj/cw/oo/tjcwoocc2qodmbd5zl7emwqt8ve.png" alt="image"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう何か。</font><font style="vertical-align: inherit;">サードパーティセットからの200エントリの実際の精度は76％ですが、否定的なコメントの分類の精度は79％です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、76％はプロトタイプ用ですが、生産には不十分です。</font><font style="vertical-align: inherit;">これは、アルゴリズムの精度を向上させるために追加の対策が必要になることを意味します。</font><font style="vertical-align: inherit;">しかし、これは別のレポートのトピックです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、1ダースのクラスと200行以上のコードを持つアプリケーションを取得しました。これは、元の例よりも30行多いです。そして、あなたは正直である必要があります-これらは、構造のヒントであり、将来のアプリケーションの境界の最初の明確化です。プロトタイプ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、このプロトタイプにより、コードへのアプローチ間の距離が機械学習の専門家の視点から、および従来のアプリケーションの開発者の視点からどれだけ離れているかを認識することが可能になりました。そして、これは、私の意見では、機械学習を試すことにした開発者にとって主な困難です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初心者を迷惑にする次のこと-データは選択したモデルと同じくらい重要です。これは明確に示されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、一部のデータでトレーニングされたモデルが他のモデルで不適切に表示される可能性や、ある時点でその精度が低下し始める可能性があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、モデルの状態を監視するためのメトリック、データを操作する際の柔軟性、学習をその場で調整する技術的能力が必要です。</font><font style="vertical-align: inherit;">等。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私については、アーキテクチャを設計し、開発プロセスを構築するときに、これらすべてを考慮に入れる必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、「ウサギの穴」は非常に深いだけでなく、非常に巧妙に敷設されていました。</font><font style="vertical-align: inherit;">しかし、私が開発者として将来的にこのトピックを研究することは、さらに興味深いことです。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457152/index.html">DEFCON 25カンファレンス。GarryKasparov。「最後の脳の戦い」パート1</a></li>
<li><a href="../ja457154/index.html">すべてのユーザー向けのレスポンシブなアプリ設計</a></li>
<li><a href="../ja457156/index.html">将来のコンピューティングシステムは何か</a></li>
<li><a href="../ja457160/index.html">C ++でデリゲートを実装する私のアプローチ：実行時に不明なパラメーターで関数を呼び出す</a></li>
<li><a href="../ja457164/index.html">ReactiveUIとAvaloniaの例を使用してディスクに状態を保存するクロスプラットフォームの.NET Coreアプリケーションでのナビゲーション</a></li>
<li><a href="../ja457172/index.html">ScreenLogger-笑顔、隠されたカメラがあなたを撃ちます</a></li>
<li><a href="../ja457178/index.html">プロセッサの設計と製造方法：CPU設計</a></li>
<li><a href="../ja457180/index.html">公式サイトNode.jsがロシア語になりました</a></li>
<li><a href="../ja457182/index.html">REXX言語、40周年</a></li>
<li><a href="../ja457184/index.html">ASP.NET Coreサイト用のrobots.txtを動的に作成する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>