<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£ üîô üë©üèº‚Äçüíª Diffusez vos vid√©os sur YouTube 24h / 24 üòä ü§≤üèº üë©üèª‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, comme passe-temps, je filme des vid√©os d'un psychologue familier sur vid√©o. Je monte et publie les images sur mon site Web. Il y a un mois,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Diffusez vos vid√©os sur YouTube 24h / 24</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493352/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©cemment, comme passe-temps, je filme des vid√©os d'un psychologue familier sur vid√©o. Je monte et publie les images sur mon site Web. Il y a un mois, j'ai eu l'id√©e d'organiser une diffusion 24 heures sur 24 de ces conf√©rences sur YouTube 24/7. Une sorte de ¬´canal¬ª th√©matique d√©di√© √† la croissance personnelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment faire une diffusion normale, je sais. Mais comment en faire une diffusion de fichiers vid√©o? Elle marchait 24h / 24 et 7j / 7, √©tait flexible, aussi autonome que possible et ne d√©pendait pas en m√™me temps de mon ordinateur personnel. C'√©tait ce que je devais d√©couvrir. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/vn/5u/tivn5utlpr-vmldtf9dh5hh7fku.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a fallu plusieurs jours pour trouver une solution. J'ai √©tudi√© de nombreux forums et divers manuels sans lesquels ma diffusion n'aurait tout simplement pas abouti. Et maintenant, quand la farce est un succ√®s, je ressens le besoin de partager ma d√©cision. Cet article est donc apparu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En bref, la solution finale √©tait la suivante: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS + ffmeg + script bash</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sous la coupe, je d√©cris les √©tapes franchies et parle des ¬´pi√®ges¬ª d√©couverts lors de la diffusion.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtape 1 - d'o√π ira la diffusion?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au tout d√©but, il fallait d√©terminer o√π se d√©roulera la diffusion, o√π se trouvera sa source. La toute premi√®re chose qui m'est venue √† l'esprit est venue </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'un ordinateur personnel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Collectez des vid√©os dans une liste de lecture et lisez-les dans n'importe quel lecteur vid√©o. Capturez ensuite l'image √† l'√©cran et diffusez-la sur YouTube. Mais j'ai presque imm√©diatement rejet√© cette option. pour le mettre en ≈ìuvre, vous devez garder votre ordinateur personnel allum√© en permanence, et c'est le bruit des refroidisseurs m√™me la nuit et la consommation d'√©nergie accrue (+ 100-150 kWh chaque mois). Et il s'av√®re que vous ne pourrez pas utiliser votre ordinateur personnel pendant la dur√©e de la diffusion. tout mouvement de la souris sera visible dans la diffusion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puis j'ai commenc√© √† regarder vers les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">services cloud</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Je cherchais un service pr√™t √† l'emploi o√π vous pourriez t√©l√©charger vos vid√©os ou, par exemple, ins√©rer des liens vers des vid√©os de YouTube et tout serait regroup√© en une seule diffusion non-stop. Mais je n'ai rien trouv√© de convenable. Peut-√™tre que je regardais mal. La seule chose qui convient √† la fonctionnalit√© est restream.io, un service qui permet de diffuser simultan√©ment sur plusieurs plates-formes. Ils semblent pouvoir t√©l√©charger leurs vid√©os. Mais ce service a √©t√© cr√©√© √† des fins compl√®tement diff√©rentes et ils s'attendent √† ce que la diffusion ne dure que quelques heures. Je pense que si, gr√¢ce √† ce service, il aurait √©t√© possible d'organiser une diffusion 24 heures sur 24, cela aurait atteint des dizaines, voire des centaines de dollars par mois. Mais je voulais quand m√™me organiser la diffusion gratuitement ou avec un investissement financier minimal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est devenu clair que vous devez diffuser</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un appareil s√©par√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou m√™me un ordinateur s√©par√©. Penser √† quelque chose comme le Raspberri Pi. Et quoi? Il n'a pas de glaci√®re. J'ai enregistr√© la vid√©o sur une cl√© USB, coll√© un c√¢ble Ethernet et laiss√© reposer quelque part dans un endroit isol√©, elle diffuse. Option. Mais je n'avais ni la planche elle-m√™me ni l'exp√©rience avec elle, j'ai donc √©galement refus√© cette option. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fin de compte, je suis tomb√© sur une discussion o√π ils ont discut√© de la cr√©ation de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">votre propre serveur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©missions. Ce n'√©tait pas exactement ce que je cherchais, mais j'ai saisi l'id√©e principale - vous pouvez utiliser le serveur! Dans cette discussion, ils ont sugg√©r√© d'utiliser un tas de VPS + nginx + OBS. Il est devenu clair que ce groupe pouvait me convenir. La seule chose qui m'a d√©rout√©, c'est que je n'ai jamais administr√© le serveur et il m'a sembl√© que mon serveur d√©di√© √©tait confus et cher. J'ai d√©cid√© de savoir combien cela co√ªterait de louer un serveur dans la configuration minimale et j'ai √©t√© agr√©ablement surpris.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mu/v8/ms/muv8msmvpgnhzj9z04nuhv_y0-s.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les prix sont en roubles bi√©lorusses et ce ne sont que des miettes. Pour comprendre, 8 roubles bi√©lorusses se situent autour de 3,5 dollars ou 240 roubles russes. Pendant un mois avec un ordinateur √† part enti√®re allum√© 24h / 24 et 7j / 7 et disposant d'un acc√®s Internet rapide. Pour une raison quelconque, cette d√©couverte a √©t√© tr√®s joyeuse pour moi, et pendant plusieurs jours j'ai march√© terriblement heureux comme un enfant qui a d√©couvert des fus√©es spatiales :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au fait, j'ai profit√© de l'offre du tout premier site que Google m'a propos√© sur demande ¬´Location de VPS¬ª. Il y a peut-√™tre encore plus de solutions budg√©taires, mais ce prix me convenait et je n'ai pas cherch√© plus loin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la cr√©ation d'un serveur, vous pouvez s√©lectionner le syst√®me d'exploitation sous lequel il fonctionnera. </font><font style="vertical-align: inherit;">Sur l'un des syst√®mes r√©pertori√©s, vous pouvez organiser la diffusion et faire un choix en fonction de vos pr√©f√©rences et de vos capacit√©s financi√®res (ils demandent des frais suppl√©mentaires pour un serveur avec Windows). </font><font style="vertical-align: inherit;">J'ai choisi CentOS. </font><font style="vertical-align: inherit;">Tout simplement parce que j'avais une petite exp√©rience avec elle.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/0a/wh/cv0awhhxim1w2fgglkrlupl5hgc.jpeg" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtape 2 - Configuration du serveur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re chose dont vous avez besoin apr√®s avoir cr√©√© le serveur est de vous y connecter via SSH. </font><font style="vertical-align: inherit;">Au d√©but, j'ai utilis√© PuTTy, mais j'ai ensuite commenc√© √† utiliser l'application Secure Shell, qui fonctionne sur Google Chrome. </font><font style="vertical-align: inherit;">Cela s'est donc av√©r√© plus pratique pour moi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, j'ai chang√© le nom d'h√¥te, mis en place la synchronisation de l'heure sur le serveur, mis √† jour le syst√®me, jou√© avec iptables ... et fait un tas de choses, mais pas parce que c'√©tait n√©cessaire. </font><font style="vertical-align: inherit;">C'√©tait juste int√©ressant pour moi de configurer le serveur et cela a fonctionn√© pour moi. </font><font style="vertical-align: inherit;">J'adore quand √ßa s'av√®re :) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais ces √©tapes qui doivent √™tre faites:</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez le r√©f√©rentiel EPEL.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relevez le serveur FTP (j'ai choisi vsftp).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installez ffmpeg.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne donnerai pas de d√©tails sur l'√©quipe, cette instruction est plut√¥t conceptuelle afin de v√©hiculer un plan d'action g√©n√©ral. Si vous rencontrez des difficult√©s avec l'une des √©tapes, elles sont rapidement r√©solues par une requ√™te dans un moteur de recherche comme ¬´CentOS connect EPEL¬ª ou ¬´Installation du serveur FTP CentOS¬ª. Et aux premiers liens, vous pouvez trouver des instructions d√©taill√©es √©tape par √©tape. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, comme je l'ai √©crit plus t√¥t, j'avais besoin d'un tas de VPS + nginx + OBS. VPS - pr√™t. Mais ici, sur les points restants, des questions ont commenc√© √† se poser. OBS est un programme de diffusion, Open Broadcaster Software. Et cela ne fonctionne qu'avec des threads, c'est-√†-dire par exemple, il prend une image d'une webcam et la diffuse. Ou l'enregistrement d'√©cran. Ou une diffusion d√©j√† en cours redirige vers un autre site. Et je n'ai pas de flux, je n'ai qu'un ensemble de fichiers vid√©o dont j'ai besoin pour faire un flux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a commenc√© √† creuser dans cette direction et est tomb√© sur ffmpeg. </font><font style="vertical-align: inherit;">FFmpeg est un ensemble de biblioth√®ques open source gratuites qui vous permettent d'enregistrer, de convertir et de transf√©rer des enregistrements audio et vid√©o num√©riques dans diff√©rents formats. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et j'ai √©t√© tr√®s surpris de voir ce que ffmpeg peut faire. </font><font style="vertical-align: inherit;">Si vous le souhaitez, il extraira le son de la vid√©o. </font><font style="vertical-align: inherit;">Si vous le souhaitez, il d√©coupera un fragment de la vid√©o sans transcodage. </font><font style="vertical-align: inherit;">Si vous le souhaitez, il sera converti d'un format √† un autre. </font><font style="vertical-align: inherit;">Et bien plus encore. </font><font style="vertical-align: inherit;">Jusqu'√† ce que vous puissiez lui sp√©cifier un fichier, il le convertira en flux et le transf√©rera lui-m√™me sur YouTube. </font><font style="vertical-align: inherit;">Tout, la cha√Æne est assembl√©e. </font><font style="vertical-align: inherit;">Il ne reste plus qu'√† affiner les nuances.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtape 3 - Configuration de la diffusion</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous cr√©ons une diffusion sur YouTube. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä ce stade, nous n'avons besoin que d'un lien et d'une cl√© de traduction. </font><font style="vertical-align: inherit;">Dans la capture d'√©cran ci-dessous, ils sont surlign√©s en rouge. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gr/a3/oo/gra3oogooafzdfjzhlqdqjjxr8o.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©l√©chargez les fichiers vid√©o sur le serveur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que nous pr√©voyons de diffuser. </font><font style="vertical-align: inherit;">En fait, FTP n'est n√©cessaire que pour cette √©tape. </font><font style="vertical-align: inherit;">Si vous avez un autre moyen pratique de t√©l√©charger des fichiers sur le serveur, le serveur FTP peut √™tre ignor√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous diffusons sur YouTube. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour d√©marrer la diffusion, vous devez ex√©cuter ffmpeg avec plusieurs attributs. </font><font style="vertical-align: inherit;">Voici la commande la plus courte que j'ai re√ßue:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©cryptage des attributs</font></font></b><div class="spoiler_text"><code>-re</code> ‚Äì ,      .<br>
<br>
<code>-i</code> ‚Äì ,    . ,       ,    -.       ,  <code>/usr/media/lecture1.mp4</code>.<br>
<br>
<code>-f</code> ‚Äì    .    ,  ffmpeg ¬´ ¬ª     mp4  flv.<br>
<br>
    ,     YouTube     .. ,     ,   ,       .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez tout fait correctement, apr√®s avoir ex√©cut√© cette commande, YouTube verra le flux transmis. </font><font style="vertical-align: inherit;">Pour d√©marrer la diffusion, il vous suffit de cliquer sur le bouton "D√©marrer la diffusion" dans YouTube m√™me.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtape 4 - Ajoutez de l'autonomie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes nos f√©licitations! Vous savez maintenant comment d√©marrer la diffusion √† partir d'un fichier vid√©o. Mais cela ne suffit pas pour une diffusion 24 heures sur 24. Il est important qu'apr√®s la fin de la lecture de la premi√®re vid√©o, la suivante d√©marre imm√©diatement et lorsque toutes les vid√©os sont affich√©es, la lecture recommence. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je suis venu avec l'option suivante: cr√©er un fichier .sh dans lequel j'ai enregistr√© une commande pour chaque fichier vid√©o et √† la fin indiqu√© une commande pour red√©marrer le m√™me script. Il s'est av√©r√© une sorte de r√©cursivit√©:</font></font><br>
<br>
<pre><code class="bash hljs"> 1... (   lecture1.mp4)<font></font>
 2... (   lecture2.mp4)<font></font>
 3... (   lecture3.mp4)<font></font>
bash start.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et oui, √ßa a march√©. Moi, satisfait de moi, j'ai commenc√© une √©mission test et je me suis endormi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une mauvaise surprise m'attendait le matin. Il s'est av√©r√© que l'√©mission n'a dur√© que quelques minutes et s'est termin√©e presque imm√©diatement lorsque j'ai √©teint mon ordinateur. L'enqu√™te a montr√© que les commandes ainsi lanc√©es sont ex√©cut√©es alors que l'utilisateur est autoris√© sur le serveur. D√®s que je me suis d√©connect√©, l'ex√©cution des commandes que j'ai lanc√©es a √©t√© interrompue. Pour √©viter que cela ne se produise, il suffit d' </font></font><code>bash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajouter l'√©quipe </font><font style="vertical-align: inherit;">avant l' </font><font style="vertical-align: inherit;">√©quipe </font></font><code>nohup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cela permettra au processus en cours de s'ex√©cuter ind√©pendamment de votre pr√©sence. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La version minimale finale du script ressemble √† ceci:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture2.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture3.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
nohup bash start.sh $</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O√π start.sh est le fichier dans lequel ce script est √©crit. </font><font style="vertical-align: inherit;">Et ce fichier doit √™tre situ√© dans le m√™me r√©pertoire que les fichiers vid√©o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ajout d'un signe dollar √† la fin vous permet de d√©marrer le processus en arri√®re-plan afin de pouvoir continuer √† utiliser la console sans interrompre la diffusion. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des bonus, les brioches suivantes se sont r√©v√©l√©es:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez basculer manuellement la lecture des fichiers. </font><font style="vertical-align: inherit;">Pour ce faire, vous devez "tuer" le processus ffmpeg en cours d'ex√©cution. </font><font style="vertical-align: inherit;">Apr√®s cela, la lecture du fichier suivant de la liste d√©marre automatiquement.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De nouvelles vid√©os peuvent √™tre ajout√©es √† la diffusion sans arr√™ter la diffusion. </font><font style="vertical-align: inherit;">T√©l√©chargez simplement la vid√©o sur le serveur, ajoutez la commande pour ex√©cuter ce fichier dans le script, enregistrez-la. </font><font style="vertical-align: inherit;">Et c'est tout. </font><font style="vertical-align: inherit;">Lors de la prochaine lecture, le nouveau fichier sera d√©j√† diffus√© avec les anciens fichiers.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtape 5 - Configurer ffmpeg</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur ce point, en principe, on pourrait s'arr√™ter. Mais je voulais rendre l'√©mission un peu plus conviviale pour le public. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons qu'une personne se rende √† l'√©mission, commence √† la regarder, qu'elle l'aime et veuille regarder cette conf√©rence depuis le d√©but, et que l'√©mission n'inclut pas le rembobinage. Pour visualiser une conf√©rence depuis le d√©but, une personne devra se rendre sur mon site Web et obtenir un enregistrement de la conf√©rence d'int√©r√™t. Et comment comprendre quelle conf√©rence l'int√©resse? Le site compte 16 conf√©rences et chaque semaine il n'y en a plus. Je pense que m√™me moi, qui ai tourn√© et √©dit√© toutes ces conf√©rences, ne pourra pas d√©terminer de quelle conf√©rence il s'agit √† partir d'un fragment al√©atoire. Par cons√©quent, il est n√©cessaire que chaque conf√©rence soit d√©sign√©e d'une mani√®re ou d'une autre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option d'ajouter des sous-titres aux fichiers vid√©o source dans le programme de montage ne me convenait pas. </font><font style="vertical-align: inherit;">Il fallait s'assurer que les fichiers originaux √©taient utilis√©s. </font><font style="vertical-align: inherit;">Pour soutenir la diffusion exig√©e de moi le moins de mouvements corporels possible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© que ffmpeg peut √©galement m'aider. </font><font style="vertical-align: inherit;">Il a un attribut sp√©cial </font></font><code>-vf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui vous permet de mettre du texte au-dessus de la vid√©o. </font><font style="vertical-align: inherit;">Pour ajouter du texte √† la vid√©o, vous devez ajouter le fragment suivant √† la commande:</font></font><br>
<br>
<pre><code class="bash hljs">-vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 13\:  .   ?':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span></code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©codage des param√®tres</font></font></b><div class="spoiler_text"><code>fontfile=</code> ‚Äì    .       .          .        .<br>
<br>
<code>text=</code> ‚Äì ,  ,     .<br>
<br>
<code>fontsize=</code> ‚Äì    .<br>
<br>
<code>fontcolor=</code> ‚Äì  .<br>
<br>
<code>borderw=</code> ‚Äì       (         1 ).<br>
<br>
<code>bordercolor=</code> ‚Äì  .<br>
<br>
<code>x=</code>  <code>y=</code> ‚Äì  .  <code>0;0</code>     .      ,           1280720 .<br>
</div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela ressemble √† ceci:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/jf/1n/sh/jf1nshia1hbk30-pjd5y6mztga0.jpeg" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtape 6 - d√©terminer la qualit√© de diffusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout, l'√©mission est pr√™te. FFmpeg diffuse, joue des fichiers, ma pr√©sence n'est pas n√©cessaire pour la diffusion. M√™me chaque conf√©rence est sign√©e. Regardez comme √ßa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais une autre nuance est apparue - j'ai choisi la configuration minimale du serveur et cela n'a pas entra√Æn√© la diffusion. Configuration du serveur: 1 c≈ìur (comme 2,2 GHz), 1 gigaoctet de RAM, 25 Go SSD. Il y avait suffisamment de RAM, mais le processeur est presque compl√®tement entr√© dans le chargement √† 100% (et parfois m√™me √† 102-103% :) Cela a conduit au gel de la diffusion une fois toutes les quelques secondes. Laid.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez simplement prendre une configuration plus co√ªteuse avec deux c≈ìurs, l'avantage est qu'avec les technologies cloud, la configuration du serveur est modifi√©e en appuyant sur quelques boutons. </font><font style="vertical-align: inherit;">Mais je voulais m'adapter √† la puissance de la configuration minimale. </font><font style="vertical-align: inherit;">J'ai commenc√© √† √©tudier la documentation de ffmpeg et oui, il y a aussi des param√®tres qui vous permettent d'ajuster la charge sur le syst√®me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une qualit√© d'image √©lev√©e peut √™tre obtenue de deux mani√®res: soit une charge de processeur √©lev√©e, soit un trafic sortant important. </font><font style="vertical-align: inherit;">Il s'av√®re que plus le processeur peut supporter la charge, moins le canal aura besoin de bande passante. </font><font style="vertical-align: inherit;">Ou vous ne pouvez pas charger lourdement le processeur, mais vous aurez alors besoin d'un canal large avec une grande marge de trafic. </font><font style="vertical-align: inherit;">S'il y a des restrictions √† la fois sur le processeur et sur la taille du canal / trafic sortant, alors vous devrez r√©duire la qualit√© de l'image pour que la diffusion se passe sans probl√®me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mon serveur dispose d'un canal 10 Mbps. Cette largeur est droite avec une marge. Mais il y a une limite de trafic - 1 To par mois. Par cons√©quent, afin de respecter les restrictions de trafic, mon flux sortant ne doit pas d√©passer ~ 300 Ko par seconde, c'est-√†-dire le d√©bit binaire du flux sortant ne doit pas d√©passer 2,5 Mbps. Au fait, YouTube recommande simplement de diffuser avec un tel d√©bit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ffmpeg utilise diff√©rentes approches pour r√©guler la charge sur le syst√®me. Bien √©crit √† ce sujet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . J'ai fini par utiliser deux attributs: </font></font><code>-crf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>-preset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facteur de taux constant (CRF)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- il s'agit d'un coefficient gr√¢ce auquel vous pouvez ajuster la qualit√© de l'image. </font><font style="vertical-align: inherit;">Le CRF peut varier de 0 √† 51, o√π 0 est la qualit√© du fichier source, 51 est la pire qualit√© possible. </font><font style="vertical-align: inherit;">Il est recommand√© d'utiliser des valeurs de 17 √† 28, la valeur par d√©faut est de 23. Avec un ratio de 17, la vid√©o sera visuellement identique √† l'original, mais techniquement ce ne sera pas le cas. </font><font style="vertical-align: inherit;">La documentation indique √©galement que la taille de la vid√©o finale, en fonction du CRF sp√©cifi√©, change de fa√ßon exponentielle, c'est-√†-dire </font><font style="vertical-align: inherit;">l'augmentation du coefficient de 6 points doublera le d√©bit binaire de la vid√©o sortante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous utilisez CRF, vous pouvez choisir le "poids" de l'image sortante, puis en utilisant des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©r√©glages (-preset),</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous pouvez d√©terminer combien le processeur sera charg√©. </font><font style="vertical-align: inherit;">Les param√®tres de cet attribut sont les suivants:</font></font><br>
<br>
<ul>
<li><code>ultrafast</code></li>
<li><code>superfast</code></li>
<li><code>veryfast</code></li>
<li><code>faster</code></li>
<li><code>fast</code></li>
<li><code>medium</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - valeur par d√©faut</font></font></li>
<li><code>slow</code></li>
<li><code>slower</code></li>
<li><code>veryslow</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus le param√®tre est "rapide", plus la charge du processeur est √©lev√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai d'abord pris le pr√©r√©glage, qui √©tait fondamentalement ¬´difficile¬ª pour mon processeur, puis j'ai r√©gl√© plus finement la charge √† l'aide de CRF. </font><font style="vertical-align: inherit;">Dans mon cas, le pr√©r√©glage est apparu </font></font><code>fast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et pour crf, j'ai opt√© pour une valeur de 24.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">La commande finale pour d√©marrer la diffusion m'a donn√© ceci:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 1\:   ':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span> -c:v libx264 -preset fast -crf 24 -g 3 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, il n'y a que deux moments non d√©crits: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><code>-c:v libx264</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- une indication d'un codec sp√©cifique pour travailler avec le fichier source. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) </font></font><code>-g 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- une indication explicite du nombre d'images cl√©s. Dans ce cas, il est indiqu√© que chaque troisi√®me trame doit √™tre cl√©. La valeur standard est de 5 ou 8, mais YouTube jure, demande au moins 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle qualit√© de la diffusion s'est r√©v√©l√©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La charge du serveur √©tait la suivante:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/b5/3s/za/b53szauaywx3bdwoic-yebil1es.jpeg" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/cq/jc/t4/cqjct4xhbz3zabriimgydbxvjaq.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sur la base des donn√©es de surveillance, il est clair que la charge du processeur varie de 70% √† 95% et la diffusion n'a jamais atteint 100% en une semaine. Donc, avec ces param√®tres, le processeur suffit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors du chargement d'un disque, je peux dire qu'il n'est presque pas charg√© et qu'un disque dur ordinaire devrait suffire pour la diffusion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais la quantit√© de trafic sortant me d√©range. Il s'av√®re que mon flux sortant varie de 450 √† 650 Ko par seconde. Pendant un mois, ce sera environ 1,8 t√©raoctets. Vous devrez peut-√™tre acheter du trafic ou toujours passer √† une configuration double c≈ìur car Je ne voudrais pas r√©duire la qualit√© de l'image. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, je dirai que la configuration d'une telle diffusion √† partir de z√©ro prend environ 1 √† 2 heures. De plus, la plupart du temps, il faudra t√©l√©charger la vid√©o sur le serveur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant qu'outil de marketing, le lancement d'une telle √©mission n'a pas port√© ses fruits. Peut-√™tre que si vous finissez les vues de sorte que les algorithmes de YouTube captent cette diffusion et la montrent activement dans les recommandations, alors quelque chose fonctionnera. Dans mon cas, pendant 16 jours de diffusion continue, il a √©t√© regard√© 58 fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√áa va. Diffusez harmonieusement sur la page principale de mon site. Cela s'est av√©r√© une sorte d'opportunit√© pour se faire rapidement une id√©e du conf√©rencier et des conf√©rences elles-m√™mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et un instant. Il est important que la diffusion ne viole pas le droit d'auteur de quiconque, sinon elle sera bloqu√©e. Je suis calme pour ma diffusion. J'ai sp√©cialement s√©lectionn√© des insertions musicales √† usage gratuit, et l'auteur du contenu est assis sur un ordinateur voisin et n'est pas du tout contre moi d'utiliser son contenu :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais si vous avez une radio qui joue en arri√®re-plan quelque part en arri√®re-plan, ou si vous avez utilis√© votre morceau pr√©f√©r√© pendant le montage, ou si vous avez pris une vid√©o d'un clip, d'une s√©rie ou d'un film de musique populaire, votre diffusion est menac√©e. </font><font style="vertical-align: inherit;">Il est √©galement important que la diffusion porte au moins une charge s√©mantique minimale, sinon elle peut √™tre bloqu√©e en tant que spam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout pour moi. </font><font style="vertical-align: inherit;">J'esp√®re que ce manuel servira bien quelqu'un. </font><font style="vertical-align: inherit;">Eh bien, si vous avez quelque chose √† ajouter - √©crivez, je me ferai un plaisir de lire les ajouts et les clarifications √† l'article.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493336/index.html">Comment l'informatique a traduit l'apprentissage en ligne</a></li>
<li><a href="../fr493340/index.html">Rendre les fonctions SIL portables entre les versions dans Jira</a></li>
<li><a href="../fr493342/index.html">Comment NSPK a pr√©par√© l'infrastructure pour la transition vers Udalenka</a></li>
<li><a href="../fr493346/index.html">Nous avons r√©ussi √† transf√©rer des bureaux √† udalenka, et vous?</a></li>
<li><a href="../fr493348/index.html">Rendre "udalenka" g√©nial √† nouveau: comment transf√©rer toute l'entreprise au travail √† distance en 4 √©tapes</a></li>
<li><a href="../fr493356/index.html">Video @Databases Meetup: s√©curit√© du SGBD, Tarantool dans l'IoT, Greenplum pour l'analyse de Big Data</a></li>
<li><a href="../fr493360/index.html">Deux doigts d'Algol</a></li>
<li><a href="../fr493362/index.html">Support technique "sur les valises". Comment nous travaillons √† distance sans nerfs inutiles et obtenons √† distance les services dont nous avons besoin</a></li>
<li><a href="../fr493366/index.html">Qu'est-ce que Windows PowerShell et que mange-t-il? Partie 3: passer des param√®tres aux scripts et aux fonctions, cr√©er des applets de commande</a></li>
<li><a href="../fr493374/index.html">Coronavirus - conseils pratiques et un peu de th√©orie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>