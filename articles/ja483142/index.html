<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗻 🈳 🛒 Quake 3をRustに移植する 👨🏿‍💼 🔸 👩🏿‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私たちのチームImmunantはRustを愛し、Rustへの移行のルーチン全体を処理する移行フレームワークであるC2Rustに積極的に取り組んでいます。私たちは、変換されたRustコードにセキュリティの改善を自動的に導入し、フレームワークが失敗したときにプログラマが自分でそれを実行できるように努めて...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Quake 3をRustに移植する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483142/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2c/61d/a4f/d2c61da4f8dfcdfb39d9fbd7787070a4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのチームImmunantはRustを愛し、Rustへの移行のルーチン全体を処理する移行フレームワークであるC2Rustに積極的に取り組んでいます。</font><font style="vertical-align: inherit;">私たちは、変換されたRustコードにセキュリティの改善を自動的に導入し、フレームワークが失敗したときにプログラマが自分でそれを実行できるように努めています。</font><font style="vertical-align: inherit;">ただし、まず第一に、ユーザーがRustを使い始めることができる信頼できるトランスレーターを作成する必要があります。</font><font style="vertical-align: inherit;">小さなCLIプログラムでのテストは徐々に時代遅れになっているため、Quake 3をRustに移行することにしました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">準備：Quake 3ソース</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
元のQuake 3のソースコードとさまざまなフォークを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">した</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">結果</font></a><font style="vertical-align: inherit;">、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ioquake3</font></a><font style="vertical-align: inherit;">に落ち着きました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これはコミュニティによって作成されたQuake 3のフォークであり、最新のプラットフォームで引き続きサポートおよび構築されています。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開始点として、プロジェクトを元の形式でアセンブルできることを確認することにしました。</font></font><br>
<br>
<pre><code class="bash hljs">$ make release</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ioquake3をビルドすると、いくつかのライブラリと実行可能ファイルが作成されます。</font></font><br>
<br>
<pre><code class="bash hljs">$ tree --prune -I missionpack -P <span class="hljs-string">"*.so|*x86_64"</span><font></font>
.<font></font>
└── build<font></font>
    └── debug-linux-x86_64<font></font>
        ├── baseq3<font></font>
        │   ├── cgamex86_64.so          <span class="hljs-comment"># client</span>
        │   ├── qagamex86_64.so         <span class="hljs-comment"># game server</span>
        │   └── uix86_64.so             <span class="hljs-comment"># ui</span>
        ├── ioq3ded.x86_64              <span class="hljs-comment"># dedicated server binary</span>
        ├── ioquake3.x86_64             <span class="hljs-comment"># main binary</span>
        ├── renderer_opengl1_x86_64.so  <span class="hljs-comment"># opengl1 renderer</span>
        └── renderer_opengl2_x86_64.so  <span class="hljs-comment"># opengl2 renderer</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのライブラリの中で、UI、クライアント、サーバーライブラリは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quake VM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アセンブリ</font><font style="vertical-align: inherit;">として、またはネイティブX86共有ライブラリとして</font><font style="vertical-align: inherit;">構築でき</font><font style="vertical-align: inherit;">ます。このプロジェクトでは、ネイティブバージョンを使用することにしました。 VMをRustに変換してQVMバージョンを使用する方がはるかに簡単ですが、C2Rustを徹底的にテストしたいと考えました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
移行プロジェクトでは、UI、ゲーム、クライアント、OpenGL1レンダラー、およびメインの実行可能ファイルに焦点を当てました。 OpenGL2-rendererをブロードキャストすることは可能ですが、大量のシェーダーファイルを使用するため、これをスキップすることにしました。</font></font><code>.glsl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ビルドシステムがCソースコードに文字列リテラルとして埋め込む。コンパイル後に、GLSLコードをRust文字列に埋め込むためのビルドスクリプトのサポートを追加しますが、これらの自動生成された一時ファイルを自動的に変換する適切な方法はありません。</font><font style="vertical-align: inherit;">そのため、代わりに、OpenGL1レンダラーライブラリを単に変換し、ゲームにデフォルトのレンダラーの代わりにそれを使用するように強制しました。</font><font style="vertical-align: inherit;">また、専用サーバーとパッケージ化されたミッションファイルは転送するのが難しくなく、デモに必要ないため、スキップすることにしました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">転置震動3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quake 3で使用されているディレクトリ構造を保持し、ソースコードを変更しないために、ネイティブアセンブリとまったく同じバイナリファイル、つまり4つの共有ライブラリと1つの実行可能ファイルを取得する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C2RustはCargoビルドファイルを作成するため、各バイナリには、対応するファイルを含む独自のRustクレートが必要です</font></font><code>Cargo.toml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C2Rustがバイナリ出力ごとに1つのクレートを作成するには、対応するオブジェクトまたはソースファイルを含むバイナリファイルのリスト、および各バイナリの作成に使用されるリンカー呼び出し（ライブラリの依存関係など、他の詳細を決定するために使用される）も必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、C2Rustがネイティブビルドプロセスをインターセプトする方法に起因する1つの制限にすぐに遭遇しました。C2Rustは</font><font style="vertical-align: inherit;">、ビルド中に実行されるコンパイルコマンドのリストを含む</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイルデータベース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを入力で受け取ります</font><font style="vertical-align: inherit;">。ただし、このデータベースには、</font><font style="vertical-align: inherit;">リンカ呼び出しの</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ない</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイル命令</font><strong><font style="vertical-align: inherit;">のみ</font></strong><font style="vertical-align: inherit;">が含まれてい</font><font style="vertical-align: inherit;">ます。このデータベースを作成するツールのほとんどは、例えば、この意図的な限界を持っている</font></font><code>cmake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>CMAKE_EXPORT_COMPILE_COMMANDS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>bear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>compiledb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。私たちの経験では、構成コマンドを含む唯一の計測器が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>build-logger</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成されます</font></font><code>CodeChecker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、独自のラッパーを記述した後でのみそれについて学習したため、使用しませんでした（以下で説明します）。</font><font style="vertical-align: inherit;">つまり</font></font><code>compile_commands.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、一般的なツールのいずれかで作成され</font><font style="vertical-align: inherit;">たファイルを使用して、Cプログラムをいくつかのバイナリファイルで転置することはできませんでした</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイラ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンカー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">へのすべての呼び出しをデータベースにダンプし、それを拡張されたものに変換する</font><font style="vertical-align: inherit;">独自の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">コンパイラ</font></a><font style="vertical-align: inherit;">と</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">リンカー</font></a><font style="vertical-align: inherit;">ラッパースクリプト</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成</font><font style="vertical-align: inherit;">しました</font></font><code>compile_commands.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次のようなコマンドを使用した通常のアセンブリの代わりに：</font></font><br>
<br>
<pre><code class="bash hljs">$ make release</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アセンブリをインターセプトするラッパーを追加しました：</font></font><br>
<br>
<pre><code class="bash hljs">$ make release CC=/path/to/C2Rust/scripts/cc-wrappers/cc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラッパーは、呼び出しごとに1つ、複数のJSONファイルのディレクトリを作成します。</font><font style="vertical-align: inherit;">2番目の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、それらすべてを1つの新しいファイル</font></font><code>compile_commands.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">収集します</font><font style="vertical-align: inherit;">。この</font><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">には、コマンド、コンパイル、およびレイアウトが含まれています。</font><font style="vertical-align: inherit;">次に、C2Rustを拡張して、データベースからビルドコマンドを読み取り、リンクされたバイナリごとに個別のクレートを作成します。</font><font style="vertical-align: inherit;">さらに、C2Rustは各バイナリファイルのライブラリの依存関係も読み取り、</font></font><code>build.rs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">対応するクレート</font><font style="vertical-align: inherit;">ファイルに自動的に追加します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに便利なように、すべてのバイナリを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワークスペース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内に配置して一度に収集でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">C2Rustは</font></font><code>Cargo.toml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最上位の</font><font style="vertical-align: inherit;">ワークスペースファイルを作成する</font><font style="vertical-align: inherit;">ので</font></font><code>cargo build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ディレクトリ内の</font><font style="vertical-align: inherit;">単一のコマンド</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">プロジェクトをアセンブルでき</font><font style="vertical-align: inherit;">ます</font></font><code>quake3-rs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">$ tree -L 1<font></font>
.<font></font>
├── Cargo.lock<font></font>
├── Cargo.toml<font></font>
├── cgamex86_64<font></font>
├── ioquake3<font></font>
├── qagamex86_64<font></font>
├── renderer_opengl1_x86_64<font></font>
├── rust-toolchain<font></font>
└── uix86_64<font></font>
<font></font>
$ cargo build --release</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">粗さをなくす</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に翻訳されたコードをコンパイルしようとしたときに、Quake 3のソースにいくつかの問題が発生しました。C2Rustが（正しくも、何とかして）処理できない境界ケースがありました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列ポインター</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
元のソースコードのいくつかの場所には、最後の配列要素の後の次の要素を指す式が含まれています。</font><font style="vertical-align: inherit;">以下は、単純化されたCコードの例です。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> <span class="hljs-built_in">array</span>[<span class="hljs-number">1024</span>];
<span class="hljs-keyword">int</span> *p;<font></font>
<font></font>
<span class="hljs-comment">// ...</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> (p &gt;= &amp;<span class="hljs-built_in">array</span>[<span class="hljs-number">1024</span>]) {
   <span class="hljs-comment">// error...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C標準（たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C11、セクション6.5.6を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照）では、要素ポインタが配列の末尾を超えることができます。ただし、要素のアドレスのみを取得する場合でも、Rustはこれを禁止します。関数にそのようなパターンの例が見つかりました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>AAS_TraceClientBBox</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rustコンパイラーも、同様の、しかし実際にはバグのある例を示しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>G_TryPushingEntity</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、条件付き命令は</font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではなくの</font><font style="vertical-align: inherit;">よう</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">見え</font></font><code>&gt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。範囲外のポインターは、条件付き構成の後に逆参照されますが、これはメモリセキュリティのバグです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将来この問題を回避するために、C2Rustトランスパイラーを修正して、配列のインデックス付け操作を使用するのではなく、ポインター演算を使用して配列要素のアドレスを計算するようにしました。</font><font style="vertical-align: inherit;">この修正により、同様のパターン「配列の末尾の要素アドレス」を使用したコードが、修正せずに正しく変換および実行されるようになりました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可変長配列要素</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはすべてをテストするためにゲームを立ち上げ、すぐにRustからパニックになりました：</font></font><br>
<br>
<pre><code class="cpp hljs">thread <span class="hljs-string">'main'</span> panicked at <span class="hljs-string">'index out of bounds: the len is 4 but the index is 4'</span>, quake3-client/src/cm_polylib.rs:<span class="hljs-number">973</span>:<span class="hljs-number">17</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を見ると</font></font><code>cm_polylib.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、彼</font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が次の構造で</font><font style="vertical-align: inherit;">フィールドを逆参照していることがわかりました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>
{</span>
	<span class="hljs-keyword">int</span>		numpoints;
	<span class="hljs-keyword">vec3_t</span>	p[<span class="hljs-number">4</span>];		<span class="hljs-comment">// variable sized</span>
} <span class="hljs-keyword">winding_t</span>;</code></pre><br><font style="vertical-align: inherit;"></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構造体</font><font style="vertical-align: inherit;">
のフィールド</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、可変</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列メンバーの</font><font style="vertical-align: inherit;">バージョン</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">であり</font></a><font style="vertical-align: inherit;">、C99標準</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">はサポートされていません</font><font style="vertical-align: inherit;">が、受け入れられ</font></font><code>gcc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。 C2Rustは、構文C99（</font></font><code>vec3_t p[]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）で</font><font style="vertical-align: inherit;">可変長配列の要素を認識し</font><font style="vertical-align: inherit;">、単純な</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヒューリスティック</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実装して、</font><font style="vertical-align: inherit;">C99までのこのパターンのバージョンも識別します（構造の最後にサイズ0と1の配列。構造体の末尾にそのような例がいくつか見つかりました。ioquake3ソースコードでも見つかりました）。</font><font style="vertical-align: inherit;">上記の構造をC99構文に</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更すると</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、パニックが解消されました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>
{</span>
	<span class="hljs-keyword">int</span>		numpoints;
	<span class="hljs-keyword">vec3_t</span>	p[];		<span class="hljs-comment">// variable sized</span>
} <span class="hljs-keyword">winding_t</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常の配列（0と1とは異なる配列サイズ）でこのパターンを自動的に修正する試みは、通常の配列と任意の長さの可変長配列の要素を区別する必要があるため、非常に困難です。</font><font style="vertical-align: inherit;">したがって、代わりに、ioquake3で行ったように、元のCコードを手動で修正することをお勧めします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組み込みアセンブリコードの結合オペランド</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラッシュの別の原因は、システムヘッダーからのこのCベースのアセンブラコードでした</font></font><code>/usr/include/bits/select.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> __FD_ZERO(fdsp)                                            \
  do {                                                              \
    int __d0, __d1;                                                 \
    __asm__ __volatile__ (<span class="hljs-meta-string">"cld; rep; "</span> __FD_ZERO_STOS               \
                          : <span class="hljs-meta-string">"=c"</span> (__d0), <span class="hljs-meta-string">"=D"</span> (__d1)                \
                          : <span class="hljs-meta-string">"a"</span> (0), <span class="hljs-meta-string">"0"</span> (sizeof (fd_set)           \
                                          / sizeof (__fd_mask)),    \
                            <span class="hljs-meta-string">"1"</span> (&amp;__FDS_BITS (fdsp)[0])             \
                          : <span class="hljs-meta-string">"memory"</span>);                              \
  } while (0)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マクロの内部バージョンを定義し</font></font><code>__FD_ZERO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。この定義は、インラインアセンブラコードのまれな境界ケースの原因</font></font><code>gcc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I / Oのオペランド縛ら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるサイズで。出力演算子</font></font><code>"=D" (__d1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、レジスタ</font></font><code>edi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><code>__d1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32ビット値として</font><font style="vertical-align: inherit;">変数に</font></font><code>"1" (&amp;__FDS_BITS (fdsp)[0])</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バインドし、同じレジスタを</font></font><code>fdsp-&gt;fds_bits</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64ビットポインタとして</font><font style="vertical-align: inherit;">アドレスにバインドし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このミスマッチ</font></font><code>gcc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><code>clang</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排除します。 64ビットのレジスターを使用し、</font></font><code>rdi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値を割り当てる前にその値を切り捨て</font></font><code>__d1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。RustはデフォルトでLLVMセマンティクスを使用しますが、そのような場合は未定義のままです。デバッグビルドでは（正常に動作するリリースビルドではありません）、両方のオペランドをレジスターに割り当てることができることがわかりました</font></font><code>edi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、組み込みポインタコードの前にポインタが32ビットに切り捨てられるため、エラーが発生します。</font><font style="vertical-align: inherit;">LLVMの組み込みアセンブラコードを非常に小さな変更でRustに転送する</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ため</font></font><code>rustc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、C2Rustでこの特定のケースを修正することにしました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>c2rust-asm-casts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rust型システムのおかげでこの問題を修正</font><font style="vertical-align: inherit;">する新しいクレートを実装しました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特性</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とヘルパー関数を使用して、結合されたオペランドを両方のオペランドを保持するのに十分な大きさの内部サイズに自動的に拡張および切り捨てます。上記のコードは、次のように正しく変換されます。</font></font><br>
<br>
<pre><code class="rust hljs"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> __d0: c_int = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> __d1: c_int = <span class="hljs-number">0</span>;
<span class="hljs-comment">// Reference to the output value of the first operand</span>
<span class="hljs-keyword">let</span> fresh5 = &amp;<span class="hljs-keyword">mut</span> __d0;
<span class="hljs-comment">// The internal storage for the first tied operand</span>
<span class="hljs-keyword">let</span> fresh6;
<span class="hljs-comment">// Reference to the output value of the second operand</span>
<span class="hljs-keyword">let</span> fresh7 = &amp;<span class="hljs-keyword">mut</span> __d1;
<span class="hljs-comment">// The internal storage for the second tied operand</span>
<span class="hljs-keyword">let</span> fresh8;
<span class="hljs-comment">// Input value of the first operand</span>
<span class="hljs-keyword">let</span> fresh9 = (::std::mem::size_of::&lt;fd_set&gt;() <span class="hljs-keyword">as</span> c_ulong).wrapping_div(::std::mem::size_of::&lt;__fd_mask&gt;() <span class="hljs-keyword">as</span> c_ulong);
<span class="hljs-comment">// Input value of the second operand</span>
<span class="hljs-keyword">let</span> fresh10 = &amp;<span class="hljs-keyword">mut</span> *fdset.__fds_bits.as_mut_ptr().offset(<span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> __fd_mask;<font></font>
asm!(<span class="hljs-string">"cld; rep; stosq"</span>
     : <span class="hljs-string">"={cx}"</span> (fresh6), <span class="hljs-string">"={di}"</span> (fresh8)<font></font>
     : <span class="hljs-string">"{ax}"</span> (<span class="hljs-number">0</span>),
       <span class="hljs-comment">// Cast the input operands into the internal storage type</span>
       <span class="hljs-comment">// with optional zero- or sign-extension</span>
       <span class="hljs-string">"0"</span> (AsmCast::cast_in(fresh5, fresh9)),
       <span class="hljs-string">"1"</span> (AsmCast::cast_in(fresh7, fresh10))<font></font>
     : <span class="hljs-string">"memory"</span>
     : <span class="hljs-string">"volatile"</span>);
<span class="hljs-comment">// Cast the operands out (types are inferred) with truncation</span><font></font>
AsmCast::cast_out(fresh5, fresh9, fresh6);<font></font>
AsmCast::cast_out(fresh7, fresh10, fresh8);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは、アセンブラーコードのアセンブリで入力値と出力値の型を必要としないことに注意してください。型の競合を解決する場合は、Rust型（主</font></font><code>fresh6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">型</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">型</font></font><code>fresh8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を導出することに依存します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整列されたグローバル変数</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
失敗の最後の原因は、SSE定数を格納する次のグローバル変数でした。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ssemask[<span class="hljs-number">16</span>] __attribute__((aligned(<span class="hljs-number">16</span>))) =<font></font>
{<font></font>
	<span class="hljs-string">"\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\x00\x00\x00\x00"</span>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rustは現在、構造型のアライメント属性をサポートしていますが、グローバル変数はサポートしていません。</font><font style="vertical-align: inherit;">要素</font></font><code>static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">RustまたはC2Rustのいずれかの一般的なケースでこの問題を解決する方法を検討しましたが、今のところioquake3では、短い</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッチ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを使用して手動で修正することにしました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このパッチファイルは、Rustの同等のものを</font></font><code>ssemask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の</font><font style="vertical-align: inherit;">ものに置き換え</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="rust hljs"><span class="hljs-meta">#[repr(C, align(16))]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SseMask</span></span>([<span class="hljs-built_in">u8</span>; <span class="hljs-number">16</span>]);
<span class="hljs-keyword">static</span> <span class="hljs-keyword">mut</span> ssemask: SseMask = SseMask([
    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<font></font>
]);</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quake3-rsの実行</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
起動時</font></font><code>cargo build --release</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にバイナリが作成されますが、バイナリが</font><font style="vertical-align: inherit;">認識しない</font></font><code>target/release</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクトリ構造の</font><font style="vertical-align: inherit;">下に作成され</font></font><code>ioquake3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">現在のディレクトリにシンボリックリンクを作成して正しいディレクトリ構造（</font><font style="vertical-align: inherit;">ゲームリソースを含む</font><font style="vertical-align: inherit;">ファイルへのリンクを</font><font style="vertical-align: inherit;">含む）</font><font style="vertical-align: inherit;">を再作成</font><font style="vertical-align: inherit;">する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成しました</font></font><code>.pk3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">$ /path/to/make_quake3_rs_links.sh /path/to/quake3-rs/target/release /path/to/paks</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パス</font></font><code>/path/to/paks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ファイルを含むディレクトリを指す必要があります</font></font><code>.pk3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それではゲームを実行しましょう！</font><font style="vertical-align: inherit;">転送</font></font><code>+set vm_game 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など</font><font style="vertical-align: inherit;">が必要な</font><font style="vertical-align: inherit;">ため、これらのモジュール</font></font><code>cl_renderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、OpenGL1レンダラーを使用する</font><font style="vertical-align: inherit;">場合と同様に、QVMアセンブリとしてではなく、Rustのパブリックライブラリとしてロードし</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">$ ./ioquake3 +<span class="hljs-built_in">set</span> sv_pure 0 +<span class="hljs-built_in">set</span> vm_game 0 +<span class="hljs-built_in">set</span> vm_cgame 0 +<span class="hljs-built_in">set</span> vm_ui 0 +<span class="hljs-built_in">set</span> cl_renderer <span class="hljs-string">"opengl1"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして…</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18e/fb3/94c/18efb394c9f33f6a1cbe78503a25bb4c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RustでQuake3をリリースしました！</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2c/61d/a4f/d2c61da4f8dfcdfb39d9fbd7787070a4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、Quake 3を転置する方法のビデオです。ゲームをダウンロードして、少し遊んでください。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/lQjvSJLDXW4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランスパイルされたソース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><code>transpiled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリの</font><font style="vertical-align: inherit;">ブランチで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">調べる</font></a><font style="vertical-align: inherit;"> 
ことができ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">また</font></font><code>refactored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、同じ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">含み、</font><font style="vertical-align: inherit;">いくつかの事前に適用された</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リファクタリングコマンド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を含む</font><font style="vertical-align: inherit;">ブランチもあり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移調する方法</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quake 3を転置して自分で実行したい場合は、独自のQuake 3ゲームリソースまたはインターネットからのデモリソースが必要になることに注意してください。</font><font style="vertical-align: inherit;">また、C2Rustをインストールする必要があります（執筆時点では、必要な毎晩のバージョンはthis </font></font><code>nightly-2019-12-05</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ですが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C2Rust </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">リポジトリ</font></a><font style="vertical-align: inherit;">または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crates.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を調べて最新バージョンを見つける</font><font style="vertical-align: inherit;">ことをお勧めします</font><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<pre><code class="bash hljs">$ cargo +nightly-2019-12-05 install c2rust</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C2Rustおよびioquake3リポジトリのコピー：</font></font><br>
<br>
<pre><code class="bash hljs">$ git <span class="hljs-built_in">clone</span> &lt;a href=<span class="hljs-string">"/cdn-cgi/l/email-protection"</span> class=<span class="hljs-string">"__cf_email__"</span> data-cfemail=<span class="hljs-string">"dcbbb5a89cbbb5a8b4a9bef2bfb3b1"</span>&gt;[email&nbsp;protected]&lt;/a&gt;:immunant/c2rust.git<font></font>
$ git <span class="hljs-built_in">clone</span> &lt;a href=<span class="hljs-string">"/cdn-cgi/l/email-protection"</span> class=<span class="hljs-string">"__cf_email__"</span> data-cfemail=<span class="hljs-string">"dcbbb5a89cbbb5a8b4a9bef2bfb3b1"</span>&gt;[email&nbsp;protected]&lt;/a&gt;:immunant/ioq3.git</code></pre><br><font style="vertical-align: inherit;"></font><code>c2rust</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上記のコマンド</font><font style="vertical-align: inherit;">
を</font><font style="vertical-align: inherit;">使用し</font><font style="vertical-align: inherit;">てインストールする代わりに、を</font><font style="vertical-align: inherit;">使用してC2Rustを手動でビルドできます</font></font><code>cargo build --release</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">いずれの場合も、ioquake3トランスパイレーションに必要なコンパイララッパースクリプトが含まれているため、C2Rustリポジトリは引き続き必要です。</font><font style="vertical-align: inherit;">Cコードを自動的にトランスパイルし、パッチを適用</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">投稿しました</font></font><code>ssemask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを使用するには、リポジトリの最上位から次のコマンドを実行します</font></font><code>ioq3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">$ ./transpile.sh &lt;/path/to/C2Rust repository&gt; &lt;/path/to/c2rust binary&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンドにより、</font></font><code>quake3-rs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rustコードを含む</font><font style="vertical-align: inherit;">サブディレクトリ</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">作成されます。このサブディレクトリ</font><font style="vertical-align: inherit;">に対して、コマンド</font></font><code>cargo build --release</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と上記の残りのステップを</font><font style="vertical-align: inherit;">実行でき</font><font style="vertical-align: inherit;">ます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja483130/index.html">スーツケースのロックのコードを忘れた場合はどうすればよいですか？</a></li>
<li><a href="../ja483132/index.html">望遠鏡の設計と製造</a></li>
<li><a href="../ja483134/index.html">二要素認証テストと可能な回避策</a></li>
<li><a href="../ja483136/index.html">購入前の中古MacBookの確認-チェックリスト</a></li>
<li><a href="../ja483140/index.html">ポリゴン別世界：Amiga 500</a></li>
<li><a href="../ja483144/index.html">科学者He Jiankuiはヒーローであり、犯罪者ではありません</a></li>
<li><a href="../ja483146/index.html">DEFCON 27 Conference。Kraken WiFiワイヤレスハッキングツール</a></li>
<li><a href="../ja483148/index.html">デジタルツインとシミュレーションについてコンサルティング会社の創設者と話し合います</a></li>
<li><a href="../ja483154/index.html">私は4万ドルを費やし、スタートアップの素晴らしいアイデアを台無しにしました</a></li>
<li><a href="../ja483156/index.html">猫を足元に</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>