<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÖ üêè üë∂üèΩ As I wrote a semi-decentralized cryptocurrency in PHP. (Part 2 - Development) ‚öóÔ∏è üòÅ üêã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword
 In one of the previous articles I talked about which libraries are useful to us and compared this idea with that unsuccessful one. In this p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>As I wrote a semi-decentralized cryptocurrency in PHP. (Part 2 - Development)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490498/"><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreword</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In one of the previous articles I talked about which libraries are useful to us and compared this idea with that unsuccessful one. </font><font style="vertical-align: inherit;">In this part, we will develop the cryptocurrency itself and configure the tracker. </font><font style="vertical-align: inherit;">Let's not hesitate, let's go.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of Articles</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As I wrote a semi-decentralized cryptocurrency in PHP. </font><font style="vertical-align: inherit;">(Part 1 - Collecting Libraries)</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As I wrote a semi-decentralized cryptocurrency in PHP. </font><font style="vertical-align: inherit;">(Part 2 - Development)</font></font></a></li>
</ol><cut></cut><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tracker Installation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before we start installing the web tracker, I‚Äôll tell you - the library supports two types of tracker - Native and Web. </font><font style="vertical-align: inherit;">Native-tracker can be used on various VDS, and they will easily maintain lists of users on the network. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here I will use a Web tracker that can be easily installed on the site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We pass to the GitHub repository, which I talked about in the previous part. </font><font style="vertical-align: inherit;">The master branch does not interest us, we select web. </font><font style="vertical-align: inherit;">Download the archive with this thread, unpack it and open in index pad or somewhere else, where you prefer, the index.php file. </font><font style="vertical-align: inherit;">Here is the content of the file:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.php</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">/**
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * <span class="hljs-doctag">@package</span>     Bit Points Network
 * <span class="hljs-doctag">@copyright</span>   2020 Podvirnyy Nikita (Observer KRypt0n_)
 * <span class="hljs-doctag">@license</span>     GNU GPLv3 &lt;https://www.gnu.org/licenses/gpl-3.0.html&gt;
 * <span class="hljs-doctag">@author</span>      Podvirnyy Nikita (Observer KRypt0n_)
 * 
 * Contacts:
 *
 * Email: &lt;suimin.tu.mu.ga.mi<span class="hljs-doctag">@gmail</span>.com&gt;
 * VK:    &lt;https://vk.com/technomindlp&gt;
 *        &lt;https://vk.com/hphp_convertation&gt;
 * 
 */</span><font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">BPN</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> TRACKER_KEY = <span class="hljs-string">'EFJI#*$&amp;(*#WEF(@Q#)(DFJSAO(@#*$)REFSKE)UJ*#@(&amp;$'</span>;<font></font>
<font></font>
<span class="hljs-keyword">require</span> <span class="hljs-string">'ext/DH-Generator/Generator.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-string">'php/User.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-string">'php/Tracker.php'</span>;<font></font>
<font></font>
$tracker = <span class="hljs-keyword">new</span> Tracker;<font></font>
$tracker-&gt;update ();<font></font>
<font></font>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> ($_GET[<span class="hljs-string">'r'</span>]))<font></font>
    $tracker-&gt;processRequest ($_GET[<span class="hljs-string">'r'</span>]);</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You must change the TRACKER_KEY constant to many different characters so that it does not match the original file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's say this:</font></font><br>
<br>
<pre><code class="php hljs">
<span class="hljs-keyword">const</span> TRACKER_KEY = <span class="hljs-string">'sdT*&amp;Y&amp;*YO*&amp;T*OGTGYFIYYUFGKUHLIYIj9sfhysdphphdpsfhBLABLABLAhsidlfhlisd'</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is just an example. </font><font style="vertical-align: inherit;">You must change in your own way. </font><font style="vertical-align: inherit;">We post it all on the hosting. </font><font style="vertical-align: inherit;">Web tracker setup is complete. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What is this tracker for?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Development</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">General</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since this is our application, you need to connect all the packages and components, namely the Composer and non-Composer packages, establish the structure of accounts and the local database of accounts, make the interaction between the application and the structures, and initialize the application itself.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">General.php</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">declare</span> (strict_types=<span class="hljs-number">1</span>);<font></font>
<font></font>
<span class="hljs-keyword">require_once</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/vendor/autoload.php'</span>; <span class="hljs-comment">#   </span><font></font>
<font></font>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'PHP/Structure.php'</span>;              <span class="hljs-comment"># </span>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'PHP/UserAPI.php'</span>;                <span class="hljs-comment"># </span><font></font>
<font></font>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'NotComposer/vendor/autoload.php'</span>;<span class="hljs-comment">#  - </span><font></font>
<font></font>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'PHP/App.php'</span>;                    <span class="hljs-comment"># </span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The library for BIP39 requires strict typing; we declare it in the first lines of code. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The BIP39 and BIP44 libraries themselves are loaded with the autoload.php file, standard for Composer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will declare the data structure in Structure.php. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Functions for working with wallets will be in the UserAPI.php file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The BPN and phpblockchain libraries are not compatible with Composer, we create a file with a name similar to Composer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We take out the application itself in App.php - it will be the last connected file there, since we must first load everything from above.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NotComposer / vendor / autoload.php</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I already said that those two libraries are not compatible with Composer, there are files that aren‚Äôt native to them, or they don‚Äôt exist at all, and they are also absent on Packagist. </font><font style="vertical-align: inherit;">You have to manually download them, and connect them. </font><font style="vertical-align: inherit;">This file is designed for that.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The data structures here are designed to make it easier to handle wallets. </font><font style="vertical-align: inherit;">The library is needed for UserAPI.php to do the work with wallets, namely registering and restoring the wallet, and for App.php to use these wallets.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure.php</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span>
</span>{
	<span class="hljs-keyword">public</span> $address;
	<span class="hljs-keyword">public</span> $publicKey;
	<span class="hljs-keyword">protected</span> $privateKey;<font></font>
<font></font>
	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPrivateKey</span> (<span class="hljs-params"></span>)
	</span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;privateKey;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setPrivateKey</span> (<span class="hljs-params">$key</span>)
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;privateKey = $key;<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountChain</span>
</span>{
	<span class="hljs-keyword">public</span> $accounts;<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primitive code, right?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserAPI.php</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The intermediary between Structure.php and App.php is UserAPI.php. </font><font style="vertical-align: inherit;">Through it, we will already operate with wallets, register new ones and restore existing ones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Code of this file:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserAPI.php</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> \<span class="hljs-title">FurqanSiddiqui</span>\<span class="hljs-title">BIP39</span>\<span class="hljs-title">BIP39</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">BIP</span>\<span class="hljs-title">BIP44</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>
</span>{
	<span class="hljs-keyword">public</span> $account;<font></font>
<font></font>
	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerNewAccount</span> (<span class="hljs-params">$password</span>)
	</span>{<font></font>
		$mnemonic = BIP39::Generate (<span class="hljs-number">18</span>);<font></font>
		$seed = $mnemonic-&gt;generateSeed ($password, <span class="hljs-number">256</span>);<font></font>
<font></font>
		$HDKey = BIP44::fromMasterSeed ($seed)-&gt;derive (<span class="hljs-string">"m/44'/0'/0'/0/1"</span>);<font></font>
<font></font>
		$newAccount = <span class="hljs-keyword">new</span> Account;<font></font>
		$newAccount-&gt;address = <span class="hljs-string">'1x'</span> . hash (<span class="hljs-string">'ripemd160'</span>, hash (<span class="hljs-string">'sha512'</span>, $HDKey-&gt;publicKey));<font></font>
		$newAccount-&gt;publicKey = $HDKey-&gt;publicKey;<font></font>
		$newAccount-&gt;setPrivateKey ($HDKey-&gt;privateKey);<font></font>
<font></font>
		$accountChain = <span class="hljs-keyword">new</span> AccountChain;<font></font>
		$accountChain-&gt;accounts = [];<font></font>
		$accountChain-&gt;accounts[] = $newAccount;<font></font>
		<font></font>
		<span class="hljs-keyword">return</span> [<span class="hljs-string">'words'</span> =&gt; $mnemonic-&gt;words, <span class="hljs-string">'chain'</span> =&gt; $accountChain];<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerNewAccountInChain</span> (<span class="hljs-params">&amp;$chain, $password, $prevAccountMnemonic</span>)
	</span>{<font></font>
		$mnemonic = BIP39::Words ($prevAccountMnemonic);<font></font>
		$seed = $mnemonic-&gt;generateSeed ($password, <span class="hljs-number">256</span>);<font></font>
<font></font>
		$accountsCount = sizeof ($chain-&gt;accounts) + <span class="hljs-number">1</span>;<font></font>
<font></font>
		$HDKey = BIP44::fromMasterSeed ($seed)-&gt;derive (<span class="hljs-string">"m/44'/0'/0'/0/{$accountsCount}"</span>);<font></font>
<font></font>
		$newAccount = <span class="hljs-keyword">new</span> Account;<font></font>
		$newAccount-&gt;address = <span class="hljs-string">'1x'</span> . hash (<span class="hljs-string">'ripemd160'</span>, hash (<span class="hljs-string">'sha512'</span>, $HDKey-&gt;publicKey));<font></font>
		$newAccount-&gt;publicKey = $HDKey-&gt;publicKey;<font></font>
		$newAccount-&gt;setPrivateKey ($HDKey-&gt;privateKey);<font></font>
<font></font>
		$chain-&gt;accounts[] = $newAccount;<font></font>
<font></font>
		<span class="hljs-keyword">return</span> [<span class="hljs-string">'chain'</span> =&gt; $chain];<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">restoreAccount</span> (<span class="hljs-params">$mnemonic, $password, $accountNo</span>)
	</span>{<font></font>
		$mnemonic = BIP39::Words ($mnemonic);<font></font>
		$seed = $mnemonic-&gt;generateSeed ($password, <span class="hljs-number">256</span>);<font></font>
<font></font>
		$HDKey = BIP44::fromMasterSeed ($seed)-&gt;derive (<span class="hljs-string">"m/44'/0'/0'/0/{$accountNo}"</span>);<font></font>
<font></font>
		$newAccount = <span class="hljs-keyword">new</span> Account;<font></font>
		$newAccount-&gt;address = <span class="hljs-string">'1x'</span> . hash (<span class="hljs-string">'ripemd160'</span>, hash (<span class="hljs-string">'sha512'</span>, $HDKey-&gt;publicKey));<font></font>
		$newAccount-&gt;publicKey = $HDKey-&gt;publicKey;<font></font>
		$newAccount-&gt;setPrivateKey ($HDKey-&gt;privateKey);<font></font>
<font></font>
		$accountChain = <span class="hljs-keyword">new</span> AccountChain;<font></font>
		$accountChain-&gt;accounts = [];<font></font>
		$accountChain-&gt;accounts[] = $newAccount;<font></font>
<font></font>
		<span class="hljs-keyword">return</span> $accountChain;<font></font>
	}<font></font>
}</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The app</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The very logic of our client. </font><font style="vertical-align: inherit;">She is responsible for everything, for working as a miner, getting a balance, sending transactions and making them homemade.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App.php</font></font></b><div class="spoiler_text"> ,      .   3 ‚Äî ,      .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To summarize</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We talked a lot about something, about structures, about keeping wallets and a lot of things. </font><font style="vertical-align: inherit;">In the next part, we will continue to show currency codes.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL; DR</font></font></b><div class="spoiler_text">  ‚Äî       ‚Äî FlyCoin    FLC<br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490484/index.html">Managing smart home sensors with the Google Assistant</a></li>
<li><a href="../en490490/index.html">Weekend Reading: 10 materials on the effects of sound on health - from ‚Äúnoise hygiene‚Äù to good sleep and GTD</a></li>
<li><a href="../en490492/index.html">Warehouse robot learns to sort non-standard things</a></li>
<li><a href="../en490494/index.html">Shop rats, Widiots and gamers: propaganda of the dangers of video games in the 80s</a></li>
<li><a href="../en490496/index.html">Creating an Online Store on Nuxt.js 2 Walkthrough Part 1</a></li>
<li><a href="../en490500/index.html">ECS back and forth</a></li>
<li><a href="../en490502/index.html">Ansible vs Puppet</a></li>
<li><a href="../en490510/index.html">Companies spend $ 16 billion on drones to capture 8 trillion market</a></li>
<li><a href="../en490512/index.html">(Almost) Auto-generate colors</a></li>
<li><a href="../en490516/index.html">AI exists, but is that not what we thought?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>