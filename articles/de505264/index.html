<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤘🏿 👩🏽‍⚖️ 👍🏾 Als ich den HTML-Parser in PHP schrieb, und was daraus wurde. Teil eins 🕥 🛌🏼 🍔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo. 
 
 Heute möchte ich erzählen, wie man einen HTML-Parser schreibt und auf welche Probleme ich bei der Entwicklung eines ähnlichen Parsers in PH...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Als ich den HTML-Parser in PHP schrieb, und was daraus wurde. Teil eins</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505264/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute möchte ich erzählen, wie man einen HTML-Parser schreibt und auf welche Probleme ich bei der Entwicklung eines ähnlichen Parsers in PHP gestoßen bin. </font><font style="vertical-align: inherit;">Aber es gab viele Probleme. </font><font style="vertical-align: inherit;">Und im ersten Teil werde ich über das Design des Parsers und die aufgetretenen Probleme sprechen, da sich der HTML-Parser vom Parser der Programmiersprachen unterscheidet, die allen bekannt sind.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe versucht, den Text dieses Artikels so klar wie möglich zu schreiben, damit jeder, der nicht einmal mit dem allgemeinen Gerät der Parser vertraut ist, verstehen kann, wie der HTML-Parser funktioniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Folgenden werde ich das Dokument, das HTML enthält, einfach </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Dokument" nennen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der im Element befindliche Dom-Baum wird als </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Subarray" bezeichnet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was soll der Parser tun?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns zunächst entscheiden, was der Parser tun soll, um in Zukunft darauf aufzubauen. </font><font style="vertical-align: inherit;">Der Parser sollte nämlich:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwerfen Sie einen dokumentbasierten Dombaum</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn das Dokument Fehler enthält, muss er diese beheben.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finde Gegenstände im Dombaum </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finden Sie Kinderartikel </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Text finden </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist die einfachste Liste dessen, was ein Parser tun sollte. </font><font style="vertical-align: inherit;">In guter Weise sollte es dennoch Informationen über Fehler senden, falls diese im Originaldokument gefunden wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies sind jedoch Kleinigkeiten. </font><font style="vertical-align: inherit;">Die Grundfunktionalität reicht aus, um ein paar Nächte lang den Kopf zu zerschlagen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt jedoch ein Problem, auf das ich sofort gestoßen bin: HTML ist nicht nur eine Sprache, sondern eine Hypertextsprache. </font><font style="vertical-align: inherit;">Eine solche Sprache hat eine eigene Syntax, und ein gewöhnlicher Parser funktioniert nicht.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teile und herrsche</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zu beginnen, müssen Sie die Arbeit des Parsers in zwei Phasen unterteilen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trennen Sie einfachen Text von Tags</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sortieren Sie alle empfangenen Tags im Dom-Baum</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies gilt direkt für das Parsen eines Dokuments. Ich werde etwas später in diesem Kapitel über die Suche nach Elementen sprechen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die erste Stufe zu beschreiben, habe ich ein Diagramm gezeichnet, das deutlich zeigt, wie die Daten in der ersten Stufe verarbeitet werden: </font></font><br>
<br>
<img src="https://hsto.org/webt/vi/da/ma/vidama0m4yfx28z5lpj9n9c7ado.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe beschlossen, alle kleinen Details wegzulassen. Wie kann man zum Beispiel unterscheiden, dass nach dem Öffnen von "&lt;" ein Tag und kein Text kommt? Ich werde in den folgenden Abschnitten darüber sprechen. Das reicht fürs Erste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es lohnt sich auch zu klären. Es ist logisch, dass das Dokument neben Tags auch Text enthält. In einfachen Worten, wenn der Parser ein Eröffnungs-Tag findet und Text darin ist, schreibt er es nach dem Eröffnungs-Tag als separates Tag. Ein solches Tag wird als einzeln betrachtet und nimmt nicht an weiteren Arbeiten des Parsers teil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, die zweite Stufe. </font><font style="vertical-align: inherit;">Das aus gestalterischer Sicht schwierigste und aus verständnisvoller Sicht auf den ersten Blick einfachste: </font></font><br>
<br>
<img src="https://hsto.org/webt/cl/mw/wt/clmwwtchiuag_bey_qkr0c4dwjk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall bedeutet die Ebene die Ebene der Rekursion. </font><font style="vertical-align: inherit;">Das heißt, wenn der Parser ein öffnendes Tag gefunden hat, ruft er sich selbst auf, "betritt eine niedrigere Ebene", und dies wird fortgesetzt, bis ein schließendes Tag gefunden wird. </font><font style="vertical-align: inherit;">In diesem Fall ergibt die Rekursion das Ergebnis "Goes a Level Up". </font><font style="vertical-align: inherit;">Aber was ist mit einzelnen Tags? </font><font style="vertical-align: inherit;">Solche Tags werden weder als Öffnen noch als Schließen als Rekursion betrachtet. </font><font style="vertical-align: inherit;">Sie gehen einfach zu dom "As Is". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis erhalten wir ungefähr Folgendes:</font></font><br>
<br>
<pre><code class="php hljs">[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt;<font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">215</span><font></font>
[tag] =&gt; div<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">// </span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt;<font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">238</span><font></font>
[tag] =&gt; div<font></font>
[id] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; tjojo<font></font>
)<font></font>
<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">// </span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">//     </span><font></font>
(<font></font>
[tag] =&gt; __TEXT<font></font>
[<span class="hljs-number">0</span>] =&gt; !<font></font>
<font></font>
)<font></font>
<font></font>
[<span class="hljs-number">1</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt; <span class="hljs-number">1</span><font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">268</span><font></font>
[tag] =&gt; div<font></font>
)<font></font>
<font></font>
)<font></font>
)<font></font>
)<font></font>
)<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist mit dem Finden von Elementen?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns nun über das Finden von Elementen sprechen. Aber hier ist nicht alles so klar, wie Sie vielleicht denken. Zuerst müssen Sie herausfinden, nach welchen Kriterien wir nach Elementen suchen. Hier ist alles einfach, wir suchen sie nach denselben Kriterien wie Javascript: Tags, Klassen und Bezeichner. Aber hier ist das Problem. Tatsache ist, dass es nur ein Tag geben kann, aber die Klassen und Bezeichner eines Elements viele oder gar nicht sind. Daher unterscheidet sich die Suche nach einem Element nach Tag von der Suche nach Klasse oder Kennung. Ich habe ein Suchschema für ein Tag gezeichnet, aber keine Sorge: Die Suche nach Klasse oder Kennung ist nicht sehr unterschiedlich.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/qs/w2/j4qsw2kzjw9bzaxen6mozm6gc0i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine kleine Klarstellung. </font><font style="vertical-align: inherit;">Mit ursprünglichem Wert meinte ich den Namen des Tags, zum Beispiel "div". </font><font style="vertical-align: inherit;">Wenn ein Element nicht dem ursprünglichen Wert entspricht, aber ein Subarray mit einem geeigneten Element hat, wird das Ergebnis genau das entsprechende Element mit seinem Subarray geschrieben, falls eines vorhanden ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist auch erwähnenswert, dass der Parser eine Funktion hat, mit der Sie nach einem bestimmten Element im Dokument suchen können. </font><font style="vertical-align: inherit;">Dadurch wird die Leistung des Parsers erheblich beschleunigt, sodass er schneller ausgeführt werden kann. </font><font style="vertical-align: inherit;">Es ist beispielsweise möglich, nur das erste gefundene oder das fünfte Element nach Ihren Wünschen zu verwenden. </font><font style="vertical-align: inherit;">Sie müssen zugeben, dass es in solchen Fällen für den Parser viel einfacher ist, nach Elementen zu suchen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suche nach Kinderartikeln</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, die Suche nach Elementen wurde sortiert, aber was ist mit untergeordneten Elementen? </font><font style="vertical-align: inherit;">Auch hier ist alles einfach: Unser Parser übernimmt gegebenenfalls alle verschachtelten Subarrays von Elementen, die zuvor gefunden wurden. </font><font style="vertical-align: inherit;">Wenn keine vorhanden sind, gibt der Parser ein leeres Ergebnis aus und fährt fort:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y0/4a/wy/y04awyfodd4cs4c9n5pijqetnkm.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Textsuche</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt nichts zu reden. </font><font style="vertical-align: inherit;">Der Parser nimmt einfach den gesamten empfangenen Text aus dem Subarray und gibt ihn aus.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehler</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Dokument kann Fehler enthalten, die unser Skript erfolgreich behandeln muss, oder, wenn der Fehler kritisch ist, auf dem Bildschirm anzeigen. </font><font style="vertical-align: inherit;">Hier finden Sie eine Liste aller möglichen Fehler, über die wir in Zukunft sprechen werden:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Symbol "&gt;" wurde nicht gefunden.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ein solcher Fehler tritt auf, wenn der Parser das Ende des Dokuments erreicht und das schließende Symbol "&gt;" nicht gefunden hat.</font></font><br>
</li>
<li><b>  </b><br>
    ,            .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">some</span> =&gt;</span><span class="hljs-comment">&lt;!--   ?    ,   --&gt;</span></code></pre><br>
</li>
<li><b> html </b><br>
     :        "&lt;",    "="  ,      .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">some</span> = =<span class="hljs-string">'something'</span>&gt;</span><span class="hljs-comment">&lt;!-- ,    --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tag</span> &lt;<span class="hljs-attr">some</span> =<span class="hljs-string">'something'</span>&gt;</span><span class="hljs-comment">&lt;!--  ?  ,    ? --&gt;</span></code></pre><br>
</li>
<li><b>   </b><br>
     ,     ,    ,  .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = =<span class="hljs-string">'wefwe'</span>&gt;</span><font></font>
!<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-comment">&lt;!--   &lt;/div&gt;?--&gt;</span>
</code></pre><br>
        .<br>
</li>
<li><b>   </b><br>
  ,    ,  .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = =<span class="hljs-string">'wefwe'</span>&gt;</span><font></font>
!<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--    ?--&gt;</span>
</code></pre><br>
     .<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untergeordnetes Element nicht gefunden.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In diesem Fall gibt der Parser einfach ein leeres Array aus.</font></font><br>
</li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript, Stil und Kommentare</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Parser werden die Skript- und Stil-Tags sofort übersprungen, da ich beim Schreiben keinen Sinn sehe. </font><font style="vertical-align: inherit;">Bei den Kommentaren ist die Situation anders. </font><font style="vertical-align: inherit;">Wenn Sie von schreiben möchten, können Sie eine separate Skriptfunktion aktivieren, die dann geschrieben wird. </font><font style="vertical-align: inherit;">Kommentare werden auf die gleiche Weise wie Text aufgezeichnet, dh als separates Tag.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielmehr sollte dieser Artikel als kleiner Exkurs zum Thema HTML-Parser betrachtet werden. </font><font style="vertical-align: inherit;">Ich habe es für diejenigen geschrieben, die darüber nachdenken, ihren eigenen Parser zu schreiben, oder für diejenigen, die nur interessiert sind. </font><font style="vertical-align: inherit;">Glauben Sie mir, das macht wirklich Spaß! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel ist der erste einleitende Teil. </font><font style="vertical-align: inherit;">In den nächsten Teilen dieser Serie wird der Code direkt teilnehmen, und es werden weniger Bilder mit Algorithmen angezeigt (was in Ordnung ist, da ich sie nicht zeichnen kann). </font><font style="vertical-align: inherit;">Bleib dran!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de505252/index.html">Avokado-Projekt</a></li>
<li><a href="../de505254/index.html">Schlangenzucker oder schreiben Sie Ihr Sortiment in JavaScript</a></li>
<li><a href="../de505256/index.html">Erfolgreicher Start. 39. seit Jahresbeginn. 14. aus den USA. Starlink SpaceX-Satelliten</a></li>
<li><a href="../de505258/index.html">Zahnmedizin: Erwartung und Realität</a></li>
<li><a href="../de505260/index.html">Messung der Verzögerung von der Tastatur zum Photon mit einem optischen Sensor</a></li>
<li><a href="../de505268/index.html">Persönliche Erfahrung: vom Frontend-Entwickler zum Leader</a></li>
<li><a href="../de505274/index.html">Tödliche Sünden der Site-Sicherheit: Was wir aus den Statistiken des Schwachstellenscanners für das Jahr gelernt haben</a></li>
<li><a href="../de505276/index.html">Wie wir ABBYY FineReader PDF beigebracht haben, ganze Absätze zu bearbeiten</a></li>
<li><a href="../de505278/index.html">39 Abkürzungen in Englisch für Anfänger und Seoshnikov</a></li>
<li><a href="../de505280/index.html">Magento 2: Kritisches CSS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>