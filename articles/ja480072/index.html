<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📓 💅🏼 ☁️ Kubernetes：システムリソース管理を設定することがなぜそれほど重要なのですか？ 👨🏾‍🎤 👩‍🚀 🧔🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="原則として、アプリケーションを正しく安定して動作させるには、常に専用のリソースプールをアプリケーションに提供する必要があります。しかし、複数のアプリケーションが同時に同じ容量で動作するとどうなるでしょうか。それぞれに最低限必要なリソースを提供するには？リソースの消費を制限するにはどうすればよいですか...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kubernetes：システムリソース管理を設定することがなぜそれほど重要なのですか？</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/nixys/blog/480072/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原則として、アプリケーションを正しく安定して動作させるには、常に専用のリソースプールをアプリケーションに提供する必要があります。</font><font style="vertical-align: inherit;">しかし、複数のアプリケーションが同時に同じ容量で動作するとどうなるでしょうか。</font><font style="vertical-align: inherit;">それぞれに最低限必要なリソースを提供するには？</font><font style="vertical-align: inherit;">リソースの消費を制限するにはどうすればよいですか？</font><font style="vertical-align: inherit;">ノード間で負荷を適切に分散するにはどうすればよいですか？</font><font style="vertical-align: inherit;">アプリケーションの負荷が増加した場合に、水平スケーリングメカニズムの動作を保証するにはどうすればよいですか？</font></font></p><br>
<p><img src="https://habrastorage.org/webt/-f/yj/hw/-fyjhwhkhcibnshgzndgd4w4e_c.png"></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、システムに存在する基本的な種類のリソース（これはもちろん、プロセッサ時間とRAM）から始める必要があります。</font><font style="vertical-align: inherit;">k8sマニフェストでは、これらのタイプのリソースは次の単位で測定されます。</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU-コア</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM-バイト単位</font></font></li>
</ul><br>
<p>          — <strong>requests </strong>  <strong>limits</strong>. Requests —           (   ),     limits    ,  . </p><br>
<p> ,         ,     :</p><br>
<ul>
<li>    limits ,  requests      ,  limits (   ,  describe ). ..         ,      .</li>
<li>      requests,          — ..      .</li>
</ul><br>
<p>           ,     namespace    :</p><br>
<ul>
<li><strong>LimitRange</strong> —      /  ns    ,      /,       / ( ),          limits  requests</li>
<li><strong>ResourceQuotas</strong> —          ns  ,  ,      (,        )</li>
</ul><br>
<p>   ,     :</p><br>
<ul>
<li><p>   :</p><br>
<pre><code class="plaintext hljs">containers:<font></font>
- name: app-nginx<font></font>
  image: nginx<font></font>
  resources:<font></font>
    requests:<font></font>
      memory: 1Gi<font></font>
    limits:<font></font>
      cpu: 200m</code></pre><br>
<p>..        nginx      1G   0.2 CPU  ,       0.2 CPU      .</p><br>
</li>
<li><p>   ns:</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: ResourceQuota<font></font>
metadata:<font></font>
  name: nxs-test<font></font>
spec:<font></font>
  hard:<font></font>
    requests.cpu: 300m<font></font>
    requests.memory: 1Gi<font></font>
    limits.cpu: 700m<font></font>
    limits.memory: 2Gi</code></pre><br>
<p>..   request    ns    300m  CPU  1G  ,    limit — 700m  CPU  2G  .</p><br>
</li>
<li><p>     ns:</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: LimitRange<font></font>
metadata:<font></font>
  name: nxs-limit-per-container<font></font>
spec:<font></font>
 limits:<font></font>
   - type: Container<font></font>
     defaultRequest:<font></font>
       cpu: 100m<font></font>
       memory: 1Gi<font></font>
     default:<font></font>
       cpu: 1<font></font>
       memory: 2Gi<font></font>
     min:<font></font>
       cpu: 50m<font></font>
       memory: 500Mi<font></font>
     max:<font></font>
       cpu: 2<font></font>
       memory: 4Gi</code></pre><br>
<p>..   namespace        request  100m  CPU  1G  , limit — 1 CPU  2G.          request/limit  CPU (50m &lt; x &lt; 2)  RAM (500M &lt; x &lt; 4G).</p><br>
</li>
<li><p>    ns:</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: LimitRange<font></font>
metadata:<font></font>
 name: nxs-limit-pod<font></font>
spec:<font></font>
 limits:<font></font>
 - type: Pod<font></font>
   max:<font></font>
     cpu: 4<font></font>
     memory: 1Gi</code></pre><br>
<p>..      ns     4 vCPU  1G.</p><br>
</li>
</ul><br>
<p>           .</p><br>
<h2 id="mehanizm-balansirovki-nagruzki-mezhdu-nodami">    </h2><br>
<p> ,         k8s,  <strong>scheduler</strong>,     .            :</p><br>
<ol>
<li></li>
<li></li>
</ol><br>
<p>..      ,         <strong>predicates</strong> (            — PodFitsResources),       ,  <strong>priorities</strong>   (  ,       —      — LeastResourceAllocation/LeastRequestedPriority/BalancedResourceAllocation)          (      ,     ). </p><br>
<p>   ,  scheduler        ,    etcd — ..   requested/limit   ,    ,      .        <code>kubectl describe node $NODE</code>, :</p><br>
<pre><code class="bash hljs"><span class="hljs-comment"># kubectl describe nodes nxs-k8s-s1</span><font></font>
..<font></font>
Non-terminated Pods:         (9 <span class="hljs-keyword">in</span> total)<font></font>
  Namespace                  Name                                         CPU Requests  CPU Limits  Memory Requests  Memory Limits  AGE<font></font>
  ---------                  ----                                         ------------  ----------  ---------------  -------------  ---<font></font>
  ingress-nginx              nginx-ingress-controller-754b85bf44-qkt2t    0 (0%)        0 (0%)      0 (0%)           0 (0%)         233d<font></font>
  kube-system                kube-flannel-26bl4                           150m (0%)     300m (1%)   64M (0%)         500M (1%)      233d<font></font>
  kube-system                kube-proxy-exporter-cb629                    0 (0%)        0 (0%)      0 (0%)           0 (0%)         233d<font></font>
  kube-system                kube-proxy-x9fsc                             0 (0%)        0 (0%)      0 (0%)           0 (0%)         233d<font></font>
  kube-system                nginx-proxy-k8s-worker-s1                    25m (0%)      300m (1%)   32M (0%)         512M (1%)      233d<font></font>
  nxs-monitoring             alertmanager-main-1                          100m (0%)     100m (0%)   425Mi (1%)       25Mi (0%)      233d<font></font>
  nxs-logging                filebeat-lmsmp                               100m (0%)     0 (0%)      100Mi (0%)       200Mi (0%)     233d<font></font>
  nxs-monitoring             node-exporter-v4gdq                          112m (0%)     122m (0%)   200Mi (0%)       220Mi (0%)     233d<font></font>
Allocated resources:<font></font>
  (Total limits may be over 100 percent, i.e., overcommitted.)<font></font>
  Resource           Requests           Limits<font></font>
  --------           --------           ------<font></font>
  cpu                487m (3%)          822m (5%)<font></font>
  memory             15856217600 (2%)  749976320 (3%)<font></font>
  ephemeral-storage  0 (0%)             0 (0%)</code></pre><br>
<p>    ,    ,   ,     .      scheduler    cronjob-cron-events-1573793820-xt6q9 (    scheduler    10-       --v=10 ):</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><pre><code class="plaintext hljs">I1115 07:57:21.637791       1 scheduling_queue.go:908] About to try and schedule pod nxs-stage/cronjob-cron-events-1573793820-xt6q9                                                                                                                                           <font></font>
I1115 07:57:21.637804       1 scheduler.go:453] Attempting to schedule pod: nxs-stage/cronjob-cron-events-1573793820-xt6q9                                                                                                                                                    <font></font>
I1115 07:57:21.638285       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s5 is allowed, Node is running only 16 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638300       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s6 is allowed, Node is running only 20 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638322       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s3 is allowed, Node is running only 20 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638322       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s4 is allowed, Node is running only 17 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638334       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s10 is allowed, Node is running only 16 out of 110 Pods.                                                                              <font></font>
I1115 07:57:21.638365       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s12 is allowed, Node is running only 9 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638334       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s11 is allowed, Node is running only 11 out of 110 Pods.                                                                              <font></font>
I1115 07:57:21.638385       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s1 is allowed, Node is running only 19 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638402       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s2 is allowed, Node is running only 21 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638383       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s9 is allowed, Node is running only 16 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638335       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s8 is allowed, Node is running only 18 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638408       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s13 is allowed, Node is running only 8 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638478       1 predicates.go:1369] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s10 is allowed, existing pods anti-affinity terms satisfied.                                                                         <font></font>
I1115 07:57:21.638505       1 predicates.go:1369] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s8 is allowed, existing pods anti-affinity terms satisfied.                                                                          <font></font>
I1115 07:57:21.638577       1 predicates.go:1369] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s9 is allowed, existing pods anti-affinity terms satisfied.                                                                          <font></font>
I1115 07:57:21.638583       1 predicates.go:829] Schedule Pod nxs-stage/cronjob-cron-events-1573793820-xt6q9 on Node nxs-k8s-s7 is allowed, Node is running only 25 out of 110 Pods.                                                                               <font></font>
I1115 07:57:21.638932       1 resource_allocation.go:78] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s10: BalancedResourceAllocation, capacity 39900 millicores 66620178432 memory bytes, total request 2343 millicores 9640186880 memory bytes, score 9        <font></font>
I1115 07:57:21.638946       1 resource_allocation.go:78] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s10: LeastResourceAllocation, capacity 39900 millicores 66620178432 memory bytes, total request 2343 millicores 9640186880 memory bytes, score 8           <font></font>
I1115 07:57:21.638961       1 resource_allocation.go:78] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s9: BalancedResourceAllocation, capacity 39900 millicores 66620170240 memory bytes, total request 4107 millicores 11307422720 memory bytes, score 9        <font></font>
I1115 07:57:21.638971       1 resource_allocation.go:78] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s8: BalancedResourceAllocation, capacity 39900 millicores 66620178432 memory bytes, total request 5847 millicores 24333637120 memory bytes, score 7        <font></font>
I1115 07:57:21.638975       1 resource_allocation.go:78] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s9: LeastResourceAllocation, capacity 39900 millicores 66620170240 memory bytes, total request 4107 millicores 11307422720 memory bytes, score 8           <font></font>
I1115 07:57:21.638990       1 resource_allocation.go:78] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s8: LeastResourceAllocation, capacity 39900 millicores 66620178432 memory bytes, total request 5847 millicores 24333637120 memory bytes, score 7           <font></font>
I1115 07:57:21.639022       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s10: TaintTolerationPriority, Score: (10)                                                                                                        <font></font>
I1115 07:57:21.639030       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s8: TaintTolerationPriority, Score: (10)                                                                                                         <font></font>
I1115 07:57:21.639034       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s9: TaintTolerationPriority, Score: (10)                                                                                                         <font></font>
I1115 07:57:21.639041       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s10: NodeAffinityPriority, Score: (0)                                                                                                            <font></font>
I1115 07:57:21.639053       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s8: NodeAffinityPriority, Score: (0)                                                                                                             <font></font>
I1115 07:57:21.639059       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s9: NodeAffinityPriority, Score: (0)                                                                                                             <font></font>
I1115 07:57:21.639061       1 interpod_affinity.go:237] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s10: InterPodAffinityPriority, Score: (0)                                                                                                                   <font></font>
I1115 07:57:21.639063       1 selector_spreading.go:146] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s10: SelectorSpreadPriority, Score: (10)                                                                                                                   <font></font>
I1115 07:57:21.639073       1 interpod_affinity.go:237] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s8: InterPodAffinityPriority, Score: (0)                                                                                                                    <font></font>
I1115 07:57:21.639077       1 selector_spreading.go:146] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s8: SelectorSpreadPriority, Score: (10)                                                                                                                    <font></font>
I1115 07:57:21.639085       1 interpod_affinity.go:237] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s9: InterPodAffinityPriority, Score: (0)                                                                                                                    <font></font>
I1115 07:57:21.639088       1 selector_spreading.go:146] cronjob-cron-events-1573793820-xt6q9 -&gt; nxs-k8s-s9: SelectorSpreadPriority, Score: (10)                                                                                                                    <font></font>
I1115 07:57:21.639103       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s10: SelectorSpreadPriority, Score: (10)                                                                                                         <font></font>
I1115 07:57:21.639109       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s8: SelectorSpreadPriority, Score: (10)                                                                                                          <font></font>
I1115 07:57:21.639114       1 generic_scheduler.go:726] cronjob-cron-events-1573793820-xt6q9_nxs-stage -&gt; nxs-k8s-s9: SelectorSpreadPriority, Score: (10)                                                                                                          <font></font>
I1115 07:57:21.639127       1 generic_scheduler.go:781] Host nxs-k8s-s10 =&gt; Score 100037                                                                                                                                                                            <font></font>
I1115 07:57:21.639150       1 generic_scheduler.go:781] Host nxs-k8s-s8 =&gt; Score 100034                                                                                                                                                                             <font></font>
I1115 07:57:21.639154       1 generic_scheduler.go:781] Host nxs-k8s-s9 =&gt; Score 100037                                                                                                                                                                             <font></font>
I1115 07:57:21.639267       1 scheduler_binder.go:269] AssumePodVolumes for pod "nxs-stage/cronjob-cron-events-1573793820-xt6q9", node "nxs-k8s-s10"                                                                                                               <font></font>
I1115 07:57:21.639286       1 scheduler_binder.go:279] AssumePodVolumes for pod "nxs-stage/cronjob-cron-events-1573793820-xt6q9", node "nxs-k8s-s10": all PVCs bound and nothing to do                                                                             <font></font>
I1115 07:57:21.639333       1 factory.go:733] Attempting to bind cronjob-cron-events-1573793820-xt6q9 to nxs-k8s-s10</code></pre></div></div><br>
<p>  ,   scheduler       3- ,     (nxs-k8s-s8, nxs-k8s-s9, nxs-k8s-s10).        (   BalancedResourceAllocation, LeastResourceAllocation)           .            (        100037,      — nxs-k8s-s10).</p><br>
<p><strong></strong>:     ,     ,   k8s (    )    ,          . ,   , ,  pod    (, wowza)      ,     ,        ,     k8s               (      ),   ,     ,            . </p><br>
<h2 id="vyselenie-poda"> </h2><br>
<p>  —      3 QoS-:</p><br>
<ol>
<li><strong>guaranuted</strong> —  ,        memory  cpu  request  limit,     </li>
<li><strong>burstable</strong> —        request  limit,   request &lt; limit</li>
<li><strong>best effort</strong> —          </li>
</ol><br>
<p> ,       (, ), kubelet     ’   ,       QoS-. ,     RAM,    QoS      :</p><br>
<ul>
<li><strong>Guaranteed</strong>: -998</li>
<li><strong>BestEffort</strong>: 1000</li>
<li><strong>Burstable</strong>: min(max(2, 1000 — (1000 * memoryRequestBytes) / machineMemoryCapacityBytes), 999)</li>
</ul><br>
<p>..   , kubelet          QoS- best effort.</p><br>
<p><strong></strong>:                ,           request/limit  .</p><br>
<h2 id="mehanizm-gorizontalnogo-avtomasshtabirovaniya-podov-prilozheniya-hpa">     (HPA)</h2><br>
<p>        pod      ( — CPU/ RAM   — rps)        k8s  <strong>HPA</strong> (Horizontal Pod Autoscaler).     :</p><br>
<ol>
<li>     (currentMetricValue)</li>
<li>     (desiredMetricValue),        request</li>
<li>    (currentReplicas)</li>
<li>       (desiredReplicas)<br>
desiredReplicas = [ currentReplicas * ( currentMetricValue / desiredMetricValue )]</li>
</ol><br>
<p>    ,   (currentMetricValue / desiredMetricValue)   1 (       ,     0.1).</p><br>
<p>  hpa    app-test (  Deployment),     ,     CPU:</p><br>
<ul>
<li><p> </p><br>
<pre><code class="plaintext hljs">kind: Deployment<font></font>
apiVersion: apps/v1beta2<font></font>
metadata:<font></font>
 name: app-test<font></font>
spec:<font></font>
 selector:<font></font>
   matchLabels:<font></font>
     app: app-test<font></font>
 replicas: 2<font></font>
 template:<font></font>
   metadata:<font></font>
     labels:<font></font>
       app: app-test<font></font>
   spec:<font></font>
     containers:<font></font>
     - name: nginx<font></font>
       image: registry.nixys.ru/generic-images/nginx<font></font>
       imagePullPolicy: Always<font></font>
       resources:<font></font>
         requests:<font></font>
           cpu: 60m<font></font>
       ports:<font></font>
       - name: http<font></font>
         containerPort: 80<font></font>
       - name: nginx-exporter<font></font>
         image: nginx/nginx-prometheus-exporter<font></font>
         resources:<font></font>
           requests:<font></font>
             cpu: 30m<font></font>
         ports:<font></font>
         - name: nginx-exporter<font></font>
           containerPort: 9113<font></font>
         args:<font></font>
         - -nginx.scrape-uri<font></font>
         - http://127.0.0.1:80/nginx-status</code></pre><br>
<p>..  ,         ,       nginx  nginx-exporter,      <strong>requests</strong>  CPU.</p><br>
</li>
<li><p> HPA</p><br>
<pre><code class="plaintext hljs">apiVersion: autoscaling/v2beta2<font></font>
kind: HorizontalPodAutoscaler<font></font>
metadata:<font></font>
 name: app-test-hpa<font></font>
spec:<font></font>
 maxReplicas: 10<font></font>
 minReplicas: 2<font></font>
 scaleTargetRef:<font></font>
   apiVersion: extensions/v1beta1<font></font>
   kind: Deployment<font></font>
   name: app-test<font></font>
 metrics:<font></font>
 - type: Resource<font></font>
   resource:<font></font>
     name: cpu<font></font>
     target:<font></font>
       type: Utilization<font></font>
       averageUtilization: 30</code></pre><br>
<p>..   hpa,     Deployment app-test          cpu ( ,     30%     CPU),        2-10.</p><br>
<p>,    hpa,       :</p><br>
<pre><code class="bash hljs"> <span class="hljs-comment"># kubectl top pod</span><font></font>
 NAME                                                   CPU(cores)   MEMORY(bytes)<font></font>
 app-test-78559f8f44-pgs58            101m         243Mi<font></font>
 app-test-78559f8f44-cj4jz            4m           240Mi</code></pre><br>
</li>
</ul><br>
<p>  :</p><br>
<ul>
<li>  (desiredMetricValue) —   hpa    30%</li>
<li>  (currentMetricValue) —   controller-manager       %, ..   :<br>
<ol>
<li>      metric-, .. 101m  4m</li>
<li>   , .. (101m + 4m ) / 2 = 53m</li>
<li>       (   request  ) 60m + 30m = 90m</li>
<li>    CPU  request , .. 53m / 90m * 100% = 59%</li>
</ol></li>
</ul><br>
<p>       ,       ,    :</p><br>
<p><code>ratio = 59% / 30% = 1.96</code></p><br>
<p>..       ~2    [2 * 1.96] = 4.</p><br>
<p><strong>:</strong>   ,              requests      .</p><br>
<h2 id="mehanizm-gorizontalnogo-avtomasshtabirovaniya-nod-cluster-autoscaler">    (Cluster Autoscaler)</h2><br>
<p> ,         ,   hpa  . ,    hpa controller manager    ,       2 ,            (..        requests)       Pending.</p><br>
<p>  ,      IaaS/PaaS (, GKE/GCE, AKS, EKS  ..),     ,  <strong>Node Autoscaler</strong>.                 (   API    / ),             (   Pending).</p><br>
<p><strong>:</strong>       requests   ,  k8s        ,         .</p><br>
<hr><br>
<h2 id="zaklyuchenie"></h2><br>
<p> ,             ,         :</p><br>
<ol>
<li>    scheduler       k8s</li>
<li>     “ ”</li>
<li>      (HPA)</li>
<li>     (Cluster Autoscaling)   </li>
</ol><br>
<h2 id="takzhe-chitayte-drugie-stati-v-nashem-bloge">      :</h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Tekton Pipeline — Kubernetes- pipelines</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">C    Nginx</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     ClickHouse    ClickHouse  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   Context  Golang</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     Docker-</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     web-</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480058/index.html">クリスマスツリーのトランススター</a></li>
<li><a href="../ja480060/index.html">オープンデータの単純なP300分類器</a></li>
<li><a href="../ja480062/index.html">10制御システム。タスクで通信してファイルを共有する方が便利な場所はどこですか？</a></li>
<li><a href="../ja480064/index.html">テーマ別にグループ化された単語の学習</a></li>
<li><a href="../ja480068/index.html">[更新]私たちの人々は暴力を受け、私たちは沈黙しますか？</a></li>
<li><a href="../ja480076/index.html">さまざまなソースからのデータのマルチプロセッシングと調整</a></li>
<li><a href="../ja480078/index.html">React周辺機器の新しいフロントエンドライブラリ</a></li>
<li><a href="../ja480080/index.html">メモを取るアプリケーションでは何が必要ですか？</a></li>
<li><a href="../ja480082/index.html">多数の監視オブジェクトを含むZabbixのMySQLでパーティショニングを使用する</a></li>
<li><a href="../ja480086/index.html">152-FZの要件に準拠し、お客様の個人データを保護し、レーキを踏まない方法  </a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>