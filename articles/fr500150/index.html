<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüåæ ü•° üë©üèª‚Äçüé® Robot ROS et Neural Grid Beggar üö£üèª üëè üåÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habituellement, deux de ces questions se posent pour ces m√©tiers: ¬´comment?¬ª et pour quoi?" La publication elle-m√™me est consacr√©e √† la premi√®re quest...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Robot ROS et Neural Grid Beggar</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500150/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habituellement, deux de ces questions se posent pour ces m√©tiers: ¬´comment?¬ª et pour quoi?" La publication elle-m√™me est consacr√©e √† la premi√®re question, et je r√©pondrai imm√©diatement √† la seconde: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
j'ai commenc√© ce projet afin de ma√Ætriser la robotique, √† commencer par le Raspberry Pi et la cam√©ra. Comme vous le savez, l'un des meilleurs moyens d'apprendre quelque chose est de proposer une t√¢che technique et d'essayer de l'accomplir, tout en acqu√©rant les comp√©tences n√©cessaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä cette √©poque, je n'avais toujours pas d'id√©es brillantes dans le domaine de la robotique, alors j'ai d√©cid√© de faire un projet exclusivement amusant - un robot mendiant. Le r√©sultat est un robot autonome sur le Raspberry Pi et le ROS, utilisant le Movidius Neural Cumpute Stick pour d√©tecter les visages. Il erre dans la pi√®ce, cherche des gens, et secoue une canette devant eux. Voici √† quoi ressemble ce robot:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/wp/nt/ptwpntdd13lkskxbxjuhoyx1oom.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le robot se d√©place au hasard dans la pi√®ce, et s'il remarque une personne, il s'enroule et secoue un pot pour de petites choses. </font><font style="vertical-align: inherit;">Pour le plaisir, je lui ai ajout√© une petite expression faciale - il sait bouger ses sourcils: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2x/lm/aw/2xlmaw5tm_hogsuqfuvqwjmeblk.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
apr√®s la premi√®re tentative, le robot essaie de retrouver son visage en vue, se tourne vers la personne et secoue √† nouveau la banque. </font><font style="vertical-align: inherit;">Mais que se passe-t-il si vous partez en ce moment:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/8x/xz/ko8xxzvzo_owit62gkv8z3wn1ik.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai pris l'id√©e d'un robot mendiant du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">magazine Popular Mechanics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La paternit√© du prototype de Chris Eckert appel√© Gimme semble tr√®s esth√©tique.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/374/8d6/dbc/3748d6dbcb97d04751dacd866eb94e07.jpg" alt="image" width="300" height="300"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je voulais me concentrer davantage sur la fonctionnalit√©, donc le bo√Ætier a √©t√© assembl√© √† partir de mat√©riaux improvis√©s. </font><font style="vertical-align: inherit;">En particulier, les coins en PVC se sont r√©v√©l√©s √™tre le mat√©riau le plus polyvalent avec lequel vous pouvez connecter presque deux parties. </font><font style="vertical-align: inherit;">Il semble qu'√† l'heure actuelle, le robot soit compos√© √† cinq pour cent de coins en PVC et de vis M3. </font><font style="vertical-align: inherit;">Le bo√Ætier lui-m√™me se compose de trois plates-formes stratifi√©es sur lesquelles la t√™te et toute l'√©lectronique sont mont√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La base du robot est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 2B</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et le code est √©crit en C ++ et se trouve sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vision</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour percevoir la r√©alit√©, le robot utilise la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cam√©ra Paspberry Pi Camera Module v2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui peut √™tre contr√¥l√©e √† l'aide de la biblioth√®que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RaspiCam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la d√©tection des visages, j'ai essay√© plusieurs approches diff√©rentes. La qualit√© des d√©tecteurs classiques d'OpenCV ne m'a pas satisfait, donc finalement je suis arriv√© √† une solution plut√¥t non standard. D√©tection de personnes engag√©es dans le r√©seau neuronal, fonctionnant sur l'appareil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Movidius Neural Compute Stick (NCS)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sous le cadre de contr√¥le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVINO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NCS est un tel mat√©riel pour le lancement efficace de r√©seaux de neurones, √† l'int√©rieur desquels se trouvent plusieurs processeurs vectoriels sp√©cialement con√ßus pour cela. L'appareil est connect√© via USB et ne consomme que 1 Watt d'√©nergie. Ainsi, le NCS agit comme un co-processeur pour le Raspberry Pi, qui ne tire pas le r√©seau neuronal. Pendant que le NCS traite la trame suivante, le processeur Paspberry est libre pour d'autres op√©rations. Il convient de noter que pour un fonctionnement optimal de l'appareil, une interface USB 3.0 est requise, qui n'est pas disponible sur les anciennes versions de Raspberry; avec USB 2.0, cela fonctionne aussi, mais plus lentement. Aussi, afin de ne pas bloquer les connecteurs USB Raspberry, je lui connecte le NCS via un court c√¢ble USB. J'ai √©crit en d√©tail sur l'utilisation du Neural Compute Stick </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans mon article pr√©c√©dent</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but, j'ai essay√© de m'entra√Æner</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propre d√©tecteur de visage avec architecture MobileNet + SSD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur des ensembles de donn√©es ouverts. Le d√©tecteur fonctionnait vraiment, mais pas tr√®s stable: avec la d√©t√©rioration in√©vitable des conditions de prise de vue (exposition et clich√©s flous), la qualit√© du d√©tecteur s'affaissait fortement. Cependant, apr√®s un certain temps, des d√©tecteurs de visage pr√™ts √† l'emploi sont apparus dans OpenVINO, et je suis pass√© √† un d√©tecteur avec l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">architecture SqueezeNet light + SSD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui non seulement fonctionnait mieux dans diverses conditions de prise de vue, mais √©tait √©galement plus rapide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de t√©l√©charger l'image sur le NCS pour obtenir les pr√©visions du d√©tecteur, l'image doit √™tre pr√©trait√©e. Le d√©tecteur de mon choix fonctionne avec des images en couleur</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>300</mn><mo>&amp;#x00D7;</mo><mn>300</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.815ex" height="2.009ex" viewBox="0 -755.5 4225.9 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-D7" x="1723" y="0"></use><g transform="translate(2724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>300</mn><mo>√ó</mo><mn>300</mn></math></span></span><script type="math/tex" id="MathJax-Element-1">300 \times 300</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, donc l'image doit d'abord √™tre compress√©e. Pour ce faire, j'utilise l'algorithme de mise √† l'√©chelle le plus l√©ger - la m√©thode du plus proche voisin (INTER_NEAREST dans la biblioth√®que OpenCV). Cela fonctionne un peu plus rapidement que les m√©thodes d'interpolation et n'affecte presque pas le r√©sultat. Il convient √©galement de pr√™ter attention √† l'ordre des canaux d'image: le d√©tecteur attend l'ordre BGR, vous devez donc le d√©finir pour la cam√©ra.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai √©galement essay√© de s√©parer le traitement vid√©o en deux flux, dont l'un a re√ßu l'image suivante de la cam√©ra et l'a trait√©e, et l'autre √† ce moment-l√† a t√©l√©charg√© l'image pr√©c√©dente sur NCS et a attendu les r√©sultats du d√©tecteur. Avec ce sch√©ma, techniquement, la vitesse de traitement augmente, mais le d√©lai entre la r√©ception de la trame et la r√©ception des d√©tections pour elle augmente √©galement. En raison de ce retard par rapport √† la r√©alit√©, la surveillance du visage devient seulement plus difficile, donc j'ai finalement refus√© ce sch√©ma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus de d√©tecter r√©ellement les visages, ils doivent √©galement √™tre suivis pour √©viter les erreurs de d√©tection. Pour ce faire, j'utilise le tracker l√©ger </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple Online Realtime Tracker (SORT)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ce tracker simple se compose de deux parties: l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">algorithme hongrois</font></a><font style="vertical-align: inherit;"> est utilis√© pour faire correspondre les objets sur les images adjacentes</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et de pr√©dire la trajectoire de l'objet, s'il dispara√Æt subitement - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filtre de Kalman</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pendant que je jouais avec le suivi du visage, j'ai trouv√© que les trajectoires pr√©dites par le filtre de Kalman peuvent √™tre tr√®s invraisemblables avec des mouvements brusques, ce qui ne fait que compliquer le processus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, j'ai d√©sactiv√© le filtre de Kalman, ne laissant que l'algorithme de correspondance de visage et le compteur du nombre s√©quentiel d'images sur lesquelles le visage a √©t√© d√©tect√© - de cette fa√ßon, je me d√©barrasse des faux positifs du d√©tecteur. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plateforme sup√©rieure, de gauche √† droite: cam√©ra, servos pour contr√¥ler la t√™te et les sourcils, interrupteur, bornes d'alimentation, Big Red Button.</font></font></i><br>
<img src="https://habrastorage.org/webt/hb/ky/kk/hbkykkpwtkhtfl39aonaop5indg.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trafic</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le mouvement, le robot dispose de cinq servos: deux servos √† rotation continue FS5103R font tourner les roues; Il y a deux autres FS5109M ordinaires, dont l'un fait tourner la t√™te et l'autre secoue la bo√Æte; enfin, le petit SG90 remue les sourcils.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour √™tre honn√™te, les mini-servos SG90 me semblaient √™tre une poubelle - l'un de mes servos avait la mauvaise largeur d'impulsion de contr√¥le, et un seul a surv√©cu parmi les quatre autres. En toute honn√™tet√©, j'ai accidentellement pris l'un des domestiques avec mon coude, mais les deux autres ne pouvaient tout simplement pas supporter la charge (je les utilisais pour la t√™te et la bo√Æte). M√™me le dernier servo, qui a obtenu le travail le plus simple - d√©placer les sourcils, doit pousser un b√¢ton de temps en temps pour qu'il ne se coince pas. Avec d'autres servos, je n'ai remarqu√© aucun probl√®me. Il est vrai que les servos √† rotation continue doivent parfois √™tre calibr√©s afin qu'ils ne tournent pas √† l'√©tat inactif - pour cela, il y a un petit r√©gulateur sur eux qui peut √™tre tourn√© avec un tournevis √† t√™te d'horloge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que la gestion des servos avec Raspberry n'est pas si simple. Premi√®rement, ils sont contr√¥l√©s par</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modulation de largeur d'impulsion (PWM / PWM)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et sur Raspberry il n'y a que deux broches sur lesquelles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM est pris en charge par le mat√©riel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Deuxi√®mement, bien s√ªr, Raspberry ne pourra pas alimenter les servos, il ne le supportera pas. Heureusement, ces probl√®mes sont r√©solus √† l'aide d'un contr√¥leur PWM externe. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adafruit PCA9685</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un contr√¥leur PWM √† 16 canaux qui peut √™tre contr√¥l√© via l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface I2C</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il est √©galement tr√®s pratique de disposer de bornes pour l'alimentation des servos. De plus, [th√©oriquement] il est possible de cha√Æner jusqu'√† 62 contr√¥leurs, tout en recevant jusqu'√† 992 broches de contr√¥le - pour cela, vous devez attribuer une adresse unique √† chaque contr√¥leur √† l'aide de cavaliers sp√©ciaux. Donc, si vous avez soudainement besoin d'une arm√©e de servos - vous savez quoi faire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour contr√¥ler le PCA9685, il existe une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioth√®que de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> haut niveau </font><font style="vertical-align: inherit;">qui agit comme une extension </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiringPi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Travailler avec cette chose est assez pratique - lors de l'initialisation, il cr√©e 16 broches virtuelles dans lesquelles vous pouvez √©crire un signal PWM, mais vous devez d'abord calculer le nombre de ticks. </font><font style="vertical-align: inherit;">Pour tourner le servo-levier √† un certain angle dans la plage [0, 180], vous devez d'abord traduire cet angle dans la plage de longueurs d'impulsion de contr√¥le en millisecondes [SERVO_MS_MIN, SERVO_MS_MAX]. </font><font style="vertical-align: inherit;">Pour tous mes servos, ces valeurs sont respectivement d'environ 0,6 ms et 2,4 ms. </font><font style="vertical-align: inherit;">En g√©n√©ral, ces valeurs peuvent √™tre trouv√©es dans la fiche technique du servo, mais la pratique a montr√© qu'elles peuvent diff√©rer, il peut donc √™tre n√©cessaire de les s√©lectionner. </font><font style="vertical-align: inherit;">Divisez ensuite la valeur r√©sultante par 20 ms (la valeur standard de la dur√©e du cycle de contr√¥le) et multipliez par le nombre maximal de graduations PCA9685 (4096):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">driveDegs</span><span class="hljs-params">(<span class="hljs-keyword">float</span> angle, <span class="hljs-keyword">int</span> pin)</span> </span>{
    <span class="hljs-keyword">int</span> ticks = (<span class="hljs-keyword">int</span>) (PCA_MAX_PWM * (angle/<span class="hljs-number">180.0f</span>*(SERVO_MS_MAX-SERVO_MS_MIN) + SERVO_MS_MIN) / <span class="hljs-number">20.0f</span>); <font></font>
    pwmWrite(pin, ticks);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De m√™me, cela se fait avec des servos √† rotation continue - au lieu d'un angle, nous d√©finissons la vitesse dans la plage [-1,1].</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai assembl√© le ch√¢ssis du robot, ainsi que le corps, √† partir de moyens improvis√©s: je mets des roues de meuble sur les servo-entra√Ænements √† rotation continue, et un support de boule de meuble fait office de troisi√®me roue. Auparavant, au lieu de cela, une roue se tenait sur un support rotatif, mais avec un tel ch√¢ssis, il √©tait difficile de faire des virages pr√©cis, j'ai donc d√ª le remplacer. Il y a aussi une petite roue sous la bo√Æte pour transf√©rer une partie du poids du servo au bo√Ætier. Une chose simple qui n'√©tait pas √©vidente pour moi au d√©part √©tait que les servo-leviers doivent √™tre fix√©s avec une vis, en particulier pour les roues, afin qu'ils ne tombent pas en cours de route. √Ä cause d'une telle stupidit√©, j'ai d√ª refaire le ch√¢ssis une fois. J'ai √©galement fait du robot un large pare-chocs fait de coins en PVC pour qu'il ne se coince pas si souvent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, ce que vous pouvez faire √† ce sujet. Tout d'abord, vous pouvez secouer le pot et bouger les sourcils - pour cela, il vous suffit de tourner le servo-levier √† des angles pr√©s√©lectionn√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deuxi√®mement, vous pouvez tourner la t√™te. Je ne voulais pas que la t√™te tourne √† la vitesse maximale du servo, car il y a un appareil photo dessus. Par cons√©quent, j'ai d√©cid√© de r√©duire la vitesse par programme: je dois tourner le levier d'un petit angle, puis attendre quelques millisecondes - et ainsi de suite jusqu'√† ce que l'angle souhait√© soit atteint. Dans ce cas, il est n√©cessaire de se souvenir de la position absolue actuelle de la t√™te et de v√©rifier √† chaque fois si elle a d√©pass√© les limites autoris√©es (sur mon robot, elle est dans la plage de [10, 90] degr√©s).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Troisi√®mement, vous pouvez changer la direction du mouvement en modifiant la vitesse de rotation des roues. </font><font style="vertical-align: inherit;">De la m√™me mani√®re, vous pouvez faire pivoter la plate-forme, par exemple, pour suivre le visage. </font><font style="vertical-align: inherit;">La vitesse angulaire de rotation d√©pend √† la fois des servos eux-m√™mes et de leur emplacement sur le ch√¢ssis, il est donc plus facile de la mesurer une fois puis de la prendre en compte dans les virages. </font><font style="vertical-align: inherit;">Pour trouver le d√©lai n√©cessaire entre l'activation des moteurs en rotation et leur d√©sactivation, vous devez diviser le module d'angle par la vitesse angulaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, vous pouvez faire pivoter la t√™te et le ch√¢ssis simultan√©ment et de mani√®re asynchrone afin de ne pas perdre de temps. </font><font style="vertical-align: inherit;">Je le fais comme √ßa:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">auto</span> waitRotation = <span class="hljs-built_in">std</span>::async(<span class="hljs-built_in">std</span>::launch::async, rotatePlatform, platformAngle);<font></font>
success = driveHead(headAngle);<font></font>
waitRotation.wait();<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plateforme centrale, de gauche √† droite: PCA9685, bus d'alimentation, Raspberry Pi, MCP3008 ADC</font></font></i><br>
<img src="https://habrastorage.org/webt/bq/q1/8_/bqq18_ilwmgadlcsz0ydepdk44u.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La navigation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, je n'ai rien compliqu√©, donc le robot utilise uniquement deux t√©l√©m√®tres infrarouges Sharp GP2Y0A02YK pour la navigation. Ce n'est pas aussi simple, car les capteurs sont analogiques, mais Raspberry, contrairement √† Arduino, n'a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas d'entr√©es analogiques</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ce probl√®me est r√©solu par le convertisseur analogique-num√©rique (ADC / ADC) - j'utilise le MCP3008 10 bits et 8 canaux. Il est vendu comme un microcircuit s√©par√©, il a donc d√ª √™tre soud√© √† une carte de circuit imprim√© et des broches y ont √©galement √©t√© soud√©es pour le rendre plus pratique √† connecter. De plus, sur les conseils de mon bati, qui t√¢tonne davantage dans les circuits, j'ai soud√© deux condensateurs (c√©ramique et √©lectrolytique) entre les jambes de l'alimentation et le sol pour absorber le bruit de la partie num√©rique de l'ensemble du circuit. Les capteurs ne produisent pas plus de trois volts √† la sortie, donc 3,3 V avec Raspberry peuvent √™tre connect√©s en tant que tension ADC de r√©f√©rence (VREF) - la m√™me que pour l'alimentation MCP3008 (VDD). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le MCP3008 peut √™tre contr√¥l√© via l'interface </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et pour cela, il est encore plus facile de trouver du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code pr√™t</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">emploi sur GitHub</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malgr√© cela, pour un travail pratique avec l'ADC, vous aurez besoin de quelques danses avec un tambourin.</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">analogRead</span><span class="hljs-params">(mcp3008Spi &amp;adc, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> channel)</span>
</span>{
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> spi_data[<span class="hljs-number">3</span>];
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> val = <span class="hljs-number">0</span>;<font></font>
<font></font>
    spi_data[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;  <span class="hljs-comment">// start bit</span>
    spi_data[<span class="hljs-number">1</span>] = <span class="hljs-number">0b10000000</span> | ( channel &lt;&lt; <span class="hljs-number">4</span>); <span class="hljs-comment">// mode and channel</span>
    spi_data[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// anything</span>
    adc.spiWriteRead(spi_data, <span class="hljs-keyword">sizeof</span>(spi_data));<font></font>
  <font></font>
    <span class="hljs-comment">// read value, combine last two bits of second byte with whole third byte</span>
    val = (spi_data[<span class="hljs-number">1</span>]&lt;&lt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0b1100000000</span>; <font></font>
    val |= (spi_data[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>);
    <span class="hljs-keyword">return</span> val;<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trois octets doivent √™tre envoy√©s au MCP3008, o√π le bit de d√©but est √©crit dans le premier octet, et le num√©ro de mode et de canal (0-7) dans le second. </font><font style="vertical-align: inherit;">Nous r√©cup√©rons √©galement trois octets, apr√®s quoi nous devons coller les deux bits les moins significatifs du deuxi√®me octet avec tous les bits du troisi√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que nous pouvons obtenir les valeurs des capteurs, nous devons les calibrer, car les deux capteurs peuvent diff√©rer l√©g√®rement l'un de l'autre. </font><font style="vertical-align: inherit;">En g√©n√©ral, l'affichage √† distance en raison de la puissance du signal de ces capteurs est non lin√©aire et pas tr√®s simple ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour plus de d√©tails voir fiche technique, pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Par cons√©quent, il suffit de prendre deux coefficients, multipli√©s par lesquels les capteurs donneront une valeur de 1,0 √† une distance √©gale et significative.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les lectures des capteurs peuvent √™tre assez bruyantes, en particulier sur les obstacles difficiles, donc j'utilise une moyenne mobile √† pond√©ration exponentielle (EWMA) pour lisser le signal de chaque capteur. </font><font style="vertical-align: inherit;">J'ai s√©lectionn√© les param√®tres de lissage √† l'≈ìil, afin que le signal ne fasse pas de bruit et ne soit pas loin derri√®re la r√©alit√©. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vue de face: banque, t√©l√©m√®tres et pare-chocs.</font></font></i><br>
<img src="https://habrastorage.org/webt/kb/vw/l-/kbvwl-usmln86iqj8aq236ifhpo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutrition</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, √©valuons le courant que le robot va consommer (√† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propos de la consommation actuelle de framboise et de p√©riph√©riques</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 2B: pas moins de 350 mA, mais plus sous charge (jusqu'√† 750-820 mA (?));</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appareil photo: environ 250 mA;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neural Compute Stick: consommation d'√©nergie d√©clar√©e de 1 watt, √† une tension de 5 volts sur USB, elle est de 200 mA;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteurs IR: 33 mA chacun ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fiche technique, pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li>MCP3008:  ,  0.5  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">, pdf</a>);</li>
<li>PCA9685:  , 6  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">, pdf</a>);</li>
<li>:  ~150-200   1500-2000     (stall current),          (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> FS5109M, pdf</a>)</li>
<li>HDMI (   ): 50 ;</li>
<li> +  ( ): ~200 .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au total, on peut estimer que 1,5 √† 2,5 amp√®res devraient √™tre suffisants, √† condition que tous les servos ne se d√©placent pas simultan√©ment sous une lourde charge. Dans le m√™me temps, Raspberry a besoin d'une tension conditionnelle de 5 volts, et pour les servos - de 4,8 √† 6 volts. Reste √† trouver une source d'alimentation r√©pondant √† ces exigences. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, j'ai d√©cid√© d'alimenter le robot √† partir de batteries au format 18650. Si vous prenez deux </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batteries ROBITON 3.4 / Li18650</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (3,6 volts, 3400 mAh, courant de d√©charge maximum 4875 mA) et les connectez en s√©rie, elles peuvent produire jusqu'√† 4,8 amp√®res √† une tension de 7,2 volts. Avec un courant de consommation de 1,5 √† 2,5 amp√®res, ils devraient √™tre suffisants pour une heure ou deux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les batteries, en passant, ont un hic: malgr√© le facteur de forme indiqu√© 18650, leurs tailles sont loin d'√™tre</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>18</mn><mo>&amp;#x00D7;</mo><mn>650</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.653ex" height="2.009ex" viewBox="0 -755.5 3725.4 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-D7" x="1223" y="0"></use><g transform="translate(2223,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-36"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>18</mn><mo>√ó</mo><mn>650</mn></math></span></span><script type="math/tex" id="MathJax-Element-2">18 \times 650</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mm - ils sont plus longs de plusieurs millim√®tres gr√¢ce au circuit de contr√¥le de charge int√©gr√©. Pour cette raison, j'ai d√ª poignarder le compartiment de la batterie avec un couteau pour qu'ils y tiennent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne reste plus qu'√† abaisser la tension √† 5 volts. Pour cela, j'utilise deux convertisseurs DC-DC abaisseur s√©par√©s </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DFRobot Power Module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ce morceau de fer vous permet d'abaisser la tension √† une tension d'entr√©e de 3,6-25 volts et une diff√©rence de tension d'au moins 0,6 volts. Pour plus de commodit√©, il dispose d'un interrupteur qui vous permet de s√©lectionner exactement 5 volts √† la sortie, ou vous pouvez configurer une tension de sortie arbitraire √† l'aide d'un r√©gulateur sp√©cial. J'ai r√©gl√© les deux convertisseurs √† 5 volts; l'un d'eux alimente la framboise via un connecteur micro-USB, et le second alimente les servos via les terminaux PCA9685. Ceci est n√©cessaire afin de maximiser l'alimentation √©lectrique des parties logiques et √©lectriques du robot afin qu'elles n'interf√®rent pas entre elles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au stade du d√©bogage, j'ai utilis√© une alimentation chinoise de 9 volts, 2 amp√®res au lieu des batteries, et c'√©tait suffisant pour que le robot fonctionne - je l'ai connect√©, comme les batteries, √† deux convertisseurs DC-DC. Par cons√©quent, pour plus de commodit√©, j'ai cr√©√© des bornes sur le robot, auxquelles vous pouvez connecter une alimentation ou un compartiment √† piles au choix. Cela a beaucoup aid√© lorsque j'ai compl√®tement r√©√©crit tout le code sur ROS, et j'ai d√ª d√©boguer le robot pendant longtemps, y compris les servos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus de commodit√©, j'ai √©galement d√ª faire un "bus d'alimentation" - en fait, juste un morceau de la carte avec trois rang√©es de broches connect√©es pour la masse, 3,3v et 5v, respectivement. Le bus se connecte aux broches Raspberry correspondantes. Seuls les t√©l√©m√®tres infrarouges sont aliment√©s par le bus 5v et les MCP3008 et PCA9685 par le bus 3,3v.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et bien s√ªr, selon la bonne vieille tradition, j'ai mis le gros bouton rouge sur le robot - quand il est press√©, il interrompt simplement tout le circuit d'alimentation. </font><font style="vertical-align: inherit;">Il n'√©tait pas n√©cessaire de l'utiliser pour un arr√™t d'urgence, mais allumer le robot √† l'aide d'un bouton est vraiment plus pratique. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plateforme inf√©rieure, de gauche √† droite: compartiment batterie, NCS, convertisseurs DC-DC, servo variateurs avec roues, t√©l√©m√®tres.</font></font></i><br>
<img src="https://habrastorage.org/webt/od/tf/6b/odtf6b5gksijt0nhbflim7wrh1m.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contr√¥le du robot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de Wi-Fi sur le Raspberry Pi 2B, je dois donc me connecter via ssh via un c√¢ble Ethernet (au fait, cela peut √™tre fait </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directement depuis l'ordinateur portable, sans utiliser de routeur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Il s'av√®re que ce sch√©ma: nous nous connectons via ssh via le c√¢ble, d√©marrons le robot et retirons le c√¢ble. Ensuite, il peut √™tre remis √† sa place pour acc√©der √† nouveau √† la framboise. Il existe des solutions plus √©l√©gantes, mais j'ai d√©cid√© de ne pas compliquer les choses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que le robot puisse √™tre facilement arr√™t√© sans s'√©teindre, j'ai ajout√© un interrupteur sovi√©tique massif (√† partir d'un sous-marin?). Lorsque vous l'√©teignez, le programme se termine et le robot s'arr√™te. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le commutateur se connecte √† la terre et √† l'une des broches Raspberry GPIO, et vous pouvez y lire √† l'aide de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la biblioth√®que WiringPi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">wiringPiSetup();<font></font>
pinMode(PIN_SWITCH, INPUT);<font></font>
pullUpDnControl(PIN_SWITCH, PUD_UP);<font></font>
<span class="hljs-keyword">bool</span> value = digitalRead(BB_PIN_SWITCH);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter qu'avec cette connexion, la tension sur la broche doit √™tre augment√©e jusqu'√† 3,3 V, et en m√™me temps, elle produira un signal haut √† l'√©tat ouvert et un signal bas √† l'√©tat ferm√©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettre tous ensemble</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Maintenant, tout ce qui pr√©c√®de doit √™tre combin√© en un seul programme qui contr√¥le le robot. </font><font style="vertical-align: inherit;">Dans la premi√®re version du robot, je l'ai fait en utilisant des threads ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pthread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Cette version est dans la branche </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais le code y est assez effrayant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le programme fonctionne en quatre fils: un fil prend des images de la cam√©ra et d√©marre le d√©tecteur sur le NCS; </font><font style="vertical-align: inherit;">le deuxi√®me flux lit les donn√©es des t√©l√©m√®tres; </font><font style="vertical-align: inherit;">le troisi√®me thread surveille le commutateur et d√©finit la variable globale </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'il est √©teint; Le thread principal est responsable du comportement du robot et de l'asservissement. Les threads ont des pointeurs en commun avec le thread principal, par lesquels ils √©crivent les r√©sultats de leur travail. J'ai limit√© les vecteurs qui stockent les informations sur les faces trouv√©es par le d√©tecteur au mutex, et d√©clar√© les autres variables communes plus simples comme atomiques. Pour coordonner le flux du d√©tecteur de visage avec le fil principal, un indicateur </font></font><code>face_processed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est r√©initialis√© lorsqu'un nouveau r√©sultat provient du d√©tecteur et augmente lorsque le fil principal utilise ce r√©sultat pour s√©lectionner un comportement - cela est n√©cessaire afin de ne pas traiter les anciennes donn√©es qui peuvent ne pas √™tre pertinentes apr√®s avoir d√©m√©nag√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
version </font><b><font style="vertical-align: inherit;">ROS</font></b><font style="vertical-align: inherit;"> avec les streams fonctionnait bien, mais j'ai commenc√© tout cela pour apprendre quelque chose, alors pourquoi pas en m√™me temps master</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">J'entends ce framework depuis longtemps, et j'ai m√™me d√ª travailler un peu avec lui sur un hackathon, donc √† la fin j'ai d√©cid√© de r√©√©crire tout le code sur ROS. </font><font style="vertical-align: inherit;">Cette version du code se trouve dans la branche par d√©faut de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et semble beaucoup plus d√©cente. </font><font style="vertical-align: inherit;">Il est clair que la mise en ≈ìuvre sur ROS sera presque certainement plus lente que la mise en ≈ìuvre sur les flux en raison des frais d'envoi de messages et de tout le reste - la seule question est de savoir combien?</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concept ROS</font></font></b>
                        <div class="spoiler_text">ROS (Robot Operating System) ‚Äî     ,             ,   ,        .<br>
<br>
    ,  ,  ,     (node), ,    ,       .<br>
<br>
      (topic)      (message)  ,         -    . <br>
<br>
    ‚Äî   (service).         ,       ,     .      ¬´ ¬ª,    .<br>
<br>
         <code>.msg</code>  <code>.srv</code> .          .<br>
<br>
 ROS    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> </a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mon robot, je n'ai utilis√© aucun package pr√™t √† l'emploi avec des algorithmes de ROS, j'ai uniquement con√ßu le code du robot dans un package s√©par√© compos√© de cinq n≈ìuds communiquant entre eux √† l'aide de messages et de services ROS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le n≈ìud le plus simple </font></font><code>switch_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,, surveille l'√©tat du commutateur. D√®s que le commutateur est d√©sactiv√©, le n≈ìud commence √† spammer des messages non informatifs du type </font></font><code>bool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la rubrique </font></font><code>terminator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. C'est un signal au n≈ìud principal qu'il est temps de terminer le travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me n≈ìud ,, </font></font><code>sensor_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lit p√©riodiquement les lectures des deux t√©l√©m√®tres IR et les envoie au sujet dans </font></font><code>sensor_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un message. De plus, ce n≈ìud est responsable du traitement du signal: mise √† l'√©chelle par des facteurs d'√©talonnage et moyenne mobile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Troisi√®me n≈ìud</font></font><code>camera_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est responsable de tout ce qui concerne les visages: il prend des images de la cam√©ra, les traite, re√ßoit les r√©sultats du d√©tecteur, les passe √† travers le tracker, puis trouve le visage le plus proche du centre du cadre - le robot n'utilise pas le reste de toute fa√ßon, mais vous voulez faire des messages plus petits. Les messages que le n≈ìud envoie au sujet </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiennent le num√©ro de la trame, le fait d'avoir un visage (car il faut aussi savoir l'absence d'un visage), les coordonn√©es relatives du coin sup√©rieur gauche, la largeur et la hauteur du visage. Voici √† quoi ressemble la description du type de message dans le fichier </font></font><code>DetectionBox.msg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">int64 count<font></font>
bool present<font></font>
float32 x<font></font>
float32 y<font></font>
float32 width<font></font>
float32 height<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le quatri√®me noeud ,, </font></font><code>servo_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est responsable des servos. Premi√®rement, il prend en charge un service </font></font><code>servo_action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui permet √† l'une des actions d'√™tre ex√©cut√©e par les servos par son num√©ro: mettre le n≈ìud entier dans son √©tat initial (sourcils, inclinaison, t√™te, arr√™t du ch√¢ssis); remettre la t√™te dans son √©tat initial; secouez le pot; d√©peindre avec un sourcil l'une des trois expressions (bon, neutre, mal). Deuxi√®mement, en utilisant le service, </font></font><code>servo_speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez d√©finir de nouvelles vitesses pour les deux roues en les envoyant dans la demande. Les deux services ne retournent rien. Enfin, il existe un service </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui vous permet de faire pivoter la t√™te et / ou le ch√¢ssis d'un certain angle par rapport √† la position actuelle. Ce service revient </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'il √©tait possible de tourner la t√™te au moins partiellement, et</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sinon, dans le cas o√π la t√™te est d√©j√† au bord de l'angle admissible, et nous essayons de la tourner encore plus loin. </font><font style="vertical-align: inherit;">Si les deux angles de la demande sont diff√©rents de z√©ro, le service tourne de mani√®re asynchrone, comme indiqu√© ci-dessus. </font><font style="vertical-align: inherit;">Dans la boucle principale, le n≈ìud d'asservissement ne fait rien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici, par exemple, une description du service </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">float32 head_delta<font></font>
float32 platform_delta<font></font>
---<font></font>
bool head_success<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chacun des n≈ìuds r√©pertori√©s prend en charge un service </font></font><code>terminate_{switch, camera, sensor, servo}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une demande de r√©ponse vide, ce qui arr√™te le fonctionnement du n≈ìud. </font><font style="vertical-align: inherit;">Il est mis en ≈ìuvre de cette mani√®re:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Du code</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">...
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">atomic_bool</span> is_running; <span class="hljs-comment">// global</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">terminate_node</span><span class="hljs-params">(std_srvs::Empty::Request &amp;req, std_srvs::Empty::Response &amp;ignored)</span> </span>{<font></font>
    is_running = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{<font></font>
    is_running = <span class="hljs-literal">true</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">while</span> (is_running &amp;&amp; ros::ok()) {
        <span class="hljs-comment">// do stuff</span><font></font>
    }<font></font>
    ...<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le n≈ìud a une variable globale </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dont la valeur d√©termine le cycle principal du n≈ìud. Le service r√©initialise simplement cette variable et la boucle principale est interrompue. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe √©galement un n≈ìud principal </font></font><code>beggar_bot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel la logique de base du robot est impl√©ment√©e. Avant le d√©but de la boucle principale, il s'abonne aux rubriques </font></font><code>sensor_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistre le contenu des messages dans des variables globales dans les fonctions de rappel. Il est √©galement abonn√© au sujet </font></font><code>terminator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dont le rappel r√©initialise l'indicateur </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, interrompant la boucle principale. De plus, avant le d√©but du cycle, le n≈ìud annonce les interfaces pour les services du n≈ìud d'asservissement et attend quelques secondes que les autres n≈ìuds d√©marrent. Une fois la boucle principale termin√©e, ce n≈ìud appelle les services</font></font><code>terminate_{switch, camera, sensor, servo}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, d√©sactivant ainsi tous les autres n≈ìuds, puis le d√©sactivant lui-m√™me. Autrement dit, lorsque le commutateur est d√©sactiv√©, les cinq n≈ìuds terminent l'op√©ration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le passage √† ROS m'a oblig√© √† changer beaucoup la structure du programme. Par exemple, auparavant, il √©tait possible de modifier la vitesse de la roue avec une fr√©quence √©lev√©e, et cela fonctionnait bien, mais le service ROS fonctionne un ordre de grandeur plus lentement, j'ai donc d√ª r√©√©crire le code afin que le service ne soit appel√© que lorsque la vitesse change vraiment (en "mode paresseux"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ROS vous permet √©galement d'ex√©cuter assez commod√©ment tous les n≈ìuds du robot. Pour ce faire, vous devez √©crire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un fichier de lancement .launch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©pertoriant tous les n≈ìuds et autres attributs du robot au format xml, puis ex√©cuter la commande:</font></font><br>
<br>
<pre><code class="plaintext hljs">roslaunch beggar_bot robot.launch</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROS vs pthread</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Maintenant, enfin, vous pouvez comparer la vitesse de la version ROS et de la version pthread. </font><font style="vertical-align: inherit;">Je le fais de cette fa√ßon: le thread / n≈ìud responsable de travailler avec la cam√©ra consid√®re son FPS (comme l'√©l√©ment le plus lent), √† condition que tout le reste fonctionne √©galement. </font><font style="vertical-align: inherit;">Pour la version pthread, j'ai toujours obtenu FPS 9,99 ou plus, pour la version ROS, il s'est av√©r√© environ 8,3. </font><font style="vertical-align: inherit;">En fait, cela suffit pour un tel jouet, mais les frais g√©n√©raux sont assez visibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comportement du robot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e est assez simple: si le robot voit une personne, il doit se diriger vers lui et secouer la bo√Æte. Secouer le pot est assez simple et amusant, mais vous devez d'abord vous rendre √† la personne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une fonction </font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui, s'il y a un visage dans le cadre, fait tourner le ch√¢ssis et la t√™te du robot dans sa direction (seule la face la plus proche du centre est prise en compte). Cela est n√©cessaire pour que le robot garde toujours son cap sur une personne, s'il est dans le cadre, et regarde √©galement directement en face lorsqu'il secoue un pot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√™me variable est utilis√©e </font><font style="vertical-align: inherit;">pour synchroniser cette fonction avec le sujet </font><font style="vertical-align: inherit;">.</font></font><code>face_processed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme dans la version avec flux. L'id√©e est la m√™me: nous voulons traiter les donn√©es une seule fois, car le robot est en mouvement constant. La fonction attend d'abord que le rappel du sujet avec les d√©tections abaisse l'indicateur que la derni√®re trame a √©t√© trait√©e. Pendant qu'elle attend, elle appelle constamment </font></font><code>ros::spinOnce()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour recevoir de nouveaux messages (en g√©n√©ral, cela doit √™tre fait partout o√π le programme attend de nouvelles donn√©es). S'il y a un visage dans le cadre, les angles sont calcul√©s, ce qui n√©cessite de faire pivoter la plate-forme et la t√™te - cela peut √™tre fait en connaissant les coordonn√©es relatives du centre du visage et le champ de vision de la cam√©ra horizontalement et verticalement. Apr√®s cela, vous pouvez appeler le service </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et d√©placer le robot.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un point subtil: les informations sur la position du visage sont en retard sur le mouvement r√©el du visage et peuvent √™tre en retard sur les mouvements du robot lui-m√™me. Par cons√©quent, le robot peut surestimer l'angle de rotation, √† cause duquel la t√™te commence √† se d√©placer d'avant en arri√®re avec une amplitude croissante. Pour √©viter cela, je fais des retards apr√®s le d√©placement (300 ms) et saute √©galement une image apr√®s le d√©placement. Dans le m√™me but, les angles de rotation du ch√¢ssis et de la t√™te sont multipli√©s par un facteur de 0,8 (les composants P du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contr√¥leur PID ont du</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sens </font><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fonction</font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoie le statut d'une personne. </font><font style="vertical-align: inherit;">Une personne peut: √™tre absente, √™tre suffisamment proche du centre, trop √©loign√©e du robot; </font><font style="vertical-align: inherit;">une autre option - lorsque nous avons tourn√© le robot et ne savons pas ce qui est arriv√© au visage (dans le processus de recherche); </font><font style="vertical-align: inherit;">il y a encore un cas rare o√π la t√™te est √† la fronti√®re, c'est pourquoi il est impossible de se tourner vers le visage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une chose assez simple se produit dans la boucle principale:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appelez </font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jusqu'√† ce que la personne ait un certain statut (n'importe lequel, sauf ¬´dans le processus de recherche¬ª). </font><font style="vertical-align: inherit;">√Ä la fin de cette √©tape, le robot regardera directement le visage.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le visage est trouv√© et qu'il est proche: </font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secouez la bo√Æte;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retrouver le visage;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le visage est en place, faites une bonne expression avec les sourcils et secouez √† nouveau le pot;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le visage a disparu, faites une expression de col√®re avec les sourcils;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retournez-vous, allez au d√©but du cycle.</font></font></li>
</ol><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il n'y a personne (ou c'est loin) - navigation dans la pi√®ce:</font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il n'y a pas d'obstacles des deux c√¥t√©s, avancez (si le visage a √©t√© trouv√©, mais s'est av√©r√© trop √©loign√©, le robot ira vers la personne);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si les obstacles sont proches des deux c√¥t√©s, faites un tour al√©atoire dans la plage </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x222A;</mo><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>180</mn><mo>,</mo><mo>&amp;#x2212;</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.479ex" height="2.634ex" viewBox="0 -809.3 9678.3 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2C" x="1279" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5D" x="3226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-222A" x="3726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5B" x="4616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2212" x="4895" y="0"></use><g transform="translate(5673,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2C" x="7175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2212" x="7620" y="0"></use><g transform="translate(8398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5D" x="9399" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy="false">]</mo><mo>‚à™</mo><mo stretchy="false">[</mo><mo>‚àí</mo><mn>180</mn><mo>,</mo><mo>‚àí</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">[90, 180] \cup [-180, -90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si l'obstacle n'est que d'un c√¥t√©, tournez dans la direction oppos√©e √† un angle al√©atoire </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0</mn><mo>,</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.815ex" height="2.634ex" viewBox="0 -809.3 2503.7 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2C" x="779" y="0"></use><g transform="translate(1224,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5D" x="2225" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">[0, 90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le mouvement vers l'avant continue trop longtemps (peut-√™tre bloqu√©), reculez un peu et faites un tour al√©atoire dans la plage </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x222A;</mo><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>180</mn><mo>,</mo><mo>&amp;#x2212;</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.479ex" height="2.634ex" viewBox="0 -809.3 9678.3 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2C" x="1279" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5D" x="3226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-222A" x="3726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5B" x="4616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2212" x="4895" y="0"></use><g transform="translate(5673,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2C" x="7175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-2212" x="7620" y="0"></use><g transform="translate(8398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiWyMxQAxdtoLQjmCT2bvACqUgbwQ#MJMAIN-5D" x="9399" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy="false">]</mo><mo>‚à™</mo><mo stretchy="false">[</mo><mo>‚àí</mo><mn>180</mn><mo>,</mo><mo>‚àí</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">[90, 180] \cup [-180, -90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></li>
</ol><br>
 </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet algorithme ne pr√©tend pas √™tre une forte intelligence artificielle, cependant, un comportement al√©atoire et un large pare-chocs permettent au robot de se lever de presque n'importe quelle position t√¥t ou tard.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgr√© son apparente simplicit√©, ce projet couvre de nombreux sujets non triviaux: travail avec capteurs analogiques, travail avec PWM, vision par ordinateur, coordination des t√¢ches asynchrones. </font><font style="vertical-align: inherit;">De plus, c'est juste incroyablement amusant. </font><font style="vertical-align: inherit;">Probablement, plus loin, je ferai quelque chose de plus significatif, mais plus avec un parti pris dans l'apprentissage profond. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En bonus - la galerie:</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/el/cw/jd/elcwjdoa21liogjvhakstzg-yru.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/il/12/fp/il12fpucbbreblnwyb2ojwsfmwu.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/3w/kr/7m/3wkr7mfjqjo2b_f9kvekia82ztq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/z4/3q/wr/z43qwrmlfgwndbi3dw-jnvxzqew.jpeg"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr500140/index.html">"Jusqu'√† 10 mille": plus de 25 avis sur les √©couteurs</a></li>
<li><a href="../fr500142/index.html">G√©rer les droits au niveau de l'installation</a></li>
<li><a href="../fr500144/index.html">David O'Brien (Xirus): Mesures! M√©trique! M√©trique! Partie 1</a></li>
<li><a href="../fr500146/index.html">Recherche d'emploi en Allemagne en tant que chef de produit et plus encore. Partie 3/5. Ce que vous devez faire avant de commencer √† envoyer des CV</a></li>
<li><a href="../fr500148/index.html">Filtre pare-feu Mikrotik: script g√©n√©rant la base d'une politique de filtrage</a></li>
<li><a href="../fr500152/index.html">Comment j'ai int√©gr√© POS-terminal et FR IKKM-Touch dans 1C: entreprise</a></li>
<li><a href="../fr500154/index.html">Apprentissage automatique confidentiel. Biblioth√®que PySyft</a></li>
<li><a href="../fr500158/index.html">Interaction de SwiftUI avec Redux</a></li>
<li><a href="../fr500160/index.html">√âl√©ments visuels</a></li>
<li><a href="../fr500162/index.html">Super tutoriel de traitement de donn√©es sportives python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>