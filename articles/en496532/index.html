<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåè ü§üüèª üöß We check on ourselves: how to deploy and how to administer 1C: Document flow within the 1C company ‚ñ∂Ô∏è üö¶ üéÖüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We at 1C widely use our own developments to organize the work of the company. In particular, ‚Äú1C: Document Management 8‚Äù . In addition to document man...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>We check on ourselves: how to deploy and how to administer 1C: Document flow within the 1C company</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/1c/blog/496532/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We at 1C widely use our own developments to organize the work of the company. In particular, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äú1C: Document Management 8‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In addition to document management (as the name implies), it is also a modern </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECM-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> system (Enterprise Content Management - corporate content management) with a wide range of functionalities - mail, employee work calendars, organization of shared access to resources (for example, booking conference rooms), accounting working hours, corporate forum and much more. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At 1C, more than a thousand employees use documents. The database has already become impressive (11 billion records), which means that it requires more thorough maintenance and more powerful equipment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How the work of our system is arranged, what difficulties we face in servicing the database, and how we solve them (we use MS SQL Server as the DBMS), we will describe in the article. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For those who first read about 1C products. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1C: Document management is an application solution (configuration) implemented on the basis of a framework for developing business applications - 1C: Enterprise platform.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/5a/ts/rb/5atsrbr1r_0dfqiyrdimcyze4by.png" alt="image"><br>
<br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Äú1C: Document Management 8‚Äù (in abbreviated form - DO) allows you to automate the work with documents at the enterprise. </font><font style="vertical-align: inherit;">One of the main tools for employee interaction is email. </font><font style="vertical-align: inherit;">In addition to mail, DO also solves other tasks:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time tracking</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accounting for absences</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Applications for couriers / transport</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Employee Calendars</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registration of correspondence</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Employee Contacts (Address Book)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corporate forum</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Room reservation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Event planning</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRM</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collective work with files (with preserving file versions)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and etc. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We enter Document Management as a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thin client</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (native executable application) from Windows, Linux, macOS, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">web client</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (from browsers) and a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mobile client</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - depending on the situation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And thanks to our other product connected to the Document Management - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Interaction System</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- we directly in the Document Management receive the messenger functionality - chats, audio and video calls (including group calls, which has now become especially important, including from a mobile client), quick file sharing plus the ability to write chat bots that simplify working with the system. Another plus from using the Interaction System (in comparison with other messengers) is the ability to conduct contextual discussions tied to specific objects of the Document Management - documents, events, etc. That is, the Interaction System integrates deeply with the target application, and does not act as a ‚Äúseparate button‚Äù.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The number of letters in our DL has already exceeded 100 million, and in general in the DBMS - more than 11 billion records. </font><font style="vertical-align: inherit;">In total, the system uses almost 30 TB of storage: the database is 7.5 TB, files for collective work are separate and occupy another 21 TB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk about more specific numbers, then here is the number of letters and files at the moment:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outgoing letters - 14.7 million.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incoming letters - 85.4 million</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File Versions - 70.8 Million</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internal documents - 30.6 thousand</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In DO there is not only mail and files. </font><font style="vertical-align: inherit;">Below are the numbers of other accounting objects:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conference room reservation - 52 126</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weekly reports - 153,940</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daily reports - 628 153</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visa approval - 11,821</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incoming documents - 79 677</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outgoing documents - 28 357</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Records of events in the working calendars of users - 168,228</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Applications for couriers - 21 883</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Counterparties - 81 029</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Records of work with contractors - 45 632</font></font></li>
<li>   ‚Äì 41 795</li>
<li> ‚Äì 10 243</li>
<li> ‚Äì 6 320</li>
<li>  ‚Äì 245 980</li>
<li>   ‚Äì 26 282</li>
<li>   ‚Äì 891 095</li>
<li>- ‚Äì 109 056.       ‚Äì , , , ,   ..     ,  ,  ,  ,     .      ,  ,           .</li>
</ul><br>
<h2>      ?</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These figures indicate an impressive amount of tasks, so we faced the need to allocate fairly productive equipment for the needs of internal subsidiaries. </font><font style="vertical-align: inherit;">To date, its characteristics are as follows: 38 cores, 240 GB of RAM, 26 TB drives. </font><font style="vertical-align: inherit;">We </font></font><br>
<img src="https://habrastorage.org/webt/lt/l1/8t/ltl18tfpfsmxrdo8drblk-04r2o.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
give the </font><font style="vertical-align: inherit;">table of servers: </font><font style="vertical-align: inherit;">In the future we plan to increase the capacity of the equipment.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What about server loading?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Network activity has never been a problem for us or our customers. As a rule, the weak point is the processor and disks, because everyone already knows how to deal with a lack of memory. Here are screenshots of our servers from Resource Monitor, which show that we have no terrible load, it is very modest. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, in the screenshot below, we see an SQL server where the CPU is 23% loaded. And this is a very good indicator (for comparison: if the load approaches 70%, then, most likely, employees will observe quite significant slowdowns). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vz/-w/oo/vz-woobphp0n1zll7bnpvwlxflk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second screenshot shows the application server on which the 1C: Enterprise platform runs - it only serves user sessions. Here the processor load is slightly higher - 38%, it is smooth and calm. There is disk loading, but it is acceptable.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/qd/uv/bzqduvuuvjk4i0dchiimfrauum0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The third screenshot shows another 1C: Enterprise server (it is the second, we have two of them in the cluster). </font><font style="vertical-align: inherit;">Only the previous one serves users, and robots work on this. </font><font style="vertical-align: inherit;">For example, they receive mail, route documents, exchange data, consider rights, etc. </font><font style="vertical-align: inherit;">All these background activities perform approximately 90-100 background tasks. </font><font style="vertical-align: inherit;">And this server is very busy - at 88%. </font><font style="vertical-align: inherit;">But this does not affect people, and it implements just all the automation that Document Management should do.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fi/k7/o3/fik7o3yrdbucybkekjymjrgq1aa.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What are the metrics to determine performance?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have built into the BS a serious subsystem for measuring performance indicators and computing various metrics. </font><font style="vertical-align: inherit;">This is necessary in order to understand at the current moment of time and in the historical perspective what is happening in the system, what is getting worse, what is getting better. </font><font style="vertical-align: inherit;">Monitoring tools - metrics and measurements of time - are included in the standard package "1C: Document Management 8". </font><font style="vertical-align: inherit;">Metrics require tuning on implementation, but the mechanism itself is typical. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metrics are measurements of various business indicators at certain points in time (for example, average mail delivery time at the moment of 10 minutes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the metrics shows the number of active users in the database. </font><font style="vertical-align: inherit;">On average, there are 1000-1400 of them per day. </font><font style="vertical-align: inherit;">The graph shows that at the time of the screenshot there were 2144 active users in the database.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pr/ca/is/prcaismpjrysr1jm8pr3m77w4j8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are more than 30 such actions, the list is under the cut.</font></font><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List</font></font></b><div class="spoiler_text"><ul>
<li>  </li>
<li>  </li>
<li> </li>
<li>  </li>
<li>  </li>
<li>  </li>
<li>   </li>
<li>  </li>
<li> </li>
<li> </li>
<li>  </li>
<li> </li>
<li> </li>
<li> </li>
<li>  </li>
<li> </li>
<li> </li>
<li> </li>
<li></li>
<li></li>
<li> </li>
<li></li>
<li>  </li>
<li> </li>
<li>  </li>
<li> </li>
<li>    </li>
<li>  </li>
<li>  </li>
<li></li>
<li> </li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The week before last, our average user activity increased one and a half times (the graph shows in red) - this is due to the transition of most employees to remote work (in connection with known events). Also, the number of active users increased by 3 times (shown in blue on the screen), as employees began to actively use mobile: each mobile client creates a connection to the server. Now, on average, for each of our employees, there are 2 connections to the server.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/la/oy/_plaoyah-fhvkshuadl9ftidsty.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For us, as for administrators, this is a signal that we need to be more attentive to issues of speed, to see if it has become worse. And we look at it in other ways. For example, how mail delivery time for internal routing changes (the screenshot below shows blue). We see that it jumped until this year, and now it is stable - for us it is an indicator that everything is in order with the system. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ws/-j/es/ws-jes5n002oaglztg92x6rhc70.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another applied metric for us is the average waiting time for downloading letters from the mail server (shown in red in the screenshot). Roughly speaking, how long will the letter go on the Internet before it comes to our employee. The screenshot shows that this time has also not changed in any recent way. There are separate outbursts - but they are associated not with delays, but with the fact that time gets lost on mail servers.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e-/tq/yk/e-tqykeehhyd-ztfieowpmodpro.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or, for example, another metric (shown in blue in the screenshot) - updating letters in a folder. Opening a mail folder is a very common operation, and it needs to be done quickly. We measure how fast it is being performed. This indicator is measured for each client. You can see the overall picture of the company, and the dynamics, for example, of an individual employee. The screenshot shows that until this year the metric was unbalanced, then we made a number of improvements, and now it does not get worse - an almost even schedule. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w-/ew/ay/w-eway3c2wyaubpqk1onjq4ptjm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metrics are basically an administrator‚Äôs tool for monitoring the system, for quickly responding to any changes in the behavior of the system. On a screenshot - metrics of internal DO for a year. The jump in the graphs is due to the fact that we have been set the task of developing internal subsidiaries.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fj/pt/d1/fjptd1wgq42u1dpgl6p96cwuwv4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is a list of some more metrics (under the cut).</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metrics</font></font></b><div class="spoiler_text"><ul>
<li> </li>
<li> </li>
<li> </li>
<li> </li>
<li>  ()</li>
<li> </li>
<li>    </li>
<li> </li>
<li> </li>
<li>          10 </li>
<li>  :  </li>
<li>    </li>
<li> </li>
<li> </li>
<li>      </li>
<li>      ( )</li>
<li>      ( )</li>
<li>      ( )</li>
<li>      ( )</li>
<li>      ()</li>
<li>  </li>
<li>  </li>
<li>  ¬´    ¬ª</li>
<li>    </li>
<li>   </li>
<li>    </li>
<li>   </li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our system makes measurements of more than 150 indicators around the clock, but not all of them can be quickly monitored. </font><font style="vertical-align: inherit;">They can come in handy later, in some historical perspective, and you can focus on the most important for business.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At one of the implementations, for example, only 5 indicators were selected. The customer set himself the goal of making a minimum set of indicators, but at the same time such that he covered the main scenarios of work. It would be unjustified to include 150 indicators in the act of acceptance, because even within the enterprise it is difficult to agree on which indicators are considered acceptable. And they knew about these 5 indicators and already presented them to the system before the start of the implementation project, including in the tender documentation: card opening time no more than 3 seconds, task execution time with a file no more than 5 seconds, etc. In our subsidiaries, there were precisely metrics that very clearly reflected the initial request from the customer‚Äôs requirements.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And we also have a profile analysis of performance measurements. </font><font style="vertical-align: inherit;">Performance indicators are the fixation of the duration of each operation that is performed (writing a letter to the database, sending a letter to the mail server, etc.) </font><font style="vertical-align: inherit;">It is used exclusively by technical specialists. </font><font style="vertical-align: inherit;">We have a lot of performance indicators in our program. </font><font style="vertical-align: inherit;">We now measure approximately 1,500 key operations, which are broken down by profile. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/kw/ht/kpkwhtmfno5e6log8ozegzltuie.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the most important profiles for us is the ‚ÄúList of key indicators of mail from the point of view of consumers‚Äù. </font><font style="vertical-align: inherit;">This profile includes, for example, the following indicators:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Command Execution: Filter by Tag</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opening a form: List form</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Command Execution: Select by Folder</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Display letters in the reading area</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saving a letter to your favorite folder</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search letters by details</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create a letter</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we see that the metric for some business indicator has become too large (for example, letters from a specific user began to arrive for a very long time), we begin to understand, turn to measuring the time of technical operations. </font><font style="vertical-align: inherit;">We have the technical operation ‚ÄúArchiving letters on the mail server‚Äù - we see the excess of time for this operation for the last period. </font><font style="vertical-align: inherit;">This operation, in turn, decomposes into other operations ‚Äî for example, establishing a connection to the mail server. </font><font style="vertical-align: inherit;">We see that for some reason it suddenly became very large (we have all the measurements in a month - we can compare that last week 10 milliseconds, and now 1000 milliseconds). </font><font style="vertical-align: inherit;">And we understand that something here is broken - we need to fix it.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How do we maintain such a large database?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our internal DO is an example of a really working highly loaded project. </font><font style="vertical-align: inherit;">Let's talk about the technical features of its database.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How long is the restructuring of large database tables?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SQL server requires periodic maintenance, cleaning up the tables. </font><font style="vertical-align: inherit;">In a good way, this should be done at least once a day, and for highly demanded tables - even more often. </font><font style="vertical-align: inherit;">But if the base is large (and our number of records has already exceeded 11 billion), then it‚Äôs not easy to take care of it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We did the restructuring of the tables 6 years ago, but then it began to take so much time that we no longer fit into the nightly intervals. </font><font style="vertical-align: inherit;">And since these operations heavily load the SQL server, it cannot provide quality services to other users.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, now we have to apply various tricks. For example, we cannot perform these procedures on complete data sets. You have to resort to the Update Sample 500000 rows procedure - this takes 14 minutes. It does not update statistics for all the data in the table, but selects half a million rows, and calculates statistics from them that it uses for the entire table. This is some assumption, but we are forced to go for it, because for a particular table the collection of statistics for the entire billion records will be unacceptably long. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dl/mq/9q/dlmq9qvlqsafte96p7yjhllxegm.png" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also optimized other maintenance operations by making them partial.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenance of a DBMS is generally a difficult task. </font><font style="vertical-align: inherit;">In the case of active interaction between employees, the database is growing rapidly, it is becoming increasingly difficult for administrators to maintain it - updating statistics, defragmenting, and indexing. </font><font style="vertical-align: inherit;">Here we need to apply different strategies, we well know how to do this, we have experience, we can share it.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How is backup implemented with such volumes?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A full backup of the DBMS is performed once a day at night, incremental - every hour. </font><font style="vertical-align: inherit;">Also, a file directory is created every day, and it is a portion of the incremental backup of the file storage.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How long does a full backup take?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On a hard disk, a full backup is performed in three hours, partial - in an hour. </font><font style="vertical-align: inherit;">It takes longer to write to the tape (a special device that backs up to a special cassette stored outside the office; an alienable copy is made to the tape, which will be saved if, for example, the server burns out). </font><font style="vertical-align: inherit;">The backup is done exactly on the same server, whose parameters were higher - SQL-server with 20% processor load. </font><font style="vertical-align: inherit;">At the time of backup, of course, the system becomes much worse, but it is still operational.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xq/sb/6j/xqsb6jqlw7y8fg5pgpwwhghhm74.png" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is there deduplication?</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is file </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">deduplication</font></a><font style="vertical-align: inherit;"> , we run it on ourselves, and soon it will be included in the new version of Document Management. </font><font style="vertical-align: inherit;">We also run on the counterparty deduplication mechanism. </font><font style="vertical-align: inherit;">There is no deduplication of records at the DBMS level, since this is not necessary. </font><font style="vertical-align: inherit;">The 1C: Enterprise platform stores objects in the DBMS, and only the platform can be responsible for their consistency.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Are there read-only nodes?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are no nodes for reading (dedicated system nodes that serve those who need to receive any reading data). </font><font style="vertical-align: inherit;">DO is not an accounting system to put on a separate BI node, but there is a separate node for the development department, which is exchanged with messages in JSON format, and typical replication times are units and tens of seconds. </font><font style="vertical-align: inherit;">The node is still small, it has about 800 million entries, but it is growing rapidly.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And messages marked for deletion are not deleted at all?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not yet. </font><font style="vertical-align: inherit;">We have no tasks to facilitate the base. </font><font style="vertical-align: inherit;">There were several rather serious cases when I had to turn to letters marked for deletion, including 2009. </font><font style="vertical-align: inherit;">Therefore, for now, we decided to keep everything. </font><font style="vertical-align: inherit;">But when the cost of this becomes unjustified, we will think about removal. </font><font style="vertical-align: inherit;">But, if you need to remove a separate letter from the database with the ends so that there are no traces, then this can be done by special request.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why store it? </font><font style="vertical-align: inherit;">Are there statistics on accesses to old documents?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are no statistics. </font><font style="vertical-align: inherit;">More precisely, it is in the form of a user log, but it is not stored for long. </font><font style="vertical-align: inherit;">Records older than a year are deleted from the protocol. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There were situations when it was necessary to raise the old correspondence of five years or even ten years ago. </font><font style="vertical-align: inherit;">And this has always been done not out of idle curiosity, but for making complex business decisions. </font><font style="vertical-align: inherit;">There was a case when without the history of correspondence the wrong business decision would be made.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How is the examination of the value and destruction of documents according to the storage period?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For paper documents, this is done in the usual traditional way, like everyone else. </font><font style="vertical-align: inherit;">For electronic we don‚Äôt do it - let it be stored. </font><font style="vertical-align: inherit;">The sit is here. </font><font style="vertical-align: inherit;">There is a benefit. </font><font style="vertical-align: inherit;">All is well.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What are the development prospects?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now our DO solves about 30 internal problems, some of which we listed at the beginning of the article. </font><font style="vertical-align: inherit;">Also DO is used to prepare conferences that we hold twice a year for our partners: the entire program, all reports, all parallel sections, halls - all this is made up in DO, and then it is downloaded from it, and a printed program is made. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the way for DO there are several more tasks, besides those that he already solves. </font><font style="vertical-align: inherit;">There are company-wide tasks, but there are unique and rare tasks that are needed only by any particular unit. </font><font style="vertical-align: inherit;">It is necessary to help them, and therefore, to expand the "geography" of using the system inside 1C - to expand the scope, solve the tasks of all departments. </font><font style="vertical-align: inherit;">This would be the best test for performance and reliability. </font><font style="vertical-align: inherit;">I would like to see the system work on trillions of records, petabytes of information.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496512/index.html"># 05 - And a whole byte is not enough ... | Anime</a></li>
<li><a href="../en496514/index.html">IPIP IPsec VPN tunnel between Linux machine and Mikrotik behind NAT provider</a></li>
<li><a href="../en496516/index.html">Telegram bot in python vs COVID-19</a></li>
<li><a href="../en496518/index.html">How did we get to the remote</a></li>
<li><a href="../en496528/index.html">Localization of a QR code is an important task, undeservedly deprived of attention</a></li>
<li><a href="../en496536/index.html">DeepCode: side view</a></li>
<li><a href="../en496538/index.html">Fractals in Python. Walkthrough</a></li>
<li><a href="../en496542/index.html">Internet traffic in Europe has grown one and a half times. Backbone providers record load records</a></li>
<li><a href="../en496544/index.html">Online hackathon of projects for self-employed: 500 thousand rubles for their ideas and support from the Federal Tax Service</a></li>
<li><a href="../en496546/index.html">Startup inside the corporation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>