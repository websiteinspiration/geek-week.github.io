<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧒🏻 🥘 🕓 Ser "novo" ou não ser ... 🛌 🤦🏽 🏊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá de novo. Antecipando o início dos cursos básicos e avançados de desenvolvimento para Android, preparamos para você outra tradução interessante.
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ser "novo" ou não ser ...</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/494826/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olá de novo. Antecipando o início dos </font><font style="vertical-align: inherit;">cursos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">básicos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avançados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de desenvolvimento para Android, preparamos para você outra tradução interessante.</font></font><br>
</i></b><br>
<br>
<img src="https://habrastorage.org/webt/hs/u-/yp/hsu-ypxo7-folltm3lmhdm9p91w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A injeção de dependência exige</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que separemos os </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operadores </font><font style="vertical-align: inherit;">e a lógica do aplicativo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Essa separação incentiva você a usar</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fábricas em seu código responsáveis ​​por vincular seu aplicativo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No entanto, em vez de escrever fábricas, preferimos usar</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a injeção automática de dependência</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , como o GUICE, para assumir o vínculo. Mas a injeção de dependência pode realmente nos salvar de todos os</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> novos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operadores</font><font style="vertical-align: inherit;">?</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos olhar para dois extremos. Digamos que você tenha uma classe MusicPlayer que deve obter o AudioDevice. Aqui, queremos usar a injeção de dependência e solicitar um AudioDevice no construtor MusicPlayer. Isso nos permitirá adicionar um AudioDevice fácil de testar, que podemos usar para afirmar que o som correto sai do nosso MusicPlayer. Se usarmos o novo operador para criar uma instância do BuiltInSpeakerAudioDevice, teremos algumas dificuldades de teste. Então, vamos chamar objetos como AudioDevice ou MusicPlayer de "Injectable". Injetáveis ​​são os objetos que você solicitará nos construtores e espera que a estrutura para implementar dependências os forneça.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, para o outro extremo. Suponha que você tenha um int int primitivo, mas deseja empacotá-lo automaticamente em Inteiro, o mais simples é chamar o novo Inteiro (5), e esse é o fim. Mas se a injeção de dependência é o novo "novo", por que chamamos de novo em linha? Isso prejudicará nossos testes? Acontece que as estruturas para injetar dependências não podem fornecer o número inteiro necessário, porque eles não entendem que tipo de número inteiro é. Este é um exemplo de brinquedo, então vamos ver algo mais complexo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que um usuário tenha inserido um endereço de email no campo de login e você precise ligar para um novo email (</font></font><code>«a@b.com»</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Podemos deixar assim ou devemos solicitar e-mail em nosso construtor? Novamente, a estrutura de injeção de dependência não pode fornecer Email, porque você deve primeiro obter a String na qual o email está localizado. E há muitas String s para escolher. Como você pode ver, existem muitos objetos que a estrutura de injeção de dependência nunca pode fornecer. Vamos chamá-los de "Novo", pois você será forçado a chamar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> manualmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, vamos definir algumas regras básicas. Uma classe injetável pode consultar outro injetável em seu construtor. (Às vezes, chamo de Injetável como um Objeto de Serviço, mas esse termo está sobrecarregado.) Injetáveis ​​tendem a ter interfaces, pois há uma chance de termos que substituí-las por uma implementação que seja conveniente para o teste. No entanto, Injectable nunca pode consultar não-Injetável (Newable) em seu construtor. Isso ocorre porque a estrutura de injeção de dependência não sabe como criar um Newable. Aqui estão alguns exemplos de classes que eu esperaria da minha estrutura de injeção de dependência: CreditCardProcessor, MusicPlayer, MailSender, OfflineQueue. Da mesma forma, Newable pode ser solicitado por outro Newable em seu construtor, mas não injetável (às vezes eu chamo Newable como um objeto de valor, mas, novamente,este termo está sobrecarregado). Alguns exemplos de Newable: Email, MailMessage, User, CreditCard, Song. Se você seguir essas distinções, seu código será fácil de testar e trabalhar. Se você violar essas regras, seu código será difícil de testar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos o exemplo do MusicPlayer e Song</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Song</span> </span>{<font></font>
  Song(String name, <span class="hljs-keyword">byte</span>[] content);<font></font>
}<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MusicPlayer</span> </span>{
  <span class="hljs-meta">@Injectable</span><font></font>
  MusicPlayer(AudioDevice device);<font></font>
  play(Song song);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que a música consulta apenas objetos que são renováveis. </font><font style="vertical-align: inherit;">Isso facilita muito a instanciação de uma música em um teste. </font><font style="vertical-align: inherit;">O MusicPlayer é completamente injetável, como o argumento AudioDevice, e pode ser obtido a partir da estrutura para injeção de dependência. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos ver o que acontece se o MusicPlayer quebrar a regra e solicitar Newable em seu construtor.</font></font><br>
 <br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Song</span> </span>{<font></font>
  String name;<font></font>
  <span class="hljs-keyword">byte</span>[] content;<font></font>
  Song(String name, <span class="hljs-keyword">byte</span>[] content);<font></font>
}<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MusicPlayer</span> </span>{<font></font>
  AudioDevice device;<font></font>
  Song song;<font></font>
  <span class="hljs-meta">@Injectable</span><font></font>
  MusicPlayer(AudioDevice device, Song song);<font></font>
  play();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, a música ainda é renovável e é fácil criar no seu teste ou no seu código. O MusicPlayer já é um problema. Se você solicitar ao MusicPlayer de sua estrutura a injeção de dependência, ela falhará porque a estrutura não saberá sobre qual música é. A maioria das pessoas novas nas estruturas de injeção de dependência raramente comete esse erro, pois é fácil perceber: seu código não funcionará. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos ver o que acontece se o Song quebra a regra e solicita o Injetável em seu construtor.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MusicPlayer</span> </span>{<font></font>
  AudioDevice device;<font></font>
  <span class="hljs-meta">@Injectable</span><font></font>
  MusicPlayer(AudioDevice device);<font></font>
}<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Song</span> </span>{<font></font>
  String name;<font></font>
  <span class="hljs-keyword">byte</span>[] content;<font></font>
  MusicPlayer palyer;<font></font>
  Song(String name, <span class="hljs-keyword">byte</span>[] content, MusicPlayer player);<font></font>
  play();<font></font>
}<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SongReader</span> </span>{<font></font>
  MusicPlayer player<font></font>
  <span class="hljs-meta">@Injectable</span><font></font>
  SongReader(MusicPlayer player) {<font></font>
    <span class="hljs-keyword">this</span>.player = player;<font></font>
  }<font></font>
  <span class="hljs-function">Song <span class="hljs-title">read</span><span class="hljs-params">(File file)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Song(file.getName(),<font></font>
                    readBytes(file),<font></font>
                    player);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À primeira vista, está tudo bem. Mas pense em como as músicas serão criadas. Presumivelmente, as músicas são armazenadas em disco, por isso precisamos do SongReader. O SongReader precisará solicitar o MusicPlayer para que, ao chamar um novo Song, ele possa satisfazer as dependências da música no MusicPlayer. Você notou alguma coisa errada aqui? Que susto o SongReader precisa saber sobre o MusicPlayer? Isso é uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">violação da lei de Demeter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O SongReader não deve saber sobre o MusicPlayer. Pelo menos porque o SongReader não chama métodos com o MusicPlayer. Ele só conhece o MusicPlayer porque o Song violou a separação Newable / Injectable. O SongReader paga pelo erro na música. Como o local onde o erro é cometido e onde as conseqüências são manifestadas não é a mesma coisa, esse erro é muito sutil e difícil de diagnosticar. Isso também significa que muitas pessoas provavelmente cometerão esse erro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em termos de teste, isso é uma verdadeira dor. Suponha que você tenha o SongWriter e deseje garantir a serialização da música no disco corretamente. Você precisa criar um MockMusicPlayer para poder passá-lo para o Song, para passá-lo ao SongWritter. Por que encontramos o MusicPlayer aqui? Vamos olhar para o outro lado. A música é o que você pode querer serializar, e a maneira mais fácil de fazer isso é usar a serialização Java. Assim, serializamos não apenas a música, mas também o MusicPlayer e o AudioDevice. Nem o MusicPlayer nem o AudioDevice devem ser serializados. Como você pode ver, pequenas alterações facilitam bastante a testabilidade.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você pode ver, trabalhar com código é mais fácil se separarmos esses dois tipos de objetos. Se você os misturar, será difícil testar seu código. Novos são os objetos que estão no final do gráfico de objetos do seu aplicativo. O recurso Newable pode depender de outro Newable, por exemplo, como o CreditCard pode depender do Endereço, que pode depender da Cidade - essas são folhas do gráfico do aplicativo. Como são folhas e não se comunicam com nenhum serviço externo (serviços externos são injetáveis), eles não precisam fazer stubs. Nada se parece mais com String do que a própria String. Por que devo fazer um stub para o Usuário, se posso apenas chamar um novo Usuário, por que fazer stubs para algo disso: Email, MailMessage, User, CreditCard, Song? Apenas chame de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e termine.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos prestar atenção a algo muito sutil. </font><font style="vertical-align: inherit;">É normal que o Newable saiba sobre o Injetável. </font><font style="vertical-align: inherit;">O que não é normal é que Newable tem uma referência a Injectable como um campo. </font><font style="vertical-align: inherit;">Em outras palavras, a Song pode saber sobre o MusicPlayer. </font><font style="vertical-align: inherit;">Por exemplo, é normal que o Injectable MusicPlayer seja passado pela pilha para Newable Song. </font><font style="vertical-align: inherit;">Porque a passagem pela pilha é independente da estrutura para injeção de dependência. </font><font style="vertical-align: inherit;">Como neste exemplo:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Song</span> </span>{<font></font>
  Song(String name, <span class="hljs-keyword">byte</span>[] content);
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPlayable</span><span class="hljs-params">(MusicPlayer player)</span></span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O problema ocorre quando a música possui um campo de link para o MusicPlayer. </font><font style="vertical-align: inherit;">Os campos de link são definidos pelo construtor, o que causará uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">violação da lei Demeter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o chamador e dificuldades para nossos testes.</font></font><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saiba mais sobre os cursos</font></font></h4><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desenvolvedor Android. </font><font style="vertical-align: inherit;">Curso básico</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desenvolvedor Android. </font><font style="vertical-align: inherit;">Curso avançado</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt494810/index.html">Introdução ao 3D: conceitos básicos do Three.js</a></li>
<li><a href="../pt494814/index.html">Slurm é útil?</a></li>
<li><a href="../pt494818/index.html">Como escolher um terminal de negociação para trabalhar na bolsa</a></li>
<li><a href="../pt494820/index.html">Como a especificação da fonte de alimentação ATX12VO da Intel mudará o futuro</a></li>
<li><a href="../pt494824/index.html">Como é organizado o sistema de conteúdo das páginas Turbo: esquemas, fatos e um pouco de história</a></li>
<li><a href="../pt494830/index.html">ViennaNET: um conjunto de bibliotecas para o back-end</a></li>
<li><a href="../pt494838/index.html">Modems GSM / 3G / 4G em sistemas embarcados usando o modem Quectel EC21 LTE e o Yocto Project como exemplo</a></li>
<li><a href="../pt494848/index.html">15 mulheres que deram uma grande contribuição à astronomia</a></li>
<li><a href="../pt494850/index.html">Configure o Microsoft Windows Server 2016/2019 para fornecer serviços DHCP para VXLAN (DFA)</a></li>
<li><a href="../pt494854/index.html">Semana 14 de segurança: privacidade pandêmica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>