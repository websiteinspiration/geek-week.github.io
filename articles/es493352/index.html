<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéì üéª üßëüèΩ‚Äçü§ù‚Äçüßëüèº Transmite tus videos en YouTube las 24 horas ‚öæÔ∏è üêª üêì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, como hobby, estoy filmando las conferencias de un psic√≥logo familiar en video. Monto y publico las im√°genes en mi sitio web. Hace un me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Transmite tus videos en YouTube las 24 horas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493352/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recientemente, como hobby, estoy filmando las conferencias de un psic√≥logo familiar en video. Monto y publico las im√°genes en mi sitio web. Hace un mes, tuve la idea de organizar una transmisi√≥n las 24 horas del d√≠a de estas conferencias en YouTube 24/7. Una especie de "canal" tem√°tico dedicado al crecimiento personal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥mo hacer una transmisi√≥n normal, lo s√©. Pero, ¬øc√≥mo convertirlo en una transmisi√≥n de archivos de video? Que caminaba las 24 horas, los 7 d√≠as de la semana, era flexible, lo m√°s aut√≥noma posible y, al mismo tiempo, no depend√≠a de la computadora de mi casa. Esto fue lo que tuve que averiguar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/vn/5u/tivn5utlpr-vmldtf9dh5hh7fku.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tard√≥ varios d√≠as en encontrar una soluci√≥n. Estudi√© muchos foros y varios manuales sin los cuales mi transmisi√≥n simplemente no hubiera resultado. Y ahora, cuando la broma es un √©xito, siento la necesidad de compartir mi decisi√≥n. Entonces apareci√≥ este art√≠culo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En resumen, la soluci√≥n final fue la siguiente: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS + ffmeg + bash script</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Debajo del corte, describo los pasos dados y hablo sobre los "escollos" que se descubrieron durante la transmisi√≥n.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paso 1: ¬øde d√≥nde ir√° la transmisi√≥n?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al principio, era necesario determinar d√≥nde se llevar√° a cabo la transmisi√≥n, d√≥nde estar√° su fuente. Lo primero que me vino a la mente fue </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desde una computadora en casa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Recopile videos en una lista de reproducci√≥n y reprod√∫zcalos en cualquier reproductor de video. Luego captura la imagen de la pantalla y transm√≠tela a YouTube. Pero casi inmediatamente descart√© esta opci√≥n. Para implementarlo, debe mantener la computadora de su hogar constantemente encendida, y este es el ruido de los refrigeradores incluso de noche y el aumento del consumo de energ√≠a (+ 100-150 kWh cada mes). Y resulta que no podr√° usar la computadora de su hogar durante la transmisi√≥n. cualquier movimiento del mouse ser√° visible en la transmisi√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces comenc√© a mirar hacia </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los servicios en la nube</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Estaba buscando un servicio listo para usar en el que pudiera subir sus videos o, por ejemplo, insertar enlaces a videos de YouTube y todo se incluir√≠a en una transmisi√≥n continua. Pero no encontr√© nada adecuado. Quiz√°s me estaba mirando mal. Lo √∫nico adecuado para la funcionalidad es restream.io, un servicio que ayuda a transmitir simult√°neamente en m√∫ltiples plataformas. Parece que pueden subir sus videos. Pero este servicio fue creado para prop√≥sitos completamente diferentes y esperan que la transmisi√≥n dure solo un par de horas. Creo que si a trav√©s de este servicio hubiera sido posible organizar una transmisi√≥n las 24 horas del d√≠a, esto habr√≠a disparado a decenas, o incluso a cientos de d√≥lares al mes. Pero todav√≠a quer√≠a organizar la transmisi√≥n de forma gratuita o con una inversi√≥n financiera m√≠nima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qued√≥ claro que necesitas transmitir</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un dispositivo separado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o incluso una computadora separada. Pensando en algo como el Raspberri Pi. ¬øY qu√©? No tiene enfriador. Grab√© el video en una unidad flash USB, conect√© un cable Ethernet y lo dej√© en un lugar apartado, se est√° transmitiendo. Opci√≥n. Pero no ten√≠a ni el tablero en s√≠ ni la experiencia con √©l, as√≠ que tambi√©n rechac√© esta opci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al final, me encontr√© con una discusi√≥n en la que discutieron la creaci√≥n de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">su propio servidor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transmisiones Esto no era exactamente lo que estaba buscando, pero capt√© la idea principal: ¬°puede usar el servidor! En esa discusi√≥n, sugirieron usar un mont√≥n de VPS + nginx + OBS. Qued√≥ claro que este grupo podr√≠a ser adecuado para m√≠. Lo √∫nico que me confundi√≥ fue que nunca administr√© el servidor y me pareci√≥ que mi servidor dedicado era confuso y costoso. Decid√≠ averiguar cu√°nto costar√≠a alquilar un servidor en la configuraci√≥n m√≠nima y me sorprendi√≥ gratamente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mu/v8/ms/muv8msmvpgnhzj9z04nuhv_y0-s.jpeg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los precios est√°n en rublos bielorrusos y son solo migajas. Para comprenderlo, 8 rublos bielorrusos cuestan alrededor de 3,5 d√≥lares o 240 rublos rusos. Durante un mes usando una computadora completa que est√° encendida las 24 horas, los 7 d√≠as de la semana y tiene acceso r√°pido a Internet. Por alguna raz√≥n, este descubrimiento fue muy alegre para m√≠, y durante varios d√≠as camin√© terriblemente feliz como un ni√±o que descubri√≥ cohetes espaciales :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por cierto, aprovech√© la oferta del primer sitio que Google me dio a pedido "Alquiler de VPS". Quiz√°s haya a√∫n m√°s soluciones de presupuesto, pero este precio me conven√≠a y no busqu√© m√°s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al crear un servidor, puede seleccionar el sistema operativo en el que operar√°. </font><font style="vertical-align: inherit;">En cualquiera de los sistemas enumerados, puede organizar la transmisi√≥n y elegir seg√∫n sus preferencias y capacidades financieras (solicitan una tarifa adicional para un servidor con Windows). </font><font style="vertical-align: inherit;">Eleg√≠ CentOS. </font><font style="vertical-align: inherit;">Solo porque sol√≠a tener un poco de experiencia con ella.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/0a/wh/cv0awhhxim1w2fgglkrlupl5hgc.jpeg" alt="imagen"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paso 2 - configuraci√≥n del servidor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo primero que necesita despu√©s de crear el servidor es conectarse a √©l a trav√©s de SSH. </font><font style="vertical-align: inherit;">Al principio us√© PuTTy, pero luego comenc√© a usar la aplicaci√≥n Secure Shell, que se ejecuta en Google Chrome. </font><font style="vertical-align: inherit;">Entonces result√≥ ser m√°s conveniente para m√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego cambi√© el nombre del host, configur√© la sincronizaci√≥n de hora en el servidor, actualic√© el sistema, me met√≠ con iptables ... e hice un mont√≥n de cosas, pero no porque fuera necesario. </font><font style="vertical-align: inherit;">Fue interesante para m√≠ configurar el servidor y funcion√≥ para m√≠. </font><font style="vertical-align: inherit;">Me encanta cuando resulta :) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero esos pasos que hay que hacer:</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte el repositorio EPEL.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Levantar servidor FTP (eleg√≠ vsftp).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar ffmpeg.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No dar√© detalles del equipo, esta instrucci√≥n es m√°s bien conceptual para transmitir un plan de acci√≥n general. Si tiene alguna dificultad con alguno de los pasos, se resuelven r√°pidamente mediante una consulta en un motor de b√∫squeda como "CentOS connect EPEL" o "Instalaci√≥n del servidor FTP CentOS". Y en los primeros enlaces puede encontrar instrucciones detalladas paso a paso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, como escrib√≠ antes, necesitaba un mont√≥n de VPS + nginx + OBS. VPS: listo. Pero aqu√≠, sobre los puntos restantes, comenzaron a surgir preguntas. OBS es un programa de difusi√≥n, Open Broadcaster Software. Y solo funciona con hilos, es decir por ejemplo, toma una imagen de una c√°mara web y la transmite. O la grabaci√≥n de pantalla. O una transmisi√≥n ya en curso redirige a otro sitio. Y no tengo una transmisi√≥n, solo tengo un conjunto de archivos de video que necesito para hacer una transmisi√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenz√≥ a cavar en esta direcci√≥n y se encontr√≥ con ffmpeg. </font><font style="vertical-align: inherit;">FFmpeg es un conjunto de bibliotecas gratuitas de c√≥digo abierto que le permiten grabar, convertir y transferir grabaciones digitales de audio y video en varios formatos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y me sorprendi√≥ mucho lo que puede hacer ffmpeg. </font><font style="vertical-align: inherit;">Si lo desea, extraer√° el sonido del video. </font><font style="vertical-align: inherit;">Si lo desea, cortar√° un fragmento del video sin transcodificarlo. </font><font style="vertical-align: inherit;">Si lo desea, se convertir√° de un formato a otro. </font><font style="vertical-align: inherit;">Y mucho, mucho m√°s. </font><font style="vertical-align: inherit;">Hasta el punto de que puede especificar un archivo para √©l, lo convertir√° en una transmisi√≥n y lo transferir√° a YouTube √©l mismo. </font><font style="vertical-align: inherit;">Todo, la cadena est√° ensamblada. </font><font style="vertical-align: inherit;">Solo queda refinar los matices.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paso 3 - configuraci√≥n de transmisi√≥n</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creamos una transmisi√≥n en YouTube. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En esta etapa, solo necesitamos un enlace y una clave de traducci√≥n. </font><font style="vertical-align: inherit;">En la captura de pantalla a continuaci√≥n, se resaltan en rojo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gr/a3/oo/gra3oogooafzdfjzhlqdqjjxr8o.jpeg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suba los archivos de video al servidor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que planeamos transmitir. </font><font style="vertical-align: inherit;">En realidad, FTP solo es necesario para esta etapa. </font><font style="vertical-align: inherit;">Si tiene otra forma conveniente de cargar archivos al servidor, entonces el servidor FTP se puede omitir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transmitimos a YouTube. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para comenzar a transmitir, debe ejecutar ffmpeg con varios atributos. </font><font style="vertical-align: inherit;">Aqu√≠ est√° el comando m√°s corto que obtuve:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descifrado de atributos</font></font></b><div class="spoiler_text"><code>-re</code> ‚Äì ,      .<br>
<br>
<code>-i</code> ‚Äì ,    . ,       ,    -.       ,  <code>/usr/media/lecture1.mp4</code>.<br>
<br>
<code>-f</code> ‚Äì    .    ,  ffmpeg ¬´ ¬ª     mp4  flv.<br>
<br>
    ,     YouTube     .. ,     ,   ,       .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hizo todo correctamente, luego de ejecutar este comando, YouTube ver√° la transmisi√≥n transmitida. </font><font style="vertical-align: inherit;">Para comenzar la transmisi√≥n, solo tiene que hacer clic en el bot√≥n "Iniciar transmisi√≥n" en YouTube.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paso 4: agrega autonom√≠a</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Felicidades! Ahora ya sabe c√≥mo comenzar a transmitir desde un archivo de video. Pero esto no es suficiente para la transmisi√≥n las 24 horas. Es importante que despu√©s de que el primer video termine de reproducirse, el siguiente comenzar√° de inmediato, y cuando se muestren todos los videos, la reproducci√≥n comenzar√° nuevamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se me ocurri√≥ la siguiente opci√≥n: crear un archivo .sh en el que registr√© un comando para cada archivo de video y al final indiqu√© un comando para reiniciar el mismo script. Result√≥ una especie de recursi√≥n:</font></font><br>
<br>
<pre><code class="bash hljs"> 1... (   lecture1.mp4)<font></font>
 2... (   lecture2.mp4)<font></font>
 3... (   lecture3.mp4)<font></font>
bash start.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y s√≠, funcion√≥. Yo, satisfecho de m√≠ mismo, comenc√© una transmisi√≥n de prueba y me fui a dormir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una sorpresa desagradable me esperaba en la ma√±ana. Result√≥ que la transmisi√≥n se prolong√≥ solo un par de minutos y termin√≥ casi de inmediato cuando apagu√© mi computadora. La investigaci√≥n mostr√≥ que los comandos lanzados de esta manera se ejecutan mientras el usuario est√° autorizado en el servidor. Tan pronto como me desconect√©, se interrumpi√≥ la ejecuci√≥n de los comandos que comenc√©. Para evitar que esto suceda, es suficiente </font></font><code>bash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agregar el equipo </font><font style="vertical-align: inherit;">antes que el </font><font style="vertical-align: inherit;">equipo </font></font><code>nohup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esto permitir√° que el proceso de ejecuci√≥n se ejecute independientemente de su presencia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La versi√≥n m√≠nima final del script se ve as√≠:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture2.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture3.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
nohup bash start.sh $</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donde start.sh es el archivo en el que se escribe este script. </font><font style="vertical-align: inherit;">Y este archivo debe ubicarse en el mismo directorio que los archivos de video. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregar un signo de d√≥lar al final le permite iniciar el proceso en segundo plano para que pueda seguir usando la consola sin interrumpir la transmisi√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De las bonificaciones resultaron los siguientes bollos:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puede cambiar manualmente la reproducci√≥n de archivos. </font><font style="vertical-align: inherit;">Para hacer esto, debe "matar" el proceso ffmpeg que se est√° ejecutando actualmente. </font><font style="vertical-align: inherit;">Despu√©s de eso, la reproducci√≥n del siguiente archivo de la lista comenzar√° autom√°ticamente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se pueden agregar nuevos videos a la transmisi√≥n sin detener la transmisi√≥n. </font><font style="vertical-align: inherit;">Simplemente suba el video al servidor, agregue el comando para ejecutar este archivo en el script, gu√°rdelo. </font><font style="vertical-align: inherit;">Y eso es. </font><font style="vertical-align: inherit;">En la siguiente ronda de reproducci√≥n, el nuevo archivo ya se transmitir√° junto con los archivos antiguos.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paso 5 - configura ffmpeg</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobre esto, en principio, uno podr√≠a detenerse. Pero quer√≠a que la transmisi√≥n fuera un poco m√°s amigable para la audiencia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que una persona fue a la transmisi√≥n, comenz√≥ a mirar, le gust√≥ y quer√≠a ver esta conferencia desde el principio, y la transmisi√≥n no incluye rebobinar. Para ver una conferencia desde el principio, una persona deber√° ir a mi sitio web y obtener un registro de la conferencia de inter√©s. ¬øY c√≥mo entender qu√© conferencia le interesa? El sitio tiene 16 conferencias y cada semana solo hay m√°s. Creo que incluso yo, que film√© y edit√© todas estas conferencias, no podr√© determinar de qu√© fragmento se trata. Por lo tanto, es necesario que cada clase sea designada de alguna manera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La opci√≥n de agregar subt√≠tulos a los archivos de video de origen en el programa de edici√≥n no me conven√≠a. </font><font style="vertical-align: inherit;">Era necesario asegurarse de que se utilizaran los archivos originales. </font><font style="vertical-align: inherit;">Para apoyar la transmisi√≥n, requer√≠a de m√≠ la menor cantidad posible de movimientos corporales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result√≥ que ffmpeg tambi√©n me puede ayudar con esto. </font><font style="vertical-align: inherit;">Tiene un atributo especial </font></font><code>-vf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que le permite poner texto encima del video. </font><font style="vertical-align: inherit;">Para agregar texto al video, debe agregar el siguiente fragmento al comando:</font></font><br>
<br>
<pre><code class="bash hljs">-vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 13\:  .   ?':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span></code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decodificaci√≥n de par√°metros</font></font></b><div class="spoiler_text"><code>fontfile=</code> ‚Äì    .       .          .        .<br>
<br>
<code>text=</code> ‚Äì ,  ,     .<br>
<br>
<code>fontsize=</code> ‚Äì    .<br>
<br>
<code>fontcolor=</code> ‚Äì  .<br>
<br>
<code>borderw=</code> ‚Äì       (         1 ).<br>
<br>
<code>bordercolor=</code> ‚Äì  .<br>
<br>
<code>x=</code>  <code>y=</code> ‚Äì  .  <code>0;0</code>     .      ,           1280720 .<br>
</div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se parece a esto:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/jf/1n/sh/jf1nshia1hbk30-pjd5y6mztga0.jpeg" alt="imagen"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paso 6: determine la calidad de transmisi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo, la transmisi√≥n est√° lista. Transmisiones FFmpeg, reproducci√≥n de archivos, mi presencia no es necesaria para la transmisi√≥n. Incluso cada conferencia est√° firmada. Parece que eso es todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero surgi√≥ otro matiz: eleg√≠ la configuraci√≥n m√≠nima del servidor y no retir√≥ la transmisi√≥n. Configuraci√≥n del servidor: 1 n√∫cleo (como 2.2 GHz), 1 gigabyte de RAM, SSD de 25 GB. Hab√≠a suficiente RAM, pero el procesador se carg√≥ casi por completo al 100% (y, a veces, incluso al 102-103% :) Esto provoc√≥ que la transmisi√≥n se congelara una vez cada pocos segundos. Feo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podr√≠a tomar una configuraci√≥n m√°s costosa con dos n√∫cleos, el beneficio es que con las tecnolog√≠as en la nube, la configuraci√≥n del servidor se cambia presionando un par de botones. </font><font style="vertical-align: inherit;">Pero quer√≠a encajar en la potencia de la configuraci√≥n m√≠nima. </font><font style="vertical-align: inherit;">Comenc√© a estudiar la documentaci√≥n de ffmpeg y s√≠, tambi√©n hay configuraciones all√≠ que le permiten ajustar la carga en el sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La alta calidad de imagen se puede lograr de dos maneras: ya sea con una alta carga del procesador o un gran tr√°fico saliente. </font><font style="vertical-align: inherit;">Resulta que cuanto m√°s pueda soportar la carga el procesador, menos ancho de banda necesitar√° el canal. </font><font style="vertical-align: inherit;">O no puede cargar mucho el procesador, pero necesitar√° un canal amplio con un gran margen de tr√°fico. </font><font style="vertical-align: inherit;">Si existen restricciones tanto en el procesador como en el tama√±o del canal / tr√°fico saliente, deber√° reducir la calidad de la imagen para que la transmisi√≥n se realice sin problemas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi servidor tiene un canal de 10 Mbps. Este ancho es recto con un margen. Pero hay un l√≠mite de tr√°fico: 1 TB por mes. Por lo tanto, para cumplir con las restricciones de tr√°fico, mi transmisi√≥n saliente no debe exceder ~ 300 Kb por segundo, es decir la tasa de bits de la transmisi√≥n saliente no debe ser superior a 2.5 Mbps. YouTube, por cierto, solo recomienda transmitir en una tasa de bits tan alta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ffmpeg utiliza diferentes enfoques para regular la carga en el sistema. Bien escrito sobre esto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Termin√© usando dos atributos: </font></font><code>-crf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>-preset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Factor de tasa constante (CRF)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- este es un coeficiente debido al cual puede ajustar la calidad de la imagen. </font><font style="vertical-align: inherit;">CRF puede variar de 0 a 51, donde 0 es la calidad del archivo fuente, 51 es la peor calidad posible. </font><font style="vertical-align: inherit;">Se recomienda utilizar valores del 17 al 28, el valor predeterminado es 23. Con una relaci√≥n de 17, el video ser√° visualmente id√©ntico al original, pero t√©cnicamente no lo ser√°. </font><font style="vertical-align: inherit;">La documentaci√≥n tambi√©n establece que el tama√±o del video final, dependiendo del CRF especificado, cambia exponencialmente, es decir. </font><font style="vertical-align: inherit;">aumentar el coeficiente en 6 puntos duplicar√° la tasa de bits del video saliente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si usa CRF puede elegir el "peso" de la imagen saliente, luego, usando los </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preajustes (-preset)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede determinar cu√°nto se cargar√° el procesador. </font><font style="vertical-align: inherit;">Los par√°metros para este atributo tienen lo siguiente:</font></font><br>
<br>
<ul>
<li><code>ultrafast</code></li>
<li><code>superfast</code></li>
<li><code>veryfast</code></li>
<li><code>faster</code></li>
<li><code>fast</code></li>
<li><code>medium</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - valor por defecto</font></font></li>
<li><code>slow</code></li>
<li><code>slower</code></li>
<li><code>veryslow</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuanto m√°s r√°pido se especifique el par√°metro, mayor ser√° la carga en el procesador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero tom√© el preajuste, que era b√°sicamente "dif√≠cil" para mi procesador, y luego ajust√© m√°s finamente la carga usando CRF. </font><font style="vertical-align: inherit;">En mi caso, apareci√≥ el preset </font></font><code>fast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y por crf me decid√≠ por un valor de 24.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo. </font><font style="vertical-align: inherit;">El comando final para comenzar la transmisi√≥n me dio esto:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 1\:   ':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span> -c:v libx264 -preset fast -crf 24 -g 3 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ solo hay dos momentos no descritos: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><code>-c:v libx264</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: una indicaci√≥n de un c√≥dec espec√≠fico para trabajar con el archivo fuente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) </font></font><code>-g 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- una indicaci√≥n expl√≠cita del n√∫mero de cuadros clave. En este caso, se indica que cada tercer cuadro debe ser clave. El valor est√°ndar es 5 u 8, pero YouTube jura, pregunta al menos 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© calidad de la transmisi√≥n se puede ver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La carga del servidor fue la siguiente:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/b5/3s/za/b53szauaywx3bdwoic-yebil1es.jpeg" alt="imagen"><br>
<br>
<img src="https://habrastorage.org/webt/cq/jc/t4/cqjct4xhbz3zabriimgydbxvjaq.jpeg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
seg√∫n los datos de monitoreo, est√° claro que la carga del procesador var√≠a del 70% al 95% y la transmisi√≥n nunca ha descansado al 100% en una semana. Entonces, con esta configuraci√≥n, el procesador es suficiente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al cargar un disco, puedo decir que casi no est√° cargado y que un HDD normal deber√≠a ser suficiente para transmitir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero la cantidad de tr√°fico saliente me molesta. Resulta que mi flujo saliente var√≠a de 450 a 650 KB por segundo. Durante un mes ser√° de aproximadamente 1,8 terabytes. Puede que tenga que comprar tr√°fico o a√∫n cambiar a una configuraci√≥n de doble n√∫cleo porque No me gustar√≠a reducir la calidad de la imagen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, dir√© que configurar una transmisi√≥n de este tipo desde cero toma aproximadamente 1-2 horas. Adem√°s, la mayor parte del tiempo llevar√° subir el video al servidor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como herramienta de marketing, el lanzamiento de dicha transmisi√≥n no vali√≥ la pena. Quiz√°s si termina las vistas para que los algoritmos de YouTube capten esta transmisi√≥n y la muestren activamente en las recomendaciones, entonces algo funcionar√≠a. En mi caso, durante 16 d√≠as de transmisi√≥n continua, fue visto 58 veces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es correcto. La transmisi√≥n encaja armoniosamente en la p√°gina principal de mi sitio. Result√≥ una especie de oportunidad para decidir r√°pidamente sobre el profesor y las conferencias en s√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y un momento Es importante que la transmisi√≥n no viole los derechos de autor de otra persona, de lo contrario se bloquear√°. Estoy tranquilo para mi transmisi√≥n. Seleccion√© especialmente inserciones musicales con uso gratuito, y el autor del contenido se sienta en una computadora vecina y no est√° en contra de que yo use su contenido :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero si tiene una radio sonando en el fondo en alg√∫n lugar del fondo, o us√≥ su pista favorita durante la edici√≥n, o tom√≥ un video de un popular video musical, serie o pel√≠cula, entonces su transmisi√≥n est√° en riesgo. </font><font style="vertical-align: inherit;">Tambi√©n es importante que la transmisi√≥n lleve al menos una carga sem√°ntica m√≠nima, de lo contrario puede bloquearse como spam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo para m√≠. </font><font style="vertical-align: inherit;">Espero que este manual sirva bien a alguien. </font><font style="vertical-align: inherit;">Bueno, si tiene algo que agregar, escriba, con gusto leer√© adiciones y aclaraciones al art√≠culo.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es493336/index.html">C√≥mo el Centro de Inform√°tica tradujo el aprendizaje en l√≠nea</a></li>
<li><a href="../es493340/index.html">Hacer que las funciones SIL sean port√°tiles entre versiones en Jira</a></li>
<li><a href="../es493342/index.html">C√≥mo NSPK prepar√≥ la infraestructura para la transici√≥n a udalenka</a></li>
<li><a href="../es493346/index.html">Nos las arreglamos para transferir oficinas a udalenka, ¬øy t√∫?</a></li>
<li><a href="../es493348/index.html">Haga que "udalenka" vuelva a ser genial: c√≥mo transferir a toda la empresa al trabajo remoto en 4 etapas</a></li>
<li><a href="../es493356/index.html">Video @Databases Meetup: Seguridad DBMS, Tarantool en IoT, Greenplum para Big Data Analytics</a></li>
<li><a href="../es493360/index.html">Dos dedos de algol</a></li>
<li><a href="../es493362/index.html">Soporte t√©cnico "en las maletas". C√≥mo trabajamos de forma remota sin nervios innecesarios y obtenemos los servicios que necesitamos de forma remota</a></li>
<li><a href="../es493366/index.html">¬øQu√© es Windows PowerShell y qu√© come? Parte 3: pasar par√°metros a scripts y funciones, crear cmdlets</a></li>
<li><a href="../es493374/index.html">Coronavirus: consejos pr√°cticos y un poco de teor√≠a</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>