<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚úàÔ∏è üèÇüèª ‚ñ´Ô∏è Como funciona o ataque de redefini√ß√£o do TCP üö¥üèø üìõ üîô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um ataque de redefini√ß√£o de TCP √© realizado usando um √∫nico pacote de dados com tamanho n√£o superior a alguns bytes. O segmento TCP substitu√≠do pela f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como funciona o ataque de redefini√ß√£o do TCP</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499902/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um ataque de redefini√ß√£o de TCP √© realizado usando um √∫nico pacote de dados com tamanho n√£o superior a alguns bytes. </font><font style="vertical-align: inherit;">O segmento TCP substitu√≠do pela falsifica√ß√£o, criado e transmitido pelo atacante, engana as duas v√≠timas para encerrar a conex√£o TCP, interrompendo a conex√£o entre elas, o que pode ser cr√≠tico.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0e/768/854/d0e7688544d90ce84fd01f7aae77b348.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este ataque teve consequ√™ncias no mundo real. </font><font style="vertical-align: inherit;">O receio de seu uso foi causado pela introdu√ß√£o de altera√ß√µes no pr√≥prio protocolo TCP. </font><font style="vertical-align: inherit;">Acredita-se que o ataque seja um componente essencial do Grande Firewall Chin√™s (o Escudo Dourado), usado pelo governo chin√™s para censurar a Internet fora da China. </font><font style="vertical-align: inherit;">Apesar de sua experi√™ncia impressionante, entender os mecanismos por tr√°s desse ataque n√£o requer necessariamente um conhecimento profundo do TCP. </font><font style="vertical-align: inherit;">Obviamente, a compreens√£o de suas sutilezas pode lhe ensinar muito sobre os recursos da implementa√ß√£o do protocolo TCP e, como veremos em breve, voc√™ pode realizar esse ataque contra si mesmo usando apenas um laptop. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste post n√≥s:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprenda o b√°sico do TCP</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprenda como o ataque funciona.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos conduzir um ataque contra n√≥s mesmos com um script Python simples.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de come√ßarmos a analisar a mec√¢nica do ataque, vamos primeiro ver como ele √© usado no mundo real.</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o ataque de redefini√ß√£o do TCP √© usado no Great Firewall?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Great Firewall (GFW) √© um conjunto de sistemas e t√©cnicas usadas pelo governo chin√™s para censurar a Internet para usu√°rios chineses internos. </font><font style="vertical-align: inherit;">O GFW bloqueia e interrompe ativamente as conex√µes com servidores dentro e fora do pa√≠s e tamb√©m monitora passivamente o tr√°fego da Internet de conte√∫do proibido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para impedir que os usu√°rios se conectem a servidores proibidos, o GFW usa t√©cnicas como </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polui√ß√£o de DNS</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueio de IP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ambos custam artigos separados). </font><font style="vertical-align: inherit;">No entanto, √†s vezes o firewall GFW precisa ter permiss√£o para fazer uma conex√£o, mas depois a interrompe no meio. </font><font style="vertical-align: inherit;">Por exemplo, isso √© necess√°rio se voc√™ deseja executar uma an√°lise lenta e pendente da conex√£o, por exemplo, sua correla√ß√£o com outras a√ß√µes. </font><font style="vertical-align: inherit;">Ou √© usado se o firewall precisar analisar os dados trocados durante o processo de conex√£o e, em seguida, usar essas informa√ß√µes para decidir se deve continuar ou bloquear. </font><font style="vertical-align: inherit;">Por exemplo, o tr√°fego para um site de not√≠cias pode ser permitido, mas v√≠deos contendo palavras-chave proibidas ser√£o censurados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para isso, o GFW precisa de ferramentas capazes de interromper conex√µes j√° estabelecidas. </font><font style="vertical-align: inherit;">Uma dessas ferramentas √© um ataque de redefini√ß√£o de TCP.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como um ataque de redefini√ß√£o de TCP funciona?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em um ataque de redefini√ß√£o de TCP, o invasor interrompe a conex√£o entre as duas v√≠timas, enviando uma ou ambas as mensagens falsas pedindo que elas se desconectem imediatamente. Essas mensagens s√£o chamadas de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segmentos de redefini√ß√£o de TCP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Em opera√ß√£o normal sem a participa√ß√£o de um invasor, os computadores enviam segmentos de descarte TCP quando recebem tr√°fego TCP inesperado e desejam que o remetente pare de envi√°-lo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ataque de redefini√ß√£o do TCP explora maliciosamente esse mecanismo, fazendo com que as v√≠timas terminem prematuramente as conex√µes TCP, enviando segmentos de redefini√ß√£o falsos. Se o segmento de redefini√ß√£o falsa for feito corretamente, o destinat√°rio o levar√° para o segmento real e fechar√° a conex√£o, interrompendo a transmiss√£o de informa√ß√µes adicionais nessa conex√£o. Para continuar a troca de dados, as v√≠timas podem tentar criar uma nova conex√£o TCP, mas o invasor pode ter a oportunidade de redefinir essa nova conex√£o. Felizmente, como um invasor precisa de tempo para criar e enviar um pacote falso, os ataques descartados s√£o realmente eficazes apenas contra conex√µes de longo prazo. Conex√µes de curto prazo. por exemplo, usado para transferir pequenas p√°ginas da web, geralmente tem tempo para cumprir sua miss√£o at√© o momentoquando o atacante puder redefini-los.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O envio de segmentos TCP falsos √©, de certo modo, um processo f√°cil, porque nem o TCP nem o IP t√™m suas pr√≥prias maneiras de verificar a identidade do remetente. H√° uma extens√£o IP chamada IPSec que fornece autentica√ß√£o, mas n√£o √© t√£o amplamente usada. Os provedores de servi√ßos de Internet devem se recusar a transmitir pacotes IP provenientes de um endere√ßo IP obviamente falso, mas √© alegado que essa verifica√ß√£o √© muito med√≠ocre. Tudo o que o destinat√°rio pode fazer √© levar o endere√ßo IP e a porta de origem dentro do pacote ou segmento pelo valor nominal e, se poss√≠vel, usar protocolos de n√≠vel superior, como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/2014/03/27/how-does-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , para identificar o remetente </font><font style="vertical-align: inherit;">. No entanto, como os pacotes de despejo TCP fazem parte do pr√≥prio protocolo TCP, eles n√£o podem ser verificados usando esses protocolos de alto n√≠vel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar da simplicidade de enviar segmentos falsos, criar um segmento falso e executar um ataque de redefini√ß√£o de TCP bem-sucedido ainda pode ser uma tarefa assustadora. </font><font style="vertical-align: inherit;">Para entender por que isso acontece, precisamos entender a opera√ß√£o do protocolo TCP.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o TCP funciona</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O objetivo do protocolo TCP √© enviar ao destinat√°rio uma c√≥pia exata do bloco de dados. </font><font style="vertical-align: inherit;">Por exemplo, se meu servidor envia HTML via TCP para o seu computador, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a pilha TCP do</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seu computador (a parte do sistema operacional que processa o TCP) deve gerar meu HTML exatamente na mesma forma e ordem em que o servidor o enviou.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/54d/bf5/d64/54dbf5d644d0a3d8ece1cff6cde7b790.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, meu HTML n√£o √© transmitido pela Internet de maneira perfeitamente ordenada. Ele √© dividido em muitos pequenos fragmentos (chamados de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segmentos TCP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), cada um dos quais √© transmitido individualmente pela Internet e recriado na ordem transferida pela pilha TCP do seu computador. Essa sa√≠da restaurada √© chamada de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fluxo TCP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cada segmento TCP √© transmitido em seu pr√≥prio </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacote IP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , no entanto, para entender o ataque, n√£o precisamos saber detalhes sobre o IP.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/468/904/175/4689041752b8fa9f66c57c696c4be2ef.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A convers√£o de segmentos em um fluxo requer cuidados, porque a Internet n√£o √© confi√°vel. </font><font style="vertical-align: inherit;">Os segmentos TCP podem ser perdidos. </font><font style="vertical-align: inherit;">Eles podem ficar fora de ordem, enviados duas vezes, danificados e sofrer muitas outras desventuras. </font><font style="vertical-align: inherit;">Portanto, o objetivo do protocolo TCP √© garantir a transmiss√£o confi√°vel de dados em uma rede n√£o confi√°vel. </font><font style="vertical-align: inherit;">O TCP executa essa tarefa, exigindo que os dois lados da conex√£o mantenham contato pr√≥ximo entre si e transmitam constantemente informa√ß√µes sobre quais blocos de dados foram recebidos. </font><font style="vertical-align: inherit;">Isso permite que os remetentes entendam quais dados o destinat√°rio ainda n√£o recebeu e retransmitam os dados perdidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para entender como o processo funciona, precisamos entender como os remetentes e receptores usam </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫meros de sequ√™ncia TCP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para marcar e rastrear dados transmitidos por TCP.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫meros de sequ√™ncia TCP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada byte transmitido por uma conex√£o TCP possui um n√∫mero de sequ√™ncia atribu√≠do pelo remetente. </font><font style="vertical-align: inherit;">As m√°quinas receptoras usam n√∫meros de s√©rie para mover os dados recebidos para o pedido original.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/402/fbc/144/402fbc144a2864f986debfb2ea9b6412.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando duas m√°quinas negociam uma conex√£o TCP, cada m√°quina envia outro </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de seq√º√™ncia inicial</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aleat√≥ria </font><font style="vertical-align: inherit;">. Este √© o n√∫mero de sequ√™ncia que a m√°quina atribuir√° ao primeiro byte enviado. Cada byte subseq√ºente recebe o n√∫mero de sequ√™ncia do byte anterior mais 1. Os segmentos </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cont√™m </font><em><font style="vertical-align: inherit;">cabe√ßalhos TCP</font></em><font style="vertical-align: inherit;"> , que s√£o metadados anexados ao in√≠cio do segmento. O n√∫mero de sequ√™ncia do primeiro byte no corpo do segmento est√° inclu√≠do no cabe√ßalho TCP deste segmento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se notar que as conex√µes TCP s√£o bidirecionais, ou seja, os dados podem ser transmitidos em ambas as dire√ß√µes, e cada m√°quina em uma conex√£o TCP atua como remetente e destinat√°rio. Por esse motivo, cada m√°quina deve atribuir e processar seu pr√≥prio conjunto independente de n√∫meros de sequ√™ncia.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Confirma√ß√£o de recebimento de dados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando uma m√°quina recebe um segmento TCP, informa ao remetente do segmento que foi recebida. </font><font style="vertical-align: inherit;">O destinat√°rio faz isso enviando um segmento </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(abrevia√ß√£o de "reconhecer"), contendo o n√∫mero de sequ√™ncia do </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√≥ximo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> byte que ele espera receber do remetente. </font><font style="vertical-align: inherit;">O remetente usa essas informa√ß√µes para entender que o destinat√°rio recebeu com √™xito todos os outros bytes at√© esse n√∫mero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um segmento √© </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicado pela presen√ßa de um sinalizador </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o n√∫mero de confirma√ß√£o correspondente no cabe√ßalho TCP do segmento. </font><font style="vertical-align: inherit;">Existem apenas 6 sinalizadores no protocolo TCP, incluindo (como veremos em breve) um sinalizador </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(abrevia√ß√£o de "reset" - "reset"), indicando o segmento de redefini√ß√£o.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/242/452/e35/242452e35d360faf406441ab93f8c383.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: O TCP tamb√©m permite o uso de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACKs seletivos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que s√£o transmitidos quando o receptor recebe alguns, mas n√£o todos, segmentos no intervalo de n√∫meros. Por exemplo, "recebi os bytes 1000-3000 e 4000-5000, mas n√£o 3001-3999". Por simplicidade, n√£o considerarei ACKs seletivos em nossa discuss√£o sobre ataques de redefini√ß√£o de TCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o remetente transmitir dados, mas n√£o receber</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para eles durante um determinado intervalo de tempo, ele assume que os dados foram perdidos e os reenvia, fornecendo os mesmos n√∫meros de s√©rie. Isso significa que, se o receptor aceita os mesmos bytes duas vezes, ele usa trivialmente os n√∫meros de sequ√™ncia para se livrar das duplicatas sem interromper o fluxo. O destinat√°rio pode aceitar dados duplicados porque o segmento original foi recebido posteriormente, depois que foi enviado novamente ou porque o segmento original foi recebido com √™xito, mas o correspondente foi </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perdido no caminho para o remetente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6d/22f/a09/e6d22fa098d7375dab30e6c8341ff358.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora esses dados duplicados sejam raros o suficiente, o desperd√≠cio excessivo de recursos causado por eles n√£o leva a problemas. </font><font style="vertical-align: inherit;">Se todos os dados </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chegarem </font><font style="vertical-align: inherit;">mais cedo ou mais tarde ao destinat√°rio e os dados correspondentes </font><font style="vertical-align: inherit;">chegarem ao remetente, a conex√£o TCP far√° seu trabalho.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escolhendo um n√∫mero de s√©rie para um segmento falso</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao criar um segmento falso, o </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invasor precisa fornecer um n√∫mero de s√©rie. </font><font style="vertical-align: inherit;">Os destinat√°rios est√£o satisfeitos com o fato de voc√™ precisar aceitar segmentos com n√∫meros de s√©rie inconsistentes e conect√°-los independentemente na ordem correta. </font><font style="vertical-align: inherit;">No entanto, suas capacidades s√£o limitadas. </font><font style="vertical-align: inherit;">Se o destinat√°rio receber um segmento com um n√∫mero de sequ√™ncia "muito" avariado, ele descartar√° esse segmento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, para um ataque de redefini√ß√£o de TCP bem-sucedido, √© necess√°rio um n√∫mero de sequ√™ncia plaus√≠vel. </font><font style="vertical-align: inherit;">Mas o que √© considerado esse n√∫mero? </font><font style="vertical-align: inherit;">Para a maioria dos segmentos (embora, como veremos mais adiante, n√£o para </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), a resposta √© determinada pelo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamanho da janela TCP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamanho da janela TCP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine um computador antigo do in√≠cio dos anos 90, conectado a uma moderna rede de fibra √≥ptica de gigabit. Uma rede ultrarr√°pida pode transferir dados para este computador idoso a uma velocidade incr√≠vel, mais rapidamente do que a m√°quina pode process√°-lo. Isso nos incomoda, porque o segmento TCP n√£o pode ser considerado recebido at√© que o receptor possa process√°-lo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a5/299/76a/8a529976a3acd7a28babb9e8220bcb7d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os computadores t√™m um </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer TCP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no qual novos dados que chegam aguardam processamento enquanto o computador est√° trabalhando nos dados que chegam antes dele. No entanto, esse buffer tem um tamanho limitado. Se o destinat√°rio n√£o conseguir lidar com a quantidade de dados transmitidos a ele pela rede, o buffer ser√° excedido. Quando o buffer est√° cheio, o destinat√°rio n√£o tem escolha a n√£o ser livrar-se dos dados redundantes. O destinat√°rio n√£o envia </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados descartados; portanto, o remetente precisa reenvi√°-los quando houver espa√ßo livre no buffer do destinat√°rio. N√£o importa a rapidez com que a rede pode transmitir dados se o destinat√°rio n√£o tiver tempo para lidar com eles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine um amigo excessivamente zeloso que envia para voc√™ um fluxo inteiro de cartas mais r√°pido do que voc√™ pode ler. H√° um certo espa√ßo de reserva dentro da sua caixa de correio, mas depois que estiver cheio, todas as cartas n√£o colocadas cair√£o no ch√£o, onde raposas e outras criaturas as comer√£o. Um amigo ter√° que reenviar as cartas que ele comeu, mas, por enquanto, voc√™ ter√° tempo para receber as mensagens anteriores. Enviar muitas cartas ou volumes de dados que o destinat√°rio n√£o pode processar √© um desperd√≠cio de energia e canal de transmiss√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Demais" - quantos dados s√£o? Como o remetente entende quando enviar mais dados e quando vale a pena esperar? √â aqui que o </font><em><font style="vertical-align: inherit;">tamanho da janela TCP</font></em><font style="vertical-align: inherit;"> √© √∫til.</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O tamanho da janela do destinat√°rio √© o n√∫mero m√°ximo de bytes n√£o reconhecidos que o remetente pode transferir para ele a qualquer momento. Suponha que o destinat√°rio relate que o tamanho da janela √© 100.000 (em breve descobriremos como ele passa esse valor); portanto, o remetente envia 100.000 bytes. Suponha que, no momento em que o remetente transmitisse cem mil√©simos de byte, o receptor enviasse os segmentos </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para os primeiros 10.000 desses bytes. Isso significa que 90.000 bytes ainda n√£o foram confirmados. Como o tamanho da janela √© 100.000, o remetente pode transferir outros 10.000 bytes antes de esperar pelos novos </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se ap√≥s o envio desses 10.000 bytes adicionais ainda</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se n√£o foi recebido, o remetente ter√° o limite de 100.000 bytes n√£o confirmados. Conseq√ºentemente, o remetente ter√° que esperar e parar de enviar dados (exceto a retransmiss√£o de dados que ele considera perdidos) at√© receber novos </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afa/5df/46f/afa5df46f3304b04abbf629ca6ef34a0.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada lado da conex√£o TCP notifica o outro sobre o tamanho de sua janela durante o processo de handshake que √© realizado quando a conex√£o √© aberta. Al√©m disso, os tamanhos das janelas podem ser alterados dinamicamente durante o processo de conex√£o. Um computador com um buffer TCP grande pode anunciar um tamanho de janela grande para maximizar a taxa de transfer√™ncia. Isso permite que a m√°quina que se comunica com ela transmita dados continuamente por uma conex√£o TCP sem pausar ou aguardar confirma√ß√£o. Um computador com um pequeno buffer TCP pode ser for√ßado a relatar um tamanho de janela pequeno. √Äs vezes, os remetentes preenchem completamente a janela e s√£o for√ßados a esperar at√© que alguns dos segmentos sejam confirmados. A largura de banda sofre por causa disso, mas √© necess√°rio que os buffers TCP n√£o excedam.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e3/d5e/5e0/8e3d5e5e0e4b574c6896e6ef7adc94bc.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tamanho da janela TCP √© um limite estrito da quantidade de dados n√£o confirmados transmitidos. </font><font style="vertical-align: inherit;">Podemos us√°-lo para calcular o n√∫mero m√°ximo poss√≠vel de sequ√™ncias (que na equa√ß√£o abaixo designei como </font></font><code>max_seq_no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), que o remetente pode enviar no momento atual:</font></font><br>
<br>
<blockquote><code>max_seq_no = max_acked_seq_no + window_size</code></blockquote><br>
<code>max_acked_seq_no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Esse √© o n√∫mero m√°ximo de sequ√™ncia para o qual o destinat√°rio enviou </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esse √© o n√∫mero m√°ximo de sequ√™ncia que o remetente sabe que recebeu exatamente. </font><font style="vertical-align: inherit;">Como o remetente pode transmitir apenas </font></font><code>window_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes n√£o confirmados, o n√∫mero m√°ximo de sequ√™ncia que pode enviar √© </font></font><code>max_acked_seq_no + window_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por esse motivo, a especifica√ß√£o TCP afirma que o destinat√°rio deve ignorar todos os dados recebidos que possuam n√∫meros de s√©rie fora da janela v√°lida. Por exemplo, se o destinat√°rio tiver confirmado todos os bytes de at√© 15.000 e o tamanho da janela for 30.000, ele receber√° todos os dados com um n√∫mero de s√©rie no intervalo de 15.000 a (15.000 + 30.000 = 45.000). Al√©m disso, o destinat√°rio ignora completamente os dados com n√∫meros de s√©rie fora desse intervalo. Se o segmento contiver dados, alguns dos quais est√£o dentro desta janela e outros fora dela, os dados dentro da janela ser√£o aceitos e confirmados, mas os dados externos ser√£o descartados. Observe que ainda ignoramos a possibilidade das </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seletivas</font></font><code>ACK</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que foram brevemente tocadas no in√≠cio do post.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso da maioria dos segmentos TCP, essa regra nos fornece um intervalo de n√∫meros de sequ√™ncia aceit√°veis. </font><font style="vertical-align: inherit;">No entanto, como mencionado anteriormente, as </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">restri√ß√µes </font><font style="vertical-align: inherit;">impostas aos segmentos </font><font style="vertical-align: inherit;">s√£o ainda mais r√≠gidas do que as restri√ß√µes aos segmentos comuns de transmiss√£o de dados. </font><font style="vertical-align: inherit;">Como veremos em breve, isso foi feito para complicar a condu√ß√£o de uma variante de um </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ataque de</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> redefini√ß√£o de TCP chamado </font><em><font style="vertical-align: inherit;">"ataque de redefini√ß√£o de TCP cego"</font></em><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫meros de sequ√™ncia aceit√°veis ‚Äã‚Äãpara segmentos RST</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Segmentos regulares s√£o aceitos se o n√∫mero de sequ√™ncia estiver entre o pr√≥ximo n√∫mero de sequ√™ncia esperado e esse n√∫mero mais o tamanho da janela. No entanto, os pacotes </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o recebidos apenas quando o n√∫mero de sequ√™ncia √© </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exatamente igual ao</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pr√≥ximo n√∫mero de sequ√™ncia esperado. Voltemos ao exemplo anterior, no qual o destinat√°rio enviou o n√∫mero de confirma√ß√£o 15.000. Para que o pacote </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seja recebido, seu n√∫mero de sequ√™ncia deve ser exatamente 15.000. Se o destinat√°rio receber um segmento </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um n√∫mero de sequ√™ncia diferente de 15.000, ele n√£o o aceitar√°.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d9/596/b55/1d9596b55bb0ac4946ed16ff6b878dff.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o n√∫mero de sequ√™ncia estiver fora do intervalo, o receptor o ignorar√° completamente. </font><font style="vertical-align: inherit;">No entanto, se estiver dentro da janela dos n√∫meros de sequ√™ncia esperados, o receptor envia um "desafio </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" ("chamada ACK"). </font><font style="vertical-align: inherit;">Este √© um segmento que informa ao remetente que o segmento </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tem um n√∫mero de sequ√™ncia inv√°lido. </font><font style="vertical-align: inherit;">Ele tamb√©m informa ao remetente o n√∫mero de sequ√™ncia que o destinat√°rio espera. </font><font style="vertical-align: inherit;">O remetente pode usar essas informa√ß√µes da </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chamada para recriar e reenviar as dele </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© 2010, o TCP n√£o impunha essas restri√ß√µes adicionais de segmento </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Os segmentos foram </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aceitos ou rejeitados de acordo com as mesmas regras que os demais. </font><font style="vertical-align: inherit;">No entanto, isso tamb√©m simplificou os </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ataques cegos de redefini√ß√£o do TCP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ataques TCP cegos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o invasor puder interceptar o tr√°fego trocado entre suas v√≠timas, ele poder√° ler os n√∫meros de s√©rie e confirma√ß√£o dos pacotes TCP das v√≠timas. Ele pode usar essas informa√ß√µes para selecionar quais n√∫meros de s√©rie fornecer aos seus segmentos falsos </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. No entanto, se o atacante n√£o puder interceptar o tr√°fego das v√≠timas, ele n√£o saber√° quais n√∫meros de sequ√™ncia inserir. Mas ele ainda pode transferir qualquer n√∫mero de segmentos </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com qualquer n√∫mero de s√©rie diferente, esperando que um deles esteja correto. Esse ataque √© chamado de ataque cego de redefini√ß√£o de TCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° dissemos, na vers√£o inicial do protocolo TCP, o invasor apenas precisou pegar o n√∫mero de s√©rie</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dentro da janela TCP do receptor. </font><font style="vertical-align: inherit;">Um artigo intitulado ‚ÄúDeslizando pela janela‚Äù mostrou que isso tornava os ataques cegos muito f√°ceis, pois, para um sucesso quase garantido, um invasor s√≥ precisava enviar dezenas de milhares de segmentos. </font><font style="vertical-align: inherit;">Para combater isso, a regra que for√ßou o destinat√°rio a aceitar o segmento </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foi substitu√≠da pelo crit√©rio mais rigoroso descrito acima. </font><font style="vertical-align: inherit;">Gra√ßas √†s novas regras para realizar ataques de redefini√ß√£o de TCP, milh√µes de segmentos precisam ser enviados √†s cegas, o que os torna praticamente irrealiz√°veis. </font><font style="vertical-align: inherit;">Veja </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-5963 para</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> detalhes </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realizar um ataque de redefini√ß√£o de TCP contra n√≥s mesmos</font></font></h2><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: Testei esse processo no OSX, mas recebi alguns coment√°rios de que ele n√£o funciona corretamente no Linux. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora sabemos tudo sobre a execu√ß√£o de um ataque de redefini√ß√£o de TCP. </font><font style="vertical-align: inherit;">O atacante deve:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assista ao tr√°fego de rede ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"cheirar"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) entre duas v√≠timas</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cheire o segmento TCP com o sinalizador ativado </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e leia seu n√∫mero confirmado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie um segmento TCP falso com o sinalizador ativado </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e um n√∫mero de sequ√™ncia igual ao n√∫mero confirmado do segmento interceptado (observe que isso implica uma transmiss√£o lenta; caso contr√°rio, o n√∫mero de sequ√™ncia selecionado ficar√° rapidamente desatualizado. (Para aumentar as chances de sucesso, voc√™ pode transferir v√°rios segmentos </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um grande intervalo de n√∫meros de sequ√™ncia) .)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envie segmentos falsos para uma ou ambas as v√≠timas, esperando que isso interrompa a conex√£o TCP</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para praticar, vamos realizar um ataque TCP contra n√≥s mesmos no mesmo computador, comunicando-nos atrav√©s de n√≥s </font></font><code>localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Para isso, precisamos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar conex√£o TCP entre duas janelas de terminal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escreva um programa de ataque que lide com o tr√°fego de sniffing</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifique o programa para que ele produz e envie segmentos falsos </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos come√ßar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Estabelecendo uma conex√£o TCP entre duas janelas do terminal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos configurar a conex√£o TCP usando a ferramenta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><code>netcat</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que por padr√£o est√° dispon√≠vel em muitos sistemas operacionais. </font><font style="vertical-align: inherit;">Qualquer outro </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cliente TCP far√°</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Na primeira janela do terminal, executaremos o seguinte comando:</font></font><br>
<br>
<blockquote><code>nc -nvl 8000</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este comando inicia um servidor TCP que est√° escutando uma porta em nossa m√°quina local </font></font><code>8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Na segunda janela do terminal, execute o seguinte comando:</font></font><br>
<br>
<blockquote><code>nc 127.0.0.1 8000</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este comando tenta criar uma conex√£o TCP com a m√°quina pelo endere√ßo IP da </font></font><code>127.0.0.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">porta </font></font><code>8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Agora, entre as duas janelas do terminal, uma conex√£o TCP deve ser estabelecida. </font><font style="vertical-align: inherit;">Tente inserir algo em uma janela - os dados ter√£o que ser transmitidos pela conex√£o TCP e aparecer em outra janela.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/911/301/786/911301786c4f56287f80d38f67ef73f6.gif"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Cheirar o tr√°fego</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escreveremos um programa de ataque que executa a detec√ß√£o de tr√°fego usando a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><code>scapy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">popular biblioteca de rede Python. </font><font style="vertical-align: inherit;">Este programa usa scapy para ler dados transferidos entre duas janelas do terminal, embora n√£o fa√ßa parte da conex√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo do programa √© publicado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meu reposit√≥rio no GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O programa fareja o tr√°fego de conex√£o e o exibe no terminal. </font><font style="vertical-align: inherit;">O n√∫cleo principal do c√≥digo √© a chamada de m√©todo </font></font><code>sniff</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da biblioteca </font></font><code>scapy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localizada no final do arquivo:</font></font><br>
<br>
<pre><code class="python hljs">t = sniff(<font></font>
        iface=<span class="hljs-string">'lo0'</span>,<font></font>
        lfilter=is_packet_tcp_client_to_server(localhost_ip, localhost_server_port, localhost_ip),<font></font>
        prn=log_packet,<font></font>
        count=<span class="hljs-number">50</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este trecho de c√≥digo nos diz </font></font><code>scapy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para cheirar pacotes na interface </font></font><code>lo0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e capturar detalhes de todos os pacotes como parte de nossa conex√£o TCP. </font><font style="vertical-align: inherit;">A chamada possui os seguintes par√¢metros:</font></font><br>
<br>
<ul>
<li><code>iface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ordens </font></font><code>scapy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para ouvir a interface de rede </font></font><code>lo0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou host local</font></font></li>
<li><code>lfilter</code> ‚Äî  ,  <code>scapy</code>   ,      IP- localhost   .   ,        ,   <code>lo0</code>.     ,     .</li>
<li><code>prn</code> ‚Äî ,  <code>scapy</code>     ,    <code>lfilter</code>.          .       ,      <code>RST</code>.</li>
<li><code>count</code> ‚Äî  ,  <code>scapy</code>    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para testar este programa, configure a conex√£o TCP da etapa 1. Clone meu reposit√≥rio GitHub, siga as instru√ß√µes de configura√ß√£o e execute o programa na terceira janela do terminal. </font><font style="vertical-align: inherit;">Digite algum texto em um dos terminais da conex√£o TCP. </font><font style="vertical-align: inherit;">Voc√™ deve ver que o programa come√ßar√° a registrar informa√ß√µes sobre os segmentos de conex√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Enviando pacotes falsos </font></font><code>RST</code></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estabelecemos uma conex√£o e o programa pode detectar todos os segmentos TCP que passam por ela. A √∫nica coisa que resta √© modificar o programa para que ele execute um ataque de redefini√ß√£o de TCP transmitindo segmentos falsos </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para fazer isso, mudaremos a fun√ß√£o </font></font><code>prn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(veja a lista de par√¢metros acima), chamada </font></font><code>scapy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de pacotes que atendem aos requisitos da fun√ß√£o </font></font><code>lfilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Na vers√£o modificada da fun√ß√£o, em vez de simplesmente consertar o pacote correspondente, estudamos, extra√≠mos os par√¢metros necess√°rios e usamos esses par√¢metros para criar e enviar o segmento </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que tenhamos interceptado um segmento que vai de </font></font><code>(src_ip, src_port)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font><code>(dst_ip, dst_port)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ele tem um sinalizador definido </font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o n√∫mero de confirma√ß√£o √© 100.000. Para fabricar e enviar um segmento, n√≥s:</font></font><br>
<br>
<ul>
<li>  IP-   ,    .  ,         .          ,  .</li>
<li>  <code>RST</code> ,     ,    <code>RST</code></li>
<li>        ,      ,    </li>
<li>  <code>send</code>  <code>scapy</code>     ‚Äî   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para modificar nosso programa anterior, conforme necess√°rio, remova </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coment√°rio </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">desta linha</font></a><font style="vertical-align: inherit;"> e comente a linha acima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora estamos prontos para um ataque em grande escala. </font><font style="vertical-align: inherit;">Configure a conex√£o TCP de acordo com a etapa 1. Execute o programa de ataque da etapa 2 na terceira janela do terminal. </font><font style="vertical-align: inherit;">Em seguida, digite algum texto em um dos terminais da conex√£o TCP. </font><font style="vertical-align: inherit;">No terminal em que voc√™ digitou o texto, a conex√£o TCP ser√° interrompida repentina e misteriosamente. </font><font style="vertical-align: inherit;">O ataque est√° feito!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad9/2a2/b18/ad92a2b18c1533c47d88ab4ff10dedf7.gif"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalho adicional</font></font></h3><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continue experimentando com a ferramenta de ataque. </font><font style="vertical-align: inherit;">Acompanhe o que acontece se voc√™ adicionar ou subtrair 1 do n√∫mero de sequ√™ncia do pacote </font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Verifique se ele deve ser </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exatamente</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> igual ao valor do </font></font><code>ack</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacote interceptado.</font></font></li>
<li> Wireshark       <code>lo0</code>    .            TCP-,       <code>RST</code>.   <code>ip.src == 127.0.0.1 &amp;&amp; ip.dst == 127.0.0.1 &amp;&amp; tcp.port == 8000</code>       .</li>
<li>  ,      .           <code>RST</code>,       <code>RST</code>         ,      .   ,      <code>RST</code>,       .</li>
</ol><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ataque de redefini√ß√£o do TCP √© profundo e simples ao mesmo tempo. </font><font style="vertical-align: inherit;">Boa sorte com suas experi√™ncias e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deixe-me saber</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se voc√™ tiver perguntas ou coment√°rios.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt499884/index.html">11 coisas que eu entendi sobre o CustDev</a></li>
<li><a href="../pt499894/index.html">Casa de cantar coisas. Revis√£o do Rastreador de Chaves Inteligentes Chipolo ONE</a></li>
<li><a href="../pt499896/index.html">Estamos saindo para o site remoto corretamente: como organizar nosso trabalho e o trabalho do projeto no Telegram?</a></li>
<li><a href="../pt499898/index.html">Como as pessoas de TI se relacionam com a quarentena, o que fazem no auto-isolamento e o que usam</a></li>
<li><a href="../pt499900/index.html">An√°lise de produtos mitap: gr√°tis, sem contato, on-line</a></li>
<li><a href="../pt499904/index.html">"Eu estou assustado". O que fazer?</a></li>
<li><a href="../pt499906/index.html">Exemplos de uso de RA na ind√∫stria de brinquedos</a></li>
<li><a href="../pt499910/index.html">Equil√≠brio na tomada de decis√£o. Garfo "experi√™ncia aleat√≥ria"</a></li>
<li><a href="../pt499920/index.html">Pequenos truques do SSH</a></li>
<li><a href="../pt499922/index.html">Finalmente, lidamos com a taxa de transmiss√£o Modbus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>