<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✍🏻 ✊🏼 🧗🏼 ホームクラウドの作成の歴史。パート5. 2019の更新-PHP 7.2、MariaDB 10.4およびNextcloud 17 🍆 🎻 🌥️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="2年前、Debian 8をベースにWebサーバーを作成し、その上でNextcloud 11サービスを起動することに関する一連の記事を公開しました。数か月後、Debian 9へのNextcloud 13のインストールに関する「差分」情報を含むアドオンがありました。2018年の終わりには、 Debian...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ホームクラウドの作成の歴史。パート5. 2019の更新-PHP 7.2、MariaDB 10.4およびNextcloud 17</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483842/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2年前、Debian 8をベースにWebサーバーを作成し、その上でNextcloud 11サービスを起動することに関する一連の記事を公開しました。数か月後、Debian 9へのNextcloud 13のインストールに関する「差分」情報を含むアドオンがありました。2018年の終わりには、 DebianとNextcloudを更新し、異常または興味深い問題は発生しませんでした。 2019年の終わりのアップデートは、すでにより興味深く、書く価値がありました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/it/6i/ct/it6ictbqrbril4nm7mdiyo16tca.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事は、最後の4つの記事の指示に従って、Debian 9でNextcloud 13を「集めた」（Nextcloudの10人のサブスクライバー、特にこれがLinuxの世界で初めての経験者に挨拶を送る）人々に主に役立ちます。</font><font style="vertical-align: inherit;">サービスをゼロから作成することを計画している場合は、このシリーズの最初の4つの記事を、経験豊富なLinuxユーザー向けに、Debian 10とNextcloud 17の現在のバージョンに合わせて調整することをお勧めします。記事は、「ささいで役に立たない」と「悪くない」のどちらかになるかもしれません。オールインワンプレースのチートシート。」</font></font><br>
<a name="habracut"></a><br>
<hr><a name="chap0"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目次</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 1.   Debian   </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 2.   —  LAMP  Debian</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 3.    —    Nextcloud</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 4.  2018 – Debian 9  Nextcloud 13</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> 5.  2019 – PHP 7.2, MariaDB 10.4  Nextcloud 17</a><br>
<br>
<hr><br>
<h3>   </h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Debian</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> PHP   7.2</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> MariaDB   10.4</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Nextcloud   17</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a><br>
<br>
<hr><a name="chap1"></a><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、Debian 10にNginxをインストールして構成したかったのですが、その上に現在のNextcloud 17が問題なくインストールされていたはずですが、これをすべて選択できなかったため、この記事はNextcloudを13から現在のバージョン17に予備からアップグレードするための一連の手順です。 Webサーバーの準備。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Webサーバー側で根本的な変更が必要な理由を説明する必要があります。私たちのサーバーは、現在サポートされているDebian 9に基づいています。オペレーティングシステムを更新するだけで、Webサーバーのすべてのコンポーネントに少なくともセキュリティアップデートが提供されます。 Nextcloud 13をさらに使用したり、バージョン14のみにアップグレードしたりすると、すべてがうまくいきますが、Nextcloud 13はサポートされなくなり、14番目のバージョンのサポートはオンザフライで行われます。 15番目のバージョンから、Nexctcloudはデータベースをbig intに変換して4バイトエンコーディングをサポートすることを提案しますが、MariaDB 10.1ではこれは非常に問題になります。 Nexctcloud 17はPHP 7.1-7.3を必要としますが、Debian 9はネイティブリポジトリにバージョン7.0のみを含んでいます。信頼性と予測可能性の観点から、最後から2番目のバージョンのNextcloudにアップグレードする方が正しいでしょう。しかし、数年前からこのサービスの信頼性を確信していたので、最新バージョンにアップグレードし、将来のために予約を入れてWebサーバーを更新しました。したがって、Nexctcloud 17にアップグレードするには、MariaDBを現在の安定したバージョン10.4に、PHPを7.2にアップグレードするのが最適です。これは7.2であり、関連性のない7.4です。実際、Nextcloud 13にはPHP 5.6、7.0-7.2が必要であり、Nexctcloud 17にはPHP 7.1-7.3が必要です。アップグレードアクションを最小限に抑えるには、PHP 7.2を使用すると便利です。 Apacheサーバーを更新する必要はありません。Debianサポートチームが配布するセキュリティ更新をインストールするだけです。ただし、更新の場合、MariaDBとPHPは外部リポジトリに接続する必要があります。Nexctcloud 17にアップグレードするには、MariaDBを現在の安定したバージョン10.4、およびPHP-7.2に更新することが最適です。これは7.2であり、関連性のない7.4です。実際、Nextcloud 13にはPHP 5.6、7.0-7.2が必要であり、Nexctcloud 17にはPHP 7.1-7.3が必要です。アップグレードアクションを最小限に抑えるには、PHP 7.2を使用すると便利です。 Apacheサーバーを更新する必要はありません。Debianサポートチームが配布するセキュリティ更新をインストールするだけです。ただし、更新の場合、MariaDBとPHPは外部リポジトリに接続する必要があります。Nexctcloud 17にアップグレードするには、MariaDBを現在の安定したバージョン10.4、およびPHP-7.2に更新することが最適です。これは7.2であり、関連性のない7.4です。実際、Nextcloud 13にはPHP 5.6、7.0-7.2が必要であり、Nexctcloud 17にはPHP 7.1-7.3が必要です。アップグレードアクションを最小限に抑えるには、PHP 7.2を使用すると便利です。 Apacheサーバーを更新する必要はありません。Debianサポートチームが配布するセキュリティ更新をインストールするだけです。ただし、更新の場合、MariaDBとPHPは外部リポジトリに接続する必要があります。Apacheサーバーを更新する必要はありません。Debianサポートチームが配布するセキュリティ更新をインストールするだけです。ただし、更新の場合、MariaDBとPHPは外部リポジトリに接続する必要があります。Apacheサーバーを更新する必要はありません。Debianサポートチームが配布するセキュリティ更新をインストールするだけです。ただし、更新の場合、MariaDBとPHPは外部リポジトリに接続する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nextcloudを初めて知ったとき、私はそれを「手動で」更新しました。Webサイトはコンソールから特別なチームによってメンテナンスモードになり、サイトの新しいバージョンのアーカイブが手動でダウンロードされて解凍され、ファイルが更新され、更新手順が開始されました。サイト、データベース、ユーザーデータをバックアップするのは面倒ではありませんでしたが、このような更新は通常、期待どおりの結果をもたらしました。しかし、自動更新は時々あらゆる種類の驚きをもたらしました。しかし、それはずっと前のことです。それ以来、エンジンの安定性は大幅に向上しました。今回は、Webインターフェイスのみを使用して更新を行いました。確かに、コマンドラインから抜け出すことはまだ不可能でした。新しい各バージョンの反復的な更新中に、さまざまな警告と通知がコントロールパネルに表示されます。これらは「削除」する必要があります。コマンドラインで意味のあるコマンドを実行する。これを行うことはできません-サービスは引き続き機能します。このアプローチは根本的に間違っていますが、発生した問題を意図的に整理する前に、Nextcloudはこのモードで3か月間私に役立ちました。</font></font><br>
<br>
<hr><a name="chap2"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debainアップデート</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webサーバーを停止します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># service apache2 stop</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして更新：</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># apt-get update</span>
<span class="hljs-comment"># apt-get dist-upgrade</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アップデート後、OSバージョンを確認し、再起動を確認して、アップデート後にすべてが正常に開始することを確認できます。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># cat /etc/debian_version</span>
<span class="hljs-comment"># reboot</span></code></pre></b><br>
<hr><a name="chap3"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPをバージョン7.2に更新</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webサーバーを停止します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># service apache2 stop</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書とPPAキー、PHPリポジトリを追加します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># apt install ca-certificates apt-transport-https</span>
<span class="hljs-comment"># wget -q https://packages.sury.org/php/apt.gpg -O- | apt-key add -</span>
<span class="hljs-comment"># echo "deb https://packages.sury.org/php/ stretch main" | tee /etc/apt/sources.list.d/php.list</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
古いバージョンのPHP 7.0を削除すると、phpremadminも削除されます。これは、autoremoveを使用して、削除されたパッケージから「トレース」をクリアするためです。</font><font style="vertical-align: inherit;">phpmyadminに特別な設定は行われず、再インストールしても問題はないため、これはそれほど問題にはなりません。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># apt-get purge php7*</span>
<span class="hljs-comment"># apt-get --purge autoremove</span>
<span class="hljs-comment"># apt-get update</span>
<span class="hljs-comment"># apt-get install php7.2 phpmyadmin</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nextcloud 17に必要なモジュールのインストール：</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># apt-get install php7.2-mysql php7.2-curl php7.2-xml php7.2-gd php7.2-json php7.2-mbstring php7.2-zip php7.2-intl</span>
<span class="hljs-comment"># apt-get install php-memcached php-apcu php-redis php-imagick</span></code></pre></b><br>
<sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このテキストはされた</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ために特別に書かれた</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlexanderS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースへのリンクはオプションですが、その参照は非常に望ましいです！</font><font style="vertical-align: inherit;">]</font></font></sup><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PHPのバージョン</font><sup><font style="vertical-align: inherit;">を</font></sup><font style="vertical-align: inherit;">確認し、Webサーバーを起動して、Nextcloudの操作性を確認します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># php -v</span>
<span class="hljs-comment"># service apache2 start</span></code></pre></b><br>
<hr><a name="chap4"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDBをバージョン10.4に更新する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトのウェブサイトには、</font><font style="vertical-align: inherit;">OSとそのリリースを指定し、データベースのバージョンを選択する必要</font><font style="vertical-align: inherit;">がある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深いページ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があります。</font><font style="vertical-align: inherit;">選択すると、リポジトリを追加するためのコードが生成されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webサーバーを停止します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># service apache2 stop</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リポジトリを追加してパッケージを更新します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># apt-get install software-properties-common dirmngr</span>
<span class="hljs-comment"># apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 0xF1656F24C74CD1D8</span>
<span class="hljs-comment"># add-apt-repository 'deb [arch=amd64,i386,ppc64el] http://mariadb.mirror.iweb.com/repo/10.4/debian stretch main'</span>
<span class="hljs-comment"># apt-get update</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MariaDBをインストールすると、パッケージマネージャーは以前のバージョンを正しく削除して新しいバージョンをインストールし、すべてのデータベースが保存されます。</font><font style="vertical-align: inherit;">ただし、Nextcloudデータベースのバックアップはもちろん推奨されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MariaDBをインストールして、更新手順を実行します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># apt-get install mariadb-server</span>
<span class="hljs-comment"># mysql_upgrade u root -p</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パスワードを入力すると、MariaDBが更新さ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れ、2番目の部分の指示に従って</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パスワードを構成できるようになります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># mysql_secure_installation</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webサーバーを起動し、Nextcloudのパフォーマンスを確認します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># service apache2 start</span></code></pre></b><br>
<hr><a name="chap5"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nextcloudのバージョン17への更新</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新を開始するには、管理エントリでサービスにログインし、設定に進み、管理セクションの「一般設定」を開く必要があります。 Nextcloudは、インストールされているバージョンと更新可能なバージョンを表示します。これは、[更新ウィンドウを開く]ボタンをクリックして起動できます。開始後、Nextcloudはバックアップを作成し、更新ファイルをダウンロードして整合性をチェックし、メンテナンスモードをオンにしてファイルを更新します。 「メンテナンスモードをアクティブにしておく」という質問に続くのは何ですか？ここで注意する必要があります。肯定的な回答の場合、サイトはメンテナンスモードのままになります。管理者は次に何をすべきかを知っており、手動で行うことが前提となっています。それ以外の場合は、Nextcloudがすべてを自動的に実行するため、[いいえ]をクリックして続行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新は繰り返し実行されます。</font><font style="vertical-align: inherit;">Nextcloud 13.xは14.xの最新バージョンにアップグレードします。</font><font style="vertical-align: inherit;">その後、管理センターに戻って、今すぐ14.xから15.xへの更新を開始する必要があります。</font><font style="vertical-align: inherit;">など、最後の可能な現在のバージョンに到達するまで。</font><font style="vertical-align: inherit;">各更新後、管理セクションの[全般設定]ページに、発生した提案と問題のリスト、およびそれらを解決するための推奨事項が表示されます。</font><font style="vertical-align: inherit;">以下では、各更新後に何を行う必要があるかについて説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新前</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nextcloudの最近のバージョンでは、PHP OPcacheを有効にしてパフォーマンスを向上させることをお勧めします。</font><font style="vertical-align: inherit;">OPcacheがPHP 5で登場してから、数年前にこの瞬間を見落としたのは奇妙です。/etc/php/7.2/apache2/php.iniで、次のパラメーターのコメントを外して編集する必要があります。</font></font><br>
<br>
<b><pre><code class="bash hljs">opcache.enable=1<font></font>
opcache.enable_cli=1<font></font>
opcache.interned_strings_buffer=8<font></font>
opcache.max_accelerated_files=10000<font></font>
pcache.memory_consumption=128<font></font>
opcache.save_comments=1<font></font>
opcache.revalidate_freq=1</code></pre></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.xを更新-&gt; 14.x</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
テーブルインデックスを復元：</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ db:add-missing-indices</span></code></pre></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.x-&gt; 15.xを更新します。4</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
バイトのエンコードを有効にするように</font><b><font style="vertical-align: inherit;">nextcloud</font></b><font style="vertical-align: inherit;">データベースを</font><b><font style="vertical-align: inherit;">準備し</font></b><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># mysql -u root -p</span><font></font>
MariaDB [(none)]&gt; ALTER DATABASE nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;<font></font>
MariaDB [(none)]&gt; quit</code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nextcloudで4バイトエンコーディングのサポートを有効にします。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ config:system:set mysql.utf8mb4 --type boolean --value="true"</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テーブルを変換します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ maintenance:repair</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
失われたテーブルインデックスを回復します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ db:add-missing-indices</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テーブルインデックスをbigintに変換します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ db:convert-filecache-bigint</span></code></pre></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新15.x-&gt; 16.x</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
失われたテーブルインデックスを回復します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ db:add-missing-indices</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テーブルインデックスをbigintに変換します。</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ db:convert-filecache-bigint</span></code></pre></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.xを更新-&gt; 17.x</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
さらなるアクションは必要ありません。</font></font><br>
<br>
<hr><a name="chap6"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あとがき</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この指示に従って、Nextcloud 13を備えた仮想マシンが更新されました。仮想マシンを使用すると、問題が発生した場合に以前に保存した仮想マシンファイルを返して最初からやり直すことができるため、Nextcloudファイルとそのデータベースをバックアップできません。ただし、これはユーザーデータフォルダーには適用されません。これは、Nextcloud仮想マシンでバックアップすることもお勧めします。私の場合、「クラウド」は自動バージョン管理のリモートフォルダーとして使用されており、同期の方向は「そこだけ」であり、このデータの損失は重要ではありませんでした。数時間だけ再度同期する必要があります。私の人生によって開発された「安全を守る」ルールを無視したにもかかわらず、更新はスムーズに進み、すべてのクライアントもNextcloud 17で問題なく収益を得ました。感心しました、フランクカーリチェク-あなたとあなたのチームは素晴らしい仕事をしています！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新後、私はユーザーデータをクリーンアップすることに決めました。統計から判断すると、2テラバイトを占めていました。</font><font style="vertical-align: inherit;">私はそれほど多くの運用データを持っていませんでした-ボリュームのほとんどは、バージョンファイルと削除されたファイルで占められていました。</font><font style="vertical-align: inherit;">私が遭遇した問題は、1人のユーザーが削除したデータ（ボリュームではなく量-たくさんの小さなファイル）が多すぎて、NextcloudがそれらをWebインターフェースに表示できないことでした。</font><font style="vertical-align: inherit;">管理ガイドを調べた後、コマンドラインから解決策を見つけました。</font><font style="vertical-align: inherit;">多分これは誰かにとって重宝するでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーuserの削除されたファイルをクリアするには：</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ trashbin:cleanup user</span></code></pre></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーのユーザーバージョンファイルをクリアするには：</font></font><br>
<br>
<b><pre><code class="bash hljs"><span class="hljs-comment"># sudo -u www-data php /var/www/nextcloud/occ versions:cleanup user</span></code></pre></b><br>
<hr><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
戻り</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、目次に</font></a><font style="vertical-align: inherit;">戻り</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホームクラウドの作成の歴史。</font><font style="vertical-align: inherit;">パート5. 2019の更新-PHP 7.2、MariaDB 10.4およびNextcloud 17 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テキストバージョン：1.1.1。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初版発行日：2020年1月15日。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終編集日：2020年1月15日。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新ログ</font></font></b><div class="spoiler_text">1.1.1 [15-01-2020]<br>
 .<br>
<br>
1.1.0 [15-01-2020]<br>
     nexcloud    .<br>
<br>
1.0.0 [15-01-2020]<br>
 .<br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja483824/index.html">私の5つのルールを学び、夢の仕事を手に入れ、前向きに考え、それを前進させる方法...</a></li>
<li><a href="../ja483826/index.html">Voアナログ出力を使用したCO2センサーモデルMH-Z19Bの接続</a></li>
<li><a href="../ja483828/index.html">輝きと貧困の原子交換</a></li>
<li><a href="../ja483830/index.html">iOSのルーティング：アプリケーションを書き直さないユニバーサルナビゲーション</a></li>
<li><a href="../ja483834/index.html">Debian：単にi386をamd64に変える</a></li>
<li><a href="../ja483844/index.html">ロシアの信用および金融セクターにおける情報保護に関する規制文書の分析</a></li>
<li><a href="../ja483846/index.html">Linuxでの代替ウィンドウ管理</a></li>
<li><a href="../ja483850/index.html">鍋を燃やす神はいない</a></li>
<li><a href="../ja483860/index.html">WHDグローバル2012：安価なドメインの真の価値</a></li>
<li><a href="../ja483862/index.html">マイクロコントローラーの仮想機能-ダークサイド</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>