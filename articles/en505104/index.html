<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õÑÔ∏è ‚§¥Ô∏è üßó How we developed a service that entered the top 5 largest pharmacy sites in the world ü§öüèª ü¶ì ‚úùÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have been developing and supporting Apteka.ru service for 7 years. About 2,300 tasks have been completed during this time! The volume of work is so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How we developed a service that entered the top 5 largest pharmacy sites in the world</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505104/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have been developing and supporting Apteka.ru service for 7 years. </font><font style="vertical-align: inherit;">About 2,300 tasks have been completed during this time! </font><font style="vertical-align: inherit;">The volume of work is so large that to analyze everything is still a challenge. </font><font style="vertical-align: inherit;">But we tried to systematize our experience in order to share it with our colleagues. </font><font style="vertical-align: inherit;">Let's talk about the solutions that helped make the service an online pharmacy No. 1 in Russia - both in terms of turnover and the length of time users stay on the site.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/cr/in/yjcrinumzmmzrlgxpg8j2zyp4aq.png" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Customer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apteka.ru is a federal service for searching and booking medicines and health products, a project of a large pharmaceutical distributor of Runet, JSC NPK Katren. In 2018, the site accounted for 31% of the total sales of online pharmacies. According to the AKIT rating, it is in the TOP-10 in terms of the number of orders among all Russian Internet resources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For 7 years, the service doubled its indicators annually, in 2019, growth accelerated. At the end of 2019, Apteka.ru trade turnover grew by 171% and exceeded 34 billion rubles, while the number of orders increased 2.7 times. Now more than 2 million orders per month are being processed at the site.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apteka.ru assortment includes up to 28,000 items of 840 Russian and foreign brands. </font><font style="vertical-align: inherit;">The service works strictly within the law. </font><font style="vertical-align: inherit;">The client makes an order on the site, information about him enters the system, is processed quickly - and the goods are sent to the selected pharmacy.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Goals and Objectives: Evolution</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the development of the project, the goals and objectives of the customer changed. </font><font style="vertical-align: inherit;">Conventionally, they can be divided into three stages.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First step. </font><font style="vertical-align: inherit;">Start</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Site - a standard online store for CMS 1C-Bitrix. </font><font style="vertical-align: inherit;">The functionality is simple - to demonstrate a catalog of goods and implement a scheme for their redemption through retail outlets of partners.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Second phase. </font><font style="vertical-align: inherit;">Scaling</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the first year of the project‚Äôs development, trade turnover increased 36 times. </font><font style="vertical-align: inherit;">Increased traffic to the site, there was a need to increase conversion, the use of new ways to stimulate sales. </font><font style="vertical-align: inherit;">The service began to turn into a large retail project, and this required a more complex development involving non-standard tools. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main goal was the creation of a stably functioning online store that brings profit to the company through cooperation with suppliers and pharmacies. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Together with the customer, we formulated the main tasks:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usability improvement.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The introduction of new functionality.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration with an external accounting system.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Additional site monetization - to attract more users through marketing tools, loyalty programs, offer advertising services to partners and suppliers.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moreover, the site should meet the following criteria:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adaptability for mobile devices;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loading time - no more than 2-3 seconds (according to data for January 2020 - 1.5 seconds for the main page).</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The third stage. </font><font style="vertical-align: inherit;">Technical support and optimization</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By 2017, the service became one of the leaders in its segment and the only specialized resource in the field of medicine and health in the top 30 largest Russian sites in terms of sales. </font><font style="vertical-align: inherit;">From that moment it was important to maintain and then strengthen the position. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
New tasks have come to the fore:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Updating the service to the current requirements of the customer and the market.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technological stack modernization and code refactoring.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuring the stable operation of a highly loaded project.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redesign and refinement of the interface.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solutions</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scaling</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration with the accounting system</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We have configured communication with an external customer accounting system - SAP Business Explorer (BE). It was necessary to achieve constant dynamic updating of information in 1C-Bitrix: Site Management, so that the site always had up-to-date information. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I had to write integration from scratch. We got a ready-made interworking protocol from BE. We developed interaction on our side for it: processing packets (formed data blocks) coming from BE and sending them to the accounting system.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then the difficulty arose - the number of packets grew so much that we did not have time to send them. To speed up the process, they introduced the RabbitMQ message broker. He helped to significantly increase the performance of sending packets and scale this procedure. Now, if it becomes necessary to send a large number of packets, you can easily increase the number of workers, and they will cope with the increased load. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Customization pricing</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The typical pricing of the online store could not satisfy all the needs of the customer. Upon request, we wrote a customized pricing program that has higher productivity, takes into account the features of the project itself, as well as interactions with customer accounting and pricing systems. The price of a specific product for each user is calculated individually, depending on its customer history and other parameters. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalization of the Bitrix box</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Initially, the Apteka.ru service was developed on Bitrix, since this solution was optimal for the online store - the boxed version allows you to quickly launch the site.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, there is a drawback - the system is configured in a rather narrow range, it is more difficult to customize for the project tasks. </font><font style="vertical-align: inherit;">Therefore, scaling required the development of an expanded software architecture. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apteka.ru offers many products with different names and properties, which complicated filtering and search, slowed down the site. </font><font style="vertical-align: inherit;">I had to do a lot of work with databases and add new functionality for developing modules. </font><font style="vertical-align: inherit;">In particular, we:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We used the Dependency Injection dependency injection container, on the basis of which we built a system of modules - more flexible, convenient, extensible.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implemented Symfony components - a template engine and component for creating console commands. </font><font style="vertical-align: inherit;">This made it possible to facilitate the creation of the visual component of the project, improve the readability of the code, and also expand and redefine the templates without disturbing the operation of the general algorithm.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Among the latter, modules have been developed:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The system of reviews and ratings. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Users got the opportunity to evaluate products of certain categories on a five-point scale, as well as leave feedback on them. </font><font style="vertical-align: inherit;">Comments are published on the site automatically, but the moderator can edit or delete them. </font><font style="vertical-align: inherit;">Technically, this is implemented as follows: the module receives information about for which categories of goods it is possible to leave reviews, and transfers it to the database.</font></font></li>
<li><b>   </b>     PHP.    ,    ,      .</li>
<li><b></b> ‚Äì           .</li>
<li>   -,      150  200 .        ‚Äì ,  , , . </li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration with Yandex cards</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In order to simplify the procedure for ordering medicine as much as possible, the customer suggested using the Yandex.Maps service API. The system automatically determines the user's location and unloads a map with the nearest pharmacies available for delivery. Given that there are more than 80,000 pharmacies in the Apteka.RU project database, this solution was optimal. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search optimization in 3 stages</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We devoted a lot of time to search optimization - the main tool for attracting users to the site. At the start of the project, a number of internal improvements were made to the service to increase the relevance of search results.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The built-in CMS search quickly stopped dealing with incoming requests. We installed and tuned the Sphinx search engine, which then had good performance. The search service began to work quickly and without fail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, a few years later the current version of Sphinx was not so actively supported by the developers, because of which it did not provide the necessary stability. And most importantly, in order to implement the new functionality that was required by the customer, he would have to create a bunch of ‚Äúcrutches‚Äù. Several times due to problems in the search engine there were problems with the availability of the site. We promptly made improvements for the smooth operation of the service. But it became clear - this is not an option.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We decided to switch to Elastic Search - a more modern open source engine. </font><font style="vertical-align: inherit;">Its advantages are more stable operation, high performance, as well as advanced user search capabilities.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Technical support</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When the site was launched, one server was enough for its operation. Attendance quickly began to grow. At first, we coped with the load simply by optimizing the code and SQL queries. And it was possible to achieve a good increase in productivity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But then this resource was exhausted. Opportunities for code optimization became less and less. Then we transferred part of the services (in particular, the database) to other servers. For some time this configuration worked, then this also became insufficient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We began to scale individual services. Instead of a single server, several php servers were added and load balancing between them was organized. The same principle was used when scaling a database - we divided it into several databases, the load between which is balanced.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the start of the project, we used the Apache web server to process requests. But it did not work well at high loads. Then we set up a web server based on Nginx + Php-Fpm technologies, after which the work of the site became much more stable and productive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Service traffic is growing. In 2019, record levels have been achieved in its entire history. More than 11 million users visit the online store per month. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The more popular the service became, the more often DDoS attacks were launched on it. We were ready for this: we constantly increased server capacities, developed server architecture. It was possible to increase fault tolerance due to redistribution of load and server interchangeability.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During massive DDoS attacks, we blocked requests from IP addresses from other countries. </font><font style="vertical-align: inherit;">In addition, in November 2019, they activated the DDoS-Guard service for automated protection against bots. </font><font style="vertical-align: inherit;">This has greatly improved protection against hacker attacks.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Optimization</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The functionality of the service expanded every year. </font><font style="vertical-align: inherit;">New requirements arose for performance, code quality, maintainability, and readability. </font><font style="vertical-align: inherit;">To solve these problems, we used two methods:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code refactoring allows you to reduce the number of user errors, to make the service more stable and secure.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changing the technology stack or working mechanism. </font><font style="vertical-align: inherit;">If more drastic measures are needed, we offer new web solutions.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are a couple of examples:</font></font><br>
<br>
<ul>
<li><b> Doctrine ORM.</b>         , SQL-  API . Doctrine ORM          ,  /     .       ,          .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The logic of the</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mobile application </font><b><font style="vertical-align: inherit;">basket was</font></b><font style="vertical-align: inherit;"> moved to the server side. </font><font style="vertical-align: inherit;">We have configured the transfer of data about the user, his basket and selected products through the API. </font><font style="vertical-align: inherit;">Prior to this, the data was stored autonomously in the mobile application, which prevented promptly making changes. </font><font style="vertical-align: inherit;">For example, on a site, the price of a product has already changed, but not yet in the application. </font><font style="vertical-align: inherit;">Now the basket backend is stored on the server and is equally accessible for both the mobile and desktop versions.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometimes the hardest thing was to convince the customer to opt for a particular solution. </font><font style="vertical-align: inherit;">To do this, we need a proactive position - to justify our opinion, to show specific benefits. </font><font style="vertical-align: inherit;">As a result, we act in the interests of the client - we help to save the budget, we warn against the introduction of obviously ineffective solutions. </font><font style="vertical-align: inherit;">The customer begins to appreciate this and trust our recommendations.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2c/8x/nw/2c8xnwq1b06d7fdrgztxh9hckwg.png" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">results</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have created a platform for the effective scaling of the project. </font><font style="vertical-align: inherit;">We performed a set of works on SEO optimization, technical implementation of marketing activity, and interface development. </font><font style="vertical-align: inherit;">Implemented solutions to expand the server architecture and technical support for a highly loaded project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This contributed to the achievement of customer business results. </font><font style="vertical-align: inherit;">Today Apteka.ru is the only specialized online store that receives orders in an amount commensurate with the largest marketplaces. </font><font style="vertical-align: inherit;">According to Data Insight, in the first half of 2019, the service entered the top three in terms of growth dynamics along with Wildberries and Ozon.ru, and also became the No. 1 traffic service among pharmacy chains.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vw/th/mh/vwthmhoh2gjvrac2xmc-pdtg5ew.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apteka.ru has repeatedly been praised by the professional community and has won prestigious industry awards. </font><font style="vertical-align: inherit;">Latest 2019 Awards:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first place in the ranking of the most frequently used professional sites by pharmacists (according to a survey of pharmacy employees by the analytical company Ipsos).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The diploma of the Green Cross pharmaceutical prize laureate in the nomination ‚ÄúThe best reservation and reservation system‚Äù.</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505078/index.html">BLE under the microscope (ATT GATT ...)</a></li>
<li><a href="../en505080/index.html">Mutex in the world of asynchronous code</a></li>
<li><a href="../en505090/index.html">About translating the words ‚Äúuseful‚Äù / ‚Äúuse‚Äù without use / useful</a></li>
<li><a href="../en505092/index.html">How I got a job at Microsoft</a></li>
<li><a href="../en505098/index.html">Snom D717 IP Phone Review</a></li>
<li><a href="../en505106/index.html">Dry water and sea knee-deep</a></li>
<li><a href="../en505108/index.html">Linux tuning to improve PostgreSQL performance. Ilya Kosmodemyansky</a></li>
<li><a href="../en505114/index.html">Transport on June 3: a week of good news (and how to drive around the country now)</a></li>
<li><a href="../en505116/index.html">Overview of the 3D dental scanner Medit Identica T300</a></li>
<li><a href="../en505118/index.html">Google Ads Editor for Mass Advertising Management: Customization and 7 Usage Examples</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>