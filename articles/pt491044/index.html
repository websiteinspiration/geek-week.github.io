<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïô „Ä∞Ô∏è üö∂üèΩ Orchestrator e VIP como solu√ß√£o de alta disponibilidade para cluster MySQL üîú üßòüèæ üë©üèæ‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No CityMobile, usamos o banco de dados MySQL como armazenamento principal para dados persistentes. Temos v√°rios clusters de banco de dados para v√°rios...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Orchestrator e VIP como solu√ß√£o de alta disponibilidade para cluster MySQL</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/citymobil/blog/491044/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No CityMobile, usamos o banco de dados MySQL como armazenamento principal para dados persistentes. </font><font style="vertical-align: inherit;">Temos v√°rios clusters de banco de dados para v√°rios servi√ßos e prop√≥sitos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A disponibilidade constante do assistente √© um indicador cr√≠tico da integridade de todo o sistema e de suas partes individuais. </font><font style="vertical-align: inherit;">A recupera√ß√£o autom√°tica de cluster no caso de uma falha do assistente reduz bastante o tempo de resposta a incidentes e o tempo de inatividade do sistema. </font><font style="vertical-align: inherit;">Neste artigo, examinarei um cluster de alta disponibilidade do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> baseado no </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">MySQL Orchestrator</font></a><font style="vertical-align: inherit;"> e em endere√ßos IP virtuais (VIP).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dn/78/bb/dn78bbg_qvozrgufsyzr0joysuw.png"><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solu√ß√£o VIP HA</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, falarei brevemente sobre como √© o nosso sistema de armazenamento de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos o esquema de replica√ß√£o cl√°ssico com um assistente somente grava√ß√£o e muitas r√©plicas somente leitura. Um cluster pode conter um mestre intermedi√°rio - um n√≥ que √© uma r√©plica e um mestre para outros. Os clientes acessam r√©plicas atrav√©s do HAProxy, que permite distribui√ß√£o uniforme de carga e f√°cil escalabilidade. O uso do HAProxy √© devido a raz√µes hist√≥ricas e agora estamos migrando para o ProxySQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A replica√ß√£o √© semi-s√≠ncrona com base em</font></font><code>GTID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Isso significa que pelo menos uma r√©plica deve gravar a transa√ß√£o no log antes de ser considerada bem-sucedida. Esse modo de replica√ß√£o fornece um equil√≠brio ideal entre desempenho e seguran√ßa dos dados em caso de falha do n√≥ principal. Basicamente, todas as altera√ß√µes s√£o transferidas do mestre para r√©plicas usando </font></font><code>Row Based Replication (RBR)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas alguns n√≥s podem ter </font></font><code>mixed binlog format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O orquestrador atualiza periodicamente o estado da topologia do cluster, analisa as informa√ß√µes recebidas e, em caso de problemas, pode iniciar o procedimento de recupera√ß√£o autom√°tica. O desenvolvedor √© respons√°vel pelo pr√≥prio procedimento, pois ele pode ser implementado de v√°rias maneiras: com base no VIP, DNS, usando servi√ßos de descoberta de servi√ßo ou mecanismos independentes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das maneiras mais f√°ceis de restaurar um assistente em caso de falha √© usar endere√ßos VIP flutuantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que voc√™ precisa saber sobre esta solu√ß√£o antes de prosseguir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VIP √© um endere√ßo IP que n√£o est√° vinculado a uma interface de rede f√≠sica espec√≠fica. </font><font style="vertical-align: inherit;">Quando um n√≥ falha ou durante o trabalho agendado, podemos alternar o VIP para outro recurso com tempo de inatividade m√≠nimo.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liberar e emitir um endere√ßo IP virtual √© uma opera√ß√£o barata e r√°pida.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para trabalhar com o VIP, √© necess√°rio acessar o servidor via SSH ou usar ferramentas especiais, por exemplo </font></font><code>keepalived</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos considerar poss√≠veis problemas com o nosso mestre e imaginar como o mecanismo de recupera√ß√£o autom√°tica deve funcionar.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A conectividade de rede com o mestre desapareceu ou ocorreu um problema no n√≠vel do hardware e o servidor est√° indispon√≠vel</font></font></h4><br>
<ol>
<li>   ,      .     ,     ,   .<br>
</li>
<li>  VIP    ‚Äî .<br>
</li>
<li>    .  .<br>
</li>
<li>     VIP.   VIP  ,        <b>gratuitous ARP</b>.   /        IP-  MAC-,       VIP.    <code>split brain</code>    . <br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas as novas conex√µes s√£o redirecionadas imediatamente para o novo mestre. </font><font style="vertical-align: inherit;">As conex√µes antigas falham, chamadas repetidas s√£o feitas no banco de dados no n√≠vel do aplicativo.</font></font><br>
</li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O servidor est√° operando no modo normal; ocorreu uma falha no n√≠vel do DBMS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O algoritmo √© semelhante ao caso anterior: atualizando a topologia e iniciando o processo de recupera√ß√£o. </font><font style="vertical-align: inherit;">Como o servidor est√° dispon√≠vel, liberamos o VIP com √™xito no mestre antigo, transferimos para o novo e enviamos v√°rias solicita√ß√µes de ARP. </font><font style="vertical-align: inherit;">O poss√≠vel retorno do assistente antigo n√£o deve afetar o cluster reconstru√≠do e o aplicativo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros problemas</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A falha de r√©plicas ou mestres intermedi√°rios </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o leva</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a a√ß√µes autom√°ticas e requer interven√ß√£o manual. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A interface de rede virtual √© sempre adicionada temporariamente, ou seja, ap√≥s a reinicializa√ß√£o, o servidor VIP n√£o √© automaticamente atribu√≠do. </font><font style="vertical-align: inherit;">Cada inst√¢ncia do banco de dados √© iniciada por padr√£o no modo somente leitura, o orquestrador muda automaticamente o novo mestre para grava√ß√£o e tenta instalar </font></font><code>read only</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no antigo mestre. </font><font style="vertical-align: inherit;">Essas a√ß√µes visam reduzir a probabilidade </font></font><code>split brain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o processo de recupera√ß√£o, podem surgir problemas, que tamb√©m devem ser notificados por meio da interface do usu√°rio do orquestrador, al√©m das ferramentas de monitoramento padr√£o. </font><font style="vertical-align: inherit;">Expandimos a API REST adicionando esse recurso (o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° atualmente em considera√ß√£o).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O esquema geral da solu√ß√£o de HA √© apresentado abaixo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yl/pk/gk/ylpkgksjn1cfj0wdbil7dje9qss.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escolhendo um novo assistente</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A orquestra √© inteligente o suficiente e tenta escolher a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©plica mais adequada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como novo mestre, de acordo com os seguintes crit√©rios:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atraso da r√©plica do mestre;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assistente de MySQL e vers√£o de r√©plica;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipo de replica√ß√£o (RBR, SBR ou mista);</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localiza√ß√£o em um ou em diferentes data centers;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disponibilidade </font></font><code>errant GTID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- transa√ß√µes realizadas na r√©plica e ausentes no mestre;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regras de sele√ß√£o personalizadas tamb√©m s√£o levadas em considera√ß√£o.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nem toda r√©plica √© um candidato ideal para o papel de mestre. </font><font style="vertical-align: inherit;">Por exemplo, uma r√©plica pode ser usada para fazer backup de dados ou o servidor tem uma configura√ß√£o de hardware mais fraca. </font><font style="vertical-align: inherit;">O orquestrador </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suporta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regras manuais, com as quais voc√™ pode ajustar suas prefer√™ncias para escolher um candidato, do mais preferido ao ignorado.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempo de resposta e recupera√ß√£o</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso de um incidente, √© importante minimizar o tempo de inatividade do sistema; portanto, consideramos os par√¢metros do MySQL que afetam a constru√ß√£o e a atualiza√ß√£o da topologia de cluster pela orquestra:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>slave_net_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- o n√∫mero de segundos durante os quais a r√©plica aguarda novos dados ou um sinal de pulsa√ß√£o do mestre antes que a conex√£o seja reconhecida como perdida e a reconex√£o seja realizada. </font><font style="vertical-align: inherit;">Quanto menor o valor, mais r√°pida a r√©plica poder√° determinar que a conex√£o com o mestre est√° interrompida. </font><font style="vertical-align: inherit;">Definimos esse valor para 5 segundos.</font></font><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>MASTER_CONNECT_RETRY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- o n√∫mero de segundos entre as tentativas de reconex√£o. </font><font style="vertical-align: inherit;">No caso de problemas de rede, um valor baixo desse par√¢metro permitir√° que voc√™ se reconecte rapidamente e evite o in√≠cio do processo de recupera√ß√£o de cluster. </font><font style="vertical-align: inherit;">O valor recomendado √© de 1 segundo.</font></font><br>
</li>
<li><code>MASTER_RETRY_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - O n√∫mero m√°ximo de tentativas para reconectar. </font></font><br>
</li>
<li><code>MASTER_HEARTBEAT_PERIOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- o intervalo em segundos ap√≥s o qual o mestre envia um sinal de pulsa√ß√£o. </font><font style="vertical-align: inherit;">O padr√£o √© metade do valor </font></font><code>slave_net_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Op√ß√µes do orquestrador:</font></font><br>
<br>
<ul>
<li><code>DelayMasterPromotionIfSQLThreadNotUpToDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- se for igual </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a fun√ß√£o do assistente n√£o ser√° aplicada na r√©plica candidata at√© que o fluxo SQL da r√©plica conclua todas as transa√ß√µes n√£o aplicadas do Relay Log. </font><font style="vertical-align: inherit;">Usamos essa op√ß√£o para n√£o perder transa√ß√µes quando todas as r√©plicas candidatas estiverem atrasadas.</font></font><br>
</li>
<li><code>InstancePollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a frequ√™ncia de constru√ß√£o e atualiza√ß√£o da topologia.</font></font><br>
</li>
<li><code>RecoveryPollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- frequ√™ncia de an√°lise de topologia. </font><font style="vertical-align: inherit;">Se um problema for detectado, a recupera√ß√£o da topologia ser√° iniciada. </font><font style="vertical-align: inherit;">Esta √© uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> igual a 1 segundo.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada n√≥ do cluster √© pesquisado pelo orquestrador uma vez a cada </font></font><code>InstancePollSeconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segundo. </font><font style="vertical-align: inherit;">Quando um problema √© detectado, o estado do cluster √© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atualizado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† for√ßa </font><font style="vertical-align: inherit;">e, em seguida, √© tomada a decis√£o final para executar a recupera√ß√£o. </font><font style="vertical-align: inherit;">Ao experimentar v√°rios par√¢metros do banco de dados e da orquestra, conseguimos reduzir a dura√ß√£o da resposta e recupera√ß√£o para 30 segundos.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suporte de teste</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Come√ßamos a testar o esquema de HA, desenvolvendo um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banco de testes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> local </font><font style="vertical-align: inherit;">e implementando-o ainda em um ambiente de teste e combate. </font><font style="vertical-align: inherit;">O estande local √© totalmente automatizado com base no Docker e permite experimentar a configura√ß√£o da orquestra e da rede, escalar o cluster de 2 a 3 servidores para v√°rias dezenas e realizar exerc√≠cios em um ambiente seguro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante os exerc√≠cios, escolhemos um dos m√©todos para emular o problema: atire instantaneamente no assistente </font></font><code>kill -9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, conclua suavemente o processo e pare o servidor ( </font></font><code>docker-compose stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), simule problemas de rede com </font></font><code>iptables -j REJECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>iptables -j DROP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esperamos estes resultados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a orquestra detectar√° problemas com o mestre e atualizar√° a topologia em n√£o mais que 10 segundos;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o procedimento de recupera√ß√£o ser√° iniciado automaticamente: a configura√ß√£o da rede ser√° alterada, o papel do assistente passar√° para a r√©plica, a topologia ser√° reconstru√≠da;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o novo mestre estar√° dispon√≠vel para grava√ß√£o, as r√©plicas ao vivo n√£o ser√£o perdidas no processo de reconstru√ß√£o;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os dados come√ßar√£o a ser gravados no novo mestre e replicados;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o tempo total de recupera√ß√£o n√£o ser√° superior a 30 segundos.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ sabe, um sistema pode se comportar de maneira diferente em ambientes de teste e produ√ß√£o devido a diferentes configura√ß√µes de hardware e rede, diferen√ßas de carga sint√©tica e real, etc. </font><font style="vertical-align: inherit;">Portanto, periodicamente realizamos exerc√≠cios em condi√ß√µes reais, verificando como o sistema se comporta em caso de perda da conectividade da rede ou degrada√ß√£o de suas partes individuais. </font><font style="vertical-align: inherit;">No futuro, queremos construir uma infraestrutura completamente id√™ntica para os dois ambientes e automatizar seus testes.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">achados</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A operacionalidade do n√≥ principal do sistema de armazenamento √© uma das principais tarefas da equipe e opera√ß√£o do SRE. </font><font style="vertical-align: inherit;">A introdu√ß√£o da orquestra e solu√ß√µes de alta disponibilidade baseadas no VIP permitiu alcan√ßar os seguintes resultados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detec√ß√£o confi√°vel de problemas com a topologia do cluster de banco de dados;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resposta autom√°tica e r√°pida a incidentes relacionados ao mestre, o que reduz o tempo de inatividade do sistema.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, a solu√ß√£o tem suas limita√ß√µes e desvantagens:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escalar o esquema de alta disponibilidade para v√°rios data centers exigir√° uma √∫nica rede L2 entre eles;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de atribuir um VIP ao novo mestre, precisamos liber√°-lo no antigo. </font><font style="vertical-align: inherit;">O processo √© seq√ºencial, o que aumenta o tempo de recupera√ß√£o;</font></font><br>
</li>
<li> VIP  SSH-  ,       .      ,   ,     ,   VIP  .            IP-   <code>split brain</code>.<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar </font></font><code>split brain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, voc√™ pode usar o m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STONITH</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (‚ÄúAtire o outro n√≥ na cabe√ßa‚Äù), que isola ou desconecta completamente o n√≥ problem√°tico. </font><font style="vertical-align: inherit;">Existem outras maneiras de implementar a alta disponibilidade do cluster: uma combina√ß√£o de VIP e DNS, descoberta de servi√ßos e servi√ßos de proxy, replica√ß√£o s√≠ncrona e outros m√©todos que t√™m suas desvantagens e vantagens. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu falei sobre a nossa abordagem para criar um cluster de failover do MySQL. </font><font style="vertical-align: inherit;">√â f√°cil de implementar e fornece um n√≠vel aceit√°vel de confiabilidade no ambiente atual. </font><font style="vertical-align: inherit;">Com o desenvolvimento de todo o sistema como um todo e a infraestrutura em particular, essa abordagem sem d√∫vida evoluir√°.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt491032/index.html">‚ÄúRTFM, cara!‚Äù, Ou como o queijo gr√°tis me custou US $ 5. E poderia ter sido em US $ 80 +</a></li>
<li><a href="../pt491034/index.html">WireGuard - VPN r√°pida e segura no kernel do Linux</a></li>
<li><a href="../pt491036/index.html">Quando uma estrutura JavaScript n√£o √© necess√°ria</a></li>
<li><a href="../pt491038/index.html">Yandex abre o Testinguite</a></li>
<li><a href="../pt491040/index.html">Controle de qualidade Meetup em Nizhny - como era e os materiais do evento</a></li>
<li><a href="../pt491050/index.html">Registro para o NeoQUEST-2020: Open World p√≥s-apocal√≠ptico</a></li>
<li><a href="../pt491052/index.html">Como e por que os curadores do HSE de S√£o Petersburgo ajudam os programadores de calouros</a></li>
<li><a href="../pt491054/index.html">Como assinar correspond√™ncia por email com uma chave GPG usando tokens PKCS # 11</a></li>
<li><a href="../pt491056/index.html">Ampere Altra - o primeiro processador ARM de 80 n√∫cleos do mundo</a></li>
<li><a href="../pt491058/index.html">Mortalidade, mortalidade, coronav√≠rus e matan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>