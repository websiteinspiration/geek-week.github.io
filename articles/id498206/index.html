<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüéì üèÖ üê° Buat backend graphql di Golang üë®‚ÄçüöÄ üí£ üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hari ini kita akan mengembangkan aplikasi di Golang + GraphQL. 
 
 Kami sering menggunakan GraphQL pada proyek kami dan tahu banyak tentang itu, mengg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Buat backend graphql di Golang</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498206/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hari ini kita akan mengembangkan aplikasi di Golang + GraphQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami sering menggunakan GraphQL pada proyek kami dan tahu banyak tentang itu, menggunakannya bersama dengan berbagai bahasa pemrograman: Javascript, Ruby, dan sekarang tangan kami telah mencapai titik mencoba bundel Graphang Golang.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Banyak yang telah dikatakan tentang keunggulan bahasa query GraphQL di Internet, banyak yang memuji karena kesederhanaan, fleksibilitas, dan kenyamanannya, baik ketika digunakan di sisi server maupun pada klien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk pengembangan yang nyaman menggunakan GraphQL, GraphiQL atau GraphQL Playground sering dikonfigurasi - antarmuka untuk mengirim permintaan dan melihat dokumentasi API. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menggunakan Playground semacam itu secara lokal, cukup menggunakan solusi open source ini - Golang HTTP.Handler untuk graphl-go. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/872/fcf/818/872fcf818836ec2689737c639fb7beff.png" alt="graphql playground golang"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sepertinya taman bermain berjalan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lanjutkan dengan menulis aplikasi kecil, contoh yang akan mencari cara untuk bekerja dengan GraphQL dan Go. Kode aplikasi lengkap dapat ditemukan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pada tautan di Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, kita akan memulai server dan taman bermain.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
  schema, err := graphql.NewSchema(defineSchema()) <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     log.Panic(<span class="hljs-string">"Error when creating the graphQL schema"</span>, err)<font></font>
  }<font></font>
<font></font>
  h := handler.New(&amp;handler.Config{<font></font>
     Schema:     &amp;schema,<font></font>
     Pretty:     <span class="hljs-literal">true</span>,<font></font>
     GraphiQL:   <span class="hljs-literal">false</span>,<font></font>
     Playground: <span class="hljs-literal">true</span>,<font></font>
  }) <span class="hljs-comment">//      FormatErrorFn -    </span><font></font>
<font></font>
  http.Handle(<span class="hljs-string">"/graphql"</span>, h) <span class="hljs-comment">//      playground    </span>
  err = http.ListenAndServe(<span class="hljs-string">":8080"</span>, <span class="hljs-literal">nil</span>)
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     log.Panic(<span class="hljs-string">"Error when starting the http server"</span>, err)<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tak satu pun dari backend graphql dapat melakukan tanpa deskripsi skema, sekarang kami akan menganalisis deskripsinya.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> User = graphql.NewObject(<font></font>
  graphql.ObjectConfig{<font></font>
     Name: <span class="hljs-string">"User"</span>,<font></font>
     Fields: graphql.Fields{<font></font>
        <span class="hljs-string">"_id"</span>: &amp;graphql.Field{<font></font>
           Type: ObjectID,<font></font>
        },<font></font>
        <span class="hljs-string">"firstName"</span>: &amp;graphql.Field{<font></font>
           Type: graphql.String,<font></font>
        },<font></font>
        <span class="hljs-string">"lastName"</span>: &amp;graphql.Field{<font></font>
           Type: graphql.String,<font></font>
        },<font></font>
        <span class="hljs-string">"email"</span>: &amp;graphql.Field{<font></font>
           Type: graphql.String,<font></font>
        },<font></font>
     },<font></font>
  },<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> UserInput = graphql.NewInputObject(<font></font>
  graphql.InputObjectConfig{<font></font>
     Name: <span class="hljs-string">"UserInput"</span>,<font></font>
     Fields: graphql.InputObjectConfigFieldMap{<font></font>
        <span class="hljs-string">"firstName"</span>: &amp;graphql.InputObjectFieldConfig{<font></font>
           Type: graphql.String,<font></font>
        },<font></font>
        <span class="hljs-string">"lastName"</span>: &amp;graphql.InputObjectFieldConfig{<font></font>
           Type: graphql.Int,<font></font>
        },<font></font>
        <span class="hljs-string">"email"</span>: &amp;graphql.InputObjectFieldConfig{<font></font>
           Type: graphql.String,<font></font>
        },<font></font>
     },<font></font>
  },<font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">defineSchema</span><span class="hljs-params">()</span> <span class="hljs-title">graphql</span>.<span class="hljs-title">SchemaConfig</span></span> {
  <span class="hljs-keyword">return</span> graphql.SchemaConfig{<font></font>
     Query: graphql.NewObject(graphql.ObjectConfig{<font></font>
        Name: <span class="hljs-string">"Query"</span>,<font></font>
        Fields: graphql.Fields{<font></font>
           <span class="hljs-string">"users"</span>: &amp;graphql.Field{<font></font>
              Name:    <span class="hljs-string">"users"</span>,<font></font>
              Type:    graphql.NewList(User),<font></font>
              Resolve: usersResolver,<font></font>
           },<font></font>
        },<font></font>
     }),<font></font>
     Mutation: graphql.NewObject(graphql.ObjectConfig{<font></font>
        Name: <span class="hljs-string">"Mutation"</span>,<font></font>
        Fields: graphql.Fields{<font></font>
           <span class="hljs-string">"addUser"</span>: &amp;graphql.Field{<font></font>
              Name:    <span class="hljs-string">"addUser"</span>,<font></font>
              Type:    User,<font></font>
              Resolve: addUserResolver,<font></font>
              Args: graphql.FieldConfigArgument{<font></font>
                 <span class="hljs-string">"input"</span>: &amp;graphql.ArgumentConfig{<font></font>
                    Type: UserInput,<font></font>
                 },<font></font>
              },<font></font>
           },<font></font>
        },<font></font>
     })}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di atas, kami menggambarkan tipe Pengguna dengan bidang _id, nama depan, nama belakang dan email, yang akan kami gunakan sebagai jenis respons terhadap permintaan. </font><font style="vertical-align: inherit;">Bidang _id adalah tipe ObjectID, yang merupakan tipe kustom, karena itu perlu untuk membuat serialisasi jenis asli ObjectID tipe MongoDB, yang merupakan struktur dari jenis ini.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> InsertOneResult <span class="hljs-keyword">struct</span> {<font></font>
  InsertedID <span class="hljs-keyword">interface</span>{}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menjelaskan parameter input ke mutasi untuk menambahkan pengguna, tipe UserInput dibuat berisi 3 bidang opsional yang menggambarkan pengguna kami. </font><font style="vertical-align: inherit;">Bidang _id tidak ada dalam tipe ini, karena akan dihasilkan di resolver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk terhubung ke mongodb, proyek ini menggunakan driver golang mongodb.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">usersCollection</span><span class="hljs-params">()</span> *<span class="hljs-title">mongo</span>.<span class="hljs-title">Collection</span></span> { <span class="hljs-comment">// ,   users    </span>
  ctx, _ := context.WithTimeout(context.Background(), <span class="hljs-number">10</span>*time.Second)<font></font>
  client, err := mongo.NewClient(options.Client().ApplyURI(<span class="hljs-string">"mongodb://mongo:27017"</span>))
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     log.Panic(<span class="hljs-string">"Error when creating mongodb connection client"</span>, err)<font></font>
  }<font></font>
  collection := client.Database(<span class="hljs-string">"testing"</span>).Collection(<span class="hljs-string">"users"</span>)<font></font>
  err = client.Connect(ctx)<font></font>
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     log.Panic(<span class="hljs-string">"Error when connecting to mongodb"</span>, err)<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> collection<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">//      </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">usersResolver</span><span class="hljs-params">(_ graphql.ResolveParams)</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>{}, error)</span></span> {<font></font>
  ctx, _ := context.WithTimeout(context.Background(), <span class="hljs-number">10</span>*time.Second)<font></font>
  collection := usersCollection()<font></font>
  result, err := collection.Find(ctx, bson.D{})<font></font>
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     log.Print(<span class="hljs-string">"Error when finding user"</span>, err)
     <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">defer</span> result.Close(ctx)<font></font>
<font></font>
  <span class="hljs-keyword">var</span> r []bson.M<font></font>
  err = result.All(ctx, &amp;r)<font></font>
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     log.Print(<span class="hljs-string">"Error when reading users from cursor"</span>, err)<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> r, <span class="hljs-literal">nil</span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">//     </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addUserResolver</span><span class="hljs-params">(p graphql.ResolveParams)</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>{}, error)</span></span> {<font></font>
  ctx, _ := context.WithTimeout(context.Background(), <span class="hljs-number">10</span>*time.Second)<font></font>
  collection := usersCollection()<font></font>
  <span class="hljs-comment">//         ,   _id</span>
  id, err := collection.InsertOne(ctx, p.Args[<span class="hljs-string">"input"</span>])
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     log.Print(<span class="hljs-string">"Error when inserting user"</span>, err)
     <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result bson.M
  <span class="hljs-comment">//       _id</span>
  err = collection.FindOne(ctx, bson.M{<span class="hljs-string">"_id"</span>: id.InsertedID}).Decode(&amp;result)
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
     log.Print(<span class="hljs-string">"Error when finding the inserted user by its id"</span>, err)
     <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result, <span class="hljs-literal">nil</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kami memproses permintaan untuk akuisisi dan mutasi pengguna, menggunakan mongodb sebagai tempat untuk menyimpan data pengguna. Alih-alih database ini, Anda bisa menggunakan yang lain tanpa masalah, baik non-relasional dan relasional, karena GraphQL tidak membatasi kami dalam memilih database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menggunakan buruh pelabuhan menulis untuk bundel golang dan mongodb. Untuk ini, saya menggambarkan file pengaturan kecil. </font><font style="vertical-align: inherit;">
Semuanya sudah siap. </font><font style="vertical-align: inherit;">
Sepasang teknologi golang mongo memungkinkan kita untuk menyimpan data pengguna dalam bentuk yang nyaman untuk pengembalian lebih lanjut dari permintaan GraphQL.</font></font><br>
<br>
<code>version: '3'<br>
services:<br>
 graphql:<br>
 image: golang<br>
 volumes:<br>
 - .:/go/src<br>
 command: /bin/bash -c "cd src &amp;&amp; go run *.go"<br>
 ports:<br>
 - 8080:8080<br>
 mongo:<br>
 image: mongo<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, aplikasi ini ternyata cukup sederhana dan ringkas. </font><font style="vertical-align: inherit;">Dan itu dapat diambil sebagai dasar untuk proyek Anda berikutnya dan dilengkapi dengan tipe baru, permintaan dan mutasi, dan fungsi lainnya. </font><font style="vertical-align: inherit;">Kali ini kami tidak mempertimbangkan contoh penerapan beberapa fitur GraphQL yang lebih menarik, misalnya, berlangganan. </font><font style="vertical-align: inherit;">Mungkin saya akan melanjutkan contoh ini di masa depan, jadi tinggalkan komentar jika ada sesuatu yang tidak cukup untuk Anda di artikel ini dan di bagian selanjutnya kita pasti akan mempertimbangkan ini.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id498186/index.html">Layanan berdasarkan jaringan saraf untuk desainer</a></li>
<li><a href="../id498192/index.html">Tas Kosmetik Steroid: Ulasan XD Design Urban Bumbag</a></li>
<li><a href="../id498194/index.html">Pencari Layanan - Mengusir Mitos</a></li>
<li><a href="../id498200/index.html">Platform Data untuk pelaporan peraturan</a></li>
<li><a href="../id498202/index.html">Intisari Pendaratan. Spesialis Keamanan Informasi</a></li>
<li><a href="../id498208/index.html">Security Week 17: Implikasi Serangan Server Linux</a></li>
<li><a href="../id498214/index.html">Maria Popova: "Beberapa orang pertama kali mengetahui tentang OpenStreetMap karena mereka menandai hogweed di peta"</a></li>
<li><a href="../id498216/index.html">Mewarnai teks dalam html dan Bereaksi</a></li>
<li><a href="../id498218/index.html">Saat saya menulis musik dari sinar kosmik</a></li>
<li><a href="../id498220/index.html">–ö–∞–∫ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å (COVID-XX) –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å 1–° –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –º–∏—Ä?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>