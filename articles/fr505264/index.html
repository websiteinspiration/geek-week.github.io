<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈹 👨🏽‍🎨 🎣 Comme j'ai écrit l'analyseur html en php, et ce qui en est sorti. Partie un 💅🏿 👩🏽‍🌾 👭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. 
 
 Aujourd'hui, je veux dire comment écrire un analyseur html, ainsi que les problèmes que j'ai rencontrés lors du développement d'un analyseur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comme j'ai écrit l'analyseur html en php, et ce qui en est sorti. Partie un</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505264/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hey. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, je veux dire comment écrire un analyseur html, ainsi que les problèmes que j'ai rencontrés lors du développement d'un analyseur similaire en php. </font><font style="vertical-align: inherit;">Mais il y avait de nombreux problèmes. </font><font style="vertical-align: inherit;">Et dans la première partie, je parlerai de la conception de l'analyseur et des problèmes qui se sont posés, car l'analyseur html est différent de l'analyseur des langages de programmation familiers.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai essayé d'écrire le texte de cet article aussi clairement que possible, afin que toute personne qui ne connaît même pas le dispositif général des analyseurs puisse comprendre comment fonctionne l'analyseur html. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-après dans l'article, j'appellerai simplement le document contenant du html </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Document»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'arbre dom situé dans l'élément sera appelé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Subarray"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que doit faire l'analyseur?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Décidons d'abord ce que l'analyseur doit faire afin de s'appuyer sur cela à l'avenir. </font><font style="vertical-align: inherit;">À savoir, l'analyseur doit:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concevoir un arbre dom basé sur des documents</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il y a des erreurs dans le document, il doit les résoudre.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rechercher des éléments dans l'arborescence dom </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trouver des articles pour enfants </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rechercher du texte </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit de la liste la plus simple de ce qu'un analyseur devrait être capable de faire. </font><font style="vertical-align: inherit;">Dans le bon sens, il devrait toujours envoyer des informations sur les erreurs, le cas échéant, dans le document d'origine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, ce sont des bagatelles. </font><font style="vertical-align: inherit;">La fonctionnalité de base est suffisante pour vous casser la tête quelques nuits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a un problème que j'ai tout de suite rencontré: le HTML n'est pas seulement un langage, c'est un langage hypertexte. </font><font style="vertical-align: inherit;">Un tel langage a sa propre syntaxe et un analyseur ordinaire ne fonctionnera pas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diviser pour régner</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, vous devez diviser le travail de l'analyseur en deux étapes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Séparer le texte brut des balises</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trier toutes les balises reçues dans l'arborescence dom</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela s'applique directement à l'analyse d'un document. Je parlerai de la recherche d'éléments un peu plus loin dans ce chapitre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour décrire la première étape, j'ai dessiné un diagramme qui montre clairement comment les données sont traitées dans la première étape: </font></font><br>
<br>
<img src="https://hsto.org/webt/vi/da/ma/vidama0m4yfx28z5lpj9n9c7ado.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
j'ai décidé d'omettre tous les petits détails. Par exemple, comment distinguer qu'après l'ouverture "&lt;" vient une balise, pas du texte? J'en parlerai dans les parties suivantes. C'est suffisant pour l'instant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela vaut également la peine d'être clarifié. Il est logique que dans le document, en plus des balises, il y ait aussi du texte. En termes simples, si l'analyseur trouve une balise d'ouverture et s'il contient du texte, il l'écrira après la balise d'ouverture en tant que balise distincte. Une telle étiquette sera considérée comme unique et ne participera pas aux travaux ultérieurs de l'analyseur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, la deuxième étape. </font><font style="vertical-align: inherit;">Le plus difficile du point de vue de la conception, et le plus simple à première vue du point de vue de la compréhension: </font></font><br>
<br>
<img src="https://hsto.org/webt/cl/mw/wt/clmwwtchiuag_bey_qkr0c4dwjk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans ce cas, le niveau signifie le niveau de récursivité. </font><font style="vertical-align: inherit;">Autrement dit, si l'analyseur a trouvé une balise d'ouverture, il s'appelle lui-même, "entre dans un niveau inférieur", et cela continuera jusqu'à ce qu'une balise de fermeture soit trouvée. </font><font style="vertical-align: inherit;">Dans ce cas, la récursivité produit le résultat, "monte d'un niveau". </font><font style="vertical-align: inherit;">Mais qu'en est-il des étiquettes uniques? </font><font style="vertical-align: inherit;">Ces balises ne sont considérées comme une récursion ni comme ouverture ni comme fermeture. </font><font style="vertical-align: inherit;">Ils vont simplement au dom "Tel quel". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous obtenons quelque chose comme ceci:</font></font><br>
<br>
<pre><code class="php hljs">[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt;<font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">215</span><font></font>
[tag] =&gt; div<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">// </span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt;<font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">238</span><font></font>
[tag] =&gt; div<font></font>
[id] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; tjojo<font></font>
)<font></font>
<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">// </span><font></font>
(<font></font>
[<span class="hljs-number">0</span>] =&gt; <span class="hljs-keyword">Array</span> <span class="hljs-comment">//     </span><font></font>
(<font></font>
[tag] =&gt; __TEXT<font></font>
[<span class="hljs-number">0</span>] =&gt; !<font></font>
<font></font>
)<font></font>
<font></font>
[<span class="hljs-number">1</span>] =&gt; <span class="hljs-keyword">Array</span><font></font>
(<font></font>
[is_closing] =&gt; <span class="hljs-number">1</span><font></font>
[is_singleton] =&gt;<font></font>
[pointer] =&gt; <span class="hljs-number">268</span><font></font>
[tag] =&gt; div<font></font>
)<font></font>
<font></font>
)<font></font>
)<font></font>
)<font></font>
)<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et pour trouver des éléments?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parlons maintenant de la recherche d'éléments. Mais ici, tout n'est pas aussi clair qu'on pourrait le penser. Vous devez d'abord déterminer quels critères nous recherchons pour les éléments. Ici, tout est simple, nous les recherchons selon les mêmes critères que Javascript: balises, classes et identifiants. Mais voici le problème. Le fait est qu'il ne peut y avoir qu'une seule balise, mais les classes et identifiants d'un élément sont nombreux, voire pas du tout. Par conséquent, la recherche d'un élément par étiquette sera différente de la recherche par classe ou identifiant. J'ai dessiné un schéma de recherche pour une balise, mais ne vous inquiétez pas: les recherches par classe ou identifiant ne sont pas très différentes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/qs/w2/j4qsw2kzjw9bzaxen6mozm6gc0i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une petite clarification. </font><font style="vertical-align: inherit;">Par valeur d'origine, je voulais dire le nom de la balise, "div" par exemple. </font><font style="vertical-align: inherit;">De plus, si un élément n'est pas égal à la valeur initiale, mais qu'il a un sous-tableau avec un élément approprié, le résultat sera écrit exactement l'élément approprié avec son sous-tableau, s'il en existe un. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient également de dire que l'analyseur aura une fonction qui vous permettra de rechercher un élément spécifique dans le document. </font><font style="vertical-align: inherit;">Cela accélérera considérablement les performances de l'analyseur, ce qui lui permettra de s'exécuter plus rapidement. </font><font style="vertical-align: inherit;">Il sera possible, par exemple, de ne prendre que le premier élément trouvé, ou le cinquième, comme vous le souhaitez. </font><font style="vertical-align: inherit;">Vous devez admettre que dans de tels cas, il sera beaucoup plus facile pour l'analyseur de rechercher des éléments.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rechercher des articles pour enfants</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, trié la recherche d'éléments, mais qu'en est-il des éléments enfants? </font><font style="vertical-align: inherit;">Ici aussi, tout est simple: notre analyseur prendra tous les sous-tableaux imbriqués d'éléments trouvés avant cela, le cas échéant. </font><font style="vertical-align: inherit;">S'il n'y en a pas, l'analyseur sortira un résultat vide et continuera:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y0/4a/wy/y04awyfodd4cs4c9n5pijqetnkm.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche de texte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a rien à dire. </font><font style="vertical-align: inherit;">L'analyseur va simplement prendre tout le texte reçu du sous-tableau et le sortir.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erreurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le document peut contenir des erreurs que notre script doit gérer avec succès ou, si l'erreur est critique, l'afficher à l'écran. </font><font style="vertical-align: inherit;">Vous trouverez ici une liste de toutes les erreurs possibles dont nous parlerons à l'avenir:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le symbole "&gt;" est introuvable.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Une telle erreur se produit si l'analyseur a atteint la fin du document et n'a pas trouvé le symbole de fermeture "&gt;".</font></font><br>
</li>
<li><b>  </b><br>
    ,            .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">some</span> =&gt;</span><span class="hljs-comment">&lt;!--   ?    ,   --&gt;</span></code></pre><br>
</li>
<li><b> html </b><br>
     :        "&lt;",    "="  ,      .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">some</span> = =<span class="hljs-string">'something'</span>&gt;</span><span class="hljs-comment">&lt;!-- ,    --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tag</span> &lt;<span class="hljs-attr">some</span> =<span class="hljs-string">'something'</span>&gt;</span><span class="hljs-comment">&lt;!--  ?  ,    ? --&gt;</span></code></pre><br>
</li>
<li><b>   </b><br>
     ,     ,    ,  .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = =<span class="hljs-string">'wefwe'</span>&gt;</span><font></font>
!<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-comment">&lt;!--   &lt;/div&gt;?--&gt;</span>
</code></pre><br>
        .<br>
</li>
<li><b>   </b><br>
  ,    ,  .<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = =<span class="hljs-string">'wefwe'</span>&gt;</span><font></font>
!<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--    ?--&gt;</span>
</code></pre><br>
     .<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Élément enfant introuvable.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans ce cas, l'analyseur affichera simplement un tableau vide.</font></font><br>
</li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script, style et commentaires</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'analyseur, les balises de script et de style seront immédiatement ignorées, car je ne vois pas l'intérêt de les écrire. </font><font style="vertical-align: inherit;">La situation est différente avec les commentaires. </font><font style="vertical-align: inherit;">Si vous souhaitez écrire à partir de, vous pouvez activer une fonction de script distincte, puis elle les écrira. </font><font style="vertical-align: inherit;">Les commentaires seront enregistrés de la même manière que le texte, c'est-à-dire comme une balise séparée.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au contraire, cet article doit être considéré comme une petite digression dans le sujet des analyseurs html. </font><font style="vertical-align: inherit;">Je l'ai écrit pour ceux qui envisagent d'écrire leur propre analyseur, ou pour ceux qui sont simplement intéressés. </font><font style="vertical-align: inherit;">Croyez-moi, c'est vraiment amusant! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article est la première partie introductive. </font><font style="vertical-align: inherit;">Dans les prochaines parties de ce cycle, le code participera directement et il y aura moins d'images avec des algorithmes (ce qui est bien, car je ne peux pas les dessiner). </font><font style="vertical-align: inherit;">Restez à l'écoute!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr505252/index.html">Projet Avokado</a></li>
<li><a href="../fr505254/index.html">Sucre de serpent ou écrivez votre gamme en JavaScript</a></li>
<li><a href="../fr505256/index.html">Lancement réussi. 39e depuis le début de l'année. 14e des États-Unis. Satellites Starlink SpaceX</a></li>
<li><a href="../fr505258/index.html">Dentisterie: attente et réalité</a></li>
<li><a href="../fr505260/index.html">Mesurer le retard du clavier au photon à l'aide d'un capteur optique</a></li>
<li><a href="../fr505268/index.html">Expérience personnelle: du développeur frontend au leader</a></li>
<li><a href="../fr505274/index.html">Péchés capitaux de la sécurité du site: ce que nous avons appris des statistiques du scanner de vulnérabilité pour l'année</a></li>
<li><a href="../fr505276/index.html">Comment nous avons appris à ABBYY FineReader PDF à modifier des paragraphes entiers</a></li>
<li><a href="../fr505278/index.html">39 abréviations en anglais pour les commerçants débutants et seoshnikov</a></li>
<li><a href="../fr505280/index.html">Magento 2: CSS critique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>