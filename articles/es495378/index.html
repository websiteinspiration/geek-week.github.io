<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë®üèΩ ‚úäüèº üê° Conferencia DEFCON 27. Buttplug: Pruebas de penetraci√≥n real. Parte 1 ü§π üí° üë©üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los analistas creen que actualmente hay alrededor de 10 mil millones de dispositivos del mundo de Internet de las cosas (IoT). A veces, estos disposit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Conferencia DEFCON 27. Buttplug: Pruebas de penetraci√≥n real. Parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/495378/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los analistas creen que actualmente hay alrededor de 10 mil millones de dispositivos del mundo de Internet de las cosas (IoT). A veces, estos dispositivos ganan su lugar en el mercado, literalmente escalando culos humanos. Result√≥ que los chips de radio baratos y de baja potencia no solo son excelentes para la automatizaci√≥n del hogar, sino que tambi√©n cambian la forma en que las personas interact√∫an con los juguetes sexuales. En este informe, nos sumergiremos en el mundo de la televisi√≥n dildonics, la tecnolog√≠a del sexo a una distancia en la cual las sensaciones t√°ctiles, de temperatura y otras se transmiten entre las parejas a trav√©s de una l√≠nea de comunicaci√≥n bidireccional. El orador le dir√° que la seguridad de los juguetes electr√≥nicos de sexo anal electr√≥nicos de Buttplug se puede oponer a un atacante que encuentra y explota vulnerabilidades en cada nivel de la pila. En √∫ltima instancia, esto permite que los juguetes sexuales se vean comprometidos,y los dispositivos a los que se conectan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/yr/ar/z5yraruqzcjhhyd_pc_eym4a5ly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un hacker con el apodo smea, o Smealum, comenz√≥ su carrera como desarrollador de videojuegos para consolas de juegos como la Nintendo DS, tratando simult√°neamente de descifrarlos. En alg√∫n momento, las consolas adquirieron serios sistemas de seguridad, y Smea cambi√≥ del software interno al desarrollo de t√©cnicas para romperlo. Smea es conocido por su "trabajo" en Nintendo 3DS y Wii U, aunque tambi√©n contribuy√≥ al desarrollo de exploits para los navegadores web y las pilas de virtualizaci√≥n m√°s populares. Probablemente, ahora se interes√≥ en irrumpir en tapones anales "inteligentes".</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hola a todos, soy Smia, y hoy hablaremos sobre c√≥mo romper un tap√≥n de arranque. Este es un objeto que tengo en la mano, no s√© si lo has visto antes, personalmente no lo s√©. Pero en los √∫ltimos 2 a√±os, conoc√≠ a muchos representantes interesantes de la industria de IoT, por lo que ahora ha llegado el momento. Puede que se pregunte c√≥mo puede romper un tap√≥n de arranque, porque es solo una pieza de silicona que debe insertarse en alg√∫n lugar, y estar√° de acuerdo en que no hay muchos lugares para esto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, esto no requiere ninguna electr√≥nica. Pero en los √∫ltimos a√±os, o incluso d√©cadas, ha aparecido una nueva industria de dispositivos electr√≥nicos llamada teledildonika. El origen de este t√©rmino se muestra en la diapositiva: la palabra griega "tele" significa "de lejos", y el ingl√©s "consolador" no significa m√°s que un consolador. Trat√© de encontrar el origen de la palabra consolador, pero nadie sabe de d√≥nde vino. Pero esto es comprensible, ¬øverdad? La idea es que quieras hacer juguetes sexuales que de alguna manera se puedan controlar desde la distancia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay varios escenarios para esto. Solo quiero explicarte c√≥mo funciona esto, porque no todos est√°n familiarizados con tales dispositivos. Por lo tanto, toma el bootplag, lo inserta donde sea necesario y puede controlarlo de forma remota desde donde quiera: desde su tel√©fono, computadora port√°til, etc. Este es el primer escenario llamado "juego en solitario". El segundo escenario que llam√© "multijugador local" es cuando transfieres el control de esta cosa a otra persona. Esto es algo bastante real que a menudo se anuncia: puede, por ejemplo, ir a un bar con ella y nadie sabr√° lo divertido que es. Pero t√©cnicamente, esto crea un nuevo vector de ataque, porque le da el control del dispositivo a un extra√±o, y aqu√≠ el modelo de amenaza realmente cambia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tercer escenario, "multijugador remoto", es similar al segundo, solo que ahora permite que otra persona controle el dispositivo a trav√©s de Internet. Tenga en cuenta que esta persona puede ser un extra√±o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/nb/hr/mnnbhrbihysuf1iengokudmgudm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para muchos, tener relaciones sexuales a distancia parece genial y divertido, y no voy a bromear sobre eso. Algunos usan teledildonics para ganarse la vida, y el escenario 3B se llama "multijugador pago remoto". Por lo tanto, el hecho de que estoy tratando de romper el tap√≥n trasero no es solo entretenimiento, sino que le da a mis estudios de penetraci√≥n cierta justificaci√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gn/g0/m4/gng0m40-kjudzygpgp6fkeczt_i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muchas personas, no s√© c√≥mo llamarlas, ni√±os y ni√±as, ofrecen entretenimiento sexual din√°mico en Internet, lo que permite que otras personas controlen sus juguetes sexuales por dinero. La compa√±√≠a que produce estos colillas tiene una patente para el concepto de deducciones de ganancias cuando usa sus productos para juegos sexuales en Internet. En este escenario, por deducciones de $ 5, tiene derecho a colocar un enlace, por ejemplo, en Twitter, para brindarle a alguien la oportunidad de administrar su bootplag por un tiempo limitado. Dado que las personas conf√≠an en estos juguetes como herramientas para ganar dinero, en mi opini√≥n, es muy importante tener en cuenta su seguridad.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos escenarios que son de inter√©s para los atacantes. El primero es un hack local, cuando un atacante que est√° dentro del alcance del dispositivo intercepta el control a trav√©s de la comunicaci√≥n inal√°mbrica. Hubo mucha investigaci√≥n sobre este m√©todo de pirater√≠a, por lo que no nos detendremos con nuestra atenci√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/wb/8g/gywb8gehwmsgsmf_5pra4m_lmr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√©cnicamente, dicha intervenci√≥n puede considerarse como abuso sexual, por lo que sea legal o no, no intente hacerlo. Seg√∫n el siguiente escenario, un atacante hace lo mismo, pero de forma remota, a trav√©s de Internet. Como ya dije, si ganas as√≠, podr√≠as proporcionar voluntariamente a un extra√±o: un atacante con acceso remoto a tu juguete sexual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto significa que un hacker puede comprometer tus juguetes sexuales "inteligentes" o dispositivos relacionados, en resumen, hacerte algo malo, y es completamente legal, ya que t√∫ mismo le diste acceso. Para un hacker, esta es una opci√≥n m√°s interesante, por lo que nos quedaremos un poco m√°s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/cb/hz/8vcbhzhmae_kgh9ka8v37s2jg_8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tercer escenario es el opuesto: el atacante mismo usa el complemento de arranque para tomar el control de una computadora o tel√©fono y piratear dispositivos ubicados en el lado del usuario que participa de forma remota en los juegos con el complemento. La gente no entiende que esto es un riesgo real, pero probablemente te imaginas lo insidiosos que pueden ser los tapones a tope (risas en el pasillo). Tambi√©n estamos explorando este escenario.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vn/tv/sr/vntvsrxrvefsyh_y7k48hqd7fiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que tiene una idea del mundo de la teledild√≥nica, veamos c√≥mo se ve en la pr√°ctica. En la diapositiva, ves un modelo de consolador llamado Lovense Hush, y luego te mostrar√© una demostraci√≥n con esta cosa en el aire. Este es el primer modelo de dildo-teledildonics en el mundo, un enchufe anal que se puede controlar desde su tel√©fono o computadora. Existen aplicaciones para IoS y Android para este boot-plag, puede controlarlo desde una computadora con Mac OS y Windows. Las aplicaciones m√≥viles admiten funciones sociales como chatear, compartir texto, im√°genes, videos y controlar juguetes con amigos o extra√±os.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/ry/zq/b-ryzqagf71doiiyxeoj_hzvzm8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para Windows, debe usar una llave USB especial, que mostrar√© m√°s adelante, porque ahora este complemento de arranque est√° conectado a mi computadora. La clave de la unidad flash electr√≥nica fue desarrollada por la misma compa√±√≠a, Lovens, el fabricante del complemento de arranque, que cre√≥ su propio ecosistema de consoladores "inteligentes" y toma alrededor de $ 5 de comisi√≥n por una sesi√≥n en Internet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bv/lg/dl/bvlgdlcsp4qckbaej8gps_szkua.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente diapositiva muestra mi visi√≥n de un ataque en un enchufe de arranque usando una aplicaci√≥n de PC. Hay una conexi√≥n BLE (BlueTooth Low Energy) entre el enchufe de arranque y la llave USB, la llave est√° conectada a la computadora del usuario, que a su vez est√° conectada a Internet. El escenario n. ¬∞ 1 lo utiliza un atacante en la secci√≥n de la llave USB del conector de arranque, es decir, se ataca la conexi√≥n BLE. De hecho, no hay protecci√≥n, por lo que cualquier extra√±o puede tomar el control de este juguete. El a√±o pasado, hubo una discusi√≥n seria sobre una herramienta llamada BTLE Jack, que le permite atacar con √©xito dicha conexi√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l_/ma/24/l_ma24foabt77cti9__dmq7ufam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El escenario No. 2 consiste en atacar una secci√≥n de la conexi√≥n a Internet de la computadora de un usuario. El tercer escenario es un intento de piratear cualquiera de los tres sitios: BLE, USB, Internet. Es probable que haya un proyecto abierto Buttplug ... puedes re√≠rte, fue una broma. Entonces, ¬ød√≥nde comenzamos nuestra "prueba de penetraci√≥n verdadera"?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cj/ov/21/cjov21ngohs6fh0gqaccbp2mdn0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No encontr√© ning√∫n c√≥digo o binario para el consolador y el dongle en s√≠, pero hay archivos de aplicaci√≥n binarios para dispositivos m√≥viles y una computadora disponible para descargar en Internet. Instal√© estos archivos en mi computadora y comenc√© a trabajar en ellos. En la siguiente diapositiva, ver√° la interfaz de la aplicaci√≥n para administrar el complemento de arranque. En el centro de la pantalla hay un control deslizante para ajustar la vibraci√≥n del juguete, y a la izquierda est√° el panel de control con botones: acceso a la cuenta, modo de control en la red local, modo de control remoto a trav√©s de Internet. Para comprender la estructura de la aplicaci√≥n, solo necesita leer un poco de c√≥digo JavaScript confuso.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/tc/l_/gytcl_o4cfm0iolamia3r6cfryo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No me gusta JavaScript, pero lo bueno de esto es la presencia de un mont√≥n de nombres de variables y nombres de campos de objetos, y todo esto est√° perfectamente dise√±ado en ingenier√≠a inversa. Simplemente suelte el c√≥digo en Beautifier y descubra c√≥mo funciona. Una vez que haga esto, puede comenzar a comprender el funcionamiento de la llave electr√≥nica.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fp/km/1s/fpkm1shgzrwislgaj09vm2ileg8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al descubrir que esto es solo un puerto serie para conectarse a trav√©s de USB, comenc√© a rastrear el tr√°fico entre la llave y la aplicaci√≥n. Preste atenci√≥n a las l√≠neas a la derecha de la diapositiva: en primer lugar, not√© que los mensajes entre el dispositivo de seguridad y la aplicaci√≥n estaban en formato de texto JSON. Para el c√≥digo JavaScript, esto es familiar, pero para una llave USB, que es un microcontrolador de 32 bits, incrustar el analizador JSON parece extra√±o ... Para nosotros es muy conveniente, porque los analizadores JSON generalmente contienen errores de firmware que se pueden usar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/5r/rk/hj5rrk2imjq5byefebbencwwmsg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, encontrar errores sin el c√≥digo de la llave en s√≠ es una tarea tediosa, pero como ten√≠a el c√≥digo de la aplicaci√≥n, comenc√© a buscar un mecanismo para actualizar el firmware de la llave USB y pronto encontr√© lo que quer√≠a: la URL del nodo de actualizaci√≥n. Result√≥ que el firmware no estaba cifrado o firmado de ninguna manera, as√≠ que lo descargu√© y obtuve un binario para su an√°lisis. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/q7/vs/xcq7vsjbakxsctt8th2gd_fwhni.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego comenc√© la ingenier√≠a inversa y llam√© la atenci√≥n sobre 2 cosas. En primer lugar, hay 2 controladores de comandos para el puerto USB serie. El primero usa comandos simples como restablecer o tipo de dispositivo, el segundo usa comandos como DFU para actualizar el firmware del dispositivo, de modo que podamos enviar estos comandos y actualizar el firmware.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oy/ol/b-/oyolb-kfxvjs8uq4ccxmvyrowdw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de mirar el analizador JSON, que es de mayor inter√©s para nosotros, descubr√≠ el error esperado: la funci√≥n parseJsonString. Solo necesita asignar una copia de la cadena original a un nuevo b√∫fer y tambi√©n trabajar con cosas como secuencias de escape. Al calcular la longitud del nuevo b√∫fer, no coincide con la longitud real utilizada. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/n7/vw/pon7vwgs51_0b0xicll5adjy0km.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta funci√≥n funciona as√≠: admite una secuencia de escape de 5 par√°metros U en lugar de, como se esperaba, igualarlos a 0. Gracias a esto, podemos evitar una cadena con terminaci√≥n nula y hacer que la longitud de la primera cadena calculada sea incorrecta.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/am/4y/lgam4y0v4ijpkvue8j2snjfr7xm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta peque√±a animaci√≥n muestra lo que est√° sucediendo aqu√≠. La barra invertida antes de U significa que deben descartarse 6 caracteres. Luego, la funci√≥n salta a trav√©s del terminador nulo, lo cual es un problema. Luego, el proceso contin√∫a, todos los caracteres se copian y caen en el b√∫fer con una longitud de solo 6 bytes. Aqu√≠ aparece el segundo problema: el riesgo de desbordamiento del b√∫fer. Esto es genial, pero a√∫n no sabemos c√≥mo funciona el hardware del dongle. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/ea/hl/wjeahlydyx11z5kl0e_entwcoiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sabemos con certeza que no tiene aleatorizaci√≥n del espacio de direcciones ASLR, ni pila de cookies, pero es posible que la clave tenga protecci√≥n como prevenci√≥n de ejecuci√≥n de datos DEP o protecci√≥n XN que impide la ejecuci√≥n de c√≥digo en la memoria, excepto para la regi√≥n .text.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clave est√° equipada con un chip SoC NRF51822 con un procesador Cortex M0, sin protecci√≥n DEP, que es muy popular para dispositivos BLE y est√° equipado con un mont√≥n de contactos de depuraci√≥n. Por lo tanto, es bastante simple conectarse a esta clave soldando un par de cosas, y depurar a trav√©s de la interfaz para depurar y flashear chips SWD si no est√° deshabilitado en la configuraci√≥n de f√°brica. Al conectarse a trav√©s de SWD, podemos vaciar el contenido del mont√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que se usa solo para el analizador JSON, que no es muy bueno, pero el mont√≥n contiene metadatos. Entonces, ¬øqu√© se puede estropear aqu√≠? ¬°Por supuesto, metadatos del mont√≥n! De esta forma creamos un exploit para el analizador JSON.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qw/9o/zh/qw9ozhk_k6ixcm_iupcoyvun3xa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un mont√≥n es solo una lista gratuita. Si observa este c√≥digo, puede ver que cada distribuci√≥n tiene su propia longitud y puntero. Si usa desbordamiento de b√∫fer, puede estropear la longitud y la posici√≥n del siguiente puntero, lo que le permite controlar la ubicaci√≥n de la siguiente distribuci√≥n. Al copiar una nueva l√≠nea en √©l, puede organizar f√°cilmente datos arbitrarios en un lugar arbitrario. Todo esto se puede hacer mientras el depurador est√° conectado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tb/hk/y7/tbhky7ub8kj5cbgpjhmrl-frong.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el lado derecho de la diapositiva, ver√° una pila que se reinicia y se sobrescribe completamente con solo 8 caracteres. Esto nos da la ejecuci√≥n del c√≥digo de la llave USB, lo cual es bastante bueno.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Record√© que, desafortunadamente, este dongle tiene un modo de actualizaci√≥n de firmware de DFU de emergencia. Esperaba que, por analog√≠a con la pirater√≠a de consolas de juegos, este modo sirve para autenticar la actualizaci√≥n de cualquier manera posible. Resulta que aqu√≠ la DFU usa el cl√°sico c√°lculo de suma de verificaci√≥n CRC16, que, si comprende la criptograf√≠a, no es autenticaci√≥n de ning√∫n tipo. No creo que realmente quisieran usar la autenticaci√≥n en este caso, lo m√°s probable es que simplemente decidieran que pocas personas estar√≠an interesadas en ejecutar el c√≥digo de la llave USB para el enchufe de arranque. Sin embargo, me interes√≥.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/if/lg/py/iflgpyq2h1z6kusfwcpqf-x0vxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por el momento, ten√≠a 2 formas diferentes de ejecutar c√≥digo en este dispositivo, pero el problema con el analizador JSON, en el que pas√© mucho tiempo, result√≥ no ser particularmente efectivo debido a la presencia del modo DFU. M√°s adelante consideraremos este m√©todo junto con la vulnerabilidad del analizador existente. Hasta ahora, he estado m√°s interesado en saber si es posible simplemente modificar el archivo main.bin, volver a calcular su CRC16 e incrustarlo utilizando el programa que se incluye en la aplicaci√≥n Lovense Remote. Result√≥ que es posible. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, obtuvimos una memoria USB que se vio comprometida al usar una aplicaci√≥n de PC, y definitivamente fue la parte m√°s f√°cil de descifrar. Una vez que obtuve el control de la clave, comenc√© a buscar una forma de ejecutar c√≥digo en el conector de arranque.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vi/k2/vm/vik2vmib-ohaqm0hlaaldyaqmgc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, recurr√≠ al "hardware" de nuestro juguete sexual, probablemente tambi√©n ten√≠a un depurador y vali√≥ la pena echarle un vistazo. Despu√©s de examinar el conector de arranque, encontr√© un chip m√°s serio, con una gran cantidad de memoria flash y RAM y un procesador Cortex M4 m√°s potente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√°cilmente descubr√≠ lo que faltaba y lo que estaba a bordo del bootplag. No hay DEP, como en un dongle, en la parte superior hay cables que conducen a la bater√≠a, luego est√° el puerto de carga, los contactos del motor vibrador, varias almohadillas de contacto para la depuraci√≥n y una antena Bluetooth. Por lo tanto, gracias a la presencia de SWD, el dispositivo se puede actualizar f√°cilmente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r8/ln/rd/r8lnrdx8uis5lkt3f-gtdkpssr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya ves lo que sucedi√≥: no tengo accionista, pero en la bolsa siempre habr√° un mont√≥n de tapones para los experimentos. Luego comenc√© la ingenier√≠a inversa y la depuraci√≥n de la placa de arranque, restableciendo el firmware original. No hab√≠a analizadores JSON, solo comandos simples, pero en grandes cantidades.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pens√© que si el modo de actualizaci√≥n del firmware del dongle era tan inseguro, entonces es posible que haya vulnerabilidades. Result√≥ como es. Como resultado de la b√∫squeda de DFU, encontr√© 2 cosas: el controlador de comando DFU normal y la l√≠nea DfuTarg en el sector de arranque. Este DfuTarg se usa de la misma manera que el identificador del complemento de arranque LVS-Z00, es decir, es similar al gestor de arranque DFU para BLE. Por lo tanto, en modo DFU, el registro de arranque se reconoce como un dispositivo con el nombre DfuTarg, y este identificador √∫nico se puede utilizar para buscar el dispositivo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, si le env√≠a exactamente el mismo comando DFU que le enviamos a la tecla, la placa de arranque entrar√° en el modo de actualizaci√≥n del firmware del dispositivo. Para flashear, puede usar las herramientas patentadas del fabricante del microcircuito Nordic Semiconductor - nRF Toolbox.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xb/iy/pr/xbiyprlhoukirnf_su9htx71rqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con un sniffer de hardware, puede visualizar paquetes BLE en Wireshark. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/ea/9o/xcea9of9tdquhsfcjnjglzcsj78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envi√© un breve mensaje "hola desde el enchufe", y esto significa que puede ejecutar el c√≥digo en el batplag sin ning√∫n tipo de pirateo, y esto no es una vulnerabilidad, sino solo un tipo de dise√±o de desarrolladores que le permite volver a actualizar el dispositivo. Quiz√°s a la comunidad de c√≥digo abierto le gustar√≠a esta soluci√≥n. La conclusi√≥n es que cualquiera que pueda conectarse a su complemento de arranque puede ejecutar su propio c√≥digo en √©l, y esto ya es algo bastante peligroso. En este caso, el hacker debe estar en el √°rea de la conexi√≥n local, es decir, estar lo suficientemente cerca del juguete sexual para obtener el control sobre √©l a trav√©s de un dongle comprometido y un canal BLE. Al mismo tiempo, puede usar el dongle en s√≠ o cualquier otro dispositivo BLE.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d_/uo/uy/d_uouyokp1p8mdsyx2x0yehkl14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pregunta es, ¬øqu√© se puede hacer realmente con el complemento de arranque, teniendo la oportunidad de ejecutar su propio c√≥digo en √©l? Tengo algunas ideas. El primero: tomar el control de esto, puede crear un bootplag de ransomware. Puede modificar su firmware para que el usuario no pueda activar el modo DFU hasta que le proporcione una determinada clave, o simplemente desactive la funci√≥n de vibraci√≥n y solicite 50 d√≥lares para desbloquear este √∫til dispositivo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cl/jb/ob/cljbobzlggrarkc30am8im-fe14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para muchos, esto servir√° como una especie de vacuna contra el uso de tales juguetes. La segunda idea es convertir el bootplag en un arma. Tiene una bater√≠a bastante potente que alimenta el motor del vibrador, podemos decir que el 80% del contenido del enchufe de arranque es una bater√≠a. Probablemente recuerde lo que sucedi√≥ con los tel√©fonos inteligentes Samsung Galaxy Note: simplemente explotaron (risas), por lo que es probable que esto pueda suceder con los enchufes a tope. No s√© cu√°l es la probabilidad de su explosi√≥n, pero si tienes muchos juguetes sexuales con motor, deber√≠as pensarlo. El equipo de desarrollo afirma que estas cosas son absolutamente seguras, a pesar de la presencia de muchas partes m√≥viles. Pero si este es el caso, la funci√≥n de seguridad del dispositivo est√° codificada en software, no en hardware.En este caso, la ejecuci√≥n de c√≥digo malicioso puede tener consecuencias desastrosas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los juguetes sexuales equipados con una bomba de aire tambi√©n son peligrosos. Tambi√©n tienen un motor bastante potente con bater√≠a, por lo que tambi√©n debes prestarles atenci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, la √∫ltima idea es un complemento de batalla hostil. Hostil, no en el sentido de que sea capaz de explotarte, sino en el hecho de que puede servir como un medio para hackear el resto de tus dispositivos. Por lo tanto, consideraremos el complemento de batalla desde el punto de vista de su hostilidad, que se garantiza mediante la ejecuci√≥n de c√≥digo malicioso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentemos averiguar si es posible lograr la ejecuci√≥n del c√≥digo en la aplicaci√≥n para el complemento de arranque considerando c√≥mo procesa los mensajes entrantes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g_/ov/1v/g_ov1vzowj7o8hifa6xhfoo5gmq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la izquierda, ver√° una devoluci√≥n de llamada en JavaScript, y a la derecha, c√≥mo interact√∫a con la aplicaci√≥n a trav√©s del puerto serie. La devoluci√≥n de llamada se coloca en una cadena y luego se procesa mediante un mont√≥n de funciones diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera funci√≥n es encontrar la clave, procesa los mensajes de inicializaci√≥n que provienen de la clave. La segunda funci√≥n est√° activada ("Datos"), una funci√≥n de procesamiento que acepta un paquete JSON entrante, cuya longitud, por cierto, no puede exceder los 32 caracteres. A continuaci√≥n, se analiza y todo lo dem√°s est√° hecho. De hecho, aqu√≠ no hay un procesamiento serio: solo se solicita el estado del dispositivo, verificando la carga de la bater√≠a y similares.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La √∫ltima funci√≥n es mucho m√°s interesante: lo llamo el registro de depuraci√≥n, aunque en realidad no tiene nombre en el c√≥digo real. Esta funci√≥n registra todo lo que ingresa al dispositivo a trav√©s del puerto serie y restablece estas l√≠neas a la consola, que si es necesario muestra un mensaje de error. Adem√°s, esta funci√≥n crea un nuevo elemento DOM como elemento HTML y arroja todo el contenido recibido a trav√©s del puerto serie a este HTML. No soy un desarrollador web, pero creo que esta es una vulnerabilidad grave de XSS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, si tiene control sobre el dongle, puede enviar cualquier cosa a trav√©s del puerto serie, lo que obliga a la aplicaci√≥n a interpretar esto como HTML. </font><font style="vertical-align: inherit;">Este es el problema, porque HTML tiene la capacidad de crear un nuevo c√≥digo JavaScript en una aplicaci√≥n instalada en su computadora, es decir, puede comprometerlo. </font><font style="vertical-align: inherit;">La pregunta es qu√© malware se puede inventar, sabiendo que solo se permiten 32 caracteres a la vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22:00 min </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conferencia DEFCON 27. Buttplug: prueba de penetraci√≥n genuina. </font><font style="vertical-align: inherit;">Parte 2</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RnxcPeemHSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco de publicidad :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por estar con nosotros. ¬øTe gustan nuestros art√≠culos? ¬øQuieres ver m√°s materiales interesantes? Ap√≥yenos haciendo un pedido o recomendando a sus amigos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS en la nube para desarrolladores desde $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an√°logo √∫nico de servidores de nivel b√°sico que inventamos para usted: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o c√≥mo dividir el servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 veces m√°s barato en el centro de datos Equinix Tier IV en Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬°Solo tenemos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los Pa√≠ses Bajos!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - ¬°desde $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lea sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥mo construir un edificio de infraestructura. </font><font style="vertical-align: inherit;">clase c con servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495364/index.html">API Style Guide, o no hagas que los usuarios piensen</a></li>
<li><a href="../es495366/index.html">16 tipos de programadores o desarrolladores no son los mismos robots</a></li>
<li><a href="../es495370/index.html">Lo p√∫blico es malo</a></li>
<li><a href="../es495374/index.html">Plaf√≥n decorativo General Lumino 02</a></li>
<li><a href="../es495376/index.html">Aburrimiento de cuarentena. C√≥mo gastar la mayor cantidad de dinero en Azure con un clic</a></li>
<li><a href="../es495380/index.html">Gran cortafuegos egipcio</a></li>
<li><a href="../es495384/index.html">Mi experiencia de pasant√≠a en Microsoft Redmond y obtener una oferta</a></li>
<li><a href="../es495388/index.html">Programa de televisi√≥n de la d√©cada de 1970 que se convirti√≥ en un antepasado de los eSports</a></li>
<li><a href="../es495390/index.html">Vale la pena probar STM32CubeMonitor</a></li>
<li><a href="../es495392/index.html">C√≥mo buscar errores en el front-end: 4 etapas principales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>