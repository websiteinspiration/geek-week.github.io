<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöã ‚ìÇÔ∏è üå≠ Ass√≠ncrono / aguardar no Unity üßõüèº üëµüèª üè©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sauda√ß√£o, Khabrovsk. Ainda resta muito pouco tempo antes do in√≠cio do curso "Desenvolvedor de Jogos na Unity" . Nesse sentido, preparamos para voc√™ ou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ass√≠ncrono / aguardar no Unity</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/506962/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sauda√ß√£o, Khabrovsk. </font><font style="vertical-align: inherit;">Ainda resta muito pouco tempo antes do in√≠cio do curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Desenvolvedor de Jogos na Unity"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nesse sentido, preparamos para voc√™ outra tradu√ß√£o interessante.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/37/kv/yt/37kvytgqxylnrra818g7eckd5ly.png"><br>
<hr><br>
<code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Unity j√° funciona </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plug-ins ou </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inv√≥lucros de corutin que simulam o comportamento ass√≠ncrono, verificando a conclus√£o em todos os quadros. </font><font style="vertical-align: inherit;">Mas ainda √© um tipo de m√°gica. </font><font style="vertical-align: inherit;">Vamos aprofundar um pouco esse t√≥pico. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Observa√ß√£o: por enquanto, n√£o tenho um entendimento ideal de todos os detalhes do cap√¥ </font></font><code>async/await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em C #, por isso tentarei complementar o exposto, √† medida que meu entendimento se aprofundar.)</font></font></i><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo</font></font></h4><br>
<img src="https://habrastorage.org/webt/ps/8i/so/ps8isowfho7xsjl99bnyzfh_5fo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que eu precise de um bot√£o que, ao ser clicado, reproduza uma anima√ß√£o de caixa cl√°ssica. Mas h√° um problema: o bot√£o deve entrar em um estado inativo (escurecido por </font></font><code>.interactable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at√© que a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caixa termine a rota√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por motivos de limpeza do c√≥digo, quero usar um </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que aguarde a conclus√£o da rota√ß√£o da caixa e adicionar imediatamente uma linha que restaure </font></font><code>interactable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, em vez de algo como criar um objeto contendo corotina, verificando o estado em cada quadro para iniciar esta tarefa. Ter um c√≥digo linear √≥bvio em um s√≥ lugar √© uma grande vantagem em termos de legibilidade. √â bom escrever esse c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo simples e compacto a seguir implementa a tarefa necess√°ria. (</font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Os m√©todos tamb√©m aparecem na lista de delegados do Unity, n√£o se preocupe.)</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpinBox</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Button button;
    <span class="hljs-keyword">public</span> Animation ani;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpinAndDisableButton</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        ani.Play();<font></font>
        button.interactable = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">while</span> (ani.isPlaying == <span class="hljs-literal">true</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> Task.Yield();<font></font>
        }<font></font>
        button.interactable = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}</code></pre><br>
<br>
<img src="https://habrastorage.org/webt/m-/or/ad/m-orad9ixe4ebtae_f6hm0ast1w.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o algumas perguntas que voc√™ deveria ter feito:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Quem" "executa" o </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resto do m√©todo? </font><font style="vertical-align: inherit;">Com que m√°gica ela √© verificada no pr√≥ximo quadro, enquanto a chamada </font></font><code>SpinAndDisableButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© feita apenas uma vez e n√£o h√° </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corotinas para reiniciar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© o tempo de cada corrida?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">Esta parece ser a chave para tudo o que acontece aqui. </font><font style="vertical-align: inherit;">Suponho que voc√™ esteja acostumado com </font></font><code>yield return null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corotinas. </font><font style="vertical-align: inherit;">Um bom palpite seria tentar novamente no pr√≥ximo quadro, mas voc√™ diz isso atrav√©s do enumerador C #. </font><font style="vertical-align: inherit;">A reda√ß√£o do rendimento √© semelhante e at√© o comportamento √© semelhante.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto de sincroniza√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Confira </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre como o restante do programa pode ser capturado e continuado como queremos (por exemplo, em qual thread? No thread de chamada ou no thread que inicia a tarefa?). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois, voc√™ notar√° que tamb√©m existe no Unity tal conceito, mas n√£o √© vis√≠vel para n√≥s √† primeira vista.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparado a um programa C # regular</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo n√£o √© exatamente o mesmo que nos programas C # regulares. Uma olhada na documenta√ß√£o oficial </font></font><code>await. await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implica um retorno ao chamador do objeto </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O chamador pode continuar enquanto n√£o precisar executar o resultado e n√£o pode mais se dar ao luxo de fazer neste momento outra coisa (n√£o importa se uma tarefa √© multiencadeada ou n√£o), exceto </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Essa cadeia pode continuar at√© voc√™ finalmente chegar </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Onde, se tamb√©m nos encontrarmos </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√° outra espera</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gerada pelo compilador, que solicita imediatamente o resultado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora de volta ao nosso </font></font><code>SpinAndDisableButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para onde est√° indo o retorno </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Na Unity n√£o temos</font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pois est√° profundamente oculto no c√≥digo do mecanismo. A quest√£o, de fato, √© a mesma que quem executa </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e assim por diante. Essa √© uma </font></font><code>PlayerLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API que suporta o c√≥digo do mecanismo dentro do ciclo do jogo para fornecer uma renderiza√ß√£o ordenada dos objetos e tudo o que √© executado no quadro. Mas antes, isso n√£o nos incomodava, pois at√© agora esses pontos de entrada retornaram </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, ele </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna o ponto de execu√ß√£o para algu√©m na esperan√ßa de que ele possa continuar a partir desse ponto mais tarde, em um determinado momento, automaticamente. Ent√£o o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><b><font style="vertical-align: inherit;">jogo continua</font></b><font style="vertical-align: inherit;"> at√©</font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° esperando. </font><font style="vertical-align: inherit;">Caso contr√°rio, n√£o ver√≠amos a caixa rotativa, se realmente esper√°ssemos at√© que a caixa terminasse a anima√ß√£o, porque a anima√ß√£o n√£o poderia terminar se a altera√ß√£o do quadro n√£o continuasse. </font><font style="vertical-align: inherit;">Ent√£o, o que acontecer√° no pr√≥ximo quadro? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este √© o pseudoc√≥digo que queremos receber em um quadro diferente daquele em que pressionamos o bot√£o e, assim, o desativamos:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">for</span> ( )<font></font>
{<font></font>
    <span class="hljs-keyword">if</span>(  )<font></font>
    {<font></font>
    	 .<font></font>
    }<font></font>
  <font></font>
     .<font></font>
         .<font></font>
        .<font></font>
}</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depura√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inclua mais logs no c√≥digo, e tentaremos a depura√ß√£o passo a passo.</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpinBox</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Button button;
    <span class="hljs-keyword">public</span> Animation ani;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpinAndDisableButton</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Started async <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
        ani.Play();<font></font>
        button.interactable = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">while</span> (ani.isPlaying == <span class="hljs-literal">true</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> Task.Yield();<font></font>
        }<font></font>
        button.interactable = <span class="hljs-literal">true</span>;<font></font>
        Debug.Log(<span class="hljs-string">$"Finished async <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Update <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LateUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Late Update <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ordem de atualiza√ß√£o √© a seguinte:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ku/rp/b7/kurpb70kzx35oellcgqqwor5eow.png"><br>
<br>
<img src="https://habrastorage.org/webt/1c/k8/ef/1ck8ef1r0hmycnkfcubqfa4kwec.png"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O quadro em que iniciamos a anima√ß√£o √© precedido por, </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">porque o clique do mouse vem de </font></font><code>EventSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>GraphicRaycaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do UGUI Unity, que, como se viu, tem a ordem de execu√ß√£o em </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qualquer um dos seus scripts acima.</font></font></li>
<li><code>while</code>   <b> </b>      ,   <b></b> <code>Update</code>,   <code>LateUpdate</code>.     ,     !</li>
<li>      ,    ,      ,   <code>Awaiting</code>,    UGUI   ,   ,  <code>await</code> ,        -   </li>
<li>         <code>Update</code>  -   . <code>await</code>     .</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resta desmistificar o ‚Äúobjeto pendente‚Äù, que eu n√£o resolvi completamente, mas pelo menos vejo como ele funciona, porque foi intencionalmente codificado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No primeiro quadro, onde cliquei no bot√£o, n√£o h√° nada de estranho. </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(a mesma m√°gica </font></font><code>MonoBehaviour Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><code>EventSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa a </font></font><code>Input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API e v√™ meu clique. Depois disso, ele examina meu bot√£o na tela e v√™ que pode fazer alguma coisa. Ent√£o √© chamado </font></font><code>public async void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e chega a essa linha. (Voc√™ tamb√©m pode us√°-las </font></font><code>ExecuteEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manualmente! Essa √© uma </font></font><code>static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe </font><font style="vertical-align: inherit;">auxiliar </font><font style="vertical-align: inherit;">.) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/6q/yb/ut6qybougoh8yuhav3o2gpn8hly.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No pr√≥ximo quadro em que a m√°gica acontece, a pilha de chamadas pode nos mostrar exatamente quem lida com a verifica√ß√£o a cada poucos quadros. N√£o entendo bem o que est√° acontecendo aqui. (embora isso funcione) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fr/gw/uj/frgwujptlworykklroix5o0m4sk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando verifiquei</font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, muito parece ser chamado do c√≥digo do mecanismo, para que eu n√£o possa fazer nada al√©m de adivinhar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/qh/vm/reqhvmmgmoxuzm6i-e-9ts49txm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas h√° algo chamado l√° </font></font><code>WorkRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que representa cada um dos seus neg√≥cios inacabados esperados. </font><font style="vertical-align: inherit;">Suponho que o retorno seja </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registrado corretamente de uma maneira ‚Äúsemelhante a um jogo‚Äù, compat√≠vel com o paradigma de pessoal e garanta que todo o c√≥digo seguro seja bloqueado no thread principal, para que voc√™ possa fazer algo totalmente ap√≥s qualquer um </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque isso ser√° feito no momento certo no quadro .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task.Yield ()</font></font></h4><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este m√©todo tem uma descri√ß√£o muito confusa: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task.yield?view=netframework-4.8</font></font></a></i><br>
<blockquote><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">YieldAwaitable</a><br>
<br>
 ,  ,          .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SynchronizationContext</a>   NULL,     .     ,     ,    .<br>
<br>
<b></b><br>
<br>
   <code>await Task.Yield()</code>;   ,     .      ( SynchronizationContext),         .   ,  ,         ,    .  ,    UI     UI,    ,    ,     .     ,  <code>await Task.Yield()</code>;   UI .      ¬´ ,    ContinueWith¬ª   ¬´   .NET¬ª.</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ingl√™s n√£o √© minha l√≠ngua nativa e acho que nem o C # </font></font><code>yield return</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nem </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">refletem a fun√ß√£o que eles desempenham. Mas vamos para a defini√ß√£o do m√©todo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6k/-f/oi/6k-foipgostpw8fxs9c9znoz7jo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O alegado caso de uso na nota parece indicar que o m√©todo n√£o √© realmente </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas voc√™ gostaria de transform√°-lo em algo </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ent√£o voc√™ precisa </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(esperar) em algum lugar nele, portanto, </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© um bode expiat√≥rio ideal. Em vez de finalizar imediatamente o m√©todo (lembre-se de que o ass√≠ncrono n√£o transformar√° magicamente o m√©todo em ass√≠ncrono, depende do conte√∫do do m√©todo), agora voc√™ o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for√ßa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a ser ass√≠ncrono. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, no nosso caso, o destinat√°rio do contexto n√£o √© um contexto comum, mas </font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Agora</font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">possui uma fun√ß√£o mais √∫til que efetivamente continua a funcionar no pr√≥ximo quadro. </font><font style="vertical-align: inherit;">Se fosse comum </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, suponho que poderia produzir um loop infinito em nosso exemplo, uma vez que continuar√° seguindo em frente </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repetidamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Retorna </font></font><code>YieldAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que o chamador pode usar para continuar. </font><font style="vertical-align: inherit;">Como nosso registro testemunha, ‚ÄúAguardado‚Äù foi registrado no in√≠cio de cada quadro, porque o contexto (o c√≥digo ao lado </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) foi salvo neste aviador. </font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faz alguma m√°gica, espera o quadro e usa esse transportador para continuar, ent√£o ele alcan√ßa </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e devolve um novo novamente </font></font><code>YieldAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Provavelmente, isso continuar√° adicionando novo </font></font><code>WorkRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo anteriormente em cada quadro como uma tarefa em espera at√© </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que se torne</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UniTask</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe um pacote popular do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UniTask</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que elimina </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e introduz </font><font style="vertical-align: inherit;">completamente </font><font style="vertical-align: inherit;">um novo tipo de tarefa mais leve </font></font><code>UniTask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que se liga diretamente √† </font></font><code>PlayerLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API. </font><font style="vertical-align: inherit;">Depois, voc√™ pode escolher a hora em que a verifica√ß√£o deve ocorrer no pr√≥ximo quadro. </font><font style="vertical-align: inherit;">(Inicializa√ß√£o? Atualiza√ß√£o tardia?) Mas, de fato, voc√™ sabe o que </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciona sem nenhum plug-in. </font><font style="vertical-align: inherit;">Isso ser√° √∫til com os Endere√ß√°veis ‚Äã‚Äãsempre que </font></font><code>AsyncOperationHandle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poss√≠vel. </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o qual voc√™ pode usar </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/7eKi6NKri6I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© uma boa conversa, que mostra que ela </font></font><code>Await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j√° funciona bem, mas h√° vantagens na corotina usada com razoabilidade. </font><font style="vertical-align: inherit;">Voc√™ pode prestar mais aten√ß√£o a este slide para resolv√™-lo um pouco, se ainda estiver confuso.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8c/md/kw/8cmdkwfptrr0hr-y6twos_oto7u.png"><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criamos um atirador de rede no espa√ßo em uma hora e meia.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt506940/index.html">O caminho para o ideal: um pequeno guia para programadores e seus l√≠deres</a></li>
<li><a href="../pt506950/index.html">O que √© a Escola 21 e por que √© t√£o projetada</a></li>
<li><a href="../pt506952/index.html">Portal da API: o que procurar ao projetar. Experi√™ncia Wrike</a></li>
<li><a href="../pt506954/index.html">Outro artigo sobre Rails e ELK</a></li>
<li><a href="../pt506956/index.html">Sa√∫de e Tecnologia Qu√¢ntica</a></li>
<li><a href="../pt506964/index.html">Desenvolvimento Android: Revis√£o de carreira em maio de 2020</a></li>
<li><a href="../pt506976/index.html">Vis√£o geral dos scanners 3D Solutionix D500 e D700</a></li>
<li><a href="../pt506980/index.html">Fim de jogo do HackTheBox. Passo a passo Xen Lab. Pentest Active Directory</a></li>
<li><a href="../zh-CN486176/index.html">‰ºÅ‰∏öÁîµÂ≠êÈÇÆ‰ª∂ÈÄöËÆØÂ§áÂøòÂΩï</a></li>
<li><a href="../zh-CN486178/index.html">FOSSÊñ∞Èóª1-2020Âπ¥1Êúà27Êó•Ëá≥2Êúà2Êó•ÂÖçË¥πÂíåÂºÄÊ∫êÊñ∞ÈóªÁöÑÂõûÈ°æ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>