<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈁 💃🏻 😯 Einzigartiger WSGI-Webserver mit ESP8266. Teil 1 🍽️ 👨‍🎤 🤥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo alle zusammen! 
 
 Dieser Artikel ist der erste Teil meines Tutorials zur Entwicklung eines eher ungewöhnlichen WSGI-Servers. In diesem Artikel ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Einzigartiger WSGI-Webserver mit ESP8266. Teil 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486752/"><img src="https://habrastorage.org/webt/2g/wi/wb/2gwiwbq1_ed0lwgklvoy8kqsayi.png" align="left"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo alle zusammen! </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel ist der erste Teil meines Tutorials zur Entwicklung eines eher ungewöhnlichen WSGI-Servers. </font><font style="vertical-align: inherit;">In diesem Artikel werde ich den theoretischen Teil meiner Idee erklären. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Hauptpublikum sind unerfahrene Entwickler, die mit Python vertraut sind, aber den Zen des http-Protokolls kennen möchten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bereit? </font><font style="vertical-align: inherit;">Lass uns unter die Katze gehen.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intro </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, dieser Artikel ist eine Textbegleitung zu meinem Video (ich versuche, ein Videoblog zu führen). Bei Interesse ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video auf Youtube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Haben Sie jemals die Idee gehabt, ein Programm zu schreiben, das sonst niemand geschrieben hat? Etwas bis zum Wahnsinn einzigartiges, absolut (oder fast absolut) nutzloses, aber interessantes? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nein? Gott sei Dank lesen mich normale Leute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ich habe ein einzigartiges und sehr interessantes Projekt konzipiert, dessen Implementierung es mir und dem Leser ermöglichen wird, in der Praxis zu verstehen, wie http und der Webserver tatsächlich funktionieren. Dieses Projekt wird den Leser in die Welt der Wahnsinns-http-Spezifikationen eintauchen lassen, das Paradoxon regulärer Ausdrücke und Treibermängel :-). Was ermöglicht es Ihnen, alle Schmerzen der Entwicklung auf niedriger Ebene zu kennen und einfache dumme Benutzeranforderungen zu genießen</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Übrigens, vielleicht werden Sie überrascht sein, aber die Idee dieses Projekts wurde nicht aus dem Nichts geboren. </font><font style="vertical-align: inherit;">Tatsache ist, dass ich einen Raspberry PI Zero ohne Wi-Fi und NodeMCU mit Wi-Fi habe. </font><font style="vertical-align: inherit;">Also dachte ich - ist es möglich, einen Webserver auf Django zu schreiben und auf einem Raspberry PI zu hosten, während eine Verbindung zum Netzwerk über Wi-Fi hergestellt wird. </font><font style="vertical-align: inherit;">Ein normaler Mensch hätte daran gedacht, entweder eine Himbeere mit WLAN zu kaufen oder einen WLAN-Adapter an eine Himbeere anzuschließen. </font><font style="vertical-align: inherit;">Ich hatte die Idee, den ESP8266 an die Himbeere anzuschließen, aber da der ESP8266 nicht als Netzwerkadapter funktionieren kann, kam mir die Idee. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fuh, ich hoffe ich habe es gerechtfertigt. </font><font style="vertical-align: inherit;">Nun zum Punkt</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Theorie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ein Webserver ist eine ziemlich komplizierte Sache, die auf niedriger Ebene mit Sockets arbeitet, rohe http-Anforderungen analysiert, Header analysiert, Verbindungen verwaltet, die Last ausgleicht usw. Es ist besser, dieses komplexe Modul getrennt zu halten, da die Webanwendung bereits mit übergeordneten Konzepten von Modellen, Controllern und Ansichten arbeitet. Beide Komponenten sind für die Arbeit des Webs notwendig und wichtig, aber die für ihre Entwicklung erforderlichen Wissensbereiche überschneiden sich nicht sehr, so dass es für sie besser ist, so wenig wie möglich voneinander zu wissen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie wissen, gibt es viele, die mit Python-Webserver-Anwendungen kompatibel sind (Gunicorn, Bojern, CherryPy, aber nicht viele davon). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem gibt es viele Webframeworks, die mit jedem dieser Webserver funktionieren können.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie kommt es dazu? Es ist einfach - wir brauchen einen Standard, und dieser Standard heißt WSGI. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/8ba/d1c/7a9/8bad1c7a923c50240e6ebb6fbce51465.png" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 1 WSGI</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
WSGI ist Teil der PEP-Spezifikation und ermöglicht Ihnen die Verwendung verschiedener Frameworks und Webanwendungen, ohne dass die Kompatibilität beeinträchtigt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgende Abbildung zeigt perfekt meine Vorstellung von einem Python-Webserver. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a34/c40/ccd/a34c40ccd0f6ed6e94d812addf8a0fcd.png" alt="Bild"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 2</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Der Leser konnte ESP8266 auf dem Bild erkennen. Nein, ich werde den Webserver nicht auf diesem Gerät platzieren, da er im Vergleich zu meiner Idee zu alltäglich wäre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP8266 wird mit der werkseitigen AT-Firmware geflasht und akzeptiert nur AT-Befehle. Am wichtigsten ist jedoch, dass er mithilfe von AT-Befehlen sosket north anheben kann, das http-Anforderungen vom Client empfängt (über WLAN empfängt) und diese über die serielle Schnittstelle sendet</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An der seriellen Schnittstelle überträgt ESP zwei wichtige Parameter - die Socket-ID, die angibt, dass wir eine Antwort an den Client zurückgeben. ESP8266 unterstützt übrigens maximal 4 gleichzeitige Socket-Verbindungen. Und natürlich die http-Anfrage </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser Python 3-Webserver analysiert http, indem er die Header in ein spezielles Umgebungsobjekt faltet und das Anwendungsobjekt auslöst, indem er die Methode start_response übergibt, mit der unsere Anwendung die Antwort und das Umgebungswörterbuch zurückgibt, das alle erforderlichen Header und den Hauptteil der http-Anfrage enthält (erforderliche Methoden) und die erforderlichen Umgebungswörterbuchschlüssel sind ein wesentlicher Bestandteil der WSGI-Spezifikation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem der Rahmen die Anforderung verarbeitet und erzeugt eine Antwort, zieht es die start_response Methode, bei diesem Verfahren wir die Parameter erhalten benötigt , um </font><font style="vertical-align: inherit;">die HTTP - </font><font style="vertical-align: inherit;">Antwort zu erzeugen, bauten den rohen HTML - </font><font style="vertical-align: inherit;">String, und übertragen Sie </font><font style="vertical-align: inherit;">die </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ganze Sache an den Client </font><font style="vertical-align: inherit;">über die serielle Schnittstelle in Esp8266. </font><font style="vertical-align: inherit;">Esp8266, wiederum </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, Ich habe den richtigen Weg gefunden, um ESP8266 AT mit der werkseitigen Firmware zu flashen, in einem ausgezeichneten Artikel, auf den Sie unter Nummer 2 im Abschnitt Nützliche URLs </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
verweisen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Bei AT-Befehlen lautet die Kommunikation mit ESP8266 wie folgt (ich verwende die ESPloter-Shell für die Kommunikation). </font><font style="vertical-align: inherit;">Ich gehe davon aus, dass der ESP8266 WiFi hat. </font><font style="vertical-align: inherit;">Wenn Wi-Fi nicht aktiviert ist, ist dies auch über ESPloter einfach</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl AT + CIPMUX = 1 - öffnet mehrere Verbindungen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl AT + CIPSERVER = 1.80 (Port 80, den wir öffnen)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach Eingabe dieser Befehle haben wir den TCP-Server auf ESP8266 erhöht und können Anforderungen vom Client empfangen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 senden </font><font style="vertical-align: inherit;">die Antwort auch mit 2 Befehlen an den Client zurück </font><font style="vertical-align: inherit;">- AT + CIPSEND-Befehl = Socket-Nummer, Anzahl der Bytes </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach Abschluss dieses Befehls wartet das Terminal auf eine Nachricht mit der angegebenen Anzahl von Bytes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir genügend Zeichen eingeben, endet die Übertragungssitzung und wir müssen einen neuen Befehl </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AT + CIPCLOSE = Nummer eingeben Steckdose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach beendet der Browser die Sitzung und zeigt den übertragenen Text an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles für heute. </font><font style="vertical-align: inherit;">Ich hoffe, dass ich in der nächsten Woche den praktischen Teil hinzufügen und auslegen werde. </font><font style="vertical-align: inherit;">Ich habe eine Reihe von Problemen, hauptsächlich mit dem Betrieb des Terminals und dem http-Parsing, aber sie scheinen lösbar zu sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danke! </font><font style="vertical-align: inherit;">Tschüss.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nützliche URLs</font></font></h3> <br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Artikel von </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Let`s Build A Web Server</font></a><font style="vertical-align: inherit;"> hat mir in diesem Projekt sehr geholfen.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Artikel </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Wiederherstellen der AT-Firmware auf dem ESP8266</font></a><font style="vertical-align: inherit;"> hat mir </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">beim Flashen des ESP8266</font></a><font style="vertical-align: inherit;"> geholfen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterschätzen Sie nicht die Macht der offiziellen Dokumentation. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiele für AT-Befehle</font></font></a></li>
</ol></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de486752/">https://habr.com/ru/post/de486752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486740/index.html">Schreiben einer API in Rust mithilfe von prozeduralen Makros</a></li>
<li><a href="../de486742/index.html">Interview mit Anatoly Wasserman über die Zukunft</a></li>
<li><a href="../de486744/index.html">Ein intelligenter, inländischer Haltungskorrektor wurde zum Verkauf angeboten. Wir haben uns das neue Produkt - IBACK - angesehen</a></li>
<li><a href="../de486746/index.html">Schreiben, nicht schneiden. Was ich in Habrs Veröffentlichungen zu vermissen begann</a></li>
<li><a href="../de486750/index.html">Die Serie "For All Mankind": Von einer alternativen Geschichte zum Müll</a></li>
<li><a href="../de486754/index.html">JIRA: Regeln für die rechtzeitige Vorbereitung köstlicher Software. TLDR 2: Anforderungsmanagement</a></li>
<li><a href="../de486756/index.html">Python für den Tester: Wie kleine C-Pandas-Skripte helfen, große Datenmengen zu testen</a></li>
<li><a href="../de486760/index.html">Sicherheitswoche 06: Werbe-Tracker in mobilen Anwendungen</a></li>
<li><a href="../de486762/index.html">Bedside Hosting: die gruselige Praxis des Home Hosting</a></li>
<li><a href="../de486764/index.html">Do-it-yourself Schema.org: Anpassen des Mikrolayouts ohne Programmierer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>