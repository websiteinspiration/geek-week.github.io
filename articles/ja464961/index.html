<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌔 👩🏽‍🤝‍👩🏼 🧜🏾 Unity UIでビジュアルコンポーネントを作成します。パーティクルシステム 🚔 😌 👩‍👧‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは！この記事では、Canvasでパーティクルシステムを視覚化するためのコンポーネントの例を使用して、UIで独自の視覚コンポーネントを作成する方法について説明します。
 
 この情報は、ユーザーインターフェイスにさまざまな効果を実装するのに役立ち、メッシュの生成や最適化にも使用できます。
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unity UIでビジュアルコンポーネントを作成します。パーティクルシステム</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464961/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは！</font><font style="vertical-align: inherit;">この記事では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canvasで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティクルシステムを視覚化するためのコンポーネントの例を使用して、UIで独自の視覚コンポーネントを作成する方法について説明します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この情報は、ユーザーインターフェイスにさまざまな効果を実装するのに役立ち、メッシュの生成や最適化にも使用できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oh/_n/xi/oh_nxiy4ykruzark8hkpzjzvh5i.gif" alt="画像"></div><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少しの理論またはコンポーネントの作成を開始する場所</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UnityのUIの基礎は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canvas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">UI要素の内部階層に従って、「マルチレイヤー」ジオメトリを表示するためにレンダリングシステムによって使用されるのは彼です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビジュアルユーザーインターフェイスコンポーネントは</font><font style="vertical-align: inherit;">、必要なすべてのデータを</font><i><font style="vertical-align: inherit;">CanvasRenderer</font></i><font style="vertical-align: inherit;">コンポーネント</font><font style="vertical-align: inherit;">に</font><i><font style="vertical-align: inherit;">渡し</font></i><font style="vertical-align: inherit;">てレンダリングする</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphic</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">（またはその派生</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MaskableGraphic</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">）を</font><font style="vertical-align: inherit;">継承する</font><font style="vertical-align: inherit;">必要があります。</font><i><font style="vertical-align: inherit;">OnPopulateMesh</font></i><font style="vertical-align: inherit;">メソッドでデータが作成されます</font><font style="vertical-align: inherit;">。これは、コンポーネントがジオメトリを更新する必要があるたびに呼び出されます（たとえば、要素のサイズを変更するとき）。</font><font style="vertical-align: inherit;">UIのメッシュの生成に役立つ</font><i><font style="vertical-align: inherit;">VertexHelper</font></i><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、パラメーターとして渡されます</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントの作成</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本</font></font></h3><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">MaskableGraphic</font></i><font style="vertical-align: inherit;">クラスから継承</font><font style="vertical-align: inherit;">
する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIParticleSystem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成する</font><font style="vertical-align: inherit;">ことから</font><font style="vertical-align: inherit;">実装を開始します</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">MaskableGraphic</font></i><font style="vertical-align: inherit;">は</font><i><font style="vertical-align: inherit;">Graphic</font></i><font style="vertical-align: inherit;">クラスの派生物で</font><font style="vertical-align: inherit;">あり、さらにマスクでの作業を提供します。</font><i><font style="vertical-align: inherit;">OnPopulateMesh</font></i><font style="vertical-align: inherit;">メソッドをオーバーライドし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">パーティクルシステムメッシュの頂点を生成するために</font><i><font style="vertical-align: inherit;">VertexHelper</font></i><font style="vertical-align: inherit;">を操作する</font><font style="vertical-align: inherit;">基本は</font><font style="vertical-align: inherit;">、次のようになります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UIParticleSystem</span> : <span class="hljs-title">MaskableGraphic</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPopulateMesh</span>(<span class="hljs-params">VertexHelper vh</span>)</span><font></font>
    {<font></font>
        vh.Clear();<font></font>
        ...<font></font>
        <span class="hljs-keyword">int</span> particlesCount = ... ;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; particlesCount; i++)<font></font>
        {<font></font>
            Color vertexColor = ... ;<font></font>
            Vector2[] vertexUV = ... ;<font></font>
<font></font>
            UIVertex[] quadVerts = <span class="hljs-keyword">new</span> UIVertex[<span class="hljs-number">4</span>];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)<font></font>
            {<font></font>
                Vector3 vertixPosition = ... ;<font></font>
                quadVerts[j] = <span class="hljs-keyword">new</span> UIVertex()<font></font>
                {<font></font>
                    position = vertixPosition,<font></font>
                    color = vertexColor,<font></font>
                    uv0 = vertexUV<font></font>
                };<font></font>
            }<font></font>
            vh.AddUIVertexQuad(quadVerts);<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、</font><i><font style="vertical-align: inherit;">Clear</font></i><font style="vertical-align: inherit;">メソッドを呼び出して、既存のデータから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VertextHelper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をクリアする必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、ピークに関する新しいデータを入力し始めることができます。</font><font style="vertical-align: inherit;">このため、</font><i><font style="vertical-align: inherit;">AddUIVertexQuad</font></i><font style="vertical-align: inherit;">メソッドが使用されます</font><font style="vertical-align: inherit;">。これにより、4つの頂点に関する情報を一度に追加できます。</font><font style="vertical-align: inherit;">この方法は、使いやすさを考慮して選択されています。</font><font style="vertical-align: inherit;">各粒子は長方形です。</font><font style="vertical-align: inherit;">各頂点は、</font><i><font style="vertical-align: inherit;">UIVertex</font></i><font style="vertical-align: inherit;">オブジェクトによって記述されます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すべてのパラメータのうち、</font><i><font style="vertical-align: inherit;">UV</font></i><font style="vertical-align: inherit;">スキャン</font><font style="vertical-align: inherit;">の位置、色、および一部の座標のみを入力する必要があります</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VertexHelper</font></font></b><div class="spoiler_text"><i>VertexHelper </i>        ,        .          <i>AddUIVertexStream</i>,      .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各フレームは、パーティクルの位置、色、その他のパラメータが変わるため、レンダリング用のメッシュも更新する必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、各フレームは呼び出します</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetVerticesDirtyの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">につながる新しいデータ、詳述する必要性にフラグを設定します、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnPopulateMesh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの</font><i><font style="vertical-align: inherit;">呼び出しを</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">マテリアルの場合も同様に、そのプロパティが変更された場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetMaterialDirty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを呼び出す必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    SetVerticesDirty();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mainTexture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロパティをオーバーライドします</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CanvasRendererに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渡され、</font><i><font style="vertical-align: inherit;">マテリアル</font></i><font style="vertical-align: inherit;">で使用さ</font><font style="vertical-align: inherit;">れるテクスチャ</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_MainTex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シェーダー</font><i><font style="vertical-align: inherit;">プロパティを示します</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを行うには</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">mainTexture</font></i><font style="vertical-align: inherit;">プロパティによって返される</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParticleImage</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドを作成し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> Texture ParticleImage;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> Texture mainTexture<font></font>
{<font></font>
    <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> ParticleImage; }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティクルシステム</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メッシュ頂点を生成するためのデータは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティクル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の位置、サイズ、色などのすべての計算に関与</font><font style="vertical-align: inherit;">する</font><i><font style="vertical-align: inherit;">ParticleSystem</font></i><font style="vertical-align: inherit;">コンポーネントから取得されます</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーティクルコンポーネントのレンダリングは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParticleSystemRenderer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、無効にされるため、メッシュの作成とUIでのレンダリングは、すでに他のコンポーネントである</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIParticleSystem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CanvasRendererに応答し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
操作に必要なフィールドを作成し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awake</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドで初期化します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIBehaviour</font></font></b><div class="spoiler_text"><i>Awake</i>,    ,   ,        <i>UIBehaviour</i>.   <i>UIBehaviour </i>       ,      <i>Graphic</i>.<br>
</div></div><br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> ParticleSystem _particleSystem;
<span class="hljs-keyword">private</span> ParticleSystemRenderer _particleSystemRenderer;
<span class="hljs-keyword">private</span> ParticleSystem.MainModule _main;
<span class="hljs-keyword">private</span> ParticleSystem.Particle[] _particles;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.Awake();<font></font>
<font></font>
    _particleSystem = GetComponent&lt;ParticleSystem&gt;();<font></font>
    _main = _particleSystem.main;<font></font>
    <font></font>
    _particleSystemRenderer = GetComponent&lt;ParticleSystemRenderer&gt;();<font></font>
    _particleSystemRenderer.enabled = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-keyword">int</span> maxCount = _main.maxParticles;<font></font>
    _particles = <span class="hljs-keyword">new</span> ParticleSystem.Particle[maxCount];<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_particles</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フィールド</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParticleSystemパーティクル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を格納</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">するために</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用され、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">MainModule</font></i><font style="vertical-align: inherit;">モジュールを簡単に</font><i><font style="vertical-align: inherit;">操作するために</font></i><font style="vertical-align: inherit;">使用されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fillメソッド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnPopulateMesh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。必要なすべてのデータをパーティクルのシステムから直接取得します。</font><font style="vertical-align: inherit;">補助変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vector3 [] _quadCorners</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vector2 [] _simpleUVを作成し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_quadCorners</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、パーティクルの中心を基準とした、長方形の4つのコーナーの座標が含まれています。</font><font style="vertical-align: inherit;">各粒子の初期サイズは、辺が1x1の正方形と見なされます。</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_simpleUV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><i><font style="vertical-align: inherit;">UV</font></i><font style="vertical-align: inherit;">座標</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スイープ、この場合、すべてのパーティクルはディスプレイスメントなしで同じテクスチャを使用します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Vector3[] _quadCorners = <span class="hljs-keyword">new</span> Vector3[]<font></font>
{<font></font>
    <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">-.5</span>f, <span class="hljs-number">-.5</span>f, <span class="hljs-number">0</span>),
    <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">-.5</span>f, <span class="hljs-number">.5</span>f, <span class="hljs-number">0</span>),
    <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">.5</span>f, <span class="hljs-number">.5</span>f, <span class="hljs-number">0</span>),
    <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">.5</span>f, <span class="hljs-number">-.5</span>f, <span class="hljs-number">0</span>)<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">private</span> Vector2[] _simpleUV = <span class="hljs-keyword">new</span> Vector2[]<font></font>
{<font></font>
    <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),
    <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>),
    <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),
    <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>),<font></font>
};<font></font>
</code></pre><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPopulateMesh</span>(<span class="hljs-params">VertexHelper vh</span>)</span><font></font>
{<font></font>
    vh.Clear();<font></font>
<font></font>
    <span class="hljs-keyword">int</span> particlesCount = _particleSystem.GetParticles(_particles);<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; particlesCount; i++)<font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> particle = _particles[i];<font></font>
<font></font>
        Vector3 particlePosition = particle.position;<font></font>
        Color vertexColor = particle.GetCurrentColor(_particleSystem) * color;<font></font>
        Vector3 particleSize = particle.GetCurrentSize3D(_particleSystem);<font></font>
<font></font>
        Vector2[] vertexUV = _simpleUV;<font></font>
        Quaternion rotation = Quaternion.AngleAxis(particle.rotation, Vector3.forward);<font></font>
<font></font>
        UIVertex[]quadVerts = <span class="hljs-keyword">new</span> UIVertex[<span class="hljs-number">4</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)<font></font>
        {<font></font>
            Vector3 cornerPosition = rotation * Vector3.Scale(particleSize, _quadCorners[j]);<font></font>
            Vector3 vertexPosition = cornerPosition + particlePosition;<font></font>
            vertexPosition.z = <span class="hljs-number">0</span>;<font></font>
            quadVerts[j] = <span class="hljs-keyword">new</span> UIVertex();<font></font>
            quadVerts[j].color = vertexColor;<font></font>
            quadVerts[j].uv0 = vertexUV[j];<font></font>
            quadVerts[j].position = vertexPosition;<font></font>
        }<font></font>
        vh.AddUIVertexQuad(quadVerts);<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vertexPosition</font></font></b><div class="spoiler_text">       ,    ( <i>Vector3.Scale(particleSize, _quadCorners[j])</i>)   (  <i>rotation </i> ).       <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、標準コンポーネントを使用して、テスト用のシンプルなUIを作成します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jo/aw/fq/joawfqnuoevb8sr9spfah6-rww0.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンポーネント</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParticleSystem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> add </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIParticleSystem</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/j4/jj/ca/j4jjcaimsgxf0bwgmkbu_lld3gi.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
シーンを実行し、コンポーネントの結果を確認します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ow/lb/d4/owlbd4oqkkdt9dl1twid2po-o1i.gif" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーティクルは、階層内の位置に従って表示され、使用されるマスクを考慮に入れます。</font><font style="vertical-align: inherit;">あなたが変更する場合と同様の画面とその割合の解像度を変更するとき</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendereモード</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャンバスを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、粒子が中に他のビジュアルコンポーネントのように動作</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャンバス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とのみで表示されます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SimulationSpace</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜなら </font><font style="vertical-align: inherit;">パーティクルシステムをUI内に配置します</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。SimulationSpace</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータに問題があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ワールド空間でシミュレーションすると、パーティクルは本来あるべき場所に表示されません。</font><font style="vertical-align: inherit;">したがって、パラメーター値に応じた粒子位置の計算を追加します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPopulateMesh</span>(<span class="hljs-params">VertexHelper vh</span>)</span><font></font>
{<font></font>
    ...<font></font>
    Vector3 particlePosition;<font></font>
        <span class="hljs-keyword">switch</span> (_main.simulationSpace)<font></font>
        {<font></font>
            <span class="hljs-keyword">case</span> ParticleSystemSimulationSpace.World:<font></font>
                particlePosition = _rectTransform.InverseTransformPoint(particle.position);<font></font>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> ParticleSystemSimulationSpace.Local:<font></font>
                particlePosition = particle.position;<font></font>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> ParticleSystemSimulationSpace.Custom:
                <span class="hljs-keyword">if</span> (_main.customSimulationSpace != <span class="hljs-literal">null</span>)<font></font>
                    particlePosition = _rectTransform.InverseTransformPoint( _main.customSimulationSpace.TransformPoint(particle.position) );<font></font>
                <span class="hljs-keyword">else</span><font></font>
                    particlePosition = particle.position;<font></font>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:<font></font>
                particlePosition = particle.position;<font></font>
                <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    ...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParticleSystemRendererプロパティのシミュレーション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParticleSystemRenderer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能の一部を実装します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">つまり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RenderMode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SortMode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pivot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のプロパティです</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダラー</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーティクルは常にキャンバスの平面にのみ配置されるという事実に制限されます。</font><font style="vertical-align: inherit;">したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Billboard</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StretchedBillboardの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つの値のみを実装します</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">thisの</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
列挙</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CanvasParticleSystemRenderMode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成してみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> CanvasParticleSystemRenderMode<font></font>
{<font></font>
    Billboard = <span class="hljs-number">0</span>,<font></font>
    StretchedBillboard = <span class="hljs-number">1</span><font></font>
}<font></font>
</code></pre><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> CanvasParticleSystemRenderMode RenderMode;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> SpeedScale = <span class="hljs-number">0f</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> LengthScale = <span class="hljs-number">1f</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPopulateMesh</span>(<span class="hljs-params">VertexHelper vh</span>)</span><font></font>
{<font></font>
    ...<font></font>
    Quaternion rotation;<font></font>
    <span class="hljs-keyword">switch</span> (RenderMode)<font></font>
    {<font></font>
        <span class="hljs-keyword">case</span> CanvasParticleSystemRenderMode.Billboard:<font></font>
            rotation = Quaternion.AngleAxis(particle.rotation, Vector3.forward);<font></font>
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> CanvasParticleSystemRenderMode.StretchedBillboard:<font></font>
            rotation = Quaternion.LookRotation(Vector3.forward, particle.totalVelocity);<font></font>
            <span class="hljs-keyword">float</span> speed = particle.totalVelocity.magnitude;<font></font>
            particleSize = Vector3.Scale(particleSize, <span class="hljs-keyword">new</span> Vector3(LengthScale + speed * SpeedScale, <span class="hljs-number">1f</span>, <span class="hljs-number">1f</span>));<font></font>
            rotation *= Quaternion.AngleAxis(<span class="hljs-number">90</span>, Vector3.forward);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:<font></font>
            rotation = Quaternion.AngleAxis(particle.rotation, Vector3.forward);<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StretchedBillboard</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パラメータを選択した場合</font><font style="vertical-align: inherit;">、パーティクルサイズは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LengthScale </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">SpeedScaleパラメータ</font></i><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">依存し、</font><font style="vertical-align: inherit;">その回転は移動方向にのみ向けられます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x9/pl/um/x9plumx0rkcnjq-0gialrkkb2oc.gif" alt="画像"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソートモード</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CanvasParticlesSortMode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列挙を作成します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">パーティクルの寿命によるソートのみを実装しています。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> CanvasParticlesSortMode<font></font>
{<font></font>
    None = <span class="hljs-number">0</span>,<font></font>
    OldestInFront = <span class="hljs-number">1</span>,<font></font>
    YoungestInFront = <span class="hljs-number">2</span>
}</code></pre><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> CanvasParticlesSortMode SortMode;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
並べ替えを行うには、パーティクルの寿命に関するデータを保存する必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_particleElapsedLifetimeに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存されます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">並べ替えは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array.Sort</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを使用して実装され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span>[] _particleElapsedLifetime;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    _particles = <span class="hljs-keyword">new</span> ParticleSystem.Particle[maxCount];<font></font>
    _particleElapsedLifetime = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[maxCount];<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPopulateMesh</span>(<span class="hljs-params">VertexHelper vh</span>)</span><font></font>
{<font></font>
    vh.Clear();<font></font>
<font></font>
    <span class="hljs-keyword">int</span> particlesCount = _particleSystem.GetParticles(_particles);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; particlesCount; i++)    <font></font>
        _particleElapsedLifetime[i] = _particles[i].startLifetime - _particles[i].remainingLifetime;<font></font>
<font></font>
    <span class="hljs-keyword">switch</span> (SortMode)<font></font>
    {<font></font>
        <span class="hljs-keyword">case</span> CanvasParticlesSortMode.None: <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> CanvasParticlesSortMode.OldestInFront:<font></font>
            Array.Sort(_particleElapsedLifetime, _particles, <span class="hljs-number">0</span>, particlesCount,Comparer&lt;<span class="hljs-keyword">float</span>&gt;.Default);<font></font>
            Array.Reverse(_particles, <span class="hljs-number">0</span>, particlesCount);
        <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> CanvasParticlesSortMode.YoungestInFront:<font></font>
            Array.Sort(_particleElapsedLifetime, _particles, <span class="hljs-number">0</span>, particlesCount, Comparer&lt;<span class="hljs-keyword">float</span>&gt;.Default);
        <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    ... <font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピボット</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティクルの中心点をオフセット</font><font style="vertical-align: inherit;">
する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピボット</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> Vector3 Pivot = Vector3.zero;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、頂点の位置を計算するときに、この値を追加します。</font></font><br>
<br>
<pre><code class="cs hljs">Vector3 cornerPosition = Vector3.Scale(particleSize, _quadCorners[j] + Pivot);<font></font>
Vector3 vertexPosition = rotation * cornerPosition + particlePosition;<font></font>
vertexPosition.z = <span class="hljs-number">0</span>;
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調節可能なサイズ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーティクルシステムが接続されている要素のサイズが固定されていないか、実行時に変更される可能性がある場合は、パーティクルシステムのサイズを調整すると便利です。ソースを作成しましょう- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形状</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は要素のサイズに比例します。</font><i><font style="vertical-align: inherit;">OnRectTransformDimensionsChange</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RectTransform</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントの</font><i><font style="vertical-align: inherit;">サイズ</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">変更さ</font></i><font style="vertical-align: inherit;">れると呼び出され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RectTransformの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寸法に合うように形状にスケール変更を実装することにより、このメソッドを再定義し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RectTransform</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネント</font><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ShapeModule</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール</font><font style="vertical-align: inherit;">の変数を作成し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。シェイプのスケーリングを無効にするには、</font><i><font style="vertical-align: inherit;">ScaleShapeByRectTransform</font></i><font style="vertical-align: inherit;">変数を作成します</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、コンポーネントがアクティブ化されたときにスケーリングを実行して、初期スケールを設定する必要があります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> RectTransform _rectTransform;
<span class="hljs-keyword">private</span> ParticleSystem.ShapeModule _shape;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> ScaleShapeByRectTransform;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
        _rectTransform = GetComponent&lt;RectTransform&gt;();<font></font>
        _shape = _particleSystem.shape;<font></font>
    ...<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEnable</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.OnEnable();<font></font>
    ScaleShape();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnRectTransformDimensionsChange</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.OnRectTransformDimensionsChange();<font></font>
    ScaleShape();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ScaleShape</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (!ScaleShapeByRectTransform)
        <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    Rect rect = _rectTransform.rect;<font></font>
    <span class="hljs-keyword">var</span> scale = Quaternion.Euler(_shape.rotation) * <span class="hljs-keyword">new</span> Vector3(rect.width, rect.height, <span class="hljs-number">0</span>);<font></font>
    scale = <span class="hljs-keyword">new</span> Vector3(Mathf.Abs(scale.x), Mathf.Abs(scale.y), Mathf.Abs(scale.z));<font></font>
    _shape.scale = scale;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
計算するときは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shape</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の回転を考慮する価値があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">最終結果の値は、モジュロを取る必要があります。これは、負になる可能性があるためです。これは、パーティクルの動きの方向に影響します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
操作をテストする</font><font style="vertical-align: inherit;">には、パーティクルシステムが接続され</font><font style="vertical-align: inherit;">た</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RectTransform</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズ変更</font><i><font style="vertical-align: inherit;">アニメーションを</font></i><font style="vertical-align: inherit;">実行</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mg/5p/8u/mg5p8ukxutwtnw4pwysqfshgnuc.gif" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトがエディターで正しく実行され、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnRectTransformDimensionsChange</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを呼び出すときのエラーを回避するために</font><font style="vertical-align: inherit;">、変数の初期化を別のメソッドで行います。</font><font style="vertical-align: inherit;">そして、彼の呼び出しを追加</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnPopulateMesh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnRectTransformDimensionsChange方法</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExecuteInEditMode</font></font></b><div class="spoiler_text">  <i>ExecuteInEditMode </i> , .. <i>Graphic </i>        .<br>
</div></div><br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> _initialized;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_initialized)
        <span class="hljs-keyword">return</span>;<font></font>
    _initialized = <span class="hljs-literal">true</span>;<font></font>
    _rectTransform = GetComponent&lt;RectTransform&gt;();<font></font>
    _particleSystem = GetComponent&lt;ParticleSystem&gt;();<font></font>
<font></font>
    _main = _particleSystem.main;<font></font>
    _textureSheetAnimation = _particleSystem.textureSheetAnimation;<font></font>
    _shape = _particleSystem.shape;<font></font>
<font></font>
    _particleSystemRenderer = GetComponent&lt;ParticleSystemRenderer&gt;();<font></font>
    _particleSystemRenderer.enabled = <span class="hljs-literal">false</span>;<font></font>
    _particleSystemRenderer.material = <span class="hljs-literal">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> maxCount = _main.maxParticles;<font></font>
    _particles = <span class="hljs-keyword">new</span> ParticleSystem.Particle[maxCount];<font></font>
    _particlesLifeProgress = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[maxCount];<font></font>
    _particleRemainingLifetime = <span class="hljs-keyword">new</span> <span class="hljs-keyword">float</span>[maxCount];                <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">base</span>.Awake();<font></font>
    Initialize();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPopulateMesh</span>(<span class="hljs-params">VertexHelper vh</span>)</span><font></font>
{<font></font>
    Initialize();<font></font>
    ...<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnRectTransformDimensionsChange</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> UNITY_EDITOR</span><font></font>
    Initialize();<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnRectTransformDimensionsChange</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッド</font><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awake</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より前に</font><i><font style="vertical-align: inherit;">呼び出す</font></i><font style="vertical-align: inherit;">こと</font><font style="vertical-align: inherit;">ができます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、呼び出しのたびに変数を初期化する必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスと最適化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このパーティクルのレンダリングは</font><font style="vertical-align: inherit;">、特にモバイルデバイスでより慎重に使用する必要がある</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParticleSystemRenderer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する場合よりも少しコストがかかり</font><font style="vertical-align: inherit;">ます。</font><i><font style="vertical-align: inherit;">Canvas</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
要素の少なくとも1つが</font><i><font style="vertical-align: inherit;">Dirty</font></i><font style="vertical-align: inherit;">としてマークされ</font><font style="vertical-align: inherit;">ている場合</font><font style="vertical-align: inherit;">、これにより</font><i><font style="vertical-align: inherit;">Canvas</font></i><font style="vertical-align: inherit;">ジオメトリ全体が再計算され、</font><font style="vertical-align: inherit;">新しいレンダリングコマンドが生成</font><font style="vertical-align: inherit;">される</font><font style="vertical-align: inherit;">ことにも注意してください</font><font style="vertical-align: inherit;">。 UIに多くの複雑なジオメトリとその計算が含まれている場合は、UIをいくつかの埋め込みキャンバスに分割する価値があります。</font><font style="vertical-align: inherit;">
PS：すべてのソースコードとデモは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">git link</font></a><font style="vertical-align: inherit;">です。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/q7/ri/o6/q7rio6go21xszatko5jp0fc4c0k.gif" alt="画像"><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事は、UIでParticleSystemを使用する必要があった後、ほぼ1年前に公開されました。</font><font style="vertical-align: inherit;">当時、私は同様の解決策を見つけられず、利用可能な解決策は現在のタスクに最適ではありませんでした。</font><font style="vertical-align: inherit;">しかし、この記事の公開の数日前、資料を収集しているときに、Graphic.OnPopulateMeshメソッドを使用して同様のソリューションを誤って見つけました。</font><font style="vertical-align: inherit;">したがって、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリへのリンクを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定する必要があると思い</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464947/index.html">8月25日から9月1日までのモスクワでのデジタルイベント</a></li>
<li><a href="../ja464949/index.html">もう一度、GCD、ユークリッドアルゴリズム、および一般的なアルゴリズムの歴史について少し説明します。もちろんSwiftの例では</a></li>
<li><a href="../ja464951/index.html">タスクが単純であるほど、私は誤解されることが多い</a></li>
<li><a href="../ja464955/index.html">Iron Mike TysonとブロックチェーンプロジェクトFight to Fame</a></li>
<li><a href="../ja464959/index.html">ロシア語の文を解析する</a></li>
<li><a href="../ja464963/index.html">Quest FoglightでMicrosoft SQL Serverのパフォーマンスの問題をすばやくローカライズ</a></li>
<li><a href="../ja464967/index.html">先週のフロントエンドの世界からの新鮮な食材のダイジェストNo. 377（2019年8月19日〜25日）</a></li>
<li><a href="../ja464969/index.html">CRISPRは人を苦痛から救う機会を提供します</a></li>
<li><a href="../ja464971/index.html">PHPダイジェストNo. 163（2019年8月12〜26日）</a></li>
<li><a href="../ja464973/index.html">10分で曲を書く（textgenrnn Python3モジュール）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>