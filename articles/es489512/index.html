<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçü§ù‚Äçüë®üèº üë©üèº‚Äç‚úàÔ∏è üçÜ Aleteo. BlOC, Proveedor, as√≠ncrono - Arquitectura de estante üñïüèΩ üêé üëª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducci√≥n
 Cuando intentas escribir una aplicaci√≥n, lo primero que encuentras es c√≥mo organizar la arquitectura de la aplicaci√≥n. Y cuando se trata...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Aleteo. BlOC, Proveedor, as√≠ncrono - Arquitectura de estante</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489512/"><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando intentas escribir una aplicaci√≥n, lo primero que encuentras es c√≥mo organizar la arquitectura de la aplicaci√≥n. </font><font style="vertical-align: inherit;">Y cuando se trata de Flutter, la cabeza puede dar la vuelta completa a lo que Google ofrece: Vanilla, Scoped Model, BLoC, MVP, MVC, MVVM, MVI, etc. </font><font style="vertical-align: inherit;">Supongamos que decide ir de la manera m√°s moderna (la que Google aconsej√≥ en 2018) y usar BLOC. </font><font style="vertical-align: inherit;">¬øQu√© es? </font><font style="vertical-align: inherit;">¬øC√≥mo usarlo? </font><font style="vertical-align: inherit;">O tal vez Redux o RxDart? </font><font style="vertical-align: inherit;">- aunque la parada es sobre el "otro" ... Pero a√∫n as√≠, ¬øqu√© sigue? </font><font style="vertical-align: inherit;">¬øQu√© bibliotecas conectar? </font><font style="vertical-align: inherit;">Bloc, Flutter_bloc, bloc_pattern, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tal cantidad de opciones de arquitectura y herramientas para su implementaci√≥n realmente pueden retrasar la etapa de selecci√≥n durante mucho tiempo.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para quien el articulo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El art√≠culo ser√° principalmente √∫til para aquellos que reci√©n comienzan a aprender Flutter y no saben por d√≥nde empezar. </font><font style="vertical-align: inherit;">Mostrar√© una de las opciones para implementar la aplicaci√≥n en Flutter. </font><font style="vertical-align: inherit;">Esto le permitir√° "sentir" Flutter y luego decidir por s√≠ mismo c√≥mo y con qu√© escribir sus aplicaciones.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patrones y herramientas. </font><font style="vertical-align: inherit;">Breve y simple</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos a empezar. Lo primero que vale la pena se√±alar es que hay una arquitectura de aplicaci√≥n (patr√≥n, plantilla, alg√∫n concepto de construcci√≥n): esto es exactamente lo mismo: BLoC, MVP, MVC, MVVM, MVI, etc. Muchas de estas arquitecturas se usan no solo en Flutter, sino tambi√©n en otros lenguajes de programaci√≥n. Pregunta: ¬øqu√© elegir? En mi opini√≥n, debe elegir lo que usted mismo sabe bien, pero solo si esto implica reactividad y una separaci√≥n estricta de la l√≥gica comercial de la interfaz (s√≠, s√≠, "un autom√≥vil puede ser de cualquier color si es negro"). En cuanto a la separaci√≥n de la interfaz y la l√≥gica empresarial, creo que no hay necesidad de explicarlo, pero en cuanto a la reactividad, intente, si no lo ha intentado, al final es realmente muy conveniente y "hermoso". Si no puede elegirlo usted mismo, perm√≠tanos permitir que lo hagan por nosotros no los tipos m√°s est√∫pidos de Google: BLOC. Descubrimos la arquitectura.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora las herramientas, hay bibliotecas listas para usar: Bloc, Flutter_bloc, bloc_pattern, ¬øcu√°l es mejor? No lo s√©, todos son buenos. Puedes elegir y comparar durante mucho tiempo, pero aqu√≠ de nuevo, como en el ej√©rcito, es mejor tomar una decisi√≥n equivocada por ahora que no tomar ninguna. Y por ahora, sugiero volver despu√©s del mod y usar Provider (lo que los mismos chicos recomiendan usar en 2019).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo esto nos permitir√° hacer tanto el bloque global como el bloque local, seg√∫n sea necesario. </font><font style="vertical-align: inherit;">Mucho se ha escrito sobre la arquitectura de BLoC (es decir, un patr√≥n, no bibliotecas), creo que no deber√≠a volver a analizarlo en detalle. </font><font style="vertical-align: inherit;">Observo solo un punto en este art√≠culo, no se utilizar√° BLoC cl√°sico, sino que se modificar√° ligeramente: en acciones BLoC (eventos) no se transmitir√°n a trav√©s de Sinks, pero se llamar√°n las funciones BLoC. </font><font style="vertical-align: inherit;">Simplemente, por el momento, no veo los beneficios de usar Sinks, y dado que no est√°n all√≠, ¬øpor qu√© complicar tu vida?</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asincron√≠a y computaci√≥n paralela en Dart</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n vale la pena aclarar un poco el concepto de asincron√≠a en Dart, ya que estamos hablando de reactividad. Muy a menudo, en las primeras etapas del conocimiento de Dart, el significado de las funciones asincr√≥nicas (as√≠ncronas) no se entiende correctamente. Siempre debe recordar que "por defecto" el programa se ejecuta en un hilo, y la asincron√≠a solo le permite cambiar la secuencia de comandos, en lugar de ejecutarlos en paralelo. Es decir, si simplemente ejecuta la funci√≥n con c√°lculos grandes simplemente marc√°ndola como as√≠ncrona, la interfaz se bloquear√°. Async NO inicia un nuevo hilo. La forma en que asincronizan y esperan el trabajo es que hay mucha informaci√≥n en Internet, por lo que tampoco me detendr√© en esto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si necesita hacer grandes c√°lculos y al mismo tiempo no bloquear la interfaz, debe usar la funci√≥n de c√°lculo (para el hardcore especial puede usar aislamientos). </font><font style="vertical-align: inherit;">Esto realmente comenzar√° un hilo de ejecuci√≥n separado, que tambi√©n tendr√° su propia √°rea de memoria separada (que es muy triste y triste). </font><font style="vertical-align: inherit;">Puede comunicarse con dichas secuencias solo a trav√©s de mensajes que pueden contener tipos de datos simples, sus listas.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos a practicar</font></font></h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulaci√≥n del problema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentemos escribir la aplicaci√≥n m√°s simple: que sea una especie de directorio telef√≥nico. </font><font style="vertical-align: inherit;">Usaremos Firebase como almacenamiento; esto nos permitir√° crear una aplicaci√≥n "en la nube". </font><font style="vertical-align: inherit;">Omitir√© c√≥mo conectar Firebase al proyecto (se ha escrito m√°s de un art√≠culo sobre este tema y no veo el punto de repetirlo. Nota: Cloud Firestore se usa en este proyecto). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deber√≠a ser as√≠:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/yj/js/xyyjjsknqbe1owqlc1vnbnec-pu.gif"><br>
<br>
<h1> <br>
</h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n de la aplicaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestra aplicaci√≥n contendr√° externamente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ventana de autorizaci√≥n de Firebase (la l√≥gica de esta ventana estar√° contenida en MainBloc).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ventana de informaci√≥n: mostrar√° informaci√≥n sobre el usuario con el que est√° autorizado el programa (la l√≥gica de esta ventana tambi√©n estar√° contenida en MainBloc).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ventana de directorio en forma de una lista de tel√©fonos (la l√≥gica de esta ventana estar√° contenida en un PhonebookBloc separado).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Men√∫ de aplicaciones que cambiar√° las pantallas.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La aplicaci√≥n interna se construir√° de la siguiente manera: cada pantalla contendr√° un archivo con widgets de pantalla, un archivo de bloque (con la clase de bloque correspondiente), un archivo de acciones (contiene clases simples que describen eventos que afectan el estado del bloque), un archivo de estados (contiene clases simples que reflejan el estado del bloque ), el archivo data_model que contiene la clase de repositorio (responsable de recibir datos) y la clase de datos (almacena datos de l√≥gica de negocios de bloque).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La aplicaci√≥n funcionar√° as√≠: cuando se abre la pantalla, el bloque correspondiente se inicializa con el valor de estado inicial y, si es necesario, se llama a alguna acci√≥n inicial en el constructor del bloque. </font><font style="vertical-align: inherit;">La pantalla se construye / reconstruye seg√∫n el estado, que devuelve el bloque. </font><font style="vertical-align: inherit;">El usuario realiza algunas acciones en la aplicaci√≥n que tienen acciones correspondientes. </font><font style="vertical-align: inherit;">Las acciones se pasan a la clase de bloque, donde se procesan en la funci√≥n mapEventToState y el bloque devuelve el nuevo estado a la pantalla, en funci√≥n del cual se reconstruye la pantalla.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estructura de archivo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, creamos un proyecto Flutter vac√≠o y hacemos la estructura del proyecto de este tipo (observo que en el proyecto de demostraci√≥n algunos archivos eventualmente permanecer√°n vac√≠os):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h8/r5/5j/h8r55j-7shyieywjwqkpkj-lwxi.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ventana de autorizaci√≥n. </font><font style="vertical-align: inherit;">Mainbloc</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora necesita implementar la autorizaci√≥n en Firebase. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos creando clases de eventos (es conveniente transferir datos a trav√©s de eventos en bloque) y estados para Bloque principal: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
archivo MainBloc \ actions</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainBlocAction</span></span>{<font></font>
  String get password =&gt; <span class="hljs-keyword">null</span>;<font></font>
  String get email =&gt; <span class="hljs-keyword">null</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
archivo MainBloc \ states</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainBlocState</span></span>{<font></font>
  bool busy;<font></font>
  MainBlocState({<span class="hljs-keyword">this</span>.busy = <span class="hljs-keyword">false</span>});<font></font>
  copy(bool busy) {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El indicador de ocupado en la clase de estado se usa para mostrar el progreso_hud en la interfaz y excluye las lecturas innecesarias de datos de la base de datos al desplazarse por la lista. </font><font style="vertical-align: inherit;">Antes de que comiencen todas las operaciones en el bloque, se emite un nuevo estado del tipo anterior con el indicador ocupado ocupado en la secuencia de salida, de esta manera la interfaz recibe una notificaci√≥n de que la operaci√≥n ha comenzado. </font><font style="vertical-align: inherit;">Al final de la operaci√≥n, se env√≠a un nuevo estado a la secuencia con el indicador ocupado ocupado borrado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los herederos de la clase MainBlocState describen el estado de la aplicaci√≥n principal Bloc. </font><font style="vertical-align: inherit;">Los herederos de MainBlocAction describen los eventos que ocurren en √©l.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clase MainBloc contiene 4 elementos principales: la funci√≥n de "convertir" eventos a estados (Future mapEventToState), el estado Bloc es _blocState, el repositorio de estado de bloque es el repositorio y la secuencia de estado de "salida" (que rastrean los elementos de interfaz) es blocStream. B√°sicamente, estos son todos los elementos que proporcionan funcionalidad de bloque. A veces es aconsejable usar 2 flujos de salida en un bloque, tal ejemplo ser√° menor. No lo enumerar√© aqu√≠; puede verlo descargando el proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clase de repositorio de bloques contiene la l√≥gica para trabajar con Firebase y un objeto (datos) que almacena los datos necesarios para la l√≥gica de negocios que implementa este bloque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Archivo MainBloc \ data_model</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainRepo</span></span>{<font></font>
<font></font>
  <span class="hljs-keyword">final</span> MainData data = MainData();<font></font>
<font></font>
  FirebaseAuth get firebaseInst =&gt; MainData.firebaseInst;<font></font>
<font></font>
  FirebaseUser _currentUser;<font></font>
<font></font>
  <span class="hljs-function">Future&lt;bool&gt; <span class="hljs-title">createUserWithEmailAndPassword</span><span class="hljs-params">(
      String email, String password)</span> async </span>{
    <span class="hljs-keyword">var</span> dataUser;
      <span class="hljs-keyword">try</span> {<font></font>
        dataUser =<font></font>
            (await firebaseInst.createUserWithEmailAndPassword(<font></font>
                email: email, password: password))<font></font>
                .user;<font></font>
      } <span class="hljs-keyword">catch</span> (e) {<font></font>
        print(Error.safeToString(e));<font></font>
        print(e.code);<font></font>
        print(e.message);<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span> (dataUser == <span class="hljs-keyword">null</span>){<font></font>
        data.setState(IsNotLogged());<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
      }<font></font>
<font></font>
      _currentUser = dataUser;<font></font>
      data.setState(IsLogged(),<font></font>
          uid: _currentUser.uid,<font></font>
          email: _currentUser.email);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
  }<font></font>
<font></font>
  ...}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainData</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> firebaseInst = FirebaseAuth.instance;
  <span class="hljs-keyword">static</span> MainBlocState _authState = IsNotLogged();
  <span class="hljs-keyword">static</span> MainBlocState get authState =&gt; _authState;
  <span class="hljs-keyword">static</span> String _uid;
  <span class="hljs-keyword">static</span> String get uid =&gt; _uid;
  <span class="hljs-keyword">static</span> String _email;
  <span class="hljs-keyword">static</span> String get email =&gt; _email;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setState</span><span class="hljs-params">(MainBlocState newState,
      {String uid = <span class="hljs-string">''</span>, String email = <span class="hljs-string">''</span>})</span> </span>{<font></font>
    _authState = newState;<font></font>
    _uid = uid;<font></font>
    _email = email;<font></font>
  }<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clase MainData tambi√©n almacena el estado, pero el estado de autorizaci√≥n en Firebase y no el estado Bloc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escribimos la l√≥gica para el bloque principal, ahora podemos comenzar a implementar la pantalla de autorizaci√≥n / registro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MainBloc se inicializa en el archivo principal: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
el archivo principal</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-comment">// This widget is the root of your application.</span>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">return</span> Provider(<font></font>
        create: (context) =&gt; MainBloc(),<font></font>
        dispose: (context, value) =&gt; value.dispose(),<font></font>
        child: MaterialApp(<font></font>
          routes: menuRoutes,<font></font>
        ));<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es hora de hacer una peque√±a digresi√≥n sobre StreamBuilder, Provider, StreamProvider, Consumer y Selector.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retiro sobre proveedores</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proveedor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : solo transfiere el valor almacenado hacia abajo en el √°rbol. Y puede acceder solo despu√©s de la compilaci√≥n secundaria, es decir necesitas construir un sub widget. No nos hacemos responsables de actualizar los widgets. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StreamBuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un widget que supervisa la transmisi√≥n y se reconstruye por completo cuando </font><b><font style="vertical-align: inherit;">recibe un</font></b><font style="vertical-align: inherit;"> nuevo objeto de la transmisi√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StreamProvider</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : un widget que monitorea el flujo y cuando se recibe un nuevo objeto, indica que los widgets secundarios (aquellos que se declaran como una clase separada con el m√©todo de compilaci√≥n) deben reconstruirse. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El consumidor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selector</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son "az√∫car sint√°ctico", es decir esto es en realidad un "contenedor" que contiene compilaci√≥n y oculta el widget debajo. En Selector-e, puede hacer un filtrado adicional de actualizaciones.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, cuando necesite reconstruir la mayor parte de la pantalla en cada evento, puede usar la opci√≥n con Proveedor y StreamBuilder. </font><font style="vertical-align: inherit;">Cuando sea necesario reconstruir partes del √°rbol de widgets cerca de las hojas, es recomendable usar StreamProvider en combinaci√≥n con Consumer y Selector para excluir reconstrucciones innecesarias del √°rbol.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorizaci√≥n </font><font style="vertical-align: inherit;">Continuaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al ingresar a la aplicaci√≥n, el usuario debe acceder a la ventana de autorizaci√≥n / registro, y en ese momento el men√∫ de la aplicaci√≥n a√∫n no debe estar disponible para √©l. El segundo punto: actualizar parcialmente esta pantalla no tiene mucho sentido, por lo que podemos usar StreamBuilder para construir la interfaz. Y el tercer punto en el proyecto es usar Navigator para navegar entre pantallas. Al recibir un evento de autorizaci√≥n exitosa, es necesario llamar a la transici√≥n a la pantalla de informaci√≥n. Pero justo dentro de BuildBuilder, esto no funcionar√°, habr√° un error. Para evitar esto, puede usar la clase de contenedor auxiliar StreamBuilderWithListener (Eugene Brusov - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stackoverflow.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora la lista de esta pantalla es auth_screen en s√≠ (dar√© aqu√≠ en parte): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Archivo auth_screen</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
  <span class="hljs-keyword">var</span> bloc = Provider.of&lt;MainBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
  <span class="hljs-keyword">return</span> StreamBuilderWithListener&lt;MainBlocState&gt;(<font></font>
      stream: bloc.blocStream.stream,<font></font>
      listener: (value) {<font></font>
        <span class="hljs-comment">//not allowed call navigator push in build</span>
        <span class="hljs-keyword">if</span> (value is IsLogged) {<font></font>
          Navigator.of(context).pushReplacementNamed(InfoScreen.nameMenuItem);<font></font>
        }<font></font>
      },<font></font>
      initialData: bloc.state,<font></font>
      builder: (context, snappShot) {<font></font>
        <span class="hljs-keyword">if</span> (snappShot.data is IsLoggedOnStart) {
          <span class="hljs-keyword">return</span> LoggedWidget();<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snappShot.data is IsLogged) {
          <span class="hljs-comment">//not allowed call navigator push in build</span>
          <span class="hljs-keyword">return</span> ModalProgressHUD(<font></font>
              inAsyncCall: <span class="hljs-keyword">true</span>,<font></font>
          child: Text(<span class="hljs-string">''</span>),);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snappShot.data is IsNotLogged) {
          <span class="hljs-keyword">return</span> SignInAndSignUpWidget();<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> Scaffold(body: Text(<span class="hljs-string">"                Unknown event"</span>));<font></font>
      });<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, se crea un StreamBuilderWithListener para escuchar la transmisi√≥n desde el bloque. </font><font style="vertical-align: inherit;">Y seg√∫n el estado actual, se llama al widget LoggedWidget (si el usuario ya ha iniciado sesi√≥n) o SignInAndSignUpWidget (si el usuario a√∫n no ha iniciado sesi√≥n). </font><font style="vertical-align: inherit;">Si el bloque devuelve el estado IsLogged, el cambio a una nueva pantalla utilizando el navegador no se produce en el generador (lo que provocar√≠a un error), sino en el oyente. </font><font style="vertical-align: inherit;">En los widgets subyacentes, la interfaz se crea en funci√≥n de los datos devueltos aqu√≠. </font><font style="vertical-align: inherit;">Aqu√≠, el paquete Provider + StreamBuilder se usa realmente, porque </font><font style="vertical-align: inherit;">cuando cambia el estado del bloque, pr√°cticamente cambia toda la interfaz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para transferir datos al bloque, se utilizan TextEditingController y par√°metros de acci√≥n: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
archivo auth_screen</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_SignUpWidgetWidgetState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span> </span>{<font></font>
  String _email, _password;<font></font>
<font></font>
  <span class="hljs-keyword">final</span> TextEditingController _emailController = TextEditingController();
  <span class="hljs-keyword">final</span> TextEditingController _passwordController = TextEditingController();<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initState</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">super</span>.initState();<font></font>
    _emailController.addListener(_onEmailChanged);<font></font>
    _passwordController.addListener(_onPasswordChanged);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">return</span> Column(<font></font>
      children: &lt;Widget&gt;[<font></font>
        TextFormField(<font></font>
          controller: _emailController,<font></font>
          decoration: InputDecoration(<font></font>
              labelText: <span class="hljs-string">'email'</span>),<font></font>
        ),<font></font>
        TextFormField(<font></font>
          controller: _passwordController,<font></font>
          obscureText: <span class="hljs-keyword">true</span>,<font></font>
          decoration: InputDecoration(<font></font>
              labelText: <span class="hljs-string">'password'</span>),<font></font>
        ),<font></font>
        RaisedButton(<font></font>
            child: Text(<span class="hljs-string">'sign up'</span>),<font></font>
            onPressed: () {<font></font>
              Provider.of&lt;MainBloc&gt;(context, listen: <span class="hljs-keyword">false</span>).mapEventToState(<font></font>
                  Registration(_email, _password));<font></font>
            })<font></font>
      ],<font></font>
    );<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{<font></font>
    _emailController.dispose();<font></font>
    _passwordController.dispose();<font></font>
    <span class="hljs-keyword">super</span>.dispose();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_onEmailChanged</span><span class="hljs-params">()</span> </span>{<font></font>
    _email = _emailController.text;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_onPasswordChanged</span><span class="hljs-params">()</span> </span>{<font></font>
    _password = _passwordController.text;<font></font>
  }<font></font>
}<font></font>
 <font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PhoneBookScreen Window</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora hablemos un poco sobre nuestra ventana PhoneBookScreen. Esta es la ventana m√°s interesante: aqu√≠ la interfaz est√° construida sobre la base de 2 secuencias del bloque, y tambi√©n hay una lista con desplazamiento y paginaci√≥n (paginaci√≥n). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PhonebookScreen \ screen File</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhonebookTopPart</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">StatefulWidget <span class="hljs-title">caseWidget</span><span class="hljs-params">(PhonebookState state)</span> </span>{
    <span class="hljs-keyword">if</span> (state is PhonebookListOpened) {
      <span class="hljs-keyword">return</span> PhonebookList();
    <span class="hljs-comment">//} else if (data is PhonebookCardToViewOpened) {</span>
    }<span class="hljs-keyword">else</span> ModalProgressHUD(<font></font>
      inAsyncCall: <span class="hljs-keyword">true</span>,<font></font>
      child: Text(<span class="hljs-string">''</span>),);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">var</span> bloc = Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
    <span class="hljs-keyword">return</span> StreamProvider&lt;PhonebookState&gt;(<font></font>
        create: (context) =&gt; bloc.blocStream.stream,<font></font>
        initialData: bloc.state,<font></font>
        child: Selector&lt;PhonebookState,PhonebookState&gt;(<font></font>
            selector: (_,state)=&gt;state,<font></font>
            shouldRebuild: (previous, next){<span class="hljs-keyword">return</span> (previous.runtimeType!=next.runtimeType);},<font></font>
            builder: (_, state, __) { <span class="hljs-keyword">return</span> ModalProgressHUD(<font></font>
                inAsyncCall: state.busy,<font></font>
                child: Scaffold(<font></font>
                  appBar: AppBar(<font></font>
                    title: Text(<span class="hljs-string">"Phones list"</span>),<font></font>
                  ),<font></font>
                  drawer: MenuWidget(),<font></font>
                  body: caseWidget(state),<font></font>
                ));}<font></font>
        ));<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se necesita el primer StreamProvider para cambiar entre diferentes pantallas del directorio: lista, tarjeta de contacto, tarjeta de contacto para editar, etc. El widget para la pantalla se selecciona en la funci√≥n caseWidget (pero en este ejemplo solo se implementa la vista de la lista; puede intentar implementar la vista para la tarjeta de contacto; esto es muy simple y no ser√° un mal comienzo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta pantalla, ya se usa un mont√≥n de StreamProvider + Selector / Consumidor, porque hay un desplazamiento de la lista y no es aconsejable reconstruir toda la pantalla con ella (es decir, la reconstrucci√≥n de widgets proviene del Selector / Consumidor correspondiente y m√°s abajo en el √°rbol). </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y aqu√≠ est√° la implementaci√≥n de la lista en s√≠: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PhonebookScreen \ screen file</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_PhonebookListState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">PhonebookList</span>&gt; </span>{<font></font>
  ScrollController _scrollController = ScrollController();<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initState</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">super</span>.initState();<font></font>
    _scrollController.addListener(_scrollListener);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function">Widget <span class="hljs-title">build</span><span class="hljs-params">(BuildContext context)</span> </span>{
    <span class="hljs-keyword">var</span> bloc = Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>);
    <span class="hljs-keyword">var</span> list = bloc.repo.data.list;
    <span class="hljs-keyword">return</span> Container(<font></font>
        child: StreamProvider&lt;PhonebookState&gt;(<font></font>
            create: (context) =&gt; bloc.scrollStream.stream,<font></font>
            initialData: bloc.scrollState,<font></font>
            child: Consumer&lt;PhonebookState&gt;(<font></font>
              builder: (_, state, __) {<font></font>
                <span class="hljs-keyword">return</span> ListView.builder(<font></font>
                    controller: _scrollController,<font></font>
                    itemCount: list.length,<font></font>
                    itemBuilder: (BuildContext context, <span class="hljs-keyword">int</span> index) {
                      <span class="hljs-keyword">return</span> ListTile(<font></font>
                        title: Text(list[index].data[<span class="hljs-string">'name'</span>]),<font></font>
                        subtitle: Text(list[index].data[<span class="hljs-string">'phone'</span>]),<font></font>
                      );<font></font>
                    });<font></font>
              },<font></font>
            )));<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">_scrollListener</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">double</span> delta = MediaQuery<font></font>
        .of(context)<font></font>
        .size<font></font>
        .height * <span class="hljs-number">3</span>;
    <span class="hljs-keyword">double</span> maxScroll = _scrollController.position.maxScrollExtent;
    <span class="hljs-keyword">double</span> currentScroll = _scrollController.position.pixels;
    <span class="hljs-keyword">if</span> (maxScroll - currentScroll &lt;= delta) {<font></font>
      Provider.of&lt;PhonebookBloc&gt;(context, listen: <span class="hljs-keyword">false</span>)<font></font>
          .mapEventToState(ScrollPhonebook());<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@override</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{<font></font>
    _scrollController.removeListener(_scrollListener);<font></font>
    <span class="hljs-keyword">super</span>.dispose();<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ vemos el segundo StreamProvider, que monitorea el segundo flujo del bloque, que es responsable del desplazamiento. La paginaci√≥n se organiza de manera est√°ndar a trav√©s de _scrollListener (controlador: _scrollController). Aunque la ventana es interesante, pero dada la descripci√≥n detallada de la primera ventana, no hay nada m√°s que decir aqu√≠. Por lo tanto, eso es todo hoy.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El objetivo de este art√≠culo no era mostrar el c√≥digo perfecto, es decir, aqu√≠ puede encontrar muchos puntos para la optimizaci√≥n: "dividirse" correctamente en archivos, usar instancias, mixins y similares en alg√∫n lugar. </font><font style="vertical-align: inherit;">Adem√°s, qu√© "pide" el siguiente paso: puede hacer una tarjeta de contacto. </font><font style="vertical-align: inherit;">La tarea principal era estructurar el conocimiento, establecer un determinado vector para construir la aplicaci√≥n, dar explicaciones sobre algunos de los momentos de dise√±o de una aplicaci√≥n en Flutter que no eran muy obvios en las primeras etapas del conocimiento. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El proyecto se puede descargar en</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (para el registro puede usar cualquier correo con una contrase√±a de al menos 6 caracteres. Al volver a autorizar, la contrase√±a debe ser la misma que la utilizada durante el registro).</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es489496/index.html">B√∫squeda de empleados y b√∫squeda de empleo: mi visi√≥n desde adentro y desde afuera</a></li>
<li><a href="../es489500/index.html">Evaluaci√≥n de tareas en puntos de historia</a></li>
<li><a href="../es489502/index.html">Selenio + AutoIT. Windows Prueba Automatizaci√≥n Windows</a></li>
<li><a href="../es489504/index.html">C√≥mo comenzar a crear un mapa en UE4</a></li>
<li><a href="../es489510/index.html">Tratando de resolver el problema de elegir boletos antes de las vacaciones # 2</a></li>
<li><a href="../es489514/index.html">Descargue y almacene archivos de cualquier tama√±o en Google Drive de forma gratuita. ¬øError o caracter√≠stica?</a></li>
<li><a href="../es489516/index.html">Amigos reaccionan nativo y Fastlane</a></li>
<li><a href="../es489518/index.html">Intercambio de miembros El intercambio de bajo costo aparece en EE. UU.</a></li>
<li><a href="../es489526/index.html">Juegos de suma cero y condiciones de Karush-Kun-Takker</a></li>
<li><a href="../es489528/index.html">¬øNo ves anuncios durante el desarrollo? Trastorno</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>