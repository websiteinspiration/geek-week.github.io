<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🌾 👨🏻‍🌾 📧 AWSが回復力のあるサービスを醸造する方法。サーバーとデータベースのスケーリング 🛌🏻 🧒🏻 👃🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="雲は魔法の箱のようなものです。必要なものを尋ねると、リソースはどこからともなく現れます。仮想マシン、データベース、ネットワーク-これはすべてあなただけのものです。クラウドには他にもテナントがありますが、あなたの宇宙ではあなたが唯一の支配者です。あなたは常に必要なリソースを手に入れることができると確信...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWSが回復力のあるサービスを醸造する方法。サーバーとデータベースのスケーリング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/471686/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">雲は魔法の箱のようなものです。必要なものを尋ねると、リソースはどこからともなく現れます。仮想マシン、データベース、ネットワーク-これはすべてあなただけのものです。クラウドには他にもテナントがありますが、あなたの宇宙ではあなたが唯一の支配者です。あなたは常に必要なリソースを手に入れることができると確信しています、誰とも考えないで、独立してネットワークがどうなるかを決定します。クラウドがリソースを弾力的に割り当て、テナントを互いに完全に分離させるこの魔法はどうですか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/95/t7/1o/95t71ogmxhqysjnhwbqd_nbj4tk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AWSクラウドは、2006年以降進化を続けてきたメガ洗練されたシステムです。この開発の一部は</font><strong><font style="vertical-align: inherit;">Vasily Pantyukhin</font></strong><font style="vertical-align: inherit;">によって発見されました</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-アマゾンウェブサービスアーキテクト。</font><font style="vertical-align: inherit;">アーキテクトとして、彼は最終結果だけでなく、AWSが克服する課題の中からも見ています。</font><font style="vertical-align: inherit;">システムを理解すればするほど、自信が増します。</font><font style="vertical-align: inherit;">したがって、VasilyはAWSクラウドサービスの秘密を共有します。</font><font style="vertical-align: inherit;">AWS物理サーバー用のデバイス、データベースの柔軟なスケーラビリティ、カスタムAmazonデータベース、仮想マシンのパフォーマンスを向上させながら仮想マシンの価格を下げるための方法が削減されています。</font><font style="vertical-align: inherit;">Amazonのアーキテクチャアプローチを知ることは、AWSサービスをより有効に活用するのに役立ち、独自のソリューションを構築するための新しいアイデアを提供する場合があります。</font></font><br>
<a name="habracut"></a><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スピーカーについて：ヴァシリーパンチュキン（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編</font></font></a>)  Unix- .ru-, 6     Sun Microsystem, 11   -   EMC.      ,   2017   .          AWS.<br>
<br>
: ,   —    ,        Amazon Web Services. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> ,     ,    YouTube-.</i><br>
<br>
<h2>     Amazon</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の最初の車は手動ハンドル付きの「ハンドル」付きでした。マシンをコントロールできてフルコントロールできる感じが良かったです。その仕事の原理を少なくとも大まかに理解していることも好きでした。当然、私はボックスデバイスをかなり原始的に想像しました-自転車のギアボックスのようなものです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t-/zx/uz/t-zxuzgpa2gj26bmpgbe1gj_zd0.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
交通渋滞に立つことを除いて、すべてが素晴らしかった。座って何もしていないように見えますが、常にギアをシフトし、クラッチ、ガス、ブレーキを押します。本当に飽きます。家族のマシンに車が現れたとき、渋滞の問題は部分的に解決されました。ハンドルを握るとき、何かを考え、オーディオブックを聴く時間がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自分の車がどのように機能するかを理解するのをやめたので、私の人生に謎が現れました。現代の車は複雑なデバイスです。マシンは、ガス、ブレーキ、運転スタイル、路面の品質など、数十の異なるパラメーターに同時に適応します。これがどのように機能するのかもう理解できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私がAmazon Cloudを始めたとき、それも私には謎でした。車には1人のドライバーがいて、AWSには何百万人もいるので、この秘密だけが桁違いに高くなります。すべてのユーザーが同時に操縦し、ガスとブレーキを押します。彼らが彼らが望む場所に行くのは驚くべきことです-私にとってそれは奇跡です！システムは自動的に各ユーザーに適応し、スケーリングし、柔軟に調整するため、彼にはこの宇宙で一人でいるように見えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
後で私がアマゾンで建築家として働くようになったとき、魔法は少し消散しました。</font><font style="vertical-align: inherit;">私たちが直面している問題、その解決方法、サービスの開発方法を見てきました。</font><font style="vertical-align: inherit;">システムの理解が深まるにつれ、サービスに対する信頼が高まります。</font><font style="vertical-align: inherit;">それで、AWSクラウドの内部にあるものの写真を共有したいと思います。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何について話しましょうか</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は多様なアプローチを選択しました-私は話し合う価値がある4つの興味深いサービスを選択しました。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーの最適化</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。物理的な実施形態を持つ一時的なクラウド：物理的なデータセンター。物理的なサーバーがあり、ブザーを鳴らし、ウォーミングアップし、電球を点滅させています。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーレス関数</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Lambda）は、おそらくクラウドで最もスケーラブルなサービスです。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースのスケーリング</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。独自のスケーラブルなデータベースを構築する方法についてお話します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークのスケーリング</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ネットワークのデバイスを開く最後の部分。これは素晴らしいことです。クラウドの各ユーザーは、クラウド内に一人でいると信じており、他のテナントをまったく見ていません。</font></font><br>
<br>
<blockquote><i>.           .      .   -?      «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">,  .   Firecracker</a>».        ,     Firecracker —       .</i></blockquote><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
雲は短命です。</font><font style="vertical-align: inherit;">しかし、この短命にはまだ物理的な具体化があります-サーバーです。</font><font style="vertical-align: inherit;">当初、それらのアーキテクチャはクラシックでした。</font><font style="vertical-align: inherit;">仮想マシンを実行する標準のx86チップセット、ネットワークカード、Linux、Xenハイパーバイザー。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hb/vt/ez/hbvtezxs1wc_ilzrlcorvx9qy4m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2012年、このアーキテクチャはうまく機能しました。</font><font style="vertical-align: inherit;">Xenは優れたハイパーバイザーですが、大きな欠点が1つあります。</font><font style="vertical-align: inherit;">彼は</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスをエミュレートするために</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">かなり</font><strong><font style="vertical-align: inherit;">高いオーバーヘッド</font></strong><font style="vertical-align: inherit;">を持ってい</font><strong><font style="vertical-align: inherit;">ます</font></strong><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">新しい高速ネットワークカードまたはSSDの登場により、これらのオーバーヘッドは高すぎます。</font><font style="vertical-align: inherit;">この問題への対処方法は？</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハードウェアとハ​​イパーバイザーの両方</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><strong><font style="vertical-align: inherit;">最適化</font></strong><font style="vertical-align: inherit;">するために、2つの面に同時に取り組むことを決定しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">タスクは非常に深刻です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイアンとハイパーバイザーの最適化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一度にすべてをうまくやることはうまくいきません。</font><font style="vertical-align: inherit;">何が「良い」かは、最初は理解できませんでした。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは進化論的なアプローチを適用することを決定しました-私たちはアーキテクチャの1つの重要な要素を変更し、それを生産に投入します。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての熊手を踏んで、苦情や提案を聞きます。</font><font style="vertical-align: inherit;">次に、別のコンポーネントを変更します。</font><font style="vertical-align: inherit;">したがって、少しずつ、ユーザーのフィードバックとサポートに基づいてアーキテクチャ全体を根本的に変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変革は2013年に最も困難なこと、つまりネットワークから始まりました。</font><font style="vertical-align: inherit;">では</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C3の</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンス、特別なネットワークアクセラレータカードは、標準のネットワークカードに追加されました。</font><font style="vertical-align: inherit;">フロントパネルの文字通り短いループバックケーブルで接続されていました。</font><font style="vertical-align: inherit;">醜いですが、クラウドには表示されません。</font><font style="vertical-align: inherit;">しかし、ハードウェアとの直接の相互作用により、ジッターとネットワーク帯域幅が根本的に改善されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、EBSブロックストレージ-Elastic Block Storageへのアクセスを改善することに焦点を当てることにしました。これは、ネットワークとストレージの組み合わせです。問題は、ネットワークアクセラレータカードが市場に存在する場合、ストレージアクセラレータハードウェアを購入するだけの方法がなかったことです。そのため、</font><font style="vertical-align: inherit;">特別なASICチップを開発してくれ</font><font style="vertical-align: inherit;">た新興企業</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annapurna Labs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に問い合わせました。リモートEBSボリュームをNVMeデバイスとして接続できます。</font><strong><font style="vertical-align: inherit;">C4</font></strong></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インスタンスで</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">2つの問題を解決しました。最初に、彼らは有望であるが当時は新しいNVMeテクノロジーを使用して、将来の基盤を実装しました。 2つ目は、EBSへの要求の処理を新しいカードに転送することにより、中央プロセッサの負荷を大幅に軽減しました。それはうまくいったので、今、アンナプルナ研究所はアマゾンの一部です。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2017年11月までに、ハイパーバイザー自体を変更する時が来たと認識しました。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいハイパーバイザーは、変更されたKVMカーネルモジュールに基づいて開発されました。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これにより、デバイスをエミュレートするオーバーヘッドコストを根本的に削減し、新しいASICを直接操作できます。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C5</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンス</font><font style="vertical-align: inherit;">は、その内部で新しいハイパーバイザーが実行される最初の</font><font style="vertical-align: inherit;">仮想マシン</font><font style="vertical-align: inherit;">でした。</font><font style="vertical-align: inherit;">それを</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニトロ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼んだ</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g6/x2/ri/g6x2rizybxczhu-ikt1pfulnpb0.jpeg"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイムライン上のインスタンスの進化。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2017年11月以降に登場したすべての新しいタイプの仮想マシンは、このハイパーバイザーで動作します。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iron Bare Metalインスタンスにはハイパーバイザーはありませんが、</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">専用のNitroカードを使用するため、Nitroとも呼ばれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の2年間で、Nitroインスタンスのタイプの数は、A1、C5、M5、T3など、数十を超えました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vw/zf/as/vwzfasdjwxuuykoylco9bnmgqki.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスのタイプ。</font></font></em><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最新のNitroマシンの仕組み</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらには3つの主要コンポーネントがあります。Nitroハイパーバイザー（上記で説明）、セキュリティチップ、Nitroカードです。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セキュリティチップは</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マザーボードに直接統合されています。ホストOSのロードの制御など、多くの重要な機能を制御します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nitroカード-4</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">種類あります。すべてがAnnapurna Labsによって開発され、一般的なASICに基づいています。ファームウェアの一部も一般的です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fy/pf/pj/fypfpj1r-mpklkd-8ltiz-frjnc.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4種類のニトロカード。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
カードの1つは、</font><strong><font style="vertical-align: inherit;">VPC </font></strong></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークで</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動作するように設計されてい</font><strong><font style="vertical-align: inherit;">ます</font></strong><font style="vertical-align: inherit;">。</font><strong><font style="vertical-align: inherit;">仮想マシン</font></strong><font style="vertical-align: inherit;">で</font><strong><font style="vertical-align: inherit;">ENA</font></strong><font style="vertical-align: inherit;">ネットワークカードとして表示されるのはそれです</font><strong><font style="vertical-align: inherit;">-Elastic Network Adapter</font></strong></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。また、物理ネットワーク（これについては記事の後半で説明します）を介して送信されるトラフィックをカプセル化し、セキュリティグループのファイアウォールを制御し、ルーティングやその他のネットワークに関与します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
個別のカード</font><font style="vertical-align: inherit;">は、サーバーに組み込まれている</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EBS</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックストレージ</font><font style="vertical-align: inherit;">とディスクで動作します。これらは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVMeアダプター</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">としてゲスト仮想マシンに提示され</font><font style="vertical-align: inherit;">ます。また、データの暗号化とディスクの監視も担当します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nitroカードシステム、ハイパーバイザー、セキュリティチップは、SDNまたは</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Software Defined Networkに</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">統合されてい</font><strong><font style="vertical-align: inherit;">ます</font></strong><font style="vertical-align: inherit;">。コントロール</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カード</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、このネットワーク（コントロールプレーン）の管理を担当し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、私たちは新しいASICの開発を続けています。</font><font style="vertical-align: inherit;">たとえば、2018年の終わりに、機械学習タスクでより効率的な作業を可能にするInferentiaチップをリリースしました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i7/1w/7p/i71w7p7mu3pbl3ozaoczqmxirku.jpeg" width="500"></div><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インフェレンティア機械学習プロセッサチップ。</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケーラブルなデータベース</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
従来のデータベースは階層構造になっています。</font><font style="vertical-align: inherit;">大幅に簡略化すると、以下のレベルが区別されます。</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントとクエリのディスパッチャーが動作します。</font></font></li>
<li><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランザクションの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保護</font><font style="vertical-align: inherit;">-ここでは、ACIDなど、すべてが明確です。</font></font></li>
<li><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファプールによって提供される</font><strong><font style="vertical-align: inherit;">キャッシュ</font></strong><font style="vertical-align: inherit;">。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロギング-REDOログでの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作業を提供します。</font><font style="vertical-align: inherit;">MySQLではそれらはBin Logsと呼ばれ、PosgreSQLではそれらはWrite Ahead Logs（WAL）と呼ばれます。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストレージ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -直接ディスクに書き込みます。</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/5x/xv/ay/5xxvay0jy9xyewxzi1py1q9rhei.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層型データベース構造。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースをスケーリングするには、シャーディング、シェアードナッシングアーキテクチャ、共有ドライブなど、さまざまな方法があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ao/pq/sf/aopqsfjiytwkbunwwni-wia5mzu.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これらの方法はすべて同じモノリシックデータベース構造を保持します。</font><font style="vertical-align: inherit;">これにより、スケーリングが大幅に制限されます。</font><font style="vertical-align: inherit;">この問題を解決するために、独自のデータベース、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Aurora</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を開発しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQLおよびPostgreSQLと互換性があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アマゾンオーロラ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主なアーキテクチャのアイデアは、メインデータベースからストレージレベルとログレベルを分割することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今後は、キャッシュレベルも独立させると言います。アーキテクチャはモノリシックでなくなり、個々のブロックのスケーリングに自由度が追加されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/31/a1/4_/31a14_4d4o0pvrk_23aj-obbiew.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロギングおよびストレージレベルは、データベースとは別です。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
従来のDBMSは、ブロックの形式でストレージシステムにデータを書き込みます。 Amazon Auroraでは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REDOログの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">言語を話すことができる「スマート」リポジトリを作成しました</font><font style="vertical-align: inherit;">。内部では、リポジトリはログをデータブロックに変換し、その整合性を監視して自動的にバックアップします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチでは、</font><strong><font style="vertical-align: inherit;">クローニング</font></strong><font style="vertical-align: inherit;">などの興味深いものを実装できます</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。すべてのデータの完全なコピーを作成する必要がないため、基本的に高速で経済的に機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストレージレベルは分散システムとして実装されます。非常に多数の物理サーバーで構成されています。各REDOログは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6つのノードで</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同時に処理および保存され</font><font style="vertical-align: inherit;">ます。これにより、データ保護とロードバランシングが提供されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uv/up/rg/uvuprghc30bpo190-fjgb3w5pm8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読み取りスケーリングは、適切なレプリカを使用して実現できます。分散ストレージにより、データを書き込むメインDBインスタンスと他のレプリカとの間の同期の必要がなくなります。実際のデータは、すべてのレプリカで利用できることが保証されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
唯一の問題は、古いデータをリードレプリカにキャッシュすることです。しかし、この問題は解決されています</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのREDOログ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の内部ネットワーク上のレプリカへの転送。</font><font style="vertical-align: inherit;">ログがキャッシュにある場合は、無効としてマークされ、上書きされます。</font><font style="vertical-align: inherit;">キャッシュにない場合は、単に破棄されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8q/lt/hc/8qlthc7bqmxhqhja_ou4u3udjk4.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストレージを見つけました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMSレベルをスケーリングする方法</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、水平スケーリングははるかに困難です。</font><font style="vertical-align: inherit;">したがって、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">古典的な垂直スケーリングの手ごわい</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トラックに行きましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マスターノードを介してDBMSと通信するアプリケーションがあるとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
垂直スケーリングでは、より多くのプロセッサとメモリを持つ新しいノードを選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ai/mn/if/aimnifftppplcs1mfg3n-zldlrk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、アプリケーションを古いマスターノードから新しいマスターノードに切り替えます。</font><font style="vertical-align: inherit;">問題があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これには、アプリケーションの顕著なダウンタイムが必要です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいマスターノードにはコールドキャッシュがあります。</font><font style="vertical-align: inherit;">データベースのパフォーマンスは、キャッシュがウォームアップされた後にのみ最大になります。</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/k0/i-/jy/k0i-jy69brtsvclx0trwgjfuw0y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状況を改善するには？</font><font style="vertical-align: inherit;">アプリケーションとマスターノードの間にプロキシを配置します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ag/bk/c9/agbkc94ple_fti2xvyjinrb7mxu.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは私たちに何を与えるでしょうか？</font><font style="vertical-align: inherit;">これで、すべてのアプリケーションを手動で新しいノードにリダイレクトする必要がなくなりました。</font><font style="vertical-align: inherit;">切り替えはプロキシの下で行うことができ、同時に基本的に高速です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は解決したようです。</font><font style="vertical-align: inherit;">しかし、いいえ、まだキャッシュをウォームアップする必要に悩まされています。</font><font style="vertical-align: inherit;">さらに、新しい問題が発生しました-現在、プロキシは潜在的な障害点です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Auroraサーバーレスの最終ソリューション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの問題をどのように解決しましたか？</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロキシを残しました</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは個別のインスタンスではなく、アプリケーションがデータベースに接続するために使用する、分散されたプロキシの全体です。障害が発生した場合、どのノードもほぼ瞬時に交換できます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまなサイズのウォームノードのプールを追加しました</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。したがって、大きいサイズまたは小さいサイズの新しいノードを割り当てる必要がある場合は、すぐに使用できます。読み込まれるまで待つ必要はありません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケーリングプロセス全体は、特別な監視システムによって制御されます。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監視は、現在のマスターノードのステータスを常に監視します。たとえば、プロセッサの負荷が臨界値に達したことを検出すると、ウォームインスタンスのプールに新しいノードを割り当てる必要があることを通知します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2r/ja/oq/2rjaoqe-tgjjv_nxbodwlibzkzc.jpeg"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分散プロキシ、ウォームインスタンス、モニタリング。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
必要な電力のノードが利用可能です。バッファー・プールがそこにコピーされ、システムは切り替えの安全な瞬間を待ち始めます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/t4/nr/hwt4nruv3h9bdyyte_awfycnp1g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、切り替えの瞬間は十分に速くなります。次に、プロキシと古いマスターノード間の通信が中断され、すべてのセッションが新しいノードに切り替わります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pz/4f/cj/pz4fcjzipu0pep5pwwex6mb5kas.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースの操作を再開します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sv/dl/kf/svdlkfp7ve6gzlomvdxulhmyjsy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフは、サスペンションが本当に非常に短いことを示しています。青いグラフ、負荷、そして赤いステップ-スケーリングの瞬間。青いグラフの短期的な落ち込みは、まさにその短い遅延です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/te/3p/4x/te3p4xzclr_3liuv-7gk2ocskey.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、Amazon Auroraでは、週末など、データベースが使用されていないときに、データベースを完全に保存してオフにすることができます。ロードを停止した後、データベースの電力が徐々に低下し、しばらくの間オフになります。負荷が戻ると、再びスムーズに上昇します。</font></font><br>
<br>
<blockquote>      Amazon    .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>    ,    .<br>
<br>
 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">HighLoad++</a>      «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">,   .    ,      Amazon</a>».        Amazon,     ,   Cell-based architecture, Constant Work, Shuffle Sharding —&nbsp; .     — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>. 24    .</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja471668/index.html">checkm8エクスプロイトのテクニカル分析</a></li>
<li><a href="../ja471670/index.html">Jetpack Composeを戦闘で試してみませんか？</a></li>
<li><a href="../ja471676/index.html">Телефонные мошенники. Действие второе, в котором я срываюсь и бегу до ближайшего банкомата</a></li>
<li><a href="../ja471678/index.html">オンデマンドでサービスを提供</a></li>
<li><a href="../ja471684/index.html">nginxのモジュールを作成する必要がある理由</a></li>
<li><a href="../ja471688/index.html">AWSが回復力のあるサービスを醸造する方法。ネットワークスケーリング</a></li>
<li><a href="../ja471700/index.html">将来の基盤を備えた技術スタックをどのように選択したか</a></li>
<li><a href="../ja471702/index.html">サイバー拡張Webアプリケーション</a></li>
<li><a href="../ja471704/index.html">本「セルフィ​​ッシュミトコンドリア。健康を維持して老後を動かす方法」</a></li>
<li><a href="../ja471706/index.html">NetFlow分析を使用して検出できる9つの典型的なネットワーク問題（例としてFlowmonを使用）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>