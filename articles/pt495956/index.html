<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüé§ üï∫üèæ üë©üèæ‚Äçü§ù‚Äçüë©üèΩ Tenho que ir r√°pido. Otimizando solicita√ß√µes de conte√∫do de email IMAP üë©üèº‚Äçüé® üë©‚Äç‚ù§Ô∏è‚Äçüë® üë©‚Äçüë©‚Äçüëß‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° a todos! Em um artigo anterior, falei sobre como voc√™ pode sincronizar rapidamente o conte√∫do de uma caixa no cache local. Aqui, quero falar sobre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tenho que ir r√°pido. Otimizando solicita√ß√µes de conte√∫do de email IMAP</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495956/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√° a todos! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em um artigo anterior,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> falei sobre como voc√™ pode sincronizar rapidamente o conte√∫do de uma caixa no cache local. </font><font style="vertical-align: inherit;">Aqui, quero falar sobre os recursos de solicitar o conte√∫do das cartas e a melhor forma de solicitar o conte√∫do, sem receio pelo alto consumo de tr√°fego.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kk/4w/8a/kk4w8ac2scl3dawogln5zyvg7fg.jpeg" alt="imagem"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos lembrar rapidamente o que aprendemos no √∫ltimo artigo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMAP √© um protocolo stateful</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para ver o conte√∫do da caixa de entrada, voc√™ deve primeiro selecion√°-lo com o comando SELECT</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para sincronizar rapidamente a caixa em que estamos, voc√™ pode usar o comando NOOP</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para n√£o classificar as mensagens do armazenamento local para atualizar a caixa de correio que j√° deixamos, voc√™ pode usar CONDSTORE e QRESYNC, desde que o servidor suporte os dados de extens√£o de protocolo</font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O suficiente!</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me lembr√°-lo do comando para solicitar o corpo da carta:</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH number (BODY[])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso criar√° uma solicita√ß√£o para obter todo o corpo da carta e todos os anexos. </font><font style="vertical-align: inherit;">Basta ver quanto tempo leva para receber uma mensagem no par√°grafo 42 de Lorem Ipsum e com uma imagem de 2 megabytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, pergunte o tamanho da mensagem no servidor. </font><font style="vertical-align: inherit;">Isso √© feito pelo comando:</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH 18871 (RFC822.SIZE)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RFC822.SIZE retorna o tamanho da mensagem em bytes:</font></font><br>
<br>
<pre><code class="bash hljs">* 18871 FETCH (RFC822.SIZE 3937793)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, como resultado, nossa mensagem ocupa quase 4 megabytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, no entanto, usaremos a solicita√ß√£o para todo o corpo da carta e daremos uma olhada no momento:</font></font><br>
<br>
<pre><code class="bash hljs">1 OK Fetch completed (0.007 + 3.265 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3,3 segundos! </font><font style="vertical-align: inherit;">E esta √© apenas uma mensagem com o anexo, e imagine que essa ser√° a caixa inteira. </font><font style="vertical-align: inherit;">Depois, levar√° mais de um minuto para baixar pelo menos os vinte e um. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ deve admitir que os neg√≥cios de um cliente que em 2020 n√£o pode sincronizar emails mais rapidamente do que em um minuto s√£o ruins. </font><font style="vertical-align: inherit;">Mas o que fazer?</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Me d√™ uma mordida uma vez</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usar o RFC3501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na cl√°usula </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que descreve os poss√≠veis par√¢metros para o comando FETCH, notar√° uma solicita√ß√£o interessante:</font></font><br>
<br>
<pre><code class="bash hljs">BODY[&lt;section&gt;]&lt;&lt;partial&gt;&gt;
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se√ß√£o - qual parte da carta obter</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parcial - o tamanho desta parte</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como √© constru√≠do parcialmente? </font><font style="vertical-align: inherit;">E √© muito f√°cil. </font><font style="vertical-align: inherit;">Primeiro, o byte a partir do qual voc√™ precisa iniciar a leitura √© escrito atrav√©s do ponto e, em seguida, quantos bytes em geral devem ser lidos:</font></font><br>
<br>
<pre><code class="bash hljs">BODY[&lt;section&gt;]&lt;&lt;0.1024&gt;&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui solicitamos a parte da carta de zero byte a 1024. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, o que √© a se√ß√£o? </font><font style="vertical-align: inherit;">Primeiro, falarei sobre um par√¢metro t√£o √∫til em uma consulta FETCH como BODYSTRUCTURE:</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH 18871 (BODYSTRUCTURE)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este par√¢metro, como voc√™ provavelmente entendeu a partir da assinatura, retorna a estrutura da carta no formato descrito em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIME-IMB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="bash hljs">* 18871 FETCH (BODYSTRUCTURE (((<span class="hljs-string">"text"</span> <span class="hljs-string">"plain"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 25604 337 NIL NIL NIL NIL)(<span class="hljs-string">"text"</span> <span class="hljs-string">"html"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 29593 390 NIL NIL NIL NIL) <span class="hljs-string">"alternative"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_763_774309787.1586268692"</span>) NIL NIL NIL)(<span class="hljs-string">"image"</span> <span class="hljs-string">"jpeg"</span> (<span class="hljs-string">"name"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>) NIL NIL <span class="hljs-string">"base64"</span> 3880726 NIL (<span class="hljs-string">"attachment"</span> (<span class="hljs-string">"filename"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>)) NIL NIL) <span class="hljs-string">"mixed"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_210_297656922.1586268692"</span>) NIL NIL NIL))
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basta dar uma olhada nessa estrutura e sua cabe√ßa est√° girando? </font><font style="vertical-align: inherit;">N√£o tenha medo, agora vamos descobrir. </font><font style="vertical-align: inherit;">Compare os colchetes de abertura e fechamento.</font></font><br>
<br>
<pre><code class="bash hljs">(<font></font>
BODYSTRUCTURE&nbsp;<font></font>
(<font></font>
[1] (<font></font>
[1.1] (<span class="hljs-string">"text"</span> <span class="hljs-string">"plain"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 25604 337 NIL NIL NIL NIL)<font></font>
[1.2] (<span class="hljs-string">"text"</span> <span class="hljs-string">"html"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 29593 390 NIL NIL NIL NIL) <span class="hljs-string">"alternative"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_763_774309787.1586268692"</span>) NIL NIL NIL<font></font>
)<font></font>
[2] (<span class="hljs-string">"image"</span> <span class="hljs-string">"jpeg"</span> (<span class="hljs-string">"name"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>) NIL NIL <span class="hljs-string">"base64"</span> 3880726 NIL (<span class="hljs-string">"attachment"</span> (<span class="hljs-string">"filename"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>)) NIL NIL) <span class="hljs-string">"mixed"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_210_297656922.1586268692"</span>) NIL NIL NIL<font></font>
)<font></font>
)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode notar que eu coloquei n√∫meros perto de alguns colchetes. </font><font style="vertical-align: inherit;">Esta √© a se√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como calcul√°-los? </font><font style="vertical-align: inherit;">O primeiro colchete deve ser ignorado, porque simplesmente cont√©m a resposta √† solicita√ß√£o e, em seguida, cada colchete de abertura deve ser numerado de acordo com a regra, √† medida que os t√≠tulos nos documentos s√£o numerados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s numeramos cada colchete de abertura levando em considera√ß√£o a se√ß√£o anterior</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a se√ß√£o estiver aninhada, a atual atrav√©s do ponto ser√° adicionada ao n√∫mero anterior</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a se√ß√£o n√£o estiver aninhada, aumente seu n√∫mero em um</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, neste caso, na primeira parte que termina com "alternativa" (ou seja, √© a parte da carta multipart / alternativa, onde podemos escolher qual das partes exibir para o usu√°rio), h√° duas se√ß√µes numeradas por um ponto. </font><font style="vertical-align: inherit;">Eu conheci um servidor onde pode haver aninhamento em tr√™s n√≠veis (ou seja, [1.1.1], [1.1.2], etc). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos analisar a parte [1.1] da estrutura de todas essas coisas no documento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIME-IMB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A julgar por isso, o cabe√ßalho Content-Type √© o primeiro. </font><font style="vertical-align: inherit;">Inclui:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipo MIME, aqui est√° texto / sem formata√ß√£o</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codifica√ß√£o (charset = utf8)</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir est√£o dois par√¢metros que s√£o gravados como NIL. </font><font style="vertical-align: inherit;">Francamente, eu n√£o entendi o que era, mas at√© agora n√£o precisei, ent√£o sentirei falta. </font><font style="vertical-align: inherit;">Pe√ßo desculpas por essa frivolidade.Em </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
seguida, est√° o cabe√ßalho Content-Transfer-Encoding, que est√° inclu√≠do nele, que descreve o mecanismo de codifica√ß√£o, aqui est√° imprim√≠vel entre aspas.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dois n√∫meros a seguir descrevem o tamanho da pe√ßa em bytes e o n√∫mero de linhas, se poss√≠vel. </font><font style="vertical-align: inherit;">Com a ajuda deles, podemos calcular quantos bytes ser√£o necess√°rios para exibir um determinado n√∫mero de linhas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As seguintes linhas que n√£o est√£o nesta parte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID do conte√∫do, usado na linha da carta</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descri√ß√£o do Conte√∫do, uma linha que descreve o que √© esta parte</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para os outros dois par√¢metros, n√£o consegui encontrar uma resposta definitiva, mas um desses par√¢metros pode conter partes MD5, que √†s vezes podem ser √∫teis. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para a parte [2], tudo √© o mesmo, exceto que √© uma imagem, um anexo com um nome e a codifica√ß√£o base64. Se ainda n√£o est√° completamente claro o que est√° acontecendo aqui, ent√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neste site est√°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> perfeitamente definido exatamente como calcular a se√ß√£o. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que isso d√°? E o fato de que, na fase de exibi√ß√£o da carta, j√° podemos solicitar apenas a parte superior do conte√∫do e n√£o carregar os anexos at√© que o pr√≥prio usu√°rio insira a mensagem e clique no bot√£o "baixar". Todas as informa√ß√µes para a exibi√ß√£o de anexos s√£o fornecidas na BODYSCTRUCTURE, para que o nome, o formato e o tamanho possam ser exibidos sem carregar o pr√≥prio anexo.&nbsp;</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos seguir praticando. </font><font style="vertical-align: inherit;">Pediremos um kilobyte de conte√∫do da mensagem sem anexos, apenas para saber o que eles nos enviaram.</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (body[1.1]&lt;0.1024&gt;)<font></font>
* 18871 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consecte=<font></font>
tur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. Praesent et enim te=<font></font>
llus. Nunc vestibulum diam tortor, id posuere turpis tempor luctus. Vivam=<font></font>
us molestie non nunc nec placerat. Cras finibus ut erat et tristique. Cur=<font></font>
abitur vitae commodo risus. Etiam sed scelerisque erat. Quisque cursus bl=<font></font>
andit finibus. Nullam ac lectus accumsan, molestie quam non, mollis urna.=<font></font>
&nbsp;Nulla at arcu <span class="hljs-keyword">in</span> libero condimentum mollis ut non velit. Vestibulum sed =<font></font>
risus et magna congue iaculis. Vestibulum nec interdum elit, ut commodo m=<font></font>
auris. Nulla ipsum leo, vestibulum nec ligula non, elementum ullamcorper =<font></font>
risus. Nunc et malesuada sem, id venenatis massa. Integer dolor ante, max=<font></font>
imus <span class="hljs-keyword">in</span> eleifend nec, ultricies ut risus. Mauris posuere eget tortor at p=<font></font>
orttitor.=0AIn porta elementum ornare. Suspendisse aliquam, tortor sed al=<font></font>
iquam bibendum, nulla ante rhoncus elit, placerat accumsan augue nibh non=<font></font>
&nbsp;est. Duis finibus vel tortor finibu)<font></font>
1 OK Fetch completed (0.073 + 0.000 + 0.072 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cerca de 100 milissegundos e j√° vemos parte do conte√∫do da carta! </font><font style="vertical-align: inherit;">Esse √© apenas um excelente resultado, j√° que anteriormente demor√°vamos quase 4 segundos para baixar o conte√∫do de uma letra. </font><font style="vertical-align: inherit;">Em seguida, voc√™ pode simplesmente carregar todo o conte√∫do da carta no fluxo em segundo plano; do lado de fora, parecer√° que as cartas ser√£o carregadas instantaneamente. </font><font style="vertical-align: inherit;">Tudo o que era necess√°rio era examinar a estrutura da carta e baixar apenas o necess√°rio para uma exibi√ß√£o r√°pida.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apenas um momento. </font><font style="vertical-align: inherit;">Esta solicita√ß√£o far√° com que a mensagem no servidor apare√ßa como lida. </font><font style="vertical-align: inherit;">Mas voc√™ pode corrigir isso adicionando apenas PEEK √† solicita√ß√£o do corpo</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (BODY.PEEK[1.1]&lt;0.1024&gt;)<font></font>
* 18871 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consecte=<font></font>
tur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. Praesent et enim te=<font></font>
llus. Nunc vestibulum diam tortor, id posuere turpis tempor luctus. Vivam=<font></font>
us molestie non nunc nec placerat. Cras finibus ut erat et tristique. Cur=<font></font>
abitur vitae commodo risus. Etiam sed scelerisque erat. Quisque cursus bl=<font></font>
andit finibus. Nullam ac lectus accumsan, molestie quam non, mollis urna.=<font></font>
&nbsp;Nulla at arcu <span class="hljs-keyword">in</span> libero condimentum mollis ut non velit. Vestibulum sed =<font></font>
risus et magna congue iaculis. Vestibulum nec interdum elit, ut commodo m=<font></font>
auris. Nulla ipsum leo, vestibulum nec ligula non, elementum ullamcorper =<font></font>
risus. Nunc et malesuada sem, id venenatis massa. Integer dolor ante, max=<font></font>
imus <span class="hljs-keyword">in</span> eleifend nec, ultricies ut risus. Mauris posuere eget tortor at p=<font></font>
orttitor.=0AIn porta elementum ornare. Suspendisse aliquam, tortor sed al=<font></font>
iquam bibendum, nulla ante rhoncus elit, placerat accumsan augue nibh non=<font></font>
&nbsp;est. Duis finibus vel tortor finibu)<font></font>
1 OK Fetch completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E pronto! </font><font style="vertical-align: inherit;">A carta permanece n√£o lida e parte do conte√∫do que recebemos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo se torna ainda mais f√°cil se o recurso de solicita√ß√£o </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">PREVIEW</font></a><font style="vertical-align: inherit;"> for implementado no seu servidor.&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (PREVIEW)<font></font>
* 18871 FETCH (PREVIEW (FUZZY <span class="hljs-string">"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consectetur enim in nisi venenatis, id varius tellus viverra. Praesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis t"</span>))<font></font>
1 OK Fetch completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, n√£o perdemos tempo consultando a estrutura e obtemos a visualiza√ß√£o da mensagem instantaneamente. </font><font style="vertical-align: inherit;">Mas n√£o esque√ßa que a estrutura da consulta √© √∫til para definir anexos para que eles n√£o sejam carregados no modo inativo.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esperar</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quase todo cliente de email implementa o bot√£o "atualizar" se o usu√°rio deseja receber novas cartas agora. </font><font style="vertical-align: inherit;">Mas, de alguma forma, isso n√£o √© legal para o nosso tempo, onde h√° notifica√ß√µes nos dispositivos e nos navegadores. </font><font style="vertical-align: inherit;">O que o IMAP diz sobre isso? </font><font style="vertical-align: inherit;">E ele diz </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ocioso</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta opera√ß√£o mant√©m a conex√£o com a pasta e notifica voc√™ sobre altera√ß√µes na pasta. </font><font style="vertical-align: inherit;">Observe, n√£o a caixa de correio, mas as pastas. </font><font style="vertical-align: inherit;">Para fazer isso, voc√™ precisa do servidor para implementar o recurso IDLE.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, selecione a pasta para a qual o servidor enviar√° alertas e ative o IDLE</font></font><br>
<br>
<pre><code class="bash hljs">1 SELECT Inbox<font></font>
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span>)<font></font>
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span> \*)] Flags permitted.<font></font>
* 18872 EXISTS<font></font>
* 0 RECENT<font></font>
* OK [UNSEEN 18685] First unseen.<font></font>
* OK [UIDVALIDITY 1532079879] UIDs valid<font></font>
* OK [UIDNEXT 20155] Predicted next UID<font></font>
* OK [HIGHESTMODSEQ 26338] Highest<font></font>
1 OK [READ-WRITE] Select completed (0.002 + 0.000 + 0.001 secs).<font></font>
1 IDLE<font></font>
+ idling</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A resposta "+ ocioso" notifica sobre a inclus√£o do ocioso na pasta. </font><font style="vertical-align: inherit;">O que acontece se uma nova carta chegar?</font></font><br>
<br>
<pre><code class="bash hljs">* 18873 EXISTS<font></font>
* 1 RECENT</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enviei-me a mesma carta e Idle me notificou que deveria solicitar a carta 18873, que havia 18873 cartas na pasta e que uma carta acabara de chegar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, solicitarei esta carta em outra conex√£o, estamos interessados ‚Äã‚Äãna carta com a resposta EXISTA.</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18873 (BODY.PEEK[1.1]&lt;0.1024&gt;)<font></font>
* 18873 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
---- Original Message ---- Tue, Apr 7, 2020, 17:11=0ASubject=<font></font>
: Lorem Ipsum=0A&nbsp; Lorem ipsum dolor sit amet, consectetur adipiscing elit=<font></font>
. Vivamus consectetur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. P=<font></font>
raesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis te=<font></font>
mpor luctus. Vivamus molestie non nunc nec placerat. Cras finibus ut erat=<font></font>
‚Ä¶</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â muito importante entender. </font><font style="vertical-align: inherit;">O IDLE requer uma conex√£o separada, para que voc√™ n√£o possa receber altera√ß√µes e solicitar mensagens na mesma sess√£o.O </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
que mais o IDLE pode fazer? </font><font style="vertical-align: inherit;">Ele sabe como notificar sobre letras exclu√≠das e cartas cujas bandeiras foram alteradas. </font><font style="vertical-align: inherit;">Vamos dar uma olhada na carta com o objetivo de colocar a bandeira "/ visto" nela e excluir a carta.</font></font><br>
<br>
<pre><code class="bash hljs">* 18873 FETCH (FLAGS (\Seen \Recent))<font></font>
* OK Still here<font></font>
* OK Still here<font></font>
* 18873 EXPUNGE<font></font>
* 18871 EXPUNGE<font></font>
* 0 RECENT</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu apaguei a conversa (18873, 18871) e olhei para outra carta (resposta FETCH). </font><font style="vertical-align: inherit;">Por que essa carta se tornou 18871? </font><font style="vertical-align: inherit;">Porque o IMAP reconta o n√∫mero da letra se algo mudou. </font><font style="vertical-align: inherit;">Desde que se tornou o primeiro, seu n√∫mero tamb√©m mudou.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com o IDLE, podemos sincronizar rapidamente o estado da caixa, mas √© desagrad√°vel que exija uma conex√£o separada. </font><font style="vertical-align: inherit;">Poderia ser melhor? </font><font style="vertical-align: inherit;">√â por isso que estou aqui.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gritar como vai</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se eu disser a voc√™ que existe um recurso que permite que voc√™ receba notifica√ß√µes do servidor na mesma conex√£o, e at√© especialmente configurado para caixas de correio e mais de uma. </font><font style="vertical-align: inherit;">Parece um conto de fadas, mas n√£o enlouque√ßa, essa √© uma real capacidade </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOTIFICAR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele sabe muito, por exemplo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar pastas espec√≠ficas a partir das quais esperamos notifica√ß√µes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvir as altera√ß√µes de status da pasta (ler cartas, novas letras)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defina o formato da notifica√ß√£o, ou seja, o que queremos ver ao alterar a pasta</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvir altera√ß√µes no nome da pasta</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvir altera√ß√µes de metadados da pasta</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos um exemplo de como podemos ouvir as altera√ß√µes no status da pasta</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (inboxes (MessageNew FlagChange MessageExpunge))<font></font>
1 OK NOTIFY completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, o servidor nos enviar√° notifica√ß√µes com status de pasta, por exemplo, adicionarei algumas mensagens a pastas diferentes</font></font><br>
<br>
<pre><code class="bash hljs">* STATUS INBOX/Ozon (MESSAGES 312 UIDNEXT 321 UNSEEN 48)<font></font>
* STATUS <span class="hljs-string">"INBOX/Company News"</span> (MESSAGES 178 UIDNEXT 179 UNSEEN 1)<font></font>
* STATUS <span class="hljs-string">"INBOX/Company News"</span> (MESSAGES 177 UIDNEXT 179 UNSEEN 0)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisarei o comando: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro vem o comando NOTIFY SET. </font><font style="vertical-align: inherit;">Ent√£o, entre par√™nteses, selecionamos quais pastas vamos ouvir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caixas de entrada - para todas as pastas que voc√™ pode selecionar</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pessoal - pastas que est√£o no espa√ßo de nome do usu√°rio</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inscrito - pastas nas quais o usu√°rio est√° inscrito</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sub√°rvore - sub√°rvore da pasta a ser especificada</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caixas de correio - aqui voc√™ pode listar as pastas para ouvir.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecionado - alerta apenas para pastas selecionadas</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E os par√¢metros que s√£o respons√°veis ‚Äã‚Äãpelo filtro de alerta:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MessageNew - se uma nova mensagem chegar</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FlagChange - se o sinalizador foi alterado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MessageExpunge - se a mensagem foi exclu√≠da ou movida</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas com esse comando, n√£o podemos receber os par√¢metros de uma mensagem nova, alterada ou exclu√≠da. </font><font style="vertical-align: inherit;">Para fazer isso, selecione o par√¢metro Selected e especifique o que exatamente retornar. </font><font style="vertical-align: inherit;">Podemos adicionar outro alerta sem excluir o anterior.</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> status (selected (MessageNew (uid preview) MessageExpunge))
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui em MessageNew, especificamos os par√¢metros que a notifica√ß√£o deve retornar. </font><font style="vertical-align: inherit;">Escolherei a Caixa de entrada e novamente jogarei para mim lorem ipsum.</font></font><br>
<br>
<pre><code class="bash hljs">* 18868 FETCH (UID 20157 PREVIEW (FUZZY <span class="hljs-string">"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consectetur enim in nisi venenatis, id varius tellus viverra. Praesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis t"</span>))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como √© que voc√™ gosta? </font><font style="vertical-align: inherit;">Para o ocioso, precisamos manter duas conex√µes, uma das quais tamb√©m solicita mensagens que o ocioso retornou para n√≥s. </font><font style="vertical-align: inherit;">Imediatamente eles nos trazem tudo em uma bandeja de prata.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E assim podemos ouvir as altera√ß√µes no nome da pasta</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (inboxes (MailboxName))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Renomeie alguma pasta e veja o resultado.</font></font><br>
<br>
<pre><code class="bash hljs">* LIST () <span class="hljs-string">"/"</span> 1111 (<span class="hljs-string">"OLDNAME"</span> (aaaa))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora sabemos que havia uma pasta "aaaa" e se tornou "1111". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ pode ouvir a altera√ß√£o de sinalizadores e a remo√ß√£o de mensagens. </font><font style="vertical-align: inherit;">Para fazer isso, use o par√¢metro FlagChange</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (selected (MessageNew (uid) FlagChange MessageExpunge))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E quando voc√™ altera os sinalizadores de mensagens e exclui, obtemos</font></font><br>
<br>
<pre><code class="bash hljs">* 18865 EXPUNGE<font></font>
* 18864 FETCH (FLAGS ())<font></font>
* 18864 FETCH (FLAGS (\Answered))</code></pre><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© o pr√≥ximo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos esses recursos ajudam o cliente de email a trabalhar o mais r√°pido e conveniente poss√≠vel para o usu√°rio. </font><font style="vertical-align: inherit;">IDLE e NOTIFY notificam o usu√°rio sobre altera√ß√µes nas pastas, solicitando que parte da carta acelere o carregamento.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No artigo final, gostaria de falar sobre o mecanismo de pesquisa no IMAP e como ele pode ser acelerado e reduzir a carga na rede. </font><font style="vertical-align: inherit;">Obrigado por ler at√© o fim.&nbsp;</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt495942/index.html">Economize tempo, nervos e horas de trabalho</a></li>
<li><a href="../pt495944/index.html">TOP50 atualizado (classifica√ß√£o dos supercomputadores da CEI): din√¢mica e tend√™ncias</a></li>
<li><a href="../pt495946/index.html">Norbert Wiener: o pai distra√≠do da cibern√©tica</a></li>
<li><a href="../pt495948/index.html">Ferrugem incorporada. Desenvolvimento para processadores Cortex-M3 usando a placa de depura√ß√£o STM32F103C8T6 (Black Pill)</a></li>
<li><a href="../pt495954/index.html">Como a Cisco opera em modo de acesso remoto e em um per√≠metro ausente h√° 20 anos?</a></li>
<li><a href="../pt495960/index.html">Apenas AH-ny Wi-Fi. Ou como constru√≠mos uma rede Wi-Fi 6 (AX) em uma institui√ß√£o educacional</a></li>
<li><a href="../pt495962/index.html">Udalenka: como no X5 eles planejavam mudar para um formato remoto de trabalho</a></li>
<li><a href="../pt495966/index.html">C√≥digo absurdo ou "como n√£o escrever"</a></li>
<li><a href="../pt495970/index.html">Ferramentas para o trabalho em equipe remoto: do controle do tempo ao financiamento</a></li>
<li><a href="../pt495974/index.html">Observa√ß√µes fotogr√°ficas de meteoros, Perseids 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>