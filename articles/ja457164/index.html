<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍⚖️ 🆒 🛳️ ReactiveUIとAvaloniaの例を使用してディスクに状態を保存するクロスプラットフォームの.NET Coreアプリケーションでのナビゲーション 🕴🏽 🍄 🤚🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最新のアプリケーションのユーザーインターフェイスは通常複雑です。多くの場合、ページナビゲーションサポートの実装、さまざまな入力フィールドの処理、ユーザーが選択したパラメーターに基づく情報の表示または非表示が必要です。同時に、UXを改善するために、アプリケーションは、一時停止またはシャットダウン中にイ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ReactiveUIとAvaloniaの例を使用してディスクに状態を保存するクロスプラットフォームの.NET Coreアプリケーションでのナビゲーション</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457164/"><p><img src="https://habrastorage.org/webt/tu/lv/gl/tulvgli1xkcq1jqef9m91o_caxe.png"><br>
</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最新のアプリケーションのユーザーインターフェイスは通常複雑です。多くの場合、ページナビゲーションサポートの実装、さまざまな入力フィールドの処理、ユーザーが選択したパラメーターに基づく情報の表示または非表示が必要です。同時に、UXを改善するために、アプリケーションは、一時停止またはシャットダウン中にインターフェイス要素の状態をディスクに保存し、プログラムの再起動時にディスクから状態を復元する必要があります。</font></font></p><br>
<p><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReactiveUI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MVVMフレームワーク</font><font style="vertical-align: inherit;">は、プログラムが中断された瞬間にプレゼンテーションモデルのグラフをシリアル化することでアプリケーションの状態を保存することを提案しますが、中断の瞬間を決定するメカニズムはフレームワークとプラットフォームで異なります。したがって、イベントはWPF </font></font><code>Exit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Xamarin.Android- </font></font><code>ActivityPaused</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Xamarin.iOS- </font></font><code>DidEnterBackground</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、UWP-overloadで使用され</font></font><code>OnLaunched</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></p><br>
<p>     ReactiveUI        GUI,   ,    GUI  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Avalonia</a>.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  MVVM</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>    C#   .NET  .  ,   ,    Windows 10  Ubuntu 18.</p><a name="habracut"></a><br>
<h2 id="sozdanie-proekta"> </h2><br>
<p>    ,    .NET Core   Avalonia,   <code>Avalonia.ReactiveUI</code> —    Avalonia  ReactiveUI. ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">.NET Core SDK</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">git</a>.</p><br>
<pre><code class="plaintext hljs">git clone https://github.com/AvaloniaUI/avalonia-dotnet-templates<font></font>
git --git-dir ./avalonia-dotnet-templates/.git checkout 9263c6b<font></font>
dotnet new --install ./avalonia-dotnet-templates <font></font>
dotnet new avalonia.app -o ReactiveUI.Samples.Suspension <font></font>
cd ./ReactiveUI.Samples.Suspension<font></font>
dotnet add package Avalonia.ReactiveUI<font></font>
dotnet add package Avalonia.Desktop<font></font>
dotnet add package Avalonia</code></pre><br>
<p>,         Welcome to Avalonia!</p><br>
<pre><code class="plaintext hljs"># Use .NET Core version which you have installed.<font></font>
# It can be netcoreapp2.0, netcoreapp2.1 and so on.<font></font>
dotnet run --framework netcoreapp3.0</code></pre><br>
<p><img src="https://habrastorage.org/webt/bn/84/7b/bn847bgygv5j5awbdb_0pvipoyq.png" width="400"><br>
</p><br>
<h2 id="podklyuchenie-predvaritelnyh-sborok-avalonia-iz-myget">   Avalonia  MyGet</h2><br>
<p>       Avalonia,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">MyGet</a>    <code>master</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> Avalonia  GitHub</a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>nuget.config</code></a>.  IDE  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">.NET Core CLI</a>  <code>nuget.config</code>,   <code>sln</code>     .   .NET Core CLI:</p><br>
<pre><code class="plaintext hljs">dotnet new sln # Ctrl+C<font></font>
dotnet sln ReactiveUI.Samples.Suspension.sln add ReactiveUI.Samples.Suspension.csproj</code></pre><br>
<p>  <code>nuget.config</code>    <code>.sln</code>-  :</p><br>
<pre><code class="xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">packageSources</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"AvaloniaCI"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"https://www.myget.org/F/avalonia-ci/api/v2"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">packageSources</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre><br>
<p>   IDE,      .   Avalonia    (  <code>0.9.1</code>)      NuGet  IDE,       Windows   Linux:</p><br>
<pre><code class="plaintext hljs">dotnet add package Avalonia.ReactiveUI --version 0.9.1<font></font>
dotnet add package Avalonia.Desktop --version 0.9.1<font></font>
dotnet add package Avalonia --version 0.9.1<font></font>
cat ReactiveUI.Samples.Suspension.csproj</code></pre><br>
<p>   <code>ReactiveUI.Samples.Suspension.csproj</code>   :</p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">Project</span> <span class="hljs-attr">Sdk</span>=<span class="hljs-string">"Microsoft.NET.Sdk"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">OutputType</span>&gt;</span>WinExe<span class="hljs-tag">&lt;/<span class="hljs-name">OutputType</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>netcoreapp3.0<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Compile</span> <span class="hljs-attr">Update</span>=<span class="hljs-string">"**\*.xaml.cs"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">DependentUpon</span>&gt;</span>%(Filename)<span class="hljs-tag">&lt;/<span class="hljs-name">DependentUpon</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Compile</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">AvaloniaResource</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"**\*.xaml"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">SubType</span>&gt;</span>Designer<span class="hljs-tag">&lt;/<span class="hljs-name">SubType</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">AvaloniaResource</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"Avalonia"</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">"0.9.1"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"Avalonia.Desktop"</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">"0.9.1"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"Avalonia.ReactiveUI"</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">"0.9.1"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Project</span>&gt;</span></code></pre><br>
<p>  <code>Views/</code>  <code>ViewModels/</code>   ,    <code>MainWindow</code>  <code>MainView</code>  ,     <code>Views/</code>,      —  <code>ReactiveUI.Samples.Suspension.Views</code>.    <code>Program.cs</code>  <code>App.xaml.cs</code> —   <code>UseReactiveUI</code>    Avalonia,      <code>OnFrameworkInitializationCompleted</code>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>     :</p><br>
<p><strong>Program.cs</strong></p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
    <span class="hljs-comment">//  .   API  Avalonia  , </span>
    <span class="hljs-comment">//  SynchronizationContext,    </span>
    <span class="hljs-comment">// OnFrameworkInitializationCompleted  App.xaml.cs: </span>
    <span class="hljs-comment">//     -    .</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span> <font></font>
        =&gt; BuildAvaloniaApp()<font></font>
            .StartWithClassicDesktopLifetime(args);<font></font>
<font></font>
    <span class="hljs-comment">//   Avalonia.    </span>
    <span class="hljs-comment">// ,      .</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AppBuilder <span class="hljs-title">BuildAvaloniaApp</span>(<span class="hljs-params"></span>)</span><font></font>
        =&gt; AppBuilder.Configure&lt;App&gt;()<font></font>
            .UseReactiveUI() <span class="hljs-comment">// !</span><font></font>
            .UsePlatformDetect()<font></font>
            .LogToDebug();<font></font>
}</code></pre><br>
<p><strong>App.xaml.cs</strong></p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">App</span> : <span class="hljs-title">Application</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params"></span>)</span> =&gt; AvaloniaXamlLoader.Load(<span class="hljs-keyword">this</span>);<font></font>
<font></font>
    <span class="hljs-comment">//    .     </span>
    <span class="hljs-comment">//  MVVM , DI    .    </span>
    <span class="hljs-comment">//     ApplicationLifetime,   </span>
    <span class="hljs-comment">//     .</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnFrameworkInitializationCompleted</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">new</span> Views.MainView().Show();
        <span class="hljs-keyword">base</span>.OnFrameworkInitializationCompleted();<font></font>
    }<font></font>
}</code></pre><br>
<p>  <code>using Avalonia.ReactiveUI</code>  <code>Program.cs</code>. ,            . </p><br>
<pre><code class="plaintext hljs"># Use .NET Core version which you have installed.<font></font>
# It can be netcoreapp2.0, netcoreapp2.1 and so on.<font></font>
dotnet run --framework netcoreapp3.0</code></pre><br>
<p><img src="https://habrastorage.org/webt/bn/84/7b/bn847bgygv5j5awbdb_0pvipoyq.png" width="400"><br>
</p><br>
<h2 id="krossplatformennyy-routing-reactiveui">  ReactiveUI</h2><br>
<p> ,           .NET — view-first  view model-first. View-first               MVVM — ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Frame</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Page</a>   UWP  WPF,    view model-first       .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">ReactiveUI</a>,    ,     view model-first.  ReactiveUI    <code>IScreen</code>,   ,   <code>IRoutableViewModel</code>     XAML — <code>RoutedViewHost</code>.</p><br>
<p><img width="600" src="https://habrastorage.org/webt/4s/7a/6_/4s7a6_gsiixrbgx3h5kf7leezcw.png"><br>
</p><br>
<p>    <code>RoutingState</code>,    . <code>IScreen</code>    ,         . <code>RoutedViewHost</code>       <code>RoutingState</code>,          <code>IRoutableViewModel</code>   XAML.      .</p><br>
<h2 id="sohranenie-sostoyaniya-modeley-predstavleniya-na-disk">     </h2><br>
<p>         . </p><br>
<p><img width="400" src="https://habrastorage.org/webt/ki/tk/o4/kitko4krrwapat8y9_bm0kcobky.png"><br>
</p><br>
<p>  ,              ,   —     .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> ReactiveUI</a>,   <code>ICommand</code>    ,   — <code>ReactiveCommand&lt;TIn, TOut&gt;</code>     ,     <code>CanExecute</code>          .     —   —    ,      <code>SearchQuery</code>      !</p><br>
<p><strong>ViewModels/SearchViewModel.cs</strong></p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">DataContract</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SearchViewModel</span> : <span class="hljs-title">ReactiveObject</span>, <span class="hljs-title">IRoutableViewModel</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ReactiveCommand&lt;Unit, Unit&gt; _search;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _searchQuery;<font></font>
<font></font>
    <span class="hljs-comment">//   IScreen  ,   NULL</span>
    <span class="hljs-comment">//  IScreen  Splat.Locator.   </span>
    <span class="hljs-comment">//      .</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SearchViewModel</span>(<span class="hljs-params">IScreen screen = <span class="hljs-literal">null</span></span>)</span> <font></font>
    {<font></font>
        HostScreen = screen ?? Locator.Current.GetService&lt;IScreen&gt;();<font></font>
<font></font>
        <span class="hljs-comment">//     SearchQuery ,</span>
        <span class="hljs-comment">//     .</span>
        <span class="hljs-keyword">var</span> canSearch = <span class="hljs-keyword">this</span><font></font>
            .WhenAnyValue(x =&gt; x.SearchQuery)<font></font>
            .Select(query =&gt; !<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(query));<font></font>
<font></font>
        <span class="hljs-comment">//      , </span>
        <span class="hljs-comment">//     .</span><font></font>
        _search = ReactiveCommand.CreateFromTask(<font></font>
            () =&gt; Task.Delay(<span class="hljs-number">1000</span>), <span class="hljs-comment">//   </span><font></font>
            canSearch);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> IScreen HostScreen { <span class="hljs-keyword">get</span>; }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> UrlPathSegment =&gt; <span class="hljs-string">"/search"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> ICommand Search =&gt; _search;<font></font>
<font></font>
    [<span class="hljs-meta">DataMember</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> SearchQuery <font></font>
    {<font></font>
        <span class="hljs-keyword">get</span> =&gt; _searchQuery;
        <span class="hljs-keyword">set</span> =&gt; <span class="hljs-keyword">this</span>.RaiseAndSetIfChanged(<span class="hljs-keyword">ref</span> _searchQuery, <span class="hljs-keyword">value</span>);<font></font>
    }<font></font>
}</code></pre><br>
<p>     <code>[DataContract]</code>,  ,    —  <code>[DataMember]</code>.     ,     opt-in  —        ,   opt-out     <code>[IgnoreDataMember]</code>  ,      . ,   <code>IRoutableViewModel</code>    ,          .</p><br>
<div class="spoiler"><b class="spoiler_title">     </b><div class="spoiler_text"><p><strong>ViewModels/LoginViewModel.cs</strong></p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">DataContract</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LoginViewModel</span> : <span class="hljs-title">ReactiveObject</span>, <span class="hljs-title">IRoutableViewModel</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ReactiveCommand&lt;Unit, Unit&gt; _login;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _password;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _username;<font></font>
<font></font>
    <span class="hljs-comment">//   IScreen  ,   NULL</span>
    <span class="hljs-comment">//  IScreen  Splat.Locator.   </span>
    <span class="hljs-comment">//      .</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginViewModel</span>(<span class="hljs-params">IScreen screen = <span class="hljs-literal">null</span></span>)</span> <font></font>
    {<font></font>
        HostScreen = screen ?? Locator.Current.GetService&lt;IScreen&gt;();<font></font>
<font></font>
        <span class="hljs-comment">//     Username  Password</span>
        <span class="hljs-comment">// ,     .</span>
        <span class="hljs-keyword">var</span> canLogin = <span class="hljs-keyword">this</span><font></font>
            .WhenAnyValue(<font></font>
                x =&gt; x.Username,<font></font>
                x =&gt; x.Password,<font></font>
                (user, pass) =&gt; !<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user) &amp;&amp;<font></font>
                                !<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(pass));<font></font>
<font></font>
        <span class="hljs-comment">//      , </span>
        <span class="hljs-comment">//    .</span><font></font>
        _login = ReactiveCommand.CreateFromTask(<font></font>
            () =&gt; Task.Delay(<span class="hljs-number">1000</span>), <span class="hljs-comment">//   </span><font></font>
            canLogin);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> IScreen HostScreen { <span class="hljs-keyword">get</span>; }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> UrlPathSegment =&gt; <span class="hljs-string">"/login"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> ICommand Login =&gt; _login;<font></font>
<font></font>
    [<span class="hljs-meta">DataMember</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Username <font></font>
    {<font></font>
        <span class="hljs-keyword">get</span> =&gt; _username;
        <span class="hljs-keyword">set</span> =&gt; <span class="hljs-keyword">this</span>.RaiseAndSetIfChanged(<span class="hljs-keyword">ref</span> _username, <span class="hljs-keyword">value</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//        !</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Password <font></font>
    {<font></font>
        <span class="hljs-keyword">get</span> =&gt; _password;
        <span class="hljs-keyword">set</span> =&gt; <span class="hljs-keyword">this</span>.RaiseAndSetIfChanged(<span class="hljs-keyword">ref</span> _password, <span class="hljs-keyword">value</span>);<font></font>
    }<font></font>
}</code></pre></div></div><br>
<p>     ,   <code>IRoutableViewModel</code>       <code>IScreen</code>.    <code>IScreen</code>.     <code>[DataContract]</code>,     ,   — .      ,   <code>[DataMember]</code>,    —       ,          . </p><br>
<p><strong>ViewModels/MainViewModel.cs</strong></p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">DataContract</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainViewModel</span> : <span class="hljs-title">ReactiveObject</span>, <span class="hljs-title">IScreen</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ReactiveCommand&lt;Unit, Unit&gt; _search;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ReactiveCommand&lt;Unit, Unit&gt; _login;
    <span class="hljs-keyword">private</span> RoutingState _router = <span class="hljs-keyword">new</span> RoutingState();<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainViewModel</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">//       ,</span>
        <span class="hljs-comment">//  ,   .</span>
        <span class="hljs-keyword">var</span> canLogin = <span class="hljs-keyword">this</span><font></font>
            .WhenAnyObservable(x =&gt; x.Router.CurrentViewModel)<font></font>
            .Select(current =&gt; !(current <span class="hljs-keyword">is</span> LoginViewModel));<font></font>
<font></font>
        _login = ReactiveCommand.Create(<font></font>
            () =&gt; { Router.Navigate.Execute(<span class="hljs-keyword">new</span> LoginViewModel()); },<font></font>
            canLogin);<font></font>
<font></font>
        <span class="hljs-comment">//       ,</span>
        <span class="hljs-comment">//  ,   .</span>
        <span class="hljs-keyword">var</span> canSearch = <span class="hljs-keyword">this</span><font></font>
            .WhenAnyObservable(x =&gt; x.Router.CurrentViewModel)<font></font>
            .Select(current =&gt; !(current <span class="hljs-keyword">is</span> SearchViewModel));<font></font>
<font></font>
        _search = ReactiveCommand.Create(<font></font>
            () =&gt; { Router.Navigate.Execute(<span class="hljs-keyword">new</span> SearchViewModel()); },<font></font>
            canSearch);<font></font>
    }<font></font>
<font></font>
    [<span class="hljs-meta">DataMember</span>]
    <span class="hljs-keyword">public</span> RoutingState Router<font></font>
    {<font></font>
        <span class="hljs-keyword">get</span> =&gt; _router;
        <span class="hljs-keyword">set</span> =&gt; <span class="hljs-keyword">this</span>.RaiseAndSetIfChanged(<span class="hljs-keyword">ref</span> _router, <span class="hljs-keyword">value</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> ICommand Search =&gt; _search;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> ICommand Login =&gt; _login;<font></font>
}</code></pre><br>
<p>        <code>RoutingState</code>,          —      .         ,  <code>IRoutableViewModel</code>,        .     <code>MainViewModel</code>,    <code>ViewModels/MainViewModel.cs</code>      <code>ReactiveUI.Samples.Suspension.ViewModels</code>.</p><br>
<p><img width="250" src="https://habrastorage.org/webt/d7/l0/zm/d7l0zmx2opzysobg-rkqvhexpxk.png"><br>
</p><br>
<h2 id="routing-v-prilozhenii-avalonia">   Avalonia</h2><br>
<p>          -        ,   .NET Standard,       GUI-.   .     MVVM        ,      <code>RoutingState</code>    XAML <code>RoutedViewHost</code>,    <code>Avalonia.ReactiveUI</code>.  GUI  <code>SearchViewModel</code> —     <code>Views/</code>   : <code>SearchView.xaml</code>  <code>SearchView.xaml.cs</code>.</p><br>
<p>      XAML,   Avalonia,       Windows Presentation Foundation, Universal Windows Platform  Xamarin.Forms.          —         ,  ,          <code>SearchViewModel</code>,  .</p><br>
<p><strong>Views/SearchView.xaml</strong></p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">UserControl</span> 
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://github.com/avaloniaui"</span>
    <span class="hljs-attr">xmlns:d</span>=<span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="hljs-attr">xmlns:mc</span>=<span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="hljs-attr">d:DataContext</span>=<span class="hljs-string">"{d:DesignInstance viewModels:SearchViewModel}"</span>
    <span class="hljs-attr">xmlns:viewModels</span>=<span class="hljs-string">"clr-namespace:ReactiveUI.Samples.Suspension.ViewModels"</span>
    <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="hljs-attr">x:Class</span>=<span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.SearchView"</span>
    <span class="hljs-attr">xmlns:reactiveUi</span>=<span class="hljs-string">"http://reactiveui.net"</span>
    <span class="hljs-attr">mc:Ignorable</span>=<span class="hljs-string">"d"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Grid.RowDefinitions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"48"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"48"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"48"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"*"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Grid.RowDefinitions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextBlock</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"Search view"</span> <span class="hljs-attr">Margin</span>=<span class="hljs-string">"5"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextBox</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"{Binding SearchQuery, Mode=TwoWay}"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"2"</span> <span class="hljs-attr">Content</span>=<span class="hljs-string">"Search"</span> <span class="hljs-attr">Command</span>=<span class="hljs-string">"{Binding Search}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">UserControl</span>&gt;</span></code></pre><br>
<p><strong>Views/SearchView.xaml.cs</strong></p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SearchView</span> : <span class="hljs-title">ReactiveUserControl</span>&lt;SearchViewModel&gt;<font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SearchView</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">//  WhenActivated     </span>
        <span class="hljs-comment">//        .</span>
        <span class="hljs-keyword">this</span>.WhenActivated((CompositeDisposable disposable) =&gt; { });<font></font>
        AvaloniaXamlLoader.Load(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
}</code></pre><br>
<p>   WPF, UWP  XF   code-behind   <code>SearchView.xaml</code>.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">WhenActivated</a>              .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">hot observables</a> (, ,    ),      <code>CompositeDisposable</code>  <code>DisposeWith</code>,      XAML         <em>hot observables</em>         .</p><br>
<div class="spoiler"><b class="spoiler_title">    </b><div class="spoiler_text"><p><strong>Views/LoginView.xaml</strong></p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">UserControl</span>
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://github.com/avaloniaui"</span>
    <span class="hljs-attr">xmlns:d</span>=<span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="hljs-attr">xmlns:mc</span>=<span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="hljs-attr">d:DataContext</span>=<span class="hljs-string">"{d:DesignInstance viewModels:LoginViewModel, IsDesignTimeCreatable=True}"</span>
    <span class="hljs-attr">xmlns:viewModels</span>=<span class="hljs-string">"clr-namespace:ReactiveUI.Samples.Suspension.ViewModels"</span>
    <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="hljs-attr">x:Class</span>=<span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.LoginView"</span>
    <span class="hljs-attr">xmlns:reactiveUi</span>=<span class="hljs-string">"http://reactiveui.net"</span>
    <span class="hljs-attr">mc:Ignorable</span>=<span class="hljs-string">"d"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Grid.RowDefinitions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"48"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"48"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"48"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"48"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"*"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Grid.RowDefinitions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextBlock</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"Login view"</span> <span class="hljs-attr">Margin</span>=<span class="hljs-string">"5"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextBox</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"{Binding Username, Mode=TwoWay}"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextBox</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"2"</span> <span class="hljs-attr">PasswordChar</span>=<span class="hljs-string">"*"</span> 
                 <span class="hljs-attr">Text</span>=<span class="hljs-string">"{Binding Password, Mode=TwoWay}"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"3"</span> <span class="hljs-attr">Content</span>=<span class="hljs-string">"Login"</span> <span class="hljs-attr">Command</span>=<span class="hljs-string">"{Binding Login}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">UserControl</span>&gt;</span></code></pre><br>
<p><strong>Views/LoginView.xaml.cs</strong></p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LoginView</span> : <span class="hljs-title">ReactiveUserControl</span>&lt;LoginViewModel&gt;<font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginView</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">this</span>.WhenActivated(disposables =&gt; { });<font></font>
        AvaloniaXamlLoader.Load(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
}</code></pre></div></div><br>
<p>  <code>Views/MainView.xaml</code>  <code>Views/MainView.xaml.cs</code>.    XAML <code>RoutedViewHost</code>    <code>Avalonia.ReactiveUI</code>   ,    <code>RoutingState</code>   <code>RoutedViewHost.Router</code>.         ,     <code>ViewModels/MainViewModel</code>,  .</p><br>
<p><strong>Views/MainView.xaml</strong></p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">Window</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://github.com/avaloniaui"</span>
        <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="hljs-attr">xmlns:d</span>=<span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span>
        <span class="hljs-attr">xmlns:mc</span>=<span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
        <span class="hljs-attr">mc:Ignorable</span>=<span class="hljs-string">"d"</span> <span class="hljs-attr">d:DesignWidth</span>=<span class="hljs-string">"800"</span> <span class="hljs-attr">d:DesignHeight</span>=<span class="hljs-string">"450"</span>
        <span class="hljs-attr">x:Class</span>=<span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.MainView"</span>
        <span class="hljs-attr">xmlns:reactiveUi</span>=<span class="hljs-string">"http://reactiveui.net"</span>
        <span class="hljs-attr">Title</span>=<span class="hljs-string">"ReactiveUI.Samples.Suspension"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Grid.RowDefinitions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"*"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"48"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Grid.RowDefinitions</span>&gt;</span>
        <span class="hljs-comment">&lt;!--  ,   RoutingState, 
               View  ViewModel  --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">reactiveUi:RoutedViewHost</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">Router</span>=<span class="hljs-string">"{Binding Router}"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">reactiveUi:RoutedViewHost.DefaultContent</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">TextBlock</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"Default Content"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">reactiveUi:RoutedViewHost.DefaultContent</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">reactiveUi:RoutedViewHost</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"1"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Grid.ColumnDefinitions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ColumnDefinition</span> <span class="hljs-attr">Width</span>=<span class="hljs-string">"*"</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ColumnDefinition</span> <span class="hljs-attr">Width</span>=<span class="hljs-string">"*"</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ColumnDefinition</span> <span class="hljs-attr">Width</span>=<span class="hljs-string">"*"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Grid.ColumnDefinitions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">Grid.Column</span>=<span class="hljs-string">"0"</span> 
                    <span class="hljs-attr">Command</span>=<span class="hljs-string">"{Binding Search}"</span>
                    <span class="hljs-attr">Content</span>=<span class="hljs-string">"Search"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">Grid.Column</span>=<span class="hljs-string">"1"</span> 
                    <span class="hljs-attr">Command</span>=<span class="hljs-string">"{Binding Login}"</span>
                    <span class="hljs-attr">Content</span>=<span class="hljs-string">"Login"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">Grid.Column</span>=<span class="hljs-string">"2"</span> 
                    <span class="hljs-attr">Command</span>=<span class="hljs-string">"{Binding Router.NavigateBack}"</span>
                    <span class="hljs-attr">Content</span>=<span class="hljs-string">"Back"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Window</span>&gt;</span></code></pre><br>
<p><strong>Views/MainView.xaml.cs</strong></p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainView</span> : <span class="hljs-title">ReactiveWindow</span>&lt;MainViewModel&gt;<font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainView</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">this</span>.WhenActivated(disposables =&gt; { });<font></font>
        AvaloniaXamlLoader.Load(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
}</code></pre><br>
<p> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">ReactiveUI</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Avalonia</a>, .     <code>Search</code>  <code>Login</code>   ,        <code>RoutingState</code>.   XAML <code>RoutedViewHost</code>,    <code>RoutingState</code>,    <code>IViewFor&lt;TViewModel&gt;</code>,  <code>TViewModel</code> —   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>Locator.Current</code></a>.    <code>IViewFor&lt;TViewModel&gt;</code> ,     ,   <code>RoutedViewHost</code>      Avalonia.</p><br>
<p><img width="550" src="https://habrastorage.org/webt/ys/o4/dg/yso4dgybdbqulwbb7dumlbktp5w.png"><br>
</p><br>
<p>   <code>IViewFor&lt;TViewModel&gt;</code>  <code>IScreen</code>   <code>App.OnFrameworkInitializationCompleted</code>  ,  <code>Locator.CurrentMutable</code>.  <code>IViewFor&lt;TViewModel&gt;</code>     <code>RoutedViewHost</code>,   <code>IScreen</code> ,     <code>SearchViewModel</code>  <code>LoginViewModel</code>   ,      <code>Locator.Current</code>.</p><br>
<p><strong>App.xaml.cs</strong></p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnFrameworkInitializationCompleted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//   .</span>
    Locator.CurrentMutable.RegisterConstant&lt;IScreen&gt;(<span class="hljs-keyword">new</span> MainViewModel());<font></font>
    Locator.CurrentMutable.Register&lt;IViewFor&lt;SearchViewModel&gt;&gt;(() =&gt; <span class="hljs-keyword">new</span> SearchView());<font></font>
    Locator.CurrentMutable.Register&lt;IViewFor&lt;LoginViewModel&gt;&gt;(() =&gt; <span class="hljs-keyword">new</span> LoginView());<font></font>
<font></font>
    <span class="hljs-comment">//        .</span>
    <span class="hljs-keyword">new</span> MainView { DataContext = Locator.Current.GetService&lt;IScreen&gt;() }.Show();
    <span class="hljs-keyword">base</span>.OnFrameworkInitializationCompleted();<font></font>
}</code></pre><br>
<p>   ,    .   -    XAML, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  Avalonia  XamlIl</a>  ,  ,   .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">XamlIl   XAML    IDE</a>!</p><br>
<pre><code class="plaintext hljs">dotnet run --framework netcoreapp3.0</code></pre><br>
<p><img src="https://habrastorage.org/webt/c2/pp/88/c2pp88h397pwscpwn-i8vnke6sw.gif" width="400"><br>
</p><br>
<h2 id="sohranenie-i-vosstanovlenie-sostoyaniya-prilozheniya-celikom">     </h2><br>
<p>,     ,    —                 ,    .  ,      ,    <code>AutoSuspendHelper</code>,    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">ReactiveUI</a>.   —         .     <code>RxApp.SuspensionHost.CreateNewAppState</code> ,      ,        ,     . </p><br>
<p>    <code>RxApp.SuspensionHost.SetupDefaultSuspendResume</code>,    <code>ISuspensionDriver</code> — ,      .   <code>ISuspensionDriver</code>   <code>Newtonsoft.Json</code>    <code>System.IO</code>     .     <code>Newtonsoft.Json</code>:</p><br>
<pre><code class="plaintext hljs">dotnet add package Newtonsoft.Json</code></pre><br>
<p><strong>Drivers/NewtonsoftJsonSuspensionDriver.cs</strong></p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NewtonsoftJsonSuspensionDriver</span> : <span class="hljs-title">ISuspensionDriver</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> _file;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> JsonSerializerSettings _settings = <span class="hljs-keyword">new</span> JsonSerializerSettings<font></font>
    {<font></font>
        TypeNameHandling = TypeNameHandling.All<font></font>
    };<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">NewtonsoftJsonSuspensionDriver</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span> =&gt; _file = file;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IObservable&lt;Unit&gt; <span class="hljs-title">InvalidateState</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (File.Exists(_file)) <font></font>
            File.Delete(_file);<font></font>
        <span class="hljs-keyword">return</span> Observable.Return(Unit.Default);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IObservable&lt;<span class="hljs-keyword">object</span>&gt; <span class="hljs-title">LoadState</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> lines = File.ReadAllText(_file);
        <span class="hljs-keyword">var</span> state = JsonConvert.DeserializeObject&lt;<span class="hljs-keyword">object</span>&gt;(lines, _settings);
        <span class="hljs-keyword">return</span> Observable.Return(state);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IObservable&lt;Unit&gt; <span class="hljs-title">SaveState</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> state</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> lines = JsonConvert.SerializeObject(state, _settings);<font></font>
        File.WriteAllText(_file, lines);<font></font>
        <span class="hljs-keyword">return</span> Observable.Return(Unit.Default);<font></font>
    }<font></font>
}</code></pre><br>
<p>     — <code>System.IO</code>    Universal Winows Platform,     —   <code>File</code>  <code>Directory</code>  <code>StorageFile</code>  <code>StorageFolder</code>.      ,         <code>IRoutableViewModel</code>,  <code>Newtonsoft.Json</code>       <code>TypeNameHandling.All</code>  .       Avalonia —  <code>App.OnFrameworkInitializationCompleted</code>:</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnFrameworkInitializationCompleted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//   . </span>
    <span class="hljs-keyword">var</span> suspension = <span class="hljs-keyword">new</span> AutoSuspendHelper(ApplicationLifetime);<font></font>
    RxApp.SuspensionHost.CreateNewAppState = () =&gt; <span class="hljs-keyword">new</span> MainViewModel();<font></font>
    RxApp.SuspensionHost.SetupDefaultSuspendResume(<span class="hljs-keyword">new</span> NewtonsoftJsonSuspensionDriver(<span class="hljs-string">"appstate.json"</span>));<font></font>
    suspension.OnFrameworkInitializationCompleted();<font></font>
<font></font>
    <span class="hljs-comment">//  ,      .</span>
    <span class="hljs-keyword">var</span> state = RxApp.SuspensionHost.GetAppState&lt;MainViewModel&gt;();<font></font>
    Locator.CurrentMutable.RegisterConstant&lt;IScreen&gt;(state);<font></font>
    Locator.CurrentMutable.Register&lt;IViewFor&lt;SearchViewModel&gt;&gt;(() =&gt; <span class="hljs-keyword">new</span> SearchView());<font></font>
    Locator.CurrentMutable.Register&lt;IViewFor&lt;LoginViewModel&gt;&gt;(() =&gt; <span class="hljs-keyword">new</span> LoginView());<font></font>
<font></font>
    <span class="hljs-comment">//  .</span>
    <span class="hljs-keyword">new</span> MainView { DataContext = Locator.Current.GetService&lt;IScreen&gt;() }.Show();
    <span class="hljs-keyword">base</span>.OnFrameworkInitializationCompleted();<font></font>
}</code></pre><br>
<p>  <code>AutoSuspendHelper</code>   <code>Avalonia.ReactiveUI</code>        <code>IApplicationLifetime</code> —  ,           <code>ISuspensionDriver</code>    .    <code>ISuspensionDriver</code>            <code>appstate.json</code>     :</p><br>
<div class="spoiler"><b class="spoiler_title">appstate.json</b><div class="spoiler_text"><p>  —      <code>$type</code>,          ,    .</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"$type"</span>: <span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.MainViewModel, ReactiveUI.Samples.Suspension"</span>,
  <span class="hljs-attr">"Router"</span>: {
    <span class="hljs-attr">"$type"</span>: <span class="hljs-string">"ReactiveUI.RoutingState, ReactiveUI"</span>,
    <span class="hljs-attr">"_navigationStack"</span>: {
      <span class="hljs-attr">"$type"</span>: <span class="hljs-string">"System.Collections.ObjectModel.ObservableCollection`1[[ReactiveUI.IRoutableViewModel, ReactiveUI]], System.ObjectModel"</span>,
      <span class="hljs-attr">"$values"</span>: [<font></font>
        {<font></font>
          <span class="hljs-attr">"$type"</span>: <span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.SearchViewModel, ReactiveUI.Samples.Suspension"</span>,
          <span class="hljs-attr">"SearchQuery"</span>: <span class="hljs-string">"funny cats"</span><font></font>
        },<font></font>
        {<font></font>
          <span class="hljs-attr">"$type"</span>: <span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.LoginViewModel, ReactiveUI.Samples.Suspension"</span>,
          <span class="hljs-attr">"Username"</span>: <span class="hljs-string">"worldbeater"</span><font></font>
        }<font></font>
      ]<font></font>
    }<font></font>
  }<font></font>
}</code></pre></div></div><br>
<p>  , ,  ,     ,     ,      ,     !  ,        ,  ReactiveUI —   UWP  WPF,    Xamarin.Forms. </p><br>
<p><img src="https://habrastorage.org/webt/yf/ig/p0/yfigp0_ob3ah_cofj-3tdazxrgc.png" width="750"><br>
</p><br>
<p><strong>:</strong> <code>ISuspensionDriver</code>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Akavache</a> —      <code>UserAccount</code>  <code>Secure</code>   iOS  UWP          ,    ,   Android  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> BundleSuspensionDriver</a>   <code>ReactiveUI.AndroidSupport</code>.      JSON   Xamarin.Essentials <code>SecureStorage</code>. ,           —    !</p><br>
<h2 id="poleznye-ssylki"> </h2><br>
<ul>
<li> ,   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  GitHub</a>. </li>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Avalonia</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>. </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたは</font><font style="vertical-align: inherit;">できる</font><font style="vertical-align: inherit;">学習を開始</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReactiveUIを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habr上ReactiveUIについての記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamicDataに関する記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、反応型コレクションの操作について学ぶことができ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457150/index.html">新しいWindowsターミナルがMicrosoftストアで入手可能に</a></li>
<li><a href="../ja457152/index.html">DEFCON 25カンファレンス。GarryKasparov。「最後の脳の戦い」パート1</a></li>
<li><a href="../ja457154/index.html">すべてのユーザー向けのレスポンシブなアプリ設計</a></li>
<li><a href="../ja457156/index.html">将来のコンピューティングシステムは何か</a></li>
<li><a href="../ja457160/index.html">C ++でデリゲートを実装する私のアプローチ：実行時に不明なパラメーターで関数を呼び出す</a></li>
<li><a href="../ja457168/index.html">PythonとTextBlobによるプロトタイプ感情分析</a></li>
<li><a href="../ja457172/index.html">ScreenLogger-笑顔、隠されたカメラがあなたを撃ちます</a></li>
<li><a href="../ja457178/index.html">プロセッサの設計と製造方法：CPU設計</a></li>
<li><a href="../ja457180/index.html">公式サイトNode.jsがロシア語になりました</a></li>
<li><a href="../ja457182/index.html">REXX言語、40周年</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>