<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóº üí£ ü§≤üèæ What to save in the cloud ‚úàÔ∏è ‚úñÔ∏è üßõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Clouds are comfortable with their flexibility. We need a powerful computing cluster for eight hours: rented in three clicks, completed the task and pu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>What to save in the cloud</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/technoserv/blog/502510/"><img src="https://habrastorage.org/webt/sf/g_/x8/sfg_x8we3_wttljq5zj21w58dde.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clouds are comfortable with their flexibility. We need a powerful computing cluster for eight hours: rented in three clicks, completed the task and put out the cars. Unfortunately, many simply misunderstand the ideology of cloud resources and are often disappointed when they see accounts at the end of the month. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To optimize costs, you need to start by collecting good statistics. I will try to briefly describe the appropriate tools for this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The key principle of saving is to turn off all unnecessary and minimize the reserve as much as possible. Weaned to think in the paradigm of the local server in the infrastructure of the company. If you can automate the expansion and shutdown of cloud resources depending on the load - even better.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider situations where fixed rates are more profitable, and when - pay-as-you-go-concept (PAYG). </font><font style="vertical-align: inherit;">Plus, consider what you can turn off the excess, and where resources are most often wasted. </font><font style="vertical-align: inherit;">Let's go through the main types of resources: CPU, RAM, virtual disks, networks and backups.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We collect information</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before you make any optimization actions, you first need to understand how your machine is loaded. </font><font style="vertical-align: inherit;">Therefore, it is most right to start with monitoring systems in order to accurately understand the nature of the load. </font><font style="vertical-align: inherit;">Moreover, the load should be analyzed at different scales. </font><font style="vertical-align: inherit;">Averaged data for the month will be useful for understanding the degree of reservation or lack of resources in general. </font><font style="vertical-align: inherit;">Also, you can predict the approximate dates when the current capacity will cease to be enough if the load is gradually growing. </font><font style="vertical-align: inherit;">Data for several days will be able to show diurnal fluctuations, usually associated with the life cycle of time zones, and sharp single bursts when resources are in short supply.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to monitor</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are a huge number of information collection and visualization systems to choose from, but I would like to draw attention to the key ones:</font></font><br>
<br>
<ul>
<li>Zabbix ‚Äî       .    ,   .</li>
<li>Kibana ‚Äî   ELK.      ,       ,  .</li>
<li>Grafana ‚Äî   ,        .  ,         .</li>
<li>   .    ,             .</li>
</ul><br>
<h4>  </h4><br>
 <img src="https://habrastorage.org/webt/gj/3_/wa/gj3_wap2yizshq8dgovsy-kqewu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The cloud itself is designed to save money, but you can also optimize costs by properly consuming cloud resources. Estimate the uniform loading of your machines. If the virtual machine is stably loaded, then everything is fine, and the tariff with fixed limits and a small power reserve will be most beneficial. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4m/z5/g0/4mz5g0mv5m3wsg0yfayffuh3leq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">During peak load, only one core was involved. You can save money and not take two. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/al/xh/rk/alxhrkhhbmjk_ayecdsd_ldikxg.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can take two cores instead of four without loss of performance.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
If more than 10% of the time the VM is idle, then you need to try to count on the PAYG model. Only then should the machine be turned off when not in use. For example, once a day, a node turns on, compiles the project and turns off again.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n6/nw/_w/n6nw_wi9iq_qolomaizyabh_ibc.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All cores are evenly loaded. Most likely, it will be advantageous to take a tariff with a fixed payment.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Usually, the tactics of financial optimization look like this: you divide the elements of your infrastructure into stable ones according to consumption and unstable ones with peak loads. We try to transfer elements with constant consumption to a fixed tariff, and unstable ones to PAYG, in order to be able to smoothly smooth out single bursts inexpensively. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We do the same with various test and experimental machines. Most often, it is more profitable to pay them upon the consumed resources, rather than with a fixed tariff. If you find a car that consumes 1% of the power, then turn it off and transfer to PAYG.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to understand that in the cloud you are not paying for the load on the processor, but for the very fact of using cores. If you use the PAYG tariff plan and you do not need a VM at the moment, for example, you have performed the necessary tests on it and do not use it anymore, then it‚Äôs more logical to turn it off and thereby save on the cost of virtual memory and processors. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some clients use the vCloud Director API to turn on and off VMs on a schedule to save even more on resources consumed. A very good approach would be to use orchestration to control the cloud, turn nodes on and off when the load changes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the same time, you will have to pay for virtual disks anyway. </font><font style="vertical-align: inherit;">If you no longer need a VM, then it is better to remove it. </font><font style="vertical-align: inherit;">Or, if you use it very rarely, then for a while, while it is off, transfer it to a cheaper storage. </font><font style="vertical-align: inherit;">You can also save on virtual disks if you deploy a node each time from a ready-made template, rather than keep the finished one turned off. </font><font style="vertical-align: inherit;">And keep the templates already in cheap storage.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You should not allocate more memory to the VM than is required. </font><font style="vertical-align: inherit;">Very often, cloud users configure VMs empirically: "Well, about as much memory needs to be dumped and so many cores." </font><font style="vertical-align: inherit;">At the same time, it is RAM that, as a rule, is the most expensive resource in the cloud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using the PAYG tariff plan, it makes sense to configure the VM so that it optimally utilizes the resources allocated to it, having a margin in performance for peak loads. </font><font style="vertical-align: inherit;">At the same time, the reserve should not be x4 or x10 from the average consumption of your application: it is simply irrationally expensive. </font><font style="vertical-align: inherit;">Of course, limits are always determined individually for each task, but most often you should strive to ensure that the stock does not exceed 25%.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Virtual disks</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One important resource is virtual disks. There are several types of virtual disks that differ in speed and price. The faster the drive, the more expensive it is expected. Therefore, saving on this parameter should begin with the analysis and separation of data into ‚Äúcold‚Äù and ‚Äúhot‚Äù. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/de/ml/vmdemlj2hlubfw8ep3nse8jaais.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wrong option. The VM allocation policy is configured so that the VM swap, configuration, and disks will be placed on expensive disks, unless you explicitly specify otherwise.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A VM can simultaneously use different types of disks that can be placed on fast and slow storage. Accordingly, if you store some kind of data archives or logs, it makes sense to place them on slow disks. Databases are critical to IOPS, so we send them to fast repositories. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/kh/ho/yhkhhocb1gaklncsygmju2u41le.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The correct option. Each data type has its own disk speed.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we need to solve the question on which disk to place the VM itself. </font><font style="vertical-align: inherit;">The vloud Director platform has a feature: it reserves disk space for the VM‚Äôs RAM at the time of its launch. </font><font style="vertical-align: inherit;">In this case, you pre-select the type of storage. </font><font style="vertical-align: inherit;">The OS itself is not too critical for IOPS, most components are already loaded into RAM, and the disk is not loaded. </font><font style="vertical-align: inherit;">However, if you save money and place yourself on a slow disk, you will get a long reboot and wake up from sleep mode due to the low reading speed of swap and configuration files. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider this factor if it is critical for you to quickly raise the virtual machine after a reboot. </font><font style="vertical-align: inherit;">In other cases, you can save.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disks under the database</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Very often, disks under the database are taken "for growth." This is a typical mistake for cloud systems. If you need 60 GB, then take as much as you need with a small margin. Conditional 200 GB of a fast disk will eat up finance and idle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unlike the iron server, there is no problem gradually expanding the disk in volume as necessary. Just do not forget to hang up monitoring with triggers to overflow the disk so as not to miss the moment when it is time to expand the space. If you want to do it very beautifully, you can try to automatically increase the space as it fills through the API.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only minus of this approach is that you cannot reduce the size of the disks, changes only towards expansion. </font><font style="vertical-align: inherit;">If you still need to reduce it, then this procedure is performed with transferring data to a smaller volume and deleting the old disk. </font><font style="vertical-align: inherit;">Do not forget about backups and thorough testing at this stage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not forget to dump the logs on a separate slow storage so as not to waste precious space on the fast disk from the database. </font><font style="vertical-align: inherit;">They tend to absorb space very quickly, especially in the case of MS SQL. </font><font style="vertical-align: inherit;">It is also highly desirable to exclude logs from the images of regular backups.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Network</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We do the same with the Network: we don‚Äôt chase round numbers of 1-10-100 megabits, but immediately take 45 megabits if you have an average channel load of around 40. Take as many resources as you need. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clarify the possibility of controlling this parameter on your part. At our place, the client himself cannot change it, that is, pay-as-you-go does not work, and changing the channel width is possible once a month. However, there are clouds where this setting is configured in real time.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/er/ev/lj/erevlj1mq2rocpm1qtf5jlkik2g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the vCloud Director-based cloud, there‚Äôs a great thing about the NSX Edge ‚Äî the virtual router. </font><font style="vertical-align: inherit;">It is free and can replace more expensive solutions that require additional capacity and purchase licenses. </font><font style="vertical-align: inherit;">It has a balancer that in simple situations can replace such solutions as Haproxy and virtual appliance Citrix NetScaler. </font><font style="vertical-align: inherit;">No need to buy licenses for commercial products, and you do not pay for NSX Edge resources. </font><font style="vertical-align: inherit;">It is by default. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If necessary, NSX Edge can be scaled. </font><font style="vertical-align: inherit;">Able to work as a VPN of three types:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPsec VPN tunnel Site-to-Site - for organizing a secure channel between the cloud and the office or other clouds where the client‚Äôs resources are located.</font></font></li>
<li>SSL VPN ‚Äî         ,          Checkpoint Cisco  Fortigate.</li>
<li>L2VPN ‚Äî  ,  IPSEC Site-to-Site,     L2.</li>
</ol><br>
<h3>CPU</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here you can save a few options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First you need to carefully select the optimal processor type in terms of frequency and number of cores. Everything will depend on the features of software licensing that runs on this machine. For example, an AD server or terminal server is convenient to keep on hypervisors with a large number of mid-range cores. On servers with software licensed by the number of cores, the frequency of a single core is already becoming important. Such machines are more expensive, but more profitable in terms of performance per core. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is not at all necessary to use the same processors on all of your machines. Moreover, a combination of instances with a core frequency of 2.4 GHz and, for example, 3.1 GHz may be more economically attractive.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hybrid architectures can also be used. </font><font style="vertical-align: inherit;">If you have your own infrastructure and you don‚Äôt want to transfer everything, then a mixed solution will be a good solution, when a part is spinning in the office and the other in the cloud. </font><font style="vertical-align: inherit;">At the same time, cloud resources are taken only to smooth the peak load of their own infrastructure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note: the RAM will reduce the RAM and the CPU only when the VM is turned off, otherwise the system might panic. </font><font style="vertical-align: inherit;">You can expand the resources on a running machine if the OS supports and the hot add mode is enabled.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backup</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When using the Backup service, the client pays for two things: for the number of VMs and for the amount of data on disk space. Again we start with the analysis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Think about whether you need copies of Active Directory a year ago, or if an incremental daily backup of one to two weeks is enough. Decide how long corrupted data may go undetected, and configure backup storage accordingly. Working machines, on which the service is only spinning, as a rule, it makes no sense to store for longer than a week. In the case of the database, it may be necessary to restore from a copy of six months ago if someone messes up the data, but this will not be noticed right away.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second point is the speed of recovery. If the service has a reserve, then you can limit yourself to a full backup and incremental copies. In this case, the last copy is restored, but before that, all changes from incremental copies must be considered in stages. This is a long time. But in the case of working backup nodes, the service will continue to function while one of the nodes is restored. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If there is no reserve for some reason, then you should think about storing the current full backup without increment. Eats more places, but it is deployed much faster and minimizes downtime. The difference in speed can be one and a half to two times.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you need to keep backups for a long time, then you should consider the option of cold storage. </font><font style="vertical-align: inherit;">These are usually slow recovery tape libraries. </font><font style="vertical-align: inherit;">The option is ideal for archived data. </font><font style="vertical-align: inherit;">A good example is Amazon Glacier, where the start of deployment from an old backup starts three to five hours after the request. </font><font style="vertical-align: inherit;">Conditionally, your data needs to be physically found, removed from the warehouse and counted. </font><font style="vertical-align: inherit;">But the cost per gigabyte of storage is becoming much more profitable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We can use the facility storage at the rate of " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">It has a small storage cost with a progressive discount: the more storage you store, the cheaper the gigabyte of data costs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can save resources on the cloud only if you carefully analyze the load and minimize the reserve capacity. </font><font style="vertical-align: inherit;">Start by collecting high-quality statistics and begin to smoothly cut resources to the minimum necessary. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the node consumption is stable and does not change - go to your own infrastructure for this task or choose fixed tariffs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not forget about the possibility of hybrid schemes. </font><font style="vertical-align: inherit;">Using cloud resources to smooth out irregular peak loads fits almost perfectly into the pay-as-you-go concept.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502496/index.html">Easy Web Access to LabVIEW VI PHP Applications via ActiveX Server</a></li>
<li><a href="../en502498/index.html">Best practices for improving performance in C #</a></li>
<li><a href="../en502500/index.html">The evolution of a passport scanner: from plywood crafts to real business</a></li>
<li><a href="../en502504/index.html">Surround the user digit</a></li>
<li><a href="../en502508/index.html">Trolley Robot 2.0. Part 2. Management in rviz and without. Elements of beauty in rviz</a></li>
<li><a href="../en502512/index.html">Results of the contest of sofa experts: the rules of scientific poking</a></li>
<li><a href="../en502518/index.html">How to climb a tree</a></li>
<li><a href="../en502520/index.html">Video reports of mitap reports on product analytics</a></li>
<li><a href="../en502522/index.html">We open the galvanic isolation chip with a tiny transformer inside</a></li>
<li><a href="../en502554/index.html">Middle information technology as a way out of crisis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>