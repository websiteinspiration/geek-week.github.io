<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêà ü§™ üí™üèº Atualiza√ß√£o do processo de CI / CD: teamcity üë©üèø‚Äçü§ù‚Äçüë®üèΩ üêÇ üåá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este √© o segundo artigo de uma s√©rie sobre a atualiza√ß√£o de processos de CI / CD. At√© esse momento, estavam sendo feitos preparativos para a cria√ß√£o d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Atualiza√ß√£o do processo de CI / CD: teamcity</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496342/"><img src="https://habrastorage.org/webt/cu/y-/hg/cuy-hgxvywohqkg_tbyr2wn268c.png" alt="imagem" align="left" width="300"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este √© o segundo artigo de uma s√©rie sobre a atualiza√ß√£o de processos de CI / CD. At√© esse momento, estavam sendo feitos preparativos para a cria√ß√£o de novas ferramentas, a saber: planejamento, com√≠cios di√°rios, resolu√ß√£o de diverg√™ncias, em geral, tudo sem o qual n√£o seria poss√≠vel construir um processo de trabalho com compet√™ncia. E agora, todas as quest√µes foram resolvidas, estamos confiantes de que podemos continuar o desenvolvimento e nosso c√≥digo n√£o afundar√° no buraco negro no in√≠cio do ver√£o.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me lembr√°-lo do √≠ndice da lista de artigos, bem como dos breves resultados da parte anterior. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1: o que √©, por que n√£o √©, como planejar, um pouco de festa.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eu chamaria essa parte de quase t√©cnica. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2: cidade da equipe. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 3: implanta√ß√£o do polvo.</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Parte 4: nos bastidores. Momentos desagrad√°veis, planos para o futuro, possivelmente FAQ. Provavelmente, tamb√©m pode ser chamado de quase t√©cnico.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fornecemos ao cliente uma prova de conceito de um novo sistema de entrega de atualiza√ß√µes, identificamos as defici√™ncias do sistema existente, selecionamos a base para o novo, fizemos um plano de transi√ß√£o e convertemos nosso reposit√≥rio mercurial em git. Al√©m disso, na parte anterior, descrevemos os recursos do projeto que afetar√£o todo o processo subsequente.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionado anteriormente, a solu√ß√£o existente n√£o atendia aos requisitos modernos. Inicialmente, muito provavelmente, uma compila√ß√£o foi configurada no ccnet. A primeira compila√ß√£o com a qual tudo come√ßou (como um big bang, sim). Aparentemente, a pessoa que configurou tudo, pressionou ctrl + c, ctrl + v, corrigiu algumas linhas e recebeu uma nova configura√ß√£o. E durante todo o tempo subsequente, isso foi feito um n√∫mero suficiente de vezes, para que o c√≥digo-fonte no servidor de constru√ß√£o ocupasse mais de 60G. E estas s√£o apenas a fonte! E h√° logs, compila√ß√£o de artefatos, arquivos tempor√°rios e assim por diante. S√≥ isso me fez pensar. Observando o sistema antigo, era poss√≠vel ver o seguinte: uma etapa de constru√ß√£o foi executada para cada m√≥dulo. De fato, o mesmo n√∫cleo foi montado. E esse assembly foi armazenado para cada m√≥dulo (junto com a origem) no servidor.Os resultados da compila√ß√£o (90% id√™nticos) foram inseridos nos reposit√≥rios locais (implanta√ß√£o do git) e, √© claro, tamb√©m foram substitu√≠dos. Era poss√≠vel e necess√°rio deixar isso.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√µes Gerais&nbsp;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse est√°gio, sup√µe-se que j√° haja uma cidade e um polvo configurados. </font><font style="vertical-align: inherit;">No est√°gio de instala√ß√£o e configura√ß√£o, n√£o paramos em detalhes. </font><font style="vertical-align: inherit;">Por conveni√™ncia, anotamos o URL e o token de API do polvo na env teamcity, que, a prop√≥sito, para o projeto raiz tem a seguinte apar√™ncia: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/vw/ir/savwiryxdsw8fpgrgvdzavejho0.png" alt="imagem"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.apiUserName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.apiUserPassword</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o acessos api ao usu√°rio da teamcity (ser√£o necess√°rios mais tarde), </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.buildPath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env .sourcePath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o caminho padr√£o para os arquivos de compila√ß√£o e de origem, respectivamente, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoApiKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o token e o URL do polvo. </font><font style="vertical-align: inherit;">Eles ainda </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.teamcityUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acrescentou. </font><font style="vertical-align: inherit;">Bem, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tt.exe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- caminho para o utilit√°rio de transforma√ß√£o de texto. </font><font style="vertical-align: inherit;">Este utilit√°rio gera todas as configura√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos plugins de terceiros, apenas a integra√ß√£o do Octopus Deploy est√° instalada.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o sobrecarregar a enorme quantidade de texto, apenas as etapas em que h√° algo que vale a pena aten√ß√£o ser√£o examinadas em detalhes. </font><font style="vertical-align: inherit;">Sup√µe-se que tudo o mais seja compreens√≠vel com base nos dados apresentados e no conhecimento do leitor. </font><font style="vertical-align: inherit;">De qualquer forma, se voc√™ tiver alguma d√∫vida, ficarei feliz em respond√™-las.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detalhamento do projeto, controle de vers√£o, nomes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O resultado foi um esquema de projeto (como uma imagem, porque h√° um problema com a exibi√ß√£o de uma lista multin√≠vel): </font></font><br>
<img src="https://habrastorage.org/webt/-4/oq/gh/-4oqghadht5sr4rdpk7f3igz5do.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vers√£o dos pacotes da seguinte forma: major.minor.patch, em que major ainda √© 1, menor - contador de compila√ß√£o na configura√ß√£o de compila√ß√£o, contador de compila√ß√£o de patch para a configura√ß√£o Implantar (n√£o necess√°rio para a configura√ß√£o Build, portanto, sempre 0). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers√£o antiga √© descrita aqui. Estamos redesenhando-o para que seja baseado na tag git. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3v/kl/ov/3vklovvjqjnhwa8yg0b3lxtduns.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, aqui 1 √© maior, 95 √© menor e 1 √© patch.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No novo processo para m√≥dulos, haver√° uma constru√ß√£o que ser√° implantada em cada m√≥dulo. Ou seja, o c√≥digo-fonte √© armazenado em uma √∫nica c√≥pia para cada ambiente, o resultado da compila√ß√£o tamb√©m √©, pois √© comum a todos os m√≥dulos. Configura√ß√µes e bibliotecas exclusivas s√£o empacotadas em um pacote individual no est√°gio de implanta√ß√£o. Isso usar√° efetivamente o espa√ßo em disco e reduzir√° o tempo de entrega de cada pacote. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No est√°gio de prepara√ß√£o, houve uma breve reuni√£o separada sobre a conven√ß√£o de nomea√ß√£o de arquivos de configura√ß√£o. Costumava ser (era apenas), mas nem sempre o mesmo. Al√©m disso, o nome da configura√ß√£o nem sempre cont√©m informa√ß√µes suficientes. Como resultado, todos os nomes de configura√ß√£o foram os seguintes: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConfigurationType.Environment.ModName.config</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onde ConfigurationType pode ser AppSettings, Web etc. </font><font style="vertical-align: inherit;">Ambiente - desenvolvimento, teste, prepara√ß√£o, produ√ß√£o. </font><font style="vertical-align: inherit;">ModName √© o nome exclusivo do m√≥dulo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os projetos de m√≥dulos funcionam com o mesmo princ√≠pio.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo ambiente possui uma configura√ß√£o de compila√ß√£o que:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executa restaura√ß√£o de nuget (instalador do NuGet, restaura√ß√£o de nuget)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gera configura√ß√µes (linha de comando, transforma√ß√£o de texto)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solu√ß√£o Buildit (Visual studio sln)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pega os arquivos do env.buildPath no zip e os envia para o polvo (Octopus deploy: push packages)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cria√ß√£o de vers√£o (sem implanta√ß√£o) (Octopus deploy create release)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redefine a vers√£o do patch (PowerShell)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m existem configura√ß√µes de implanta√ß√£o que funcionam com base no modelo e fazem o seguinte:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pega as configura√ß√µes geradas no est√°gio de compila√ß√£o (etapa 2) (Octopus implementa pacotes push)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implantar a vers√£o principal (criada na etapa 6 da compila√ß√£o) (Octopus deploy: deploy release)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vers√£o individual de implanta√ß√£o (criada na etapa 1 da configura√ß√£o atual) (Octopus deploy: deploy release)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibe uma lista de todos os dom√≠nios deste m√≥dulo no log (etapa para a conveni√™ncia do testador e desenvolvedor). </font><font style="vertical-align: inherit;">(Powershell).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cada configura√ß√£o de implanta√ß√£o, a configura√ß√£o de compila√ß√£o √© adicionada √† depend√™ncia. </font><font style="vertical-align: inherit;">Isso possibilita iniciar automaticamente a compila√ß√£o quando for implantada, se n√£o for relevante, al√©m da capacidade de redefinir a vers√£o do patch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deploy_all configuration. </font><font style="vertical-align: inherit;">De fato, essa √© uma cadeia de constru√ß√£o que descreve que voc√™ primeiro precisa executar a constru√ß√£o, se n√£o for relevante, e depois instalar simultaneamente todos os modos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â algo parecido com isto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rq/ps/ck/rqpsckl2g8rrt9voltbt082itcu.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos algumas das etapas com mais detalhes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√µes gerais</font></font></h3><br>
<img src="https://habrastorage.org/webt/g_/5j/b9/g_5jb95h7ei6qexbvckqd8sxs7e.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De incomum formato de n√∫mero apenas compila√ß√£o </font><font style="vertical-align: inherit;">Ser√° explicado mais tarde.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.env</font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/nr/bx/a4nrbxt_8ol6yjuo64npqfxuota.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
interesse aqui s√£o: </font><i><font style="vertical-align: inherit;">env.coreProjectName</font></i><font style="vertical-align: inherit;"> - definido para todo o projeto. </font><font style="vertical-align: inherit;">Necess√°rio para identificar o projeto no polvo. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.Environment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - definido para o subprojeto M√≥dulos. </font><font style="vertical-align: inherit;">√â necess√°rio selecionar as configura√ß√µes corretas, dependendo do ambiente. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoChannel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o canal no polvo no qual o pacote cai. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mesmo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que </font><i><font style="vertical-align: inherit;">ambiente</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.serviceName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o nome da solu√ß√£o. </font><font style="vertical-align: inherit;">Basicamente, a vari√°vel √© adicionada para facilitar a visualiza√ß√£o. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantRoleTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tag de </font><i><font style="vertical-align: inherit;">inquilino</font></i><font style="vertical-align: inherit;"> no polvo. </font><font style="vertical-align: inherit;">Mais detalhes na se√ß√£o de polvo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.4 </font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/da/r1/a4dar1z6_kawzfttqbuvoivu_mm.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione ao arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">morto</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o nome </font><i><font style="vertical-align: inherit;">% env.serviceName%.% Build.number% .zip</font></i><font style="vertical-align: inherit;"> arquivos do diret√≥rio com o resultado da constru√ß√£o, excluindo todas as configura√ß√µes e DLL da pasta bin / native. </font><font style="vertical-align: inherit;">Os √∫ltimos foram adicionados manualmente ao servidor da Web uma vez e ningu√©m os tocar√° novamente. </font><font style="vertical-align: inherit;">Se necess√°rio, eles tamb√©m ser√£o atualizados manualmente (para isso, est√° planejado escrever um script separado, mas seremos honestos). </font><font style="vertical-align: inherit;">Isso se deve ao fato de essas bibliotecas serem "mantidas" pelo pool do IIS e, para uma implanta√ß√£o bem-sucedida, ela deve ser interrompida e iniciada, o que leva algum tempo. </font><font style="vertical-align: inherit;">Ao excluir essas bibliotecas da implanta√ß√£o, podemos pular a etapa de parar o pool, o que reduzir√° o tempo da implanta√ß√£o e, consequentemente, o tempo de inatividade.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.5</font></font></h3><br>
<img src="https://habrastorage.org/webt/us/hu/zx/ushuzxwer8u3iwqnuuqpjbuoodo.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acho que tudo est√° claro aqui, exceto por que o campo Ambiente est√° vazio. </font><font style="vertical-align: inherit;">Em que ambiente o pacote fica, o polvo toma uma decis√£o com base na tag de pr√©-lan√ßamento (configurada nos canais). </font><font style="vertical-align: inherit;">Essa tag est√° contida em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% build.number%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o mesmo est√°gio na tela em Build.General). </font><font style="vertical-align: inherit;">Portanto, neste caso, acabou sendo mais conveniente. </font><font style="vertical-align: inherit;">Tamb√©m vale a pena prestar aten√ß√£o na caixa de sele√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mostrar processo de implanta√ß√£o"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se n√£o estiver instalado, o timsity considerar√° a compila√ß√£o bem-sucedida assim que o polvo come√ßar (mas n√£o terminar!) O trabalho. </font><font style="vertical-align: inherit;">Ou seja, se a caixa de sele√ß√£o n√£o estiver instalada e algo der errado durante a fase de implanta√ß√£o - sem olhar para a interface do polvo, n√£o saberemos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.6</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nada incomum, apenas um script do PowerShell e informa√ß√µes da documenta√ß√£o da equipe da cidade.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$pair</span> = <span class="hljs-string">"%env.apiUserName%:%env.apiUserPassword%"</span>
<span class="hljs-variable">$encodedCreds</span> = [<span class="hljs-type">System.Convert</span>]::ToBase64String([<span class="hljs-type">System.Text.Encoding</span>]::ASCII.GetBytes(<span class="hljs-variable">$pair</span>))
<span class="hljs-variable">$basicAuthValue</span> = <span class="hljs-string">"Basic <span class="hljs-variable">$encodedCreds</span>"</span>
<span class="hljs-variable">$depUri</span>=<span class="hljs-string">"%env.teamcityUrl%/app/rest/buildTypes?locator=snapshotDependency:(from:(build:(id:%teamcity.build.id%)),includeInitial:false)"</span>
<span class="hljs-comment"># Get all dependencies of main build</span>
<span class="hljs-variable">$result</span> = (<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$depUri</span>)
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$i</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$result</span>.buildTypes.buildType.Count) { <span class="hljs-variable">$buildId</span> += <span class="hljs-variable">$result</span>.buildTypes.buildType.id }
<span class="hljs-variable">$buildId</span> = <span class="hljs-variable">$buildId</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">'Module_DeployAll'</span> }
<span class="hljs-comment"># Reset all child build counters to 1. This build counters are patch versions in every build. (1.build.patch)</span>
<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buildId</span>.Count; <span class="hljs-variable">$i</span>++) {
  <span class="hljs-variable">$buildCounterUri</span> = <span class="hljs-string">"%env.teamcityUrl%/httpAuth/app/rest/buildTypes/"</span>+<span class="hljs-variable">$buildId</span>[<span class="hljs-variable">$i</span>]+<span class="hljs-string">"/settings/buildNumberCounter"</span>
  <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Method</span> Put <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'accept'</span>=<span class="hljs-string">'text/plain'</span>; <span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$buildCounterUri</span> <span class="hljs-literal">-ContentType</span> <span class="hljs-string">"text/plain"</span> <span class="hljs-literal">-Body</span> <span class="hljs-number">1</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui precisamos de um usu√°rio da API no teamcity (o ambiente √© criado para ele). </font><font style="vertical-align: inherit;">Efetuamos login, pegamos todas as configura√ß√µes que dependem da configura√ß√£o Build e redefinimos seu contador de build para 1. Isso √©, de fato, para cada vers√£o de patch, este √© um indicador de quantas vezes a mesma build foi implantada para um m√≥dulo espec√≠fico. </font><font style="vertical-align: inherit;">Se n√£o houver 1, significa que algo deu errado no processo de implanta√ß√£o ou funcionamento do m√≥dulo na vers√£o atual e requer aten√ß√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.General</font></font></h3><br>
<img src="https://habrastorage.org/webt/aa/lx/p4/aalxp4uzeiofjnfo0tfdx57z0cs.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formato da vers√£o: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.% dep.Module_Build.build.counter%.% Build.counter% -staging</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , em que </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% dep.Module_Build.build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© a vari√°vel de sistema teamcity cujo valor corresponde ao contador de compila√ß√£o da configura√ß√£o de compila√ß√£o correspondente (deve ser adicionado a depend√™ncias). </font><font style="vertical-align: inherit;">De fato, aqui 1 √© a vers√£o principal, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% dep.Module_Build.build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© menor e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© patch. </font><font style="vertical-align: inherit;">a prepara√ß√£o √© uma tag de pr√©-lan√ßamento.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.Env</font></font></h3><br>
<img src="https://habrastorage.org/webt/wl/lc/sv/wllcsv3zxji40gzu-p1ef-vlgu4.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao adicionar um novo m√≥dulo, apenas a configura√ß√£o para sua implementa√ß√£o √© adicionada e o valor da vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><i><font style="vertical-align: inherit;">indicado</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todas as outras vari√°veis ‚Äã‚Äãs√£o herdadas dos projetos pais. </font><font style="vertical-align: inherit;">A vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantModTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para um polvo √© formada a partir de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.2</font></font></h3><br>
<img src="https://habrastorage.org/webt/zt/yx/2q/ztyx2q7ffqxfpwxtsrrol6ojfqy.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implante o pacote principal.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√∫mero da vers√£o mais recente - use a vers√£o mais recente dispon√≠vel para este ambiente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Etiqueta do inquilino - etiqueta do cliente / organiza√ß√£o. </font><font style="vertical-align: inherit;">Mais detalhes na se√ß√£o de polvo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par√¢metros cli adicionais. </font><font style="vertical-align: inherit;">Aqui, indicamos o canal em que nosso pacote cair√°, bem como par√¢metros adicionais. </font><font style="vertical-align: inherit;">Isso tamb√©m ser√° discutido separadamente na se√ß√£o de polvos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implantar.3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como Deploy.2, apenas um pacote de m√≥dulo individual √© implantado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implantar.4</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta etapa tamb√©m ser√° descrita em detalhes abaixo, porque recebe dados do polvo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As configura√ß√µes para o site da empresa e o m√≥dulo Especial s√£o constru√≠das com o mesmo princ√≠pio, e os principais pontos nelas s√£o os mesmos, portanto, n√£o vejo o objetivo de descrev√™-las nos mesmos detalhes. Eles s√£o um, eles n√£o precisam ser implantados muitas vezes e, de fato, h√° restaura√ß√£o de pepitas, transforma√ß√£o de texto, msbuild, envio de polvo, lan√ßamento de polvo, lan√ßamento de polvo + implanta√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saiba mais sobre configura√ß√µes exclusivas. </font><font style="vertical-align: inherit;">Para alguns mods, pode n√£o haver ambientes (por exemplo, teste), eles devem ser implantados em outros servidores ou voc√™ deve definir manualmente o identificador do cliente (fa√ßa a configura√ß√£o b√°sica e altere alguns campos usando o PowerShell). </font><font style="vertical-align: inherit;">Ou seja, eles funcionam com o mesmo princ√≠pio que os m√≥dulos principais. </font><font style="vertical-align: inherit;">Sua singularidade reside no fato de que as etapas s√£o adicionadas / alteradas para eles ou o servidor de implanta√ß√£o √© alterado e elas n√£o se encaixam no modelo, portanto, leva um pouco mais de tempo para cri√°-las. </font><font style="vertical-align: inherit;">Felizmente, existem alguns deles.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teamcity: Resumo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A implementa√ß√£o do teamcity permitiu uma abordagem mais otimizada para o processo de montagem do aplicativo. Agora, leva muito menos tempo: em vez de criar o mesmo c√≥digo a cada vez, criamos uma vez. Tamb√©m fazemos melhor uso do espa√ßo em disco, tr√°fego de rede e tempo de computa√ß√£o. Anteriormente, o n√∫mero de pacotes para implementa√ß√£o (reposit√≥rios com artefatos) era igual ao n√∫mero de m√≥dulos. Cada embalagem pesava aproximadamente 100M na forma compactada. Agora temos o n√∫mero de pacotes um a mais que o n√∫mero de m√≥dulos, com um pacote pesando aproximadamente os mesmos 100M e o restante cerca de 500K. Al√©m de uma interface mais amig√°vel, logs convenientes e, o mais importante - reduzindo o tempo para manter o sistema de compila√ß√£o e adicionar configura√ß√µes. Agora, a adi√ß√£o de um novo m√≥dulo leva de 15 minutos a meia hora.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Separadamente, deve-se dizer sobre os modelos, pois √© a padroniza√ß√£o que nos permite economizar tempo na cria√ß√£o de novas configura√ß√µes e em sua manuten√ß√£o posterior. Todas as configura√ß√µes para interagir com o polvo (implantar) s√£o constru√≠das com base em um √∫nico modelo. Em primeiro lugar, permite unificar e, portanto, simplificar o processo. Em segundo lugar, como j√° mencionado, economiza tempo adicionando novas configura√ß√µes: conectamos um modelo, alteramos uma vari√°vel e √© isso. E o mais importante, os modelos simplificam a manuten√ß√£o. Todas as altera√ß√µes feitas no modelo s√£o herdadas por configura√ß√µes baseadas nele. Portanto, se precisarmos adicionar uma etapa a todas as configura√ß√µes de uma s√≥ vez, n√£o precisamos clicar em todas, basta adicionar essa etapa ao modelo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturalmente, o processo de configura√ß√£o da cidade da equipe andava de m√£os dadas com a configura√ß√£o do polvo. </font><font style="vertical-align: inherit;">√â simplesmente imposs√≠vel descrever em paralelo no texto, pois h√° uma grande chance de confus√£o. </font><font style="vertical-align: inherit;">Portanto, a descri√ß√£o foi compartilhada e, nesta parte, apenas as etapas para o fornecimento de IC s√£o descritas. </font><font style="vertical-align: inherit;">O processo de instala√ß√£o do polvo ser√° descrito a seguir.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt496332/index.html">Antidron: reflex√£o de ataques de UAV e quadrocopter</a></li>
<li><a href="../pt496334/index.html">Dell U4919DW Review: Monitor de tela curvada ultra-larga de 49 polegadas</a></li>
<li><a href="../pt496336/index.html">Para que servem os medidores inteligentes?</a></li>
<li><a href="../pt496338/index.html">Crise e √© isso</a></li>
<li><a href="../pt496340/index.html">Treinamos uma rede competitiva entre gera√ß√µes para desenhar imagens no Azure ML</a></li>
<li><a href="../pt496344/index.html">Os hackathons online de quarentena s√£o o momento certo?</a></li>
<li><a href="../pt496346/index.html">Adicionamos uma verifica√ß√£o de hash do rootkit hunter no script di√°rio</a></li>
<li><a href="../pt496348/index.html">Estudos de caso da API de armazenamento na Web</a></li>
<li><a href="../pt496350/index.html">Voc√™ n√£o passar√°! - Impressoras 3D respondem ao coronav√≠rus</a></li>
<li><a href="../pt496354/index.html">Programa√ß√£o tern√°ria: brinque com o emulador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>