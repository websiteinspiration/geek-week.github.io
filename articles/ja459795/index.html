<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😩 🕴🏻 👼🏻 BitrixとMariaDBを最新の安定バージョンに更新 🧖 🏻 👆🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、親愛なるカブロフキアン！自己紹介させてください、アレクサンダー。小さいながらも誇り高いWEBスタジオのシステム管理者。私たちは、すべてが迅速に、安全に、そして新しいソフトウェアで動作することを本当に望んでいます。これを行うために、彼らはオフィスのコンピューターでnagios + Phan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>BitrixとMariaDBを最新の安定バージョンに更新</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459795/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、親愛なるカブロフキアン！自己紹介させてください、アレクサンダー。小さいながらも誇り高いWEBスタジオのシステム管理者。私たちは、すべてが迅速に、安全に、そして新しいソフトウェアで動作することを本当に望んでいます。これを行うために、彼らはオフィスのコンピューターでnagios + PhantomJSの束を発生させ、30分ごとにページの読み込み速度をチェックしました。利用規約に従って、1C-Bitrixのアップデートも追跡し、定期的にインストールします。また、次回の更新後、管理パネルに、2019年の夏以降、1C-BitrixがMySQL 5.5での動作を停止し、更新する必要があることを示すメッセージが表示されます。 ISPSystemの人たちはハンサムで、定期的にパネルの機能を拡張しています。しかし、今回はすべてのマウスをクリックすることはできませんでした。しかし、何が起こったのか、そして現在私のひげに白髪がどれだけあるのかは、カットの下にあります。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dockerコンテナーに配置される「代替DBMSサーバー」を配置するオプションのみがありました。</font><font style="vertical-align: inherit;">もちろん、私はDockerが非常にリソース効率が良いことを理解していますが、それがどれほどクールであっても、オーバーヘッドは依然として0を超えます。</font><font style="vertical-align: inherit;">そして、ここでは10分の1秒で戦います。入り口では、すべてのサイトを最適化してから、契約を発行して署名します。</font><font style="vertical-align: inherit;">したがって、これは私の選択肢ではありません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
わかりました、ドキュメントには何が書かれていますか？</font><font style="vertical-align: inherit;">合計をバックアップし、yum.repos.dのMariaDBリポジトリへのリンクを含むファイルを追加します。</font></font><br>
<br>
<pre><code class="bash hljs">rpm -e --nodeps MariaDB-server MariaDB-client MariaDB-common</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yumはその後、誰かが知らないうちにパッケージを削除またはインストールしたことを誓います。</font><font style="vertical-align: inherit;">しかし、最初に-彼に誓ってもらいましょう、それは大丈夫です。</font><font style="vertical-align: inherit;">次に、yumを介して削除を行うと、MariaDBに関連するすべてのものを破棄しようとします。これは、PHP、ISPManager、およびPHPmyadminです。</font><font style="vertical-align: inherit;">そのため、落書きを扱っております。</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
yum clean all<font></font>
yum update<font></font>
yum install MariaDB-server MariaDB-client MariaDB-common</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、すべてがセットアップされ、巻き取られました。いいことは、ベースが拾われて、それらをダンプから復元する必要がなかったことです。私はサイトをチェックしました-それらはすぐに機能します。私はいくつかの管理ページに行き、何も落ちないことを確認し、すべてが問題ないことをディレクターに書いた。 30分も経たないうちに、それでも大丈夫ではないことが</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
わかりました。管理パネルに移動して何かを追加または編集しようとすると、コンテンツにメッセージが表示されました</font></font><br>
<br>
<pre><code class="sql hljs">MySQL Query Error: <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> b_iblock_element_property (<span class="hljs-keyword">ID</span>, IBLOCK_ELEMENT_ID, IBLOCK_PROPERTY_ID, VAL UE, VALUE_NUM) <span class="hljs-keyword">SELECT</span> <span class="hljs-number">10555</span> ,<span class="hljs-number">2201</span> ,P.ID ,<span class="hljs-string">'3607'</span> ,<span class="hljs-number">3607.0000</span> FR OM b_iblock_property P <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">ID</span> = <span class="hljs-number">184</span> [[<span class="hljs-number">1062</span>] <span class="hljs-keyword">Duplicate</span> entry <span class="hljs-string">'10555'</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">key</span> <span class="hljs-string">'PRIMARY'</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
従業員がサイトにコンテンツを追加しているため、クライアントはまだ何も知らず、まだ私たちを引き裂き始めていませんでした。しかし、サイトの情報を更新する必要があるので、それは時間の問題でした。そして、これは多くのクライアントが彼ら自身と密接にフォローしているものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーテキストから、Bitrixはデータベースに新しいレコードを追加しようとしているが、編集された記事と同じ主キーを示していると結論付けることができます。したがって、問題がBitrix側で発生していると疑う理由があります。私たちは彼らのウェブサイトに行き、サポートに向かいます。ほとんどすぐに、「難しい問題です。上級エンジニアに渡した-ちょっと待ってください...」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は長い間待たなければならず（ダイアログ全体が2019年6月25日から2019年9月7日まで行われました）、その結果、「この問題はBitrix CMSの作業とは関係ありませんが、mariadb 10.4.6のデータベース自体と、残念ながらサイトの側では、この問題は解決できません。MariaDBの古いバージョンにアップグレードする必要はありません。」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らが到着しました...話の冒頭でダウングレードを考えましたが、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここでは白黒で言います</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウングレードできないこと。ダンプをマージし、クリーンインストールされたサーバーに再度展開します。それら。一度にすべてのサーバーを更新しなかったのは良いことです。それら。 「ただ」百のサイト（緊張した笑い:-)）。彼らはまた、サポートで次のように述べています。</font></font><br>
<br>
<pre><code class="sql hljs">$DB-&gt;Query("<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">".$strTable."</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">ID</span> = <span class="hljs-string">".$res["</span><span class="hljs-keyword">ID</span><span class="hljs-string">"]);
$results = $DB-&gt;Query("</span><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-string">".$strTable."</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">ID</span> = <span class="hljs-string">".$res["</span><span class="hljs-keyword">ID</span><span class="hljs-string">"]);”</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MariaDBサポートとのコミュニケーションが始まってから数時間は暖かくなっていると思いますが、その後、私が商用ユーザーではないため、私が意図的に問題を解決する人はいないことを正しく伝える手紙が届きましたが、彼らのWebサイトにフォーラムがあり、そこでオプションを探すことができました...詳細は退屈しません。そこにオプションはありません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
約！ ISPのライセンスを購入しました！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -こんにちは、サポート？みんな、助けて！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -申し訳ありませんが、DBMSのネイティブバージョンを変更する問題をサポートしていません。あなたが欲しい-dockerに代替サーバーのオプションがあります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -しかし、ユーザーとデータベースはどのようにして到達するのでしょうか。ドッカーに？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -まあ、あなたは手でそれらをそこにドラッグします...</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - はい！</font><font style="vertical-align: inherit;">また、mysqlのポートが変更され、すべての構成を確認して書き直す必要があることを忘れないでください。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -わかりました。ありがとう、私は考えます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ペンで10.4を解体し、他のサーバーで問題がなかった10.2を置くことにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロセスは、更新プロセスとそれほど変わらない。</font><font style="vertical-align: inherit;">リポジトリへのリンクで10.4を10.2に変更し、リセットしてyumのキャッシュを再作成する必要がありました。</font><font style="vertical-align: inherit;">さて、もう1つの「ささいなこと」：10.4を削除した後、/ var / lib / mysqlに移動してそこからすべてを削除します。</font><font style="vertical-align: inherit;">この手順がないと、10.2をインストールした後、サービスが常に低下し、</font></font><br>
<br>
<pre><code class="bash hljs">      <span class="hljs-string">''</span> Lost connection to MySQL server at <span class="hljs-string">'reading initial communication packet'</span>, system error: 104 <span class="hljs-string">"Connection reset by peer"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または</font></font><br>
<br>
<pre><code class="bash hljs">Lost connection to MySQL server at <span class="hljs-string">'handshake: reading inital communication packet'</span>, system error: 104</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースをインポートする前に、ISP構成に登録されているmysqlのルートパスワードを設定し、mysqlデータベースダンプをインポートしました。</font><font style="vertical-align: inherit;">それでは、ユーザーと権限が既にあるので、ルートアカウントを使用して、すべてのユーザーベースを続けてインポートします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースダンプのスクリプトテキスト：</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'show databases'</span> | mysql -u root --password=<span class="hljs-string">"_"</span> --skip-column-names | grep -v information_schema | xargs -I {} -t bash -c <span class="hljs-string">'mysqldump -u root --password="_" {} | gzip &gt; /BACK/back-$(hostname)-{}-$(date +%Y-%m-%d-%H.%M.%S).sql.gz'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースをインポートする前に、データベースを解凍する必要があります。</font><font style="vertical-align: inherit;">したがって、コマンドを実行するだけです</font></font><br>
<br>
<pre><code class="bash hljs">gunzip /BACK/*.gz</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後：何らかの理由で、データベース名にハイフンを使用できます（ISPmanagerを使用して作成する場合）。ただし、データベース内のダンプを作成するか、名前にハイフンを入力しようとすると、クエリ構文が正しくないというメッセージが表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての祝福を最後まで読んでください。コンマが配置されていない可能性が高いため、お詫び申し上げます。記載されている内容の本質についての希望/提案がある場合-コメントで何かを見逃すのを恐れているので、個人的なメッセージを書いてください。そして、大したことはしないでください-これは私の最初の記事です:-) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD1：私は</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんど言及するのを忘れていました：MariaDBをダウングレードせずに問題の解決策を見つけようとしていたときに、どういうわけか情報を更新する必要がありました。データベース全体がInnoDBからMyISAMに変換され、情報が更新されてから、InooDBに変換されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD2：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1C-Bitrixから次の内容の手紙が届きました。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改訂のためのアプリケーションが実装され</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、「情報ブロック要素の保存中にエラーが発生しました10.4.6にmariadbをアップデートした後、」</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IBLOCK、バージョン：不明なモジュール</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソリューション：拒否します</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> したがって、10.4に更新することは明らかに不可能ですが、:-(</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja459775/index.html">12のスタートアップで働いた後に機械学習について学んだこと</a></li>
<li><a href="../ja459785/index.html">深層学習：概要</a></li>
<li><a href="../ja459787/index.html">C ++、型が定義されているかどうか：必要なオブジェクトの予備宣言</a></li>
<li><a href="../ja459789/index.html">ARM64アーキテクチャとの互換性のためのUnity Androidプロジェクトの更新</a></li>
<li><a href="../ja459793/index.html">コードに意味のある名前を付ける方法</a></li>
<li><a href="../ja459797/index.html">「N-nadaメガネ？」または「ジオプター付きの既製の中国製メガネの危険性は何ですか？」</a></li>
<li><a href="../ja459798/index.html">Snom D335-ワイドスクリーンTFTカラーディスプレイを備えた多機能IP電話</a></li>
<li><a href="../ja459800/index.html">フォトツアー：ITMO大学光学博物館</a></li>
<li><a href="../ja459802/index.html">Habr Weekly＃9 /若者のバーンアウト、日本のインターフェース、Battle.netニューラルネットワーク、ゲーム、残酷さ</a></li>
<li><a href="../ja459804/index.html">WordPress + shMapperでクラウドソーシングヘルプカードを作成する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>