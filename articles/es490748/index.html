<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèΩ üêÇ ‚ôªÔ∏è La tarea para el desarrollador, o c√≥mo escaneamos esc√°neres manuales sin un proveedor ü¶í üôéüèª ‚úçüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos. 
 
 Nosotros, Victor Antipov e Ilya Aleshin, hoy hablaremos sobre nuestra experiencia con dispositivos USB a trav√©s de Python PyUSB y un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>La tarea para el desarrollador, o c√≥mo escaneamos esc√°neres manuales sin un proveedor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/490748/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola a todos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosotros, Victor Antipov e Ilya Aleshin, hoy hablaremos sobre nuestra experiencia con dispositivos USB a trav√©s de Python PyUSB y un poco sobre ingenier√≠a inversa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/ux/va/j4uxvafzrna4qe-37a6miqsyg1u.jpeg"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antecedentes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2019, entr√≥ en vigencia el Decreto del Gobierno de la Federaci√≥n de Rusia No. 224 ‚ÄúSobre la aprobaci√≥n de las reglas para etiquetar productos de tabaco mediante identificaci√≥n y los detalles de la introducci√≥n de un sistema de informaci√≥n estatal para monitorear la circulaci√≥n de productos sujetos a etiquetado obligatorio mediante identificaci√≥n en relaci√≥n con productos de tabaco‚Äù. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El documento explica que a partir del 1 de julio de 2019, los fabricantes deben etiquetar cada paquete de tabaco. Y los distribuidores directos deben recibir estos productos con el dise√±o de un documento de transferencia universal (UPD). Las tiendas, a su vez, deben registrar la venta de productos etiquetados a trav√©s de la caja registradora.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, desde el 1 de julio de 2020, los productos de tabaco sin marcar est√°n prohibidos. Esto significa que todos los paquetes de cigarrillos deben estar etiquetados con un c√≥digo de barras especial Datamatrix. Y, un punto importante, result√≥ que Datamatrix no ser√° ordinario, sino inverso. Es decir, no un c√≥digo negro sobre blanco, sino viceversa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probamos nuestros esc√°neres, y result√≥ que la mayor√≠a de ellos necesitan ser renovados / reentrenados, de lo contrario, simplemente no pueden funcionar normalmente con este c√≥digo de barras. Este giro de los acontecimientos nos garantiz√≥ un fuerte dolor de cabeza, porque nuestra compa√±√≠a tiene muchas tiendas dispersas en un vasto territorio. Varias decenas de miles de cajas, y muy poco tiempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cual era la tarea asignada? </font><font style="vertical-align: inherit;">Hay dos opciones </font><font style="vertical-align: inherit;">Primero: los ingenieros de la instalaci√≥n actualizan y ajustan manualmente los esc√°neres. </font><font style="vertical-align: inherit;">Segundo: trabajamos de forma remota y, preferiblemente, cubrimos muchos esc√°neres a la vez en una sola iteraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera opci√≥n, obviamente, no nos conven√≠a: tendr√≠amos que gastar dinero en viajes de campo de ingenieros, y en este caso es dif√≠cil controlar y coordinar el proceso. </font><font style="vertical-align: inherit;">Pero lo m√°s importante es que las personas trabajar√≠an, es decir, potencialmente obtendr√≠amos muchos errores y, lo m√°s probable, no se ajustar√≠a a la fecha l√≠mite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda opci√≥n es buena para todos, si no para uno pero. </font><font style="vertical-align: inherit;">Algunos proveedores no ten√≠an las herramientas de flasheo remoto que necesit√°bamos para todos los sistemas operativos requeridos. </font><font style="vertical-align: inherit;">Y como se acababan los plazos, tuve que pensar con la cabeza.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, describiremos c√≥mo desarrollamos herramientas para esc√°neres port√°tiles para el sistema operativo Debian 9.x (tenemos toda la taquilla de Debian).</font></font><br>
<br>
<h3> :   </h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dice Victor Antipov.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La utilidad oficial proporcionada por el proveedor funciona en Windows, y solo con IE. La utilidad puede flashear y configurar el esc√°ner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como el sistema de destino es Debian, instalamos el servidor usb-redirector en el servidor Debian y el cliente usb-redirector en Windows. Usando las utilidades del redireccionador usb, el esc√°ner fue reenviado desde la m√°quina Linux a la m√°quina Windows. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La utilidad del proveedor de Windows vio el esc√°ner e incluso lo flashe√≥ normalmente. Por lo tanto, se hizo la primera conclusi√≥n: nada depende del sistema operativo, el asunto est√° en el protocolo de actualizaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OKAY. Se inici√≥ un flasheo en una m√°quina con Windows y se elimin√≥ un volcado en una m√°quina con Linux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metieron el basurero en WireShark y ... estaban tristes (omitir√© parte de los detalles del basurero, no son de inter√©s). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qu√© volcado nos mostr√≥:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5c/ut/sa/5cutsausebu86kbucq6rfksz7wu.png"><br>
<br>
<img src="https://habrastorage.org/webt/9z/ex/jo/9zexjowdglq6cjc88ln5r6tlkcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las direcciones 0000-0030, a juzgar por Wireshark, son informaci√≥n de servicio USB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√°bamos interesados ‚Äã‚Äãen la parte 0040-0070. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nada estaba claro en una trama de transmisi√≥n, excepto los caracteres MOCFT. Estos s√≠mbolos resultaron ser s√≠mbolos del archivo de firmware, as√≠ como el resto de los s√≠mbolos hasta el final del marco (el archivo de firmware est√° resaltado): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/ls/mf/yblsmf2htqk4n-lsa3u702yy5vm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© significaban los s√≠mbolos fd 3e 02 01 fe? Personalmente, como Ilya, no ten√≠a idea. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mir√© el siguiente cuadro (la informaci√≥n de servicio se elimina aqu√≠, el archivo de firmware se resalta): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/sr/ut/r3srutakf1ioytxspf1zurv9pww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© qued√≥ claro? Que los dos primeros bytes son alg√∫n tipo de constante. Todos los bloques posteriores confirmaron esto, pero antes del final del bloque de transmisi√≥n:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/t6/ux/j7t6uxe8auhqxaxp5azeolv5jwm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este marco tambi√©n entr√≥ en un estupor, ya que la constante cambi√≥ (resaltada) y, curiosamente, hab√≠a una parte del archivo. El tama√±o de los bytes transmitidos del archivo indic√≥ que se transfirieron 1024 bytes. Qu√© significaban los bytes restantes: no lo sab√≠a de nuevo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, como un antiguo apodo de BBS, revis√© los protocolos de transferencia est√°ndar. 1024 bytes, no se aprob√≥ ning√∫n protocolo. Comenz√≥ a estudiar el material y se top√≥ con el protocolo 1K Xmodem. Permiti√≥ transmitir 1024, pero con un matiz: al principio solo 128, y solo en ausencia de errores, el protocolo aument√≥ el n√∫mero de bytes transmitidos. Inmediatamente tuve una transmisi√≥n de 1024 bytes. Decid√≠ estudiar los protocolos de transmisi√≥n, y espec√≠ficamente el m√≥dem X. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubo dos variaciones del m√≥dem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, el formato del paquete XMODEM con soporte CRC8 (XMODEM original):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/dq/7w/wudq7w7yg59duxo2ok3rcng5bga.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En segundo lugar, el formato de paquete XMODEM con soporte CRC16 (XmodemCRC): se </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i2/cz/j3/i2czj3nd212vhlbms9uqrysd5xa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ve similar, con la excepci√≥n de SOH, n√∫mero de paquete y CRC y la longitud del paquete. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mir√© el comienzo del segundo bloque de transmisi√≥n (y nuevamente vi el archivo de firmware, pero con una sangr√≠a de 1024 bytes):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/lk/nb/5vlknbhbecr2d3d7uigb19dh_cg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vi el encabezado familiar fd 3e 02, pero los siguientes dos bytes ya han cambiado: era 01 fe y se convirti√≥ en 02 fd. Entonces not√© que el segundo bloque ahora est√° numerado 02 y as√≠ entend√≠: frente a m√≠ est√° la numeraci√≥n del bloque de transmisi√≥n. La primera transmisi√≥n 1024 es 01, la segunda 02, la tercera 03 y as√≠ sucesivamente (pero en hexadecimal, por supuesto). Pero, ¬øqu√© significa el cambio de fe a fd? Los ojos vieron una disminuci√≥n de 1, el cerebro record√≥ que los programadores cuentan desde 0, no desde 1. Pero entonces, ¬øpor qu√© el primer bloque es 1, no 0? No encontr√© la respuesta a esta pregunta. Pero entend√≠ c√≥mo se considera el segundo bloque. El segundo bloque no es m√°s que FF - (menos) el n√∫mero del primer bloque. Por lo tanto, el segundo bloque se design√≥ como = 02 (FF-02) = 02 FD. La lectura posterior del basurero confirm√≥ mi presentimiento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, la siguiente imagen del programa comenz√≥ a surgir: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El comienzo del programa.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 3e 02 - Inicio </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01 FE - contador de transmisi√≥n </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transmisi√≥n (se transmiten 34 bloques, 1024 bytes) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 3e 1024 bytes de datos (divididos en bloques de 30 bytes). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fin de la transmisi√≥n </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 25 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Restos de datos para alinear a 1024 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo se ve la trama final de la transferencia de bloque?: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/ee/t9/dmeet9sttaokhdirciuxag4p9y4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fd 25 - se√±al al final de la transferencia de bloque. Siguiente 2f 52: los restos del archivo de hasta 1024 bytes. 2f 52, a juzgar por el protocolo, es una suma de verificaci√≥n CRC de 16 bits.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basado en la memoria anterior, hice un programa en C que extra√≠a 1024 bytes de un archivo y le√≠a CRC de 16 bits. </font><font style="vertical-align: inherit;">El lanzamiento del programa mostr√≥ que este no es un CRC de 16 bits. </font><font style="vertical-align: inherit;">De nuevo estupor, durante unos tres d√≠as. </font><font style="vertical-align: inherit;">Todo este tiempo intent√© entender qu√© podr√≠a ser si no fuera una suma de verificaci√≥n. </font><font style="vertical-align: inherit;">Al estudiar sitios en ingl√©s, descubr√≠ que el m√≥dem X utiliza su propio c√°lculo de suma de comprobaci√≥n: CRC-CCITT (XModem). </font><font style="vertical-align: inherit;">No encontr√© ninguna implementaci√≥n en C para este c√°lculo, pero encontr√© un sitio que lee esta suma de verificaci√≥n en l√≠nea. </font><font style="vertical-align: inherit;">Al subir 1024 bytes de mi archivo a la p√°gina web, el sitio me mostr√≥ una suma de verificaci√≥n que coincid√≠a completamente con la suma de verificaci√≥n del archivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Hurra! </font><font style="vertical-align: inherit;">El √∫ltimo enigma est√° resuelto, ahora ten√≠a que hacer su propio firmware. </font><font style="vertical-align: inherit;">Luego transfir√≠ mi conocimiento (y se quedaron solo en mi cabeza) a Ilya, quien est√° familiarizado con herramientas poderosas: Python.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creaci√≥n de programa</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Narrado por Ilya Aleshin. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habiendo recibido las instrucciones apropiadas, estaba muy "feliz". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øD√≥nde empezar? </font><font style="vertical-align: inherit;">Desde el principio. </font><font style="vertical-align: inherit;">ÔÅä Por volcar desde un puerto USB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecute USB-pcap </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://desowin.org/usbpcap/tour.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Elija el puerto al que est√° conectado el dispositivo y el archivo donde guardaremos el volcado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/ax/xp/gaaxxp3qdqajous7didfd7gwkg8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conectamos el esc√°ner a la m√°quina donde est√° instalado el software nativo EZConfigScanning para Windows. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ol/oo/le/olooleeirgestw3q0gzvhqvzr58.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En √©l encontramos el punto de enviar comandos al dispositivo. </font><font style="vertical-align: inherit;">¬øPero qu√© hay de los equipos? </font><font style="vertical-align: inherit;">¬øD√≥nde conseguirlos? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se inicia el programa, el equipo se interroga autom√°ticamente (lo veremos un poco m√°s adelante). </font><font style="vertical-align: inherit;">Y hab√≠a c√≥digos de barras de capacitaci√≥n de los documentos oficiales del equipo. </font><font style="vertical-align: inherit;">DEFALT. </font><font style="vertical-align: inherit;">Este es nuestro equipo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/dv/gf/8vdvgfiuthogftttgzdsxym22_4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se reciben los datos necesarios. </font><font style="vertical-align: inherit;">Abra dump.pcap a trav√©s de wireshark.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bloquear al iniciar EZConfigScanning. Los puntos rojos son lugares a los que prestar atenci√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/ju/0x/wpju0xwxz9_hgex0jnnyttjxqpa.png"><br>
<br>
<img src="https://habrastorage.org/webt/nw/6s/so/nw6ssotdpggn37qvn9kvayxhxde.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al ver todo esto por primera vez, me desanim√©. D√≥nde cavar m√°s lejos no est√° claro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un poco de lluvia de ideas y-y-y ... ¬°Aj√°! En un basurero, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afuera</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adentro</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adentro</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afuera</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Busqu√© en Google qu√© es URB_INTERRUPT. Descubr√≠ que este es un m√©todo de transferencia de datos. Y hay 4 de estos m√©todos: control, interrupci√≥n, is√≥crono, a granel. Puedes leer sobre ellos por separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y las direcciones de punto final en la interfaz del dispositivo USB se pueden obtener a trav√©s del comando ‚Äúlsusb ‚Äìv‚Äù o mediante pyusb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora necesita encontrar todos los dispositivos con este VID. Puede buscar espec√≠ficamente por VID: PID. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/xp/i_/fnxpi_m69b43p6yzpeoh3atps0q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se parece a esto:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g0/h4/td/g0h4tdpscytduyzmj4xqe31r5s4.png"><br>
<br>
<img src="https://habrastorage.org/webt/d4/wf/5k/d4wf5k6asqr5nvofve-ntd5sm4g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, tenemos la informaci√≥n necesaria: comandos P_INFO. o DEFALT, direcciones donde escribir los comandos endpoint = 03 y d√≥nde obtener el endpoint de respuesta = 86. Solo queda traducir los comandos en hexadecimal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/wf/ui/iowfuid0hhvl6q6zpb9kfds3tny.png"><br>
<br>
<img src="https://habrastorage.org/webt/0p/gr/2j/0pgr2jw1u6tj5vqetitjg3g6chw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya encontramos el dispositivo, descon√©ctelo del n√∫cleo ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/xy/84/jixy849fy7l81g9tenjxpf7uymo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... y escriba en el punto final con la direcci√≥n 0x03, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/v0/nt/qxv0nttjmnddvekfmbnfq9vebfi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... y luego lea la respuesta del punto final con la direcci√≥n 0x86. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kj/xn/e2/kjxne2x9ab6spmxnk2ac3bnroc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Respuesta estructurada:</font></font><br>
<br>
<pre><code class="plaintext hljs">P_INFOfmt: 1<font></font>
mode: app<font></font>
app-present: 1<font></font>
boot-present: 1<font></font>
hw-sn: 18072B44CA<font></font>
hw-rev: 0x20<font></font>
cbl: 4<font></font>
app-sw-rev: CP000116BBA<font></font>
boot-sw-rev: CP000014BAD<font></font>
flash: 3<font></font>
app-m_name: Voyager 1450g<font></font>
boot-m_name: Voyager 1450g<font></font>
app-p_name: 1450g<font></font>
boot-p_name: 1450g<font></font>
boot-time: 16:56:02<font></font>
boot-date: Oct 16 2014<font></font>
app-time: 08:49:30<font></font>
app-date: Mar 25 2019<font></font>
app-compat: 289<font></font>
boot-compat: 288<font></font>
csum: 0x6986</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos estos datos en dump.pcap. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cr/z5/2y/crz52y_j0alhcohhokmry0bx7t8.png"><br>
<br>
<img src="https://habrastorage.org/webt/-s/np/cv/-snpcv4opok9jdsrj8thkshno_4.png"><br>
<br>
<img src="https://habrastorage.org/webt/qj/dq/zl/qjdqzlcwogon9yts12p5awr32ha.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Multa! Traducimos los c√≥digos de barras del sistema a hexadecimal. Todo, la funcionalidad de entrenamiento est√° lista. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© hacer con el firmware? Parece que todo es igual, pero hay un matiz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habiendo eliminado un volcado completo del proceso de flasheo, entendimos aproximadamente a qu√© nos enfrentamos. Aqu√≠ hay un art√≠culo sobre XMODEM que realmente ayud√≥ a entender c√≥mo ocurre esta comunicaci√≥n, aunque en t√©rminos generales: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://microsin.net/adminstuff/others/xmodem-protocol-overview.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recomiendo leerlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si observa el volcado, puede ver que el tama√±o de trama es 1024 y el tama√±o de los datos URB es 64. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/o6/uj/wio6ujyvlj_bnltlngxf24k9evk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, 1024/64, obtenemos 16 l√≠neas en un bloque, leemos el archivo de firmware por 1 car√°cter y formamos un bloque. Complementando 1 l√≠nea en un bloque con caracteres especiales fd3e02 + n√∫mero de bloque.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las siguientes 14 l√≠neas se complementan con fd25 +, usando XMODEM.calc_crc () calculamos la suma de verificaci√≥n de todo el bloque (tom√≥ mucho tiempo entender que "FF - 1" es CSUM) y la √∫ltima l√≠nea 16 se complementa con fd3e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que todo, lea el archivo de firmware, golpee los bloques, desconecte el esc√°ner del n√∫cleo y env√≠elo al dispositivo. </font><font style="vertical-align: inherit;">Pero no tan simple. </font><font style="vertical-align: inherit;">El esc√°ner debe ponerse en modo firmware </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
envi√°ndolo NEWAPP = '\\ xfd \\ x0a \\ x16 \\ x4e \\ x2c \\ x4e \\ x45 \\ x57 \\ x41 \\ x50 \\ x50 \\ x0d'. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øDe d√≥nde viene este comando? </font><font style="vertical-align: inherit;">Del basurero. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/au/sd/nd/ausdnd16ikur6ajzdiyk9-ntklw.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no podemos enviar todo el bloque al esc√°ner debido a la restricci√≥n de 64: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/db/k6/qg/dbk6qgrapgsxiwdo9jyxqd0svwu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, el esc√°ner en el modo de parpadeo NEWAPP tampoco acepta hexadecimal. </font><font style="vertical-align: inherit;">Por lo tanto, es necesario traducir cada l√≠nea bytes_array</font></font><br>
<br>
<pre><code class="plaintext hljs">[253, 10, 22, 78, 44, 78, 69, 87, 65, 80, 80, 13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ya env√≠a estos datos al esc√°ner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obtenemos la respuesta:</font></font><br>
<br>
<pre><code class="plaintext hljs">[2, 1, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si revisa el art√≠culo sobre XMODEM, queda claro: los datos han sido aceptados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/fd/gj/pofdgjvcgns7oxdeonuldkqbptg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de que se hayan transferido todos los bloques, completamos la transferencia END_TRANSFER = '\ xfd \ x01 \ x04'. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, dado que estos bloques no contienen ninguna informaci√≥n para la gente com√∫n, haremos el firmware en modo oculto de forma predeterminada. </font><font style="vertical-align: inherit;">Y por si acaso, a trav√©s de tqdm organizaremos una barra de progreso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/da/18/g1/da18g1axnll2zps9qpx2s7opkha.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, el resto es peque√±o. </font><font style="vertical-align: inherit;">Solo queda envolver la soluci√≥n en scripts para la replicaci√≥n masiva en un momento claramente definido, a fin de no ralentizar el proceso de trabajo en la taquilla y agregar el registro.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de pasar mucho tiempo, energ√≠a </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y cabello en la cabeza</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pudimos desarrollar las soluciones que necesit√°bamos, adem√°s, cumplimos con la fecha l√≠mite. </font><font style="vertical-align: inherit;">Al mismo tiempo, los esc√°neres se actualizan y se vuelven a entrenar ahora de forma centralizada, controlamos claramente todo el proceso. </font><font style="vertical-align: inherit;">La compa√±√≠a ahorr√≥ tiempo y dinero, y obtuvimos una experiencia invaluable en ingenier√≠a inversa de este tipo de equipos.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es490736/index.html">9 herramientas claras para aprender y aprender vocabulario en ingl√©s</a></li>
<li><a href="../es490738/index.html">Principio de sustituci√≥n de Lisk</a></li>
<li><a href="../es490740/index.html">Defectuoso *** s no es solo aleatorizaci√≥n</a></li>
<li><a href="../es490742/index.html">Una nueva era en rob√≥tica ha comenzado</a></li>
<li><a href="../es490746/index.html">Calificaci√≥n en Yandex.Taxi: una breve publicaci√≥n sobre un tema serio</a></li>
<li><a href="../es490750/index.html">Mikhail Salosin. Golang Meetup. Usando Go en el backend de la aplicaci√≥n Watch +</a></li>
<li><a href="../es490754/index.html">Visual Studio Code Code Editor. La gu√≠a m√°s detallada para configurar e instalar complementos para principiantes</a></li>
<li><a href="../es490756/index.html">Implementar Jenkins como c√≥digo</a></li>
<li><a href="../es490758/index.html">Los matem√°ticos han demostrado la ley universal de la turbulencia.</a></li>
<li><a href="../es490760/index.html">Ray Casting Visual Search (RCVS). Algoritmo simple y r√°pido para encontrar modelos 3D similares en geometr√≠a</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>