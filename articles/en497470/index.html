<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÉ üêº üë©üèæ‚Äçü§ù‚Äçüë®üèº How to Eject Viruses on the Corona SDK ‚úçüèΩ üê∑ üë®üèø‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="$google = "We don't allow apps that lack reasonable sensitivity towards or capitalize on a natural disaster, atrocity, conflict, death, or other tragi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to Eject Viruses on the Corona SDK</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497470/"><img src="https://habrastorage.org/webt/l5/r8/no/l5r8nopjzn53ujgynqarl2utjee.png" alt="image"><br>
<br>
<pre><code class="php hljs">$google = <span class="hljs-string">"We don't allow apps that lack reasonable sensitivity towards or capitalize on a natural disaster, atrocity, conflict, death, or other tragic event"</span>;<font></font>
mysql_query(<span class="hljs-string">"UPDATE cvirus_users SET winners = winners+19, message='$google' WHERE imea='$imea' "</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No panic guys, the article is not contagious! </font><font style="vertical-align: inherit;">In addition, its author died last year. </font><font style="vertical-align: inherit;">There is nothing to do in the next world, except to write and publish games yourself-know-where. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No more than 7 users per day are cut into fresh games. </font><font style="vertical-align: inherit;">None of them are able to overcome the magic bar. </font><font style="vertical-align: inherit;">The devils also laugh, - Weak to make a game so that more than 7 people stick to it? </font><font style="vertical-align: inherit;">Say a thousand? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I had to try.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How did the idea come</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not in the bathroom this time, but in the development process. </font><font style="vertical-align: inherit;">Two new games were card games, one - three-dimensional BlockOut II (veterans remember), three more on blocks (yatzee and doodo) and, attention, a couple of puzzle for the battle of emoticons against the crown viruses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last two ideas were born thanks to the animated stickers sent to me by the Telegram bot. </font><font style="vertical-align: inherit;">Emoticons hid from funny viruses in them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In one of the games a bug crawled out, which at first amazed me, then made me laugh, and then it turned out to be a good application of an unknown genre. </font><font style="vertical-align: inherit;">Conclusion - write carelessly, bots.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Engine</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It's been about 3 years since I got hooked on the Corona SDK. </font><font style="vertical-align: inherit;">I managed to write three-dimensional games on it and even was on the staff of the company, but in 2018 all the loafers were dispersed, and the engine went to open-source. </font><font style="vertical-align: inherit;">Let me remind you that the Corona SDK is a cross-platform 45 (see hex value) engine for all mobile phones, desktops and HTML5.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Look inside</font></font></b>
                        <div class="spoiler_text">   , , ,      . <i></i> :    11- iPhone       .     Xcode-&gt;Window-&gt;Devices-&gt;Drug and Drop.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, gentlemen, the engine is very smart for development, the prototype of the game is done in a couple of hours, then as many days of grinding and the product is ready. </font><font style="vertical-align: inherit;">For comparison, the publication on Habr√© took </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twice </font></font></s> <s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">three times</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> four times more time.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Art</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I repeat, I took the pictures from the animated stickers in the Telegram - there they are stored in tgs format, in fact it is renamed gzip, it is unzipped to a json file and looks something like this:</font></font><br>
<br>
<pre><code class="json hljs">{<span class="hljs-attr">"tgs"</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">"v"</span>:<span class="hljs-string">"5.5.2"</span>,<span class="hljs-attr">"fr"</span>:<span class="hljs-number">60</span>,<span class="hljs-attr">"ip"</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">"op"</span>:<span class="hljs-number">180</span>,<span class="hljs-attr">"w"</span>:<span class="hljs-number">512</span>,<span class="hljs-attr">"h"</span>:<span class="hljs-number">512</span>,<span class="hljs-attr">"nm"</span>:<span class="hljs-string">"05_STAYHOME_OUT"</span>,<span class="hljs-attr">"ddd"</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">"assets"</span>:[{<span class="hljs-attr">"id"</span>:<span class="hljs-string">"comp_0"</span>,<span class="hljs-attr">"layers"</span>:[{<span class="hljs-attr">"ddd"</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">"ind"</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">"ty"</span>:<span class="hljs-number">3</span>,<span class="hljs-attr">"nm"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In haste, I began to invent my own program for rendering json, but, having burned myself, I spat on the Internet. </font><font style="vertical-align: inherit;">And I received in response a telegram bot #GIF Export Bot, which converts tgs-stickers into a GIF file. </font><font style="vertical-align: inherit;">God, how old I am, I remember GIFs and still so small ... Each GIF stores about 100-200 frames of 512x512 in size. </font><font style="vertical-align: inherit;">GIMP.app is launched on the GIF, then the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scale, transform</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , well, you know, the main thing is not to get stuck on editing the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/-y/hf/yj-yhf68-5egfrkfued7zthrwpg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's one of the negative characters. </font><font style="vertical-align: inherit;">Coronovirus - fucking off ... (c) Slepakov.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game and physics</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Corona SDK has a magical, incredible box2D engine. </font><font style="vertical-align: inherit;">Watch how the playing field and co-viruses are written on it</font></font><br>
<br>
<pre><code class="lua hljs"> physics.start() <font></font>
 physics.setGravity( <span class="hljs-number">0</span>, <span class="hljs-number">0</span> )<font></font>
 physics.addBody( downBox, <span class="hljs-string">"static"</span>, {shape=rect }  )<font></font>
 physics.addBody( cvirus, <span class="hljs-string">"dynamic"</span>, {shape=octogon,  density=<span class="hljs-number">2</span>, <font></font>
          friction=<span class="hljs-number">1</span>, bounce=<span class="hljs-number">0.2</span> } )<font></font>
 physics.setGravity( <span class="hljs-number">0</span>, <span class="hljs-number">9.8</span> )<font></font>
<font></font>
<span class="hljs-comment">--  </span><font></font>
<font></font>
 physics.stop() <font></font>
<font></font>
<span class="hljs-comment">--     </span><font></font>
<font></font>
 </code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basically, I have nothing to add to this piece of code - you all understand. </font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game idea itself</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remember the hit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">There (in the field of gravity), panda bears and mommy separate colored cubes. </font><font style="vertical-align: inherit;">They need to be killed (cubes, not bears), but they nasty multiply like the heads of a Lirnean hydra and do not want to join the Panda gang.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panda Gangs</font></font></b>
                        <div class="spoiler_text">     .      . <br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the colored cubes in this game are located on a uniform orthogonal regular grid. </font><font style="vertical-align: inherit;">About five years ago, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was a bestseller, even I wrote a remix of Hex Rabbit to her. </font><font style="vertical-align: inherit;">On the same grid, only hexagonal and with the same pandas, only rabbits. </font><font style="vertical-align: inherit;">I was surprised that rabbits are still being driven - seven (damn you!) People.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And if you check?</font></font></b>
                        <div class="spoiler_text">     ,   Apple    <i></i>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hex-rabbits then painted for me by the artist Andryukha Chesnokov. </font><font style="vertical-align: inherit;">Bright memory to him. </font><font style="vertical-align: inherit;">Although he is alive, thank God, move on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So? </font><font style="vertical-align: inherit;">Tell me, why do you need a net in this panda game? </font><font style="vertical-align: inherit;">Take it away, add physics. </font><font style="vertical-align: inherit;">We replace the evil cubes with </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">octagonal squares</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (forgive me Professor Ponomarev and analytic geometry) and turn the gang of pandas into koloboks. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Co-viruses against co-pubis. </font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It‚Äôs indecent, but funny. </font><font style="vertical-align: inherit;">I drive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">koloboks for the</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> second week, I wait when I'm tired. </font><font style="vertical-align: inherit;">Thanks to self-isolation, enough time.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug physics</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Corona has a corresponding function for debugging physics, like this</font></font><br>
<br>
<pre><code class="lua hljs"> physics.setDrawMode( <span class="hljs-string">"debug"</span> )  
 </code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this mode, elements of the physical world are schematically depicted. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/yk/hh/reykhh4jdu36lqec8aej1jn4yva.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, there was a jamb - the glass walls were initially set not very high (three screens) and at some levels the buns fell out. </font><font style="vertical-align: inherit;">I wondered - where did they go? </font><font style="vertical-align: inherit;">Probably still fly to the center of the Earth ... Although no, most likely they have already flown taking into account the air resistance K_ {air} = 0.75. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Turn off debug mode</font></font><br>
<br>
<pre><code class="lua hljs"><span class="hljs-comment">--  physics.setDrawMode( "debug" )  </span>
 </code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and we get art </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a5/ya/aj/a5yaajqrettxllc3bavptuzk5pc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I admit to you, as an artist to an artist - I limited the animation of sprites to two frames - added the blinking of the heroes, and I'm good. </font><font style="vertical-align: inherit;">Let Kisa Vorobyaninov draw, I personally - pass.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Level editor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The buttons on the level selection screen were drawn by myself, in the coronavirus style. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w0/hi/6z/w0hi6zah8np2uriauc9tmreflrc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, he determined 12 levels, thinking of gradually increasing the number of co-viruses and rabbits on the blackboard, which are #anobolics. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He reasoned like this: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the first two levels, only 2 types of villains live. Green is the most dangerous (c) DMB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the next two - more complicated, 3 types of villains live. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then - 4 species. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Five - the planet cannot be saved. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sh (G) is - an imposible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With pleasure I rushed to debug the game and after 24 hours I noticed boredom at levels with 5 or 6 types of monsters. It is difficult to think.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What to do? Oh, I took the skis, went outside, returned, replaced the skis with sticks and ran into the forest. At the 19th minute of the run, the brains started and I abruptly realized - I would add horizontal sticks to the field of play! By type of partitions in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">open-space</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . So </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">open-space</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a rare muck in life, but in a game it's normal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Things went - everything was breathing, each level began to demonstrate its character, pulse and temperature. You check too! I mean, the temperature ... The number of playing fields in this setting, you know, is infinite. But counting. I limited myself to a dozen levels and attracted a dunce-third-grader son to debugging, putting one of the fifth iPhone in his hand. And he is happy, there is something to do in the video lesson. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voila, the lessons are done, the levels are debugged and named places on the planet</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A land</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> where I felt good. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And it would be nice to save these places</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Now I‚Äôm not joking.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More geometry</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Who said the heroes of the game are octagons? </font><font style="vertical-align: inherit;">I added squares, hexagons, circles, pentagons. </font><font style="vertical-align: inherit;">In honor of professors Dubrovsky, Mishchenko and Fomenko. </font><font style="vertical-align: inherit;">Diff </font><font style="vertical-align: inherit;">The geometry of the viruses markedly changed the mood of the game. </font><font style="vertical-align: inherit;">See for yourself. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wx/kw/qq/wxkwqq6m7c-pggk5ijdw3o2bcoe.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And you can make koloboks square. </font><font style="vertical-align: inherit;">Russian folk bun and will not tolerate it. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/im/ew/g5/imewg56rmpr3okwf-01gakxqecu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oh! </font><font style="vertical-align: inherit;">Where did the viruses go? </font><font style="vertical-align: inherit;">Removed ... Google takes the brutal seriousness of the word </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viruses, infected, cured</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... I had to edit the meta-data, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">co-viruses</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> became </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colored monsters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">everyone died</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">try again</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parallel replaced Telegram-pictures. </font><font style="vertical-align: inherit;">Eh, eh, forgive Pavel Durov, irony and laughter will not save the world.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mistakes, bored without them</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Box2D sometimes crashed by mistake in the onGlobalCollision function. Especially on real devices, that is, iPhones. It's funny, but I have not a single Android in the house, and the application is in Google Play ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The code looks extremely simple, but it breaks like a girl. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I turn off the sound - it does not break. Does the girl come out deaf? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We look at the code:</font></font><br>
<br>
<pre><code class="lua hljs">
<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onGlobalCollision</span><span class="hljs-params">( event )</span></span>
  <span class="hljs-keyword">if</span> ( event.phase == <span class="hljs-string">"began"</span> ) <span class="hljs-keyword">then</span><font></font>
<font></font>
    <span class="hljs-keyword">local</span> ball = event.object1
    <span class="hljs-keyword">local</span> u, v = ball:getLinearVelocity()
    <span class="hljs-keyword">local</span> speed = u*u + v*v
<span class="hljs-comment">--    print( "speed: " .. speed  )</span>
     <span class="hljs-keyword">if</span> speed&gt;<span class="hljs-number">10000</span> <span class="hljs-keyword">then</span>
       <span class="hljs-keyword">if</span> speed&lt;<span class="hljs-number">20000</span> <span class="hljs-keyword">then</span><font></font>
         audio.play( rockSound )<font></font>
       <span class="hljs-keyword">else</span><font></font>
         audio.play( woodenSound )<font></font>
       <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You see, in the onGlobalCollision function I catch collisions of koloboks and lose 2 types of sounds from collisions. </font><font style="vertical-align: inherit;">So, at some levels the </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sine was equal to two</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , more than 500 objects collided at the same time (or at the same time? Grishkovets). </font><font style="vertical-align: inherit;">At this rare moment, when calling </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sounds</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inside </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collision</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a terrible </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> occurs </font><font style="vertical-align: inherit;">in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runtime</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;kznm! </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Don't turn off the sound, right? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to fix? </font><font style="vertical-align: inherit;">Decided not to call </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">play (sound)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directly </font><font style="vertical-align: inherit;">from the </font><i><font style="vertical-align: inherit;">onGlobalCollision</font></i><font style="vertical-align: inherit;"> function</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and accumulate the number of collisions in the variables boom1 and boom2. </font><font style="vertical-align: inherit;">Then in the runTimeLoop cycle (this function is called in the game 10 times per second, don‚Äôt understand why) check boom1 and boom2 and play the sound if necessary.</font></font><br>
<br>
<pre><code class="lua hljs">       <span class="hljs-keyword">if</span> boom1&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">then</span><font></font>
          audio.play( rockSound )<font></font>
          boom1=<span class="hljs-number">0</span>
       <span class="hljs-keyword">end</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The error disappeared, but the sound became unpleasantly rhythmic (it is understandable, 10 times per second) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then I just entered a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time-delay</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> noise. </font><font style="vertical-align: inherit;">A random delay of 100 milliseconds - and oppa! </font><font style="vertical-align: inherit;">everything began to sound very natural:</font></font><br>
<br>
<pre><code class="lua hljs">
<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">play1</span><span class="hljs-params">()</span></span><font></font>
  audio.play( rockSound )<font></font>
<span class="hljs-keyword">end</span><font></font>
<font></font>
<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">play2</span><span class="hljs-params">()</span></span><font></font>
  audio.play( woodenSound )<font></font>
<span class="hljs-keyword">end</span><font></font>
<font></font>
<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">playSound</span><span class="hljs-params">()</span></span>
  <span class="hljs-keyword">local</span> t = <span class="hljs-built_in">math</span>.<span class="hljs-built_in">random</span>(<span class="hljs-number">100</span>)
  <span class="hljs-keyword">if</span> boom1&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
    boom1=<span class="hljs-number">0</span><font></font>
    timer.performWithDelay(t, play1)<font></font>
  <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">if</span> boom2&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
    boom2=<span class="hljs-number">0</span><font></font>
    timer.performWithDelay(t, play2)<font></font>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span><font></font>
  <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Handsomely? </font><font style="vertical-align: inherit;">Who is well done? </font><font style="vertical-align: inherit;">I know, I know, you yourself would do that.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Play and YouTube</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I prepared screenshots and shot a video for youtube, the author is behind the piano. </font><font style="vertical-align: inherit;">It looks slowed down, but I‚Äôm such in life, this can‚Äôt be fixed:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OyQecfICU1U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The video was recorded by the native poppy program </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QuickTime.app</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">For the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apple store, the</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> received video needs to be edited (set the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frame-rate</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to 30). </font><font style="vertical-align: inherit;">For this, I usually use the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handBrake.app</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> application </font><font style="vertical-align: inherit;">, I highly recommend it.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server, no way without it</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interest in the game is fueled by distance competition. The best results are stored on the server. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masterhost</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a separate pain, why the heck they are ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Okay, forget the insult ... On the server I store the best results of the day and rank the players. Players, of course, want to be the first and take the Cup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Every midnight (MSK timezone), the high score table on the server is reset and the day King turns into a night Pumpkin. You turns Kings into bergers ... Good song. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The winner of the day goes to the Hall of Fame, a new battle ensues for the next Cup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How did the backend? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Created 4 mysql tables: cvirus_users, cvirus_events, cvirus_today, cvirus_ticks. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The cvirus_ticks table has only one entry and two </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">day</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font><i><font style="vertical-align: inherit;">tick</font></i><font style="vertical-align: inherit;"> fields</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Now I realized that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tick</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field </font><font style="vertical-align: inherit;">is superfluous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Every midnight, the entry in the table is checked against the current date and updated as follows.</font></font><br>
<br>
<pre><code class="php hljs">    $new_day_flag = <span class="hljs-number">0</span>;<font></font>
    $day = date(<span class="hljs-string">"d"</span>);  <span class="hljs-comment">//  </span>
    $result = mysql_query(<span class="hljs-string">"SELECT * FROM cvirus_ticks LIMIT 1 "</span>);
    <span class="hljs-keyword">if</span> ($row = mysql_fetch_array($result)) {<font></font>
      $d=$row[<span class="hljs-string">'day'</span>];
      <span class="hljs-keyword">if</span> ($day&lt;&gt;$d) {<font></font>
         $new_day_flag = $day;<font></font>
      }<font></font>
    } <font></font>
<font></font>
    <span class="hljs-keyword">if</span> ($newday &lt;&gt; <span class="hljs-number">0</span>) {<font></font>
      mysql_query( <span class="hljs-string">"UPDATE cvirus_ticks SET day = '$new_day_flag', tick = tick + 1 "</span>);<font></font>
    } <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the script is triggered, all the results of the players are recorded in the cvirus_today table with the updated </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tick</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tag </font><font style="vertical-align: inherit;">. Thus, the cvirus_today table stores player records sorted by day. Losers can see who became the winner in previous days. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is interesting to observe the geography of users - for this I pull out his IP address from the player‚Äôs request, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etch the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> address to </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">api.wipmania.com</font></a><font style="vertical-align: inherit;"> , in return I get the country‚Äôs domain name (for example, RU or UA) and show the RU.PNG or UA.PNG flag opposite the player‚Äôs name. In some games, the geography of users is impressive and thought-provoking. But we will not indulge in travel dreams (what kind of geography is in self-isolation mode ?!), but look at the php-example how to turn ip -&gt; country</font></font><br>
<br>
<pre><code class="php hljs">$ipAddress = $_SERVER[<span class="hljs-string">'REMOTE_ADDR'</span>];<font></font>
$ipCode = file_get_contents(<span class="hljs-string">'http://api.wipmania.com/'</span> . $ipAddress . <span class="hljs-string">'?k=3g-Y6QrmGQ7'</span>);
 <span class="hljs-keyword">if</span> (strlen($ipCode)!=<span class="hljs-number">2</span>) $ipCode = <span class="hljs-string">'HN'</span>;  <span class="hljs-comment">// - )</span>
</code></pre> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We don't allow apps that lack reasonable sensitivity towards or capitalize on a natural disaster, atrocity, conflict, death, or other tragic event. </font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is not me, this is Google-UFO ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of used links</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meanwhile, in the Play the Google </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of N-th</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 12th day waiting check my poor game. </font><font style="vertical-align: inherit;">Just one - without a host, without advertising, without support. </font><font style="vertical-align: inherit;">But I do not cry. </font><font style="vertical-align: inherit;">I have already replaced words, pictures and sounds in it. </font><font style="vertical-align: inherit;">And thanks to Google, it got better, in addition, I fixed a couple of irregularities. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the result is a game on Google Play. </font><font style="vertical-align: inherit;">No ads and no price. </font><font style="vertical-align: inherit;">I have long understood that the time of casual loners is gone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, remind me, son, </font><font style="vertical-align: inherit;">you can‚Äôt give </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">download links</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">And then you turn into an evil Pinocchio, twice a scoundrel (a scoundrel + a scoundrel) and a villain, right?</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link to download</font></font></b>
                        <div class="spoiler_text">! ?!<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, who just did not ban me for it is not known what - Google banned, Apple - banned, Habr - banned twice ... In times there were. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But I'm not discouraged - I‚Äôm sitting at home, fixing a stove, eating buckwheat. </font><font style="vertical-align: inherit;">What for bought so much?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML5 saves everyone</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-Let me, but what about h </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ml5 version? </font><font style="vertical-align: inherit;">Where is the vaunted cross-platform? - the attentive reader will exclaim. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And be right, Github is in his hand. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let me remind you that on Github each user has the opportunity to keep one free site - I spent this chance for the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">web version of the game</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I warn you, d-design is old, uncensored. </font><font style="vertical-align: inherit;">Nervous (and without humor), please do not run.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tell me, wise guys</font></font></b>
                        <div class="spoiler_text">,  remote web- (   ) -         . ,     .htaccess   Access-Control-Allow-Origin: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">papabubadiop.github.io</a>,     .     ‚Äî , .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I almost forgot! </font><font style="vertical-align: inherit;">There was another browser error. </font><font style="vertical-align: inherit;">When starting the game in Safari, he received a dozen identical messages / warnings</font></font><br>
<br>
<pre><code class="perl hljs">libpng warning: iCCP: CRC error
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The error is not critical (you press OK ten times and play), but unpleasant. </font><font style="vertical-align: inherit;">The Internet claims that the GIMP image editor is to blame. </font><font style="vertical-align: inherit;">It is b-free and saves PNG files with the wrong color palette checksum. </font><font style="vertical-align: inherit;">Online tips didn't help</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uncheck envelope</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- no, it doesn't work. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He fixed the problem stupidly - he opened all PNG files in the Preview application (Mac OS system application for viewing and editing all types of files), made Flip twice and closed it. </font><font style="vertical-align: inherit;">All pictures are resaved in the correct format. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhaps some of the readers may get other bugs, well, I'm not holy </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HelloWorld</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , I code quickly and carelessly. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Write about errors in the comments, we will.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Epilogue</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I wish your families good health. </font><font style="vertical-align: inherit;">To you, the reader - patience. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS All typos - intentional, do not write in PM.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497452/index.html">CLion News: 2020.1 Release, Five-Year IDE, and Online Q & A</a></li>
<li><a href="../en497456/index.html">Spring animations in Vue</a></li>
<li><a href="../en497460/index.html">Streetsview in 2000</a></li>
<li><a href="../en497466/index.html">Sysbench and the distribution of random variables</a></li>
<li><a href="../en497468/index.html">[Master class] Practical attacks on the USB interface</a></li>
<li><a href="../en497476/index.html">Top 8 JavaScript Data Structures</a></li>
<li><a href="../en497478/index.html">Network simulator tutorial ns-3. Chapter 4</a></li>
<li><a href="../en497480/index.html">Video Lectures: unix way</a></li>
<li><a href="../en497482/index.html">Authentication in Kubernetes with Dex: fasten LDAP</a></li>
<li><a href="../en497484/index.html">Using ML Algorithms to Classify Multipage Documents: VTB Experience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>