<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄºÔ∏è üë©üèº‚Äçüíº üç≠ Thanos - Prometeo escalable üëÇüèæ ü§õüèΩ ‚ùáÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La traducci√≥n del art√≠culo fue preparada espec√≠ficamente para estudiantes del curso "Pr√°cticas y herramientas de DevOps" .
 
 
 
  (Fabian Reinartz) ‚Äî...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Thanos - Prometeo escalable</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/502122/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La traducci√≥n del art√≠culo fue preparada espec√≠ficamente para estudiantes del curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pr√°cticas y herramientas de DevOps"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/hn/yb/6z/hnyb6zs1kjgdaigpvcdypntr4yo.png"><br>
<hr><br>
<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  (Fabian Reinartz)</a> ‚Äî   ,  Go     .    Prometheus   Kubernetes SIG instrumentation.     production-  SoundCloud      CoreOS.      Google.<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  (Bartek Plotka)</a> ‚Äî    Improbable.       .      Intel,    Mesos  production- SRE    Improbable.    .   : Golang, open source  .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al observar nuestro producto insignia SpatialOS, puede adivinar que Improbable necesita una infraestructura de nube global altamente din√°mica con docenas de cl√∫steres de Kubernetes. Fuimos uno de los primeros en usar el sistema de monitoreo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Prometheus es capaz de rastrear millones de m√©tricas en tiempo real y viene con un poderoso lenguaje de consulta para recuperar la informaci√≥n necesaria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplicidad y confiabilidad Prometheus es una de sus principales ventajas. Sin embargo, despu√©s de pasar una cierta escala, encontramos varios inconvenientes. Para resolver estos problemas, desarrollamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Un proyecto de c√≥digo abierto creado por Improbable para transformar sin problemas los cl√∫steres Prometheus existentes en un √∫nico sistema de monitoreo con un dep√≥sito ilimitado de datos hist√≥ricos. </font><font style="vertical-align: inherit;">Thanos est√° disponible en github </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mant√©ngase al d√≠a con las √∫ltimas noticias de Improbable.</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuestros objetivos con Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cierta escala, surgen problemas que van m√°s all√° de las capacidades del Prometheus de vainilla. </font><font style="vertical-align: inherit;">¬øC√≥mo almacenar de forma confiable y econ√≥mica petabytes de datos hist√≥ricos? </font><font style="vertical-align: inherit;">¬øSe puede hacer esto sin perjuicio del tiempo de respuesta a la solicitud? </font><font style="vertical-align: inherit;">¬øEs posible acceder a todas las m√©tricas ubicadas en diferentes servidores Prometheus con una sola solicitud de API? </font><font style="vertical-align: inherit;">¬øEs posible combinar de alguna manera los datos replicados recopilados con Prometheus HA? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para abordar estos problemas, creamos Thanos. </font><font style="vertical-align: inherit;">Las siguientes secciones describen c√≥mo abordamos estos problemas y explicamos los objetivos que perseguimos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulta de datos de m√∫ltiples instancias de Prometheus (consulta global)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus ofrece un enfoque funcional para fragmentar. Incluso un servidor Prometheus proporciona escalabilidad suficiente para liberar a los usuarios de las dificultades de fragmentaci√≥n horizontal en casi todos los casos de uso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque este es un excelente modelo de implementaci√≥n, a menudo se requiere para acceder a datos en diferentes servidores Prometheus a trav√©s de una √∫nica API o UI: vista global. Por supuesto, es posible mostrar varias solicitudes en un panel de Grafana, pero cada solicitud solo se puede ejecutar en un servidor Prometheus. Con Thanos, por otro lado, puede consultar y agregar datos de m√∫ltiples servidores Prometheus, ya que todos son accesibles desde un punto final. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente, para obtener una visi√≥n global de Improbable, organizamos nuestras instancias de Prometheus en un nivel m√∫ltiple</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Federaci√≥n jer√°rquica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Esto signific√≥ crear un meta servidor Prometheus que recolecta parte de las m√©tricas de cada servidor hoja, lo </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pv/0j/w3/pv0jw3yhsdl31rqexmamjdx4tiy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
que result√≥ ser problem√°tico, complicando la configuraci√≥n, agregando un punto potencial de falla adicional y aplicando reglas complejas para proporcionar al punto final federado los datos correctos. Adem√°s, la federaci√≥n de este tipo no le permite obtener una vista global real, ya que no se puede acceder a todos los datos desde una solicitud de API.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estrechamente relacionado con esto est√° la presentaci√≥n √∫nica de los datos recopilados en los servidores de alta disponibilidad (HA) de Prometheus. El modelo Prometheus HA recolecta datos de forma independiente dos veces, lo cual es tan simple que no podr√≠a ser m√°s simple. Sin embargo, usar una representaci√≥n combinada y deduplicada de ambos hilos ser√≠a mucho m√°s conveniente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, existe la necesidad de servidores Prometheus de alta disponibilidad. En Improbable, nos tomamos muy en serio el monitoreo de datos cada minuto, pero tener una instancia de Prometheus por cl√∫ster es un punto √∫nico de falla. Cualquier error de configuraci√≥n o falla de hardware puede resultar en la p√©rdida de datos importantes. Incluso las implementaciones simples pueden provocar fallas menores en la recopilaci√≥n de m√©tricas, ya que el reinicio puede ser significativamente m√°s largo que el intervalo de raspado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Almacenamiento confiable de datos hist√≥ricos</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El almacenamiento de m√©tricas barato, r√°pido y a largo plazo es nuestro sue√±o (compartido por la mayor√≠a de los usuarios de Prometheus). </font><font style="vertical-align: inherit;">En Improbable, nos vimos obligados a establecer el per√≠odo de almacenamiento para las m√©tricas en nueve d√≠as (para Prometheus 1.8). </font><font style="vertical-align: inherit;">Esto agrega limitaciones obvias a lo lejos que podemos mirar hacia atr√°s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus 2.0 es mejor en este aspecto, ya que el n√∫mero de series de tiempo ya no afecta el rendimiento general del servidor (vea la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nota clave de KubeCon sobre Prometheus 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Sin embargo, Prometheus almacena datos en un disco local. </font><font style="vertical-align: inherit;">Aunque la compresi√≥n de datos altamente eficiente puede reducir significativamente el uso de un SSD local, todav√≠a hay una limitaci√≥n en la cantidad de datos hist√≥ricos que se guardan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Improbable, tambi√©n nos preocupamos por la fiabilidad, la simplicidad y el costo. </font><font style="vertical-align: inherit;">Las unidades locales grandes son m√°s dif√≠ciles de operar y realizar copias de seguridad. </font><font style="vertical-align: inherit;">Son m√°s caros y requieren m√°s herramientas de respaldo, lo que conduce a una complejidad innecesaria.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desmuestreo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tan pronto como comenzamos a trabajar con datos hist√≥ricos, nos dimos cuenta de que existen dificultades fundamentales con O-big que hacen que las consultas sean cada vez m√°s lentas si trabajamos con datos durante semanas, meses y a√±os. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La soluci√≥n est√°ndar a este problema ser√° la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disminuci√≥n de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muestreo, la disminuci√≥n de la se√±al. </font><font style="vertical-align: inherit;">Al reducir el muestreo, podemos "reducir" a un rango de tiempo mayor y mantener el mismo n√∫mero de muestras, lo que nos permite mantener la capacidad de respuesta de las solicitudes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La disminuci√≥n de datos antiguos es un requisito inevitable de cualquier soluci√≥n de almacenamiento a largo plazo y va m√°s all√° de Prometheus.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetivos adicionales</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uno de los objetivos iniciales del proyecto Thanos era integrarse perfectamente con cualquier instalaci√≥n Prometheus existente. </font><font style="vertical-align: inherit;">El segundo objetivo era una operaci√≥n simple con una barrera de entrada m√≠nima. </font><font style="vertical-align: inherit;">Cualquier dependencia debe satisfacerse f√°cilmente para usuarios peque√±os y grandes, lo que tambi√©n implica un bajo costo base.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitectura Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de que nuestros objetivos se enumeraron en la secci√≥n anterior, trabajemos en ellos y veamos c√≥mo Thanos resuelve estos problemas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vista global</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obtener una vista global sobre las instancias existentes de Prometheus, necesitamos asociar un √∫nico punto de entrada de solicitud con todos los servidores. Esto es exactamente lo que hace el componente Thanos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sidecar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se implementa junto a cada servidor Prometheus y act√∫a como un proxy, y sirve datos locales de Prometheus a trav√©s de la interfaz gRPC de la Tienda, lo que le permite seleccionar datos de series de tiempo por etiqueta y rango de tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por otro lado, hay un componente Querier escalable horizontalmente sin estado que hace un poco m√°s que responder a las solicitudes de PromQL a trav√©s de la API HTTP Prometheus est√°ndar. Los componentes Querier, Sidecar y otros Thanos se comunican a trav√©s </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">del protocolo de chismes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1p/zn/ts/1pzntsrxrwhxxvdou57tpxhypwm.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al recibir una solicitud, Querier se conecta al servidor API de la tienda correspondiente, es decir, a nuestro Sidecar, y recibe datos de series temporales de los servidores Prometheus correspondientes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de eso, combina las respuestas y realiza una consulta PromQL sobre ellas. </font><font style="vertical-align: inherit;">Querier puede combinar tanto datos disjuntos como datos duplicados de servidores Prometheus HA.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto resuelve la mayor parte de nuestro rompecabezas, combinando datos de servidores Prometheus aislados en una sola vista. </font><font style="vertical-align: inherit;">De hecho, Thanos solo puede usarse para esta oportunidad. </font><font style="vertical-align: inherit;">¬°Los servidores Prometheus existentes no necesitan hacer ning√∫n cambio!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Vida √∫til ilimitada!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, tarde o temprano querremos guardar datos que vayan m√°s all√° del tiempo de almacenamiento normal de Prometheus. Para almacenar datos hist√≥ricos, hemos elegido el almacenamiento de objetos. Est√° ampliamente disponible en cualquier nube, as√≠ como en centros de datos locales y es muy econ√≥mico. Adem√°s, se puede acceder a casi cualquier almacenamiento de objetos a trav√©s de la conocida API S3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus escribe datos desde la RAM en el disco aproximadamente cada dos horas. El bloque de datos almacenados contiene todos los datos durante un per√≠odo fijo de tiempo y es inmutable. Esto es muy conveniente, porque Thanos Sidecar puede simplemente mirar el cat√°logo de datos de Prometheus y, a medida que aparecen nuevos bloques, cargarlos en los dep√≥sitos de almacenamiento de objetos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ss/l6/lh/ssl6lhmk5kyfwe0luqcsbpe8z9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La descarga al almacenamiento de objetos inmediatamente despu√©s de escribir en un disco tambi√©n le permite mantener la simplicidad de un "raspador" (Prometheus y Thanos Sidecar). Lo que simplifica el soporte, el costo y el dise√±o del sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, la copia de seguridad de los datos es muy simple. ¬øPero qu√© pasa con la consulta de datos en el almacenamiento de objetos? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El componente Thanos Store act√∫a como un proxy para recuperar datos del almacenamiento de objetos. Al igual que Thanos Sidecar, participa en el cl√∫ster de chismes e implementa la API de la tienda. Por lo tanto, el Querier existente puede considerarlo como Sidecar, como otra fuente de datos de series temporales: no se requiere una configuraci√≥n especial.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/n_/pl/vqn_pl2z-oq1-m1yiix-y-tgvwc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los bloques de datos de series temporales est√°n formados por varios archivos grandes. Descargarlos a pedido ser√≠a bastante ineficiente, y el almacenamiento en cach√© local requer√≠a una gran memoria y espacio en disco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cambio, Store Gateway sabe c√≥mo manejar el formato de almacenamiento Prometheus. Gracias al ingenioso planificador de consultas y al almacenamiento en cach√© de solo las partes de √≠ndice necesarias de los bloques, fue posible reducir las consultas complejas al m√≠nimo n√∫mero de solicitudes HTTP para objetar archivos de almacenamiento. Por lo tanto, es posible reducir el n√∫mero de solicitudes de cuatro a seis √≥rdenes de magnitud y lograr tiempos de respuesta que generalmente son dif√≠ciles de distinguir de las solicitudes de datos en un SSD local.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/c-/hv/qxc-hvkg1llfi9oaoee6uxtla9c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se muestra en el diagrama anterior, Thanos Querier reduce significativamente el costo de una sola solicitud de datos en el almacenamiento de objetos mediante el uso del formato de almacenamiento Prometheus y colocando los datos relacionados uno al lado del otro. </font><font style="vertical-align: inherit;">Con este enfoque, podemos combinar muchas consultas individuales en un n√∫mero m√≠nimo de operaciones masivas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compactaci√≥n y disminuci√≥n de resoluci√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de que el nuevo bloque de datos de series temporales se haya cargado con √©xito en el almacenamiento de objetos, lo consideramos como datos "hist√≥ricos" que estar√°n disponibles de inmediato a trav√©s de Store Gateway. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, despu√©s de un tiempo, los bloques de una fuente (Prometheus con Sidecar) se acumulan y ya no usan todo el potencial de indexaci√≥n. Para resolver este problema, presentamos otro componente llamado Compactor. Simplemente aplica el mecanismo de compactaci√≥n Prometheus local a los datos hist√≥ricos en el almac√©n de objetos y puede ejecutarse como un simple trabajo por lotes peri√≥dico.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/wt/sy/lpwtsym1qftrslmkks3fre9q2o8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias a la compresi√≥n eficiente, una consulta en el repositorio durante un largo per√≠odo de tiempo no presenta problemas en t√©rminos de tama√±o de datos. Sin embargo, el costo potencial de desempaquetar mil millones de valores y ejecutarlos a trav√©s de un procesador de consultas conducir√° inevitablemente a un fuerte aumento en el tiempo de ejecuci√≥n de consultas. Por otro lado, dado que hay cientos de puntos de datos por p√≠xel de la pantalla, resulta imposible incluso visualizar los datos en resoluci√≥n completa. Por lo tanto, la disminuci√≥n de la resoluci√≥n no solo es posible, sino que no conducir√° a una p√©rdida notable de precisi√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/ju/gh/xmjughzg4svkzo0behzid9tt02s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para datos de disminuci√≥n de muestreo, Compactor agrega datos continuamente con una resoluci√≥n de cinco minutos y una hora. Para cada fragmento sin procesar codificado utilizando la compresi√≥n TSDB XOR, se almacenan varios tipos de datos agregados, como min, max o sum para un bloque. Esto permite a Querier seleccionar autom√°ticamente el agregado adecuado para esta consulta de PromQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar datos con precisi√≥n reducida, el usuario no necesita ninguna configuraci√≥n especial. Querier cambia autom√°ticamente entre diferentes resoluciones y datos sin procesar a medida que el usuario se acerca y aleja. Si lo desea, el usuario puede controlar esto directamente a trav√©s del par√°metro "paso" en la solicitud.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que el costo de almacenar un GB es peque√±o, por defecto Thanos guarda los datos originales, datos con una resoluci√≥n de cinco minutos y una hora. </font><font style="vertical-align: inherit;">No es necesario eliminar los datos originales.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reglas de registro</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso con las reglas de grabaci√≥n de Thanos son una parte esencial de la pila de monitoreo. </font><font style="vertical-align: inherit;">Reducen la complejidad, la latencia y el costo de las solicitudes. </font><font style="vertical-align: inherit;">Tambi√©n son convenientes para que los usuarios obtengan datos m√©tricos agregados. </font><font style="vertical-align: inherit;">Thanos se basa en instancias de vainilla de Prometheus, por lo que es perfectamente aceptable almacenar reglas de grabaci√≥n y reglas de alerta en un servidor Prometheus existente. </font><font style="vertical-align: inherit;">Sin embargo, en algunos casos esto puede no ser suficiente:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alertas y reglas globales (por ejemplo, alertas cuando un servicio est√° inactivo en m√°s de dos de los tres grupos).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regla para datos fuera del almacenamiento local.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El deseo de mantener todas las reglas y alertas en un solo lugar.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/wu/da/bf/wudabfepzgopbamehs1hqzx5s7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para todos estos casos, Thanos incluye un componente separado llamado Regla, que calcula la regla y la alerta a trav√©s de las consultas de Thanos. </font><font style="vertical-align: inherit;">Al proporcionar el conocido StoreAPI, el nodo Consulta puede acceder a m√©tricas reci√©n calculadas. </font><font style="vertical-align: inherit;">M√°s tarde, tambi√©n se almacenan en el almacenamiento de objetos y se ponen a disposici√≥n a trav√©s de Store Gateway.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El poder de Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanos es lo suficientemente flexible como para personalizarlo seg√∫n sus necesidades. </font><font style="vertical-align: inherit;">Esto es especialmente √∫til cuando se migra desde Prometheus simple. </font><font style="vertical-align: inherit;">Echemos un vistazo r√°pido a lo que aprendimos sobre los componentes de Thanos. </font><font style="vertical-align: inherit;">Aqu√≠ le mostramos c√≥mo transferir su Prometheus de vainilla al mundo del "almacenamiento de m√©tricas ilimitado":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d-/y0/cn/d-y0cnjpddmhvlfbw-8c7fvqt7o.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregue Thanos Sidecar a sus servidores Prometheus, por ejemplo, el contenedor adyacente en el pod Kubernetes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expanda m√∫ltiples r√©plicas de Thanos Querier para ver los datos. </font><font style="vertical-align: inherit;">En este punto, es f√°cil configurar chismes entre Scraper y Querier. </font><font style="vertical-align: inherit;">Use la m√©trica 'thanos_cluster_members' para probar las interacciones de los componentes.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Solo estos dos pasos son suficientes para proporcionar una visi√≥n global y una deduplicaci√≥n de datos sin problemas de posibles r√©plicas de Prometheus HA! </font><font style="vertical-align: inherit;">Simplemente conecte sus paneles al punto final HTTP de Querier o use la interfaz de UI de Thanos directamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, si necesita hacer una copia de seguridad de las m√©tricas y el almacenamiento a largo plazo, deber√° realizar tres pasos m√°s:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construye un AWS S3 o GCS Bucket. </font><font style="vertical-align: inherit;">Configure Sidecar para copiar datos a estos dep√≥sitos. </font><font style="vertical-align: inherit;">Ahora puede minimizar el almacenamiento local de datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expanda Store Gateway y con√©ctelo a un cl√∫ster de chismes existente. </font><font style="vertical-align: inherit;">¬°Ahora puede enviar solicitudes de datos en copias de seguridad!</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implemente Compactor para mejorar el rendimiento de las consultas durante largos per√≠odos de tiempo utilizando compactaci√≥n y disminuci√≥n de resoluci√≥n.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea saber m√°s, ¬°no dude en mirar nuestros </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplos de los kubernetes manifiestos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comenzar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En solo cinco pasos, hemos convertido a Prometheus en un sistema de monitoreo confiable con vista global, tiempo de almacenamiento ilimitado y alta disponibilidad potencial de m√©tricas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitud de extracci√≥n: ¬°te necesitamos!</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fue un proyecto de c√≥digo abierto desde el principio. </font><font style="vertical-align: inherit;">La integraci√≥n perfecta con Prometheus y la capacidad de usar solo una parte de Thanos lo convierten en una excelente opci√≥n para escalar un sistema de monitoreo sin ning√∫n esfuerzo adicional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siempre damos la bienvenida a la solicitud y los problemas de GitHub Pull. </font><font style="vertical-align: inherit;">Al mismo tiempo, no dude en contactarnos a trav√©s de Github Issues o slack </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Improbable-eng #thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si tiene preguntas o comentarios, o si desea compartir su experiencia. </font><font style="vertical-align: inherit;">Si te gusta lo que hacemos en Improbable, no dudes en contactarnos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°siempre tenemos vacantes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprende m√°s sobre el curso.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es502104/index.html">El robot secretario, el informante del bot, el terapeuta del bot y otros proyectos del hackathon en l√≠nea VirusHack</a></li>
<li><a href="../es502114/index.html">Juego de motivaciones. Parte 1</a></li>
<li><a href="../es502116/index.html">Descripci√≥n general de las caracter√≠sticas de PVS-Studio versi√≥n 7.07</a></li>
<li><a href="../es502118/index.html">Dise√±o a nivel de sistema. Parte 3: Vincular System Composer y la cadena de herramientas MathWorks</a></li>
<li><a href="../es502120/index.html">Monitoreo remoto y diagn√≥stico de equipos de producci√≥n.</a></li>
<li><a href="../es502124/index.html">Resultados de riesgo de 2019 para Ucrania</a></li>
<li><a href="../es502126/index.html">C√≥mo mejorar tu curr√≠culum de programador de ingl√©s</a></li>
<li><a href="../es502132/index.html">C√≥mo transferir el contenedor OpenVZ 6 al servidor KVM sin dolor de cabeza</a></li>
<li><a href="../es502134/index.html">Lo suficiente como para temer las decisiones subjetivamente hermosas en el c√≥digo: no son robots</a></li>
<li><a href="../es502136/index.html">Compresi√≥n de datos en Apache Ignite. Experiencia Sberbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>