<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🤝‍👩🏻 🏀 🍲 Kami merakit jaringan ZigBee yang paling sederhana, program di bawah Mbed, berkomunikasi melalui MQTT 🙈 😿 🤽🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini adalah lokakarya pelatihan tingkat pemula yang hebat tentang penggunaan modul XBee bersama dengan mikrokontroler yang memiliki Mbed OS. Zi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kami merakit jaringan ZigBee yang paling sederhana, program di bawah Mbed, berkomunikasi melalui MQTT</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/samsung/blog/497200/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel ini adalah lokakarya pelatihan tingkat pemula yang hebat tentang penggunaan modul XBee bersama dengan mikrokontroler yang memiliki Mbed OS. ZigBee adalah standar yang panjang dan berakar kuat dalam sistem Smart Home (misalnya, digunakan bersama dengan Z-Wave di hub Samsung SmartThings, lihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami </font><font style="vertical-align: inherit;">), ini ditandai dengan konsumsi daya yang rendah, kemudahan penggunaan, dan, yang paling menarik, kemampuan untuk membuat jaringan mesh yang dapat dikonfigurasi sendiri. Anda akan melihat dari bengkel bahwa ini memang benar - kita akan melihat struktur jaringan seperti itu melalui utilitas visualizer yang nyaman.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diasumsikan bahwa Anda sudah tahu apa itu ZigBee dan untuk apa ZigBee. </font><font style="vertical-align: inherit;">Sekarang Anda ingin menghubungkan modul-XBee pertama Anda dan menyelesaikan masalah Anda dengannya, tanpa masuk ke pemrograman modul itu sendiri, tetapi hanya menggunakannya sebagai antarmuka komunikasi. </font><font style="vertical-align: inherit;">Pada akhirnya, kami akan mengirim semua data melalui gateway MQTT darurat di mana saja, bahkan ke server lokal, bahkan ke Internet. </font><font style="vertical-align: inherit;">Kami memutuskan untuk menunjukkan semuanya pada contoh Mbed sebagai RTOS yang paling sederhana dan paling mudah diakses. </font><font style="vertical-align: inherit;">Anda akan diyakinkan bahwa semuanya bekerja "di luar kotak", dan Anda dapat segera mulai membuat proyek Anda, bahkan jika sebelumnya Anda hanya berurusan dengan Arduino.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manual akan terdiri dari bagian-bagian berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Koneksi dan konfigurasi modul XBee</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hubungkan modul ke jaringan</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mengkonfigurasi modul tanpa melepaskannya dari perisai</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penerimaan data</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim data</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat gateway MQTT sederhana</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi pertama-tama, daftar komponen: apa yang diinginkan untuk dimiliki untuk melakukan semua hal di atas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponen yang Diperlukan</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dua papan yang kompatibel dengan Mbed. </font><font style="vertical-align: inherit;">Kami merekomendasikan papan pelatihan STM32 Nucleo sebagai relatif murah dan populer untuk tujuan pendidikan. </font><font style="vertical-align: inherit;">Proses pemrograman di sana disederhanakan secara maksimal: kumpulkan program dalam IDE online gratis, unduh firmware yang telah dirakit dan “jatuhkan” ke papan, yang akan muncul dalam sistem sebagai flash drive. </font><font style="vertical-align: inherit;">Apa model spesifik untuk mengambil tidak penting, tetapi jangan mengambil yang tertua, perhatikan jumlah memori. </font><font style="vertical-align: inherit;">Sebagai contoh, F401RE - kami berikan hanya untuk kepastian, sehingga Anda tidak menjadi bingung dalam variasi mereka dan pada awalnya kode alfabet yang tidak dapat dimengerti dari prosesor STM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"> <img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"><br>
</li>
<li> XBee-.      Digi.  «» ,  ,  , MBee,  ,    ,     ,      . /        :      ,      .   /  Pro:      ,      ,   Pro   .<br>
<img src="https://habrastorage.org/webt/r2/ed/ew/r2edew1y1gkdpcw9soz-vunnu9q.png"><img src="https://habrastorage.org/webt/m6/-n/aq/m6-naqf0x0qqrjpj-soxa6aulj0.png"><img src="https://habrastorage.org/webt/t2/x5/ng/t2x5ng0wfuoehd4oujmvhf1spha.png" width="200"><br>
</li>
<li>  XBee Shield V2 ( SeeedStudio).      -     ,        RX  TX XBee-.<br>
<img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Satu konverter USB-UART dengan konektor untuk XBee. </font><font style="vertical-align: inherit;">Diperlukan untuk konfigurasi awal. </font><font style="vertical-align: inherit;">Modul XBee sendiri tidak dilengkapi dengan antarmuka USB (tidak ada hubungannya dengan itu). </font><font style="vertical-align: inherit;">USB diperlukan semata-mata dan secara eksklusif untuk komunikasi antara modul dan komputer, dan di perangkat ini dapat bekerja pada UART yang jauh lebih sederhana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Slot pitch modul XBee adalah 2,0 mm - untuk elektronik itu tidak standar, dalam sistem metrik (kita biasanya terbiasa melihat langkah 2.54 sesuai dengan standar Amerika). </font><font style="vertical-align: inherit;">Oleh karena itu, sayangnya, modul-modul tersebut tidak dimasukkan ke papan tempat memotong roti dan mereka selalu membutuhkan adaptor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adaptor apa pun cocok di sini, kami mengambil yang ini dari Waveshare:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/md/y5/04mdy5mhmm6cfwuj-a21a5eqagy.png" width="300"></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Koneksi dan konfigurasi modul XBee</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal paling sederhana yang dapat Anda lakukan dengan modul adalah menghubungkannya ke komputer secara langsung melalui USB. </font><font style="vertical-align: inherit;">Kami akan segera mendapatkan akses ke parameter konfigurasinya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk bekerja dengan XBee, ada program XCTU resmi. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unduh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan instal. </font><font style="vertical-align: inherit;">Dokumentasi mengatakan bahwa di Ubuntu Anda perlu menambahkan pengguna ke grup </font></font><code>dialout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk bekerja dengan port yang bukan dari pengguna super - lakukan ini jika Anda belum melakukannya:</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -a -G dialout &lt;username&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unduh arsip zip dari tautan, itu akan berisi file </font></font><code>.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Perlu dibuat dapat dieksekusi (melalui </font></font><code>chmod +x _</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di konsol atau: tombol kanan mouse - Properties - Izin) dan jalankan </font></font><code>./40002881_V.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting untuk memulai instalasi bukan dari root (tanpa </font></font><code>sudo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), jika tidak, akan ada masalah nanti. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setup terlihat seperti ini:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/44/kg/iz/44kgizj3bjlvchzakcksvrh1i_u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah instalasi, Anda dapat memulai program dengan menjalankan file </font></font><code>app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di direktori tempat Anda menginstal program (secara default - </font></font><code>~/Digi/XCTU-NG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampilannya adalah sebagai berikut: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/wz/y0/qrwzy0nbyhomwp8g-k26jrluio4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam program ini, Anda dapat menambahkan modul yang ada yang terhubung ke port USB melalui adaptor. Klik pada tombol Discover dengan kaca pembesar. Sebuah jendela muncul meminta Anda untuk memilih port - seperti yang Anda lihat, program mendeteksi port dengan benar dalam sistem </font></font><code>/dev/ttyUSB0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ini adalah adaptor USB-UART kami.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/qr/h1/rsqrh1y2if1z6nr_zl844kdba4o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jendela menyarankan mencentang pencarian. </font><font style="vertical-align: inherit;">Tentu saja, ada godaan untuk memeriksa sekaligus untuk menemukan modul Anda. </font><font style="vertical-align: inherit;">Tetapi kemudian pencarian akan berlangsung untuk waktu yang sangat lama. </font><font style="vertical-align: inherit;">Dalam praktiknya, masuk akal untuk membiarkan kotak dicentang secara default, dan memilih opsi yang paling umum untuk kecepatan transfer data, seperti pada gambar di bawah ini. </font><font style="vertical-align: inherit;">Biasanya, modul baru default ke 9600, dan untuk tujuan pelatihan ini lebih dari cukup, kecepatan di sini tidak penting bagi kami. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l2/dj/ve/l2djvekjunxaxpxesaxo786q3le.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, jika semuanya berhasil, Anda akan diminta untuk memilih modul yang ditemukan: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/dq/le/4zdqledgifvp92zr4lvm6bat2km.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bug kecil diketahui: terkadang modul tidak pada kecepatan non-standar, reset manual modul dengan tombol Reset selama pencarian dan mengatur ulang baud rate ke standar (9600) membantu.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubah parameter modul</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya kami terlibat dalam konfigurasi modul. Sejumlah parameter akan keluar, yang sebagian besar pada awalnya tidak dapat dipahami. Untungnya, hanya sedikit dari mereka yang perlu diubah untuk memulai lebih cepat. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID Jaringan - ID PAN.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kunci jaringan umum, itu harus sama untuk semua perangkat sehingga mereka terhubung secara independen ke jaringan. Masukkan nomor berapapun, dalam kasus kami kami lakukan 42. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t7/dg/lk/t7dglkxhvbkban2romlxiu97qpi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE - Coordinator Diaktifkan.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jika ada 1, maka modul ini bertindak sebagai koordinator. Jika 0, maka modul bertindak sebagai router (Router) - pada kenyataannya, itu hanya memastikan bahwa paket melewati jaringan melalui dirinya sendiri. Kebanyakan host biasanya adalah router. Kami membutuhkan satu koordinator dan dua router di jaringan kami, jadi taruh satu di sini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada juga peran "Perangkat akhir" - ini adalah modul yang tidak melakukan pekerjaan pada transfer paket, tetapi hanya berkomunikasi dengan router lain dan melakukan fungsi yang bermanfaat. Biasanya, dia hanya dalam mode tidur dan bangun pada interval yang ditentukan dan mencari tahu apakah ada pesan. Modul semacam itu dapat ditenagai oleh baterai, sedangkan router dan koordinator harus selalu "online" dan sebagai hasilnya, membutuhkan daya yang konstan untuk mempertahankan seluruh jaringan. Kami tidak akan mempertimbangkan contoh seperti itu sekarang, karena lebih menarik bagi semua orang untuk menetapkan peran router dan mengamati bagaimana jaringan akan secara otomatis mengubah konfigurasinya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/zp/e3/0mzpe3yptscx6la-wummlbiixks.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP - API Aktifkan.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modus operasi. Modul XBee dapat beroperasi dalam dua mode: AT atau API. AT-mode lebih mudah bagi pemula, itu adalah penggantian transparan dari port serial dan bekerja dengan modul melalui AT-command. Namun, mode API jauh lebih kaya dalam fungsi, memungkinkan Anda untuk mengkonfigurasi modul dari jarak jauh, berisi alamat pengirim, mengembalikan status pengiriman paket, dan banyak lagi. Selain itu, perpustakaan untuk berinteraksi dengan XBee menganggap bahwa perangkat tersebut digunakan dalam mode API. Oleh karena itu, segera ganti dengan mode API, ini dilakukan dengan mengatur unit di bidang yang sesuai. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ra/wv/ng/rawvngogy6biagddxsxxx08fhao.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nama modul adalah Node Identifier.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Opsi praktis untuk memberi modul Anda nama yang bisa dibaca manusia. Mari kita beri nama seperti itu - Koordinator. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xi/h2/fy/xih2fygnbxffyqcyhuwbvn8zhqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, Anda dapat mem-flash pengaturan ke modul dengan menekan tombol dengan pensil:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/8g/xm/pi8gxmplnffs0qmxtckhrfmxrqe.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Sambungkan modul ke jaringan</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita akan melihat jaringan apa yang kita dapatkan jika kita mengkonfigurasi tiga modul. </font><font style="vertical-align: inherit;">Program XCTU memiliki visualisator jaringan yang cukup nyaman, kita akan dengan jelas melihat topologi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan mengkonfigurasi ketiga modul secara bergantian dengan parameter berikut:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID PAN - jumlah total, misalnya 42</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP (API Enable) - diatur ke 1 (berfungsi dalam mode API)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NI (Node Identifier) ​​- memberikan nama modul yang dapat dimengerti (Koordinator, Lampu dan Sakelar, jika kita melakukan, misalnya, model sistem Smart Home).</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE (Coordinator Enable) - atur salah satu modul ke 1, itu akan menjadi koordinator.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian berikan daya ke semua modul. Posisikan mereka seperti ini: koordinator akan berada di konverter USB-UART, dan dua lainnya (router) akan ditempatkan di papan XBee Shield di atas Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda melakukan semuanya dengan hati-hati, maka keindahan akan terjadi. Modul akan secara otomatis terhubung ke jaringan. Anda dapat berkomunikasi dengan router dari jarak jauh melalui koordinator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini terlihat seperti ini. Klik tombol "Temukan node radio di jaringan yang sama". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/nf/mx/emnfmxivn4xxt3wtx0pe0f54m8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda akan melihat bahwa dua modul secara otomatis terdeteksi dan ditambahkan: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j3/ev/gf/j3evgfx0nj0xowanzz3ovdctyks.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan Anda dapat mengubah parameternya dengan cepat!&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang masih bagus: sekarang Anda dapat melihat peta jaringan jika Anda beralih ke mode kerja Jaringan di kanan atas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/2v/ma/sf2vmarm8agrkfjtepgib28sxuq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menyebar node jaringan dengan mouse, Anda akan melihat segitiga. </font><font style="vertical-align: inherit;">Harap dicatat bahwa lalu lintas ke modul paling kanan dapat berlangsung dalam dua cara. </font><font style="vertical-align: inherit;">Dan jika Anda memindahkan modul di ruang angkasa, Anda akan melihat bahwa gambar telah berubah, dan sekarang, mungkin, modul lain akan menjadi "ekstrem". </font><font style="vertical-align: inherit;">Ini adalah inti dari jaringan konfigurasi-sendiri.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Pasang modul XBee tanpa melepaskannya dari pelindung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, akan lebih menarik untuk bekerja dengan modul XBee tidak melalui komputer, tetapi dengan mengendalikannya menggunakan program pada mikrokontroler. </font><font style="vertical-align: inherit;">Yaitu, menghubungkannya ke papan STM32Nucleo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita bahas bagaimana modul XBee dapat berkomunikasi dengan mikrokontroler. </font><font style="vertical-align: inherit;">Dan mari kita mulai dengan tugas kecil: cara mengkonfigurasi modul tanpa mengeluarkannya dari perisai ekspansi? </font><font style="vertical-align: inherit;">Anda harus mengakui bahwa memindahkan modul bolak-balik tidak nyaman, pada saat yang sama Anda ingin bereksperimen dengan parameter dan aneh mengapa Anda memerlukan modul USB-UART yang terpisah, karena secara teori ada satu di papan STM32Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusinya sederhana: kita perlu mengubah papan Nucleo menjadi jembatan antara modul XBee dan konverter USB di papan tulis.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deskripsi umum dari ide tersebut</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mikrokontroler STM32 yang kami gunakan memiliki beberapa antarmuka UART. Setiap antarmuka seperti itu mewakili saluran komunikasi. Salah satunya terhubung ke konverter USB-UART sehingga kita dapat berkomunikasi dengan komputer melalui USB di terminal. Dua lainnya belum digunakan. Kami akan menghubungkan modul XBee ke salah satunya, yang juga memiliki saluran komunikasi seperti itu. Anda dapat memilih UART apa saja, kami telah memilih UART1 kepastian.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pinout dapat dilihat dalam MBed di kanan atas, dengan menekan tombol pemilihan board, dan kemudian pada tab Pinout. </font><font style="vertical-align: inherit;">Karena kebiasaan, mungkin cukup sulit untuk memahami gambar yang penuh warna ini. </font><font style="vertical-align: inherit;">Ada banyak hal di sini, karena papan memiliki banyak antarmuka, dan ada dua nomor pin: relatif terhadap mikrokontroler (PA_5, PA_6 - penomoran pin), dan relatif ke papan (D13, D12 - tulisan pada papan Nucleo, angka yang sama di dekat terminal). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/97/dp/mq/97dpmqw9dmy9lcqtb1hf6i_gyz0.png"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ternyata pada mikrokontroler, antarmuka UART1 akan berkomunikasi dengan modul-XBee, dan UART2 - seperti sebelumnya, dengan komputer. </font><font style="vertical-align: inherit;">Kode internal akan mengalihkan UART1 ke UART2 dan sebaliknya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/vk/5w/rpvk5wsdsb8qnz5i_m7dk8q-wwc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan koneksi, akan terlihat seperti ini:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/g7/cs/tpg7cslaiomjx-ogqje-su3q-7s.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat "jembatan" dari mikrokontroler</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus kami, kami dapat melompat pada perisai mengatur angka yang ingin kami sambungkan modul ZigBee. Modul komunikasi TX akan terhubung ke pin 2 board (PA_9 pada mikrokontroler), dan RX ke pin 8 (alias PA_10). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akan terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/ce/3s/ohce3sq3y1_0_jewruer0dmn36a.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami ambil disebut Serial Bridge. Ini adalah "jembatan" antara dua saluran komunikasi. Kami memuat kode ke dalam mikrokontroler, yang meneruskan segala sesuatu yang datang ke input dari komputer melalui UART2, ke UART1, dan sebaliknya. Seolah kami menyisipkan pipa di antara dua sumber informasi (Linuxsoids akan mengerti). Kami menghubungkan modul XBee ke UART1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode ini sangat sederhana, satu-satunya hal yang perlu Anda ubah di dalamnya adalah nomor pin yang terhubung dengan perangkat. Artinya, buat mereka PA_9 dan PA_10, seperti yang ditunjukkan di atas.</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mbed.h"</span></span>
<span class="hljs-comment">// Make a serial bridge from a serial I/O device on mbed to the PC</span>
<span class="hljs-function">Serial <span class="hljs-title">pc</span><span class="hljs-params">(USBTX, USBRX)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-function">Serial <span class="hljs-title">device</span><span class="hljs-params">(PA_9, PA_10)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-comment">// Defaults to 9600 baud on each device - use .baud(baudrate) to change</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
&nbsp;pc.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello!"</span>);
&nbsp;<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(pc.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device.putc(pc.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(device.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.putc(device.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting bahwa jika Anda mengacaukan urutan kesimpulan - misalnya, Anda membuat kesalahan dan menulis PA_10, PA_9 bukannya PA_9, PA_10 - urutan yang salah, maka kompiler tidak akan melaporkan kesalahan kepada Anda, dan program akan menampilkan kesalahan di konsol saat reboot:</font></font><br>
<pre><code class="plaintext hljs">pinmap not found for peripheral</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dan tidak akan bergerak, yaitu, pada prinsipnya, tidak ada yang akan berhasil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah Anda mengunduh kode ini dan mengatur jumper dengan benar pada pelindung, Anda dapat terhubung dengan aman ke modul XBee dari komputer, seperti yang Anda lakukan sebelumnya dengan adaptor USB-UART tanpa melepaskannya dari pelindung. </font><font style="vertical-align: inherit;">Itu akan secara teratur terdeteksi oleh program XCTU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekalipun Anda tidak memerlukan fungsi ini, masih periksa apakah programnya berfungsi, karena dalam contoh berikut ini kami akan berkomunikasi dengan modul XBee dari mikrokontroler, dan koneksi melalui UART1 harus sudah dibangun (yaitu, jumper diatur dengan benar dan nomor pin ditunjukkan dalam program) .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Akuisisi data</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat dua contoh sederhana: cara menerima dan mengirim data pada level mikrokontroler, menggunakan modul XBee sebagai antarmuka komunikasi eksternal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perpustakaan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resmi </font><font style="vertical-align: inherit;">dari produsen - perusahaan Digi. </font><font style="vertical-align: inherit;">Itu terletak di repositori Mbed, ada komentar yang berguna tentang penggunaan dan logika kode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, kita akan belajar cara mendapatkan data - ada contoh yang lebih mudah. </font><font style="vertical-align: inherit;">Kami akan memiliki modul XBee yang terhubung ke konverter USB-UART, mengirim ucapan ke papan Nucleo, dan itu akan mencetak ucapan ini ke konsol. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/ic/u5/zgicu5mh8dvsy8y8aegzetdoew8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buka </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di perpustakaan ini. </font><font style="vertical-align: inherit;">Seperti biasa, impor ke kompiler online sebagai program.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perbaiki perpustakaan untuk modul S2C</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu diingat bahwa jika Anda memiliki modul seri S2C: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
maka alih-alih pustaka standar Anda harus menggunakan perbaikan: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeLib_Fixed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kalau tidak, program ini tidak akan berfungsi. </font><font style="vertical-align: inherit;">Itu ditambahkan ke proyek hanya dengan menghapus perpustakaan XBeeLib dari sana, dan mengimpornya ke proyek XBeeLibFix. </font><font style="vertical-align: inherit;">Tidak ada lagi yang perlu diubah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi: impor perpustakaan ini ke kompiler online: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/vq/e9/kovqe9zqdl7553_kivabf8bedv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jendela impor proyek akan muncul. </font><font style="vertical-align: inherit;">Di sana Anda harus memilih target - tempat kami mengimpor: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/pt/vt/bxptvt2ctwcv87vl-b1qi5upi4s.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai proyek target, pilih contoh kami XBeeZB_Receive_Data. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/lj/hg/7qljhgp7jx5yt9875cqijnfopcs.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu perpustakaan akan diimpor ke proyek, dan kemudian dengan langkah berani kami menghapus versi XBeeLib yang salah.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iw/hz/or/iwhzor7bqjopgpigyi4_lfiv43e.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh Kompilasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, Anda mengimpor contoh dan mengganti perpustakaan di dalamnya jika perlu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lihatlah kode sampel, ini cukup sederhana. </font><font style="vertical-align: inherit;">Ini mendefinisikan fungsi panggilan balik yang dipanggil saat paket diterima. </font><font style="vertical-align: inherit;">Fungsi ini mencetak isi dari paket yang diterima ke konsol. </font><font style="vertical-align: inherit;">Jadi jika kita mengirimnya salam, dia akan mencetaknya juga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar contoh dikompilasi, Anda harus menulis dalam contoh kesimpulan bahwa kita bertanggung jawab untuk berkomunikasi dengan modul-XBee, karena program tidak tahu kesimpulan mana yang kita hubungkan dengan perangkat keras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, kita buka file config.h dan baris di dalamnya:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define RADIO_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX pin connected to the XBee module DIN pin */</span>
<span class="hljs-comment">//#define RADIO_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX pin connected to the XBee module DOUT pin */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Batalkan komentar, dan bukannya NC yang kami tulis, sesuai dengan kesimpulan apa yang kami hubungkan dengan jumper:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_TX PA_9</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_RX PA_10</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Demikian pula, kami memodifikasi garis:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define DEBUG_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX for debugging */</span>
<span class="hljs-comment">//#define DEBUG_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX for debugging (optional) */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menulis:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_TX USBTX</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_RX USBRX</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda menemukan kesalahan selama kompilasi yang tidak dapat Anda temukan </font></font><code>device.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, perbarui perpustakaan Mbed di pohon proyek (klik kanan di atasnya -&gt; Perbarui). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, program akan berhasil dikompilasi, dan Anda dapat mengunduhnya ke papan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh menjalankan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah melihat konsol apa yang ditulis papan Nucleo, Anda akan melihat yang berikut: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/mk/fb/asmkfbne30jznt7bzqvr2vjhl5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana kami mengirim data? </font><font style="vertical-align: inherit;">Opsi termudah: melalui konsol dalam program XCTU. </font><font style="vertical-align: inherit;">Pilih di menu utama program: Alat - Kirim paket. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/9b/7q/ko9b7qwhvwszyezghvzpbs1py74.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bagian bawah ada jendela dengan kata-kata Kirim paket. </font><font style="vertical-align: inherit;">Buat paket baru dengan mengklik "plus" di sebelah kanan. </font><font style="vertical-align: inherit;">Sebuah jendela untuk membuat paket baru akan muncul. </font><font style="vertical-align: inherit;">Pilih tab HEX di sana. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cf/wz/jccfwz6aesmjic-ncukw8ot1ls8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masukkan pengiriman data seperti itu: </font></font><br>
<code>7E 00 19 10 01 00 00 00 00 00 00 FF FF FF FE 00 00 48 65 6C 6C 6F 20 58 42 65 65 21 5A</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(menggunakan tombol "Kirim paket terpilih" di sebelah kanan daftar paket) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda akan melihat hasilnya di konsol modul pendengaran:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/tg/mk/55tgmkipu_8dk33yhqdxxqa90du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap dicatat bahwa itu hanya mencetak bagian terakhir dari byte yang Anda kirim. </font><font style="vertical-align: inherit;">Ini adalah muatan pesan yang sebenarnya. </font><font style="vertical-align: inherit;">Juga perhatikan bahwa jika Anda mengirim "hanya byte" (kombinasi byte acak), penerima tidak akan mengeluarkannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda meletakkan satu set byte:&nbsp; </font></font><br>
<code>48 65 6C 6C 6F 20 58 42 65 65 21</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
di konverter HEX-ASCIII mana pun (misalnya, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), maka pastikan itu berarti "Halo XBee!" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas yang sangat sederhana untuk eksekusi independen: modifikasi kode contoh sehingga menampilkan teks pesan dalam ASCII, bukan HEX, dan Anda bisa membaca teks ini di terminal.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Mengirim data</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan analogi dengan contoh sebelumnya, kami sekarang mempertimbangkan untuk mengirim data. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya ada di sini, seperti pada contoh sebelumnya. </font><font style="vertical-align: inherit;">Hanya dengan perbedaan itulah kita sekarang membuka </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contoh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> XBeeZB_Send_Data.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh Kompilasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting bahwa jika Anda memiliki modul S2C (itu tertulis dengan jelas di atasnya), </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
maka Anda akan kembali menghubungkan perpustakaan dengan perbaikan, jika tidak, tidak ada yang akan bekerja untuk Anda. Cara melakukan ini dijelaskan dalam contoh sebelumnya.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga, di sini untuk kompilasi yang berhasil Anda perlu menentukan pin pengontrol yang digunakan, Anda dapat menyalinnya dari contoh sebelumnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat contoh kode itu sendiri. Ini </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggunakan beberapa metode untuk mengirim data. Pilih yang paling sederhana: kirim data ke koordinator. Kami bahkan tidak perlu mendaftarkan alamat koordinator, karena dia sudah terdaftar di jaringan. Karenanya, tanpa mengubah sampel, kami mengomentari semua baris di akhir:</font></font><br>
<pre><code class="cpp hljs">send_data_to_coordinator(xbee);
<span class="hljs-comment">//send_broadcast_data(xbee);</span>
<span class="hljs-comment">//send_data_to_remote_node(xbee, remoteDevice);</span>
<span class="hljs-comment">//send_explicit_data_to_remote_node(xbee, remoteDevice);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ketika Anda mulai, Anda akan melihat ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/pp/sj/suppsjbb95cdiavs1svsj1ixctm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(jika Anda tidak melihatnya, cukup restart papan) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana saya bisa memastikan bahwa data mencapai koordinator? Misalnya, XCTU memiliki mode konsol jaringan. Diaktifkan oleh tombol di kanan atas. Dalam mode ini, Anda akan melihat semua paket di jaringan. Tentu saja, pada saat yang sama, Anda harus memiliki koneksi serial dengan koordinator. Dan jangan lupa klik tombol Open di kiri atas untuk membuatnya hijau. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/st/vy/yzstvyfb4ed2rkbgvmgushy1gkg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat melihat informasi terperinci tentang setiap paket di jaringan dengan memilihnya dalam daftar di sebelah kiri: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/2w/_f/fl2w_fotyjqzbmdpt9tp6fvyyba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggulir ke bagian akhir isi paket, Anda juga akan melihat baris dengan teks "send_data_to_coordinator":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/da/ha/vmdahazkjgs7ttk_d-hg6osq7oi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat mencoba metode lain untuk mengirim data, tetapi di sana (misalnya, untuk mengirim ke simpul yang dipilih terpisah) Anda harus mendaftarkan alamat simpul. </font><font style="vertical-align: inherit;">Anda dapat melihat alamat semua modul dalam program XCTU. </font><font style="vertical-align: inherit;">Cara mendaftarkan alamat tertentu dijelaskan secara mendalam dalam contoh ini.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Kami membuat gateway MQTT</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya bagus, tapi sekarang saya ingin bekerja dengan data ini di luar jaringan XBee, misalnya, di Internet. </font><font style="vertical-align: inherit;">Salah satu cara untuk melakukan ini adalah dengan menempatkan penerjemah dari XBee ke dalam protokol MQTT yang populer. </font><font style="vertical-align: inherit;">Kemudian, dengan cara biasa, kita dapat berlangganan pemberitahuan acara dan mengirim perintah dari antarmuka pengguna, dan program ini dapat ditemukan di mana saja (jika Anda menggunakan server MQTT eksternal daripada eksternal), dan tidak hanya di komputer kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bawah ini adalah instruksi. </font><font style="vertical-align: inherit;">Singkatnya, program yang diluncurkan di komputer akan bertukar data dari koordinator jaringan melalui koneksi USB. </font><font style="vertical-align: inherit;">Dia akan mengirimkan data ini ke protokol MQTT.</font></font><br>
<img src="https://habrastorage.org/webt/t0/yo/dx/t0yodx2oqigqjepdzr0w8exjwaq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal dan konfigurasikan XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Program yang akan kita gunakan sebagai gateway MQTT disebut XBMQ, terbuka dan gratis. </font><font style="vertical-align: inherit;">Ada dalam dua versi:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jawa</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeJS</font></font></a><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versi Java akan dipertimbangkan, meskipun ini tidak terlalu mendasar: kita tidak akan memprogramnya, kita hanya akan menginstalnya dan menggunakannya. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar program dapat bekerja, Anda memerlukan pustaka RXTX, itu dapat diinstal hanya dari repositori:</font></font><br>
<pre><code class="bash hljs">sudo apt-get install librxtx-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan tentu saja, Anda memerlukan JDK (Java Development Kit). </font><font style="vertical-align: inherit;">Itu ada dalam dua versi - dari Oracle dan OpenJDK, yang kedua direkomendasikan. </font><font style="vertical-align: inherit;">Kemungkinan besar, OpenJDK sudah diinstal pada sistem Anda, jika tidak, instal ulang. </font><font style="vertical-align: inherit;">Java membutuhkan maksimum 8, karena </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.xml.bind dikecualikan dari Java 11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan Anda harus memilih alternatif dengan JDK-8 sebagai opsi default, atau membuat konfigurasi untuk kasus ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unduh repositori program XBMQ:</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/angryelectron/xbmq-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah mengunduh kode sumber, kami akan mengumpulkan file biner program. </font><font style="vertical-align: inherit;">Tim</font></font><br>
<pre><code class="bash hljs">ant dist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
akan merakit proyek untuk semua sistem operasi utama. </font><font style="vertical-align: inherit;">Program akhir yang dikompilasi akan berada di folder </font></font><code>dist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang konfigurasikan program ini. </font><font style="vertical-align: inherit;">Membuka file</font></font><pre><code class="plaintext hljs">dist/xbmq.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 dan lihat di sana:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment">#</span>
<span class="hljs-comment"># Xbmq Properties.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#port = /dev/ttyUSB0</span>
<span class="hljs-comment">#baud = 9600</span>
<span class="hljs-comment">#rootTopic = ab123</span>
<span class="hljs-comment">#broker = tcp://test.mosquitto.org:1883</span>
<span class="hljs-comment">#username = user</span>
<span class="hljs-comment">#password = password</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Batalkan komentar dan ubah ke parameter Anda. </font><font style="vertical-align: inherit;">Parameternya adalah sebagai berikut: Port koneksi koordinator ZigBee, kecepatan, topik root (semua data akan jatuh ke dalamnya), alamat server MQTT, nama pengguna dan kata sandi (jika server membutuhkannya). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam contoh ini, hanya alamat server yang berubah - ke server mqtt lokal (mosquitto standar dari Linux). </font><font style="vertical-align: inherit;">Segala sesuatu yang lain ditinggalkan secara default:</font></font><br>
<pre><code class="bash hljs"><font></font>
port = /dev/ttyUSB0<font></font>
baud = 9600<font></font>
rootTopic = ab123<font></font>
broker = tcp://127.0.0.1:1883<font></font>
username = user<font></font>
password = password<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum langkah berikutnya, Anda harus menginstal dan menjalankan server MQTT mosquitto lokal:&nbsp;</font></font><br>
<pre><code class="bash hljs">sudo apt-get install mosquitto</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peluncuran XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, program dapat diluncurkan. </font><font style="vertical-align: inherit;">Setelah menghubungkan konverter USB-UART dengan modul koordinator dimasukkan, jalankan program:</font></font><br>
<pre><code class="bash hljs">./dist/xbmq.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat Anda menjalankan skrip, kami melihat baris di konsol:</font></font><br>
<pre><code class="bash hljs">INFO - Starting XBMQ gateway ab123/0013A2004154EA46</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terakhir - ini persis alamat koordinator kami. </font><font style="vertical-align: inherit;">Jika Anda berlangganan semua topik dengan klien MQTT eksternal, Anda akan segera melihat 2 pesan:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam topik </font></font><code>ab123/0013A2004154EA46/online</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- akan menjadi 1, ini adalah Kehendak Terakhir (contoh yang baik tentang bagaimana parameter "khusus" ini digunakan dalam kehidupan nyata)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Topik </font></font><code>ab123/0013A2004154EA46/log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan berisi frasa debug yang sama, "Memulai gateway XBMQ ..." yang sudah Anda lihat di konsol</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang cobalah mengirim pesan dari beberapa modul XBee eksternal lainnya - misalnya, ambil contoh dengan mengirim data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, dalam program MQTT.fx, jika Anda berlangganan semua topik (#), Anda akan melihat ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/56/5l/hy565luregquqnizlxf7pejdn40.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jendela program MQTT.fx.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dengan menjalankan contoh yang dipelajari sebelumnya dengan mengirim pesan ke koordinator, kita akan melihat teks ini (“send_data_to_coordinator”) sebagai bagian Paket MQTT. Topik induk umum bagi kami adalah yang ditentukan dalam konfigurasi program ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ab123</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Anda dapat mengubahnya sendiri). Berikutnya adalah alamat koordinator, kemudian alamat modul dari mana pesan itu berasal. Akhirnya, topik ini disebut DataOut, karena ini adalah data keluar.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, Anda akan melihat gambar seperti itu di klien MQTT lain, apakah itu MQTTLens atau bahkan hanya</font></font><code>mosquitto_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di konsol. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa komentar terakhir:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam cara yang baik, program ini harus bekerja dalam mode daemon. </font><font style="vertical-align: inherit;">Ada file xbmqd untuk ini, dan README mengatakan bagaimana cara menggunakannya.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perlu diingat bahwa karena ia </font></font><code>xbmq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memegang port, kami tidak dapat menjalankan program ini pada saat yang sama dengan XCTU.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda dapat bekerja dengan sistem Anda menggunakan protokol MQTT dan menulis program yang kompleks dan menarik! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/kt/h0/g8kth04siprq-9s2uwlli2fp6ae.jpeg" align="left"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatyana Volkova - Penulis program pelatihan di Internet of Things melacak "Samsung IT Academy", seorang spesialis dalam program tanggung jawab sosial perusahaan di Samsung Research Center</font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id497178/index.html">"1C: ERP" dan "1C: CRM": fungsionalitas dan analisis komparatif konfigurasi</a></li>
<li><a href="../id497184/index.html">Tampak arah yang menjanjikan dari pengembangan sistem manajemen data geologi, geofisika dan lapangan</a></li>
<li><a href="../id497186/index.html">Bagaimana pencarian vaksin untuk coronavirus</a></li>
<li><a href="../id497192/index.html">Cara TI bekerja dari jauh: kiat untuk mengelola tim yang didistribusikan</a></li>
<li><a href="../id497194/index.html">Tinder tahu lebih banyak tentang kehidupan intim Anda daripada teman-teman Anda</a></li>
<li><a href="../id497204/index.html">Digital 2020: memperbaiki tren</a></li>
<li><a href="../id497206/index.html">Tentang Pemrograman Berorientasi Objek</a></li>
<li><a href="../id497212/index.html">[Instruksi] Menggunakan Google-disk, Google-Site, Google-Form untuk membuat bank data dan sistem umpan balik</a></li>
<li><a href="../id497214/index.html">Insinyur Data dan Ilmuwan Data: apa yang mereka bisa dan berapa banyak yang mereka hasilkan</a></li>
<li><a href="../id497216/index.html">Kami membuat epidemi koronavirus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>