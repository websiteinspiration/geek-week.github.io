<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš ğŸ‘©ğŸ»â€ğŸ­ ğŸ¨ ä»OpenVPNè¿ç§»åˆ°WireGuardï¼Œå°†ç½‘ç»œåŠ å…¥ä¸€ä¸ªL2ç½‘ç»œ ğŸ‘¦ğŸ» ğŸšµğŸ¾ â—ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘æƒ³åˆ†äº«åœ¨ä¸‰ä¸ªåœ°ç†ä½ç½®é¥è¿œçš„å…¬å¯“ä¸­ç»„åˆç½‘ç»œçš„ç»éªŒï¼Œåœ¨æ¯ä¸ªå…¬å¯“ä¸­ï¼Œå¸¦æœ‰OpenWRTçš„è·¯ç”±å™¨ç”¨ä½œé€šå‘ä¸€ä¸ªå…¬ç”¨ç½‘ç»œçš„ç½‘å…³ã€‚é€‰æ‹©å°†L3ä¸å­ç½‘è·¯ç”±å’ŒL2ä¸æ¡¥æ¥ä¹‹é—´çš„ç½‘ç»œç»„åˆåœ¨ä¸€èµ·çš„æ–¹æ³•æ—¶ï¼Œå½“ç½‘ç»œçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å­ç½‘ä¸Šæ—¶ï¼Œé¦–é€‰ç¬¬äºŒç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒè®¡åˆ’åœ¨æ­£åœ¨åˆ›å»ºçš„ç½‘ç»œä¸­ä½¿ç”¨é€æ˜æŠ€æœ¯ï¼Œå› æ­¤ç¬¬äºŒç§æ–¹æ³•æ›´éš¾ä»¥é…ç½®ï¼Œä½†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä»OpenVPNè¿ç§»åˆ°WireGuardï¼Œå°†ç½‘ç»œåŠ å…¥ä¸€ä¸ªL2ç½‘ç»œ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486864/"><img src="https://habrastorage.org/webt/sk/lb/nc/sklbncaul8kfwr65yuroz8eteki.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘æƒ³åˆ†äº«åœ¨ä¸‰ä¸ªåœ°ç†ä½ç½®é¥è¿œçš„å…¬å¯“ä¸­ç»„åˆç½‘ç»œçš„ç»éªŒï¼Œåœ¨æ¯ä¸ªå…¬å¯“ä¸­ï¼Œå¸¦æœ‰OpenWRTçš„è·¯ç”±å™¨ç”¨ä½œé€šå‘ä¸€ä¸ªå…¬ç”¨ç½‘ç»œçš„ç½‘å…³ã€‚</font><font style="vertical-align: inherit;">é€‰æ‹©å°†L3ä¸å­ç½‘è·¯ç”±å’ŒL2ä¸æ¡¥æ¥ä¹‹é—´çš„ç½‘ç»œç»„åˆåœ¨ä¸€èµ·çš„æ–¹æ³•æ—¶ï¼Œå½“ç½‘ç»œçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å­ç½‘ä¸Šæ—¶ï¼Œé¦–é€‰ç¬¬äºŒç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒè®¡åˆ’åœ¨æ­£åœ¨åˆ›å»ºçš„ç½‘ç»œä¸­ä½¿ç”¨é€æ˜æŠ€æœ¯ï¼Œå› æ­¤ç¬¬äºŒç§æ–¹æ³•æ›´éš¾ä»¥é…ç½®ï¼Œä½†æ˜¯å´æä¾›äº†æ›´å¤šçš„æœºä¼šã€‚å±€åŸŸç½‘å”¤é†’å’ŒDLNAã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬1éƒ¨åˆ†ï¼šèƒŒæ™¯</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åˆé€‰æ‹©OpenVPNä½œä¸ºæ‰§è¡Œæ­¤ä»»åŠ¡çš„åè®®ï¼Œå› ä¸ºé¦–å…ˆï¼Œå®ƒå¯ä»¥åˆ›å»ºå¯ä»¥è½»æ¾æ·»åŠ åˆ°ç½‘æ¡¥çš„Tapè®¾å¤‡ï¼Œå…¶æ¬¡ï¼ŒOpenVPNæ”¯æŒTCPåè®®æ“ä½œï¼Œè¿™ä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºæ‰€æœ‰å…¬å¯“éƒ½æ²¡æœ‰ä¸“ç”¨çš„IPåœ°å€ï¼Œæˆ‘æ— æ³•ä½¿ç”¨STUNï¼Œå› ä¸ºç”±äºæŸç§åŸå› ï¼Œæˆ‘çš„æä¾›å•†é˜»æ­¢äº†UDPé€šè¿‡å…¶ç½‘ç»œä¼ å…¥çš„è¿æ¥ï¼Œè€ŒTCPå…è®¸æˆ‘å°†VPNæœåŠ¡å™¨çš„ç«¯å£è½¬å‘è‡³ä½¿ç”¨SSHç§Ÿç”¨VPSã€‚æ˜¯çš„ï¼Œè¿™ç§æ–¹æ³•å¸¦æ¥äº†å¾ˆå¤§çš„è´Ÿæ‹…ï¼Œå› ä¸ºæ•°æ®å·²è¢«åŠ å¯†ä¸¤æ¬¡ï¼Œä½†æ˜¯æˆ‘ä¸æƒ³å°†VPSè¾“å…¥åˆ°æˆ‘çš„ä¸“ç”¨ç½‘ç»œä¸­ï¼Œå› ä¸ºå­˜åœ¨ç¬¬ä¸‰æ–¹æ§åˆ¶å®ƒçš„é£é™©ï¼Œå› æ­¤ï¼Œåœ¨å®¶åº­ç½‘ç»œä¸Šæ‹¥æœ‰è¿™æ ·çš„è®¾å¤‡æ˜¯éå¸¸ä¸å¸Œæœ›çš„ï¼Œå› æ­¤å†³å®šä»¥é«˜é¢å¼€é”€æ¥æ”¯ä»˜å®‰å…¨æ€§ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†åœ¨è®¡åˆ’éƒ¨ç½²æœåŠ¡å™¨çš„è·¯ç”±å™¨ä¸Šè½¬å‘ç«¯å£ï¼Œä½¿ç”¨äº†sshtunnelç¨‹åºã€‚æˆ‘ä¸ä¼šæè¿°å…¶é…ç½®çš„å¤æ‚æ€§-è¿™å¾ˆå®¹æ˜“åšåˆ°ï¼Œæˆ‘åªæ˜¯æ³¨æ„åˆ°å®ƒçš„ä»»åŠ¡æ˜¯å°†TCPç«¯å£1194ä»è·¯ç”±å™¨è½¬å‘åˆ°VPSã€‚æ¥ä¸‹æ¥ï¼Œåœ¨tap0è®¾å¤‡ä¸Šé…ç½®OpenVPNæœåŠ¡å™¨ï¼Œè¯¥è®¾å¤‡ç¼ ç»•åœ¨br-lanæ¡¥ä¸­ã€‚åœ¨æ£€æŸ¥äº†ä¸æ‚¨åˆšåˆšä»ç¬”è®°æœ¬ç”µè„‘åˆ›å»ºçš„æœåŠ¡å™¨çš„è¿æ¥ä¹‹åï¼Œå¾ˆæ˜æ˜¾ï¼Œç«¯å£è½¬å‘çš„æƒ³æ³•å·²ç»å¥æ•ˆï¼Œå°½ç®¡æˆ‘å®é™…ä¸Šä¸åœ¨ç°åœºï¼Œä½†æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘å·²æˆä¸ºè·¯ç”±å™¨ç½‘ç»œçš„æˆå‘˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº‹æƒ…ä»ç„¶å¾ˆå°ï¼šæœ‰å¿…è¦åœ¨ä¸åŒçš„å…¬å¯“ä¸­åˆ†é…IPåœ°å€ï¼Œä»¥å…å®ƒä»¬å†²çªï¼Œå¹¶å°†è·¯ç”±å™¨é…ç½®ä¸ºOpenVPNå®¢æˆ·ç«¯ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€‰æ‹©äº†ä»¥ä¸‹è·¯ç”±å™¨IPåœ°å€å’ŒDHCPæœåŠ¡å™¨èŒƒå›´ï¼š</font></font><br>
<br>
<ul>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°„ç¨‹</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.80</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„æœåŠ¡å™¨</font></font></li>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.100</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰ä¸€å®šèŒƒå›´çš„</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.101</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.149</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å…¬å¯“2å·è·¯ç”±å™¨</font></font></li>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.150</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰ä¸€å®šèŒƒå›´çš„</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.151</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.10.199</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç¬¬3å·å…¬å¯“è·¯ç”±å™¨</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿˜éœ€è¦é€šè¿‡åœ¨å…¶é…ç½®ä¸­æ·»åŠ ä»¥ä¸‹å‡ è¡Œï¼Œå°†è¿™äº›åœ°å€åˆ†é…ç»™OpenVPNæœåŠ¡å™¨çš„å®¢æˆ·ç«¯è·¯ç”±å™¨ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">ifconfig-pool-persist /etc/openvpn/ipp.txt 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°/etc/openvpn/ipp.txtæ–‡ä»¶ä¸­ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">flat1_id 192.168.10.100<font></font>
flat2_id 192.168.10.150<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…¶ä¸­flat1_idå’Œflat2_idæ˜¯åœ¨åˆ›å»ºç”¨äºè¿æ¥åˆ°OpenVPNçš„è¯ä¹¦æ—¶æŒ‡å®šçš„è®¾å¤‡åç§°</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œåœ¨è·¯ç”±å™¨ä¸Šé…ç½®äº†OpenVPNå®¢æˆ·ç«¯ï¼Œä¸¤ä¸ªè·¯ç”±å™¨ä¸Šçš„tap0è®¾å¤‡éƒ½æ·»åŠ åˆ°äº†br-lanç½‘æ¡¥ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¼¼ä¹ä¸€åˆ‡éƒ½äº•ç„¶æœ‰åºï¼Œå› ä¸ºæ‰€æœ‰ä¸‰ä¸ªç½‘ç»œéƒ½å¯ä»¥äº’ç›¸çœ‹åˆ°å¹¶æ•´ä½“è¿ä½œã€‚ä½†æ˜¯ï¼Œäº‹å®è¯æ˜è¿™ä¸æ˜¯ä¸€ä¸ªéå¸¸ä»¤äººæ„‰å¿«çš„ç»†èŠ‚ï¼šæœ‰æ—¶è®¾å¤‡æ— æ³•ä»å…¶è·¯ç”±å™¨è·å–IPåœ°å€ï¼Œéšä¹‹è€Œæ¥çš„æ˜¯æ‰€æœ‰åæœã€‚ç”±äºæŸäº›åŸå› ï¼ŒæŸäº›å…¬å¯“ä¸­çš„è·¯ç”±å™¨æ²¡æœ‰æ—¶é—´åŠæ—¶å“åº”DHCPDISCOVERï¼Œå¹¶ä¸”è®¾å¤‡æœªæ”¶åˆ°å…¶åœ°å€ã€‚æˆ‘æ„è¯†åˆ°æˆ‘éœ€è¦åœ¨æ¯ä¸ªè·¯ç”±å™¨çš„tap0ä¸­è¿‡æ»¤æ­¤ç±»è¯·æ±‚ï¼Œä½†æ˜¯äº‹å®è¯æ˜ï¼Œå¦‚æœiptablesæ˜¯ç½‘æ¡¥çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™iptablesä¸èƒ½ä¸è¯¥è®¾å¤‡ä¸€èµ·ä½¿ç”¨ï¼Œè€Œebtablesåº”è¯¥å¯ä»¥å¸®åŠ©æˆ‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¸åœ¨æˆ‘çš„å›ºä»¶ä¸­ï¼Œæˆ‘ä¸å¾—ä¸ä¸ºæ¯ä¸ªè®¾å¤‡é‡å»ºæ˜ åƒã€‚å®Œæˆæ­¤æ“ä½œå¹¶å°†æ­¤ç±»è¡Œæ·»åŠ åˆ°æ¯ä¸ªè·¯ç”±å™¨çš„/etc/rc.localåï¼Œé—®é¢˜å¾—ä»¥è§£å†³ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">ebtables -A INPUT --<span class="hljs-keyword">in</span>-interface tap0 --protocol ipv4 --ip-protocol udp --ip-destination-port 67:68 -j DROP<font></font>
ebtables -A INPUT --<span class="hljs-keyword">in</span>-interface tap0 --protocol ipv4 --ip-protocol udp --ip-source-port 67:68 -j DROP<font></font>
ebtables -A FORWARD --out-interface tap0 --protocol ipv4 --ip-protocol udp --ip-destination-port 67:68 -j DROP<font></font>
ebtables -A FORWARD --out-interface tap0 --protocol ipv4 --ip-protocol udp --ip-source-port 67:68 -j DROP<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ç§é…ç½®æŒç»­äº†ä¸‰å¹´ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬2éƒ¨åˆ†ï¼šWireGuardç®€ä»‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€è¿‘ï¼Œåœ¨Internetä¸Šï¼Œä»–ä»¬å¼€å§‹è¶Šæ¥è¶Šå¤šåœ°è°ˆè®ºWireGuardï¼Œæ¬£èµå…¶é…ç½®çš„ç®€å•æ€§ï¼Œé«˜ä¼ è¾“é€Ÿåº¦ï¼Œä½pingå’Œå¯æ¯”çš„å®‰å…¨æ€§ã€‚æœç´¢æœ‰å…³ä»–çš„å…¶ä»–ä¿¡æ¯è¡¨æ˜ï¼Œä»–ä»¬æ—¢ä¸æ”¯æŒä½œä¸ºæ¡¥æ¥æˆå‘˜ï¼Œä¹Ÿä¸æ”¯æŒä¸TCPä¸€èµ·å·¥ä½œï¼Œè¿™ä½¿æˆ‘è®¤ä¸ºå¯¹äºæˆ‘è€Œè¨€ï¼ŒOpenVPNä»ç„¶æ²¡æœ‰å…¶ä»–é€‰æ‹©ã€‚æ‰€ä»¥æˆ‘æ¨è¿Ÿäº†è®¤è¯†WireGuardã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡ å¤©å‰ï¼Œé€šè¿‡èµ„æºï¼Œä¸€ç§æˆ–å¦ä¸€ç§æ–¹å¼ä¸ITè¿æ¥ï¼Œæœ‰æ¶ˆæ¯ä¼ å‡ºï¼ŒWireGuardæœ€ç»ˆå°†ä»5.6ç‰ˆå¼€å§‹åŒ…å«åœ¨Linuxå†…æ ¸ä¸­ã€‚æ–°é—»æ–‡ç« ä¸€å¦‚æ—¢å¾€åœ°èµæ‰¬WireGuardã€‚æˆ‘å†æ¬¡æŠ•å…¥äº†å¯»æ‰¾æ›¿ä»£æ—§å¼OpenVPNçš„æ–¹æ³•ã€‚è¿™æ¬¡æˆ‘ç¢°åˆ°</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ç¯‡æ–‡ç« </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å®ƒè®¨è®ºäº†ä½¿ç”¨GREåœ¨L3ä¸Šæ„å»ºä»¥å¤ªç½‘éš§é“çš„é—®é¢˜ã€‚è¿™ç¯‡æ–‡ç« ç»™äº†æˆ‘å¸Œæœ›ã€‚å°šä¸æ¸…æ¥šå¦‚ä½•å¤„ç†UDPåè®®ã€‚é€šè¿‡æœç´¢ï¼Œæˆ‘æ‰¾åˆ°äº†æœ‰å…³å°†socatä¸SSHéš§é“ç»“åˆä½¿ç”¨ä»¥è½¬å‘UDPç«¯å£çš„æ–‡ç« ï¼Œä½†æ˜¯ï¼Œä»–ä»¬æŒ‡å‡ºï¼Œè¿™ç§æ–¹æ³•ä»…åœ¨å•è¿æ¥æ¨¡å¼ä¸‹æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— æ³•ä½¿ç”¨å¤šä¸ªVPNå®¢æˆ·ç«¯ã€‚æˆ‘æƒ³åˆ°äº†åœ¨VPSä¸Šå®‰è£…VPNæœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯è®¾ç½®GREçš„æƒ³æ³•ï¼Œä½†äº‹å®è¯æ˜ï¼ŒGREä¸æ”¯æŒåŠ å¯†ï¼Œè¿™å°†å¯¼è‡´ä»¥ä¸‹äº‹å®ï¼šå¦‚æœç¬¬ä¸‰æ–¹è®¿é—®æœåŠ¡å™¨ï¼Œåˆ™æˆ‘ç½‘ç»œä¹‹é—´çš„æ‰€æœ‰æµé‡éƒ½åœ¨ä»–ä»¬çš„æ‰‹ä¸­åŸåˆ™ä¸Šä¸é€‚åˆæˆ‘ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒæ ·ï¼Œæ ¹æ®ä»¥ä¸‹æ–¹æ¡ˆï¼Œé€šè¿‡åœ¨VPNä¸Šä½¿ç”¨VPNæ¥åšå‡ºè¿‡åº¦åŠ å¯†çš„å†³å®šï¼š</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€çº§VPNï¼š</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯</font><font style="vertical-align: inherit;">å†…éƒ¨åœ°å€ä¸º192.168.30.1 </font><font style="vertical-align: inherit;">çš„</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœåŠ¡å™¨</font></font></i><font style="vertical-align: inherit;"></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯</font><font style="vertical-align: inherit;">å†…éƒ¨åœ°å€ä¸º192.168.30.2 </font><i><font style="vertical-align: inherit;">çš„</font></i><font style="vertical-align: inherit;"> VPS </font><i><font style="vertical-align: inherit;">å®¢æˆ·ç«¯</font></i><b><font style="vertical-align: inherit;">MK2</font></b><font style="vertical-align: inherit;">æ˜¯</font><font style="vertical-align: inherit;">å†…éƒ¨åœ°å€ä¸º192.168.30.3 </font><i><font style="vertical-align: inherit;">çš„</font></i><font style="vertical-align: inherit;"> VPS </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®¢æˆ·ç«¯</font></font></i><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">MK3</font></b><font style="vertical-align: inherit;">æ˜¯</font><font style="vertical-align: inherit;">å†…éƒ¨åœ°å€ä¸º192.168.30.3 </font><i><font style="vertical-align: inherit;">çš„</font></i><font style="vertical-align: inherit;"> VPS </font><i><font style="vertical-align: inherit;">å®¢æˆ·ç«¯</font></i></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MK2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯</font><b><font style="vertical-align: inherit;">ç¬¬äºŒçº§VPNï¼š</font></b><b><font style="vertical-align: inherit;">MS</font></b><font style="vertical-align: inherit;">æ˜¯</font><i><font style="vertical-align: inherit;">æœåŠ¡å™¨</font></i><font style="vertical-align: inherit;">å…·æœ‰å¤–éƒ¨åœ°å€192.168.30.2å’Œå†…éƒ¨192.168.31.1çš„</font><b><font style="vertical-align: inherit;">MK2</font></b><font style="vertical-align: inherit;">æ˜¯</font><i><font style="vertical-align: inherit;">ä¸€ä¸ª</font></i><b><font style="vertical-align: inherit;">MS </font></b><i><font style="vertical-align: inherit;">å®¢æˆ·ç«¯</font></i><font style="vertical-align: inherit;">ï¼Œå…¶åœ°å€ä¸º192.168.30.2å¹¶å…·æœ‰å†…éƒ¨IP 192.168.31.2 </font><b><font style="vertical-align: inherit;">MK3</font></b><font style="vertical-align: inherit;">æ˜¯</font><i><font style="vertical-align: inherit;">ä¸€ä¸ª</font></i><b><font style="vertical-align: inherit;">MS </font></b><i><font style="vertical-align: inherit;">å®¢æˆ·ç«¯</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å€ä¸º192.168.30.2ï¼Œå†…éƒ¨IPä¸º192.168.31.3 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¬å¯“1ä¸­çš„è·¯ç”±å™¨-æœåŠ¡å™¨ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MK2-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¬å¯“2ä¸­çš„</font><font style="vertical-align: inherit;">è·¯ç”±å™¨</font><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MK3-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¬å¯“3ä¸­çš„è·¯ç”±å™¨</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*è®¾å¤‡é…ç½®åœ¨æœ¬æ–‡ç»“å°¾å¤„çš„æ‰°æµå™¨ä¸­å‘å¸ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œåœ¨ç½‘ç»œ192.168.31.0/24çš„èŠ‚ç‚¹ä¹‹é—´æ‰§è¡Œpingæ“ä½œï¼Œæ˜¯æ—¶å€™ç»§ç»­å»ºç«‹GREéš§é“äº†ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œä¸ºäº†ä¸å¤±å»å¯¹è·¯ç”±å™¨çš„è®¿é—®æƒé™ï¼Œå€¼å¾—è®¾ç½®SSHéš§é“ä»¥è½¬å‘VPSä¸Šçš„22ä¸ªç«¯å£ï¼Œä¾‹å¦‚ï¼Œç¬¬2å¥—å…¬å¯“çš„è·¯ç”±å™¨å°†åœ¨ç¬¬10022ä¸ªVPSç«¯å£ä¸Šå¯ç”¨ï¼Œè€Œåœ¨ç¬¬11122ä¸ªç«¯å£ä¸Šå°†å¯ç”¨VPSè·¯ç”±å™¨æ¥è‡ª3å·å…¬å¯“ã€‚æœ€å¥½ä½¿ç”¨ç›¸åŒçš„sshtunnelé…ç½®è½¬å‘ï¼Œå› ä¸ºå¦‚æœéš§é“æ‰çº¿ï¼Œå®ƒå°†æ¢å¤éš§é“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
éš§é“å·²é…ç½®ï¼Œæ‚¨å¯ä»¥é€šè¿‡è½¬å‘çš„ç«¯å£è¿æ¥åˆ°SSHï¼š</font></font><br>
<br>
<pre><code class="bash hljs">ssh root@_VPS -p 10022</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œç¦ç”¨OpenVPNï¼š</font></font><br>
<br>
<pre><code class="bash hljs">/etc/init.d/openvpn stop</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œä»å…¬å¯“2åœ¨è·¯ç”±å™¨ä¸Šé…ç½®GREéš§é“ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">ip link add grelan0 <span class="hljs-built_in">type</span> gretap remote 192.168.31.1 <span class="hljs-built_in">local</span> 192.168.31.2<font></font>
ip link <span class="hljs-built_in">set</span> grelan0 up
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶å°†åˆ›å»ºçš„æ¥å£æ·»åŠ åˆ°ç½‘æ¡¥ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">brctl addif br-lan grelan0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†åœ¨è·¯ç”±å™¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç±»ä¼¼çš„è¿‡ç¨‹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">ip link add grelan0 <span class="hljs-built_in">type</span> gretap remote 192.168.31.2 <span class="hljs-built_in">local</span> 192.168.31.1<font></font>
ip link <span class="hljs-built_in">set</span> grelan0 up
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶ä¸”ï¼Œè¿˜å°†åˆ›å»ºçš„æ¥å£æ·»åŠ åˆ°ç½‘æ¡¥ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">brctl addif br-lan grelan0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»è¿™ä¸€åˆ»å¼€å§‹ï¼ŒPingå¼€å§‹æˆåŠŸè¿›å…¥æ–°ç½‘ç»œï¼Œè€Œæˆ‘æ»¡æ„åœ°å°†è¦å–å’–å•¡ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œä¸ºäº†è¯„ä¼°ç½‘ç»œå¦ä¸€ç«¯çš„å·¥ä½œæ–¹å¼ï¼Œæˆ‘å°è¯•é€šè¿‡SSHè¿æ¥åˆ°2å·å…¬å¯“ä¸­çš„ä¸€å°è®¡ç®—æœºï¼Œä½†æ˜¯sshå®¢æˆ·ç«¯å†»ç»“ï¼Œè€Œæ²¡æœ‰æç¤ºè¾“å…¥å¯†ç ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°è¯•é€šè¿‡telnetè¿æ¥åˆ°è¿™å°è®¡ç®—æœºï¼Œå¹¶è¿æ¥åˆ°ç«¯å£22ï¼Œæˆ‘çœ‹åˆ°ä¸€æ¡çº¿ï¼Œä»ä¸­å¯ä»¥äº†è§£åˆ°æ­£åœ¨å»ºç«‹è¿æ¥ï¼ŒSSHæœåŠ¡å™¨æ­£åœ¨å“åº”ï¼Œä»…å‡ºäºæŸç§åŸå› ä¸æä¾›æˆ‘ç™»å½•ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">$ telnet 192.168.10.110 22<font></font>
SSH-2.0-OpenSSH_8.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å°è¯•é€šè¿‡VNCè¿æ¥åˆ°å®ƒå¹¶çœ‹åˆ°é»‘å±ã€‚æˆ‘å‘è‡ªå·±ä¿è¯è¿™æ˜¯ä¸€å°è¿œç¨‹è®¡ç®—æœºï¼Œå› ä¸ºæˆ‘å¯ä»¥ä»å†…éƒ¨åœ°å€çš„è¿™å¥—å…¬å¯“è½»æ¾åœ°è¿æ¥åˆ°è·¯ç”±å™¨ã€‚ä½†æ˜¯ï¼Œæˆ‘å†³å®šé€šè¿‡è·¯ç”±å™¨è¿æ¥åˆ°æ­¤è®¡ç®—æœºçš„SSHï¼Œå¾ˆæƒŠè®¶åœ°å‘ç°è¿æ¥æˆåŠŸå¹¶ä¸”è¿œç¨‹è®¡ç®—æœºå¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯å®ƒä¹Ÿæ— æ³•è¿æ¥åˆ°æˆ‘çš„è®¡ç®—æœºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»ç½‘æ¡¥ä¸Šå¸ä¸‹äº†grelan0è®¾å¤‡ï¼Œå¹¶åœ¨2å·å…¬å¯“çš„è·¯ç”±å™¨ä¸Šè¿è¡ŒOpenVPNï¼Œå¹¶ç¡®ä¿ç½‘ç»œå†æ¬¡æŒ‰é¢„æœŸå·¥ä½œå¹¶ä¸”è¿æ¥ä¸ä¼šä¸­æ–­ã€‚å½“æˆ‘è¿›è¡Œæœç´¢æ—¶ï¼Œæˆ‘ä¼šé‡åˆ°ä¸€äº›è®ºå›ï¼Œåœ¨è¯¥è®ºå›ä¸Šäººä»¬ä¼šæŠ±æ€¨åŒæ ·çš„é—®é¢˜ï¼Œå»ºè®®ä»–ä»¬æé«˜MTUã€‚ä½†æ˜¯ï¼Œæˆ‘æ— æ³•æé«˜ç¬¬ä¸€çº§VPNï¼ˆwg0ï¼‰çš„MTUï¼šå¦‚æœMTUé«˜äº1420ï¼ˆä¼šè‡ªåŠ¨è®¾ç½®ï¼‰ï¼Œåˆ™ä¼šå¼€å§‹ä¸­æ–­ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œåœ¨wg0ä¹‹ä¸Šå·¥ä½œçš„ç¬¬äºŒçº§VPN wg1åœ¨MTU 1600ä¸Šä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚è¿™è¶³ä»¥å®‰è£…gretapè®¾å¤‡çš„MTUä¸º1500ï¼Œå› æ­¤è¯¥æ¥å£çš„MTUå€¼ä¸è®¡åˆ’å°†gretapæ·»åŠ åˆ°å…¶ä¸­çš„br-lanæ¡¥ç›¸åŒã€‚æ®æˆ‘äº†è§£ï¼Œç½‘æ¡¥å°†MTUè®¾ç½®ä¸ºç­‰äºæ‰€æœ‰è®¾å¤‡ä¸Šå¯ç”¨å€¼ä¸­çš„è¾ƒå°è€…ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘åœ¨3å·å…¬å¯“çš„è·¯ç”±å™¨ä¸Šè¿›è¡Œäº†ç±»ä¼¼çš„é…ç½®ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯æœåŠ¡å™¨åœ¨æœåŠ¡å™¨ä¸Šæ·»åŠ äº†ç¬¬äºŒä¸ªgretapæ¥å£ï¼Œåä¸ºgrelan1ï¼Œè¯¥æ¥å£ä¹Ÿå·²æ·»åŠ åˆ°br-lanç½‘æ¡¥ä¸­ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€åˆ‡æ­£å¸¸ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨å¯åŠ¨æ—¶æ”¾ç½®gretapç¨‹åºé›†ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†è¿™äº›è¡Œæ”¾åœ¨å•å…ƒ2çš„è·¯ç”±å™¨ä¸Šçš„/etc/rc.localä¸­ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">ip link add grelan0 type gretap remote 192.168.31.1 local 192.168.31.2<font></font>
ip link set dev grelan0 mtu 1500<font></font>
ip link set grelan0 up<font></font>
brctl addif br-lan grelan0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†æ­¤æ·»åŠ åˆ°å•å…ƒ3ä¸­çš„è·¯ç”±å™¨çš„/etc/rc.localä¸­ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">ip link add grelan0 type gretap remote 192.168.31.1 local 192.168.31.3<font></font>
ip link set dev grelan0 mtu 1500<font></font>
ip link set grelan0 up<font></font>
brctl addif br-lan grelan0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶åœ¨æœåŠ¡å™¨è·¯ç”±å™¨ä¸Šï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">ip link add grelan0 type gretap remote 192.168.31.2 local 192.168.31.1<font></font>
ip link set dev grelan0 mtu 1500<font></font>
ip link set grelan0 up<font></font>
brctl addif br-lan grelan0<font></font>
<font></font>
ip link add grelan1 type gretap remote 192.168.31.3 local 192.168.31.1<font></font>
ip link set dev grelan1 mtu 1500<font></font>
ip link set grelan1 up<font></font>
brctl addif br-lan grelan1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡æ–°å¯åŠ¨å®¢æˆ·ç«¯è·¯ç”±å™¨åï¼Œæˆ‘å‘ç°ç”±äºæŸç§åŸå› å®ƒä»¬æ²¡æœ‰è¿æ¥åˆ°æœåŠ¡å™¨ã€‚</font><font style="vertical-align: inherit;">è¿æ¥åˆ°ä»–ä»¬çš„SSHï¼ˆå¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä¸ºæ­¤é¢„å…ˆé…ç½®äº†sshtunnelï¼‰åï¼Œå‘ç°WireGuardå‡ºäºæŸç§åŸå› æ­£åœ¨ä¸ºç«¯ç‚¹åˆ›å»ºè·¯ç”±ï¼Œä½†è¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¯¹äº192.168.30.2ï¼Œè·¯ç”±è¡¨æŒ‡ç¤ºäº†é€šè¿‡pppoe-wanæ¥å£ï¼ˆå³ï¼Œé€šè¿‡Internetï¼‰çš„è·¯ç”±ï¼Œå°½ç®¡åˆ°è¯¥è·¯ç”±çš„è·¯ç”±åº”è¯¥å·²ç»é€šè¿‡wg0æ¥å£è¿›è¡Œäº†è·¯ç”±ã€‚</font><font style="vertical-align: inherit;">åˆ é™¤æ­¤è·¯ç”±åï¼Œæ¢å¤äº†è¿æ¥ã€‚</font><font style="vertical-align: inherit;">æˆ‘åœ¨æŸå¤„æ‰¾ä¸åˆ°æœ‰å…³å¦‚ä½•ä½¿WireGuardä¸åˆ›å»ºè¿™äº›è·¯ç”±çš„è¯´æ˜ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ï¼Œæˆ‘ä»€è‡³ä¸çŸ¥é“ï¼ŒåŠŸèƒ½æ˜¯OpenWRTè¿˜æ˜¯WireGuardæœ¬èº«ã€‚</font><font style="vertical-align: inherit;">ä¸ç”¨é•¿æ—¶é—´è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åªæ˜¯åœ¨æ­¤è·¯ç”±å™¨ä¸Šæ·»åŠ äº†ä¸€è¡Œåˆ°ç”±è®¡æ—¶å™¨å¾ªç¯çš„è„šæœ¬ä¸­ä»¥åˆ é™¤æ­¤è·¯ç”±ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">route del 192.168.30.2
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»ç»“ä¸€ä¸‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘è¿˜æ²¡æœ‰å®Œå…¨æ‹’ç»ä½¿ç”¨OpenVPNï¼Œå› ä¸ºæœ‰æ—¶æˆ‘éœ€è¦ä»ç¬”è®°æœ¬ç”µè„‘æˆ–æ‰‹æœºè¿æ¥åˆ°æ–°ç½‘ç»œï¼Œå¹¶ä¸”é€šå¸¸æ— æ³•åœ¨å®ƒä»¬ä¸Šå®‰è£…gretapè®¾å¤‡ï¼Œä½†æ˜¯å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯è·å¾—äº†å…¬å¯“ä¹‹é—´æ•°æ®ä¼ è¾“é€Ÿåº¦çš„ä¼˜åŠ¿å¹¶ä¸”ï¼Œä¾‹å¦‚ï¼Œç°åœ¨ä½¿ç”¨VNCä¸ä¼šå¸¦æ¥ä»»ä½•ä¸ä¾¿ã€‚</font><font style="vertical-align: inherit;">Pingç•¥æœ‰ä¸‹é™ï¼Œä½†å˜å¾—æ›´åŠ ç¨³å®šï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨OpenVPNæ—¶ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">[r0ck3r@desktop ~]$ ping -c 20 192.168.10.110<font></font>
PING 192.168.10.110 (192.168.10.110) 56(84) bytes of data.<font></font>
64 bytes from 192.168.10.110: icmp_seq=1 ttl=64 time=133 ms<font></font>
...<font></font>
64 bytes from 192.168.10.110: icmp_seq=20 ttl=64 time=125 ms<font></font>
<font></font>
--- 192.168.10.110 ping statistics ---<font></font>
20 packets transmitted, 20 received, 0% packet loss, time 19006ms<font></font>
rtt min/avg/max/mdev = 124.722/126.152/136.907/3.065 ms<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨WireGuardæ—¶ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">[r0ck3r@desktop ~]$ ping -c 20 192.168.10.110<font></font>
PING 192.168.10.110 (192.168.10.110) 56(84) bytes of data.<font></font>
64 bytes from 192.168.10.110: icmp_seq=1 ttl=64 time=124 ms<font></font>
...<font></font>
64 bytes from 192.168.10.110: icmp_seq=20 ttl=64 time=124 ms<font></font>
--- 192.168.10.110 ping statistics ---<font></font>
20 packets transmitted, 20 received, 0% packet loss, time 19003ms<font></font>
rtt min/avg/max/mdev = 123.954/124.423/126.708/0.675 ms<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VPSä¹‹å‰çš„é«˜pingï¼ˆå¤§çº¦61.5 msï¼‰å¯¹å®ƒçš„å½±å“æ›´å¤§ï¼Œ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯é€Ÿåº¦æ˜¾ç€æé«˜ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨å¸¦æœ‰è·¯ç”±å™¨æœåŠ¡å™¨çš„å…¬å¯“ä¸­ï¼Œæˆ‘çš„Internetè¿æ¥é€Ÿåº¦ä¸º30 Mbit / sï¼Œåœ¨å…¶ä»–å…¬å¯“ä¸­ä¸º5 Mbit / sã€‚</font><font style="vertical-align: inherit;">åŒæ—¶ï¼Œæ ¹æ®iperfï¼Œåœ¨ä½¿ç”¨OpenVPNæ—¶ï¼Œæˆ‘æ— æ³•å®ç°ç½‘ç»œä¹‹é—´çš„æ•°æ®ä¼ è¾“é€Ÿç‡è¶…è¿‡3.8 Mb / sï¼Œè€ŒWireGuardå°†å…¶â€œæŠ½å–â€åˆ°ç›¸åŒçš„5 Mb / sã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPSä¸Šçš„WireGuardé…ç½®</font></font></b><div class="spoiler_text"><code>[Interface]<br>
Address = 192.168.30.1/24<br>
ListenPort = 51820<br>
PrivateKey = &lt;___VPS&gt;<br>
<br>
[Peer]<br>
PublicKey = &lt;__VPN_1_&gt;<br>
AllowedIPs = 192.168.30.2/32<br>
<br>
[Peer]<br>
PublicKey = &lt;__VPN_2_2&gt;<br>
AllowedIPs = 192.168.30.3/32<br>
<br>
[Peer]<br>
PublicKey = &lt;__VPN_2_3&gt;<br>
AllowedIPs = 192.168.30.4/32</code><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSä¸Šçš„WireGuardé…ç½®ï¼ˆæ·»åŠ åˆ°/ etc / config / networkï¼‰</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">#VPN   - <font></font>
config interface 'wg0'<font></font>
        option proto 'wireguard'<font></font>
        list addresses '192.168.30.2/24'<font></font>
        option private_key '__VPN_1_'<font></font>
        option auto '1'<font></font>
<font></font>
config wireguard_wg0<font></font>
        option public_key '__VPN_1_VPS'<font></font>
        option endpoint_port '51820'<font></font>
        option route_allowed_ips '1'<font></font>
        option persistent_keepalive '25'<font></font>
        list allowed_ips '192.168.30.0/24'<font></font>
        option endpoint_host 'IP__VPS'<font></font>
<font></font>
#VPN   - <font></font>
config interface 'wg1'<font></font>
        option proto 'wireguard'<font></font>
        option private_key '__VPN_2_'<font></font>
        option listen_port '51821'<font></font>
        list addresses '192.168.31.1/24'<font></font>
        option auto '1'<font></font>
        option mtu '1600'<font></font>
<font></font>
config wireguard_wg1<font></font>
        option public_key '__VPN_2_2'<font></font>
        list allowed_ips '192.168.31.2'<font></font>
<font></font>
config wireguard_wg1ip link add grelan0 type gretap remote 192.168.31.1 local 192.168.31.3<font></font>
        option public_key '__VPN_2_3'<font></font>
        list allowed_ips '192.168.31.3'<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MK2ä¸Šçš„WireGuardé…ç½®ï¼ˆæ·»åŠ åˆ°/ etc / config / networkï¼‰</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">#VPN   - <font></font>
config interface 'wg0'<font></font>
        option proto 'wireguard'<font></font>
        list addresses '192.168.30.3/24'<font></font>
        option private_key '__VPN_1_2'<font></font>
        option auto '1'<font></font>
<font></font>
config wireguard_wg0<font></font>
        option public_key '__VPN_1_VPS'<font></font>
        option endpoint_port '51820'<font></font>
        option persistent_keepalive '25'<font></font>
        list allowed_ips '192.168.30.0/24'<font></font>
        option endpoint_host 'IP__VPS'<font></font>
<font></font>
#VPN   - <font></font>
config interface 'wg1'<font></font>
        option proto 'wireguard'<font></font>
        option private_key '__VPN_2_2'<font></font>
        list addresses '192.168.31.2/24'<font></font>
        option auto '1'<font></font>
        option listen_port '51821'<font></font>
        option mtu '1600'<font></font>
<font></font>
config wireguard_wg1<font></font>
        option public_key '__VPN_2_'<font></font>
        option endpoint_host '192.168.30.2'<font></font>
        option endpoint_port '51821'<font></font>
        option persistent_keepalive '25'<font></font>
        list allowed_ips '192.168.31.0/24'<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MK3ä¸Šçš„WireGuardé…ç½®ï¼ˆæ·»åŠ åˆ°/ etc / config / networkï¼‰</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">#VPN   - <font></font>
config interface 'wg0'<font></font>
        option proto 'wireguard'<font></font>
        list addresses '192.168.30.4/24'<font></font>
        option private_key '__VPN_1_3'<font></font>
        option auto '1'<font></font>
<font></font>
config wireguard_wg0<font></font>
        option public_key '__VPN_1_VPS'<font></font>
        option endpoint_port '51820'<font></font>
        option persistent_keepalive '25'<font></font>
        list allowed_ips '192.168.30.0/24'<font></font>
        option endpoint_host 'IP__VPS'<font></font>
<font></font>
#VPN   - <font></font>
config interface 'wg1'<font></font>
        option proto 'wireguard'<font></font>
        option private_key '__VPN_2_3'<font></font>
        list addresses '192.168.31.3/24'<font></font>
        option auto '1'<font></font>
        option listen_port '51821'<font></font>
        option mtu '1600'<font></font>
<font></font>
config wireguard_wg1<font></font>
        option public_key '__VPN_2_'<font></font>
        option endpoint_host '192.168.30.2'<font></font>
        option endpoint_port '51821'<font></font>
        option persistent_keepalive '25'<font></font>
        list allowed_ips '192.168.31.0/24'<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ‰€æè¿°çš„ç¬¬äºŒå±‚VPNé…ç½®ä¸­ï¼Œæˆ‘ä¸ºWireGuardå®¢æˆ·ç«¯æŒ‡å®šäº†51821ç«¯å£ï¼ŒåŸåˆ™ä¸Šè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯å°†é€šè¿‡ä»»ä½•å…è´¹çš„éç‰¹æƒç«¯å£å»ºç«‹è¿æ¥ï¼Œä½†æ˜¯æˆ‘è¿™æ ·åšæ˜¯ä¸ºäº†é˜»æ­¢æ‰€æœ‰è·¯ç”±å™¨çš„wg0æ¥å£ä¸Šçš„æ‰€æœ‰ä¼ å…¥è¿æ¥ã€‚åˆ°ç«¯å£51821çš„UDPä¼ å…¥è¿æ¥ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å¸Œæœ›æœ¬æ–‡å¯¹æŸäººæœ‰ç”¨ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–ï¼Œæˆ‘æƒ³å…±äº«æˆ‘çš„è„šæœ¬ï¼Œå½“ç½‘ç»œä¸Šå‡ºç°æ–°è®¾å¤‡æ—¶ï¼Œè¯¥è„šæœ¬ä¼šåœ¨ç”µè¯ä¸­å‘æˆ‘å‘é€ä¸€ä¸ªPUSHé€šçŸ¥åˆ°WirePusheråº”ç”¨ç¨‹åºã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯è„šæœ¬çš„é“¾æ¥ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/r0ck3r/device_discover</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ–°ï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é…ç½®OpenVPNæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVPNæœåŠ¡å™¨</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">client-to-client<font></font>
<font></font>
ca /etc/openvpn/server/ca.crt<font></font>
cert /etc/openvpn/server/vpn-server.crt<font></font>
dh /etc/openvpn/server/dh.pem<font></font>
key /etc/openvpn/server/vpn-server.key<font></font>
<font></font>
dev tap<font></font>
ifconfig-pool-persist /etc/openvpn/ipp.txt 0<font></font>
keepalive 10 60<font></font>
proto tcp4<font></font>
server-bridge 192.168.10.1 255.255.255.0 192.168.10.80 192.168.10.254<font></font>
status /var/log/openvpn-status.log<font></font>
verb 3<font></font>
comp-lzo</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVPNå®¢æˆ·ç«¯</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">client<font></font>
tls-client<font></font>
dev tap<font></font>
proto tcp<font></font>
remote VPS_IP 1194 # Change to your router's External IP<font></font>
resolv-retry infinite<font></font>
nobind<font></font>
<font></font>
ca client/ca.crt<font></font>
cert client/client.crt<font></font>
key client/client.key<font></font>
dh client/dh.pem<font></font>
<font></font>
comp-lzo<font></font>
persist-tun<font></font>
persist-key<font></font>
verb 3</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”Ÿæˆä½¿ç”¨easy-rsaçš„è¯ä¹¦</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN486864/">https://habr.com/ru/post/zh-CN486864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN486844/index.html">Facebook Webhookå¤„ç†çš„æ¼”å˜ï¼šä»é›¶åˆ°æ¯ç§’25,000</a></li>
<li><a href="../zh-CN486850/index.html">æ–°é¢„ç•™çš„åº§ä½-å¦‚èƒ¶å›Šæ—…é¦†</a></li>
<li><a href="../zh-CN486858/index.html">åˆ›å»ºä¸€ä¸ªæˆç†Ÿçš„Viberbotã€‚ç¬¬äºŒéƒ¨åˆ†-é¦–æ¬¡è”ç³»æˆ–â€œ conversion_startedâ€</a></li>
<li><a href="../zh-CN486860/index.html">ATX12VO-åƒä¸€ç§æ–°æ–¹æ³•</a></li>
<li><a href="../zh-CN486862/index.html">è¿åŠ¨è®¾è®¡å¯å¸®åŠ©æ‚¨ä¸äººå»ºç«‹è”ç³»çš„5ä¸ªåŸå› </a></li>
<li><a href="../zh-CN486866/index.html">åŒæ­¥ä¿¡å·ï¼šçº³ç±³æŠ€æœ¯ä¸­çš„ç”Ÿç‰©é©¬è¾¾</a></li>
<li><a href="../zh-CN486868/index.html">ä¸ºä»€ä¹ˆå’Œä¸ºè°åšSlime Agile</a></li>
<li><a href="../zh-CN486870/index.html">æˆ‘ä»¬å¦‚ä½•æ‘†è„±æ¬ºè¯ˆ</a></li>
<li><a href="../zh-CN486872/index.html">çš„Linux é”®ç›˜è®¾å®š</a></li>
<li><a href="../zh-CN486874/index.html">å† çŠ¶ç—…æ¯’2019-nCoVï¼šä½æ­»äº¡ç‡ï¼Œé«˜æ­»äº¡ç‡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>