<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤮 👨🏼‍🏫 💅🏿 YouTubeで24時間動画を配信する 🎨 💛 👨🏿‍🤝‍👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、趣味でおなじみの心理学者の講義をビデオで撮影しています。フッテージをマウントして自分のウェブサイトに公開しています。 1か月前、私はこれらの講義を24時間体制で24時間体制でYouTubeで放送するというアイデアを得ました。個人の成長に特化したテーマ別の「チャネル」の一種。
 
 通常の放送の...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>YouTubeで24時間動画を配信する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493352/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、趣味でおなじみの心理学者の講義をビデオで撮影しています。フッテージをマウントして自分のウェブサイトに公開しています。 1か月前、私はこれらの講義を24時間体制で24時間体制でYouTubeで放送するというアイデアを得ました。個人の成長に特化したテーマ別の「チャネル」の一種。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常の放送の作り方は知っています。しかし、それをビデオファイルのブロードキャストにする方法は？彼女が24時間年中無休で歩き、柔軟性があり、可能な限り自律的であると同時に、自宅のコンピューターに依存していなかった。これは私が見つけなければならなかったものでした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/vn/5u/tivn5utlpr-vmldtf9dh5hh7fku.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解決策を見つけるのに数日かかりました。私は多くのフォーラムやさまざまなマニュアルを勉強しましたが、それがなければ私の放送はまったくわかりませんでした。そして今、いたずらが成功したとき、私は私の決定を共有する必要性を感じています。そこでこの記事が登場しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、最終的なソリューションは次のとおりです</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。VPS+ ffmeg + bashスクリプト</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">カットの下で、私は取られた手順を説明し、放送中に発見された「落とし穴」について話します。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ1-放送はどこから始まりますか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、放送がどこで行われ、どこでソースが行われるかを決定する必要がありました。最初に頭に浮かんだのは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、自宅のコンピュータから</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でした。プレイリストにビデオを収集し、任意のビデオプレーヤーで再生します。次に、画面イメージをキャプチャして、YouTubeにブロードキャストします。しかし、私はこのオプションをすぐに却下しました。それを実装するには、自宅のコンピューターを常にオンにしておく必要があります。これは、夜間でもクーラーからのノイズであり、エネルギー消費量が増加します（毎月+100〜150 kWh）。また、放送中は自宅のコンピュータを使用できないことがわかりました。マウスの動きはブロードキャストで表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それから私は</font><b><font style="vertical-align: inherit;">クラウドサービス</font></b><font style="vertical-align: inherit;">に目を向け始めました</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。動画をアップロードしたり、たとえばYouTubeから動画へのリンクを挿入したりして、すべてを1つのノンストップブロードキャストにまとめることができる既製のサービスを探していました。しかし、適切なものは何も見つかりませんでした。多分私はひどく見ていました。機能に適しているのは、複数のプラットフォームで同時にブロードキャストするのに役立つサービスであるrestream.ioだけです。彼らは自分のビデオをアップロードできるようです。しかし、このサービスはまったく異なる目的のために作成されたものであり、放送は数時間しか続かないと期待しています。このサービスを通じて24時間体制の放送を編成できれば、月に数十ドル、場合によっては数百ドルの費用がかかると思います。しかし、私はまだ無料で、または最小限の投資で放送を編成したいと思っていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
放送する必要があることが明らかになりました</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のデバイス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または別のコンピューター。 Raspberri Piのようなものを考えています。そして何？彼はクーラーを持っていません。 USBフラッシュドライブにビデオを録画し、イーサネットケーブルを貼り付けて、人里離れた場所のどこかにそれを置くと、放送されます。オプション。しかし、ボード自体もボードの経験もなかったため、このオプションも拒否しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局、私は彼らが</font><b><font style="vertical-align: inherit;">あなた自身のサーバーを</font></b><font style="vertical-align: inherit;">作ることを議論する議論に出会いました</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放送。これはまさに私が探していたものではありませんでしたが、私は主なアイデアを見つけました-サーバーを使用できます！その議論で、彼らはVPS + nginx + OBSの束の使用を提案しました。この束が私に合うことが明らかになった。私を混乱させた唯一のことは、サーバーを管理したことがなく、専用サーバーが混乱していて高価であるように思えたことです。最小限の構成でサーバーをレンタルするのにどれくらいの費用がかかるかを調べることにしましたが、うれしい驚きでした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mu/v8/ms/muv8msmvpgnhzj9z04nuhv_y0-s.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
価格はベラルーシルーブルであり、彼らはちょうどパン粉です。理解のために、8ベラルーシルーブルは、約3.5ドルまたは240ロシアルーブルです。 1か月間、24時間365日稼働し、高速インターネットアクセスが可能な本格的なコンピューターを使用しています。どういうわけか、この発見は私にとって非常に嬉しかったです。そして、数日間、宇宙ロケットを発見した子供のようにひどく喜んで歩きました:) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、私はGoogleがリクエストした「VPSレンタル」の最初のサイトの提供を利用しました。おそらくさらに多くの予算ソリューションがありますが、この価格は私に適していて、それ以上は調べませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーを作成するときに、サーバーが動作するオペレーティングシステムを選択できます。</font><font style="vertical-align: inherit;">リストされているどのシステムでも、ブロードキャストを整理して、好みや財務機能に基づいて選択できます（Windowsを搭載したサーバーには追加料金がかかります）。</font><font style="vertical-align: inherit;">CentOSを選びました。</font><font style="vertical-align: inherit;">私は彼女と少しの経験があったからです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/0a/wh/cv0awhhxim1w2fgglkrlupl5hgc.jpeg" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ2-サーバーのセットアップ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーを作成した後に最初に必要なことは、SSH経由でサーバーに接続することです。</font><font style="vertical-align: inherit;">最初はPuTTyを使用していましたが、その後、Google Chromeで実行されるSecure Shell Appを使い始めました。</font><font style="vertical-align: inherit;">それで、私にとってはより便利であることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ホスト名を変更し、サーバー上で時間同期を設定し、システムを更新し、iptablesをいじりました...そして、それが必要だったためではありませんでした。</font><font style="vertical-align: inherit;">サーバーをセットアップするのは私にとって興味深いだけで、うまくいきました。</font><font style="vertical-align: inherit;">それが判明したときに私は大好き</font><b><font style="vertical-align: inherit;">です</font></b><font style="vertical-align: inherit;"> :) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、実行する必要があるそれらのステップ：</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPELリポジトリーを接続します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTPサーバーを起動します（私はvsftpを選択しました）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ffmpegをインストールします。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チームの詳細については触れません。この指示は、一般的な行動計画を伝えるための概念的なものです。いずれかの手順で問題が発生した場合は、「CentOS connect EPEL」や「CentOS FTPサーバーのインストール」などの検索エンジンでクエリを実行することにより、問題をすばやく解決できます。また、最初のリンクには、詳細なステップバイステップの説明があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、以前に書いたように、一連のVPS + nginx + OBSが必要でした。 VPS-準備完了。しかし、ここで残りのポイントで質問が生じ始めました。 OBSは、放送プログラムであるOpen Broadcaster Softwareです。そして、それはスレッドでのみ機能します。たとえば、Webカメラから画像を取得してブロードキャストします。または画面録画。または、すでに進行中のブロードキャストが別のサイトにリダイレクトします。ストリームはありません。ストリームを作成するために必要なビデオファイルのセットしかありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はこの方向に掘り始め、ffmpegに出くわしました。</font><font style="vertical-align: inherit;">FFmpegは、デジタルオーディオおよびビデオの録音をさまざまな形式で録音、変換、転送できる無料のオープンソースライブラリのセットです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、私はffmpegがどれだけできるかを非常に驚きました。</font><font style="vertical-align: inherit;">必要に応じて、ビデオからサウンドを引き出します。</font><font style="vertical-align: inherit;">必要に応じて、トランスコードせずにビデオの断片を切り取ります。</font><font style="vertical-align: inherit;">必要に応じて、ある形式から別の形式に変換します。</font><font style="vertical-align: inherit;">そして、はるかに。</font><font style="vertical-align: inherit;">彼のためにファイルを指定できるようになるまで、彼はそれをストリームに変換し、自分でYouTubeに転送します。</font><font style="vertical-align: inherit;">すべて、チェーンが組み立てられます。</font><font style="vertical-align: inherit;">それはニュアンスを洗練するためだけに残っています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ3-ブロードキャストのセットアップ</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTubeでブロードキャストを作成します。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この段階では、リンクと翻訳キーだけが必要です。</font><font style="vertical-align: inherit;">下のスクリーンショットでは、赤で強調表示されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gr/a3/oo/gra3oogooafzdfjzhlqdqjjxr8o.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font><font style="vertical-align: inherit;">ブロードキャストする予定</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のサーバーにビデオファイルをアップロードします</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">実際、FTPはこの段階でのみ必要です。</font><font style="vertical-align: inherit;">サーバーにファイルをアップロードする別の便利な方法がある場合は、FTPサーバーを省略できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTubeにストリーミングしています。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロードキャストを開始するには、いくつかの属性を指定してffmpegを実行する必要があります。</font><font style="vertical-align: inherit;">これが私が得た最短のコマンドです：</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性の復号化</font></font></b><div class="spoiler_text"><code>-re</code> – ,      .<br>
<br>
<code>-i</code> – ,    . ,       ,    -.       ,  <code>/usr/media/lecture1.mp4</code>.<br>
<br>
<code>-f</code> –    .    ,  ffmpeg « »     mp4  flv.<br>
<br>
    ,     YouTube     .. ,     ,   ,       .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてを正しく行った場合、このコマンドを実行すると、送信されたストリームがYouTubeに表示されます。</font><font style="vertical-align: inherit;">配信を開始するには、YouTube自体の[配信開始]ボタンをクリックするだけです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ4-自律性を追加する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おめでとう！これで、ビデオファイルからブロードキャストを開始する方法がわかりました。しかし、これは24時間の放送には十分ではありません。最初の動画の再生が終了するとすぐに次の動画が開始され、すべての動画が表示されたら、もう一度最初から再生することが重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は次のオプションを思いつきました：各ビデオファイルのコマンドを登録した.shファイルを作成し、最後に同じスクリプトを再起動するコマンドを示しました。それは一種の再帰でした：</font></font><br>
<br>
<pre><code class="bash hljs"> 1... (   lecture1.mp4)<font></font>
 2... (   lecture2.mp4)<font></font>
 3... (   lecture3.mp4)<font></font>
bash start.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、はい、それはうまくいきました。私は自分に満足して、テスト放送を開始し、眠りについた。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
朝、不愉快な驚きが待っていました。放送はほんの数分だけ続き、コンピュータの電源を切るとほぼ即座に終了したことがわかりました。調査の結果、この方法で起動されたコマンドは、ユーザーがサーバー上で承認されている間に実行されることがわかりました。切断するとすぐに、開始したコマンドの実行が中断されました。これを防ぐに</font></font><code>bash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、チームの</font><font style="vertical-align: inherit;">前に</font><font style="vertical-align: inherit;">チーム</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加する</font><font style="vertical-align: inherit;">だけで十分</font></font><code>nohup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。これにより、ユーザーの存在に関係なく、実行中のプロセスを実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトの最終的な最小バージョンは次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture2.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture3.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
nohup bash start.sh $</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、start.shは、このスクリプトが記述されているファイルです。</font><font style="vertical-align: inherit;">そして、このファイルはビデオファイルと同じディレクトリに配置する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後にドル記号を追加すると、プロセスをバックグラウンドで開始できるため、ブロードキャストを中断せずにコンソールを使い続けることができます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボーナスから、次のバンズが判明しました：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの再生を手動で切り替えることができます。</font><font style="vertical-align: inherit;">これを行うには、現在実行中のffmpegプロセスを「強制終了」する必要があります。</font><font style="vertical-align: inherit;">その後、リストの次のファイルの再生が自動的に開始されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロードキャストを停止せずに、新しいビデオをブロードキャストに追加できます。</font><font style="vertical-align: inherit;">ビデオをサーバーにアップロードし、スクリプトでこのファイルを実行するコマンドを追加して保存します。</font><font style="vertical-align: inherit;">以上です。</font><font style="vertical-align: inherit;">次の再生ラウンドでは、新しいファイルは古いファイルとともにすでにブロードキャストされます。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ5-ffmpegを構成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これについては、原則として、止めることができます。しかし、私は放送を視聴者にとってもう少し親しみやすいものにしたかったのです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある人が放送に行って視聴を始め、彼がそれを気に入ってこの講義を最初から見たいと思ったとします。放送には巻き戻しは含まれていません。講義を最初から見るには、私のWebサイトにアクセスして、興味のある講義の記録を取得する必要があります。そして、どの講義が彼に興味を持っているかをどのように理解するのですか？このサイトには16の講義があり、毎週それ以上しかありません。これらの講義をすべて撮影して編集した私でさえ、ランダムな断片からどの講義であるかを判別することはできないと思います。したがって、各講義はなんとかして指定する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
編集プログラムでソースビデオファイルにキャプションを追加するオプションは、私には適していませんでした。</font><font style="vertical-align: inherit;">元のファイルが使用されていることを確認する必要がありました。</font><font style="vertical-align: inherit;">私から要求される放送をできるだけ体の動きを少なくするために。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ffmpegもこれで私を助けることができることがわかりました。</font><font style="vertical-align: inherit;">それは</font></font><code>-vf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたがビデオの上にテキストを置くことを可能に</font><font style="vertical-align: inherit;">する特別な属性</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">持っています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ビデオにテキストを追加するには、次のフラグメントをコマンドに追加する必要があります。</font></font><br>
<br>
<pre><code class="bash hljs">-vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 13\:  .   ?':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span></code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータのデコード</font></font></b><div class="spoiler_text"><code>fontfile=</code> –    .       .          .        .<br>
<br>
<code>text=</code> – ,  ,     .<br>
<br>
<code>fontsize=</code> –    .<br>
<br>
<code>fontcolor=</code> –  .<br>
<br>
<code>borderw=</code> –       (         1 ).<br>
<br>
<code>bordercolor=</code> –  .<br>
<br>
<code>x=</code>  <code>y=</code> –  .  <code>0;0</code>     .      ,           1280720 .<br>
</div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のようになります。</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/jf/1n/sh/jf1nshia1hbk30-pjd5y6mztga0.jpeg" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ6-放送品質を決定する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべて、放送の準備が整いました。 FFmpegブロードキャスト、ファイル再生、私の存在はブロードキャストには必要ありません。すべての講義にも署名されています。それのように見えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、別のニュアンスが浮上しました-私は最小サーバー構成を選択しました、そしてそれは放送を引き出しませんでした。サーバー構成：1コア（2.2 GHzなど）、1ギガバイトのRAM、25 GB SSD。十分なRAMがありましたが、プロセッサはほぼ完全に100％（場合によっては102-103％でも）の読み込みを開始しました。これにより、数秒ごとにブロードキャストがフリーズしました。醜い。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのコアを使用したより高価な構成を採用することもできます。その利点は、クラウドテクノロジーを使用すると、いくつかのボタンを押すことでサーバー構成が変更されることです。</font><font style="vertical-align: inherit;">しかし、私は最小構成の力に適合したかった。</font><font style="vertical-align: inherit;">私はffmpegのドキュメントを調べ始めました。そうです、システムの負荷を調整できる設定もあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
高画質は、2つの方法で実現できます。高いプロセッサ負荷、または大きな送信トラフィックです。</font><font style="vertical-align: inherit;">プロセッサが負荷を引き受けることができるほど、チャネルが必要とする帯域幅が少なくなることがわかります。</font><font style="vertical-align: inherit;">または、プロセッサに大きな負荷をかけることはできませんが、大きなトラフィックマージンを持つ広いチャネルが必要になります。</font><font style="vertical-align: inherit;">プロセッサと発信チャネル/トラフィックのサイズの両方に制限がある場合は、放送がスムーズに進むように画質を下げる必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のサーバーには10 Mbpsチャネルがあります。この幅はマージンのある直線です。ただし、トラフィックの制限があります-1か月あたり1 TB。したがって、トラフィック制限を満たすために、私の発信ストリームは毎秒約300 Kbを超えてはなりません。発信ストリームのビットレートは2.5 Mbps以下である必要があります。ちなみに、YouTubeはこのようなビットレートでの放送を推奨しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ffmpegはさまざまなアプローチを使用してシステムの負荷を調整します。よく</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書いてあり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。最終的に、2つの属性を使用することになりました：</font></font><code>-crf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>-preset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定率係数（CRF）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-これは、画質を調整できる係数です。</font><font style="vertical-align: inherit;">CRFの範囲は0〜51です。0はソースファイルの品質、51は可能な限り最悪の品質です。</font><font style="vertical-align: inherit;">17から28までの値を使用することをお勧めします。デフォルトは23です。比率が17の場合、ビデオはオリジナルと視覚的には同じになりますが、技術的には異なります。</font><font style="vertical-align: inherit;">ドキュメントには、指定されたCRFに応じて、最終的なビデオのサイズが指数関数的に変化することも記載されています。</font><font style="vertical-align: inherit;">係数を6ポイント増やすと、送信ビデオのビットレートが2倍になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CRFを使用する場合は、送信画像の「重み」を選択できます。次に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プリセット（-preset）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、プロセッサにロードする量を決定できます。</font><font style="vertical-align: inherit;">この属性のパラメーターには次のものがあります。</font></font><br>
<br>
<ul>
<li><code>ultrafast</code></li>
<li><code>superfast</code></li>
<li><code>veryfast</code></li>
<li><code>faster</code></li>
<li><code>fast</code></li>
<li><code>medium</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -デフォルト値</font></font></li>
<li><code>slow</code></li>
<li><code>slower</code></li>
<li><code>veryslow</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータが「高速」に指定されているほど、プロセッサの負荷が高くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は最初に、基本的にプロセッサーにとって「タフ」なプリセットをピックアップし、次にCRFを使用して負荷をさらに微調整しました。</font><font style="vertical-align: inherit;">私の場合、プリセットが表示され</font></font><code>fast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、CRFの場合は24の値で解決しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です。</font><font style="vertical-align: inherit;">ブロードキャストを開始するための最後のコマンドは次のとおりです。</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 1\:   ':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span> -c:v libx264 -preset fast -crf 24 -g 3 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、説明されていない瞬間が2つだけあります</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。1）</font></font><code>-c:v libx264</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ソースファイルを操作するための特定のコーデックを示します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2）</font></font><code>-g 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-キーフレームの数を明示的に示します。この場合、3フレームごとにキーを指定する必要があることが示されています。標準値は5または8であるが、YouTubeの誓いは、少なくとも3尋ねる</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見ることができる何判明放送の品質を</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーの負荷は次のとおりです。</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/b5/3s/za/b53szauaywx3bdwoic-yebil1es.jpeg" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/cq/jc/t4/cqjct4xhbz3zabriimgydbxvjaq.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
監視データに基づいて、プロセッサの負荷が70％から95％に変化し、ブロードキャストが1週間で100％で停止したことがないことは明らかです。したがって、これらの設定では、プロセッサで十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクをロードするときは、ほとんどロードされておらず、ブロードキャストには通常のHDDで十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、発信トラフィックの量は私を困らせます。私の発信ストリームの範囲は、毎秒450〜650 KBであることがわかりました。 1か月で約1.8テラバイトになります。トラフィックを購入するか、デュアルコア構成に切り替える必要がある場合があります。画質を落としたくない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果として、そのようなブロードキャストをゼロからセットアップするには、約1〜2時間かかります。さらに、ほとんどの場合、サーバーへのビデオのアップロードに時間がかかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マーケティングツールとして、このような放送の開始は報われませんでした。おそらく、YouTubeのアルゴリズムがこの放送をピックアップして推奨に積極的に表示するようにビューを巻き上げると、何かがうまくいくでしょう。私の場合、16日間の連続放送で58回視聴されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは大丈夫です。私のサイトのメインページに調和して放送が適合します。講師と講義そのものをすぐに決断するような機会でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして一瞬。ブロードキャストが他人の著作権を侵害しないことが重要です。それ以外の場合はブロックされます。放送は落ち着いています。私は特別に無料で使用できる音楽インサートを選択しました。コンテンツの作成者は隣のコンピューターに座っており、コンテンツの使用にまったく反対しません:)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ラジオをバックグラウンドでバックグラウンドで再生している場合、または編集中にお気に入りのトラックを使用した場合、または人気のミュージックビデオ、シリーズ、または映画からビデオを撮影した場合、ブロードキャストが危険にさらされます。</font><font style="vertical-align: inherit;">ブロードキャストが少なくとも最小限のセマンティックロードを運ぶことも重要です。それ以外の場合は、スパムとしてブロックされる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これですべてです。</font><font style="vertical-align: inherit;">このマニュアルが誰かに役立つことを願っています。</font><font style="vertical-align: inherit;">まあ、あなたが何かを追加する場合-書く場合、私は記事への追加と説明を喜んで読みます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja493336/index.html">コンピュータサイエンスセンターがオンラインで学習を翻訳した方法</a></li>
<li><a href="../ja493340/index.html">Jiraのバージョン間でSIL関数を移植可能にする</a></li>
<li><a href="../ja493342/index.html">NSPKがudalenkaへの移行のためのインフラストラクチャを準備した方法</a></li>
<li><a href="../ja493346/index.html">私たちはなんとかオフィスをウダレンカに移転しました、そしてあなたは？</a></li>
<li><a href="../ja493348/index.html">「udalenka」を再び素晴らしいものにする：会社全体を4つの段階でリモート作業に転送する方法</a></li>
<li><a href="../ja493356/index.html">ビデオ@Databases Meetup：DBMSセキュリティ、IoTのTarantool、ビッグデータ分析のためのGreenplum</a></li>
<li><a href="../ja493360/index.html">アルゴールからの2本の指</a></li>
<li><a href="../ja493362/index.html">「スーツケースの」テクニカルサポート。不必要な神経を使わずにリモートで作業し、リモートで必要なサービスを取得する方法</a></li>
<li><a href="../ja493366/index.html">Windows PowerShellとは何で、何を食べますか？パート3：スクリプトと関数にパラメーターを渡す、コマンドレットを作成する</a></li>
<li><a href="../ja493374/index.html">コロナウイルス-実用的なヒントと理論</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>