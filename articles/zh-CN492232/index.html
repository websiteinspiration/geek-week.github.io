<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗽 🍿 🏇🏽 Smartcalls如何成为Voximplant Kit的品牌-品牌重塑和杀手features 🧙🏼 🌑 ♌️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="长期以来，我们一直在准备对Smartcalls进行更新，这是用于拨出电话的可视化编辑器，现在它发生了。今天，在剪裁的基础上，我们将讨论UI / UX的更改，并在演示模式下进行深入了解，以了解如何驯服JointJS。
 
 实际发生了什么变化？
 最明显的是-一个新的名称和URL，这意味着可以在相应的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Smartcalls如何成为Voximplant Kit的品牌-品牌重塑和杀手features</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/492232/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/by/c2/ih/byc2ihl70ggcz-ftm-a4ziskyvo.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
长期以来，我们一直在准备对Smartcalls进行更新，这是用于拨出电话的可视化编辑器，现在它发生了。</font><font style="vertical-align: inherit;">今天，在剪裁的基础上，我们将讨论UI / UX的更改，并在演示模式下进行</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深入</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解，以了解如何驯服</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">JointJS</font></a><font style="vertical-align: inherit;">。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际发生了什么变化？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最明显的是-一个新的名称和URL，这意味着可以在相应的链接</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voximplant.com/kit上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到Voximplant Kit </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们还修改了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册页面</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，现在是这样的：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/jh/vc/cljhvcpw84_miyo3xcr8tsamgwo.png" alt="图片"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管概念保持不变，但产品界面已发生了很大变化，变得更加用户友好。</font><font style="vertical-align: inherit;">顶部菜单移至左侧，这使浏览块更加合理和方便。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zr/9y/hf/zr9yhfrpoz4qjawojzkqgdl5kpa.png" alt="图片"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，现在还可以对脚本和录音进行分组和排序，按号码搜索以及带有简短信息的广告牌，包括新的指标-成功呼叫的平均持续时间和花费的总金额。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/yf/12/kgyf12bkj5jjx_cffukvfnqnk7g.png" alt="图片"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
至于集成：用户友好的界面进入了邮件设置，并且在Dialogflow，SIP，全局变量选项卡上，出现了按ID和主机对文件进行搜索和排序的操作。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sr/wm/dj/srwmdjgvejupi9urypqn1iyglzk.png" alt="图片"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 总的来说，很多新颖而酷！</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的博客中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解有关更改的更多信息</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是最重​​要的是编辑</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
演示模式（扰流板：这是主要的杀手级功能）。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7m/po/du/7mpoduas-ap0m6lbi-o12g9eyd0.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实时脚本执行，突出显示所涉及的块，并在执行后-调用（流和日志）的结果，使脚本的调试更加轻松和快捷。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_i/vl/0a/_ivl0ayzlmrojpumqdf_knc99ie.png" alt="图片"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">观看演示模式的视频，也可以</font><font style="vertical-align: inherit;">在注册</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voximplant Kit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">自行进行</font></a><font style="vertical-align: inherit;">测试</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以及如何实现所有这些，我们将在下一节中介绍。</font><font style="vertical-align: inherit;">编辑器的新功能：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">撤消/重做（下图中的1）；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">热键（2）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弹出菜单，您可以一键式对齐块和块之间的链接，更改比例，使用miniMap，将脚本展开为全屏显示并共享（复制或另存为png）（3）；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右键单击上下文菜单；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制块-不仅在同一脚本内，而且在不同脚本之间，甚至（！）不同的帐户之间；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定/解锁块-可以移动锁定的块，但是无法进行编辑以避免不必要的更改；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色变化-在视觉上，您可以选择几个“相关”块；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按使用块的名称和内容进行搜索；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“交互式菜单”块-只需拖放即可交换位置中的端口（答案选项）的功能。</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wp/fw/u4/wpfwu4ddvz--h5gd0yqm9ipcfzs.png" alt="图片"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们揭示卡片</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在该弄清楚代码中如何实现块动画了。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/qo/cz/zoqoczrubc5rvxijm-cshjukoq0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编辑器调用我们的HTTP API方法-StartScenarios-运行云脚本。</font><font style="vertical-align: inherit;">Voximplant云启动脚本并将其提供给media_access_url编辑器。</font><font style="vertical-align: inherit;">从这一刻起，编辑器每秒拉出media_access_url，以接收有关脚本如何“遍历”块的响应信息-基于此数据，编辑器突出显示必要的块并为它们之间的连接添加动画效果。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
历史记录是具有以下字段的JSON对象：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间戳</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idSource-初始块；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idTarget-最后一块；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口-端口（1个块中可能有多个输出）。</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wl/qt/ht/wlqthtjgn0l2bnwfoqophwregpy.png" alt="图片"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
借助这些自定义和服务变量，前端可以了解在测试期间它将传递给哪个块。</font><font style="vertical-align: inherit;">他怎么理解的？</font><font style="vertical-align: inherit;">进行视觉构造时（添加了一个新块），将立即为其分配一个ID，然后将其在历史记录中用作idSource / idTarget。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了实现此功能，我们使用了JointJS库，但是有一些自写代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们从主要的selectBlock（）方法开始，它的工作方式如下：我们遍历运动历史记录数组（idSource，idTarget），并在找到起点和终点后立即查找它们之间的连接：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> link = <span class="hljs-keyword">this</span>.editor.getTestLink(sourceCell, portId);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果它们之间存在连接，则为沿通讯线运行的球设置动画：</font></font><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (link) <span class="hljs-keyword">this</span>.setLinkAnimation(link);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在this.testHistory的每次更新之后，都会调用selectBlock（）方法。</font><font style="vertical-align: inherit;">由于传递的多个块可以一次到达this.testHistory，因此我们每700毫秒递归调用一次selectBlock（这是动画化从一个块到另一个块的运动所花费的大约时间）：</font></font><br>
<br>
<pre><code class="javascript hljs">setTimeout(<span class="hljs-keyword">this</span>.selectBlock, <span class="hljs-number">700</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此方法的所有代码如下。</font><font style="vertical-align: inherit;">注意第7行和第10行的selectTestBlock和getTestLink方法-现在我们将分别讨论它们：</font></font><br>
<br>
<div class="oembed"><script type="text/javascript" src="https://gist.github.com/5ffed5b2bbb82d4a3eff6df3f153a1ed.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-31007ea0d3bd9f80540adfbc55afc7bd.css"><div id="gist101791201" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-selectblock-js" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-javascript ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-selectblock-js-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-selectblock-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效</font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-selectblock-js-LC2" class="blob-code blob-code-inner js-file-line">     <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historyIndex </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt; </font></font></span> <span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testHistory </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长度</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-selectblock-js-LC3" class="blob-code blob-code-inner js-file-line">       <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const </font></font></span> <span class="pl-s1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historyIndex </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-selectblock-js-LC4" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">targetCellId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">idTarget</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-selectblock-js-LC5" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">sourceCellId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">idSource</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-selectblock-js-LC6" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">portId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">port</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-selectblock-js-LC7" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">targetCell</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">selectTestBlock</span><span class="pl-kos">(</span><span class="pl-s1">targetCellId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-selectblock-js-LC8" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">sourceCell</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">getCell</span><span class="pl-kos">(</span><span class="pl-s1">sourceCellId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-selectblock-js-LC9" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">sourceCell</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">targetCell</span><span class="pl-kos">)</span> <span class="pl-kos">{</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-selectblock-js-LC10" class="blob-code blob-code-inner js-file-line">         <span class="pl-k">const</span> <span class="pl-s1">link</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">getTestLink</span><span class="pl-kos">(</span><span class="pl-s1">sourceCell</span><span class="pl-kos">,</span> <span class="pl-s1">portId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-selectblock-js-LC11" class="blob-code blob-code-inner js-file-line">         <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">link</span><span class="pl-kos">)</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-en">setLinkAnimation</span><span class="pl-kos">(</span><span class="pl-s1">link</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-selectblock-js-LC12" class="blob-code blob-code-inner js-file-line">       <span class="pl-kos">}</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-selectblock-js-LC13" class="blob-code blob-code-inner js-file-line">       <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">historyIndex</span> <span class="pl-c1">+=</span> <span class="pl-c1">1</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-selectblock-js-LC14" class="blob-code blob-code-inner js-file-line">       <span class="pl-en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的setTimeout </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">700 </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-selectblock-js-LC15" class="blob-code blob-code-inner js-file-line">     <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-selectblock-js-LC16" class="blob-code blob-code-inner js-file-line">   <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看原始</font></font></a>
        <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        托管与❤通过</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub上</font></font></a>
      </div>
    </div>
</div>
</div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建立联系</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
getTestLink（）方法有助于获得块之间的连接-它基于getConnectedLinks（），getConnectedLinks（）是内置的JointJS方法，该方法接收块输入并返回链接数组。</font><font style="vertical-align: inherit;">在我们的实现中，我们在结果数组中查找带有端口的链接，其中source属性的值为portId：</font></font><br>
<br>
<pre><code class="javascript hljs">link = <span class="hljs-keyword">this</span>.graph.getConnectedLinks(cell, {<span class="hljs-attr">outbound</span> : <span class="hljs-literal">true</span>}).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> item.get(<span class="hljs-string">'source'</span>).port === portId;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，如果有链接，则突出显示它：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">return</span> link ? (link.toFront() &amp;&amp; link) : <span class="hljs-literal">null</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法代码：</font></font><br>
<br>
<pre><code class="javascript hljs">getTestLink(sourceCell: Cell, <span class="hljs-attr">portId</span>: string): Link {
  <span class="hljs-keyword">let</span> link = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (sourceCell &amp;&amp; sourceCell.id) {
    <span class="hljs-keyword">let</span> cell = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (sourceCell.type === <span class="hljs-string">'ScenarioStart'</span> || sourceCell.type === <span class="hljs-string">'IncomingStart'</span>) {<font></font>
      cell = <span class="hljs-keyword">this</span>.getStartCell()<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      cell = <span class="hljs-keyword">this</span>.graph.getCell(sourceCell.id);<font></font>
    }<font></font>
    link = <span class="hljs-keyword">this</span>.graph.getConnectedLinks(cell, {<span class="hljs-attr">outbound</span> : <span class="hljs-literal">true</span>}).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> item.get(<span class="hljs-string">'source'</span>).port === portId;<font></font>
    });<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> link ? (link.toFront() &amp;&amp; link) : <span class="hljs-literal">null</span>;<font></font>
}<font></font>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以通过JointJS完全实现奔跑球的动画（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们移到当前区块</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当需要选择最后一块并将画布移动到该块时，我们调用selectTestBlock（）方法。</font><font style="vertical-align: inherit;">这里我们得到块中心的坐标：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> center = cell.getBBox().center();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后调用setTestCell（）为块着色：</font></font><br>
<br>
<pre><code class="javascript hljs">editor.tester.setTestCell(cell);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，我们使用自编写的zoomToCell（）函数将其缩放到其中心（这是最有趣的，但最后是关于它的）：</font></font><br>
<br>
<pre><code class="javascript hljs">editor.paperController.zoomToCell(center, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法代码：</font></font><br>
<br>
<pre><code class="javascript hljs">selectTestBlock(id: string): Cell {
 <span class="hljs-keyword">const</span> cell = (id === <span class="hljs-string">'ScenarioStart'</span>) ? editor.tester.getStartCell() : editor.graph.getCell(id);
 <span class="hljs-keyword">if</span> (cell) {
   <span class="hljs-keyword">const</span> center = cell.getBBox().center();<font></font>
   editor.tester.setTestCell(cell);<font></font>
   editor.paperController.zoomToCell(center, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);<font></font>
 }<font></font>
 <span class="hljs-keyword">return</span> cell;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
着色方法：找到我们块的SVG元素，并添加CSS类.tested使块颜色：</font></font><br>
<br>
<pre><code class="javascript hljs">setTestCell(cell: Cell): <span class="hljs-keyword">void</span> {
 <span class="hljs-keyword">const</span> view = cell.findView(<span class="hljs-keyword">this</span>.paper);
 <span class="hljs-keyword">if</span> (view) view.el.classList.add(<span class="hljs-string">'is-tested'</span>);<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平滑缩放</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，zoomToCell（）！ JointJS有一个内置的方法可以沿着X和Y轴移动画布，起初他们想拿它。但是，此方法使用transform作为SVG标签的属性，它不支持Firefox +浏览器中的平滑动画，而仅使用CPU。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们做了一个小技巧-写了我们的函数zoomToCell（），实质上，它执行相同的操作，但是将转换强制转换为内联CSS，这允许使用GPU进行渲染（因为WebGL已连接到进程）。因此，解决了跨浏览器兼容性的问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们的功能不仅使画布沿XY移动，还允许我们通过使用变换矩阵同时缩放（缩放）。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.animate-viewport类的will-change属性告诉浏览器该元素将被更改，并且必须应用优化，包括使用GPU，transition属性设置将画布移动到块的平滑度：</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-class">.animate-viewport</span> {
 <span class="hljs-attribute">will-change</span>: transform;
 <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.5s</span> ease-in-out;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们所有的方法代码如下：</font></font><br>
<br>
<pre><code class="javascript hljs">public zoomToCell(center: g.Point, <span class="hljs-attr">zoom</span>: number, <span class="hljs-attr">offset</span>: boolean = <span class="hljs-literal">true</span>): <span class="hljs-keyword">void</span> {
   <span class="hljs-keyword">this</span>.updateGridSize();
   <span class="hljs-keyword">const</span> currentMatrix = <span class="hljs-keyword">this</span>.paper.layers.getAttribute(<span class="hljs-string">'transform'</span>);
   <span class="hljs-comment">//   svg-,        center</span>
   <span class="hljs-comment">//   ,     style</span>
   <span class="hljs-keyword">const</span> { a, b, c, d, e, f } = <span class="hljs-keyword">this</span>.zoomMatrix(zoom, center, offset);
   <span class="hljs-comment">//  FireFox    ,       </span>
   <span class="hljs-keyword">this</span>.paper.layers.style.transform = currentMatrix;
   <span class="hljs-comment">//    FF  ,     ,    </span>
   setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">//  CSS- .animate-viewport,    - transition;</span>
     <span class="hljs-comment">//    style      - transition</span>
     <span class="hljs-keyword">this</span>.paper.layers.classList.add(<span class="hljs-string">'animate-viewport'</span>);
     <span class="hljs-keyword">this</span>.paper.layers.style.transform = <span class="hljs-string">`matrix(<span class="hljs-subst">${ a }</span>, <span class="hljs-subst">${ b }</span>, <span class="hljs-subst">${ c }</span>, <span class="hljs-subst">${ d }</span>, <span class="hljs-subst">${ e }</span>, <span class="hljs-subst">${ f }</span>)`</span>;
     <span class="hljs-keyword">const</span> duration = <span class="hljs-built_in">parseFloat</span>(getComputedStyle(<span class="hljs-keyword">this</span>.paper.layers)[<span class="hljs-string">'transitionDuration'</span>]) * <span class="hljs-number">1000</span>;
     <span class="hljs-comment">//        style;</span>
     <span class="hljs-comment">//      joint</span>
     setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
       <span class="hljs-keyword">this</span>.paper.layers.classList.remove(<span class="hljs-string">'animate-viewport'</span>);
       <span class="hljs-keyword">this</span>.paper.layers.style.transform = <span class="hljs-literal">null</span>;
       <span class="hljs-keyword">this</span>.paper.matrix(newMatrix);
       <span class="hljs-keyword">this</span>.paper.trigger(<span class="hljs-string">'paper:zoom'</span>);
       <span class="hljs-keyword">this</span>.updateGridSize();
       <span class="hljs-keyword">this</span>.paper.trigger(<span class="hljs-string">'paper:update'</span>);<font></font>
     }, duration);<font></font>
   }, <span class="hljs-number">100</span>);<font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明，有时甚至最高级的文件也都需要完成一个文件:)我们希望您喜欢挖鲸的内部（无论听起来多么令人毛骨悚然）。</font><font style="vertical-align: inherit;">我们希望您使用Voximplant Kit等成功开发！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN492218/index.html">要记住的图标设计规则</a></li>
<li><a href="../zh-CN492220/index.html">熊猫的5个鲜为人知的秘密</a></li>
<li><a href="../zh-CN492222/index.html">撰写的CTFZone Quals 2019：鸡肉</a></li>
<li><a href="../zh-CN492226/index.html">托管Kubernetes的价格比较（2020）</a></li>
<li><a href="../zh-CN492228/index.html">正如Sports.ru写的所见即所得编辑器</a></li>
<li><a href="../zh-CN492234/index.html">研究：为什么人们准备减少在社会项目中的收入</a></li>
<li><a href="../zh-CN492242/index.html">M5Stack及其联系人</a></li>
<li><a href="../zh-CN492244/index.html">冠状病毒清除期：家庭“逮捕”或机会时机？</a></li>
<li><a href="../zh-CN492246/index.html">冠状病毒：对社会，经济和医学的可能影响</a></li>
<li><a href="../zh-CN492248/index.html">用React Hooks防弹跳</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>