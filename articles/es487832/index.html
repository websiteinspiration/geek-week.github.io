<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïô ü§õüèæ üòÑ Creaci√≥n de Minecraft en una semana en C ++ y Vulkan ‚òùüèª üê∂ ü•Å</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Me propuse la tarea de recrear Minecraft desde cero en una semana usando mi propio motor en C ++ y Vulkan. Me inspir√≥ Hopson , que hizo lo mismo con C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Creaci√≥n de Minecraft en una semana en C ++ y Vulkan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487832/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Me propuse la tarea de recrear Minecraft desde cero en una semana usando mi propio motor en C ++ y Vulkan. </font><font style="vertical-align: inherit;">Me inspir√≥ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopson</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que hizo lo mismo con C ++ y OpenGL. </font><font style="vertical-align: inherit;">A su vez, se inspir√≥ en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shane Beck</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , quien se inspir√≥ en Minecraft, cuya fuente de inspiraci√≥n fue Infiniminer, cuya creaci√≥n, presumiblemente, se inspir√≥ en la miner√≠a real.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa1/8b2/50c/aa18b250ce4120bd3a0dc94c01a63621.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El repositorio de GitHub para este proyecto est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cada d√≠a tiene su propia etiqueta git. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, no plane√© recrear literalmente Minecraft. </font><font style="vertical-align: inherit;">Se supon√≠a que este proyecto era educativo. </font><font style="vertical-align: inherit;">Quer√≠a aprender a usar Vulkan en algo m√°s complicado que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulkan-tutorial.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o la demostraci√≥n de Sasha Willem. </font><font style="vertical-align: inherit;">Por lo tanto, el √©nfasis principal est√° en el dise√±o del motor Vulkan, y no en el dise√±o del juego.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tareas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El desarrollo en Vulkan es mucho m√°s lento que en OpenGL, por lo que no pude incorporar muchas de las caracter√≠sticas de este Minecraft en el juego. </font><font style="vertical-align: inherit;">No hay mobs, ni artesan√≠as, ni piedra roja, ni f√≠sica de bloques, etc. </font><font style="vertical-align: inherit;">Desde el principio, los objetivos del proyecto fueron los siguientes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear un sistema de representaci√≥n del terreno</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trituraci√≥n</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encendiendo</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear un sistema generador de terreno</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alivio</font></font></li>
</ul><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arboles</font></font></li>
</ul><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biomas</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregar la capacidad de cambiar el terreno y mover bloques</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Necesitaba encontrar una manera de implementar todo esto sin agregar una GUI al juego, porque no pude encontrar ninguna biblioteca de GUI que funcionara con Vulkan y fuera f√°cil de integrar.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliotecas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, no iba a escribir una aplicaci√≥n Vulkan desde cero. </font><font style="vertical-align: inherit;">Para acelerar el proceso de desarrollo, utilizar√© bibliotecas listas siempre que sea posible. </font><font style="vertical-align: inherit;">A saber:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulkanWrapper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : mi propio contenedor de C ++ para la API de Vulkan</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GLFW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - para ventanas y entrada del usuario</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulkanMemoryAllocator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - para asignar memoria Vulkan</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GLM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - para vectores matem√°ticos y matrices</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - para se√±ales / slots y ECS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para utilidades de carga de im√°genes</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FastNoise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : para generar ruido 3D</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√≠a 1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primer d√≠a, prepar√© una caldera Vulkan y un esqueleto del motor. </font><font style="vertical-align: inherit;">La mayor parte del c√≥digo era repetitivo y pod√≠a copiarlo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulkan-tutorial.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tambi√©n incluy√≥ un truco con el almacenamiento de datos de v√©rtices como parte de un sombreador de v√©rtices. </font><font style="vertical-align: inherit;">Esto significaba que ni siquiera ten√≠a que ajustar la asignaci√≥n de memoria. </font><font style="vertical-align: inherit;">Solo un transportador simple que solo puede hacer una cosa: dibujar un tri√°ngulo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El motor es lo suficientemente simple como para soportar el renderizador de tri√°ngulos. </font><font style="vertical-align: inherit;">Tiene una ventana y un bucle de juego al que se pueden conectar los sistemas. </font><font style="vertical-align: inherit;">La GUI est√° limitada por la velocidad de fotogramas que se muestra en el t√≠tulo de la ventana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El proyecto se divide en dos partes: </font></font><code>VoxelEngine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>VoxelGame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/875/3cd/190/8753cd190975239ad550e8c0c8b27d00.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dia 2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Integr√© la biblioteca Vulkan Memory Allocator. </font><font style="vertical-align: inherit;">Esta biblioteca se encarga de la mayor parte de la plantilla de asignaci√≥n de memoria de Vulkan: tipos de memoria, montones de memoria del dispositivo y asignaci√≥n secundaria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que ten√≠a una asignaci√≥n de memoria, cre√© clases para mallas y b√∫feres de v√©rtices. </font><font style="vertical-align: inherit;">Cambi√© el renderizador de los tri√°ngulos para que use la clase de mallas, y no las matrices integradas en el sombreador. </font><font style="vertical-align: inherit;">Actualmente, los datos de malla se transfieren a la GPU renderizando manualmente los tri√°ngulos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/627/28d/0fc/62728d0fce9015f2be4dad88f18c7b7a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poco ha cambiado</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√≠a 3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregu√© un sistema de representaci√≥n gr√°fica. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta publicaci√≥n se</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tom√≥ como base para crear esta clase </font><font style="vertical-align: inherit;">, pero la clase est√° muy simplificada. Mi gr√°fico de representaci√≥n contiene solo los elementos esenciales para manejar la sincronizaci√≥n con Vulkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El gr√°fico de renderizado me permite establecer </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bordes</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Los nodos son el trabajo realizado por la GPU. Las costillas son dependencias de datos entre nodos. Cada nodo recibe su propio b√∫fer de instrucciones, en el que escribe. El gr√°fico est√° involucrado en b√∫feres de comando de almacenamiento en b√∫fer doble y sincroniz√°ndolos con fotogramas anteriores. Los bordes se utilizan para insertar autom√°ticamente barreras transportadoras antes y despu√©s de que un nodo escriba en cada b√∫fer de instrucciones. Las barreras de tuber√≠a sincronizan el uso de todos los recursos y transfieren la propiedad entre colas. Adem√°s, los bordes insertan sem√°foros entre nodos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los nodos y los bordes forman un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gr√°fico ac√≠clico dirigido</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Luego, el gr√°fico de representaci√≥n realiza la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clasificaci√≥n topol√≥gica.</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodos, lo que lleva a la creaci√≥n de una lista plana de nodos ordenados para que cada nodo vaya despu√©s de todos los nodos de los que depende. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El motor tiene tres tipos de nodos. </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recibe una imagen de una cadena de b√∫fer (cadena de intercambio), </font></font><code>TransferNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transfiere datos de la CPU a la GPU y </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proporciona una imagen de una cadena de b√∫fer para mostrar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada nodo puede implementar </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>postRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que se ejecutan en cada marco. </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtiene una imagen de una cadena de buffers durante </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proporciona esta imagen a tiempo </font></font><code>postRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Refactor√© el renderizador de tri√°ngulos para que use un sistema de representaci√≥n gr√°fica, en lugar de procesar todo yo mismo. Hay un borde entre </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as√≠ como entre </font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esto garantiza que la imagen de la cadena de b√∫fer est√© sincronizada correctamente durante su uso durante el marco.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/12b/d88/6ba/12bd886ba9b41891ae1e2d0ff47b9929.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juro que dentro del motor ha cambiado</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√≠a 4</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cre√© una c√°mara y un sistema de renderizado 3D. Hasta ahora, la c√°mara recibe su propio b√∫fer persistente y grupo de descriptores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reduje la velocidad ese d√≠a porque estaba tratando de encontrar la configuraci√≥n correcta para el renderizado 3D con Vulkan. La mayor√≠a del material en l√≠nea se enfoca en renderizar usando OpenGL, que usa sistemas de coordenadas ligeramente diferentes de Vulkan. En OpenGL, el eje Z del espacio del clip se especifica como </font></font><code>[-1, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y el borde superior de la pantalla est√° en </font></font><code>Y = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En Vulkan, el eje Z se especifica como </font></font><code>[0, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y el borde superior de la pantalla est√° en </font></font><code>Y = -1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Debido a estas peque√±as diferencias, las matrices de proyecci√≥n GLM est√°ndar no funcionan correctamente porque est√°n dise√±adas para OpenGL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GLM tiene una opci√≥n</font></font><code>GLM_FORCE_DEPTH_ZERO_TO_ONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, eliminando el problema con el eje Z. Despu√©s de eso, el problema con el eje Y puede eliminarse simplemente cambiando el signo del elemento de </font></font><code>(1, 1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matriz de proyecci√≥n (GLM usa la indexaci√≥n desde 0). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si volteamos el eje Y, entonces necesitamos voltear los datos del v√©rtice, porque antes de eso, la direcci√≥n negativa del eje Y apuntaba hacia arriba.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d9/05d/464/8d905d4643a189400471c7e8d4fbd3f6.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora en 3D!</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dia 5</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregu√© la entrada del usuario y la capacidad de mover la c√°mara con el mouse. </font><font style="vertical-align: inherit;">El sistema de entrada es demasiado sofisticado, pero elimina las rarezas de la entrada GLFW. </font><font style="vertical-align: inherit;">En particular, tuve el problema de cambiar la posici√≥n del mouse mientras lo bloqueaba. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La entrada del teclado y el mouse es esencialmente una envoltura delgada en la parte superior de GLFW, abierta a trav√©s de controladores de se√±al </font></font><code>entt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo para comparar, casi lo mismo que Hopson hizo el d√≠a 1 de su proyecto.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Su navegador no admite video HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels.webm" type="video/webm"></video></div></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√≠a 6</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenc√© a agregar c√≥digo para generar y renderizar bloques voxel. </font><font style="vertical-align: inherit;">Escribir el c√≥digo de malla fue f√°cil porque lo hice antes y conoc√≠a abstracciones que me permitieron cometer menos errores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las abstracciones fue una clase de plantilla </font></font><code>ChunkData&lt;T, chunkSize&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que define un cubo de tipo del </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tama√±o </font></font><code>chunkSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de cada lado. </font><font style="vertical-align: inherit;">Esta clase almacena datos en una matriz 1D y procesa datos de indexaci√≥n con una coordenada 3D. </font><font style="vertical-align: inherit;">El tama√±o de cada bloque es de 16 x 16 x 16, por lo que los datos internos son una matriz simple con una longitud de 4096. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra abstracci√≥n es crear un iterador de posiciones que genere coordenadas de </font></font><code>(0, 0, 0)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font><code>(15, 15, 15)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Estas dos clases aseguran que las iteraciones con datos de bloque se realicen en un orden lineal para aumentar la localidad de cach√©. </font><font style="vertical-align: inherit;">La coordenada 3D a√∫n est√° disponible para otras operaciones que la necesitan. </font><font style="vertical-align: inherit;">Por ejemplo:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (glm::ivec3 pos : Chunk::Positions()) {
    <span class="hljs-keyword">auto</span>&amp; data = chunkData[pos];<font></font>
    glm::ivec3 offset = ...;<font></font>
    <span class="hljs-keyword">auto</span>&amp; neighborData = chunkData[pos + offset];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tengo varias matrices est√°ticas que especifican las compensaciones que se usan com√∫nmente en el juego. </font><font style="vertical-align: inherit;">Por ejemplo, </font></font><code>Neighbors6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">define 6 vecinos con los que el cubo tiene caras comunes.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;glm::ivec3, 6&gt; Neighbors6 = {<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment">//right</span>
        glm::ivec3(<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">//left</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment">//top</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">//bottom</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),    <span class="hljs-comment">//front</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)    <span class="hljs-comment">//back</span>
    };</code></pre><br>
<code>Neighbors26</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- todos estos son vecinos con los que el cubo tiene una cara, borde o v√©rtice com√∫n. </font><font style="vertical-align: inherit;">Es decir, es una cuadr√≠cula de 3x3x3 sin un cubo central. </font><font style="vertical-align: inherit;">Tambi√©n hay matrices similares para otros conjuntos de vecinos y para conjuntos de vecinos 2D. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay una matriz que define los datos necesarios para crear una cara del cubo. </font><font style="vertical-align: inherit;">Las direcciones de cada cara en esta matriz corresponden a las direcciones en la matriz </font></font><code>Neighbors6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;FaceArray, 6&gt; NeighborFaces = {
    <span class="hljs-comment">//right face</span><font></font>
    FaceArray {<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),<font></font>
    },<font></font>
    ...<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias a esto, el c√≥digo de creaci√≥n de malla es muy simple. Simplemente omite los datos de los bloques y agrega una cara cuando el bloque es s√≥lido, pero su vecino no lo es. El c√≥digo simplemente verifica cada cara de cada cubo en un bloque. Esto es similar al m√©todo "ingenuo" descrito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (glm::ivec3 pos : Chunk::Positions()) {<font></font>
    Block block = chunk.blocks()[pos];<font></font>
    <span class="hljs-keyword">if</span> (block.type == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; Chunk::Neighbors6.size(); i++) {<font></font>
        glm::ivec3 offset = Chunk::Neighbors6[i];<font></font>
        glm::ivec3 neighborPos = pos + offset;<font></font>
<font></font>
        <span class="hljs-comment">//<span class="hljs-doctag">NOTE:</span> bounds checking omitted</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (chunk.blocks()[neighborPos].type == <span class="hljs-number">0</span>) {<font></font>
            Chunk::FaceArray&amp; faceArray = Chunk::NeighborFaces[i];<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = <span class="hljs-number">0</span>; j &lt; faceArray.size(); j++) {<font></font>
                m_vertexData.push_back(pos + faceArray[j]);<font></font>
                m_colorData.push_back(glm::i8vec4(pos.x * <span class="hljs-number">16</span>, pos.y * <span class="hljs-number">16</span>, pos.z * <span class="hljs-number">16</span>, <span class="hljs-number">0</span>));<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reemplac√© </font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con </font></font><code>ChunkRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Tambi√©n agregu√© un b√∫fer de profundidad para que la malla de bloques pueda renderizarse correctamente. Era necesario agregar un borde m√°s al gr√°fico de representaci√≥n entre </font></font><code>TransferNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>ChunkRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este borde transfiere la propiedad de los recursos de la familia de colas entre la cola de transferencia y la cola de gr√°ficos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego cambi√© el motor para que pudiera manejar correctamente los eventos de cambio de ventana. En OpenGL, esto se hace de manera simple, pero bastante confusa en Vulkan. Dado que la cadena de buffers debe crearse expl√≠citamente y tener un tama√±o constante, cuando cambie el tama√±o de la ventana, debe volver a crearla. Debe recrear todos los recursos que dependen de la cadena de b√∫fer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los comandos que dependen de la cadena de almacenamiento intermedio (y ahora todos estos son comandos de dibujo) deben completar la ejecuci√≥n antes de destruir la cadena de almacenamiento intermedio anterior. </font><font style="vertical-align: inherit;">Esto significa que toda la GPU estar√° inactiva. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debe cambiar la canalizaci√≥n de gr√°ficos para proporcionar una ventana gr√°fica din√°mica y cambiar el tama√±o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No se puede crear una cadena de b√∫fer si el tama√±o de la ventana es 0 en el eje X o Y. Incluso cuando la ventana est√° minimizada. </font><font style="vertical-align: inherit;">Es decir, cuando esto sucede, todo el juego se detiene y contin√∫a solo cuando se abre la ventana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora la malla es un simple tablero de ajedrez tridimensional. </font><font style="vertical-align: inherit;">Los colores RGB de la malla se configuran de acuerdo con su posici√≥n XYZ multiplicada por 16.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Su navegador no admite video HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels2.webm" type="video/webm"></video></div></div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√≠a 7</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hice el proceso del juego no uno, sino varios bloques a la vez. La biblioteca ECS gestiona m√∫ltiples bloques y sus mallas </font></font><code>entt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Luego refactor√© el renderizador de bloques para que renderizara todos los bloques que est√°n en ECS. Todav√≠a tengo solo un bloque, pero </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podr√≠a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agregar otros nuevos si es necesario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Refactor√© la malla para que sus datos pudieran actualizarse despu√©s de su creaci√≥n. Esto me permitir√° actualizar la malla de bloques en el futuro cuando agregue la capacidad de agregar y eliminar cubos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando agrega o elimina un cubo, el n√∫mero de v√©rtices en la malla puede aumentar o disminuir potencialmente. El b√∫fer de v√©rtices seleccionado previamente solo se puede usar si la nueva malla es del mismo tama√±o o menor. Pero si la malla es m√°s grande, entonces se deben crear nuevos b√∫feres de v√©rtices.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El b√∫fer de v√©rtices anterior no se puede eliminar de inmediato. Puede haber almacenamientos intermedios de instrucciones ejecutados desde cuadros anteriores que son espec√≠ficos de un objeto en particular </font></font><code>VkBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El motor debe mantener un b√∫fer hasta que se completen estos b√∫feres de comando. Es decir, si dibujamos una malla en un marco </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la GPU puede usar este b√∫fer antes de que comience el marco </font></font><code>i + 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El b√∫fer no se puede quitar de la CPU hasta que la GPU haya terminado de usarlo. As√≠ que cambi√© el gr√°fico de representaci√≥n para que rastree la vida √∫til de los recursos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si el nodo del gr√°fico de representaci√≥n desea utilizar un recurso (b√∫fer o imagen), debe llamar al m√©todo </font></font><code>sync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dentro del m√©todo </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este m√©todo obtiene un puntero </font></font><code>shared_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a un recurso. Esta</font></font><code>shared_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">garantiza que el recurso no se eliminar√° mientras se ejecutan las memorias intermedias de comandos. </font><font style="vertical-align: inherit;">(En t√©rminos de rendimiento, esta soluci√≥n no es muy buena. M√°s sobre esto m√°s adelante). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora la malla de bloques se regenera en cada cuadro.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Su navegador no admite video HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels3.webm" type="video/webm"></video></div></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo lo que hice en una semana: prepar√© los conceptos b√°sicos para representar el mundo con m√∫ltiples bloques de v√≥xel y continuar√© trabajando en la segunda semana.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es487812/index.html">Prueba de espectro LED polaco Led E27</a></li>
<li><a href="../es487814/index.html">La velocidad y la fiabilidad son m√°s altas, y el precio es m√°s bajo. Nuevas unidades de estado s√≥lido Kingston KC2000</a></li>
<li><a href="../es487822/index.html">AvitoTech On Tour: encuentro de Android en Nizhny Novgorod</a></li>
<li><a href="../es487824/index.html">Descripci√≥n general de las l√°mparas LED Spectrum Led GU10 de Europa</a></li>
<li><a href="../es487826/index.html">Descripci√≥n general de las l√°mparas LED de Polonia Spectrum Led E14</a></li>
<li><a href="../es487834/index.html">Semana de la seguridad 07: Vulnerabilidad de Android Bluetooth Stack</a></li>
<li><a href="../es487836/index.html">Carga interactiva de archivos al servidor usando RxJS</a></li>
<li><a href="../es487838/index.html">Validaci√≥n de datos: un enfoque diferente</a></li>
<li><a href="../es487842/index.html">2 SIM para un enrutador de pa√≠s: ¬øes mucho o poco?</a></li>
<li><a href="../es487844/index.html">El olor revela</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>