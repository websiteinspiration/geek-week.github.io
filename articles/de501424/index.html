<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òùüèæ üìî üõ∞Ô∏è Aus dem Leben mit Kubernetes: Wie wir DBMS (und nicht nur) aus √úberpr√ºfungsumgebungen in statische Umgebungen entfernt haben üõéÔ∏è üë©üèΩ‚Äçü§ù‚Äçüë®üèæ üè≥Ô∏è‚Äçüåà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hinweis : Dieser Artikel erhebt keinen Anspruch auf bew√§hrte Vorgehensweise. Es beschreibt die Erfahrung einer bestimmten Implementierung einer Infras...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Aus dem Leben mit Kubernetes: Wie wir DBMS (und nicht nur) aus √úberpr√ºfungsumgebungen in statische Umgebungen entfernt haben</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/501424/"><img src="https://habrastorage.org/webt/ae/yu/zw/aeyuzw9pz0k6d0pbc0g86pxkfd0.png"><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Dieser Artikel erhebt keinen Anspruch auf bew√§hrte Vorgehensweise. </font><font style="vertical-align: inherit;">Es beschreibt die Erfahrung einer bestimmten Implementierung einer Infrastrukturaufgabe im Hinblick auf die Verwendung von Kubernetes und Helm, die bei der L√∂sung verwandter Probleme hilfreich sein kann. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verwendung von √úberpr√ºfungsumgebungen in CI / CD kann sowohl f√ºr Entwickler als auch f√ºr Systemingenieure sehr n√ºtzlich sein. </font><font style="vertical-align: inherit;">Lassen Sie uns zun√§chst die allgemeinen Vorstellungen √ºber sie synchronisieren:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √úberpr√ºfungsumgebungen k√∂nnen aus separaten Zweigen in Git-Repositorys erstellt werden, die von Entwicklern definiert wurden (sogenannte Feature-Zweige).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen separate DBMS-Instanzen, Warteschlangenprozessoren, Caching-Dienste usw. haben. </font><font style="vertical-align: inherit;">- im Allgemeinen alles f√ºr die vollst√§ndige Reproduktion der Produktionsumgebung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie erm√∂glichen eine parallele Entwicklung und beschleunigen die Ver√∂ffentlichung neuer Funktionen in der Anwendung erheblich. </font><font style="vertical-align: inherit;">Gleichzeitig k√∂nnen t√§glich Dutzende solcher Umgebungen erforderlich sein, weshalb die Geschwindigkeit ihrer Erstellung von entscheidender Bedeutung ist.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An der Schnittstelle zwischen dem zweiten und dem dritten Punkt treten h√§ufig Schwierigkeiten auf: Da die Infrastruktur sehr unterschiedlich ist, k√∂nnen ihre Komponenten f√ºr eine lange Zeit bereitgestellt werden. </font><font style="vertical-align: inherit;">Diese aufgewendete Zeit umfasst beispielsweise das Wiederherstellen der Datenbank aus einer bereits vorbereiteten Sicherung *. </font><font style="vertical-align: inherit;">Der Artikel handelt von der faszinierenden Art und Weise, wie wir einst ein solches Problem gel√∂st haben.</font></font><a name="habracut"></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* √úbrigens, speziell √ºber gro√üe Datenbank-Dumps in diesem Zusammenhang haben wir bereits in dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Material √ºber die Beschleunigung der Bootstrap-Datenbank geschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .)</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Problem und der Weg, es zu l√∂sen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einem der Projekte wurde uns die Aufgabe √ºbertragen, "einen einzigen Einstiegspunkt f√ºr Entwickler und QS-Ingenieure zu schaffen". </font><font style="vertical-align: inherit;">Diese Formulierung verbarg technisch folgendes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um die Arbeit der QS-Ingenieure und einiger anderer Mitarbeiter zu vereinfachen, nehmen Sie alle in der √úberpr√ºfung verwendeten Datenbanken (und entsprechenden vhosts) in einer separaten - statischen - Umgebung heraus. </font><font style="vertical-align: inherit;">Aus den im Projekt vorherrschenden Gr√ºnden war diese Art der Interaktion mit ihnen optimal.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduzieren Sie den Zeitaufwand f√ºr die Erstellung einer √úberpr√ºfungsumgebung. </font><font style="vertical-align: inherit;">Der gesamte Prozess ihrer Erstellung von Grund auf ist impliziert, d.h. </font><font style="vertical-align: inherit;">einschlie√ülich Datenbankklonen, Migrationen usw.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter dem Gesichtspunkt der Implementierung besteht das Hauptproblem darin, die Idempotenz beim Erstellen und L√∂schen von √úberpr√ºfungsumgebungen sicherzustellen. Um dies zu erreichen, haben wir den Mechanismus zum Erstellen von √úberpr√ºfungsumgebungen ge√§ndert, indem wir zuerst die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL-, MongoDB- und RabbitMQ-Dienste</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in eine statische Umgebung </font><font style="vertical-align: inherit;">migriert </font><font style="vertical-align: inherit;">haben. Statisch bezieht sich auf eine solche ‚Äûpermanente‚Äú Umgebung, die nicht auf Anforderung des Benutzers erstellt wird (wie dies bei √úberpr√ºfungsumgebungen der Fall ist). </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wichtig!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Ansatz mit einer statischen Umgebung ist alles andere als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ideal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr seine spezifischen M√§ngel siehe das Ende des Artikels. Wir teilen diese Erfahrung jedoch im Detail, da sie mehr oder weniger auf andere Aufgaben anwendbar sein kann und gleichzeitig als Argument bei der Er√∂rterung von Fragen des Infrastrukturdesigns dient.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, die Reihenfolge der Aktionen in der Implementierung:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beim Erstellen einer √úberpr√ºfungsumgebung sollte Folgendes einmal geschehen: Erstellen von Datenbanken in zwei DBMS (MongoDB und PostgreSQL), Wiederherstellen von Datenbanken aus einer Sicherung / Vorlage und Erstellen von vhost in RabbitMQ. </font><font style="vertical-align: inherit;">Dies erfordert eine bequeme M√∂glichkeit zum Laden aktueller Speicherausz√ºge. </font><font style="vertical-align: inherit;">(Wenn Sie zuvor √úberpr√ºfungsumgebungen hatten, haben Sie h√∂chstwahrscheinlich bereits eine vorgefertigte L√∂sung daf√ºr.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nach Abschluss der √úberpr√ºfungsumgebung m√ºssen Sie die Datenbank und den virtuellen Host in RabbitMQ l√∂schen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall arbeitet die Infrastruktur im Rahmen von Kubernetes (mit Helm). </font><font style="vertical-align: inherit;">Daher waren f√ºr die Ausf√ºhrung der oben genannten Aufgaben </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helmhaken</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ausgezeichnet </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sie k√∂nnen sowohl vor dem Erstellen aller anderen Komponenten in der Helm-Version als auch nach deren Entfernung ausgef√ºhrt werden. </font><font style="vertical-align: inherit;">Deshalb:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr die Initialisierungsaufgabe wird ein Hook verwendet </font></font><code>pre-install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, um sie zu starten, bevor alle Ressourcen in der Version erstellt werden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºr die L√∂schaufgabe ein Hook </font></font><code>post-delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommen wir zu den Implementierungsdetails.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Praktische Anwendung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Originalversion verwendete dieses Projekt nur einen Job, der aus drei Containern bestand. </font><font style="vertical-align: inherit;">Dies ist nat√ºrlich nicht ganz praktisch, da das Ergebnis ein gro√ües Manifest ist, das kitschig und schwer zu lesen ist. </font><font style="vertical-align: inherit;">Deshalb haben wir es in drei kleine Jobs aufgeteilt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Folgende ist eine Auflistung f√ºr PostgreSQL, und die anderen beiden (MongoDB und RabbitMQ) sind in der Manifeststruktur identisch:</font></font><br>
<br>
<pre><code class="plaintext hljs">{{- if .Values.global.review }}<font></font>
---<font></font>
apiVersion: batch/v1<font></font>
kind: Job<font></font>
metadata:<font></font>
  name: db-create-postgres-database<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "5"<font></font>
spec:<font></font>
  template:<font></font>
    metadata:<font></font>
      name: init-db-postgres<font></font>
    spec:<font></font>
      volumes:<font></font>
      - name: postgres-scripts<font></font>
        configMap:<font></font>
          defaultMode: 0755<font></font>
          name: postgresql-configmap<font></font>
      containers:<font></font>
      - name: init-postgres-database<font></font>
        image: private-registry/postgres <font></font>
        command: ["/docker-entrypoint-initdb.d/01-review-load-dump.sh"]<font></font>
        volumeMounts:<font></font>
        - name: postgres-scripts<font></font>
          mountPath: /docker-entrypoint-initdb.d/01-review-load-dump.sh<font></font>
          subPath: review-load-dump.sh<font></font>
        env:<font></font>
{{- include "postgres_env" . | indent 8 }}<font></font>
      restartPolicy: Never<font></font>
{{- end }}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommentare zum Inhalt des Manifests:</font></font><br>
<br>
<ol>
<li> Job    review-.  review   CI/CD       Helm- (. <code>if</code>  <code>.Values.global.review</code>    ).</li>
<li>  Job      ‚Äî , ConfigMap.       ,  ,       .       ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>hook-weight</code></a>.</li>
<li>      cURL   ,        PostgreSQL,       .</li>
<li>      PostgreSQL    :     ,     shell- .</li>
</ol><br>
<h3>PostgreSQL</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das interessanteste ist das bereits in der Liste erw√§hnte Shell-Skript ( </font></font><code>review-load-dump.sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Was sind die allgemeinen Optionen zum Wiederherstellen einer Datenbank in PostgreSQL?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Standard" -Wiederherstellung von der Sicherung;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiederherstellung mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorlagen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall liegt der Unterschied zwischen den beiden Ans√§tzen haupts√§chlich in der Geschwindigkeit, mit der eine Datenbank f√ºr die neue Umgebung erstellt wird. </font><font style="vertical-align: inherit;">Im ersten Fall laden wir den Datenbankspeicherauszug und stellen ihn mit wieder her </font></font><code>pg_restore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Und bei uns geschieht dies langsamer als bei der zweiten Methode, sodass die entsprechende Auswahl getroffen wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verwenden der zweiten Option ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiederherstellung mit Vorlagen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Sie k√∂nnen die Datenbank auf physischer Ebene klonen, ohne Daten aus dem Container in einer anderen Umgebung remote an sie zu senden. Dies verk√ºrzt die Wiederherstellungszeit. </font><font style="vertical-align: inherit;">Es gibt jedoch eine Einschr√§nkung: Sie k√∂nnen keine Datenbank klonen, zu der noch aktive Verbindungen bestehen. </font><font style="vertical-align: inherit;">Da wir Stage als statische Umgebung verwenden (und keine separate √úberpr√ºfungsumgebung), m√ºssen wir eine zweite Datenbank erstellen und diese in eine Vorlage konvertieren und t√§glich aktualisieren (z. B. morgens). </font><font style="vertical-align: inherit;">Daf√ºr wurde ein kleiner CronJob vorbereitet:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: batch/v1beta1<font></font>
kind: CronJob<font></font>
metadata:<font></font>
  name: update-postgres-template<font></font>
spec:<font></font>
  schedule: "50 4 * * *"<font></font>
  concurrencyPolicy: Forbid<font></font>
  successfulJobsHistoryLimit: 3<font></font>
  failedJobsHistoryLimit: 3<font></font>
  startingDeadlineSeconds: 600<font></font>
  jobTemplate:<font></font>
    spec:<font></font>
      template:<font></font>
        spec:<font></font>
          restartPolicy: Never<font></font>
          imagePullSecrets:<font></font>
          - name: registrysecret<font></font>
          volumes:<font></font>
          - name: postgres-scripts<font></font>
            configMap:<font></font>
              defaultMode: 0755<font></font>
              name: postgresql-configmap-update-cron<font></font>
          containers:<font></font>
          - name: cron<font></font>
            command: ["/docker-entrypoint-initdb.d/update-postgres-template.sh"]<font></font>
          image: private-registry/postgres <font></font>
            volumeMounts:<font></font>
            - name: postgres-scripts<font></font>
              mountPath: /docker-entrypoint-initdb.d/update-postgres-template.sh<font></font>
              subPath: update-postgres-template.sh<font></font>
            env:<font></font>
{{- include "postgres_env" . | indent 8 }}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das vollst√§ndige ConfigMap-Manifest, das das Skript enth√§lt, ist h√∂chstwahrscheinlich nicht sehr sinnvoll (in den Kommentaren angeben, falls dies nicht der Fall ist). </font><font style="vertical-align: inherit;">Stattdessen werde ich das Wichtigste geben - ein Bash-Skript:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#!/bin/bash -x</span><font></font>
<font></font>
CREDENTIALS=<span class="hljs-string">"postgresql://<span class="hljs-variable">${POSTGRES_USER}</span>:<span class="hljs-variable">${POSTGRES_PASSWORD}</span>@<span class="hljs-variable">${POSTGRES_HOST}</span>/postgres"</span><font></font>
<font></font>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"REVOKE CONNECT ON DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span> FROM public"</span>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE pg_stat_activity.datname = '<span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span>'"</span><font></font>
<font></font>
curl --fail -vsL <span class="hljs-variable">${HOST_FORDEV}</span>/latest_<span class="hljs-variable">${POSTGRES_DB_STAGE}</span>.psql -o /tmp/<span class="hljs-variable">${POSTGRES_DB}</span>.psql<font></font>
<font></font>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"ALTER DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span> WITH is_template false allow_connections true;"</span>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"DROP DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span>;"</span> || <span class="hljs-literal">true</span>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"CREATE DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span>;"</span> || <span class="hljs-literal">true</span>
pg_restore -U <span class="hljs-variable">${POSTGRES_USER}</span> -h <span class="hljs-variable">${POSTGRES_HOST}</span> -w -j 4 -d <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span> /tmp/<span class="hljs-variable">${POSTGRES_DB}</span>.psql<font></font>
<font></font>
psql -d <span class="hljs-string">"<span class="hljs-variable">${CREDENTIALS}</span>"</span> -w -c <span class="hljs-string">"ALTER DATABASE <span class="hljs-variable">${POSTGRES_DB_TEMPLATE}</span> WITH is_template true allow_connections false;"</span><font></font>
<font></font>
rm -v /tmp/<span class="hljs-variable">${POSTGRES_DB}</span>.psql</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen mehrere Datenbanken gleichzeitig aus einer Vorlage ohne Konflikte wiederherstellen. </font><font style="vertical-align: inherit;">Die Hauptsache ist, dass Datenbankverbindungen verboten werden sollten und die Datenbank selbst eine Vorlage sein sollte. </font><font style="vertical-align: inherit;">Dies erfolgt im vorletzten Schritt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Manifest mit dem Shell-Skript zum Wiederherstellen der Datenbank stellte sich wie folgt heraus:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: postgresql-configmap<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded<font></font>
data:<font></font>
  review-load-dump.sh: |<font></font>
    #!/bin/bash -x<font></font>
    <font></font>
 <font></font>
 <font></font>
    CREDENTIALS="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/postgres"<font></font>
<font></font>
    if [ "$( psql -d "${CREDENTIALS}" -tAc "SELECT CASE WHEN EXISTS (SELECT * FROM pg_stat_activity WHERE datname = '${POSTGRES_DB}' LIMIT 1) THEN 1 ELSE 0 END;" )" = '1' ]<font></font>
      then<font></font>
          echo "Open connections has been found in ${POSTGRES_DB} database, will drop them"<font></font>
          psql -d "${CREDENTIALS}" -c "SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE pg_stat_activity.datname = '${POSTGRES_DB}' -- AND pid &lt;&gt; pg_backend_pid();"<font></font>
      else<font></font>
          echo "No open connections has been found ${POSTGRES_DB} database, skipping this stage"<font></font>
    fi<font></font>
<font></font>
    psql -d "${CREDENTIALS}" -c "DROP DATABASE ${POSTGRES_DB}"<font></font>
<font></font>
    if [ "$( psql -d "${CREDENTIALS}" -tAc "SELECT 1 FROM pg_database WHERE datname='${POSTGRES_DB}'" )" = '1' ]<font></font>
      then<font></font>
          echo "Database ${POSTGRES_DB} still exists, delete review job failed"<font></font>
          exit 1<font></font>
      else<font></font>
          echo "Database ${POSTGRES_DB} does not exist, skipping"<font></font>
    fi<font></font>
<font></font>
<font></font>
    psql ${CREDENTIALS} -d postgres -c 'CREATE DATABASE ${POSTGRES_DB} TEMPLATE "loot-stage-copy"'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anscheinend sind sie hier beteiligt </font></font><code>hook-delete-policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Details zur Anwendung dieser Richtlinien finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In dem angegebenen Manifest verwenden wir </font></font><code>before-hook-creation,hook-succeeded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, um die folgenden Anforderungen zu erf√ºllen: L√∂schen Sie das vorherige Objekt, bevor Sie einen neuen Hook erstellen, und l√∂schen Sie es nur, wenn der Hook erfolgreich war. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden die Datenbank in dieser ConfigMap l√∂schen:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: postgresql-configmap-on-delete<font></font>
  annotations:<font></font>
    "helm.sh/hook": "post-delete, pre-delete"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation<font></font>
data:<font></font>
  review-delete-db.sh: |<font></font>
    #!/bin/bash -e<font></font>
<font></font>
    CREDENTIALS="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/postgres"<font></font>
<font></font>
    psql -d "${CREDENTIALS}" -w postgres -c "DROP DATABASE ${POSTGRES_DB}"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl wir es in eine separate ConfigMap verschoben haben, kann es in eine regul√§re ConfigMap eingef√ºgt werden </font></font><code>command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Schlie√ülich kann es zu einem Einzeiler gemacht werden, ohne das Erscheinungsbild des Manifests selbst zu verkomplizieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Option mit PostgreSQL-Vorlagen aus irgendeinem Grund nicht passt oder nicht passt, k√∂nnen Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mithilfe der Sicherung zum</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oben genannten </font><b><font style="vertical-align: inherit;">"Standard" -Wiederherstellungspfad zur√ºckkehren</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Der Algorithmus wird trivial sein:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jede Nacht wird eine Datenbanksicherung durchgef√ºhrt, damit diese aus dem lokalen Netzwerk des Clusters heruntergeladen werden kann.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zum Zeitpunkt der Erstellung der √úberpr√ºfungsumgebung wird die Datenbank geladen und aus dem Speicherauszug wiederhergestellt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wenn der Speicherauszug bereitgestellt wird, werden alle anderen Aktionen ausgef√ºhrt.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall sieht das Wiederherstellungsskript ungef√§hr wie folgt aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: postgresql-configmap<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded<font></font>
data:<font></font>
  review-load-dump.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    CREDENTIALS="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/postgres"<font></font>
    psql -d "${CREDENTIALS}" -w -c "DROP DATABASE ${POSTGRES_DB}" || true<font></font>
    psql -d "${CREDENTIALS}" -w -c "CREATE DATABASE ${POSTGRES_DB}"<font></font>
<font></font>
    curl --fail -vsL ${HOST_FORDEV}/latest_${POSTGRES_DB_STAGE}.psql -o /tmp/${POSTGRES_DB}.psql<font></font>
<font></font>
    psql psql -d "${CREDENTIALS}" -w -c "CREATE EXTENSION ip4r;"<font></font>
    pg_restore -U ${POSTGRES_USER} -h ${POSTGRES_HOST} -w -j 4 -d ${POSTGRES_DB} /tmp/${POSTGRES_DB}.psql<font></font>
    rm -v /tmp/${POSTGRES_DB}.psql</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Verfahren entspricht dem, was oben bereits beschrieben wurde. Die einzige √Ñnderung ist das Entfernen der psql-Datei, nachdem alle Arbeiten hinzugef√ºgt wurden. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Sowohl im Wiederherstellungsskript als auch im Deinstallationsskript wird die Datenbank jedes Mal gel√∂scht. Dies geschieht, um m√∂gliche Konflikte bei der Neuerstellung der √úberpr√ºfung zu vermeiden: Sie m√ºssen sicherstellen, dass die Datenbank wirklich gel√∂scht wird. Dieses Problem kann m√∂glicherweise auch durch Hinzuf√ºgen eines Flags </font></font><code>--clean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im Dienstprogramm </font><font style="vertical-align: inherit;">gel√∂st werden. Seien Sie </font></font><code>pg_restore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jedoch vorsichtig: Dieses Flag l√∂scht nur die Daten der Elemente, die sich im Speicherauszug selbst befinden. In unserem Fall funktioniert diese Option also nicht.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis haben wir einen funktionierenden Mechanismus erhalten, der weitere Verbesserungen erfordert (bis hin zum Ersetzen von Bash-Skripten durch eleganteren Code). </font><font style="vertical-align: inherit;">Wir werden sie au√üerhalb des Geltungsbereichs des Artikels belassen (obwohl Kommentare zum Thema nat√ºrlich willkommen sind).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mongodb</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die n√§chste Komponente ist MongoDB. </font><font style="vertical-align: inherit;">Die Hauptschwierigkeit dabei ist, dass f√ºr dieses DBMS die Option zum Kopieren der Datenbank (wie in PostgreSQL) eher nominell besteht, weil:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Er ist in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einem veralteten Zustand</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach den Ergebnissen unserer Tests haben wir keinen gro√üen Unterschied in der Zeit der Datenbankwiederherstellung im Vergleich zur √ºblichen festgestellt </font></font><code>mongo_restore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich stelle jedoch fest, dass die Tests als Teil eines Projekts durchgef√ºhrt wurden - in Ihrem Fall k√∂nnen die Ergebnisse v√∂llig unterschiedlich sein.</font></font></i></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass bei einem gro√üen Datenbankvolumen ein ernstes Problem auftreten kann: Wir sparen Zeit beim Wiederherstellen der Datenbank in PgSQL, stellen aber gleichzeitig den Speicherauszug in Mongo f√ºr eine sehr lange Zeit wieder her. </font><font style="vertical-align: inherit;">Zum Zeitpunkt des Schreibens und im Rahmen der vorhandenen Infrastruktur haben wir drei M√∂glichkeiten gesehen (sie k√∂nnen √ºbrigens kombiniert werden):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Wiederherstellung kann beispielsweise lange dauern, wenn sich Ihr DBMS in einem Netzwerkdateisystem befindet (in F√§llen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ohne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Produktionsumgebung). </font><font style="vertical-align: inherit;">Anschlie√üend k√∂nnen Sie das DBMS einfach von der B√ºhne auf einen separaten Knoten √ºbertragen und den lokalen Speicher verwenden. </font><font style="vertical-align: inherit;">Da dies keine Produktion ist, ist die Geschwindigkeit der Erstellung einer √úberpr√ºfung f√ºr uns kritischer.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen jede Jobwiederherstellung in einem separaten Pod speichern, sodass Sie Migrationen und andere Prozesse, die vom Betrieb des DBMS abh√§ngen, vorab ausf√ºhren k√∂nnen. </font><font style="vertical-align: inherit;">So sparen wir Zeit, indem wir sie im Voraus ausf√ºllen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manchmal k√∂nnen Sie die Gr√∂√üe des Speicherauszugs reduzieren, indem Sie alte / irrelevante Daten l√∂schen - soweit es ausreicht, nur die Datenbankstruktur zu belassen. </font><font style="vertical-align: inherit;">Dies gilt nat√ºrlich nicht f√ºr F√§lle, in denen ein vollst√§ndiger Speicherauszug erforderlich ist (z. B. f√ºr QS-Testaufgaben).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie keine schnellen √úberpr√ºfungsumgebungen erstellen m√ºssen, k√∂nnen alle beschriebenen Schwierigkeiten ignoriert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir die Datenbank nicht √§hnlich wie PgSQL kopieren k√∂nnen, werden wir den ersten Weg gehen, d. H. </font><font style="vertical-align: inherit;">Standardwiederherstellung von der Sicherung. </font><font style="vertical-align: inherit;">Der Algorithmus ist der gleiche wie bei PgSQL. </font><font style="vertical-align: inherit;">Dies ist leicht zu erkennen, wenn Sie sich die Manifeste ansehen:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: mongodb-scripts-on-delete<font></font>
  annotations:<font></font>
    "helm.sh/hook": "post-delete, pre-delete"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation<font></font>
data:<font></font>
  review-delete-db.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    mongo ${MONGODB_NAME} --eval "db.dropDatabase()" --host ${MONGODB_REPLICASET}/${MONGODB_HOST}<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: mongodb-scripts<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded<font></font>
data:<font></font>
  review-load-dump.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    curl --fail -vsL ${HOST_FORDEV}/latest_${MONGODB_NAME_STAGE}.gz -o /tmp/${MONGODB_NAME}.gz<font></font>
<font></font>
    mongo ${MONGODB_NAME} --eval "db.dropDatabase()" --host ${MONGODB_REPLICASET}/${MONGODB_HOST}<font></font>
    mongorestore --gzip --nsFrom "${MONGODB_NAME_STAGE}.*" --nsTo "${MONGODB_NAME}.*" --archive=/tmp/${MONGODB_NAME}.gz --host ${MONGODB_REPLICASET}/${MONGODB_HOST}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier gibt es ein wichtiges Detail. In unserem Fall befindet sich MongoDB im Cluster und Sie m√ºssen sicherstellen, dass die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbindung immer zum Prim√§rknoten erfolgt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn Sie beispielsweise den ersten Host im Quorum angeben, wechselt dieser m√∂glicherweise nach einiger Zeit von prim√§r zu sekund√§r, wodurch die Erstellung einer Datenbank verhindert wird. Daher m√ºssen Sie keine Verbindung zu einem Host, sondern sofort zu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReplicaSet herstellen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und alle darin enthaltenen Hosts auflisten. Allein aus diesem Grund m√ºssen Sie MongoDB als StatefulSet erstellen, damit die Hostnamen immer gleich sind (ganz zu schweigen davon, dass MongoDB von Natur aus eine Stateful-Anwendung ist). Bei dieser Option wird garantiert, dass Sie eine Verbindung zum Prim√§rknoten herstellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr MongoDB l√∂schen wir auch die Datenbank, bevor wir die √úberpr√ºfung erstellen - dies erfolgt aus den gleichen Gr√ºnden wie in PostgreSQL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Letzte Nuance: Da sich die zu √ºberpr√ºfende Datenbank in derselben Umgebung wie die Stufe befindet, ist f√ºr die geklonte Datenbank ein separater Name erforderlich. </font><font style="vertical-align: inherit;">Wenn der Speicherauszug keine BSON-Datei ist, tritt der folgende Fehler auf:</font></font><br>
<br>
<pre><code class="plaintext hljs">the --db and --collection args should only be used when restoring from a BSON file. Other uses are deprecated and will not exist in the future; use --nsInclude instead</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher werden im obigen Beispiel </font></font><code>--nsFrom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">verwendet </font></font><code>--nsTo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben keine anderen Probleme mit der Genesung festgestellt. </font><font style="vertical-align: inherit;">Am Ende </font><font style="vertical-align: inherit;">m√∂chte </font><font style="vertical-align: inherit;">ich nur hinzuf√ºgen, dass die Dokumentation f√ºr </font></font><code>copyDatabase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoDB hier verf√ºgbar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - falls Sie diese Option ausprobieren m√∂chten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rabbitmq</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die letzte Anwendung auf unserer Anforderungsliste war RabbitMQ. </font><font style="vertical-align: inherit;">Es ist ganz einfach: Sie m√ºssen im Namen des Benutzers, mit dem die Anwendung eine Verbindung herstellen soll, einen neuen vhost erstellen. </font><font style="vertical-align: inherit;">Und dann l√∂schen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manifest zum Erstellen und Entfernen von vhosts:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: rabbitmq-configmap<font></font>
  annotations:<font></font>
    "helm.sh/hook": "pre-install"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded<font></font>
data:<font></font>
  rabbitmq-setup-vhost.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    /usr/local/bin/rabbitmqadmin -H ${RABBITMQ_HOST} -u ${RABBITMQ_USER} -p ${RABBITMQ_PASSWORD} declare vhost name=${RABBITMQ_VHOST}<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: rabbitmq-configmap-on-delete<font></font>
  annotations:<font></font>
    "helm.sh/hook": "post-delete, pre-delete"<font></font>
    "helm.sh/hook-weight": "1"<font></font>
    "helm.sh/hook-delete-policy": before-hook-creation<font></font>
data:<font></font>
  rabbitmq-delete-vhost.sh: |<font></font>
    #!/bin/bash -x<font></font>
<font></font>
    /usr/local/bin/rabbitmqadmin -H ${RABBITMQ_HOST} -u ${RABBITMQ_USER} -p ${RABBITMQ_PASSWORD} delete vhost name=${RABBITMQ_VHOST}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit gro√üen Schwierigkeiten in RabbitMQ sind wir (bisher?) Nicht begegnet. </font><font style="vertical-align: inherit;">Im Allgemeinen kann der gleiche Ansatz f√ºr alle anderen Dienste gelten, die keine kritische Datenbindung aufweisen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachteile</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum behauptet diese Entscheidung nicht, ‚ÄûBest Practices‚Äú zu sein?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es stellt sich heraus, dass es sich um einen einzelnen Fehlerpunkt in Form einer B√ºhnenumgebung handelt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn eine Anwendung in einer Stage-Umgebung nur in einem Replikat ausgef√ºhrt wird, sind wir noch st√§rker von dem Host abh√§ngig, auf dem diese Anwendung ausgef√ºhrt wird. </font><font style="vertical-align: inherit;">Dementsprechend nimmt mit zunehmender Anzahl von √úberpr√ºfungsumgebungen die Last auf dem Knoten proportional zu, ohne dass diese Last ausgeglichen werden kann.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese beiden Probleme konnten unter Ber√ºcksichtigung der F√§higkeiten der Infrastruktur eines bestimmten Projekts nicht vollst√§ndig gel√∂st werden. Potenzielle Sch√§den k√∂nnen jedoch durch Clustering (Hinzuf√ºgen neuer Knoten) und vertikale Skalierung minimiert werden. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der Entwicklung der Anwendung und der zunehmenden Anzahl von Entwicklern steigt fr√ºher oder sp√§ter die Belastung der √úberpr√ºfungsumgebungen und es werden neue Anforderungen hinzugef√ºgt. F√ºr Entwickler ist es wichtig, die n√§chsten √Ñnderungen in der Produktion so schnell wie m√∂glich bereitzustellen. Um dies zu erm√∂glichen, ben√∂tigen wir dynamische √úberpr√ºfungsumgebungen, die die Entwicklung ‚Äûparallel‚Äú machen. Infolgedessen w√§chst die Belastung der Infrastruktur und die Zeit f√ºr die Erstellung solcher Umgebungen nimmt zu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel wurde basierend auf realen und ziemlich spezifischen Erfahrungen geschrieben. Nur in Ausnahmef√§llen isolieren wir Dienste in statischen Umgebungen, und hier ging es speziell um ihn. Dank dieser notwendigen Ma√ünahme konnten wir die Entwicklung und das Debuggen der Anwendung beschleunigen - dank der M√∂glichkeit, schnell √úberpr√ºfungsumgebungen von Grund auf neu zu erstellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als wir anfingen, diese Aufgabe zu erledigen, schien es sehr einfach zu sein, aber als wir daran arbeiteten, fanden wir viele Nuancen. </font><font style="vertical-align: inherit;">Sie wurden im letzten Artikel zusammengestellt: Obwohl sie nicht universell sind, k√∂nnen sie als Beispiel f√ºr die Grundlage / Inspiration ihrer eigenen Entscheidungen zur Beschleunigung von √úberpr√ºfungsumgebungen dienen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lesen Sie auch in unserem Blog:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipps und Tricks von Kubernetes: Beschleunigen des Bootstraps gro√üer Datenbanken</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ungehinderte RabbitMQ-Migration zu Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ungehinderte MongoDB-Migration nach Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºhren von Teams, die gerade eine neue Anwendungsversion f√ºr Kubernetes bereitstellen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de501412/index.html">Mobiles Eye-Tracking auf PyTorch</a></li>
<li><a href="../de501414/index.html">Debian, Nginx und Gunicorn f√ºr ein Django-Projekt konfigurieren</a></li>
<li><a href="../de501416/index.html">Ein bisschen √ºber WebRTC: was zu verwenden ist und der Fall aus der Praxis</a></li>
<li><a href="../de501418/index.html">Woche 4 Marathon: Motivation</a></li>
<li><a href="../de501420/index.html">Online Mitapas und YouTube Shows: JUG Ru Group Stream Week</a></li>
<li><a href="../de501426/index.html">Unison: Einrichten und Automatisieren der bidirektionalen Synchronisierung von Verzeichnissen auf zwei Servern</a></li>
<li><a href="../de501430/index.html">Gro√üartiger Leitfaden f√ºr die Gestaltung und Planung von Website-Inhalten</a></li>
<li><a href="../de501432/index.html">Zwei Alternativen zu JDBC</a></li>
<li><a href="../de501434/index.html">Sicherheitswoche 20: Hacken eines Computers durch Thunderbolt</a></li>
<li><a href="../de501436/index.html">Zahlenerkennungsalgorithmus auf dem Bild mit einer geringen Wahrscheinlichkeit der zweiten Art von Fehler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>