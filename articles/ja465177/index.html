<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👼🏽 👸🏼 🍆 New Relicのものではない：DatadogとAtatusの考察 📢 😠 🦊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SRE- / DevOps-engineersの環境では、ある日、クライアント（または監視システム）が表示され、「すべてが失われました」と表示されても驚くことはありません。シンプルで理解しやすいツールがなければ、これを行うのは非常に困難です。多くの場合、問題はアプリケーション自体のコードに隠されてい...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>New Relicのものではない：DatadogとAtatusの考察</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/465177/"><img src="https://habrastorage.org/webt/rp/lp/ct/rplpctt6yzam8cvxnufgkygd3um.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SRE- / DevOps-engineersの環境では、ある日、クライアント（または監視システム）が表示され、「すべてが失われました」と表示されても驚くことはありません。シンプルで理解しやすいツールがなければ、これを行うのは非常に困難です。</font><font style="vertical-align: inherit;">多くの場合、問題はアプリケーション自体のコードに隠されています。ローカライズする必要があるだけです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして悲しみと喜びの中で…</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
偶然にも、私たちはずっとNew Relicが大好きでした。これは、アプリケーションのパフォーマンスを監視するための優れたツールであり、これからも変わりません。また、（エージェントを使用して）マイクロサービスアーキテクチャなどをインスツルメントすることができます。そして、サービスの価格設定ポリシーの変更がなければ、すべてが素晴らしいかもしれません。その</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コスト</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は2013年以来</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3倍以上増加してい</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。さらに、昨年からトライアルアカウントを取得するには、パーソナルマネージャーとのコミュニケーションが必要であるため、潜在的な顧客に製品を提示することは困難です。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常の状況：New Relicは「永続的に」必要とされず、問題が発生した瞬間にのみ記憶されます。ただし、引き続き定期的に支払う必要があり（サーバーあたり月額140米ドル）、自動的にスケーラブルなクラウドインフラストラクチャでは、金額がかなり大きくなります。 「従量課金制」の可能性はありますが、New Relicを有効にするには、アプリケーションを再起動する必要があります。これにより、すべてが開始された問題の状況が失われる可能性があります。それほど長い前に、新しいRelicのは、新料金プランを導入- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essentialsの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロフェッショナルへの合理的な代替のような一見のルックスで...しかし、綿密に検討すると、それは重要な機能のいくつかは、特に、それは持っていない（欠けていることが判明し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キー取引を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クロスアプリケーショントレースは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分散トレース</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、私たちはより安価な代替案を見つけることを考え、DatadogとAtatusの2つのサービスを選択しました。</font><font style="vertical-align: inherit;">なぜ正確にそれらに？</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">競合他社について</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
市場には他の解決策があることを私はすぐに言わなければなりません。</font><font style="vertical-align: inherit;">オープンソースのオプションも検討しましたが、すべてのクライアントがセルフホストソリューションをホストできる無料の容量があるわけではありません...-さらに、追加のメンテナンスが必要になります。</font><font style="vertical-align: inherit;">私たちが選んだカップルは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちのニーズに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も近いことがわかりました</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPアプリケーションの組み込みおよび開発済みサポート（クライアントのスタックは非常に多様ですが、New Relicに代わるものを見つけるという文脈における明確なリーダーです）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手頃な価格（ホストあたり月額100米ドル未満）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動計測;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesの統合</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New Relicインターフェースとの類似性は目立つプラスです（私たちのエンジニアがそれに慣れているため）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、最初の選択の段階で、他のいくつかの一般的なソリューション、特に次のものを排除しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tideways、AppDynamics、Dynatrace-価格;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Stackify-ロシア連邦ではブロックされ、表示されるデータが少なすぎます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以降の記事は、検討中のソリューションが簡単に説明されるように構成されています。その後、New Relicとの典型的な相互作用と、他のサービスで同様の操作を実行した経験/印象について説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選ばれた競合他社のプレゼンテーション</font></font></h3><br>
<img src="https://habrastorage.org/webt/mu/el/kq/muelkqnuiwzgvaz_jtton8mrbzs.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらく誰もが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New Relic</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
について</font><font style="vertical-align: inherit;">聞いたのでしょうか？このサービスは、10年以上前の2008年に開発を開始しました。 2012年から積極的に使用しており、PHP、Ruby、Pythonの非常に多くのアプリケーションとの統合の問題は発生していません。また、C＃およびGoとの統合の経験もありました。サービスの作成者は、アプリケーションの監視、インフラストラクチャ、マイクロサービスインフラストラクチャの追跡、ユーザーデバイス用の便利なアプリケーションの作成など、さまざまなソリューションを提供しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、New Relicエージェントは独自のプロトコルで動作し、OpenTracingのサポートはありません。高度なインストルメンテーションでは、New Relic専用の編集が必要です。最後に、これまでのところ、Kubernetesのサポートには試験的なステータスがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4t/ae/fp/4taefp5hohou0ekzzmcrnduvzlu.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2010年に開発を開始した</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datadog</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes環境でのアプリケーションに関しては、New Relicよりも著しく興味深いように見えます。特に、NGINX Ingress、ログ収集、statsd、OpenTracingプロトコルとの統合をサポートしているため、作業の最後に接続された瞬間からユーザーリクエストを追跡し、このリクエストのログを見つけることができます（ウェブサーバー側とサイドの両方で）消費者）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datadogを使用すると、マイクロサービスマップが誤って構築されることがあり、技術的な欠陥がいくつかあった。たとえば、彼はサービスのタイプを誤って決定し（キャッシングサービスにDjangoを採用）、人気の高いPredisライブラリを使用するPHPアプリケーションで500番目のエラーを引き起こしました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h5/te/m9/h5tem9e4arkqlsoed48qc0u9xha.png"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アタトゥス</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-最年少のツール。</font><font style="vertical-align: inherit;">サービスは2014年に開始されました。</font><font style="vertical-align: inherit;">そのマーケティング予算は、リストされた競合他社よりも明らかに劣っており、言及はあまり一般的ではありません。</font><font style="vertical-align: inherit;">それにもかかわらず、ツール自体はNew Relicと非常によく似ており、機能（APM、ブラウザーの監視など）だけでなく、外観も異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重大な欠点は、Node.jsとPHPのみをサポートすることです。</font><font style="vertical-align: inherit;">一方、Datadogよりもはるかに優れた実装です。</font><font style="vertical-align: inherit;">後者とは異なり、Atatusはアプリケーションでコード内の追加のタグを変更または設定する必要がありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New Relicとの連携方法</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、New Relicが一般的にどのように使用されるかを見てみましょう。解決する必要のある問題があるとします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mk/_t/bv/mk_tbvlysng7--qgh2gvhjum4cg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チャートで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サージ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に気づくのは簡単</font><font style="vertical-align: inherit;">です。それを分析します。 New Relicでは、WebアプリケーションのWebトランザクションがすぐに選択され、すべてのコンポーネントがパフォーマンスグラフに示されます。エラーレート、リクエストレートのパネルがあります...最も重要なのは、これらのパネルから直接、アプリケーションのさまざまな部分の間を移動できることです（たとえば、MySQLをクリックすると、データベースセクションに）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティビティが急増しているので、この</font><font style="vertical-align: inherit;">グラフをクリックして自動的に[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランザクション</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]に移動します。</font><b><font style="vertical-align: inherit;">トランザクション</font></b><font style="vertical-align: inherit;">の</font></font><br>
<br>
<img src="https://habrastorage.org/webt/02/2v/b_/022vb_o0euwqk8jaf2qh1z4pges.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リストは、本質的にMVCモデルのコントローラーであり、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も時間がかかります</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは非常に便利です。アプリケーションが何をするのかがすぐにわかります。</font><font style="vertical-align: inherit;">New Relicが自動的に収集する長いクエリの例を次に示します。</font><font style="vertical-align: inherit;">並べ替えの切り替えは簡単に見つかります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 最もロードされたアプリケーションコントローラ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 最も頻繁に要求されるコントローラー</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 最も遅いコントローラー。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、各トランザクションを展開して、コード実行時にアプリケーションが実行していたことを確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/bz/sk/vqbzsk-cj4sp9prjqwx16hnzy4k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、アプリケーションは長いクエリトレースの例を格納します（2秒以上で機能します）。長いトランザクションのパネルは次のとおり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jk/b_/ux/jkb_uxm9a3tx9ed6wdtufrz5g6u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
です。2つのメソッドには時間がかかり、リクエストが実行された時間とともに、そのURIとドメインも表示されていることがわかります。多くの場合、これはログでクエリを見つけるのに役立ちます。行く</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トレースの詳細</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらのメソッドが呼び出される場合、あなたが見ることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_1/m6/li/_1m6li8g6zgv8siatzj1mrqiclc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、中に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースのクエリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、アプリケーションが実行された時に実行されたデータベースクエリを評価します：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ru/xv/k7/ruxvk7jbfe-93duilolwh3nj7p8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この知識を武器に、アプリケーションの速度低下の理由を評価し、開発者とともに問題を解決するための戦略を立てることができます。</font><font style="vertical-align: inherit;">実際には、New Relicは常に明確な画像を提供するわけではありませんが、調査のベクトルを選択するのに役立ちます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長い間、</font></font><code>PDO::Construct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはpgpollの奇妙な機能に私たちを導きました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時間の不安定性</font></font><code>Memcache::Get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">により、仮想マシンの構成が正しくないことが示唆されました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> テンプレートの処理に疑わしいほど時間がかかったため、オブジェクトストレージに500アバターが存在するかどうかをチェックするネストされたループが発生しました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 等…</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、メイン画面でコードを実行する代わりに、外部データストレージに関連する何かが大きくなり、それが何であるかは問題ではありません。RedisまたはPostgreSQL-それらはすべて[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブで非表示になります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ku/ke/xe/kukexe0cn79kgj_x_40dt79au5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リサーチの特定のベースを選択してクエリを並べ替えることができます。また、[リクエスト]タブに移動すると、各アプリケーションコントローラーでこのリクエストがどの程度見つかったかを確認できるだけでなく、そのリクエストが呼び出される頻度を評価できます。これは非常に便利です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ac/jm/xq/acjmxqt0dop9r1ncalo1enmrihq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部サービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブには同様のデータが含まれており</font><font style="vertical-align: inherit;">、オブジェクトストアへのアクセス、監視センターへのイベントの送信など、外部HTTPサービスのリクエストが非表示になります。その内容では、タブはデータベースと完全に似ています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/2h/al/vv2halrqjfjjpqltn7ty1had57y.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">競合他社：機会と印象</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで最も興味深いのは、New Relicの機能を競合他社が提供している機能と比較することです。</font><font style="vertical-align: inherit;">残念ながら、本番環境で実行されている1つのアプリケーションの同じバージョンで3つのツールすべてをテストすることはできませんでした。</font><font style="vertical-align: inherit;">それにもかかわらず、私たちは最も同一の状況/構成を比較しようとしました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.データドッグ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datadogはウォールパネルサービスで私たちに挨拶します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/vv/rt/ytvvrt5tlhegxiaoanulug0dwfu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はアプリケーションをコンポーネント/ mikroservisyに分割しようとしているため、Django-applicationの例では、PostgreSQL（</font></font><code>defaultdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><code>postgres</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">Celery </font><font style="vertical-align: inherit;">、Redis </font><font style="vertical-align: inherit;">に接続するために2が表示されます</font><font style="vertical-align: inherit;">。 Datadogを使用するには、MVCの原則に関する最低限の知識が必要です。ユーザーリクエストの送信元を理解する必要があります。通常、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスマップ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はこれに役立ちます</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t3/19/r9/t319r9yb96o3h0fjhdmi5wzdxbc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、New Relicにも同様のものがあり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f8/sr/tq/f8srtq3vds1qmm2ddrp_g-d6pwo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">...そして私の地図では、それらのマップはよりシンプルで理解しやすくなっています：1つのアプリケーションのコンポーネントを表示しません（Datadogの場合のように、詳細になりすぎます）。 、ただし特定のサービスまたはマイクロサービスのみ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datadogに戻りましょう。ユーザーのリクエストがDjangoに到達することはサービスマップから明らかです。 Djangoサービスにアクセスして、最後に期待した結果を見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c3/ip/fk/c3ipfkqpsv9jxxr1m0y9lqz7fvw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、デフォルトでは</font><font style="vertical-align: inherit;">、New Relicのメインパネルに表示</font><font style="vertical-align: inherit;">される</font><font style="vertical-align: inherit;">ような</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webトランザクションタイム</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケジュールはありません</font><font style="vertical-align: inherit;">。ただし、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時間の経過時間の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グラフの代わりに構成できます</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプごとのリクエストあたりの平均時間</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に切り替えるだけで十分</font><font style="vertical-align: inherit;">です。今度は、おなじみのグラフが表示されます</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0l/jb/4m/0ljb4m2fh3_mbje9ihwvo6hlwge.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datadogが別のスケジュールを選択した理由は私たちにとって謎です。また、システムがユーザーの選択を（両方の競合他社とは異なり）覚えていないため、カスタムパネルの作成だけが保存されることもイライラしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、Datadogでこれらのグラフから関連サーバーのメトリックに切り替え、ログを読み取り、Webサーバーハンドラー（Gunicorn）の負荷を評価する機会に満足しました。すべてはNew Relicとほぼ同じです...さらにいくつか（ログ）！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフの下には、New Relicに完全に類似した</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/pg/u5/lnpgu5fj2oclzdzlc1uwwjjtfkm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トランザクションがあります。Datadogでは、トランザクションは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソース</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><font style="vertical-align: inherit;">ます。リクエスト数、平均応答時間、選択した期間の最大経過時間でコントローラーを並べ替えることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リソースを展開して、New Relicですでに観察したすべてを見ることができます。リソースの</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3s/c1/5k/3sc15ksmnyvw_e-gyfagahxtep8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
統計、内部呼び出しの一般化されたリスト、および応答コードでソートできるリクエストの例があります...ところで、エンジニアはこのソートを非常に気に入っていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datadogのリソースの任意の例を開いて調査できます</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k8/tm/j8/k8tmj8vcz91rwmv-_lvshtzd8qi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。クエリパラメーター、各コンポーネントの経過時間の概要図、一連の呼び出し</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">表示されるウォーターフォール図</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">表示されます。また、ウォーターフォール図のツリービューに切り替えることもできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/og/uu/ro/oguurozj3wo9vibezkytxmmc0c4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も興味深いのは、リクエストが実行されたホストの負荷を表示し、クエリログを表示することです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/n6/be/vgn6belqdye20suvjgsq5kje3wu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
素晴らしい統合！</font><font style="vertical-align: inherit;">New Relicのように</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部サービスの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タブがどこにあるのか不思議に思うかもしれません</font><font style="vertical-align: inherit;">。それらはここにはありません。Datadogはアプリケーションをコンポーネントに解析するため、PostgreSQLは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別個のサービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と見なされ、</font><font style="vertical-align: inherit;">外部サービスの代わりに一見の価値があります。</font></font><code>aws.storage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（同様に、アプリケーションがアクセスできるのは他のすべての外部サービスの場合です）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qp/bp/ap/qpbpapt5pqxtre_bkspuob-myqe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ここに例があり</font></font><code>postgres</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/u6/ea/nbu6eaa6-6xlbkipsijjn4i9rxg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、私たちが望んでいたものはすべて同じです：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ww/r8/-c/wwr8-cpjbw26yv_chyaknlyolfe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どの「サービス」からリクエストが来た</font><font style="vertical-align: inherit;">かがわかり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DatadogはNGINX Ingressと完全に統合され、リクエストがクラスターに到着した瞬間からエンドツーエンドのトレースを可能にし、statsdメトリックを受け入れ、ログとホストメトリックを収集できることを思い出しても不必要ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datadogの大きなプラスは、その価格がということです</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から成り</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、すなわち、インフラストラクチャの監視、APM、ログ管理およびシンセティックテストの </font><font style="vertical-align: inherit;">プランは柔軟に選択できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Atatus</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atatusチームは、サービスは「New Relicと同じですが、より優れています」と述べています。これが本当にそうかどうか見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タイトルバーは実際には同じに見えますが、アプリケーションで使用されているRedisとmemcachedを特定することはできませんでした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/f8/9t/-vf89tugun8vmi3f8vc5upnswpq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APMはデフォルトですべてのトランザクションを選択しますが、通常はWebのみが必要です。 Datadogと同様に、メインパネルから目的のサービスに切り替える方法はありません。さらに、トランザクションはエラーの後にリストされますが、これはAPMにとってはあまり論理的に見えません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atatusトランザクションでは、すべてが可能な限りNew Relicに似ています。マイナス-各コントローラーのダイナミクスをすぐに確認することはできません。コントローラテーブルでそれを探し、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も消費さ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れた</font><b><font style="vertical-align: inherit;">時間</font></b><font style="vertical-align: inherit;">でソート</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/gm/df/1rgmdfhp2wi-etyz90cp-nhicne.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
する必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常のコントローラのリストは、[ </font><b><font style="vertical-align: inherit;">エクスプローラ</font></b><font style="vertical-align: inherit;"> ]タブにあります。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n6/bm/4e/n6bm4epe4rgm1o0-j6gckbe5xcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの点で、このテーブルはDatadogに似ており、New Relicのテーブルに似ています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各トランザクションを展開して、アプリケーションの動作を確認できます</font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/nj/jz/omnjjzghaohvdghitkkynauqwd8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。パネルもDatadogに似ている可能性が高くなります。要求の数、呼び出しの全体像があります。トップパネルはとタブを提供して</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP失敗の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラー</font><font style="vertical-align: inherit;">と遅いの例</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セッショントレースの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cp/xo/jccpxoykxlwophfgejumdduui88.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたがトランザクションに入る場合は、トレースの例を見ることができ、データベースへの要求のリストを取得し、リクエストヘッダを見ることができます。すべてがNew Relicに似ています：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_c/lb/dn/_clbdnkiqpd-6spg325of0c09o0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、Atatusは詳細なトレースに満足しています-リマインダーブロックへの呼び出しの典型的なNew Relic接着なし：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m5/ub/hk/m5ubhk5bxdzyqwg3oaidmflbmjc.png"><br>
<img src="https://habrastorage.org/webt/hv/3s/27/hv3s27-mped0zuubmx9qs-7b_7c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、（New Relicのように）超高速のリクエスト（&lt;5ms）を遮断する十分なフィルターはありません。</font><font style="vertical-align: inherit;">一方、最終的なトランザクション応答（成功またはエラー）の表示は快適でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]パネル</font><font style="vertical-align: inherit;">は、アプリケーションが行う外部データベースへのクエリを調べるのに役立ちます。</font><font style="vertical-align: inherit;">AtatusはPostgreSQLとMySQLのみを検出したことを思い出させてください。ただし、Redisとmemcachedもこのプロジェクトに関与しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/1z/vn/rj1zvn9n6wvmcbzcx1fj65x1mmg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要求は、通常の基準（応答頻度、平均応答時間など）でソートされます。</font><font style="vertical-align: inherit;">クエリが最も遅いタブにも注目したいと思います。これは非常に便利です。</font><font style="vertical-align: inherit;">さらに、このPostgreSQLのタブのデータは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_stat_statements</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張のデータと一致しました</font><font style="vertical-align: inherit;">-素晴らしい結果です！</font><b><font style="vertical-align: inherit;">[外部リクエスト]</font></b></font><br>
<br>
<img src="https://habrastorage.org/webt/-4/th/4c/-4th4c5ykhiikiwtmrk23rr7g7g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
タブ</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> データベースと完全に同一です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
提示されたツールはどちらも、APMの役割でうまく機能しました。</font><font style="vertical-align: inherit;">それらのどれでも必要な最低限を提供できます。</font><font style="vertical-align: inherit;">次のように私たちの印象を簡単に要約します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データドッグ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
長所：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 便利な料金表（APMはホストあたり31米ドル）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pythonで完全に表示されました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenTracingと統合する機能</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kubernetesの統合</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NGINX Ingressとの統合。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイナス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> モジュールエラー（predis）が原因でアプリケーションにアクセスできなくなった唯一のAPM</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 弱いPHP自動ツール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サービスとその目的の部分的に奇妙な定義。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アタトゥス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
長所：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PHPの深いインストルメンテーション。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> New Relicユーザーインターフェースに似ています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイナス：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 古いオペレーティングシステム（Ubuntu 12.05、CentOS 5）では機能しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 弱い自動ツール;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2言語のみのサポート（Node.jsとPHP）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> インターフェースの動作が遅い。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atatusの価格がサーバーあたり月額69米ドルであることを考えると、Datadogを使用することをお勧めします。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのブログも読んでください：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesで実行されているアプリケーションの開発者向けのツール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubernetesポッドでデバッグするためのKubectl-debugプラグイン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロサービス：Kubernetesを使用している場合でも、サイズは重要です</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。」</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja465161/index.html">Quintetデータモデルと数百ギガバイトのデータ</a></li>
<li><a href="../ja465163/index.html">3Dプリント：素晴らしいケースともう少し興味深い</a></li>
<li><a href="../ja465167/index.html">リソースプランニング。なぜ動作しないのですか？パート1</a></li>
<li><a href="../ja465169/index.html">PVS-StudioのDIY：実績のゲーミフィケーション</a></li>
<li><a href="../ja465173/index.html">アプリケーションで作成されたサブスクリプションのコストを変更する方法。App Store ConnectとGoogle Play Console</a></li>
<li><a href="../ja465179/index.html">自動化は手動テストに取って代わりますか？</a></li>
<li><a href="../ja465181/index.html">C ++ 17の滑りやすい場所</a></li>
<li><a href="../ja465185/index.html">新しいビデオ監視規格：夜間のカラー、ノイズ対策、ePoE</a></li>
<li><a href="../ja465187/index.html">外国企業との給与交渉に使える6つの英フレーズ</a></li>
<li><a href="../ja465189/index.html">Workflow One Sprint開発チーム</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>