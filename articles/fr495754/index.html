<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏿 👩🏻‍💻 🎃 Interphone intelligent d'ingénierie ouverte ou inversée SIM-SIM 👌 📉 🍐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Après avoir lu le post KrupnikasIl y avait une idée pour gérer mitmproxy et voir comment le backend des applications mobiles utilisées quotidiennement...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Interphone intelligent d'ingénierie ouverte ou inversée SIM-SIM</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495754/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après avoir lu le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">post</font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Krupnikas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y avait une idée pour gérer mitmproxy et voir comment le backend des applications mobiles utilisées quotidiennement est organisé. </font><font style="vertical-align: inherit;">Le choix s'est porté sur l'application interphone. </font><font style="vertical-align: inherit;">Après autorisation, il vous permet d'ouvrir les portes et de répondre aux appels vidéo. </font><font style="vertical-align: inherit;">Ce qui en est ressorti et quels trous j'ai réussi à trouver, je le dirai sous la coupe.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cd/rc/hu/cdrchuiued3otgzhrka3gqtgdqa.jpeg"></div><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paramètres du proxy</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour analyser le trafic, une approche appelée homme au milieu est souvent utilisée. Il consiste en ce que lorsqu'il est connecté à un réseau local, le trafic provenant de l'appareil analysé va d'abord vers l'ordinateur sur lequel il est décrypté et analysé, puis il est rechiffré et envoyé au serveur. Pour décrypter le trafic, le plus populaire est le programme mitmproxy. L'installation de mitmproxy n'était pas un gros problème.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour afficher le trafic depuis un appareil mobile, vous devez vous connecter à votre wifi domestique depuis votre téléphone et votre ordinateur. </font><font style="vertical-align: inherit;">Installez mitmproxy sur l'ordinateur et exécutez. </font><font style="vertical-align: inherit;">Sur le téléphone dans les paramètres wifi, définissez l'adresse locale et le port de l'ordinateur en tant que serveur proxy. </font><font style="vertical-align: inherit;">Ensuite, accédez à mitm.it depuis le téléphone et installez un certificat qui vous permet de décrypter les requêtes https. </font><font style="vertical-align: inherit;">Après ces étapes, les demandes du navigateur sont devenues visibles. </font><font style="vertical-align: inherit;">Hourra! </font><font style="vertical-align: inherit;">Cependant, l'étape suivante a été la déception:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/js/ot/7e/jsot7e1q5qkrqftcgvxvwy2h1mq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une recherche sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conduit à un problème ouvert sur le </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">github</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il s'est avéré qu'à partir de l'API niveau 24, les applications ne font plus confiance aux certificats utilisateur. </font><font style="vertical-align: inherit;">Heureusement, vous pouvez contourner ce problème en décompressant apk et en ajoutant la configuration suivante à AndroidManifest.xml:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">network-security-config</span>&gt;</span>  
     <span class="hljs-tag">&lt;<span class="hljs-name">debug-overrides</span>&gt;</span>  
          <span class="hljs-tag">&lt;<span class="hljs-name">trust-anchors</span>&gt;</span>  
               <span class="hljs-comment">&lt;!-- Trust preinstalled CAs --&gt;</span>  
               <span class="hljs-tag">&lt;<span class="hljs-name">certificates</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"system"</span> /&gt;</span>  
               <span class="hljs-comment">&lt;!-- Additionally trust user added CAs --&gt;</span>  
               <span class="hljs-tag">&lt;<span class="hljs-name">certificates</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"user"</span> /&gt;</span>  
          <span class="hljs-tag">&lt;/<span class="hljs-name">trust-anchors</span>&gt;</span>  
     <span class="hljs-tag">&lt;/<span class="hljs-name">debug-overrides</span>&gt;</span>  
<span class="hljs-tag">&lt;/<span class="hljs-name">network-security-config</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il y a un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prêt à l'emploi sur le github </font><font style="vertical-align: inherit;">qui le fait automatiquement. </font><font style="vertical-align: inherit;">Alors, téléchargez apk, script de patch, installez adb install et le tour est joué.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse du trafic</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous constatons que les demandes sont adressées aux adresses du formulaire:</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deux paramètres sont passés dans l'en-tête: </font></font><br>
<pre><code class="python hljs"><span class="hljs-string">'api-version'</span>: <span class="hljs-string">'2'</span>,
<span class="hljs-string">'authorization'</span>:&nbsp; <span class="hljs-string">'Bearer&nbsp;your.jwt.token’
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier paramètre est la version api et le second est le jeton d'autorisation. </font><font style="vertical-align: inherit;">Pour l'autorisation, un jeton Web json est utilisé, qui se compose de trois parties: l'en-tête, la charge utile et la signature. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Décodez-le avec la commande:</font></font><br>
<br>
<pre><code class="bash hljs">pyjwt decode --no-verify your.jwt.token
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
voir que la charge utile contient account_id et exp. </font><font style="vertical-align: inherit;">Le champ exp correspond à l'heure de création du jeton, ce qui vous permet de générer des jetons pour différents appareils à partir d'un seul compte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les plus intéressantes pour nous sont les demandes de liste des interphones disponibles et des portes qui s'ouvrent. </font><font style="vertical-align: inherit;">Lors de l'envoi d'une requête (j'ai utilisé python et la bibliothèque de requêtes) à</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/customers/properties/{account_id}/intercoms 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous obtenons json contenant une liste d'interphones avec des champs:</font></font><br>
<br>
<pre><code class="json hljs">[<font></font>
    {<font></font>
        'id': ID,<font></font>
        'mode': MODE, <font></font>
        'sip_account': {'ex_user': USER_ID, 'proxy': PROXY,  'password': PSWD}, <font></font>
        'video': [{'quality': 'low', 'source': 'rtsp:<span class="hljs-comment">//LINK }]</span><font></font>
    }<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans json id - identifiant d'interphone, mode - quelle porte peut être ouverte (les valeurs possibles sont one_door, left_door, right_door), un compte SIP et un lien vers la diffusion vidéo. Hou la la! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant le protocole d'ouverture de session (SIP), les appels vidéo sont effectués via l'interphone. Dans le champ sip_account, nous avons reçu id'shniki et les mots de passe pour les interphones auxquels notre compte a accès. Les appeler tout de même ne fonctionne pas, car ils sont sur le réseau interne. Mais le champ vidéo est intéressant. Il contient un lien externe pour diffuser la vidéo de la caméra. Il suffit d'ouvrir vlc, de copier le lien et vous pouvez regarder autour de l'horloge sur la caméra de l'interphone. Ce n'est pas bon de disperser de tels liens! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous découvrirons comment ouvrir la porte. Lorsque vous cliquez sur le bouton d'ouverture de la porte, l'application envoie une demande d'obtention:</font></font><br>
<br>
<pre><code class="bash hljs">https://{intercom-company-url}/api/customers/intercoms/{intercom_id}/unlock?door=left_door&amp;id={intercom_id}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré que la présence ou l'absence du paramètre id n'affecte rien, mais la porte permet dans le cas d'un interphone à deux portes d'ouvrir non seulement la vôtre, mais aussi la porte suivante de votre choix. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim-sim ouvert!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir compris l'api, j'ai décidé de faire quelque chose d'utile. </font><font style="vertical-align: inherit;">Le résultat est une application Android qui reconnaît les commandes vocales et lorsqu'elle reconnaît des commandes prédéfinies comme «sim-sim open», elle envoie une demande d'ouverture de la porte correspondante.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">résultats</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un interphone intelligent est bien, mais un interphone sûr et intelligent est encore mieux.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495732/index.html"># 03 - Et un octet entier ne suffit pas ... | 2B ou pas 2B</a></li>
<li><a href="../fr495740/index.html">Comme nous avons passé une semaine sans argent, les connexions et les logiciels ont lancé un service de livraison de nourriture et n'ont presque pas foiré</a></li>
<li><a href="../fr495746/index.html">Nous formons View dans SwiftUI, en partant des conditions</a></li>
<li><a href="../fr495748/index.html">Nouveau Punto Switcher pour Linux: xswitcher</a></li>
<li><a href="../fr495752/index.html">Quand la pandémie va-t-elle décliner? Évaluation en Python avec Pandas</a></li>
<li><a href="../fr495756/index.html">Principes clés pour l'utilisation d'ECS dans le développement de jeux</a></li>
<li><a href="../fr495758/index.html">Incendies et stratégie</a></li>
<li><a href="../fr495760/index.html">Plus lumineux que les étoiles: changement de marque HGST et reconstitution de la gamme Ultrastar</a></li>
<li><a href="../fr495762/index.html">Prosto: retirez le passe-partout lorsque vous travaillez avec RecyclerView</a></li>
<li><a href="../fr495764/index.html">CSI Linux: distribution Linux pour les cyber-enquêtes et OSINT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>