<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’˜ ğŸ‘¨ğŸ¼â€ğŸ³ ğŸ‘§ ä½¿ç”¨mlr3è½¯ä»¶åŒ…çš„Rè¯­è¨€æœºå™¨å­¦ä¹  ğŸ‘¨ğŸ»â€ğŸ”¬ ğŸ‘©â€ğŸ”§ â›³ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="èµ„æ–™æ¥æºï¼šhttps : //mlr3book.mlr-org.com/
 
 å“ˆHaï¼
 
 åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä½¿ç”¨Rè¯­è¨€å¼€å‘å½“ä»Šæœ€å‘¨åˆ°çš„æœºå™¨å­¦ä¹ æ–¹æ³•-mlr3è½¯ä»¶åŒ…åŠå…¶å‘¨å›´çš„ç”Ÿæ€ç³»ç»Ÿã€‚è¯¥æ–¹æ³•åŸºäºä½¿ç”¨R6ç±»çš„â€œå¸¸è§„â€ OOPï¼Œå¹¶ä»¥æ•°æ®å’Œæ¨¡å‹ä»¥è®¡ç®—å›¾çš„å½¢å¼è¡¨ç¤ºæ‰€æœ‰æ“ä½œã€‚è¿™ä½¿æ‚¨å¯ä»¥ä¸ºæœºå™¨å­¦ä¹ ä»»åŠ¡åˆ›å»º...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨mlr3è½¯ä»¶åŒ…çš„Rè¯­è¨€æœºå™¨å­¦ä¹ </h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ods/blog/491566/"><img src="https://habrastorage.org/webt/r3/-o/p_/r3-op_7dtewyjrmorqxmotmtm2q.png"><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èµ„æ–™æ¥æºï¼š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//mlr3book.mlr-org.com/</font></font></a></em><br>
</p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å“ˆHaï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä½¿ç”¨Rè¯­è¨€å¼€å‘å½“ä»Šæœ€å‘¨åˆ°çš„æœºå™¨å­¦ä¹ æ–¹æ³•</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-mlr3</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¯ä»¶åŒ…</font><font style="vertical-align: inherit;">åŠå…¶å‘¨å›´çš„ç”Ÿæ€ç³»ç»Ÿã€‚</font><font style="vertical-align: inherit;">è¯¥æ–¹æ³•åŸºäºä½¿ç”¨R6ç±»çš„â€œå¸¸è§„â€ OOPï¼Œå¹¶ä»¥æ•°æ®å’Œæ¨¡å‹ä»¥è®¡ç®—å›¾çš„å½¢å¼è¡¨ç¤ºæ‰€æœ‰æ“ä½œã€‚</font><font style="vertical-align: inherit;">è¿™ä½¿æ‚¨å¯ä»¥ä¸ºæœºå™¨å­¦ä¹ ä»»åŠ¡åˆ›å»ºç²¾ç®€è€Œçµæ´»çš„ç®¡é“ï¼Œä½†æ˜¯èµ·åˆçœ‹èµ·æ¥ä¼¼ä¹å¾ˆå¤æ‚ä¸”ä»¤äººå›°æƒ‘ã€‚</font><font style="vertical-align: inherit;">ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å°è¯•ä½¿</font><font style="vertical-align: inherit;">æ‚¨çš„é¡¹ç›®</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´åŠ </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸…æ™°ï¼Œå¹¶æ¿€å‘ä½¿ç”¨</font><strong><font style="vertical-align: inherit;">mlr3çš„</font></strong><font style="vertical-align: inherit;">ç§¯ææ€§</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†…å®¹ï¼š</font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†å²å’Œä¸ç«äº‰è§£å†³æ–¹æ¡ˆçš„æ¯”è¾ƒ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŠ€æœ¯ç»†èŠ‚ï¼šR6ç±»å’Œdata.tableåŒ…</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mlr3ä¸­MLç®¡çº¿çš„ä¸»è¦ç»„ä»¶</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾ç½®è¶…å‚æ•°</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MLR3ç”Ÿæ€ç³»ç»Ÿæ¦‚è¿°</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®¡é“å’Œè®¡ç®—å›¾</font></font></a></li>
</ol><a name="habracut"></a><br>
<h4 id="section1">1.       </h4><br>
<h5>caret â€” ,   </h5><br>
<p> <strong>caret</strong>           R          (  CRAN   2007 ).  2013               <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Applied Predictive Modeling</a>,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>            .</p><br>
<p>:</p><br>
<ul>
<li>     (   -   );</li>
<li>      (-),     ,     ,      ;</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> ,       <strong>caret</strong>-    -  ;</li>
<li>     â€” ,  <strong>xgboost</strong>        <code>nrounds</code>, <code>max_depth</code>, <code>eta</code>, <code>gamma</code>, <code>colsample_bytree</code>, <code>min_child_weight</code>  <code>subsample</code>.</li>
</ul><br>
<p>:</p><br>
<ul>
<li>        â€”     ,       .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>;</li>
<li>             :      ,       .  <strong>recipes</strong>    ,    ;</li>
<li>  - (nested resampling),         <strong>caretEnsemble</strong>.</li>
</ul><br>
<h5>tidyverse strikes back</h5><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>    <strong>tidymodels</strong>,     <strong>recipes</strong> (   Â«Â»   ,              ), <strong>rsample</strong> (    )    <strong>tune</strong> (   ). </p><br>
<p>:</p><br>
<ul>
<li>Â«Â»       ,        ;</li>
<li>   ,       <strong>embed</strong>  <strong>textrecipes</strong>;</li>
<li>    ,       .       ( <strong>tune</strong>);</li>
<li> <strong>workflows</strong>       Â«Â»    .</li>
</ul><br>
<p>:</p><br>
<ul>
<li>        ,   <strong>tune</strong> . Â«Â»  ,    ,           <code>apply</code>/<code>map</code>-;</li>
<li>          . ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> 200  ;</li>
<li> -     .</li>
</ul><br>
<h5>mlr3 vs  </h5><br>
<p> <strong>mlr3</strong>               <strong>mlr</strong>   ,     <strong>caret</strong>  <strong>tidymodels</strong>. <strong>mlr</strong>      ,        <strong>mlr3</strong>.</p><br>
<p>:</p><br>
<ul>
<li>   R6-,          <strong>data.table</strong>;</li>
<li>       .            ,              ;</li>
<li>     API  ,       <code>learner</code> â€”             ;</li>
<li>    .</li>
</ul><br>
<p>:</p><br>
<ul>
<li>      :    ,     (   ),     ;</li>
<li>     .</li>
</ul><br>
<h4 id="section2">2.  : R6-   data.table</h4><br>
<p>   <strong>mlr3</strong>  Â«Â» ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">R6-</a>. R6-  ,         .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Advanced R</a>,     ,    .</p><br>
<p> R6-    <code>R6Class()</code>:</p><br>
<pre><code class="plaintext hljs">library(R6)<font></font>
<font></font>
Accumulator &lt;- R6Class("Accumulator", list(<font></font>
  sum = 0,<font></font>
  add = function(x = 1) {<font></font>
    self$sum &lt;- self$sum + x <font></font>
    invisible(self)<font></font>
  })<font></font>
)</code></pre><br>
<p>       â€”     <code>"Accumulator"</code>.</p><br>
<p>    <code>new()</code>,    (,     , )  :</p><br>
<pre><code class="plaintext hljs">x &lt;- Accumulator$new() </code></pre><br>
<p>,      ,       :</p><br>
<pre><code class="plaintext hljs">x$add(4) <font></font>
x$sum<font></font>
#&gt; [1] 4</code></pre><br>
<p>R6-   :</p><br>
<pre><code class="plaintext hljs">y1 &lt;- Accumulator$new() <font></font>
y2 &lt;- y1<font></font>
<font></font>
y1$add(10)<font></font>
c(y1 = y1$sum, y2 = y2$sum)<font></font>
#&gt; y1 y2 <font></font>
#&gt; 10 10</code></pre><br>
<p>       <code>clone()</code> ( <code>clone(deep = TRUE)</code>     ):</p><br>
<pre><code class="plaintext hljs">y1 &lt;- Accumulator$new() <font></font>
y2 &lt;- y1$clone()<font></font>
<font></font>
y1$add(10)<font></font>
c(y1 = y1$sum, y2 = y2$sum)<font></font>
#&gt; y1 y2 <font></font>
#&gt; 10  0</code></pre><br>
<p> ,     R6      <strong>mlr3</strong>. </p><br>
<p>           <strong>data.table</strong>      (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> data.table</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">data.table:          R</a>). -          <code>data.table</code>,        <code>:=</code>    . ,          ,     2   ,   .              ,    ,   .</p><br>
<h4 id="section3">3.   ML-  mlr3</h4><br>
<img src="https://habrastorage.org/webt/b7/dy/ex/b7dyexo79bs7eswm3j_yvlnxie8.png"><br>
<p><em>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://mlr3book.mlr-org.com/</a></em></p><br>
<p>        <strong>mlr3</strong>   :</p><br>
<pre><code class="plaintext hljs">library(mlr3)<font></font>
<font></font>
# <font></font>
task &lt;- TaskClassif$new(id = "iris", <font></font>
                        backend = iris, <font></font>
                        target = "Species")<font></font>
task<font></font>
# &lt;TaskClassif:iris&gt; (150 x 5)<font></font>
# * Target: Species<font></font>
# * Properties: multiclass<font></font>
# * Features (4):<font></font>
#   - dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width<font></font>
<font></font>
# <font></font>
# learner_rpart &lt;- mlr_learners$get("classif.rpart")<font></font>
learner_rpart &lt;- lrn("classif.rpart", <font></font>
                     predict_type = "prob", <font></font>
                     minsplit = 50)<font></font>
learner_rpart<font></font>
# &lt;LearnerClassifRpart:classif.rpart&gt;<font></font>
# * Model: -<font></font>
# * Parameters: xval=0, minsplit=50<font></font>
# * Packages: rpart<font></font>
# * Predict Type: prob<font></font>
# * Feature types: logical, integer, numeric, factor, ordered<font></font>
# * Properties: importance, missings, multiclass, selected_features, twoclass, weights<font></font>
<font></font>
#  <font></font>
learner_rpart$param_set<font></font>
# ParamSet: <font></font>
#                id    class lower upper levels     default value<font></font>
# 1:       minsplit ParamInt     1   Inf                 20    50<font></font>
# 2:      minbucket ParamInt     1   Inf        &lt;NoDefault&gt;      <font></font>
# 3:             cp ParamDbl     0     1               0.01      <font></font>
# 4:     maxcompete ParamInt     0   Inf                  4      <font></font>
# 5:   maxsurrogate ParamInt     0   Inf                  5      <font></font>
# 6:       maxdepth ParamInt     1    30                 30      <font></font>
# 7:   usesurrogate ParamInt     0     2                  2      <font></font>
# 8: surrogatestyle ParamInt     0     1                  0      <font></font>
# 9:           xval ParamInt     0   Inf                 10     0<font></font>
<font></font>
# <font></font>
learner_rpart$train(task, row_ids = 1:120) <font></font>
learner_rpart$model<font></font>
# n= 120 <font></font>
# <font></font>
# node), split, n, loss, yval, (yprob)<font></font>
#       * denotes terminal node<font></font>
# <font></font>
# 1) root 120 70 setosa (0.41666667 0.41666667 0.16666667)  <font></font>
#   2) Petal.Length&lt; 2.45 50  0 setosa (1.00000000 0.00000000 0.00000000) *<font></font>
#   3) Petal.Length&gt;=2.45 70 20 versicolor (0.00000000 0.71428571 0.28571429)  <font></font>
#     6) Petal.Length&lt; 4.95 49  1 versicolor (0.00000000 0.97959184 0.02040816) *<font></font>
#     7) Petal.Length&gt;=4.95 21  2 virginica (0.00000000 0.09523810 0.90476190) *</code></pre><br>
<p>    :  (task)   (learner). </p><br>
<p>      (<code>TaskClassif</code>  , <code>TaskRegr</code>    ..)    <code>new()</code>.     <code>id</code>,    <code>backend</code>    <code>target</code>;         <code>positive</code>.        : <code>mlr_tasks$get("iris")</code>  <code>tsk("iris")</code>.</p><br>
<p>    <code>mlr_learners</code>    <code>get()</code>       <code>train()</code>,      <code>task</code>   ,   .        : <code>lrn("classif.rpart", predict_type = "prob", minsplit = 50)</code>.         (<code>predict_type = "prob"</code>)    (<code>minsplit = 50</code>).       : <code>learner_rpart$predict_type &lt;- "prob"</code>, <code>learner_rpart$param_set$values$minsplit = 50</code>. </p><br>
<p>           <code>predict_newdata()</code>:</p><br>
<pre><code class="plaintext hljs">#    <font></font>
preds &lt;- learner_rpart$predict_newdata(newdata = iris[121:150, ])<font></font>
preds<font></font>
# &lt;PredictionClassif&gt; for 30 observations:<font></font>
#     row_id     truth   response prob.setosa prob.versicolor prob.virginica<font></font>
#          1 virginica  virginica           0       0.0952381     0.90476190<font></font>
#          2 virginica versicolor           0       0.9795918     0.02040816<font></font>
#          3 virginica  virginica           0       0.0952381     0.90476190<font></font>
# ---                                                                       <font></font>
#         28 virginica  virginica           0       0.0952381     0.90476190<font></font>
#         29 virginica  virginica           0       0.0952381     0.90476190<font></font>
#         30 virginica  virginica           0       0.0952381     0.90476190</code></pre><br>
<p> -    5 :</p><br>
<pre><code class="plaintext hljs">cv10 &lt;- rsmp("cv", folds = 5)<font></font>
<font></font>
resample_results &lt;- resample(task, learner_rpart, cv10)<font></font>
# INFO  [09:37:05.993] Applying learner 'classif.rpart' on task 'iris' (iter 1/5) <font></font>
# INFO  [09:37:06.018] Applying learner 'classif.rpart' on task 'iris' (iter 2/5) <font></font>
# INFO  [09:37:06.042] Applying learner 'classif.rpart' on task 'iris' (iter 3/5) <font></font>
# INFO  [09:37:06.074] Applying learner 'classif.rpart' on task 'iris' (iter 4/5) <font></font>
# INFO  [09:37:06.098] Applying learner 'classif.rpart' on task 'iris' (iter 5/5) <font></font>
<font></font>
resample_results<font></font>
# &lt;ResampleResult&gt; of 5 iterations<font></font>
# * Task: iris<font></font>
# * Learner: classif.rpart<font></font>
# * Warnings: 0 in 0 iterations<font></font>
# * Errors: 0 in 0 iterations<font></font>
<font></font>
#    (-):<font></font>
as.data.table(mlr_resamplings)<font></font>
#            key        params iters<font></font>
# 1:   bootstrap repeats,ratio    30<font></font>
# 2:      custom                   0<font></font>
# 3:          cv         folds    10<font></font>
# 4:     holdout         ratio     1<font></font>
# 5: repeated_cv repeats,folds   100<font></font>
# 6: subsampling repeats,ratio    30</code></pre><br>
<p>   .     <code>score()</code>     <code>resample_results</code>,       â€” accuracy <code>"classif.acc"</code>  classification error <code>"classif.ce"</code>.     ,     <code>get()</code>: <code>mlr_measures$get("classif.ce")</code>.          <code>msrs()</code>:</p><br>
<pre><code class="plaintext hljs">resample_results$score(msrs(c("classif.acc", "classif.ce")))[, 5:10]<font></font>
#   <font></font>
#        resampling resampling_id iteration prediction classif.acc classif.ce<font></font>
# 1: &lt;ResamplingCV&gt;            cv         1     &lt;list&gt;   0.8666667 0.13333333<font></font>
# 2: &lt;ResamplingCV&gt;            cv         2     &lt;list&gt;   0.9666667 0.03333333<font></font>
# 3: &lt;ResamplingCV&gt;            cv         3     &lt;list&gt;   0.9333333 0.06666667<font></font>
# 4: &lt;ResamplingCV&gt;            cv         4     &lt;list&gt;   0.9666667 0.03333333<font></font>
# 5: &lt;ResamplingCV&gt;            cv         5     &lt;list&gt;   0.9333333 0.06666667</code></pre><br>
<h4 id="section4">4.  </h4><br>
<p>   â€”    .    ,       .</p><br>
<p>       .      <strong>paradox</strong>:</p><br>
<pre><code class="plaintext hljs">library("paradox")<font></font>
searchspace &lt;- ParamSet$new(list(<font></font>
  ParamDbl$new("cp", lower = 0.001, upper = 0.1),<font></font>
  ParamInt$new("minsplit", lower = 1, upper = 10)<font></font>
))<font></font>
searchspace<font></font>
# ParamSet: <font></font>
#          id    class lower upper levels     default value<font></font>
# 1:       cp ParamDbl 0.001   0.1        &lt;NoDefault&gt;      <font></font>
# 2: minsplit ParamInt 1.000  10.0        &lt;NoDefault&gt; </code></pre><br>
<p>     <code>ParamSet</code>,          <code>cp</code>    <code>minsplit</code>;     <code>rpart</code>   . </p><br>
<p>   ,   <code>searchspace</code>       .        <code>tune()</code>   <code>Tuner</code>.       .      <code>resolution</code>,       ,    <code>param_resolutions</code>,       .  ,        ,     .</p><br>
<p> <code>generate_design_grid()</code>     ,     :</p><br>
<pre><code class="plaintext hljs">generate_design_grid(searchspace, <font></font>
                     param_resolutions = c("cp" = 2, "minsplit" = 3))<font></font>
# &lt;Design&gt; with 6 rows:<font></font>
#       cp minsplit<font></font>
# 1: 0.001        1<font></font>
# 2: 0.001        5<font></font>
# 3: 0.001       10<font></font>
# 4: 0.100        1<font></font>
# 5: 0.100        5<font></font>
# 6: 0.100       10</code></pre><br>
<p>      : <code>generate_design_random()</code>       <code>generate_design_lhs()</code>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.</p><br>
<p>   ,      .      <code>Terminator</code>-,    ,    (   ),       .      <strong>mlr3tuning</strong>:</p><br>
<pre><code class="plaintext hljs">library("mlr3tuning")<font></font>
<font></font>
evals20 &lt;- term("evals", n_evals = 20)<font></font>
evals20<font></font>
# &lt;TerminatorEvals&gt;<font></font>
# * Parameters: n_evals=20<font></font>
<font></font>
#  <font></font>
as.data.table(mlr_terminators)<font></font>
#             key<font></font>
# 1:   clock_time<font></font>
# 2:        combo<font></font>
# 3:        evals<font></font>
# 4:   model_time<font></font>
# 5:         none<font></font>
# 6: perf_reached<font></font>
# 7:   stagnation</code></pre><br>
<p>       <code>TuningInstance</code>:</p><br>
<pre><code class="plaintext hljs">tuning_instance &lt;- TuningInstance$new(<font></font>
  task = TaskClassif$new(id = "iris", <font></font>
                        backend = iris, <font></font>
                        target = "Species"),<font></font>
  learner = lrn("classif.rpart", <font></font>
                predict_type = "prob"),<font></font>
  resampling = rsmp("cv", folds = 5),<font></font>
  measures = msr("classif.ce"),<font></font>
  param_set = ParamSet$new(<font></font>
    list(ParamDbl$new("cp", lower = 0.001, upper = 0.1),<font></font>
         ParamInt$new("minsplit", lower = 1, upper = 10)<font></font>
         )<font></font>
    ),<font></font>
  terminator = term("evals", n_evals = 20)<font></font>
)<font></font>
<font></font>
tuning_instance<font></font>
# &lt;TuningInstance&gt;<font></font>
# * State:  Not tuned<font></font>
# * Task: &lt;TaskClassif:iris&gt;<font></font>
# * Learner: &lt;LearnerClassifRpart:classif.rpart&gt;<font></font>
# * Measures: classif.ce<font></font>
# * Resampling: &lt;ResamplingCV&gt;<font></font>
# * Terminator: &lt;TerminatorEvals&gt;<font></font>
# * bm_args: list()<font></font>
# * n_evals: 0<font></font>
# ParamSet: <font></font>
#          id    class lower upper levels     default value<font></font>
# 1:       cp ParamDbl 0.001   0.1        &lt;NoDefault&gt;      <font></font>
# 2: minsplit ParamInt 1.000  10.0        &lt;NoDefault&gt;  </code></pre><br>
<p>  â€”   <code>Tuner</code>,        :</p><br>
<pre><code class="plaintext hljs">tuner &lt;- tnr("grid_search", <font></font>
             resolution = 5, <font></font>
             batch_size = 2)<font></font>
<font></font>
#  <font></font>
# as.data.table(mlr_tuners)<font></font>
#              key<font></font>
# 1: design_points<font></font>
# 2:         gensa<font></font>
# 3:   grid_search<font></font>
# 4: random_search</code></pre><br>
<p>  <code>resolution = 5</code>,       25 .      20    ,    <code>terminator = term("evals", n_evals = 20)</code>. <code>batch_size</code> â€”    ,     .   <strong>mlr3</strong> â€”   ,     . </p><br>
<p>   <code>tnr("design_points")</code>:         ,       (        â€”          ,   <strong>mlr3</strong>  ).</p><br>
<p>,  :</p><br>
<pre><code class="plaintext hljs">result &lt;- tuner$tune(tuning_instance)<font></font>
result<font></font>
# NULL</code></pre><br>
<p> , <code>result</code>   .  ,   <code>tuner$tune()</code>     <code>tuning_instance</code>:</p><br>
<pre><code class="plaintext hljs">tuning_instance$result<font></font>
# $tune_x<font></font>
# $tune_x$cp<font></font>
# [1] 0.001<font></font>
# <font></font>
# $tune_x$minsplit<font></font>
# [1] 5<font></font>
# <font></font>
# <font></font>
# $params<font></font>
# $params$xval<font></font>
# [1] 0<font></font>
# <font></font>
# $params$cp<font></font>
# [1] 0.001<font></font>
# <font></font>
# $params$minsplit<font></font>
# [1] 5<font></font>
# <font></font>
# <font></font>
# $perf<font></font>
# classif.ce <font></font>
#       0.04 <font></font>
<font></font>
result &lt;- tuning_instance$archive(unnest = "params")<font></font>
result[order(classif.ce), c("cp", "minsplit", "classif.ce")]<font></font>
#         cp minsplit classif.ce<font></font>
#  1: 0.00100        5 0.04000000<font></font>
#  2: 0.00100        3 0.04000000<font></font>
#  3: 0.00100        8 0.04000000<font></font>
#  4: 0.00100        1 0.04000000<font></font>
#  5: 0.00100       10 0.04666667<font></font>
#  6: 0.02575       10 0.06000000<font></font>
#  7: 0.07525        5 0.06000000<font></font>
#  8: 0.02575        8 0.06000000<font></font>
#  9: 0.02575        3 0.06000000<font></font>
# 10: 0.05050        1 0.06000000<font></font>
# 11: 0.07525        3 0.06000000<font></font>
# 12: 0.07525        1 0.06000000<font></font>
# 13: 0.05050        3 0.06000000<font></font>
# 14: 0.02575        5 0.06000000<font></font>
# 15: 0.05050        5 0.06000000<font></font>
# 16: 0.05050        8 0.06000000<font></font>
# 17: 0.10000        3 0.06000000<font></font>
# 18: 0.10000        8 0.06000000<font></font>
# 19: 0.05050       10 0.06000000<font></font>
# 20: 0.10000        1 0.06000000<font></font>
<font></font>
library(ggplot2)<font></font>
ggplot(result, <font></font>
       aes(x = cp, y = classif.ce, color = as.factor(minsplit))) +<font></font>
  geom_line() + <font></font>
  geom_point(size = 3)</code></pre><br>
<img src="https://habrastorage.org/webt/kh/di/nw/khdinwbd66zfrz-numff5w_iypy.png"><br>
<p> ,       <code>tune()</code>:</p><br>
<ol>
<li><code>Tuner</code>        (             <code>batch_size</code>);</li>
<li>      <code>Learner</code>    <code>Task</code>    .      <code>ResampleResult</code> (      <code>BenchmarkResult</code>);</li>
<li><code>Terminator</code> ,      .  ,     1,     ,    ;</li>
<li>       ;</li>
<li>      ,    (        , , <code>msr("classif.ce", aggregator = "median")</code>.</li>
</ol><br>
<p>          <code>tuning_instance$bmr</code>,   <code>BenchmarkResult</code>,     <code>score()</code>   <code>as.data.table(tuning_instance$bmr)</code>.      ,  ,      <code>ResampleResult</code>   <code>tuning_instance$archive()</code>:</p><br>
<pre><code class="plaintext hljs">tuning_instance$archive()[1, resample_result][[1]]$score()[, 4:9]<font></font>
#       learner_id     resampling resampling_id iteration prediction classif.ce<font></font>
# 1: classif.rpart &lt;ResamplingCV&gt;            cv         1     &lt;list&gt; 0.06666667<font></font>
# 2: classif.rpart &lt;ResamplingCV&gt;            cv         2     &lt;list&gt; 0.16666667<font></font>
# 3: classif.rpart &lt;ResamplingCV&gt;            cv         3     &lt;list&gt; 0.03333333<font></font>
# 4: classif.rpart &lt;ResamplingCV&gt;            cv         4     &lt;list&gt; 0.03333333<font></font>
# 5: classif.rpart &lt;ResamplingCV&gt;            cv         5     &lt;list&gt; 0.00000000</code></pre><br>
<p>,          :</p><br>
<pre><code class="plaintext hljs">res &lt;- tuning_instance$archive(unnest = "params")<font></font>
res[, ce_resemples := lapply(resample_result, function(x) x$score()[, classif.ce])]<font></font>
ce_resemples &lt;- res[, .(ce_resemples = unlist(ce_resemples)), by = nr]<font></font>
res[ce_resemples, on = "nr"]</code></pre><br>
<h4 id="section5">5.   mlr3</h4><br>
<p>     :  <strong>mlr3</strong>, <strong>mlr3tuning</strong>  <strong>paradox</strong>.         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>,        - <strong>mlr3verse</strong>:</p><br>
<pre><code class="plaintext hljs"># install.packages("mlr3verse")<font></font>
library(mlr3verse)<font></font>
## Loading required package: mlr3<font></font>
## Loading required package: mlr3db<font></font>
## Loading required package: mlr3filters<font></font>
## Loading required package: mlr3learners<font></font>
## Loading required package: mlr3pipelines<font></font>
## Loading required package: mlr3tuning<font></font>
## Loading required package: mlr3viz<font></font>
## Loading required package: paradox</code></pre><br>
<ul>
<li><strong>mlr3db</strong>   <strong>dbplyr</strong>     <strong>data.table</strong>.</li>
<li><strong>mlr3filters</strong>    ,            (   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>).</li>
<li><strong>mlr3learners</strong>      (<code>regr.glmnet</code>, <code>regr.kknn</code>, <code>regr.km</code>, <code>regr.lm</code>, <code>regr.ranger</code>, <code>regr.svm</code>, <code>regr.xgboost</code>)   (<code>classif.glmnet</code>, <code>classif.kknn</code>, <code>classif.lda</code>, <code>classif.log_reg</code>, <code>classif.multinom</code>, <code>classif.naive_bayes</code>, <code>classif.qda</code>, <code>classif.ranger</code>, <code>classif.svm</code>, <code>classif.xgboost</code>).      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.</li>
<li><strong>mlr3pipelines</strong>   (pipelines),     .  ,         ,       CRAN,      : <code>remotes::install_github("https://github.com/mlr-org/mlr3pipelines")</code>.</li>
<li><strong>mlr3tuning</strong>   .</li>
<li><strong>mlr3viz</strong>   ,        .</li>
<li><strong>mlr3measures</strong> â€”   ~40  .   <strong>mlr3verse</strong>  ,   .</li>
</ul><br>
<p>     ,    .</p><br>
<h4 id="section6">6.    </h4><br>
<p>  (pipelines)     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> ,           .</p><br>
<p>  â€”  , ,    â€”    .    <code>PipeOpLearner()</code>,    â€” <code>PipeOpFilter()</code>,     â€” <code>PipeOp()</code>.     ( <code>po()</code>)    :</p><br>
<pre><code class="plaintext hljs">pca &lt;- po("pca")<font></font>
filter &lt;- po("filter", <font></font>
             filter = mlr3filters::flt("variance"), <font></font>
             filter.frac = 0.5)<font></font>
learner_po &lt;- po("learner", <font></font>
                 learner = lrn("classif.rpart"))</code></pre><br>
<p>        <code>%&gt;&gt;%</code>:</p><br>
<pre><code class="plaintext hljs">graph &lt;- pca %&gt;&gt;% filter %&gt;&gt;% learner_po<font></font>
graph$plot()</code></pre><br>
<img src="https://habrastorage.org/webt/ja/nv/c2/janvc2zyn-erqiijiwb9wi5kdpk.png"><br>
<p>     .         ,        :</p><br>
<pre><code class="plaintext hljs">gr &lt;- Graph$new()$<font></font>
  add_pipeop(mlr_pipeops$get("copy", outnum = 2))$<font></font>
  add_pipeop(mlr_pipeops$get("scale"))$<font></font>
  add_pipeop(mlr_pipeops$get("pca"))$<font></font>
  add_pipeop(mlr_pipeops$get("featureunion", innum = 2))<font></font>
<font></font>
gr$<font></font>
  add_edge("copy", "scale", src_channel = 1)$        <font></font>
  add_edge("copy", "pca", src_channel = "output2")$  <font></font>
  add_edge("scale", "featureunion", dst_channel = 1)$<font></font>
  add_edge("pca", "featureunion", dst_channel = 2)<font></font>
<font></font>
gr$plot(html = FALSE)</code></pre><br>
<img src="https://habrastorage.org/webt/ag/jv/np/agjvnpgbx8urspsoran0dva9ho8.png"><br>
<p>    ,    (<code>po("learner", learner = lrn("classif.rpart"))</code>).   ,     :</p><br>
<pre><code class="plaintext hljs">glrn &lt;- GraphLearner$new(graph)<font></font>
glrn <font></font>
# &lt;GraphLearner:pca.variance.classif.rpart&gt;<font></font>
# * Model: -<font></font>
# * Parameters: variance.filter.frac=0.5, variance.na.rm=TRUE, classif.rpart.xval=0<font></font>
# * Packages: -<font></font>
# * Predict Type: response<font></font>
# * Feature types: logical, integer, numeric, character, factor, ordered, POSIXct<font></font>
# * Properties: importance, missings, multiclass, oob_error, selected_features, twoclass,<font></font>
#   weights</code></pre><br>
<p>     <code>GraphLearner</code>  <code>Learner</code>.     ,      <code>Learner</code>-, :</p><br>
<pre><code class="plaintext hljs">resample(tsk("iris"), glrn, rsmp("cv"))<font></font>
# INFO  [17:17:00.358] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 1/10) <font></font>
# INFO  [17:17:00.615] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 2/10) <font></font>
# INFO  [17:17:00.881] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 3/10) <font></font>
# INFO  [17:17:01.087] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 4/10) <font></font>
# INFO  [17:17:01.303] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 5/10) <font></font>
# INFO  [17:17:01.518] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 6/10) <font></font>
# INFO  [17:17:01.716] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 7/10) <font></font>
# INFO  [17:17:01.927] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 8/10) <font></font>
# INFO  [17:17:02.129] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 9/10) <font></font>
# INFO  [17:17:02.337] Applying learner 'pca.variance.classif.rpart' on task 'iris' (iter 10/10) <font></font>
# &lt;ResampleResult&gt; of 10 iterations<font></font>
# * Task: iris<font></font>
# * Learner: pca.variance.classif.rpart<font></font>
# * Warnings: 0 in 0 iterations<font></font>
# * Errors: 0 in 0 iterations</code></pre><br>
<p>      ,    issue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">How to deal with different preprocessing steps as hyperparameters</a>:</p><br>
<pre><code class="plaintext hljs">gr &lt;- pipeline_branch(list(pca = po("pca"), nothing = po("nop")))<font></font>
gr$plot()</code></pre><br>
<img src="https://habrastorage.org/webt/sb/h5/ae/sbh5aepybf5hmwzjvcp1ulko0sa.png"><br>
<p>    <strong>caret</strong>  <strong>tidymodels</strong>   !</p><br>
<p>,              <strong>mlr3</strong>.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mlr3 book</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN491556/index.html">Javaå¾®æœåŠ¡ï¼šå®ç”¨æŒ‡å—</a></li>
<li><a href="../zh-CN491558/index.html">æŸ¥æ‰¾æ›´å¤šçš„å¤æ´»èŠ‚å½©è›‹ï¼šä»ç¥ç§˜çš„è®¯æ¯åˆ°æ‰“ç”µè¯æ´—æ‰‹å’Œåšå®¶åº­ä½œä¸šçš„ä¿¡æ¯</a></li>
<li><a href="../zh-CN491560/index.html">å¦‚ä½•ä½¿èˆªç«™æ¥¼æˆä¸ºæ‚¨çš„åŠ©æ‰‹ï¼Œè€Œä¸æ˜¯æ•Œäººï¼Ÿ</a></li>
<li><a href="../zh-CN491562/index.html">FOSSæ–°é—»6-2020å¹´3æœˆ2æ—¥è‡³8æ—¥å…è´¹å’Œå¼€æºæ–°é—»çš„å›é¡¾</a></li>
<li><a href="../zh-CN491564/index.html">Java 14ï¼šè®°å½•ï¼Œæ›´ç®€æ´çš„instanceofï¼ŒjpackageåŒ…è£…å™¨ï¼Œå¼€å…³lambdaå’Œæ–‡æœ¬å—</a></li>
<li><a href="../zh-CN491568/index.html">ä½¿ç”¨Debian 10åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šçš„SOCKSä¸­æ„å»ºè·¯ç”±å™¨</a></li>
<li><a href="../zh-CN491570/index.html">ä¸ºä»€ä¹ˆICQåœ¨è´­ä¹°Mail.Ruä¹‹åå¤±å»äº†ä¸€ä¸ªå¤è€çš„ç”¨æˆ·</a></li>
<li><a href="../zh-CN491572/index.html">ä¸Šå‘¨ç¬¬405æœŸï¼ˆ2020å¹´3æœˆ2æ—¥è‡³8æ—¥ï¼‰æ¥è‡ªå‰ç«¯ä¸–ç•Œçš„æ–°é²œææ–™æ‘˜è¦</a></li>
<li><a href="../zh-CN491574/index.html">ç®¡ç†æ‹–å»¶çš„ç®€å•æŠ€å·§</a></li>
<li><a href="../zh-CN491576/index.html">ä½œä¸ºå›¾ç¥ç»ç½‘ç»œçš„å˜å‹å™¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>