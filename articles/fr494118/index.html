<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐢 👏 👈🏼 COVID-19 Telegram-bot // Nous répondons automatiquement aux questions fréquemment posées 👨‍👨‍👧‍👧 👩🏿‍🤝‍👩🏼 🖤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans le contexte du battage médiatique universel sur le coronavirus, j'ai décidé de faire au moins quelque chose d'utile (mais pas moins de battage mé...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>COVID-19 Telegram-bot // Nous répondons automatiquement aux questions fréquemment posées</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494118/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le contexte du battage médiatique universel sur le coronavirus, j'ai décidé de faire au moins quelque chose d'utile (mais pas moins de battage médiatique). </font><font style="vertical-align: inherit;">Dans cet article, je vais vous expliquer comment créer et déployer le Telegram Bot en utilisant des méthodes NLP basées sur des règles en 2,5 heures (c'est le temps qu'il m'a fallu) pour répondre aux questions de la FAQ en utilisant le cas COVID-19 comme exemple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours du travail, nous utiliserons le bon vieux Python, l'API Telegram, quelques bibliothèques NLP standard, ainsi que Docker.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/68/e4/tw/68e4twfyppio_uy1o1dojajfeca.jpeg"><br>
<a name="habracut"></a><br>
<blockquote><img src="https://habrastorage.org/webt/fi/0x/4z/fi0x4z2nhcc3-3bdzugakb4csji.png" align="left"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UFO Care Minute</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pandémie COVID-19, une infection respiratoire aiguë potentiellement grave causée par le coronavirus SARS-CoV-2 (2019-nCoV), a été officiellement annoncée dans le monde. </font><font style="vertical-align: inherit;">Il y a beaucoup d'informations sur Habré sur ce sujet - rappelez-vous toujours qu'il peut être à la fois fiable / utile, et vice versa.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous vous invitons à critiquer toute information publiée.</font></font></h4><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources officielles</font></font></b><div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">C   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">C </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">  ()</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> </a></li>
<li>       </li>
</ul><br>
     ,      .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lavez-vous les mains, prenez soin de vos proches, restez à la maison dans la mesure du possible et travaillez à distance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lire les publications sur: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coronavirus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">travail à distance</font></font></a></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brève préface</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article décrit le processus de création d'un Bot Telegram simple répondant aux questions de la FAQ sur COVID-19. </font><font style="vertical-align: inherit;">La technologie de développement est extrêmement simple et polyvalente et peut être utilisée pour tout autre cas. </font><font style="vertical-align: inherit;">Je souligne encore une fois que je ne prétends pas être à la pointe de la technologie, mais seulement proposer une solution simple et efficace qui peut être réutilisée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que je crois que le lecteur de cet article a déjà une certaine expérience avec Python, nous supposerons que vous avez déjà installé Python 3.X et les outils de développement nécessaires (PyCharm, VS Code), vous pouvez créer un bot dans Telegram via BotFather, et par conséquent, je vais sauter ces choses.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Configurer l'API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première chose que vous devez installer est la bibliothèque d'encapsuleur pour l'API Telegram " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">La commande standard pour cela est:</font></font><br>
<br>
<pre><code class="python hljs">pip install python-telegram-bot --upgrade</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous allons construire le cadre de notre petit programme en définissant des "gestionnaires" pour les événements Bot suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start - Commande de lancement de Bot;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help - commande d'aide (aide);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">message - traitement des messages texte;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erreur - une erreur.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La signature des gestionnaires ressemblera à ceci:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment"># </span>
    <span class="hljs-keyword">pass</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, par analogie avec l'exemple de la documentation de la bibliothèque, nous définissons la fonction principale dans laquelle nous affectons tous ces gestionnaires et démarrons le bot:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_answer</span>():</span>
    <span class="hljs-string">"""Start the bot."""</span>
    <span class="hljs-comment"># Create the Updater and pass it your bot's token.</span>
    <span class="hljs-comment"># Make sure to set use_context=True to use the new context based callbacks</span>
    <span class="hljs-comment"># Post version 12 this will no longer be necessary</span>
    updater = Updater(<span class="hljs-string">"Token"</span>, use_context=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-comment"># Get the dispatcher to register handlers</span><font></font>
    dp = updater.dispatcher<font></font>
<font></font>
    <span class="hljs-comment"># on different commands - answer in Telegram</span>
    dp.add_handler(CommandHandler(<span class="hljs-string">"start"</span>, start))<font></font>
    dp.add_handler(CommandHandler(<span class="hljs-string">"help"</span>, help))<font></font>
<font></font>
    <span class="hljs-comment"># on noncommand i.e message - echo the message on Telegram</span><font></font>
    dp.add_handler(MessageHandler(Filters.text, message))<font></font>
<font></font>
    <span class="hljs-comment"># log all errors</span><font></font>
    dp.add_error_handler(error)<font></font>
<font></font>
    <span class="hljs-comment"># Start the Bot</span><font></font>
    updater.start_polling()<font></font>
<font></font>
    <span class="hljs-comment"># Run the bot until you press Ctrl-C or the process receives SIGINT,</span>
    <span class="hljs-comment"># SIGTERM or SIGABRT. This should be used most of the time, since</span>
    <span class="hljs-comment"># start_polling() is non-blocking and will stop the bot gracefully.</span><font></font>
    updater.idle()<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<font></font>
    get_answer()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'attire votre attention sur le fait qu'il existe 2 mécanismes pour lancer un bot:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interrogation standard - interrogation périodique de Bot à l'aide des outils standard de l'API Telegram pour les nouveaux événements ( </font></font><code>updater.start_polling()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webhook - nous démarrons notre serveur avec un point de terminaison, auquel les événements du bot arrivent, il nécessite HTTPS.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous l'avez déjà remarqué, pour plus de simplicité, nous utilisons l'interrogation standard.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Nous remplissons les gestionnaires standard de logique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons par une simple, remplissons le début et aidons les gestionnaires avec des réponses standard, nous obtenons quelque chose comme ceci:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /start is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
!
        COVID-19.
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /help is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
     (  COVID-19).
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Désormais, lorsque l'utilisateur envoie les commandes / start ou / help, il recevra la réponse que nous lui avons prescrite. </font><font style="vertical-align: inherit;">J'attire votre attention sur le fait que le texte est formaté en Markdown</font></font><br>
<br>
<pre><code class="python hljs">parse_mode=telegram.ParseMode.MARKDOWN</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, ajoutez la journalisation des erreurs au gestionnaire d'erreurs:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Log Errors caused by Updates."""</span>
    logger.warning(<span class="hljs-string">'Update "%s" caused error "%s"'</span>, update, context.error)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, vérifions si notre Bot fonctionne. </font><font style="vertical-align: inherit;">Copiez tout le code écrit dans un seul fichier, par exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.py</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ajoutez les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nécessaires </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exécutez le fichier et accédez à Telegram ( </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'oubliez pas d'insérer votre Token dans le code</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Nous écrivons les commandes / start et / help et nous réjouissons:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/jf/bo/hnjfbobptb1e1no0h-nl5cdegt4.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Nous traitons le message et générons une réponse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première chose dont nous avons besoin pour répondre à la question est la base de connaissances. </font><font style="vertical-align: inherit;">La chose la plus simple que vous pouvez faire est de créer un fichier json simple sous la forme de valeurs de valeur-clé, où Clé est le texte de la question proposée et Valeur est la réponse à la question. </font><font style="vertical-align: inherit;">Exemple de base de connaissances:</font></font><br>
<br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"      ?"</span>: <span class="hljs-string">"  —  .     -     ,     ,     ,        .    ,      ,   .        ,     ."</span>,
  <span class="hljs-attr">"   ?"</span>: <span class="hljs-string">"  :\n     \n    \n    \n     \n\n         ,    ."</span>,
  <span class="hljs-attr">"  ?"</span>: <span class="hljs-string">" :\n- (    , , )\n- (  )"</span>,<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme pour répondre à la question sera le suivant:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous obtenons le texte de la question de l'utilisateur;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lemmatiser tous les mots du texte de l'utilisateur;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous ne comparons pas clairement le texte résultant avec toutes les questions lemmatisées de la base de connaissances ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">distance de Levenshtein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous sélectionnons la question la plus «similaire» dans la base de connaissances;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous envoyons la réponse à la question sélectionnée à l'utilisateur.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mettre en œuvre nos plans, nous avons besoin de bibliothèques: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fuzzywuzzy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pour les comparaisons floues) et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pymorphy2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pour la lemmatisation). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez un nouveau fichier et implémentez l'algorithme sondé:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> fuzzywuzzy <span class="hljs-keyword">import</span> fuzz
<span class="hljs-keyword">import</span> pymorphy2<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
morph = pymorphy2.MorphAnalyzer()<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">"faq.json"</span>) <span class="hljs-keyword">as</span> json_file:<font></font>
    faq = json.load(json_file)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classify_question</span>(<span class="hljs-params">text</span>):</span>
    <span class="hljs-comment">#  </span>
    text = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> text.split())<font></font>
    questions = list(faq.keys())<font></font>
    scores = list()<font></font>
    <span class="hljs-comment">#      </span>
    <span class="hljs-keyword">for</span> question <span class="hljs-keyword">in</span> questions:
        <span class="hljs-comment">#    </span>
        norm_question = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> question.split())
        <span class="hljs-comment">#       </span><font></font>
        scores.append(fuzz.token_sort_ratio(norm_question.lower(), text.lower()))<font></font>
    <span class="hljs-comment"># </span><font></font>
    answer = faq[questions[scores.index(max(scores))]]<font></font>
<font></font>
    <span class="hljs-keyword">return</span> answer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant d'écrire un gestionnaire de messages, nous allons écrire une fonction qui enregistre l'historique de la correspondance dans un fichier tsv:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump_data</span>(<span class="hljs-params">user, question, answer</span>):</span><font></font>
    username = user.username<font></font>
    full_name = user.full_name<font></font>
    id = user.id<font></font>
<font></font>
    str = <span class="hljs-string">"""{username}\t{full_name}\t{id}\t{question}\t{answer}\n"""</span>.format(username=username,<font></font>
                                                                 full_name=full_name,<font></font>
                                                                 id=id,<font></font>
                                                                 question=question,<font></font>
                                                                 answer=answer)<font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"/data/dump.tsv"</span>, <span class="hljs-string">"a"</span>) <span class="hljs-keyword">as</span> myfile:<font></font>
        myfile.write(str)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous utilisons la méthode que nous avons écrite dans le message du gestionnaire de message texte:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Answer the user message."""</span>
    <span class="hljs-comment"># </span><font></font>
    answer = classify_question(update.message.text)<font></font>
    <span class="hljs-comment">#  </span><font></font>
    dump_data(update.message.from_user, update.message.text, answer)<font></font>
    <span class="hljs-comment"># </span>
    update.message.reply_text(answer)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voila, allez maintenant à Telegram et profitez de l'écriture:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/id/fj/2h/idfj2hjue-vkxmusxsd6hibl-zu.jpeg" width="300"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Configurer Docker et déployer l'application</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le disait le classique: "Si vous exécutez, alors c'est beau à exécuter.", Pour que nous ayons tout en tant que personnes, nous allons configurer la conteneurisation à l'aide de Docker Compose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour cela, nous avons besoin de:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créer Dockerfile - définit l'image du conteneur et le point d'entrée;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create docker-compose.yml - lance de nombreux conteneurs à l'aide d'un seul Dockerfile (dans notre cas, ce n'est pas nécessaire, mais si vous avez de nombreux services, cela sera utile.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez boot.sh (le script est directement responsable du lancement).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, le contenu du Dockerfile:</font></font><br>
<br>
<pre><code class="plaintext hljs">#<font></font>
FROM python:3.6.6-slim<font></font>
<font></font>
#  <font></font>
WORKDIR /home/alex/covid-bot<font></font>
<font></font>
#  requirements.txt<font></font>
COPY requirements.txt ./<font></font>
<font></font>
# Install required libs<font></font>
RUN pip install --upgrade pip -r requirements.txt; exit 0<font></font>
<font></font>
#      <font></font>
COPY data data<font></font>
<font></font>
#   <font></font>
COPY app.py faq.json reply_generator.py boot.sh  ./<font></font>
<font></font>
#   <font></font>
RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*<font></font>
<font></font>
# <font></font>
RUN chmod +x boot.sh<font></font>
<font></font>
#  <font></font>
ENTRYPOINT ["./boot.sh"]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contenu de docker-compose.yml:</font></font><br>
<br>
<pre><code class="plaintext hljs"># docker-compose<font></font>
version: '2'<font></font>
#  <font></font>
services:<font></font>
  bot:<font></font>
    restart: unless-stopped<font></font>
    image: covid19_rus_bot:latest<font></font>
    container_name: covid19_rus_bot<font></font>
    #    boot.sh<font></font>
    environment:<font></font>
      - SERVICE_TYPE=covid19_rus_bot<font></font>
    # volume      <font></font>
    volumes: <font></font>
        - ./data:/data<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contenu de boot.sh:</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/bash<font></font>
if [ -n $SERVICE_TYPE ]<font></font>
then<font></font>
  if [ $SERVICE_TYPE == "covid19_rus_bot" ]<font></font>
  then<font></font>
    exec python app.py<font></font>
    exit<font></font>
  fi<font></font>
else<font></font>
  echo -e "SERVICE_TYPE not set\n"<font></font>
fi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous sommes prêts, pour démarrer tout cela, vous devez exécuter les commandes suivantes dans le dossier du projet:</font></font><br>
<br>
<pre><code class="bash hljs">sudo docker build -t covid19_rus_bot:latest .<font></font>
sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voilà, notre bot est prêt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au lieu d'une conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme prévu, tout le code est disponible dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référentiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette approche, montrée par moi, peut être appliquée dans tous les cas pour répondre aux questions de la FAQ, il suffit de personnaliser la base de connaissances! En ce qui concerne la base de connaissances, elle peut également être améliorée en changeant la structure de la clé et de la valeur en tableaux, de sorte que chaque paire sera un tableau de questions potentielles sur un sujet et un tableau de réponses potentielles (pour un changement, les réponses peuvent être choisies au hasard). Naturellement, l'approche basée sur les règles n'est pas trop flexible pour la mise à l'échelle, mais je suis sûr que cette approche résistera à une base de connaissances avec environ 500 questions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceux qui ont lu jusqu'à la fin, je vous invite à essayer mon Bot </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr494094/index.html">Faites-le vous-même en 3D. Partie 1: pixels et lignes</a></li>
<li><a href="../fr494096/index.html">Déploiement intranet. Expérience, erreurs, recommandations</a></li>
<li><a href="../fr494098/index.html">Approche impérative des données réactives sur l'exemple de Jetbrains KTor et R2DBC</a></li>
<li><a href="../fr494100/index.html">Ce dont vous avez besoin pour créer le modèle idéal d'un centre éducatif pour former des informaticiens</a></li>
<li><a href="../fr494114/index.html">Comment réduire le nombre et augmenter la lisibilité du code dans react-redux, redux-saga</a></li>
<li><a href="../fr494124/index.html">Assemblage d'un ordinateur 8 bits: comment réduire le nombre de puces à six</a></li>
<li><a href="../fr494126/index.html">TOP SCIENCE. Février Media Ten: Féministes crabe zombies, salamandres préhistoriques et alcooliques exagérés</a></li>
<li><a href="../fr494128/index.html">Hackspace Neuron - un lieu de rencontre pour les pirates à Moscou</a></li>
<li><a href="../fr494130/index.html">Qu'advient-il des événements en ligne: certaines de nos statistiques</a></li>
<li><a href="../fr494132/index.html">Compilateur Befunge en Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>