<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÇüèº üç∑ üéª O desempenho do Java moderno ao trabalhar com grandes quantidades de dados, parte 1 üëâüèø üçë üíæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O tempo de execu√ß√£o Java evoluiu mais rapidamente nos √∫ltimos anos do que antes. Ap√≥s 15 anos, finalmente obtivemos o coletor de lixo padr√£o - G1. Mai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>O desempenho do Java moderno ao trabalhar com grandes quantidades de dados, parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/506706/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gy/8p/zf/gy8pzf7gjtwr9pvv1zb7rgmmjiy.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tempo de execu√ß√£o Java evoluiu mais rapidamente nos √∫ltimos anos do que antes. </font><font style="vertical-align: inherit;">Ap√≥s 15 anos, finalmente obtivemos o coletor de lixo padr√£o - G1. </font><font style="vertical-align: inherit;">Mais dois est√£o em desenvolvimento e est√£o dispon√≠veis como fun√ß√µes experimentais - Oracle ZGC e OpenJDK Shenandoah. </font><font style="vertical-align: inherit;">Decidimos testar todas essas novas ferramentas e descobrir o que funciona melhor com as cargas de trabalho t√≠picas do mecanismo de streaming de c√≥digo aberto distribu√≠do Hazelcast Jet.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Jet √© usado para resolver todos os tipos de tarefas, com diferentes requisitos de lat√™ncia e largura de banda. </font><font style="vertical-align: inherit;">As tarefas se enquadram em tr√™s categorias importantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Streaming ilimitado de baixa lat√™ncia. </font><font style="vertical-align: inherit;">Exemplo: identificando tend√™ncias nos dados de sensores de 10.000 dispositivos que recebem informa√ß√µes na frequ√™ncia de 100 Hz e enviando corre√ß√µes entre 10 e 20 ms.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processamento ilimitado de streaming com alta largura de banda. </font><font style="vertical-align: inherit;">Exemplo: rastreamento de coordenadas GPS de milh√µes de usu√°rios com o c√°lculo de seus vetores de velocidade.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processamento em lote cl√°ssico de big data. </font><font style="vertical-align: inherit;">O crit√©rio √© o tempo gasto no processamento, o que significa que √© necess√°rio um alto rendimento. </font><font style="vertical-align: inherit;">Exemplo: an√°lise dos dados de negocia√ß√£o de a√ß√µes coletados por dia para atualizar o n√≠vel de risco de um determinado portf√≥lio de ativos.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, podemos observar o seguinte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No primeiro cen√°rio, os requisitos de atraso caem na zona de perigo do coletor de lixo em pausa: 100 ms. </font><font style="vertical-align: inherit;">Esse √© considerado um excelente resultado para a coleta de lixo nos casos mais dif√≠ceis e, em muitas situa√ß√µes, pode se tornar um obst√°culo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os segundo e terceiro cen√°rios s√£o id√™nticos nos requisitos de coleta de lixo. </font><font style="vertical-align: inherit;">Os requisitos de atraso s√£o menos rigorosos, mas uma grande carga para as gera√ß√µes consolidadas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O segundo cen√°rio √© mais dif√≠cil devido aos requisitos de atraso, mesmo que n√£o sejam t√£o rigorosos quanto no primeiro cen√°rio.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentamos as seguintes combina√ß√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK 8 com assembler Parallel padr√£o e ConcurrentMarkSweep e G1 opcionais.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK 11 com coletor padr√£o G1 e paralelo opcional.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK 14 com coletor padr√£o G1 e ZGC experimental e Shenandoah.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chegamos √†s seguintes conclus√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com vers√µes modernas do JDK, o construtor G1 funciona muito bem. </font><font style="vertical-align: inherit;">Ele processa facilmente dezenas de gigabytes de heap (tentamos 60 GB), com uma pausa m√°xima de 200 ms. </font><font style="vertical-align: inherit;">Sob carga extrema, o G1 n√£o entra em modos cr√≠ticos de pesadelo. </font><font style="vertical-align: inherit;">Em vez disso, a dura√ß√£o das pausas para a coleta completa de lixo aumenta para segundos. </font><font style="vertical-align: inherit;">O ponto fraco do coletor √© o limite superior das pausas em condi√ß√µes favor√°veis ‚Äã‚Äãde baixa carga. </font><font style="vertical-align: inherit;">Conseguimos baix√°-lo para 20-25 ms.</font></font></li>
<li>JDK 8 ‚Äî   .    Parallel       .  G1    ,    ,       ,     .       12    20   Parallel     G1. ConcurrentMarkSweep       G1,           .</li>
<li>  ZGC    ,   G1,        ,  G1       10 . </li>
<li>Shenandoah        220    .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nem o ZGC nem o Shenandoah se comportaram em modos cr√≠ticos de maneira t√£o constante quanto o G1. </font><font style="vertical-align: inherit;">O trabalho deles n√£o era confi√°vel, no modo de baixa lat√™ncia, pausas muito longas ocorreram inesperadamente e at√© OOME.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo descreve os resultados de nossos testes em dois cen√°rios de processamento de streaming. </font><font style="vertical-align: inherit;">Na segunda parte, falaremos sobre os resultados do processamento em lote.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benchmark de processamento de fluxo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o benchmark de streaming, pegamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> c√≥digo e o alteramos um pouco entre os testes. </font><font style="vertical-align: inherit;">Aqui est√° a parte principal, o pipeline Jet:</font></font><br>
<br>
<pre><code class="java hljs">StreamStage&lt;Long&gt; source = p.readFrom(longSource(ITEMS_PER_SECOND))<font></font>
                            .withNativeTimestamps(<span class="hljs-number">0</span>)<font></font>
                            .rebalance(); <span class="hljs-comment">// Introduced in Jet 4.2</span><font></font>
source.groupingKey(n -&gt; n % NUM_KEYS)<font></font>
      .window(sliding(SECONDS.toMillis(WIN_SIZE_SECONDS), SLIDING_STEP_MILLIS))<font></font>
      .aggregate(counting())<font></font>
      .filter(kwr -&gt; kwr.getKey() % DIAGNOSTIC_KEYSET_DOWNSAMPLING_FACTOR == <span class="hljs-number">0</span>)<font></font>
      .window(tumbling(SLIDING_STEP_MILLIS))<font></font>
      .aggregate(counting())<font></font>
      .writeTo(Sinks.logger(wr -&gt; String.format(<span class="hljs-string">"time %,d: latency %,d ms, cca. %,d keys"</span>,<font></font>
              simpleTime(wr.end()),<font></font>
              NANOSECONDS.toMillis(System.nanoTime()) - wr.end(),<font></font>
              wr.result() * DIAGNOSTIC_KEYSET_DOWNSAMPLING_FACTOR)));<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse pipeline reflete cen√°rios de uso com um fluxo ilimitado de eventos. O mecanismo deve agregar dados usando o m√©todo "janela deslizante". Essa agrega√ß√£o √© necess√°ria, por exemplo, para obter a derivada no tempo de um valor vari√°vel, para limpar dados de ru√≠do de alta frequ√™ncia (suaviza√ß√£o) ou para medir a frequ√™ncia de ocorr√™ncia de um evento (eventos por segundo). O mecanismo pode primeiro dividir o fluxo em categorias (por exemplo, todos os dispositivos ou smartphones IoT individuais) em sub-fluxos. E, em seguida, rastreie independentemente o valor agregado para cada subfluxo. No Hazelcast Jet, uma janela deslizante se move em etapas discretas, cujo tamanho voc√™ especifica. Por exemplo, com uma etapa de 1 segundo, voc√™ obt√©m um conjunto completo de resultados a cada segundo. E com uma etapa de 1 minuto, os resultados incluir√£o tudo o que aconteceu no √∫ltimo minuto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas notas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo √© completamente independente. Fontes de dados externas n√£o s√£o usadas. Usamos uma fonte de stub para emular um fluxo de eventos na frequ√™ncia certa. Os eventos ocorrem em intervalos regulares. A fonte n√£o gera eventos cujos carimbos de data e hora est√£o relacionados ao futuro, mas os gera o mais r√°pido poss√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o pipeline ficar atrasado, os eventos ser√£o "armazenados em buffer" sem salvar. Nesse caso, o pipeline deve acompanhar o mais r√°pido poss√≠vel o recebimento de dados. Como nossa fonte n√£o √© paralela, seu limite de largura de banda atingiu cerca de 2,2 milh√µes de eventos por segundo. Emulamos 1 milh√£o de eventos / s, deixando uma margem para alcan√ßar 1,2 milh√£o de eventos / s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O transportador mede seu atraso comparando o registro de data e hora do resultado da janela deslizante com o hor√°rio atual. Foram utilizados dois est√°gios de agrega√ß√£o com filtra√ß√£o intermedi√°ria. O resultado de uma janela deslizante cont√©m muitos elementos, um para cada sub-fluxo, e estamos interessados ‚Äã‚Äãno atraso para o √∫ltimo dos elementos. Portanto, primeiro filtramos a maior parte do resultado, deixando cada d√©cimo mil√©simo elemento. E ent√£o direcionamos o fluxo reduzido para o segundo est√°gio, com uma janela ‚Äúinvertida‚Äù sem chave. Nesta fase, observamos o tamanho do resultado e medimos o atraso. A agrega√ß√£o sem usar uma chave n√£o √© paralelizada, portanto, temos um ponto de medi√ß√£o. O est√°gio de filtragem √© paralelo e √© local dos dados; portanto, a influ√™ncia do est√°gio de agrega√ß√£o adicional √© muito pequena (muito menor que 1 ms).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos uma fun√ß√£o agregada simples: contagem. De fato, uma m√©trica da frequ√™ncia de eventos no fluxo foi obtida. Possui uma estrutura m√≠nima (n√∫mero de um tipo </font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), o lixo n√£o √© gerado. Para qualquer quantidade de uso de heap (em gigabytes), uma estrutura de chave t√£o pequena implica o pior cen√°rio para o coletor de lixo: um n√∫mero muito grande de objetos. A carga no coletor n√£o aumenta com o tamanho da pilha, mas com o n√∫mero de objetos. Tamb√©m testamos a op√ß√£o de calcular a mesma fun√ß√£o agregada, mas com uma implementa√ß√£o diferente que gera lixo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dirigimos a maioria dos benchmarks de fluxo em um n√≥, porque est√°vamos interessados ‚Äã‚Äãno impacto do gerenciamento de mem√≥ria no desempenho do pipeline. </font><font style="vertical-align: inherit;">E a lat√™ncia da rede apenas adiciona ru√≠do aos dados. </font><font style="vertical-align: inherit;">Para testar a hip√≥tese de que o desempenho do cluster n√£o afetar√° nossas descobertas, repetimos alguns testes principais em um cluster Amazon EC2 de tr√™s n√≥s. </font><font style="vertical-align: inherit;">Mais sobre isso ser√° descrito no final do segundo artigo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Removemos o coletor Parallel dos resultados da carga de streaming porque os picos de atraso que ele cria s√£o inaceit√°veis ‚Äã‚Äãna maioria dos cen√°rios do mundo real.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cen√°rio 1: baixa lat√™ncia, estrutura m√©dia</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Op√ß√µes de script:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenJDK 14</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tamanho do heap da JVM √© de 4 GB.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para G1, dado </font></font><code>-XX:MaxGCPauseMillis=5</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 milh√£o de eventos / s.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50.000 chaves individuais.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Janela deslizante de 30 segundos ap√≥s 0,1 segundos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse cen√°rio, menos de 1 GB de heap √© usado. </font><font style="vertical-align: inherit;">A carga no coletor √© pequena, tem tempo suficiente para a coleta de lixo competitiva em segundo plano. </font><font style="vertical-align: inherit;">Aqui est√£o os atrasos m√°ximos na opera√ß√£o do pipeline com tr√™s montadores testados:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/053/d40/26c/053d4026c6d3eb747e3e78bbdcd46ecd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses valores incluem intervalos fixos de aproximadamente 3 ms para a transmiss√£o dos resultados da janela. </font><font style="vertical-align: inherit;">O gr√°fico fala por si: o coletor padr√£o G1 faz um excelente trabalho, mas se voc√™ precisar de um atraso ainda mais baixo, poder√° usar o ZGC experimental. </font><font style="vertical-align: inherit;">N√£o foi poss√≠vel diminuir os picos de atraso abaixo de 10 ms. </font><font style="vertical-align: inherit;">Mas no caso de ZGC e Shenandoah, eles n√£o surgem devido a pausas na coleta de lixo, mas devido a curtos per√≠odos de aumento do volume de trabalho em segundo plano dos coletores. </font><font style="vertical-align: inherit;">Ocasionalmente, os processos de servi√ßo de Shenandoah aumentavam o atraso acima de 200 ms.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cen√°rio dois: estrutura maior, requisitos de lat√™ncia menos rigorosos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assumimos que, por motivos alheios ao nosso controle (por exemplo, devido √† rede celular), o atraso pode aumentar para segundos. </font><font style="vertical-align: inherit;">Isso atenua os requisitos para o pipeline de processamento de fluxo. </font><font style="vertical-align: inherit;">Por outro lado, podemos encontrar dados muito maiores, do tamanho de milh√µes ou dezenas de milh√µes de chaves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse cen√°rio, podemos preparar o equipamento para uso pesado, levando em considera√ß√£o o fato de que o coletor de lixo operar√° em uma grande pilha, em vez de distribuir dados entre v√°rios n√≥s do cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Executamos muitos testes em diferentes combina√ß√µes para descobrir como as combina√ß√µes de fatores afetam o desempenho do tempo de execu√ß√£o. </font><font style="vertical-align: inherit;">Descobriu-se que isso depende de dois par√¢metros:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O n√∫mero de registros armazenados em agregados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisito de largura de banda para maquiagem.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro par√¢metro descreve o n√∫mero de objetos na gera√ß√£o ocupada. Ao agregar usando o m√©todo da janela deslizante, mantemos objetos por um longo tempo (em toda a janela) e os liberamos. Isso contradiz diretamente a hip√≥tese do lixo geracional (hip√≥tese do lixo geracional), que afirma que os objetos morrem jovens ou vivem para sempre. Nesse modo, a carga m√°xima no coletor de lixo √© criada. E como a intensidade de seu trabalho aumenta com o n√∫mero de objetos vivos, a produtividade depende muito desse par√¢metro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo par√¢metro est√° relacionado √† quantidade de recursos que o aplicativo pode alocar para o coletor de lixo. Para tornar mais claro, vamos criar alguns diagramas. Ao agregar usando o m√©todo da janela deslizante, o transportador passa por tr√™s est√°gios:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processamento de eventos em tempo real conforme eles ocorrem.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passando os resultados de uma janela deslizante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apanhando os eventos recebidos durante a segunda etapa.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os tr√™s est√°gios podem ser visualizados da seguinte maneira:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99c/d77/894/99cd778940f1596c2dd5e1dbf0933fd4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a transfer√™ncia dos resultados da janela demorar mais, nos encontraremos nesta situa√ß√£o:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b22/694/760/b226947608cfb3373742d02e6dc7774f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, o transportador mal tem tempo e todos os atrasos, como pausas na coleta de lixo, aumentam o atraso e se recuperam muito lentamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos mudar o gr√°fico e mostrar apenas a taxa m√©dia de absor√ß√£o de eventos depois de passar os resultados da janela:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d78/cd9/ccb/d78cd9ccbf09b96c23705ae8bb0d6e38.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos chamar a altura do ret√¢ngulo amarelo de "requisito de imposi√ß√£o": esse √© o requisito para a capacidade de origem. Se exceder a taxa de transfer√™ncia real do transportador, n√£o poder√° lidar com a carga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja como ser√° se a transfer√™ncia dos resultados da janela demorar muito:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b9/0ea/594/5b90ea59490f05c628401475c9849e21.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A √°rea dos ret√¢ngulos vermelho e amarelo √© fixa e corresponde √† quantidade de dados que devem passar pelo pipeline. De fato, o vermelho "aperta" o amarelo. Mas a altura do ret√¢ngulo amarelo √© limitada; no nosso caso, o teto √© de 2,2 milh√µes de eventos / s. E quando a altura excede o limite, obtemos um transportador que n√£o pode lidar com a carga e com um atraso crescente ilimitado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Derivamos f√≥rmulas para prever o tamanho dos ret√¢ngulos para uma determinada combina√ß√£o de frequ√™ncia de eventos, tamanho da janela, etapa de escorregamento e tamanho do conjunto de chaves. Portanto, para qualquer caso, podemos determinar a exig√™ncia de imposi√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, temos dois par√¢metros mais ou menos independentes derivados de muitos outros par√¢metros que descrevem cada combina√ß√£o individual. </font><font style="vertical-align: inherit;">Voc√™ pode criar um gr√°fico bidimensional, c√≠rculos nos quais indicam os benchmarks banidos. </font><font style="vertical-align: inherit;">Pinte os c√≠rculos de acordo com o sucesso ou fracasso da combina√ß√£o. </font><font style="vertical-align: inherit;">Por exemplo, para um monte de JDK 14 com G1 em execu√ß√£o em um laptop, obtemos o seguinte gr√°fico:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab2/9e6/416/ab29e641669a2666c59d506e59fce458.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Identificamos tr√™s categorias:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Sim" - o transportador est√° lidando,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"N√£o" - o pipeline n√£o pode lidar devido √† falta de largura de banda,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúColetor de lixo‚Äù - o transportador n√£o aguenta devido a frequentes pausas longas na montagem.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que a falta de largura de banda tamb√©m pode ocorrer devido √† coleta de lixo competitiva e frequentes pausas curtas na montagem. Em geral, a diferen√ßa entre as duas √∫ltimas categorias √© pequena. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver a borda separando a parte inferior esquerda do gr√°fico. Ele cont√©m pontos de benchmarks aprovados com sucesso. Plotamos o mesmo gr√°fico para outras combina√ß√µes do JDK e do coletor de lixo, identificamos os limites das zonas e obtivemos o seguinte resultado:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/251/d12/394/251d123945208cbed4806928946c4241.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tivemos um MacBook Pro 2018 com um Intel Core i7 de 6 n√∫cleos e 16 GB de RAM DDR4. Para a JVM foi configurada </font></font><code>-Xmx10g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. No entanto, acreditamos que uma imagem semelhante ser√° observada em muitas outras configura√ß√µes. O gr√°fico mostra a superioridade do G1 em rela√ß√£o a outros coletores, a fraqueza do G1 quando usado com o JDK 8 e a fraqueza dos coletores experimentais com baixa lat√™ncia sob esse tipo de carga.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O atraso b√°sico - a dura√ß√£o da transmiss√£o dos resultados da janela - flutuou em torno de 500 ms. </font><font style="vertical-align: inherit;">No entanto, as explos√µes geralmente ocorreram devido √†s principais pausas para a coleta de lixo (que eram irracionalmente longas no caso do G1), at√© 10 s em situa√ß√µes lim√≠trofes (quando o transportador mal suporta o trabalho) e diminui para 1-2 s. </font><font style="vertical-align: inherit;">Tamb√©m observamos o efeito da compila√ß√£o JIT em situa√ß√µes lim√≠trofes: o pipeline come√ßa a funcionar com um atraso cada vez maior e, ap√≥s cerca de dois minutos, o desempenho melhora e o atraso retorna aos valores normais.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt506696/index.html">Gerenciando o PostgreSQL no Gitlab.com. Jose Cores Finotto</a></li>
<li><a href="../pt506698/index.html">R√©quiem para "Lan√ßamento no Mar"</a></li>
<li><a href="../pt506700/index.html">Configuramos as A√ß√µes do GitHub para Android com a implanta√ß√£o subsequente no PlayMarket</a></li>
<li><a href="../pt506702/index.html">Os HDDs mais confi√°veis ‚Äã‚Äãde acordo com o Backblaze Q1 2020</a></li>
<li><a href="../pt506704/index.html">Por que escrever em PHP em 2020? Holivarim √© um podcast interativo no Youtube nesta quinta-feira</a></li>
<li><a href="../pt506708/index.html">Autentica√ß√£o de dois fatores VPN / Mikrotik - simples e escal√°vel</a></li>
<li><a href="../pt506710/index.html">Gerenciar v√°rios cat√°logos de endere√ßos no Zimbra Collaboration Suite Open-Source Edition</a></li>
<li><a href="../pt506716/index.html">Lista linear multithread: problema de exist√™ncia de elemento, aprimoramento de produtividade e rela√ß√£o STL</a></li>
<li><a href="../pt506726/index.html">Experi√™ncia no uso da tecnologia Rutoken para registro e autoriza√ß√£o de usu√°rios no sistema (parte 2)</a></li>
<li><a href="../pt506730/index.html">Bufo ou Suricata. Parte 1: escolha um IDS / IPS gratuito para proteger a rede corporativa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>