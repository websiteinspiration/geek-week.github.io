<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💝 👨🏼‍🚒 👩‍🔬 Erkundung der Codequalität des Zephyr-Betriebssystems 🙍🏼 🐜 👩🏽‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir haben kürzlich gesagt, dass der PVS-Studio Code Analyzer mit der Integration in PlatformIO begonnen hat. Natürlich hat das PVS-Studio-Entwicklungs...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Erkundung der Codequalität des Zephyr-Betriebssystems</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/495290/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ee/aeb/25b/4eeaeb25b1ec54a9016cec031ae97451.png" alt="PVS-Studio und Zephyr"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben kürzlich gesagt, dass der PVS-Studio Code Analyzer mit der Integration in PlatformIO begonnen hat. </font><font style="vertical-align: inherit;">Natürlich hat das PVS-Studio-Entwicklungsteam mit dem PlatformIO-Team kommuniziert und aus Gründen des Interesses vorgeschlagen, den Code des Zephyr-Echtzeitbetriebssystems zu überprüfen. </font><font style="vertical-align: inherit;">Warum nicht, dachten wir, und hier ist ein Artikel über eine solche Studie.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlatformIO</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor ich mit dem Hauptteil des Artikels beginne, möchte ich das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlatformIO-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt Entwicklern eingebetteter Systeme empfehlen </font><font style="vertical-align: inherit;">, die ihnen das Leben erleichtern können. </font><font style="vertical-align: inherit;">Es ist ein plattformübergreifendes Programmierwerkzeug für Mikrocontroller. </font><font style="vertical-align: inherit;">Der Kern von PlatformIO ist ein Befehlszeilentool. Es wird jedoch empfohlen, es als Plug-In für Visual Studio Code zu verwenden. </font><font style="vertical-align: inherit;">Eine große Anzahl moderner Chips und darauf basierender Motherboards wird unterstützt. </font><font style="vertical-align: inherit;">Es kann automatisch geeignete Montagesysteme herunterladen und die Site verfügt über eine große Sammlung von Bibliotheken zur Verwaltung von elektronischen Plug-in-Komponenten.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio ist in der Welt der eingebetteten Systeme noch wenig bekannt. Für alle Fälle werde ich eine Einführung für neue Leser geben, die mit diesem Tool noch nicht vertraut sind. </font><font style="vertical-align: inherit;">Unsere regelmäßigen Leser können direkt zum nächsten Abschnitt springen. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein statischer Code-Analysator, mit dem Fehler und potenzielle Schwachstellen im Code von Programmen erkannt werden können, die in C, C ++, C # und Java geschrieben wurden. </font><font style="vertical-align: inherit;">Wenn wir nur über C und C ++ sprechen, werden die folgenden Compiler unterstützt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows </font><font style="vertical-align: inherit;">Visual Studio 2010-2019 C, C ++, C ++ / CLI, C ++ / CX (WinRT)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows </font><font style="vertical-align: inherit;">IAR Embedded Workbench, C / C ++ - Compiler für ARM C, C ++</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows </font><font style="vertical-align: inherit;">QNX Momentics, QCC C, C ++</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows / Linux </font><font style="vertical-align: inherit;">Keil µVision, DS-MDK, ARM-Compiler 5/6 C, C ++</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows / Linux </font><font style="vertical-align: inherit;">Code Composer Studio von Texas Instruments, Tools zur ARM-Codegenerierung C, C ++</font></font></li>
<li>Windows/Linux/macOS. GNU Arm Embedded Toolchain, Arm Embedded GCC compiler, C, C++</li>
<li>Windows/Linux/macOS. Clang C, C++</li>
<li>Linux/macOS. GCC C, C++</li>
<li>Windows. MinGW C, C++</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Analysator verfügt über ein eigenes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnklassifizierungssystem.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bei Bedarf können Sie jedoch die Anzeige von Warnungen gemäß den Codierungsstandards </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEI CERT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MISRA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aktivieren </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können PVS-Studio auch in einem großen Legacy-Projekt schnell und regelmäßig verwenden. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hierfür ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein spezieller Mechanismus zur Massenunterdrückung </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">von Warnungen</font></a><font style="vertical-align: inherit;"> vorgesehen </font><font style="vertical-align: inherit;">. Alle aktuellen Warnungen gelten als technische Schulden und sind ausgeblendet, sodass Sie sich auf Warnungen konzentrieren können, die nur für neuen oder geänderten Code gelten. Auf diese Weise kann das Team den Analysator sofort täglich für seine Arbeit verwenden, und Sie können von Zeit zu Zeit zur technischen Aufgabe zurückkehren und den Code verbessern.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viele andere Szenarien für die Verwendung von PVS-Studio. </font><font style="vertical-align: inherit;">Sie können es beispielsweise als Plugin für SonarQube verwenden. </font><font style="vertical-align: inherit;">Die Integration mit Systemen wie Travis CI, CircleCI, GitLab CI / CD usw. ist möglich. </font><font style="vertical-align: inherit;">Eine detailliertere Beschreibung von PVS-Studio würde den Rahmen dieses Artikels sprengen. </font><font style="vertical-align: inherit;">Daher schlage ich vor, sich mit dem Artikel vertraut zu machen, der viele nützliche Links enthält und viele Fragen beantwortet: " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gründe, den statischen Code-Analysator PVS-Studio in den Entwicklungsprozess einzuführen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zephyr</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration von PVS-Studio in PlatformIO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sprachen unsere Teams und wurden gebeten, sich ein Projekt aus der eingebetteten Welt anzusehen, nämlich Zephyr. </font><font style="vertical-align: inherit;">Uns hat die Idee gefallen, die der Grund für das Schreiben dieses Artikels war. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zephyr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein leichtes Echtzeitbetriebssystem, das für Geräte mit begrenzten Ressourcen verschiedener Architekturen entwickelt wurde. </font><font style="vertical-align: inherit;">Der Code wird unter der Open Source Apache 2.0-Lizenz verteilt. </font><font style="vertical-align: inherit;">Funktioniert auf den folgenden Plattformen: ARM (Cortex-M0, Cortex-M3, Cortex-M4, Cortex-M23, Cortex-M33, Cortex-R4, Cortex-R5, Cortex-A53), x86, x86-64, ARC, RISC- V, Nios II, Xtensa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einige Eigenschaften:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einheitlicher Adressraum. </font><font style="vertical-align: inherit;">Der spezifische Anwendungscode in Kombination mit dem benutzerdefinierten Kernel erstellt ein monolithisches Image, das auf dem Gerät ausgeführt wird.</font></font></li>
<li>  .     ,        .</li>
<li>    .       .</li>
<li>  .     .           .</li>
<li>    : ,  ,  ,     ,     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den für uns interessanten Momenten ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synopsys</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an der Entwicklung des Betriebssystems beteiligt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">2014 erwarb Synopsys Coverity, das den gleichnamigen statischen Code-Analysator produzierte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist nur natürlich, dass der Zephyr-Entwickler von Anfang an den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coverity-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Analysator verwendet </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der Analysator ist Marktführer und dies könnte die Qualität des Betriebssystemcodes nur zum Besseren beeinflussen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zephyr Code Qualität</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meiner Meinung nach ist der Code des Zephyr-Betriebssystems Qualität. </font><font style="vertical-align: inherit;">Folgendes gibt mir Grund zu der Annahme:</font></font><br>
<br>
<ul>
<li> PVS-Studio  122     High  367   Medium.  , ,    560 C/C++ .     .       7810 C/C++   10075  . ,     . ,      ,          .</li>
<li>       .    «» ,   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SourceMonitor-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dienstprogramm </font><font style="vertical-align: inherit;">, das den Quellcode analysiert hatte, gab Statistiken an, dass 48% des Codes Kommentare sind. </font><font style="vertical-align: inherit;">Dies ist eine Menge und zeigt meiner Erfahrung nach, dass die Qualität des Codes und seine Verständlichkeit für andere Entwickler von großer Bedeutung sind.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei der Entwicklung eines Projekts wird ein statischer Coverity-Code-Analysator verwendet. </font><font style="vertical-align: inherit;">Aufgrund dieser Tatsache konnte sich der PVS-Studio-Analysator höchstwahrscheinlich, obwohl er Fehler im Projekt fand, nicht anschaulich zeigen, wie dies manchmal bei der Analyse anderer Projekte der Fall ist.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dieser Grundlage glaube ich, dass die Autoren des Projekts Wert auf die Qualität und Zuverlässigkeit des Codes legen. </font><font style="vertical-align: inherit;">Schauen wir uns nun einige Warnungen an, die vom PVS-Studio-Analysegerät (Version 7.06) ausgegeben wurden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halb falsche Warnungen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Projektcode ist aufgrund seiner niedrigen Ebene sehr spezifisch und mit viel bedingter Kompilierung (#ifdef) geschrieben. Dies erzeugt eine große Anzahl von Warnungen, die keinen echten Fehler anzeigen, aber nicht einfach als falsch bezeichnet werden können. Es wird am einfachsten sein, dies anhand einiger Beispiele zu verdeutlichen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Beispiel für eine "halb-falsche" Betätigung N1</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">char_framebuffer</span> <span class="hljs-title">char_fb</span>;</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cfb_framebuffer_invert</span><span class="hljs-params">(struct device *dev)</span>
</span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">char_framebuffer</span> *<span class="hljs-title">fb</span> = &amp;<span class="hljs-title">char_fb</span>;</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!fb || !fb-&gt;buf) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  fb-&gt;inverted = !fb-&gt;inverted;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein Teil des bedingten Ausdrucks ist immer falsch </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">:! Fb</font></a><font style="vertical-align: inherit;"> . cfb.c 188 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Adresse einer statischen Variablen verwendet wird, wird immer ein Zeiger ungleich Null erhalten. Daher ist der Zeiger </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> immer ungleich Null und seine Überprüfung ist nicht sinnvoll. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist jedoch klar, dass dies überhaupt kein Fehler ist, sondern lediglich eine übermäßige Überprüfung, die keinen Schaden anrichtet. Darüber hinaus wird der Compiler beim Erstellen der Release-Version diese wegwerfen, sodass dies nicht einmal zu einer Verlangsamung führt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein ähnlicher Fall fällt meines Wissens unter das Konzept des "halbfalken" Analysatorbetriebs. Formal ist der Analysator absolut richtig. Und es ist besser, die zusätzliche sinnlose Prüfung aus dem Code zu entfernen. All dies ist jedoch kleinlich und solche Warnungen sind im Rahmen des Artikels nicht einmal interessant zu berücksichtigen.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Beispiel für eine "halb-falsche" Betätigung N2</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">hex2char</span><span class="hljs-params">(<span class="hljs-keyword">u8_t</span> x, <span class="hljs-keyword">char</span> *c)</span>
</span>{
  <span class="hljs-keyword">if</span> (x &lt;= <span class="hljs-number">9</span>) {<font></font>
    *c = x + <span class="hljs-string">'0'</span>;<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &gt;= <span class="hljs-number">10</span> &amp;&amp; x &lt;= <span class="hljs-number">15</span>) {<font></font>
    *c = x - <span class="hljs-number">10</span> + <span class="hljs-string">'a'</span>;<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> -EINVAL;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warnung PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein Teil des bedingten Ausdrucks ist immer wahr: x&gt; = 10. hex.c 31 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Analysator hat wieder formal Recht, wenn er behauptet, dass ein Teil der Bedingung immer wahr ist. </font><font style="vertical-align: inherit;">Wenn die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht kleiner als / gleich 9 ist, stellt sich heraus, dass sie immer größer als / gleich 10 ist. Und der Code kann vereinfacht werden:</font></font><br>
<br>
<pre><code class="cpp hljs">} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &lt;= <span class="hljs-number">15</span>) {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wieder einmal klar, dass es hier keinen wirklich schädlichen Fehler gibt, und der zusätzliche Vergleich wurde nur für die Schönheit des Codes geschrieben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schauen wir uns nun ein komplexeres Beispiel für N3 an.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lassen Sie uns zunächst sehen, wie das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHECKIF-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Makro implementiert werden kann </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(CONFIG_ASSERT_ON_ERRORS)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHECKIF(expr) \
  __ASSERT_NO_MSG(!(expr));   \
  <span class="hljs-meta-keyword">if</span> (0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">elif</span> defined(CONFIG_NO_RUNTIME_CHECKS)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHECKIF(...) \
  <span class="hljs-meta-keyword">if</span> (0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHECKIF(expr) \
  <span class="hljs-meta-keyword">if</span> (expr)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abhängig vom Kompilierungsmodus des Projekts kann die Prüfung entweder durchgeführt oder übersprungen werden. </font><font style="vertical-align: inherit;">In unserem Fall wurde bei der Überprüfung des Codes mit PVS-Studio diese Makroimplementierung ausgewählt:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHECKIF(expr) \
  <span class="hljs-meta-keyword">if</span> (expr)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun wollen wir sehen, wozu das führt.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">k_queue_append_list</span><span class="hljs-params">(struct k_queue *<span class="hljs-built_in">queue</span>, <span class="hljs-keyword">void</span> *head, <span class="hljs-keyword">void</span> *tail)</span>
</span>{<font></font>
  CHECKIF(head == <span class="hljs-literal">NULL</span> || tail == <span class="hljs-literal">NULL</span>) {
    <span class="hljs-keyword">return</span> -EINVAL;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">k_spinlock_key_t</span> key = k_spin_lock(&amp;<span class="hljs-built_in">queue</span>-&gt;lock);
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">k_thread</span> *<span class="hljs-title">thread</span> = <span class="hljs-title">NULL</span>;</span>
  <span class="hljs-keyword">if</span> (head != <span class="hljs-literal">NULL</span>) {<font></font>
    thread = z_unpend_first_thread(&amp;<span class="hljs-built_in">queue</span>-&gt;wait_q);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;"> [CWE-571] Der Ausdruck 'head! = NULL' ist immer wahr. </font><font style="vertical-align: inherit;">queue.c 244 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Analysator ist der Ansicht, dass die Überprüfung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(head! = NULL)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> immer true ergibt. </font><font style="vertical-align: inherit;">Und tatsächlich ist es so. </font><font style="vertical-align: inherit;">Wenn der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kopf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeiger </font><font style="vertical-align: inherit;">NULL ist, dann würde die Funktion nicht mehr funktioniert aufgrund einer Kontrolle am Anfang der Funktion:</font></font><br>
<br>
<pre><code class="cpp hljs">CHECKIF(head == <span class="hljs-literal">NULL</span> || tail == <span class="hljs-literal">NULL</span>) {
  <span class="hljs-keyword">return</span> -EINVAL;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Denken Sie daran, dass das Makro hier wie folgt erweitert wird:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (head == <span class="hljs-literal">NULL</span> || tail == <span class="hljs-literal">NULL</span>) {
  <span class="hljs-keyword">return</span> -EINVAL;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der PVS-Studio-Analysator ist also aus seiner Sicht richtig und gibt eine korrekte Warnung aus. </font><font style="vertical-align: inherit;">Diese Prüfung kann jedoch nicht gelöscht werden. </font><font style="vertical-align: inherit;">Sie wird gebraucht. </font><font style="vertical-align: inherit;">In einem anderen Szenario wird das Makro folgendermaßen geöffnet:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (<span class="hljs-number">0</span>) {
  <span class="hljs-keyword">return</span> -EINVAL;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anschließend muss der Zeiger erneut überprüft werden. </font><font style="vertical-align: inherit;">Natürlich generiert der Analysator in dieser Version der Codekompilierung keine Warnung. </font><font style="vertical-align: inherit;">Es gibt jedoch eine Warnung für die Debug-Version der Kompilierung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hoffe, dass den Lesern jetzt klar ist, woher die "halb-falschen" Warnungen kommen. </font><font style="vertical-align: inherit;">Es ist jedoch nichts falsch mit ihnen. </font><font style="vertical-align: inherit;">PVS-Studio Analyzer bietet verschiedene Mechanismen zur Unterdrückung von Fehlalarmen, die in der Dokumentation zu finden sind.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fallwarnungen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber haben Sie doch etwas Interessantes gefunden? </font><font style="vertical-align: inherit;">Es war ein Erfolg, und jetzt werden wir uns verschiedene Fehler ansehen. </font><font style="vertical-align: inherit;">In diesem Fall möchte ich sofort zwei Punkte beachten:</font></font><br>
<br>
<ol>
<li>       .  :   , , ,      Coverity. ,     PVS-Studio  -  ,               . </li>
<li>            . ,             «»      .      ,          .         GitHub,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> PVS-Studio.</li>
</ol><br>
<b> N1, </b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">gen_prov_ack</span><span class="hljs-params">(struct prov_rx *rx, struct net_buf_simple *buf)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (link.tx.cb &amp;&amp; link.tx.cb) {<font></font>
    link.tx.cb(<span class="hljs-number">0</span>, link.tx.cb_data);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-571] Links und rechts vom Operator '&amp;&amp;' befinden sich identische Unterausdrücke: link.tx.cb &amp;&amp; link.tx.cb pb_adv.c 377 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einer ist doppelt geprüft die gleiche Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link.tx.cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Anscheinend ist dies ein Tippfehler, und die zweite zu überprüfende Variable sollte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link.tx.cb_data sein</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N2, </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">das den </font></i><b><font style="vertical-align: inherit;">Puffer </font></b><i><font style="vertical-align: inherit;">überläuft</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Betrachten Sie die Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net_hostname_get</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die später verwendet wird.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(CONFIG_NET_HOSTNAME_ENABLE)</span>
<span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">net_hostname_get</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">net_hostname_get</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">"zephyr"</span>;<font></font>
}<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meinem Fall wurde bei der Vorverarbeitung die Option für den Zweig </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#else ausgewählt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Das heißt, in der vorverarbeiteten Datei wird die Funktion wie folgt implementiert:</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">net_hostname_get</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">"zephyr"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktion gibt einen Zeiger auf ein Array von 7 Bytes zurück (wir berücksichtigen die Klemme Null am Ende der Zeile). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie nun den Code, der zum Verlassen der Array-Grenze führt.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">do_net_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  ....<font></font>
  (<span class="hljs-keyword">void</span>)<span class="hljs-built_in">memcpy</span>(hostname, net_hostname_get(), MAX_HOSTNAME_LEN);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V512</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-119] Ein Aufruf der Funktion 'memcpy' führt dazu, dass der Puffer 'net_hostname_get ()' außerhalb des Bereichs liegt. </font><font style="vertical-align: inherit;">log_backend_net.c 114 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Vorverarbeitung wird </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_HOSTNAME_LEN</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wie folgt erweitert:</font></font><br>
<br>
<pre><code class="cpp hljs">(<span class="hljs-keyword">void</span>)<span class="hljs-built_in">memcpy</span>(hostname, net_hostname_get(),
    <span class="hljs-keyword">sizeof</span>(<span class="hljs-string">"xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx"</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dementsprechend tritt beim Kopieren von Daten ein Zeichenfolgenliteral außerhalb der Grenzen auf. </font><font style="vertical-align: inherit;">Es ist schwer vorherzusagen, wie sich dies auf die Ausführung des Programms auswirkt, da dies zu undefiniertem Verhalten führt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N3, möglicher Pufferüberlauf</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">do_write_op_json</span><span class="hljs-params">(struct lwm2m_message *msg)</span>
</span>{
  <span class="hljs-keyword">u8_t</span> value[TOKEN_BUF_LEN];
  <span class="hljs-keyword">u8_t</span> base_name[MAX_RESOURCE_LEN];
  <span class="hljs-keyword">u8_t</span> full_name[MAX_RESOURCE_LEN];<font></font>
  ....<font></font>
  <span class="hljs-comment">/* combine base_name + name */</span>
  <span class="hljs-built_in">snprintf</span>(full_name, TOKEN_BUF_LEN, <span class="hljs-string">"%s%s"</span>, base_name, value);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V512</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-119] Ein Aufruf der Funktion 'snprintf' führt zum Überlaufen des Puffers 'full_name'. lwm2m_rw_json.c 826 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir </font><font style="vertical-align: inherit;">Makrowerte </font><font style="vertical-align: inherit;">ersetzen, sieht das Bild des Geschehens folgendermaßen aus:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">u8_t</span> value[<span class="hljs-number">64</span>];
<span class="hljs-keyword">u8_t</span> base_name[<span class="hljs-number">20</span>];
<span class="hljs-keyword">u8_t</span> full_name[<span class="hljs-number">20</span>];<font></font>
....<font></font>
<span class="hljs-built_in">snprintf</span>(full_name, <span class="hljs-number">64</span>, <span class="hljs-string">"%s%s"</span>, base_name, value);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter dem Puffer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">full_name,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in dem die Zeichenfolge gebildet wird, werden nur 20 Bytes zugewiesen. In diesem Fall werden die Teile, aus denen der String gebildet wird, in Puffern mit einer Größe von 20 und 64 Bytes gespeichert. Darüber hinaus ist die Konstante 64, die an die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snprintf-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion übergeben wurde </font><font style="vertical-align: inherit;">und verhindern soll, dass das Array ins Ausland geht, offensichtlich zu groß! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Code führt nicht unbedingt zu einem Pufferüberlauf. Vielleicht immer Glück und Teilzeichenfolgen sind immer sehr klein. Im Allgemeinen ist dieser Code jedoch in keiner Weise vor Überlauf geschützt und enthält die klassische Sicherheitslücke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-119</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N4, Ausdruck ist immer wahr</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">keys_set</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name, <span class="hljs-keyword">size_t</span> len_rd, settings_read_cb read_cb,
                    <span class="hljs-keyword">void</span> *cb_arg)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">size_t</span> len;<font></font>
  ....<font></font>
  len = read_cb(cb_arg, val, <span class="hljs-keyword">sizeof</span>(val));
  <span class="hljs-keyword">if</span> (len &lt; <span class="hljs-number">0</span>) {<font></font>
    BT_ERR(<span class="hljs-string">"Failed to read value (err %zu)"</span>, len);
    <span class="hljs-keyword">return</span> -EINVAL;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;"> [CWE-570] Der Ausdruck 'len &lt;0' ist immer falsch. </font><font style="vertical-align: inherit;">Der </font><font style="vertical-align: inherit;">vorzeichenlose </font><font style="vertical-align: inherit;">Typwert ist niemals &lt;0. Keys.c 312 Die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hat einen vorzeichenlosen Typ und kann daher nicht kleiner als 0 sein. Dementsprechend wird der Fehlerstatus in keiner Weise verarbeitet. </font><font style="vertical-align: inherit;">An anderen Stellen </font><font style="vertical-align: inherit;">der Typ </font><i><font style="vertical-align: inherit;">int</font></i><font style="vertical-align: inherit;"> oder </font><i><font style="vertical-align: inherit;">wird ssize_t</font></i><font style="vertical-align: inherit;"> verwendet </font><font style="vertical-align: inherit;">das Ergebnis der speichern </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">read_cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
Beispiel:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">mesh_x_set</span><span class="hljs-params">(....)</span>
</span>{
 <span class="hljs-keyword">ssize_t</span> len;<font></font>
 len = read_cb(cb_arg, out, read_len);<font></font>
 <span class="hljs-keyword">if</span> (len &lt; <span class="hljs-number">0</span>) {<font></font>
 ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit der Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">read_cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> scheint </font><font style="vertical-align: inherit;">alles schlecht </font><font style="vertical-align: inherit;">zu </font><i><font style="vertical-align: inherit;">sein</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tatsache ist, dass es so deklariert wird:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">u8_t</span> <span class="hljs-title">read_cb</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct bt_gatt_attr *attr, <span class="hljs-keyword">void</span> *user_data)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u8_t</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vorzeichenloses </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">Zeichen </font></i><i><font style="vertical-align: inherit;">. </font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktion gibt immer nur positive Zahlen vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vorzeichenloses Zeichen zurück</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wenn Sie diesen Wert in eine vorzeichenbehaftete Variable vom Typ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssize_t einfügen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ist der Wert immer positiv. </font><font style="vertical-align: inherit;">Daher funktioniert die Überprüfung auf Fehlerstatus an anderen Stellen auch nicht. </font><font style="vertical-align: inherit;">Aber ich habe mich nicht mit diesem Thema befasst. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N5, etwas sehr Seltsames</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">mntpt_prepare</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *mntpt)</span>
</span>{
  <span class="hljs-keyword">char</span> *cpy_mntpt;<font></font>
<font></font>
  cpy_mntpt = k_malloc(<span class="hljs-built_in">strlen</span>(mntpt) + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">if</span> (cpy_mntpt) {<font></font>
    ((<span class="hljs-keyword">u8_t</span> *)mntpt)[<span class="hljs-built_in">strlen</span>(mntpt)] = <span class="hljs-string">'\0'</span>;
    <span class="hljs-built_in">memcpy</span>(cpy_mntpt, mntpt, <span class="hljs-built_in">strlen</span>(mntpt));<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> cpy_mntpt;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V575</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-628] Die Funktion 'memcpy' kopiert nicht die gesamte Zeichenfolge. </font><font style="vertical-align: inherit;">Verwenden Sie die Funktion 'strcpy / strcpy_s', um das Terminal null beizubehalten. </font><font style="vertical-align: inherit;">shell.c 427</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/11e/bb5/367/11ebb53676d77d0d9418b626de856106.png" alt="Seltsamer Code"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jemand versuchte, ein Analogon der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strdup-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion zu </font><i><font style="vertical-align: inherit;">erstellen</font></i><font style="vertical-align: inherit;"> , aber es gelang ihm nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit der Warnung des Analysators. </font><font style="vertical-align: inherit;">Es wird berichtet, dass die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memcpy-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">die Zeile kopiert, aber nicht das Terminal Null, und dies ist sehr verdächtig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass dieses Terminal 0 hier kopiert wird:</font></font><br>
<br>
<pre><code class="cpp hljs">((<span class="hljs-keyword">u8_t</span> *)mntpt)[<span class="hljs-built_in">strlen</span>(mntpt)] = <span class="hljs-string">'\0'</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber nein! </font><font style="vertical-align: inherit;">Hier ist ein Tippfehler, aufgrund dessen die Klemme Null in sich selbst kopiert wird! </font><font style="vertical-align: inherit;">Beachten Sie, dass beim Schreiben in das Array </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mntpt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und nicht in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpy_mntpt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Infolgedessen gibt die Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mntpt_prepare</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Zeichenfolge zurück, die mit einem Terminal Null unvollständig ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich wollte der Programmierer so schreiben:</font></font><br>
<br>
<pre><code class="cpp hljs">((<span class="hljs-keyword">u8_t</span> *)cpy_mntpt)[<span class="hljs-built_in">strlen</span>(mntpt)] = <span class="hljs-string">'\0'</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist jedoch immer noch nicht klar, warum es so kompliziert war! </font><font style="vertical-align: inherit;">Dieser Code kann auf folgende Option vereinfacht werden:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">mntpt_prepare</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *mntpt)</span>
</span>{
  <span class="hljs-keyword">char</span> *cpy_mntpt;<font></font>
<font></font>
  cpy_mntpt = k_malloc(<span class="hljs-built_in">strlen</span>(mntpt) + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">if</span> (cpy_mntpt) {
    <span class="hljs-built_in">strcpy</span>(cpy_mntpt, mntpt);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> cpy_mntpt;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N6, der einen Zeiger vor der Validierung dereferenziert</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bt_mesh_model_publish</span><span class="hljs-params">(struct bt_mesh_model *model)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_mesh_model_pub</span> *<span class="hljs-title">pub</span> = <span class="hljs-title">model</span>-&gt;<span class="hljs-title">pub</span>;</span><font></font>
  ....<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_mesh_msg_ctx</span> <span class="hljs-title">ctx</span> = {</span><font></font>
    .send_rel = pub-&gt;send_rel,<font></font>
  };<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (!pub) {
    <span class="hljs-keyword">return</span> -ENOTSUP;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-476] Der ' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Pub'</font></a><font style="vertical-align: inherit;"> -Zeiger wurde verwendet, bevor er gegen nullptr verifiziert wurde. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 708, 719. access.c 708 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein sehr </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">häufiges</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fehlermuster. </font><font style="vertical-align: inherit;">Zunächst wird der Zeiger dereferenziert, um ein Mitglied der Struktur zu initialisieren:</font></font><br>
<br>
<pre><code class="cpp hljs">.send_rel = pub-&gt;send_rel,</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und erst dann wird geprüft, ob dieser Zeiger null sein kann. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N7-N9, Zeiger-Dereferenzierung vor der Validierung</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">net_tcp_accept</span><span class="hljs-params">(struct net_context *context, <span class="hljs-keyword">net_tcp_accept_cb_t</span> cb,
                   <span class="hljs-keyword">void</span> *user_data)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcp</span> *<span class="hljs-title">conn</span> = <span class="hljs-title">context</span>-&gt;<span class="hljs-title">tcp</span>;</span><font></font>
  ....<font></font>
  conn-&gt;accept_cb = cb;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!conn || conn-&gt;state != TCP_LISTEN) {
    <span class="hljs-keyword">return</span> -EINVAL;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-476] Der 'conn'-Zeiger wurde verwendet, bevor er gegen nullptr verifiziert wurde. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 1071, 1073. tcp2.c 1071 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie im vorherigen Fall. </font><font style="vertical-align: inherit;">Eine Erklärung ist hier nicht erforderlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zwei weitere solche Fehler sind hier zu sehen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595 [CWE-476] Der Zeiger 'context-&gt; tcp' wurde verwendet, bevor er gegen nullptr verifiziert wurde. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 1512, 1518. tcp.c 1512</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595 [CWE-476] Der Zeiger 'fsm' wurde verwendet, bevor er gegen nullptr verifiziert wurde. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 365, 382. fsm.c 365</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N10, fehlerhafte Prüfung</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">x509_get_subject_alt_name</span><span class="hljs-params">( <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> **p,
                                      <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *end,
                                      mbedtls_x509_sequence *subject_alt_name)</span>
</span>{<font></font>
  ....<font></font>
    <span class="hljs-keyword">while</span>( *p &lt; end )<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span>( ( end - *p ) &lt; <span class="hljs-number">1</span> )
            <span class="hljs-keyword">return</span>( MBEDTLS_ERR_X509_INVALID_EXTENSIONS +<font></font>
                    MBEDTLS_ERR_ASN1_OUT_OF_DATA );<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warnung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;"> [CWE-570] Ausdruck '(Ende - * p) &lt;1' ​​ist immer falsch. </font><font style="vertical-align: inherit;">x509_crt.c 635 Sehen </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie sich die Bedingungen genau an:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* p &lt;Ende</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Ende - * p) &lt;1</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie widersprechen sich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn (* p &lt;Ende), dann gibt (Ende - * p) immer einen Wert von 1 oder mehr. </font><font style="vertical-align: inherit;">Im Allgemeinen stimmt hier etwas nicht, aber ich weiß nicht, wie ich es richtig buchstabieren soll. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N11, nicht erreichbarer Code</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">lv_disp_get_inactive_time</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">lv_disp_t</span> * disp)</span>
</span>{
    <span class="hljs-keyword">if</span>(!disp) disp = lv_disp_get_default();
    <span class="hljs-keyword">if</span>(!disp) {<font></font>
        LV_LOG_WARN(<span class="hljs-string">"lv_disp_get_inactive_time: no display registered"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(disp) <span class="hljs-keyword">return</span> lv_tick_elaps(disp-&gt;last_activity_time);<font></font>
<font></font>
    <span class="hljs-keyword">lv_disp_t</span> * d;
    <span class="hljs-keyword">uint32_t</span> t = UINT32_MAX;<font></font>
    d          = lv_disp_get_next(<span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">while</span>(d) {<font></font>
        t = LV_MATH_MIN(t, lv_tick_elaps(d-&gt;last_activity_time));<font></font>
        d = lv_disp_get_next(d);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> t;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V547</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [CWE-571] Der Ausdruck 'disp' ist immer wahr. lv_disp.c 148 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktion wird beendet, wenn </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein Nullzeiger ist. Im Gegenteil, dann wird überprüft, ob der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disp-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeiger </font><font style="vertical-align: inherit;">nicht null ist (und dies ist immer der Fall), und die Funktion beendet ihre Arbeit erneut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen wird ein Teil des Codes in einer Funktion niemals die Kontrolle erhalten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N12, seltsamer Rückgabewert</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">size_t</span> <span class="hljs-title">put_end_tlv</span><span class="hljs-params">(struct lwm2m_output_context *out, <span class="hljs-keyword">u16_t</span> mark_pos,
        <span class="hljs-keyword">u8_t</span> *writer_flags, <span class="hljs-keyword">u8_t</span> writer_flag,
        <span class="hljs-keyword">int</span> tlv_type, <span class="hljs-keyword">int</span> tlv_id)</span>
</span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tlv_out_formatter_data</span> *<span class="hljs-title">fd</span>;</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">oma_tlv</span> <span class="hljs-title">tlv</span>;</span>
  <span class="hljs-keyword">u32_t</span> len = <span class="hljs-number">0U</span>;<font></font>
<font></font>
  fd = engine_get_out_user_data(out);<font></font>
  <span class="hljs-keyword">if</span> (!fd) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
  }<font></font>
<font></font>
  *writer_flags &amp;= ~writer_flag;<font></font>
<font></font>
  len = out-&gt;out_cpkt-&gt;offset - mark_pos;<font></font>
<font></font>
  <span class="hljs-comment">/* use stored location */</span><font></font>
  fd-&gt;mark_pos = mark_pos;<font></font>
<font></font>
  <span class="hljs-comment">/* set instance length */</span><font></font>
  tlv_setup(&amp;tlv, tlv_type, tlv_id, len);<font></font>
  len = oma_tlv_put(&amp;tlv, out, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">true</span>) - tlv.length;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Variable 'len' wird zugewiesen, aber am Ende der Funktion nicht verwendet. </font><font style="vertical-align: inherit;">lwm2m_rw_oma_tlv.c 338 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktion enthält zwei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return-Anweisungen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die beide 0 zurückgeben. Es ist seltsam, dass die Funktion immer 0 zurückgibt. Es ist auch seltsam, dass die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Variable </font><font style="vertical-align: inherit;">nach der Zuweisung nicht mehr verwendet wird. </font><font style="vertical-align: inherit;">Ich habe den großen Verdacht, dass es eigentlich so geschrieben werden sollte:</font></font><br>
<br>
<pre><code class="cpp hljs">  len = oma_tlv_put(&amp;tlv, out, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">true</span>) - tlv.length;
  <span class="hljs-keyword">return</span> len;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N13-N16, Synchronisationsfehler</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">nvs_startup</span><span class="hljs-params">(struct nvs_fs *fs)</span>
</span>{<font></font>
  ....<font></font>
  k_mutex_lock(&amp;fs-&gt;nvs_lock, K_FOREVER);<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (fs-&gt;ate_wra == fs-&gt;data_wra &amp;&amp; last_ate.len) {
    <span class="hljs-keyword">return</span> -ESPIPE;<font></font>
  }<font></font>
  ....<font></font>
end:<font></font>
  k_mutex_unlock(&amp;fs-&gt;nvs_lock);<font></font>
  <span class="hljs-keyword">return</span> rc;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Warnung: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Funktion wurde beendet, ohne die Funktion 'k_mutex_unlock' aufzurufen. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 620, 549. nvs.c 620 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt eine Situation, in der eine Funktion ihre Arbeit beendet, ohne den Mutex zu entsperren. </font><font style="vertical-align: inherit;">So wie ich es verstehe, wäre es richtig, so zu schreiben:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">nvs_startup</span><span class="hljs-params">(struct nvs_fs *fs)</span>
</span>{<font></font>
  ....<font></font>
  k_mutex_lock(&amp;fs-&gt;nvs_lock, K_FOREVER);<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (fs-&gt;ate_wra == fs-&gt;data_wra &amp;&amp; last_ate.len) {<font></font>
    rc = -ESPIPE;<font></font>
    <span class="hljs-keyword">goto</span> end;<font></font>
  }<font></font>
  ....<font></font>
end:<font></font>
  k_mutex_unlock(&amp;fs-&gt;nvs_lock);<font></font>
  <span class="hljs-keyword">return</span> rc;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Drei weitere solche Fehler:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1020 Die Funktion wurde beendet, ohne die Funktion 'k_mutex_unlock' aufzurufen. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 574, 549. nvs.c 574</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1020 Die Funktion wurde beendet, ohne die Funktion 'k_mutex_unlock' aufzurufen. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 908, 890. net_context.c 908</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1020 Die Funktion wurde beendet, ohne die Funktion 'k_mutex_unlock' aufzurufen. </font><font style="vertical-align: inherit;">Überprüfen Sie die Zeilen: 1194, 1189. shell.c 1194</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hoffe, dass es Ihnen gefallen hat. Besuchen Sie unseren </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um mehr über Überprüfungen anderer Projekte und andere interessante Veröffentlichungen zu erfahren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verwenden Sie bei Ihrer Arbeit statische Analysegeräte, um die Anzahl der Fehler und potenziellen Schwachstellen bereits beim Schreiben von Code zu verringern. Besonders die frühzeitige Fehlererkennung ist für eingebettete Systeme relevant, da die Aktualisierung von Programmen häufig zeitaufwändig und teuer ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich empfehle außerdem, Ihre Projekte nicht mit dem PVS-Studio-Analysegerät zu verschieben und zu überprüfen. Lesen Sie den Artikel: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie können Sie schnell interessante Warnungen anzeigen, die vom PVS-Studio Analyzer für C- und C ++ - Code generiert wurden?</font></font></a><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie diesen Artikel einem englischsprachigen Publikum zugänglich machen möchten, verwenden Sie bitte den Link zur Übersetzung: Andrey Karpov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Überprüfen des Code des Zephyr-Betriebssystems</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495274/index.html">So beheben Sie Routenlecks</a></li>
<li><a href="../de495276/index.html">Und zeigen Sie, oder wie wir das Operational Sustainability Audit am Uptime Institute bestanden haben</a></li>
<li><a href="../de495278/index.html">Datenbanken, Karten, Checklisten oder Warum ein Business Knowledge Manager</a></li>
<li><a href="../de495280/index.html">Max Patrol SIEM. Übersicht über das Informationssicherheits-Ereignisverwaltungssystem</a></li>
<li><a href="../de495282/index.html">XML-Validierung mit XSD, JAXB und Spring Framework</a></li>
<li><a href="../de495292/index.html">InterSystems IRIS 2020.1 Release</a></li>
<li><a href="../de495294/index.html">Makros für einen Pythonisten. Yandex-Bericht</a></li>
<li><a href="../de495296/index.html">Forensik, SQL-Injection und leidende Katze: Analyse der Aufgabe Nr. 3 der Online-Phase NeoQUEST-2020</a></li>
<li><a href="../de495298/index.html">Bewerten Sie die Optionen von Monte Carlo Clojure</a></li>
<li><a href="../de495302/index.html">So steigern Sie den Umsatz in einem Online-Shop in 4 Monaten um das 2,5-fache - ein Argument für SEO-Werbung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>