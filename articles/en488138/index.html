<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëî üßñüèª üéÉ Small Capacitance Measurements (analog capacitive sensor) üî± ü¶Ö üë©üèæ‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I offer the community a small capacitance sensor, operating from almost 0 pF. It can be used in amateur electronics, robotics. 
 
 When developing a h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Small Capacitance Measurements (analog capacitive sensor)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488138/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I offer the community a small capacitance sensor, operating from almost 0 pF. </font><font style="vertical-align: inherit;">It can be used in amateur electronics, robotics. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When developing a hobby electronics, I needed some simple distance sensor with a capacitive effect. </font><font style="vertical-align: inherit;">Searching the Internet, I found only touch sensors, but they have a short response distance and a digital output. </font><font style="vertical-align: inherit;">Other sensors are too complex or with a long setup. </font><font style="vertical-align: inherit;">I needed a very simple and cheap, working from a microcontroller. </font><font style="vertical-align: inherit;">What happened - under the cut ...</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheme</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After several experiments </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the circuit appeared</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Fig. </font><font style="vertical-align: inherit;">1. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pl/ck/n4/plckn4ewvlpav7mqtomvgpc0dig.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. </font><font style="vertical-align: inherit;">1. The scheme. </font><font style="vertical-align: inherit;">Microcap 10</font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How does it work</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The principle of operation is based on measuring the charge that has accumulated on the capacitor plate during charging. The second cover is an object brought to the sensor. For modeling, it is shown connected to the "earth", but this is not important. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The capacitor plate is connected to the output of the microcontroller, which is configured to issue a meander frequency of 120 - 180 kHz, in the diagram it is a voltage source V2. Also, the lining is connected to the base of transistor Q1. The emitter is connected to the same generator. Since the MK output is complementary, this means that the output is alternately connected to the ‚Äú+‚Äù power source, then to ‚Äú0‚Äù. What happens during these half-periods:</font></font><br>
<br>
<ul>
<li>   . <b>1</b>:     R1, R2.     ,     ,  R2    ,     .  ,       U<sub></sub>&lt;0.</li>
<li>    . <b>0</b>:  1   R3,   Q1   .         ¬´0V¬ª,         .      ,    1. </li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/0d5/6c1/20a/0d56c120a2bb8f1e69c40143786bf385.jpg" alt="image"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diode D1 and capacitor C2 form an amplitude detector - a voltage proportional to the capacitance C1 is created on R5. Transistor Q2 is needed to match the resistances with the ADC MK. The output voltage is removed from R6. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The simulation results (Fig. 2) at the ratings shown in the diagram. The linear relationship is approximately maintained up to 10 pF. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cp/ff/cx/cpffcxh8r_mkcutiaoq-y82jrjm.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 2. Graph capacitance - voltage.</font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
When R3 is reduced to 2 kOhm, sensitivity increases and the linear section decreases to approximately 0 ... 4 pF. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gz/cu/bf/gzcubfza-kkw7dhkypthokqcpa8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 3.</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Capacitance </font><i><font style="vertical-align: inherit;">‚Äì voltage</font></i><font style="vertical-align: inherit;"> graph </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : a graph rise of about 0 pF is a simulation error, linearity actually continues there. Tested in hardware.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The given circuit differs from others (with diode isolation or bridges and constant inclusion of the BE transistor) in that the capacitance / voltage ratio is available with almost 0 pF, without a dead zone. </font><font style="vertical-align: inherit;">Also, only one capacitor plate is involved in the circuit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When executed on the board, the circuit's own capacity is much less than the capacity of one cover - a plate of 20 cm </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sensitivity of the sensor: for a raised hand about 50 mm to the plate - change in the output signal is more than 10%. </font><font style="vertical-align: inherit;">The estimated change in capacitance is about 2 pF. </font><font style="vertical-align: inherit;">The sensor does not respond to network interference, EMF and GSM.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refinements for implementation</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transistors should be with an operating frequency of 100 MHz, and a minimum base capacity (here 2 pF).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diode D1 - high-frequency type BAV99, the capacity of a unit pF.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C2 in the range of 10 - 30 nF, no longer needed, the output current of the MK increases. </font><font style="vertical-align: inherit;">To smooth the pulses, you can put a capacitor parallel to R6</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A 100 ohm resistor R1 limits the output current of the MK, pulse 5mA, an average of 0.2 mA.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The microcontroller in this circuit is Atmega8A, the output is a 166 kHz square wave, its ADC. </font><font style="vertical-align: inherit;">Increasing the frequency above 300 kHz is not recommended, due to the influence of stray capacitances.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Who implements and applies in their crafts - unsubscribe, interesting.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternative use.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the comments under the article, the use of soil moisture as a sensor is discussed. </font><font style="vertical-align: inherit;">I decided to check if it is possible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He took the sensor plate 40x60 mm, well wrapped in 4 layers of plumbing tape (for example, sealed). </font><font style="vertical-align: inherit;">Own capacitance increased, I had to change the ratings in the circuit, reducing the sensitivity to the level of 15 pF. </font><font style="vertical-align: inherit;">The new diagram is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<img src="https://habrastorage.org/webt/d1/yy/_w/d1yy_wc3znzrt2pafsy74zhno3s.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. </font><font style="vertical-align: inherit;">4. Scheme for soil moisture sensor.</font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experiments</font></font></h4><br>
<s><font style="vertical-align: inherit;"></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I don‚Äôt have </font><s><font style="vertical-align: inherit;">flat</font></s><font style="vertical-align: inherit;"> land, there is sand that I poured into a jar with a volume of about 300 ml. </font><font style="vertical-align: inherit;">I added water every time about 15 ... 20 ml. </font></font><br>
<img src="https://habrastorage.org/webt/2r/ad/vn/2radvnrp-95qx2jucr3vo7o959e.jpeg" width="50%" alt="image1"> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dry sand. </font><font style="vertical-align: inherit;">Own sensor capacity. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d-/jw/ox/d-jwoxuuaegks_jav6ccxivrgkc.jpeg" width="50%" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sand + 20ml of water. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j9/ff/mp/j9ffmpxwq8ddb9zvhrycajedgee.jpeg" width="50%" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He also added water and rammed a little. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yl/hu/7o/ylhu7odvxfoov_enbchztx1spke.jpeg" width="50%" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... and more water. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o9/bs/ct/o9bsctqlgprpigxpncmgw4s4ice.jpeg" width="50%" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... and more water. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f8/ap/nd/f8apndhsm_2hcwn6t70u6qdkt4a.jpeg" width="50%" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... and more water. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/aa/2x/r-/aa2xr-nbsbln4gtxvpuomxfnyv0.jpeg" width="50%" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... and more water. </font><font style="vertical-align: inherit;">It became quite tropical moist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The voltage was removed from R5, so with an increase in capacity, the voltage increases. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It can be seen that the capacity increases with each topping. </font><font style="vertical-align: inherit;">However, either this sand, or I don‚Äôt know what, but the readings increase immediately when topping up. </font><font style="vertical-align: inherit;">I expected a smoother change in U when soaking sand with water.</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yes, I know about touch sensors for Arduino with Ali. </font><font style="vertical-align: inherit;">But I wanted to figure it out myself and do it with the given parameters.</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488122/index.html">$ 1.5 compact airgel, aluminum and paper towel distiller</a></li>
<li><a href="../en488128/index.html">Preferential packages: what is added to the salaries of IT specialists in Armenia?</a></li>
<li><a href="../en488130/index.html">Learn English using Telegram bot</a></li>
<li><a href="../en488134/index.html">Raising CI on github for Android in a day</a></li>
<li><a href="../en488136/index.html">How did the Atlas robot learn to do acrobatic stunts, unbearable for an ordinary person?</a></li>
<li><a href="../en488140/index.html">How to simplify life with the help of the Pareto law</a></li>
<li><a href="../en488142/index.html">Pensive Avalonia</a></li>
<li><a href="../en488144/index.html">Java Version and Feature Guide</a></li>
<li><a href="../en488146/index.html">[Discussion]: Are IT engineers, are IT engineers?</a></li>
<li><a href="../en488148/index.html">HighLoad ++, Mikhail Raichenko (ManyChat): almost without magic, or how easy it is to distribute terabit video stream</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>