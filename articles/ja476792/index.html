<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛳️ 🎫 👶🏻 Swift.assert-リリース後の生活 👨‍👩‍👦‍👦 👎🏾 🚪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Swift.assert()コードでどれくらいの頻度で使用しますか？私は正直にそれをかなり頻繁に使用します（これが悪い習慣である場合は、コメントに書き込んでください-なぜそれが悪いのですか？）。私のコードでは、たとえば、次のような呼び出しを頻繁に確認できます。
 
 

Swift.assert(T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Swift.assert-リリース後の生活</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476792/"><font style="vertical-align: inherit;"></font><code>Swift.assert()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードで</font><font style="vertical-align: inherit;">どれくらいの頻度で使用</font><font style="vertical-align: inherit;">しますか？</font><font style="vertical-align: inherit;">私は正直にそれをかなり頻繁に使用します（これが悪い習慣である場合は、コメントに書き込んでください-なぜそれが悪いのですか？）。</font><font style="vertical-align: inherit;">私のコードでは、たとえば、次のような呼び出しを頻繁に確認できます。</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">Swift</span>.<span class="hljs-built_in">assert</span>(<span class="hljs-type">Thread</span>.isMainThread)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し前のことですが、シミュレーター/デバイスでのアプリケーションの起動の一部としてだけでなく、実際のユーザーのアクションからも、これらの呼び出しからの結果を引き続き監視することをお勧めします。ちなみに、ここで私たちはプロの話をすることができ</font></font><code>Swift.precondition()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>Swift.fatalError()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はそれらを回避しようけれども、など。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">この出版物</font></a></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でSwiftの回復不能エラー</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について詳しく</font><font style="vertical-align: inherit;">読んだ</font><font style="vertical-align: inherit;">ところ、非常に有益であることがわかりました。</font><font style="vertical-align: inherit;">
ポイントに近い：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードで私はそのような呼び出しを約300見つけました。通常のローカルテスト中にはどれも機能せず、満足しました。しかし、私はユーザーアクションがまだいくつかの呼び出しをトリガーする可能性があることを示唆しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーの観点からは、クラッシュは起こらないはずです（これもまた私の意見です）。極端な場合、ユーザーはいくつかのシナリオが間違っていて、開発チームがすでにそれを修正するために取り組んでいることを理解する必要があります。同様の例外は常に私によって処理されており、ユーザーにとっては最も無害な形で影響を与える可能性があります。たとえば、何百ものテーブルセルの1つが単に表示されませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーは多かれ少なかれすべてが明確です。開発者へのログの配信を処理するために残っています。まず、コード内の現在の呼び出しを、アプリケーションの外部のどこかでログを送信する呼び出しに置き換えるための最小限の労力で必要でした。次に、インシデントのシーンを正確に特定する必要がありました。それ以外の場合、例外と実際のコードを関連付けることは事実上不可能です。 3番目に、変更された呼び出しはユニットテスト中に機能する可能性があることを考慮に入れる</font></font><code>Thread.isMainThread</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要があります。私</font><font style="vertical-align: inherit;">は特定の種類のテストに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RxTest</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームワーク</font><font style="vertical-align: inherit;">を使用してい</font><font style="vertical-align: inherit;">ます（ここでは、アドバイスや批評を聞く準備もできています）。重要な点は、ローカルですべての例外を以前と同じようにトリガーする必要があるということです。</font></font><code>Loggin.assert()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それが機能するときに、同時に機能するはずです</font></font><code>Swift.assert()</code><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファブリック</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crashlytics</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">
は、イベントを送信するための優れた方法を提供します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">Crashlytics</span>.sharedInstance().recordCustomExceptionName(<span class="hljs-string">""</span>, reason: <span class="hljs-string">""</span>...</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crashlytics</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をいくつかのフレームワーク</font><font style="vertical-align: inherit;">
にパック</font><font style="vertical-align: inherit;">して、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全体</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をアプリケーションにロードし</font><font style="vertical-align: inherit;">、テストターゲットで</font><font style="vertical-align: inherit;">（</font><b><font style="vertical-align: inherit;">Crashlytics</font></b><font style="vertical-align: inherit;">への依存性なしで</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">切り詰めた形でロードすることができます</font><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">CocoaPods</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を通じて「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージング</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」を行うことにしました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword">do</span> <span class="hljs-params">|s|</span><font></font>
<font></font>
    s.name = <span class="hljs-string">'Logging'</span><font></font>
    ...<font></font>
<font></font>
    s.subspec <span class="hljs-string">'Base'</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|ss|</span>
        ss.source_files = <span class="hljs-string">'Source/Logging+Base.swift'</span>
        ss.dependency <span class="hljs-string">'Crashlytics'</span>
    <span class="hljs-keyword">end</span><font></font>
<font></font>
    s.subspec <span class="hljs-string">'Test'</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|ss|</span>
        ss.source_files = <span class="hljs-string">'Source/Logging+Test.swift'</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「戦闘ターゲット」のコードは次のとおりです。</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> Crashlytics<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Logging</span> </span>{<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">send</span><span class="hljs-params">(<span class="hljs-number">_</span> reason: String? = <span class="hljs-literal">nil</span>, __file: String = #file, __line: Int = #line)</span></span> {
        <span class="hljs-keyword">let</span> file = __file.components(separatedBy: <span class="hljs-string">"/"</span>).last ?? __file
        <span class="hljs-keyword">let</span> line = <span class="hljs-string">"\(__line)"</span>
        <span class="hljs-keyword">let</span> name = [line, file].joined(separator: <span class="hljs-string">"_"</span>)
        <span class="hljs-type">Crashlytics</span>.sharedInstance().recordCustomExceptionName(name, reason: reason ?? <span class="hljs-string">"no reason"</span>, frameArray: [])<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">assert</span><span class="hljs-params">(<span class="hljs-number">_</span> assertion: @escaping @autoclosure <span class="hljs-params">()</span></span></span> -&gt; <span class="hljs-type">Bool</span>, reason: <span class="hljs-type">String?</span> = <span class="hljs-literal">nil</span>, __file: <span class="hljs-type">String</span> = #file, __line: <span class="hljs-type">Int</span> = #line) {
        <span class="hljs-keyword">if</span> assertion() == <span class="hljs-literal">false</span> {
            <span class="hljs-keyword">self</span>.<span class="hljs-built_in">assertionFailure</span>(reason, __file: __file, __line: __line)<font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">assert</span><span class="hljs-params">(<span class="hljs-number">_</span> assertion: @escaping <span class="hljs-params">()</span></span></span> -&gt; <span class="hljs-type">Bool</span>, reason: <span class="hljs-type">String?</span> = <span class="hljs-literal">nil</span>, __file: <span class="hljs-type">String</span> = #file, __line: <span class="hljs-type">Int</span> = #line) {
        <span class="hljs-keyword">if</span> assertion() == <span class="hljs-literal">false</span> {
            <span class="hljs-keyword">self</span>.<span class="hljs-built_in">assertionFailure</span>(reason, __file: __file, __line: __line)<font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">assertionFailure</span><span class="hljs-params">(<span class="hljs-number">_</span> reason: String? = <span class="hljs-literal">nil</span>, __file: String = #file, __line: Int = #line)</span></span> {
        <span class="hljs-type">Swift</span>.<span class="hljs-built_in">assertionFailure</span>(reason ?? <span class="hljs-string">""</span>)
        <span class="hljs-keyword">self</span>.send(reason, __file: __file, __line: __line)<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「テストターゲット」、つまり </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crashlytics</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への依存なし</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> Foundation<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Logging</span> </span>{<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">send</span><span class="hljs-params">(<span class="hljs-number">_</span> reason: String? = <span class="hljs-literal">nil</span>, __file: String = #file, __line: Int = #line)</span></span> {
        <span class="hljs-comment">//</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">assert</span><span class="hljs-params">(<span class="hljs-number">_</span> assertion: @escaping @autoclosure <span class="hljs-params">()</span></span></span> -&gt; <span class="hljs-type">Bool</span>, reason: <span class="hljs-type">String?</span> = <span class="hljs-literal">nil</span>, __file: <span class="hljs-type">String</span> = #file, __line: <span class="hljs-type">Int</span> = #line) {
        <span class="hljs-comment">//</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">assert</span><span class="hljs-params">(<span class="hljs-number">_</span> assertion: @escaping <span class="hljs-params">()</span></span></span> -&gt; <span class="hljs-type">Bool</span>, reason: <span class="hljs-type">String?</span> = <span class="hljs-literal">nil</span>, __file: <span class="hljs-type">String</span> = #file, __line: <span class="hljs-type">Int</span> = #line) {
        <span class="hljs-comment">//</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">assertionFailure</span><span class="hljs-params">(<span class="hljs-number">_</span> reason: String? = <span class="hljs-literal">nil</span>, __file: String = #file, __line: Int = #line)</span></span> {
        <span class="hljs-comment">//</span><font></font>
    }<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果：</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例外が実際に機能し始めました。</font><font style="vertical-align: inherit;">それらのほとんどは、受信したデータの形式が正しくないことを報告しました。</font></font><code>Decodable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時には、</font><font style="vertical-align: inherit;">間違った</font><font style="vertical-align: inherit;">タイプのデータを受信しまし</font><font style="vertical-align: inherit;">た</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">のログ</font></font><code>Thread.isMainThread</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">トリガーされることがありました</font><font style="vertical-align: inherit;">が、次のリリースですぐに修正されました。</font><font style="vertical-align: inherit;">最も興味深いエラーは奇跡的に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSException</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって検出されました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご清聴ありがとうございました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのようなログを突然</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crashlyticsに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">頻繁</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">送信すると</font><font style="vertical-align: inherit;">、サービスがあなたのアクションをスパムとして認識する可能性があります。</font><font style="vertical-align: inherit;">そして、次のメッセージが表示されます。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不適切な使用のため、致命的でないレポートは複数のビルドで無効になっています。</font><font style="vertical-align: inherit;">ドキュメントでレポートを再度有効にする方法をご覧ください。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、ログを送信する頻度を事前に検討する価値があります。</font><font style="vertical-align: inherit;">そうしないと、すべての</font><b><font style="vertical-align: inherit;">ビルドログがCrashlytics</font></b><font style="vertical-align: inherit;">によって無視される危険性があります</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja476770/index.html">「オリオール2.0」-WDCに沿って移動する列車</a></li>
<li><a href="../ja476772/index.html">開発者向けのDeepPavlov：＃2セットアップとデプロイメント</a></li>
<li><a href="../ja476774/index.html">Playme TAU DVRレビュー：磁気マウント、安い</a></li>
<li><a href="../ja476778/index.html">Gorp.NET-構造化テキストからデータを抽出するためのリバーシブルテンプレートを作成するための新しいライブラリ</a></li>
<li><a href="../ja476786/index.html">犯罪の写真/ビデオ録画システムと輸送セキュリティセグメントのシステムの認証</a></li>
<li><a href="../ja476796/index.html">完璧なボディの反射</a></li>
<li><a href="../ja476798/index.html">Hynix GDDR3 SDRAMの例でRAMチップのアセンブリを研究します</a></li>
<li><a href="../ja476806/index.html">MPS 2019.2：列挙型データ、エラーメッセージのカスタマイズ、JDK 11への移行など</a></li>
<li><a href="../ja476812/index.html">すべてについてのメモ。シンプルで危険な電源</a></li>
<li><a href="../ja476816/index.html">スマートフォンのドバイモール、または建物のフロアプランをアプリケーションに追加する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>