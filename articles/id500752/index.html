<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ½â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ‘ğŸ¼ ğŸ† MASK-RCNN untuk menemukan atap dari gambar drone ğŸ¤¸ğŸ¿ ğŸ’‹ ğŸ‘§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Di kota putih dan putih di jalan putih dan putih ada rumah-rumah putih dan putih ... Dan seberapa cepat Anda bisa menemukan semua atap rumah di foto i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>MASK-RCNN untuk menemukan atap dari gambar drone</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lanit/blog/500752/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad9/eb5/21e/ad9eb521e7c2fcb232116aa876742ee3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di kota putih dan putih di jalan putih dan putih ada rumah-rumah putih dan putih ... Dan seberapa cepat Anda bisa menemukan semua atap rumah di foto ini? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semakin banyak orang dapat mendengar tentang rencana pemerintah untuk melakukan inventarisasi lengkap real estat untuk mengklarifikasi data kadaster. Untuk solusi utama untuk masalah ini, metode sederhana dapat diterapkan berdasarkan perhitungan luas atap bangunan modal dari foto udara dan perbandingan lebih lanjut dengan data kadaster. Sayangnya, pencarian dan perhitungan manual membutuhkan banyak waktu, dan karena rumah-rumah baru dihancurkan dan dibangun terus menerus, perhitungannya perlu diulang-ulang. Hipotesis segera muncul bahwa proses ini dapat diotomatisasi menggunakan algoritma pembelajaran mesin, khususnya, Computer Vision. Dalam artikel ini saya akan berbicara tentang bagaimana kita berada di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NORBIT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memecahkan masalah ini dan kesulitan apa yang mereka temui.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spoiler - kami </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berhasil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Layanan ML yang dikembangkan didasarkan pada model pembelajaran mesin dalam yang didasarkan pada jaringan saraf konvolusi. </font><font style="vertical-align: inherit;">Layanan menerima gambar dari kendaraan udara tak berawak sebagai input, pada output, ia menghasilkan file GeoJSON dengan markup objek konstruksi modal yang ditemukan dengan mengacu pada koordinat geografis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya, terlihat seperti ini:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ab/892/528/0ab892528db9a5c84fd26d0e30329b5a.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan masalah teknis yang kami temui:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ada perbedaan yang signifikan antara foto udara musim dingin dan musim panas (model yang hanya dilatih dalam foto musim panas sama sekali tidak dapat menemukan atap di musim dingin);</font></font></li>
<li>            ,       ;</li>
<li>  ,          (  ),     (     )      ,           ;</li>
<li>   ,     ,         (     ).        ;</li>
<li>  (,   )     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan drone terkadang membawa foto-foto ini:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/663/809/821/66380982148bc07c8309f8d106ecfc38.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya juga ingin mencatat masalah yang mungkin terjadi, tetapi mereka tidak mempedulikan kami:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kami tidak memiliki tugas untuk melakukan inferensi untuk waktu yang terbatas (misalnya, langsung pada saat penerbangan), yang segera menyelesaikan semua masalah yang mungkin terjadi dengan kinerja;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pada input untuk diproses, kami segera menerima gambar resolusi tinggi berkualitas tinggi (menggunakan lensa dengan panjang fokus 21 mm pada ketinggian 250 m, yaitu 5 cm / px) dari pelanggan kami, perusahaan Shakhty, dapat menggunakan keahlian mereka dalam geolokasi objek pada peta, dan mereka juga memiliki kesempatan untuk menetapkan serangkaian persyaratan khusus untuk penerbangan UAV di masa depan, yang pada akhirnya sangat mengurangi kemungkinan ubin unik yang tidak ada dalam rangkaian pelatihan;</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi pertama untuk masalah ini, gunakan kotak Boundary&nbsp;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa kata tentang alat apa yang kami gunakan untuk membuat solusi.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anaconda adalah sistem manajemen paket yang mudah digunakan untuk Python dan R.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tensorflow adalah perpustakaan perangkat lunak pembelajaran mesin sumber terbuka yang dikembangkan oleh Google.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keras adalah add-on untuk framework Deeplearning4j, TensorFlow dan Theano.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCV adalah perpustakaan algoritma untuk visi komputer, pemrosesan gambar, dan algoritma numerik open-source untuk tujuan umum.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flask adalah kerangka kerja untuk membuat aplikasi web dalam bahasa pemrograman Python.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai OS yang digunakan Ubuntu 18.04. </font><font style="vertical-align: inherit;">Dengan driver pada GPU (NVIDIA) di Ubuntu, semuanya sudah beres, sehingga tugas biasanya diselesaikan dengan satu perintah:</font></font><br>
<br>
<code>&gt; sudo apt install nvidia-cuda-toolkit</code><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Persiapan Ubin</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas pertama yang kami hadapi adalah untuk membagi gambar flyby menjadi ubin (2048x2048 px). </font><font style="vertical-align: inherit;">Anda dapat menulis skrip Anda sendiri, tetapi kemudian Anda harus berpikir tentang mempertahankan lokasi geografis setiap ubin. </font><font style="vertical-align: inherit;">Lebih mudah menggunakan solusi yang sudah jadi, misalnya, GeoServer - ini adalah perangkat lunak sumber terbuka yang memungkinkan Anda untuk mempublikasikan geodata di server. </font><font style="vertical-align: inherit;">Selain itu, GeoServer memecahkan masalah lain bagi kami - tampilan nyaman dari hasil penandaan otomatis pada peta. </font><font style="vertical-align: inherit;">Ini dapat dilakukan secara lokal, misalnya, dalam qGIS, tetapi untuk perintah dan demonstrasi yang didistribusikan, sumber daya web lebih nyaman. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ubin, Anda harus menentukan skala dan ukuran yang diperlukan dalam pengaturan.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/688/b29/4d1/688b294d129f14dddc810ca0defdef44.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk terjemahan antara sistem koordinat, kami menggunakan pyproj library:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> pyproj <span class="hljs-keyword">import</span> Proj, transform<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Converter</span>:</span>
&nbsp;&nbsp;&nbsp;&nbsp;P3857 = Proj(init=<span class="hljs-string">'epsg:3857'</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;P4326 = Proj(init=<span class="hljs-string">'epsg:4326'</span>)<font></font>
...<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_3857_to_GPS</span>(<span class="hljs-params">self, point</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x, y = point<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> transform(self.P3857, self.P4326, x, y)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_GPS_to_3857</span>(<span class="hljs-params">self, point</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x, y = point<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> transform(self.P4326, self.P3857, x, y)<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, adalah mungkin untuk dengan mudah membentuk satu lapisan besar dari semua poligon dan meletakkannya di atas substrat.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2b8/9f6/428/2b89f642889bdc551871a35ba43a7c03.png"></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk menginstal perangkat lunak GeoServer, Anda harus menyelesaikan langkah-langkah berikut.</font></font></b>
                        <div class="spoiler_text"><ol>
<li> Java  8.</li>
<li> GeoServer.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a></li>
<li>     , ,&nbsp;<code>/usr/share/geoserver</code></li>
<li>      &nbsp;<br>
<br>
<strong><code>echo Â«export GEOSERVER_HOME=/usr/share/geoserverÂ» &gt;&gt; ~/.profile</code></strong></li>
<li>   :<br>
<br>
<strong><code>sudo groupadd geoserver</code></strong></li>
<li> ,     ,   :<br>
<br>
<strong><code>sudo usermod -a -G geoserver &lt;user_name&gt;</code></strong></li>
<li> -  :<br>
<br>
<strong><code>sudo chown -R :geoserver /usr/share/geoserver/</code></strong></li>
<li>    :<br>
<br>
<strong><code>sudo chmod -R g+rwx /usr/share/geoserver/</code></strong></li>
<li> GeoServer&nbsp;<br>
<br>
<strong><code>cd geoserver/bin &amp;&amp; sh startup.sh</code></strong></li>
</ol></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GeoServer bukan satu-satunya aplikasi yang memungkinkan kita untuk menyelesaikan masalah kita. </font><font style="vertical-align: inherit;">Sebagai alternatif, misalnya, Anda dapat mempertimbangkan ArcGIS untuk Server, tetapi produk ini adalah hak milik, jadi kami tidak menggunakannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, setiap ubin harus menemukan semua atap yang terlihat. </font><font style="vertical-align: inherit;">Pendekatan pertama untuk memecahkan masalah adalah dengan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">object_detection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari model / set penelitian Tensorflow. </font><font style="vertical-align: inherit;">Dengan cara ini, kelas pada gambar dapat ditemukan dan dilokalkan dengan pilihan persegi panjang (kotak batas).&nbsp;</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelatihan markup data&nbsp;</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jelas, untuk melatih model Anda memerlukan dataset berlabel. Secara kebetulan, selain berputar-putar, di tempat sampah kami set data untuk 50 ribu atap disimpan dari masa lalu yang indah, ketika semua set data untuk pelatihan masih dalam domain publik di mana-mana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ukuran persis sampel pelatihan yang diperlukan untuk mendapatkan akurasi model yang dapat diterima agak sulit untuk diprediksi sebelumnya. Ini dapat bervariasi tergantung pada kualitas gambar, tingkat perbedaannya satu sama lain, dan kondisi di mana model akan digunakan dalam produksi. Kami memiliki kasus ketika 200 lembar sudah cukup, dan kadang-kadang 50 ribu sampel yang ditandai juga hilang. Jika terjadi kekurangan gambar yang ditandai, kami biasanya menambahkan metode augmentasi: putaran, refleksi cermin, penilaian warna, dll.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang ada banyak layanan yang tersedia yang memungkinkan Anda untuk menandai gambar - baik dengan kode sumber terbuka untuk instalasi di komputer / server Anda, dan solusi korporat yang mencakup karya penilai eksternal, misalnya Yandex.Tolok. </font><font style="vertical-align: inherit;">Dalam proyek ini, kami menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VGG Image Annotator yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paling sederhana </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Atau, Anda dapat mencoba </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coco-annotator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">label-studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kami biasanya menggunakan yang terakhir untuk menandai file teks dan audio.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b1/46b/39c/5b146b39c6413ebde30c1a0a6f25421a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk pelatihan tentang markup berbagai annotator, Anda biasanya perlu melakukan pergeseran kecil bidang, contoh untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VGG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menghitung dengan benar area atap yang jatuh ke area alokasi persegi panjang, perlu diperhatikan beberapa kondisi:</font></font><br>
<br>
<ul>
<li>     /     .          :</li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b0c/41a/80e/b0c41a80e0ae785794143da7b38dfbbf.png"></div><br>
<ul>
<li>,    ,      :</li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/092/1de/dcb/0921dedcbc4effc0430d11cd8dea8401.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengatasi masalah kedua, Anda dapat mencoba melatih model terpisah yang akan menentukan sudut rotasi ubin yang tepat untuk penandaan, tetapi semuanya ternyata sedikit lebih mudah. </font><font style="vertical-align: inherit;">Orang sendiri berusaha mengurangi entropi, sehingga mereka menyelaraskan semua struktur buatan manusia dalam kaitannya satu sama lain, terutama dengan bangunan padat. </font><font style="vertical-align: inherit;">Jika Anda melihat dari atas, maka di area terlokalisasi, pagar, jalur pejalan kaki, penanaman, rumah kaca, arbors akan sejajar atau tegak lurus dengan batas atap. </font><font style="vertical-align: inherit;">Tetap hanya untuk menemukan semua garis yang jelas dan menghitung sudut kemiringan paling umum ke vertikal. </font><font style="vertical-align: inherit;">Untuk ini, OpenCV memiliki alat HoughLinesP yang hebat.&nbsp;</font></font><br>
<br>
<pre><code class="python hljs">...<font></font>
<font></font>
lines = cv2.HoughLinesP(edges, <span class="hljs-number">1</span>, np.pi/<span class="hljs-number">180</span>, <span class="hljs-number">50</span>, minLineLength=minLineLength, maxLineGap=<span class="hljs-number">5</span>)
<span class="hljs-keyword">if</span> lines <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;length = image.shape[<span class="hljs-number">0</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;angles = []<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> x1, y1, x2, y2 <span class="hljs-keyword">in</span> lines[<span class="hljs-number">0</span>]:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;angle = math.degrees(math.atan2(y2 â€” y1, x2 - x1))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;angles.append(angle)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;parts_angles.append(angles)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;median_angle = np.median(angles)<font></font>
...<font></font>
<font></font>
<span class="hljs-comment">#    &nbsp;</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, image.shape[<span class="hljs-number">0</span>]<span class="hljs-number">-1</span>, image.shape[<span class="hljs-number">0</span>] // count_crops):
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, image.shape[<span class="hljs-number">1</span>]<span class="hljs-number">-1</span>, image.shape[<span class="hljs-number">1</span>] // count_crops):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_line(image[x:x+image.shape[<span class="hljs-number">0</span>]//count_crops, y:y+image.shape[<span class="hljs-number">1</span>]//count_crops, :])<font></font>
...<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
<font></font>
np.median([a <span class="hljs-keyword">if</span> a&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">90</span>+a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> np.array(parts_angles).flatten()])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menemukan sudutnya, kami memutar gambar menggunakan transformasi affine:</font></font><br>
<br>
<pre><code class="python hljs">
h, w = image.shape[:<span class="hljs-number">2</span>]<font></font>
image_center = (w/<span class="hljs-number">2</span>, h/<span class="hljs-number">2</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> size <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;radians = math.radians(angle)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;sin = math.sin(radians)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;cos = math.cos(radians)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;size = (int((h * abs(sin)) + (w * abs(cos))), int((h * abs(cos)) + (w * abs(sin))))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;rotation_matrix = cv2.getRotationMatrix2D(image_center, angle, <span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;rotation_matrix[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>] += ((size[<span class="hljs-number">0</span>] / <span class="hljs-number">2</span>) â€” image_center[<span class="hljs-number">0</span>])<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;rotation_matrix[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>] += ((size[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>) â€” image_center[<span class="hljs-number">1</span>])
<span class="hljs-keyword">else</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;rotation_matrix = cv2.getRotationMatrix2D(image_center, angle, <span class="hljs-number">1</span>)<font></font>
<font></font>
cv2.warpAffine(image, rotation_matrix, size)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode contoh lengkap ada di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Begini tampilannya:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2b2/032/15c/2b203215c7a688dc7639e7993643a99e.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/594/423/c1b/594423c1b3e52a8e4fcd383b20a04b05.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode membalik ubin dan menandai dengan persegi panjang bekerja lebih cepat daripada menandai dengan topeng, hampir semua atap ditemukan, tetapi dalam produksi metode ini hanya digunakan sebagai tambahan karena beberapa kelemahan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ada banyak overflight di mana ada sejumlah besar atap non-persegi panjang, karena ini ada terlalu banyak pekerjaan manual untuk memperbaiki area tersebut,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terkadang ditemukan di rumah dengan orientasi berbeda pada ubin yang sama,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kadang-kadang ada banyak garis palsu pada ubin, yang pada akhirnya mengarah ke belokan yang salah. </font><font style="vertical-align: inherit;">Ini terlihat seperti ini:</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d4/ba0/30c/6d4ba030c0784c6ee7366486b3a8f03c.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/691/5fd/a10/6915fda10769dc9b5d96522737d6aef6.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi akhir berdasarkan Mask-RCNN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Upaya kedua adalah untuk mencari dan menyorot atap dengan topeng pixel demi pixel, dan kemudian secara otomatis menguraikan kontur topeng yang ditemukan dan membuat poligon vektor.&nbsp;&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sudah ada cukup bahan tentang prinsip-prinsip operasi, jenis dan tugas jaringan saraf convolutional, termasuk yang di Rusia, jadi kami tidak akan membahasnya dalam artikel ini. Mari kita membahas satu implementasi tertentu saja, Mask-RCNN - sebuah arsitektur untuk melokalisasi dan menyoroti kontur objek dalam gambar. Ada solusi luar biasa lainnya dengan kelebihan dan kekurangan mereka, misalnya, UNet, tetapi dimungkinkan untuk mencapai kualitas yang lebih baik di Mask-RCNN.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam proses pengembangannya, ia melewati beberapa tahap. Versi pertama R-CNN dikembangkan pada 2014. Prinsip kerjanya adalah untuk menyoroti area kecil dalam gambar, untuk masing-masing estimasi dibuat dari kemungkinan keberadaan objek target di area ini. R-CNN melakukan pekerjaan yang sangat baik dengan tugas itu, tetapi kecepatannya meninggalkan banyak yang harus diinginkan. Pengembangan logis adalah jaringan Fast R-CNN dan Faster R-CNN, yang menerima peningkatan dalam algoritma penelusuran gambar, yang memungkinkan untuk secara signifikan meningkatkan kecepatan. Di pintu keluar ke Faster R-CNN, sebuah tanda muncul dengan pilihan persegi panjang yang menunjukkan batas-batas objek, yang tidak selalu cukup untuk menyelesaikan masalah.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mask R-CNN juga menambahkan overlay masker piksel demi piksel untuk mendapatkan garis besar objek yang tepat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kotak batas dan topeng dapat dilihat dengan jelas pada hasil operasi model (filter berdasarkan luas bangunan minimum dihidupkan):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6e/d0c/756/d6ed0c7567ed2894bbe11161fc91af55.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara konvensional, ada 4 tahap dalam pengoperasian jaringan ini:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standar untuk semua jaringan saraf convolutional, alokasi fitur dalam gambar, seperti garis, tikungan, batas kontras dan lainnya;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Region Proposal Network (RPN) memindai fragmen kecil gambar, yang disebut jangkar (jangkar) dan menentukan apakah jangkar ini mengandung tanda-tanda karakteristik kelas target (dalam kasus kami, atap);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klasifikasi Wilayah Bunga dan Bounding Box. </font><font style="vertical-align: inherit;">Pada tahap ini, jaringan, berdasarkan hasil dari tahap sebelumnya, sedang mencoba untuk menyoroti area persegi panjang yang besar dalam foto, mungkin mengandung objek target;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masker Segmentasi. </font><font style="vertical-align: inherit;">Pada tahap ini, topeng dari objek yang diinginkan diperoleh dari area persegi panjang yang diperoleh dengan menerapkan kotak batas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, jaringan ternyata sangat fleksibel dalam konfigurasi, dan kami dapat membangunnya kembali untuk memproses gambar dengan lapisan informasi tambahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan hanya menggunakan gambar RGB saja tidak memungkinkan kami untuk mencapai akurasi pengenalan yang diperlukan (model kehilangan seluruh bangunan, ada kesalahan rata-rata 15% dalam menghitung luas atap), jadi kami menyediakan model dengan data berguna tambahan, misalnya, peta ketinggian yang diperoleh dengan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fotogrametri.</font></font></a>&nbsp;<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7cc/801/ac8/7cc801ac8060a3b99a2bb26415d2fe38.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metrik digunakan untuk mengevaluasi kualitas model</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menentukan kualitas model, kami paling sering menggunakan metrik Intersection over Union (IoU)</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cc/486/5be/8cc4865be494cc0bee045c618df9ff59.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode contoh untuk menghitung IoU menggunakan pustaka geometri.shapely:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> shapely.geometry <span class="hljs-keyword">import</span> Polygon<font></font>
<font></font>
true_polygon = Polygon([(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">6</span>), (<span class="hljs-number">5</span>, <span class="hljs-number">6</span>), (<span class="hljs-number">5</span>, <span class="hljs-number">2</span>)])<font></font>
predicted_polygon = Polygon([(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">7</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">7</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">3</span>)])<font></font>
print(true_polygon.intersection(predicted_polygon).area / true_polygon.union(predicted_polygon).area)<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">0.3333333333333333</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melacak proses pelatihan model dengan mudah dikontrol menggunakan Tensorboard, alat kontrol metrik yang nyaman yang memungkinkan Anda menerima data waktu nyata mengenai kualitas model dan membandingkannya dengan model lain.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31c/a7a/b20/31ca7ab20d4583360b3058b59277bc10.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tensorboard menyediakan data pada banyak metrik yang berbeda. </font><font style="vertical-align: inherit;">Yang paling menarik bagi kami adalah:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">val_mrcnn_bbox_loss - menunjukkan seberapa baik model melokalkan objek (mis. memaksakan kotak batas);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">val_mrcnn_mask_loss - menunjukkan seberapa baik model melakukan segmentasi objek (mis. memaksakan mask).</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelatihan model dan validasi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat pelatihan, kami menggunakan praktik standar membagi dataset secara acak menjadi 3 bagian - pelatihan, validasi, dan tes. Dalam proses pembelajaran, kualitas model dievaluasi pada sampel validasi, dan setelah selesai melewati tes akhir pada data tes yang ditutup dari itu dalam proses pembelajaran.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melakukan pelatihan pertama kami dimulai pada serangkaian kecil tembakan musim panas dan, memutuskan untuk memeriksa seberapa baik model kami di musim dingin, kami diharapkan menerima hasil yang mengecewakan. </font><font style="vertical-align: inherit;">Pilihan untuk menggunakan model yang berbeda untuk musim yang berbeda, tentu saja, merupakan jalan keluar yang sangat baik dari situasi ini, tetapi itu akan memerlukan sejumlah ketidaknyamanan, jadi kami memutuskan untuk mencoba membuat model tersebut universal. </font><font style="vertical-align: inherit;">Dengan bereksperimen dengan berbagai konfigurasi lapisan, dan juga menutup bobot masing-masing lapisan dari perubahan bobot, kami menemukan strategi optimal untuk melatih model dengan menerapkan gambar musim panas dan musim dingin secara bergantian ke input.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat layanan latar belakang untuk pengakuan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang setelah kita memiliki model yang berfungsi, kita dapat membuat layanan API latar belakang dari skrip pengenalan yang menerima gambar sebagai input dan menghasilkan json dengan poligon atap yang ditemukan di output. </font><font style="vertical-align: inherit;">Ini tidak secara langsung mempengaruhi solusi masalah, tetapi mungkin bermanfaat bagi seseorang.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntu menggunakan systemd, dan sebuah contoh akan diberikan secara khusus untuk sistem ini. </font><font style="vertical-align: inherit;">Kode layanan itu sendiri dapat dilihat di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Unit pengguna berada di direktori / etc / systemd / system, di mana kami akan membuat file layanan kami. </font><font style="vertical-align: inherit;">
Edit file:</font></font><br>
<br>
<code>cd /etc/systemd/system<br>
<br>
sudo touch my_srv.service</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">sudo vim my_srv.service
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unit systemd terdiri dari tiga bagian:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Unit] - menjelaskan urutan dan kondisi awal (misalnya, Anda dapat memberi tahu proses untuk menunggu dimulainya layanan tertentu dan baru kemudian memulainya sendiri);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Layanan] - menjelaskan parameter startup;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Instal] - menjelaskan perilaku layanan saat menambahkannya ke startup.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, file kami akan terlihat seperti ini:</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=my_test_unit<font></font>
<font></font>
[Service]<font></font>
WorkingDirectory=/home/user/test_project<font></font>
User=root<font></font>
ExecStart=/home/user/test_project/venv/bin/python3 /home/user/test_project/script.py<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang muat ulang konfigurasi systemd dan jalankan layanan kami:</font></font><br>
<br>
<pre><code class="bash hljs">sudo systemctl daemon-reload<font></font>
sudo systemctl start my_srv.service<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah contoh sederhana dari proses latar belakang, systemd mendukung banyak parameter berbeda yang memungkinkan Anda mengkonfigurasi perilaku layanan secara fleksibel, tetapi tidak ada yang lebih rumit yang diperlukan untuk tugas kami.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temuan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil utama dari proyek ini adalah kemampuan untuk secara otomatis mendeteksi inkonsistensi dalam pengembangan aktual dan informasi yang terkandung dalam data kadaster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasil dari evaluasi keakuratan model pada data uji, nilai-nilai berikut diperoleh: jumlah atap yang ditemukan - 91%, akurasi poligon garis atap - 94%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimungkinkan untuk mencapai kualitas model yang dapat diterima dalam penerbangan musim panas dan musim dingin, tetapi kualitas pengakuan dapat menurun dalam gambar segera setelah hujan salju. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang bahkan Gedung Opera Sydney tidak akan luput dari pandangan model kita.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zs/c1/yl/zsc1yl0dgkkhjahgjk3vssn8swc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami berencana untuk menempatkan layanan ini dengan model yang terlatih di demostand kami. </font><font style="vertical-align: inherit;">Jika Anda tertarik untuk mencoba layanan pada foto Anda sendiri, kirim aplikasi ke ai@norbit.ru.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id500732/index.html">Kecerdasan buatan dan krisis teori kesadaran</a></li>
<li><a href="../id500734/index.html"># GitLab 12.10 dirilis dengan manajemen persyaratan dan penskalaan CI otomatis pada AWS Fargate</a></li>
<li><a href="../id500742/index.html">Penilaian Kualitas Clustering: Properti, Metrik, Kode GitHub</a></li>
<li><a href="../id500744/index.html">"Untuk mendengarkan Anda dengan lebih baik, pembicara saya": bagaimana menyiarkan lebih baik dari rumah</a></li>
<li><a href="../id500746/index.html">Rak tinju untuk SMD dan hal-hal kecil lainnya</a></li>
<li><a href="../id500754/index.html">Bagaimana menjadi jutawan dolar dalam 30 tahun, berbaring di sofa</a></li>
<li><a href="../id500756/index.html">Remote All-Power. Bagaimana cara streaming di konferensi online Grup JUG Ru bekerja?</a></li>
<li><a href="../id500758/index.html">Tren utama dalam pasar keamanan siber dan keamanan informasi 2020-2021 versus perkiraan 2019-2020</a></li>
<li><a href="../id500760/index.html">Cara membunuh zombie lebih efisien dengan ZeroTier</a></li>
<li><a href="../id500764/index.html">Gambar pidato: Software Automatic Mouth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>