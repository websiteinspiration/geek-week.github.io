<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤üèæ ü§µüèΩ ‚ûó Creating a Dark Theme for Stack Overflow üë©üèæ‚Äç‚öïÔ∏è ‚úçüèº üí∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On March 30, 2020, Stack Overflow developers gave website visitors the opportunity to use a beta version of the dark theme. The material, the translat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Creating a Dark Theme for Stack Overflow</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/495998/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On March 30, 2020, Stack Overflow developers gave website visitors the opportunity to use a beta version of the dark theme. </font><font style="vertical-align: inherit;">The material, the translation of which we publish, is dedicated to the story of how the dark theme of Stack Overflow was created.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/61f/9d2/662/61f9d2662c30a95f29c885ac6c3180ee.png"></div></a><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banner on Stack Overflow, which allows you to include a dark theme</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
My name is Aaron Sheki. I am the head of design at Stack Overflow. I participate in the design of the interface components that underlie the new features of the project.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To begin with, a little irony. Personally, I am not a fan of dark interface themes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I often see that the contrast level of dark interfaces is too low. The design of such interfaces is difficult to use a full range of colors. The same applies to simulating volume using shadows, and to applying other visual effects. When I read a light text, located on a dark background, my eyes get tired. It‚Äôs difficult to deal with phenomena like simultaneous contrast when using light themes, and if a dark theme is used, then everything becomes more complicated.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But I'm the person whose efforts brought up a dark theme on Stack Overflow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The work that I want to talk about has never been aimed specifically at developing a dark topic, despite the fact that many users have long asked to equip the resource with such a topic. </font><font style="vertical-align: inherit;">But in the course of moving towards a dark topic, we had to solve many problems. </font><font style="vertical-align: inherit;">In particular, the Stack Overflow front-end code has been upgraded, content accessibility has been improved. </font><font style="vertical-align: inherit;">Working on a dark topic, we got an incentive to use our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">design system</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> more widely in the project </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Can we give users a dark theme, and simultaneously open the way to improving the accessibility of the project? </font><font style="vertical-align: inherit;">We answered this question in the affirmative, having done everything that I will tell about now.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Color research</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When creating the original color scales for the project, we, probably a little naive, took a certain color value and modified it using transformations implemented using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Less</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . So, for example, we could declare a Less-variable </font></font><code>@red</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and make the color darker several times using the design </font></font><code>darken(@red, 10%)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The same goes for multiple color clarification using </font></font><code>tint(@red, 10%)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This can give a color scale in which colors are in the range from </font></font><code>@red-050</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to </font></font><code>@red-900</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in increments of 10%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When I first tried to understand how the Stack Overflow resource might look in dark mode, I decided to just try changing the white background to black and ‚Äúflip‚Äù the color scales. With this approach, color </font></font><code>@red-050</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">becomes color</font></font><code>@red-900</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, colors correspondingly change between the initial and final colors of the scale. </font><font style="vertical-align: inherit;">But these colors themselves remain the same as those used before.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4de/c02/321/4dec023214649262a2a743d8e32e6de0.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Light and dark color scales for red.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
With this approach, the contrast of elements has suffered. </font><font style="vertical-align: inherit;">What happened turned out to contain something that, in general, I did not like about dark topics. </font><font style="vertical-align: inherit;">For example, if you look closely at the darkest version of red, located on a dark background, you will see that the color is almost indistinguishable. </font><font style="vertical-align: inherit;">We will talk more about this below.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3dd/aa4/7fc/3ddaa47fcedcb5bc32c10e43d2079a7b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We definitely need to come up with something better.</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçGetting started: layout design</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just trying to draw the color scales, I actually did not achieve anything. </font><font style="vertical-align: inherit;">This step cannot be called the real start of work on a dark topic. </font><font style="vertical-align: inherit;">Therefore, I decided to start developing a layout and manually selecting colors in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">I selected the colors, focusing on how, in my opinion, Stack Overflow should look, and not thinking about how the new colors will relate to existing ones. </font><font style="vertical-align: inherit;">Reducing the overall contrast was the key to preserving the depth effect in the interface, to supporting the shadows of the elements, to applying the full spectrum of colors.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f6/abf/d73/7f6abfd73f890a0c221fafada3eefa8b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Getting started with the design of the layout allowed us, first of all, to understand what aesthetic effect we are striving for, while not paying attention to the technical requirements for the project</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçSelection of an improved algorithm for working with colors</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After I picked up a lighter background for the dark theme, I got the opportunity to more deeply explore the color scales. First, I needed to deal with some of the color problems of the existing design system, which appeared when applying the light theme. At the bright end of the spectrum, the red and yellow colors did not look the way I would like. Some colors had the lightest values, too close to white. There were colors, the lightest values ‚Äã‚Äãof which were too dark.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/554/d5f/86c/554d5f86ce75ada85b706b3604bb904b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The lightest version of yellow was indistinguishable from white, and the darkest was indistinguishable from black</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
. We had problems at the dark end of the spectrum. </font><font style="vertical-align: inherit;">Using, as background, colors</font></font><code>@red-900</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>@blue-900</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we noticed that these colors are indistinguishable from black and from each other. </font><font style="vertical-align: inherit;">We needed an algorithm that would give us colors whose main tone is distinguishable for both the lightest and the darkest versions. </font><font style="vertical-align: inherit;">This would allow the creation of components using these color values.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/570/4e5/9bd/5704e59bdc120461244c34f4dc678bea.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The darkest variations of our colors were indistinguishable from black and from each other.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Creating components that implement notifications, we could not use the colors from our design system. </font><font style="vertical-align: inherit;">Instead, we needed to pick our own colors on the eye.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fc/1e4/a56/3fc1e4a5627c6bec05aefae3de608e15.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These colors are beautiful, but they are not based on the color values ‚Äã‚Äãfrom our color scales.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
I used the wonderful</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ColorBox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tool</font><font style="vertical-align: inherit;">from Lyft Design</font><font style="vertical-align: inherit;">to normalize the colors</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Instead of changing colors in the simplest way, linearly, in 10% increments, I applied Bezier curves. </font><font style="vertical-align: inherit;">This allowed us to achieve significant improvements in the extreme positions of the color scales.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e9/58e/6ff/3e958e6ffcf012c47397c0a67afb58a3.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After normalizing the colors in the bright part of the spectrum, I was able to create notifications whose colors are taken from the colors of our design system</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Dark colors</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we put in order the light version of the site, it's time to try out new colors against a dark background. </font><font style="vertical-align: inherit;">As a result, I resorted to manual settings of what the color matching algorithm produced, doing this to preserve the corporate colors that have been used for a very long time. </font><font style="vertical-align: inherit;">This allowed me to use new colors in production and at the same time do without too drastic changes in the appearance of the project.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb1/8f0/00f/eb18f000f7742e215c90a7c9be062795.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Full normalized color gamut</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementing a dark theme in the Stacks interface</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If I somehow hoped to equip Stack Overflow with a dark theme, I would first need to implement a dark theme in our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stacks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> design system </font><font style="vertical-align: inherit;">, using it as a testing ground for testing new technology.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçVariables</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I needed to convert static Less compiled hexadecimal color values ‚Äã‚Äãinto custom CSS properties that were designed to be used while the program was running. The point is that color values ‚Äã‚Äãshould be stored using view structures </font></font><code>var(--red-500)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, rather than using static view structures </font></font><code>@red-500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It was an interesting task - both within our system design, and within the entire site. We usually took a single color value, like </font></font><code>@red-500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and made it lighter or darker to highlight different states of the elements (like the states that the elements take when they hover over them, or when they get focus), to use as the background color or the color of the borders of the elements.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk about the colors of each of the buttons, which we have a lot, about the colors of each state of each button, then we can say that these colors were obtained in the course of a set of transformations of a single compiled color value. It reminded me of one scene from the movie "The game for a fall." There they talked about the possibility of turning a ten millionth investment into billions of dollars. It is not surprising that such ‚Äútransformations‚Äù led to the financial crisis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The problem with regular CSS variables is that you cannot apply Less transforms to them. CSS variable values ‚Äã‚Äãare computed at runtime, so a construct like this </font></font><code>darken(var(--red-500), 5%)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leads to a compilation error. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this meant that I needed to rework the code responsible, for example, for styling buttons. At first he looked like this:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-class">.s-btn</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">color</span>: @white;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">background-color</span>: @blue-<span class="hljs-number">600</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">darken</span>(@blue-<span class="hljs-number">600</span>, <span class="hljs-number">5%</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;:hover {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">darken</span>(@blue-<span class="hljs-number">600</span>, <span class="hljs-number">5%</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">darken</span>(@blue-<span class="hljs-number">600</span>, <span class="hljs-number">10%</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I needed to go on to indicate the exact color values ‚Äã‚Äãdescribed in our color system. </font><font style="vertical-align: inherit;">As a result, I needed to come to this version of the code:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-class">.s-btn</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--white);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--blue-<span class="hljs-number">600</span>);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--blue-<span class="hljs-number">700</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;:hover {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--blue-<span class="hljs-number">700</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">var</span>(--blue-<span class="hljs-number">800</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the same time, it was clear that everything was not limited to buttons. </font><font style="vertical-align: inherit;">Therefore, I needed to rework the styles of all components available in Stacks. </font><font style="vertical-align: inherit;">The same was true for notifications, pop-up menus, modal windows, links, and many other components.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Browser Compatibility</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk about CSS variables, their application meant the need to consider their support by browsers. </font><font style="vertical-align: inherit;">In particular, they are not supported by Internet Explorer 11 - a browser that we have never forgotten about. </font><font style="vertical-align: inherit;">As a result, we decided to abandon IE11 support, getting rid of all those CSS hacks that we added to the system over the years of its development, taking into account the features of this browser. </font><font style="vertical-align: inherit;">In addition, we decided to send notifications to IE11 users with a proposal to install a new browser. </font><font style="vertical-align: inherit;">This decision was not easy for us. </font><font style="vertical-align: inherit;">Its implementation required weeks of refactoring.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçConditional classes</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IE11 didn't limit me anymore and I was able to work with colors in Stacks. I decided to add a </font></font><code>body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font><font style="vertical-align: inherit;">to the element </font></font><code>.theme-system</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Having done this, I was able to replace light colors with their dark equivalents using the appropriate media query. In addition, we could completely refuse the media request by simply adding to the </font></font><code>body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font></font><code>.theme-dark</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This would allow users to use the dark theme of the site regardless of their system settings. Here is what I got as a result:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-tag">body</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">--red-600</span>: <span class="hljs-number">#c02d2e</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">body</span><span class="hljs-selector-class">.theme-system</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;@media (<span class="hljs-attribute">prefers-color-scheme</span>: dark) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--red-<span class="hljs-number">600</span>: <span class="hljs-number">#d25d5d</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">body</span><span class="hljs-selector-class">.theme-dark</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">--red-600</span>: <span class="hljs-number">#d25d5d</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To achieve full flexibility, Stacks makes it possible to work with atomic color classes, which apply only when a dark theme is enabled. Details on CSS support in Stacks can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . For example, adding a class to an element. </font></font><code>d:bg-green-100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the designer expresses the following thought: "In dark mode, you need to use green for the background </font></font><code>bg-green-100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">." Additional conditional classes designed for dark mode allow us to remove the borders of elements, change backgrounds, and adjust the color of the text. In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tweet you can see an interesting example of color adjustment. Such a setting is sometimes necessary in dark mode. I want to note that one of the sources of inspiration when working on the dark mode of the site for me was the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tailwind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CSS framework </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçUse a dark theme in Stacks</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the dark theme was implemented in Stacks, we decided to add a button to the top of the system interface that allows you to switch between themes. </font><font style="vertical-align: inherit;">The employees of the company should have had a quick and convenient ability to switch between different color themes of the site.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cef/577/bd3/cef577bd304db402329b23ee9aa740e4.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Switch between light and dark themes in Stacks</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementing a dark theme on the Stack Overflow main site</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I solved the tasks related to the implementation of the dark theme in the interface of the Stacks design system relatively easily. Refactoring, which takes into account considerations of the future development of the system, makes it easier for Stacks to be smaller than the main site from the consequences of erroneous decisions made in the past. In order to equip Stack Overflow with a dark theme, I needed to provide support for Less variables for the sake of backward compatibility of the solution. This allowed us to organize the application of the dark theme incrementally, in separate parts of the interface. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since most of our interface, created after 2018, is based on Stacks, this part of the interface receives, without additional efforts on our part, a dark theme and responsive layouts. What about the main part of the interface? Everything here is far from so simple.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçMain colors of the site</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To begin with, I needed to make the biggest changes to the site that could be made without violating the standard light theme Stack Overflow. </font><font style="vertical-align: inherit;">The tasks that I had to solve were mainly to replace static Less variables with CSS variables equivalent to them. </font><font style="vertical-align: inherit;">First, I applied the style </font></font><code>background-color: var(--white)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the background of the site, replacing it with the style </font></font><code>background-color: @white</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Thanks to this, the main area of ‚Äã‚Äãthe villages could now easily be repainted in the background dark color. </font><font style="vertical-align: inherit;">Then I did the same operation with the colors of the fonts and some other elements. </font><font style="vertical-align: inherit;">This work mainly consisted in removing a large amount of CSS code, since, for example, we were often fond of overly detailed styles, setting the font colors of child elements, although we could well get by with color values ‚Äã‚Äãinherited from parent elements.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Demonstration of a new design for the company employees</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After I worked on large blocks of the site, I asked our programmers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adam Lear</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nick Craver to</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> help me find a way to show a preliminary version of the dark theme to the Stack Overflow staff. </font><font style="vertical-align: inherit;">This would allow employees to include a dark topic, which is still very far from being ready to see which areas of the site still need improvement. </font><font style="vertical-align: inherit;">This, I thought, would encourage them to help refine parts of the site with the most traffic. </font><font style="vertical-align: inherit;">This would allow me to overcome the main barrier to a new design. </font><font style="vertical-align: inherit;">Namely, it would help integrate the new design into the existing code base.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçButtons</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the area of ‚Äã‚Äãthe site that I was working on was created using Stacks, then in order to prepare it for using the dark mode, it was necessary to solve not very many problems. Say, during the course of the work, it was possible to decide that somewhere the border was not needed, or - that somewhere, a special shade of gray was needed as the background color. This preparation for the use of the dark regime could be limited. Unfortunately, most of the site was created without using Stacks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This was most clearly manifested when it came to the buttons. Over the years of working on the site, many button implementations have been used in it. This was especially frustrating as we stylized the elements themselves </font></font><code>button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This means that any element </font></font><code>button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, or element, decorated as</font></font><code>input type=¬´button¬ª</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, was assigned the default style. This style has a very high level of specificity and is based on an outdated set of rules. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The above fact has led to the need for a lot of refactoring, which is still ongoing. It aims to remove element-level CSS styles </font></font><code>button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and replace them with equivalents from Stacks. In particular, we are talking about the fact that hundreds of elements </font></font><code>input type=¬´submit¬ª</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">need to be replaced with </font></font><code>&lt;button type="submit" class="s-btn s-btn__primary"&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In addition to adding work, I note that we often linked JavaScript functionality to visual selectors. If you change the classes that affect the appearance of the element, this can break the functionality of the button. As a result, during the processing of thousands of buttons, I needed to add classes to them first</font></font><code>js-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, connect handlers to them, and then get rid of old styles that define the appearance of buttons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This ultimately led me to remove most of the old button classes, which allowed the buttons to change colors correctly when turning on a dark theme.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Website Title</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To complicate the task, the header used on the entire site can work in different modes. We are talking about light and dark modes, and about the support mode for a special topic. The site option for teams (Stack Overflow for Teams) and for corporate systems forcibly uses a dark header theme. In addition, the command version uses the color specified by the color of the team avatar. Like many of our other components, CSS for the site title provides for a single color, which determines whether the title is light or dark. This color then, using complex Less instructions, is transformed, which allows you to get its different options. However, we could not do what we did when we processed the code of the design system. That is, they couldn‚Äôt just throw away all the old CSS and replace it with code,which uses CSS variables. The fact is that our corporate clients, in fact, completely, with the help of themes, customize the appearance of the header. In this case, color options are generated based on a single color.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac9/46c/185/ac946c185fca67ca872cbba06ebf01e7.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Light heading</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a3/4b0/c9c/1a34b0c9c3f233b0ce09f1ee3a304f26.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dark title</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/444/297/a58/444297a5852500a5e4279b783619e1b3.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Command heading</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In the case of the bright Stack Overflow heading, we needed to find a mechanism to find out if a certain color was set using a CSS variable, or using a static hex value. </font><font style="vertical-align: inherit;">If the color was set using a CSS variable, then we could completely skip its Less transformation, creating a heading that could change colors based on the parameters of the dark theme. </font><font style="vertical-align: inherit;">If a static Less variable was used instead, you had to evaluate the color to see if it is light or dark, and create an appropriate heading. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, we came to this approach:</font></font><br>
<br>
<pre><code class="css hljs">&amp; <span class="hljs-selector-tag">when</span> ( <span class="hljs-selector-tag">iscolor</span>(<span class="hljs-keyword">@theme-topbar-background-color</span>) ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">@theme-topbar-style</span>: if(luma(@theme-topbar-background-color) &gt;= <span class="hljs-number">50%</span>, light, dark);<font></font>
&nbsp;}<font></font>
&nbsp;&amp; <span class="hljs-selector-tag">when</span> <span class="hljs-selector-tag">not</span> ( <span class="hljs-selector-tag">iscolor</span>(<span class="hljs-keyword">@theme-topbar-background-color</span>) ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">@theme-topbar-style</span>: automatic;<font></font>
&nbsp;}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then, based on the received value ( </font></font><code>automatic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>light</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>dark</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), the correct header is created.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçTags</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If I could give just one piece of advice to those involved in the design of components, then it would read: "Do not describe in components what affects their location on the page." In other words, what kind of space separates the components should determine the context in which they are applied. No need to set such things in the component itself. In earlier versions of Stack Overflow, it was decided that </font></font><code>post-tag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">external padding should be applied </font><font style="vertical-align: inherit;">to components </font><font style="vertical-align: inherit;">. At the same time, tags, like buttons, turned out to be subject to a JavaScript-related problem. To make things even harder, most tags were generated using a single helper method. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tag refactoring involved replacing </font></font><code>post-tag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-components with</font></font><code>s-tag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-components designed to use different topics. </font><font style="vertical-align: inherit;">This work also included changes to JavaScript, taking into account the use </font></font><code>js-tag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In addition, it was necessary to change the method responsible for generating tags, making it so that it would accept arbitrary classes that affect the placement of elements. </font><font style="vertical-align: inherit;">The fact is that in certain contexts, tags may need to be placed in the flex layout by doing this instead of relying on predefined external indents (or instead of fighting against such indents).</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Styling publications</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The bulk of Stack Overflow is made up of user publications. These publications, namely questions, answers, comments, are made out with the help of Markdown markup. During the launch of Stack Overflow, Markdown Markup was a relatively new technology. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Over the years, the web has developed some standard ways to display something like headings and quotes. The introduction of the dark topic was an excellent moment to review our approach to formatting publications. The most controversial issue in this matter was the formatting of quotes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, quotes were framed using a powerful yellow background color, which reduced the contrast of the quote itself. </font><font style="vertical-align: inherit;">The yellow color, in addition, causes certain problems when it is displayed on a dark background. </font><font style="vertical-align: inherit;">As a result, we moved on to the generally accepted method of displaying quotes, using a narrow gray vertical bar to highlight them.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Code styling</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the pages of Stack Overflow, which is quite understandable, many pieces of code are displayed. </font><font style="vertical-align: inherit;">The colors we used to highlight syntax had nothing to do with our signature colors. </font><font style="vertical-align: inherit;">I have a strong suspicion that these colors are the legacy of the first library used in the project for syntax highlighting. </font><font style="vertical-align: inherit;">Having analyzed these colors, I decided to subject the syntax highlight to a deep redesign. </font><font style="vertical-align: inherit;">As a result, the backlight colors were replaced with colors from our design system. </font><font style="vertical-align: inherit;">This applies to both light and dark topics. </font><font style="vertical-align: inherit;">And this is done so that what happened does not differ radically from what it was before.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">results</font></font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4df/a80/f44/4dfa80f44153364564dae8eef53c2b44.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The bright theme and the beta version of the dark theme, released on March 30.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Due to the volume of refactoring that we did while moving to the dark topic, we were able to make quite large changes to the look of the project without too much difficulty. Based on what we now have, we can, for example, develop a high-contrast website theme that increases its accessibility.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The creation of the dark theme was the result of a fundamental shift in the approach to Stack Overflow design. In particular, we are talking about the use of a</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> design system</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which I have been promoting for a year now. And creating a dark theme was an excellent opportunity for me to rebuild many parts of the site. This is the first of many projects that will increase the availability of Stack Overflow.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you do not take into account the rejection of support for IE11, work on the dark topic began in July 2019 with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PR, aimed at researching the situation. </font><font style="vertical-align: inherit;">Prior to this, in April 2019, there were </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regarding a dark topic. </font><font style="vertical-align: inherit;">In October 2019, an experimental version of a dark theme went into production. </font><font style="vertical-align: inherit;">And then, after at least 60 PRs were made, a beta version of the dark theme was presented to users. </font><font style="vertical-align: inherit;">It happened on March 30, 2020. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dear readers! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do you use Stack Overflow? </font><font style="vertical-align: inherit;">Do you like their new dark theme?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495984/index.html">React, performance and -500 milliseconds at launch - the history of our optimizations in numbers</a></li>
<li><a href="../en495986/index.html">Analysis of international documents on information security risk management. Part 2</a></li>
<li><a href="../en495990/index.html">Disclosure of telephone number and geolocation through vulnerability in Telegram</a></li>
<li><a href="../en495994/index.html">Beginning of the academic quarter or how I became the coordinator of distance learning</a></li>
<li><a href="../en495996/index.html">Raspberry Pi, Python and watering indoor plants</a></li>
<li><a href="../en496004/index.html">New models of data search and analysis. WSDM 2020 through the eyes of the Yandex.Tolki team</a></li>
<li><a href="../en496006/index.html">Outgrowing reverse proxy - technology for remote protection and site optimization without changing DNS A-records</a></li>
<li><a href="../en496010/index.html">What happens to transport during the crisis (first week of April)</a></li>
<li><a href="../en496014/index.html">IBM Weekly Seminars - April 2020</a></li>
<li><a href="../en496016/index.html">Search for bugs as a way of life: a review No. 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>