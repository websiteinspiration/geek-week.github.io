<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø ü¶î üöÖ Membuat game balap pseudo-tiga dimensi üçº üë©üèΩ‚Äçü§ù‚Äçüë©üèº ü•ß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sebagai seorang anak, saya jarang pergi ke ruang-ruang arcade arcade karena saya tidak benar-benar membutuhkannya, karena saya punya game yang luar bi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Membuat game balap pseudo-tiga dimensi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499252/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d16/6e3/cff/d166e3cff9c2a3cefeb68f5c1ddc02d1.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai seorang anak, saya jarang pergi ke ruang-ruang arcade arcade karena saya tidak benar-benar membutuhkannya, karena saya punya game yang luar biasa untuk C64 di rumah ... tetapi ada tiga game arcade yang selalu saya punya uang - Donkey Kong, Dragon Lair dan Outrun ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... dan saya sangat suka berlari lebih cepat - kecepatan, bukit, pohon-pohon palem dan musik, bahkan pada versi yang lemah untuk C64.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48e/aee/56f/48eaee56f43d8a25e840c6ae13268db4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi saya memutuskan untuk mencoba menulis game balap pseudo-tiga dimensi sekolah tua dengan gaya Outrun, Pitstop atau Pole. </font><font style="vertical-align: inherit;">Saya tidak berencana untuk membuat permainan yang lengkap dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lengkap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi bagi saya tampaknya akan menarik untuk memeriksa kembali mekanisme yang dengannya permainan ini mewujudkan trik mereka. </font><font style="vertical-align: inherit;">Kurva, bukit, sprite, dan kecepatan ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, inilah "proyek akhir pekan" saya, yang pada akhirnya memakan waktu lima atau enam minggu di akhir pekan</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ec/27b/d28/7ec27bd28630dbbaf7b81c87233c28ac.png"></div><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bermain permainan</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kode sumber</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versi yang dapat diputar lebih seperti demo teknis daripada game nyata. </font><font style="vertical-align: inherit;">Bahkan, jika Anda ingin membuat balapan pseudo-tiga-dimensi yang nyata, maka ini akan menjadi fondasi paling minimal yang Anda butuhkan untuk secara bertahap berubah menjadi permainan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini tidak dipoles, sedikit jelek, tetapi berfungsi penuh. </font><font style="vertical-align: inherit;">Saya akan menunjukkan kepada Anda bagaimana menerapkannya sendiri dalam empat langkah sederhana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda juga bisa bermain</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demo jalan langsung</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demo dengan kurva</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demo dengan bukit-bukit</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versi selesai</font></font></a></li>
</ul><a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentang kinerja</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kinerja game </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini sangat</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tergantung pada mesin / browser. </font><font style="vertical-align: inherit;">Di browser modern, ini berfungsi dengan baik, terutama pada mereka yang memiliki akselerasi GPU kanvas, tetapi driver grafis yang buruk dapat menyebabkannya membeku. </font><font style="vertical-align: inherit;">Dalam gim, Anda dapat mengubah resolusi rendering dan jarak rendering.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentang struktur kode</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kebetulan proyek tersebut diimplementasikan dalam Javascript (karena kesederhanaan prototyping), tetapi tidak dimaksudkan untuk menunjukkan teknik atau teknik yang direkomendasikan dari Javascript. </font><font style="vertical-align: inherit;">Bahkan, untuk memudahkan pemahaman, Javascript dari setiap contoh disematkan langsung di halaman HTML (horor!); </font><font style="vertical-align: inherit;">lebih buruk lagi, ia menggunakan variabel dan fungsi global. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika saya membuat game nyata, kodenya akan jauh lebih terstruktur dan efisien, tetapi karena ini adalah demo teknis dari game balap, saya memutuskan untuk tetap menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KISS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 1. Jalan lurus.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, bagaimana kita memulai membuat game balap pseudo-tiga dimensi? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, kita perlu</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ulangi trigonometri</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingat kembali dasar-dasar proyeksi 3d</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat lingkaran game</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unduh gambar sprite</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bangun geometri jalan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadikan latar belakang</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berikan jalan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render mobil</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terapkan dukungan keyboard untuk kontrol alat berat</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi sebelum kita mulai, mari kita baca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lou's Pseudo 3d Page</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terjemahan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Habr√©] - satu-satunya sumber informasi (yang bisa saya temukan) tentang cara membuat game balap psevdotrohmernuyu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selesai membaca artikel Lou? </font><font style="vertical-align: inherit;">Baik! </font><font style="vertical-align: inherit;">Kami akan membuat variasi teknik Realistic Hills Using 3d-Projected Segments. </font><font style="vertical-align: inherit;">Kami akan melakukan ini secara bertahap selama empat bagian berikutnya. </font><font style="vertical-align: inherit;">Tetapi kita akan mulai sekarang, dengan versi v1, dan membuat geometri jalan lurus yang sangat sederhana dengan memproyeksikannya ke elemen kanvas HTML5.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demo dapat dilihat di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sedikit trigonometri</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum kita masuk ke implementasi, mari kita gunakan dasar-dasar trigonometri untuk mengingat bagaimana memproyeksikan titik di dunia 3D ke layar 2D. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus paling sederhana, jika Anda tidak menyentuh vektor dan matriks, hukum </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segitiga serupa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digunakan untuk proyeksi 3D </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan notasi berikut:</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = tinggi kamera</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = jarak dari kamera ke layar</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = jarak dari kamera ke mobil</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = layar </font><strong><font style="vertical-align: inherit;">y</font></strong><font style="vertical-align: inherit;"> koordinat</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lalu kita bisa menggunakan hukum segitiga yang sama untuk menghitung </font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y = h * d / z</font></font></strong></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
seperti yang ditunjukkan pada diagram:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/949/0ab/47b/9490ab47bb570b61218e46e5913c18bb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda juga bisa menggambar diagram serupa di tampilan atas, bukan tampilan samping, dan mendapatkan persamaan yang sama untuk menghitung koordinat </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> layar:</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x = w * d / z</font></font></strong></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di mana </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = setengah lebar jalan (dari kamera ke tepi jalan). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, untuk </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami mengukur berdasarkan faktor</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d / z</font></font></strong></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistem koordinat</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam bentuk diagram, itu terlihat indah dan sederhana, tetapi ketika Anda memulai pengkodean, Anda bisa sedikit bingung, karena kami memilih nama yang berubah-ubah, dan tidak jelas dengan apa yang kami tetapkan koordinat dunia 3D, dan apa koordinat layar 2D itu. </font><font style="vertical-align: inherit;">Kami juga berasumsi bahwa kamera berada di pusat asal usul dunia, meskipun pada kenyataannya ia akan mengikuti mesin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda melakukan pendekatan secara lebih formal, maka kami perlu melakukan:</font></font><br>
<br>
<ol>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">konversi</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari koordinat dunia ke koordinat layar</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memproyeksikan</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> koordinat kamera ke bidang proyeksi yang dinormalisasi</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scaling</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> koordinat yang diproyeksikan ke koordinat layar fisik (dalam kasus kami, ini kanvas)</font></font></li>
</ol><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b59/5d2/30f/b595d230f4f45b9b0c9409266d5804d8.png"></div><br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan: dalam sistem-3d saat ini </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">tahap </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rotasi</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dilakukan antara tahap 1 dan 2 </font><font style="vertical-align: inherit;">, tetapi karena kita akan mensimulasikan kurva, kita tidak perlu rotasi.</font></font></em></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proyeksi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Persamaan proyeksi formal dapat direpresentasikan sebagai berikut:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/edb/246/e18/edb246e187e7fe0eb027b53c58790c34.png"></div><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Titik </font><font style="vertical-align: inherit;">Persamaan Konversi ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terjemahkan</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) dihitung relatif terhadap bilik</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Persamaan proyeksi ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyek</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) adalah variasi dari "hukum segitiga serupa" yang ditunjukkan di atas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Persamaan Penskalaan ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skala</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) memperhitungkan perbedaan antara:</font></font><br>
<ul>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matematika</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di mana 0,0 berada di tengah dan sumbu y naik, dan</font></font></li>
<li><em></em>,  0,0     ,   y  :</li>
</ul></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/11f/050/aad/11f050aadea0d1c537baefcb06f7c2f0.png"></div><br>
<blockquote><em>:   3d-         <code>Vector</code>  <code>Matrix</code>     3d-,      ,      WebGL (  )‚Ä¶       .           Outrun.</em></blockquote><br>
<h2>  </h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b7/27b/1bd/3b727b1bdb285d874bd659c29db13522.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian terakhir dari teka-teki akan menjadi cara untuk menghitung </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - jarak dari kamera ke bidang proyeksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alih-alih hanya menulis nilai hard-set dari </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , akan lebih berguna untuk menghitungnya dari bidang tampilan vertikal yang diinginkan. </font><font style="vertical-align: inherit;">Berkat ini, kami akan dapat "memperbesar" kamera jika perlu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita mengasumsikan bahwa kita memproyeksikan ke bidang proyeksi yang dinormalisasi, koordinatnya berada dalam kisaran dari -1 hingga +1, maka </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat dihitung sebagai berikut:</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 1 / tan (fov / 2)</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mendefinisikan fov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebagai satu (dari banyak) variabel, kita dapat menyesuaikan ruang lingkup untuk menyempurnakan algoritma rendering.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Struktur Kode Javascript</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada awal artikel, saya sudah mengatakan bahwa kode tersebut tidak cukup sesuai dengan pedoman untuk menulis Javascript - ini adalah demo "cepat dan kotor" dengan variabel dan fungsi global yang sederhana. </font><font style="vertical-align: inherit;">Namun, karena saya akan membuat empat versi terpisah (lurus, kurva, bukit dan sprite), saya akan menyimpan beberapa metode yang dapat digunakan kembali di </font></font><code>common.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam modul berikut:</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dom</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah beberapa fungsi pembantu DOM kecil.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Util</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - utilitas umum, terutama fungsi matematika bantu.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fungsi dukungan game umum, seperti pengunduh gambar dan loop game.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fungsi rendering pembantu di atas kanvas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan menjelaskan secara terperinci metode dari </font></font><code>common.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hanya jika mereka berhubungan dengan permainan itu sendiri, dan bukan hanya fungsi matematika atau DOM tambahan. </font><font style="vertical-align: inherit;">Semoga dari nama dan konteksnya akan jelas apa metode yang harus dilakukan.</font></font><br>
<br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti biasa, kode sumber ada di dokumentasi akhir.</font></font></em></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Loop game sederhana</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum merender sesuatu, kita perlu loop game. </font><font style="vertical-align: inherit;">Jika Anda membaca salah satu artikel saya sebelumnya tentang permainan ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pong</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">breakout</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tetris</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ular</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boulderdash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), maka Anda telah melihat contoh siklus permainan favorit saya dengan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">langkah waktu yang tetap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak akan masuk jauh ke detail, dan hanya menggunakan kembali bagian dari kode dari game sebelumnya untuk membuat loop game dengan langkah waktu yang tetap menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requestAnimationFrame</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prinsipnya adalah bahwa masing-masing dari empat contoh saya dapat memanggil </font></font><code>Game.run(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan menggunakan versinya sendiri</font></font><br>
<br>
<ul>
<li><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Memperbarui dunia game dengan langkah waktu yang tetap.</font></font></li>
<li><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Memperbarui dunia game saat browser memungkinkan.</font></font></li>
</ul><br>
<pre><code class="javascript hljs">run: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{<font></font>
<font></font>
  Game.loadImages(options.images, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">images</span>) </span>{<font></font>
<font></font>
    <span class="hljs-keyword">var</span> update = options.update,    <span class="hljs-comment">// method to update game logic is provided by caller</span>
        render = options.render,    <span class="hljs-comment">// method to render the game is provided by caller</span>
        step   = options.step,      <span class="hljs-comment">// fixed frame step (1/fps) is specified by caller</span>
        now    = <span class="hljs-literal">null</span>,<font></font>
        last   = Util.timestamp(),<font></font>
        dt     = <span class="hljs-number">0</span>,<font></font>
        gdt    = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">frame</span>(<span class="hljs-params"></span>) </span>{<font></font>
      now = Util.timestamp();<font></font>
      dt  = <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, (now - last) / <span class="hljs-number">1000</span>); <span class="hljs-comment">// using requestAnimationFrame have to be able to handle large delta's caused when it 'hibernates' in a background or non-visible tab</span><font></font>
      gdt = gdt + dt;<font></font>
      <span class="hljs-keyword">while</span> (gdt &gt; step) {<font></font>
        gdt = gdt - step;<font></font>
        update(step);<font></font>
      }<font></font>
      render();<font></font>
      last = now;<font></font>
      requestAnimationFrame(frame);<font></font>
    }<font></font>
    frame(); <span class="hljs-comment">// lets get this party started</span><font></font>
  });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekali lagi, ini adalah pembuatan ulang ide dari game kanvas saya sebelumnya, jadi jika Anda tidak mengerti cara kerja loop game, maka kembalilah ke salah satu artikel sebelumnya.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar dan sprite</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum siklus permainan dimulai, kami memuat dua spritesheet (sprite sheet) yang terpisah:</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">background</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tiga lapisan paralaks untuk langit, bukit, dan pohon</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sprite</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><strong><font style="vertical-align: inherit;">sprite</font></strong><font style="vertical-align: inherit;"> mesin (ditambah pohon dan papan iklan yang akan ditambahkan ke versi final)</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6f/111/acc/f6f111accbba448459e25c6fe761ff05.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembar sprite dibuat menggunakan tugas kecil Rake dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruby Gem sprite-factory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas ini menghasilkan lembar sprite gabungan, serta koordinat x, y, w, h, yang akan disimpan dalam konstanta </font></font><code>BACKGROUND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>SPRITES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan: Saya membuat latar belakang menggunakan Inkscape, dan kebanyakan sprite adalah grafik yang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diambil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari versi Outrun lama untuk Genesis dan digunakan sebagai contoh pelatihan.</font></font></em></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Variabel game</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain gambar latar dan sprite, kami membutuhkan beberapa variabel game, yaitu:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> fps           = <span class="hljs-number">60</span>;                      <span class="hljs-comment">// how many 'update' frames per second</span>
<span class="hljs-keyword">var</span> step          = <span class="hljs-number">1</span>/fps;                   <span class="hljs-comment">// how long is each frame (in seconds)</span>
<span class="hljs-keyword">var</span> width         = <span class="hljs-number">1024</span>;                    <span class="hljs-comment">// logical canvas width</span>
<span class="hljs-keyword">var</span> height        = <span class="hljs-number">768</span>;                     <span class="hljs-comment">// logical canvas height</span>
<span class="hljs-keyword">var</span> segments      = [];                      <span class="hljs-comment">// array of road segments</span>
<span class="hljs-keyword">var</span> canvas        = Dom.get(<span class="hljs-string">'canvas'</span>);       <span class="hljs-comment">// our canvas...</span>
<span class="hljs-keyword">var</span> ctx           = canvas.getContext(<span class="hljs-string">'2d'</span>); <span class="hljs-comment">// ...and its drawing context</span>
<span class="hljs-keyword">var</span> background    = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// our background image (loaded below)</span>
<span class="hljs-keyword">var</span> sprites       = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// our spritesheet (loaded below)</span>
<span class="hljs-keyword">var</span> resolution    = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// scaling factor to provide resolution independence (computed)</span>
<span class="hljs-keyword">var</span> roadWidth     = <span class="hljs-number">2000</span>;                    <span class="hljs-comment">// actually half the roads width, easier math if the road spans from -roadWidth to +roadWidth</span>
<span class="hljs-keyword">var</span> segmentLength = <span class="hljs-number">200</span>;                     <span class="hljs-comment">// length of a single segment</span>
<span class="hljs-keyword">var</span> rumbleLength  = <span class="hljs-number">3</span>;                       <span class="hljs-comment">// number of segments per red/white rumble strip</span>
<span class="hljs-keyword">var</span> trackLength   = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// z length of entire track (computed)</span>
<span class="hljs-keyword">var</span> lanes         = <span class="hljs-number">3</span>;                       <span class="hljs-comment">// number of lanes</span>
<span class="hljs-keyword">var</span> fieldOfView   = <span class="hljs-number">100</span>;                     <span class="hljs-comment">// angle (degrees) for field of view</span>
<span class="hljs-keyword">var</span> cameraHeight  = <span class="hljs-number">1000</span>;                    <span class="hljs-comment">// z height of camera</span>
<span class="hljs-keyword">var</span> cameraDepth   = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// z distance camera is from screen (computed)</span>
<span class="hljs-keyword">var</span> drawDistance  = <span class="hljs-number">300</span>;                     <span class="hljs-comment">// number of segments to draw</span>
<span class="hljs-keyword">var</span> playerX       = <span class="hljs-number">0</span>;                       <span class="hljs-comment">// player x offset from center of road (-1 to 1 to stay independent of roadWidth)</span>
<span class="hljs-keyword">var</span> playerZ       = <span class="hljs-literal">null</span>;                    <span class="hljs-comment">// player relative z distance from camera (computed)</span>
<span class="hljs-keyword">var</span> fogDensity    = <span class="hljs-number">5</span>;                       <span class="hljs-comment">// exponential fog density</span>
<span class="hljs-keyword">var</span> position      = <span class="hljs-number">0</span>;                       <span class="hljs-comment">// current camera Z position (add playerZ to get player's absolute Z position)</span>
<span class="hljs-keyword">var</span> speed         = <span class="hljs-number">0</span>;                       <span class="hljs-comment">// current speed</span>
<span class="hljs-keyword">var</span> maxSpeed      = segmentLength/step;      <span class="hljs-comment">// top speed (ensure we can't move more than 1 segment in a single frame to make collision detection easier)</span>
<span class="hljs-keyword">var</span> accel         =  maxSpeed/<span class="hljs-number">5</span>;             <span class="hljs-comment">// acceleration rate - tuned until it 'felt' right</span>
<span class="hljs-keyword">var</span> breaking      = -maxSpeed;               <span class="hljs-comment">// deceleration rate when braking</span>
<span class="hljs-keyword">var</span> decel         = -maxSpeed/<span class="hljs-number">5</span>;             <span class="hljs-comment">// 'natural' deceleration rate when neither accelerating, nor braking</span>
<span class="hljs-keyword">var</span> offRoadDecel  = -maxSpeed/<span class="hljs-number">2</span>;             <span class="hljs-comment">// off road deceleration is somewhere in between</span>
<span class="hljs-keyword">var</span> offRoadLimit  =  maxSpeed/<span class="hljs-number">4</span>;             <span class="hljs-comment">// limit when off road deceleration no longer applies (e.g. you can always go at least this speed even when off road)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa di antaranya dapat dikustomisasi menggunakan kontrol UI untuk mengubah nilai kritis selama eksekusi program sehingga Anda dapat melihat bagaimana pengaruhnya terhadap rendering jalan. </font><font style="vertical-align: inherit;">Lainnya dihitung ulang dari nilai UI khusus dalam metode ini </font></font><code>reset()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mengelola Ferrari</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melakukan binding kunci untuk </font></font><code>Game.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang menyediakan input keyboard sederhana yang mengatur atau me-reset variabel yang melaporkan tindakan pemain saat ini:</font></font><br>
<br>
<pre><code class="javascript hljs">Game.run({<font></font>
  ...<font></font>
  keys: [<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.LEFT,  KEY.A], <span class="hljs-attr">mode</span>: <span class="hljs-string">'down'</span>, <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyLeft   = <span class="hljs-literal">true</span>;  } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.RIGHT, KEY.D], <span class="hljs-attr">mode</span>: <span class="hljs-string">'down'</span>, <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyRight  = <span class="hljs-literal">true</span>;  } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.UP,    KEY.W], <span class="hljs-attr">mode</span>: <span class="hljs-string">'down'</span>, <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyFaster = <span class="hljs-literal">true</span>;  } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.DOWN,  KEY.S], <span class="hljs-attr">mode</span>: <span class="hljs-string">'down'</span>, <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keySlower = <span class="hljs-literal">true</span>;  } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.LEFT,  KEY.A], <span class="hljs-attr">mode</span>: <span class="hljs-string">'up'</span>,   <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyLeft   = <span class="hljs-literal">false</span>; } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.RIGHT, KEY.D], <span class="hljs-attr">mode</span>: <span class="hljs-string">'up'</span>,   <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyRight  = <span class="hljs-literal">false</span>; } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.UP,    KEY.W], <span class="hljs-attr">mode</span>: <span class="hljs-string">'up'</span>,   <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keyFaster = <span class="hljs-literal">false</span>; } },<font></font>
    { <span class="hljs-attr">keys</span>: [KEY.DOWN,  KEY.S], <span class="hljs-attr">mode</span>: <span class="hljs-string">'up'</span>,   <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ keySlower = <span class="hljs-literal">false</span>; } }<font></font>
  ],<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Status pemain dikendalikan oleh variabel-variabel berikut:</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kecepatan</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><strong><font style="vertical-align: inherit;">kecepatan</font></strong><font style="vertical-align: inherit;"> saat ini.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">position</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><strong><font style="vertical-align: inherit;">posisi</font></strong><font style="vertical-align: inherit;"> Z saat ini di trek. </font><font style="vertical-align: inherit;">Perhatikan bahwa ini adalah posisi kamera, bukan Ferrari.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">playerX</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - posisi pemain saat ini di X di jalan. </font><font style="vertical-align: inherit;">Dinormalisasi dalam kisaran dari -1 hingga +1, agar tidak bergantung pada nilai aktual </font></font><code>roadWidth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variabel-variabel ini diatur di dalam metode </font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang melakukan tindakan berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pembaruan </font></font><code>position</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berdasarkan saat ini </font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pembaruan </font></font><code>playerX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saat Anda menekan tombol kiri atau kanan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meningkat </font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika tombol atas ditekan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berkurang </font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika tombol bawah ditekan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berkurang </font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika tombol atas dan bawah tidak ditekan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengurangi </font></font><code>speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika </font></font><code>playerX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terletak di tepi jalan dan di rumput.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus jalan langsung, metode ini </font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cukup jelas dan sederhana:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">dt</span>) </span>{<font></font>
<font></font>
  position = Util.increase(position, dt * speed, trackLength);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> dx = dt * <span class="hljs-number">2</span> * (speed/maxSpeed); <span class="hljs-comment">// at top speed, should be able to cross from left to right (-1 to 1) in 1 second</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> (keyLeft)<font></font>
    playerX = playerX - dx;<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (keyRight)<font></font>
    playerX = playerX + dx;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (keyFaster)<font></font>
    speed = Util.accelerate(speed, accel, dt);<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (keySlower)<font></font>
    speed = Util.accelerate(speed, breaking, dt);<font></font>
  <span class="hljs-keyword">else</span><font></font>
    speed = Util.accelerate(speed, decel, dt);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (((playerX &lt; <span class="hljs-number">-1</span>) || (playerX &gt; <span class="hljs-number">1</span>)) &amp;&amp; (speed &gt; offRoadLimit))<font></font>
    speed = Util.accelerate(speed, offRoadDecel, dt);<font></font>
<font></font>
  playerX = Util.limit(playerX, <span class="hljs-number">-2</span>, <span class="hljs-number">2</span>);     <span class="hljs-comment">// dont ever let player go too far out of bounds</span>
  speed   = Util.limit(speed, <span class="hljs-number">0</span>, maxSpeed); <span class="hljs-comment">// or exceed maxSpeed</span><font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan khawatir, itu akan menjadi jauh lebih sulit ketika dalam versi selesai kami menambahkan sprite dan pengenalan tabrakan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geometri jalan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum kita dapat membuat dunia game, kita perlu membangun sebuah array </font></font><code>segments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di dalam metode </font></font><code>resetRoad()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masing-masing segmen jalan ini pada akhirnya akan diproyeksikan dari koordinat dunianya sehingga berubah menjadi poligon 2d dalam koordinat layar. </font><font style="vertical-align: inherit;">Untuk setiap segmen, kami menyimpan dua titik, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah pusat tepi paling dekat dengan kamera, dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah pusat tepi terjauh dari kamera.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53a/fa4/076/53afa40768a00b49833703b1457a6941.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2 dari</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setiap segmen identik dengan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1 dari</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> segmen sebelumnya, tetapi bagi saya lebih mudah untuk menyimpannya sebagai titik yang terpisah dan mengonversi setiap segmen secara terpisah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tetap terpisah </font></font><code>rumbleLength</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">karena kami dapat memiliki kurva rinci dan indah, tetapi pada saat yang sama garis-garis horizontal. Jika setiap segmen berikutnya memiliki warna yang berbeda, maka ini akan menciptakan efek strobo yang buruk. Oleh karena itu, kami ingin memiliki banyak segmen kecil, tetapi kelompokkan bersama untuk membentuk garis horizontal terpisah.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetRoad</span>(<span class="hljs-params"></span>) </span>{<font></font>
  segments = [];<font></font>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span> ; n &lt; <span class="hljs-number">500</span> ; n++) { <span class="hljs-comment">// arbitrary road length</span><font></font>
    segments.push({<font></font>
       <span class="hljs-attr">index</span>: n,
       <span class="hljs-attr">p1</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">z</span>:  n   *segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
       <span class="hljs-attr">p2</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">z</span>: (n+<span class="hljs-number">1</span>)*segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
       <span class="hljs-attr">color</span>: <span class="hljs-built_in">Math</span>.floor(n/rumbleLength)%<span class="hljs-number">2</span> ? COLORS.DARK : COLORS.LIGHT<font></font>
    });<font></font>
  }<font></font>
<font></font>
  trackLength = segments.length * segmentLength;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menginisialisasi </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hanya dengan koordinat dunia </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena kami hanya perlu jalan lurus. Koordinat </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan selalu 0, dan koordinat </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan selalu bergantung pada nilai yang diskalakan </font></font><code>+/- roadWidth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Nanti, ketika kita menambahkan kurva dan bukit, bagian ini akan berubah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami juga akan mengatur objek kosong untuk menyimpan representasi titik-titik ini di kamera dan di layar agar tidak membuat banyak objek sementara di masing-masing </font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Untuk meminimalkan pengumpulan sampah, kita harus menghindari mengalokasikan objek dalam loop game.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika mobil mencapai ujung jalan, kita cukup kembali ke awal siklus. </font><font style="vertical-align: inherit;">Untuk menyederhanakan ini, kami akan membuat metode untuk menemukan segmen untuk nilai Z apa pun, bahkan jika melampaui panjang jalan:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findSegment</span>(<span class="hljs-params">z</span>) </span>{
  <span class="hljs-keyword">return</span> segments[<span class="hljs-built_in">Math</span>.floor(z/segmentLength) % segments.length];<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render latar belakang</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dimulai dengan merender gambar latar belakang. </font><font style="vertical-align: inherit;">Di bagian berikut, di mana kita akan menambahkan kurva dan bukit, kita akan membutuhkan latar belakang untuk melakukan pengguliran paralaks, jadi sekarang kita akan mulai bergerak ke arah ini, menjadikan latar belakang sebagai tiga lapisan terpisah:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>) </span>{<font></font>
<font></font>
  ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);<font></font>
<font></font>
  Render.background(ctx, background, width, height, BACKGROUND.SKY);<font></font>
  Render.background(ctx, background, width, height, BACKGROUND.HILLS);<font></font>
  Render.background(ctx, background, width, height, BACKGROUND.TREES);<font></font>
<font></font>
  ...</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render jalan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian, fungsi render berulang melalui semua segmen dan memproyeksikan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> masing </font><strong><font style="vertical-align: inherit;">-</font></strong><font style="vertical-align: inherit;"> masing segmen dari koordinat dunia ke koordinat layar, memangkas segmen jika perlu, dan merendernya:</font></font><br>
<br>
<pre><code class="javascript hljs">  <span class="hljs-keyword">var</span> baseSegment = findSegment(position);
  <span class="hljs-keyword">var</span> maxy        = height;
  <span class="hljs-keyword">var</span> n, segment;
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; drawDistance ; n++) {<font></font>
<font></font>
    segment = segments[(baseSegment.index + n) % segments.length];<font></font>
<font></font>
    Util.project(segment.p1, (playerX * roadWidth), cameraHeight, position, cameraDepth, width, height, roadWidth);<font></font>
    Util.project(segment.p2, (playerX * roadWidth), cameraHeight, position, cameraDepth, width, height, roadWidth);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ((segment.p1.camera.z &lt;= cameraDepth) || <span class="hljs-comment">// behind us</span>
        (segment.p2.screen.y &gt;= maxy))          <span class="hljs-comment">// clip by (already rendered) segment</span>
      <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
    Render.segment(ctx, width, lanes,<font></font>
                   segment.p1.screen.x,<font></font>
                   segment.p1.screen.y,<font></font>
                   segment.p1.screen.w,<font></font>
                   segment.p2.screen.x,<font></font>
                   segment.p2.screen.y,<font></font>
                   segment.p2.screen.w,<font></font>
                   segment.color);<font></font>
<font></font>
    maxy = segment.p2.screen.y;<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di atas, kita telah melihat perhitungan yang diperlukan untuk memproyeksikan suatu poin; Versi javascript menggabungkan transformasi, proyeksi dan penskalaan menjadi satu metode:</font></font><br>
<br>
<pre><code class="javascript hljs">project: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p, cameraX, cameraY, cameraZ, cameraDepth, width, height, roadWidth</span>) </span>{<font></font>
  p.camera.x     = (p.world.x || <span class="hljs-number">0</span>) - cameraX;<font></font>
  p.camera.y     = (p.world.y || <span class="hljs-number">0</span>) - cameraY;<font></font>
  p.camera.z     = (p.world.z || <span class="hljs-number">0</span>) - cameraZ;<font></font>
  p.screen.scale = cameraDepth/p.camera.z;<font></font>
  p.screen.x     = <span class="hljs-built_in">Math</span>.round((width/<span class="hljs-number">2</span>)  + (p.screen.scale * p.camera.x  * width/<span class="hljs-number">2</span>));<font></font>
  p.screen.y     = <span class="hljs-built_in">Math</span>.round((height/<span class="hljs-number">2</span>) - (p.screen.scale * p.camera.y  * height/<span class="hljs-number">2</span>));<font></font>
  p.screen.w     = <span class="hljs-built_in">Math</span>.round(             (p.screen.scale * roadWidth   * width/<span class="hljs-number">2</span>));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain menghitung layar </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk setiap titik </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami menggunakan perhitungan proyeksi yang sama untuk menghitung proyeksi lebar ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) segmen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memiliki layar </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> koordinat </font><font style="vertical-align: inherit;">titik </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , serta lebar jalan yang diproyeksikan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kita dapat dengan mudah menghitung dengan bantuan fungsi bantu </font></font><code>Render.segment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">semua poligon yang diperlukan untuk rendering rumput, jalan, garis horizontal dan garis pemisah, menggunakan fungsi bantu umum </font></font><code>Render.polygon</code> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(lihat</font></font><code>common.js</code><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fungsi tambahan umum) </font><em><font style="vertical-align: inherit;">(lihat . </font></em><em><font style="vertical-align: inherit;">)</font></em><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render mobil</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, hal terakhir yang dibutuhkan metode </font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini adalah rendering Ferrari:</font></font><br>
<br>
<pre><code class="javascript hljs">  Render.player(ctx, width, height, resolution, roadWidth, sprites, speed/maxSpeed,<font></font>
                cameraDepth/playerZ,<font></font>
                width/<span class="hljs-number">2</span>,<font></font>
                height);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ini disebut </font></font><code>player</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan bukan </font></font><code>car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, karena dalam versi final permainan akan ada mobil lain di jalan, dan kami ingin memisahkan pemain Ferrari dari mobil lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi helper </font></font><code>Render.player</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggunakan metode kanvas yang dipanggil </font></font><code>drawImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk membuat sprite, setelah sebelumnya menskalanya menggunakan skala proyeksi yang sama yang digunakan sebelumnya:</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di mana </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam hal ini adalah jarak relatif dari mesin ke kamera, disimpan dalam </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pemutar</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variabelZ </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, fungsi "mengguncang" mobil sedikit pada kecepatan tinggi, menambahkan sedikit keacakan ke persamaan penskalaan, tergantung pada </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kecepatan / kecepatan maksimum</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan inilah yang kami dapatkan:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/845/dfd/3e8/845dfd3e88ef0a22b2c9fd021140ff3b.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melakukan pekerjaan yang cukup besar hanya untuk menciptakan sistem dengan jalan lurus. </font><font style="vertical-align: inherit;">Kami menambahkan</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generik pembantu modul </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dom</font></font></strong></li>
<li><font style="vertical-align: inherit;"><strong><font style="vertical-align: inherit;">Gunakan</font></strong><font style="vertical-align: inherit;"> modul matematika umum</font></font><strong><font style="vertical-align: inherit;"></font></strong></li>
<li><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modul pembantu umum </font><font style="vertical-align: inherit;">...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... termasuk </font></font><code>Render.segment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Render.polygon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan</font></font><code>Render.sprite</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">siklus permainan pitch tetap</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengunduh gambar</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengendali keyboard</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">latar belakang paralaks</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sprite sheet dengan mobil, pohon, dan papan iklan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geometri dasar belum sempurna</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">metode </font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk mengendalikan mesin</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">metode </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk menampilkan latar belakang, jalan, dan mobil pemain</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tag HTML5 </font></font><code>&lt;audio&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan musik balap (bonus tersembunyi!)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... yang memberi kami dasar yang baik untuk pengembangan lebih lanjut.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 2. Kurva.</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98f/c3d/6d1/98fc3d6d13cc16f12847d253e112fcb2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada bagian ini, kami akan menjelaskan secara lebih rinci bagaimana kurva bekerja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada bagian sebelumnya, kami menyusun geometri jalan dalam bentuk array segmen, yang masing-masing memiliki koordinat dunia yang ditransformasikan relatif ke kamera dan kemudian diproyeksikan ke layar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami hanya membutuhkan koordinat dunia </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk setiap titik, karena pada jalan lurus </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sama dengan nol.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c78/551/359/c78551359ef7c11e4af48b4285d61842.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita membuat sistem 3d yang berfungsi penuh, kita bisa menerapkan kurva dengan menghitung garis </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari poligon yang ditunjukkan di atas. Namun, jenis geometri ini akan agak sulit untuk dihitung, dan untuk ini perlu menambahkan tahap rotasi-3d ke persamaan proyeksi ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... jika kita menggunakan cara ini, akan lebih baik menggunakan WebGL atau analognya, tetapi proyek ini tidak memiliki tugas lain untuk proyek kita. Kami hanya ingin menggunakan trik pseudo-tiga dimensi jadul untuk mensimulasikan kurva. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, Anda mungkin akan terkejut mengetahui bahwa kami tidak akan menghitung koordinat </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> segmen jalan sama sekali ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebaliknya, kami akan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saran Lu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Untuk melengkung jalan, cukup ubah posisi garis tengah bentuk kurva ... mulai dari bagian bawah layar, jumlah pergeseran pusat jalan ke kiri atau ke kanan secara bertahap meningkat</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><em><font style="vertical-align: inherit;">"</font></em></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus kami, garis tengah adalah nilai yang </font></font><code>cameraX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diteruskan ke perhitungan proyeksi. </font><font style="vertical-align: inherit;">Ini berarti bahwa ketika kami melakukan </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setiap segmen jalan, Anda dapat mensimulasikan kurva dengan menggeser nilainya </font></font><code>cameraX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan </font><font style="vertical-align: inherit;">nilai </font><font style="vertical-align: inherit;">yang meningkat secara bertahap.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8a/569/19e/c8a56919e67d6f19cc737074ce92fffb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengetahui berapa banyak yang harus diubah, kita perlu menyimpan nilai di setiap segmen </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nilai ini menunjukkan seberapa banyak segmen harus digeser dari garis tengah kamera. </font><font style="vertical-align: inherit;">Dia akan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">negatif untuk kurva belok kiri</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">positif untuk belokan ke kanan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kurang untuk kurva halus</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lebih banyak untuk kurva tajam</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nilai-nilai itu sendiri dipilih secara sewenang-wenang; </font><font style="vertical-align: inherit;">melalui coba-coba, kita dapat menemukan nilai bagus di mana kurva tampaknya ‚Äúbenar‚Äù:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> ROAD = {
  <span class="hljs-attr">LENGTH</span>: { <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">SHORT</span>:  <span class="hljs-number">25</span>, <span class="hljs-attr">MEDIUM</span>:  <span class="hljs-number">50</span>, <span class="hljs-attr">LONG</span>:  <span class="hljs-number">100</span> }, <span class="hljs-comment">// num segments</span>
  <span class="hljs-attr">CURVE</span>:  { <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">EASY</span>:    <span class="hljs-number">2</span>, <span class="hljs-attr">MEDIUM</span>:   <span class="hljs-number">4</span>, <span class="hljs-attr">HARD</span>:    <span class="hljs-number">6</span> }<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain memilih nilai yang baik untuk kurva, kita perlu menghindari celah dalam transisi ketika garis berubah menjadi kurva (atau sebaliknya). </font><font style="vertical-align: inherit;">Ini dapat dicapai dengan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melunakkan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saat memasuki dan keluar dari kurva. </font><font style="vertical-align: inherit;">Kami akan melakukan ini dengan secara bertahap meningkatkan (atau mengurangi) nilai </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk setiap segmen menggunakan fungsi smoothing tradisional hingga mencapai nilai yang diinginkan:</font></font><br>
<br>
<pre><code class="javascript hljs">easeIn:    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b,percent</span>) </span>{ <span class="hljs-keyword">return</span> a + (b-a)*<span class="hljs-built_in">Math</span>.pow(percent,<span class="hljs-number">2</span>);                           },
<span class="hljs-attr">easeOut</span>:   <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b,percent</span>) </span>{ <span class="hljs-keyword">return</span> a + (b-a)*(<span class="hljs-number">1</span>-<span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">1</span>-percent,<span class="hljs-number">2</span>));                     },
<span class="hljs-attr">easeInOut</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b,percent</span>) </span>{ <span class="hljs-keyword">return</span> a + (b-a)*((-<span class="hljs-built_in">Math</span>.cos(percent*<span class="hljs-built_in">Math</span>.PI)/<span class="hljs-number">2</span>) + <span class="hljs-number">0.5</span>);        },</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, sekarang, dengan mempertimbangkan fungsi menambahkan satu segmen ke geometri ...</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSegment</span>(<span class="hljs-params">curve</span>) </span>{
  <span class="hljs-keyword">var</span> n = segments.length;<font></font>
  segments.push({<font></font>
     <span class="hljs-attr">index</span>: n,
        <span class="hljs-attr">p1</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">z</span>:  n   *segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
        <span class="hljs-attr">p2</span>: { <span class="hljs-attr">world</span>: { <span class="hljs-attr">z</span>: (n+<span class="hljs-number">1</span>)*segmentLength }, <span class="hljs-attr">camera</span>: {}, <span class="hljs-attr">screen</span>: {} },
     <span class="hljs-attr">curve</span>: curve,
     <span class="hljs-attr">color</span>: <span class="hljs-built_in">Math</span>.floor(n/rumbleLength)%<span class="hljs-number">2</span> ? COLORS.DARK : COLORS.LIGHT<font></font>
  });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kita dapat membuat metode untuk entri halus, menemukan dan keluar mulus dari jalan melengkung:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRoad</span>(<span class="hljs-params">enter, hold, leave, curve</span>) </span>{
  <span class="hljs-keyword">var</span> n;
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; enter ; n++)<font></font>
    addSegment(Util.easeIn(<span class="hljs-number">0</span>, curve, n/enter));
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; hold  ; n++)<font></font>
    addSegment(curve);<font></font>
  <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; leave ; n++)<font></font>
    addSegment(Util.easeInOut(curve, <span class="hljs-number">0</span>, n/leave));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... dan di atas Anda dapat menerapkan geometri tambahan, misalnya, kurva berbentuk S:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSCurves</span>(<span class="hljs-params"></span>) </span>{<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,  -ROAD.CURVE.EASY);<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,   ROAD.CURVE.MEDIUM);<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,   ROAD.CURVE.EASY);<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,  -ROAD.CURVE.EASY);<font></font>
  addRoad(ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM, ROAD.LENGTH.MEDIUM,  -ROAD.CURVE.MEDIUM);<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perubahan ke metode pembaruan ()</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu-satunya perubahan yang perlu dilakukan untuk metode </font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini adalah penerapan semacam gaya sentrifugal ketika mesin bergerak sepanjang kurva. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menetapkan faktor sewenang-wenang yang dapat disesuaikan menurut preferensi kami.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> centrifugal = <span class="hljs-number">0.3</span>;   <span class="hljs-comment">// centrifugal force multiplier when going around curves</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kemudian kita hanya akan memperbarui posisi </font></font><code>playerX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berdasarkan kecepatannya saat ini, nilai kurva dan pengganda gaya sentrifugal:</font></font><br>
<br>
<pre><code class="javascript hljs">playerX = playerX - (dx * speedPercent * playerSegment.curve * centrifugal);</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render kurva</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mengatakan di atas bahwa Anda dapat membuat kurva simulasi dengan menggeser nilai yang </font></font><code>cameraX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">digunakan dalam perhitungan proyeksi selama pelaksanaan </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setiap ruas jalan.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8a/569/19e/c8a56919e67d6f19cc737074ce92fffb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, kami akan menyimpan variabel drive </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , meningkat untuk setiap segmen dengan suatu nilai </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, serta variabel </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang akan digunakan sebagai offset dari nilai yang </font></font><code>cameraX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">digunakan dalam perhitungan proyeksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menerapkan kurva, kita perlu yang berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggeser </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proyeksi </font><font style="vertical-align: inherit;">setiap segmen dengan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggeser </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p2</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proyeksi </font><font style="vertical-align: inherit;">masing </font><strong><font style="vertical-align: inherit;">-</font></strong><font style="vertical-align: inherit;"> masing segmen dengan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font></strong></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tingkatkan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk segmen berikutnya dengan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font></strong></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, untuk menghindari transisi yang sobek ketika melintasi batas segmen, kita harus membuat </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diinisialisasi dengan nilai interpolasi dari kurva segmen dasar saat ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubah metode </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebagai berikut:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> baseSegment = findSegment(position);
<span class="hljs-keyword">var</span> basePercent = Util.percentRemaining(position, segmentLength);
<span class="hljs-keyword">var</span> dx = - (baseSegment.curve * basePercent);
<span class="hljs-keyword">var</span> x  = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span> ; n &lt; drawDistance ; n++) {<font></font>
<font></font>
  ...<font></font>
<font></font>
  Util.project(segment.p1, (playerX * roadWidth) - x,      cameraHeight, position - (segment.looped ? trackLength : <span class="hljs-number">0</span>), cameraDepth, width, height, roadWidth);<font></font>
  Util.project(segment.p2, (playerX * roadWidth) - x - dx, cameraHeight, position - (segment.looped ? trackLength : <span class="hljs-number">0</span>), cameraDepth, width, height, roadWidth);<font></font>
<font></font>
  x  = x + dx;<font></font>
  dx = dx + segment.curve;<font></font>
<font></font>
  ...<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Latar Belakang Menggulir Parallax</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, kita perlu menggulung lapisan latar belakang paralaks, menyimpan offset untuk setiap lapisan ...</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> skySpeed    = <span class="hljs-number">0.001</span>; <span class="hljs-comment">// background sky layer scroll speed when going around curve (or up hill)</span>
<span class="hljs-keyword">var</span> hillSpeed   = <span class="hljs-number">0.002</span>; <span class="hljs-comment">// background hill layer scroll speed when going around curve (or up hill)</span>
<span class="hljs-keyword">var</span> treeSpeed   = <span class="hljs-number">0.003</span>; <span class="hljs-comment">// background tree layer scroll speed when going around curve (or up hill)</span>
<span class="hljs-keyword">var</span> skyOffset   = <span class="hljs-number">0</span>;     <span class="hljs-comment">// current sky scroll offset</span>
<span class="hljs-keyword">var</span> hillOffset  = <span class="hljs-number">0</span>;     <span class="hljs-comment">// current hill scroll offset</span>
<span class="hljs-keyword">var</span> treeOffset  = <span class="hljs-number">0</span>;     <span class="hljs-comment">// current tree scroll offset</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... dan meningkatkannya selama waktu </font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tergantung pada nilai kurva dari segmen pemain saat ini dan kecepatannya ...</font></font><br>
<br>
<pre><code class="javascript hljs">skyOffset  = Util.increase(skyOffset,  skySpeed  * playerSegment.curve * speedPercent, <span class="hljs-number">1</span>);<font></font>
hillOffset = Util.increase(hillOffset, hillSpeed * playerSegment.curve * speedPercent, <span class="hljs-number">1</span>);<font></font>
treeOffset = Util.increase(treeOffset, treeSpeed * playerSegment.curve * speedPercent, <span class="hljs-number">1</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... dan kemudian gunakan untuk menggunakan offset ini saat melakukan </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lapisan latar belakang.</font></font><br>
<br>
<pre><code class="javascript hljs">Render.background(ctx, background, width, height, BACKGROUND.SKY,   skyOffset);<font></font>
Render.background(ctx, background, width, height, BACKGROUND.HILLS, hillOffset);<font></font>
Render.background(ctx, background, width, height, BACKGROUND.TREES, treeOffset);</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, di sini kita dapatkan kurva pseudo-tiga dimensi palsu:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98f/c3d/6d1/98fc3d6d13cc16f12847d253e112fcb2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian utama dari kode yang kami tambahkan adalah untuk membangun geometri jalan dengan nilai yang sesuai </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Menyadari itu, menambahkan gaya sentrifugal selama ini </font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jauh lebih mudah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Render kurva dilakukan hanya dalam beberapa baris kode, tetapi mungkin sulit untuk memahami (dan menjelaskan) apa sebenarnya yang terjadi di sini. Ada banyak cara untuk mensimulasikan kurva dan sangat mudah untuk berkeliaran ketika mereka diterapkan ke jalan buntu. Bahkan lebih mudah terbawa dengan tugas luar dan mencoba melakukan segala sesuatu "dengan benar"; sebelum Anda menyadarinya, Anda akan mulai membuat sistem 3d yang berfungsi penuh dengan matriks, rotasi, dan 3d-geometri nyata ... yang, seperti yang saya katakan, bukan tugas kami.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika saya menulis artikel ini, saya yakin pasti ada masalah dalam implementasi kurva saya. </font><font style="vertical-align: inherit;">Mencoba memvisualisasikan algoritme, saya tidak mengerti mengapa saya membutuhkan dua nilai drive </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> daripada satu ... dan jika saya tidak dapat sepenuhnya menjelaskan sesuatu, maka ada sesuatu yang salah di suatu tempat ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... tetapi waktu proyek </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"menyala" akhir pekan ‚Äù</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hampir kedaluwarsa, dan, sejujurnya, kurva menurut saya cukup indah, dan pada akhirnya, ini yang paling penting.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499240/index.html">Melalui duri ke bintang-bintang, atau analisis data dalam urusan surga</a></li>
<li><a href="../id499242/index.html">Para peneliti mengirim data dari PC desktop melalui getaran di atas meja</a></li>
<li><a href="../id499244/index.html">Organisasi sinergis. Bagian II</a></li>
<li><a href="../id499246/index.html">Investigasi fungsi logistik sebagai hukum pengembangan industri</a></li>
<li><a href="../id499248/index.html">Bagaimana kami mengenali alat pelindung diri</a></li>
<li><a href="../id499254/index.html">PyConRu 2020 Anggota Komite Program Menjawab Pertanyaan Tentang Python</a></li>
<li><a href="../id499262/index.html">Hackathon online final untuk SMZhack wiraswasta: proyek yang akan menghantam masyarakat</a></li>
<li><a href="../id499268/index.html">Kesadaran spasial: apa yang bisa dilakukan kacamata Hololens?</a></li>
<li><a href="../id499272/index.html">–ü–∞–π–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ 0201. –°–ª–∞–±–æ–Ω–µ—Ä–≤–Ω—ã—Ö –ø—Ä–æ—Å—å–±–∞ —É–¥–∞–ª–∏—Ç—å—Å—è –æ—Ç —ç–∫—Ä–∞–Ω–æ–≤</a></li>
<li><a href="../id499274/index.html">Kami membongkar Kapsul baru. Kami tahu berapa banyak mikrofon dan cara kerjanya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>