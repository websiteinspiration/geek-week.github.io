<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🔧 📧 ▫️ Eine Einführung in TLS für Patrik Patrick (Teil 1) 👩‍🎨 🤷🏼 🤾🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie Sie vielleicht bereits wissen, ist dies Patrick. Er ist ein Seestern, was bedeutet, dass man ohne Beleidigung sagen kann, dass seine Hände von ein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Eine Einführung in TLS für Patrik Patrick (Teil 1)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plesk/blog/502604/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie vielleicht bereits wissen, ist dies Patrick. Er ist ein Seestern, was bedeutet, dass man ohne Beleidigung sagen kann, dass seine Hände von einem Ort aus wachsen. Patrick ist auch sehr praktisch und vergisst sofort alles, was er nicht braucht - aber wenn er etwas braucht, will er es wissen (weil er es braucht!). Spoiler: Hier versucht Patrick einen TLS Handshake zu machen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/di/aa/64/diaa64cwcj8dktjvcv-4ba6wtbg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel ist für Patrick und Leute wie ihn geschrieben. Sie wurde aus einer Präsentation geboren, die erstmals auf unserem internen Plesk TechTalk gezeigt wurde, wo Mitarbeiter in zugänglicher Form Informationen über interessante Technologien, Prozesse und Lösungen miteinander austauschen. Daher sehen die Bilder in diesem Artikel wie Folien aus :) Der Autor des Originaltextes des Berichts ist Programmmanager Plesk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruslan Kosolapov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Regel deckt das gesamte TLS-Material einen kleinen Aspekt ab, nicht jedoch das Gesamtbild. </font><font style="vertical-align: inherit;">Das ist nicht sehr praktisch und Patrick hat Kopfschmerzen. </font><font style="vertical-align: inherit;">Hier wird alles anders sein: kurz, anwendbar „im Alltag“ und so umfassend wie möglich.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist TLS und warum ist es für Patrick?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TLS (Transport Layer Security) ist ein Transportschicht-Schutzprotokoll. Es wird benötigt, damit niemand auf Sie "hören" und wichtige Informationen herausfinden kann (meistens Passwörter, wenn wir über die Arbeit im Netzwerk sprechen). Und auch, um sich während der Übertragung vor Fälschungen und Verkehrsänderungen zu schützen. In diesen beiden Dingen liegt der Zweck von TLS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten wir aus Gründen der Klarheit den TLS-Handshake als einen Anruf bei Patrick SpongeBob. Während eines Anrufs kann jemand das Gespräch belauschen (neben Patrick stehen oder sich in der Mitte der Leitung einschalten), und im Allgemeinen befindet sich der SpongeBob möglicherweise nicht am anderen Ende - all diese Probleme sind relevant. Und um sie zu lösen, möchte Patrick TLS verwenden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz gesagt, der Handshake der obersten Ebene sieht folgendermaßen aus: </font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patrick:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ich möchte TLS verwenden, die Chiffrierversionen sind so und so.</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpongeBob:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ok, lass uns solche und solche Chiffrierversionen verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach sendet SpongeBob das Zertifikat, Patrick überprüft es und sagt, dass alles in Ordnung ist. Der Sitzungsschlüssel ist fertig (es gibt tatsächlich zwei davon, aber das spielt keine Rolle). Warum einen Sitzungsschlüssel anstelle einer asymmetrischen Verschlüsselung verwenden - weil er schneller ist? Danach beginnen sie eine Sprache zu sprechen, die für die Entschlüsselung unverständlich ist. Somit ist alles geschützt. </font></font><br>
<img src="https://habrastorage.org/webt/na/xj/yu/naxjyufzfjvlcazi16qsmlf5muq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles scheint einfach zu sein. Wie es auf Hardware funktioniert, ist für uns nicht so wichtig. Aber wenn Sie anfangen zu denken - und Patrick beginnt zu denken! - das wirft die Frage auf, wie man allgemein zustimmt, dass wir TLS verwenden werden? Immerhin gab es einmal kein TLS, aber nur gewöhnliche Protokolle - SMTP, HTTP. Wie kann man sagen, was auf TLS benötigt wird? Und hier in unserer Branche ist alles wie gewohnt - es gibt viele Möglichkeiten!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst wollten sie einen bestimmten Port verwenden, was die Verwendung von TLS implizieren würde. </font><font style="vertical-align: inherit;">Was sind die Nachteile davon? </font><font style="vertical-align: inherit;">Und warum erschien dann die explizite (explizite) Methode zum Starten einer TLS-Sitzung? </font><font style="vertical-align: inherit;">Es gibt verschiedene Gründe:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie benötigen viele Ports - und Ports sind so etwas, das Sie nicht ausgeben möchten. </font><font style="vertical-align: inherit;">Denn je mehr es gibt, desto schwieriger ist es, die Firewall zu konfigurieren.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Server kann dies ignorieren - er hat eine Verbindung zu Port 443 hergestellt und es gibt dort kein TLS, nur HTTP ohne HTTPS.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bevor die Verbindung hergestellt wird, können Sie nicht herausfinden, ob der TLS-Server unterstützt wird oder nicht.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All dies führte zur Entstehung einer expliziten Methode - wenn wir eine Verbindung zu einem regulären Port herstellen und dann unsere Sitzung auf TLS aktualisieren. </font><font style="vertical-align: inherit;">Für verschiedene Dienste verfügt das Protokoll über unterschiedliche Befehle. Für SMTP gibt es beispielsweise einen separaten Befehl auf der Ebene des SMTP-Protokolls - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STARTTLS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">HTTP hat auch einen solchen Witz, es heißt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upgrade: TLS / 1.0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Auf Protokollebene ist es einfacher zu verstehen, ob ein TLS-Server unterstützt wird oder nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns etwas näher auf die verschiedenen Arten von Verbindungen eingehen und wie die Dinge mit TLS für sie sind.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbinden: HTTP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles wäre einfach, wenn es wie immer keine Nuancen gäbe. Im Fall von HTTP bieten die wachsenden Sicherheitsanforderungen eine ständige Weiterentwicklung des Arbeitsprozesses mit TLS. Zuerst gab es eine Umleitung zu HTTPS, und dies wurde einfach im Header durchgeführt. Dies hinterließ eine Lücke für Sicherheitslücken, sodass Google-Kollegen HSTS (HTTP Strict Transport Security) entwickelten. Dies ist ein solcher Header in der HTTP-Antwort, der dem Browser mitteilt: "Bitte denken Sie daran, dass Sie, wenn Sie zu dieser Domain kommen, direkt zu HTTPS wechseln, auch wenn die Person Sie aufgefordert hat, zu HTTP zu wechseln." Somit gibt es keine Weiterleitung und alles geschieht viel sicherer. Darüber hinaus hat Google eine weitere Initiative: Sie können eine Anfrage hinterlassen, damit Ihre Website unabhängig von Überschriften zur Liste für Google Chrome "Immer HTTPS verwenden" hinzugefügt wird. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HSTS behebt die Umleitung von HTTP- zu HTTPS-Schwachstellen, sodass fast alle Browser HSTS unterstützen, was gut ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connect: exotisch (neue Versionen von HTTP und nicht nur)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In HTTP / 2 läuft TLS gut: Es wird immer verwendet (da jetzt Browser erstellt werden). </font><font style="vertical-align: inherit;">Darüber hinaus muss TLS in HTTP / 2 frisch sein, dh Version 1.2+ haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Höchstwahrscheinlich wird Google sehr bald die weit verbreitete Verwendung von HTTP / 3 verkaufen, jetzt wird es vom IANA-Standard übernommen. </font><font style="vertical-align: inherit;">Die Geschichte seines Auftretens und seiner Entwicklung ist ziemlich verwirrend; </font><font style="vertical-align: inherit;">Die Hauptsache, an die man sich erinnern sollte Patrick:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HTTP / 3 ist immer TLS 1.3+.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 3 basiert auf QUIC - es ist ein solches Protokoll über UDP, das laut Google besser ist als TCP. </font><font style="vertical-align: inherit;">Bevor der Name HTTP / 3 endgültig genehmigt wurde, hieß das Protokoll HTTP-over-QUIC.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt noch ein interessantes SCTP-Protokoll, das hauptsächlich in der Telekommunikation verwendet wird. </font><font style="vertical-align: inherit;">Darüber werden sowohl TLS als auch DTLS verwendet (dies ist ein solches TLS für UDP). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz gesagt:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In 2 Jahren wird QUIC (d. H. HTTP / 3) überall verwendet, aber jetzt sollte es bereits überall HTTP / 2 geben, aber in Wirklichkeit ist es nicht überall.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbinden: Mail</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viele Clients glauben, dass es TLS am 587. Port geben sollte, aber hier gibt es auch Nuancen: Jemand erwartet standardmäßig TLS und jemand erwartet eine explizite </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STARTTLS-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anforderung </font><font style="vertical-align: inherit;">vom Client. Aus diesem Grund verursachen verschiedene Kombinationen von Mailserver und Mailclient manchmal unerwünschte Effekte. Beispielsweise tritt ein Client in Port 587 ein und erwartet, dass TLS vorhanden sein wird, während der Server darauf wartet, dass der Client </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STARTTLS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> explizit anfordert </font><font style="vertical-align: inherit;">. Nachdem der Client nichts erhalten hat, kehrt er zu Port 25 zurück. Das Ergebnis ist ein stiller Wechsel zu einer unsicheren SMTP-Verbindung. Beim Testen und Entwickeln sollten Sie sich an solche Auswirkungen von Client-Server-Kombinationen erinnern. Autodiscaver bietet verschiedene Optionen zum Festlegen von TLS: wie es sein soll, was erwartet wird und was zu tun ist. Viele Mail-Clients verstehen diese Dinge. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mit der TLS-Unterstützung in Mailservern und Mailclients ist im Allgemeinen alles in Ordnung. In besonderen Fällen kann es jedoch zu Problemen kommen, und TLS-Erweiterungen werden nicht sehr gut unterstützt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbinden: FTP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier kann wenig gesagt werden. </font><font style="vertical-align: inherit;">Das Hauptproblem ist SNI (dies ist, wenn sich verschiedene Domänen auf derselben IP befinden). </font><font style="vertical-align: inherit;">Auf FTP-Ebene wird der Domainname nicht übertragen. </font><font style="vertical-align: inherit;">In einer expliziten Version kann es nicht funktionieren, da es keinen Ort gibt, an dem es geschrieben werden kann. </font><font style="vertical-align: inherit;">Es gibt verschiedene Lösungsoptionen - einige bieten an, andere bieten eine allgemeine Lösung an, es gibt noch keinen Standard. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz gesagt: Es</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt eine Art TLS-Unterstützung für FTP (FTPS, SFTP - ein Analogon von FTP, das über SSH implementiert wird), aber einige Aspekte werden aufgrund der technischen Einschränkungen von FTP selbst nicht behandelt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS Handshake</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt wissen wir also, wie man die Kommunikation mit TLS in verschiedenen Verbindungen initiiert, und Patrick konnte SpongeBob seinen Wunsch mitteilen. </font><font style="vertical-align: inherit;">Sobald sie vereinbart haben, TLS zu verwenden, wird TLS Handshake erstellt. </font><font style="vertical-align: inherit;">Das Ergebnis sollte eine Vereinbarung zwischen Client und Server darüber sein, wie sie alles verschlüsseln. </font><font style="vertical-align: inherit;">Darüber hinaus muss der Client sicherstellen, dass der Server derjenige ist, der benötigt wird. </font><font style="vertical-align: inherit;">Manchmal überprüft der Server auch den Client (aber viel seltener).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chiffren und Versionen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bereits erwähnt, besteht der erste Schritt darin, auszuwählen, welche TLS-Version und welche Chiffren für die Verschlüsselung verwendet werden. </font><font style="vertical-align: inherit;">In der Regel sieht die Verschlüsselung folgendermaßen aus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7j/bc/ne/7jbcnel13ieehyi6h6ibu9gi7r4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verschlüsselungssuite befindet sich in der IANA-Registrierung, und im TLS-Protokoll in binärer Form ist nur die ID angegeben. </font><font style="vertical-align: inherit;">Wie Sie in der Abbildung sehen können, ist hier nicht nur (und nicht nur) die Chiffre, sondern auch deren Betriebsmodus und andere Details, die für den TLS-Handshake erforderlich sind. </font><font style="vertical-align: inherit;">Patrick muss nicht auf Details eingehen. </font><font style="vertical-align: inherit;">In diesem Stadium ist es nur wichtig, sich daran zu erinnern, dass diese Buchstaben gut (und der Rest schlecht) sind:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DHE</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ECDhe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AES128</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AES256</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RSA</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ecdsa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cbc</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gcm</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA256</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA383</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CHACHA20</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> POLY1308</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bild zum Erinnern an gute Chiffren: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5o/oz/us/5oozuswdmgo1dmropfliew8ee3w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn es schwer zu merken ist, gibt es gute Dienste, die Ihnen davon erzählen können, zum Beispiel einen Dienst von Mozilla </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssl-config.mozilla.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/im/06/g0/im06g0jqgsdkw3kbie0c3lzfjcq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können sofort sehen, wo und wie es unterstützt wird - dem versuchen die Mozilla-Leute zu folgen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein interessantes Detail: Der Client überträgt die Chiffren in der Reihenfolge ihrer Priorität gemäß ihren Präferenzen, aber der Server hat die Entscheidung - er wählt die Chiffre aus der Liste der unterstützten Clients aus, die am besten zu sein scheint. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beide Seiten geben auch die maximal unterstützte Version des Protokolls an - in diesem Fall ist Patrick weiter fortgeschritten als SpongeBob.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eigentlich Zertifikat</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusammen mit der Antwort „Lass es uns so machen“ sendet der Server sein Zertifikat oder seine Zertifikate - es kann viele davon geben. </font></font><br>
<img src="https://habrastorage.org/webt/ay/9m/p-/ay9mp-c7akdltxlnomatwwq1zdq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist ein Zertifikat? Dies ist eine Beziehung zwischen Informationen (Betreff) - meistens der Name einer Domain oder Organisation - und einem öffentlichen Schlüssel (öffentlicher Schlüssel). Das heißt, auf dem Zertifikat steht: „Alter, mein öffentlicher Schlüssel ist so. Jetzt werden wir uns mit seiner Hilfe auf Sitzungsschlüssel einigen. “ Mit seiner Hilfe können Sie auch die Signatur von Zertifikaten oder etwas anderem überprüfen. Das heißt, es wäre grundsätzlich möglich, keine Zertifikate zu verwenden, sondern Register, in denen diese Beziehung angegeben ist. Tatsächlich werden die Schritte in diese Richtung fortgesetzt, da der Mechanismus der Zertifizierungsstelle als nicht sehr gut angesehen wird und es einfach nichts anderes gibt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somit ist das Zertifikat die Struktur von 'Betreff: Öffentlicher Schlüssel' plus der Unterschrift des Ishyuers (Aussteller bei der Transliteration ins Russische sieht schrecklich aus, aber das engste Synonym hier ist im Zusammenhang mit dem "Aussteller" nicht sehr nah), dass dieses Zertifikat ausgestellt wurde. Ishüyer hat auch ein Zertifikat und jemandes Verbindung zu etwas. Sie können das Zertifikat auf Richtigkeit überprüfen, indem Sie den öffentlichen Schlüssel des Ishyuere nehmen und die Signatur überprüfen. Infolgedessen kann hier nichts gefälscht werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns das Zertifikat durchgehen und sehen, welche Probleme es haben könnte. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/14/gt/ox/14gtoxx4czgwthkckj2vjyjfnbi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstens impliziert die Seriennummer die Eindeutigkeit nur innerhalb der Grenzen des Ishyuere, obwohl einige Software der Ansicht ist, dass sie im gesamten Universum einzigartig ist. Glücklicherweise ist es meistens wirklich einzigartig.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Zertifikat gibt auch an, welche Algorithmen für die Verschlüsselung und Signatur verwendet werden: RSA oder ECDSA - dh welche Kryptografie für die Arbeit mit diesem öffentlichen Schlüssel verwendet werden soll. Der Hauptunterschied zwischen RSA und ECDSA besteht darin, dass das mathematische Prinzip von ECDSA auf elliptischen Kurven basiert und RSA einfach aus natürlichen Zahlen besteht. Daher ist es langsamer und es werden große Schlüssel (3-4 Tausend) verwendet, um zu verhindern, dass es Risse bekommt. . Und für ECDSA reicht ein 300-Bit-Schlüssel aus und es funktioniert schneller. Daher wechseln viele zu ECDSA - der Handschlag selbst ist schwer und ich möchte ihn reduzieren. ECDSA kann bei der Ausstellung eines Zertifikats angefordert werden. Wenn der Prospektor es unterstützt, wird er es für Sie tun. Die Signatur des Zertifikats hängt jedoch davon ab, welchen privaten Schlüssel ishuiur derzeit hat und nicht davon, ob Sie nach ECDSA oder RSA gefragt haben.Daher können Browser anzeigen, dass sich einer in der Signatur und der andere im öffentlichen Schlüssel befindet, und es besteht kein Grund zur Angst, wenn die Signatur nicht ECDSA ist.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie bekomme ich ein Zertifikat?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz gesagt: </font></font><br>
<img src="https://habrastorage.org/webt/th/7f/f1/th7ff1g-1g54v0t-_genzf3rc3u.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patrick sagt der Zertifizierungsstelle: Ich brauche ein Zertifikat. </font><font style="vertical-align: inherit;">Diese Person (oder Organisation) prüft, ob es Patrick ist. </font><font style="vertical-align: inherit;">Schecks können sehr unterschiedlich sein. </font><font style="vertical-align: inherit;">Natürlich hat Patrick als Client möglicherweise kein Zertifikat, aber wenn der Server kein Zertifikat hat, gibt es kein TLS. </font><font style="vertical-align: inherit;">Es wird geprüft, ob im Zertifikatantrag alles korrekt angegeben ist, ob Patrick wirklich den Betreff besitzt, für den er ein Zertifikat anfordert. </font><font style="vertical-align: inherit;">Dies wird von höheren Zertifizierungsstellen durchgeführt - von bedingten Personen, an die jeder glaubt. </font><font style="vertical-align: inherit;">Um ein Zertifikat auszustellen, müssen Sie eine CSR (Certificate Signing Request, eine Anfrage für ein Zertifikat) erstellen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z1/mi/dk/z1midktpy8soeqqaz_xah-w0sn8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist auch eine Struktur, mit der es ziemlich schwierig ist, zu arbeiten, da es nur wenige Dienste gibt, mit denen Sie alles festlegen, angeben, überprüfen und anzeigen können. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insgesamt generieren wir ein Paar öffentlicher Schlüssel: private Schlüssel, aber wir geben nur die öffentlichen und verbergen die privaten. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschließend generieren wir eine Zertifikatsignierungsanforderung und signieren sie mit unserem privaten Schlüssel. </font><font style="vertical-align: inherit;">Wir senden dies alles an die Zertifizierungsstelle und sie startet die Überprüfung. </font><font style="vertical-align: inherit;">Es kann anders sein, für besonders coole Zertifikate gibt es spezielle knifflige Verfahren, aber wir werden uns mit dem allgemeinen Fall befassen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAA RR</font></font></h2><br>
<img src="https://habrastorage.org/webt/pg/rh/lw/pgrhlwwd8la4_perxzg4zawlyjy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt ein solches Problem, dass Menschen, von denen jeder glaubt, dass sie manchmal nicht sehr gut sind. Einer der Gründe, warum Symantec Teil von DigiCert geworden ist, ist, dass Symantec Zertifikate ausgestellt hat, ohne die Domaininhaber zu fragen. Sie können dies nicht tun, es war eine Beleidigung für alle, vor allem aber für Symantec selbst, weil Sie Ihr Unternehmen verkaufen mussten. Um den Server weniger abhängig von solchen skrupellosen Kameraden zu machen, gibt es so etwas wie CAA RR - einen Eintrag in DNS, der angibt, wer der Eigentümer zulässt, Zertifikate für seine Domain auszustellen. Diese Funktion ist auch in Plesk verfügbar. Sie wird bisher nur wenig verwendet, ungefähr wie DNSSec, aber dennoch. Alle Zertifizierungsstellen haben zugestimmt, diesen Eintrag zu überprüfen. Wenn angegeben wird, dass diese Zertifizierungsstelle nicht ausgestellt werden kann, heißt es: "Sie haben die Validierung nicht bestanden, sie ist in CAA RR geschrieben."dass ich kein Zertifikat für Sie ausschreiben kann “- und es nicht ausschreiben wird. Wenn es keinen Eintrag gibt, können Sie. Jetzt drängt Google auf die Initiative, damit Kunden das erhaltene Zertifikat auf Übereinstimmung mit CAA RR-Datensätzen überprüfen. Die Debatte dauert noch an.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem wurde CAA RR von dem Moment an, als wir die Unterstützung in Plesk vorgenommen haben, erweitert, indem Validierungsmethoden (dh Sie können hier auch angeben, mit welcher Methode Sie überprüfen, ob diese Domain Ihnen gehört) und Konto-URI (Uniform Resource Identifier) ​​angegeben wurden. </font><font style="vertical-align: inherit;">Beliebt bei Benutzern Plesk Let's Encrypt unterstützt dies bereits (gut gemacht!). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All dies funktioniert für jede Art von Zertifikat, und da wir später über die Unterschiede sprechen werden, ist es Zeit, die Typen genauer zu besprechen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zertifikatstypen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt drei davon:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain-Validierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Thema ist eine Domain, das heißt, hier überprüfen wir nur es. </font><font style="vertical-align: inherit;">Früher, als es keine automatischen Validatoren gab, erfolgte die Validierung hauptsächlich per E-Mail über den Whois-Dienst. </font><font style="vertical-align: inherit;">Dies wurde als ausreichender Grund für die Annahme angesehen, dass Sie der Eigentümer dieser Domain sind. </font><font style="vertical-align: inherit;">Dann haben sie sich überlegt, ob sie über DNS nachsehen sollen - sie haben Ihnen per E-Mail geschrieben: „und so und so einen Eintrag zu DNS hinzufügen“. </font><font style="vertical-align: inherit;">Später erschienen automatische Methoden (wir werden etwas weiter über ACME sprechen).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisationsvalidierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Feld "Betreff" wird neben dem Domainnamen auch der Name der Organisation angegeben. </font><font style="vertical-align: inherit;">Die Prüfung besteht darin, zu überprüfen, ob die Domain zu dieser Organisation gehört und ob die Person, die das Zertifikat erhalten hat, dort arbeitet. </font><font style="vertical-align: inherit;">Wie das gemacht wird: Sie suchen nach Organisationen in den Registern, rufen an, fordern etwas zu tun (das Telefon hat sich als richtig herausgestellt, die richtige Person hat geantwortet, was bedeutet, dass höchstwahrscheinlich alles in Ordnung ist).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweiterte Validierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie OV, nur kühler. Hier ist alles sehr geregelt - ein 40-seitiges Dokument im Sinne von "in Absatz 5.6.8 sollte wie folgt lauten: ..." usw. Viele Dinge werden überprüft - das Land, die Abteilung (falls im Antrag angegeben) und manchmal geht sogar eine besondere Person, um mit den Augen zu sehen. Was ist der praktische Unterschied? Fast alle Browser haben aufgehört, zwischen OV und DV zu unterscheiden, und dies ist schlecht, da in diesem Fall der Name der Organisation nicht angezeigt wird. Infolgedessen stört es niemanden, eine Domain aliepxress.ru zu erstellen, dieselbe Seite zu zeichnen und Kreditkarten zu stehlen. Und es ist absolut legitim, eine solche Domain zu erstellen und ein DV-Zertifikat darauf zu erhalten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispiel mit EV - der Name der Organisation ist hier sichtbar. Wenn also jemand etwas stiehlt, weiß der Benutzer, dass es sich um eine Valve Corp-Gesellschaft handelt, und die Registrierung der Organisation ist etwas schwieriger als die Domain (mehr Überprüfungen). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6p/kp/kc/6pkpkccn848gjwl1osfx_yc0gjy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles geht jedoch bis zu dem Punkt, an dem EV nicht mehr anders ist. Auf Mobilgeräten ist es nicht mehr sichtbar und Sie müssen eine separate Taste drücken, und dies auch in Safari. </font><font style="vertical-align: inherit;">Google Chrome hält noch (UPD - nicht mehr! Ich musste einen Bildschirm aus dem IE erstellen). </font><font style="vertical-align: inherit;">Die Argumentation derer, die nicht zeigen: "Wenn Sie besorgt sind, klicken und schauen", aber niemand drückt natürlich.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zertifikat erhalten: Automatisierung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns nun über den automatisierten Empfang von DV-Zertifikaten sprechen. </font><font style="vertical-align: inherit;">Lassen Sie uns der Klarheit halber sehen, wie unser Lieblings-Let's Encrypt das macht. </font><font style="vertical-align: inherit;">Er hat im Allgemeinen eine gute Dokumentation, wenn jemand interessiert ist, und sogar in Russisch.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GIPFEL</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ACME (Automatic Certificate Management Environment) ist ein Protokoll zur Automatisierung und Standardisierung des Prozesses zum Abrufen eines Zertifikats. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie beweist ACME, dass Sie Domaininhaber sind? </font><font style="vertical-align: inherit;">Sie sagen: Ich möchte ein Zertifikat und geben die Art der automatischen Validierung an - zum Beispiel ACME HTTP-01. </font><font style="vertical-align: inherit;">Let's Encrypt fordert Sie auf, die Daten in eine Datei einzufügen. Wenn Sie die Dateien in Ihre Domain einfügen könnten (und Let's Encrypt sie über HTTP von dort abholen könnte), sind Sie wahrscheinlich deren Eigentümer. </font><font style="vertical-align: inherit;">Jetzt wird dieser Ansatz kritisiert, auch von Google, weil er nicht vor Phishing schützt. </font><font style="vertical-align: inherit;">Das heißt, bei manueller Validierung wird die Domäne aliepxress.ru wahrscheinlich Verdacht erregen, aber Let's Encrypt selbst weiß bisher nicht, wie (oder kann es, aber schlecht).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS-Herausforderung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neben ACME gibt es auch eine DNS-Herausforderung. </font><font style="vertical-align: inherit;">Zum Beispiel sagen sie Ihnen: Geben Sie einen TXT-Eintrag in Ihre DNS-Zone ein und geben Sie die Daten ein. </font><font style="vertical-align: inherit;">Es gibt andere Wege, aber nicht üblich, und einer wurde insgesamt abgesagt, weil er sich als verletzlich herausstellte. </font><font style="vertical-align: inherit;">Was wir in Plesk haben: Platzhalterzertifikate (die nur mit der DNS-Herausforderung ausgeschrieben werden können) funktionieren für viele Menschen nicht, da Plesk die DNS-Zonen und die Erweiterung der Domain sehr oft nicht verwaltet. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's Encrypt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kann die Erstellung eines Eintrags in der DNS-Zone nicht automatisieren .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noch zwei Worte zu Let's Encrypt</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein wichtiger Aspekt bei der Arbeit mit Let's Encrypt-Zertifikaten sind Grenzwerte. </font><font style="vertical-align: inherit;">Im Zweifelsfall (oder im Verdacht, dass sie erreicht wurden) folgen Sie am besten dem Link: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">letsencrypt.org/docs/rate-limits</font></font></a><br>
<img src="https://habrastorage.org/webt/c0/lx/5g/c0lx5gabymsjx5fzdqfvn1lk-ku.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal werden sie aktualisiert. </font><font style="vertical-align: inherit;">Es gibt nicht offensichtliche Grenzen, die die Leute vergessen: Nach Supportanfragen sind sie meistens mit einer Grenze von 100 Domain-Namen im Zertifikat konfrontiert. </font><font style="vertical-align: inherit;">Let's Encrypt verfügt auch über einen Staging-Server und es gibt weitere Einschränkungen. Solche Zertifikate gelten jedoch als nicht vertrauenswürdig und ähneln für den Browser selbstsignierten Zertifikaten. </font><font style="vertical-align: inherit;">In der Praxis kommen sie mit einem Limit von 100 Namen selten zu uns (trotz der Tatsache, dass Websites auf Plesk insgesamt 1.300.000 Let's Encrypt-Zertifikate haben). </font><font style="vertical-align: inherit;">Der Median liegt laut Statistik bei 20 Namen pro Zertifikat. </font><font style="vertical-align: inherit;">Wenn also etwas nicht funktioniert, schauen Sie - vielleicht ist das Limit erreicht. </font><font style="vertical-align: inherit;">Let's Encrypt hat eine gute Fehlerberichterstattung, und Sie können normalerweise verstehen, was passiert ist.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was weiter?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem das Zertifikat empfangen wurde, überträgt der Server die Sitzungsschlüsseldaten - dies wird für die Verschlüsselung verwendet. </font><font style="vertical-align: inherit;">Wenn der Server der Ansicht ist, dass eine Authentifizierung des Clients erforderlich ist (der Zugriff steht beispielsweise nur einem bestimmten Personenkreis offen), kann er fragen: Der Client, wer sind Sie? </font><font style="vertical-align: inherit;">Und dann muss der Kunde sein Zertifikat senden. </font><font style="vertical-align: inherit;">Nach dem Empfang der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerHelloDone-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nachricht </font><font style="vertical-align: inherit;">erkennt </font><i><font style="vertical-align: inherit;">der</font></i><font style="vertical-align: inherit;"> Client, dass es Zeit ist, die Zertifikate zu überprüfen und mit den Schlüsseln zu arbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles, worüber wir gesprochen haben, bevor TLS 1.3 über einen offenen Kanal läuft, und jeder kann all diese Dinge sehen. </font><font style="vertical-align: inherit;">Es gibt mehrere interessante Angriffe, die Sie über sich selbst lesen können. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der zweiten </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reihe</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des Artikels erfahren Sie, wie der Client das Zertifikat überprüft.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de502588/index.html">Die unglaubliche Geschichte von PowerPoint</a></li>
<li><a href="../de502592/index.html">Neomorphismus mit SwiftUI. Teil 1</a></li>
<li><a href="../de502594/index.html">7 Gründe, warum Webprojekte nicht beendet werden und wie man damit umgeht</a></li>
<li><a href="../de502596/index.html">Kostenlose Quarantäne-Bildungskurse: Design</a></li>
<li><a href="../de502598/index.html">Sicherheitswoche 21: Sicherheitsanfälligkeit in Windows Print Service</a></li>
<li><a href="../de502608/index.html">Wie wir den Marktplatz für Anwendungen im SaaS-Dienst gestartet haben</a></li>
<li><a href="../de502614/index.html">Best Practices von Kubernetes. Abfragen und Ressourcenlimits festlegen</a></li>
<li><a href="../de502620/index.html">Geldbuchhaltung</a></li>
<li><a href="../de502624/index.html">Wie arbeiten sie auf Facebook? Werte und Einstellungen in einem Unternehmen</a></li>
<li><a href="../de502626/index.html">Automatische iOS-Screenshots mit XCTestplan und Xcode 11</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>