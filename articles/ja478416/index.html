<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎄 😩 ➰ マイクロサービスのサービスメッシュ。パートIII。Istioの詳細 🤳🏽 🎯 🐻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事の翻訳は、Kubernetesベースのインフラストラクチャプラットフォームコースの学生向けに特別に作成されました。
 
 
 
 これは、Kubernetesとサービスメッシュテクノロジー（「マイクロサービスネットワーク」および「マイクロサービスメッシュネットワーク」とも呼ばれます）に関する一連...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>マイクロサービスのサービスメッシュ。パートIII。Istioの詳細</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/478416/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の翻訳は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesベースのインフラストラクチャプラットフォーム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コースの学生向けに特別に作成されました</font><font style="vertical-align: inherit;">。</font></font></i><br>
<hr><br>
<img src="https://habrastorage.org/webt/r8/xf/fb/r8xffbeasanmwzua4h0okbollnq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、Kubernetesとサービスメッシュテクノロジー（「マイクロサービスネットワーク」および「マイクロサービスメッシュネットワーク」とも呼ばれます）に関する一連の出版物の3番目の記事です。では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の記事、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはIstioでの作業の基本を学び、このツールは設定や複雑なクラウド・アーキテクチャの管理に役立ちます方法を発見しました。したがって、その助けを借りて、マイクロサービスのメッシュネットワークを構成し、分散マイクロサービス環境でいくつかの集中化機能を利用できます。今日は、サービスメッシュテクノロジーの利点を理解するために、Istioの機能を詳しく見ていきます。</font></font><a name="habracut"></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Istio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は強力ですが、非常に洗練されたツールです。重い負荷を処理できるマイクロサービスのスケーラブルなメッシュネットワークを構築することは困難な場合があります。この記事を読んだ後は、メッシュネットワークの複雑さやメッシュネットワークを正しく構成するのに役立つツールについて理解を深めていただければ幸いです。ほとんどの場合、サイドカープロキシを手動で構成したり、ネットワークの相互作用を構成したりする必要はありませんが、これらの手順の実行方法を習得すれば、サービスメッシュのしくみを理解できます。これは非常に難しいトピックです。ツールの機能をより深く理解するほど、より良いものになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、今日は、Istioの4つの主要コンポーネントとその機能、すなわちトラフィック管理（Envoy）、コントロールプレーン（パイロット）、テレメトリコンポーネント（ミキサー）、およびセキュリティコンポーネント（シタデル）について詳しく説明します。</font><font style="vertical-align: inherit;">それらのそれぞれと、マイクロサービスのメッシュネットワークにおけるそれらの役割について、引き続き検討します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特使</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイドカープロキシについては</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Istioに関する最新の出版物で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すでに読んでいると思います。サイドカープロキシは</font><font style="vertical-align: inherit;">各サービス定義に追加され、サービス自体と同じサブミッションにデプロイされます。私たちにとって、Envoyとサイドカーという用語は実際には同義語ですが、サイドカープロキシはさまざまなプラグインで機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイドカープロキシ</font><font style="vertical-align: inherit;">は、定義した特定のサービスのトラフィックのメインネットワークゲートウェイとして</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">します。プロキシは、特定のサービスに向けられた着信トラフィックを受信し、一般的な構成で指定されたルールとポリシーに従ってルーティングします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのソースからの制御データを処理するには、サイドカープロキシが必要です。これらの1つ目は、ユーザー、つまりユーザーがメッシュネットワークに展開した構成です。負荷分散パラメーターの変更、新しいノード、サービス、ネットワークルーティングデータの追加など、その変更に関する情報は、アプリケーションの状態に関する主要な情報源として機能するPilotコンポーネントに送信されます。サイドカープロキシは定期的にパイロットをチェックし、最新の構成データを取得して、ローカルルールに必要な変更を加えます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wb/ge/w3/wbgew3hlepxlpg61enq6c2omy2a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
管理データの2番目のソースは、サイドカープロキシが接続されているアプリケーションです。 Envoyはロードバランサーとして機能し、それに接続されているインスタンスの状態を常に監視し、そのアクティビティを確認するリクエストを送信します。コンポーネントは、応答時間などの主要なインジケーターを監視し、要求が処理されていることを確認します。 Envoyはプールから不良インスタンスを削除するため、デプロイメントの破損やサーバーエラーによってサービス全体が失敗することはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイドカープロキシには他にどのような利点がありますか？ロードバランシングとインスタンスのステータスのチェックの組み込み機能に加えて、それらは、アプリケーションのアイデアを得ることができるようにトラフィックを構成することを可能にします。したがって、開発段階でコードを大幅に変更した新しいバージョンをテストしても、詳細な状況を把握できるとは限りません。このような場合、実際の状態での動作を観察するために、新しいコードを実行するインスタンスに少量の作業トラフィックを送信すると便利です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envoyでは、異なるバージョン間で負荷を分散する構成を作成できます。</font><font style="vertical-align: inherit;">たとえば、トラフィックの5％のみを新しいインスタンスにリダイレクトすることから始めることができます。</font><font style="vertical-align: inherit;">変更された構成データがPilotコンポーネントに転送されるとすぐに、サイドカープロキシの負荷分散が変更されます。</font><font style="vertical-align: inherit;">最初は、新しいサービスは少量のトラフィックを受け取り、実験データを収集して処理することができます。</font><font style="vertical-align: inherit;">その後、新しいバージョンが正しく機能していることを確認するまで、音量を5から100％に徐々に上げ、必要に応じて音量を下げます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイドカープロキシ構成</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この構成は実際にはどのように見えますか？</font><font style="vertical-align: inherit;">トラフィックをさまざまなターゲットの場所にリダイレクトするには、たとえば次のように、サービス構成で重みパラメータを設定する必要があります。</font></font><br>
<br>
<pre><code class="python hljs">apiVersion: networking.istio.io/v1alpha3<font></font>
kind: VirtualService<font></font>
metadata:<font></font>
   name: helloworld<font></font>
spec:<font></font>
   hosts:<font></font>
      - hello1<font></font>
   http:<font></font>
      - route:<font></font>
         - destination:<font></font>
            host: hello1<font></font>
            subset: v1<font></font>
            weight: <span class="hljs-number">75</span><font></font>
         - destination:<font></font>
            host: hello1<font></font>
            subset: v2<font></font>
            weight: <span class="hljs-number">25</span><font></font>
---<font></font>
apiVersion: networking.istio.io/v1alpha3<font></font>
kind: DestinationRule<font></font>
metadata:<font></font>
   name: helloworld<font></font>
spec:<font></font>
   host: hello1<font></font>
   subsets:<font></font>
      - name: v1<font></font>
      labels:<font></font>
         version: v1<font></font>
      - name: v2<font></font>
      labels:<font></font>
         version: v2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つのホストhello1があり、v1とv2の2つのバージョンのターゲットの場所があります。</font><font style="vertical-align: inherit;">まず、トラフィックの75％をv1に割り当て、残りの25％をv2に割り当てます。</font><font style="vertical-align: inherit;">構成を実装した後、事前定義された時間待機してステータスを確認し、パラメータを再度変更できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このように、Envoyは特定の対象場所に優れたトラフィック管理機能を提供します。</font><font style="vertical-align: inherit;">アプリケーションが機器に過負荷をかけるトラフィックスパイクを特徴とする場合は、パラメーターを使用して遅延を実装できます</font></font><code>fault</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">apiVersion: networking.istio.io/v1alpha3<font></font>
kind: VirtualService<font></font>
metadata:<font></font>
   name: helloworld<font></font>
spec:<font></font>
   hosts:<font></font>
      - hello1<font></font>
   http:<font></font>
      - fault:<font></font>
         delay:<font></font>
            percent: <span class="hljs-number">10</span>
            fixedDelay: <span class="hljs-number">3</span>s<font></font>
   route:<font></font>
      - destination:<font></font>
         host: hello1</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パイロット</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envoyと対話する主なコンポーネントは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、メッシュネットワーク内のすべてのEnvoyインスタンスを集中管理します。パイロットは、環境データの単一のソースとして機能します。これは、サービスとその相互作用に関するすべてのルールのローカルリポジトリです。また、実行された操作に関する情報も含まれています。パイロットはすべてのEnvoyプロキシの管理と構成を担当するため、Istioコントロールプレーンで識別されることがよくあります（ただし、技術的にはCitadelなどの他のコンポーネントもコントロールプレーンに属しています）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、パイロットはサービスメッシュのしくみを理解する上で重要な役割を果たします。しかし実際には、このコンポーネントに関連する操作のほとんどはEnvoyプロキシによって実行されます。彼らは定期的にPilotに問い合わせて最新の構成データを取得し、定期的に更新されます。メッシュネットワーク構成の変更には、コントロールプレーンとの対話が含まれます。このタスクの分離は、Istioの主要な原則です。EnvoyプロキシはPilotと対話して、アプリケーションを構成するサービスを作成します。サービスメッシュコンポーネント間の相互接続に関する知識は、このテクノロジーの本質を理解する上で重要な役割を果たします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の記事では、マイクロサービスネットワークの抽象化の利点について説明しました。これにより、高レベルのコマンドを使用してサービス間の相互作用を判別できます。</font><font style="vertical-align: inherit;">このテクノロジーは、これらのコマンドを、制御するサービスの正確な構成に変換します。</font><font style="vertical-align: inherit;">パイロットは、これらの主要な機能を担当するコンポーネントです。</font><font style="vertical-align: inherit;">入力として、サービス検出ルールを受け取り、Envoyプロキシ（またはEnvoy APIと互換性のある他のサイドカープロキシ）によって実行される特定のアクションを生成します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パイロットコンポーネントテストドライブ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メッシュネットワークのパイロットインスタンスの詳細を確認する最良の方法は、サイドカープロキシステータスデータを読み取ることです。</font><font style="vertical-align: inherit;">次のコマンドを実行すると、サービスのリストとそれらを制御するパイロットIDを取得できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">istioctl proxy-status</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスとその識別子のリストが、対応するパイロットIDと現在の同期ステータスとともに表示されます。</font><font style="vertical-align: inherit;">SyncedまたはSyncedステータス（100％）のサイドカープロキシが更新され、Pilotコンポーネントから最新の構成を受け取りました。</font><font style="vertical-align: inherit;">未送信のステータスは、設定が最近変更されていないため、同期するものがないことを意味します。</font><font style="vertical-align: inherit;">また、Staleステータスは、サイドカープロキシが変更に応答しないことを意味します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/vi/n0/chvin0y81flbaprnduncvwxkyki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同期で問題が発生した場合は、プロキシステータスコマンドで特定のサービスの識別子を指定し、パイロットとサイドカー間の同期エラーに関する情報を表示できます。</font><font style="vertical-align: inherit;">たとえば、上記のサービスのリストに識別子が含まれている</font></font><code>hello-world-v2–5aa3f7abd-ppz2n.default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、次のコマンドを実行できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">istioctl proxy-status hello-world-v2-686a3b641-4r52s.default</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
得られる出力は次のとおりです。</font></font><br>
<br>
<pre><code class="plaintext hljs">Clusters Match<font></font>
Listeners Match<font></font>
Routes Match (RDS last loaded at Fri, 24 May 2019 20:22:14 UTC)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロキシステータスコマンドの出力のタイプは、Istioのバージョンによって異なります（特に、バージョン1.0.5、1.1.2、および最新バージョン1.1.7）。</font><font style="vertical-align: inherit;">そのため、Istioの以前のバージョンでは、出力には完全なJSONオブジェクトが含まれていましたが、バージョン1.1.7以降では、上記のようになります。</font><font style="vertical-align: inherit;">他の出力形式が発生する場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パイロットは、設定変更と現在のサービスステータスのフォーマットされた違いを表示します。</font><font style="vertical-align: inherit;">そのため、サービスにまだ実装されておらず確認されていない変更を追跡できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミキサー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pilotと同様に、Mixerは</font><font style="vertical-align: inherit;">Istio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、トラフィックを処理してカスタムルールを適用します。主な違いは、ミキサーはメッシュネットワーク全体のレベルで動作し、グローバルルールを適用できることです。つまり、アプリケーション全体のテレメトリを収集したり、特定のサービスの使用に関するグローバルな制限を構成したりするために使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、EnvoyとMixerの動作がどのように異なるかを見てみましょう。サイドカープロキシという名前は、アプリケーションにデプロイされた各サービスにEnvoyが追加され、このサービスへのトラフィックで機能することを意味します。ミキサーはアプリケーション全体のレベルで機能し、環境全体に設定されたルールを適用します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/px/mq/sr/pxmqsrysspkooo8t64yhkr2qlni.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使い方？ルールは大きく異なります。タイムスタンプとIPアドレスを使用したリクエストの単純な登録から、より信頼性の高い保護のための複雑な割り当てとホワイトリストの適用まで。モノリシックアプリケーションに固有の集中化を提供するのはミキサーです。ユーザーがSaaSアプリケーションで送信するリクエストの数に基づいて課金を設定しませんか？これはミキサーを使用して行うことができます。ユーザーが機密情報にアクセスするたびに、外部サービスでイベントログを有効にする必要がありますか？再びミキサー。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコンポーネントのもう1つの便利な機能は、サードパーティのプラグインとの統合です。</font><font style="vertical-align: inherit;">一元化されたアプリケーション情報の主要なソースは、操作を視覚化したり、ログを表示したりするためのツールと互換性がある必要があります。</font><font style="vertical-align: inherit;">Mixerを使用すると、これらの機能をKubernetesに追加し、収集した情報を、多くの場合リアルタイムで便利に表示できます。</font><font style="vertical-align: inherit;">そのようなイベント監視プラットフォームの1つ（Prometheus）はすでに統合されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなツールはあなたの人生を大いに促進します。</font><font style="vertical-align: inherit;">Mixerは、以前はマイクロサービスのデプロイメントに利用できなかったメッシュデータを提供します。</font><font style="vertical-align: inherit;">また、彼らの活動に関する情報を個別に抽出することは容易ではないので、さまざまな専用ツールが役立ちます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミキサーの使用</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Istioには、デプロイの準備ができているいくつかのミキサーポリシーが付属しています。</font><font style="vertical-align: inherit;">テレメトリデータの収集を開始するには、YAMLファイルを構成とともに適用する必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">kubectl apply -f samples/bookinfo/telemetry/metrics.yaml</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、着信トラフィックが登録され、ミキサーの中央インスタンスに送信されます。</font><font style="vertical-align: inherit;">サービスがアクティブな場合は、すぐに結果が表示されます。</font><font style="vertical-align: inherit;">それ以外の場合は、人為的にトラフィックをサービスに転送できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Istioでログをクエリするための組み込みツールであるPrometheusは、トラフィックを表示する最も簡単な方法です。</font><font style="vertical-align: inherit;">Prometheusポート転送を構成します。</font></font><br>
<br>
<pre><code class="python hljs">kubectl -n istio-system port-forward $(kubectl -n istio-system get pod -l app=prometheus -o jsonpath=<span class="hljs-string">'{.items[0].metadata.name}'</span>) <span class="hljs-number">9090</span>:<span class="hljs-number">9090</span> &amp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、Prometheusはローカルコンピューターのポート9090を介して実行されます。この場所からログを要求できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5u/ej/hc/5uejhcx2jekjs4lfoc6y7-ktts8.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">城塞</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envoyによって提供されるスケーラビリティとMixerによって提供される広範な知識に加えて、クラウドメッシュアーキテクチャの利点の1つはセキュリティです。 Istioは、このために</font><font style="vertical-align: inherit;">主要なセキュリティコンポーネントである</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Citadelを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用します</font><font style="vertical-align: inherit;">。これは、最新のマイクロサービス展開に不可欠な部分である鍵と証明書の管理に役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロサービスのデプロイのセキュリティ管理は、サービスアーキテクチャに切り替えるときに簡単な作業ではありません。多くの個別の、絶えず変化する自己署名証明書（相互TLS認証を使用する場合）を管理するか、暗号化を拒否して、最善の結果を期待する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
城塞は仕事のかなりの部分を引き受けます。このコンポーネントは、サービス定義に基づいて自動的にキーを作成および保存し、組み込みのKubernetes秘密キー管理インフラストラクチャを使用してキーを管理します。 Citadelは常にKubernetesと対話することにより、各新しいサービスに証明書が割り当てられ、新しいEnvoyプロキシはそのような新しいサービスでデプロイされた証明書を信頼します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5a/bl/hk/5ablhkeg-2cjjb2d3j9ouoojtao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、TLS相互認証を使用しない理由はもはやありません。TLS相互認証は、現在、サービスアーキテクチャにとって最良のオプションと見なされています。各サービスは他のサービスとデータを交換するときにTLS確認を受信するため、攻撃者がネットワークトラフィックを表示できたとしても、データは暗号化され、確実に保護されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、自己署名証明書とTLS相互認証のサポートは、Citadelの機能のほんの一部です。</font><font style="vertical-align: inherit;">コンポーネントは、サードパーティの認証局と対話し、すでにそれらに基づくセキュリティ対策を実装している場合は、代替の証明書を使用できます。</font><font style="vertical-align: inherit;">また、TLS over HTTPSの相互認証など、必要に応じてより厳しいポリシーを適用することもできます。</font><font style="vertical-align: inherit;">ご覧のとおり、Citadelは非常に柔軟な保護オプションを提供しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シタデルの使用</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコンポーネントのセキュリティ機能はかなり複雑ですが、Citadelを使い始めるのは簡単です。</font><font style="vertical-align: inherit;">ミキサーと同様に、作業の大部分は自動的に行われます。</font><font style="vertical-align: inherit;">プロセスを開始するには、正しい構成をアクティブ化するだけで済みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、グローバル相互TLS認証を有効にするには、メッシュ認証ポリシーを変更する必要があります。</font><font style="vertical-align: inherit;">これは、次のコマンドを適用してkubectlを使用して実行できます。</font></font><br>
<br>
<pre><code class="python hljs">kubectl apply -f - &lt;&lt;EOF<font></font>
apiVersion: <span class="hljs-string">"authentication.istio.io/v1alpha1"</span>
kind: <span class="hljs-string">"MeshPolicy"</span><font></font>
metadata:<font></font>
   name: <span class="hljs-string">"default"</span><font></font>
spec:<font></font>
   peers:<font></font>
      - mtls: {}<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、それだけではありません。</font><font style="vertical-align: inherit;">サービスはTLSを使用して着信トラフィックを受け入れるコマンドを受け取りましたが、TLSを介して発信要求を送信するように構成されていないため、現在データ交換はできません。</font><font style="vertical-align: inherit;">発信要求にTLSを適用するには、ネットワーク相互作用のルールを構成します。</font></font><br>
<br>
<pre><code class="python hljs">kubectl apply -f - &lt;&lt;EOF<font></font>
apiVersion: <span class="hljs-string">"networking.istio.io/v1alpha3"</span>
kind: <span class="hljs-string">"DestinationRule"</span><font></font>
metadata:<font></font>
   name: <span class="hljs-string">"default"</span>
   namespace: <span class="hljs-string">"istio-system"</span><font></font>
spec:<font></font>
   host: <span class="hljs-string">"*.local"</span><font></font>
   trafficPolicy:<font></font>
      tls:<font></font>
         mode: ISTIO_MUTUAL<font></font>
EOF</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、サービスの動作を確認します。</font><font style="vertical-align: inherit;">これで彼らは互いにデータを交換できますが、暗号化されたトラフィックがこれに使用されます。</font><font style="vertical-align: inherit;">2つのコマンドだけで、トラフィックは適切に保護され、ネットワークは安全です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、Istioの機能と、それらが一般的なサービスメッシュの利点にどのように関連するかについて、より多くの知識が身に付きました。</font><font style="vertical-align: inherit;">タスクを明確に分散させることは、このツールの長所の1つです。</font><font style="vertical-align: inherit;">EnvoyサイドカープロキシやCitadelキー管理システムなどのすべてのコンポーネントは分離され、スタンドアロンです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらの機能の原理を研究することに時間を費やすことをお勧めします。</font><font style="vertical-align: inherit;">トライアルアプリケーションで1つまたは2つのコンポーネントを試してみるか、例の1つを試してください。</font><font style="vertical-align: inherit;">したがって、サービスメッシュテクノロジーの機能をよりよく理解できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、1人の開発者がIstioのすべてのニュアンスを理解することは困難です。</font><font style="vertical-align: inherit;">テクノロジーは常に進化しており、新しい機会が毎日追加され、古いものは変化を遂げています。自分で追跡する場合は、この時間に専念する必要があります。</font><font style="vertical-align: inherit;">そのため、隠れたプロセスを理解するのに役立つ視覚的な例をまとめました。</font><font style="vertical-align: inherit;">また、前述の補助ツールを使用すると、Istioを使用して適切に作業を構築できます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478406/index.html">無料のCRM +テレフォニー</a></li>
<li><a href="../ja478408/index.html">セキュリティウィーク49：ホテルのインフラをハッキング</a></li>
<li><a href="../ja478410/index.html">学校の教科書IIIからのタスク</a></li>
<li><a href="../ja478412/index.html">Rostelecom Solarでのインターンシップ：Scalaスキルのダウンロード</a></li>
<li><a href="../ja478414/index.html">デジタル時代の幕開けを告げるヒーロー：カセットプレーヤー用アダプター</a></li>
<li><a href="../ja478418/index.html">マイクロチッピングの人気の高まり：テクノロジーを肌に浸透させる準備はできていますか？</a></li>
<li><a href="../ja478420/index.html">1つの漸近線ではあなたは遠くに行きません...</a></li>
<li><a href="../ja478426/index.html">中央銀行はコンピュータを制御したいですか？</a></li>
<li><a href="../ja478432/index.html">正月はもうすぐです。PHP-25 *。それが私たちが彼に望むことです</a></li>
<li><a href="../ja478434/index.html">それがヤギのポッドキャストなのですか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>