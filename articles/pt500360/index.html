<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺🏾 😿 ✊🏼 Melhores perguntas sobre entrevistas com dificuldade média do SQL 🛣️ 👨🏽‍🤝‍👨🏻 🍤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os primeiros 70% do curso SQL parecem bem diretos. As dificuldades começam nos 30% restantes.
 
 De 2015 a 2019, passei por quatro entrevistas para os...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Melhores perguntas sobre entrevistas com dificuldade média do SQL</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/500360/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os primeiros 70% do curso SQL parecem bem diretos. As dificuldades começam nos 30% restantes.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De 2015 a 2019, passei por quatro entrevistas para os cargos de analista de dados e especialista em análise de dados em mais de uma dúzia de empresas. Depois de outra entrevista malsucedida em 2017 - quando fiquei confusa sobre questões complexas de SQL - comecei a compilar um livro de problemas com perguntas de SQL de média e alta complexidade, a fim de me preparar melhor para as entrevistas. Este guia foi útil na última rodada de entrevistas em 2019. No ano passado, compartilhei este guia com alguns amigos e, graças ao tempo livre extra devido a uma pandemia, eu o aprimorei e compilei este documento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem muitos ótimos tutoriais SQL para iniciantes. Meus favoritos são</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cursos interativos de SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Star SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da Codecademy de Zi Chung Kao. </font><font style="vertical-align: inherit;">Mas, na realidade, os primeiros 70% do curso SQL são bastante simples, e as dificuldades reais começam nos 30% restantes, que não são abordados nos guias para iniciantes. </font><font style="vertical-align: inherit;">Portanto, em entrevistas para analistas de dados e especialistas em análise de dados em empresas de tecnologia, muitas vezes fazem perguntas sobre esses 30%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Surpreendentemente, não encontrei uma fonte exaustiva sobre esses problemas de dificuldade média, por isso compilei este guia.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É útil para entrevistas, mas, ao mesmo tempo, aumentará sua eficácia em seus empregos atuais e futuros. </font><font style="vertical-align: inherit;">Pessoalmente, acredito que alguns dos modelos SQL mencionados também são úteis para sistemas ETL que executam ferramentas de relatório e funções de análise de dados para identificar tendências.</font></font><br>
<br>
<blockquote><h1><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conteúdo</font></font></a></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">        SQL</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 1.     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 2.   </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 3.     ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 2</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 3</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 4.  </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 5.  </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 6.   </a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 1.     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 2.        ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 2</a></li>
</ul></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">     </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 1. </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 2.   ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 2</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">№ 3.  </a></li>
</ul></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você precisa entender que, durante entrevistas com analistas de dados e analistas de dados, eles fazem perguntas não apenas sobre SQL. Outros tópicos comuns incluem discussão de projetos anteriores, teste A / B, desenvolvimento de métricas e questões analíticas abertas. Há cerca de três anos, Quora postou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dicas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre entrevistas para uma posição de analista de produtos no Facebook. Lá, este tópico é discutido em mais detalhes. No entanto, se o aprimoramento do seu conhecimento de SQL o ajudar na sua entrevista, então este guia vale a pena. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No futuro, posso portar o código deste guia para um site como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Star SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para facilitar a gravação de instruções SQL - e ver o resultado da execução do código em tempo real. </font><font style="vertical-align: inherit;">Como opção, adicione perguntas como problemas à plataforma para se preparar para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entrevistas do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">LeetCode</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Enquanto isso, eu só queria publicar este documento para que as pessoas possam se familiarizar com essas informações.</font></font><br>
<br>
<a name="1"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suposições feitas e como usar o manual</font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pressupostos sobre o conhecimento da linguagem SQL:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Supõe-se que você tenha conhecimento prático de SQL. </font><font style="vertical-align: inherit;">Você provavelmente o usa frequentemente no trabalho, mas deseja aprimorar suas habilidades em tópicos como auto-associações e funções de janela. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como usar este manual:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como um quadro ou um notebook virtual é frequentemente usado em uma entrevista (sem compilar o código), recomendo pegar um lápis e um papel e escrever soluções para cada problema e, depois de concluir, compare suas anotações com as respostas. </font><font style="vertical-align: inherit;">Ou elabore suas respostas com um amigo que atuará como entrevistador!</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pequenos erros de sintaxe não importam muito durante uma entrevista com um quadro branco ou bloco de notas. </font><font style="vertical-align: inherit;">Mas eles podem distrair o entrevistador, então, idealmente, tente reduzir seu número para concentrar toda a atenção na lógica.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As respostas dadas não são necessariamente a única maneira de resolver cada problema. </font><font style="vertical-align: inherit;">Sinta-se livre para escrever comentários com soluções adicionais que você pode adicionar a este guia!</font></font></li>
</ul><br>
<a name="2"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dicas para resolver tarefas complexas em entrevistas SQL</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, dicas padrão para todas as entrevistas de programação ...</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouça atentamente a descrição do problema, repita a essência do problema para o entrevistador.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formule um caso limite para demonstrar que realmente entende o problema (ou seja, uma linha que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não será</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> incluída na consulta SQL final que você escreverá)</font></font><br>
</li>
<li>(    )     ,     —     :     ,             <br>
<ul>
<li>,      ,     </li>
</ul></li>
<li>  SQL,   ,     .      ,      .</li>
</ol><br>
<a name="3"></a><h1>   </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns dos problemas listados aqui são adaptados das entradas antigas do blog do Periscope (escritas principalmente por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sean Cook por</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> volta de 2014, embora sua autoria pareça ter sido removida dos materiais após a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fusão do SiSense com o Periscope</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), bem como das discussões no StackOverflow. </font><font style="vertical-align: inherit;">Se necessário, as fontes são marcadas no início de cada pergunta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Star SQL,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> também há uma boa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seleção de quebra-cabeças</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , questões complementares deste documento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que essas perguntas não são cópias literais das perguntas de minhas próprias entrevistas e não foram usadas nas empresas em que trabalhei ou trabalho.</font></font><br>
<br>
<a name="4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefas de auto-associação</font></font></h1><br>
<a name="5"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 1. Variação percentual mês a mês</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geralmente </font><b><font style="vertical-align: inherit;">é</font></b><font style="vertical-align: inherit;"> útil saber como uma métrica importante muda, por exemplo, o público mensal de usuários ativos, mês a mês. </font><font style="vertical-align: inherit;">Digamos que temos uma tabela </font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neste formulário:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">data |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">01/07/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">02/07/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">02/07/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">02/07/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">04-10-2018 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetivo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : encontre a alteração percentual mensal no público mensal de usuários ativos (MAU). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solução: </font></font></b><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Esta solução, como os outros blocos de código deste documento, contém comentários sobre elementos de sintaxe SQL que podem diferir entre diferentes variantes SQL e outras notas)</font></font></i> <br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> mau <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
  <span class="hljs-keyword">SELECT</span> 
   <span class="hljs-comment">/* 
    *       
    *  , .&nbsp;.   ,    . 
    *    ,   
    *
    *  Postgres  DATE_TRUNC(),   
    *      SQL   
    * . https://www.postgresql.org/docs/9.0/functions-datetime.html#FUNCTIONS-DATETIME-TRUNC
    */</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-built_in">date</span>) month_timestamp,
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) mau
  <span class="hljs-keyword">FROM</span> <font></font>
    logins <font></font>
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-built_in">date</span>)<font></font>
  )<font></font>
 <font></font>
 <span class="hljs-keyword">SELECT</span> 
    <span class="hljs-comment">/*
    *    SELECT      . 
    * 
    *        ,   
    *    ,   , 
    *        ..
    */</span> <font></font>
    a.month_timestamp previous_month, <font></font>
    a.mau previous_mau, <font></font>
    b.month_timestamp current_month, <font></font>
    b.mau current_mau, <font></font>
    <span class="hljs-keyword">ROUND</span>(<span class="hljs-number">100.0</span>*(b.mau - a.mau)/a.mau,<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> percent_change 
 <span class="hljs-keyword">FROM</span><font></font>
    mau a <font></font>
 <span class="hljs-keyword">JOIN</span> 
    <span class="hljs-comment">/*
    *   `ON b.month_timestamp = a.month_timestamp + interval '1 month'` 
    */</span>
    mau b <span class="hljs-keyword">ON</span> a.month_timestamp = b.month_timestamp - <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span> </code></pre><br>
<a name="6"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2. Estrutura da árvore de marcação</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suponha que você tenha uma tabela </font></font><code>tree</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com duas colunas: a primeira indica os nós e a segunda os nós pais.</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pai do nó</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 NULL </font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escrever SQL de forma que designemos cada nó como interno (raiz), raiz (raiz) ou nó final / folha (folha), para que, para os valores acima, você obtenha o seguinte:</font></font><br>
<br>
<pre><code class="sql hljs">node    label  <font></font>
1       Leaf<font></font>
2       Inner<font></font>
3       Inner<font></font>
4       Leaf<font></font>
5       Root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Nota: mais informações sobre a terminologia da estrutura de dados em forma de árvore podem ser encontradas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No entanto, não é necessário resolver esse problema!) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solução: </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obrigado:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta é uma solução mais generalizada proposta por Fabian Hoffman em 2 de maio de 2020. </font><font style="vertical-align: inherit;">Obrigado Fabian</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> join_table <span class="hljs-keyword">AS</span><font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> <font></font>
        cur.node, <font></font>
        cur.parent, <font></font>
        <span class="hljs-keyword">COUNT</span>(next.node) <span class="hljs-keyword">AS</span> num_children
    <span class="hljs-keyword">FROM</span> <font></font>
        tree cur<font></font>
    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> 
        tree <span class="hljs-keyword">next</span> <span class="hljs-keyword">ON</span> (next.parent = cur.node)
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
        cur.node, <font></font>
        cur.parent<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span><font></font>
    node,<font></font>
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">"Root"</span>
        <span class="hljs-keyword">WHEN</span> num_children = <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">"Leaf"</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">"Inner"</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> label
<span class="hljs-keyword">FROM</span> 
    join_table </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solução alternativa, sem conexões explícitas: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconhecimento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> William Chardgin em 02 de maio de 2020 chamou a atenção para a necessidade da condição </font></font><code>WHERE parent IS NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de que este retorno solução </font></font><code>Leaf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vez </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Obrigado William!</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    node,<font></font>
    <span class="hljs-keyword">CASE</span> 
        <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Root'</span>
        <span class="hljs-keyword">WHEN</span> node <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> 
            (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">FROM</span> tree <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Leaf'</span>
        <span class="hljs-keyword">WHEN</span> node <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">FROM</span> tree) <span class="hljs-keyword">AND</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Inner'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> label 
 <span class="hljs-keyword">from</span> 
    tree</code></pre><br>
<a name="7"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 3. Retenção de usuários por mês (várias partes)</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecimento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta tarefa foi adaptada do artigo de blog do SiSense, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Usando</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auto-associações </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">para calcular retenção,</font></a><font style="vertical-align: inherit;"> vazão e reativação </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="8"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suponha que tenhamos estatísticas sobre a autorização do usuário em um site na tabela </font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">data |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">01/07/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">02/07/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">02/07/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">02/07/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">04-10-2018 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreva uma solicitação que receba o número de usuários retidos por mês. </font><font style="vertical-align: inherit;">No nosso caso, esse parâmetro é definido como o número de usuários que efetuaram login no sistema neste e no mês anterior. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> a.user_id) retained_users 
 <span class="hljs-keyword">FROM</span> <font></font>
    logins a <font></font>
 <span class="hljs-keyword">JOIN</span> 
    logins b <span class="hljs-keyword">ON</span> a.user_id = b.user_id 
        <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, b.date) + 
                                             <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span>
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    date_trunc(<span class="hljs-string">'month'</span>, a.date)</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecimento:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tom Moertel destacou que a pré-duplicação de user_id antes da autoatendimento torna a solução mais eficiente e sugeriu o código abaixo. </font><font style="vertical-align: inherit;">Obrigado Tom! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solução alternativa:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> DistinctMonthlyUsers <span class="hljs-keyword">AS</span> (
  <span class="hljs-comment">/*
  *     ** , 
  *  
  */</span>
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>
      DATE_TRUNC(<span class="hljs-string">'MONTH'</span>, a.date) <span class="hljs-keyword">AS</span> month_timestamp,<font></font>
      user_id<font></font>
    <span class="hljs-keyword">FROM</span> logins<font></font>
  )<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span><font></font>
  CurrentMonth.month_timestamp month_timestamp,<font></font>
  <span class="hljs-keyword">COUNT</span>(PriorMonth.user_id) <span class="hljs-keyword">AS</span> retained_user_count
<span class="hljs-keyword">FROM</span> 
    DistinctMonthlyUsers <span class="hljs-keyword">AS</span> CurrentMonth
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> 
    DistinctMonthlyUsers <span class="hljs-keyword">AS</span> PriorMonth
  <span class="hljs-keyword">ON</span>
    CurrentMonth.month_timestamp = PriorMonth.month_timestamp + <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1 MONTH'</span>
    <span class="hljs-keyword">AND</span> 
    CurrentMonth.user_id = PriorMonth.user_id</code></pre><br>
<a name="9"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agora assumimos a tarefa anterior de calcular o número de usuários retidos por mês - e a invertemos. </font><font style="vertical-align: inherit;">Escreveremos uma solicitação para contar os usuários que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retornaram ao site este mês. </font><font style="vertical-align: inherit;">Ou seja, usuários "perdidos". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> b.user_id) churned_users 
<span class="hljs-keyword">FROM</span> <font></font>
    logins a <font></font>
<span class="hljs-keyword">FULL</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> 
    logins b <span class="hljs-keyword">ON</span> a.user_id = b.user_id 
        <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, b.date) + 
                                         <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span>
<span class="hljs-keyword">WHERE</span> 
    a.user_id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que esse problema também pode ser resolvido com </font></font><code>LEFT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>RIGHT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a name="10"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 3</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: esta é</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> provavelmente uma tarefa mais difícil do que você será oferecido em uma entrevista real. </font><font style="vertical-align: inherit;">Pense nisso mais como um quebra-cabeça - ou você pode pular e passar para a próxima tarefa. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : fizemos um bom trabalho com dois problemas anteriores. </font><font style="vertical-align: inherit;">Sob os termos da nova tarefa, agora temos uma tabela de usuários perdidos </font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se o usuário estiver ativo no mês passado, mas não estiver ativo, ele será inserido na tabela desse mês. </font><font style="vertical-align: inherit;">Aqui está o que parece </font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">month_date |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">01/05/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">01/05/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">01/05/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">12 </font><font style="vertical-align: inherit;">01/05/2018 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 </font><font style="vertical-align: inherit;">01-10-2018 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : agora você deseja realizar uma análise de coorte, ou seja, uma análise da totalidade dos usuários ativos que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foram reativados no passado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Crie uma tabela com esses usuários. </font><font style="vertical-align: inherit;">Você pode usar tabelas </font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">criar uma coorte </font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No Postgres, o registro de data e hora atual é acessível via </font></font><code>current_timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> user_login_data <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp,<font></font>
        a.user_id,<font></font>
        <span class="hljs-comment">/* 
        *   ,    SQL,   , 
        *      SELECT   HAVING.
        *       .  
        */</span> 
        <span class="hljs-keyword">MAX</span>(b.month_date) <span class="hljs-keyword">as</span> most_recent_churn, 
        <span class="hljs-keyword">MAX</span>(DATE_TRUNC(<span class="hljs-string">'month'</span>, c.date)) <span class="hljs-keyword">as</span> most_recent_active 
     <span class="hljs-keyword">FROM</span> <font></font>
        logins a<font></font>
     <span class="hljs-keyword">JOIN</span> <font></font>
        user_churns b <font></font>
            <span class="hljs-keyword">ON</span> a.user_id = b.user_id <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) &gt; b.month_date 
     <span class="hljs-keyword">JOIN</span><font></font>
        logins c <font></font>
            <span class="hljs-keyword">ON</span> a.user_id = c.user_id 
            <span class="hljs-keyword">AND</span> 
            DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) &gt; DATE_TRUNC(<span class="hljs-string">'month'</span>, c.date)
     <span class="hljs-keyword">WHERE</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-keyword">current_timestamp</span>)
     <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date),<font></font>
        a.user_id<font></font>
     <span class="hljs-keyword">HAVING</span> 
        most_recent_churn &gt; most_recent_active</code></pre><br>
<a name="11"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 4. Total crescente</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecimento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta tarefa foi adaptada do artigo do blog SiSense </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Cash Flow Modeling in SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suponha que tenhamos uma tabela </font></font><code>transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neste formato:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">data | </font><font style="vertical-align: inherit;">cash_flow |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ----------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">01-01-2018 | </font><font style="vertical-align: inherit;">-1000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">02-01-2018 | </font><font style="vertical-align: inherit;">-100</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">03-01-2018 | </font><font style="vertical-align: inherit;">50</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Onde </font></font><code>cash_flow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">está a receita menos os custos de cada dia. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetivo:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreva uma solicitação para obter um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">total</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contínuo de fluxo de caixa todos os dias de forma que, no final, você obtenha uma tabela neste formulário:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">data | </font><font style="vertical-align: inherit;">cumulative_cf |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | --------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">01-01-2018 | </font><font style="vertical-align: inherit;">-1000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">02-01-2018 | </font><font style="vertical-align: inherit;">-1100</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">03-01-2018 | </font><font style="vertical-align: inherit;">-1050</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    a.date <span class="hljs-built_in">date</span>, 
    <span class="hljs-keyword">SUM</span>(b.cash_flow) <span class="hljs-keyword">as</span> cumulative_cf 
<span class="hljs-keyword">FROM</span><font></font>
    transactions a<font></font>
<span class="hljs-keyword">JOIN</span> b <font></font>
    transactions b <span class="hljs-keyword">ON</span> a.date &gt;= b.date 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
    a.date <font></font>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma solução alternativa usando uma função de janela (mais eficiente!):</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    <span class="hljs-built_in">date</span>, 
    <span class="hljs-keyword">SUM</span>(cash_flow) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span>) <span class="hljs-keyword">as</span> cumulative_cf 
<span class="hljs-keyword">FROM</span><font></font>
    transactions <font></font>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span></code></pre><br>
<a name="12"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 5. Média Móvel</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecimento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta tarefa foi adaptada do artigo do blog SiSense </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Médias móveis no MySQL e SQL Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> média móvel pode ser calculada de várias maneiras. </font><font style="vertical-align: inherit;">Aqui usamos a média anterior. </font><font style="vertical-align: inherit;">Assim, a métrica para o sétimo dia do mês será a média dos seis dias anteriores e dele próprio. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : suponha que tenhamos uma tabela </font></font><code>signups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neste formato:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">data | </font><font style="vertical-align: inherit;">inscrições |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ---------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">01-01-2018 | </font><font style="vertical-align: inherit;">10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">02-01-2018 | </font><font style="vertical-align: inherit;">20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">03-01-2018 | </font><font style="vertical-align: inherit;">50</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">01-10-2018 | </font><font style="vertical-align: inherit;">35</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : escreva uma solicitação para obter uma média móvel de 7 dias dos registros diários. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
  a.date, <font></font>
  <span class="hljs-keyword">AVG</span>(b.sign_ups) average_sign_ups 
<span class="hljs-keyword">FROM</span> <font></font>
  signups a <font></font>
<span class="hljs-keyword">JOIN</span> 
  signups b <span class="hljs-keyword">ON</span> a.date &lt;= b.date + <span class="hljs-built_in">interval</span> <span class="hljs-string">'6 days'</span> <span class="hljs-keyword">AND</span> a.date &gt;= b.date
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
  a.date</code></pre><br>
<a name="13"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 6. Várias condições de conexão</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecimento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta tarefa foi adaptada do artigo de blog do SiSense, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Analisando Seu Email Usando SQL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digamos que nossa tabela </font></font><code>emails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contenha e-mails enviados pelo endereço </font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e recebidos nele:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">assunto | </font><font style="vertical-align: inherit;">de | </font><font style="vertical-align: inherit;">para | </font><font style="vertical-align: inherit;">timestamp |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ---- | ---------- | -------------- | -------------- | --- ------------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">Yosemite </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-02 12:45:03</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 </font><font style="vertical-align: inherit;">Big Sur </font><font style="vertical-align: inherit;">sarah@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-02 16:30:01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">Yosemite </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-02 16:35:04 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 </font><font style="vertical-align: inherit;">Correndo | </font><font style="vertical-align: inherit;">jill@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-03 08:12:45 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 </font><font style="vertical-align: inherit;">Yosemite </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-03 14:02:01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 </font><font style="vertical-align: inherit;">Yosemite </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-03 15:01:05 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">.. </font><font style="vertical-align: inherit;">.. </font><font style="vertical-align: inherit;">.. </font><font style="vertical-align: inherit;">.. </font><font style="vertical-align: inherit;">..</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreva uma solicitação para obter tempo de resposta para cada letra ( </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) enviada para </font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Não inclua cartas para outros endereços. </font><font style="vertical-align: inherit;">Suponha que cada segmento tenha um tema único. </font><font style="vertical-align: inherit;">Lembre-se de que o segmento pode ter várias cartas de ida e volta entre </font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e outros destinatários. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    a.id, <font></font>
    <span class="hljs-keyword">MIN</span>(b.timestamp) - a.timestamp <span class="hljs-keyword">as</span> time_to_respond 
<span class="hljs-keyword">FROM</span> <font></font>
    emails a <font></font>
<span class="hljs-keyword">JOIN</span><font></font>
    emails b <font></font>
        <span class="hljs-keyword">ON</span> <font></font>
            b.subject = a.subject <font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.to = b.from<font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.from = b.to <font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.timestamp &lt; b.timestamp <font></font>
 <span class="hljs-keyword">WHERE</span> 
    a.to = <span class="hljs-string">'zach@g.com'</span> 
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    a.id </code></pre><br>
<a name="14"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefas para funções da janela</font></font></h1><br>
<a name="15"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Não. 1. Encontre o identificador com o valor máximo</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suponha que tenhamos uma tabela </font></font><code>salaries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com dados sobre departamentos e salários dos funcionários no seguinte formato:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  depname | </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">salário |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">11 </font><font style="vertical-align: inherit;">5200</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">7 </font><font style="vertical-align: inherit;">4200</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">9 </font><font style="vertical-align: inherit;">4500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">8 </font><font style="vertical-align: inherit;">6000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">10 </font><font style="vertical-align: inherit;">5200</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pessoal | </font><font style="vertical-align: inherit;">5 </font><font style="vertical-align: inherit;">3500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pessoal | </font><font style="vertical-align: inherit;">2 </font><font style="vertical-align: inherit;">3900</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">4800</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">4 </font><font style="vertical-align: inherit;">4800</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : escreva uma solicitação para obter </font></font><code>empno</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o salário mais alto. </font><font style="vertical-align: inherit;">Verifique se a sua solução lida com casos de salários iguais! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> max_salary <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">MAX</span>(salary) max_salary
    <span class="hljs-keyword">FROM</span> <font></font>
        salaries<font></font>
    )<font></font>
<span class="hljs-keyword">SELECT</span> <font></font>
    s.empno<font></font>
<span class="hljs-keyword">FROM</span> <font></font>
    salaries s<font></font>
<span class="hljs-keyword">JOIN</span> 
    max_salary ms <span class="hljs-keyword">ON</span> s.salary = ms.max_salary</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solução alternativa usando </font></font><code>RANK()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> sal_rank <span class="hljs-keyword">AS</span> 
  (<span class="hljs-keyword">SELECT</span> <font></font>
    empno, <font></font>
    <span class="hljs-keyword">RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) rnk
  <span class="hljs-keyword">FROM</span> <font></font>
    salaries)<font></font>
<span class="hljs-keyword">SELECT</span> <font></font>
  empno<font></font>
<span class="hljs-keyword">FROM</span><font></font>
  sal_rank<font></font>
<span class="hljs-keyword">WHERE</span> 
  rnk = <span class="hljs-number">1</span>;</code></pre><br>
<a name="16"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2. Valor médio e classificação com uma função de janela (várias partes)</font></font></h2><br>
<a name="17"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : suponha que tenhamos uma tabela </font></font><code>salaries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neste formato:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  depname | </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">salário |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">11 </font><font style="vertical-align: inherit;">5200</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">7 </font><font style="vertical-align: inherit;">4200</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">9 </font><font style="vertical-align: inherit;">4500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">8 </font><font style="vertical-align: inherit;">6000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">10 </font><font style="vertical-align: inherit;">5200</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pessoal | </font><font style="vertical-align: inherit;">5 </font><font style="vertical-align: inherit;">3500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pessoal | </font><font style="vertical-align: inherit;">2 </font><font style="vertical-align: inherit;">3900</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">4800</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">4 </font><font style="vertical-align: inherit;">4800</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreva uma consulta que retorne a mesma tabela, mas com uma nova coluna que mostre o salário médio para o departamento. </font><font style="vertical-align: inherit;">Esperamos uma tabela como esta:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  depname | </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">salário | </font><font style="vertical-align: inherit;">avg_salary |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">11 </font><font style="vertical-align: inherit;">5200 </font><font style="vertical-align: inherit;">5020</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">7 </font><font style="vertical-align: inherit;">4200 </font><font style="vertical-align: inherit;">5020</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">9 </font><font style="vertical-align: inherit;">4500 </font><font style="vertical-align: inherit;">5020</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">8 </font><font style="vertical-align: inherit;">6000 </font><font style="vertical-align: inherit;">5020</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">10 </font><font style="vertical-align: inherit;">5200 </font><font style="vertical-align: inherit;">5020</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pessoal | </font><font style="vertical-align: inherit;">5 </font><font style="vertical-align: inherit;">3500 </font><font style="vertical-align: inherit;">3700</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pessoal | </font><font style="vertical-align: inherit;">2 </font><font style="vertical-align: inherit;">3900 </font><font style="vertical-align: inherit;">3700</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">4800 </font><font style="vertical-align: inherit;">4867</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 </font><font style="vertical-align: inherit;">4867</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">4 </font><font style="vertical-align: inherit;">4800 </font><font style="vertical-align: inherit;">4867</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    *, <font></font>
    <span class="hljs-comment">/*
    * AVG() is a Postgres command, but other SQL flavors like BigQuery use 
    * AVERAGE()
    */</span> 
    <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">AVG</span>(salary),<span class="hljs-number">0</span>) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> depname) avg_salary
<span class="hljs-keyword">FROM</span>
    salaries</code></pre><br>
<a name="18"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreva uma consulta que inclua uma coluna com a posição de cada funcionário no quadro de horários com base no salário em seu departamento, onde o funcionário com o salário mais alto obtém a posição 1. Esperaríamos uma tabela neste formato:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  depname | </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">salário | </font><font style="vertical-align: inherit;">salário_ranco |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">11 </font><font style="vertical-align: inherit;">5200 </font><font style="vertical-align: inherit;">2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">7 </font><font style="vertical-align: inherit;">4200 </font><font style="vertical-align: inherit;">5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">9 </font><font style="vertical-align: inherit;">4500 </font><font style="vertical-align: inherit;">4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">8 </font><font style="vertical-align: inherit;">6000 </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desenvolver | </font><font style="vertical-align: inherit;">10 </font><font style="vertical-align: inherit;">5200 </font><font style="vertical-align: inherit;">2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pessoal | </font><font style="vertical-align: inherit;">5 </font><font style="vertical-align: inherit;">3500 </font><font style="vertical-align: inherit;">2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 pessoal | </font><font style="vertical-align: inherit;">2 </font><font style="vertical-align: inherit;">3900 </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">4800 </font><font style="vertical-align: inherit;">2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 vendas | </font><font style="vertical-align: inherit;">4 </font><font style="vertical-align: inherit;">4800 </font><font style="vertical-align: inherit;">2</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    *, <font></font>
    <span class="hljs-keyword">RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> depname <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) salary_rank
 <span class="hljs-keyword">FROM</span>  
    salaries </code></pre><br>
<a name="19"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outras tarefas de dificuldade média e alta</font></font></h1><br>
<a name="20"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 1. Histogramas</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digamos que temos uma tabela em </font></font><code>sessions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que cada linha representa uma sessão de streaming de vídeo com duração em segundos:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">session_id | </font><font style="vertical-align: inherit;">length_seconds |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ---------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">23</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 </font><font style="vertical-align: inherit;">453</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">27</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">.. </font><font style="vertical-align: inherit;">..</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreva uma consulta para calcular o número de sessões que caem em intervalos de cinco segundos, ou seja, para o fragmento acima, o resultado será algo como isto:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">balde | </font><font style="vertical-align: inherit;">contar |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">20-25 </font><font style="vertical-align: inherit;">2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">450-455 </font><font style="vertical-align: inherit;">1 |</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pontuação máxima conta para os rótulos de linha adequados ("5-10" etc.) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solução:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> bin_label <span class="hljs-keyword">AS</span> 
(<span class="hljs-keyword">SELECT</span> <font></font>
    session_id, <font></font>
    <span class="hljs-keyword">FLOOR</span>(length_seconds/<span class="hljs-number">5</span>) <span class="hljs-keyword">as</span> bin_label 
 <span class="hljs-keyword">FROM</span><font></font>
    sessions <font></font>
 )<font></font>
 <span class="hljs-keyword">SELECT</span> 
    CONCATENTATE(<span class="hljs-keyword">STR</span>(bin_label*<span class="hljs-number">5</span>), <span class="hljs-string">'-'</span>, <span class="hljs-keyword">STR</span>(bin_label*<span class="hljs-number">5</span>+<span class="hljs-number">5</span>)) <span class="hljs-keyword">bucket</span>, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> session_id) <span class="hljs-keyword">count</span> 
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
    bin_label<font></font>
 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    bin_label <span class="hljs-keyword">ASC</span> </code></pre><br>
<a name="21"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2. Conexão cruzada (várias partes)</font></font></h2><br>
<a name="22"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digamos que temos uma tabela em </font></font><code>state_streams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que o nome do estado e o número total de horas de streaming da hospedagem de vídeo são indicados em cada linha:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">estado | </font><font style="vertical-align: inherit;">total_streams |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------- | --------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NC </font><font style="vertical-align: inherit;">34569</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SC </font><font style="vertical-align: inherit;">33999</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CA </font><font style="vertical-align: inherit;">98324</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MA </font><font style="vertical-align: inherit;">19345</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">.. </font><font style="vertical-align: inherit;">..</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(De fato, tabelas agregadas desse tipo geralmente têm uma coluna de data, mas a excluiremos para esta tarefa) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escreva uma consulta para obter pares de estados com um número total de encadeamentos dentro de mil um do outro. </font><font style="vertical-align: inherit;">Para o snippet acima, gostaríamos de ver algo como:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">state_a | </font><font style="vertical-align: inherit;">state_b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | --------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NC </font><font style="vertical-align: inherit;">SC</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SC </font><font style="vertical-align: inherit;">NC</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a<font></font>
 <span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> <font></font>
    state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &lt;&gt; b.state </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obter informações, as junções cruzadas também podem ser gravadas sem especificar explicitamente as junções:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a, state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &lt;&gt; b.state </code></pre><br>
<a name="23"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esta é uma questão de bônus, e não um modelo SQL realmente importante. </font><font style="vertical-align: inherit;">Você pode pular! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como posso modificar o SQL de uma solução anterior para remover duplicatas? </font><font style="vertical-align: inherit;">Por exemplo, o exemplo da mesma tabela, para vapor </font></font><code>NC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>SC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">houve apenas uma vez, não duas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a, state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &gt; b.state </code></pre><br>
<a name="24"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 3. Cálculos avançados</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecimento:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta tarefa foi adaptada de uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussão</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre uma pergunta que eu fiz no StackOverflow (meu apelido é zthomas.nc). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: esta é</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> provavelmente uma tarefa mais difícil do que você será oferecido em uma entrevista real. </font><font style="vertical-align: inherit;">Pense nisso mais como um quebra-cabeça - ou você pode pular! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suponha que tenhamos uma tabela </font></font><code>table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desse tipo, onde </font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valores diferentes de uma classe podem corresponder </font><font style="vertical-align: inherit;">ao mesmo usuário </font></font><code>class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">usuário | </font><font style="vertical-align: inherit;">classe |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------ | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">a |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 </font><font style="vertical-align: inherit;">b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 </font><font style="vertical-align: inherit;">a |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suponha que haja apenas dois valores possíveis para uma classe. </font><font style="vertical-align: inherit;">Escreva uma consulta para calcular o número de usuários em cada classe. </font><font style="vertical-align: inherit;">Nesse caso, os usuários com os dois rótulos </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devem se referir à classe </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para nossa amostra, obtemos o seguinte resultado:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">classe | </font><font style="vertical-align: inherit;">contar |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------- | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">b </font><font style="vertical-align: inherit;">2</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decisão:</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> usr_b_sum <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">user</span>, 
        <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) num_b
    <span class="hljs-keyword">FROM</span> 
        <span class="hljs-keyword">table</span>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
        <span class="hljs-keyword">user</span><font></font>
), <font></font>
<font></font>
usr_class_label <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">user</span>, 
        <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> num_b &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'b'</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'a'</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">class</span> 
    <span class="hljs-keyword">FROM</span> <font></font>
        usr_b_sum<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span> 
    <span class="hljs-keyword">class</span>, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">user</span>) <span class="hljs-keyword">count</span> 
<span class="hljs-keyword">FROM</span><font></font>
    usr_class_label<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-keyword">class</span> 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-keyword">class</span> <span class="hljs-keyword">ASC</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma solução alternativa usa instruções </font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nos operadores </font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    <span class="hljs-string">"a"</span> <span class="hljs-keyword">class</span>,
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) - <font></font>
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span>) <span class="hljs-keyword">count</span> 
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> 
    <span class="hljs-string">"b"</span> <span class="hljs-keyword">class</span>,<font></font>
    (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span>) <span class="hljs-keyword">count</span> </code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt500346/index.html">Problemas com o DNS no Kubernetes. Post-mortem público</a></li>
<li><a href="../pt500348/index.html">Pandemia de COVID-19 através dos olhos de um matemático, ou por que o modelo SEIRD clássico não funciona</a></li>
<li><a href="../pt500352/index.html">Como obter um estágio no Facebook e obter uma oferta em Londres? Faça uma pergunta a um engenheiro do Facebook</a></li>
<li><a href="../pt500354/index.html">Uma nova maneira de rastrear dados no Gerenciador de tags do Google - Etiquetagem no servidor</a></li>
<li><a href="../pt500356/index.html">Transferência direta de arquivos entre dispositivos via WebRTC</a></li>
<li><a href="../pt500364/index.html">Expandindo o portal de aprendizado escolar no Moodle e BigBlueButton</a></li>
<li><a href="../pt500368/index.html">Gerando seqüências aleatórias previsíveis: uma abordagem diferente da permutação</a></li>
<li><a href="../pt500370/index.html">10 podcasts úteis em inglês para programadores que valem a pena assinar em 2020</a></li>
<li><a href="../pt500378/index.html">Pesquisa eficaz de informações no trabalho</a></li>
<li><a href="../pt500380/index.html">Processando dados pessoais remotamente: riscos e possíveis consequências</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>