<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïé üßïüèø üëãüèΩ SSO en arquitectura de microservicios. Usamos Keycloak. N√∫mero de parte 1 ü§∏üèª ü§æüèø üê¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En cualquier empresa grande, X5 Retail Group no es una excepci√≥n, ya que la cantidad de proyectos donde se requiere autenticaci√≥n de usuario aumenta a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SSO en arquitectura de microservicios. Usamos Keycloak. N√∫mero de parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/486778/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cualquier empresa grande, X5 Retail Group no es una excepci√≥n, ya que la cantidad de proyectos donde se requiere autenticaci√≥n de usuario aumenta a medida que crece la cantidad de proyectos. Con el tiempo, se requiere una transici√≥n sin problemas de los usuarios de una aplicaci√≥n a otra y luego es necesario usar un solo servidor Single-Sing-On (SSO). Pero, ¬øqu√© pasa cuando proveedores de identidad como AD u otros que no tienen atributos adicionales ya se utilizan en varios proyectos? Una clase de sistemas llamados "corredores de identidad" vendr√° al rescate. Los m√°s funcionales son sus representantes, como Keycloak, Gravitee Access management, etc. La mayor√≠a de las veces, los escenarios de uso pueden ser diferentes: interacci√≥n con la m√°quina, participaci√≥n del usuario, etc. La soluci√≥n debe admitir una funcionalidad flexible y escalablecapaz de combinar todos los requisitos en uno, y esa soluci√≥n en nuestra empresa ahora es un corredor de indicadores: Keycloak.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/bi/eh/hmbiehmxsfcq_cfltz8xj0mhrgc.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak es un producto de c√≥digo abierto para autenticaci√≥n y control de acceso compatible con RedHat. </font><font style="vertical-align: inherit;">Es la base de los productos de la compa√±√≠a que utilizan SSO - RH-SSO.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conceptos b√°sicos </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de comenzar a lidiar con decisiones y enfoques, debe determinar los t√©rminos y la secuencia de los procesos: la </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mm/j1/c2/mmj1c2uynwb23y5j4me13zzcrb4.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identificaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el proceso de reconocer a un sujeto por su identificador (en otras palabras, es determinar un nombre, inicio de sesi√≥n o n√∫mero). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La autenticaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un procedimiento de autenticaci√≥n (se verifica al usuario con una contrase√±a, se verifica el correo electr√≥nico mediante firma electr√≥nica, etc.) La </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autorizaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es la provisi√≥n de acceso a alg√∫n recurso (por ejemplo, correo electr√≥nico).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keycloak Identity Broker</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keycloak</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una soluci√≥n de gesti√≥n de acceso e identidad de c√≥digo abierto dise√±ada para su uso en circuitos integrados donde se pueden usar patrones de arquitectura de microservicios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak ofrece caracter√≠sticas tales como inicio de sesi√≥n √∫nico (SSO), identificaci√≥n de corredores e inicio de sesi√≥n social, federaci√≥n de usuarios, adaptadores de clientes, una consola de administrador y una consola de administraci√≥n de cuentas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funcionalidad b√°sica compatible con Keycloak:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single-Sign On y Single-Sign Out para aplicaciones basadas en navegador.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte para OpenID / OAuth 2.0 / SAML.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identity Brokering: autenticaci√≥n mediante proveedores de identidad externos OpenID Connect o SAML.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicio de sesi√≥n social: soporte para Google, GitHub, Facebook, Twitter para la identificaci√≥n del usuario.</font></font></li>
<li>User Federation ‚Äì    LDAP  Active Directory     .</li>
<li>Kerberos bridge ‚Äì  Kerberos     .</li>
<li>Admin Console ‚Äî         Web.</li>
<li>Account Management Console ‚Äì     .</li>
<li>      .</li>
<li>2FA Authentication ‚Äì  TOTP/HOTP   Google Authenticator  FreeOTP.</li>
<li>Login Flows ‚Äì   ,      .</li>
<li>Session Management ‚Äì        .</li>
<li>Token Mappers ‚Äì   ,       .</li>
<li>    realm, application  .</li>
<li>CORS Support ‚Äì      CORS.</li>
<li>Service Provider Interfaces (SPI) ‚Äì   SPI,      :  ,  ,     .</li>
<li>   JavaScript applications, WildFly, JBoss EAP, Fuse, Tomcat, Jetty, Spring.</li>
<li>    ,  OpenID Connect Relying Party library  SAML 2.0 Service Provider Library.</li>
<li>    plugins.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para los procesos de CI / CD, as√≠ como la automatizaci√≥n de los procesos de gesti√≥n en Keycloak, se puede utilizar la API REST API / JAVA. </font><font style="vertical-align: inherit;">La documentaci√≥n est√° disponible en formato electr√≥nico: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REST API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.keycloak.org/docs-api/8.0/rest-api/index.html</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
JAVA API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.keycloak.org/docs-api/8.0/javadocs /index.html</font></font></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proveedores de identidad empresarial (en las instalaciones)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La capacidad de autenticar usuarios a trav√©s de los servicios de la Federaci√≥n de usuarios. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/s9/cl/8js9cl3cx9whnsshxcel0xynpqs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La autenticaci√≥n de paso tambi√©n se puede utilizar: si los usuarios se autentican en estaciones de trabajo con Kerberos (LDAP o AD), se pueden autenticar autom√°ticamente con Keycloak sin tener que volver a ingresar su nombre de usuario y contrase√±a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la autenticaci√≥n y autorizaci√≥n adicional de los usuarios, es posible utilizar un DBMS relacional, que es m√°s aplicable para entornos de desarrollo, ya que no implica configuraciones e integraciones a largo plazo en las primeras etapas de los proyectos. De forma predeterminada, Keycloak utiliza un DBMS incorporado para almacenar configuraciones y datos de usuario.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La lista de DBMS compatibles es extensa e incluye: MS SQL, Oracle, PostgreSQL, MariaDB, Oracle y otros. </font><font style="vertical-align: inherit;">Los m√°s probados en este momento son Oracle 12C Release1 RAC y Galera 3.12 cluster para MariaDB 10.1.19.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proveedores de identidad - inicio de sesi√≥n social </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es posible utilizar un inicio de sesi√≥n desde las redes sociales. </font><font style="vertical-align: inherit;">Para activar la capacidad de autenticar usuarios, se utiliza la consola de administraci√≥n de Keycloack. </font><font style="vertical-align: inherit;">No se requieren cambios en el c√≥digo de la aplicaci√≥n y esta funcionalidad est√° disponible "fuera de la caja" y se puede activar en cualquier etapa del proyecto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bs/rj/vp/bsrjvpxnw7eojom-_bv816iwoxk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para autenticar a los usuarios, es posible usar proveedores de identidad OpenID / SAML.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escenarios de autorizaci√≥n t√≠picos que usan OAuth2 en Keycloak</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flujo de c√≥digo de autorizaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : se utiliza con aplicaciones del lado del servidor. Uno de los tipos m√°s comunes de permisos de autorizaci√≥n, ya que es muy adecuado para aplicaciones de servidor en las que el c√≥digo fuente de la aplicaci√≥n y los datos del cliente no son accesibles para personas externas. El proceso en este caso se basa en la redirecci√≥n. La aplicaci√≥n debe poder interactuar con el agente de usuario (agente de usuario), como un navegador web, para recibir c√≥digos de autorizaci√≥n API redirigidos a trav√©s del agente de usuario. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flujo impl√≠cito</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : utilizado por aplicaciones m√≥viles o web (aplicaciones que se ejecutan en el dispositivo del usuario).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las aplicaciones m√≥viles y web utilizan un tipo impl√≠cito de permiso de autorizaci√≥n donde no se puede garantizar la privacidad del cliente. </font><font style="vertical-align: inherit;">El tipo de permiso impl√≠cito tambi√©n utiliza la redirecci√≥n del agente de usuario, y el token de acceso se pasa al agente de usuario para su uso posterior en la aplicaci√≥n. </font><font style="vertical-align: inherit;">Esto hace que el token est√© disponible para el usuario y otras aplicaciones en el dispositivo del usuario. </font><font style="vertical-align: inherit;">Con este tipo de permiso de autorizaci√≥n, la aplicaci√≥n no se autentica y el proceso en s√≠ depende de una URL de redireccionamiento (previamente registrada en el servicio).</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El flujo impl√≠cito no admite tokens de actualizaci√≥n.
</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flujo de concesi√≥n de credenciales de cliente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : se utiliza cuando la aplicaci√≥n accede a la API. </font><font style="vertical-align: inherit;">Este tipo de permiso de autorizaci√≥n se usa generalmente para interacciones de servidor a servidor que deben ejecutarse en segundo plano sin interacci√≥n inmediata del usuario. </font><font style="vertical-align: inherit;">El flujo de credenciales del cliente permite que el servicio web (el cliente confidencial) use sus propias credenciales en lugar de suplantar al usuario para la autenticaci√≥n al llamar a otro servicio web. </font><font style="vertical-align: inherit;">Para un mayor nivel de seguridad, es posible que el servicio de llamadas use un certificado (en lugar de un secreto compartido) como credenciales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La especificaci√≥n OAuth2 se describe en </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-6749 </font></font></a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-8252 </font></font></a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-6819</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token JWT y sus ventajas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JWT (JSON Web Token) es un est√°ndar abierto ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://tools.ietf.org/html/rfc7519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) que define un m√©todo compacto e independiente para transferir informaci√≥n de forma segura entre las partes como un objeto JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n el est√°ndar, el token consta de tres partes en formato base 64, separadas por puntos. </font><font style="vertical-align: inherit;">La primera parte se llama encabezado, que contiene el tipo de token y el nombre del algoritmo hash para obtener una firma digital. </font><font style="vertical-align: inherit;">La segunda parte almacena la informaci√≥n b√°sica (usuario, atributos, etc.). </font><font style="vertical-align: inherit;">La tercera parte es una firma digital.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;encabezado codificado&gt;. &lt;carga √∫til codificada&gt;. &lt;firma&gt;</font></font></oembed><br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nunca guarde un token en su base de datos. </font><font style="vertical-align: inherit;">Debido a que un token v√°lido es equivalente a una contrase√±a, almacenar un token es como almacenar una contrase√±a en texto sin cifrar.</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un token de acceso</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un token que le da acceso a su propietario a los recursos protegidos del servidor. </font><font style="vertical-align: inherit;">Por lo general, tiene una vida √∫til corta y puede transportar informaci√≥n adicional, como la direcci√≥n IP de la parte que solicita este token. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un token de actualizaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un token que permite a los clientes solicitar nuevos tokens de acceso despu√©s de que su vida haya expirado. </font><font style="vertical-align: inherit;">Estas fichas generalmente se emiten por un largo per√≠odo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Principales ventajas de la aplicaci√≥n en arquitectura de microservicios:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La capacidad de acceder a diversas aplicaciones y servicios a trav√©s de una autenticaci√≥n √∫nica.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En ausencia de una serie de atributos requeridos en el perfil del usuario, es posible enriquecerlo con datos que se pueden agregar a la carga √∫til, incluidos los automatizados y sobre la marcha.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No es necesario almacenar informaci√≥n sobre sesiones activas, la aplicaci√≥n del servidor solo debe verificar la firma.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control de acceso m√°s flexible con atributos adicionales en la carga √∫til.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El uso de una firma de token para el encabezado y la carga √∫til aumenta la seguridad de la soluci√≥n en su conjunto.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token JWT - Composici√≥n</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encabezado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : de forma predeterminada, el encabezado contiene solo el tipo de token y el algoritmo utilizado para el cifrado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tipo de token se almacena en la tecla "typ". </font><font style="vertical-align: inherit;">La tecla "typ" se ignora en el JWT. </font><font style="vertical-align: inherit;">Si la clave typ est√° presente, su valor debe ser JWT para indicar que este objeto es un token web JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda clave alg define el algoritmo utilizado para cifrar el token. </font><font style="vertical-align: inherit;">De manera predeterminada, debe establecerse en HS256. </font><font style="vertical-align: inherit;">El encabezado est√° codificado en base64.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"alg": "HS256", "typ": "JWT"}</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carga √∫til (contenido)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : la carga √∫til almacena cualquier informaci√≥n que deba verificarse. </font><font style="vertical-align: inherit;">Cada clave en la carga √∫til se conoce como una "declaraci√≥n". </font><font style="vertical-align: inherit;">Por ejemplo, la aplicaci√≥n solo se puede ingresar por invitaci√≥n (promoci√≥n cerrada). </font><font style="vertical-align: inherit;">Cuando queremos invitar a alguien a participar, le enviamos una carta de invitaci√≥n. </font><font style="vertical-align: inherit;">Es importante verificar que la direcci√≥n de correo electr√≥nico pertenece a la persona que acepta la invitaci√≥n, por lo que incluiremos esta direcci√≥n en la carga √∫til, para esto la guardaremos en la clave de "correo electr√≥nico"</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"email": "example@x5.ru"}
</font></font></oembed><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las claves en la carga √∫til pueden ser arbitrarias. </font><font style="vertical-align: inherit;">Sin embargo, hay algunos reservados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iss (Emisor): define la aplicaci√≥n desde la que se env√≠a el token.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub (Asunto): define el tema del token.</font></font></li>
<li>aud (Audience) ‚Äì       URI,     .     JWT   ,        ‚Äî   .</li>
<li>exp (Expiration Time) ‚Äî ,     .  JWT ,           . Exp       unix .</li>
<li>nbf (Not Before) ‚Äî    unix ,  ,    .</li>
<li>iat (Issued At) ‚Äî     ,            JWT. iat       unix .</li>
<li>Jti (JWT ID) ‚Äî ,      c  .</li>
</ul><br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es importante comprender que la carga √∫til no se transmite en forma encriptada (aunque los tokens se pueden incrustar y luego es posible transmitir datos encriptados). </font><font style="vertical-align: inherit;">Por lo tanto, es imposible almacenar informaci√≥n secreta en √©l. </font><font style="vertical-align: inherit;">Al igual que el encabezado, la carga √∫til est√° codificada en base64.</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firma</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : cuando tenemos un encabezado y una carga √∫til, podemos calcular la firma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Base64 codificada: se toman el encabezado y la carga √∫til, se combinan en una l√≠nea a trav√©s de un punto. </font><font style="vertical-align: inherit;">Luego, esta l√≠nea y la clave secreta se env√≠an a la entrada del algoritmo de cifrado especificado en el encabezado (clave "alg"). </font><font style="vertical-align: inherit;">La clave puede ser cualquier cadena. </font><font style="vertical-align: inherit;">Las cadenas m√°s largas ser√°n preferibles, ya que llevar√° m√°s tiempo hacer coincidir.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"alg": "RSA1_5", "carga √∫til": "A128CBC-HS256"}</font></font></oembed><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitectura del cl√∫ster de conmutaci√≥n por error de Keycloak</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se usa un solo cl√∫ster para todos los proyectos, hay mayores requisitos para una soluci√≥n para SSO. Cuando el n√∫mero de proyectos es peque√±o, estos requisitos no son tan notables para todos los proyectos, pero con un aumento en el n√∫mero de usuarios e integraciones, aumentan los requisitos de accesibilidad y productividad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aumentar el riesgo de falla de un √∫nico SSO aumenta los requisitos para la arquitectura de la soluci√≥n y los m√©todos utilizados para la redundancia de componentes y conduce a un SLA muy ajustado. En este sentido, con mayor frecuencia al desarrollar o en las primeras etapas de implementaci√≥n de soluciones, los proyectos tienen su propia infraestructura sin tolerancia a fallas. A medida que se desarrolla, debe establecer la posibilidad de desarrollo y escalamiento. Lo m√°s flexible es crear un cl√∫ster de conmutaci√≥n por error utilizando la virtualizaci√≥n de contenedores o un enfoque h√≠brido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para trabajar en cl√∫steres Activo / Activo y Activo / Pasivo, es necesario garantizar la consistencia de los datos en una base de datos relacional: ambos nodos de la base de datos deben replicarse sincr√≥nicamente entre diferentes centros de datos geodistribuidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ejemplo m√°s simple de una instalaci√≥n a prueba de fallas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xo/tw/7w/xotw7wkifwb3h6nnclvnjbbe72c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øCu√°les son los beneficios de usar un solo cl√∫ster?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alta disponibilidad y rendimiento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte para modos de funcionamiento: activo / activo, activo / pasivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La capacidad de escalar din√°micamente, cuando se usa la virtualizaci√≥n de contenedores.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Posibilidad de gesti√≥n centralizada y seguimiento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfoque unificado para la identificaci√≥n / autenticaci√≥n / autorizaci√≥n de usuarios en proyectos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interacci√≥n m√°s transparente entre varios proyectos sin participaci√≥n del usuario.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La capacidad de reutilizar el token JWT en varios proyectos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Punto √∫nico de confianza.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lanzamiento m√°s r√°pido de proyectos utilizando microservicios / virtualizaci√≥n de contenedores (no es necesario generar y configurar componentes adicionales).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tal vez la adquisici√≥n de soporte comercial del vendedor. </font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cosas a tener en cuenta al planificar un cl√∫ster</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak utiliza un sistema de gesti√≥n DBMS para guardar: reinos, clientes, usuarios, etc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se admite una amplia gama de DBMS: MS SQL, Oracle, MySQL, PostgreSQL. </font><font style="vertical-align: inherit;">Keycloak viene con su propia base de datos relacional incorporada. </font><font style="vertical-align: inherit;">Se recomienda su uso para entornos sin carga, como los entornos de desarrollo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para operar en cl√∫steres Activo / Activo y Activo / Pasivo, es necesario asegurar la consistencia de los datos en una base de datos relacional, y ambos nodos del cl√∫ster de la base de datos se replican sincr√≥nicamente entre los centros de datos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cach√© Distribuida (Infinspan)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que el cl√∫ster funcione correctamente, se requiere una sincronizaci√≥n adicional de los siguientes tipos de cach√© utilizando JBoss Data Grid: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sesiones de autenticaci√≥n: se utilizan para guardar datos durante la autenticaci√≥n de un usuario espec√≠fico. </font><font style="vertical-align: inherit;">Las solicitudes de este cach√© generalmente incluyen solo el navegador y el servidor Keycloak, no la aplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fichas de acci√≥n: se utilizan para escenarios en los que el usuario necesita confirmar la acci√≥n de forma asincr√≥nica (por correo electr√≥nico). </font><font style="vertical-align: inherit;">Por ejemplo, durante el flujo de contrase√±a olvidada, el cach√© actionTokens Infinispan se usa para rastrear metadatos sobre marcadores de acci√≥n relacionados que ya se han utilizado, por lo que no se puede reutilizar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Almacenamiento en cach√© e invalidaci√≥n de datos persistentes: se utiliza para almacenar en cach√© datos persistentes para evitar consultas innecesarias en la base de datos. </font><font style="vertical-align: inherit;">Cuando un servidor Keycloak actualiza los datos, todos los dem√°s servidores Keycloak en todos los centros de datos deben ser conscientes de esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabajo: se utiliza solo para enviar mensajes de invalidaci√≥n entre nodos del cl√∫ster y centros de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sesiones de usuario: se utilizan para guardar datos sobre sesiones de usuario que son v√°lidos para la sesi√≥n del navegador de un usuario. </font><font style="vertical-align: inherit;">El cach√© debe manejar las solicitudes HTTP del usuario final y la aplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Protecci√≥n de fuerza bruta: se utiliza para rastrear datos de inicio de sesi√≥n fallidos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Balanceo de carga</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El equilibrador de carga es un √∫nico punto de entrada en keycloak y debe admitir sesiones fijas. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor de aplicaciones</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se utilizan para controlar la interacci√≥n de los componentes entre ellos y se pueden virtualizar o contenerizar mediante las herramientas de automatizaci√≥n existentes y las herramientas de automatizaci√≥n de infraestructura de escala din√°mica. </font><font style="vertical-align: inherit;">Los escenarios de implementaci√≥n m√°s comunes en OpenShift, Kubernetes, Rancher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobre esto, la primera parte, te√≥rica, ha terminado. </font><font style="vertical-align: inherit;">En la siguiente serie de art√≠culos, se discutir√°n ejemplos de integraciones con varios proveedores de identificaci√≥n y ejemplos de configuraci√≥n.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es486764/index.html">H√°galo usted mismo Schema.org: personalizando el micro dise√±o sin un programador</a></li>
<li><a href="../es486766/index.html">¬øC√≥mo transferir todas las transacciones en l√≠nea en el mercado de factoraje arcaico? Experiencia de Factoring Sberbank</a></li>
<li><a href="../es486768/index.html">Revisi√≥n del panel de administraci√≥n de Webasyst</a></li>
<li><a href="../es486772/index.html">Arde, pero no arde, arde para brillar</a></li>
<li><a href="../es486776/index.html">Finalizaci√≥n de c√≥digo y verificaci√≥n de tipo para boto3</a></li>
<li><a href="../es486780/index.html">Desarrollo frontend en la empresa: qu√© es y c√≥mo hacerlo efectivo</a></li>
<li><a href="../es486782/index.html">UI / UX - dise√±o. Tendencias y pron√≥sticos para 2020</a></li>
<li><a href="../es486784/index.html">Los hermanos Lumiere nunca so√±aron</a></li>
<li><a href="../es486788/index.html">Seminario web ‚ÄúMonitoreo remoto y diagn√≥stico de equipos. Estudios de caso de soluciones CNC de Winnum ¬ª</a></li>
<li><a href="../es486790/index.html">Y de nuevo Qbot: una nueva variedad de troyanos bancarios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>