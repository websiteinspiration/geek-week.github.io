<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèæ üîü ‚åöÔ∏è How we created a prototype robot merchandiser and what's next üëèüèæ üéØ üï£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Coronavirus continues its deadly spread throughout the world and in our country. We have been working from home for almost two months, like all IT emp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How we created a prototype robot merchandiser and what's next</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503616/"><iframe width="560" height="315" src="https://www.youtube.com/embed/i9pAHMTUdXQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Coronavirus continues its deadly spread throughout the world and in our country. We have been working from home for almost two months, like all IT employees around the world, and, on the one hand, we are more and more sad about our good old openspace and the opportunity to discuss all tasks and problems in a living, and not crazy useful, but still soulless zoom (we unfortunately did not have time to rent a California llama for all our meet-ups :)). On the other hand, we are thinking more and more about automation and robotization of all processes, including the processes of creating the analytical data that we and our system work with.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In more detail, we recall our first robot merchandiser, which we made as a prototype 2 years ago and are more and more thinking (and not only thinking!) About the second version, which can be put into commercial production and operation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article I want to tell you what happened from this idea, what turned out badly or did not work out at all, and what we are going to do now in order to bring this idea to real application in real stores. For those who are interested, welcome to cat.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A little background: our company (ShelfMatch Robotics) began to automate merchandising about 5 years ago. Automation in this case means that in one way or another we get photos of goods shelves in stores (in pharmacies, at gas stations, etc.) made by merchandisers, recognize all the goods on them and issue the necessary analytics to customers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As soon as we got a little deeper into it, we immediately faced one of the main and rather complex problems - for the most part, merchandisers take bad or very bad photos. It is clear that this issue can be resolved in various traditional ways, such as staff training, issuing good devices, etc., but for many reasons (I will leave them aside, unimportant), these methods do not always work, or rather, they do not always work well.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second, no less important reason why automation of analytics inside the store makes sense is that stores lose money every second due to various display errors, such as out-of-stock or failure to observe the planogram. And they lose a lot of money, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">according to analysts at bossa nova robotics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> out-of-stock, leading to a loss of revenue of 0.5 trillion. dollars a year all over the world. In general, for the store, the introduction of ‚Äúextra eyes‚Äù that will scan the entire space of the trading floor and warehouse is extremely important and poorly implemented at the moment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We at that moment immediately came up with another, more interesting, in our opinion, decision - why not delegate taking photos to someone who, in essence, does everything ALWAYS exactly according to the instructions and almost never makes mistakes (when taking into account accurate and high-quality instructions) . You probably already guessed that we are talking about a robot-merchandisers.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I remember when we considered all the craziest ideas, starting from robotic drones that will fly around the store and ending with robotic automatic cameras that will travel along mono-rails on the ceiling of the store. </font><font style="vertical-align: inherit;">The first thing that we saw and really inspired us was the robots of bossa nova robotics, which cut across American stores (for example, Walmart), giving customers the opportunity to touch the near future a little. </font><font style="vertical-align: inherit;">As a result, we nevertheless came to the conclusion that we need to create a traditional robot on a "chassis-truck" such as a robot vacuum cleaner and equip it with all kinds of cameras and sensors necessary for navigation and photographing shelves.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulation of the problem:</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the statement of the problem is quite simple: we need a prototype robot that can independently (while under the supervision of the operator, but still without controlling the joystick) travel along the shelves of the store, photograph all these shelves and transfer the photos to the server for further processing. </font><font style="vertical-align: inherit;">The robot should look, if not attractive, then at least not frightening, so that shop visitors do not shy away from it. </font><font style="vertical-align: inherit;">This is important, since we planned to conduct real experiments and measurements in real open stores and no one was going to close them for the period of our manipulations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first version of the robot was named after the commander of replicants from the good old, I hope everyone is familiar with the familiar and beloved film of Ridley Scott Blade Runner - Roy (as we will continue to call him).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What Roy consisted of</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chassis:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Swiss motors maxon - Swiss because their Chinese cheap comrades for some reason very quickly burned out in our hands</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 wheels of the omni-wheels type - at that time it seemed to us that we needed exactly omni-wheels so that the robot could quickly and without unnecessary movements change the direction of movement</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base made of aluminum and plastic</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motor controller</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">battery</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUC with ROS on top of Ubuntu inside for navigation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lidar RPLidar A2 for building maps, navigation and localization</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Torso (tower):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aluminum profile frame</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plastic finish</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plastic mounts for cameras printed on a 3D printer</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 USB Bustler Cameras</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUC for taking pictures and sending photos to the server via WiFi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3D camera of depth like Intel IntelliVision, which we still could not connect</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LCD screen for debugging and displaying service and advertising information</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was not difficult to assemble the trolley and body, we spent several months on it. </font><font style="vertical-align: inherit;">In the assembly and adjustment of the trolley we were assisted by several former employees of the TsNII-RTK.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How it all worked and what came of it</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everyone who is familiar with working in ROS can skip this chapter; they are unlikely to find something unique or original in it, but those who are ‚Äúoff topic‚Äù will be interested. </font><font style="vertical-align: inherit;">I‚Äôll tell you right away how all this happened in a real store (we were then tested in the still live and healthy SPAR in Kupchino):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We come to the store, find the rack we need (the prototype was tested on the product category Tea, then another 4-5 product categories were photographed), we find an unoccupied outlet (this, by the way, was quite difficult), and unpack the entire belongings.</font></font></li>
<li> Roy (    ‚Äî  ,  ,     ).<br>
<br>
<img src="https://habrastorage.org/webt/9f/fv/4s/9ffv4sqr2f06gnoon_abdear9bk.jpeg"></li>
<li>  WiFi-     .</li>
<li>   Ubuntu+ROS      ,  Game-Pad   .</li>
<li>  : ROS, Teleop (   ), Gmapping (   ), Rviz (      Roy).</li>
<li>   ‚Äî    ,  Roy             ,          (          ,        Roy   ¬´¬ª  ¬´¬ª).</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the map is built, save it, hammer in the coordinates of the survey points (the beginning of the rack 1 is point ‚ÄúA‚Äù, the end of the rack 1 is point ‚ÄúB‚Äù, the rotation is 90 degrees, the end of the rack 2 is point ‚ÄúC‚Äù. We basically removed the rack in the shape of the letter "G")</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, run the photography script (everything is already without a gamepad, real ‚Äúmagic‚Äù):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roy goes to the given position - point "A". </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roy is deployed in the correct way (with cameras to the shelf), the degrees of rotation are also set in the script.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roy begins to drive slowly along the rack, shooting several times per second with each camera and saving the photo to the NUC. </font><font style="vertical-align: inherit;">In this case, the cameras are synchronized and take photos at the same time.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the same moment, another script starts asynchronously sending photos via WiFi to the server. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roy drives along one rack (point ‚ÄúB‚Äù), stops the cameras for the duration of the turn, makes a 90-degree turn, turns on the cameras again.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It drives along the 2nd rack to point ‚ÄúC‚Äù. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turns off the cameras. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Returns to the starting position (point "A"). </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further work is already directly on the server:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the moment when all the photos are transferred to the server, the server starts gluing photos and the process of recognizing goods on the shelf </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When all processes are completed, in the web interface there are racks with goods marked with goods markup + all the necessary analytics (the share of goods on the shelf, out-of-stock, comparison with the planogram, etc.)</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/7t/jr/im/7tjrimawr197ieul5mwti7im88u.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summing up what we managed to find out</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perhaps the most important point - we can make a prototype of the robot on our own, there is nothing unrealistic about it, the whole system (collecting photos + navigation + data transfer + data processing + data visualization) works, but this is only a prototype</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an interesting and important observation - visitors to the store are not afraid and do not ‚Äúshy away‚Äù the robot - grandmothers just don‚Äôt notice it, children admire it, others are very interested in ‚Äúwhat kind of thing is it and why is it necessary‚Äù, merchandisers worry because it is their direct competitor</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the question of the selection of spare parts must be approached wisely - given the cost, availability, quality</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roy flaws identified after prototype creation and testing</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The biggest problem we had with building a map and the associated navigation problem</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the map was not always built exactly</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">very often it was built poorly from the 1st or 2nd time, it took half an hour to go to build a map</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roy sometimes "lost" even on a good map (this was immediately clear since he started spinning in one place and didn‚Äôt go anywhere else, he had to turn on the gamepad and switch to manual control)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We had such hypotheses about this problem:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">our omni wheels sometimes slipped over the smooth tiles of the store, this could knock down odometer parameters</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roy had too few "eyes", maybe one lidar was not enough for him and it was necessary to add other sensors</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maybe our lidar was not the most correct and accurate or was poorly tuned, maybe the problem was in it, especially considering the complexity of the task (a small distance to the shelf, very long racks)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Other disadvantages:</font></font><br>
<ul>
<li>       ‚Äî           (+ ),        30  60   ,  Roy      2</li>
<li>    (  ),     (      )     </li>
<li>Roy      ,    ,   -     (QR- , bluetooth-  ..)</li>
<li>   ()  ( )     ,      ,      </li>
<li>       (    ,           ,   ,     )</li>
<li>  (  , )    (         10 )</li>
<li>Roy   ,  ,     ,      (  ,    ¬´ ¬ª)</li>
<li>     Roy      (       3-4 ),        </li>
</ul><br>
<h3>   2  (Zhora  Leon)</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The pandemic of the coronavirus has shown that in some situations the use of a robot is not only desirable, but even necessary. </font><font style="vertical-align: inherit;">If we are in a situation where it is better not to leave the house at all, robots, delivery men, cleaners, and analysts could help us in solving a large number of important tasks. </font><font style="vertical-align: inherit;">If you look at our Roy or his brothers from this side, the project looks even more interesting - for example, the idea of ‚Äã‚Äãre-equipping a robot-marchandiser into a robot-disinfector or a robot that monitors the observance of social distance and unobtrusively warns those who crowd in one place or queuing up.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The platform on the basis of which we want to build a new version can not only scan shelves, but also recognize the faces of visitors. </font><font style="vertical-align: inherit;">Other interesting features of such devices could be:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">targeted advertising on LCD screens: from the series I see a woman with a baby - I offer diapers, I see pensioners - I offer goods on stocks;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help customers find products</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">monitoring of shoplifters on the basis of persons</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warehouse inventory, assistance to the logistics department in procurement planning</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc. </font><font style="vertical-align: inherit;">right up to putting goods on shelves</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Summing up, we can say that we would like to see in the 2nd version of the prototype:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">industrial "sexy" design, providing for a bunch of all kinds of "tricks" like a device for communicating with the outside world (speakers, microphone, screens, cameras, indicator of emotions, etc.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">all processes need to be significantly accelerated</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the new device should be easy to scale and relatively cheap</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">need accuracy in navigation and localization</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">need global navigation throughout the store</font></font></li>
<li>         +    </li>
<li>             </li>
</ul><br>
 <b>P.S.  -                 (     ),    ,         .</b><br>
<br>
<b>P.P.S.  ,   ,         .</b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en503604/index.html">Sergey and ‚Äúprogramming is better than sex‚Äù</a></li>
<li><a href="../en503606/index.html">Swift 5.3: What's New?</a></li>
<li><a href="../en503608/index.html">How we searched for virus filters</a></li>
<li><a href="../en503610/index.html">Why not make your own Lisp for the web?</a></li>
<li><a href="../en503612/index.html">Kubernetes best practices. Mapping external services</a></li>
<li><a href="../en503620/index.html">News from the world of OpenStreetMap No. 512 (05.05.2020-11.05.2020)</a></li>
<li><a href="../en503624/index.html">The digest of fresh materials from the world of the front-end for the last week No. 416 (May 18-24, 2020)</a></li>
<li><a href="../en503626/index.html">Testing. ISTQB certification errors or solve a million examples</a></li>
<li><a href="../en503630/index.html">Augmented reality glasses: where are we now?</a></li>
<li><a href="../es486176/index.html">Memo de correspondencia de correo electr√≥nico corporativo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>