<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🚒 🌆 💺 Entendendo a Atividade Android launchMode: standard, singleTop, singleTask e singleInstance 🤱🏼 👌🏻 🌆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A tradução do artigo foi preparada especialmente para estudantes avançados no desenvolvimento do Android .
 
 
 
 Activity é um dos conceitos mais mar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Entendendo a Atividade Android launchMode: standard, singleTop, singleTask e singleInstance</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/493802/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tradução do artigo foi preparada especialmente para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estudantes avançados no desenvolvimento do Android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/rz/oc/v4/rzocv4m1jq5tpiy0oisluhhgrfs.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Activity é um dos conceitos mais marcantes do Android (o sistema operacional móvel mais popular com uma arquitetura de gerenciamento de memória bem projetada que implementa perfeitamente multitarefa). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De uma forma ou de outra, com o lançamento da Atividade na tela, nem tudo é tão simples. A maneira como foi executada também é importante. Existem muitas nuances neste tópico. Um dos realmente importantes é o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">launchMode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sobre o qual falaremos neste artigo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada atividade é criada para trabalhar com objetivos diferentes. Alguns deles foram projetados para funcionar separadamente com cada Intent, por exemplo, atividade enviada para compor email no cliente de email. Enquanto outros são projetados para funcionar como um singleton, como uma caixa de correio de atividades.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É por isso que é importante indicar se você precisa criar uma nova atividade ou usar uma existente, caso contrário, isso pode levar a UX incorreto ou travar. </font><font style="vertical-align: inherit;">Graças aos desenvolvedores do kernel do Android, isso é fácil de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">executar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o </font><b><font style="vertical-align: inherit;">launchMode</font></b><font style="vertical-align: inherit;"> , que foi projetado especificamente para isso.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definição de LaunchMode </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essencialmente, podemos definir o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">launchMode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diretamente como um atributo de tag </font></font><code><code>&lt;</code>activity&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em </font></font><code>AndroidManifest.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".SingleTaskActivity"</span>
    <span class="hljs-attr">android:label</span>=<span class="hljs-string">"singleTask launchMode"</span>
    <span class="hljs-attr">android:launchMode</span>=<span class="hljs-string">"singleTask"</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem 4 tipos de launchMode disponíveis. Vamos olhar para eles um de cada vez. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">padrão</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Este é o modo padrão. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O comportamento de uma atividade definida para esse modo sempre criará uma nova atividade para trabalhar separadamente com cada intenção enviada. De fato, se 10 Intenções foram enviadas para compor um email, 10 Atividades devem ser iniciadas para atender cada Intenção separadamente. Como resultado, um número ilimitado dessas atividades pode ser iniciado no dispositivo. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comportamento no Android pré-pirulito</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esse tipo de atividade será criado e colocado no topo da pilha na mesma tarefa que enviou a Intenção.</font></font><br>
 <br>
 <img src="https://habrastorage.org/webt/ne/n2/2u/nen22uybqupb_f6jnw5hvjz90rc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A imagem abaixo mostra o que acontece quando compartilhamos a imagem com a atividade padrão. Ele será empilhado na mesma tarefa descrita acima, embora seja de aplicativos diferentes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/t5/fz/wpt5fzwohvycuouxans3y_t11vu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E é isso que você verá no gerenciador de tarefas. (Pode parecer um pouco estranho) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s8/u_/ii/s8u_iioeu_3jyfu9e2va7xypr54.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se mudarmos o aplicativo para outra tarefa e voltarmos para a Galeria, ainda veremos que o launchMode padrão é colocado na parte superior da tarefa da Galeria. Como resultado, se precisarmos fazer algo na Galeria, devemos primeiro terminar nosso trabalho nesta Atividade adicional. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comportamento no Android Lollipop</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se essas atividades estiverem relacionadas ao mesmo aplicativo, o comportamento será o mesmo da implementação anterior ao Lollipop - colocando na pilha em cima da tarefa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/pm/90/ljpm90f0v8oh12ygrs0hrqxnmxa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Porém, caso o Intent seja enviado de outro aplicativo, uma nova tarefa será criada e a Atividade recém-criada será colocada como raiz, conforme mostrado abaixo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/bn/ci/rebncivt1yw-otyjkghmjmevxss.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso é o que você verá no gerenciador de tarefas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/st/vh/us/stvhusvjhnp8tmqogzkrenle3am.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso ocorre porque o sistema de gerenciamento de tarefas foi modificado no Lollipop - tornou-se melhor e mais compreensível. No Lollipop, você pode simplesmente voltar para a Galeria, pois está em uma tarefa diferente. Você pode enviar outra Intenção, uma nova tarefa será criada que servirá a Intenção da mesma maneira que a anterior. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ia/iz/p_/iaizp_8fdhzzyft95zupxt89q54.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo desse tipo de atividade é Atividade de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">composição de email</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font><b><font style="vertical-align: inherit;">Atividade </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de postagem de status da rede social</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(atualização de status nas redes sociais). </font><font style="vertical-align: inherit;">Se você tem uma atividade em mente que processa cada intenção separadamente, está pensando na </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atividade padrão</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">singleTop</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O próximo modo é </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">singleTop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele se comporta da mesma maneira que o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">padrão</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que significa que você pode criar quantas instâncias da atividade SingleTop desejar. </font><font style="vertical-align: inherit;">A única diferença é que, se já existe uma instância de atividade com o mesmo tipo no topo da pilha na tarefa de chamar, nenhuma nova atividade será criado, em vez disso, a intenção será enviado para a instância Atividade existente através do método </font></font><code>onNewIntent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/uq/dj/khuqdjmchshqsq4cvxsybngidg8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No modo singleTop, considere manipular o Intent recebido </font></font><code>onCreate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>onNewIntent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que ele funcione em todos os casos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo do uso desse modo é a função de pesquisa. Vamos pensar em criar uma caixa de pesquisa que direcione você para SearchActivity para ver os resultados da pesquisa. Para um melhor UX, geralmente sempre colocamos a caixa de pesquisa na página de resultados da pesquisa para permitir que o usuário realize a próxima pesquisa sem voltar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora imagine que, se sempre lançarmos uma nova SearchActivity para exibir um novo resultado de pesquisa, obteremos 10 novas Atividades para 10 iterações da pesquisa. Seria muito estranho voltar, pois você teria que clicar 10 vezes para percorrer todos os resultados da pesquisa para retornar à atividade raiz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em vez disso, se o SearchActivity já estiver no topo da pilha, é melhor enviar um Intent para uma instância Activity existente e deixá-lo atualizar o resultado da pesquisa. Agora, haverá apenas uma SearchActivity localizada na parte superior da pilha, e você pode simplesmente clicar no botão Voltar uma vez para retornar à Atividade anterior. Isso faz mais sentido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De qualquer forma, o singleTop funciona na mesma tarefa que o chamador. Se você espera que a Intenção seja enviada para uma Atividade existente, colocada em cima de qualquer outra tarefa, devo desapontá-lo ao dizer que não funciona mais. Caso o Intent seja enviado de outro aplicativo para a atividade SingleTop, a nova Atividade será iniciada no mesmo aspecto que para o launchMode padrão (</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pré-pirulito: colocado em cima da tarefa de chamada, pirulito: uma nova tarefa será criada)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">singleTask</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este modo é muito diferente de standart e singleTop. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A atividade com singleTask launchMode pode ter apenas uma instância no sistema (ala singleton)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se um exemplo Actividade já existe no sistema, todo a tarefa que prende a instância irá ser movida para cima, e a intenção será fornecida através do método </font></font><code>onNewIntent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Caso contrário, uma nova atividade será criada e colocada na tarefa correspondente. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhando em um aplicativo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se não houvesse uma instância única do ActivityTask no sistema, uma nova será criada e simplesmente será colocada na pilha na mesma tarefa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/gd/v5/tlgdv5pp1aup44lacg-a39l4qtg.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas, se existir, todas as atividades localizadas acima desta atividade de tarefa única serão automaticamente brutalmente destruídas adequadamente (o ciclo de vida é concluído) para exibir a atividade desejada no topo da pilha.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao mesmo tempo, o Intent será enviado para a atividade SingleTask através de um método maravilhoso </font></font><code>onNewIntent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pr/7l/e9/pr7le9ygampc5au3-slsqydvakq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não faz sentido do ponto de vista da experiência do usuário, mas foi projetado desta maneira ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode observar uma nuance mencionada na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentação</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O sistema cria uma nova tarefa e instancia uma instância de atividade na raiz da nova tarefa. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas, na prática, parece que isso não funciona como descrito</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A atividade SingleTask ainda é colocada na parte superior da pilha de atividades da tarefa, como pode ser visto no resultado do comando </font></font><code>dumpsys activity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ta</font></font><br>
<br>
<pre><code class="java hljs">sk id #<span class="hljs-number">239</span>
  TaskRecord{<span class="hljs-number">428</span>efe30 #<span class="hljs-number">239</span> A=com.thecheesefactory.lab.launchmode U=<span class="hljs-number">0</span> sz=<span class="hljs-number">2</span>}<font></font>
  Intent { act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] flg=<span class="hljs-number">0x10000000</span> cmp=com.thecheesefactory.lab.launchmode/.StandardActivity }<font></font>
    Hist #<span class="hljs-number">1</span>: ActivityRecord{<span class="hljs-number">429</span>a88d0 u0 com.thecheesefactory.lab.launchmode/.SingleTaskActivity t239}<font></font>
      Intent { cmp=com.thecheesefactory.lab.launchmode/.SingleTaskActivity }<font></font>
      ProcessRecord{<span class="hljs-number">42243130</span> <span class="hljs-number">18965</span>:com.thecheesefactory.lab.launchmode/u0a123}<font></font>
    Hist #<span class="hljs-number">0</span>: ActivityRecord{<span class="hljs-number">425f</span>ec98 u0 com.thecheesefactory.lab.launchmode/.StandardActivity t239}<font></font>
      Intent { act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] flg=<span class="hljs-number">0x10000000</span> cmp=com.thecheesefactory.lab.launchmode/.StandardActivity }<font></font>
      ProcessRecord{<span class="hljs-number">42243130</span> <span class="hljs-number">18965</span>:com.thecheesefactory.lab.launchmode/u0a123}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você deseja que o SingleTask Activity se comporte conforme descrito no documento: crie uma nova tarefa e coloque Activity como a atividade raiz. Você precisa definir um atributo </font></font><code>taskAffinity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a atividade SingleTask da seguinte maneira.</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".SingleTaskActivity"</span>
    <span class="hljs-attr">android:label</span>=<span class="hljs-string">"singleTask launchMode"</span>
    <span class="hljs-attr">android:launchMode</span>=<span class="hljs-string">"singleTask"</span>
    <span class="hljs-attr">android:taskAffinity</span>=<span class="hljs-string">""</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse será o resultado quando tentarmos executar </font></font><code>SingleTaskActivity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qn/au/9f/qnau9ftfyqxjtq8yty5cjlfaxiq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/ln/pk/d4/lnpkd4alkah9kvmiphylvk8mx6a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sua tarefa é decidir se deseja usar </font></font><code>taskAffinity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou não, dependendo do comportamento desejado da Atividade. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interagindo com outro aplicativo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Assim que o Intent for enviado de outro aplicativo e nenhuma instância de Atividade for criada no sistema, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma nova tarefa será criada</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com uma nova Atividade, colocada como a Atividade raiz. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/wv/9p/bewv9pxsnqrp9rj2is8sfs1ka1m.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/7b/wc/_b/7bwc_bbpbwsbw0man-59yupltyw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se não houver tarefa que seja o proprietário da atividade singleTask de chamada, uma nova atividade será exibida. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0e/eo/j5/0eeoj5h6thjdff3izlqcttpphde.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se uma instância de uma atividade existir em uma tarefa, a tarefa inteira será movida para cima e, para cada atividade individual localizada acima de uma única atividade da tarefa, o ciclo de vida será concluído</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se o botão Voltar for pressionado, o usuário deverá executar a Atividade na pilha antes de retornar à tarefa de chamada. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dy/if/9d/dyif9dvekt6pictwq7znk7bqb-i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo do uso desse modo é qualquer Atividade do Ponto de Entrada, por exemplo, a página Caixa de Entrada de um cliente de email ou uma linha do tempo da rede social. </font><font style="vertical-align: inherit;">Essas atividades não assumem mais de uma instância; portanto, a singleTask fará seu trabalho perfeitamente. </font><font style="vertical-align: inherit;">De qualquer forma, você deve usar este modo com sabedoria, pois nesse modo as atividades podem ser destruídas sem a confirmação do usuário, conforme descrito acima.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instância única</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse modo é muito semelhante ao singleTask, onde apenas uma instância de uma Atividade poderia existir em um sistema. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A diferença é que uma tarefa que possui essa atividade pode ter apenas uma atividade - uma que possui um atributo singleInstance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se outra atividade for chamada desse tipo de atividade, uma nova tarefa será criada automaticamente para acomodar essa nova atividade. Da mesma forma, se a atividade singleInstance for chamada, uma nova tarefa será criada para hospedar essa atividade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De qualquer forma, o resultado é bastante estranho. A partir das informações fornecidas</font></font><code>dumpsys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, é claro que existem duas tarefas no sistema, mas apenas uma aparece no gerenciador de tarefas, dependendo de qual delas está no topo. Como resultado, embora exista uma tarefa que ainda esteja sendo executada em segundo plano, não podemos alterá-la novamente para o primeiro plano. Não faz nenhum sentido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É o que acontece quando uma única atividade de instância é chamada enquanto uma atividade já existe na pilha. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ea/2v/qy/ea2vqyvflpzuia5elbfl7cd_fzm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui está o que vemos no gerenciador de tarefas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5a/lr/7s/5alr7sfn0d253r5-wi90zpmaoc4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como essa tarefa pode ter apenas uma atividade, não podemos mais voltar à tarefa nº 1. A única maneira de fazer isso é reiniciar o aplicativo a partir do iniciador, mas, como resultado, a tarefa singleInstance ficará oculta em segundo plano.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De qualquer forma, existem algumas soluções alternativas para esse problema. </font><font style="vertical-align: inherit;">Como na atividade singleTask, basta atribuir um atributo </font></font><code>taskAffinity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à atividade singleInstance, permitindo a existência de várias tarefas no gerenciador de tarefas.</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".SingleInstanceActivity"</span>
    <span class="hljs-attr">android:label</span>=<span class="hljs-string">"singleInstance launchMode"</span>
    <span class="hljs-attr">android:launchMode</span>=<span class="hljs-string">"singleInstance"</span>
    <span class="hljs-attr">android:taskAffinity</span>=<span class="hljs-string">""</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora a imagem faz mais sentido. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4g/g7/sr/4gg7srssanlpsftak21yt7ge4o4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este modo é raramente usado. </font><font style="vertical-align: inherit;">Alguns dos casos de uso práticos são um ativador de atividades ou um aplicativo para o qual você tem 100% de certeza de que deve haver apenas uma atividade. </font><font style="vertical-align: inherit;">De qualquer forma, sugiro que você não use este modo, a menos que haja uma emergência.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sinalizadores de intenção</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além </font></font><code>AndroidManifest.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de definir o </font><font style="vertical-align: inherit;">modo de inicialização diretamente para </font><font style="vertical-align: inherit;">, também podemos ajustar o comportamento usando uma ferramenta chamada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intent flags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , por exemplo:</font></font><br>
<br>
<pre><code class="java hljs">Intent intent = <span class="hljs-keyword">new</span> Intent(StandardActivity.<span class="hljs-keyword">this</span>, StandardActivity.class);<font></font>
intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);<font></font>
startActivity(intent);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
será iniciado </font></font><code>StandardActivity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com a condição singleTop launchMode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem algumas bandeiras com as quais você pode trabalhar. </font><font style="vertical-align: inherit;">Você pode encontrar mais informações sobre isso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que você tenha achado este artigo útil =) </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saiba mais sobre o curso</font></font></a></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493792/index.html">Relatórios do segundo Meetup do ROS sobre navegação por robôs</a></li>
<li><a href="../pt493794/index.html">Como o escritório da FunCorp em Moscou mudou para udalenka em 1 dia</a></li>
<li><a href="../pt493796/index.html">4 melhores padrões de design para testes automatizados (e 86 mais)</a></li>
<li><a href="../pt493798/index.html">Não há design no 1C UX / UI</a></li>
<li><a href="../pt493800/index.html">Probabilidade empírica</a></li>
<li><a href="../pt493804/index.html">Jogador falando na framboesa</a></li>
<li><a href="../pt493808/index.html">Linearizando código assíncrono com corutin</a></li>
<li><a href="../pt493810/index.html">Cinco anos de intenso desenvolvimento do mercado para reconhecimento de documentos</a></li>
<li><a href="../pt493814/index.html">Como conduzimos entrevistas em Barcelona</a></li>
<li><a href="../pt493816/index.html">Guia Git Número da peça 1: tudo o que você precisa saber sobre o diretório .git</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>