<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🎓 👩🏿‍✈️ 👨‍🎓 ReddコンプレックスのFPGAでのCPUおよびプロセッサ通信の例でストリーミングプロトコルを使用した最初の実験 🛌🏽 🧗🏾 📴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="以前の記事では、すでにAvalon-MMバスに出会いました。MMはメモリマップド、つまりメモリに投影されたメモリを表します。このタイヤはかなり用途が広い。複数のマスター（マスター）と複数のスレーブデバイスを接続できます。 NIOS IIプロセッサにはハーバードアーキテクチャがあり、コマンドバスとデー...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ReddコンプレックスのFPGAでのCPUおよびプロセッサ通信の例でストリーミングプロトコルを使用した最初の実験</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462253/"><img src="https://habrastorage.org/webt/hx/9r/u0/hx9ru01kpi9-x1z8jztv7uaemjm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前の記事では、すでに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-MM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">出会いました</font><b><font style="vertical-align: inherit;">。MM</font></b><font style="vertical-align: inherit;">はメモリマップド、つまりメモリに投影されたメモリを表します。このタイヤはかなり用途が広い。複数のマスター（マスター）と複数のスレーブデバイスを接続できます。 NIOS IIプロセッサにはハーバードアーキテクチャがあり、コマンドバスとデータバスが異なるため、すでに2つの主要なデバイス（命令マスターとデータマスター）を一度に接続しましたが、多くの作成者が同じ共通のデバイスに接続して、外部からのソフトウェア開発を簡素化していますバスに。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バス上のブロックにダイレクトメモリアクセス（DMA）機能がある場合は、バスのマスターも含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、このタイヤの主な不便はこの事実に基づいています（多くのリーダー、多くのフォロワー）。</font><font style="vertical-align: inherit;">スレーブを設計したとき、アドレスをデコードする必要がありました。</font><font style="vertical-align: inherit;">私がたまたま私のリーダーになったとき、仲裁にはもっと大騒ぎがありました。</font><font style="vertical-align: inherit;">しかし、Reddでの開発はプロジェクトの補助的な部分であり、あまり多くの人件費を必要とすべきではないという主張は、赤い糸です。</font><font style="vertical-align: inherit;">そして、私たちが日常から自分自身を解放することができるなら、私たちはそれから自分を解放しなければなりません。</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ns/cc/m1/nsccm1g4bldwl-4okgx-puukhyk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイクルのすべての記事：</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReddにインストールされたFPGA用の最も単純な「ファームウェア」の開発、および例としてメモリテストを使用したデバッグ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReddにインストールされたFPGA用の最も単純な「ファームウェア」の開発。</font><font style="vertical-align: inherit;">パート2.プログラムコード</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPGAベースのプロセッサシステムに埋め込むための独自のコアの開発</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     Redd     </a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちがすでに知っている</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon Interface Specifications</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font><font style="vertical-align: inherit;">（通常、直接リンクは提供しません。それらは常に変更されるため、ネットワーク全体がリンク切れの記事で散らかされているため、検索エンジンに名前を入力することで現在の位置を見つけるのが簡単です）は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-MM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスに加えて</font><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスもあります</font><b><font style="vertical-align: inherit;">。ST</font></b><font style="vertical-align: inherit;">はStream、つまりストリーミングを表します。実際には、送信されたデータがストリーム構造を持っていることがよくあります。はい、ハードドライブの古典的なセクターです。固定サイズです。最初から最後まで渡す必要があります。アドレス領域で考えても、アドレスは直線的に増加します。また、FIFOブロックをストレージに使用する場合、その内部のアドレスは完全に私たちから隠されています。彼らはそうですが、彼らとの仕事は私たちの関心事ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じことが他の多くのストリーミングデータにも当てはまります。データは常に最初から最後まで、順次リポジトリに配置されます。これはまさにそのようなデータを転送するために使用されるストリーミングプロトコルです。明示的なアドレス指定がないことに加えて、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスは</font><font style="vertical-align: inherit;">、2つのデバイス（ソースとレシーバー）を常に接続するという点で興味深いものです。常に2つあります。 1つのデバイスは常にソースで、2番目のデバイスは常にレシーバーです。したがって、このバスの調停の問題は関係ありません。これは、このバスで接続されているデバイスの典型的なペアは次のようになります。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/z_/ix/tz/z_ixtzpnxmb0fhhyoxgsqnydhvc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、このバスの典型的な信号：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ua/bh/ku/uabhkulgiofulvfomh0mw-mdz7g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、</font><b><font style="vertical-align: inherit;">エラー</font></b><font style="vertical-align: inherit;">ライン</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションで、当社が割り当てたバイナリエラーコードを送信します。エラーコードはないと言えます。そして、上で見たように、チャネル番号ラインは、逆多重化がさらに実行される場合にのみ必要です。そうでない場合、チャネル番号は必要ありません。今はそれなしでやります。 3つのラインが残ります。実際には、データ、レディ信号、およびデータ確認信号（ストローブ）です。さて、バスは同期しているので、別のクロック信号。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドキュメンテーションから、さらに3つの信号が可能であり、個別のパケットの伝送特性をバスに追加する</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/wa/rc/ixwarc27-jx3cqndio3gzxaim_g.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ことがわかり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">一般に、バスは非常に興味深いものであり、今日はそれを使って実験を開始します。すでにご存じのとおり、FPGAは</font><b><font style="vertical-align: inherit;">FT245-SYNC</font></b><font style="vertical-align: inherit;">モードで動作</font><font style="vertical-align: inherit;">する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT2232H</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブリッジを介してReddコンプレックスのUSBバスに接続されてい</font><font style="vertical-align: inherit;">ます</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。厳密に言うと、このインターフェイスを通過するデータは完全にストリーミングデータです。今日は、このデータをNIOS IIベースのプロセッサシステムに転送する方法を学びます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT245-SYNC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコルは</font><font style="vertical-align: inherit;">ストリーミングですが、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスに完全には準拠していません</font><font style="vertical-align: inherit;">。チップレッグを節約するために、双方向のデータバスがあり、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスは</font><font style="vertical-align: inherit;">単方向です。したがって、プロトコルを一致させるが一致しないブロックを作成する必要があります。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">以前の記事の</font></a><font style="vertical-align: inherit;"> 1つで</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT245-SYNC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコル</font><font style="vertical-align: inherit;">についてすでに知っ</font><font style="vertical-align: inherit;">ています</font><font style="vertical-align: inherit;">。その説明は、ドキュメント</font><b><font style="vertical-align: inherit;">AN_130 FT2232H FT245スタイルの同期FIFOモードで使用</font></b><font style="vertical-align: inherit;">されていることに記載されてい</font><b><font style="vertical-align: inherit;">ます。</font></b></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、ブリッジからFPGAへの転送の典型的なタイミング図です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ea/-y/ly/ea-ylyf7hie2zal-gfjzyp_ehwy.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、プログラマーとして、送信パケットの開始と終了が明確にマークされていることに非常に興味があります。まあ、UDPプロトコルのロジックをより論理的にするには、送信がTCPスタイルである場合、特別なベンチマークデータをストリームに追加する必要があります。これは、私のプログラミング、作業、およびプロセッササイクルに費やされます... RXFラインのように見えますこれで私たちを助けることができます。チェック中... </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">前の記事</font></a><font style="vertical-align: inherit;">で作成した、パフォーマンスを測定するためのFPGA「ファームウェア」を入力します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そしてオシロスコーププローブをRXFラインに接続します。</font><font style="vertical-align: inherit;">Redd中央処理装置のテストプログラムとして、パフォーマンスの測定にも使用されるデータベースを使用します。大量のデータを送信するのではなく、0x400バイトのモノリシックブロックを送信します。</font></font><br>
<br>
<pre><code class="plaintext hljs">	uint8_t temp [maxBlockSize];<font></font>
	memset (temp,0,sizeof (temp));<font></font>
<font></font>
	uint32_t dwWritten;<font></font>
	FT_Write(ftHandle0, temp, 0x400, &amp;dwWritten);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RXFラインに次の画像が表示され</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/0-/yc/ic/0-ycici6rpo4urdmg8nlvyuem3w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。マイクロ回路が0x200バイトのバッファーを受信し（これは、1つのUSB2.0 HSパケットで受信できる量です）、チャネルに送信します。</font><font style="vertical-align: inherit;">一般的に、これは奇妙です。ドキュメントには、各方向で2つのバッファが使用されると記載されているためです。</font><font style="vertical-align: inherit;">送信中に、2番目のバッファーがいっぱいになる時間があったはずです。</font><font style="vertical-align: inherit;">ああ。</font><font style="vertical-align: inherit;">その充填の終わりは明らかに遅いです。</font><font style="vertical-align: inherit;">実際、これはパフォーマンスが理論上の毎秒52メガバイトに達しない理由を示しています。時間の大部分（50％ではない）が転送されないだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、何らかの方法で、パケットサイズが0x200バイトを超えない場合にのみ、負のRXFエッジでパケットの先頭を検出できることがわかりました。少量のデータを含むコマンドのみをデバイスに送信すると、これはかなり達成可能です。ただし、大量のデータストリームを送信する場合は、そのロジックがUART（または、たとえば、TCPチャネル）と同様の連続チャネルを使用して、パケット境界を純粋にプログラムで強調表示する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、プレゼンテーションを簡単にするために、ストリーミングバージョンをベースにしています。今日はパッケージを考慮しません。ええと、どのバージョンの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス</font><font style="vertical-align: inherit;">がベースとして採用されているかは明らかです。ブロックの設計を開始します。上記のように、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT245FIFO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス</font><b><font style="vertical-align: inherit;">は</font></b><font style="vertical-align: inherit;">双方向であり、バス</font><b><font style="vertical-align: inherit;">は</font></b><font style="vertical-align: inherit;">ブリッジであるため、ブリッジだけでなくスイッチも</font><b><font style="vertical-align: inherit;">作成</font></b><font style="vertical-align: inherit;">する</font><b><font style="vertical-align: inherit;">必要が</font></b><font style="vertical-align: inherit;">あります。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単方向。つまり、</font><font style="vertical-align: inherit;">出力と入力の</font><font style="vertical-align: inherit;">2つの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスを同時に作成する必要が</font><font style="vertical-align: inherit;">あります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/hl/fm/hrhlfm67sw8-xemukkwo47lg3va.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要なロジックを実装するオートマトンをゆっくりと開発し始めています。もちろん、この記事では、このロジックを最大限に簡略化します。 FPGAからPCにデータを転送するところから始めましょう。このプロセスは少し単純です（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前回の記事で説明し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たOEラインの状態を切り替える必要はありません</font><font style="vertical-align: inherit;">）。つまり、シンクポートを実装しています。</font><b><font style="vertical-align: inherit;">Avalon-ST</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
バスの側面から、</font><font style="vertical-align: inherit;">次の動作モードを選択しました（ドキュメントには非常に多くの動作モードがありますが、</font><b><font style="vertical-align: inherit;">FT245-SYNC</font></b><font style="vertical-align: inherit;">とのインターフェースの場合、</font><b><font style="vertical-align: inherit;">これが</font></b><font style="vertical-align: inherit;">最も近くなります）：</font><font style="vertical-align: inherit;">
信号の方向を思い出させてください：</font><font style="vertical-align: inherit;">
つまり、バスでの確認を待ちます（</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
 <br>
<img src="https://habrastorage.org/webt/f_/rh/nm/f_rhnmctxwtl01xdlaiioun81jk.png"> <br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/cc/r-/sdccr--rw2vsk1xitskseckafiq.png"> <br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有効</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、データをラッチし、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">準備完了</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラインでこの事実を評価し</font><font style="vertical-align: inherit;">ます。</font><b><font style="vertical-align: inherit;">FT245_FIFO</font></b></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
側から</font><font style="vertical-align: inherit;">見る</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコルは次のよう</font><b><font style="vertical-align: inherit;">になり</font></b><font style="vertical-align: inherit;">ます</font><b><font style="vertical-align: inherit;">。TXE</font></b></font><br>
 <br>
<img src="https://habrastorage.org/webt/d-/nf/ki/d-nfkirvzei94d3kvkhntyea7pi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
信号を待ち、WR＃信号でデータをゲートする必要があることがわかります（これらの信号の極性は逆です）。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TXE＃の機能は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">準備完了</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と非常に似て</font><font style="vertical-align: inherit;">おり、WR＃は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有効</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">似</font><font style="vertical-align: inherit;">てい</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。詳細は少し異なりますが、ロジックは似ています。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのラインの最も単純なコミュテーションが実行される単一の状態toPCを単一化できることがわかりました。この状態になるための条件は、両方の送信準備が整っていること、つまり（TXE＃== 0）AND（有効== 1）です。準備がいくらかなくなるとすぐに、アイドル状態に戻ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのオートマトンの遷移グラフは単純であることがわかりました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/gb/j9/cigbj9hrioumzbnck6pyeevv1ia.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
切り替えテーブルは次のようになります（信号名があいまいで、インデックスが追加されています。名前は一意です-インデックスはありません）。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信号</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToPCステータス</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の条件</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WR＃</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT（validSink）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readySink</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT（TXE＃）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DATAFT245_FIFO</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DataSink</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SourceからFT245_FIFOへの少し複雑な転送に移ります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">見</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">た</font></a><font style="vertical-align: inherit;">ように</font><font style="vertical-align: inherit;">、複雑なのはOE＃信号を使用して方向を切り替える</font><font style="vertical-align: inherit;">ことです</font><b><font style="vertical-align: inherit;">。Avalon_ST</font></b></font><br>
 <br>
<img src="https://habrastorage.org/webt/al/xu/1-/alxu1-uqzen0dpj4n8bbgcruyck.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
バスの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてが以前と同じなので、画像は2回目に表示されませんが、現在はソースの位置にあります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、RXF＃行は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有効な</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">対応し</font><font style="vertical-align: inherit;">、RD＃行は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">準備ができた</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行に</font><font style="vertical-align: inherit;">対応し</font><font style="vertical-align: inherit;">て</font><b><font style="vertical-align: inherit;">い</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さて、結構です、いくつかの状態をマシンに追加</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pu/gs/fm/pugsfmp11c6b79fi8cwfud-wm-q.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
します</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">そして、この状態でアクティブな信号の次のロジック：</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信号</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropOE</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fromPC</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の条件</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OE＃</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RD＃</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT（readySource）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情報源</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意の値</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DATAFT245_FIFO</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意の値</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有効なソース</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT（RXF＃）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スキームが最も理想的ではなかったことは明らかです。バッファオーバーランまたはアンダーランに関連するさまざまなニュアンスがあります。ただし、データが失われることはありませんが、最適化のためには、どこかから開始する必要があります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発した理論をSystemVerilogコードに転送し始めます。確かに、SystemVerilogのすべての機能を使用できるわけではありません。</font><font style="vertical-align: inherit;">実際の開発環境でこの言語の美しい機能の実用的な合成可能性をテストし</font><font style="vertical-align: inherit;">た</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大きな記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を書きました</font><font style="vertical-align: inherit;">。システムには</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-STタイプの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスが2つあるため、ここではインターフェースの使用を求めます</font><font style="vertical-align: inherit;">。ああ、ああ。ここにテストコードがあります：</font></font><br>
<pre><code class="plaintext hljs">interface AvalonST #(parameter width=8)(input clk);<font></font>
logic [width-1:0] data;<font></font>
logic 		  ready;<font></font>
logic 		  valid;<font></font>
modport source (input clk, ready, output data,valid);<font></font>
modport sink (input clk, data, valid, output ready);<font></font>
endinterface<font></font>
<font></font>
module FT245toAvalonST<font></font>
(<font></font>
    AvalonST.source source,<font></font>
    AvalonST.sink sink<font></font>
);<font></font>
<font></font>
//assign source.ready = sink.valid;<font></font>
assign sink.ready = source.valid;<font></font>
endmodule<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはメインコンパイラで完全に合成されます（コメントを削除するとコメント行が発生し、シンセサイザがすべてを正しく解釈することを確認</font><font style="vertical-align: inherit;">するエラーが</font><b><font style="vertical-align: inherit;">発生</font></b><font style="vertical-align: inherit;">します）が、このコードのコンポーネントの</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyze Synthesis Files</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタン</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">チェック</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、タイプ</font><b><font style="vertical-align: inherit;">AvalonSTが</font></b><font style="vertical-align: inherit;">不明</font><font style="vertical-align: inherit;">であるというエラーが</font><b><font style="vertical-align: inherit;">生成さ</font></b><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">つまり、そこでの分析はSystemVerilogではなく、純粋なVerilogに関するものです。</font><font style="vertical-align: inherit;">それは残念だ。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/4x/ju/ma/4xjumaitxzkw5tig_pdponziq38.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、言語は正しく決定され、アナライザーだけがポート間のインターフェースを理解しません。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/tp/vm/gn/tpvmgnmidvtcb1e5ngfteokprpi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、醜い古い構文を使用する必要があります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この構文を使用して、モジュールインターフェイスを取得します。</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">module FT245toAvalonST<font></font>
(<font></font>
	input			clk,<font></font>
	input			reset,<font></font>
	<font></font>
	inout	  		[7:0] ft245_data,<font></font>
	input	 logic		ft245_rxf,<font></font>
	input	 logic		ft245_txe,<font></font>
	output logic		ft245_rd,<font></font>
	output logic		ft245_wr,<font></font>
	output logic		ft245_oe,<font></font>
	output logic		ft245_siwu,<font></font>
	<font></font>
	input	 logic		source_ready,<font></font>
	output logic		source_valid,<font></font>
	output logic[7:0] source_data,<font></font>
	<font></font>
	output logic		sink_ready,<font></font>
	input	 logic		sink_valid,<font></font>
	input  logic[7:0]	sink_data<font></font>
	<font></font>
);<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
失礼なヴィンテージですが、何ができますか。</font></font><br>
 <br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フリルのないオートマトンの遷移グラフを実現します。</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">//   <font></font>
enum {idle, toPC, dropOE, fromPC} state = idle;<font></font>
<font></font>
//    <font></font>
always_ff @(posedge clk,posedge reset)<font></font>
begin<font></font>
	if (reset == 1)<font></font>
	begin<font></font>
		state &lt;= idle;<font></font>
	end else<font></font>
	begin<font></font>
		case (state)<font></font>
		idle: begin<font></font>
				if ((ft245_txe == 0) &amp;&amp; (sink_valid == 1))<font></font>
					state &lt;= toPC;<font></font>
				else if ((ft245_rxf == 0)&amp;&amp;(source_ready == 1))<font></font>
					state &lt;= dropOE;<font></font>
				end<font></font>
		toPC: begin<font></font>
				if (!((ft245_txe == 0) &amp;&amp; (sink_valid == 1)))<font></font>
					state &lt;= idle;<font></font>
				end<font></font>
		dropOE: begin<font></font>
					state &lt;= fromPC;<font></font>
				end<font></font>
		fromPC: begin<font></font>
				if (!((ft245_rxf == 0)&amp;&amp;(source_ready == 1)))<font></font>
							state &lt;= idle;<font></font>
				end<font></font>
		endcase<font></font>
	end<font></font>
end<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、出力の制御には説明が必要です。 </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストールの一部は「額」で行われます。</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">//   <font></font>
//   ,        ,<font></font>
//  -    .<font></font>
always_comb<font></font>
begin<font></font>
	ft245_oe &lt;= 1;<font></font>
	ft245_rd &lt;= 1;<font></font>
	ft245_wr &lt;= 1;<font></font>
	source_valid &lt;= 0;<font></font>
	sink_ready &lt;= 0;<font></font>
	<font></font>
	//     ,<font></font>
	//     assign-<font></font>
<font></font>
	case (state)<font></font>
		idle: begin<font></font>
				end<font></font>
		toPC: begin<font></font>
					ft245_wr &lt;= !(sink_valid);<font></font>
					sink_ready &lt;= !(ft245_txe);<font></font>
				end<font></font>
		dropOE: begin<font></font>
					ft245_oe &lt;= 0;<font></font>
				end<font></font>
		fromPC: begin<font></font>
					ft245_oe &lt;= 0;<font></font>
					ft245_rd &lt;= !(source_ready);<font></font>
					source_valid &lt;= !(ft245_rxf);<font></font>
				end<font></font>
		endcase<font></font>
	<font></font>
end<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、双方向データバスの場合は、一般的なソリューションを適用する必要があります。</font><font style="vertical-align: inherit;">私たちが覚えているように、それは次のようにインターフェース部分で宣言されています：</font></font><br>
<br>
<pre><code class="plaintext hljs">	inout	  		[7:0] ft245_data,
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそれからの読み取りは通常の方法で行うことができます。</font><font style="vertical-align: inherit;">このケースでは、すべてのデータを出力</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスのデータにラップするだけです</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">//         <font></font>
assign source_data = ft245_data;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、一般的には、バスからいつでも好きな方法で読み取ることができます。</font><font style="vertical-align: inherit;">ただし、マルチプレクサを使用してそれに書き込む必要があります。</font><font style="vertical-align: inherit;">バスにデータを書き込むとき、このデータは事前​​に準備された他のバスからのものでなければなりません。</font><font style="vertical-align: inherit;">通常、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型</font><font style="vertical-align: inherit;">（またはnewfangled </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロジック</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の</font><font style="vertical-align: inherit;">変数は、モジュールに</font><font style="vertical-align: inherit;">組み込ま</font><font style="vertical-align: inherit;">れます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちの場合、そのようなバスはすでに存在しています。</font><font style="vertical-align: inherit;">これは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sink_data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">それ以外の場合は、状態Zが出力されます。回路に精通している場合は、一般的な出力バッファーをよく理解しています。</font><font style="vertical-align: inherit;">入力データをスキップするか、Z状態になります。</font><font style="vertical-align: inherit;">コードでは、このマルチプレクサは次のようになります。</font></font><br>
<br>
<pre><code class="plaintext hljs">//      inout-<font></font>
assign ft245_data = (state == toPC) ? sink_data : 8'hzz;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして別の信号ft245_siwu。</font><font style="vertical-align: inherit;">私たちは決してそれを使用しないので、FT2232Hのドキュメントによると、それを単一にプルします：</font></font><br>
<br>
<pre><code class="plaintext hljs">//   FTDI :<font></font>
// Tie this pin to VCCIO if not used.<font></font>
assign ft245_siwu = 1;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、それだけです。 </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール全体は次のようになります。</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">module FT245toAvalonST<font></font>
(<font></font>
	input			clk,<font></font>
	input			reset,<font></font>
	<font></font>
	inout	  		[7:0] ft245_data,<font></font>
	input	 logic		ft245_rxf,<font></font>
	input	 logic		ft245_txe,<font></font>
	output logic		ft245_rd,<font></font>
	output logic		ft245_wr,<font></font>
	output logic		ft245_oe,<font></font>
	output logic		ft245_siwu,<font></font>
	<font></font>
	input	 logic		source_ready,<font></font>
	output logic		source_valid,<font></font>
	output logic[7:0] source_data,<font></font>
	<font></font>
	output logic		sink_ready,<font></font>
	input	 logic		sink_valid,<font></font>
	input  logic[7:0]	sink_data<font></font>
	<font></font>
);<font></font>
<font></font>
//   <font></font>
enum {idle, toPC, dropOE, fromPC} state = idle;<font></font>
<font></font>
//    <font></font>
always_ff @(posedge clk,posedge reset)<font></font>
begin<font></font>
	if (reset == 1)<font></font>
	begin<font></font>
		state &lt;= idle;<font></font>
	end else<font></font>
	begin<font></font>
		case (state)<font></font>
		idle: begin<font></font>
				if ((ft245_txe == 0) &amp;&amp; (sink_valid == 1))<font></font>
					state &lt;= toPC;<font></font>
				else if ((ft245_rxf == 0)&amp;&amp;(source_ready == 1))<font></font>
					state &lt;= dropOE;<font></font>
				end<font></font>
		toPC: begin<font></font>
				if (!((ft245_txe == 0) &amp;&amp; (sink_valid == 1)))<font></font>
					state &lt;= idle;<font></font>
				end<font></font>
		dropOE: begin<font></font>
					state &lt;= fromPC;<font></font>
				end<font></font>
		fromPC: begin<font></font>
				if (!((ft245_rxf == 0)&amp;&amp;(source_ready == 1)))<font></font>
							state &lt;= idle;<font></font>
				end<font></font>
		endcase<font></font>
	end<font></font>
end<font></font>
<font></font>
//   <font></font>
//   ,        ,<font></font>
//  -    .<font></font>
always_comb<font></font>
begin<font></font>
	ft245_oe &lt;= 1;<font></font>
	ft245_rd &lt;= 1;<font></font>
	ft245_wr &lt;= 1;<font></font>
	source_valid &lt;= 0;<font></font>
	sink_ready &lt;= 0;<font></font>
	<font></font>
	//     ,<font></font>
	//     assign-<font></font>
<font></font>
	case (state)<font></font>
		idle: begin<font></font>
				end<font></font>
		toPC: begin<font></font>
					ft245_wr &lt;= !(sink_valid);<font></font>
					sink_ready &lt;= !(ft245_txe);<font></font>
				end<font></font>
		dropOE: begin<font></font>
					ft245_oe &lt;= 0;<font></font>
				end<font></font>
		fromPC: begin<font></font>
					ft245_oe &lt;= 0;<font></font>
					ft245_rd &lt;= !(source_ready);<font></font>
					source_valid &lt;= !(ft245_rxf);<font></font>
				end<font></font>
		endcase<font></font>
	<font></font>
end<font></font>
<font></font>
// -  c  ,   ...<font></font>
<font></font>
//   FTDI :<font></font>
// Tie this pin to VCCIO if not used.<font></font>
assign ft245_siwu = 1;<font></font>
<font></font>
//      inout-<font></font>
assign ft245_data = (state == toPC) ? sink_data : 8'hzz;<font></font>
<font></font>
//         <font></font>
assign source_data = ft245_data;<font></font>
<font></font>
<font></font>
endmodule<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロセッサシステムで使用可能なリストにモジュールを含める方法については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前の記事の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1つで詳細に検討した</font><font style="vertical-align: inherit;">ので、結果を図に示します。</font><font style="vertical-align: inherit;">それを実現するために、2つの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVALON-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス</font><font style="vertical-align: inherit;">、1つの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンジット</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス</font><font style="vertical-align: inherit;">を追加</font><font style="vertical-align: inherit;">し、誤って定義された</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVALON-MM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスから信号をプルし</font><font style="vertical-align: inherit;">、そのバスに単一の信号が残っていない場合は削除する必要があったこと</font><font style="vertical-align: inherit;">を思い出し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">途中で、図は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVALON-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス用に選択した設定を示しています</font><font style="vertical-align: inherit;">（シンボルあたり8ビット、エラーなし、最大チャネルはゼロ、待ち時間はゼロです）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/9t/ml/-v9tmldj2eyv4rsv8lb3reokzoa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タイヤをドッキングするためのモジュールの開発で-それだけです。しかし、ああ、ああ。開発することは仕事の始まりにすぎません。実装ははるかに困難です。画面上のスクローラーの位置からわかるように、記事の最後はまだ遠くにあります。そのため、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT245-SYNC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス</font><font style="vertical-align: inherit;">を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVALON-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスと</font><b><font style="vertical-align: inherit;">組み合わせ</font></b><font style="vertical-align: inherit;">て使用する簡単なプロジェクトの作成を開始しています</font><font style="vertical-align: inherit;">。一番簡単です。深刻なプロジェクトは、妥当なサイズの単一の記事のフレームワークには適合しません。読者の注意が残りのテキストのために十分であるように単純化することによって簡単にそれを単純化して、簡単に読むのをやめないようにします。最初の単純化は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT245_SYNCの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 60 MHzクロックパルス</font><font style="vertical-align: inherit;">が</font><b><font style="vertical-align: inherit;">FT2232H</font></b><font style="vertical-align: inherit;">チップ</font><b><font style="vertical-align: inherit;">自体</font></b><font style="vertical-align: inherit;">によって生成されること</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。システムに2本のクロックラインを追加することもできますが、すべてが表示されるとすぐに、母が悲しむことのないようなワイヤーのクモの巣ができます。それでも別のクロックラインに注意を払うと、混乱してしまいます。したがって、私が発表したのは、今日のプロセッサーシステムが</font><font style="vertical-align: inherit;">通常のジェネレーターからではなく</font><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT2232H</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チップからクロックを</font><b><font style="vertical-align: inherit;">供給</font></b><font style="vertical-align: inherit;">すること</font><font style="vertical-align: inherit;">です。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜあなたはいつもそれができないのですか？非常にシンプル：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT2232H</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">245_SYNCモードに切り替えられないため、出力にこれらのパルスがありません。つまり、最初に中央処理装置のプログラムを実行してから、すべてをFPGAにロードする必要があります。外部顧客向けのシステムを作成する場合、そのようなソリューションは多くの問題を引き起こします。私は経験から、彼らが定期的に私たちに電話して何もうまくいかないと言います、私たちはバーについて思い出させるでしょうが、それはしばらくの間助けになるでしょう。しかし、私たちは内部的なことを行っており、実験室の条件でのみ使用します。つまり、このタスクのフレームワーク内では、これは許容されます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、それは新しい挑戦をもたらします。周波数は60 MHzであり、現在使用しているSDRAMクロックユニットは50 MHzの周波数と密接に関連しています。はい、チェックしました。60を送信できますが、許可されているモードを超えないようにしようとします。以降の記事では、このハードブロックを交換する方法を紹介しますが、本日はSDRAMのクロックユニットが使用周波数で動作しないため、SDRAMプロセッサシステムから除外することをお伝えします。プログラムとそのデータは完全にFPGAの内部メモリに配置されます。今日の構成では、FPGAがこのビジネスに最大28 KBのRAMを使用できることが実験的にわかりました。 2の累乗ではなく、ボリュームを取ることができることがわかります...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、標準時計とリセットユニットを使用します。 SDRAMで使用したものとは少し異なります。記事を複雑にしないために、開発したシステムは常にデバッガーの制御下で動作するという事実を利用するため、JTAGデバッグサブシステムからリセットを開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全体として、ここではベースプロセッサシステムのこのようなスケッチを取得します（最も難しいリセットラインは現在ハイライト表示されており、青いマーカーは信号ソース上にあります）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/ug/nk/zxugnk3v9rhownqtdorprzuvqc8.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クロックとリセットユニットでは周波数が調整されました：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/dj/hq/ap/djhqapk0jpgumyp0qrp34ucszhw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてRAM-ボリューム：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/pm/k2/vn/pmk2vngq6jhbl3yhydiarxcsm2i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日はターミナルにテキストを表示する必要があります。したがって、次の興味深いブロックをシステムに追加します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9q/nx/r-/9qnxr-5owicrjxhlqmkeckfxxn8.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このブロックを使用すると、printfと同様の関数を呼び出すことができます。 AVALON_MMバスに加えて、割り込み要求出力も接続する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/h6/rg/gph6rg59lvarzmtdeaq9wvsiohu.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべて、プロセッサシステムの調達が完了しました。私たちのユニットを埋め込む時が来ました。彼はどこにデータを送信しますか？私たちが利用できるブロックの中には、非常に興味深いデュアルポートFIFOメモリがあります。その魅力は、1つのポートを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVALON-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モードに構成し</font><font style="vertical-align: inherit;">てユニットに接続し、2番目の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポート</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">AVALON_MM</font></b><font style="vertical-align: inherit;">モード</font><font style="vertical-align: inherit;">に構成して、NIOS IIプロセッサを使用してそれを操作できることです。この素晴らしいユニットはここにあります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fe/9o/ur/fe9ourutodpbj31wm9av_-pkfc4.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つあるので（1つは読み取り用、もう1つは書き込み用）、2つのFIFOブロックも必要です。次に、そのうちの1つについて詳しく説明します。数キロのウェブ（および画像付きのテキストスクリーンの束）を巻き、1秒あたり、「類推によって実行できる」と言い、違いのみを示します。したがって、これまでのところ、システムに1つのブロックのみを追加し、その設定を確認しています。たくさんの設定があります。誰もが参照として記事を参照するように必要な値を単純に示すことができますが、突然誰かが構成する必要がある状況に入りましたが、ネットワーク（したがって、記事）にアクセスできません。したがって、設定を繰り返し追加します。最初に明らか、それから-システムの要求に応じて、何度も対話を繰り返します。したがって、誰もがプロセスを感じ、いつでもそれを繰り返すことができます。そう。デフォルトでは、次の設定が指定されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yl/bt/14/ylbt14u32cw8xeqherwazdx8nx4.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FIFOを実行して、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からデータを収集し</font><font style="vertical-align: inherit;">、それを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-MMに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アップロードし</font><font style="vertical-align: inherit;">ます。最初の編集は次のようになることがわかります：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/1w/m0/xx/1wm0xx_bdp9gjk9nqmb6sooxop0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この興味深い警告が表示されました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1u/a8/qs/1ua8qsawychkqv0nxjg_l5u3f4q.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少なくとも1つのポートがメモリに投影されている場合、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バス</font><font style="vertical-align: inherit;">は厳密に32ビット</font><font style="vertical-align: inherit;">幅である</font><font style="vertical-align: inherit;">必要があります。そして、8ビットバスがあります。ビット深度に同意する方法については、もう少しお伝えしますが、ここでは8ビット文字の32ビットバスを使用しています。まあ、理論的な部分で決定したように、バッチモードを無効にします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oi/jh/k0/oijhk02tjofxdavtznc1m1es8w4.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次は容量です。 256ワード（つまり、1024バイト）のキューを作成するとします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s4/ca/vl/s4cavlmtxomzl0gsc2dfwn2ovmg.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今ステータス。最初は何も重視していなかったので、プログラムが固まってしまいました。だから今私はステータスが必要であることを知っています。プログラムで出力ポートを操作するため、ステータスを追加します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0_/hc/hp/0_hchpmkhfrlg8pg3tjaqg3vpsi.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラーを取得します</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xk/e7/lg/xke7lgan6dpoohxssnvglenuhog.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。ダブルクロッキングを追加します。両方の入力があるので、両方を同じクロックラインに接続します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
うふふ。合計：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/iv/nv/pv/ivnvpvdfov3zeo6owfevsdhrq6k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、このビジネスを一般的なシステムに接続するには時期尚早です。わかったように、8ビットの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスは、私たちが開発したブロックから出て</font><font style="vertical-align: inherit;">おり、これには32ビットの</font><font style="vertical-align: inherit;">バスが</font><font style="vertical-align: inherit;">含まれているはずです。どうですか？ブロックを改造しますか？番号！すべてはすでに私たちの前で行われています。これが私たちを助けるものです：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/2j/q7/3g2jq74qwjbcgmnvhdchryqi9xm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムに追加します。さらに、これは中間層であるため、美しさのために、対応する矢印を使用してブロックとFIFOの間に配置し</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lt/pd/9q/ltpd9qytvl60ez2znbxu1qsudyq.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。</font><font style="vertical-align: inherit;">次の</font><font style="vertical-align: inherit;">設定</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">行います。8ビットの入力バスと32ビットの出力があります。パケット信号は使用されず、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レディ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有効な</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信号</font><font style="vertical-align: inherit;">が使用されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bo/-e/h1/bo-eh154mbqqyr0owj9vn96his8.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webを織り込む時間です。まず、ストリーミングラインを配置します（図では両方が強調表示され、マーカーはデータレシーバーにあります）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/br/xu/uj/brxuujnbnsiazm3pxfnnr3tb-cc.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、ブロックのSourceからの信号はアダプターの入力に送られます。そして、アダプター出力からFIFO入力へ。先ほど述べたように、ストリーミングプロトコルのすべての接続はポイントツーポイントベースで行われます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、リセットラインとクロックラインを停止し、すべてをシステムバスと割り込みに接続します...</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/tj/1g/dctj1gqgwbbs7-pcdf4urfbhvsy.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて...そして、同じ原理で、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT245SYNCに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データを発行するためにFIFOを追加し</font><font style="vertical-align: inherit;">ます。そこでのみ、データは</font><font style="vertical-align: inherit;">32ビット形式で</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-MM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からFIFOに入り</font><font style="vertical-align: inherit;">ます。彼らは32-in-8アダプターを通過し、現在の回路に接続されていない私たちのブロックのSINK入力に到達します...最終回路の次のフラグメント（シングルクロックで判明したメモリ）を取得します：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eg/e5/kc/ege5kckjc4x5vwtsfaxmlp32rqo.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記載された実験ですでにうまく機能しているさらなる手続き過去の記事で（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほとんどの場合-これで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）ベクトルをプロセッサに割り当てます。システムでは、割り込み番号とアドレスの自動割り当てを呼び出します。システムを保存します...システムが階層の最上位にあるように、保存されたシステムの名前はプロジェクトの名前と一致する必要があることを誰もが覚えていますか？システムをプロジェクトに追加し、プロジェクトの大まかなドラフトを作成し、脚を割り当てます。個人的に、私はカンニングをしました。割り当てをドラフトプロジェクトの* .qsfファイルから現在の最終的なものにコピーしました（私のプロジェクトを取得して、対応する* .qsf行を自分の行にコピーできますが、GUIを介してすべてのレッグを割り当てることができます）。以前のプロジェクトのように、clk信号が25ではなく23に接続されていることに特に注意します。ここでは、FT2232の出力からカチカチと音を立てていることを思い出します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9z/bx/sb/9zbxsbgsn4m_9wewmjestkse0fi.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完璧に！</font><font style="vertical-align: inherit;">ハードウェアの準備が整いました。</font><font style="vertical-align: inherit;">ソフトウェアに移行します。</font><font style="vertical-align: inherit;">どこから始めますか？</font><font style="vertical-align: inherit;">今日、この質問は価値がありません。</font><font style="vertical-align: inherit;">NIOS IIプロセッサで実行するプログラムから始める場合、何も機能しません。</font><font style="vertical-align: inherit;">まず、FT2232を245-SYNCモードにする必要があります。そうしないと、プロセッサシステムがクロックパルスを受信しません。</font><font style="vertical-align: inherit;">したがって、中央処理装置のコードから始めます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のようなものが得られます。</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">#include &lt;cstdio&gt;<font></font>
<font></font>
#include &lt;sys/time.h&gt;<font></font>
#include &lt;unistd.h&gt;<font></font>
#include "ftd2xx.h"<font></font>
<font></font>
FT_HANDLE OpenFT2232H()<font></font>
{<font></font>
	FT_HANDLE	ftHandle0;<font></font>
	static FT_DEVICE ftDevice;<font></font>
<font></font>
	//     <font></font>
	int nDevice = 0;<font></font>
	while (true)<font></font>
	{<font></font>
		//    <font></font>
		if (FT_Open(nDevice, &amp;ftHandle0) != FT_OK)<font></font>
		{<font></font>
			printf("No FT2232 found\n");<font></font>
			//  ,     <font></font>
			return 0;<font></font>
		}<font></font>
<font></font>
		//     ?<font></font>
		if (FT_GetDeviceInfo(ftHandle0,<font></font>
			&amp;ftDevice,<font></font>
			NULL,<font></font>
			NULL,<font></font>
			NULL,<font></font>
			NULL) == FT_OK)<font></font>
		{<font></font>
			// ,   <font></font>
			if (ftDevice == FT_DEVICE_2232H)<font></font>
			{<font></font>
				// ,     AN130<font></font>
<font></font>
				FT_SetBitMode(ftHandle0, 0xff, 0x00);<font></font>
<font></font>
				usleep(1000000);<font></font>
<font></font>
				//Sync FIFO mode <font></font>
				FT_SetBitMode(ftHandle0, 0xff, 0x40);<font></font>
<font></font>
				FT_SetLatencyTimer(ftHandle0, 2);<font></font>
<font></font>
				FT_SetUSBParameters(ftHandle0, 0x10000, 0x10000);<font></font>
<font></font>
				return ftHandle0;<font></font>
<font></font>
			}<font></font>
		}<font></font>
		//   <font></font>
		FT_Close(ftHandle0);<font></font>
		//   <font></font>
		nDevice += 1;<font></font>
	}<font></font>
	printf("No FT2232 found\n");<font></font>
}<font></font>
<font></font>
int main()<font></font>
{<font></font>
	FT_HANDLE	ftHandle0 = OpenFT2232H();<font></font>
<font></font>
	if (ftHandle0 == 0)<font></font>
	{<font></font>
		printf("Cannot open device\n");<font></font>
		return -1;<font></font>
	}<font></font>
<font></font>
	int item;<font></font>
<font></font>
	bool bWork = true;<font></font>
	while (bWork)<font></font>
	{<font></font>
		printf("1 - Send 16 bytes\n");<font></font>
		printf("2 - Send 256 bytes\n");<font></font>
		printf("3 - Receive loop\n");<font></font>
		printf("0 - Exit\n");<font></font>
<font></font>
		scanf("%d", &amp;item);<font></font>
<font></font>
		switch (item)<font></font>
		{<font></font>
		case 0:<font></font>
			bWork = false;<font></font>
			break;<font></font>
		case 1:<font></font>
		{<font></font>
			static const unsigned char data[0x10] = { 0x00,0x01,0x02,0x03,<font></font>
									0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f };<font></font>
			DWORD dwWritten;<font></font>
			FT_Write(ftHandle0, (void*)data, sizeof(data), &amp;dwWritten);<font></font>
		}<font></font>
		break;<font></font>
		case 2:<font></font>
		{<font></font>
			unsigned char data[0x100];<font></font>
			for (size_t i = 0; i &lt; sizeof(data); i++)<font></font>
			{<font></font>
				data[i] = (unsigned char)i;<font></font>
			}<font></font>
			DWORD dwWritten;<font></font>
			FT_Write(ftHandle0, (void*)data, sizeof(data), &amp;dwWritten);<font></font>
		}<font></font>
		break;<font></font>
		case 3:<font></font>
		{<font></font>
			DWORD dwRxBytes;<font></font>
			DWORD dwRead;<font></font>
			DWORD buf[0x100];<font></font>
			while (true)<font></font>
			{<font></font>
				FT_GetQueueStatus(ftHandle0, &amp;dwRxBytes);<font></font>
				if (dwRxBytes != 0)<font></font>
				{<font></font>
					printf("Received %d bytes (%d DWORDs)\n", dwRxBytes, dwRxBytes / sizeof(buf[0]));<font></font>
					if (dwRxBytes &gt; sizeof(buf))<font></font>
					{<font></font>
						dwRxBytes = sizeof(buf);<font></font>
					}<font></font>
					FT_Read(ftHandle0, buf, dwRxBytes, &amp;dwRead);<font></font>
					for (DWORD i = 0; i &lt; dwRxBytes / sizeof(buf[0]);i++)<font></font>
					{<font></font>
						printf("0x%X, ",buf[i]);<font></font>
					}<font></font>
					printf("\n");<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
			break;<font></font>
		}<font></font>
	}<font></font>
	// ,   <font></font>
	FT_Close(ftHandle0);<font></font>
	return 0;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenFT2232H（）は</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前回の記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おなじみ</font><font style="vertical-align: inherit;">です。 FT2232デバイスを開いて必要なモードにするのは彼女です。プログラムが正常に起動した直後に、クロックパルスが表示され、NIOS IIのプログラムをデバッグすることができます。まあ、メイン機能の機能はスツールと同じくらい簡単です。データを送信（1）、大量のデータを送信（2）、データを受信（3）。すべてのデータは4バイトの倍数のブロックで送信されることに注意してください。これは、8-in-32アダプターがあるためです。それからの出口で、データはダブルワードで行く必要があります。そうでなければ、すべてが明白です。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NIOS II用のプログラムを開発するときは、最初にBSPを構成する必要があります。 Hello World Smallテンプレートに従ってプログラム自体を作成することを思い出します。以下の図では、BSPで変更されたフィールドが赤でマークされています（テンプレートからプログラムを作成する方法とBSPを修正する方法については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前の記事の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1つで詳しく説明しました</font><font style="vertical-align: inherit;">）。ツリーのルート、つまりSettings要素を選択すると、すべての設定がすぐに右側に表示されることを思い出してください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/mg/jh/lcmgjhu3udg8njitretcj5wp4vm.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、BSPを生成し、私の習慣</font><font style="vertical-align: inherit;">に基づい</font><font style="vertical-align: inherit;">て</font><font style="vertical-align: inherit;">、ファイル名を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello_world_small.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello_world_small.cpp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に変更します</font><font style="vertical-align: inherit;">。その後、プロジェクトをクリーンアップして、この名前変更によるエラーが発生しないようにします。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はかなり表面的に作業の検証を行います（実際のテスターは確実にFIFOサイズを超える大量のデータの転送を徹底的にテストしますが、この記事の目的は基本的な原則を示すことであり、非常識なサイズのためにそのままにしておくことではありません）。</font><font style="vertical-align: inherit;">また、基本的な原則を2つの段階で示します。</font><font style="vertical-align: inherit;">最初のステップは、中央処理装置からNIOS IIへのデータ転送を検証することです。</font><font style="vertical-align: inherit;">このために、次のコードを開発しました。</font></font><br>
<br>
<pre><code class="plaintext hljs">extern "C"<font></font>
{<font></font>
#include "sys/alt_stdio.h"<font></font>
#include &lt;system.h&gt;<font></font>
#include &lt;altera_avalon_fifo_util.h&gt;<font></font>
}<font></font>
#include &lt;stdint.h&gt;<font></font>
int main()<font></font>
{ <font></font>
	while (1)<font></font>
	{<font></font>
		int level = IORD_ALTERA_AVALON_FIFO_LEVEL(FIFO_0_OUT_CSR_BASE);<font></font>
		if (level != 0)<font></font>
		{<font></font>
			alt_printf("0x%x words received:\n",level);<font></font>
			for (int i=0;i&lt;level;i++)<font></font>
			{<font></font>
				alt_printf("0x%x,",IORD_ALTERA_AVALON_FIFO_DATA (FIFO_0_OUT_BASE));<font></font>
			}<font></font>
			alt_printf("\n");<font></font>
		}<font></font>
	}<font></font>
<font></font>
  /* Event loop never exits. */<font></font>
  while (1);<font></font>
<font></font>
  return 0;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプログラムは、データがFIFOに現れるのを待っています。</font><font style="vertical-align: inherit;">そこに現れた場合、それらを表示します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストを開始します。</font><font style="vertical-align: inherit;">最初に、時計を始めるのを忘れたふりをします。</font><font style="vertical-align: inherit;">したがって、Reddをオンにした後、FPGAの「ファームウェア」をロードしてから、NIOS IIのデバッグプログラムを実行しようとします。</font><font style="vertical-align: inherit;">私はこのメッセージを受け取ります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/88/1c/xk/881cxkj95xirw_0rdrrhyaf0ffm.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じ場合は、プロセッサシステムのクロックを開始するのを本当に忘れていたことを意味します。しかし、あなたはそれを素早く識別する方法を知っています。排除するには、中央プロセッサ用に作成したプログラムを実行する必要があります。 FT2232ブリッジが起動して初期化されるとすぐに、クロックパルスがプロセッサに送られ、デバッグを開始するプロセスを繰り返すことが可能になります。また、その時までに中央処理装置用のプログラムを完成させることができる。クロックパルスはどこにも行きません。ブリッジはすでに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT245-SYNC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モードに設定されています</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中央処理装置のプログラムで、1を押します。状況に応じて、どちらかが端末に表示され</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。受信した0x2ワード：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0x3020100,0x7060504、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受信した0x2ワード：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0xb0a0908,0xf0e0d0c、</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
または：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x3ワードを受信：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0x3020100,0x7060504,0xb0a0908、0x1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワードを受信：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0xf0e0d0c、</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、ダブルワードは1つ、次に3つありますが、これは私には起こりませんでした。それはすべて、最初の表示が始まる前にバス上で実行するバイト数に依存します。そして、それが開始した場合、JTAGを介したデータ転送は高速なプロセスではないため、それが終了するまでに、他のすべてのバイトが実行される時間があります。バスがパケット信号を使用した場合、プログラムはパケット受信の完了時にのみデータを見ることができます。場合によっては、それは良いです（まだパケットがないのに、なぜそれを見なければならないのですか？特にパケットが一時的なものである場合）、場合によっては悪いです（FIFOはブラックボックスです。最終処理のために、データはアドレス指定可能なRAMにコピーする必要があります。これは、データの受信と並行して行う方がよいでしょう） ）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信されたデータは、リトルエンディアン表記でダブルワードで配置されます。次の配列が渡されることを思い出してください。</font></font><br>
<br>
<pre><code class="plaintext hljs">static const unsigned char data[0x10] = { 0x00,0x01,0x02,0x03,<font></font>
	0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f };<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのとおり。</font><font style="vertical-align: inherit;">中央処理装置のプログラムで項目2を選択すると、メッセージが表示されます（読みやすくするために、記事の準備時に行がフォーマットされます）。</font></font><br>
<br>
<pre><code class="plaintext hljs">0x3 words received:<font></font>
0x3020100,0x7060504,0xb0a0908,<font></font>
0x3d words received:<font></font>
0xf0e0d0c,<font></font>
0x13121110,0x17161514,0x1b1a1918,0x1f1e1d1c,<font></font>
0x23222120,0x27262524,0x2b2a2928,0x2f2e2d2c,<font></font>
0x33323130,0x37363534,0x3b3a3938,0x3f3e3d3c,<font></font>
0x43424140,0x47464544,0x4b4a4948,0x4f4e4d4c,<font></font>
0x53525150,0x57565554,0x5b5a5958,0x5f5e5d5c,<font></font>
0x63626160,0x67666564,0x6b6a6968,0x6f6e6d6c,<font></font>
0x73727170,0x77767574,0x7b7a7978,0x7f7e7d7c,<font></font>
0x83828180,0x87868584,0x8b8a8988,0x8f8e8d8c,<font></font>
0x93929190,0x97969594,0x9b9a9998,0x9f9e9d9c,<font></font>
0xa3a2a1a0,0xa7a6a5a4,0xabaaa9a8,0xafaeadac,<font></font>
0xb3b2b1b0,0xb7b6b5b4,0xbbbab9b8,0xbfbebdbc,<font></font>
0xc3c2c1c0,0xc7c6c5c4,0xcbcac9c8,0xcfcecdcc,<font></font>
0xd3d2d1d0,0xd7d6d5d4,0xdbdad9d8,0xdfdedddc,<font></font>
0xe3e2e1e0,0xe7e6e5e4,0xebeae9e8,0xefeeedec,<font></font>
0xf3f2f1f0,0xf7f6f5f4,0xfbfaf9f8,0xfffefdfc,<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが真実です。</font><font style="vertical-align: inherit;">後退ギアのチェックに進みます。</font><font style="vertical-align: inherit;">NIOS IIのプログラムを次のように置き換えます。</font></font><br>
<br>
<pre><code class="plaintext hljs">	/*  -  2 */<font></font>
	uint32_t buf[] = {0x11223344,0x55667788,0x99aabbcc,0xddeeff00};<font></font>
	for (uint32_t i=0;i&lt;sizeof(buf)/sizeof(buf[0]);i++)<font></font>
	{<font></font>
		IOWR_ALTERA_AVALON_FIFO_DATA (FIFO_1_IN_BASE,buf[i]);<font></font>
	}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中央処理装置のプログラムでポイント3を選択し、NIOS II用のこのバージョンのプログラムを実行します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得</font></font><br>
<br><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><b><font style="vertical-align: inherit;">16バイト（4 DWORD）</font></b><b><font style="vertical-align: inherit;">
0x11223344、0x55667788、0x99AABBCC、0xDDEEFF00を受信、</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
両方のチャネルが粗く動作しています。</font><font style="vertical-align: inherit;">なんとかしてまたチェックしてみます。</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon-ST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バスストリーミングプロトコルの基本について説明します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このプロトコルを通じて、Redd中央プロセッサとFPGAに実装されたプロセッサシステムとの接続が編成されます。</font><font style="vertical-align: inherit;">読者は、中央プロセッサーと補助プロセッサー間の相互作用の最も簡単な方法についてのアイデアを得ました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、開発プロセス中に作成されたプロジェクトをダウンロードし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、ストリーミングプロトコルとその使用法について得た知識は非常に基本的です。</font><font style="vertical-align: inherit;">以降の記事では、これらのプロトコルを使用して、ReddボードにあるダイナミックRAMにデータを効率的に保存する方法について説明します。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja462213/index.html">学び、働きます：情報技術およびプログラミング学部の学部生の経験</a></li>
<li><a href="../ja462221/index.html">Google Playでの失望感</a></li>
<li><a href="../ja462227/index.html">8月9日、モスクワ-バックエンドストーリー4.0</a></li>
<li><a href="../ja462245/index.html">Linuxカーネルの例としての自動git bisect</a></li>
<li><a href="../ja462251/index.html">ブラウザのシークレットモードはフィクションですか？</a></li>
<li><a href="../ja462257/index.html">KubernetesのKafka-それは良いですか？</a></li>
<li><a href="../ja462259/index.html">スマートホーム用のコントローラーを作る</a></li>
<li><a href="../ja462263/index.html">床へのペダル：PC用の別の足のマニピュレーターを作成する</a></li>
<li><a href="../ja462265/index.html">Pythonとキューブ</a></li>
<li><a href="../ja462269/index.html">ジョン・ロメロからドゥーム：80年代のゲーム開発</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>