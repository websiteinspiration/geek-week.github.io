<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëºüèΩ üë®üèº‚Äçüíº üë®üèª‚Äç‚öñÔ∏è How to help pandas in processing large amounts of data? üßóüèª üöù üßëüèæ‚Äçü§ù‚ÄçüßëüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The pandas library is one of the best tools for exploratory data analysis . But this does not mean that pandas is a universal tool suitable for solvin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to help pandas in processing large amounts of data?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/500428/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The pandas library is one of the best tools for </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exploratory data analysis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . But this does not mean that pandas is a universal tool suitable for solving any problems. In particular, we are talking about processing large amounts of data. I happened to spend a very, very long time, waiting for pandas to read many files, or process them, calculating on the basis of the information contained in them some indicators that interest me. The fact is that pandas does not support parallel data processing mechanisms. As a result, this package fails to take full advantage of the capabilities of modern multi-core processors. Large datasets in pandas are processed slowly.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/jp/tu/xh/jptuxhdfys8yd3jjgajrmfg7rl4.jpeg"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recently, I set out to find something that would help me in the processing of big data. </font><font style="vertical-align: inherit;">I managed to find what I was looking for, I embedded the found tool in my data processing pipeline. </font><font style="vertical-align: inherit;">I use it to work with large amounts of data. </font><font style="vertical-align: inherit;">For example, to read files containing 10 gigabytes of data, to filter and aggregate them. </font><font style="vertical-align: inherit;">When I manage to solve such problems, I save what I got in a smaller CSV file that is suitable for pandas, and then I start working with the data using pandas. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a Jupyter notebook containing examples of this material that you can experiment with.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The tool that I use to process large amounts of data is the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dask</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It supports parallel data processing, allowing you to speed up the work of existing tools. </font><font style="vertical-align: inherit;">This includes numpy, pandas and sklearn. </font><font style="vertical-align: inherit;">Dask is a free open source project. </font><font style="vertical-align: inherit;">It uses Python APIs and data structures, which makes it easy to integrate Dask into existing projects. </font><font style="vertical-align: inherit;">If we briefly describe Dask, then we can say that this library simplifies the solution of ordinary problems and makes it possible to solve problems of enormous complexity.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparing pandas and dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I can describe the possibilities of Dask here, since this library has a lot of interesting things, but instead, I just consider one practical example. </font><font style="vertical-align: inherit;">In the course of work, I usually encounter sets of large files, the data stored in which needs to be analyzed. </font><font style="vertical-align: inherit;">Let's play one of my typical tasks and create 10 files, each of which contains 100,000 records. </font><font style="vertical-align: inherit;">Each such file has a size of 196 MB.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> make_classification
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">'Generating trainset %d'</span> % i)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;x, y = make_classification(n_samples=<span class="hljs-number">100</span>_000, n_features=<span class="hljs-number">100</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df = pd.DataFrame(data=x)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df[<span class="hljs-string">'y'</span>] = y<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df.to_csv(<span class="hljs-string">'trainset_%d.csv'</span> % i, index=<span class="hljs-literal">False</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now read these files using pandas and measure the time required to read them. </font><font style="vertical-align: inherit;">There is no built-in support in pandas </font></font><code>glob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, so we have to read the files in a loop:</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-keyword">import</span> glob<font></font>
df_list = []<font></font>
<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> glob.glob(<span class="hljs-string">'trainset_*.csv'</span>):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df_ = pd.read_csv(filename)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df_list.append(df_)<font></font>
df = pd.concat(df_list)<font></font>
df.shape<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It took 16 seconds for pandas to read these files:</font></font><br>
<br>
<pre><code class="python hljs">CPU times: user <span class="hljs-number">14.6</span> s, sys: <span class="hljs-number">1.29</span> s, total: <span class="hljs-number">15.9</span> s<font></font>
Wall time: <span class="hljs-number">16</span> s
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk about Dask, it can be noted that this library allows you to process files that do not fit in memory. </font><font style="vertical-align: inherit;">This is done by breaking them into blocks and by compiling task chains. </font><font style="vertical-align: inherit;">Let's measure the time Dask needs to read these files:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> dask.dataframe <span class="hljs-keyword">as</span> dd<font></font>
%%time<font></font>
df = dd.read_csv(<span class="hljs-string">'trainset_*.csv'</span>)<font></font>
CPU times: user <span class="hljs-number">154</span> ms, sys: <span class="hljs-number">58.6</span> ms, total: <span class="hljs-number">212</span> ms<font></font>
Wall time: <span class="hljs-number">212</span> ms
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dask took 154 ms! </font><font style="vertical-align: inherit;">How is this even possible? </font><font style="vertical-align: inherit;">In fact, this is not possible. </font><font style="vertical-align: inherit;">Dask implements a delayed task paradigm. </font><font style="vertical-align: inherit;">Calculations are performed only when their results are needed. </font><font style="vertical-align: inherit;">We describe the execution graph, which gives Dask the ability to optimize the execution of tasks. </font><font style="vertical-align: inherit;">Repeat the experiment. </font><font style="vertical-align: inherit;">Note that the function </font></font><code>read_csv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from Dask has built-in support for working with </font></font><code>glob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs">%%time<font></font>
df = dd.read_csv(<span class="hljs-string">'trainset_*.csv'</span>).compute()<font></font>
CPU times: user <span class="hljs-number">39.5</span> s, sys: <span class="hljs-number">5.3</span> s, total: <span class="hljs-number">44.8</span> s<font></font>
Wall time: <span class="hljs-number">8.21</span> s
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using the function </font></font><code>compute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forces Dask to return the result, for which you need to really read the files. </font><font style="vertical-align: inherit;">The result is that Dask reads files twice as fast as pandas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It can be said that Dask allows you to equip Python projects with scaling tools.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparing CPU Usage in Pandas and Dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Does Dask use all the processor cores on the system? </font><font style="vertical-align: inherit;">Compare the use of processor resources in pandas and in Dask when reading files. </font><font style="vertical-align: inherit;">The same code that we reviewed above applies here.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc4/365/628/bc4365628d41d261946f440ee9929726.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using processor resources when reading files with pandas</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/464/ded/88d/464ded88d73b2fc52c06b8ad31fb6533.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using processor resources when reading files using Dask</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A couple of the above animated images allow you to clearly see how pandas and Dask use processor resources when reading files.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What happens in the bowels of Dask?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Dask dataframe consists of several pandas dataframes, which are separated by indexes. </font><font style="vertical-align: inherit;">When we execute a function </font></font><code>read_csv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from Dask, it reads the same file by several processes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We can even visualize a graph of this task.</font></font><br>
<br>
<pre><code class="python hljs">exec_graph = dd.read_csv(<span class="hljs-string">'trainset_*.csv'</span>)<font></font>
exec_graph.visualize()<font></font>
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/123/e8b/383/123e8b383276d05a51f8b1cc34cdd74f.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dask runtime graph when reading multiple files</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dask disadvantages</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhaps you now have the following thought: ‚ÄúIf the Dask library is so good, why not just use it instead of pandas?‚Äù </font><font style="vertical-align: inherit;">But not so simple. </font><font style="vertical-align: inherit;">Only some pandas functions are ported to Dask. </font><font style="vertical-align: inherit;">The fact is that certain tasks are difficult to parallelize. </font><font style="vertical-align: inherit;">For example, sorting data and assigning indexes to unsorted columns. </font><font style="vertical-align: inherit;">Dask is not a tool that solves absolutely all tasks of data analysis and processing. </font><font style="vertical-align: inherit;">This library is recommended to be used only for working with data sets that do not fit in memory entirely. </font><font style="vertical-align: inherit;">Since the Dask library is based on pandas, everything that works slowly in pandas will remain slow in Dask. </font><font style="vertical-align: inherit;">As I said before, Dask is a useful tool that you can embed in a data processing pipeline, but this tool does not replace other libraries.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install Dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to install Dask, you can use the following command:</font></font><br>
<br>
<pre><code class="python hljs">python -m pip install <span class="hljs-string">"dask[complete]"</span>
</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I only superficially touched on the capabilities of Dask. </font><font style="vertical-align: inherit;">If you are interested in this library - take a look at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">these</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> great tutorials on Dask, and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of datafreymam Dask. </font><font style="vertical-align: inherit;">And if you want to know what functions support Dask dataframes, read the </font><font style="vertical-align: inherit;">API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">description</font></font></a><font style="vertical-align: inherit;"></font><code>DataFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Would you use the Dask library?</font></font></b><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We remind you that we are continuing </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the prediction contest</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in which you can win a brand new iPhone. </font><font style="vertical-align: inherit;">There is still time to break into it, and make the most accurate forecast on topical values.</font></font></blockquote><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500418/index.html">New earthquake calculations predict their probable destructiveness</a></li>
<li><a href="../en500420/index.html">sMock - Swift mocking framework for Unit-tests (thanks gMock for ideas)</a></li>
<li><a href="../en500422/index.html">Visual Debugger for Jupyter</a></li>
<li><a href="../en500424/index.html">Deferred use of directive functionality in Angular</a></li>
<li><a href="../en500426/index.html">Python, pandas and solving three problems from the world of Excel</a></li>
<li><a href="../en500430/index.html">How I looked for quarantined work</a></li>
<li><a href="../en500436/index.html">Coming of binary neural networks based on random neurons and logical functions</a></li>
<li><a href="../en500438/index.html">SFTP and FTPS</a></li>
<li><a href="../en500444/index.html">9 Python programming skills that distinguish a beginner from an experienced</a></li>
<li><a href="../en500446/index.html">A few words about R2DBC and PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>