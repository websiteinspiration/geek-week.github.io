<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîã üò¨ üê∞ Mise √† jour du processus CI / CD: pr√©paration et planification üçÆ üëºüèª üòø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2020, il est probablement assez difficile de trouver un projet dans une description de pile qui n'aurait pas l'un des mots suivants: IaC, microserv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mise √† jour du processus CI / CD: pr√©paration et planification</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496204/"><img src="https://habrastorage.org/webt/vl/jg/11/vljg11dfzemfbyfy8oexvw73eyq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2020, il est probablement assez difficile de trouver un projet dans une description de pile qui n'aurait pas l'un des mots suivants: IaC, microservices, kubernetes, docker, aws / azure / gcloud, blockchain, ML, VR et ainsi de suite. </font><font style="vertical-align: inherit;">Et c'est super! </font><font style="vertical-align: inherit;">Le progr√®s ne s'arr√™te pas. </font><font style="vertical-align: inherit;">Nous grandissons, nos projets grandissent avec nous, des outils plus pratiques et fonctionnels apparaissent qui r√©solvent les probl√®mes modernes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour. Je voulais donc commencer cet article. Mais j'ai ensuite pass√© en revue certaines choses, parl√© avec mes coll√®gues et r√©alis√© que je me trompais. Il y a encore des projets qui ont d√©j√† plus de 15 ans, avec des gestionnaires et des participants qui sont de vieux croyants, et en cons√©quence, ces projets ont une pile technologique ancienne qui est assez difficile √† maintenir dans un zoo existant. Et pour une raison quelconque, ce projet ne peut pas √™tre mis √† jour globalement (le client est une starover, il n'y a pas d'√©valuation, le projet est tr√®s important et la migration est retard√©e, ou tout le monde est satisfait de tout), et vous devez le soutenir. Encore plus d√©sagr√©able quand un projet similaire est toujours activement d√©velopp√©. C'est comme une boule de neige. Le client et le public ont besoin de fonctionnalit√©s, le code doit √™tre livr√©, les serveurs n√©cessitent de l'attention et des soins ... Mais le bitpack - donc en g√©n√©ral, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cess√© de prendre en charge le mercure</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Un tel cas est propos√© pour examen.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui sera envisag√©: conversion de mercurial-git, d√©placement de CI de CruiseControl.NET vers TeamCity, de git-deployment √† Octopus avec une </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">petite</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> description de l'ensemble du processus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le texte s'est av√©r√© beaucoup, il sera donc divis√© en parties s√©par√©es pour faciliter la perception. </font><font style="vertical-align: inherit;">Il y aura une table des mati√®res. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 1: ce qui est, pourquoi ce n'est pas comme, la planification, un petit coup bash. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'appellerais cette partie presque technique. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 2: teamcity. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 3: d√©ploiement de poulpe. </font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Partie 4: dans les coulisses. </font><font style="vertical-align: inherit;">Moments d√©sagr√©ables, plans pour l'avenir, √©ventuellement FAQ. </font><font style="vertical-align: inherit;">Tr√®s probablement, il peut √©galement √™tre qualifi√© de quasi-technique.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'appellerais pas cela un guide de r√©p√©tition pour de nombreuses raisons: une immersion insuffisante dans les processus du projet en raison du manque de temps, une pratique insuffisante de ces choses, un √©norme monolithe dans lequel tous les sous-projets sont √©troitement entrelac√©s, et un tas d'autres nuances qui vous font br√ªler, vous √©tonner, les supporter. , mais en aucun cas ne pla√Æt pas. </font><font style="vertical-align: inherit;">Et aussi, en raison des caract√©ristiques du projet (il est assez unique), certaines √©tapes seront con√ßues exclusivement pour ce cas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction classique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avions un r√©f√©rentiel mercurial, 300+ (ouverts!) Brunches, ccnet, un autre ccnet + git (pour les d√©ploiements), et une multitude de modules de projet avec nos propres configurations et clients individuels, quatre environnements et une multitude de pools dans IIS, ainsi que cmd scripts, SQL, plus de cinq cents domaines, deux douzaines de builds et d√©veloppement actif en plus. Non pas que tout cela √©tait n√©cessaire, mais cela a fonctionn√©, et c'√©tait g√™nant et long. La seule chose qui m'a inqui√©t√© √©tait la pr√©sence d'autres projets n√©cessitant mon attention. Rien dans le processus de travail avec des t√¢ches de cette ampleur n'est plus dangereux que le manque de concentration et d'interruption.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je savais que, t√¥t ou tard, je devrais pr√™ter attention √† d'autres t√¢ches, et c'est pourquoi j'ai pass√© √©norm√©ment de temps √† √©tudier les infrastructures existantes afin qu'au moins, par la suite, il n'y ait pas de probl√®mes non r√©solus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, je ne peux pas donner une description compl√®te du projet, en raison de la NDA, donc des points techniques g√©n√©raux seront pris en compte. Tous les noms li√©s au projet seront √©galement peints. Je m'excuse pour le maculage noir sur les captures d'√©cran.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une des principales caract√©ristiques du projet est qu'il comporte un certain nombre de modules qui ont un c≈ìur, mais dont les configurations diff√®rent. Il existe √©galement des modules avec une approche ¬´sp√©ciale¬ª, con√ßus pour les revendeurs et surtout les gros clients. Un module peut servir plus d'un client. Un client doit √™tre compris comme une organisation distincte ou un groupe de personnes ayant acc√®s √† un module sp√©cifique. Chaque client a acc√®s √† son propre domaine, a sa propre conception et ses propres param√®tres par d√©faut uniques. Le client est identifi√© par le domaine qu'il utilise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sch√©ma g√©n√©ral de cette partie du projet peut √™tre repr√©sent√© comme suit:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/1p/jp/ft1pjp-5mnyfk2fu07salwryrew.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, le noyau est utilis√© de la m√™me mani√®re partout, et cela peut √™tre utilis√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Raisons pour lesquelles la t√¢che s'est pos√©e d'examiner et de mettre √† jour les processus CI / CD:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CruiseControl.NET a √©t√© utilis√© comme syst√®me de g√©n√©ration. </font><font style="vertical-align: inherit;">Travailler avec lui est en principe un plaisir douteux. </font><font style="vertical-align: inherit;">Configurations XML sur plusieurs √©crans, un tas de d√©pendances et de liens entre les configurations, manque de solutions modernes aux probl√®mes modernes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certains d√©veloppeurs (principalement des leads) sur le projet doivent avoir acc√®s √† des serveurs de build, et ils aiment parfois changer les configurations ccnet qui ne doivent pas √™tre modifi√©es. </font><font style="vertical-align: inherit;">Devinez ce qui se passe ensuite. </font><font style="vertical-align: inherit;">Vous devez avoir une gestion simple et pratique des droits dans le syst√®me CI, sans retirer aux d√©veloppeurs l'acc√®s au serveur. </font><font style="vertical-align: inherit;">Autrement dit, il n'y a pas de configuration de texte - il n'y a nulle part o√π grimper avec des mains ludiques.</font></font></li>
<li>  - ‚Ä¶  CCNET,        git.         (. ).</li>
<li> ,      .     ,      .&nbsp;</li>
<li>-       ,        ‚Äî         (   )       .</li>
<li>   .        ?   ?     ?            .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation sous-optimale des ressources et processus obsol√®te de cr√©ation et de livraison de code.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure au paragraphe 3:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hc/yk/kv/hcykkvp6zijbax7ykugimj3qwkq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au stade de la planification, il a √©t√© d√©cid√© d'utiliser Teamcity comme syst√®me de construction et Octopus comme syst√®me de d√©ploiement. </font><font style="vertical-align: inherit;">L‚Äôinfrastructure ¬´de fer¬ª du client est rest√©e inchang√©e: des serveurs d√©di√©s s√©par√©s pour le d√©veloppement, le test, la mise en place et la production, ainsi que des serveurs revendeurs (principalement des environnements de production). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le client a re√ßu une preuve de concept sur l'exemple d'un des modules, un plan d'action a √©t√© r√©dig√©, des travaux pr√©paratoires ont √©t√© effectu√©s (installation, configuration, etc.). </font><font style="vertical-align: inherit;">Cela n'a probablement aucun sens de d√©crire cela. </font><font style="vertical-align: inherit;">Comment installer Team City peut √™tre lu sur le site officiel. </font><font style="vertical-align: inherit;">Je m'attarderai s√©par√©ment sur certaines exigences formul√©es pour le nouveau syst√®me:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenance facile avec toutes les cons√©quences (sauvegardes, mises √† jour, r√©solution de probl√®mes, le cas √©ch√©ant).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Universalit√©. </font><font style="vertical-align: inherit;">Id√©alement, d√©veloppez un sch√©ma g√©n√©ral selon lequel tous les modules sont assembl√©s et livr√©s, et utilisez-le comme mod√®le.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimisez le temps pour ajouter de nouvelles configurations de construction et de maintenance. </font><font style="vertical-align: inherit;">Les clients sont ajout√©s / supprim√©s. </font><font style="vertical-align: inherit;">Parfois, il devient n√©cessaire de faire de nouvelles configurations. </font><font style="vertical-align: inherit;">Il est n√©cessaire que lors de la cr√©ation d'un nouveau module il n'y ait pas de retard dans la configuration de sa livraison.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä peu pr√®s √† ce stade, nous nous sommes souvenus de l'arr√™t du support des r√©f√©rentiels mercurial avec un bitbucket, et l'exigence a √©t√© ajout√©e de transf√©rer le r√©f√©rentiel vers git tout en pr√©servant les branches et l'historique des validations.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©paration: conversion du r√©f√©rentiel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que quelqu'un ait clairement r√©solu ce probl√®me devant nous et au lieu de nous. </font><font style="vertical-align: inherit;">Il vous suffit de trouver une solution de travail pr√™te √† l'emploi. </font><font style="vertical-align: inherit;">L'exportation rapide s'est av√©r√©e moins rapide. </font><font style="vertical-align: inherit;">De plus, cela n'a pas fonctionn√©. </font><font style="vertical-align: inherit;">Malheureusement, il n'y a plus de journaux ni de captures d'√©cran. </font><font style="vertical-align: inherit;">Le fait est qu'il ne pouvait pas. </font><font style="vertical-align: inherit;">Bitbucket ne fournit pas son propre convertisseur (mais pourrait). </font><font style="vertical-align: inherit;">Quelques m√©thodes googl√© plus, et aussi par. </font><font style="vertical-align: inherit;">J'ai d√©cid√© d'√©crire mes propres scripts, de toute fa√ßon ce n'est pas le seul d√©p√¥t mercuriel, il sera utile √† l'avenir. </font><font style="vertical-align: inherit;">Les premiers d√©veloppements seront pr√©sent√©s ici (car ils restent toujours sous la m√™me forme). </font><font style="vertical-align: inherit;">La logique du travail ressemble √† ceci:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous prenons l'extension mercurial hggit comme base.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous obtenons une liste de toutes les branches du r√©f√©rentiel mercurial.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous convertissons les noms de branches (merci √† mercurial et aux d√©veloppeurs pour les espaces dans les noms de branches, merci sp√©cialement pour les tr√©mas et autres personnages qui ajoutent de la joie √† la vie).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez des signets (hg bookmark) et poussez dans le r√©f√©rentiel interm√©diaire. </font><font style="vertical-align: inherit;">Pourquoi? </font><font style="vertical-align: inherit;">Parce que bitbucket et parce que vous ne pouvez pas cr√©er un signet avec le m√™me nom que le nom de la branche (par exemple, transfert).&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le nouveau r√©f√©rentiel (d√©j√† git), supprimez le suffixe du nom de la branche et migrez hgignore vers gitignore.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poussez vers le r√©f√©rentiel principal. </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Liste des commandes en fonction des points:</font></font><br>
<br>
<ol>
<li><pre><code class="bash hljs">$ <span class="hljs-built_in">cd</span> /path/to/hg/repo<font></font>
$ cat &lt;&lt; EOF &gt;&gt; ./.hg/hgrc<font></font>
[extensions]<font></font>
hggit=<font></font>
EOF<font></font>
</code></pre></li>
<li><pre><code class="bash hljs">$ hg branches &gt; ../branches
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
hgBranchList=<span class="hljs-string">"./branches"</span>
sed -i <span class="hljs-string">'s/:.*//g'</span> <span class="hljs-variable">${hgBranchList}</span>
symbolsToDelete=$(awk <span class="hljs-string">'{print $NF}'</span> FS=<span class="hljs-string">" "</span> <span class="hljs-variable">${hgBranchList}</span> &gt; sym_to_del.tmp)<font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> hgBranch; <span class="hljs-keyword">do</span>
  hgBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${hgBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${hgBranchList}</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> str; <span class="hljs-keyword">do</span>
  strToDel[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${str}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt; ./sym_to_del.tmp<font></font>
 <font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!strToDel[@]}</span>
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">${hgBranches[$i]}</span> | sed <span class="hljs-string">"s/<span class="hljs-variable">${strToDel[$i]}</span>//"</span> &gt;&gt; result.tmp
<span class="hljs-keyword">done</span><font></font>
 <font></font>
sed -i <span class="hljs-string">'s/[ \t]*$//'</span> result.tmp<font></font>
sed <span class="hljs-string">'s/^/"/g'</span> result.tmp &gt; branches_hg<font></font>
sed -i <span class="hljs-string">'s/$/"/g'</span> branches_hg<font></font>
sed <span class="hljs-string">'s/ /-/g'</span> result.tmp &gt; branches_git<font></font>
sed -i <span class="hljs-string">'s/-\/-/\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/-\//\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/\/-/\//g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/---/-/g'</span> branches_git<font></font>
sed -i <span class="hljs-string">'s/--/-/g'</span> branches_git<font></font>
rm sym_to_del.tmp<font></font>
rm result.tmp<font></font>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
hgBranchList=<span class="hljs-string">"./branches_hg"</span>
hgRepo=<span class="hljs-string">"/repos/reponame"</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> hgBranch; <span class="hljs-keyword">do</span>
  hgBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${hgBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${hgBranchList}</span><font></font>
 <font></font>
i=0<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>
  gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>
  i=$((i+<span class="hljs-number">1</span>))
<span class="hljs-keyword">done</span> &lt;<span class="hljs-variable">${gitBranchList}</span><font></font>
 <font></font>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${hgRepo}</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>
<span class="hljs-keyword">do</span>
  hg bookmark -r <span class="hljs-string">"<span class="hljs-variable">${hgBranches[$i]}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${gitBranches[$i]}</span>-cnv"</span>
<span class="hljs-keyword">done</span><font></font>
 <font></font>
hg push git+ssh://git@bitbucket.org:username/reponame-temp.git<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Done."</span>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># clone repo, run git branch -a, delete remotes/origin words to leave only branch names, delete -cnv postfix, delete default branch string because we can't delete it</span>
repo=<span class="hljs-string">"/repos/repo"</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
defaultBranch=<span class="hljs-string">"default-cnv"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>   gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>;   i=$((i+<span class="hljs-number">1</span>)); <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$gitBranchList</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$repo</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span> git checkout <span class="hljs-variable">${gitBranches[$i]}</span>-cnv; <span class="hljs-keyword">done</span>
git checkout <span class="hljs-variable">$defaultBranch</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span>
    git branch -m <span class="hljs-variable">${gitBranches[$i]}</span>-cnv <span class="hljs-variable">${gitBranches[$i]}</span>
    git push origin :<span class="hljs-variable">${gitBranches[$i]}</span>-cnv <span class="hljs-variable">${gitBranches[$i]}</span>
    git push origin -u <span class="hljs-variable">${gitBranches[$i]}</span>
<span class="hljs-keyword">done</span>
</code></pre></li>
<li><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># clone repo, run git branch -a, delete remotes/origin words to leave only branch names, delete -cnv postfix, delete default branch string because we can't delete it</span>
repo=<span class="hljs-string">"/repos/repo"</span>
gitBranchList=<span class="hljs-string">"./branches_git"</span>
defaultBranch=<span class="hljs-string">"default"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> gitBranch; <span class="hljs-keyword">do</span>   gitBranches[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">${gitBranch}</span>;   i=$((i+<span class="hljs-number">1</span>)); <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$gitBranchList</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$repo</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${!gitBranches[@]}</span>; <span class="hljs-keyword">do</span>
    git checkout <span class="hljs-variable">${gitBranches[$i]}</span>
    sed -i <span class="hljs-string">'1d'</span> .hgignore<font></font>
    mv .hgignore .gitignore<font></font>
    git add .<font></font>
    git commit -m <span class="hljs-string">"Migrated ignore file"</span>
<span class="hljs-keyword">done</span>
</code></pre></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais essayer d'expliquer la signification de certaines actions, √† savoir l'utilisation d'un r√©f√©rentiel interm√©diaire. Initialement, dans le r√©f√©rentiel apr√®s la conversion, les noms de branche contiennent le suffixe ¬´-cnv¬ª. Cela est d√ª √† la fonction de signet hg. Vous devez supprimer ce suffixe et cr√©er des fichiers gitignore au lieu de hgignore. Tout cela ajoute de l'historique et augmente donc la taille du r√©f√©rentiel (et de mani√®re d√©raisonnable). Comme autre exemple, je peux citer ce qui suit: essayez de cr√©er un r√©f√©rentiel et poussez le premier commit √† 300M avec le code dedans. Ajoutez-le ensuite √† gitignore et poussez-le sans lui. Il restera dans l'histoire. Essayez maintenant de le supprimer de l'historique (git filter-branch). Avec un certain nombre de validations, la taille du r√©f√©rentiel r√©sultant ne diminuera pas, mais augmentera. Ceci est r√©solu par l'optimisation, mais il ne peut pas √™tre lanc√© sur bitbucket.Elle n'est effectu√©e que lors de l'importation du r√©f√©rentiel. Par cons√©quent, toutes les op√©rations brutes sont effectu√©es avec un interm√©diaire, puis l'importation dans un nouveau est effectu√©e. La taille du d√©p√¥t interm√©diaire dans la finale √©tait de 1,15 G, et la taille du 350 M r√©sultant.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ensemble du processus de migration a √©t√© divis√© en plusieurs √©tapes, √† savoir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©paration (d√©monstration au client en utilisant un exemple de build, installation de logiciel, conversion de r√©f√©rentiel, mise √† jour des configurations ccnet existantes);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration CI / CD pour l'environnement de d√©veloppement et ses tests (l'ancien syst√®me continue de fonctionner en parall√®le);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres CI / CD pour les environnements restants (en parall√®le avec le "bon" existant) et tests;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev migration, staging et test;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration de la production et transfert de domaines des anciennes instances IIS vers les nouvelles.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La description de la phase pr√©paratoire achev√©e avec succ√®s est en cours de finalisation. </font><font style="vertical-align: inherit;">Un succ√®s grandiose n'a pas √©t√© atteint ici, sauf que le syst√®me existant n'est pas tomb√© en panne et que le r√©f√©rentiel mercurial dans git a √©t√© migr√©. </font><font style="vertical-align: inherit;">Cependant, sans une description de ces processus, il n'y aura pas de contexte pour des pi√®ces plus techniques. </font><font style="vertical-align: inherit;">La partie suivante d√©crira le processus de mise en place d'un syst√®me CI bas√© sur teamcity.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496186/index.html">Algorithme de propagation de retour d'erreur utilisant Word2Vec comme exemple</a></li>
<li><a href="../fr496188/index.html">Comment arr√™ter la fr√©n√©sie de regarder des √©missions de t√©l√©vision et commencer √† vivre</a></li>
<li><a href="../fr496190/index.html">√Ä propos des verbes Phrasal-2</a></li>
<li><a href="../fr496192/index.html">Appeler les fonctions Rust depuis Go</a></li>
<li><a href="../fr496194/index.html">Sur la binarisation d'images tomographiques √† structure fine</a></li>
<li><a href="../fr496206/index.html">Un milliard d'op√©rations dans la base de donn√©es en 0,3 seconde. Ne comparez pas OLTP avec OLAP, mais QuestDB avec PostgreSQL</a></li>
<li><a href="../fr496208/index.html">Comment JIT int√®gre notre code C # (heuristique)</a></li>
<li><a href="../fr496210/index.html">La biodiversit√© peut avoir √©volu√© √† partir du principe de jouer des ciseaux √† papier</a></li>
<li><a href="../fr496212/index.html"># 04 - Et un octet entier ne suffit pas ... | Prenez BK par les cornes</a></li>
<li><a href="../fr496214/index.html">AdColony: 89% des √©diteurs d'applications et de jeux mobiles utilisent des vid√©os promotionnelles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>