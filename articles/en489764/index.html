<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😳 🗯️ 🤤 “The Destination has a lot of guises ...” or we automate the control of a bulb using CANNY 3 tiny and a photoresistor 👨🏾‍🎓 👩🏼‍🎤 🔅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article on Habr, I told you about how I received the Canny3 tiny controller as a gift. We “blinked” the LED, pushed a button. On this, in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>“The Destination has a lot of guises ...” or we automate the control of a bulb using CANNY 3 tiny and a photoresistor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489764/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">last article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on Habr, I told you about how I received the Canny3 tiny controller as a gift. We “blinked” the LED, pushed a button. On this, in principle, it was possible to finish the experiments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, for the last couple of weeks I have been listening to audio books about The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Witcher</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and therefore have become much more serious about </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Destination</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . According to the information indicated on the manufacturer’s website, the CANNY family of controllers are primarily intended for the automation of various automobile systems and special equipment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The problem is that no one will let me poke around in a real car with my “golden hands”, and in general I'm afraid of cars. </font><font style="vertical-align: inherit;">Therefore, I had to buy a small car lamp and a photoresistor specially for this article. </font><font style="vertical-align: inherit;">What you will not do so as not to anger the Destiny. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Today we will connect the controller and the car lamp to a 12V power supply, send a message to the COM port, automate the inclusion of the lamp depending on the light, and try the high-frequency PWM controller. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do you also believe in the power of Destination? </font><font style="vertical-align: inherit;">Then you are welcome under cat.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/kd/tj/ytkdtjul2i1qbdrqllt278lszck.png"><br>
<a name="habracut"></a><br>
<br>
<a name="I"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part I: Introduction</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part I: Introduction </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part II: Components and Precautions </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part III: How to write data to the COM port </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part IV: Connect and program the autolamp and photoresistor </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part V: Trying to lower the lamp brightness using PWM </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part VI: Conclusion</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
At the very beginning of the article, I remind you I don’t have much experience in DIY electronics. </font><font style="vertical-align: inherit;">Many years ago I dabbled with CraftDuino - the domestic Arduino clone. </font><font style="vertical-align: inherit;">And apart from those "crafts" that he did for me</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drzugrik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this is actually my experience in DIY electronics is limited. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apparently, knowing my love for domestic developments, I decided to give Canny 3.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Even in the process of preparing the last article, I was surprised that the controller can be powered not only from 5V, but also from 12V, while the voltage at the outputs will be the same as on input, and the maximum current per channel is as much as 100mA. It seemed interesting to me, because my old CraftDuino could not. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By simple calculations using the formula</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo>=</mo><mi>U</mi><mo>&amp;#x2217;</mo><mi>I</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.993ex" height="2.009ex" viewBox="0 -755.5 4302.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-3D" x="1029" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMATHI-55" x="2085" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-2217" x="3075" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMATHI-49" x="3798" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo>=</mo><mi>U</mi><mo>∗</mo><mi>I</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">P=U*I</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I realized that the maximum power per controller output will be around 1.2 watts. It was decided to pick up a lamp with a power reserve, just in case. The choice fell on a 0.9 W LED bulb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, I still did not want to ingloriously burn my New Year's gift, and before connecting it, I decided to ask the developers if I understood everything correctly. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To my great surprise, they not only answered me, but also suggested that if you combine several outputs, then the power will increase proportionally. After that, it was decided to buy something more powerful than the lamp and the choice fell on the car fan, which is inserted into the cigarette lighter. However, in order not to make “vinaigrette” from the article, I decided to postpone manipulations with the automobile fan until the next time.</font></font><br>
<br>
<a name="II"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part II: Equipment and Precautions </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, by the beginning of the experiments, I had the following:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Charging and launching device "Orion Vympel-55". </font><font style="vertical-align: inherit;">I already had it and, fortunately, it can not only charge the batteries, but also be a power source in a wide range (including 12 V);</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/fi/_i/ujfi_iwx1hku88fcb2trgbdhvqu.jpeg"><br>
<br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED autolamp "Skyway H3. </font><font style="vertical-align: inherit;">SH3-9SMD-5050 W. " </font><font style="vertical-align: inherit;">As I understand it, the bulb can be used in various headlights, but I have nowhere to stick it, so I chose the power and ease of connection without soldering; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zw/vm/yi/zwvmyih0_5t0grxn5elq4j1zvfe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, returning to the power calculation formula, I decided to measure the currents and make sure that I fit into the permissible 100 mA. </font><font style="vertical-align: inherit;">In theory, the current of the bulb should be</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>I</mi><mo>=</mo><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mi>U</mi><mo>=</mo><mn>0.9</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>12</mn><mo>=</mo><mn>0</mn><mo>,</mo><mn>075</mn><mi>A</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.044ex" height="2.634ex" viewBox="0 -809.3 12504.8 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMATHI-49" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-3D" x="782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMATHI-50" x="1838" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-2F" x="2590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMATHI-55" x="3090" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-3D" x="4135" y="0"></use><g transform="translate(5192,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-39" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-2F" x="6471" y="0"></use><g transform="translate(6972,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-32" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-3D" x="8250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-30" x="9307" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-2C" x="9807" y="0"></use><g transform="translate(10252,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-37" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/489764/&amp;usg=ALkJrhisrnje8YqAFaaVOo3DeJOzyLrmRQ#MJMATHI-41" x="11754" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>=</mo><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>U</mi><mo>=</mo><mn>0.9</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>12</mn><mo>=</mo><mn>0</mn><mo>,</mo><mn>075</mn><mi>A</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">I=P/U=0.9/12=0,075A</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But judging by the measurement, it turned out a little less. </font><font style="vertical-align: inherit;">Although maybe I just did something wrong.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gl/fw/qv/glfwqvsyuybaay2nr5bdftlk2n8.png"><br>
<br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photoresistor FR-765. </font><font style="vertical-align: inherit;">I chose him simply because there was nothing else in the store.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h9/zq/gq/h9zqgqgqp4vfwhhoreh_qxmo5aa.png"></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, of course I had: a controller, a breadboard, wires, crocodiles, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a previous article about Canny 3, I really praised the controller, but it turned out that there is one fly in the ointment. </font><font style="vertical-align: inherit;">Last time I did not use the bundled cable bundle that came with the kit, but this time I could not do without it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since I use a soldering iron very poorly, I wanted to reduce its use to a vital minimum. </font><font style="vertical-align: inherit;">Therefore, in the end, I collected all the circuits on detachable connections. </font><font style="vertical-align: inherit;">I used special wires (dad-dad, mom-mom, mom-dad), breadboards and crocodile clips.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And if the developers of the controller are not to blame for the fact that in the process of stripping the cable I got a couple of cuts, then the moments in which my entire structure fell to the floor due to the fact that I hooked the "wooden" harness, partly on their conscience. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the one hand, a tourniquet is a good thing. To install the controller inside the car, the cable harness I think is just right. The wires in it are stranded and if they are twisted well, then they completely fit into the connectors "mother" of my "breadboard" wires. On the other hand, how it is not convenient to do experiments with the cable with the breadboard, even a beautiful photo with the controller turned in full face was difficult to do because of the “oak wires”. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I said a little higher that I did not want to use a soldering iron, but at least once they would have to arm themselves.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to measure the signal from the photoresistor, we need to “insert” it into the analog-to-digital converter (ADC) of the controller. </font><font style="vertical-align: inherit;">But the fact is that, unlike, for example, my old Craftduino. </font><font style="vertical-align: inherit;">In the case of Canny, it turned out to be necessary to put a jumper. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the beginning, I did not carefully read the documentation and thought that the 5 and 6 output of the controller are the outputs of A5 and A6. </font><font style="vertical-align: inherit;">I even wrote a program and tried for a long time to take readings. </font><font style="vertical-align: inherit;">Naturally, I did not succeed because by default, without preliminary preparation, channels No. 5 and 6 work as a normal discrete input. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After reading the documentation for the controller on a "fresh mind", I realized that I still have to solder. </font><font style="vertical-align: inherit;">You have no idea how I was afraid to “screw up” everything.</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The last time I tried to solder something in the circuit that I did for me </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drzugrik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, I managed to fill in all the capacitors with solder near the place of soldering. </font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This time the soldering process was simple. </font><font style="vertical-align: inherit;">It was enough to very carefully put a drop of solder on the track. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What my solder jumper looks like can be seen in the photo below:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/r9/vd/pvr9vdryjakzmbjalenhh6wrn9a.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I have connected only the 6th output to channel A6, I did not dare to solder the fifth channel, so as not to accidentally fill both jumpers with solder. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Purely theoretically, it was possible to do without a soldering iron by connecting the hole and terminal No. 6 with a wire. </font><font style="vertical-align: inherit;">But that would be terribly inconvenient. </font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The photo below shows the connection of pin No. 5 and ADC pin No. A5 with a dad-to-dad wire: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/l6/hb/qul6hbndz9lv1jwj8rq-m34sipe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last thing you should pay attention to before getting down to business. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attention!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not repeat one to one, what I will describe further on the text. </font><font style="vertical-align: inherit;">Do not be lazy to replace the plug-in connections with soldering, pick up thicker wires, read the documentation. </font><font style="vertical-align: inherit;">I am not an expert in these matters, so I put everything together "as best I could." </font><font style="vertical-align: inherit;">I also advise you to carefully monitor the fire hazard, and not to leave equipment unattended. </font><font style="vertical-align: inherit;">I managed to smell a few smoldering wires a couple of times. </font><font style="vertical-align: inherit;">Well, even in the power supply there was protection against short circuit (I also arranged it). </font><font style="vertical-align: inherit;">Therefore - please be careful. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, do not forget that in spite of the fact that the voltages and currents we have are small, still touching the live parts under voltage can be painful </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(especially if you poke them with a wounded part of the body)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="III"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part III: How to write data to COM port</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to somehow calibrate our ambient light sensor, we need to understand what values ​​it sends to the controller depending on the light level. To do this, we need to output data from the ADC to the monitor. When working with Arduino and its clones to solve such problems, I used a COM port monitor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of Canny 3 tiny, the process of reading data from a virtual COM port is not much more complicated than for Arduino. But there is one key difference. The CannyLab development environment does not have its own COM port monitor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I used </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hterm</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> because it is cross-platform, lightweight and does not require installation. But you can use any other. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will say even more, nothing will stop us from using the Arduino IDE COM port monitor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything worked out of the box on my Windows 10 system and I didn’t have to install drivers for the virtual COM port separately. But just in case, I’ll say that the driver seems to be bundled with the CannyLab development environment (it’s in the drv \ canny3tiny_vcp folder). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order not to further explain how the chart blocks associated with sending data to USB virtual COM-port work, I will give a simple example. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Today, as a workout, we will send the message “HABR” using the controller. First you need to download the IDE CannyLab. It can easily be found on the official website of the developer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, I used CannyLab v 1.42, but I think in previous versions there will be no problems with the performance of diagrams.</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The process of writing software to the new controller and the basic principles of working with Cannylab I outlined in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 3 of the last article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Create a new chart, select Canny 3 tiny in the dialog box. And we transfer blocks, constants and registers to the diagram, as in the screenshot below. Of course, it is not necessary to transfer text labels; nothing depends on them during the execution of the diagram. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rz/st/g9/rzstg9zmltxsf2ekndo4orydcnu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you don’t feel like moving blocks yourself, you can download the diagrams for this article using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
It should be noted that sending a message to the COM port works a bit strange and you have to write letters in a pair of characters in a mirror, but you can get used to it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will explain in parts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font><b><font style="vertical-align: inherit;">"Parameter Setting"</font></b><font style="vertical-align: inherit;"> block</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we set the USB VCP driver settings. First, enable the transfer mode on the virtual COM port, and then set the length of the transmitted message. In our case - 6 characters including line feed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Message Text"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block </font><b><font style="vertical-align: inherit;">,</font></b><font style="vertical-align: inherit;"> we write the message text in constants (do not forget to switch to the "chr" mode) and transfer these constants to the corresponding driver registers. Once again I draw your attention to the fact that we write the message in the reverse order, both in the symbol pairs themselves and in the driver registers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Last block </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Message Transfer"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sends with a specified frequency our message to the COM port. For this we use a PWM block. Do not confuse it with the RF PWM, which we will use when connecting the lamp. In this case, the block generates half the time “0”, and the second half “1”. You can "play around" with the size of the period and fill to increase or decrease the frequency of sending messages. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connecting a green LED to this PWM block is necessary in order to check the operation of the controller. If everything is in order, the LED will blink with the frequency of sending a message. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to write a program to the controller, I already said </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in a previous article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . However, over the past time I have learned another cool trick.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we connect the controller to the computer, it enters the program recording mode. Previously, in order to go into runtime mode, I removed the controller from the computer and stuck USB charging into it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turned out that there is an easier way. After you have connected the controller to the USB port of the computer and clicked the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Connect”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button in CannyLab </font><font style="vertical-align: inherit;">, go to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Device”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menu and select </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Run”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/dt/bv/b-dtbvog9sirji-opbj-ehor-hm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The controller starts to execute the recorded program, receiving power from the USB port. Also after that the controller will become available in the monitor of the COM port. True, in order to switch back to the program recording mode, the controller will need to be removed and reinserted into the computer’s USB port.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here is our “HABR” in the Hterm COM port monitor. </font><font style="vertical-align: inherit;">Pay attention to the data transfer speed and other settings. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/lh/yu/lslhyucpy7cxrmexfqnn3l5swgi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And this is the Arduino IDE COM port monitor: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/zd/vl/abzdvlqwpn6jaw0q0uuzx06ltzo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The photo shows how the controller works after recording the diagram: The </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qv/4n/zu/qv4nzuowx6saogj5xskvkn7dt3w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
red LED signals that power is being received via the computer’s USB port, and the green “blinks” to the beat of messages transmitted via the virtual USB COM port.</font></font><br>
<br>
<a name="IV"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part IV: We connect and program a car lamp and a photoresistor.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To begin, we will consider the simplest option. Just connect the lamp to terminal No. 1 of the controller, and the photoresistor to terminal No. 6 (ADC). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is quite simple, but just in case, I drew a diagram: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sv/un/pm/svunpmu3hc-n4agrotbzy2rquea.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But here it looks live: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ap/az/z8/apazz8ybxdpnfnaxf9y3c-daabc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“-” and “+” of the power source we connect to the corresponding terminals of Canny 3 tiny, pin No. 1 is connected to the lamp housing, and the “tail” of the lamp with a plus on the breadboard of the breadboard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With a photoresistor, too, everything is simple. Plus, we bring the breadboard from the bus to the breadboard, and the minus goes to pin No. 6 of the controller, which we previously connected with the jumper to the ADC. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I already wrote above that my whole structure fell a couple of times from the table. Therefore, further on the photos there may be slight differences in terms of the colors of the conductors and the points of their entry into the breadboard.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we’ll write a program. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n1/7s/l8/n17sl8exoem1_jl54mqgb-bapeg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the new day us blocks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start with the block </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Getting the value from the ADC and converting it to suites”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this block, we translate the values ​​that the ADC (0 to 1023) can give us in illumination (lux). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need to make one measurement of illumination when it is light and one measurement in darker conditions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accordingly, in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“value from”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I recorded the minimum ADC reading “0”, and in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“result from” the</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zero value of the illumination level. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“value to”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I recorded the ADC readings = 20, and the corresponding illumination equal to 300 lux, I entered in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“result to”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I do not have a detailed description of the parameters of the photoresistor, but I suspect that it does not have a completely linear characteristic, but this is enough for us now. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pre-check how the diagram is performed in the simulator. In more detail about work in the CannyLab simulator I wrote </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is what I ended up with: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mp/yw/no/mpywnolxlvzxyaqqkeyy3oh2m-u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine that the photoresistor passed a value of 10 to the ADC. The </font><b><font style="vertical-align: inherit;">“Display (MAP)”</font></b><font style="vertical-align: inherit;"> block</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this is essentially linear scaling. Ten is exactly half of the scale of our scale, which means that the output will be half the range 0 - 300, namely 150. This is below the specified level of 300 lux. Therefore, one is sent to the channel register No. 1 (output No. 1) and the lamp turns on . But it will not turn on immediately, but only if it is dark for at least one second (1000 milliseconds). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To understand what message we will receive in the COM port, I switched the display of the values ​​in the simulator to hexadecimal format. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mq/nr/rk/mqnrrkxyzudcput-yez77oke13a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“VCP message setup register D1: D0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the value 3130 comes into it. As we recall, this is a pair of characters, each part of which represents a hexadecimal character code. It turns out that 31h is the character code “1” in ASCII, 30 is the zero code in ASCII.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"VCP D3: D2 message installation register</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , we will accordingly have the characters" 0 "and" 5 ". We collect the values ​​of the pairs of characters in the order from D0 to D3 we get: "0", "1", "5", "0". So we got our 0150 lux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But as they say "not a single simulator ...". Let's see what happens in practice. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Measurement under the light from the chandelier and natural light (combined lighting): The </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/ze/ps/ofzepsndi0bepg1hwoxzursk7my.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
readings of the factory light meter and our homemade one coincide almost perfectly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metering in daylight: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w_/kz/aq/w_kzaqulbnhvr-pq2tsdcy7pqu8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Extremely worse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is probably due to the non-linearity of the characteristics of the photoresistor, and also because we set the lower scaling limit to zero, but we will not complicate the diagram in order to increase the measurement accuracy; for our example, the main thing was to understand the general principle of obtaining illumination values. </font><font style="vertical-align: inherit;">And increasing accuracy can be delayed until the implementation of these projects in the car or at home. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We check the operation of the circuit, close the sensor with a finger, and then remove the finger. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4f/nh/qd/4fnhqd-jpxmvsbj5wtvwnokgybg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And now there’s an option when it’s just dark in the room: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/d7/lc/5rd7lcy5_cdx339o6z6c39r3y5i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The lamp is on. </font><font style="vertical-align: inherit;">Everything works as it should.</font></font><br>
<br>
<a name="V"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part V: Trying to lower the lamp brightness using PWM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's complicate the scheme a bit by changing the brightness of the lamp. To do this, we need a high-frequency PWM (RF PWM), in Canny 3 tiny it is implemented at outputs No. 3 and No. 4. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I decided to use output No. 4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The connection scheme will remain practically unchanged. Simply, instead of output No. 1, we connect output No. 4 to the lamp. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qp/bg/b-/qpbgb-a7whds1vugbizqoyr3its.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is how it looks in assembly. All the difference is that instead of a white wire, the frame is now blue. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2t/z3/nl/2tz3nldjplnly2tzmo7ttrb0he0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The diagram, too, has not changed much. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/or/fx/wl/orfxwlbv1adspw_c0fv2ouenqhy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not paint the diagram in detail. The main changes in the configuration of output 4, which we use for PWM. In this section, we must set the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Fill Setting Register"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It takes values ​​from 2 to 255 microseconds, I decided not to risk it and chose 254. Note that it is installed for two channels at once (No. 3 and No. 4). Then we write “1” in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“PWM channel enable register No. 4”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> thereby including the PWM of our light bulb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the block </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Turning on the lamp in PWM mode (with low brightness)”,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> new for us is only </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Register for setting the filling channel No. 4, μs”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We will write the value “10” in it, provided that the level of illumination above the photosensor was less than 250 lux, in within 1 second. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The photo below shows that the lamp turns on, but it shines dimly.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/pp/_t/ompp_teo-f76yagfthj5qylheus.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want the lamp to glow brighter, you only need to change the value of the constant “10” to any larger number. For example, you can take the number 127, in our case it is half the time it takes to fill the RF PWM period, which means about half the brightness of the lamp. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lx/ni/3t/lxni3tbt3zw1y6lyqthoqqufc1w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It should be noted that the RF PWM with this lamp works quite noticeably. Here are three photos: on the first, we set the </font><font style="vertical-align: inherit;">value </font><font style="vertical-align: inherit;">in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Register for filling channel number 4”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to 10 μs, on the second - 110 μs, on the right - 210 μs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/os/_w/udos_wpczlgn2m1naf4nc5053da.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In principle, the autolamp from our example, as I understand it, is used in position signals and sometimes in fog lamps of cars.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I think that if we refine the scheme and the diagram, then it would be possible to implement the inclusion of backlighting in low light on older machines. </font><font style="vertical-align: inherit;">True, you need to consider the effect of artificial lighting at night. </font><font style="vertical-align: inherit;">So that on the roads, in the tunnels and from the headlights of oncoming cars, the lamp did not go out. </font><font style="vertical-align: inherit;">Or it would be possible to control the lamp in the passenger compartment so that, for example, the lamps in the doors of the Zhiguli or Niva would not always light up when opened.</font></font><br>
<br>
<a name="VI"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part VI: Conclusion </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the process of writing this article, I experienced a strong sense of nostalgia. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While studying at the institute, my friend and classmate Seryoga had a chic blue VAZ 2107 brand sedan. What he just didn’t do with him: he’ll attach some kind of hose (to increase boost), install a fan in the passenger compartment so that he turns on by a separate button, then he will make the car start at the press of a button (only with the key turned ignition). In general, he just did not “tune” his “swallow”. Many years have passed since then, my friend moved to a more solid car, but I’m scared to imagine what he would do with his Zhiguli if he got this controller 10 years ago.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks to this article, I also remembered my Destination. After all, I studied for many years as an automation engineer, but I did not work a day purely in my specialty. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Turns out it's so cool to dive into the DIY world. In the process of assembling the circuits more than once “stuck” turning the bulb and LED on / off with a button. It is a pleasant feeling when something works as intended. I also caught myself on the idea that programming a controller using diagrams is a more meditative task than writing code in the Arduino IDE. A completely different perception of the program. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While writing this article, I ordered myself a version of Canny 3 tiny without cable harness. Now I’ll have a little rest and write an article about installing this controller in a breadboard, and by itself we will analyze a few more examples of lighting automation with its help.</font></font><br>
<br>
<i>   ,  ,    . </i><br>
<br>
<i>UPD:<br>
,       ,            :</i><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">«, ,  –  !»       CANNY 3 tiny</a>.<br>
</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">«  ...»         (CANNY  Arduino)  Raspberry PI</a>.<br>
</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">« ?»     bluetooth      Xamarin (Android)</a>.<br>
</li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489754/index.html">20 project management systems, overview of 100 chips</a></li>
<li><a href="../en489756/index.html">Create a pencil effect in SVG</a></li>
<li><a href="../en489758/index.html">Angular: an example of using NGRX</a></li>
<li><a href="../en489760/index.html">Consciousness and existence. Quantum mechanics without paradoxes</a></li>
<li><a href="../en489762/index.html">A simple example of parsing and data analytics for World of Tanks</a></li>
<li><a href="../en489768/index.html">How π combines colliding blocks and a quantum search algorithm</a></li>
<li><a href="../en489770/index.html">Video from MinskJS mitap: my report on browser extensions</a></li>
<li><a href="../en489772/index.html">Hackathon in Simferopol, Yandex. Dialogs and laws of chat-bot technology</a></li>
<li><a href="../en489774/index.html">The tale of how I automated the apartment using Node-RED. Part II</a></li>
<li><a href="../en489776/index.html">The Ember Times - Issue 136</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>