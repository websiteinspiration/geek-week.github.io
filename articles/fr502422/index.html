<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèø üë©üèø‚Äçüíª üìè R√©duction de 60% de la taille de l'application React Native en quelques √©tapes simples ü§≤üèº ü¶í ‚öíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je travaille chez Mutual . Elle travaille au Br√©sil, dans le domaine de l'√©galit√© de cr√©dit. Nous aidons les emprunteurs et les pr√™teurs √† se connecte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>R√©duction de 60% de la taille de l'application React Native en quelques √©tapes simples</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/502422/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je travaille chez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mutual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Elle travaille au Br√©sil, dans le domaine de l'√©galit√© de cr√©dit. </font><font style="vertical-align: inherit;">Nous aidons les emprunteurs et les pr√™teurs √† se connecter les uns aux autres. </font><font style="vertical-align: inherit;">Les premiers recherchent de bons paris, tandis que les seconds recherchent un revenu sup√©rieur √† ce que le march√© peut leur offrir. </font><font style="vertical-align: inherit;">Notre produit est utilis√© par un large √©ventail d'utilisateurs, nous travaillons dans un grand pays. </font><font style="vertical-align: inherit;">En cons√©quence, nos applications iOS et Android bas√©es sur React Native se t√©l√©chargent sur des appareils tr√®s diff√©rents.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/59/3g/lf/593glf1nnlud4u0pbaogbghegiy.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que la plupart de nos utilisateurs installent des applications sur des appareils √† petit budget. </font><font style="vertical-align: inherit;">Nous pouvons tirer de telles conclusions en utilisant les donn√©es de la biblioth√®que de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">classe d'appareil de</font></a><font style="vertical-align: inherit;"> Facebook.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cette biblioth√®que, apr√®s avoir re√ßu des informations sur le mod√®le de l'appareil, indique l'ann√©e dans laquelle cet appareil serait consid√©r√© comme un t√©l√©phone phare haut de gamme. </font><font style="vertical-align: inherit;">Par exemple, le t√©l√©phone le plus populaire parmi nos utilisateurs est le Samsung Galaxy A10. </font><font style="vertical-align: inherit;">Ce t√©l√©phone, bien qu'il soit sorti en 2019, ne pouvait √™tre consid√©r√© comme le produit phare qu'en 2013. En analysant les donn√©es sur les appareils des utilisateurs, nous pouvons dire que 85% de ces appareils ne pouvaient √™tre reconnus comme des appareils haut de gamme qu'en 2015 ou avant. </font><font style="vertical-align: inherit;">Pour cette raison, nous avons des exigences particuli√®res pour optimiser notre application mobile. </font><font style="vertical-align: inherit;">Le but de l'optimisation est que m√™me les utilisateurs avec des appareils faibles puissent utiliser confortablement notre application.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/e6b/cf3/1e2e6bcf354e0ed85e47f70b1570dbba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourcentage d'appareils pouvant √™tre reconnus comme phares au cours d'une ann√©e donn√©e</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä cet √©gard, nous avons pr√™t√© une attention particuli√®re √† la taille de l'application. Dans le cas de sa version Android, il √©tait de 26,8 Mo. Bien que ce ne soit pas une si grande taille, c'est certainement plus que la taille m√©diane des applications de nos utilisateurs. Selon la console Google Play, ce chiffre est de 16,3 Mo. La taille de l'application peut √™tre un facteur d√©cisif pour les utilisateurs avec des plans tarifaires limit√©s, ou pour ceux avec des dispositifs √† faible m√©moire, ce qui oblige les utilisateurs √† s√©lectionner soigneusement les applications qu'ils auront install√©es. Par cons√©quent, certaines applications doivent √™tre d√©sinstall√©es. Cela est particuli√®rement important dans le cas de la demande mutuelle, car les emprunteurs paient des versements mensuels via cette application. Lorsque l'emprunteur d√©sinstalle notre application, les chances qu'il effectue le paiement √† temps sont consid√©rablement r√©duites.Et cela affecte directement les revenus des investisseurs utilisant notre plateforme.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/cea/78e/72ccea78ee7c05e86b626c0cf6ea45ef.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La taille de l'application Mutual est beaucoup plus grande que la taille m√©diane des</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
applications</font><i><font color="#999999"><font style="vertical-align: inherit;"> de nos utilisateurs</font></font></i><font style="vertical-align: inherit;"> . La taille de l'application n'affecte pas seulement le niveau des d√©sinstallations. La taille affecte √©galement le taux de conversion des param√®tres d'application.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voici un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bon article √† ce sujet r√©dig√© par l'√©quipe Google Play. Cet article explique l'importance de la taille de l'application. En particulier, il indique que chaque 6 Mo suppl√©mentaires de la taille du fichier APK r√©duit le taux de conversion des installations de 1%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils parlent √©galement du fait que dans les pays en d√©veloppement o√π les dispositifs budg√©taires sont la norme, cet effet est encore plus fort. A savoir, la r√©duction de la taille du fichier APK de 10 Mo dans les march√©s √©mergents correspond √† une augmentation du taux de conversion des installations d'environ 2,5%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/624/15d/1c162415de7e88ff4c5ed89853b6483b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Augmenter le taux de conversion des installations pour chaque 10 Mo de r√©duction de la taille du fichier APK dans diff√©rents pays (selon les donn√©es internes de Google)</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous √©tions tr√®s motiv√©s par la fa√ßon dont la r√©duction de la taille de l'application peut affecter le niveau de d√©sinstallation et le taux de conversion des param√®tres d'application. </font><font style="vertical-align: inherit;">En cons√©quence, nous nous sommes mis au travail afin de r√©duire autant que possible la taille de l'application, en tenant compte de sa commodit√© pour les utilisateurs. </font><font style="vertical-align: inherit;">La premi√®re √©tape de ce projet a √©t√© d'analyser les</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recommandations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> officielles de</font><font style="vertical-align: inherit;">Google pour les d√©veloppeurs Android.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensemble d'applications Android</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En lisant les recommandations, nous avons appris que la fa√ßon la plus simple de r√©duire la taille d'une application est d'utiliser une nouvelle m√©thode de distribution d'application appel√©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android App Bundle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (AAB). Jusqu'√† ce moment, nous avons distribu√© l'application, collect√© le bon vieux </font><font style="vertical-align: inherit;">fichier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Package</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (APK), qui peut √™tre ex√©cut√© sur la plupart des appareils Android, et t√©l√©charg√© vers la console Google Play. Mais le bundle AAB ne contient que du code et des ressources compil√©s. Par cons√©quent, lors de son t√©l√©chargement, Google est responsable de la g√©n√©ration de fichiers APK optimis√©s pour diff√©rents types d'appareils, en tenant compte de leurs sp√©cifications et de leur architecture CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re qu'en apportant un simple changement au processus de construction du projet, pouvons-nous obtenir une r√©duction s√©rieuse de la taille de l'application sans faire plus d'efforts? C'est trop beau pour la v√©rit√©! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir lu la documentation, nous venons de changer le script de construction React Native Gradle afin qu'il </font></font><code>assembleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'ex√©cute √† la </font><font style="vertical-align: inherit;">place du script actuel </font></font><code>bundleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. C'est tout ce dont nous avions besoin pour cr√©er le fichier AAB. Apr√®s quelques modifications suppl√©mentaires apport√©es √† la </font></font><code>supply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configuration </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fastlane</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> concernant le t√©l√©chargement automatique de documents directement sur le Play Store, nous sommes pass√©s √† AAB et une nouvelle version de notre application est apparue dans la console Google Play.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce changement √† lui seul a entra√Æn√© une r√©duction de la taille des fichiers APK transf√©r√©s sur les appareils des utilisateurs. La diminution variait de 9,1 √† 12,4 Mo. Il s'est av√©r√© que l'utilisation du bundle d'applications Android est une technique efficace qui, en effet, vous permet de r√©duire la taille de l'application.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/feb/57b/9e5feb57bf54450425a6dc54da48f613.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ancien fichier APK et le nouveau bundle AAB, dont l'utilisation conduit au fait que la taille de l'application sur diff√©rents appareils peut aller de 14,4 √† 17,7 Mo.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vrai, vous devez √™tre prudent ici. </font><font style="vertical-align: inherit;">Si vous utilisez React Native avec</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hermes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous devrez peut-√™tre mettre √† jour votre d√©pendance</font></font><code>soloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(voir les d√©tails</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Sinon, il existe un risque de donner √† l'utilisateur une application qui contiendra une erreur critique. </font><font style="vertical-align: inherit;">Nous avons eu de la chance, nous avons pu identifier ce probl√®me lors des tests de la version alpha du projet. </font><font style="vertical-align: inherit;">Mais l'erreur pourrait facilement se glisser en production, car elle n'appara√Æt pas lors des tests locaux ou lors de la cr√©ation du fichier APK.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimisation des ressources d'application √† l'aide d'Android Size Analyzer</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prochaine suggestion d'optimisation des applications que nous avons trouv√©e dans la documentation √©tait l'utilisation d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Size Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il s'agit d'un outil en ligne de commande qui analyse les applications Android et cherche des moyens de r√©duire leur taille. </font><font style="vertical-align: inherit;">Nous avons lanc√© cet outil √† l'aide d'une commande de la forme suivante:</font></font><br>
<br>
<pre><code class="javascript hljs">size-analyzer check-bundle [BUNDLE].aab
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, nous avons obtenu une liste d'excellentes ressources d'application et d'images que nous pouvons optimiser. </font><font style="vertical-align: inherit;">Il nous a √©galement √©t√© recommand√© de configurer ProGuard.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed0/a26/0b0/ed0a260b0a19878cf664c53ec54c9026.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rapport d'analyseur de taille</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçProGuard</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ProGuard est un outil pour compresser, masquer et optimiser le bytecode Java. </font><font style="vertical-align: inherit;">Nous n'avons pas encore explor√© la possibilit√© d'utiliser cet outil, car nous avons appris qu'il pourrait ne pas √™tre compatible avec certaines biblioth√®ques Android. </font><font style="vertical-align: inherit;">Puisque nous nous sommes efforc√©s de r√©duire la taille de notre application le plus rapidement possible et de rendre cela aussi simple que possible, nous avons d√©cid√© de laisser cette m√©thode d'optimisation √† l'avenir.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçGrandes ressources d'application</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En l'ex√©cutant √† </font></font><code>size-analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveau, avec la cl√© </font></font><code>-d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous avons obtenu une liste de ressources d'application, tri√©es par leur taille. </font><font style="vertical-align: inherit;">√âtant donn√© que cet outil ne sait rien de la fa√ßon exacte dont les utilisateurs travaillent avec l'application, il nous a donn√© la possibilit√© de d√©cider ind√©pendamment quelles ressources doivent √™tre supprim√©es et lesquelles doivent √™tre charg√©es dynamiquement dans l'application.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/d84/262/900d84262161b1440fe03e0d8b0d4fab.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des ressources d'application volumineuses tri√©es par taille</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La premi√®re et la plus grande ressource de cette liste √©tait le bundle React Native JavaScript. </font><font style="vertical-align: inherit;">Maintenant, nous ne pouvons pas fractionner ce bundle et le charger dynamiquement. </font><font style="vertical-align: inherit;">Mais plus tard, nous y penserons. </font><font style="vertical-align: inherit;">Plus bas dans la liste se trouvent de gros fichiers de polices (TTF) et des fichiers d'images (JPG et PNG).</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Images inutiles</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre attention a √©t√© imm√©diatement attir√©e sur les √©normes images JPG utilis√©es dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">livre de contes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous utilisons ce syst√®me pour d√©velopper et tester des composants. </font><font style="vertical-align: inherit;">Il s'agit de 2 Mo de d√©chets tomb√©s dans la version de production du projet. </font><font style="vertical-align: inherit;">Erreur honteuse! </font><font style="vertical-align: inherit;">Quand quelque chose comme √ßa se produit, nous avons l'impression d'avoir fait une grave stupidit√©. </font><font style="vertical-align: inherit;">Mais dans le monde complexe du d√©veloppement logiciel, tout le monde fait des erreurs. </font><font style="vertical-align: inherit;">Je crois que si vous parlez de vos erreurs publiquement, cela aidera les autres d√©veloppeurs √† apprendre de ces erreurs. </font><font style="vertical-align: inherit;">Il est possible que vous fassiez les m√™mes erreurs si vous n'analysez pas la structure des ressources de l'application, dont la taille augmente progressivement.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Polices</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s nous √™tre rapidement d√©barrass√©s des images inutiles, nous avons proc√©d√© √† l'analyse d'autres √©l√©ments de la liste des ressources. Il √©tait clair qu'il y avait beaucoup de polices int√©gr√©es. Apr√®s en avoir discut√© avec nos concepteurs, ils nous ont dit que de nombreux anciens composants ne diff√®rent pas dans le strict respect des manuels typographiques. Par cons√©quent, nous avons d√©couvert quels composants peuvent √™tre supprim√©s et dans lesquels vous pouvez utiliser les polices mises √† jour appropri√©es. Gr√¢ce √† cela, nous avons pu r√©duire le nombre de polices utilis√©es de six √† quatre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre chose que nous avons remarqu√©e √©tait la taille m√™me des fichiers de polices eux-m√™mes. La taille de chacun d'eux √©tait d'environ 670 Kb. Cela signifie que quatre polices du paquet non compress√© occupent un superbe 2,7 Mo. Mais, heureusement, il existe un outil appel√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FontForge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui vous permet d'analyser et de modifier en profondeur les fichiers de polices. √Ä l'aide de cet outil, nous avons pu d√©couvrir que la principale raison de la grande taille des fichiers de police √©tait les caract√®res cyrilliques √©tendus et les glyphes inutiles. Nous pourrions supprimer tout cela en toute s√©curit√©, car la partie texte de notre application est enti√®rement √©crite en portugais. Gr√¢ce √† ce changement, nous avons pu r√©duire la taille des fichiers de polices de 670 Ko √† 70 Ko - de 90%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d0/144/f9c/7d0144f9c3954dee6570347075fbe392.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples de glyphes inclus dans nos polices.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Du fait que nous avons supprim√© les polices inutiles et optimis√© les autres, nous avons pu r√©duire la taille de l'application de 3,8 Mo. </font><font style="vertical-align: inherit;">Cela a entra√Æn√© une r√©duction agr√©able de 2 Mo de la taille totale du fichier APK.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/62c/a55/52b62ca55ea0178919421a1c08304adc.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des polices et de leurs tailles avant optimisation</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83e/374/6db/83e3746db754c475501170c6e4372c49.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des polices et de leurs tailles apr√®s optimisation</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçOptimisation des images</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir analys√© les images qui restaient encore dans l'application, nous avons remarqu√© que certaines d'entre elles sont assez grandes. </font><font style="vertical-align: inherit;">Nous avons trait√© plusieurs de ces images avec l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outil d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> optimisation graphique </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">TinyPNG</font></a><font style="vertical-align: inherit;"> et constat√© une r√©duction significative de la taille de ces images. </font><font style="vertical-align: inherit;">Apr√®s cela, nous avons d√©cid√© d'optimiser toutes les images JPG et PNG utilis√©es dans l'application. </font><font style="vertical-align: inherit;">Il y en avait 41.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa5/8e9/9e6/aa58e99e6307077787f37d0d60fc59db.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image avant et apr√®s optimisation</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cela nous a permis de r√©duire la taille des images de 2,5 Mo √† 756 Ko, soit 70%. </font><font style="vertical-align: inherit;">Cependant, du fait que les images n'√©taient pas optimis√©es auparavant, elles ont √©t√© compress√©es lors de la cr√©ation du fichier APK final. </font><font style="vertical-align: inherit;">Il s'est av√©r√© que notre optimisation a entra√Æn√© une diminution de la taille de l'application t√©l√©charg√©e par l'utilisateur de seulement 500 Ko. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, nous avons r√©alis√© que nous avions d√©j√† √©puis√© toutes les possibilit√©s d'optimisation rapide. </font><font style="vertical-align: inherit;">La poursuite de l'optimisation des ressources n√©cessiterait soit de grands efforts, soit seulement des am√©liorations mineures.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React Native JavaScript Bundle Optimization</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir compris les ressources d'application sp√©cifiques √† la plate-forme Android, il est temps d'analyser le bundle JavaScript. </font><font style="vertical-align: inherit;">L'optimisation des bundles peut √™tre consid√©r√©e comme une bonne id√©e pour trois raisons. </font><font style="vertical-align: inherit;">Premi√®rement, cela r√©duit la taille du fichier APK fini. </font><font style="vertical-align: inherit;">Deuxi√®mement, cela entra√Æne un lancement plus rapide de l'application, car la machine virtuelle JS doit traiter moins de code. </font><font style="vertical-align: inherit;">Enfin, et surtout, cela acc√©l√®re les mises √† jour OTA que nous faisons plusieurs fois par semaine en utilisant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodePush</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Analyseur de bundles et optimisation de code</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de prendre une d√©cision sur la fa√ßon de r√©duire la taille de l'ensemble, vous devez d'abord d√©terminer ce qui prend le plus de place dans l'ensemble. Pour ce faire, nous avons utilis√© l'excellent outil open source </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">react-native-bundle-visualizer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Apr√®s avoir analys√© le projet avec son aide, nous avons obtenu une visualisation dans laquelle chaque dossier et chaque d√©pendance d'application √©taient pr√©sents, indiquant les tailles des entit√©s correspondantes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f2/641/4c0/7f26414c02bec1a7cf7bcd6b901fb837.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instantan√© des biblioth√®ques et dossiers de la base de code du frontend de l'application Mutual avec indication des tailles</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous avons d√©couvert que la taille totale du bundle est de 5,49 Mo. 57,8% de ce volume est repr√©sent√© par des d√©pendances du dossier</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 27,5% - code d'application. Ce qui reste, l'outil utilis√© par nous n'a pas pu √™tre identifi√©. Pendant le processus d'assemblage du bundle, le code inutilis√© a d√©j√† √©t√© supprim√©, donc ce que nous avons vu √©tait du code qui est r√©ellement utilis√© par l'application. Mais, m√™me en tenant compte de cela, dans le bundle, vous pouvez toujours trouver quelque chose qui peut √™tre am√©lior√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plus grande d√©pendance du projet est</font></font><code>math.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette biblioth√®que, comme son nom l'indique, impl√©mente de nombreuses op√©rations math√©matiques. Nous n'avons pas un besoin particulier pour cette biblioth√®que car nous effectuons tous les calculs importants sur le serveur, apr√®s quoi nous envoyons simplement les r√©sultats √† l'application. Lorsque nous avons examin√© le code de l'application, il s'est av√©r√© que la biblioth√®que n'est utilis√©e que pour effectuer des op√©rations simples. Il √©tait tr√®s probablement utilis√© par un d√©veloppeur qui ne travaillait sur le code du serveur que par habitude. Nous avons rapidement extrait les m√©thodes appropri√©es de la biblioth√®que et les avons int√©gr√©es dans notre base de code, en nous d√©barrassant compl√®tement de cette d√©pendance. Cela a permis de r√©duire la taille du bundle √† 4,64 Mo. Le refus d'une seule biblioth√®que a permis de r√©duire la taille du bundle de 15,5%!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme d√©j√† mentionn√©, nous utilisons le Storybook pour d√©velopper et tester des composants. Certes, les capacit√©s correspondantes ne devraient √™tre disponibles que dans les environnements locaux et interm√©diaires. Les utilisateurs finaux n'en ont pas besoin. Gr√¢ce √† cela, nous avons utilis√© la variable </font></font><code>ENVIRONMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour contr√¥ler l'inclusion de la partie correspondante de l'application. Bien que cela soit appropri√© pour restreindre l'acc√®s, le regroupeur ne peut pas savoir quelle valeur est √©crite dans cette variable. En raison de cette limitation, tout le code Storybook est tomb√© dans le bundle de production.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de r√©soudre le probl√®me, nous avons isol√© l'importation de cette section dans un seul fichier. Ensuite, nous avons cr√©√© deux versions de ce fichier: une qui comprend le livre d'histoires et une autre destin√©e √† la production, qui ne contient que la disposition des composants. Pour basculer entre ces fichiers lors de la pr√©paration de la version de production du bundle, nous avons √©crit un script qui est ex√©cut√© avant la construction du projet et change un fichier en un autre. Gr√¢ce √† cette m√©thode, nous avons pu supprimer compl√®tement le code Storybook de la version de production de l'application, supprimant √† la fois la d√©pendance </font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le code habituel concernant la configuration des ¬´histoires¬ª Storybook.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/4cc/276/9964cc2769a8a23b3b18d5b0d273cfd9.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise √† jour du dossier Storybook avec deux versions du fichier d'index.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ces deux modifications ont r√©duit la taille de l'ensemble de 5,49 Mo √† 4,2 Mo. </font><font style="vertical-align: inherit;">Cela signifie, entre autres, que l'application se chargera plus rapidement et se mettra √† jour plus rapidement.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/034/06f/f53/03406ff53c8a918119c9febd41e6d752.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La taille de l'ensemble final √©tait de 4,2 Mo.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apr√®s toutes ces am√©liorations, nous avons de nouveau t√©l√©charg√© l'application dans le Play Store. </font><font style="vertical-align: inherit;">Maintenant, nous avons √©t√© inform√©s que la taille du fichier APK fini sera comprise entre 10,5 et 13,7 Mo. </font><font style="vertical-align: inherit;">Cela, √©tant donn√© que l'application avait √† l'origine une taille de 26,8 Mo, signifie simplement une r√©duction incroyable de la taille du projet d'environ 60%! </font><font style="vertical-align: inherit;">Ainsi, comme nous l'avons dit dans un article de l'√©quipe Google Play, nous pouvons nous attendre √† ce que le taux de conversion des installations augmente de 3,75%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/715/69e/cec/71569ececb25a15225a48cef54bfb254.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparaison de la version APK d'origine de l'application avec la version AAB finale, dans laquelle toutes les am√©liorations d√©crites ci-dessus sont apport√©es</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que programmeurs orient√©s m√©tier, nous savons que, parfois, pour acc√©l√©rer le d√©veloppement d'un projet, les entreprises peuvent continuer d'augmenter leur dette technique. </font><font style="vertical-align: inherit;">Cela est particuli√®rement vrai pour les jeunes startups comme Mutual, qui essaient de trouver leur place sur le march√©. </font><font style="vertical-align: inherit;">Mais si vous n'observez pas cette dette, vous pouvez faire des erreurs g√™nantes, comme l'envoi de 2 Mo d'images de test √† la production et l'utilisation injustifi√©e d'une immense biblioth√®que. </font><font style="vertical-align: inherit;">La dette technique ne devrait pas devenir incontr√¥lable et causer des probl√®mes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il arrive souvent que les d√©veloppeurs manquent tout simplement les opportunit√©s qui s'offrent √† eux pour optimiser les projets. </font><font style="vertical-align: inherit;">Par cons√©quent, il est parfois recommand√© d'analyser de mani√®re critique vos projets. </font><font style="vertical-align: inherit;">Juste pour v√©rifier si vous avez manqu√© une occasion d'optimiser rapidement la taille, la vitesse ou tout autre aspect de l'application. </font><font style="vertical-align: inherit;">Il nous a fallu seulement deux jours pour analyser l'application, planifier le travail et apporter des am√©liorations au projet, ce qui nous a permis de r√©duire la taille de l'application de 60%. </font><font style="vertical-align: inherit;">Il est difficile de trouver autre chose qui puisse produire les m√™mes r√©sultats en si peu de temps. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment optimisez-vous vos projets React Native?</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502412/index.html">Guilloche d'une mani√®re diff√©rente</a></li>
<li><a href="../fr502414/index.html">FOSS News n ¬∞ 16 - une revue des logiciels libres et open source du 11 au 17 mai 2020</a></li>
<li><a href="../fr502416/index.html">Compl√©ter SQL. Partie 1. La complexit√© de l'analyse. Histoires sur la finalisation du fichier ANTLR</a></li>
<li><a href="../fr502418/index.html">Moniteur d'images 3D</a></li>
<li><a href="../fr502420/index.html">D√©couvertes CSS int√©ressantes dans la conception de Twitter</a></li>
<li><a href="../fr502424/index.html">Arr√™tez d'importer des packages JavaScript entiers</a></li>
<li><a href="../fr502428/index.html">Syntactic Goodies Julia</a></li>
<li><a href="../fr502430/index.html">Meilleures pratiques Kubernetes. Test de viabilit√© de Kubernetes avec tests de pr√©paration et de vivacit√©</a></li>
<li><a href="../fr502432/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 415 (11-17 mai 2020)</a></li>
<li><a href="../fr502436/index.html">CI TeamCity - Automatisation des processus de construction de tests Android et UI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>