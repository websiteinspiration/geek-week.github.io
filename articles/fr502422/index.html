<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏿 👩🏿‍💻 📏 Réduction de 60% de la taille de l'application React Native en quelques étapes simples 🤲🏼 🦒 ⚒️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je travaille chez Mutual . Elle travaille au Brésil, dans le domaine de l'égalité de crédit. Nous aidons les emprunteurs et les prêteurs à se connecte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Réduction de 60% de la taille de l'application React Native en quelques étapes simples</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/502422/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je travaille chez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mutual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Elle travaille au Brésil, dans le domaine de l'égalité de crédit. </font><font style="vertical-align: inherit;">Nous aidons les emprunteurs et les prêteurs à se connecter les uns aux autres. </font><font style="vertical-align: inherit;">Les premiers recherchent de bons paris, tandis que les seconds recherchent un revenu supérieur à ce que le marché peut leur offrir. </font><font style="vertical-align: inherit;">Notre produit est utilisé par un large éventail d'utilisateurs, nous travaillons dans un grand pays. </font><font style="vertical-align: inherit;">En conséquence, nos applications iOS et Android basées sur React Native se téléchargent sur des appareils très différents.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/59/3g/lf/593glf1nnlud4u0pbaogbghegiy.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que la plupart de nos utilisateurs installent des applications sur des appareils à petit budget. </font><font style="vertical-align: inherit;">Nous pouvons tirer de telles conclusions en utilisant les données de la bibliothèque de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">classe d'appareil de</font></a><font style="vertical-align: inherit;"> Facebook.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cette bibliothèque, après avoir reçu des informations sur le modèle de l'appareil, indique l'année dans laquelle cet appareil serait considéré comme un téléphone phare haut de gamme. </font><font style="vertical-align: inherit;">Par exemple, le téléphone le plus populaire parmi nos utilisateurs est le Samsung Galaxy A10. </font><font style="vertical-align: inherit;">Ce téléphone, bien qu'il soit sorti en 2019, ne pouvait être considéré comme le produit phare qu'en 2013. En analysant les données sur les appareils des utilisateurs, nous pouvons dire que 85% de ces appareils ne pouvaient être reconnus comme des appareils haut de gamme qu'en 2015 ou avant. </font><font style="vertical-align: inherit;">Pour cette raison, nous avons des exigences particulières pour optimiser notre application mobile. </font><font style="vertical-align: inherit;">Le but de l'optimisation est que même les utilisateurs avec des appareils faibles puissent utiliser confortablement notre application.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/e6b/cf3/1e2e6bcf354e0ed85e47f70b1570dbba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourcentage d'appareils pouvant être reconnus comme phares au cours d'une année donnée</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À cet égard, nous avons prêté une attention particulière à la taille de l'application. Dans le cas de sa version Android, il était de 26,8 Mo. Bien que ce ne soit pas une si grande taille, c'est certainement plus que la taille médiane des applications de nos utilisateurs. Selon la console Google Play, ce chiffre est de 16,3 Mo. La taille de l'application peut être un facteur décisif pour les utilisateurs avec des plans tarifaires limités, ou pour ceux avec des dispositifs à faible mémoire, ce qui oblige les utilisateurs à sélectionner soigneusement les applications qu'ils auront installées. Par conséquent, certaines applications doivent être désinstallées. Cela est particulièrement important dans le cas de la demande mutuelle, car les emprunteurs paient des versements mensuels via cette application. Lorsque l'emprunteur désinstalle notre application, les chances qu'il effectue le paiement à temps sont considérablement réduites.Et cela affecte directement les revenus des investisseurs utilisant notre plateforme.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/cea/78e/72ccea78ee7c05e86b626c0cf6ea45ef.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La taille de l'application Mutual est beaucoup plus grande que la taille médiane des</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
applications</font><i><font color="#999999"><font style="vertical-align: inherit;"> de nos utilisateurs</font></font></i><font style="vertical-align: inherit;"> . La taille de l'application n'affecte pas seulement le niveau des désinstallations. La taille affecte également le taux de conversion des paramètres d'application.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voici un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bon article à ce sujet rédigé par l'équipe Google Play. Cet article explique l'importance de la taille de l'application. En particulier, il indique que chaque 6 Mo supplémentaires de la taille du fichier APK réduit le taux de conversion des installations de 1%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils parlent également du fait que dans les pays en développement où les dispositifs budgétaires sont la norme, cet effet est encore plus fort. A savoir, la réduction de la taille du fichier APK de 10 Mo dans les marchés émergents correspond à une augmentation du taux de conversion des installations d'environ 2,5%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/624/15d/1c162415de7e88ff4c5ed89853b6483b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Augmenter le taux de conversion des installations pour chaque 10 Mo de réduction de la taille du fichier APK dans différents pays (selon les données internes de Google)</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous étions très motivés par la façon dont la réduction de la taille de l'application peut affecter le niveau de désinstallation et le taux de conversion des paramètres d'application. </font><font style="vertical-align: inherit;">En conséquence, nous nous sommes mis au travail afin de réduire autant que possible la taille de l'application, en tenant compte de sa commodité pour les utilisateurs. </font><font style="vertical-align: inherit;">La première étape de ce projet a été d'analyser les</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recommandations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> officielles de</font><font style="vertical-align: inherit;">Google pour les développeurs Android.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensemble d'applications Android</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En lisant les recommandations, nous avons appris que la façon la plus simple de réduire la taille d'une application est d'utiliser une nouvelle méthode de distribution d'application appelée </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android App Bundle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (AAB). Jusqu'à ce moment, nous avons distribué l'application, collecté le bon vieux </font><font style="vertical-align: inherit;">fichier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Package</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (APK), qui peut être exécuté sur la plupart des appareils Android, et téléchargé vers la console Google Play. Mais le bundle AAB ne contient que du code et des ressources compilés. Par conséquent, lors de son téléchargement, Google est responsable de la génération de fichiers APK optimisés pour différents types d'appareils, en tenant compte de leurs spécifications et de leur architecture CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère qu'en apportant un simple changement au processus de construction du projet, pouvons-nous obtenir une réduction sérieuse de la taille de l'application sans faire plus d'efforts? C'est trop beau pour la vérité! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir lu la documentation, nous venons de changer le script de construction React Native Gradle afin qu'il </font></font><code>assembleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'exécute à la </font><font style="vertical-align: inherit;">place du script actuel </font></font><code>bundleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. C'est tout ce dont nous avions besoin pour créer le fichier AAB. Après quelques modifications supplémentaires apportées à la </font></font><code>supply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configuration </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fastlane</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> concernant le téléchargement automatique de documents directement sur le Play Store, nous sommes passés à AAB et une nouvelle version de notre application est apparue dans la console Google Play.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce changement à lui seul a entraîné une réduction de la taille des fichiers APK transférés sur les appareils des utilisateurs. La diminution variait de 9,1 à 12,4 Mo. Il s'est avéré que l'utilisation du bundle d'applications Android est une technique efficace qui, en effet, vous permet de réduire la taille de l'application.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/feb/57b/9e5feb57bf54450425a6dc54da48f613.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ancien fichier APK et le nouveau bundle AAB, dont l'utilisation conduit au fait que la taille de l'application sur différents appareils peut aller de 14,4 à 17,7 Mo.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vrai, vous devez être prudent ici. </font><font style="vertical-align: inherit;">Si vous utilisez React Native avec</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hermes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous devrez peut-être mettre à jour votre dépendance</font></font><code>soloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(voir les détails</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Sinon, il existe un risque de donner à l'utilisateur une application qui contiendra une erreur critique. </font><font style="vertical-align: inherit;">Nous avons eu de la chance, nous avons pu identifier ce problème lors des tests de la version alpha du projet. </font><font style="vertical-align: inherit;">Mais l'erreur pourrait facilement se glisser en production, car elle n'apparaît pas lors des tests locaux ou lors de la création du fichier APK.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimisation des ressources d'application à l'aide d'Android Size Analyzer</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prochaine suggestion d'optimisation des applications que nous avons trouvée dans la documentation était l'utilisation d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Size Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il s'agit d'un outil en ligne de commande qui analyse les applications Android et cherche des moyens de réduire leur taille. </font><font style="vertical-align: inherit;">Nous avons lancé cet outil à l'aide d'une commande de la forme suivante:</font></font><br>
<br>
<pre><code class="javascript hljs">size-analyzer check-bundle [BUNDLE].aab
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous avons obtenu une liste d'excellentes ressources d'application et d'images que nous pouvons optimiser. </font><font style="vertical-align: inherit;">Il nous a également été recommandé de configurer ProGuard.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed0/a26/0b0/ed0a260b0a19878cf664c53ec54c9026.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rapport d'analyseur de taille</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ProGuard</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ProGuard est un outil pour compresser, masquer et optimiser le bytecode Java. </font><font style="vertical-align: inherit;">Nous n'avons pas encore exploré la possibilité d'utiliser cet outil, car nous avons appris qu'il pourrait ne pas être compatible avec certaines bibliothèques Android. </font><font style="vertical-align: inherit;">Puisque nous nous sommes efforcés de réduire la taille de notre application le plus rapidement possible et de rendre cela aussi simple que possible, nous avons décidé de laisser cette méthode d'optimisation à l'avenir.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Grandes ressources d'application</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En l'exécutant à </font></font><code>size-analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveau, avec la clé </font></font><code>-d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous avons obtenu une liste de ressources d'application, triées par leur taille. </font><font style="vertical-align: inherit;">Étant donné que cet outil ne sait rien de la façon exacte dont les utilisateurs travaillent avec l'application, il nous a donné la possibilité de décider indépendamment quelles ressources doivent être supprimées et lesquelles doivent être chargées dynamiquement dans l'application.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/d84/262/900d84262161b1440fe03e0d8b0d4fab.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des ressources d'application volumineuses triées par taille</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La première et la plus grande ressource de cette liste était le bundle React Native JavaScript. </font><font style="vertical-align: inherit;">Maintenant, nous ne pouvons pas fractionner ce bundle et le charger dynamiquement. </font><font style="vertical-align: inherit;">Mais plus tard, nous y penserons. </font><font style="vertical-align: inherit;">Plus bas dans la liste se trouvent de gros fichiers de polices (TTF) et des fichiers d'images (JPG et PNG).</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Images inutiles</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre attention a été immédiatement attirée sur les énormes images JPG utilisées dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">livre de contes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous utilisons ce système pour développer et tester des composants. </font><font style="vertical-align: inherit;">Il s'agit de 2 Mo de déchets tombés dans la version de production du projet. </font><font style="vertical-align: inherit;">Erreur honteuse! </font><font style="vertical-align: inherit;">Quand quelque chose comme ça se produit, nous avons l'impression d'avoir fait une grave stupidité. </font><font style="vertical-align: inherit;">Mais dans le monde complexe du développement logiciel, tout le monde fait des erreurs. </font><font style="vertical-align: inherit;">Je crois que si vous parlez de vos erreurs publiquement, cela aidera les autres développeurs à apprendre de ces erreurs. </font><font style="vertical-align: inherit;">Il est possible que vous fassiez les mêmes erreurs si vous n'analysez pas la structure des ressources de l'application, dont la taille augmente progressivement.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Polices</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après nous être rapidement débarrassés des images inutiles, nous avons procédé à l'analyse d'autres éléments de la liste des ressources. Il était clair qu'il y avait beaucoup de polices intégrées. Après en avoir discuté avec nos concepteurs, ils nous ont dit que de nombreux anciens composants ne diffèrent pas dans le strict respect des manuels typographiques. Par conséquent, nous avons découvert quels composants peuvent être supprimés et dans lesquels vous pouvez utiliser les polices mises à jour appropriées. Grâce à cela, nous avons pu réduire le nombre de polices utilisées de six à quatre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre chose que nous avons remarquée était la taille même des fichiers de polices eux-mêmes. La taille de chacun d'eux était d'environ 670 Kb. Cela signifie que quatre polices du paquet non compressé occupent un superbe 2,7 Mo. Mais, heureusement, il existe un outil appelé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FontForge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui vous permet d'analyser et de modifier en profondeur les fichiers de polices. À l'aide de cet outil, nous avons pu découvrir que la principale raison de la grande taille des fichiers de police était les caractères cyrilliques étendus et les glyphes inutiles. Nous pourrions supprimer tout cela en toute sécurité, car la partie texte de notre application est entièrement écrite en portugais. Grâce à ce changement, nous avons pu réduire la taille des fichiers de polices de 670 Ko à 70 Ko - de 90%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d0/144/f9c/7d0144f9c3954dee6570347075fbe392.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples de glyphes inclus dans nos polices.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Du fait que nous avons supprimé les polices inutiles et optimisé les autres, nous avons pu réduire la taille de l'application de 3,8 Mo. </font><font style="vertical-align: inherit;">Cela a entraîné une réduction agréable de 2 Mo de la taille totale du fichier APK.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/62c/a55/52b62ca55ea0178919421a1c08304adc.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des polices et de leurs tailles avant optimisation</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83e/374/6db/83e3746db754c475501170c6e4372c49.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des polices et de leurs tailles après optimisation</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Optimisation des images</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir analysé les images qui restaient encore dans l'application, nous avons remarqué que certaines d'entre elles sont assez grandes. </font><font style="vertical-align: inherit;">Nous avons traité plusieurs de ces images avec l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outil d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> optimisation graphique </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">TinyPNG</font></a><font style="vertical-align: inherit;"> et constaté une réduction significative de la taille de ces images. </font><font style="vertical-align: inherit;">Après cela, nous avons décidé d'optimiser toutes les images JPG et PNG utilisées dans l'application. </font><font style="vertical-align: inherit;">Il y en avait 41.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa5/8e9/9e6/aa58e99e6307077787f37d0d60fc59db.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image avant et après optimisation</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cela nous a permis de réduire la taille des images de 2,5 Mo à 756 Ko, soit 70%. </font><font style="vertical-align: inherit;">Cependant, du fait que les images n'étaient pas optimisées auparavant, elles ont été compressées lors de la création du fichier APK final. </font><font style="vertical-align: inherit;">Il s'est avéré que notre optimisation a entraîné une diminution de la taille de l'application téléchargée par l'utilisateur de seulement 500 Ko. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, nous avons réalisé que nous avions déjà épuisé toutes les possibilités d'optimisation rapide. </font><font style="vertical-align: inherit;">La poursuite de l'optimisation des ressources nécessiterait soit de grands efforts, soit seulement des améliorations mineures.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React Native JavaScript Bundle Optimization</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir compris les ressources d'application spécifiques à la plate-forme Android, il est temps d'analyser le bundle JavaScript. </font><font style="vertical-align: inherit;">L'optimisation des bundles peut être considérée comme une bonne idée pour trois raisons. </font><font style="vertical-align: inherit;">Premièrement, cela réduit la taille du fichier APK fini. </font><font style="vertical-align: inherit;">Deuxièmement, cela entraîne un lancement plus rapide de l'application, car la machine virtuelle JS doit traiter moins de code. </font><font style="vertical-align: inherit;">Enfin, et surtout, cela accélère les mises à jour OTA que nous faisons plusieurs fois par semaine en utilisant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodePush</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Analyseur de bundles et optimisation de code</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de prendre une décision sur la façon de réduire la taille de l'ensemble, vous devez d'abord déterminer ce qui prend le plus de place dans l'ensemble. Pour ce faire, nous avons utilisé l'excellent outil open source </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">react-native-bundle-visualizer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Après avoir analysé le projet avec son aide, nous avons obtenu une visualisation dans laquelle chaque dossier et chaque dépendance d'application étaient présents, indiquant les tailles des entités correspondantes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f2/641/4c0/7f26414c02bec1a7cf7bcd6b901fb837.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instantané des bibliothèques et dossiers de la base de code du frontend de l'application Mutual avec indication des tailles</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous avons découvert que la taille totale du bundle est de 5,49 Mo. 57,8% de ce volume est représenté par des dépendances du dossier</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 27,5% - code d'application. Ce qui reste, l'outil utilisé par nous n'a pas pu être identifié. Pendant le processus d'assemblage du bundle, le code inutilisé a déjà été supprimé, donc ce que nous avons vu était du code qui est réellement utilisé par l'application. Mais, même en tenant compte de cela, dans le bundle, vous pouvez toujours trouver quelque chose qui peut être amélioré.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plus grande dépendance du projet est</font></font><code>math.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette bibliothèque, comme son nom l'indique, implémente de nombreuses opérations mathématiques. Nous n'avons pas un besoin particulier pour cette bibliothèque car nous effectuons tous les calculs importants sur le serveur, après quoi nous envoyons simplement les résultats à l'application. Lorsque nous avons examiné le code de l'application, il s'est avéré que la bibliothèque n'est utilisée que pour effectuer des opérations simples. Il était très probablement utilisé par un développeur qui ne travaillait sur le code du serveur que par habitude. Nous avons rapidement extrait les méthodes appropriées de la bibliothèque et les avons intégrées dans notre base de code, en nous débarrassant complètement de cette dépendance. Cela a permis de réduire la taille du bundle à 4,64 Mo. Le refus d'une seule bibliothèque a permis de réduire la taille du bundle de 15,5%!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme déjà mentionné, nous utilisons le Storybook pour développer et tester des composants. Certes, les capacités correspondantes ne devraient être disponibles que dans les environnements locaux et intermédiaires. Les utilisateurs finaux n'en ont pas besoin. Grâce à cela, nous avons utilisé la variable </font></font><code>ENVIRONMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour contrôler l'inclusion de la partie correspondante de l'application. Bien que cela soit approprié pour restreindre l'accès, le regroupeur ne peut pas savoir quelle valeur est écrite dans cette variable. En raison de cette limitation, tout le code Storybook est tombé dans le bundle de production.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de résoudre le problème, nous avons isolé l'importation de cette section dans un seul fichier. Ensuite, nous avons créé deux versions de ce fichier: une qui comprend le livre d'histoires et une autre destinée à la production, qui ne contient que la disposition des composants. Pour basculer entre ces fichiers lors de la préparation de la version de production du bundle, nous avons écrit un script qui est exécuté avant la construction du projet et change un fichier en un autre. Grâce à cette méthode, nous avons pu supprimer complètement le code Storybook de la version de production de l'application, supprimant à la fois la dépendance </font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le code habituel concernant la configuration des «histoires» Storybook.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/4cc/276/9964cc2769a8a23b3b18d5b0d273cfd9.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise à jour du dossier Storybook avec deux versions du fichier d'index.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ces deux modifications ont réduit la taille de l'ensemble de 5,49 Mo à 4,2 Mo. </font><font style="vertical-align: inherit;">Cela signifie, entre autres, que l'application se chargera plus rapidement et se mettra à jour plus rapidement.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/034/06f/f53/03406ff53c8a918119c9febd41e6d752.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La taille de l'ensemble final était de 4,2 Mo.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Après toutes ces améliorations, nous avons de nouveau téléchargé l'application dans le Play Store. </font><font style="vertical-align: inherit;">Maintenant, nous avons été informés que la taille du fichier APK fini sera comprise entre 10,5 et 13,7 Mo. </font><font style="vertical-align: inherit;">Cela, étant donné que l'application avait à l'origine une taille de 26,8 Mo, signifie simplement une réduction incroyable de la taille du projet d'environ 60%! </font><font style="vertical-align: inherit;">Ainsi, comme nous l'avons dit dans un article de l'équipe Google Play, nous pouvons nous attendre à ce que le taux de conversion des installations augmente de 3,75%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/715/69e/cec/71569ececb25a15225a48cef54bfb254.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparaison de la version APK d'origine de l'application avec la version AAB finale, dans laquelle toutes les améliorations décrites ci-dessus sont apportées</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que programmeurs orientés métier, nous savons que, parfois, pour accélérer le développement d'un projet, les entreprises peuvent continuer d'augmenter leur dette technique. </font><font style="vertical-align: inherit;">Cela est particulièrement vrai pour les jeunes startups comme Mutual, qui essaient de trouver leur place sur le marché. </font><font style="vertical-align: inherit;">Mais si vous n'observez pas cette dette, vous pouvez faire des erreurs gênantes, comme l'envoi de 2 Mo d'images de test à la production et l'utilisation injustifiée d'une immense bibliothèque. </font><font style="vertical-align: inherit;">La dette technique ne devrait pas devenir incontrôlable et causer des problèmes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il arrive souvent que les développeurs manquent tout simplement les opportunités qui s'offrent à eux pour optimiser les projets. </font><font style="vertical-align: inherit;">Par conséquent, il est parfois recommandé d'analyser de manière critique vos projets. </font><font style="vertical-align: inherit;">Juste pour vérifier si vous avez manqué une occasion d'optimiser rapidement la taille, la vitesse ou tout autre aspect de l'application. </font><font style="vertical-align: inherit;">Il nous a fallu seulement deux jours pour analyser l'application, planifier le travail et apporter des améliorations au projet, ce qui nous a permis de réduire la taille de l'application de 60%. </font><font style="vertical-align: inherit;">Il est difficile de trouver autre chose qui puisse produire les mêmes résultats en si peu de temps. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment optimisez-vous vos projets React Native?</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502412/index.html">Guilloche d'une manière différente</a></li>
<li><a href="../fr502414/index.html">FOSS News n ° 16 - une revue des logiciels libres et open source du 11 au 17 mai 2020</a></li>
<li><a href="../fr502416/index.html">Compléter SQL. Partie 1. La complexité de l'analyse. Histoires sur la finalisation du fichier ANTLR</a></li>
<li><a href="../fr502418/index.html">Moniteur d'images 3D</a></li>
<li><a href="../fr502420/index.html">Découvertes CSS intéressantes dans la conception de Twitter</a></li>
<li><a href="../fr502424/index.html">Arrêtez d'importer des packages JavaScript entiers</a></li>
<li><a href="../fr502428/index.html">Syntactic Goodies Julia</a></li>
<li><a href="../fr502430/index.html">Meilleures pratiques Kubernetes. Test de viabilité de Kubernetes avec tests de préparation et de vivacité</a></li>
<li><a href="../fr502432/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 415 (11-17 mai 2020)</a></li>
<li><a href="../fr502436/index.html">CI TeamCity - Automatisation des processus de construction de tests Android et UI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>