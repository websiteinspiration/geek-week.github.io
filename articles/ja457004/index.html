<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😯 🛫 ℹ️ Goプログラムを最適化する簡単な方法 🕟 ☝️ 🔟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私はいつもパフォーマンスを気にします。理由は正確にはわかりません。しかし、私は遅いサービスとプログラムにうんざりしています。私は一人じゃないようです。
 
 A / Bテストでは、100ミリ秒単位でページの出力を遅くしようとしましたが、非常に小さな遅延でも収益が大幅に減少することがわかりました。 -...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Goプログラムを最適化する簡単な方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457004/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はいつもパフォーマンスを気にします。</font><font style="vertical-align: inherit;">理由は正確にはわかりません。</font><font style="vertical-align: inherit;">しかし、私は遅いサービスとプログラムにうんざりしています。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私は一人じゃない</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よう</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">です</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A / Bテストでは、100ミリ秒単位でページの出力を遅くしようとしましたが、非常に小さな遅延でも収益が大幅に減少することがわかりました。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-Greg Linden、Amazon.com</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
経験から、低い生産性は次の2つの方法のいずれかで明らかになります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小規模でうまく機能する操作は、ユーザー数が増えると実行不可能になります。</font><font style="vertical-align: inherit;">通常、これらはO（N）またはO（N²）演算です。</font><font style="vertical-align: inherit;">ユーザーベースが小さい場合、すべてが正常に動作します。</font><font style="vertical-align: inherit;">製品の市場投入が急がれています。</font><font style="vertical-align: inherit;">基地が拡大するにつれて、ますます予期しない病理学的状況が発生し、サービスが停止します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次善の仕事の多くの個々の情報源、「千カットからの死」。</font></font></li>
</ul><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のキャリアのほとんどで、私はPythonでデータサイエンスを研究するか、Goでサービスを作成しました。</font><font style="vertical-align: inherit;">2番目のケースでは、最適化の経験がずっと豊富です。</font><font style="vertical-align: inherit;">Goは通常、私が作成するサービスのボトルネックではありません。データベースプログラムはI / Oによって制限されることがよくあります。</font><font style="vertical-align: inherit;">ただし、私が開発した機械学習バッチパイプラインでは、プログラムがCPUによって制限されることがよくあります。</font><font style="vertical-align: inherit;">Goがプロセッサを使いすぎる場合は、さまざまな方法があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、それほど努力することなく生産性を大幅に向上させるために使用できるいくつかの方法について説明します。</font><font style="vertical-align: inherit;">プログラムの構造に大幅な労力や大幅な変更が必要なメソッドは、意図的に無視しています。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始める前に</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムに変更を加える前に、時間をかけて比較のための適切なベースラインを作成してください。</font><font style="vertical-align: inherit;">そうしないと、暗闇の中をさまよい、変更によるメリットがあるかどうか疑問に思います。</font><font style="vertical-align: inherit;">最初に、ベンチマークを記述し</font><font style="vertical-align: inherit;">、pprofで使用</font><font style="vertical-align: inherit;">する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロファイル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">取得し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Goでもベンチマークを記述する</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のが最適</font><font style="vertical-align: inherit;">です。pprofとメモリプロファイリングの使用が簡単になります。</font><font style="vertical-align: inherit;">また、benchcmpを使用してください。テスト間のパフォーマンスの違いを比較するための便利なツールです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードがベンチマークとあまり互換性がない場合は、測定可能なものから始めてください。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runtime / pprofを使用</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して、コードを手動でプロファイルできます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは始めましょう！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sync.Poolを使用して、以前に選択したオブジェクトを再利用します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sync.Pool </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はリリースリストを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">します</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、以前に割り当てられた構造を再利用し、オブジェクトの分布をさまざまな用途に分散させることができるため、ガベージコレクターの作業が軽減されます。</font><font style="vertical-align: inherit;">APIは非常にシンプルです。</font><font style="vertical-align: inherit;">オブジェクトの新しいインスタンスを割り当てる関数を実装します。</font><font style="vertical-align: inherit;">APIはポインター型を返します。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> bufpool = sync.Pool{<font></font>
    New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">interface</span></span>{} {<font></font>
        buf := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, <span class="hljs-number">512</span>)
        <span class="hljs-keyword">return</span> &amp;buf<font></font>
    }}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後</font></font><code>Get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プールからオブジェクトを</font><font style="vertical-align: inherit;">作成</font><font style="vertical-align: inherit;">し、</font></font><code>Put()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完了したらそれら</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">返すことができます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// sync.Pool returns a interface{}: you must cast it to the underlying type</span>
<span class="hljs-comment">// before you use it.</span>
b := *bufpool.Get().(*[]<span class="hljs-keyword">byte</span>)
<span class="hljs-keyword">defer</span> bufpool.Put(&amp;b)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// Now, go do interesting things with your byte buffer.</span>
buf := bytes.NewBuffer(b)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ニュアンスがあります。</font><font style="vertical-align: inherit;">Go 1.13より前は、プールはすべてのガベージコレクションでクリアされていました。</font><font style="vertical-align: inherit;">これは、大量のメモリを割り当てるプログラムのパフォーマンスに悪影響を与える可能性があります。</font><font style="vertical-align: inherit;">1.13の時点で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、GC後もより多くのオブジェクトが存続するようです</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">!!! </font><font style="vertical-align: inherit;">オブジェクトをプールに戻す前に、構造体フィールドをリセットする必要があります。</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そうしないと、以前に使用したデータが含まれているプールからダーティオブジェクトを取得できます。</font><font style="vertical-align: inherit;">これは重大なセキュリティリスクです。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> AuthenticationResponse {<font></font>
    Token <span class="hljs-keyword">string</span>
    UserID <span class="hljs-keyword">string</span><font></font>
}<font></font>
<font></font>
rsp := authPool.Get().(*AuthenticationResponse)<font></font>
<span class="hljs-keyword">defer</span> authPool.Put(rsp)<font></font>
<font></font>
<span class="hljs-comment">// If we don't hit this if statement, we might return data from other users! </span>
<span class="hljs-keyword">if</span> blah {<font></font>
    rsp.UserID = <span class="hljs-string">"user-1"</span>
    rsp.Token = <span class="hljs-string">"super-secret"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">return</span> rsp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
常にゼロメモリを保証する安全な方法は、これを明示的に行うことです。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// reset resets all fields of the AuthenticationResponse before pooling it.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a* AuthenticationResponse)</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span></span> {<font></font>
    a.Token = <span class="hljs-string">""</span>
    a.UserID = <span class="hljs-string">""</span><font></font>
}<font></font>
<font></font>
rsp := authPool.Get().(*AuthenticationResponse)<font></font>
<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<font></font>
    rsp.reset()<font></font>
    authPool.Put(rsp)<font></font>
}()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが問題でない唯一のケースは、書き込んだ正確なメモリを使用する場合です。</font><font style="vertical-align: inherit;">例えば：</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> (<font></font>
    r io.Reader<font></font>
    w io.Writer<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">// Obtain a buffer from the pool.</span>
buf := *bufPool.Get().(*[]<span class="hljs-keyword">byte</span>)
<span class="hljs-keyword">defer</span> bufPool.Put(&amp;buf)<font></font>
<font></font>
<span class="hljs-comment">// We only write to w exactly what we read from r, and no more. </span><font></font>
nr, er := r.Read(buf)<font></font>
<span class="hljs-keyword">if</span> nr &gt; <span class="hljs-number">0</span> {<font></font>
    nw, ew := w.Write(buf[<span class="hljs-number">0</span>:nr])<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインタを含む構造体を大きなマップのキーとして使用しないでください</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ふう、私は冗長すぎました。</font><font style="vertical-align: inherit;">謝罪します。</font><font style="vertical-align: inherit;">彼らはしばしば（私の前の同僚である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phil Pearl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を含めて</font><font style="vertical-align: inherit;">）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大きなヒープサイズでの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Goパフォーマンスについて</font><font style="vertical-align: inherit;">話</font><font style="vertical-align: inherit;">しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ガベージコレクション中に、ランタイムはポインターを使用してオブジェクトをスキャンし、追跡します。</font><font style="vertical-align: inherit;">マップが非常に大きい場合</font></font><code>map[string]int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、GCは各行をチェックする必要があります。</font><font style="vertical-align: inherit;">行にはポインタが含まれているため、これはすべてのガベージコレクションで発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、1000万個のアイテムを書き込み</font></font><code>map[string]int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ガベージコレクションの期間を測定します。</font><font style="vertical-align: inherit;">ヒープからのメモリ割り当てを確実にするために、マップをパッケージ領域に割り当てます。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"runtime"</span>
    <span class="hljs-string">"strconv"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">const</span> (<font></font>
    numElements = <span class="hljs-number">10000000</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> foo = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>{}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">timeGC</span><span class="hljs-params">()</span></span> {<font></font>
    t := time.Now()<font></font>
    runtime.GC()<font></font>
    fmt.Printf(<span class="hljs-string">"gc took: %s\n"</span>, time.Since(t))<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; numElements; i++ {<font></font>
        foo[strconv.Itoa(i)] = i<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">for</span> {<font></font>
        timeGC()<font></font>
        time.Sleep(<span class="hljs-number">1</span> * time.Second)<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムを実行すると、次のようになります。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inthash→インストールに行く&amp;&amp; inthash</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCの所要時間：98.726321ms</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCにかかった時間：105.524633ミリ秒</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCの所要時間：102.829451ms</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCの所要時間：102.71908ms</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCにかかった時間：103.084104ms</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcの所要時間：104.821989ms</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはコンピューターの国ではかなり長い時間です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最適化するには何ができますか？</font><font style="vertical-align: inherit;">ガベージコレクターを読み込まないように、ポインターをどこにでも削除することをお勧めします。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行にポインタがあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これをとして実装しましょう</font></font><code>map[int]int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"runtime"</span>
    <span class="hljs-string">"time"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">const</span> (<font></font>
    numElements = <span class="hljs-number">10000000</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> foo = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">int</span>]<span class="hljs-keyword">int</span>{}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">timeGC</span><span class="hljs-params">()</span></span> {<font></font>
    t := time.Now()<font></font>
    runtime.GC()<font></font>
    fmt.Printf(<span class="hljs-string">"gc took: %s\n"</span>, time.Since(t))<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; numElements; i++ {<font></font>
        foo[i] = i<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">for</span> {<font></font>
        timeGC()<font></font>
        time.Sleep(<span class="hljs-number">1</span> * time.Second)<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムを再度実行すると、次のようになります。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inthash→インストールに行く&amp;&amp; inthash</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCにかかった時間：3.608993ms</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCにかかった時間：3.926913ミリ秒</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCにかかった時間：3.955706ms</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCにかかった時間：4.063795ms</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCにかかった時間：3.91519ミリ秒</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GCにかかった時間：3.75226ミリ秒</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ずっといい。ガベージコレクションを35倍高速化しました。本番環境で使用する場合、カードに挿入する前に整数で文字列をハッシュする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ところで、GCを回避する方法は他にもたくさんあります。意味のない構造体、整数、またはバイトの巨大な配列を割り当てる場合、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCはそれをスキャンしません</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。つまり、GC時間を節約できます。このような方法は通常、プログラムの大幅な改訂を必要とするため、本日はこのトピックについて詳しく説明しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他の最適化と同様に、効果はさまざまです。</font><font style="vertical-align: inherit;">よりスマートなデータ構造を優先して大きなマップから行を削除すると、実際に</font><font style="vertical-align: inherit;">メモリ消費量</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">増加</font></i><font style="vertical-align: inherit;">した興味深い例については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Damian Gryskiのツイート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">スレッドを</font></a><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">。一般的に、彼が出版するすべてのものを読んでください。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ランタイムでの反映を回避するためのコード生成のマーシャリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構造をJSONなどのさまざまなシリアル化形式にマーシャリングおよびアンマーシャリングすることは、特にマイクロサービスを作成する場合の典型的な操作です。</font><font style="vertical-align: inherit;">多くのマイクロサービスでは、これが一般的に唯一の仕事です。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">実行時のリフレクション</font></a></font><code>json.Marshal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">同様に機能し</font><font style="vertical-align: inherit;">、フィールドの構造をバイトに、またはその逆にシリアル化する</font></font><code>json.Unmarshal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ために</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リフレクションに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これはゆっくりと動作する可能性があります。リフレクションは明示的なコードほど効率的ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、最適化オプションがあります。</font><font style="vertical-align: inherit;">JSONマーシャリングの仕組みは次のようになります。</font></font><br>
<br>
<pre><code class="json hljs">package json<font></font>
<font></font>
<span class="hljs-comment">// Marshal take an object and returns its representation in JSON.</span><font></font>
func Marshal(obj interface{}) ([]byte, error) {<font></font>
    <span class="hljs-comment">// Check if this object knows how to marshal itself to JSON</span>
    <span class="hljs-comment">// by satisfying the Marshaller interface.</span><font></font>
    if m, is := obj.(json.Marshaller); is {<font></font>
        return m.MarshalJSON()<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// It doesn't know how to marshal itself. Do default reflection based marshallling.</span><font></font>
    return marshal(obj)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSONでのマーシャライゼーションプロセスを知っている場合、ランタイムでの反映を回避する手掛かりがあります。</font><font style="vertical-align: inherit;">しかし、すべてのマーシャライゼーションコードを手動で記述したくないので、どうすればよいでしょうか。</font><font style="vertical-align: inherit;">コンピュータにこのコードを生成させてください！</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">easyjsonの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ようなコードジェネレーター</font><font style="vertical-align: inherit;">は構造を調べ、などの既存のマーシャリングインターフェイスと完全に互換性のある高度に最適化されたコードを生成し</font></font><code>json.Marshaller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージをダウンロードし、</font></font><code>$file.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードを生成する構造を含む</font><font style="vertical-align: inherit;">次のコマンドを</font><font style="vertical-align: inherit;">に記述します。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">easyjson -all $ file.go</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルが生成され</font></font><code>$file_easyjson.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。私</font></font><code>easyjson</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はあなたのためにインターフェース</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実装した</font><font style="vertical-align: inherit;">ので</font></font><code>json.Marshaller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、反映する代わりに、これらの関数はデフォルトで呼び出されます。おめでとうございます。JSONコードを3回高速化しました。生産性をさらに高めるためのコツはたくさんあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前に自分で使用して成功したため、このパッケージをお勧めします。しかし、注意してください。これを、最速のJSONパッケージについての私との積極的な議論を開始するための招待として受け取らないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構造が変更された場合は、必ずマーシャリングコードを再生成してください。これを忘れると、新しく追加されたフィールドはシリアル化されず、混乱を招きます！</font></font><code>go generate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらのタスクに</font><font style="vertical-align: inherit;">使用できます</font><font style="vertical-align: inherit;">。構造と同期を保つために、私は</font></font><code>generate.go</code><font style="vertical-align: inherit;"></font><code>go generate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのパッケージファイルを必要とする</font><font style="vertical-align: inherit;">パッケージのルートに</font><font style="vertical-align: inherit;">：これは、そのようなコードを生成する必要がある多くのファイルがある場合に役立ちます。</font><font style="vertical-align: inherit;">主なヒント：構造が確実に更新されるようにするに</font></font><code>go generate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、CIを</font><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">、登録されたコードとの違いがないことを確認します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strings.Builderを使用して文字列を作成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goでは、文字列は不変です。文字列は読み取り専用のバイトと考えてください。</font><font style="vertical-align: inherit;">つまり、文字列を作成するたびに、メモリが割り当てられ、ガベージコレクターにより多くの作業が作成される可能性があります。</font><font style="vertical-align: inherit;">文字列を作成する効率的な方法として、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go 1.10実装の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strings.Builder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用します。</font><font style="vertical-align: inherit;">内部的には、バイトバッファーに書き込みます。</font></font><code>String()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビルダーで</font><font style="vertical-align: inherit;">呼び出さ</font><font style="vertical-align: inherit;">れた</font><font style="vertical-align: inherit;">ときにのみ、</font><font style="vertical-align: inherit;">実際にラインが作成されます。</font><font style="vertical-align: inherit;">彼は基本的なバイトをゼロ割り当ての文字列として返すためにいくつかの安全でないトリックに依存しています：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がどのように機能するかについてのさらなる研究</font><font style="vertical-align: inherit;">については</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">このブログ</font></a><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのアプローチのパフォーマンスを比較します。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// main.go</span>
<span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"strings"</span><font></font>
<font></font>
<span class="hljs-keyword">var</span> strs = []<span class="hljs-keyword">string</span>{
    <span class="hljs-string">"here's"</span>,
    <span class="hljs-string">"a"</span>,
    <span class="hljs-string">"some"</span>,
    <span class="hljs-string">"long"</span>,
    <span class="hljs-string">"list"</span>,
    <span class="hljs-string">"of"</span>,
    <span class="hljs-string">"strings"</span>,
    <span class="hljs-string">"for"</span>,
    <span class="hljs-string">"you"</span>,<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buildStrNaive</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> {
    <span class="hljs-keyword">var</span> s <span class="hljs-keyword">string</span><font></font>
<font></font>
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> strs {<font></font>
        s += v<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> s<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buildStrBuilder</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> {<font></font>
    b := strings.Builder{}<font></font>
<font></font>
    <span class="hljs-comment">// Grow the buffer to a decent length, so we don't have to continually</span>
    <span class="hljs-comment">// re-allocate.</span>
    b.Grow(<span class="hljs-number">60</span>)<font></font>
<font></font>
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> strs {<font></font>
        b.WriteString(v)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> b.String()<font></font>
}</code></pre><br>
<pre><code class="go hljs"><span class="hljs-comment">// main_test.go</span>
<span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"testing"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> str <span class="hljs-keyword">string</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkStringBuildNaive</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        str = buildStrNaive()<font></font>
    }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkStringBuildBuilder</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        str = buildStrBuilder()<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが私のMacbook Proでの結果です。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strbuild-&gt; go test -bench =。</font><font style="vertical-align: inherit;">-benchmem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
goos：ダーウィン</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
goarch：amd64</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pkg：github.com/sjwhitworth/perfblog/strbuild</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BenchmarkStringBuildNaive-8 5,000,000 255 ns / op 216 B / op 8 allocs / op</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BenchmarkStringBuildBuilder-8 20,000,000 54.9 ns / op 64 B / op 1 allocs / op</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、これ</font></font><code>strings.Builder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は4.7倍高速で、割り当てが8分の1になり、必要なメモリが4分の1になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスが重要な場合は、を使用してください</font></font><code>strings.Builder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一般的に、文字列を作成する最も些細な場合を除いて、どこでも使用することをお勧めします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fmtの代わりにstrconvを使用する</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fmt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はGoで最も有名なパッケージの1つです。</font><font style="vertical-align: inherit;">おそらく最初のプログラムで「hello、world」を表示するためにそれを使用したでしょう。</font><font style="vertical-align: inherit;">しかし、整数と浮動小数点数を文字列に変換することになると、その弟</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strconv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほど効率的ではありません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このパッケージは、APIにほとんど変更を加えなくても、まともなパフォーマンスを示します。</font></font><br>
<br>
<code>fmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的には</font></font><code>interface{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引数として関数を</font><font style="vertical-align: inherit;">取り</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">2つの欠点があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプセーフを失っています。</font><font style="vertical-align: inherit;">それは私にとって非常に重要です。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これにより、必要な分泌物の量を増やすことができます。</font><font style="vertical-align: inherit;">品質へのポインタなしで型を渡すと、</font></font><code>interface{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常はヒープが割り当てられます。</font><font style="vertical-align: inherit;">で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、このブログ記事は、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理由を説明します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のプログラムは、パフォーマンスの違いを示しています。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// main.go</span>
<span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"strconv"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">strconvFmt</span><span class="hljs-params">(a <span class="hljs-keyword">string</span>, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">string</span></span> {
    <span class="hljs-keyword">return</span> a + <span class="hljs-string">":"</span> + strconv.Itoa(b)<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fmtFmt</span><span class="hljs-params">(a <span class="hljs-keyword">string</span>, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">string</span></span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%s:%d"</span>, a, b)<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {}</code></pre><br>
<pre><code class="go hljs"><span class="hljs-comment">// main_test.go</span>
<span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"testing"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">var</span> (<font></font>
    a    = <span class="hljs-string">"boo"</span>
    blah = <span class="hljs-number">42</span>
    box  = <span class="hljs-string">""</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkStrconv</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        box = strconvFmt(a, blah)<font></font>
    }<font></font>
    a = box<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkFmt</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {<font></font>
        box = fmtFmt(a, blah)<font></font>
    }<font></font>
    a = box<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Macbook Proのベンチマーク：</font></font><br>
<br>
<pre> strfmt → go test -bench=. -benchmem<font></font>
goos: darwin<font></font>
goarch: amd64<font></font>
pkg: github.com/sjwhitworth/perfblog/strfmt<font></font>
BenchmarkStrconv-8      30000000            39.5 ns/op        32 B/op          1 allocs/op<font></font>
BenchmarkFmt-8          10000000           143 ns/op          72 B/op          3 allocs/op</pre><br>
 ,  strconv  3,5  ,         .<br>
<br>
<h3>      make,   </h3><br>
     ,        . &nbsp;—     Go.                  .    ,      :<br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> slice <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// pointer to underlying data in the slice.</span>
    data <span class="hljs-keyword">uintptr</span>
    <span class="hljs-comment">// the number of elements in the slice.</span>
    <span class="hljs-built_in">len</span> <span class="hljs-keyword">int</span>
    <span class="hljs-comment">// the number of elements that the slice can </span>
    <span class="hljs-comment">// grow to before a new underlying array</span>
    <span class="hljs-comment">// is allocated.</span>
    <span class="hljs-built_in">cap</span> <span class="hljs-keyword">int</span>     
}</code></pre><br>
   ?<br>
<br>
<ul>
<li><code>data</code>:      <br>
</li>
<li><code>len</code>:     <br>
</li>
<li><code>cap</code>:  ,       </li>
</ul><br>
       .     (<code>cap</code>)       ,       ,    .<br>
<br>
     ,       ,     :<br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> userIDs []<span class="hljs-keyword">string</span>
<span class="hljs-keyword">for</span> _, bar := <span class="hljs-keyword">range</span> rsp.Users {<font></font>
    userIDs = <span class="hljs-built_in">append</span>(userIDs, bar.ID)<font></font>
}</code></pre><br>
        <code>len</code>     <code>cap</code>.  ,     ,     :    ,    <code>cap</code>,     .       8 ,    5 .<br>
<br>
    :<br>
<br>
<pre><code class="go hljs">userIDs := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(rsp.Users))<font></font>
<font></font>
<span class="hljs-keyword">for</span> _, bar := <span class="hljs-keyword">range</span> rsp.Users {<font></font>
    userIDs = <span class="hljs-built_in">append</span>(userIDs, bar.ID)<font></font>
}</code></pre><br>
         make.      ,     .<br>
<br>
   ,   ,         ,        .    90-  99-       .  ,  CPU    RAM,    ,   ,  .<br>
<br>
    : <code>make(map[string]string, len(foo))</code>   ,   .<br>
<br>
. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>  ,     .<br>
<br>
<h3> ,    </h3><br>
    ,     :        .<br>
<br>
 &nbsp;—  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">time.Format</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">time.AppendFormat</a>.   .            <code>time.AppendFormat</code>.    ,         .        : . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">strconv.AppendFloat</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">bytes.NewBuffer</a>.<br>
<br>
   ? ,      ,    <code>sync.Pool</code>,  ,      .        ,      ,      .<br>
<br>
<h1></h1><br>
        .             Go.      .<br>
<br>
      .  ,   .     .<br>
<br>
 ,  .   —  :  ,    .         .       10&nbsp;,     90&nbsp;, ,      10&nbsp;  5&nbsp;:      95&nbsp;.       1&nbsp;,      91&nbsp;. ,   .<br>
<br>
  !<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに情報が必要な場合は、ここからインスピレーションの素晴らしい情報源をご覧ください。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">囲碁での大きな山のさらなる危険</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高性能Goサービスの配信効率</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私が心配するのをやめて、たくさんに恋に落ちた方法</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイトあなたは私の友達だと思った</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gcは悪いですが、気分を悪くするべきではありません</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Goでのプロファイリングと最適化</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CockroachDBのメモリ使用量</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大きなヒープでのGC遅延の排除</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100倍加速するための7つのステップ</font></font></a></li>
</ul></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja456986/index.html">ドゥロフはTONとは何の関係もありません</a></li>
<li><a href="../ja456988/index.html">IT弁護士の話。生活アウトソーシング事業。パート3</a></li>
<li><a href="../ja456992/index.html">自分で英語を学ぶことにした人のためのいくつかの役立つヒント</a></li>
<li><a href="../ja456996/index.html">3つの白い馬</a></li>
<li><a href="../ja456998/index.html">フォールアウトのハロルドとボブハーバートツリーの完全な物語</a></li>
<li><a href="../ja457008/index.html">骨董品：3つのパームストーリー</a></li>
<li><a href="../ja457010/index.html">Webコンポーネントを使用しない理由</a></li>
<li><a href="../ja457016/index.html">opencartのステッカーの例に関するBEM方法論</a></li>
<li><a href="../ja457018/index.html">複雑すぎる</a></li>
<li><a href="../ja457020/index.html">厳選された学術およびサイエンスポップソース</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>