<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤝 💪🏻 🤺 Asíncrono / espera en la Unidad 👎 💛 🖖🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saludo, Khabrovsk. Queda muy poco tiempo antes del inicio del curso "Desarrollador de juegos en Unity" , en este sentido, hemos preparado para usted o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Asíncrono / espera en la Unidad</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/506962/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saludo, Khabrovsk. </font><font style="vertical-align: inherit;">Queda muy poco tiempo antes del inicio del curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Desarrollador de juegos en Unity"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en este sentido, hemos preparado para usted otra traducción interesante.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/37/kv/yt/37kvytgqxylnrra818g7eckd5ly.png"><br>
<hr><br>
<code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity ya funciona </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> complementos ni </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envoltorios de corutina que simulen un comportamiento asincrónico, verificando la finalización en cada cuadro. </font><font style="vertical-align: inherit;">Pero sigue siendo una especie de magia. </font><font style="vertical-align: inherit;">Vamos a profundizar un poco más en este tema. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Nota: por el momento no tengo una comprensión ideal de todos los detalles del capó </font></font><code>async/await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en C #, por lo que trataré de complementar lo anterior, a medida que mi comprensión se profundice).</font></font></i><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo</font></font></h4><br>
<img src="https://habrastorage.org/webt/ps/8i/so/ps8isowfho7xsjl99bnyzfh_5fo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que necesito un botón que, al hacer clic, reproduzca una animación de cuadro clásico. Pero hay un inconveniente: el botón debe pasar a un estado inactivo (oscurecerse </font></font><code>.interactable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasta que la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caja termine la rotación. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por razones de limpieza del código, quiero usar uno </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que espere a que se complete la rotación del cuadro, e inmediatamente agregue una línea que restaure </font></font><code>interactable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en lugar de algo como crear un objeto que contenga rutina, verificando el estado en cada cuadro para comenzar esta tarea. Tener un código lineal obvio en un lugar es una gran ventaja en términos de legibilidad. Tal código es bueno de escribir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente código simple y compacto implementa la tarea requerida. (</font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> los métodos también aparecen en la lista de delegados de Unity, no se preocupe).</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpinBox</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Button button;
    <span class="hljs-keyword">public</span> Animation ani;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpinAndDisableButton</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        ani.Play();<font></font>
        button.interactable = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">while</span> (ani.isPlaying == <span class="hljs-literal">true</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> Task.Yield();<font></font>
        }<font></font>
        button.interactable = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}</code></pre><br>
<br>
<img src="https://habrastorage.org/webt/m-/or/ad/m-orad9ixe4ebtae_f6hm0ast1w.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí hay algunas preguntas que debería haber hecho:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"¿Quién" "ejecuta" el </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resto del método? </font><font style="vertical-align: inherit;">Cuán mágicamente se verifica en el siguiente cuadro, mientras que la llamada </font></font><code>SpinAndDisableButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se realiza solo una vez, y no hay </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rutinas para reiniciar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Cuál es el momento de cada carrera?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Qué es </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">Esta parece ser la clave de todo lo que sucede aquí. </font><font style="vertical-align: inherit;">Supongo que estás acostumbrado a las </font></font><code>yield return null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corutinas. </font><font style="vertical-align: inherit;">Una buena suposición sería intentar nuevamente en el siguiente cuadro, pero usted lo dice a través del enumerador de C #. </font><font style="vertical-align: inherit;">La redacción del rendimiento es similar, e incluso el comportamiento es similar.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexto de sincronización</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este artículo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre cómo se puede capturar y continuar el resto del programa como queramos (por ejemplo, ¿en qué hilo? ¿En el hilo de llamada o en el hilo que inicia la tarea?) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces notará que también existe en Unity tal concepto, pero no es visible para nosotros a primera vista.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En comparación con un programa normal de C #</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No todo es lo mismo que en los programas normales de C #. Una mirada a la documentación oficial </font></font><code>await. await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implica una devolución al llamador del objeto </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La persona que llama puede continuar hasta que necesite el resultado de la ejecución, y ya no puede permitirse hacer otra cosa en este momento (no importa si la tarea es multiproceso o no), excepto </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esta cadena puede continuar hasta que finalmente llegues </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Donde, si también nos encontramos </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hay otra espera</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> generada por el compilador, que solicita inmediatamente el resultado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora de vuelta a la nuestra </font></font><code>SpinAndDisableButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ¿A dónde va el regreso </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? En la unidad no tenemos</font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ya que está profundamente oculto en el código del motor. La pregunta, de hecho, es la misma que quién realiza </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y así sucesivamente. Esta es una </font></font><code>PlayerLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API que admite el código del motor dentro del ciclo del juego para proporcionar una representación ordenada de los objetos y todo lo que se ejecuta en el marco. Pero antes, esto no nos molestó, ya que hasta ahora estos puntos de entrada han regresado </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora le </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devuelve el punto de ejecución a alguien con la esperanza de que pueda continuar desde ese punto más tarde, en cierto punto, automáticamente. Luego el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ciclo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del </font><b><font style="vertical-align: inherit;">juego continúa</font></b><font style="vertical-align: inherit;"> hasta</font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">está esperando. </font><font style="vertical-align: inherit;">De lo contrario, no veríamos la caja giratoria en absoluto, si realmente esperamos hasta que la caja termine la animación, porque la animación no podría terminar si el cambio de marco no continuara. </font><font style="vertical-align: inherit;">Entonces, ¿qué pasará en el próximo cuadro? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el pseudocódigo que queremos recibir en un marco diferente al que presionamos el botón y, por lo tanto, lo deshabilitamos:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">for</span> ( )<font></font>
{<font></font>
    <span class="hljs-keyword">if</span>(  )<font></font>
    {<font></font>
    	 .<font></font>
    }<font></font>
  <font></font>
     .<font></font>
         .<font></font>
        .<font></font>
}</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depuración</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluya más registros en el código e intentaremos la depuración paso a paso.</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpinBox</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Button button;
    <span class="hljs-keyword">public</span> Animation ani;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpinAndDisableButton</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Started async <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
        ani.Play();<font></font>
        button.interactable = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">while</span> (ani.isPlaying == <span class="hljs-literal">true</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> Task.Yield();<font></font>
        }<font></font>
        button.interactable = <span class="hljs-literal">true</span>;<font></font>
        Debug.Log(<span class="hljs-string">$"Finished async <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Update <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LateUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Late Update <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El orden de actualización es el siguiente:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ku/rp/b7/kurpb70kzx35oellcgqqwor5eow.png"><br>
<br>
<img src="https://habrastorage.org/webt/1c/k8/ef/1ck8ef1r0hmycnkfcubqfa4kwec.png"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El marco en el que comenzamos la animación está precedido por, </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debido a que el clic del mouse proviene de </font></font><code>EventSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>GraphicRaycaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desde UGUI Unity, que, como resultó, tiene el orden de ejecución en </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cualquiera de sus scripts anteriores.</font></font></li>
<li><code>while</code>   <b> </b>      ,   <b></b> <code>Update</code>,   <code>LateUpdate</code>.     ,     !</li>
<li>      ,    ,      ,   <code>Awaiting</code>,    UGUI   ,   ,  <code>await</code> ,        -   </li>
<li>         <code>Update</code>  -   . <code>await</code>     .</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Queda por desmitificar el "objeto pendiente", que no resolví completamente, pero al menos veo cómo funciona, porque fue codificado intencionalmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el primer cuadro, donde hice clic en el botón, no hay nada extraño. </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(el mismo mágico </font></font><code>MonoBehaviour Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><code>EventSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa la </font></font><code>Input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API y ve mi clic, después de lo cual escanea mi botón en el lienzo y ve que puede hacer algo. Luego se llama </font></font><code>public async void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y llega a esa línea. (¡También puede usarlos </font></font><code>ExecuteEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manualmente! Esta es una </font></font><code>static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clase </font><font style="vertical-align: inherit;">auxiliar </font><font style="vertical-align: inherit;">.) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/6q/yb/ut6qybougoh8yuhav3o2gpn8hly.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el siguiente cuadro, donde ocurre la magia, la pila de llamadas puede mostrarnos con precisión quién procesa la verificación cada pocos cuadros. No entiendo muy bien lo que está sucediendo aquí. (aunque esto funciona) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fr/gw/uj/frgwujptlworykklroix5o0m4sk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando revisé</font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, parece que se llama mucho desde el código del motor, por lo que no puedo hacer nada más que adivinar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/qh/vm/reqhvmmgmoxuzm6i-e-9ts49txm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero hay algo llamado allí </font></font><code>WorkRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que representa cada uno de sus asuntos pendientes pendientes. </font><font style="vertical-align: inherit;">Supongo que la devolución está </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registrada correctamente de una manera "similar a un juego", que es compatible con el paradigma del personal y garantiza que todo el código seguro esté bloqueado en el hilo principal para que pueda hacer algo completamente después de cualquier </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque se hará en el momento correcto en el marco .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task.Yield ()</font></font></h4><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este método tiene una descripción muy confusa: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task.yield?view=netframework-4.8</font></font></a></i><br>
<blockquote><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">YieldAwaitable</a><br>
<br>
 ,  ,          .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SynchronizationContext</a>   NULL,     .     ,     ,    .<br>
<br>
<b></b><br>
<br>
   <code>await Task.Yield()</code>;   ,     .      ( SynchronizationContext),         .   ,  ,         ,    .  ,    UI     UI,    ,    ,     .     ,  <code>await Task.Yield()</code>;   UI .      « ,    ContinueWith»   «   .NET».</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El inglés no es mi lengua materna, y creo que ni C # </font></font><code>yield return</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ni </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reflejan la función que realizan. Pero pasemos a la definición del método. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6k/-f/oi/6k-foipgostpw8fxs9c9znoz7jo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El supuesto caso de uso en la nota parece indicar que el método no es realmente </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero le gustaría convertirlo </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por lo que necesita </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(esperar) en algún lugar, por lo que </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es un chivo expiatorio ideal. En lugar de terminar inmediatamente el método (recuerde que async no convertirá mágicamente el método en asíncrono, depende del contenido del método), ahora lo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obliga</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a ser asíncrono. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero en nuestro caso, el receptor del contexto no es un contexto ordinario, sino </font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ahora</font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiene una función más útil que efectivamente continúa funcionando en el siguiente marco. </font><font style="vertical-align: inherit;">Si fuera ordinario </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, supongo que podría producir un bucle infinito en nuestro ejemplo, ya que continuará recto </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una y otra vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devuelve lo </font></font><code>YieldAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que la persona que llama puede usar para continuar. </font><font style="vertical-align: inherit;">Como testifica nuestro registro, "Esperado" se grabó al comienzo de cada cuadro, porque el contexto (el código al lado </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) se guardó en este aviador. </font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hace un poco de magia, espera el marco y usa este transportador para continuar, luego alcanza </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y devuelve uno nuevo nuevamente </font></font><code>YieldAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esto probablemente continuará agregando nuevo </font></font><code>WorkRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">código antes en cada marco como una tarea de espera hasta que </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se convierta</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UniTask</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un paquete popular de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UniTask</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que elimina por completo </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e introduce un nuevo tipo de tarea más ligera </font></font><code>UniTask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que se une directamente a la </font></font><code>PlayerLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API. </font><font style="vertical-align: inherit;">Luego puede elegir el momento en que la verificación debería ocurrir en el siguiente cuadro. </font><font style="vertical-align: inherit;">(¿Inicialización? ¿Actualización tardía?) Pero, de hecho, sabes lo que </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciona sin ningún complemento. </font><font style="vertical-align: inherit;">Esto será útil con los direccionables siempre que sea </font></font><code>AsyncOperationHandle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posible. </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que puedes usar con </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para ver</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/7eKi6NKri6I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una buena conversación, que muestra que </font></font><code>Await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ya funciona bien, pero hay ventajas en la rutina de uso razonable. </font><font style="vertical-align: inherit;">Puede prestar más atención a esta diapositiva para resolverla un poco si todavía está confundido.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8c/md/kw/8cmdkwfptrr0hr-y6twos_oto7u.png"><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creamos un tirador de red en el espacio en una hora y media.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es506940/index.html">El camino hacia el ideal: una breve guía para programadores y sus líderes</a></li>
<li><a href="../es506950/index.html">¿Qué es la escuela 21 y por qué está tan diseñada?</a></li>
<li><a href="../es506952/index.html">Portal API: qué buscar al diseñar. Experiencia de Wrike</a></li>
<li><a href="../es506954/index.html">Otro artículo sobre Rails y ELK</a></li>
<li><a href="../es506956/index.html">Tecnología cuántica y salud</a></li>
<li><a href="../es506964/index.html">Desarrollo de Android: revisión profesional para mayo de 2020</a></li>
<li><a href="../es506976/index.html">Descripción general de los escáneres 3D Solutionix D500 y D700</a></li>
<li><a href="../es506980/index.html">HackTheBox final del juego. Tutorial Xen Lab. Active Directory de Pentest</a></li>
<li><a href="../fr486176/index.html">Mémo de correspondance par e-mail d'entreprise</a></li>
<li><a href="../fr486178/index.html">FOSS News No. 1 - revue des nouvelles gratuites et open source du 27 janvier au 2 février 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>