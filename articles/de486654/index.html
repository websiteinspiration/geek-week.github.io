<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍾 🧛🏼 👨‍✈️ Bewegungssensor und Alarm- und Videoregistrierungsverbindung im Home Assistant auf Raspberry pi 👴 ✌🏻 👩🏻‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich möchte über meine kleinen Erfahrungen bei der Arbeit mit Home Assistant (im Folgenden als HA bezeichnet) auf dem Raspberry Pi sprechen und über da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bewegungssensor und Alarm- und Videoregistrierungsverbindung im Home Assistant auf Raspberry pi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486654/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich möchte über meine kleinen Erfahrungen bei der Arbeit mit Home Assistant (im Folgenden als HA bezeichnet) auf dem Raspberry Pi sprechen und über das Anschließen der Videoregistrierungsfunktion, des Bewegungssensors und dementsprechend der Home Security-Funktion, um im Falle eines Sicherheitsvorgangs Bilder per E-Mail zu empfangen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einer der Gründe ist natürlich der Wunsch, aus Ihrem Feedback zu verstehen, dass das, was ich getan habe, bei der Implementierung dieses Szenarios „falsch gemacht“ hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt drei Möglichkeiten, die oben genannten Funktionen zu konfigurieren: "ohne Probleme", "kurz" und "unabhängig". Im ersten Fall haben Sie das fertige Bild von der Website </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">https://ViaMyBox.com/downloadpage</font></a><font style="vertical-align: inherit;"> heruntergeladen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Für Ihren Raspberry Pi können Sie sehen, wie alles in der bereits konfigurierten Form aussieht. Im zweiten Fall können Sie die Zip-Datei von der Website oder vom Github-Projekt herunterladen, das HA-Docker-Image über das Dienstprogramm (sudo via-setup.sh) installieren und installieren, um zu sehen, wie alles konfiguriert ist. Und schließlich besteht der dritte Weg darin, „alles auf Ihre eigene Weise“ einzurichten: Nehmen Sie etwas Nützliches von der Site oder dem Githab des Projekts oder von diesem Tutorial. Links zu allem am Ende des Artikels.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, Sie haben bereits einen funktionierenden Home Assistant (HA). In diesem Artikel werden nur Aspekte der Bildung von Yaml-Konfigurationen und eine Beschreibung der Abfolge von Regeln und Bedingungen betrachtet, die zu einer bestimmten Aktion führen, in unserem Fall die Verbindung von „Haussicherheit“ und einem Skript, das innerhalb von 5 Sekunden nach dem Auslösen des Bewegungssensors mit dem Aufnehmen von Bildern beginnt. Infolgedessen sendet Home Assistant die aufgenommenen Bilder per Post. Ich bin kein Spezialist für Yaml oder das Erstellen von Konfigurationen für Home Assistant, aber anhand der Arbeitsbeispiele habe ich eine Arbeitskonfiguration erhalten, die ich freigeben möchte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Dateien, auf die wir verweisen werden, werde ich am Ende des Artikels für eine bequemere Überprüfung auslegen. Ich werde mich hier nicht mit der Arbeit von Skripten für die Aufnahme von Videos in Bash oder Python in diesem Beispiel befassen. Nur Heimassistent. Aber wenn Sie Fragen haben - Willkommen! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende sieht für mich alles so aus (rot hervorgehoben, was wir im Artikel betrachten werden): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3u/ol/s8/3uols87hy7mnocdgbj-k-mfbp-a.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/v9/ib/8s/v9ib8sthumy5p5hphabioyvr1ie.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich benutze Raspberry Pi als Plattform. Und mein Pfad zu den Konfigurationsdateien ist / usr / share / hassio / homeassistant /. Der Pfad zu Ihren Konfigurationsdateien kann sich von meinem Pfad unterscheiden. Zu dieser Zeit hatte ich Home Assistant 0.101.3. Wir werden an den Konfigurationsdateien in diesem Verzeichnis interessiert sein: configuration.yaml und automation.yaml.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach jeder Änderung an diesen Dateien ist zu beachten, dass die Konfiguration nach unseren Änderungen auf etwaige Fehler überprüft werden muss. Dies erfolgt auf der Registerkarte Home Assistant-Dashboard -&gt; Konfiguration -&gt; Serversteuerelemente -&gt; Konfiguration überprüfen. Und dann führen wir an derselben Stelle Reload Automations und Reload Scripts durch, wenn die Überprüfung erfolgreich war. Und im Zweifelsfall aktualisiert ein Neustart der Serververwaltung auf derselben Registerkarte die Konfiguration genau.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Bewegungssensor HC-SR501 ist an den Raspberry pi GPIO-Bus angeschlossen. Es ist notwendig, die drei Kontaktdrähte korrekt mit dem GPIO zu verbinden, und wir können unseren Sensor in Aktion verwenden. Der Sensor hat drei Kontakte: Leistung gcc (+), Null gnd (-), Steuerkontakt (Daten). Nachdem ich die Beschreibung des GPIO gelesen hatte, verband ich sie wie folgt mit meiner Himbeere. Ich habe hc-sr501 an den GPIO-Anschluss angeschlossen: Pin # 2 - 5.5vvcc; Pin # 26 (13. Reihe) - Datenkontakt und Pin # 6 - gnd (-) des Sensors. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich benutze entweder eine USB-Kamera oder eine CSI-Kamera in Verbindung mit einem MJPG-Streamer als Quelle für das Foto. Wie man mjpg-streamer auf Raspberry pi installiert und konfiguriert, wird hier nicht berücksichtigt. Beispiele für eine schnelle Installation im Internet. Ich möchte jedoch sagen, dass ich Daten aus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem Projekt verwende</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dort wird auch die Installation dieses Moduls ausführlich beschrieben. </font><font style="vertical-align: inherit;">Oder verwenden Sie eine für Sie geeignete Methode, um Fotos und Videos aufzunehmen. </font><font style="vertical-align: inherit;">Schließlich liegt es an Ihnen, welches Bash-Skript letztendlich an HA befestigt werden soll. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden unseren Sensor nun in configuration.yaml beschreiben, beispielsweise über die Befehlszeile:</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo nano /usr/share/hassio/homeassistant/configuration.yaml</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl die Verwendung von Notepad ++ mit Winscp möglicherweise bequemer ist ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beschreiben die Reihenfolge der Einstellungen für den HC-SR501 folgendermaßen:</font></font><br>
<br>
<pre><code class="plaintext hljs">binary_sensor:<font></font>
  - platform: rpi_gpio<font></font>
    #name: HC-SR501<font></font>
    ports:<font></font>
      7: Sensor HC-SR501<font></font>
    invert_logic: false<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hierbei ist zu beachten, dass hier die Einstellungen in den Zeilen wichtig sind, die die Verbindung zu den Steuer- (Daten-) Kontakten der Sensoren beschreiben: Pin # 7- </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anschlüsse: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7: Sensor HC-SR501 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Home Assistant verfügt über ein integriertes Tool zum Aktivieren der Home Security-Funktion. </font><font style="vertical-align: inherit;">Wir werden es in unserer configuration.yaml anhand der folgenden Beschreibung beschreiben: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.home-assistant.io/integrations/manual</font></font></a><br>
<br>
<pre><code class="plaintext hljs">alarm_control_panel:<font></font>
  - platform: manual<font></font>
    name: Home Alarm<font></font>
    pending_time: 60<font></font>
     delay time 40<font></font>
     triggered:<font></font>
    pending_time: 0<font></font>
    code: 1234<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Einstellung bedeutet, dass wir 60 Sekunden Zeit haben, um das Haus zu verlassen (nach dieser Zeit wird der Alarm eingeschaltet) und 40 Sekunden, um es auszuschalten (mit dem Passwort 1234), wenn wir nach Hause zurückkehren. Aus irgendeinem Grund gehen Sie immer länger als Sie kommen.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun beschreiben wir den Mechanismus zum Ein- und Ausschalten von Fotos durch den Betrieb des Bewegungssensors in unserer Konfiguration.yaml (mehr über die switch - command_line-Plattform finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="plaintext hljs"> - platform: command_line<font></font>
   switches:<font></font>
      start_stop_motion_rec_timelapse:<font></font>
        friendly_name: 'Record motion timelapse video'<font></font>
        command_on: 'curl http://localhost/start_mjpgstrm.php  &amp;&amp; curl http://localhost//rec-motion-mjpg.php'<font></font>
        command_off: 'curl http://localhost/stop_mjpgstrm.php &amp;&amp; curl http://localhost/rec-motion-mjpg-stop.php'<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier haben wir die Befehle enable enable command_on und command_off off mit unseren Skripten verknüpft, die die Kameraaufzeichnung steuern. In diesem Fall werden bei der Ausführung von command_on 2 Skripte nacheinander ausgeführt. Dadurch wird der mjpg-Streamer gestartet und die Aufzeichnung des Bewegungssensors ausgelöst. Der Zugriff auf Bash-Skripte erfolgt über die PHP-Datei der Arbeitsstelle auf Raspberry pi. Zu diesem Zweck habe ich den Nginx- und Webzugriff konfiguriert. Beim Zugriff über den Browser in der Form http: // &lt;IP-Adresse Ihres Raspberry Pi&gt; /start_mjpgstrm.php sollte unser PHP-Skript ausgeführt werden. Dieses Skript führt in dieser Situation mjpg-streamer aus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel wird die Webzugriffskonfiguration nicht berücksichtigt. Dies ist definitiv keine Sicherheit, aber aufgrund der Tatsache, dass ich HA auf Docker habe, wurde ich mit der Tatsache konfrontiert, dass ich eine isolierte Docker-Umgebung und die „Außenwelt“ des Betriebssystems habe, die ich durch Kontaktaufnahme mit meiner Site über PHP sehen kann. Es gibt wahrscheinlich eine Reihe guter Lösungen von Docker- oder HA-Gurus. Schreiben Sie, es wäre interessant zu wissen! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde eine Liste dieser Skripte unter dem Artikel hinterlassen, wir werden nicht darauf eingehen. In diesem Artikel möchte ich nur die Bildung der Abfolge von Aktionen im Home Assistant verfolgen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All dies wird im Objekt start_stop_motion_rec_timelapse platziert. Dies ist unser visueller Schalter, mit dem wir die Aufzeichnung von Fotos steuern, wenn der Bewegungssensor ausgelöst wird.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/jb/kz/j4jbkzlnslehtgai7ak93blgqnm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir können diese von uns erstellten Objekte auf der Registerkarte Home Assistant -&gt; Overview anzeigen und die Aktivierung des Konfigurationsmodus UI konfigurieren in der oberen rechten Ecke umschalten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s5/r8/31/s5r831pi5yqbp6zpph6gy_yen2g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Starten Sie HA im Browser auf der Registerkarte „Configuration -&gt; Server Control“ neu, um unsere configuration.yaml aufzurufen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wählen Sie als Nächstes das gelbe Plus am unteren Rand des Browserfensters aus, klicken Sie auf die Entitätskarte und hängen Sie unsere erstellten Objekte an die Karten an. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t5/6c/i_/t56ci_fwyo5z_vojj6iywesnwno.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wählen Sie für unseren Sensor die Sensorkarte aus. Es sieht folgendermaßen aus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hi/h-/9d/hih-9d8acqpf9lxmub8pqpxbm2y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie auf dem Bild sehen können, lautet der obige Schalter im zweiten Feld der Entität: switch.start_stop_motion_rec_timelapse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit können wir unsere Aufzeichnung am Bewegungssensor ein- und ausschalten, unabhängig von der Funktion „Sicherheit zu Hause“. Und im Allgemeinen sollte es nach all den oben genannten Aktionen bereits funktionieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, und dementsprechend die Alarmtafel: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m-/om/ob/m-omobeh7bj-auliurl9abujbhw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt noch einen weiteren interessanten Punkt. Ich benutze Home Assistant als Docker-Container. In dieser Hinsicht unterscheidet sich der Pfad zu unserem Skript vom tatsächlichen Pfad zur Skriptdatei. Schließlich wird die Dateistruktur im Container virtualisiert und über bereitgestellte Docker-Volumes mit der realen Dateistruktur verbunden. Es sieht folgendermaßen aus: Pfad im Container: / config / scripts / Pfad im Betriebssystem: / usr / share / hassio / homeassiatnt / scripts. Sehen Sie sich also Ihre Containereinstellungen an, wie diese Volumes im Feld Binds konfiguriert sind. Wenn HA hast du da.</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo docker inspect homeassistant|less
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Bewegungssensor ausgelöst wird, in dem Moment, in dem der Alarm eingeschaltet wird: Ich möchte zusätzlich zu der Tatsache, dass wir mit dem schnellen Fotografieren beginnen (Zeitraffer-Schnappschüsse), eine Warnung per E-Mail und einen Schnappschuss erhalten. Ich habe die Prozesse parallelisiert. Auf dem ersten Foto erfolgt die Protokollierung (Zeitraffer-Schnappschüsse) innerhalb weniger Sekunden nach dem Auslösen des Sensors. Dazu führe ich mjpg-streamer curl </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localhost / start_mjpgstrm.php aus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">starte</font></a><font style="vertical-align: inherit;"> php: surl </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: //localhost/rec-motion-mjpg.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Er führt seinerseits das Python-Skript mov.py aus. Alle beschriebenen Dateien und Links befinden sich am Ende des Artikels als Referenz. Und ein anderes Skript von takeSnapshotWebcam.sh erstellt einen Schnappschuss, den ich per E-Mail sende. Ich beschreibe diese Skripte in unserer configuration.yaml folgendermaßen:</font></font><br>
<br>
<pre><code class="plaintext hljs">shell_command:<font></font>
#      <font></font>
  take_snapshot_webcam: '/config/scripts/takeSnapshotWebcam.sh'<font></font>
#  mjpg-streamer <font></font>
  start_mgpg_streamer: 'curl http://localhost/start_mjpgstrm.php'<font></font>
# mjpg-streamer<font></font>
  stop_mgpg_streamer: 'curl http://localhost/stop_mjpgstrm.php'<font></font>
#      5 <font></font>
  start_motion_rec: 'curl http://localhost/rec-motion-mjpg.php'<font></font>
# <font></font>
  stop_motion_rec: 'curl http://localhost/rec-motion-mjpg-stop.php'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dort beschreiben wir in configuration.yaml unser Mailing-Objekt:</font></font><br>
<br>
<pre><code class="plaintext hljs">notify:<font></font>
  - name: ha_sendmail<font></font>
    platform: smtp<font></font>
#    gmail<font></font>
    server: smtp.gmail.com<font></font>
    port: 587<font></font>
    timeout: 15<font></font>
#  <font></font>
    sender: user@gmail.com<font></font>
    encryption: starttls<font></font>
    username: user@gmail.com<font></font>
    password: passwd<font></font>
#  (       ,    )<font></font>
    recipient:<font></font>
      - user@gmail.com<font></font>
    sender_name: My Home Assistant<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein wichtiger Punkt! </font><font style="vertical-align: inherit;">Damit unser HA eine Verbindung herstellen und Briefe senden kann (Absenderfeld), müssen wir Google Mail aktivieren, um dieses Feld für unseren HA-Dienst zu verwenden. </font><font style="vertical-align: inherit;">Wie das geht, ist der Link hier: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myaccount.google.com/lesssecureapps</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Und dann beschreiben wir den Automatisierungsmechanismus selbst, wenn der Alarm home_alarm in automation.yaml aktiviert ist:</font></font><br>
<br>
<pre><code class="plaintext hljs">#   (alias) “  ,   ”<font></font>
- alias: 'Trigger alarm while armed away'<font></font>
#alias ,     “on”<font></font>
  trigger: <font></font>
    - platform: state<font></font>
      entity_id: binary_sensor.sensor_hc_sr501<font></font>
      to: 'on'<font></font>
# ,         “armed away”<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
      state: armed_away<font></font>
#     <font></font>
  action:<font></font>
# mjpg-streamer ( )<font></font>
    - service: shell_command.start_mgpg_streamer<font></font>
# ,   <font></font>
    - service: shell_command.start_motion_rec<font></font>
#    “  ”   HA   “ ”<font></font>
    - service: alarm_control_panel.alarm_trigger<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgenden Bedingungen und Aktionen dienen dazu, beim Deaktivieren von "Sicherheit" eine Konsolennachricht zu senden und unsere Bewegungsaufzeichnungsskripte zu deaktivieren:</font></font><br>
<br>
<pre><code class="plaintext hljs">- alias: 'Send notification when alarm is Disarmed'<font></font>
  trigger:<font></font>
    - platform: state<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
      to: 'disarmed'<font></font>
  action:<font></font>
    - service: shell_command.stop_mgpg_streamer<font></font>
    - service: shell_command.stop_motion_rec<font></font>
    - service: persistent_notification.create<font></font>
      data:<font></font>
       message: The alarm is Disarmed at {{ states('sensor.date_time') }}"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und schließlich der dritte Haufen - wir senden einen Brief mit einem Foto:</font></font><br>
<br>
<pre><code class="plaintext hljs">- alias: 'Send notification when alarm triggered'<font></font>
  trigger: <font></font>
   - platform: state<font></font>
     entity_id: alarm_control_panel.home_alarm<font></font>
     to: 'triggered'<font></font>
  action:<font></font>
    - service: persistent_notification.create<font></font>
      data:<font></font>
       message: Notification when alarm triggered. Motion sensor HC-SR501 detected.<font></font>
    - delay:<font></font>
       seconds: 4<font></font>
#     <font></font>
    - service: script.webcam_snapshot<font></font>
#      configuration.yaml: notify.ha_sendmail<font></font>
    - service: notify.ha_sendmail<font></font>
      data:<font></font>
        title: 'Intruder alert'<font></font>
        message: '{{now().strftime("%H:%M %Y-%m-%d")}}:Notification when alarm triggered. Motion sensor HC-SR501 detected.'<font></font>
        data:<font></font>
           images:<font></font>
#      script.webcam_snapshot  <font></font>
              - /config/camera/snapshot.jpg<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Denken Sie daran, dass das Zeilenlayout in Yaml-Dateien wichtig ist und Leerzeichen vor Befehlen eine wichtige Rolle bei der Bildung von Codeblöcken und ihrer Struktur spielen. </font><font style="vertical-align: inherit;">Überprüfen Sie alle Änderungen an Ihrem Yaml über die HA-Konfiguration (Home Assistant) -&gt; Serversteuerelemente -&gt; Konfiguration überprüfen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles scheint zu sein, und Ihr Himbeer-Pi wird elegant ... wenn der Blitz nicht hängen geblieben ist!) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist es - eine funktionierende HA-Automatisierung, maßgeschneidert! </font><font style="vertical-align: inherit;">Schreiben Sie mir unbedingt, was Sie darüber denken! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn Sie noch bis zum Ende lesen, biete ich die versprochenen Links an: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://viamybox.com/downloadpage </font></font><br>
</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/viatc/viamybox Die</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
hier beschriebenen Konfigurationsdateien: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automation.yaml, configuration.yaml, takeSnapshotWebcam. sh, rec-motion-mjpg.php, mov.py.</font></font></a></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486644/index.html">DIY Antenne in 5 Minuten</a></li>
<li><a href="../de486646/index.html">Geh weg von jQuery nach Svelte, ohne Schmerzen</a></li>
<li><a href="../de486648/index.html">AWS Lambda in Aktion in Java 11. Serverlos in die Produktion gehen</a></li>
<li><a href="../de486650/index.html">Dynamischer Speicher in harten Echtzeitsystemen</a></li>
<li><a href="../de486652/index.html">"Kritik der reinen Vernunft" für Programmierer</a></li>
<li><a href="../de486656/index.html">So fügen Sie Unicode neue Charaktere hinzu: die Erfahrung des Laien</a></li>
<li><a href="../de486658/index.html">Moxy Strategie Plugin</a></li>
<li><a href="../de486660/index.html">Ideen vom Tisch: Metro Raumanzug</a></li>
<li><a href="../de486664/index.html">Hack The Box. Passage RE. Metasploit, Laden in Office-Dokument, Zip-Slip-Angriff, ein bisschen über PowerSploit und Token</a></li>
<li><a href="../de486666/index.html">Schneemobile, Bier und Wetterderivate</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>