<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥀 ↕️ 🍱 最も簡単なZigBeeネットワークを組み立て、Mbedの下でプログラムし、MQTTを介して通信します 🙍🏾 🚵🏼 🔳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事は、Mbed OSを搭載したマイクロコントローラーと組み合わせてXBeeモジュールを使用するための、入門レベルのトレーニングワークショップです。 ZigBeeは、スマートホームシステムで長く根付いた標準であり（たとえば、Samsung SmartThingsハブでZ-Waveと一緒に使用され...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>最も簡単なZigBeeネットワークを組み立て、Mbedの下でプログラムし、MQTTを介して通信します</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/samsung/blog/497200/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事は、Mbed OSを搭載したマイクロコントローラーと組み合わせてXBeeモジュールを使用するための、入門レベルのトレーニングワークショップです。 ZigBeeは、スマートホームシステムで長く根付いた標準であり（たとえば、Samsung SmartThingsハブでZ-Waveと一緒に使用されます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">）、低消費電力、使いやすさ、そして最も興味深いのは、作成できることです。自己構成メッシュネットワーク。ワークショップから、これが実際にそうであることがわかります。便利なビジュアライザーユーティリティを使用して、このようなネットワークの構造を確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZigBeeとは何か、それが何のためにあるかをすでに知っていることが前提です。</font><font style="vertical-align: inherit;">ここで、最初のXBeeモジュールを接続して、モジュール自体のプログラミングに入るのではなく、それを通信インターフェイスとしてのみ使用して、問題を解決します。</font><font style="vertical-align: inherit;">最終的には、すべてのデータを、その場しのぎのMQTTゲートウェイを介して、ローカルサーバーやインターネットにも送信します。</font><font style="vertical-align: inherit;">私たちは、Mbedの例のすべてを、初心者向けのRTOSで最もシンプルで最もアクセスしやすいものとして示すことにしました。</font><font style="vertical-align: inherit;">すべてが「そのまま」機能することを確信し、以前はArduinoのみを扱っていたとしても、すぐにプロジェクトの作成を開始できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このマニュアルは次の部分で構成されます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeモジュールの接続と構成</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールをネットワークに接続します</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シールドから外さずにモジュールを構成します</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ検索</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データを送信する</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単純なMQTTゲートウェイを作成する</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、最初に、コンポーネントのリスト：上記のすべてを実行するために必要なもの。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なコンポーネント</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つのMbed互換ボード。</font><font style="vertical-align: inherit;">STM32 Nucleoトレーニングボードは、教育目的で比較的安価で人気があるものとして推奨しています。</font><font style="vertical-align: inherit;">プログラミングプロセスは非常に単純化されています。プログラムをオンラインの無料IDEで収集し、組み立てられたファームウェアをダウンロードして、システムにフラッシュドライブとして表示されるボードに「ドロップ」します。</font><font style="vertical-align: inherit;">どのモデルを採用するかは重要ではありませんが、最も古いモデルを採用するのではなく、メモリの量に注意してください。</font><font style="vertical-align: inherit;">たとえば、F401RE-私たちは明確さのために提供します。そのため、それらの多様性と、最初はSTMプロセッサの理解できないアルファベットコードとが混同されることはありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"> <img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"><br>
</li>
<li> XBee-.      Digi.  «» ,  ,  , MBee,  ,    ,     ,      . /        :      ,      .   /  Pro:      ,      ,   Pro   .<br>
<img src="https://habrastorage.org/webt/r2/ed/ew/r2edew1y1gkdpcw9soz-vunnu9q.png"><img src="https://habrastorage.org/webt/m6/-n/aq/m6-naqf0x0qqrjpj-soxa6aulj0.png"><img src="https://habrastorage.org/webt/t2/x5/ng/t2x5ng0wfuoehd4oujmvhf1spha.png" width="200"><br>
</li>
<li>  XBee Shield V2 ( SeeedStudio).      -     ,        RX  TX XBee-.<br>
<img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBee用のコネクタを備えたUSB-UARTコンバータ1つ。</font><font style="vertical-align: inherit;">初期設定に必要です。</font><font style="vertical-align: inherit;">XBeeモジュール自体はUSBインターフェースを装備していません（それとは関係ありません）。</font><font style="vertical-align: inherit;">USBは、モジュールとコンピュータ間の通信にのみ必要であり、デバイスでは、はるかに単純なUARTで動作できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XBeeモジュールのスロットピッチは2.0 mmです-メートル法では電子機器の標準ではありません（通常、アメリカの標準によると、ステップ2.54に慣れています）。</font><font style="vertical-align: inherit;">したがって、残念ながら、そのようなモジュールはブレッドボードに挿入されず、常にアダプターが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではどのアダプターも適しています。これをWaveshareから取得しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/md/y5/04mdy5mhmm6cfwuj-a21a5eqagy.png" width="300"></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeモジュールの接続と構成</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このモジュールでできる最も簡単なことは、USB経由で直接コンピューターに接続することです。</font><font style="vertical-align: inherit;">すぐにその構成パラメーターにアクセスします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XCTUをインストールする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XBeeを使用するために、公式のXCTUプログラムがあります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウンロード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">してインストールしてください。</font><font style="vertical-align: inherit;">ドキュメントによれば、Ubuntuでは</font></font><code>dialout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、スーパーユーザーではなくポートを</font><font style="vertical-align: inherit;">操作するためにユーザーをグループに追加する必要があり</font><font style="vertical-align: inherit;">ます-まだ行っていない場合は、次のようにしてください。</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -a -G dialout &lt;username&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リンクからzipアーカイブをダウンロードします</font></font><code>.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ファイルが含まれます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（</font></font><code>chmod +x _</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンソールまたは右マウスボタン-プロパティ-権限を</font><font style="vertical-align: inherit;">介し</font><font style="vertical-align: inherit;">て）</font><font style="vertical-align: inherit;">実行可能にして実行する必要が</font><font style="vertical-align: inherit;">あります</font></font><code>./40002881_V.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルートからではなく（なしで</font></font><code>sudo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">インストールを開始することが重要</font><font style="vertical-align: inherit;">です。そうしないと、後で問題が発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セットアップは次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/44/kg/iz/44kgizj3bjlvchzakcksvrh1i_u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XCTUプログラム</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストール後、プログラム</font></font><code>app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をインストールしたディレクトリ（デフォルトでは- </font></font><code>~/Digi/XCTU-NG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">のファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実行してプログラムを起動でき</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
外観は次のようになります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/wz/y0/qrwzy0nbyhomwp8g-k26jrluio4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプログラムでは、アダプターを介してUSBポートに接続されている既存のモジュールを追加できます。虫眼鏡で[発見]ボタンをクリックします。ウィンドウが表示され、ポートを選択するように求められます。ご覧のとおり、プログラムはシステム内のポートを正しく検出しました</font></font><code>/dev/ttyUSB0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これがUSB-UARTアダプターです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/qr/h1/rsqrh1y2if1z6nr_zl844kdba4o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィンドウは検索を開始することを提案します。</font><font style="vertical-align: inherit;">もちろん、モジュールを確実に見つけるために一度にすべてをチェックしたいという誘惑があります。</font><font style="vertical-align: inherit;">しかしその後、検索は非常に長い間続きます。</font><font style="vertical-align: inherit;">実際には、デフォルトでチェックボックスをオンのままにして、下の図のように、データ転送速度の最も一般的なオプションを選択することは理にかなっています。</font><font style="vertical-align: inherit;">通常、新しいモジュールのデフォルトは9600ですが、トレーニング目的ではこれで十分です。ここでは速度は重要ではありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l2/dj/ve/l2djvekjunxaxpxesaxo786q3le.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果として、すべてが成功した場合は、見つかったモジュールを選択するように求められます</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/dq/le/4zdqledgifvp92zr4lvm6bat2km.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。小さなバグが</font><font style="vertical-align: inherit;">発見されました。</font><font style="vertical-align: inherit;">モジュールが標準速度でない場合がありました。検索中にリセットボタンを使用してモジュールを手動でリセットし、ボーレートを標準（9600）にリセットすることで解決しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールのパラメーターを変更する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、モジュール構成にも取り組んでいます。多くのパラメータが削除されますが、そのほとんどは最初は理解できません。幸いなことに、クイックスタートのために変更する必要があるのはそのうちのいくつかだけです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークID-PAN ID。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共通のネットワークキー。ネットワークに独立して接続されるように、すべてのデバイスで同じでなければなりません。私たちの場合、42を入力しました。CE </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t7/dg/lk/t7dglkxhvbkban2romlxiu97qpi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Coordinator Enabled。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1の場合、このモジュールはコーディネーターとして機能します。値が0の場合、モジュールはルーター（ルーター）として機能します。実際、パケットがネットワークを通過することを保証します。ほとんどのホストは通常​​ルーターです。ネットワークには1つのコーディネーターと2つのルーターが必要なので、ここに1つ配置します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、「エンドデバイス」（エンドデバイス）という役割もあります。これは、パケットの転送に関する作業は行わず、他のルーターとのみ通信してその有用な機能を実行するモジュールです。通常、彼はスリープモードにあり、設定された間隔で目を覚まし、メッセージがあるかどうかを調べます。このようなモジュールはバッテリーで駆動できますが、ルーターとコーディネーターは常に「オンライン」である必要があり、その結果、ネットワーク全体の正常性を維持するために一定の電力が必要になります。誰もがルーターの役割を割り当て、ネットワークがその構成を自動的に変更する方法を観察することはより興味深いので、ここではそのような例を検討しません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/zp/e3/0mzpe3yptscx6la-wummlbiixks.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP-API有効。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動作モード。 XBeeモジュールは、ATまたはAPIの2つのモードで動作できます。 ATモードは初心者にとっては簡単で、シリアルポートの透過的な置き換えであり、ATコマンドを介してモジュールを操作します。ただし、APIモードは機能がはるかに豊富で、モジュールをリモートで構成したり、送信者アドレスを含めたり、パッケージの配信ステータスを返したりすることができます。さらに、XBeeと対話するためのライブラリは、デバイスがAPIモードで使用されることを前提としています。したがって、すぐにAPIモードに置き換えます。これは、対応するフィールドに単位を設定することによって行われます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ra/wv/ng/rawvngogy6biagddxsxxx08fhao.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールの名前はNode Identifierです。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールに人間が読める名前を付けるための便利なオプション。そのような名前を付けましょう-コーディネーター。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xi/h2/fy/xih2fygnbxffyqcyhuwbvn8zhqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、鉛筆でボタンを押すことにより、設定をモジュールにフラッシュできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/8g/xm/pi8gxmplnffs0qmxtckhrfmxrqe.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.モジュールをネットワークに接続します</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つのモジュールを構成すると、どのようなネットワークが得られるかがわかります。</font><font style="vertical-align: inherit;">XCTUプログラムにはかなり便利なネットワークビジュアライザがあり、トポロジーがはっきりとわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のパラメーターを使用して、3つすべてのモジュールを順に構成します。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAN ID-合計数、たとえば42</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP（API有効）-1に設定（APIモードで動作）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NI（ノード識別子）-モジュールにわかりやすい名前を付けます（たとえば、スマートホームシステムのモデルの場合は、コーディネーター、ランプ、スイッチ）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE（Coordinator Enable）-モジュールの1つを1に設定します。これがコーディネーターになります。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、すべてのモジュールに電源を投入します。このように配置します。コーディネーターはUSB-UARTコンバーターにあり、他の2つ（ルーター）はNucleoの上のXBeeシールドボードに配置されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてを注意深く行うと、美しいことが起こります。モジュールは自動的にネットワークに接続します。コーディネーターを介してリモートでルーターと通信できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんな感じです。 「同じネットワーク内の無線ノードを検出」ボタンをクリックします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/nf/mx/emnfmxivn4xxt3wtx0pe0f54m8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのモジュールが自動的に検出されて追加されたことがわかります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j3/ev/gf/j3evgfx0nj0xowanzz3ovdctyks.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、その場でパラメーターを変更できます！&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
優れた点：右上のネットワーク動作モードに切り替えると、ネットワークマップが表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/2v/ma/sf2vmarm8agrkfjtepgib28sxuq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マウスでネットワークノードを広げると、三角形が表示されます。</font><font style="vertical-align: inherit;">右端のモジュールへのトラフィックは2つの方法で移動できることに注意してください。</font><font style="vertical-align: inherit;">また、モジュールを空間に移動すると、状況が変わったことがわかり、おそらく、別のモジュールが「極端」になるでしょう。</font><font style="vertical-align: inherit;">これが自己構成ネットワークの本質です。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. XBeeモジュールをシールドから取り外さずにセットアップします</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、XBeeモジュールをコンピューターではなく、マイクロコントローラーのプログラムを使用して制御することで、より興味深いものになります。</font><font style="vertical-align: inherit;">つまり、STM32Nucleoボードに接続します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XBeeモジュールがマイクロコントローラーとどのように通信できるかについて説明します。</font><font style="vertical-align: inherit;">そして、小さなタスクから始めましょう：拡張シールドから削除せずにモジュールを構成する方法？</font><font style="vertical-align: inherit;">モジュールを前後に移動するのは不便であると同時に、パラメータを実験したいことと、理論上はSTM32Nucleoボードにあるため、別のUSB-UARTモジュールが必要なのは不思議です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解決策は簡単です。NucleoボードをXBeeモジュールとボード上のUSBコンバーターの間のブリッジに変える必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイデアの概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが使用するSTM32マイクロコントローラーには、ボード上にいくつかのUARTインターフェイスがあります。そのような各インターフェースは、通信チャネルを表します。そのうちの1つはUSB-UARTコンバーターに接続されているため、ターミナルでUSBを介してコンピューターと通信できます。他の2つはまだ使用されていません。 XBeeモジュールをそのうちの1つに接続します。これには、このような通信チャネルもあります。任意のUARTを選択できます。UART1を明確にするために選択しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ピン配置は、ボード選択ボタンを押して、右上の[ピン配置]タブでMBedで表示できます。</font><font style="vertical-align: inherit;">習慣がなければ、このカラフルな絵を認識するのは非常に困難です。</font><font style="vertical-align: inherit;">ボードには多くのインターフェースがあり、マイクロコントローラー（PA_5、PA_6-ピン番号）に関連するものと、ボード（D13、D12-Nucleoボード上の銘板、端子の近くにある同じ番号）に関連する2つのピン番号があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/97/dp/mq/97dpmqw9dmy9lcqtb1hf6i_gyz0.png"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロコントローラーでは、UART1インターフェイスはXBeeモジュールと通信し、UART2は以前と同様にコンピューターと通信します。</font><font style="vertical-align: inherit;">内部コードはUART1をUART2に、またはその逆にリダイレクトします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/vk/5w/rpvk5wsdsb8qnz5i_m7dk8q-wwc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続により、次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/g7/cs/tpg7cslaiomjx-ogqje-su3q-7s.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロコントローラーから「ブリッジ」を作成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、シールドのジャンパーを使用して、ZigBeeモジュールを接続する番号を設定できます。 TX通信モジュールはボードのピン2（マイクロコントローラーのPA_9）に接続され、RXはピン8（別名PA_10）に接続されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようになります</font><font style="vertical-align: inherit;">。私たちが取った</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/ce/3s/ohce3sq3y1_0_jewruer0dmn36a.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、シリアルブリッジと呼ばれます。これは、2つの通信チャネル間の「ブリッジ」です。コードをマイクロコントローラーにロードします。マイクロコントローラーは、UART2を介してコンピューターから入力されたものすべてをUART1に転送し、その逆も同様です。 2つの情報源の間にパイプを挿入したかのように（Linuxsoidは理解します）。 XBeeモジュールをUART1に接続しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードは非常に単純です。コードを変更する必要があるのは、デバイスが接続されているピン番号だけです。つまり、上記のようにPA_9およびPA_10にします。</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mbed.h"</span></span>
<span class="hljs-comment">// Make a serial bridge from a serial I/O device on mbed to the PC</span>
<span class="hljs-function">Serial <span class="hljs-title">pc</span><span class="hljs-params">(USBTX, USBRX)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-function">Serial <span class="hljs-title">device</span><span class="hljs-params">(PA_9, PA_10)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-comment">// Defaults to 9600 baud on each device - use .baud(baudrate) to change</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
&nbsp;pc.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello!"</span>);
&nbsp;<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(pc.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device.putc(pc.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(device.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.putc(device.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論の順序を混同する場合-たとえば、ミスをしてPA_9、PA_10の代わりにPA_10、PA_9-間違った順序を書いた場合、コンパイラーはエラーを報告せず、プログラムは再起動時にコンソールにエラーを表示します。</font></font><br>
<pre><code class="plaintext hljs">pinmap not found for peripheral</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
移動しない、つまり、原則として何も機能しない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードをダウンロードし、ジャンパーをシールドに正しく設定したら、シールドから外さずに以前のUSB-UARTアダプターを使用した場合と同じように、コンピューターからXBeeモジュールに安全に接続できます。</font><font style="vertical-align: inherit;">XCTUプログラムによって定期的に検出されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この機能が必要ない場合でも、プログラムが機能していることを確認してください。次の例では、マイクロコントローラーからXBeeモジュールと通信し、UART1を介した接続がすでに確立されているはずです（つまり、ジャンパーが正しく設定され、ピン番号がプログラムに示されています）。 。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.データ取得</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XBeeモジュールを外部通信インターフェースとして使用して、マイクロコントローラーレベルでデータを送受信する2つの簡単な例を見てみましょう。</font><font style="vertical-align: inherit;">メーカー-Digi社の</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
公式</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それはMbedリポジトリにあり、コードの使用とロジックに関する有用なコメントがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、データを取得する方法を学習します-簡単な例があります。</font><font style="vertical-align: inherit;">XBeeモジュールをUSB-UARTコンバーターに接続し、Nucleoボードに挨拶を送信すると、この挨拶がコンソールに出力されます。</font><font style="vertical-align: inherit;">このライブラリで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">プロジェクト</font></a><font style="vertical-align: inherit;">を</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/ic/u5/zgicu5mh8dvsy8y8aegzetdoew8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開き</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">いつものように、それをプログラムとしてオンラインコンパイラにインポートします。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2Cモジュールのライブラリを修正</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S2Cシリーズのモジュール</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を使用している場合は、標準ライブラリの代わりに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeLib_Fixed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する必要があることに注意して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そうしないと、これらのプログラムは機能しません。</font><font style="vertical-align: inherit;">そこからXBeeLibライブラリを削除し、XBeeLibFixプロジェクトにインポートするだけで、プロジェクトに追加されます。</font><font style="vertical-align: inherit;">これ以上変更する必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、このライブラリをオンラインコンパイラに</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/vq/e9/kovqe9zqdl7553_kivabf8bedv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インポートします。プロジェクトのインポートウィンドウが表示されます。</font><font style="vertical-align: inherit;">ここで、ターゲットを選択する必要があります-インポートする場所：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/pt/vt/bxptvt2ctwcv87vl-b1qi5upi4s.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ターゲットプロジェクトとして、サンプルXBeeZB_Receive_Dataを選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/lj/hg/7qljhgp7jx5yt9875cqijnfopcs.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、ライブラリがプロジェクトにインポートされ、その後、大胆に移動して、間違ったバージョンのXBeeLibを削除します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iw/hz/or/iwhzor7bqjopgpigyi4_lfiv43e.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイル例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、サンプルをインポートし、必要に応じてその中のライブラリを置き換えました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サンプルコードを見てください、それは非常に簡単です。</font><font style="vertical-align: inherit;">パケットを受信したときに呼び出されるコールバック関数を定義します。</font><font style="vertical-align: inherit;">この関数は、受信したパケットの内容をコンソールに出力します。</font><font style="vertical-align: inherit;">したがって、私たちが彼女に挨拶を送ると、彼女もそれを印刷します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サンプルをコンパイルするには、XBeeモジュールとの通信を担当する結論をサンプルに書き込む必要があります。これは、プログラムがハードウェアに接続した結論がわからないためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、config.hファイルとその中の行に移動します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define RADIO_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX pin connected to the XBee module DIN pin */</span>
<span class="hljs-comment">//#define RADIO_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX pin connected to the XBee module DOUT pin */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コメントを外し、NCの代わりに、ジャンパーを接続した結論に従って、次のように記述します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_TX PA_9</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_RX PA_10</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、次の行を変更します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define DEBUG_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX for debugging */</span>
<span class="hljs-comment">//#define DEBUG_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX for debugging (optional) */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは書く：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_TX USBTX</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_RX USBRX</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイル中に検出できないエラーが発生した場合</font></font><code>device.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、プロジェクトツリーでMbedライブラリを更新します（右クリックして[更新]をクリックします）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、プログラムは正常にコンパイルされ、ボードにダウンロードできます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nucleoボードの書き込み内容をコンソールで確認すると、次のことがわかり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/mk/fb/asmkfbne30jznt7bzqvr2vjhl5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。</font><font style="vertical-align: inherit;">最も簡単なオプションは、XCTUプログラムのコンソールからです。</font><font style="vertical-align: inherit;">プログラムのメインメニューで[ツール]-[パケットを送信]を選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/9b/7q/ko9b7qwhvwszyezghvzpbs1py74.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下部には、「パケットの送信」という言葉のウィンドウがあります。</font><font style="vertical-align: inherit;">右側の「プラス」をクリックして、新しいパッケージを作成します。</font><font style="vertical-align: inherit;">新しいパッケージを作成するためのウィンドウが表示されます。</font><font style="vertical-align: inherit;">そこでHEXタブを選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cf/wz/jccfwz6aesmjic-ncukw8ot1ls8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこにそのようなデータ送信を入力します：（</font></font><br>
<code>7E 00 19 10 01 00 00 00 00 00 00 FF FF FF FE 00 00 48 65 6C 6C 6F 20 58 42 65 65 21 5A</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケットリストの右側にある[選択したパケットの送信]ボタンを使用）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リスニングモジュールのコンソールに結果が表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/tg/mk/55tgmkipu_8dk33yhqdxxqa90du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信したバイトセットの最後の部分のみが印刷されることに注意してください。</font><font style="vertical-align: inherit;">これはメッセージの実際のペイロードです。</font><font style="vertical-align: inherit;">また、「バイトのみ」（バイトの任意の組み合わせ）を送信した場合、レシーバーはそれらを出力しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バイトのセットを配置する場合：&nbsp; </font></font><br>
<code>48 65 6C 6C 6F 20 58 42 65 65 21</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
任意のHEX-ASCIIIコンバーター（たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）で、「Hello XBee！」を意味することを確認してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独立した実行のための非常に単純なタスク：サンプルテキストを変更して、メッセージテキストを16進数ではなくASCIIで表示し、このテキストを端末で読み取ることができるようにします。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.データの送信</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の例と同様に、データの送信を検討します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の例と同様に、すべてがここにあります。</font><font style="vertical-align: inherit;">XBeeZB_Send_Data </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サンプルを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開いているという違いのみ</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイル例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S2Cモジュール（それが明確に書かれている）を</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用している場合は、ライブラリを修正プログラムに再度接続する</font><font style="vertical-align: inherit;">ことが重要</font><font style="vertical-align: inherit;">です。そうしないと何も機能しません。これを行う方法は、前の例で説明されています。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ここでコンパイルを成功させるには、使用するコントローラーピンを指定する必要があります。前の例から単純にコピーできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サンプルコード自体を見てみましょう。これは、</font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データを送信するために、いくつかの方法を使用しています。最も単純なものを選択してください：コーディネーターにデータを送信します。コーディネーターは既にネットワークに登録されているため、コーディネーターのアドレスを登録する必要さえありません。したがって、サンプルを変更せずに、最後のすべての行でコメントを付けます。</font></font><br>
<pre><code class="cpp hljs">send_data_to_coordinator(xbee);
<span class="hljs-comment">//send_broadcast_data(xbee);</span>
<span class="hljs-comment">//send_data_to_remote_node(xbee, remoteDevice);</span>
<span class="hljs-comment">//send_explicit_data_to_remote_node(xbee, remoteDevice);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開始すると、次のように表示されます：（</font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/pp/sj/suppsjbb95cdiavs1svsj1ixctm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表示されない場合は、ボードを再起動するだけです）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データをコーディネーターに確実に到達させるにはどうすればよいですか？たとえば、XCTUにはネットワークコンソールモードがあります。右上のボタンでONになります。このモードでは、ネットワーク上のすべてのパケットが表示されます。もちろん、同時に、コーディネーターとのシリアル接続が必要です。左上にある[開く]ボタンをクリックして緑色にすることを忘れないでください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/st/vy/yzstvyfb4ed2rkbgvmgushy1gkg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
左側のリストでパッケージを選択すると、ネットワーク上の各パッケージに関する詳細情報を確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/2w/_f/fl2w_fotyjqzbmdpt9tp6fvyyba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージの内容の最後までスクロールすると、「send_data_to_coordinator」というテキストの行も表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/da/ha/vmdahazkjgs7ttk_d-hg6osq7oi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のデータ送信方法を試すこともできますが、（たとえば、選択した別のノードに送信するには）ノードアドレスを登録する必要があります。</font><font style="vertical-align: inherit;">XCTUプログラムですべてのモジュールのアドレスを確認できます。</font><font style="vertical-align: inherit;">例では、特定のアドレスを登録する方法を徹底的に説明しています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. MQTTゲートウェイを作成します</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが素晴らしいですが、今はどういうわけか、このデータをXBeeネットワークの外部、たとえばインターネットで処理したいと思います。</font><font style="vertical-align: inherit;">これを行う1つの方法は、XBeeからトランスレータを一般的なMQTTプロトコルに配置することです。</font><font style="vertical-align: inherit;">次に、通常の方法で、イベント通知をサブスクライブし、ユーザーインターフェイスからコマンドを送信できます。このプログラムは、コンピューター上だけでなく、任意の場所（ローカルMQTTサーバーではなく外部を使用する場合）に配置できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下が手順です。</font><font style="vertical-align: inherit;">つまり、コンピューターで起動されたプログラムは、USB接続を介してネットワークコーディネーターからデータを交換します。</font><font style="vertical-align: inherit;">彼女はこれらのデータをMQTTプロトコルに送信します。</font></font><br>
<img src="https://habrastorage.org/webt/t0/yo/dx/t0yodx2oqigqjepdzr0w8exjwaq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBMQをインストールして構成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MQTTゲートウェイとして使用するプログラムはXBMQと呼ばれ、オープンで無料です。</font><font style="vertical-align: inherit;">2つのバージョンで存在します：</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジャワ</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeJS</font></font></a><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javaバージョンが考慮されますが、これはあまり基本的ではありません。とにかくプログラムしないで、インストールして使用するだけです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムが機能するには、RXTXライブラリが必要です。これは、リポジトリから簡単にインストールできます。</font></font><br>
<pre><code class="bash hljs">sudo apt-get install librxtx-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてもちろん、JDK（Java Development Kit）も必要です。</font><font style="vertical-align: inherit;">OracleとOpenJDKの2つのバージョンが存在し、2番目のバージョンが推奨されます。</font><font style="vertical-align: inherit;">ほとんどの場合、OpenJDKはすでにシステムにインストールされています。インストールされていない場合は、再インストールしてください。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.xml.bindはJava 11から除外されて</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おり、デフォルトオプションとしてJDK-8の代替を選択するか、この場合の構成を作成する</font><font style="vertical-align: inherit;">必要があるため、Javaは最大で8番目</font><font style="vertical-align: inherit;">を必要とします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XBMQプログラムのリポジトリをダウンロードします。</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/angryelectron/xbmq-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースコードをダウンロード後、プログラムのバイナリファイルを収集します。</font><font style="vertical-align: inherit;">チーム</font></font><br>
<pre><code class="bash hljs">ant dist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての主要なオペレーティングシステムのプロジェクトをアセンブルします。</font><font style="vertical-align: inherit;">最終的にコンパイルされたプログラムはフォルダーにあります</font></font><code>dist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、このプログラムを構成します。</font><font style="vertical-align: inherit;">ファイルを開く</font></font><pre><code class="plaintext hljs">dist/xbmq.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 そこを見てください：</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment">#</span>
<span class="hljs-comment"># Xbmq Properties.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#port = /dev/ttyUSB0</span>
<span class="hljs-comment">#baud = 9600</span>
<span class="hljs-comment">#rootTopic = ab123</span>
<span class="hljs-comment">#broker = tcp://test.mosquitto.org:1883</span>
<span class="hljs-comment">#username = user</span>
<span class="hljs-comment">#password = password</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コメントを外して、パラメーターを変更します。</font><font style="vertical-align: inherit;">パラメーターは次のとおりです。ZigBeeコーディネーター接続ポート、速度、ルートトピック（すべてのデータがその中に含まれます）、MQTTサーバーアドレス、ユーザー名、およびパスワード（サーバーで必要な場合）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、サーバーアドレスのみがローカルのmqttサーバー（Linuxからの標準のmosquitto）に変更されています。</font><font style="vertical-align: inherit;">他のすべてはデフォルトで残されました：</font></font><br>
<pre><code class="bash hljs"><font></font>
port = /dev/ttyUSB0<font></font>
baud = 9600<font></font>
rootTopic = ab123<font></font>
broker = tcp://127.0.0.1:1883<font></font>
username = user<font></font>
password = password<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップの前に、ローカルのmosquitto MQTTサーバーをインストールして実行する必要があります。&nbsp;</font></font><br>
<pre><code class="bash hljs">sudo apt-get install mosquitto</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBMQの発売</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、プログラムを起動できます。</font><font style="vertical-align: inherit;">コーディネーターモジュールを挿入してUSB-UARTコンバーターを接続したら、プログラムを実行します。</font></font><br>
<pre><code class="bash hljs">./dist/xbmq.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトを実行すると、コンソールに次の行が表示されます。</font></font><br>
<pre><code class="bash hljs">INFO - Starting XBMQ gateway ab123/0013A2004154EA46</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に-これはまさにコーディネーターのアドレスです。</font><font style="vertical-align: inherit;">外部MQTTクライアントですべてのトピックをサブスクライブすると、すぐに2つのメッセージが表示されます。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トピックでは</font></font><code>ab123/0013A2004154EA46/online</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-は1になります、これはラストウィルです（これらの「特別な」パラメータが実際にどのように使用されるかの良い例です）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トピックに</font></font><code>ab123/0013A2004154EA46/log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、コンソールですでに見たのと同じデバッグフレーズ「Starting XBMQ gateway ...」が含まれます</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、他の外部XBeeモジュールからメッセージを送信してみます。たとえば、データ送信の例を見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、MQTT.fxプログラムでは、すべてのトピック（＃）をサブスクライブすると、次のように表示されます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/56/5l/hy565luregquqnizlxf7pejdn40.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT.fxプログラムウィンドウ。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
つまり、コーディネーターにメッセージを送信して先に調べた例を実行すると、このテキスト（「send_data_to_coordinator」）が一部として表示されますMQTTパッケージ。私たちの共通の親トピックは、プログラム構成で指定されたもの</font><font style="vertical-align: inherit;">です</font><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ab123</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、独自のものに変更できます）。次に、コーディネーターのアドレス、次にメッセージの送信元のモジュールのアドレスが続きます。最後に、このトピックは発信データであるため、DataOutと呼ばれます。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、MQTTLensであるか、それとも単なる他のMQTTクライアントでも、このような画像が表示されます。</font></font><code>mosquitto_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンソールで。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のいくつかのコメント：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">良い意味で、このプログラムはデーモンモードで動作するはずです。</font><font style="vertical-align: inherit;">このためのxbmqdファイルがあり、READMEにはその使用方法が記載されています。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"></font><code>xbmq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポートを保持</font><font style="vertical-align: inherit;">しているため</font><font style="vertical-align: inherit;">、このプログラムをXCTUと同時に実行することはできません。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、MQTTプロトコルを使用してシステムを操作し、複雑で興味深いプログラムを作成できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/kt/h0/g8kth04siprq-9s2uwlli2fp6ae.jpeg" align="left"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatyana Volkova-モノのインターネットのトレーニングプログラムの著者である、Samsung Research Centerの企業の社会的責任プログラムの専門家である「Samsung IT Academy」</font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja497178/index.html">「1C：ERP」および「1C：CRM」：構成の機能と比較分析</a></li>
<li><a href="../ja497184/index.html">地質学、地球物理学、フィールドデータ管理システムの開発の有望な方向性の考察</a></li>
<li><a href="../ja497186/index.html">コロナウイルス用のワクチンの探索はどうですか</a></li>
<li><a href="../ja497192/index.html">離れた場所からITが機能する方法：分散チームを管理するためのヒント</a></li>
<li><a href="../ja497194/index.html">ティンダーは友達よりあなたの親密な生活についてもっと知っています</a></li>
<li><a href="../ja497204/index.html">Digital 2020：トレンドの修正</a></li>
<li><a href="../ja497206/index.html">オブジェクト指向プログラミングについて</a></li>
<li><a href="../ja497212/index.html">[手順] Googleディスク、Googleサイト、Googleフォームを使用してデータバンクとフィードバックシステムを作成する</a></li>
<li><a href="../ja497214/index.html">データエンジニアとデータサイエンティスト：何ができるか、どれくらい稼げるか</a></li>
<li><a href="../ja497216/index.html">コロナウイルスの流行を作りました</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>