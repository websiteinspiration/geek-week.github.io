<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎊 🤳🏾 🏼 LinuxでのQemu KVMディスクサブシステムの高速化 ▫️ 💱 🛌🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="時々私はサーバーをセットアップするための様々なタスクを引き受けます。少し前に、小さなホスティング会社のオーナーが興味深い問題を抱えて私に近づきました。彼は、Ubuntu 18.04がすでにインストールされているサーバー上のKVMの下でWindows仮想マシンを実行したいと考えています。
 
 ただし...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>LinuxでのQemu KVMディスクサブシステムの高速化</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/493696/"><img src="https://habrastorage.org/webt/gx/ub/i1/gxubi1ucfhq7jujnimizriacaqa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時々私はサーバーをセットアップするための様々なタスクを引き受けます。</font><font style="vertical-align: inherit;">少し前に、小さなホスティング会社のオーナーが興味深い問題を抱えて私に近づきました。</font><font style="vertical-align: inherit;">彼は、Ubuntu 18.04がすでにインストールされているサーバー上のKVMの下でWindows仮想マシンを実行したいと考えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、彼のテストでは、KVMディスクシステムが、Hyper-Vで使用していたインジケーターにかなり遅れていることがわかりました。</font><font style="vertical-align: inherit;">彼は、高価なWindowsサーバーライセンスの購入を回避するために、Ubuntuサーバーでqemuを解放したいと考えていました（Microsoft Hyper-Vサーバーの無料バージョンは、その制限のためにうまくいきませんでした）。</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.処分</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストには、Samsung 970 Pro 1TB SSDを使用しました。</font><font style="vertical-align: inherit;">顧客はCrystalDiskMarkで作業の結果を確認したので、記事のさらにそこからすべてのグラフを確認しました。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 LTSC</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hyper-V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/h_/-8/n1/h_-8n1bwsgaovljitrm1wztowbi.png"></td>
<td><img src="https://habrastorage.org/webt/to/eh/ft/toehft7m0vaghk2a3vdlmkxdwq8.png"></td>
<td><img src="https://habrastorage.org/webt/-i/na/am/-inaamktv9beteru7huusvcktmo.png"></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のステップは、ランダムI / Oパフォーマンスを改善することでした。</font><font style="vertical-align: inherit;">このタイプの負荷は、仮想マシン、特にさまざまなデータベースを使用する仮想マシンで一般的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntu（16.04 LTSおよび18.04）は引き続きqemuバージョン2.11を使用します。</font><font style="vertical-align: inherit;">したがって、最新のqemuバンの一部は、この記事では考慮されていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アイアンを仮想マシンに関連付けないようにする必要があると判断しました。仮想マシンの移植性が複雑になるため、SSD /物理ディスク/パーティションを仮想マシンに投入するオプションは望ましくないと考えられていました。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrystalDiskMarkのテストファイルサイズについて</font></font></b><div class="spoiler_text">   ,          100  4.   ,         :   ,    .<br>
<br>
,        ,  Windows       .    100  4    ,     40  .<br>
<br>
       ,      ,         100-1.         4.<br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.仮想マシンディスクを保存するためのファイルではなく、LVMボリュームを使用します。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
論理はこれです。仮想ディスクを含むファイルはLinuxファイルシステムに格納され、NTFSはファイル自体の中にあります。各ファイルシステムは、ディスク操作中にリソースを消費します。したがって、人形の深さが小さいほど、入力/出力が速くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
qcow2ファイルについて話す場合、その名前は「Qemu Copy-On-Write」を表しており、実際には、どのブロックがビジーでどのブロックがどこになく、どこにあるかを担当する独自の変換テーブルが内部にあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVMレイヤーは、ファイルシステムよりもプロセッサーリソースを大幅に消費しません。これの理由の1つは、その中のブロックが一般的なファイルシステムブロック（4KB）よりもはるかに大きいことです。物理LVMデバイスのブロック（範囲）が大きいほど、IOが速くなり、断片化が少なくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、SSDのランダムであっても、I / Oはシリアルよりもはるかに低速です。したがって、ボリュームグループを作成するときは、256MBという非常に大きな範囲を指定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSD上のWindowsでディスクを最適化している人がいないため、論理ボリュームの先読みは無効にします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVMは、仮想マシンのホスティングに使用すると非常に便利です。 LVMボリュームは物理ディスク間で簡単に移植でき、スナップショットとサイズ変更はオンラインで行えます。さらに、virt-manager（libvirt）は、ボリュームグループから仮想マシンディスク用の箱から出して論理ボリュームを作成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シンボリュームを作成する機能も魅力的に見えますが、シンボリュームが抽象化の追加レイヤーであることを考えると、IOパフォーマンスが低下することは明らかです。</font><font style="vertical-align: inherit;">さらに、libvirtには、シンプール内の仮想マシン用のディスクを自動的に作成する洗練された方法がありません。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#    SSD    (volume group)</span><font></font>
pvcreate /dev/nvme1n1p1<font></font>
<font></font>
<span class="hljs-comment">#    win    (extent) 256.</span><font></font>
vgcreate -s 256M win_pool /dev/nvme1n1p1<font></font>
<font></font>
<span class="hljs-comment">#    vm1.    C</span><font></font>
lvcreate -n vm1 -L 100G win_pool<font></font>
<font></font>
<span class="hljs-comment">#      (read ahead)</span><font></font>
lvchange -r none /dev/win_pool/vm1<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1。</font><font style="vertical-align: inherit;">ディスクとしてのシンボリュームおよび/またはスナップショットの論理ボリューム設定</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シンボリュームを作成するシンプールを使用する場合は、プールのチャンクサイズを4MBに設定することをお勧めします。これは、デフォルトサイズの64KBよりもはるかに大きくなります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、この抽象化レイヤーのより高速な作業を伴います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVMのスナップショットメカニズムはシンボリュームとほぼ同じコードで機能するため、スナップショットの速度を上げるための設定は同じになります。</font></font><br>
<br>
<pre><code class="bash hljs">lvcreate -c 4m -L 300G -T -Zn win_pool/thin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このオプション</font></font><code>-Zn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、強調表示時にチャンクをゼロで上書きする</font><font style="vertical-align: inherit;">ことを</font><font style="vertical-align: inherit;">無効にするため、作業速度が向上します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lvm.confまたは同様のファイル（lvmlocal.confなど）の設定：</font></font><br>
<br>
<pre><code class="bash hljs">thin_pool_chunk_size = 4096<font></font>
thin_pool_zero = n</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドを使用してテストし、値を選択することで、チャンクの最適なサイズを自分で決定できます</font></font><code>--blocksize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">fio --name=randwrite --filename=/dev/nvme0n1p9 --size=10G --ioengine=libaio --iodepth=1 --buffered=0 --direct=1 --rw=randwrite --blocksize=4m</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドを使用して、チャンクの現在のサイズを表示できます。</font></font><br>
<br>
<pre><code class="bash hljs">lvs -ao name,chunksize</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.各KVM仮想マシンに割り当てられる論理プロセッサーの数を増やすと、ディスクのパフォーマンスが向上します</font></font></h4><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 CPU</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/rk/d5/pp/rkd5pphdlwmwx0ykk_mszbtcxjc.png"></td>
<td><img src="https://habrastorage.org/webt/o6/0s/u-/o60su-evqzflfsjh4v0wl7ih8sa.png"></td>
<td><img src="https://habrastorage.org/webt/gv/0x/jf/gv0xjf7ky6xkidam9duclsztowo.png"></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だれもが仮想マシンに10プロセッサを割り当てることはほとんどないことは明らかですが、極端なケースを見るのは興味深いものでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはすでに空きプロセッサの数に依存しています。</font><font style="vertical-align: inherit;">私の意見では、4つ以上を割り当てるのは不便です。</font><font style="vertical-align: inherit;">スレッド数が8の場合、ランダムな読み取りと書き込みのパフォーマンスが最大になります。</font><font style="vertical-align: inherit;">これは、2番目のテストで8つのスレッドを実行するCrystalDiskMark 6.0.2の特性です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこから、IOをアクティブに使用するタスクごとに1つの論理プロセッサを用意するのが良いと結論付けることができます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. RAMの巨大なページ（hugepages）を使用して、RAMの断片化によるパフォーマンスの低下を回避する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このパッケージは、動作中にhugepagesに関するさまざまな情報が必要な場合に役立ちます。</font></font><br>
<br>
<pre><code class="bash hljs">apt install hugepages</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
編集</font></font><code>/etc/default/grub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">GRUB_CMDLINE_LINUX=<span class="hljs-string">"default_hugepagesz=1GB hugepagesz=1G hugepages=64"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、64GBのメモリがすべての仮想マシンにhugepagesとして割り当てられました。</font><font style="vertical-align: inherit;">あなたの場合、より少ない/より多いかもしれません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの設定をGRUBに適用して、次にシステムが起動したときにアクティブになるようにします。</font></font><br>
<br>
<pre><code class="bash hljs">grub-mkconfig -o /boot/grub/grub.cfg
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシン構成の編集：</font></font><br>
<br>
<pre><code class="bash hljs">virsh edit vm_name</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追加：</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">memoryBacking</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">hugepages</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">memoryBacking</span>&gt;</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.各仮想マシンに専用ストリームを追加してIOを提供します</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
太字で強調表示されているものを追加する必要があります。</font></font><code>virsh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の段落と同様に、</font><font style="vertical-align: inherit;">を使用します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><b>&lt;iothreads&gt;1&lt;/iothreads&gt;</b><br>
<br>
&lt;disk type='block' device='disk'&gt;<br>
&lt;driver name='qemu' type='raw' cache='none' io='threads' <b>iothread='1'</b>/&gt;<br>
&lt;source dev='/dev/win/terminal'/&gt;<br>
&lt;target dev='vda' bus='virtio'/&gt;<br>
&lt;boot order='2'/&gt;<br>
&lt;address type='pci' domain='0x0000' bus='0x04' slot='0x00' function='0x0'/&gt;<br>
&lt;/disk&gt;</blockquote><br>
<br>
<h4>4.1.       writeback</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクへの偶発的な書き込みを高速化しますが、データ損失のリスクが高まるため</font></font><code>cache=writeback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、前の段落を</font><font style="vertical-align: inherit;">使用できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">電源の品質とバックアップ、およびバックアップの存在に大きな信頼がある場合にのみ使用できます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Virt Managerのディスクサブシステム設定</font></font></h4><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスクバス：VirtIO </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストレージフォーマット：raw </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュモード：ライトバック</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IOモード：スレッド</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1。</font><font style="vertical-align: inherit;">構成ファイルによるディスクサブシステムの構成</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qemu 2.11（Ubuntuで現在使用されています）は、virtio-blkとvirtio-scsiの2種類のディスク仮想デバイスをサポートしています。</font><font style="vertical-align: inherit;">Virt Manager </font></font><code>Disk bus: VirtIO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">指定されている場合</font><font style="vertical-align: inherit;">、これはvirtio-blkデバイスを使用することを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストされたqemuバージョンでは、virtio-scsiとは異なり、virtio-blkの方がまだTRIMをサポートしていません（バージョン5.x以降は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既にサポートし</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">います</font></a><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクIO速度の観点から見ると、virtio-scsiは、たとえば何百ものディスクを仮想マシンに接続する必要があるような、特殊なケースでのみ意味があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Windowsのインストール中に、VirtIOドライバーをインストールします。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そうしないと、ディスクがOSで使用できなくなります。</font><font style="vertical-align: inherit;">これを行うには、仮想マシンに事前に接続したドライバーイメージを使用します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.すべての調整を適用した後の結果</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、クライアントからの電源供給の信頼性がわからなかったため、調整4.1は使用されませんでした。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hyper-V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 CPU</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/to/eh/ft/toehft7m0vaghk2a3vdlmkxdwq8.png"></td>
<td><img src="https://habrastorage.org/webt/4a/la/5s/4ala5snjmars3uaepsbb63lcgqm.png"></td>
<td><img src="https://habrastorage.org/webt/fu/tt/0k/futt0kedtld37khc96igkyks1zq.png"></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CrystalDiskMarkを起動するたびに値が少し異なるため、これらの結果には一定の規則があることを理解する必要があります。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すぐに使える</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU</font></font></th>
<th><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 CPU </font><font style="vertical-align: inherit;">を調整した後のKVM</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/-i/na/am/-inaamktv9beteru7huusvcktmo.png"></td>
<td><img src="https://habrastorage.org/webt/4a/la/5s/4ala5snjmars3uaepsbb63lcgqm.png"></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じコア数のqemu（kvm）でディスクサブシステムの処理を大幅に高速化できることがわかります。</font><font style="vertical-align: inherit;">書き込みは平均58％、読み取りは25％高速化されました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主な成功要素</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：qcow2ファイルの代わりにLVMボリュームを使用し、個別のI / O、およびhugepages。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知されたエラーをPMに送信します。</font><font style="vertical-align: inherit;">このためにカルマを増やします。</font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS vhost-user-blkおよびvhost-user-nvme</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実験中に、Qemu 2.12およびバージョン3もコンパイルされました。</font><font style="vertical-align: inherit;">ディスクのvhost-user-blkオプションがテストされました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局、virtio-blkよりもうまくいきませんでした。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vhost-user-blk </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 CPU</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">virtio-blk </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 CPU</font></font></th>
</tr>
<tr>
<td><img src="https://habrastorage.org/webt/x_/zw/04/x_zw04o-k8gq4so3yvyp66ddyga.png"></td>
<td><img src="https://habrastorage.org/webt/fu/tt/0k/futt0kedtld37khc96igkyks1zq.png"></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vhost-user-nvmeを使用するには、qemuにパッチを適用する必要がありました。このオプションは、運用中のサーバーの自動更新を複雑にするため、テストされていません。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS SPDK</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intelは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このフレームワーク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">設計</font><font style="vertical-align: inherit;">して、プロセッサーで実行する必要のある仮想マシンのディスクシステムの卓越したパフォーマンスインジケーターを実現しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
spdkを適切に機能させるために、彼らは多くのトリックを実行します-彼らはそれに個別のカーネルを割り当て、spdkと仮想マシンのカーネルを1つのソケットに配置します。仮想マシンを連続したメモリのチャンクにロードします。このような対策を通常のvirtio-blkに適用すると、動作も速くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SPDKは、vhost-user-scsi、vhost-user-blk、vhost-user-nvmeの3つのモードで機能します。 2番目のモードは、2.12以降のqemuでのみ使用できます。ubuntuではまだ使用できません。 vhost-user-nvmeモードは通常、大規模な実験です-そのためにはqemuにパッチを適用する必要があります。現在、scsiエミュレーションのみが機能し、低速です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vhost-user-scsiモードにはもう1つの重大な制限があります-spdkは起動できません。</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bootindex = 2 Qemuオプションがvhost-user-scsi-pciデバイスに指定されていることを確認してください。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レコードは、ドライバーを使用して複数のデバイスでSSDを共有し、vhost-user-nvmeとして転送するときに設定されます。</font><font style="vertical-align: inherit;">鉄を突き刺すアプローチは私たちには合わなかった。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
論理ディスクの実装（標準のlvmとは完全に異なる）でのみSPDKを使用するのが普通であるという印象でした。</font><font style="vertical-align: inherit;">これは、その写真と複製を備えたそのような自作の自転車です。</font><font style="vertical-align: inherit;">チームはすべてLVMとは異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SPDKの構成、仮想マシンのサポートと移植性、およびIntelプロセッサーへの接続の難しさは、その使用から遠ざかっていました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">謝辞</font></font></h4><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TripletConceptをありがとう</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">別のウィンドウでフルサイズで見ることをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作業資料の共有許可について-</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">st_neon</font></font></a></i><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下のクーポンの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUVDS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
からSSDを搭載した仮想マシンを注文でき</font><font style="vertical-align: inherit;">ます。</font><b><i><font style="vertical-align: inherit;">通知されたエラーをPMに送信します。</font></i></b><b><i><font style="vertical-align: inherit;">このためにカルマを増やします。</font></i></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a><br>
<br>
<b><i><font style="vertical-align: inherit;"></font></i></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja493682/index.html">長期投資の選び方：ウォーレンバフェットのポートフォリオから6株</a></li>
<li><a href="../ja493686/index.html">コードMastermindのハッキングに関するボードゲームの神秘的な起源</a></li>
<li><a href="../ja493688/index.html">私たちはMicrosoft Teamsを無料にします-この困難な時期に同僚と連絡を取り合う</a></li>
<li><a href="../ja493690/index.html">ドローンをクラッシュや紛失から保護するためのパイロットDJI Mavic Miniの20のヒント</a></li>
<li><a href="../ja493692/index.html">JavaScriptでの理論的なデータ構造とそのアプリケーション。P1。カップル</a></li>
<li><a href="../ja493700/index.html">Azureでマルウェアを使用してMicrosoft 365テナントにアクセスする</a></li>
<li><a href="../ja493702/index.html">リモートワークへの大規模な移行：技術的な問題とセキュリティに対する脅威</a></li>
<li><a href="../ja493704/index.html">TypeScriptを記述せずにJavaScriptでTypeScriptを使用する</a></li>
<li><a href="../ja493706/index.html">敵を知る：Node.jsバックドアを作成する</a></li>
<li><a href="../ja493708/index.html">私のホームKubernetesクラスターの構造</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>