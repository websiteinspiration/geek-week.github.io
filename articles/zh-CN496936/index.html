<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¸ ğŸ¤²ğŸ¾ ğŸ‘¨â€ğŸš’ è®©æˆ‘ä»¬åœ¨Kubernetesä¸­ä½¿ç”¨cert-manageråŠ å¯†SSLè¯ä¹¦ ğŸ‘©ğŸ¾â€ğŸ¤ ğŸ¦ ğŸ¡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨é™„åŠ çš„cert-managerè‡ªåŠ¨åŒ–ï¼ˆä¸ä»…é™äºï¼‰Kubernetesä¸­çš„Let's Encryptçš„è¯ä¹¦æ’åºå’Œæ›´æ–°ï¼ˆä¸ä»…å¦‚æ­¤ï¼‰ã€‚ä½†æ˜¯ï¼Œæˆ‘å°†é¦–å…ˆç®€è¦ä»‹ç»é—®é¢˜çš„å®è´¨ã€‚
 
 ä¸€ç‚¹æ•™è‚²è®¡åˆ’
 HTTPåè®®æ˜¯ä¸Šä¸–çºª90å¹´ä»£åˆæœŸå¼€å‘çš„ï¼Œå®ƒç´§å¯†åœ°è¿›å…¥äº†æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ï¼Œå¾ˆéš¾æƒ³è±¡è‡³å°‘ä¸€å¤©æ²¡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>è®©æˆ‘ä»¬åœ¨Kubernetesä¸­ä½¿ç”¨cert-manageråŠ å¯†SSLè¯ä¹¦</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/496936/"><img src="https://habrastorage.org/webt/la/qd/o7/laqdo7i6ovirl5ciie_qmnbrau4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨é™„åŠ çš„cert-managerè‡ªåŠ¨åŒ–ï¼ˆä¸ä»…é™äºï¼‰Kubernetesä¸­çš„Let's Encryptçš„è¯ä¹¦æ’åºå’Œæ›´æ–°ï¼ˆä¸ä»…å¦‚æ­¤ï¼‰ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘å°†é¦–å…ˆç®€è¦ä»‹ç»é—®é¢˜çš„å®è´¨ã€‚</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ç‚¹æ•™è‚²è®¡åˆ’</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTPåè®®æ˜¯ä¸Šä¸–çºª90å¹´ä»£åˆæœŸå¼€å‘çš„ï¼Œå®ƒç´§å¯†åœ°è¿›å…¥äº†æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ï¼Œå¾ˆéš¾æƒ³è±¡è‡³å°‘ä¸€å¤©æ²¡æœ‰ä½¿ç”¨å®ƒã€‚ä½†æ˜¯ï¼Œå°±å…¶æœ¬èº«è€Œè¨€ï¼Œå½“åœ¨ç”¨æˆ·å’ŒWebæœåŠ¡å™¨ä¹‹é—´äº¤æ¢ä¿¡æ¯æ—¶ï¼Œå®ƒç”šè‡³ä¸æä¾›æœ€ä½çº§åˆ«çš„å®‰å…¨æ€§ã€‚ HTTPSï¼ˆâ€œ Sâ€-å®‰å…¨ï¼‰å¯åŠ©æ‚¨ä¸€è‡‚ä¹‹åŠ›ï¼šé€šè¿‡ä½¿ç”¨SSL / TLSä¸­ä¼ è¾“çš„æ•°æ®æ‰“åŒ…ï¼Œè¯¥åè®®å·²è¯æ˜å¯ä»¥ä¿æŠ¤ä¿¡æ¯å…é­æ‹¦æˆªï¼Œå¹¶å¾—åˆ°ä¸šç•Œçš„ç§¯ææ¨å¹¿ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼ŒGoogle </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://security.googleblog.com/2014/08/"><font style="vertical-align: inherit;">åšæŒ</font></a><font style="vertical-align: inherit;"> 2014å¹´</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://security.googleblog.com/2014/08/"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œæ— å¤„ä¸åœ¨çš„HTTPSâ€ä½ç½®ç”šè‡³é™ä½äº†ç½‘ç«™çš„ä¼˜å…ˆçº§ï¼Œè€Œæ²¡æœ‰åœ¨æœç´¢ç»“æœä¸­æ˜¾ç¤ºå®ƒã€‚è¿™ç§â€œå®£ä¼ â€ä¹Ÿä¸ä¼šç»•è¿‡æ™®é€šæ¶ˆè´¹è€…ï¼šç°ä»£æµè§ˆå™¨ä¼šè­¦å‘Šå…¶ç”¨æˆ·æœ‰å…³æ‰€è®¿é—®ç«™ç‚¹çš„SSLè¯ä¹¦çš„å­˜åœ¨å’Œæ­£ç¡®æ€§ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sr/me/il/srmeilomqktrr7qofwjlgpiw01i.png"><br>
<img src="https://habrastorage.org/webt/mj/jo/pf/mjjopfpjvy84bnbdae_mv6vluw8.png"><br>
<img src="https://habrastorage.org/webt/dd/t4/vn/ddt4vnh-3yseofqyzip5qma-dti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ªäººç«™ç‚¹è¯ä¹¦çš„è´¹ç”¨ä»å‡ åç¾å…ƒå¼€å§‹ã€‚å¹¶éæ€»æ˜¯è´­ä¹°å®ƒæ˜¯åˆç†ä¸”é€‚å½“çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œè‡ª2015å¹´åº•ä»¥æ¥ï¼Œæˆ‘ä»¬æä¾›äº†å…è´¹çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå½¢å¼ä¸º</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's Encrypt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆLEï¼‰</font><font style="vertical-align: inherit;">è¯ä¹¦</font><font style="vertical-align: inherit;">ã€‚è¿™ä¸ªéè¥åˆ©é¡¹ç›®æ˜¯ç”±Mozillaçˆ±å¥½è€…åˆ›å»ºçš„ï¼Œç›®çš„æ˜¯é€šè¿‡åŠ å¯†è¦†ç›–å¤§å¤šæ•°ç½‘ç«™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯ä¹¦é¢å‘æœºæ„é¢å‘</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">åŸŸéªŒè¯çš„</font></a><font style="vertical-align: inherit;">è¯ä¹¦</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå¸‚åœºä¸Šæœ€ç®€å•çš„ï¼‰æœ‰æ•ˆæœŸä¸º90å¤©ï¼Œå¹¶ä¸”å¤šå¹´æ¥ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­åŸŸé¢å‘æ‰€è°“çš„é€šé…ç¬¦è¯ä¹¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†è·å¾—è¯ä¹¦ï¼Œè¯¥ç«™ç‚¹ä½¿ç”¨</font><font style="vertical-align: inherit;">ä¸“é—¨ä¸ºLet's Encryptåˆ›å»º</font><font style="vertical-align: inherit;">çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªåŠ¨è¯ä¹¦ç®¡ç†ç¯å¢ƒ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆACMEï¼‰</font><font style="vertical-align: inherit;">åè®®ä¸­æè¿°çš„ç®—æ³•</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨å®ƒæ—¶ï¼Œå°†é€šè¿‡æ”¾ç½®ç‰¹å®šçš„HTTPä»£ç ï¼ˆç§°ä¸º</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP-01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰æˆ–å®‰è£…DNSè®°å½•</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆDNS-01ï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥é€šè¿‡è¯·æ±‚è¿›è¡ŒåŸŸæ‰€æœ‰æƒç¡®è®¤</font><font style="vertical-align: inherit;">-æœ‰å…³å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ä¸‹æ–‡ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¤è¯ç»ç†</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cert-manager</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯Kubernetesçš„ä¸€ä¸ªç‰¹æ®Šé¡¹ç›®ï¼Œå®ƒæ˜¯</font><font style="vertical-align: inherit;">CAé…ç½®ï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰å’Œè¯ä¹¦ç›´æ¥è®¢è´­çš„</font><font style="vertical-align: inherit;">ä¸€ç»„CustomResourceDefinitionsï¼ˆå› æ­¤ï¼Œ</font><font style="vertical-align: inherit;">å¯¹K8sæœ€ä½æ”¯æŒç‰ˆæœ¬</font><font style="vertical-align: inherit;">çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™åˆ¶</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -v1.12ï¼‰ã€‚</font><font style="vertical-align: inherit;">åœ¨é›†ç¾¤ä¸­å®‰è£…CRDæ˜¯å¾®ä¸è¶³é“ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½’ç»“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ä½¿ç”¨ä¸€ä¸ªYAMLæ–‡ä»¶ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl create ns cert-manager<font></font>
kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.13.0/cert-manager.yaml</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¿˜ç”¨å¤´ç›”å®‰è£…çš„å¯èƒ½ï¼‰</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è¦å¯åŠ¨é¡ºåºè¿‡ç¨‹ä¸­ï¼Œè¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„èµ„æºå¿…é¡»åœ¨é›†ç¾¤ä¸­å£°æ˜ï¼š</font></font><code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ–è€…</font></font><code>ClusterIssuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ -è¿™æ˜¯ç”¨æ¥ç­¾ç½²CSRï¼ˆè¯ä¹¦ç­¾å‘è¯·æ±‚ï¼‰ã€‚</font><font style="vertical-align: inherit;">ç¬¬ä¸€ç§èµ„æºå’Œç¬¬äºŒç§èµ„æºçš„åŒºåˆ«åœ¨äºèŒƒå›´ï¼š</font></font><br>
<br>
<ul>
<li> <code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯ä»¥åœ¨åŒä¸€ä¸ªåç§°ç©ºé—´ä¸­ä½¿ç”¨</font></font></li>
<li> <code>ClusterIssuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ˜¯å…¨å±€ç¾¤é›†å¯¹è±¡ã€‚</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸è¯ä¹¦ç»ç†ä¸€èµ·ç»ƒä¹ </font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1å· </font><font style="vertical-align: inherit;">è‡ªç­¾åè¯ä¹¦</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„æƒ…å†µå¼€å§‹-è®¢è´­è‡ªç­¾åè¯ä¹¦ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå¯¹äºå¼€å‘äººå‘˜çš„åŠ¨æ€æµ‹è¯•ç¯å¢ƒæˆ–åœ¨ä½¿ç”¨ç»ˆæ­¢SSLæµé‡çš„å¤–éƒ¨å¹³è¡¡å™¨çš„æƒ…å†µä¸‹ï¼Œæ­¤é€‰é¡¹éå¸¸å¸¸è§ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥èµ„æº</font></font><code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: cert-manager.io/v1alpha2<font></font>
kind: Issuer<font></font>
metadata:<font></font>
  name: selfsigned<font></font>
spec:<font></font>
  selfSigned: {}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†é¢å‘è¯ä¹¦ï¼Œæœ‰å¿…è¦æè¿°èµ„æº</font></font><code>Certificate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ŒæŒ‡ç¤ºå¦‚ä½•é¢å‘</font><font style="vertical-align: inherit;">èµ„æº</font><font style="vertical-align: inherit;">ï¼ˆè¯·å‚é˜…ä»¥ä¸‹éƒ¨åˆ†</font></font><code>issuerRef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ä»¥åŠç§é’¥ï¼ˆå­—æ®µ</font></font><code>secretName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰æ‰€åœ¨çš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">ä¹‹åï¼ŒIngresså°†éœ€è¦å¼•ç”¨æ­¤å¯†é’¥ï¼ˆè¯·å‚é˜…</font></font><code>tls</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font><font style="vertical-align: inherit;">éƒ¨åˆ†</font></font><code>spec</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
apiVersion: cert-manager.io/v1alpha2<font></font>
kind: Certificate<font></font>
metadata:<font></font>
  name: selfsigned-crt<font></font>
spec:<font></font>
  secretName: tls-secret<font></font>
  issuerRef:<font></font>
    kind: Issuer<font></font>
    name: selfsigned<font></font>
  commonName: "yet-another.website"<font></font>
  dnsNames:<font></font>
  - "yet-another.website"<font></font>
---<font></font>
apiVersion: networking.k8s.io/v1beta1<font></font>
kind: Ingress<font></font>
metadata:<font></font>
  name: app<font></font>
spec:<font></font>
  tls:<font></font>
  - hosts:<font></font>
    - "yet-another.website"<font></font>
    secretName: tls-secret<font></font>
  rules:<font></font>
  - host: "yet-another.website"<font></font>
    http:<font></font>
      paths:<font></font>
      - path: /<font></font>
        backend:<font></font>
          serviceName: app<font></font>
          servicePort: 8080</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†è¿™äº›èµ„æºæ·»åŠ åˆ°ç¾¤é›†åå‡ ç§’é’Ÿï¼Œå°†é¢å‘è¯ä¹¦ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥åœ¨å‘½ä»¤çš„è¾“å‡ºä¸­çœ‹åˆ°ç›¸åº”çš„æŠ¥å‘Šï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">kubectl -n app describe  certificate selfsigned-crt<font></font>
...<font></font>
  Normal  GeneratedKey  5s    cert-manager  Generated a new private key<font></font>
  Normal  Requested     5s    cert-manager  Created new CertificateRequest resource "selfsigned-crt-4198958557"<font></font>
  Normal  Issued        5s    cert-manager  Certificate issued successfully</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨æŸ¥çœ‹ç§˜å¯†èµ„æºæœ¬èº«ï¼Œé‚£ä¹ˆå®ƒåŒ…å«ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§é’¥</font></font><code>tls.key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¹è¯ä¹¦</font></font><code>ca.crt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çš„è‡ªç­¾åè¯ä¹¦</font></font><code>tls.crt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><code>openssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œ</font><font style="vertical-align: inherit;">
å¯ä»¥ä½¿ç”¨å®ç”¨ç¨‹åº</font><font style="vertical-align: inherit;">æŸ¥çœ‹</font><font style="vertical-align: inherit;">è¿™äº›æ–‡ä»¶çš„å†…å®¹</font><font style="vertical-align: inherit;">ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app get secret tls-secret -ojson | jq -r <span class="hljs-string">'.data."tls.crt"'</span> | base64 -d | openssl x509 -dates -noout -issuer<font></font>
notBefore=Feb 10 21:01:59 2020 GMT<font></font>
notAfter=May 10 21:01:59 2020 GMT<font></font>
issuer=O = cert-manager, CN = yet-another.website</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ­¤è¯ä¹¦é¢å‘çš„è¯ä¹¦</font><b><font style="vertical-align: inherit;">å°†ä¸ä¼šè¢«</font></b></font><code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿æ¥çš„å®¢æˆ·ç«¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿¡ä»»</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åŸå› å¾ˆç®€å•ï¼šå®ƒæ²¡æœ‰CA </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆè¯·å‚é˜…</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¡¹ç›®ç½‘ç«™ä¸Šçš„æ³¨é‡Š</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œæ‚¨éœ€è¦</font></font><code>Certificate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç§˜å¯†æ–‡ä»¶</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">è·¯å¾„ä¸­</font><font style="vertical-align: inherit;">æŒ‡å®š</font><font style="vertical-align: inherit;">å…¶æ‰€åœ¨ä½ç½®</font></font><code>ca.crt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥æ˜¯å…¬å¸çš„CAç»„ç»‡-ç”¨å·²ç”¨äºå…¶ä»–æœåŠ¡å™¨æœåŠ¡/ä¿¡æ¯ç³»ç»Ÿéœ€æ±‚çš„å¯†é’¥æ¥ç­¾ç½²ä¸ºIngressé¢å‘çš„è¯ä¹¦ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2å· </font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä½¿ç”¨HTTPéªŒè¯åŠ å¯†è¯ä¹¦</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚å‰æ‰€è¿°ï¼Œè¦é¢å‘LEè¯ä¹¦ï¼Œå¯ä»¥ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¤ç§ç±»å‹çš„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸŸæ‰€æœ‰æƒ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ç¡®è®¤</font></a><font style="vertical-align: inherit;">ï¼šHTTP-01å’ŒDNS-01ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬ä¸€ç§æ–¹æ³•ï¼ˆHTTP-01ï¼‰</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://cert-manager.io/docs/configuration/acme/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯åŠ¨å…·æœ‰å•ç‹¬éƒ¨ç½²çš„å°å‹WebæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å°†é€šè¿‡é“¾æ¥</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;YOUR_DOMAIN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; / </font><font style="vertical-align: inherit;">å‘é€åˆ°Internet </font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ­¤æ–¹æ³•æ„å‘³ç€å¯ä»¥ä»ç«¯å£80å¤–éƒ¨è®¿é—®Ingressï¼Œå¹¶ä¸”å°†åŸŸçš„DNSè®°å½•è§£æä¸ºå…¬å…±IPåœ°å€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
éªŒè¯å·²é¢å‘è¯ä¹¦ï¼ˆDNS-01ï¼‰çš„ç¬¬äºŒä¸ªé€‰é¡¹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥è‡ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»æ‹¥æœ‰APIåˆ°æ‰˜ç®¡åŸŸè®°å½•çš„DNSæœåŠ¡å™¨ã€‚å‘è¡Œè€…ä½¿ç”¨æŒ‡ç¤ºçš„ä»¤ç‰Œåœ¨åŸŸä¸Šåˆ›å»ºTXTè®°å½•ï¼Œç„¶åACMEæœåŠ¡å™¨åœ¨ç¡®è®¤æœŸé—´å°†å…¶æ¥æ”¶ã€‚æ­£å¼å—æ”¯æŒçš„DNSæä¾›å•†åŒ…æ‹¬CloudFlareï¼ŒAWS Route53ï¼ŒGoogle CloudDNSå’Œå…¶ä»–æä¾›å•†ï¼ŒåŒ…æ‹¬å…¶è‡ªå·±çš„å®ç°ï¼ˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acme-dns</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šâ€œè®©æˆ‘ä»¬åŠ å¯†â€ </font><font style="vertical-align: inherit;">å¯¹ACMEæœåŠ¡å™¨çš„è¯·æ±‚</font><font style="vertical-align: inherit;">æœ‰ç›¸å½“</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¥æ ¼çš„é™åˆ¶</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ä¸ºäº†é¿å…é•¿æ—¶é—´ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">letsencrypt-staging</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯ä¹¦ç±»å‹è¿›è¡Œè°ƒè¯•</font><font style="vertical-align: inherit;">ï¼ˆåŒºåˆ«ä»…åœ¨äºACMEæœåŠ¡å™¨ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæˆ‘ä»¬æè¿°èµ„æºï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: cert-manager.io/v1alpha2<font></font>
kind: Issuer<font></font>
metadata:<font></font>
  name: letsencrypt<font></font>
spec:<font></font>
  acme:<font></font>
    server: https://acme-staging-v02.api.letsencrypt.org/directory <font></font>
    privateKeySecretRef:<font></font>
      name: letsencrypt<font></font>
    solvers:<font></font>
    - http01:<font></font>
       ingress:<font></font>
         class: nginx<font></font>
---<font></font>
apiVersion: cert-manager.io/v1alpha2<font></font>
kind: Certificate<font></font>
metadata:<font></font>
  name: le-crt<font></font>
spec:<font></font>
  secretName: tls-secret<font></font>
  issuerRef:<font></font>
    kind: Issuer<font></font>
    name: letsencrypt<font></font>
  commonName: yet-another.website<font></font>
  dnsNames:<font></font>
  - yet-another.website</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯·æ³¨æ„ï¼Œ</font><b><font style="vertical-align: inherit;">ç™»å°</font></b><font style="vertical-align: inherit;">æœåŠ¡å™¨</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">åœ°å€æŒ‡å®š</font><font style="vertical-align: inherit;">ä¸º</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>acme</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆc </font></font><code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç¨åå°†å®ƒæ›¿æ¢ä¸ºæˆ˜æ–—ã€‚</font><font style="vertical-align: inherit;">
åº”ç”¨æ­¤é…ç½®ï¼Œæˆ‘ä»¬è·Ÿè¸ªæ•´ä¸ªè®¢å•è·¯å¾„ï¼š</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›ä½œ</font></font><code>Certificate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚¬ç”Ÿäº†æ–°èµ„æº</font></font><code>CertificateRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app describe certificate le-crt<font></font>
...<font></font>
Created new CertificateRequest resource <span class="hljs-string">"le-crt-1127528680"</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä»–çš„æè¿°ä¸­-åˆ›ä½œçš„æ ‡è®°</font></font><code>Order</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app describe certificaterequests le-crt-1127528680<font></font>
â€¦<font></font>
Created Order resource app/le-crt-1127528680-1805948596</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒ</font></font><code>Order</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æè¿°äº†æµ‹è¯•é€šè¿‡çš„å‚æ•°ä»¥åŠå½“å‰çš„çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">æ­¤ç±»éªŒè¯ç”±èµ„æºæ‰§è¡Œ</font></font><code>Challenge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app describe order le-crt-1127528680-1805948596<font></font>
â€¦<font></font>
Created Challenge resource <span class="hljs-string">"le-crt-1127528680-1805948596-1231544594"</span> <span class="hljs-keyword">for</span> domain <span class="hljs-string">"yet-another.website"</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€åï¼Œæ­¤èµ„æºçš„è¯¦ç»†ä¿¡æ¯åŒ…å«æœ‰å…³æ‰«ææœ¬èº«çŠ¶æ€çš„ä¿¡æ¯ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app describe challenges le-crt-1127528680-1805948596-1231544594<font></font>
...<font></font>
  Reason:      Successfully authorized domain                                                                                                                                                                      <font></font>
...<font></font>
  Normal  Started         2m45s  cert-manager  Challenge scheduled <span class="hljs-keyword">for</span> processing<font></font>
  Normal  Presented       2m45s  cert-manager  Presented challenge using http-01 challenge mechanism<font></font>
  Normal  DomainVerified  2m22s  cert-manager  Domain <span class="hljs-string">"yet-another.website"</span> verified with <span class="hljs-string">"http-01"</span> validation</code></pre></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼ˆå³ï¼Œå¯ä»¥ä»å¤–éƒ¨è®¿é—®è¯¥åŸŸï¼Œåˆ™LEæ²¡æœ‰ç¦ä»¤...ï¼‰-åœ¨ä¸åˆ°ä¸€åˆ†é’Ÿçš„æ—¶é—´å†…ï¼Œå°†é¢å‘è¯ä¹¦ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆåŠŸï¼Œ</font></font><code>describe certificate le-crt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®°å½•å°†å‡ºç°</font><font style="vertical-align: inherit;">åœ¨è¾“å‡ºä¸­</font></font><code>Certificate issued successfully</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°æ›´æ”¹æœåŠ¡å™¨åœ°å€ä»¥è¿›è¡Œæˆ˜æ–—ï¼ˆ</font></font><code>https://acme-v02.api.letsencrypt.org/directory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰å¹¶é‡æ–°æ’åºå·²ç­¾ånot </font></font><code>Fake LE Intermediate X1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€Œæ˜¯</font><font style="vertical-align: inherit;">çš„çœŸå®è¯ä¹¦</font></font><code>Let's Encrypt Authority X3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºæ­¤ï¼Œæ‚¨é¦–å…ˆéœ€è¦åˆ é™¤èµ„æº</font></font><code>Certificate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¦åˆ™ï¼Œä¸ä¼šæ¿€æ´»ä»»ä½•è®¢è´­è¿‡ç¨‹ï¼Œå› ä¸ºè¯ä¹¦å·²ç»å­˜åœ¨å¹¶ä¸”ç›¸å…³ã€‚</font><font style="vertical-align: inherit;">åˆ é™¤æœºå¯†å°†å¯¼è‡´å…¶ç«‹å³è¿”å›å¹¶æ˜¾ç¤ºä»¥ä¸‹æ¶ˆæ¯</font></font><code>describe certificate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">  Normal  PrivateKeyLost  44s                   cert-manager  Lost private key for CertificateRequest "le-crt-613810377", deleting old resource</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»éœ€å¯¹</font></font><code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šè¿°å·²ç»</font><font style="vertical-align: inherit;">ä½¿ç”¨è¿‡çš„â€œæˆ˜æ–—â€å®£è¨€</font></font><code>Certificate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå®ƒæ²¡æœ‰æ”¹å˜ï¼‰ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: cert-manager.io/v1alpha2<font></font>
kind: Issuer<font></font>
metadata:<font></font>
  name: letsencrypt<font></font>
spec:<font></font>
  acme:<font></font>
    server: https://acme-v02.api.letsencrypt.org/directory<font></font>
    privateKeySecretRef:<font></font>
      name: letsencrypt<font></font>
    solvers:<font></font>
    - http01:<font></font>
       ingress:<font></font>
         class: nginx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ”¶åˆ°æ¶ˆæ¯å</font></font><code>Certificate issued successfully</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>describe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥å®ƒï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app get secret tls-secret -ojson | jq -r <span class="hljs-string">'.data."tls.crt"'</span> | base64 -d | openssl x509 -dates -noout -issuer<font></font>
notBefore=Feb 10 21:11:48 2020 GMT<font></font>
notAfter=May 10 21:11:48 2020 GMT<font></font>
issuer=C = US, O = Let<span class="hljs-string">'s Encrypt, CN = Let'</span>s Encrypt Authority X3</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3å· </font><font style="vertical-align: inherit;">å¸¦DNSéªŒè¯çš„é€šé…ç¬¦LE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡å°†è¯ä¹¦ç«‹å³å†™åˆ°ç«™ç‚¹çš„æ‰€æœ‰å­åŸŸï¼Œç„¶åä½¿ç”¨DNSæ£€æŸ¥ï¼ˆé€šè¿‡CloudFlareï¼‰ï¼Œæˆ‘ä»¬å°†ä½¿ä»»åŠ¡å¤æ‚åŒ–ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œåœ¨CloudFlareæ§åˆ¶é¢æ¿ä¸­è·å–ä»¤ç‰Œä»¥é€šè¿‡APIå·¥ä½œï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é…ç½®æ–‡ä»¶â†’APIä»¤ç‰Œâ†’åˆ›å»ºä»¤ç‰Œã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è®¾ç½®æƒé™å¦‚ä¸‹ï¼š</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æƒé™ï¼š</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒºåŸŸ-DNS-ç¼–è¾‘</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒºåŸŸ-åŒºåŸŸ-è¯»å–</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒºåŸŸèµ„æºï¼š</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…æ‹¬-æ‰€æœ‰åŒºåŸŸ</font></font></li>
</ul></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤åˆ¶ä¿å­˜åæ”¶åˆ°çš„ä»¤ç‰Œï¼ˆä¾‹å¦‚ï¼šï¼‰</font></font><code>y_JNkgQwkroIsflbbYqYmBooyspN6BskXZpsiH4M</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸€ä¸ªå°†å­˜å‚¨æ­¤ä»¤ç‰Œçš„å¯†é’¥ï¼Œå¹¶åœ¨å‘è¡Œè€…ä¸­å¼•ç”¨å®ƒï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Secret<font></font>
metadata:<font></font>
  name: cloudflare-api-token<font></font>
type: Opaque<font></font>
stringData:<font></font>
  api-token: y_JNkgQwkroIsflbbYqYmBooyspN6BskXZpsiH4M<font></font>
---<font></font>
apiVersion: cert-manager.io/v1alpha2<font></font>
kind: Issuer<font></font>
metadata:<font></font>
  name: letsencrypt<font></font>
spec:<font></font>
  acme:<font></font>
    server: https://acme-v02.api.letsencrypt.org/directory <font></font>
    privateKeySecretRef:<font></font>
      name: letsencrypt<font></font>
    solvers:<font></font>
    - dns01:<font></font>
        cloudflare:<font></font>
          email: my-cloudflare-acc@example.com<font></font>
          apiTokenSecretRef:<font></font>
            name: cloudflare-api-token<font></font>
            key: api-token<font></font>
<font></font>
---<font></font>
apiVersion: cert-manager.io/v1alpha2<font></font>
kind: Certificate<font></font>
metadata:<font></font>
  name: le-crt<font></font>
spec:<font></font>
  secretName: tls-secret<font></font>
  issuerRef:<font></font>
    kind: Issuer<font></font>
    name: letsencrypt<font></font>
  commonName: yet-another.website<font></font>
  dnsNames:<font></font>
  - "yet-another.website"<font></font>
  - "*.yet-another.website"</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå¦‚æœæ‚¨æ­£åœ¨å°è¯•ï¼Œè¯·ä¸è¦å¿˜è®°ä½¿ç”¨æš‚å­˜ï¼ï¼‰</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è®©æˆ‘ä»¬å®Œæˆç¡®è®¤åŸŸæ‰€æœ‰æƒçš„è¿‡ç¨‹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app describe challenges.acme.cert-manager.io le-crt-613810377-1285319347-3806582233<font></font>
...<font></font>
Status:<font></font>
  Presented:   <span class="hljs-literal">true</span>
  Processing:  <span class="hljs-literal">true</span>
  Reason:      Waiting <span class="hljs-keyword">for</span> dns-01 challenge propagation: DNS record <span class="hljs-keyword">for</span> <span class="hljs-string">"yet-another.website"</span> not yet propagated<font></font>
  State:       pending<font></font>
Events:<font></font>
  Type    Reason     Age   From          Message<font></font>
  ----    ------     ----  ----          -------<font></font>
  Normal  Started    54s   cert-manager  Challenge scheduled <span class="hljs-keyword">for</span> processing<font></font>
  Normal  Presented  53s   cert-manager  Presented challenge using dns-01 challenge mechanism</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TXTè®°å½•å°†å‡ºç°åœ¨é¢æ¿ä¸­ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/hk/jc/pohkjc19ui1olxdlfeaiuuqm3ne.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...ï¼Œä¸ä¹…åçŠ¶æ€å°†å˜ä¸ºï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">Domain "yet-another.website" verified with "dns-01" validation</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¡®ä¿è¯ä¹¦å¯¹ä»»ä½•å­åŸŸå‡æœ‰æ•ˆï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app get secret tls-secret -ojson | jq -r <span class="hljs-string">'.data."tls.crt"'</span> | base64 -d | openssl x509 -dates -noout -text |grep DNS:<font></font>
          DNS:*.yet-another.website, DNS:yet-another.website</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šå¸¸ï¼Œé€šè¿‡DNSè¿›è¡ŒéªŒè¯ä¸ä¼šå¾ˆå¿«è¿›è¡Œï¼Œå› ä¸ºå¤§å¤šæ•°DNSä¾›åº”å•†éƒ½æœ‰ä¸€ä¸ªæ•°æ®æ›´æ–°å‘¨æœŸï¼Œè¯¥æ•°æ®æ›´æ–°å‘¨æœŸæ˜¾ç¤ºä»DNSè®°å½•æ›´æ”¹åˆ°æ‰€æœ‰ä¾›åº”å•†DNSæœåŠ¡å™¨çš„å®é™…æ›´æ–°ä¹‹é—´ç»è¿‡äº†å¤šå°‘æ—¶é—´ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼ŒACMEæ ‡å‡†è¿˜æä¾›äº†ä¸¤ä¸ªéªŒè¯é€‰é¡¹çš„ç»„åˆï¼Œå¯ç”¨äºåŠ å¿«æ¥æ”¶ä¸»åŸŸè¯ä¹¦çš„é€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯´æ˜</font></font><code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä¸‹ï¼š</font></font><br>
<br>
<pre><code class="1c hljs">apiVersion: cert-manager.io/v1alpha2<font></font>
kind: Issuer<font></font>
metadata:<font></font>
  name: letsencrypt<font></font>
spec:<font></font>
  acme:<font></font>
    server: https:<span class="hljs-comment">//acme-v02.api.letsencrypt.org/directory</span><font></font>
    privateKeySecretRef:<font></font>
      name: letsencrypt<font></font>
    solvers:<font></font>
    - selector:<font></font>
        dnsNames:<font></font>
        - <span class="hljs-string">"*.yet-another.website"</span><font></font>
      dns01:<font></font>
        cloudflare:<font></font>
          email: my-cloudflare-acc@example.com<font></font>
          apiTokenSecretRef:<font></font>
            name: cloudflare-api-token<font></font>
            key: api-token            <font></font>
    - selector:<font></font>
        dnsNames:<font></font>
        - <span class="hljs-string">"yet-another.website"</span><font></font>
      http01:<font></font>
        ingress:<font></font>
          class: nginx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœåº”ç”¨æ­¤é…ç½®ï¼Œå°†åˆ›å»ºä¸¤ä¸ªèµ„æº</font></font><code>Challenge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n app describe orders le-crt-613810377-1285319347<font></font>
â€¦<font></font>
  Normal  Created  3m29s  cert-manager  Created Challenge resource <span class="hljs-string">"le-crt-613810377-1285319347-3996324737"</span> <span class="hljs-keyword">for</span> domain <span class="hljs-string">"yet-another.website"</span>                 
  Normal  Created  3m29s  cert-manager  Created Challenge resource <span class="hljs-string">"le-crt-613810377-1285319347-1443470517"</span> <span class="hljs-keyword">for</span> domain <span class="hljs-string">"yet-another.website"</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4å· </font><font style="vertical-align: inherit;">ä½¿ç”¨å…¥å£ç‰¹æ®Šæ³¨é‡Š</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†åœ¨cert-managerä¸­åˆ›å»ºè¯ä¹¦çš„ç›´æ¥è·¯å¾„å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingress-shim</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ç»„ä»¶ï¼Œ</font><font style="vertical-align: inherit;">è€Œä¸å¿…æ˜¾å¼åˆ›å»ºèµ„æº</font></font><code>Certificate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æƒ³æ³•æ˜¯ï¼Œå€ŸåŠ©ç‰¹æ®Šçš„Ingressæ³¨é‡Šï¼Œå°†ä½¿ç”¨å…¶ä¸­æŒ‡ç¤ºçš„è¯ä¹¦è‡ªåŠ¨å¯¹è¯ä¹¦è¿›è¡Œæ’åº</font></font><code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ç»“æœå¤§è‡´æ˜¯ä»¥ä¸‹Ingressèµ„æºï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: networking.k8s.io/v1beta1<font></font>
kind: Ingress<font></font>
metadata:<font></font>
  annotations:<font></font>
    cert-manager.io/cluster-issuer: letsencrypt<font></font>
spec:<font></font>
  tls:<font></font>
  - hosts:<font></font>
    - "yet-another.website"<font></font>
    secretName: tls-secret<font></font>
  rules:<font></font>
  - host: "yet-another.website"<font></font>
    http:<font></font>
      paths:<font></font>
      - path: /<font></font>
        backend:<font></font>
          serviceName: app<font></font>
          servicePort: 8080</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†è¿›è¡Œæ­£ç¡®çš„æ“ä½œï¼Œæ­¤å¤„ä»…å­˜åœ¨Issuerå°±è¶³å¤Ÿäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ›å»ºä¸€ä¸ªæ›´å°‘çš„å®ä½“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿‡æ—¶çš„</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨é‡Š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kube-lego</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><code>kubernetes.io/tls-acme: "true"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ- </font></font><code>Issuer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä½¿ç”¨Helmå‚æ•°ï¼ˆæˆ–åœ¨ç®¡ç†å™¨å®¹å™¨å¯åŠ¨é€‰é¡¹ä¸­ï¼‰å®‰è£…cert-manageræ—¶</font><font style="vertical-align: inherit;">ï¼Œéœ€è¦</font><font style="vertical-align: inherit;">é»˜è®¤</font><font style="vertical-align: inherit;">ä½œä¸š</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºç”¨äºè®¢è´­SSLè¯ä¹¦çš„æ–¹æ³•çš„ä¸é€æ˜æ€§ï¼ˆåŒæ—¶</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£å†³äº†å‡ºç°çš„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å„ç§</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">é—®é¢˜</font></a><font style="vertical-align: inherit;">ï¼‰ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å…¬å¸ä¸ä½¿ç”¨è¿™äº›é€‰é¡¹ï¼Œä¹Ÿæ— æ³•æä¾›å»ºè®®</font><font style="vertical-align: inherit;">ï¼Œä½†ä»å†³å®šåœ¨æœ¬æ–‡ä¸­è¿›è¡Œä»‹ç»ä»¥è·å–æ›´å®Œæ•´çš„ä¿¡æ¯ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€Œä¸æ˜¯ç»“è®º</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡CRDçš„ç®€å•æ“ä½œï¼Œæˆ‘ä»¬ä»Let's Encrypté¡¹ç›®ä¸­äº†è§£äº†å¦‚ä½•ä¸ºKubernetesé›†ç¾¤ä¸­Ingressçš„ä¸€éƒ¨åˆ†å¯åŠ¨çš„åŸŸç«™ç‚¹ç¼–å†™å¯è‡ªåŠ¨æ›´æ–°ï¼Œè‡ªç­¾åå’Œå…è´¹çš„SSLè¯ä¹¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ–‡æä¾›äº†è§£å†³æˆ‘ä»¬å®è·µä¸­æœ€å¸¸è§é—®é¢˜çš„ç¤ºä¾‹ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œè¯ä¹¦ç®¡ç†å™¨åŠŸèƒ½ä¸é™äºä¸Šè¿°åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">åœ¨å®ç”¨ç¨‹åºç½‘ç«™ä¸Šï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä½¿ç”¨å…¶ä»–æœåŠ¡çš„ç¤ºä¾‹-ä¾‹å¦‚ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Vaultæ†ç»‘åœ¨ä¸€èµ·</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ–</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨å¤–éƒ¨å‘è¡Œä¸­å¿ƒ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå‘è¡Œæ–¹ï¼‰çš„</font><font style="vertical-align: inherit;">ç¤ºä¾‹</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èšè‹¯ä¹™çƒ¯</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦è¯·å‚é˜…æˆ‘ä»¬çš„åšå®¢ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®‰å…¨ä¸“ä¸šäººå‘˜çš„Kubernetesç½‘ç»œç­–ç•¥ç®€ä»‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â« </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesæç¤ºå’ŒæŠ€å·§ï¼šIngress NGINXä¸­çš„è‡ªå®šä¹‰é”™è¯¯é¡µé¢</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Â»ï¼›</font></font></li>
<li> Â«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    Ingress  Kubernetes</a>Â».</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN496914/index.html">æœ€çŸ­çš„åè¿›åˆ¶ç¨‹åº</a></li>
<li><a href="../zh-CN496916/index.html">è¿œç¨‹æ•™å­¦ï¼Œåå•†å’Œå’¨è¯¢-ç¬¬3éƒ¨åˆ†ï¼šYealinkä¼šè®®æœåŠ¡å™¨å’Œ4ä¸ªç‰¹åˆ«ä¼˜æƒ </a></li>
<li><a href="../zh-CN496920/index.html">ä½¿ç”¨ASP.NET Coreå’ŒArduinoæ‰“é€ æ™ºèƒ½å®¶å±…</a></li>
<li><a href="../zh-CN496922/index.html">å…³äºä½œä¸šNeoQUEST-2020ç¤ºä¾‹çš„åå‘å®¢æˆ·ç«¯-æœåŠ¡å™¨apkæŒ‡å—</a></li>
<li><a href="../zh-CN496924/index.html">Webç»„ä»¶è·¯ç”±</a></li>
<li><a href="../zh-CN496938/index.html">è¶…çº§è®¡ç®—æœºï¼ŒåŸºå› ç»„æµ‹åºå’Œå‡»è´¥å† çŠ¶ç—…æ¯’çš„å‰æ™¯</a></li>
<li><a href="../zh-CN496940/index.html">é€šç”¨æ±½è½¦å·¥ç¨‹å¸ˆå¦‚ä½•æµ‹è¯•ç”µå­äº§å“</a></li>
<li><a href="../zh-CN496942/index.html">4æœˆ13æ—¥è‡³19æ—¥åœ¨è«æ–¯ç§‘ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN496944/index.html">4æœˆ13æ—¥è‡³19æ—¥åœ¨åœ£å½¼å¾—å ¡ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN496946/index.html">å†è°ˆä¸€åˆ†é’±çš„GPGç¡¬ä»¶æŒ‰é”®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>