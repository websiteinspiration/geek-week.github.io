<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíë ü§¥üèΩ üèúÔ∏è Spiral: high-performance PHP / Go framework ‚òÉÔ∏è ü§πüèø üïë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr. My name is Anton Titov, CTO of Spiral Scout. Today I would like to tell you about our PHP elephant. Or rather, about the second version o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Spiral: high-performance PHP / Go framework</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495224/"><img src="https://habrastorage.org/webt/1_/ku/gu/1_kugualputdvwq2gxujopusshg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hello, Habr. </font><font style="vertical-align: inherit;">My name is Anton Titov, CTO of Spiral Scout. </font><font style="vertical-align: inherit;">Today I would like to tell you about our PHP elephant. </font><font style="vertical-align: inherit;">Or rather, about the second version of the open-source full-stack PHP / Go framework - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spiral</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spiral is a component full-stack framework developed by our company for more than eleven years and serving a hundred of real projects. </font><font style="vertical-align: inherit;">The software package is based on many open and proprietary libraries, including </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RoadRunner</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cycle ORM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The framework is compatible with most PSR recommendations, supports MVC and runs 5-10 times faster than Laravel / Symfony. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you have never heard of Spiral and are wondering what the PHP / Go framework is and where the first version went, then welcome to cat.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About the framework</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spiral development began in 2008/09 as a portable kernel for freelance applications. In 2010, we finally formed an outsourcing company and have since been engaged in improving our stack. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the framework was transformed into a set of independent components, united by a common integration layer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only public announcement of the first version occurred on Reddit in 2017 and made it clear to us that, technically, Spiral did not really beat the competitors at that time. We took into account the feedback we received, the experience of more complex projects and completed the second version in May 2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After a year of documentation and running on real projects, we are ready to submit this development to the public.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main difference between Spiral 2.0 from the previous generation of the framework and, perhaps, from all other existing PHP frameworks is the integrated application server RoadRunner, as well as the adaptation of the architecture for a long-lived execution model (daemon mode). </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hybrid Rantheim</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main concept of the framework is the symbiosis between the application server written in Golang and the PHP core. </font><font style="vertical-align: inherit;">PHP application code is loaded only once into memory - this way you get significant resource savings, but lose the ability to run WordPress.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/88/-o/fw/88-ofwfx3p83cjgqkkwuqmkuxk0.png"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can read more about the hybrid model </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The server is responsible for the entire infrastructure part: HTTP / FastCGI, communication with queue brokers, GRPC, WebSockets, Pub / Sub, cache, metrics, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Writing code for Spiral is practically no different from code for any other framework. </font><font style="vertical-align: inherit;">However, SOLID principles will have to be more responsible. </font><font style="vertical-align: inherit;">If previously caching user data in singleton caused only severe pain for the code review, now such a code simply will not work correctly.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Golang knowledge is not required to work with the platform. </font><font style="vertical-align: inherit;">However, having learned a second language, you can create almost seamless integrations with Golang libraries. </font><font style="vertical-align: inherit;">For example, embed a full-text search engine or write your own Kafka driver.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To shoot in the leg was a little more difficult, it was decided to abandon the system of events and hooks and prioritize work with the call stack in an explicit form. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The framework provides a set of tools, such as IoC closures, middleware, domain layer spoilers and immutable services.</font></font><br>
<br>
<pre><code class="php hljs">$container-&gt;runScope(<font></font>
    [UserContext::class =&gt; $user],<font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) <span class="hljs-title">use</span> (<span class="hljs-params">$container</span>) </span>{<font></font>
        dump($container-&gt;get(UserContext::class);<font></font>
    }<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although such an approach imposes an additional overhead, the ability not to unload the core of the program, connections to the database and sockets from memory more than covers these limitations.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the full-stack class of PHP frameworks, Spiral mainly competes with Swoole-based assemblies and several micro-frameworks. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/a5/tz/nwa5tzv_osg63cq6l2ha2xpbs2c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Full benchmarks are available </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For us, performance is a side effect of the chosen architecture. We are sure that with proper configuration and replacing the PSR-7 with a lighter abstraction, productivity can be increased by 50-80% (this is proved by the example of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ubiquity-roadrunner</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<blockquote> Swoole. Swoole     RoadRunner,     PHP        ++.       ,     Go.     ,   .<br>
<br>
   RoadRunner   (   ),    ,       Windows.<br>
<br>
   Spiral     Swoole,     !</blockquote><br>
<h4>PSR-*  </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most Spiral components are optional for your build, the difference between micro and full build is only in the content </font></font><code>composer.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If necessary, you can use the interfaces to replace standard libraries with alternative implementations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The HTTP layer of the framework is written taking into account the PSR-7/15/17 standards, you can safely </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://spiral.dev/docs/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">change the router</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the implementation of messages, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most framework libraries can be used outside the framework. </font><font style="vertical-align: inherit;">For example, RoadRunner works great with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Symfony</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laravel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and Cycle ORM will be available in Yii3.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server components</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the PHP components, the RoadRunner assembly includes several libraries written in Golang. </font><font style="vertical-align: inherit;">Most server services can be managed from within PHP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In particular, there is a queue component that supports work with brokers AMQP, Amazon SQS and Beanstalk. </font><font style="vertical-align: inherit;">The library can correctly stop, reconnect and distribute any number of incoming queues to several workers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Out of the box there is monitoring on Prometheus and health-check points, a hot reboot and a memory limit. </font><font style="vertical-align: inherit;">For distributed projects, there is a GRPC server and client. </font><font style="vertical-align: inherit;">
There are web sockets, they can be authorized from a PHP application and connected to the pub-sub bus (in memory or on Redis). </font><font style="vertical-align: inherit;">Key-Value drivers are currently being tested.</font></font><br>
<br>
<code>INFO[0154] 10.42.5.55:51990 Ok {2.28ms} /images.Service/GetFiles<br>
INFO[0155] 10.42.3.95:50926 Ok {11.3ms} /images.Service/GetFiles<br>
INFO[0156] 10.42.5.55:52068 Ok {3.60ms} /images.Service/GetFiles<br>
INFO[0158] 10.42.5.55:52612 Ok {2.30ms} /images.Service/GetFiles<br>
INFO[0166] 10.42.5.55:52892 Ok {2.23ms} /images.Service/GetFiles<br>
INFO[0167] 10.42.3.95:49938 Ok {2.37ms} /images.Service/GetFiles<br>
INFO[0169] 10.42.5.55:52988 Ok {2.22ms} /images.Service/GetFiles</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portability</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The framework does not require PHP-FPM and NGINX. </font><font style="vertical-align: inherit;">And all Golang components have drivers for working without external dependencies. </font><font style="vertical-align: inherit;">Thus, you can use queues, websockets, metrics without installing external brokers or programs.</font></font><br>
<br>
<pre><code class="plaintext hljs">./spiral serve -v -d</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spiral doesn‚Äôt matter if you write a huge distributed application or a small site sending ‚Äúwrite to us‚Äù in the background. </font><font style="vertical-align: inherit;">In any case, you can use the same tools, unifying the behavior of local and production environments.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the HTTP layer is optional, you can write console applications that process data in the background using a queue package. </font><font style="vertical-align: inherit;">We use such programs for data migration.</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cycle ORM</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As an ORM out of the box comes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cycle ORM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This Data Mapper engine is very similar in function to Doctrine, but very architecturally different. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Like Doctrine, Cycle can work with pure domain models, independently generating migrations and arranging foreign keys. </font><font style="vertical-align: inherit;">The mapping scheme can be described by code or collected from annotations. </font><font style="vertical-align: inherit;">But instead of DQL, classic Query Builders are used.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-comment">//    </span>
<span class="hljs-comment">//        </span><font></font>
$users = $orm-&gt;getRepository(User::class)<font></font>
    -&gt;select()<font></font>
    -&gt;where(<span class="hljs-string">'active'</span>, <span class="hljs-literal">true</span>)<font></font>
    -&gt;load(<span class="hljs-string">'orders'</span>, [
        <span class="hljs-string">'method'</span> =&gt; Select::SINGLE_QUERY, <span class="hljs-comment">// force LEFT JOIN</span>
        <span class="hljs-string">'load'</span>   =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$query</span>) </span>{<font></font>
            $query-&gt;where(<span class="hljs-string">'paid'</span>, <span class="hljs-literal">true</span>)-&gt;orderBy(<span class="hljs-string">'timeCreated'</span>, <span class="hljs-string">'DESC'</span>);<font></font>
        }<font></font>
    ])<font></font>
    -&gt;fetchAll();<font></font>
<font></font>
$transaction = <span class="hljs-keyword">new</span> Transaction($orm);<font></font>
<font></font>
<span class="hljs-keyword">foreach</span>($users <span class="hljs-keyword">as</span> $user) {<font></font>
    $transaction-&gt;persist($user);<font></font>
}<font></font>
<font></font>
$transaction-&gt;run();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cycle runs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faster than</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Doctrine on selections, but slower on persist. </font><font style="vertical-align: inherit;">The engine supports complex queries with several loading strategies, proxy classes, embeddings and provides portable transactions instead of the global EntityManager.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More details can be heard at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP Russia 2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main ‚Äúfeature‚Äù of ORM is the ability to change the mapping of data and links in runtime. </font><font style="vertical-align: inherit;">In simple words, you can allow users to independently define the data schema (DBAL supports introspection and declaration of database schemas).</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can read more about comparing Cycle, Eloquent, and Doctrine 2 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rapid Prototyping</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spiral includes several tools to speed up and simplify development. </font><font style="vertical-align: inherit;">The main ones are auto-dependency injection, auto-configuration and automatic model search using static analysis. </font><font style="vertical-align: inherit;">Console commands allow you to generate most of the required classes and are easily customizable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For integration into the IDE there is a rapid prototyping system. </font><font style="vertical-align: inherit;">Using the magic PrototypeTrait, you can get quick access to tips in the IDE. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/33/9u/_a/339u_ac_8gelzkarpyljtgtisck.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The trait automatically finds ORM repositories, standard components and can index your services by annotations. </font><font style="vertical-align: inherit;">Under the hood, the magic </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__get</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method is used </font><font style="vertical-align: inherit;">, which guarantees you a quick code review.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just run the command `php app.php prototype: inject -r`, and the prototyping system will automatically remove all the magic:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Controller</span>;<font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Repository</span>\<span class="hljs-title">UserRepository</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Spiral</span>\<span class="hljs-title">Views</span>\<span class="hljs-title">ViewsInterface</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span>
</span>{
    <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> ViewsInterface */</span>
    <span class="hljs-keyword">private</span> $views;<font></font>
<font></font>
    <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> UserRepository */</span>
    <span class="hljs-keyword">private</span> $users;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> ViewsInterface $views
     * <span class="hljs-doctag">@param</span> UserRepository $users
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">ViewsInterface $views, UserRepository $users</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;users = $users;
        <span class="hljs-keyword">$this</span>-&gt;views = $views;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;views-&gt;render(<span class="hljs-string">'profile'</span>, [
            <span class="hljs-string">'user'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;users-&gt;findByName(<span class="hljs-string">'Antony'</span>)<font></font>
        ]);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under the hood, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP-Parser is used</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safety</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since most of our applications are developed for the B2B segment, security matters have to be taken seriously. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Components for validating complex requests (Request Filters), CSRF and encryption (based on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defuse / php-encryption</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">will be available to you </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Work with cookies and session supports anti-tampering and signing of data on the server side. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The framework provides </font><font style="vertical-align: inherit;">an expiring token based </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication component</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As a driver, you can use sessions, a database, or even pure JWT.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or all types of tokens at the same time, if the requirement ‚Äúurgently connect SAML / SSO / 2FA!‚Äù Suddenly flies to you </font><font style="vertical-align: inherit;">:(</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Access authorization is performed through the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RBAC component</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with some improvements that allow operation in DAC and ABAC mode. </font><font style="vertical-align: inherit;">There is support for many roles, annotations to protect controller methods, and a system of rules. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Work with the domain layer occurs through an intermediate </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interceptor layer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">So you can create special restrictions on a group of controllers, pre-validate data and wrap errors.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Template Engine</font></font></h4><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you like only Twig - you can scroll through this section, just install the extension and use familiar tools. </font><font style="vertical-align: inherit;">:)</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Out of the box comes the Stemper template engine, or rather, a library for creating your own DSL markup. In particular, there is a full-fledged lexer, several grammars, a parser and access to AST (similar to Nikita's PHP-Parser). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is possible to parse several nested grammars. So, for example, you can use Laravel Blade directives and your own DSL (in the form of HTML tags) markup within the same template. It turns out something like web-components on the server side. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We use this component to describe complex interfaces using simple primitives and rules.</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">extends:admin.layout.tabs</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"User Information"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">use:bundle</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"admin/bundle"</span>/&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">ui:tab</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"info"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Information"</span>&gt;</span><font></font>
  User, {{ $user-&gt;name }}<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">ui:tab</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">ui:tab</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"User Settings"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">grid:table</span> <span class="hljs-attr">for</span>=<span class="hljs-string">{{</span> $<span class="hljs-attr">user-</span>&gt;</span>settings }}&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">grid:cell</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Key"</span>&gt;</span>{{ $key }}<span class="hljs-tag">&lt;/<span class="hljs-name">grid:cell</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">grid:cell</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Value"</span>&gt;</span>{{ $value }}<span class="hljs-tag">&lt;/<span class="hljs-name">grid:cell</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">grid:table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ui:tab</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It supports auto-escaping with context support (for example, the output of PHP inside the JS block automatically converts data to JSON), source-maps for working with errors. </font><font style="vertical-align: inherit;">Templates are compiled into optimized PHP code and then given directly from the application memory.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stemper can fully work with the DOM of the document (albeit slower if you use specialized tools).</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Framework Development</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, in more than a decade of developing this tool, we have made many mistakes. Some of them were corrected for the release of the second version, while the other part requires a revision of the concept of some components. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will also not deny that some things require a file. And some questions may sound for us for the first time. Although the documentation tries to cover the maximum of components, it can still sag in some places. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are open to criticism and suggestions, since we ourselves are actively using this tool. The huge backlog of improvements is slowly being sorted out by our team and the community.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lot of work will be required to improve and speed up Cycle, as well as rewriting Request Filters according to the latest RFCs. </font><font style="vertical-align: inherit;">Under development is a component for working and emulating Key-Value databases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We simply did not manage to translate many things from the first version. </font><font style="vertical-align: inherit;">The plans are to restore ODM packages, admin panel, write a good profiler, etc.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Community and Links</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can log in to our small </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discord</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> community </font><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram channel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Framework site</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github framework</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github standard application</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All code is distributed under the MIT license and does not have any restrictions for commercial use. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you for the attention. </font><font style="vertical-align: inherit;">I hope our tools come in handy in your projects!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495210/index.html">How the fraudsters of Runet reacted to coronavirus</a></li>
<li><a href="../en495212/index.html">Native compilation in Quarkus - why it matters</a></li>
<li><a href="../en495214/index.html">In the office of no one: developing games on a remote site</a></li>
<li><a href="../en495216/index.html">Learning, negotiating, consulting remotely - Part 2: Vinteo Server - 3 months of free video conferencing</a></li>
<li><a href="../en495220/index.html">The solar system acquired its current configuration shortly after its formation</a></li>
<li><a href="../en495226/index.html">In most corporate networks, there may be traces of hackers and related vulnerabilities</a></li>
<li><a href="../en495228/index.html">WebStorm 2020.1: interface improvements, Vuex support, and launching Prettier when saving files</a></li>
<li><a href="../en495230/index.html">Interview Technique ‚ÄúMoSt‚Äù</a></li>
<li><a href="../en495232/index.html">April 4-5 will be a selection for online intensives in the framework of the festival RuCode</a></li>
<li><a href="../en495234/index.html">OpenStreetMap Public Dataset on Google Cloud Platform with BigQuery SQL. OSM Layer Classifier</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>