<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚿 ➖ 🥤 General Financial Analysis in Python (Part 3) 👨‍👨‍👦‍👦 🆚 💹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After all the calculations presented in this and this publication, we can delve into the statistical analysis and consider the least squares method. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>General Financial Analysis in Python (Part 3)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496810/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After all the calculations presented in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> publication, we can delve into the statistical analysis and consider the least squares method. </font><font style="vertical-align: inherit;">The statsmodels library is used for this purpose, which allows users to examine data, evaluate statistical models, and perform statistical tests. </font><font style="vertical-align: inherit;">This </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and this </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> were taken as a basis </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The description of the function used in English is available at the following </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, a little theory:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About linear regression</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linear regression is used as a predictive model when a linear relationship is assumed between the dependent variable (the variable we are trying to predict) and the independent variable (the variable and / or variables used for the prediction). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the simplest case, when considering, one variable is used based on which we are trying to predict another. </font><font style="vertical-align: inherit;">The formula in this case is as follows: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y = C + M * X</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y = dependent variable (result / forecast / estimate)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C = Constant (Y-Intercept)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M = Slope of the regression line (slope or gradient of the estimated line; it is the amount by which Y increases on average if we increase X by one unit)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> X = independent variable (predictor used in forecast Y)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, there may also be a relationship between the dependent variable and several independent variables. </font><font style="vertical-align: inherit;">For these types of models (assuming linearity), we can use multiple linear regression of the following form: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y = C + M1X1 + M2X2 + ...</font></font></b><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beta Ratio</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lot has already been written about this coefficient, for example, on this </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Briefly, if you do not go into details, you can characterize it as follows: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stocks with a beta coefficient:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zero indicates no correlation between stock and index</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the unit indicates that the stock has the same volatility as the index</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> more than one - indicates a higher profitability (and therefore risks) of the stock than the index</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> less than one - less volatile stock than index</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In other words, if the stock increases by 14%, while the market grew by only 10%, then the beta coefficient of the stock will be 1.4. </font><font style="vertical-align: inherit;">Typically, markets with a higher beta can offer better conditions for reward (and therefore risk).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-e/yf/ky/-eyfkygh_enn9wusk29gg2gyot8.png" alt="image"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Practice</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following Python code includes an example of linear regression, where the input variable is the yield on the Moscow Exchange Index, and the estimated variable is the yield on Aeroflot stocks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to avoid the need to remember how to download data and bring the data to the form necessary for the calculation, the code is given from the moment the data is downloaded and until the results are obtained. </font><font style="vertical-align: inherit;">Here is the complete syntax for doing linear regression in Python using statsmodels:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># </span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> yfinance <span class="hljs-keyword">as</span> yf
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> statsmodels.api <span class="hljs-keyword">as</span> sm<font></font>
<font></font>
<span class="hljs-comment"># </span>
ticker = [<span class="hljs-string">'AFLT.ME'</span>,<span class="hljs-string">'IMOEX.ME'</span>]<font></font>
stock = yf.download(ticker)<font></font>
<font></font>
<span class="hljs-comment">#    </span>
all_adj_close = stock[[<span class="hljs-string">'Adj Close'</span>]]<font></font>
<font></font>
<span class="hljs-comment">#   </span>
all_returns = np.log(all_adj_close / all_adj_close.shift(<span class="hljs-number">1</span>))<font></font>
<font></font>
<span class="hljs-comment">#      </span>
aflt_returns = all_returns[<span class="hljs-string">'Adj Close'</span>][[<span class="hljs-string">'AFLT.ME'</span>]].fillna(<span class="hljs-number">0</span>)<font></font>
<font></font>
<span class="hljs-comment">#      </span>
moex_returns = all_returns[<span class="hljs-string">'Adj Close'</span>][[<span class="hljs-string">'IMOEX.ME'</span>]].fillna(<span class="hljs-number">0</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#   DataFrame</span><font></font>
<font></font>
return_data = pd.concat([aflt_returns, moex_returns], axis=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>:]<font></font>
return_data.columns = [<span class="hljs-string">'AFLT.ME'</span>, <span class="hljs-string">'IMOEX.ME'</span>]<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#      X  y</span>
X = sm.add_constant(return_data[<span class="hljs-string">'IMOEX.ME'</span>])<font></font>
y = return_data[<span class="hljs-string">'AFLT.ME'</span>]<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
model_moex = sm.OLS(y,X).fit()<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
print(model_moex.summary())<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/ed/xr/a9/edxra9sgz7wsy6bcfko4hte2hni.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the yahoo website and Mosbirzhi beta coefficient differs slightly upwards. </font><font style="vertical-align: inherit;">But I must honestly admit that the calculation for some other shares from the Russian stock exchange showed more significant differences, but within the interval. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w8/re/zg/w8rezgmmmshfkvnooj3bgbwpezg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same analysis for the FB stock and the SP500 index. </font><font style="vertical-align: inherit;">Here, the calculation, as in the original, is carried out through the monthly yield.</font></font><br>
<br>
<pre><code class="python hljs">sp_500 = yf.download(<span class="hljs-string">'^GSPC'</span>)<font></font>
fb = yf.download(<span class="hljs-string">'FB'</span>)<font></font>
<font></font>
<span class="hljs-comment">#    </span>
fb = fb.resample(<span class="hljs-string">'BM'</span>).apply(<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">-1</span>])<font></font>
sp_500 = sp_500.resample(<span class="hljs-string">'BM'</span>).apply(<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">-1</span>])<font></font>
<font></font>
monthly_prices = pd.concat([fb[<span class="hljs-string">'Close'</span>], sp_500[<span class="hljs-string">'Close'</span>]], axis=<span class="hljs-number">1</span>)<font></font>
monthly_prices.columns = [<span class="hljs-string">'FB'</span>, <span class="hljs-string">'^GSPC'</span>]<font></font>
<font></font>
monthly_returns = monthly_prices.pct_change(<span class="hljs-number">1</span>)<font></font>
clean_monthly_returns = monthly_returns.dropna(axis=<span class="hljs-number">0</span>)  <font></font>
<font></font>
X = clean_monthly_returns[<span class="hljs-string">'^GSPC'</span>]<font></font>
y = clean_monthly_returns[<span class="hljs-string">'FB'</span>]<font></font>
<font></font>
X1 = sm.add_constant(X)<font></font>
<font></font>
model_fb_sp_500 = sm.OLS(y, X1)<font></font>
<font></font>
results_fb_sp_500 = model_fb_sp_500.fit()<font></font>
print(results_fb_sp_500.summary())<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/pb/67/sa/pb67saq7ogsncggyw-syzplqciu.jpeg" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/iq/kn/t5/iqknt566j5ed_mz7gzmhwt0gyyk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this case, everything coincided and confirmed the possibility of using statsmodels to determine the beta coefficient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, and as a bonus - if you want to get only beta - you want to leave the coefficient and the rest of the statistics aside, then another code is proposed for calculating it:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats<font></font>
slope, intercept, r_value, p_value, std_err = stats.linregress(X, y)<font></font>
<font></font>
print(slope)<font></font>
<font></font>
<span class="hljs-number">1.0568997978702754</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
True, this does not mean that all other obtained values ​​should be ignored, but knowledge of statistics will be needed to understand them. </font><font style="vertical-align: inherit;">I will give a small excerpt from the obtained values:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R-squared, which is the coefficient of determination and takes values ​​from 0 to 1. The closer the value of the coefficient to 1, the stronger the dependence;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adj. </font><font style="vertical-align: inherit;">R-squared - adjusted R-squared based on the number of observations and the number of degrees of freedom;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> std err - standard error of coefficient estimation;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P&gt; | t | </font><font style="vertical-align: inherit;">- p-value A value of less than 0.05 is considered statistically significant;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.025 and 0.975 are the lower and upper values ​​of the confidence interval.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> etc.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all for now. </font><font style="vertical-align: inherit;">Of course, it is of interest to look for a relationship between different values ​​in order to predict the other through one and get a profit. </font><font style="vertical-align: inherit;">In one of the foreign sources, the index was predicted through the interest rate and unemployment rate. </font><font style="vertical-align: inherit;">But if the change in the interest rate in Russia can be taken from the Central Bank's website, then I continue to search for others. </font><font style="vertical-align: inherit;">Unfortunately, the Rosstat website could not find the relevant ones. </font><font style="vertical-align: inherit;">This is the final publication in the articles of the general financial analysis.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496782/index.html">How I refused to calculate the square root</a></li>
<li><a href="../en496790/index.html">Unigine Engine - New Unique</a></li>
<li><a href="../en496792/index.html">Drawing a graph with cairo in GTK3</a></li>
<li><a href="../en496802/index.html">Simple Made Easy - Rich Hickey (with Russian translation)</a></li>
<li><a href="../en496804/index.html">Installing and Configuring Docker on Windows Subsystem Linux (WSL)</a></li>
<li><a href="../en496812/index.html">Zoom - banal negligence or targeted espionage?</a></li>
<li><a href="../en496816/index.html">Can you feel the candidate, is he alive?</a></li>
<li><a href="../en496818/index.html">Hundreds of thousands of routes per second per core. Yandex.Routing Experience</a></li>
<li><a href="../en496820/index.html">Pitfalls of Terraform</a></li>
<li><a href="../en496822/index.html">How startups in the United States die due to coronavirus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>