<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš€ ğŸ‘°ğŸ¿ ğŸ‘©ğŸ¿â€ğŸŒ¾ ä»é”™è¯¯åˆ°è¡ŒåŠ¨è­¦æŠ¥ ğŸ‘¨ğŸ¿â€ğŸ¨ ğŸ‘©ğŸ¿â€âš•ï¸ ãŠ—ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œé”™è¯¯æ¶ˆæ¯é€šå¸¸çœ‹èµ·æ¥åƒâ€œå‡ºäº†ç‚¹é—®é¢˜ï¼ŒAAAAï¼â€ã€‚å½“ç„¶ï¼Œä»–å¸Œæœ›çœ‹åˆ°é”™è¯¯â€œä¿®å¤å…¨éƒ¨â€è€Œä¸æ˜¯çŠ¯é”™ã€‚å¥½å§ï¼Œè¿˜æ˜¯å…¶ä»–é€‰æ‹©ã€‚æˆ‘ä»¬å¼€å§‹ç§¯æåœ°å°†å®ƒä»¬æ·»åŠ åˆ°æˆ‘ä»¬è‡ªå·±ä¸­ï¼Œæˆ‘æƒ³è°ˆä¸€è°ˆå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚
 
 
 
 é¦–å…ˆï¼Œè‡ªæˆ‘ä»‹ç»-æˆ‘çš„åå­—å«Alexanderï¼Œæœ€è¿‘å…­å¹´æˆ‘è‡´åŠ›äºiOSå¼€å‘ã€‚ç°åœ¨ï¼Œæˆ‘è´Ÿè´£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä»é”™è¯¯åˆ°è¡ŒåŠ¨è­¦æŠ¥</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/manychat/blog/495346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆHaï¼</font><font style="vertical-align: inherit;">å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œé”™è¯¯æ¶ˆæ¯é€šå¸¸çœ‹èµ·æ¥åƒâ€œå‡ºäº†ç‚¹é—®é¢˜ï¼ŒAAAAï¼â€ã€‚</font><font style="vertical-align: inherit;">å½“ç„¶ï¼Œä»–å¸Œæœ›çœ‹åˆ°é”™è¯¯â€œä¿®å¤å…¨éƒ¨â€è€Œä¸æ˜¯çŠ¯é”™ã€‚</font><font style="vertical-align: inherit;">å¥½å§ï¼Œè¿˜æ˜¯å…¶ä»–é€‰æ‹©ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¼€å§‹ç§¯æåœ°å°†å®ƒä»¬æ·»åŠ åˆ°æˆ‘ä»¬è‡ªå·±ä¸­ï¼Œæˆ‘æƒ³è°ˆä¸€è°ˆå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6q/cf/s3/6qcfs3uiu0o9ajdlcfi8frjb5pg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œè‡ªæˆ‘ä»‹ç»-æˆ‘çš„åå­—å«Alexanderï¼Œæœ€è¿‘å…­å¹´æˆ‘è‡´åŠ›äºiOSå¼€å‘ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘è´Ÿè´£ManyChatç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œæˆ‘å°†ä½¿ç”¨ä»–çš„ç¤ºä¾‹è§£å†³é—®é¢˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ç«‹å³åˆ¶å®šæˆ‘ä»¬å°†è¦åšçš„äº‹æƒ…ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘é”™è¯¯ç±»å‹æ·»åŠ åŠŸèƒ½</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†é”™è¯¯å˜æˆç”¨æˆ·å‹å¥½çš„è­¦æŠ¥</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨ç•Œé¢ä¸­æ˜¾ç¤ºå¯èƒ½çš„è¿›ä¸€æ­¥æ“ä½œå¹¶å¤„ç†å…¶ç‚¹å‡»</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€æœ‰è¿™äº›éƒ½å°†æ”¾åœ¨Swiftä¸Š:)</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ç”¨ä¸€ä¸ªä¾‹å­è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</font><font style="vertical-align: inherit;">æœåŠ¡å™¨è¿”å›çš„é”™è¯¯ä»£ç ä¸º500ï¼Œè€Œä¸æ˜¯é¢„æœŸçš„200ã€‚å¼€å‘äººå‘˜åº”è¯¥æ€ä¹ˆåšï¼Ÿ</font><font style="vertical-align: inherit;">è‡³å°‘ï¼Œå¸¦ç€æ‚²ä¼¤çš„å¿ƒæƒ…é€šçŸ¥ç”¨æˆ·-æ— æ³•ä¸‹è½½å¸¦æœ‰ç›–ç« çš„é¢„æœŸå¸–å­ã€‚</font><font style="vertical-align: inherit;">åœ¨Appleä¸­ï¼Œæ ‡å‡†æ¨¡å¼æ˜¯è­¦æŠ¥ï¼Œå› æ­¤è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeedViewController</span>: <span class="hljs-title">UIViewController</span> </span>{
  <span class="hljs-comment">// -   </span><font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleFeedResponse</span><span class="hljs-params">(...)</span></span> {
	<span class="hljs-comment">/// -    </span>
	<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
		<span class="hljs-keyword">let</span> alertVC = <span class="hljs-type">UIAlertController</span>(<font></font>
			title: <span class="hljs-string">"Error"</span>,<font></font>
			message: <span class="hljs-string">"Error connecting to the server"</span>,<font></font>
			preferredStyle: .alert)<font></font>
		<span class="hljs-keyword">let</span> action = <span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">"OK"</span>, style: .<span class="hljs-keyword">default</span>, handler: <span class="hljs-literal">nil</span>)<font></font>
		alertVC.addAction(action)<font></font>
		<span class="hljs-keyword">self</span>.present(alertVC, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
	}<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºç®€å•èµ·è§ï¼Œå¤§å¤šæ•°ä»£ç éƒ½åœ¨æ§åˆ¶å™¨ä¸­ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥åœ¨ä½“ç³»ç»“æ„ä¸­è‡ªç”±ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æ–‡ç« ä»£ç å°†åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­˜å‚¨åº“ä¸­æä¾›</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåœ¨æ–‡ç« æœ«å°¾ï¼Œæ­¤é“¾æ¥ä¹Ÿå°†å¯ç”¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å›¾ç‰‡ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9o/ra/ee/9oraeel1k7noyxjplcumz1b56jy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç†è®ºä¸Šï¼Œæˆ‘ä»¬å®Œæˆäº†ä»»åŠ¡ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæœ‰å‡ ä»¶äº‹ç«‹å³æ˜¾è€Œæ˜“è§ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ²¡æœ‰æœºä¼šä»¥æŸç§æ–¹å¼ä»é”™è¯¯çš„æƒ…å†µè½¬æ¢ä¸ºæˆåŠŸçš„æƒ…å†µã€‚</font><font style="vertical-align: inherit;">åœ¨å½“å‰æƒ…å†µä¸‹è¿˜å¯ä»¥ï¼Œå®ƒåªæ˜¯éšè—è­¦æŠ¥-è¿™ä¸æ˜¯è§£å†³æ–¹æ¡ˆ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»ç”¨æˆ·ä½“éªŒçš„è§’åº¦æ¥çœ‹ï¼Œæ–‡æœ¬éœ€è¦å˜å¾—æ›´åŠ æ¸…æ™°ï¼Œä¸­æ€§ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·ç”¨æˆ·å°±ä¸ä¼šå®³æ€•ï¼Œä¹Ÿä¸ä¼šåœ¨AppStoreä¸­ç»™åº”ç”¨ç¨‹åºåŠ ä¸€æ˜Ÿã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒè¯•æ—¶çš„è¯¦ç»†æ–‡å­—å¯¹æˆ‘ä»¬å¾ˆæœ‰ç”¨</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€Œä¸”ï¼Œè€å®è¯´-è­¦æŠ¥åœ¨æŸç§ç¨‹åº¦ä¸Šå·²ç»è¿‡æ—¶ï¼ˆä½œä¸ºè§£å†³æ–¹æ¡ˆï¼‰ï¼ˆè¶Šæ¥è¶Šå¤šçš„è™šæ‹Ÿå±å¹•æˆ–åå¸å‡ºç°åœ¨åº”ç”¨ç¨‹åºä¸­ï¼‰ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™å·²ç»æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œåº”è¯¥ä¸å›¢é˜Ÿå•ç‹¬è®¨è®º</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒæ„ï¼Œä¸‹é¢æ˜¾ç¤ºçš„é€‰é¡¹çœ‹èµ·æ¥æ›´æœ‰åŒæƒ…å¿ƒã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jv/0z/oz/jv0zozzv3foowtocsqkk_pjdifo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ— è®ºæ‚¨é€‰æ‹©å“ªç§é€‰é¡¹ï¼Œå¯¹äºå…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ‚¨éƒ½éœ€è¦è€ƒè™‘è¿™æ ·ä¸€ç§æœºåˆ¶æ¥æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯åœ¨å‘ç”Ÿä»»æ„é”™è¯¯æ—¶çœ‹èµ·æ¥å¾ˆæ£’ï¼Œå®ƒå°†ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ¸…æ™°çš„è„šæœ¬ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œè¿›ä¸€æ­¥çš„å·¥ä½œå¹¶æä¾›ä¸€ç³»åˆ—æ“ä½œã€‚</font><font style="vertical-align: inherit;">è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»æ˜¯å¯æ‰©å±•çš„ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éƒ½çŸ¥é“å›ºæœ‰çš„è®¾è®¡å¯å˜æ€§ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬çš„æœºåˆ¶å¿…é¡»ä¸ºä»»ä½•äº‹æƒ…åšå¥½å‡†å¤‡</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å‡ è¡Œä»£ç å°†å…¶æ·»åŠ åˆ°å¯¹è±¡ï¼ˆå¹¶åˆ é™¤ï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»è¿‡æµ‹è¯•</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢è®¨Swiftä¸­é”™è¯¯çš„ç†è®ºæœ€å°å€¼ã€‚ </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Swiftä¸­çš„é”™è¯¯</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ®µæ˜¯ä¸€èˆ¬é”™è¯¯çš„é¡¶çº§æ¦‚è¿°ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨å·²ç»åœ¨åº”ç”¨ç¨‹åºä¸­ç§¯æä½¿ç”¨é”™è¯¯ï¼Œåˆ™å¯ä»¥å®‰å…¨åœ°è¿›è¡Œä¸‹ä¸€æ®µã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ€ä¹ˆäº† </font><font style="vertical-align: inherit;">æŸç§é”™è¯¯çš„æ“ä½œæˆ–ä¸æ­£ç¡®çš„ç»“æœã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾å¯èƒ½çš„é”™è¯¯ï¼Œå¹¶æå‰åœ¨ä»£ç ä¸­å¯¹å…¶è¿›è¡Œæè¿°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºè¿™ç§æƒ…å†µï¼ŒAppleä¸ºæˆ‘ä»¬æä¾›äº†é”™è¯¯ç±»å‹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬æ‰“å¼€Appleæ–‡æ¡£ï¼Œåˆ™Errorä¼šçœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆä¸Swift 5.1ç›¸å…³ï¼‰ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">Error</span> </span>{<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åªæ˜¯ä¸€ä¸ªåè®®ï¼Œæ²¡æœ‰å…¶ä»–è¦æ±‚ã€‚</font><font style="vertical-align: inherit;">è¯¥æ–‡æ¡£å¾ˆå¥½åœ°è§£é‡Šäº†-ç¼ºå°‘å¿…éœ€çš„å‚æ•°å…è®¸åœ¨Swifté”™è¯¯å¤„ç†ç³»ç»Ÿä¸­ä½¿ç”¨ä»»ä½•ç±»å‹ã€‚</font><font style="vertical-align: inherit;">æœ‰äº†å¦‚æ­¤æ¸©å’Œçš„åè®®ï¼Œæˆ‘ä»¬å°†è½»æ¾å·¥ä½œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç«‹å³æƒ³åˆ°ä½¿ç”¨æšä¸¾çš„æƒ³æ³•ï¼šå·²çŸ¥çš„é”™è¯¯æ•°é‡æœ‰é™ï¼Œå®ƒä»¬å¯èƒ½å…·æœ‰æŸç§å‚æ•°ã€‚</font><font style="vertical-align: inherit;">è‹¹æœæ­£åœ¨åšä»€ä¹ˆã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è€ƒè™‘å®ç°DecodingErrorï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">DecodingError</span> : <span class="hljs-title">Error</span> </span>{<font></font>
    <font></font>
        <span class="hljs-comment">/// ,     . </span>
    	<span class="hljs-comment">///  ,    </span>
        <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Context</span> </span>{<font></font>
    <font></font>
    	    <span class="hljs-comment">///      </span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">let</span> codingPath: [<span class="hljs-type">CodingKey</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">let</span> debugDescription: <span class="hljs-type">String</span><font></font>
    <font></font>
    	    <span class="hljs-comment">/// ,    . </span>
            <span class="hljs-comment">///      .   </span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">let</span> underlyingError: <span class="hljs-type">Error?</span><font></font>
    <font></font>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>(codingPath: [<span class="hljs-type">CodingKey</span>], debugDescription: <span class="hljs-type">String</span>, underlyingError: <span class="hljs-type">Error?</span> = <span class="hljs-literal">nil</span>)<font></font>
        }<font></font>
    <font></font>
    	<span class="hljs-comment">/// N    </span>
        <span class="hljs-keyword">case</span> typeMismatch(<span class="hljs-type">Any</span>.<span class="hljs-type">Type</span>, <span class="hljs-type">DecodingError</span>.<span class="hljs-type">Context</span>)
        <span class="hljs-keyword">case</span> valueNotFound(<span class="hljs-type">Any</span>.<span class="hljs-type">Type</span>, <span class="hljs-type">DecodingError</span>.<span class="hljs-type">Context</span>)<font></font>
    <font></font>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ©ç”¨è‹¹æœçš„æœ€ä½³å®è·µã€‚</font><font style="vertical-align: inherit;">ä»¥ç®€åŒ–å½¢å¼æƒ³è±¡ä¸€ç»„å¯èƒ½çš„ç½‘ç»œé”™è¯¯ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">NetworkError</span>: <span class="hljs-title">Error</span> </span>{
       <span class="hljs-comment">//  500 </span>
	<span class="hljs-keyword">case</span> serverError
        <span class="hljs-comment">//   ,   </span>
	<span class="hljs-keyword">case</span> responseError
        <span class="hljs-comment">//  ,   ,  </span>
	<span class="hljs-keyword">case</span> internetError<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­å‘ç”Ÿé”™è¯¯çš„ä»»ä½•åœ°æ–¹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨Network.Errorã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚ä½•å¤„ç†é”™è¯¯ï¼Ÿæœ‰ä¸€ä¸ªæ•è·æœºåˆ¶ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°å¯ä»¥å¼•å‘é”™è¯¯ï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºthrowså…³é”®å­—ã€‚ç°åœ¨ï¼Œå®ƒçš„æ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦é€šè¿‡do catchæ„é€ å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œæˆ‘ä»¬å°†é™·å…¥é”™è¯¯çš„doå—ä¸­ï¼Œè¿›å…¥catchå—ã€‚å¯¼è‡´é”™è¯¯çš„å‡½æ•°åœ¨doå—ä¸­å¯ä»¥æ˜¯ä»»ä½•æ•°å­—ã€‚å”¯ä¸€çš„è´Ÿé¢å½±å“æ˜¯ï¼Œåœ¨catchä¸­ï¼Œæˆ‘ä»¬æ”¶åˆ°é”™è¯¯ç±»å‹ä¸ºErrorçš„é”™è¯¯ã€‚æ‚¨å°†éœ€è¦å°†é”™è¯¯è½¬æ¢ä¸ºæ‰€éœ€çš„ç±»å‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¯é€‰çš„æ–¹æ³•ï¼Œå³åœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹è·å–nilå¹¶æ‘†è„±ç¬¨é‡çš„è®¾è®¡ã€‚æœ‰æ—¶å®ƒæ›´æ–¹ä¾¿ï¼šå‡è®¾æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¯é€‰å˜é‡ï¼Œç„¶åå¯¹å…¶åº”ç”¨ä¸€ä¸ªthrowså‡½æ•°ã€‚å¯ä»¥å°†ä»£ç æ”¾åœ¨ä¸€ä¸ªif / guardå—ä¸­ï¼Œå®ƒå°†ä¿æŒç®€æ´ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯ä½¿ç”¨throwså‡½æ•°çš„ç¤ºä¾‹ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">blah</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">String</span> <span class="hljs-keyword">throws</span> {
    	<span class="hljs-keyword">throw</span> <span class="hljs-type">NetworkError</span>.serverError<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">do</span> {
    	<span class="hljs-keyword">let</span> string = <span class="hljs-keyword">try</span> blah()
    	<span class="hljs-comment">//     ,      </span>
    	<span class="hljs-keyword">let</span> anotherString = <span class="hljs-keyword">try</span> blah()<font></font>
    } <span class="hljs-keyword">catch</span> {
    	<span class="hljs-comment">//  NetworkError.serverError</span>
    	<span class="hljs-built_in">print</span>(error)<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//  string = nil</span>
    <span class="hljs-keyword">let</span> string = <span class="hljs-keyword">try</span>? blah()</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸è¦ä¸å…¶ä»–è¯­è¨€çš„â€œæŠ“æ•â€æ··æ·†ã€‚ Swiftä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°†é”™è¯¯çš„å€¼ï¼ˆå¦‚æœå‘ç”Ÿäº†ï¼‰å†™å…¥ä¸€ä¸ªç‰¹æ®Šçš„å¯„å­˜å™¨ã€‚å¦‚æœæœ‰ä¸€ä¸ªå€¼ï¼Œå®ƒå°†è½¬åˆ°é”™è¯¯å—ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ç»§ç»­æ‰§è¡Œdoå—ã€‚æœ€å¥½å¥‡çš„æ¥æºï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.mikeash.com/pyblog/friday-qa-2017-08-25-swift-error-handling-implementation.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ­¤æ–¹æ³•é€‚ç”¨äºå¤„ç†åŒæ­¥äº‹ä»¶ï¼Œä½†ä¸é€‚ç”¨äºé•¿æ—¶é—´æ“ä½œï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ç½‘ç»œè¯·æ±‚æ•°æ®ï¼‰ï¼Œè¿™å¯èƒ½å¾ˆè€—æ—¶ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç®€å•çš„å®Œæˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½œä¸ºSwift 5çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå¼•å…¥äº†Result-ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªé€‰é¡¹çš„æˆåŠŸæšä¸¾-æˆåŠŸå’Œå¤±è´¥ã€‚</font><font style="vertical-align: inherit;">å°±å…¶æœ¬èº«è€Œè¨€ï¼Œå®ƒä¸éœ€è¦ä½¿ç”¨Errorã€‚</font><font style="vertical-align: inherit;">å®ƒä¸å¼‚æ­¥æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å°†è¿™ç§ç±»å‹ç²¾ç¡®åœ°è¿”å›å®Œæˆå¯¹äºå¼‚æ­¥äº‹ä»¶æ›´ä¸ºæ–¹ä¾¿ï¼ˆå¦åˆ™ï¼Œæ‚¨å°†å¿…é¡»æ‰§è¡Œä¸¤ä¸ªå®Œæˆï¼ŒæˆåŠŸå’Œå¤±è´¥ï¼Œæˆ–è€…è¿”å›ä¸¤ä¸ªå‚æ•°ï¼‰ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å†™ä¸€ä¸ªä¾‹å­ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">blah</span>&lt;ResultType&gt;<span class="hljs-params">(handler: @escaping <span class="hljs-params">(Swift.Result&lt;ResultType, Error&gt;)</span></span></span> -&gt; <span class="hljs-type">Void</span>) {<font></font>
	handler(.failure(<span class="hljs-type">NetworkError</span>.serverError)<font></font>
}<font></font>
<font></font>
blah&lt;<span class="hljs-type">String</span>&gt;(handler { result <span class="hljs-keyword">in</span> 
	<span class="hljs-keyword">switch</span> result {
		<span class="hljs-keyword">case</span> .success(<span class="hljs-keyword">let</span> value):
			<span class="hljs-built_in">print</span>(value)
		<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
			<span class="hljs-built_in">print</span>(error)<font></font>
	}<font></font>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™äº›ä¿¡æ¯è¶³ä»¥ä¾›æˆ‘ä»¬å·¥ä½œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å†æ¬¡ç®€è¦åœ°ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Swiftä¸­çš„é”™è¯¯æ˜¯ä¸€ä¸ªåè®®</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥æšä¸¾çš„å½¢å¼è¡¨ç¤ºé”™è¯¯å¾ˆæ–¹ä¾¿</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰ä¸¤ç§å¤„ç†é”™è¯¯çš„æ–¹æ³•-åŒæ­¥ï¼ˆæ•è·ï¼‰å’Œå¼‚æ­¥ï¼ˆæ‚¨è‡ªå·±çš„ç«äº‰æˆ–ç»“æœï¼‰</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é”™è¯¯æ–‡å­—</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬å›åˆ°æœ¬æ–‡çš„ä¸»é¢˜ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸Šé¢çš„æ®µè½ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†è‡ªå·±çš„é”™è¯¯ç±»å‹ã€‚</font><font style="vertical-align: inherit;">ä»–åœ¨é‚£ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">NetworkError</span>: <span class="hljs-title">Error</span> </span>{
        <span class="hljs-comment">//  500 </span>
	<span class="hljs-keyword">case</span> serverError
        <span class="hljs-comment">//   ,   </span>
	<span class="hljs-keyword">case</span> responseError
        <span class="hljs-comment">//  ,   ,  </span>
	<span class="hljs-keyword">case</span> internetError<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªé”™è¯¯ä¸ç”¨æˆ·å¯ä»¥ç†è§£çš„æ–‡æœ¬è¿›è¡ŒåŒ¹é…ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œæˆ‘ä»¬å°†åœ¨ç•Œé¢ä¸­æ˜¾ç¤ºå®ƒã€‚</font><font style="vertical-align: inherit;">LocalizedErroråè®®æ€¥äºä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚</font><font style="vertical-align: inherit;">å®ƒç»§æ‰¿åè®®é”™è¯¯å¹¶è¡¥å……4ä¸ªå±æ€§ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">LocalizedError</span> : <span class="hljs-title">Error</span> </span>{
    <span class="hljs-keyword">var</span> errorDescription: <span class="hljs-type">String?</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> failureReason: <span class="hljs-type">String?</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> recoverySuggestion: <span class="hljs-type">String?</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> helpAnchor: <span class="hljs-type">String?</span> { <span class="hljs-keyword">get</span> }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å®ç°è¯¥åè®®ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">NetworkError</span>: <span class="hljs-title">LocalizedError</span> </span>{
    	<span class="hljs-keyword">var</span> errorDescription: <span class="hljs-type">String?</span> {
            <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-keyword">case</span> .serverError, .responseError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Error"</span>
    	    <span class="hljs-keyword">case</span> .internetError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"No Internet Connection"</span><font></font>
            }<font></font>
        }<font></font>
    <font></font>
        <span class="hljs-keyword">var</span> failureReason: <span class="hljs-type">String?</span> {
            <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-keyword">case</span> .serverError, .responseError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Something went wrong"</span>
    	    <span class="hljs-keyword">case</span> .internetError:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
            }<font></font>
        }<font></font>
    <font></font>
        <span class="hljs-keyword">var</span> recoverySuggestion: <span class="hljs-type">String?</span> {
            <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-keyword">case</span> .serverError, .responseError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Please, try again"</span>
    	    <span class="hljs-keyword">case</span> .internetError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Please check your internet connection and try again"</span><font></font>
            }<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é”™è¯¯æ˜¾ç¤ºå‡ ä¹ä¸ä¼šæ”¹å˜ï¼š</font></font><br>
<br>
<pre><code class="swift hljs">	<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
		<span class="hljs-keyword">let</span> errorMessage = [error.failureReason, error.recoverySuggestion].<span class="hljs-built_in">compactMap</span>({ $<span class="hljs-number">0</span> }).joined(separator: <span class="hljs-string">". "</span>)
		<span class="hljs-keyword">let</span> alertVC = <span class="hljs-type">UIAlertController</span>(<font></font>
			title: error.errorDescription,<font></font>
			message: errorMessage,<font></font>
			preferredStyle: .alert)<font></font>
		<span class="hljs-keyword">let</span> action = <span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">"OK"</span>, style: .<span class="hljs-keyword">default</span>) { (<span class="hljs-number">_</span>) -&gt; <span class="hljs-type">Void</span> <span class="hljs-keyword">in</span> }<font></font>
		alertVC.addAction(action)<font></font>
		<span class="hljs-keyword">self</span>.present(alertVC, animated: <span class="hljs-literal">true</span>, competion: <span class="hljs-literal">nil</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤ªå¥½äº†ï¼Œä½¿ç”¨æ–‡å­—ä¸€åˆ‡éƒ½å¾ˆå®¹æ˜“ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ç»§ç»­æŒ‰é’®ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é”™è¯¯æ¢å¤</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»¥ç®€å•çš„å›¾è¡¨å½¢å¼ä»‹ç»é”™è¯¯å¤„ç†ç®—æ³•ã€‚</font><font style="vertical-align: inherit;">å¯¹äºç”±äºé”™è¯¯è€Œå¯¼è‡´çš„æƒ…å†µï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œå…¶ä¸­åŒ…å«â€œé‡è¯•â€ï¼Œâ€œå–æ¶ˆâ€é€‰é¡¹ä»¥åŠå¯èƒ½çš„æŸäº›ç‰¹å®šé€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ–¹æ¡ˆï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/a9/te/n3/a9ten3zbrffm7sz8kkupfo8xsuy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»å¤´å¼€å§‹è§£å†³é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ˜¾ç¤ºn + 1ä¸ªè­¦æŠ¥çš„å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æŠ›å‡ºï¼Œå› ä¸ºæˆ‘ä»¬æƒ³æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecovableAction</span> </span>{
    	<span class="hljs-keyword">let</span> title: <span class="hljs-type">String</span>
    	<span class="hljs-keyword">let</span> action: () -&gt; <span class="hljs-type">Void</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">showRecovableOptions</span><span class="hljs-params">(actions: [RecovableAction], from viewController: UIViewController)</span></span> {
    	<span class="hljs-keyword">let</span> alertActions = actions.<span class="hljs-built_in">map</span> { <span class="hljs-type">UIAlertAction</span>(name: $<span class="hljs-number">0</span>.title, action: $<span class="hljs-number">0</span>.action) }
    	<span class="hljs-keyword">let</span> cancelAction = <span class="hljs-type">UIAlertAction</span>(name: <span class="hljs-string">"Cancel"</span>, action: <span class="hljs-literal">nil</span>)
    	<span class="hljs-keyword">let</span> alertController = <span class="hljs-type">UIAlertController</span>(actions: alertActions)<font></font>
    	viewController.present(alertController, complition: <span class="hljs-literal">nil</span>)<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¡®å®šé”™è¯¯ç±»å‹å¹¶å‘é€ä¿¡å·ä»¥æ˜¾ç¤ºè­¦æŠ¥çš„åŠŸèƒ½ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleError</span><span class="hljs-params">(error: Error)</span></span> {
	<span class="hljs-keyword">if</span> error <span class="hljs-keyword">is</span> <span class="hljs-type">RecovableError</span> {<font></font>
		showRecovableOptions(actions: error.actions, from: viewController)<font></font>
		<span class="hljs-keyword">return</span><font></font>
	}<font></font>
	showErrorAlert(...)<font></font>
} </code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿˜æœ‰æ‰©å±•çš„é”™è¯¯ç±»å‹ï¼Œå®ƒå…·æœ‰ä¸Šä¸‹æ–‡å¹¶äº†è§£å¦‚ä½•ä½¿ç”¨æ­¤é€‰é¡¹æˆ–è¯¥é€‰é¡¹ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecovableError</span>: <span class="hljs-title">Error</span> </span>{
	<span class="hljs-keyword">let</span> recovableACtions: [<span class="hljs-type">RecovableAction</span>]
	<span class="hljs-keyword">let</span> context: <span class="hljs-type">Context</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤´éƒ¨ç«‹å³ç»˜åˆ¶å‡ºæ‚¨çš„è‡ªè¡Œè½¦å›¾ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹AppleåŸºåº§ã€‚</font><font style="vertical-align: inherit;">æœºåˆ¶çš„ä¸€éƒ¨åˆ†ä¹Ÿè®¸å·²ç»æŒæ¡åœ¨æˆ‘ä»¬æ‰‹ä¸­ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬æœºå®ç°ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº’è”ç½‘æœç´¢ä¼šå¯¼è‡´åè®®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RecoverableError</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">// A specialized error that may be recoverable by presenting several potential recovery options to the user.</span>
<span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">RecoverableError</span> : <span class="hljs-title">Error</span> </span>{
    <span class="hljs-keyword">var</span> recoveryOptions: [<span class="hljs-type">String</span>] { <span class="hljs-keyword">get</span> }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(optionIndex recoveryOptionIndex: Int, resultHandler handler: @escaping <span class="hljs-params">(Bool)</span></span></span> -&gt; <span class="hljs-type">Void</span>)
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(optionIndex recoveryOptionIndex: Int)</span></span> -&gt; <span class="hljs-type">Bool</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çœ‹èµ·æ¥æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recoveryOptionsï¼š[String]-å­˜å‚¨æ¢å¤é€‰é¡¹çš„å±æ€§</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">func tryRecoveryï¼ˆoptionIndexï¼šIntï¼‰-&gt; Bool-ä»é”™è¯¯ä¸­åŒæ­¥æ¢å¤ã€‚</font><font style="vertical-align: inherit;">çœŸå®-æˆåŠŸ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">func tryRecoveryï¼ˆoptionIndexï¼šIntï¼ŒresultHandlerï¼šï¼ˆBoolï¼‰-&gt; Voidï¼‰-å¼‚æ­¥é€‰é¡¹ï¼Œæƒ³æ³•æ˜¯ç›¸åŒçš„</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰äº†ä½¿ç”¨æŒ‡å—ï¼Œä¸€åˆ‡éƒ½å˜å¾—æ›´åŠ æ¸©å’Œã€‚</font><font style="vertical-align: inherit;">åœ¨Appleç½‘ç«™åŠå…¶å‘¨å›´åœ°åŒºè¿›è¡Œçš„ä¸€æ¬¡å°å‹æœç´¢å¯¼è‡´</font><font style="vertical-align: inherit;">åœ¨Swiftçš„å…¬å‘Šä¹‹å‰æ’°å†™</font><font style="vertical-align: inherit;">äº†</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ç¯‡æœ‰å…³é”™è¯¯å¤„ç†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">æ–‡ç« </font></a><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç®€è¦åœ°ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥æœºåˆ¶æ˜¯ä¸ºMacOsåº”ç”¨ç¨‹åºè€ƒè™‘çš„ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒæœ€åˆæ˜¯å›´ç»•NSErroræ„å»ºçš„ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RecoveryAttempterå¯¹è±¡å°è£…åœ¨userInfoçš„é”™è¯¯ä¸­ï¼Œè¯¥ä¿¡æ¯äº†è§£é”™è¯¯çš„æƒ…å†µï¼Œå¹¶å¯ä»¥é€‰æ‹©æœ€ä½³çš„è§£å†³æ–¹æ¡ˆã€‚</font><font style="vertical-align: inherit;">å¯¹è±¡ä¸èƒ½ä¸ºé›¶</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RecoveryAttempterå¿…é¡»æ”¯æŒéæ­£å¼åè®®NSErrorRecoveryAttempting</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–åœ¨userInfoåº”è¯¥æ˜¯æ¢å¤é€‰é¡¹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€åˆ‡éƒ½ä¸è°ƒç”¨presentErroræ–¹æ³•æœ‰å…³ï¼Œè¯¥æ–¹æ³•ä»…åœ¨macOS SDKä¸­ã€‚</font><font style="vertical-align: inherit;">ä»–æ˜¾ç¤ºè­¦æŠ¥</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœè­¦æŠ¥æ˜¯é€šè¿‡presentErroræ˜¾ç¤ºçš„ï¼Œé‚£ä¹ˆå½“æ‚¨åœ¨AppDelegateçš„å¼¹å‡ºçª—å£ä¸­é€‰æ‹©ä¸€ä¸ªé€‰é¡¹æ—¶ï¼Œä¸€ä¸ªæœ‰è¶£çš„å‡½æ•°å°±ä¼šæŠ½æï¼š</font></font></li>
</ul><br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(fromError error: Error, optionIndex recoveryOptionIndex: Int, delegate: <span class="hljs-keyword">Any</span>?, didRecoverSelector: Selector?, contextInfo: UnsafeMutableRawPointer?)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬æ²¡æœ‰presentErrorï¼Œå› æ­¤æ— æ³•å°†å…¶æ‹‰å‡ºã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/xo/cj/vpxocjapqc5ywmiq8hhq3djow6o.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæ„Ÿè§‰å°±åƒæˆ‘ä»¬æ˜¯åœ¨æŒ–å°¸ä½“è€Œä¸æ˜¯å®è—ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å¿…é¡»å°†Errorè½¬æ¢ä¸ºNSErrorå¹¶ç¼–å†™æˆ‘ä»¬è‡ªå·±çš„å‡½æ•°ä»¥ç”±åº”ç”¨ç¨‹åºæ˜¾ç¤ºè­¦æŠ¥ã€‚</font><font style="vertical-align: inherit;">ä¸€å †éšå¼è¿æ¥ã€‚</font><font style="vertical-align: inherit;">å¯èƒ½ï¼Œå›°éš¾ä¸”ä¸å®Œå…¨æ¸…æ¥š-â€œä¸ºä»€ä¹ˆï¼Ÿâ€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å†²æ³¡ä¸‹ä¸€æ¯èŒ¶æ—¶ï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä¸Šé¢çš„å‡½æ•°å°†å§”æ‰˜ä½œä¸ºAnyå¹¶ä¼ é€’é€‰æ‹©å™¨ã€‚</font><font style="vertical-align: inherit;">ç­”æ¡ˆå¦‚ä¸‹ï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›ç­”</font></font></b><div class="spoiler_text">      iOS 2.          !         ( ,   ).  :)<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€ è‡ªè¡Œè½¦ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬å®ç°è¯¥åè®®ï¼Œå®ƒä¸ä¼šå¯¹æˆ‘ä»¬é€ æˆä¼¤å®³ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecoverableError</span>: <span class="hljs-title">Foundation</span>.<span class="hljs-title">RecoverableError</span> </span>{
	<span class="hljs-keyword">let</span> error: <span class="hljs-type">Error</span>
	<span class="hljs-keyword">var</span> recoveryOptions: [<span class="hljs-type">String</span>] {
		<span class="hljs-keyword">return</span> [<span class="hljs-string">"Try again"</span>]s<font></font>
	}<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(optionIndex recoveryOptionIndex: Int)</span></span> -&gt; <span class="hljs-type">Bool</span> {
		<span class="hljs-comment">//  ,    </span>
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><font></font>
	}<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(optionIndex: Int, resultHandler: <span class="hljs-params">(Bool)</span></span></span> -&gt; <span class="hljs-type">Void</span>) {
		<span class="hljs-comment">//      . </span>
               <span class="hljs-comment">//      </span>
		<span class="hljs-keyword">switch</span> optionIndex {
			<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
				resultHandler(<span class="hljs-literal">true</span>)
			<span class="hljs-keyword">default</span>: <font></font>
				resultHandler(<span class="hljs-literal">false</span>)<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç´¢å¼•ä¾èµ–ä¸æ˜¯æœ€æ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆï¼ˆæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°è¶…è¶Šæ•°ç»„å¹¶ä½¿åº”ç”¨ç¨‹åºå´©æºƒï¼‰ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å¯¹äºMVPæ¥è¯´ä¼šçš„ã€‚</font><font style="vertical-align: inherit;">ä»¥Appleçš„æƒ³æ³•ä¸ºä¾‹ï¼Œå¯¹å…¶è¿›è¡Œç°ä»£åŒ–æ”¹é€ ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå•ç‹¬çš„Attempterå¯¹è±¡å’ŒæŒ‰é’®é€‰é¡¹ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecoveryAttemper</span> </span>{
    	<span class="hljs-comment">//   </span>
    	<span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> _recoveryOptions: [<span class="hljs-type">RecoveryOptions</span>]<font></font>
    <font></font>
    	<span class="hljs-keyword">var</span> recoveryOptionsText: [<span class="hljs-type">String</span>] {
    		<span class="hljs-keyword">return</span> _recoveryOptions.<span class="hljs-built_in">map</span>({ $<span class="hljs-number">0</span>.title })<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">init</span>(options: [<span class="hljs-type">RecoveryOptions</span>] {<font></font>
    		_recoveryOptions = recoveryOptions<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-comment">//    </span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(fromError error: Error, optionIndex: Int)</span></span> -&gt; <span class="hljs-type">Bool</span> {
    		<span class="hljs-keyword">let</span> option = _recoveryOptions[optionIndex]
    				<span class="hljs-keyword">switch</span> option {
    				<span class="hljs-keyword">case</span> .tryAgain(<span class="hljs-keyword">let</span> action)<font></font>
    					action()<font></font>
    					<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    				<span class="hljs-keyword">case</span> .cancel:
    					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><font></font>
    				}<font></font>
    		}<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//  enum,       </span>
    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">RecoveryOptions</span> </span>{
    	<span class="hljs-comment">//      (,     )</span>
    	<span class="hljs-keyword">case</span> tryAgain(action: (() -&gt; <span class="hljs-type">Void</span>))
    	<span class="hljs-keyword">case</span> cancel<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æ‚¨éœ€è¦æ˜¾ç¤ºé”™è¯¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘çœŸçš„å¾ˆå–œæ¬¢åè®®ï¼Œå› æ­¤æˆ‘å°†é€šè¿‡å®ƒä»¬è§£å†³é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨äºä»é”™è¯¯åˆ›å»ºUIAlertControllerçš„é€šç”¨åè®®ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorAlertCreatable</span>: <span class="hljs-title">class</span>, <span class="hljs-title">ErrorReasonExtractable</span> </span>{
    	<span class="hljs-comment">//     </span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error)</span></span> -&gt; <span class="hljs-type">UIAlertController</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorAlertCreatable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">UIViewController</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error)</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-comment">//      </span>
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> recoverableError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">RecoverableError</span> {
    			<span class="hljs-keyword">return</span> createRecoverableAlert(<span class="hljs-keyword">for</span>: recoverableError)<font></font>
    		}<font></font>
    		<span class="hljs-keyword">let</span> defaultTitle = <span class="hljs-string">"Error"</span>
    		<span class="hljs-keyword">let</span> description = errorReason(from: error)<font></font>
    <font></font>
    		<span class="hljs-comment">//          </span>
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> localizedError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">LocalizedError</span> {
    			<span class="hljs-keyword">return</span> createAlert(<font></font>
    				title: localizedError.errorDescription ?? defaultTitle,<font></font>
    				message: description,<font></font>
    				actions: [.okAction],<font></font>
    				aboveAll: aboveAll)<font></font>
    		}<font></font>
    <font></font>
    		<span class="hljs-keyword">return</span> createAlert(title: defaultTitle, message: description, actions: [.okAction])<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(title: String?, message: String?, actions: [UIAlertAction])</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-keyword">let</span> alertViewController = <span class="hljs-type">UIAlertController</span>(title: title, message: message, preferredStyle: .alert)<font></font>
    		actions.forEach({ alertViewController.addAction($<span class="hljs-number">0</span>) })
    		<span class="hljs-keyword">return</span> alertViewController<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createRecoverableAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> recoverableError: RecoverableError)</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-keyword">let</span> title = recoverableError.errorDescription
    		<span class="hljs-keyword">let</span> message = recoverableError.recoverySuggestion
    		<span class="hljs-comment">//     . </span>
    		<span class="hljs-keyword">let</span> actions = recoverableError.recoveryOptions.enumerated().<span class="hljs-built_in">map</span> { (element) -&gt; <span class="hljs-type">UIAlertAction</span> <span class="hljs-keyword">in</span>
    		<span class="hljs-keyword">let</span> style: <span class="hljs-type">UIAlertAction</span>.<span class="hljs-type">Style</span> = element.offset == <span class="hljs-number">0</span> ? .cancel : .<span class="hljs-keyword">default</span>
    		<span class="hljs-keyword">return</span> <span class="hljs-type">UIAlertAction</span>(title: element.element, style: style) { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span><font></font>
    			recoverableError.attemptRecovery(optionIndex: element.offset)<font></font>
    		      }<font></font>
    		}<font></font>
    		<span class="hljs-keyword">return</span> createAlert(title: title, message: message, actions: actions)<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createOKAlert</span><span class="hljs-params">(with text: String)</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-keyword">return</span> createAlert(title: text, message: <span class="hljs-literal">nil</span>, actions: [.okAction])<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ERror</span>
    
    //     <span class="hljs-title">ok</span>
    <span class="hljs-title">extension</span> <span class="hljs-title">UIAlertAction</span> </span>{
    	<span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> okAction = <span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">"OK"</span>, style: .cancel) { (<span class="hljs-number">_</span>) -&gt; <span class="hljs-type">Void</span> <span class="hljs-keyword">in</span> }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorReasonExtractable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">errorReason</span><span class="hljs-params">(from error: Error)</span></span> -&gt; <span class="hljs-type">String?</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorReasonExtractable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">errorReason</span><span class="hljs-params">(from error: Error)</span></span> -&gt; <span class="hljs-type">String?</span> {
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> localizedError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">LocalizedError</span> {
    			<span class="hljs-keyword">return</span> localizedError.recoverySuggestion<font></font>
    		}<font></font>
    		<span class="hljs-keyword">return</span> <span class="hljs-string">"Something bad happened. Please try again"</span><font></font>
    	}<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥åŠç”¨äºæ˜¾ç¤ºåˆ›å»ºçš„è­¦æŠ¥çš„åè®®ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorAlertPresentable</span>: <span class="hljs-title">class</span> </span>{
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlert</span><span class="hljs-params">(from error: Error)</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// MARK: - Default implementation</span>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorAlertPresentable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">ErrorAlertCreatable</span> &amp; <span class="hljs-title">UIViewController</span> </span>{
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlert</span><span class="hljs-params">(from error: Error)</span></span> {
		<span class="hljs-keyword">let</span> alertVC = createAlert(<span class="hljs-keyword">for</span>: error)<font></font>
		present(alertVC, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸæ¥å¾ˆéº»çƒ¦ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“ç®¡ç†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥åˆ›å»ºæ˜¾ç¤ºé”™è¯¯çš„æ–°æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œåå¸æˆ–æ˜¾ç¤ºè‡ªå®šä¹‰è§†å›¾ï¼‰å¹¶æ³¨å†Œé»˜è®¤å®ç°ï¼Œè€Œæ— éœ€åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸­è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡è®¾åè®®æ¶µç›–äº†æˆ‘ä»¬çš„è§‚ç‚¹ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ViewControllerInput</span>: <span class="hljs-title">class</span> </span>{
     <span class="hljs-comment">//  </span><font></font>
    }<font></font>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewControllerInput</span>: <span class="hljs-title">ErrorAlertPresentable</span> </span>{ }<font></font>
    <font></font>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorAlertCreatable</span> </span>{ }
    <span class="hljs-comment">//  ,         ,    </span>
    <span class="hljs-comment">//    </span><font></font>
    <font></font>
    <span class="hljs-comment">//       "",    ErrorAlertPresentable      . </span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorToastCreatable</span> </span>{ }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯æˆ‘ä»¬çš„ç¤ºä¾‹æ›´åŠ ç®€å•ï¼Œå› æ­¤æˆ‘ä»¬åŒæ—¶æ”¯æŒä¸¤ç§åè®®å¹¶è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestFeed</span><span class="hljs-params">(...)</span></span> {<font></font>
    		service.requestObject { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (result) <span class="hljs-keyword">in</span>
    			<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> `<span class="hljs-keyword">self</span>` = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
    			<span class="hljs-keyword">switch</span> result {
    			<span class="hljs-keyword">case</span> .success:
    				<span class="hljs-keyword">break</span>
    			<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
    				<span class="hljs-comment">//           </span>
    				<span class="hljs-comment">// -     (   viewController)  ,</span>
    				<span class="hljs-comment">//    .     tryAgainOption </span>
    				<span class="hljs-keyword">let</span> tryAgainOption = <span class="hljs-type">RecoveryOptions</span>.tryAgain {
    					<span class="hljs-keyword">self</span>.requestFeed(...)<font></font>
    				}<font></font>
    				<span class="hljs-keyword">let</span> recoveryOptions = [tryAgainOption]
    				<span class="hljs-keyword">let</span> attempter = <span class="hljs-type">RecoveryAttemper</span>(recoveryOptions: recoveryOptions)
    				<span class="hljs-keyword">let</span> recovableError = <span class="hljs-type">RecoverableError</span>(error: error, attempter: attempter)
    				<span class="hljs-keyword">self</span>.presentAlert(from: recovableError)<font></font>
    			}<font></font>
    		}<font></font>
    	}<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - ErrorAlertCreatable</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorAlertCreatable</span> </span>{ }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - ErrorAlertPresentable</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorAlertPresentable</span> </span>{ }</code></pre><br>
<img src="https://habrastorage.org/webt/3h/fl/vh/3hflvhmxpfkuzgskzcpe9hodl2k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¼¼ä¹ä¸€åˆ‡é¡ºåˆ©ã€‚</font><font style="vertical-align: inherit;">åˆå§‹æ¡ä»¶ä¹‹ä¸€æ˜¯2-3è¡Œã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªæ–¹ä¾¿çš„æ„é€ å‡½æ•°æ¥æ‰©å±•æˆ‘ä»¬çš„å°è¯•å™¨ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecoveryAttemper</span> </span>{
    	<span class="hljs-comment">//</span><font></font>
    	...<font></font>
    	<span class="hljs-comment">//</span>
    	<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">tryAgainAttempter</span><span class="hljs-params">(block: @escaping <span class="hljs-params">(<span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type">Void</span>)) -&gt; <span class="hljs-type">Self</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-type">RecoveryAttemper</span>(recoveryOptions: [.cancel, .tryAgain(action: block)])<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestFeed</span><span class="hljs-params">()</span></span> {<font></font>
    		service.requestObject { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (result) <span class="hljs-keyword">in</span>
    			<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> `<span class="hljs-keyword">self</span>` = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
    			<span class="hljs-keyword">switch</span> result {
    			<span class="hljs-keyword">case</span> .success:
    				<span class="hljs-keyword">break</span>
    			<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
    				<span class="hljs-comment">//    </span>
    				<span class="hljs-keyword">let</span> recovableError = <span class="hljs-type">RecoverableError</span>(error: error, attempter: .tryAgainAttempter(block: {
    					<span class="hljs-keyword">self</span>.requestFeed()<font></font>
    				}))<font></font>
    				<span class="hljs-keyword">self</span>.presentAlert(from: recovableError)<font></font>
    			}<font></font>
    		}<font></font>
    	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬è·å¾—äº†MVPè§£å†³æ–¹æ¡ˆï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®è¿›è¡Œè¿æ¥å’Œè°ƒç”¨éƒ½ä¸ä¼šå›°éš¾ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å¼€å§‹æ£€æŸ¥æç«¯æƒ…å†µå’Œå¯ä¼¸ç¼©æ€§ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬æœ‰å‡ ç§é€€å‡ºæ–¹æ¡ˆæ€ä¹ˆåŠï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡è®¾ç”¨æˆ·åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æœ‰ä¸€ä¸ªå­˜å‚¨åº“ã€‚</font><font style="vertical-align: inherit;">ä¿é™©åº“æœ‰ä½ç½®é™åˆ¶ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·æœ‰ä¸¤ç§é€€å‡ºè¯¥é”™è¯¯çš„æ–¹æ¡ˆï¼šç”¨æˆ·å¯ä»¥é‡Šæ”¾ç©ºé—´æˆ–è´­ä¹°æ›´å¤šç©ºé—´ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//  </span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">runOutOfSpace</span><span class="hljs-params">()</span></span> {<font></font>
    		service.runOfSpace { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (result) <span class="hljs-keyword">in</span>
    			<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> `<span class="hljs-keyword">self</span>` = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
    			<span class="hljs-keyword">switch</span> result {
    			<span class="hljs-keyword">case</span> .success:
    				<span class="hljs-keyword">break</span>
    			<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
    				<span class="hljs-keyword">let</span> notEnoughSpace = <span class="hljs-type">RecoveryOptions</span>.freeSpace {
    					<span class="hljs-keyword">self</span>.freeSpace()<font></font>
    				}<font></font>
    <font></font>
    				<span class="hljs-keyword">let</span> buyMoreSpace = <span class="hljs-type">RecoveryOptions</span>.buyMoreSpace {
    					<span class="hljs-keyword">self</span>.buyMoreSpace()<font></font>
    				}<font></font>
    				<span class="hljs-keyword">let</span> options = [notEnoughSpace, buyMoreSpace]
    				<span class="hljs-keyword">let</span> recovableError = <span class="hljs-type">RecoverableError</span>(error: error, attempter: .cancalableAttemter(options: options))
    				<span class="hljs-keyword">self</span>.presentAlert(from: recovableError)<font></font>
    			}<font></font>
    		}<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">freeSpace</span><span class="hljs-params">()</span></span> {
    		<span class="hljs-keyword">let</span> alertViewController = createOKAlert(with: <span class="hljs-string">"Free space selected"</span>)<font></font>
    		present(alertViewController, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buyMoreSpace</span><span class="hljs-params">()</span></span> {
    		<span class="hljs-keyword">let</span> alertViewController = createOKAlert(with: <span class="hljs-string">"Buy more space selected"</span>)<font></font>
    		present(alertViewController, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
    	}<font></font>
    <font></font>
    <font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecoveryAttemper</span> </span>{
    	<span class="hljs-comment">//</span><font></font>
    	...<font></font>
    	<span class="hljs-comment">//</span>
    	<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">cancalableAttemter</span><span class="hljs-params">(options: [RecoveryOptions])</span></span> -&gt; <span class="hljs-type">Self</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-type">RecoveryAttemper</span>(recoveryOptions: [.cancel] + options)<font></font>
    	}<font></font>
    }<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/d5/eg/zq/d5egzquyykwxtjorhevcq2pe1mg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™å¾ˆå®¹æ˜“è§£å†³ã€‚ </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨å±å¹•ä¸­é—´æ˜¾ç¤ºè­¦æŠ¥ï¼Œè€Œæ˜¯æ˜¾ç¤ºä¿¡æ¯è§†å›¾ï¼Ÿ</font></font></h3><br>
<img src="https://habrastorage.org/webt/fg/xr/pq/fgxrpqsgg_yqmy4txescavcvdvc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡ç±»æ¨å‡ ä¸ªæ–°åè®®å¯ä»¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorViewCreatable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createErrorView</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error)</span></span> -&gt; <span class="hljs-type">ErrorView</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorViewCreatable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createErrorView</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error)</span></span> -&gt; <span class="hljs-type">ErrorView</span> {
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> recoverableError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">RecoverableError</span> {
    			<span class="hljs-keyword">return</span> createRecoverableAlert(<span class="hljs-keyword">for</span>: recoverableError)<font></font>
    		}<font></font>
    <font></font>
    		<span class="hljs-keyword">let</span> defaultTitle = <span class="hljs-string">"Error"</span>
    		<span class="hljs-keyword">let</span> description = errorReason(from: error)
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> localizedError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">LocalizedError</span> {
    			<span class="hljs-keyword">return</span> createErrorView(<font></font>
    				title: localizedError.errorDescription ?? defaultTitle,<font></font>
    				message: description)<font></font>
    		}<font></font>
    		<span class="hljs-keyword">return</span> createErrorView(title: defaultTitle, message: description)<font></font>
    		}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createErrorView</span><span class="hljs-params">(title: String?, message: String?, actions: [ErrorView.Action] = [])</span></span> -&gt; <span class="hljs-type">ErrorView</span> {
    		<span class="hljs-comment">//  ErrorView        . </span>
                <span class="hljs-comment">//     github</span>
    		<span class="hljs-keyword">return</span> <span class="hljs-type">ErrorView</span>(title: title, description: message, actions: actions)<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createRecoverableAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> recoverableError: RecoverableError)</span></span> -&gt; <span class="hljs-type">ErrorView</span> {
    		<span class="hljs-keyword">let</span> title = recoverableError.errorDescription
    		<span class="hljs-keyword">let</span> message = errorReason(from: recoverableError)
    		<span class="hljs-keyword">let</span> actions = recoverableError.recoveryOptions.enumerated().<span class="hljs-built_in">map</span> { (element) -&gt; <span class="hljs-type">ErrorView</span>.<span class="hljs-type">Action</span> <span class="hljs-keyword">in</span>
    			<span class="hljs-keyword">return</span> <span class="hljs-type">ErrorView</span>.<span class="hljs-type">Action</span>(title: element.element) {<font></font>
    				recoverableError.attemptRecovery(optionIndex: element.offset)<font></font>
    			}<font></font>
    		}<font></font>
    		<span class="hljs-keyword">return</span> createErrorView(title: title, message: message, actions: actions)<font></font>
    	}<font></font>
    }</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorViewAddable</span>: <span class="hljs-title">class</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentErrorView</span><span class="hljs-params">(from error: Error)</span></span><font></font>
    <font></font>
    	<span class="hljs-keyword">var</span> errorViewSuperview: <span class="hljs-type">UIView</span> { <span class="hljs-keyword">get</span> }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorViewAddable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">ErrorViewCreatable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentErrorView</span><span class="hljs-params">(from error: Error)</span></span> {
    		<span class="hljs-keyword">let</span> errorView = createErrorView(<span class="hljs-keyword">for</span>: error)<font></font>
    		errorViewSuperview.addSubview(errorView)<font></font>
    		errorView.center = errorViewSuperview.center<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <font></font>
    <span class="hljs-comment">//    </span><font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - ErrorAlertCreatable</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorViewCreatable</span> </span>{ }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - ErrorAlertPresentable</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorViewAddable</span> </span>{
    	<span class="hljs-keyword">var</span> errorViewSuperview: <span class="hljs-type">UIView</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span><font></font>
    	}<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»¥ä¿¡æ¯è§†å›¾çš„å½¢å¼æ˜¾ç¤ºé”™è¯¯ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šå¦‚ä½•æ˜¾ç¤ºå®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥å±å¹•æ—¶å‡ºç°é”™è¯¯-æ˜¾ç¤ºä¿¡æ¯è§†å›¾ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå±å¹•åŠ è½½æˆåŠŸï¼Œä½†æ˜¯å±å¹•ä¸Šçš„æ“ä½œè¿”å›äº†é”™è¯¯-æ˜¾ç¤ºè­¦æŠ¥ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯å¦æ— æ³•è®¿é—®è§†å›¾ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰æ—¶æ‚¨éœ€è¦æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œä½†æ˜¯æ— æ³•è®¿é—®è¯¥è§†å›¾ã€‚</font><font style="vertical-align: inherit;">æˆ–è€…ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å½“å‰å“ªä¸ªè§†å›¾å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæˆ‘ä»¬æƒ³åœ¨æ‰€æœ‰è§†å›¾ä¹‹ä¸Šæ˜¾ç¤ºè­¦æŠ¥ã€‚</font><font style="vertical-align: inherit;">å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼‰æœ€ç®€å•çš„æ–¹æ³•ä¹‹ä¸€æ˜¯åšä¸Appleé”®ç›˜ç›¸åŒçš„äº‹æƒ…ã€‚</font><font style="vertical-align: inherit;">åœ¨å½“å‰å±å¹•é¡¶éƒ¨åˆ›å»ºä¸€ä¸ªæ–°çª—å£ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¼€å§‹åšå§ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@UIApplicationMain</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppDelegate</span>: <span class="hljs-title">UIResponder</span>, <span class="hljs-title">UIApplicationDelegate</span> </span>{<font></font>
<font></font>
	<span class="hljs-comment">//   â€“   . </span>
	<span class="hljs-comment">//              DI</span>
	<span class="hljs-keyword">static</span> <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> errorWindow: <span class="hljs-type">UIWindow</span> = {
		<span class="hljs-keyword">let</span> alertWindow = <span class="hljs-type">UIWindow</span>.<span class="hljs-keyword">init</span>(frame: <span class="hljs-type">UIScreen</span>.main.bounds)<font></font>
		alertWindow.backgroundColor = .clear<font></font>
<font></font>
		<span class="hljs-comment">//  rootViewController,    present   viewController</span>
		<span class="hljs-keyword">let</span> viewController = <span class="hljs-type">UIViewController</span>()<font></font>
		viewController.view.backgroundColor = .clear<font></font>
		alertWindow.rootViewController = viewController<font></font>
<font></font>
		<span class="hljs-keyword">return</span> alertWindow<font></font>
	}()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸€ä¸ªå¯ä»¥æ˜¾ç¤ºåœ¨æ‰€æœ‰å†…å®¹ä¹‹ä¸Šçš„æ–°è­¦æŠ¥ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AboveAllAlertController</span>: <span class="hljs-title">UIAlertController</span> </span>{
	<span class="hljs-keyword">var</span> alertWindow: <span class="hljs-type">UIWindow</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-type">AppDelegate</span>.alertWindow<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">show</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">let</span> topWindow = <span class="hljs-type">UIApplication</span>.shared.windows.last
		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> topWindow = topWindow {<font></font>
			alertWindow.windowLevel = topWindow.windowLevel + <span class="hljs-number">1</span><font></font>
		}<font></font>
<font></font>
		alertWindow.makeKeyAndVisible()<font></font>
		alertWindow.rootViewController?.present(<span class="hljs-keyword">self</span>, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewWillDisappear</span><span class="hljs-params">(<span class="hljs-number">_</span> animated: Bool)</span></span> {
		<span class="hljs-keyword">super</span>.viewWillDisappear(animated)<font></font>
<font></font>
		alertWindow.isHidden = <span class="hljs-literal">true</span><font></font>
	}<font></font>
}</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorAlertCreatable</span>: <span class="hljs-title">class</span> </span>{
    	<span class="hljs-comment">//      </span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error, aboveAll: Bool)</span></span> -&gt; <span class="hljs-type">UIAlertController</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorAlertCreatable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">UIViewController</span> </span>{<font></font>
    	...<font></font>
    	<span class="hljs-comment">//     </span>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(title: String?, message: String?, actions: [UIAlertAction], aboveAll: Bool)</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-keyword">let</span> alertViewController = aboveAll ?
    			<span class="hljs-type">AboveAllAlertController</span>(title: title, message: message, preferredStyle: .alert) :
    			<span class="hljs-type">UIAlertController</span>(title: title, message: message, preferredStyle: .alert)<font></font>
    		actions.forEach({ alertViewController.addAction($<span class="hljs-number">0</span>) })
    		<span class="hljs-keyword">return</span> alertViewController<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorAlertPresentable</span>: <span class="hljs-title">class</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlert</span><span class="hljs-params">(from error: Error)</span></span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlertAboveAll</span><span class="hljs-params">(from error: Error)</span></span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorAlertPresentable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">ErrorAlertCreatable</span> &amp; <span class="hljs-title">UIViewController</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlert</span><span class="hljs-params">(from error: Error)</span></span> {
    		<span class="hljs-keyword">let</span> alertVC = createAlert(<span class="hljs-keyword">for</span>: error, aboveAll: <span class="hljs-literal">false</span>)<font></font>
    		present(alertVC, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlertAboveAll</span><span class="hljs-params">(from error: Error)</span></span> {
    		<span class="hljs-keyword">let</span> alertVC = createAlert(<span class="hljs-keyword">for</span>: error, aboveAll: <span class="hljs-literal">true</span>)
    		<span class="hljs-comment">//         </span>
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> alertVC = alertVC <span class="hljs-keyword">as</span>? <span class="hljs-type">AboveAllAlertController</span> {<font></font>
    			alertVC.show()<font></font>
    			<span class="hljs-keyword">return</span><font></font>
    		}<font></font>
    		<span class="hljs-comment">//    ,  - </span>
    		<span class="hljs-built_in">assert</span>(<span class="hljs-literal">false</span>, <span class="hljs-string">"Should create AboveAllAlertController"</span>)<font></font>
    		present(alertVC, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
    	}<font></font>
    }</code></pre><br>
<img src="https://habrastorage.org/webt/qr/es/uo/qresuobexdwaxevl3gnmsfjsc6i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å¤–è§‚ä¸Šï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æ‘†è„±äº†è§†å›¾æ§åˆ¶å™¨çš„å±‚æ¬¡ç»“æ„ã€‚</font><font style="vertical-align: inherit;">æˆ‘å¼ºçƒˆå»ºè®®æ‚¨ä¸è¦é”™è¿‡è¿™ä¸ªæœºä¼šã€‚</font><font style="vertical-align: inherit;">æœ€å¥½åœ¨å…·æœ‰ç›¸åŒæƒé™çš„è·¯ç”±å™¨æˆ–å®ä½“ä¸­è°ƒç”¨æ˜¾ç¤ºä»£ç ã€‚</font><font style="vertical-align: inherit;">ä»¥é€æ˜å’Œæ¸…æ™°çš„åä¹‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå‡ºè‰²çš„å·¥å…·ï¼Œå¯ä»¥åœ¨å‘ç”Ÿæ•…éšœï¼Œç»´æŠ¤ç­‰è¿‡ç¨‹ä¸­å‘æœåŠ¡å™¨å‘é€åƒåœ¾é‚®ä»¶ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥æ”¹å–„ä»€ä¹ˆï¼Ÿ</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€çŸ­è¦æ±‚æ—¶é—´</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡è®¾æˆ‘ä»¬å…³é—­äº’è”ç½‘ï¼Œç„¶åå†è¯•ä¸€æ¬¡ã€‚</font><font style="vertical-align: inherit;">è¿è¡ŒåŠ è½½ç¨‹åºã€‚</font><font style="vertical-align: inherit;">ç­”æ¡ˆå°†ç«‹å³å‡ºç°å¹¶è·å¾—ä¸€ä¸ªè¿·ä½ æ¸¸æˆâ€œ Clickerâ€ã€‚</font><font style="vertical-align: inherit;">å…·æœ‰é—ªçƒçš„åŠ¨ç”»ã€‚</font><font style="vertical-align: inherit;">ä¸å¤ªå¥½ </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/3n/mu/uz3nmu7_ag_k4swmsiy8gw2y1z0.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬å°†å³æ—¶é”™è¯¯å˜æˆä¸€ä¸ªè¿‡ç¨‹ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•-æˆ‘ä»¬å°†ä½¿è¯·æ±‚æ—¶é—´æœ€çŸ­ã€‚</font><font style="vertical-align: inherit;">è¿™é‡Œçš„å®ç°å–å†³äºæ‚¨çš„è”ç½‘æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å‡è®¾æˆ‘ä½¿ç”¨Operationï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DelayOperation</span>: <span class="hljs-title">AsyncOperation</span> </span>{
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> _delayTime: <span class="hljs-type">Double</span><font></font>
<font></font>
	<span class="hljs-keyword">init</span>(delayTime: <span class="hljs-type">Double</span> = <span class="hljs-number">0.3</span>) {<font></font>
		_delayTime = delayTime<font></font>
	}<font></font>
	<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">super</span>.main()<font></font>
<font></font>
		<span class="hljs-type">DispatchQueue</span>.global().asyncAfter(deadline: .now() + _delayTime) {
			<span class="hljs-keyword">self</span>.state = .finished<font></font>
		}<font></font>
	}<font></font>
}<font></font>
		<font></font>
<span class="hljs-comment">// -  </span>
<span class="hljs-keyword">let</span> flowListOperation = flowService.list(<span class="hljs-keyword">for</span>: pageID, path: path, limiter: limiter)
<span class="hljs-keyword">let</span> handler = createHandler(<span class="hljs-keyword">for</span>: flowListOperation)
<span class="hljs-keyword">let</span> delayOperation = <span class="hljs-type">DelayOperation</span>(delayTime: <span class="hljs-number">0.5</span>)
<span class="hljs-comment">///  &gt;&gt;&gt;  addDependency. </span><font></font>
[flowListOperation, delayOperation] &gt;&gt;&gt; handler<font></font>
operationQueue.addOperations([flowListOperation, delayOperation, handler])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºä¸€èˆ¬æƒ…å†µï¼Œæˆ‘å¯ä»¥æä¾›ä»¥ä¸‹è®¾è®¡ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//  global      </span>
<span class="hljs-type">DispatchQueue</span>.global().asyncAfter(deadline: .now() + <span class="hljs-number">0.15</span>) {
    <span class="hljs-comment">// your code here</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ–è€…æˆ‘ä»¬å¯ä»¥å¯¹å¼‚æ­¥æ“ä½œè¿›è¡ŒæŠ½è±¡å¹¶ä¸ºå…¶æ·»åŠ å¯ç®¡ç†æ€§ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Task</span> </span>{
    	<span class="hljs-keyword">let</span> closure: () -&gt; <span class="hljs-type">Void</span><font></font>
    <font></font>
    	<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _delayTime: <span class="hljs-type">Double?</span><font></font>
    <font></font>
    	<span class="hljs-keyword">init</span>(closure: @escaping () -&gt; <span class="hljs-type">Void</span>) {
    		<span class="hljs-keyword">self</span>.closure = closure<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-keyword">init</span>(closure: @escaping () -&gt; <span class="hljs-type">Void</span>, time: <span class="hljs-type">Double</span>) {
    		<span class="hljs-keyword">self</span>.closure = closure<font></font>
    		_delayTime = time<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-meta">@discardableResult</span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Self</span> {
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> delayTime = _delayTime {
    			<span class="hljs-type">DispatchQueue</span>.global().asyncAfter(deadline: .now() + delayTime) {
    				<span class="hljs-keyword">self</span>.closure()<font></font>
    			}<font></font>
    			<span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span><font></font>
    		}<font></font>
    		closure()<font></font>
    		<span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span><font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">delayedTask</span><span class="hljs-params">(time: Double)</span></span> -&gt; <span class="hljs-type">Self</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-type">Task</span>(closure: closure, time: time)<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestObject</span><span class="hljs-params">(completionHandler: @escaping <span class="hljs-params">(<span class="hljs-params">(Result&lt;Bool, Error&gt;)</span></span></span></span> -&gt; <span class="hljs-type">Void</span>)) -&gt; <span class="hljs-type">Task</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-type">Task</span> {<font></font>
    			completionHandler(.failure(<span class="hljs-type">NetworkError</span>.internetError))<font></font>
    		}<font></font>
    			.delayedTask(time: <span class="hljs-number">0.5</span>)<font></font>
    		.run()<font></font>
    	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œå³ä½¿ç¦»çº¿ï¼Œæˆ‘ä»¬çš„åŠ¨ç”»ä¹Ÿä¸ä¼šæ˜¾å¾—é‚£ä¹ˆæ¸…æ™°ã€‚</font><font style="vertical-align: inherit;">æˆ‘å»ºè®®åœ¨å¤§å¤šæ•°å¸¦æœ‰åŠ¨ç”»çš„åœ°æ–¹ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9k/oq/46/9koq46qq0wffoivy0ucs18om1cm.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºé£è¡Œæ¨¡å¼ï¼Œæœ€å¥½æ˜¾ç¤ºè­¦æŠ¥æç¤ºï¼ˆç”¨æˆ·å¯èƒ½ä¼šå¿˜è®°å…³é—­è¯¥æ¨¡å¼ä»¥å¼€å§‹ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºï¼‰ã€‚</font><font style="vertical-align: inherit;">å°±åƒç”µæŠ¥ä¸€æ ·ã€‚</font><font style="vertical-align: inherit;">å¯¹äºé‡è¦çš„æŸ¥è¯¢ï¼Œæœ€å¥½å…ˆåœ¨å¼•æ“ç›–ä¸‹é‡å¤å‡ æ¬¡ï¼Œç„¶åå†æ˜¾ç¤ºè­¦æŠ¥...ä½†æ˜¯ï¼Œä¸‹æ¬¡å†è¯´å§ï¼š)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯æµ‹æ€§</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“æ‰€æœ‰é€»è¾‘éƒ½è½¬å‚¨åˆ°viewControllerä¸­æ—¶ï¼ˆå¦‚æˆ‘ä»¬ç°åœ¨æ‰€è¿°ï¼‰ï¼Œå¾ˆéš¾è¿›è¡Œæµ‹è¯•ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„viewControllerä¸ä¸šåŠ¡é€»è¾‘å…±äº«ï¼Œåˆ™æµ‹è¯•å°†æˆä¸ºä¸€é¡¹çç¢çš„ä»»åŠ¡ã€‚</font><font style="vertical-align: inherit;">è½»å¼¹ä¸€ä¸‹</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è£¤å­ï¼Œ</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸šåŠ¡é€»è¾‘å°±ä¼šå˜æˆï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestFeed</span><span class="hljs-params">()</span></span> {<font></font>
		service.requestObject { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (result) <span class="hljs-keyword">in</span>
			<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> `<span class="hljs-keyword">self</span>` = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
			<span class="hljs-keyword">switch</span> result {
			<span class="hljs-keyword">case</span> .success:
				<span class="hljs-keyword">break</span>
			<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
				<span class="hljs-type">DispatchQueue</span>.main.async {
					<span class="hljs-keyword">let</span> recoverableError = <span class="hljs-type">RecoverableError</span>(error: error, attempter: .tryAgainAttempter(block: {
						<span class="hljs-keyword">self</span>.requestFeed()<font></font>
					}))<font></font>
					<span class="hljs-comment">//     </span>
					<span class="hljs-keyword">self</span>.viewInput?.presentAlert(from: recoverableError)<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	}</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-comment">// -  </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testRequestFeedFailed</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// Put out mock that conform to AlertPresntable protocol</span>
	controller.viewInput = <span class="hljs-type">ViewInputMock</span>()<font></font>
<font></font>
	<span class="hljs-comment">//  .    ,    </span>
	<span class="hljs-comment">//    expectation</span><font></font>
	controller.requestFeed()<font></font>
<font></font>
	<span class="hljs-comment">// Our mocked object should save to true to bool variable when method called</span>
	<span class="hljs-type">XCTAssert</span>(controller.viewInput.presentAlertCalled)
	<span class="hljs-comment">// Next we could compare recoverable error attempter to expected attempter</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸æœ¬æ–‡ä¸€èµ·ï¼Œæˆ‘ä»¬ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ¶ä½œäº†æ–¹ä¾¿çš„è­¦æŠ¥æ˜¾ç¤ºæœºåˆ¶</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºç”¨æˆ·æä¾›é‡è¯•å¤±è´¥æ“ä½œçš„é€‰é¡¹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°è¯•é€šè¿‡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ”¹å–„ç”¨æˆ·ä½“éªŒ</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â†’&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“¾æ¥åˆ°ä»£ç </font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è°¢è°¢æ‚¨çš„å®è´µæ—¶é—´ï¼Œæˆ‘å¾ˆä¹æ„åœ¨è¯„è®ºä¸­å›ç­”æ‚¨çš„é—®é¢˜ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN495336/index.html">ä¸å’Œè°ä¸ä»…æ˜¯ä¼ä¸šçš„ä½¿è€…ï¼Œ</a></li>
<li><a href="../zh-CN495338/index.html">åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯åŠ¨å®¹å™¨å’ŒKubernetesçš„æœ€ä½³å®è·µå’ŒæŒ‡å—</a></li>
<li><a href="../zh-CN495340/index.html">å¦‚ä½•æ›´æ”¹é¤å…ç®¡ç†å‘˜çš„å·¥ä½œä»¥ä½¿å…¶åœ¨ITæ–¹é¢è¡¨ç°å‡ºè‰²</a></li>
<li><a href="../zh-CN495342/index.html">äº¤æ˜“ä¸­é“¶è¡Œå¡çš„ç»“ç®—-åœ¨Google Data Studioä¸­åˆ›å»ºä¸€ä¸ªå¼€æ”¾çš„æ•°æ®é›†å’Œä¿¡æ¯å›¾</a></li>
<li><a href="../zh-CN495344/index.html">ç»Ÿä¸€å®ƒï¼šLamodaå¦‚ä½•ä½¿å…¶GoæœåŠ¡ä¿æŒä¸€è‡´</a></li>
<li><a href="../zh-CN499818/index.html">ä¹Œå…¹åˆ«å…‹ç”µæŠ¥è¥é”€</a></li>
<li><a href="../zh-CN499820/index.html">ä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©Kotlinä½œä¸ºæˆ‘ä»¬çš„ç›®æ ‡è¯­è¨€ä¹‹ä¸€ã€‚ç¬¬2éƒ¨åˆ†ï¼šKotlinå¤šå¹³å°</a></li>
<li><a href="../zh-CN499822/index.html">æ— çº¿æ¥å…¥ç‚¹ä¸è·¯ç”±å™¨ï¼šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li>
<li><a href="../zh-CN499824/index.html">2020å¹´5æœˆäººåŠ›èµ„æºå’ŒITæ‹›è˜äººå‘˜çš„äº‹ä»¶æ‘˜è¦</a></li>
<li><a href="../zh-CN499826/index.html">è¡€å‹åˆ†å¸ƒ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>