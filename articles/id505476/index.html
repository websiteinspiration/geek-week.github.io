<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⬛️ 👨‍👦‍👦 🏓 API CRUD di Deno dan PostegreSQL: bekerja dengan dinosaurus 🤛🏾 🚵🏻 🐒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Untuk mengantisipasi dimulainya kursus "Pengembang JavaScript Fullstack" , kami ingin membagikan beberapa materi menarik yang dikirim o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>API CRUD di Deno dan PostegreSQL: bekerja dengan dinosaurus</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/505476/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya. </font><font style="vertical-align: inherit;">Untuk mengantisipasi dimulainya kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pengembang JavaScript Fullstack"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kami ingin membagikan beberapa materi menarik yang dikirim oleh penulis lepas kami. </font><font style="vertical-align: inherit;">Artikel ini tidak terkait dengan program kursus, tetapi tentu akan menarik sebagai ulasan singkat tentang Deno.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/1a/5g/sq/1a5gsqglaelsf8jja4zdr0jslbw.png"><br>
<br>
<hr><br>
<blockquote>"-,    CLI   Deno .    secure runtime ?"<br>
"-"<br>
"-,     ,   ,    -  .   ?"<br>
"-"</blockquote><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halo semuanya. </font><font style="vertical-align: inherit;">Deno menjadi semakin terkenal dan populer, ada sejumlah besar video dan panduan teks baru tentang hal ini, tetapi terutama dalam bahasa Inggris. </font><font style="vertical-align: inherit;">Beberapa artikel tentang Deno juga diterbitkan di Habré, misalnya, di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi sebagian besar artikel berbicara tentang Deno secara teoritis. </font><font style="vertical-align: inherit;">Hari ini kami akan mencoba membuat CRUD Api kecil yang dapat berfungsi, misalnya, aplikasi todo di frontend, dan saya akan membagikan kepada Anda kesan saya tentang dinosaurus ini dalam pengkodean nyata.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pengantar teoritis </font></font></h1><br>
<img src="https://habrastorage.org/webt/ou/cz/_q/oucz_qc3vym7u2ftdzkcgnt65pi.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi mereka yang ada di dalam tangki, saya akan memberi tahu Anda apa Deno itu, jika Anda belum membaca, misalnya, salah satu artikel di atas. Deno adalah runtime runtime yang berjalan pada JavaScript dan TypeScript (TypeScript didukung di luar kotak, versi kompiler TypeScript bawaan untuk versi Deno, Anda hanya dapat mengubahnya jika Anda mengubah versi Deno), yang didasarkan pada mesin V8 dan bahasa pemrograman Rust. Deno diciptakan oleh Ryan Dahl, pencipta Node.js, dan kualitas utama Deno adalah kinerja dan keamanan. Deno diumumkan pada tahun 2018, dan banyak sumber lupa menyebutkannya - sangat dipengaruhi oleh Golang (dan memang pada awalnya ditulis dalam Golang, tetapi kemudian harus ditulis ulang dalam Rust).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pustaka standar dibuat pada model pustaka Go standar, dan banyak alat atau implementasinya beralih dari Golang ke Deno, misalnya, kurangnya ekosistem seperti npm dan pemompaan perpustakaan langsung dari sumber daya web pada tahap perakitan awal (yang menyebabkan semacam kekakuan di Node. js dari pengembang yang, tentu saja, tidak terbiasa dengan sistem yang mirip dengan Go). </font><font style="vertical-align: inherit;">Jadi untuk siapa Deno sekarang? </font><font style="vertical-align: inherit;">Jika Anda suka bahasa yang diketik, seperti ide dan alat Golang, tetapi ingin menulis dukungan pada sesuatu yang lebih sederhana - inilah saatnya untuk mencoba Deno dalam kenyataan. </font><font style="vertical-align: inherit;">Namun, jika Anda ingin menunggu hingga platform matang, lebih banyak perpustakaan dan jawaban untuk StackOverflow akan muncul, mungkin Anda harus menunggu sedikit.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mulai membuat </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlepas dari masa muda Deno, beberapa jenis ekosistem berhasil terbentuk di sekitarnya (yang, tentu saja, belum dapat dibandingkan dengan ekosistem Node.js), yang memungkinkan Anda untuk memenuhi kebutuhan dasar untuk membuat API Anda sendiri. </font><font style="vertical-align: inherit;">Mari kita putuskan apa yang kita buat: Saya ingin membuat CRUD Api sederhana menggunakan Deno dan TypeScript di backend (karena ada dukungan TypeScript, mengapa tidak menggunakannya), PostgreSQL sebagai database (secara umum, saya ingin menggunakan MySQL, tetapi tidak sengaja merusak akses saya di localhost dan tidak bisa memperbaikinya. Fakta yang menarik adalah bahwa pada ip eksternal, server built-in PHP 7.4 dapat terhubung ke database MySQL saya, dan Deno menunjukkan paket-paket yang rusak), dan permintaan kami akan terlihat seperti ini:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> metode </font></font></b></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rute </font></font></b></td>
<td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hasil eksekusi </font></font></b></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dapatkan </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos / get</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mendapatkan semua yang harus dilakukan </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pos </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos / post</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Menciptakan bisnis baru </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PATCH </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos /: id</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Memperbarui kasus tertentu </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MENGHAPUS </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos /: id</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hapus huruf besar-kecil oleh id </font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, kami memutuskan skema kueri, kami meluncurkan server PostgreSQL (jika Anda dapat mengunduhnya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , itu adalah klien </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postico</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GUI yang sangat bagus </font><font style="vertical-align: inherit;">), kami menciptakan basis data crud_api. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Apa berikutnya? </font><font style="vertical-align: inherit;">Anda dapat membuat tabel dengan tangan Anda menggunakan kueri sql atau klien, tentu saja, tetapi saya ingin melihat bagaimana dengan migrasi Deno. </font><font style="vertical-align: inherit;">Dalam hal ini </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">perpustakaan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nessia berguna</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang memungkinkan Anda untuk membuat migrasi yang mirip dengan migrasi di Laravel. </font><font style="vertical-align: inherit;">Tetapi sebelum kita masuk ke migrasi, mari kita bicara tentang mengatur lingkungan pengembangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa hari yang lalu, plugin pengembangan JetBrains Deno resmi dirilis. </font><font style="vertical-align: inherit;">Anda dapat menemukannya di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pada Visual Studio, Anda perlu menginstal plugin Deno, dan dalam folder proyek buat folder </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.vscode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> settings </font><font style="vertical-align: inherit;">, di mana di settings.json Anda mengaktifkan dukungan deno (tetapi tampaknya berhasil bagi saya tanpa itu):</font></font><br>
<br>
<pre><code class="json hljs">    <span class="hljs-string">"deno.enable"</span>:<span class="hljs-literal">true</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu semua dengan tahap persiapan, kita dapat kembali ke migrasi. </font><font style="vertical-align: inherit;">Pertama kita perlu memasukkan perintah inisialisasi, mengambilnya dari dokumentasi perpustakaan mereka:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read --allow-write https://deno.land/x/nessie/cli.ts init
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membuat file konfigurasi untuk pustaka kami, dengan bantuan kami dapat menentukan DBMS dan database yang akan Anda sambungkan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awalnya, tiga templat dibuat dalam file - untuk PostgreSQL, MySQL dan Sqlite (secara default, pengaturan untuk PostegreSQL diekspor). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akibatnya, file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nessie.config.ts</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami </font><font style="vertical-align: inherit;">akan terlihat seperti ini:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { ClientPostgreSQL} <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/nessie/mod.ts"</span>; <font></font>
<font></font>
<span class="hljs-keyword">const</span> migrationFolder = <span class="hljs-string">"./migrations"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> configPg = {
  <span class="hljs-attr">client</span>: <span class="hljs-keyword">new</span> ClientPostgreSQL(migrationFolder, {
    <span class="hljs-attr">database</span>: <span class="hljs-string">"deno_crud"</span>,
    <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,
    <span class="hljs-attr">user</span>: <span class="hljs-string">"isakura313"</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">""</span>,<font></font>
  }),<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> configPg;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, sekarang Anda dapat membuat file migrasi sehingga Anda dapat mengeditnya dengan menentukan tabel mana dan data apa yang akan kita buat. </font><font style="vertical-align: inherit;">Untuk melakukan ini, masukkan perintah berikut:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read --allow-write https://deno.land/x/nessie/cli.ts make create_todo
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin pembaca yang tidak berpengalaman sudah memiliki pertanyaan tentang mengapa begitu banyak bendera. </font><font style="vertical-align: inherit;">Ini aman di Deno - untuk menjalankan perintah, Anda harus menentukan tingkat akses yang Anda berikan ( </font></font><strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini adalah sistem keamanan yang kami tunggu</font></font></strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Bendera-bendera ini menyebabkan banyak pembakaran yang cukup tajam - apakah perlu dicetak? </font><font style="vertical-align: inherit;">Tambahkan skrip bash di mana Anda selalu memohonnya dengan hak penuh? </font><font style="vertical-align: inherit;">Saya pikir pada titik tertentu sistem ini akan berubah, tetapi untuk saat ini, sebagaimana adanya. </font><font style="vertical-align: inherit;">Dengan demikian, </font></font><code>.migrations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file migrasi akan muncul </font><font style="vertical-align: inherit;">di folder kami </font><font style="vertical-align: inherit;">, yang dapat Anda edit saat Anda pergi. </font><font style="vertical-align: inherit;">Saya mengeditnya sebagai berikut:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> up = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"CREATE TABLE todo (id serial, text text, done boolean)"</span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> down = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"DROP TABLE todo"</span><font></font>
};<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, kita bisa bermigrasi ke database menggunakan perintah berikut:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read https://deno.land/x/nessie/cli.ts migrate
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada opsi migrasi yang lebih maju di nessia, tetapi saya memutuskan untuk membuat segalanya lebih mudah. </font><font style="vertical-align: inherit;">Selanjutnya kita dapat melanjutkan untuk membuat model kita sendiri.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami bekerja dengan Model</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Kami membuat folder </font></font><code>models</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di mana kami akan memiliki permintaan sendiri. </font><font style="vertical-align: inherit;">Pertama, Anda perlu membuat file </font></font><code>config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di mana pengaturan untuk menghubungkan ke database akan ditambahkan (ya, kami telah menyebutkannya </font></font><code>nessie.config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tetapi file itu digunakan untuk migrasi). </font><font style="vertical-align: inherit;">Untuk koneksi dalam file </font></font><code>config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kita akan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perpustakaan deno-posgres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Akibatnya, file konfigurasi akan terlihat seperti ini:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Client } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/postgres/mod.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Client({
  <span class="hljs-attr">user</span>: <span class="hljs-string">"isakura313"</span>,
  <span class="hljs-attr">database</span>: <span class="hljs-string">"deno_crud"</span>,
  <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
  <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,<font></font>
});<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> client;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baik! </font><font style="vertical-align: inherit;">Sekarang kita beralih langsung ke model. </font><font style="vertical-align: inherit;">Untuk membangun kueri sql saya akan menggunakan perpustakaan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , port perpustakaan Knex di Deno. </font><font style="vertical-align: inherit;">Ini akan memungkinkan saya untuk menentukan secara kueri sql mana yang akan saya jalankan. </font><font style="vertical-align: inherit;">Mari kita mulai dengan menentukan dialek Dex mana yang harus digunakan saat ini, dan mendefinisikan antarmuka todo kita:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> dex = Dex({ <span class="hljs-attr">client</span>: <span class="hljs-string">"postgres"</span> });<font></font>
<font></font>
interface Todo {<font></font>
  id?: number;   <span class="hljs-comment">//? -     TypeScript</span><font></font>
  text: string;<font></font>
  done: boolean;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, sekarang kita bisa melanjutkan ke pulp itu sendiri. </font><font style="vertical-align: inherit;">Pertama, tentukan permintaan get yang akan menerima semua todo. </font><font style="vertical-align: inherit;">Saya akan menggunakan eksekusi fungsi asinkron untuk terhubung ke database melalui menunggu dan mendapatkan hasil permintaan:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllTodo</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).toString();
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
  <span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda bahkan sedikit terbiasa dengan TypeScript dan menunggu, Anda tidak akan memiliki pertanyaan apa pun di sini. </font><font style="vertical-align: inherit;">Tetapi lebih jauh lagi - kita perlu menulis post-request yang akan menambahkan case ke database.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTodo</span>(<span class="hljs-params">todo: Todo</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> insertQuery = dex.queryBuilder().insert([todo]).into(<span class="hljs-string">"todo"</span>).toString();
  <span class="hljs-keyword">return</span> client.query(insertQuery).then(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).where(<font></font>
      { <span class="hljs-attr">text</span>: todo.text },<font></font>
    ).toString();<font></font>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
    <span class="hljs-keyword">const</span> result_data = result.rows ? result.rows[<span class="hljs-number">0</span>] : {};
    <span class="hljs-keyword">return</span> result_data;<font></font>
  });<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode di atas dapat disingkat, namun, saya mencoba membuatnya sesederhana dan se ekspresif mungkin, bahkan merugikan jumlah baris. </font><font style="vertical-align: inherit;">Secara umum, berikut ini terjadi di sana - di dalam fungsi, kami membuat koneksi ke database, menyisipkan - permintaan dibangun, permintaan terjadi, di dalam mana permintaan baru dibuat, yang mengembalikan kasing yang baru dibuat atau objek kosong. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi lainnya - mengedit dan menghapus, saya akan berikan bersama. </font><font style="vertical-align: inherit;">Dalam mengedit, hal yang sama terjadi pada kita seperti menambahkan kasus, kecuali bahwa kita memiliki pembaruan di editTodo. </font><font style="vertical-align: inherit;">Dalam hapus, kami cukup menghapus kasing dan tidak mengembalikan apa pun:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editTodo</span>(<span class="hljs-params">id: number, todo: Todo</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> editQuery = dex.queryBuilder().from(<span class="hljs-string">"todo"</span>).update(todo).where({ id })<font></font>
    .toString();<font></font>
  <span class="hljs-keyword">return</span> client.query(editQuery).then(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).where(<font></font>
      { <span class="hljs-attr">text</span>: todo.text },<font></font>
    ).toString();<font></font>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
    <span class="hljs-keyword">const</span> result_data = result.rows ? result.rows[<span class="hljs-number">0</span>] : {};
    <span class="hljs-keyword">return</span> result_data;<font></font>
  });<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteTodo</span>(<span class="hljs-params">id: number</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> deleteQuery = dex.queryBuilder().from(<span class="hljs-string">"todo"</span>).delete().where({ id })<font></font>
    .toString();<font></font>
  <span class="hljs-keyword">return</span> client.query(deleteQuery);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wow. </font><font style="vertical-align: inherit;">Tetap hanya untuk mengekspor fungsi kami, dan Anda dapat mulai mengonfigurasi server dan perutean:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> {<font></font>
  addTodo,<font></font>
  getAllTodo,<font></font>
  editTodo,<font></font>
  deleteTodo,<font></font>
};<font></font>
<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Routing dan operasi server </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buat folder rute di mana kita akan memiliki route.ts. </font><font style="vertical-align: inherit;">Untuk mengerjakan rute kami, kami akan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denotrain</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , perpustakaan yang terinspirasi oleh expressJS dan diizinkan untuk bekerja dengan permintaan url, mengonfigurasi perutean dan banyak hal berguna. </font><font style="vertical-align: inherit;">Kami mengimpor fungsi dan Router kami:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Router } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/denotrain@v0.5.0/mod.ts"</span>;
<span class="hljs-keyword">import</span> { addTodo, getAllTodo, editTodo, deleteTodo } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/models.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> Router();
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan metode mendapatkan dan memposting:</font></font><br>
<br>
<pre><code class="javascript hljs">api.get(<span class="hljs-string">"/"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">return</span> getAllTodo().then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> result.rows;
    <span class="hljs-comment">// </span><font></font>
  });<font></font>
});<font></font>
<font></font>
api.post(<span class="hljs-string">"/"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">const</span> body = {
  <span class="hljs-comment">//  </span>
    <span class="hljs-attr">text</span>: ctx.req.body.text,
    <span class="hljs-attr">done</span>: ctx.req.body.done,<font></font>
  };<font></font>
<font></font>
  <span class="hljs-keyword">return</span> addTodo(body).then(<span class="hljs-function">(<span class="hljs-params">newTodo</span>) =&gt;</span> {<font></font>
    ctx.res.setStatus(<span class="hljs-number">201</span>); <span class="hljs-comment">//   "Created"</span>
    <span class="hljs-keyword">return</span> newTodo;<font></font>
  });<font></font>
});<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ctx adalah variabel yang bertanggung jawab untuk konteks respons. </font><font style="vertical-align: inherit;">Saya tidak tahu apa yang harus ditambahkan ke komentar, menurut saya, semuanya sudah sangat jelas. </font><font style="vertical-align: inherit;">Tinggal menambahkan patch dan menghapus metode dan mengekspor api kami:</font></font><br>
<br>
<pre><code class="javascript hljs">api.patch(<span class="hljs-string">"/:id"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">const</span> todo = {
    <span class="hljs-attr">text</span>: ctx.req.body.text,
    <span class="hljs-attr">done</span>: ctx.req.body.done,<font></font>
  };<font></font>
<font></font>
  <span class="hljs-keyword">return</span> editTodo(ctx.req.params.id <span class="hljs-keyword">as</span> number, todo).then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> result;<font></font>
  });<font></font>
});<font></font>
<font></font>
api.delete(<span class="hljs-string">"/:id"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">return</span> deleteTodo(ctx.req.params.id <span class="hljs-keyword">as</span> number).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    ctx.res.setStatus(<span class="hljs-number">204</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  });<font></font>
});<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> api;<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetap hanya untuk meningkatkan server kami. </font><font style="vertical-align: inherit;">Di folder root, buat file </font></font><code>server.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di mana kami juga mengimpor Aplikasi dari denotrain untuk meningkatkan server kami:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> {Application} <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/denotrain@v0.5.0/mod.ts"</span>;
<span class="hljs-keyword">import</span> api <span class="hljs-keyword">from</span> <span class="hljs-string">"./routes/routes.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Application({<span class="hljs-attr">port</span>: <span class="hljs-number">1337</span>}) <span class="hljs-comment">//      1337</span><font></font>
<font></font>
app.use(<span class="hljs-string">"/api/todos"</span>, api) <span class="hljs-comment">//  ,      </span>
app.run() <span class="hljs-comment">//  </span>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ada kemungkinan bahwa Anda akan memiliki masalah dalam aplikasi. </font><font style="vertical-align: inherit;">Saya tidak ingin me-restart server yang dikompilasi secara manual setiap kali, jadi saya menggunakan analog nodemon - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denomon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang dengan setia akan mengkompilasi ulang kode Anda dan me-restart server. </font><font style="vertical-align: inherit;">Dalam kasus kami, perintah berikut cocok:</font></font><br>
<br>
<pre><code class="bash hljs">denomon --allow net,<span class="hljs-built_in">read</span> server.ts
 </code></pre><br>
 <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesan saya </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Saya sangat menikmati menulis di Deno. Meskipun ada skeptisisme dalam arahannya, dengan bantuan TypeScript dan lingkungan pengembangan yang dibangun dengan baik, Anda dapat mencapai hasil yang bagus dalam menulis layanan yang sangat andal yang akan bekerja semampu yang dapat diprediksi. Masih ada ruang untuk tumbuh (misalnya, dalam kecepatan mengkompilasi ulang proyek) dan masih terlalu dini untuk mencoba menggunakan Deno untuk produksi serius, tetapi saya berharap dinosaurus akan dapat mengadopsi yang terbaik dari Node.js, sedikit mengubah keanehan arsitektur, dan melanjutkan pengembangannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu saja dalam membuat API kami. Anda dapat menemukan seluruh proyek di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Anda dapat membuka tukang pos dan memverifikasi bahwa semuanya berfungsi dengan benar. Secara tradisional, beberapa tautan bermanfaat: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST microframework untuk Deno tanpa ketergantungan </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejs-engine untuk Deno</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">    Deno</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> Deno  Discord</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  Chat App  Deno + React</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">    Deno  </a><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   </a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id505460/index.html">Membayar untuk pengkodean: Sarjana Rusia dapat memenangkan beasiswa untuk belajar untuk gelar master di Swiss</a></li>
<li><a href="../id505462/index.html">Pusat data mikro: mengapa kita membutuhkan pusat data miniatur?</a></li>
<li><a href="../id505468/index.html">Pengarsipan Email dalam Zimbra Collaboration Suite Open-Source Edition</a></li>
<li><a href="../id505470/index.html">Catatan manajer pengetahuan. Bagaimana Exness Knowledge Management Bekerja</a></li>
<li><a href="../id505472/index.html">Posting yang berguna: Instal OpenShift, pelajari Kafka, gunakan Ansible di Google Cloud Platform</a></li>
<li><a href="../id505478/index.html">Mengganti sistem CRM dengan sistem CRM</a></li>
<li><a href="../id505488/index.html">12 tips untuk mengimplementasikan TypeScript di Bereaksi aplikasi</a></li>
<li><a href="../id505494/index.html">Pembingkaian Pengembang</a></li>
<li><a href="../id505496/index.html">Flutter Dev Podcast dengan CTO Meduza Boris Goryachev: hal utama tentang aplikasi Meduz dan pengembangan media</a></li>
<li><a href="../id505498/index.html">Bagaimana kami memecahkan masalah memori tumpukan tidak diinisialisasi pada Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>