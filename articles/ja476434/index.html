<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♏️ 🕜 🙆🏽 放棄されたデバイス用のUSBドライバーの作成 🙊 🖕 🔡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近eBayで、興味深いUSBデバイス（Epiphan VGA2USB LR）のバッチに出会いました。これは、VGA入力を受信し、ビデオをWebカメラとしてUSBに送信します。私はVGAモニターに二度と迷惑をかける必要がないという考えにとても喜び、Linuxのサポートが宣言されたので、私はチャンスを...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>放棄されたデバイス用のUSBドライバーの作成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476434/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ko/58/4t/ko584thwb5si-do2bof-snfagjc.jpeg" width="550"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近eBayで、興味深いUSBデバイス（Epiphan VGA2USB LR）のバッチに出会いました。これは、VGA入力を受信し、ビデオをWebカメラとしてUSBに送信します。私はVGAモニターに二度と迷惑をかける必要がないという考えにとても喜び、Linuxのサポートが宣言されたので、私はチャンスを利用してバッチ全体を約20ポンド（25米ドル）で購入しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージを受け取った後、デバイスを接続しましたが、システムに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UVC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として表示されるとは思われませんでした</font><font style="vertical-align: inherit;">。どうしましたか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メーカーのウェブサイトを調べたところ、作業には特別なドライバーが必要であることがわかりました。私の場合、これは新しい概念でした。私のLinuxディストリビューションのカーネルには通常、すべてのデバイス用のドライバーがあるからです。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、これらのデバイスのみのドライバーサポートはLinux 4.9で終了しました。そのため、私のシステムには表示されません（Linux 4.19のDebian 10またはLinux 5.0のLTS Ubuntuの最新バージョン）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、それは修正できますよね？もちろん、ファイル</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はDKMSパッケージ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に入ってい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。これは、必要に応じて、多くの通常のドライバーと同様に、ソースコードからドライバーを収集します... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悲しいです。しかし、ここではそうではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージ内には、プリコンパイルされたバイナリしかありませんでした</font></font><code>vga2usb.o</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。私はそれを研究し始め、リバースエンジニアリングの複雑さを疑問に思い、いくつかの興味深い行を見つけました。</font></font><br>
<br>
<pre><code class="bash hljs">$ strings vga2usb.ko | grep <span class="hljs-string">'v2uco'</span> | sort | uniq<font></font>
v2ucom_autofirmware<font></font>
v2ucom_autofirmware_ezusb<font></font>
v2ucom_autofirmware_fpga</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは本当に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPGA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オンスティックですか？このようなものを作る方法は？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DSA秘密鍵パラメーターの行は、もう少しおかしくて気がかりな発見でした。これは私に不思議に思いました：それはドライバーの中で何を保護できますか？</font></font><br>
<br>
<pre><code class="bash hljs">$ strings vga2usb.ko | grep <span class="hljs-string">'epiphan'</span> | sort | uniq<font></font>
epiphan_dsa_G<font></font>
epiphan_dsa_P<font></font>
epiphan_dsa_Q</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常の環境でドライバーを調べるために、Debian 9仮想マシン（サポートされている最新のリリース）をピックアップし</font><font style="vertical-align: inherit;">、デバイスに直接アクセスできるように</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KVM USBパススルー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成</font><font style="vertical-align: inherit;">しました。次に、ドライバーをインストールして、それが機能することを確認しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、通信プロトコルがどのようなものか見たかった。デバイスがrawまたはほとんどrawのフレームを送信することを期待していました。これにより、ユーザースペース用のドライバーの記述が容易になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うために、モジュールを仮想マシンのホストにダウンロードし、</font></font><code>usbmon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiresharkを起動して、起動およびビデオキャプチャ中にデバイスとの間のUSBトラフィックをキャプチャしました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wo/0l/ux/wo0luxcyjaf5kmnthlsjsseo_o0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
起動すると、画像のキャプチャを開始する前に、多数の小さなパケットがデバイスに送信されることがわかりました。</font><font style="vertical-align: inherit;">データストレージのないFPGAプラットフォームに基づいている可能性があります。</font><font style="vertical-align: inherit;">接続後、ドライバーは毎回、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20191109230917/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPGAビットストリーム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の形式でファームウェアをデバイスに送信しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボックスの1つを開いて、これを確信しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8d/df/qe/8ddfqe7xzlovfj9bnjwhmyu5due.jpeg"><br>
<br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<td colspan="1" rowspan="1"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">赤</font></font></p></td>
<td colspan="1" rowspan="1"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISL98002CRZ-170-VGA信号のADCとして機能</font></font></p></td>
</tr>
<tr>
<td colspan="1" rowspan="1"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">黄</font></font></p></td>
<td colspan="1" rowspan="1"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XC6SLX16-ザイリンクスSpartan 6 FPGA</font></font></p></td>
</tr>
<tr>
<td colspan="1" rowspan="1"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シアン</font></font></p></td>
<td colspan="1" rowspan="1"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64 MB DDR3</font></font></p></td>
</tr>
<tr>
<td colspan="1" rowspan="1"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">赤紫色</font></font></p></td>
<td colspan="1" rowspan="1"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CY7C68013A-USBコントローラ/フロントエンド</font></font></p></td>
</tr>
</tbody>
</table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスを「ダウンロード」するには、ビットストリーム/ファームウェアを送信する必要があるため、プリコンパイルされたバイナリでデバイスを探す必要があります。私は</font></font><code>binwalk -x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの圧縮オブジェクト（zlib）を探し</font><font style="vertical-align: inherit;">始めました</font><font style="vertical-align: inherit;">。これを行うために、16進数シーケンス検索スクリプトを作成し、傍受したパケットから3バイトを指定しました。</font></font><br>
<br>
<pre><code class="bash hljs">$ bash scan.sh <span class="hljs-string">"03 3f 55"</span><font></font>
trying 0.elf<font></font>
trying 30020<font></font>
trying 30020.zlib<font></font>
trying 30020.zlib.decompressed<font></font>
...<font></font>
trying 84BB0<font></font>
trying 84BB0.zlib<font></font>
trying 84BB0.zlib.decompressed<font></font>
trying AA240<font></font>
trying AA240.zlib<font></font>
trying AA240.zlib.decompressed<font></font>
000288d0  07 2f 03 3f 55 50 7d 7c  00 00 00 00 00 00 00 00  |./.?UP}|........|<font></font>
trying C6860<font></font>
trying C6860.zlib</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AA240.zlibファイルを解凍した後、完全なビットストリーム用の十分なデータがないことがわかりました。そこで、USBパッケージからファームウェアを取得することにしました。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">tshark</font></a><font style="vertical-align: inherit;">と</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">tcpdump</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どちらも</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pcapファイルからUSBパケットを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">読み取る</font></a><font style="vertical-align: inherit;">ことができます</font><font style="vertical-align: inherit;">が、どちらも部分的にしか保存できません。各ユーティリティにはパズルの異なる部分がある</font><font style="vertical-align: inherit;">ため、パケットをデバイスに再生するために、両方のプログラムの出力をgo構造に結合</font><font style="vertical-align: inherit;">する</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">小さなプログラム</font></a><font style="vertical-align: inherit;">を作成しました。</font><font style="vertical-align: inherit;">
この時点で、ダウンロードが2つの段階で行われることに気づきました。最初にUSBコントローラ、次にFPGAです。</font><font style="vertical-align: inherit;">
数日間スタックしました。ビットストリーム全体がロードされているように見えましたが、デバイスは起動しませんでしたが、実際のドライバーと私のシミュレーションのパッケージは似ています。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、各パケットの応答時間を考慮してpcapを注意深く調べることで問題を解決しました-特定の1つのパケットに大きな時間差があることに気付きました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/jr/cl/fmjrcloapr8mljsbnl3ed1qc0p0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小さな</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプミスのために、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記録はデバイスの間違った領域で発生したことが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">わかり</font></a><font style="vertical-align: inherit;">ました。</font><font style="vertical-align: inherit;">手動で値を入力する方法についてのレッスンになります... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、デバイスのLEDがついに点滅しました！</font><font style="vertical-align: inherit;">大きな成果！</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://blog.benjojo.co.uk/asset/hwDmbj53li" type="video/mp4"></video></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データ転送をトリガーしたのと同じパッケージを複製するのは比較的簡単だったので、USBバルクエンドポイントを書き込み、データをディスクに即座にフラッシュできました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが本当の困難が始まった場所です。分析の結果、データが明示的にエンコードされていないことがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を実行して、実行時にドライバースタックをトレースするという一般的なアイデアを得ました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8u/8u/gu/8u8ugu8wikugmk_9pmp9iwdzwig.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームデータで関数をキャッチすることはできましたが、データ自体のエンコードを理解できませんでした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0w/hl/rx/0whlrxmpbisqikichzqziye8ilm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のドライバー内で何が起こっているのかをよりよく理解するために</font><font style="vertical-align: inherit;">、NSAの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ghidra</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツール</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">試してみました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2k/w-/vk/2kw-vke76xvk_wp1zuultsc_g6m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ギドラは素晴らしいですが（IDA Proの代わりに最初に使用したとき）、それでもドライバーを理解するのに十分ではありません。リバースエンジニアリングには別の方法が必要でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はWindows 7仮想マシンを取得してWindowsドライバーを確認することにしましたが、突然アイデアが投げ出されます。そして、デバイス用のSDKがあることに気づきました。ツールの1つが特に興味深いことがわかりました。</font></font><br>
<br>
<pre><code class="bash hljs">PS&gt; ls<font></font>
<font></font>
    Directory: epiphan_sdk-3.30.3.0007\epiphan\bin<font></font>
<font></font>
Mode                LastWriteTime     Length Name<font></font>
----                -------------     ------ ----<font></font>
-a---        10/26/2019  10:57 AM     528384 frmgrab.dll<font></font>
-a---        10/27/2019   5:41 PM    1449548 out.aw<font></font>
-a---        10/26/2019  10:57 AM     245760 v2u.exe<font></font>
-a---        10/26/2019  10:57 AM      94208 v2u_avi.exe<font></font>
-a---        10/26/2019  10:57 AM     102400 v2u_dec.exe<font></font>
-a---        10/26/2019  10:57 AM     106496 v2u_dshow.exe<font></font>
-a---        10/26/2019  10:57 AM     176128 v2u_ds_decoder.ax<font></font>
-a---        10/26/2019  10:57 AM      90112 v2u_edid.exe<font></font>
-a---        10/26/2019  10:57 AM      73728 v2u_kvm.exe<font></font>
-a---        10/26/2019  10:57 AM      77824 v2u_libdec.dll<font></font>
<font></font>
PS&gt; .\v2u_dec.exe<font></font>
Usage:<font></font>
      v2u_dec &lt;number of frames&gt; [format] [compression level] &lt;filename&gt;<font></font>
               - sets compression level [1..5],<font></font>
               - captures and saves compressed frames to a file<font></font>
      v2u_dec x [format] &lt;filename&gt;<font></font>
               - decompresses frames from the file to separate BMP files</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このツールを使用すると、単一のフレームを「つかむ」ことができます。最初はフレームが圧縮されていないため、後でより高速なマシンでフレームを処理することができます。これはほぼ完璧です。USBパケットシーケンスを複製して、これらの非圧縮のblobを取得しました。ピクセルあたり約3（RGB）に対応するバイト数！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの画像の初期処理（出力を受け入れてRGBピクセルとして書き込むだけ）により、デバイスがVGAを介して受け取った実際の画像を漠然と連想させるものが得られ</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zw/a7/ex/zwa7ext1vs4qdprl7-nv9vzp0-m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ました。16進エディターでデバッグした後、すべてのマーカーが1028バイトごとに繰り返されることがわかりました。フィルタの作成に費やした時間は少し恥ずかしいです。一方、その過程で、現代美術のいくつかの例を楽しむことができました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/je/ft/wqjeft0hks2k0tc7hfdwf4sm0ti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、画像の傾きと歪みは各行のスキップとピクセルラップによって発生していることに気付きました（x = 799はx = 800と等しくありません）。そして最後に、色を除いてほぼ正しい画像が得</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b5/wq/3o/b5wq3ocp1mjzytcefasym6nyuem.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
られました。最初は、VGA入力が無地でスタックしているときに、データのサンプリングが原因であると思っていました。修正のために、そのような問題を特定するために新しいテスト画像を作成しました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">振り返ってみると、Philips PM5544テストカードの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ようなものを使用しなければならなかったと理解しています</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/70/se/ue/70seuem7_dhlhaip_wfjtfzgvs0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像をラップトップにアップロードし、そのようなVGA画像を提供しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/k3/yj/nbk3yjxdr_mulhymu7enyvt3xjo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、3Dレンダリング/シェーダーの古い作品の記憶を手に入れました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUVの配色</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とよく似ていまし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">た</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、私はYUVの文献を読むことに没頭し、公式のカーネルドライバーのリバースエンジニアリング中に、という関数にブレークポイントを設定すると</font></font><code>v2ucom_convertI420toBGR24</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、システムが更新せずにフリーズすること</font><font style="vertical-align: inherit;">を思い出しました</font><font style="vertical-align: inherit;">。それで、おそらく入力はI420エンコーディング（オフ</font></font><code>-pix_fmt yuv420p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）で、出力はRGBでしたか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
組み込みのGo関数</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YCbCrToRGB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用した後</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、</font></a><font style="vertical-align: inherit;">画像が突然元の画像に非常に近くなりました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_8/aq/ne/_8aqnetxgrlor_21ezu2ywdqnrq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
やりました！ rawドライバーでさえ、毎秒7フレームを生成しました。正直なところ、事故の場合にのみVGAをバックアップディスプレイとして使用するので、これで十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、このデバイスを十分に理解し、最初からそれを開始するためのアルゴリズムを説明できます。</font></font><br>
<br>
<ol>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> USB-</a>.    ,          .<br>
</li>
<li>    USB,     USB         USB.<br>
</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  FPGA</a>,   64-  USB    .<br>
</li>
<li>         .      ,     (overscan   ).<br>
</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    </a>,    .     4:3   ,       .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使いやすさを最大にするために、ドライバーに小さなWebサーバーを実装しました。</font><font style="vertical-align: inherit;">ブラウザベースの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MediaRecorder API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を介して</font><font style="vertical-align: inherit;">、画面からビデオファイルへのストリームを簡単に記録します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o4/gr/u9/o4gru9m7gywpqz85razdl6ktsd0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実験的なコードの品質に対する避けられない主張を回避するために、私はすぐに言います。私はそれを誇りに思っていません。</font><font style="vertical-align: inherit;">おそらく彼はそのような状態にあり、私にとって許容できる使用には十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LinuxおよびOSX用のコードと既製のビルド</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はGitHubにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
誰もプログラムを開始しなかったとしても、私にとっては、USBプロトコル、カーネルデバッグ、モジュールのリバースエンジニアリング、およびビデオデコード形式の荒野を通過する魅惑的な旅の地獄でした。</font><font style="vertical-align: inherit;">これらが気に入った場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のブログ投稿を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックしてください</font><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja476414/index.html">Linuxのディスクアクティビティを特定する</a></li>
<li><a href="../ja476416/index.html">Windows管理センターからのWindowsサーバーの管理</a></li>
<li><a href="../ja476424/index.html">フレームワーク-プラスよりもマイナス</a></li>
<li><a href="../ja476428/index.html">Nginx VTS Stats、Mockify-モックAPI、WiremockおよびMockifyの比較</a></li>
<li><a href="../ja476430/index.html">完璧な技術ポートフォリオを作成する方法</a></li>
<li><a href="../ja476436/index.html">ロボットオペレーティングシステムに関するロボット開発者のロシアでの最初の会議からのレポート</a></li>
<li><a href="../ja476442/index.html">いくつかのスペースまたは周波数計のようなマイクロコントローラを与える</a></li>
<li><a href="../ja476444/index.html">量子コンピューティングの原理の解明</a></li>
<li><a href="../ja476446/index.html">Jiraプラグイン：成功した自転車発明のいくつかの例</a></li>
<li><a href="../ja476448/index.html">ジャーニーゲームのサンドシェーダーの探索</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>