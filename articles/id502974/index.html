<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍⚕️ 👨🏻‍✈️ 🙇🏿 C # Implementasi dalam C # .NET 👩‍⚖️ 🔲 👩🏼‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Untuk mengantisipasi dimulainya kursus "C # ASP.NET Core Developer" , kami menyiapkan terjemahan materi yang menarik tentang implementasi ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C # Implementasi dalam C # .NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/502974/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, Habr! </font><font style="vertical-align: inherit;">Untuk mengantisipasi dimulainya kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"C # ASP.NET Core Developer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kami menyiapkan terjemahan materi yang menarik tentang implementasi cache di C #. </font><font style="vertical-align: inherit;">Selamat membaca.</font></font></b></i><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu pola yang paling umum digunakan dalam pengembangan perangkat lunak adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caching</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ini adalah konsep yang sederhana dan, pada saat yang sama, sangat efektif. Idenya adalah untuk menggunakan kembali hasil operasi yang dilakukan. Setelah operasi yang memakan waktu, kami menyimpan hasilnya dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wadah cache</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami </font><font style="vertical-align: inherit;">. Lain kali kita membutuhkan hasil ini, kita akan mengekstraknya dari wadah cache, daripada harus melakukan operasi yang melelahkan lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, untuk mendapatkan avatar pengguna, Anda mungkin harus memintanya dari basis data. Alih-alih mengeksekusi permintaan dengan setiap panggilan, kami akan menyimpan avatar ini di cache, mengekstraknya dari memori setiap kali Anda membutuhkannya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caching bagus untuk data yang jarang berubah. </font><font style="vertical-align: inherit;">Atau, idealnya, mereka tidak pernah berubah. </font><font style="vertical-align: inherit;">Data yang terus berubah, misalnya, waktu saat ini, tidak boleh di-cache, jika tidak, Anda berisiko mengambil hasil yang salah.</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache lokal, cache lokal persisten, dan cache terdistribusi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada 3 jenis cache:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In-Memory Cache digunakan untuk kasus-kasus ketika Anda hanya perlu mengimplementasikan cache dalam satu proses. </font><font style="vertical-align: inherit;">Ketika sebuah proses mati, cache mati bersamanya. </font><font style="vertical-align: inherit;">Jika Anda menjalankan proses yang sama di beberapa server, Anda akan memiliki cache terpisah untuk setiap server.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache dalam-proses persisten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ini adalah saat Anda membuat cadangan cache di luar memori proses. </font><font style="vertical-align: inherit;">Ini dapat ditemukan di file atau di database. </font><font style="vertical-align: inherit;">Itu lebih kompleks daripada cache di memori, tetapi jika proses Anda restart, cache tidak memerah. </font><font style="vertical-align: inherit;">Paling cocok untuk kasus-kasus di mana mendapatkan barang yang di-cache mahal dan proses Anda cenderung sering dimulai kembali.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache Terdistribusi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah ketika Anda membutuhkan cache bersama untuk beberapa mesin. </font><font style="vertical-align: inherit;">Biasanya ini adalah beberapa server. </font><font style="vertical-align: inherit;">Cache yang didistribusikan disimpan dalam layanan eksternal. </font><font style="vertical-align: inherit;">Ini berarti bahwa jika satu server memiliki elemen cache, server lain juga dapat menggunakannya. </font><font style="vertical-align: inherit;">Layanan seperti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sangat bagus untuk ini.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami hanya akan berbicara tentang </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cache lokal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementasi primitif</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan membuat implementasi cache yang sangat sederhana di C #:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NaiveCache</span>&lt;TItem&gt;<font></font>
{<font></font>
    Dictionary&lt;<span class="hljs-keyword">object</span>, TItem&gt; _cache = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">object</span>, TItem&gt;();<font></font>
 <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TItem <span class="hljs-title">GetOrCreate</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> key, Func&lt;TItem&gt; createItem</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (!_cache.ContainsKey(key))<font></font>
        {<font></font>
            _cache[key] = createItem();<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> _cache[key];<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> _avatarCache = <span class="hljs-keyword">new</span> NaiveCache&lt;<span class="hljs-keyword">byte</span>[]&gt;();
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">var</span> myAvatar = _avatarCache.GetOrCreate(userId, () =&gt; _database.GetAvatar(userId));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode sederhana ini memecahkan masalah penting. Untuk mendapatkan avatar pengguna, hanya permintaan pertama yang akan menjadi permintaan aktual dari basis data. Data avatar ( </font></font><code>byte []</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) oleh hasil permintaan disimpan dalam memori proses. Semua permintaan avatar selanjutnya akan mengambilnya dari memori, menghemat waktu dan sumber daya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi, seperti kebanyakan hal dalam pemrograman, banyak hal yang tidak begitu sederhana. Implementasi di atas bukanlah solusi yang baik karena sejumlah alasan. Di satu sisi, implementasi ini tidak </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aman untuk thread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ketika digunakan dari banyak utas, pengecualian dapat terjadi. Selain itu, item yang di-cache akan tetap berada dalam memori selamanya, yang sebenarnya sangat buruk. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inilah mengapa kami harus menghapus item dari cache:</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache dapat mulai mengambil banyak memori, yang akhirnya mengarah ke pengecualian karena kekurangan dan crash.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konsumsi memori yang tinggi dapat menyebabkan tekanan memori (juga dikenal sebagai </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tekanan GC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Dalam keadaan ini, pengumpul sampah bekerja lebih dari yang seharusnya, yang mengurangi kinerja.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache mungkin perlu diperbarui ketika data berubah. </font><font style="vertical-align: inherit;">Infrastruktur caching kami harus mendukung fitur ini.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengatasi masalah ini ada dalam kerangka </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kebijakan perpindahan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (juga dikenal sebagai </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">penghapusan kebijakan - Kebijakan Penggusuran / Penghapusan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Ini adalah aturan untuk menghapus item dari cache sesuai dengan logika yang diberikan. </font><font style="vertical-align: inherit;">Di antara kebijakan penghapusan umum adalah sebagai berikut:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kebijakan Kedaluwarsa Absolut</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang menghapus item dari cache setelah waktu yang tetap, apa pun yang terjadi.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kebijakan Kedaluwarsa Sliding</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang menghapus item dari cache jika belum diakses selama periode waktu tertentu. </font><font style="vertical-align: inherit;">Artinya, jika saya mengatur waktu kedaluwarsa menjadi 1 menit, item itu akan tetap ada di cache sementara saya menggunakannya setiap 30 detik. </font><font style="vertical-align: inherit;">Jika saya tidak menggunakannya lebih dari satu menit, item tersebut akan dihapus.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kebijakan Batas Ukuran</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang akan membatasi ukuran cache.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kami telah menemukan semua yang kami butuhkan, mari beralih ke solusi yang lebih baik.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi yang lebih baik</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sangat mengecewakan saya sebagai seorang blogger, Microsoft telah menciptakan implementasi cache yang luar biasa. </font><font style="vertical-align: inherit;">Ini menghilangkan saya dari kesenangan membuat implementasi yang serupa sendiri, tetapi setidaknya penulisan artikel ini juga kurang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan menunjukkan kepada Anda solusi Microsoft, cara menggunakannya secara efektif, dan kemudian bagaimana memperbaikinya untuk beberapa skenario.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Runtime.Caching / MemoryCache vs Microsoft.Extensions.Caching.Memory</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microsoft memiliki 2 solusi, 2 paket caching NuGet yang berbeda. </font><font style="vertical-align: inherit;">Keduanya bagus. </font><font style="vertical-align: inherit;">Menurut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rekomendasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Microsoft, lebih baik digunakan </font></font><code>Microsoft.Extensions.Caching.Memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, karena terintegrasi lebih baik dengan Asp. </font><font style="vertical-align: inherit;">Core NET. </font><font style="vertical-align: inherit;">Ini dapat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan mudah</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diintegrasikan ke dalam mekanisme injeksi dependensi Asp .NET Core. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah contoh sederhana dengan </font></font><code>Microsoft.Extensions.Caching.Memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SimpleMemoryCache</span>&lt;TItem&gt;<font></font>
{<font></font>
    <span class="hljs-keyword">private</span> MemoryCache _cache = <span class="hljs-keyword">new</span> MemoryCache(<span class="hljs-keyword">new</span> MemoryCacheOptions());<font></font>
 <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TItem <span class="hljs-title">GetOrCreate</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> key, Func&lt;TItem&gt; createItem</span>)</span><font></font>
    {<font></font>
        TItem cacheEntry;<font></font>
        <span class="hljs-keyword">if</span> (!_cache.TryGetValue(key, <span class="hljs-keyword">out</span> cacheEntry)) <span class="hljs-comment">//    .</span><font></font>
        {<font></font>
            <span class="hljs-comment">//    ,   .</span><font></font>
            cacheEntry = createItem();<font></font>
            <font></font>
            <span class="hljs-comment">//    . </span><font></font>
            _cache.Set(key, cacheEntry);<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> cacheEntry;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> _avatarCache = <span class="hljs-keyword">new</span> SimpleMemoryCache&lt;<span class="hljs-keyword">byte</span>[]&gt;();
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">var</span> myAvatar = _avatarCache.GetOrCreate(userId, () =&gt; _database.GetAvatar(userId));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini sangat mengingatkan saya pada saya sendiri </font></font><code>NaiveCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, jadi apa yang telah berubah? </font><font style="vertical-align: inherit;">Yah, pertama, ini </font><font style="vertical-align: inherit;">implementasi yang </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aman</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Anda dapat dengan aman menyebutnya dari beberapa utas sekaligus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kedua, ini </font></font><code>MemoryCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memperhitungkan semua kebijakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crowding-out</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang kita bicarakan sebelumnya. </font><font style="vertical-align: inherit;">Berikut ini contohnya: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMemoryCache dengan kebijakan preemption:</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MemoryCacheWithPolicy</span>&lt;TItem&gt;<font></font>
{<font></font>
    <span class="hljs-keyword">private</span> MemoryCache _cache = <span class="hljs-keyword">new</span> MemoryCache(<span class="hljs-keyword">new</span> MemoryCacheOptions()<font></font>
    {<font></font>
        SizeLimit = <span class="hljs-number">1024</span><font></font>
    });<font></font>
 <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TItem <span class="hljs-title">GetOrCreate</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> key, Func&lt;TItem&gt; createItem</span>)</span><font></font>
    {<font></font>
        TItem cacheEntry;<font></font>
        <span class="hljs-keyword">if</span> (!_cache.TryGetValue(key, <span class="hljs-keyword">out</span> cacheEntry))<span class="hljs-comment">//    .</span><font></font>
        {<font></font>
            <span class="hljs-comment">//    ,   . </span><font></font>
            cacheEntry = createItem();<font></font>
 <font></font>
            <span class="hljs-keyword">var</span> cacheEntryOptions = <span class="hljs-keyword">new</span> MemoryCacheEntryOptions()<font></font>
         	.SetSize(<span class="hljs-number">1</span>)<span class="hljs-comment">// </span>
         	<span class="hljs-comment">//        (  )</span><font></font>
                .SetPriority(CacheItemPriority.High)<font></font>
                <span class="hljs-comment">//       ,    .</span>
                 .SetSlidingExpiration(TimeSpan.FromSeconds(<span class="hljs-number">2</span>))
                <span class="hljs-comment">//       ,    .</span>
                .SetAbsoluteExpiration(TimeSpan.FromSeconds(<span class="hljs-number">10</span>));<font></font>
 <font></font>
            <span class="hljs-comment">//    .</span><font></font>
            _cache.Set(key, cacheEntry, cacheEntryOptions);<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> cacheEntry;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita menganalisis elemen-elemen baru:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemoryCacheOptions telah ditambahkan </font></font><code>SizeLimit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ini menambahkan kebijakan batas ukuran ke wadah cache kami. </font><font style="vertical-align: inherit;">Cache tidak memiliki mekanisme untuk mengukur ukuran catatan. </font><font style="vertical-align: inherit;">Karena itu, kita perlu mengatur ukuran setiap entri cache. </font><font style="vertical-align: inherit;">Dalam hal ini, setiap kali kita mengatur ukuran ke 1 dengan </font></font><code>SetSize(1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ini berarti bahwa cache kami akan memiliki batas 1024 elemen.</font></font></li>
<li>     ,      ?       <code>.SetPriority (CacheItemPriority.High)</code>.   : <b>Low (), Normal (), High ()</b>  <b>NeverRemove (  )</b>.</li>
<li><code>SetSlidingExpiration(TimeSpan.FromSeconds(2))</code>  <b>   </b>  2 .  ,         2 ,   .</li>
<li><code>SetAbsoluteExpiration(TimeSpan.FromSeconds(10))</code>  <b>   </b>  10 .  ,       10 ,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain opsi dalam contoh, Anda juga dapat menetapkan delegasi </font></font><code>RegisterPostEvictionCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang akan dipanggil saat item dihapus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah rentang fungsi yang cukup luas, tetapi, bagaimanapun, kita perlu memikirkan apakah ada hal lain untuk ditambahkan. </font><font style="vertical-align: inherit;">Sebenarnya ada beberapa hal.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah dan fitur yang hilang</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada beberapa bagian penting yang hilang dari implementasi ini.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meskipun Anda dapat menetapkan batas ukuran, caching sebenarnya tidak mengontrol tekanan memori. </font><font style="vertical-align: inherit;">Jika kita memonitor, kita bisa memperketat kebijakan dengan tekanan tinggi dan melemahkan kebijakan dengan rendah.</font></font></li>
<li>         ,      .     . , ,    ,        10 .      2    ,  ,     ( ),       .</li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengenai masalah</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tekanan pertama pada gc: dimungkinkan untuk mengontrol tekanan pada gc dengan beberapa metode dan heuristik. </font><font style="vertical-align: inherit;">Posting ini bukan tentang ini, tetapi Anda dapat membaca artikel saya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Menemukan, Memperbaiki, dan Mencegah Kebocoran Memori di C # .NET: 8 Praktik Terbaik”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk mempelajari tentang beberapa metode yang berguna. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah kedua lebih mudah dipecahkan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sebenarnya, ini adalah implementasi </font></font><code>MemoryCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang sepenuhnya menyelesaikannya:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WaitToFinishMemoryCache</span>&lt;TItem&gt;<font></font>
{<font></font>
    <span class="hljs-keyword">private</span> MemoryCache _cache = <span class="hljs-keyword">new</span> MemoryCache(<span class="hljs-keyword">new</span> MemoryCacheOptions());
    <span class="hljs-keyword">private</span> ConcurrentDictionary&lt;<span class="hljs-keyword">object</span>, SemaphoreSlim&gt; _locks = <span class="hljs-keyword">new</span> ConcurrentDictionary&lt;<span class="hljs-keyword">object</span>, SemaphoreSlim&gt;();<font></font>
 <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;TItem&gt; <span class="hljs-title">GetOrCreate</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> key, Func&lt;Task&lt;TItem&gt;&gt; createItem</span>)</span><font></font>
    {<font></font>
        TItem cacheEntry;<font></font>
 <font></font>
        <span class="hljs-keyword">if</span> (!_cache.TryGetValue(key, <span class="hljs-keyword">out</span> cacheEntry))<span class="hljs-comment">//    .</span><font></font>
        {<font></font>
            SemaphoreSlim mylock = _locks.GetOrAdd(key, k =&gt; <span class="hljs-keyword">new</span> SemaphoreSlim(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>));<font></font>
 <font></font>
            <span class="hljs-keyword">await</span> mylock.WaitAsync();
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                <span class="hljs-keyword">if</span> (!_cache.TryGetValue(key, <span class="hljs-keyword">out</span> cacheEntry))<font></font>
                {<font></font>
                    <span class="hljs-comment">//    ,   .</span>
                    cacheEntry = <span class="hljs-keyword">await</span> createItem();<font></font>
                    _cache.Set(key, cacheEntry);<font></font>
                }<font></font>
            }<font></font>
            <span class="hljs-keyword">finally</span><font></font>
            {<font></font>
                mylock.Release();<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> cacheEntry;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> _avatarCache = <span class="hljs-keyword">new</span> WaitToFinishMemoryCache&lt;<span class="hljs-keyword">byte</span>[]&gt;();
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">var</span> myAvatar =
<span class="hljs-keyword">await</span> _avatarCache.GetOrCreate(userId, <span class="hljs-keyword">async</span> () =&gt; <span class="hljs-keyword">await</span> _database.GetAvatar(userId));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam implementasi ini, ketika Anda mencoba untuk mendapatkan elemen, jika elemen yang sama sudah dalam proses dibuat oleh utas lain, Anda akan menunggu sampai utas pertama selesai. </font><font style="vertical-align: inherit;">Kemudian Anda akan mendapatkan item yang sudah di-cache dibuat oleh utas lain.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penguraian kode</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementasi ini memblokir pembuatan elemen. </font><font style="vertical-align: inherit;">Penguncian terjadi pada tombol. </font><font style="vertical-align: inherit;">Misalnya, jika kita menunggu avatar Alexey, kita masih bisa mendapatkan nilai cache dari Zhenya atau Barbara di utas lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kamus </font></font><code>_locks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menyimpan semua kunci. </font><font style="vertical-align: inherit;">Kunci biasa tidak berfungsi </font></font><code>async/await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, jadi kita perlu menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SemaphoreSlim</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada 2 cek untuk memeriksa apakah nilainya sudah di-cache jika </font></font><code>(!_Cache.TryGetValue(key, out cacheEntry))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Yang ada di kunci adalah yang menyediakan satu-satunya kreasi elemen. </font><font style="vertical-align: inherit;">Yang ada di luar kunci, untuk optimasi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapan harus digunakan </font></font><code>WaitToFinishMemoryCache</code></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementasi ini jelas memiliki beberapa overhead. </font><font style="vertical-align: inherit;">Mari kita lihat kapan itu relevan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gunakan </font></font><code>WaitToFinishMemoryCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saat:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika waktu pembuatan item memiliki nilai, dan Anda ingin meminimalkan jumlah kreasi sebanyak mungkin.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika waktu untuk membuat item sangat panjang.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika suatu item harus dibuat sekali untuk setiap tombol.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan gunakan </font></font><code>WaitToFinishMemoryCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saat:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak ada bahaya bahwa banyak utas akan mendapatkan akses ke elemen cache yang sama.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda tidak kategoris menentang membuat elemen lebih dari sekali. </font><font style="vertical-align: inherit;">Misalnya, jika satu kueri tambahan ke database tidak terlalu memengaruhi apa pun.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ringkasan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caching adalah pola yang sangat kuat. </font><font style="vertical-align: inherit;">Dan juga berbahaya dan memiliki jebakannya. </font><font style="vertical-align: inherit;">Cache terlalu banyak dan Anda dapat menyebabkan tekanan pada GC. </font><font style="vertical-align: inherit;">Tembolok terlalu sedikit dan Anda dapat menyebabkan masalah kinerja. </font><font style="vertical-align: inherit;">Ada juga caching terdistribusi, yang mewakili dunia baru untuk dijelajahi. </font><font style="vertical-align: inherit;">Ini adalah pengembangan perangkat lunak, selalu ada sesuatu yang baru yang dapat dikuasai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harap Anda menikmati artikel ini. </font><font style="vertical-align: inherit;">Jika Anda tertarik pada manajemen memori, artikel saya berikutnya akan fokus pada bahaya tekanan pada GC dan bagaimana mencegahnya, jadi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">daftar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nikmati pengkodean Anda.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelajari lebih lanjut tentang kursus.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id502954/index.html">Contoh 5 platform webinar lainnya</a></li>
<li><a href="../id502962/index.html">Mengapa kami tidak akan kembali ke kantor (lihat pekerjaan jarak jauh setelah 2 bulan)</a></li>
<li><a href="../id502964/index.html">Nuansa keuangan dalam perjanjian proyek proyek TI</a></li>
<li><a href="../id502968/index.html">Dasar-dasar Vault Data</a></li>
<li><a href="../id502972/index.html">SD Express: SD 8.0 & PCIe 4.0 standar. Apa ini dan mengapa?</a></li>
<li><a href="../id502978/index.html">Skema warna tanpa bantuan desainer</a></li>
<li><a href="../id502980/index.html">THT dan plot dalam game non-plot pada contoh Throne: Kingdom at War</a></li>
<li><a href="../id502984/index.html">Bagaimana cara memilih psikolog / psikoterapis?</a></li>
<li><a href="../id502986/index.html">F #, meningkatkan kontras gambar dengan menyelaraskan histogram</a></li>
<li><a href="../id502988/index.html">Pakar dan pemrograman bisnis. Combine tidak dapat dibagikan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>