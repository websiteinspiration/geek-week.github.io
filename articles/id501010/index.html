<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙏 👍🏾 🔟 Linux Kernel TLS dan Nginx 👩🏻‍🚀 👨‍🚒 ☁️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel ini saya akan berbicara tentang sejarah perkembangan dan kondisi teknologi saat ini untuk mempercepat distribusi konten dalam koneksi TL...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linux Kernel TLS dan Nginx</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501010/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam artikel ini saya akan berbicara tentang sejarah perkembangan dan kondisi teknologi saat ini untuk mempercepat distribusi konten dalam koneksi TLS dengan mentransfer enkripsi ke inti sistem operasi, serta tentang kontribusi saya untuk pengembangan arah ini.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Latar Belakang</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kembali pada tahun 2015, Randall Stewart dan Scott Long dari Netflix membuat presentasi di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">konferensi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AsiaBSDCon2015 </font><font style="vertical-align: inherit;">tentang mengoptimalkan distribusi konten terenkripsi. Pesan utama dari laporan ini adalah untuk mentransfer enkripsi data ke kernel sistem operasi untuk mengurangi jumlah salinan data antara ruang-kernel dan ruang-pengguna dan menggunakan panggilan sistem sendfile () non-blocking yang dioptimalkan. Topiknya ternyata sangat menjanjikan dan sudah pada konferensi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netdev 1.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2016, </font><font style="vertical-align: inherit;">Dave Watson dari Facebook membuat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">presentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tentang perlunya membuat soket TLS di kernel Linux, dan Boris Pismenny, Ilya Lesokhin dan Liran Liss dari Mellanox </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">membuat presentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentang kemampuan untuk menggunakan akselerasi perangkat keras TLS dalam kartu jaringan. </font><font style="vertical-align: inherit;">Topik ini juga dibahas di HighLoad ++ 2017 oleh pembicara dari Tempesta Technologies.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan kernel Linux</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil dari semua percakapan ini adalah munculnya Kernel TLS di Linux 4.13 kernel (2017) dengan dukungan untuk TLSv1.2 dan cipher AES128-GCM. </font><font style="vertical-align: inherit;">Awalnya, enkripsi hanya lalu lintas keluar didukung, dukungan dekripsi muncul kemudian di kernel Linux 4.17 (2018). </font><font style="vertical-align: inherit;">Dalam versi 5.1, mereka menambahkan dukungan untuk TLSv1.3 dan AES256-GCM, dan dalam versi 5.2 mereka juga menambahkan cipher AES128-CCM (2019).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan di ruang pengguna</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam semua laporan yang disebutkan di atas, dikatakan bahwa hanya enkripsi data berguna yang dapat ditempatkan di kernel, dan semua persetujuan TLS dan pesan kontrol harus ditangani sama di ruang pengguna. Dan untuk ini, versi OpenSSL yang dimodifikasi digunakan. Namun, pada saat publikasi laporan dalam domain publik tidak ada informasi tentang modifikasi yang perlu dilakukan pada perpustakaan terkenal ini untuk mendukung fungsi tersebut. Mungkin satu-satunya contoh menggunakan Linux Kernel TLS yang tersedia adalah artikel blog Filippo Valsorda </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Playing dengan kernel TLS di Linux 4.13 dan Go</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang muncul segera setelah rilis kernel Linux 4.13. </font><font style="vertical-align: inherit;">Dan, meskipun menunjukkan contoh yang valid dari penggunaan teknologi, itu tidak membawa pemahaman tentang bagaimana menggunakan teknologi dalam proyek nyata. </font><font style="vertical-align: inherit;">Memang, sangat sedikit orang yang menulis server WEB untuk proyek mereka sendiri, biasanya semua orang menggunakan alat yang terkenal dan telah teruji waktu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan dalam OpenSSL</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diskusi pertama teknologi di OpenSSL muncul pada musim panas 2017 tak lama sebelum rilis Linux 4.13 kernel ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PR 3631</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), tetapi proses diskusi sangat, sangat lambat, komentar nyata pertama muncul pada bulan Oktober (setelah rilis kernel 4.13), dan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">versi kerja yang</font></a><font style="vertical-align: inherit;"> sebenarnya</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mulai berdiskusi pada Februari 2018. Pada saat semua koreksi disetujui, jendela untuk menambahkan fungsionalitas baru di OpenSSL 1.1.1 ditutup, dan dukungan untuk Kernel TLS dipindahkan ke rilis berikutnya. </font><font style="vertical-align: inherit;">Sejak saat itu, dukungan Kernel TLS RX telah ditambahkan, dan SSL_sendfile () adalah panggilan ke syscall terkait dengan sedikit pemrosesan kemungkinan situasi dalam protokol TLS. </font><font style="vertical-align: inherit;">Tetapi sekarang di tahun 2020, OpenSSL 3.0 belum keluar, TLSv1.3 didukung oleh sebagian besar browser, dan cipher AES128-GCM secara aktif diganti oleh AES256-GCM yang lebih tahan. </font><font style="vertical-align: inherit;">Jadi saya mengambil kebebasan dan mengirim </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permintaan Tarik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk mendukung sandi dan TLSv1.3 baru dengan harapan mereka akan menerimanya sebelum rilis baru perpustakaan.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan di WEB-server</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi mendukung Kernel TLS di perpustakaan TLS tidak cukup. Laporan tentang teknologi mengatakan bahwa efisiensi maksimum dapat diperoleh dengan mengirim tanpa menyalin data ke ruang pengguna - menggunakan panggilan sistem sendfile (). Dan aplikasi server harus dapat membedakan antara situasi di mana Anda dapat menggunakan sendfile () pada soket dengan TLS, dan ketika Anda perlu melakukan "baca cara lama" baca () / SSL_write (). Beberapa kemajuan dalam menambahkan fungsionalitas ke Nginx muncul pada April 2019, tetapi tidak ada perubahan yang diterima pada kode utama. Posisi pengembang adalah bahwa API untuk fungsi-fungsi ini belum disetujui di OpenSSL, dan kode aktual yang diusulkan dalam tambalan tampaknya tidak cukup portabel untuk platform yang berbeda. Sejujurnya, kode ini tidak hanya tidak terlihat sangat bagus, tetapi juga mengandung kesalahan yang mencegah Nginx dibangun tanpa koreksi tambahan.Saya tidak dapat menemukan dukungan Kernel TLS di server web lain sama sekali (mungkin seseorang melihatnya - beri tahu saya di komentar).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan apa yang harus dilakukan?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sementara komunitas sedang menunggu rilis OpenSSL 3.0, untuk mulai mengembangkan dukungan untuk Kernel TLS di Nginx dengan API yang stabil, saya memilih sebaliknya. </font><font style="vertical-align: inherit;">Di </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudut nyaman</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya di </font><font style="vertical-align: inherit;">GitHub, saya melakukan 2 hal:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya membuat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">garpu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenSSL dan meng-backport semua yang terkait dengan Kernel TLS ke versi stabil OpenSSL 1.1.1 (cabang OpenSSL_1_1_1-ktls). </font><font style="vertical-align: inherit;">Terutama agar dapat memeriksa fungsionalitas dalam kondisi operasi yang stabil dari seluruh perpustakaan. </font><font style="vertical-align: inherit;">Ketika versi stabil tersedia, saya mencoba untuk rebase sehingga fork up to date.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya membuat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">garpu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nginx, di mana saya menambahkan (berdasarkan tambalan dari Mellanox) dukungan untuk memanggil SSL_sendfile () dalam kondisi ketika itu benar-benar mungkin dan dengan pemeriksaan soket SSL yang diperlukan, dan kemampuan untuk mengaktifkan / menonaktifkan fungsi melalui variabel konfigurasi. </font><font style="vertical-align: inherit;">Selain fitur ini, di garpu saya ada juga beberapa tambalan yang mengoptimalkan kerja Nginx sedikit dan memperbaiki beberapa bug (master-feature branch). </font><font style="vertical-align: inherit;">Sejauh mungkin, saya mencoba untuk rebase berdasarkan cabang utama dari repo utama Nginx, agar garpu tetap up to date.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya mengundang semua orang untuk ikut serta dalam pengujian. </font><font style="vertical-align: inherit;">Komentar dan koreksi kode dapat dilemparkan ke Issue on GitHub. </font><font style="vertical-align: inherit;">Untuk membangun Nginx ini dengan OpenSSL ini dan dukungan TLS Kernel yang disertakan, tambahkan parameter ke skrip configure:</font></font><br>
<br>
<pre><code class="bash hljs">./configure --with-openssl=&lt;OpenSSL-fork-dir&gt; --with-openssl-opt=<span class="hljs-string">"enable-ktls"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini, saya tidak memiliki kesempatan untuk menguji bundel Nginx + OpenSSL ini di bawah beban berat untuk mengonfirmasi kinerja dari komentar di patch Nginx, jadi jika tiba-tiba seseorang dapat mengukur perbedaan dalam beban CPU dengan kecepatan unggah file yang tinggi, akan sangat bagus untuk mendapatkan grafik dan menambahkan mereka menjadi sebuah artikel untuk pemahaman visual tentang efeknya.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id500996/index.html">Bagaimana menjadi insinyur DevOps dalam enam bulan atau bahkan lebih cepat. Bagian 1. Pendahuluan</a></li>
<li><a href="../id501002/index.html">Umka: bahasa skrip diketik statis baru</a></li>
<li><a href="../id501004/index.html">Lakukan. Kerja</a></li>
<li><a href="../id501006/index.html">Kami berteman STM32 dengan layar LCD 1604 di bus I2C (perpustakaan HAL)</a></li>
<li><a href="../id501008/index.html">Paving domino</a></li>
<li><a href="../id501012/index.html">Bagaimana saya mencari mesin anak untuk blog</a></li>
<li><a href="../id501016/index.html">Pada tren perkembangan arsitektur prosesor, atau mengapa saya percaya pada keberhasilan Huawei di pasar server</a></li>
<li><a href="../id501018/index.html">Cara menyiasati beberapa batasan terjemahan google</a></li>
<li><a href="../id501020/index.html">Cara menguji kode yang mengandung setTimeout / setInterval di bawah tenda</a></li>
<li><a href="../id501022/index.html">“Saya di padang pasir”: mengapa isolasi diri ternyata menjadi tekanan serius bagi kami dan apa akibatnya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>