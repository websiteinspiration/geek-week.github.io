<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜï üë®üèæ‚Äç‚öïÔ∏è üïµüèª Guide pour travailler avec OpenAL en C ++. Partie 1: jouer du son üë©üèª‚Äçüç≥ üê§ üë®‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Votre jeu a besoin de son! Vous avez probablement d√©j√† utilis√© OpenGL pour dessiner √† l'√©cran. Vous avez compris son API, et vous vous √™tes donc tourn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Guide pour travailler avec OpenAL en C ++. Partie 1: jouer du son</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488744/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre jeu a besoin de son! </font><font style="vertical-align: inherit;">Vous avez probablement d√©j√† utilis√© OpenGL pour dessiner √† l'√©cran. </font><font style="vertical-align: inherit;">Vous avez compris son API, et vous vous √™tes donc tourn√© vers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parce que le nom semble familier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, la bonne nouvelle est qu'OpenAL poss√®de √©galement une API tr√®s famili√®re. </font><font style="vertical-align: inherit;">Il a √©t√© initialement con√ßu pour simuler l'API de sp√©cification OpenGL. </font><font style="vertical-align: inherit;">C'est pourquoi je l'ai choisi parmi les nombreux syst√®mes de sonorisation pour les jeux; </font><font style="vertical-align: inherit;">en outre, il est multiplateforme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je parlerai en d√©tail du code n√©cessaire pour utiliser OpenAL dans un jeu √©crit en C ++. </font><font style="vertical-align: inherit;">Nous discuterons des sons, de la musique et du positionnement sonore dans l'espace 3D avec des exemples de code.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Histoire d'OpenAL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'essaierai d'√™tre bref. Comme mentionn√© ci-dessus, il a √©t√© intentionnellement con√ßu comme une imitation de l'API OpenGL, et il y a une raison √† cela. Il s'agit d'une API pratique qui est connue de beaucoup, et si les graphiques sont un c√¥t√© du moteur de jeu, alors le son devrait √™tre diff√©rent. Initialement, OpenAL √©tait cens√© √™tre open-source, mais quelque chose s'est pass√© ... Les </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gens ne sont pas aussi int√©ress√©s par le son que par les graphiques, donc Creative a finalement fait d'OpenAL sa propri√©t√©, et l' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impl√©mentation de r√©f√©rence est</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©sormais propri√©taire et non gratuite. Mais! </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La sp√©cification</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenAL est toujours une norme ¬´ouverte¬ª, c'est-√†-dire qu'elle est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publi√©e</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De temps en temps, les sp√©cifications sont modifi√©es, mais pas beaucoup. Le son ne change pas aussi vite que les graphismes, car il n'y a pas de besoin particulier pour cela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La sp√©cification ouverte a permis √† d'autres personnes de cr√©er une impl√©mentation open source de la sp√©cification. Une telle impl√©mentation est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et franchement, cela n'a aucun sens d'en chercher d'autres. C'est l'impl√©mentation que j'utiliserai, et je vous recommande de l'utiliser √©galement.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elle est multiplateforme. </font><font style="vertical-align: inherit;">Il est impl√©ment√© assez curieusement - en fait, √† l'int√©rieur de la biblioth√®que utilise d'autres API sonores pr√©sentes dans votre syst√®me. </font><font style="vertical-align: inherit;">Sous Windows, il utilise </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectSound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sous Unix, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Gr√¢ce √† cela, elle a pu devenir multiplateforme; </font><font style="vertical-align: inherit;">en substance, c'est un grand nom pour l'API wrapper. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez vous inqui√©ter de la vitesse de cette API. </font><font style="vertical-align: inherit;">Mais ne t'inqui√®te pas. </font><font style="vertical-align: inherit;">C'est le m√™me son et il ne cr√©e pas une charge importante, il ne n√©cessite donc pas les grandes optimisations requises par l'API graphique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais assez d'histoire, passons √† la technologie.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De quoi avez-vous besoin pour √©crire du code dans OpenAL?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez cr√©er OpenAL Soft dans la cha√Æne d'outils de votre choix. Il s'agit d'un processus tr√®s simple que vous pouvez suivre conform√©ment aux instructions </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la section Installation source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Je n'ai jamais eu de probl√®me avec cela, mais si vous avez des difficult√©s, √©crivez un commentaire sous l'article d'origine ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©crivez √† la liste de diffusion OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous aurez besoin de quelques fichiers audio et d'un moyen de les t√©l√©charger. Le chargement de donn√©es audio dans des tampons et des d√©tails subtils de divers formats audio n'entrent pas dans le cadre de cet article, mais vous pouvez en savoir plus sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©l√©chargement et le streaming de fichiers Ogg / Vorbis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le t√©l√©chargement de fichiers WAV est tr√®s simple, il existe d√©j√† des centaines d'articles sur Internet √† ce sujet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La t√¢che de trouver des fichiers audio que vous devez d√©cider vous-m√™me. </font><font style="vertical-align: inherit;">Il existe de nombreux bruits et explosions sur Internet que vous pouvez t√©l√©charger. </font><font style="vertical-align: inherit;">Si vous avez une rumeur, vous pouvez essayer d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©crire votre propre musique chiptune</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traduction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur Habr√©]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gardez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©galement √† port√©e de main le Guide du programmeur d'OpenALSoft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette documentation est bien meilleur pdf avec sp√©cialisation "officielle". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, c'est tout. </font><font style="vertical-align: inherit;">Nous supposerons que vous savez d√©j√† comment √©crire du code, utilisez l'IDE et la cha√Æne d'outils.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©sentation de l'API OpenAL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dit plusieurs fois, c'est similaire √† l'API OpenGL. La similitude r√©side dans le fait qu'elle est bas√©e sur des √©tats et que vous interagissez avec des descripteurs / identifiants, et non directement avec les objets eux-m√™mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des diff√©rences entre les conventions d'API dans OpenGL et OpenAL, mais elles ne sont pas significatives. Dans OpenGL, vous devez effectuer des appels OS sp√©ciaux pour g√©n√©rer un contexte de rendu. Ces d√©fis sont diff√©rents pour diff√©rents syst√®mes d'exploitation et </font><font style="vertical-align: inherit;">ne font pas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraiment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partie de la sp√©cification OpenGL. Dans OpenAL, tout est diff√©rent - les fonctions de cr√©ation de contexte font partie de la sp√©cification et sont les m√™mes quel que soit le syst√®me d'exploitation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous interagissez avec l'API, il existe trois principaux types d'objets avec lesquels vous interagissez. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les auditeurs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(¬´Listeners¬ª) est l'emplacement des ¬´oreilles¬ª situ√©es dans l'espace 3D (il n'y a toujours qu'un seul auditeur). </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les sources</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (¬´sources¬ª) sont des ¬´haut-parleurs¬ª qui √©mettent du son, l√† encore dans l'espace 3D. </font><font style="vertical-align: inherit;">L'auditeur et les sources peuvent √™tre d√©plac√©s dans l'espace et en fonction de cela, ce que vous entendez √† travers les haut-parleurs dans le jeu change. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les derniers objets sont des </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tampons</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ils stockent des √©chantillons de sons que les sources joueront pour les auditeurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe √©galement des </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le jeu utilise pour changer la fa√ßon dont l'audio est trait√© via OpenAL.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme mentionn√© ci-dessus, ces objets sont des sources de sons. </font><font style="vertical-align: inherit;">Ils peuvent √™tre r√©gl√©s en position et en direction, et ils sont associ√©s √† un tampon de lecture de donn√©es audio.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auditeur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le seul ensemble d '"oreilles" du jeu. </font><font style="vertical-align: inherit;">Ce que l'auditeur entend est reproduit par les haut-parleurs de l'ordinateur. </font><font style="vertical-align: inherit;">Il a √©galement un poste.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampons</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans OpenGL, leur √©quivalent est Texture2D. </font><font style="vertical-align: inherit;">Il s'agit essentiellement des donn√©es audio que la source reproduit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Types de donn√©es</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour pouvoir prendre en charge le code multiplateforme, OpenAL effectue une certaine s√©quence d'actions et d√©finit certains types de donn√©es. </font><font style="vertical-align: inherit;">En fait, il suit OpenGL si pr√©cis√©ment que nous pouvons m√™me convertir directement les types OpenAL en types OpenGL. </font><font style="vertical-align: inherit;">Le tableau ci-dessous les r√©pertorie ainsi que leurs √©quivalents.</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type ouvert</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type openalc</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type opengl</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ Typedef</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La description</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ALboolean</code></td>
<td><code>ALCboolean</code></td>
<td><code>GLboolean</code></td>
<td><code>std::int8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur bool√©enne 8 bits</font></font></td>
</tr>
<tr>
<td><code>ALbyte</code></td>
<td><code>ALCbyte</code></td>
<td><code>GLbyte</code></td>
<td><code>std::int8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur enti√®re sur 8 bits du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code suppl√©mentaire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec un signe</font></font></td>
</tr>
<tr>
<td><code>ALubyte</code></td>
<td><code>ALCubyte</code></td>
<td><code>GLubyte</code></td>
<td><code>std::uint8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur enti√®re non sign√©e 8 bits</font></font></td>
</tr>
<tr>
<td><code>ALchar</code></td>
<td><code>ALCchar</code></td>
<td><code>GLchar</code></td>
<td><code>char</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">symbole</font></font></td>
</tr>
<tr>
<td><code>ALshort</code></td>
<td><code>ALCshort</code></td>
<td><code>GLshort</code></td>
<td><code>std::int16_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur enti√®re sign√©e 16 bits</font></font></td>
</tr>
<tr>
<td><code>ALushort</code></td>
<td><code>ALCushort</code></td>
<td><code>GLushort</code></td>
<td><code>std::uint16_t</code></td>
<td>16-    </td>
</tr>
<tr>
<td><code>ALint</code></td>
<td><code>ALCint</code></td>
<td><code>GLint</code></td>
<td><code>std::int32_t</code></td>
<td>32-      </td>
</tr>
<tr>
<td><code>ALuint</code></td>
<td><code>ALCuint</code></td>
<td><code>GLuint</code></td>
<td><code>std::uint32_t</code></td>
<td>32-    </td>
</tr>
<tr>
<td><code>ALsizei</code></td>
<td><code>ALCsizei</code></td>
<td><code>GLsizei</code></td>
<td><code>std::int32_t</code></td>
<td> 32-   </td>
</tr>
<tr>
<td><code>ALenum</code></td>
<td><code>ALCenum</code></td>
<td><code>GLenum</code></td>
<td><code>std::uint32_t</code></td>
<td> 32- </td>
</tr>
<tr>
<td><code>ALfloat</code></td>
<td><code>ALCfloat</code></td>
<td><code>GLfloat</code></td>
<td><code>float</code></td>
<td>32-     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IEEE 754</a></td>
</tr>
<tr>
<td><code>ALdouble</code></td>
<td><code>ALCdouble</code></td>
<td><code>GLdouble</code></td>
<td><code>double</code></td>
<td>64-     IEEE 754</td>
</tr>
<tr>
<td><code>ALvoid</code></td>
<td><code>ALCvoid</code></td>
<td><code>GLvoid</code></td>
<td><code>void</code></td>
<td> </td>
</tr>
</tbody>
</table></div><br>
<h2>  OpenAL</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un article sur la fa√ßon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de simplifier la reconnaissance des erreurs OpenAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais par souci d'exhaustivit√©, je vais le r√©p√©ter ici. Il existe deux </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">types</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d'appels OpenAL API: r√©guliers et contextuels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les appels de contexte commen√ßant par </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont similaires aux appels OpenGL win32 pour obtenir le contexte de rendu ou leurs homologues sous Linux. Le son est une chose assez simple pour que tous les syst√®mes d'exploitation aient les m√™mes appels. Les appels ordinaires commencent par </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour obtenir des erreurs dans les appels contextuels, nous appelons </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; dans le cas d'appels r√©guliers, nous appelons </font></font><code>alGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ils renvoient une valeur </font></font><code>ALCenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou une valeur </font></font><code>ALenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui r√©pertorie simplement les erreurs possibles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant consid√©rer un seul cas, mais dans tout le reste, ils sont presque les m√™mes. </font><font style="vertical-align: inherit;">Relevons les d√©fis habituels </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tout d'abord, cr√©ez une macro de pr√©processeur pour faire le travail ennuyeux de transmission des d√©tails:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> alCall(function, ...) alCallImpl(__FILE__, __LINE__, function, __VA_ARGS__)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Th√©oriquement, votre compilateur peut ne pas prendre </font></font><code>__FILE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en </font><font style="vertical-align: inherit;">charge non </font><font style="vertical-align: inherit;">plus </font></font><code>__LINE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais, pour √™tre honn√™te, je serais surpris si cela se r√©v√©lait √™tre le cas. </font></font><code>__VA_ARGS__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique un nombre variable d'arguments pouvant √™tre transmis √† cette macro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous impl√©mentons une fonction qui re√ßoit manuellement la derni√®re erreur signal√©e et affiche une valeur claire dans le flux d'erreurs standard.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check_al_errors</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line)</span>
</span>{<font></font>
    ALenum error = alGetError();<font></font>
    <span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"***ERROR*** ("</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; line &lt;&lt; <span class="hljs-string">")\n"</span> ;
        <span class="hljs-keyword">switch</span>(error)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> AL_INVALID_NAME:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_NAME: a bad name (ID) was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_ENUM:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_ENUM: an invalid enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_VALUE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_VALUE: an invalid value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_OPERATION:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_OPERATION: the requested operation is not valid"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_OUT_OF_MEMORY:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_OUT_OF_MEMORY: the requested operation resulted in OpenAL running out of memory"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"UNKNOWN AL ERROR: "</span> &lt;&lt; error;<font></font>
        }<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas beaucoup d'erreurs possibles. </font><font style="vertical-align: inherit;">Les explications que j'ai √©crites dans le code sont les seules informations que vous recevrez sur ces erreurs, mais la sp√©cification explique pourquoi une fonction particuli√®re peut renvoyer une erreur sp√©cifique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous impl√©mentons deux fonctions de mod√®le diff√©rentes qui encapsuleront tous nos appels OpenGL.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                alFunction function, 
                Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;!<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;
</span>{
    <span class="hljs-keyword">auto</span> ret = function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);<font></font>
    check_al_errors(filename,line);<font></font>
    <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                 alcFunction function, 
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y en a deux, car le premier est utilis√© pour les fonctions OpenAL qui retournent </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le second est utilis√© lorsque la fonction renvoie une valeur non vide. </font><font style="vertical-align: inherit;">Si vous n'√™tes pas tr√®s familier avec les mod√®les de m√©taprogrammation en C ++, jetez un ≈ìil aux parties du code c </font></font><code>std::enable_if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils d√©terminent lesquelles de ces fonctions de mod√®le sont impl√©ment√©es par le compilateur pour chaque appel de fonction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant la m√™me chose pour les appels </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> alcCall(function, device, ...) alcCallImpl(__FILE__, __LINE__, function, device, __VA_ARGS__)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check_alc_errors</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, ALCdevice* device)</span>
</span>{<font></font>
    ALCenum error = alcGetError(device);<font></font>
    <span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"***ERROR*** ("</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; line &lt;&lt; <span class="hljs-string">")\n"</span> ;
        <span class="hljs-keyword">switch</span>(error)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> ALC_INVALID_VALUE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_VALUE: an invalid value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_DEVICE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_DEVICE: a bad device was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_CONTEXT:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_CONTEXT: a bad context was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_ENUM:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_ENUM: an unknown enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_OUT_OF_MEMORY:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_OUT_OF_MEMORY: an unknown enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"UNKNOWN ALC ERROR: "</span> &lt;&lt; error;<font></font>
        }<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                 alcFunction function, 
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span> ReturnType, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename,
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line,
                 alcFunction function,
                 ReturnType&amp; returnValue,
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;!<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    returnValue = function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus grand changement est l'inclusion </font></font><code>device</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que tous les appels utilisent </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ainsi que l'utilisation correspondante des erreurs de style </font></font><code>ALCenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>ALC_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils ont l'air tr√®s similaires, et pendant tr√®s longtemps de petits changements de </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gravement endommag√© mon code et ma compr√©hension, j'ai donc continu√© √† lire juste en haut </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">En r√®gle g√©n√©rale, un appel OpenAL en C ++ ressemble √† l'une des options suivantes:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* example #1 */</span>
alGenSources(<span class="hljs-number">1</span>, &amp;source);<font></font>
ALenum error = alGetError();<font></font>
<span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #2 */</span><font></font>
alcCaptureStart(&amp;device);<font></font>
ALCenum error = alcGetError();<font></font>
<span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #3 */</span>
<span class="hljs-keyword">const</span> ALchar* sz = alGetString(param);<font></font>
ALenum error = alGetError();<font></font>
<span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #4 */</span>
<span class="hljs-keyword">const</span> ALCchar* sz = alcGetString(&amp;device, param);<font></font>
ALCenum error = alcGetError();<font></font>
<span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais maintenant, nous pouvons le faire comme ceci:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* example #1 */</span>
<span class="hljs-keyword">if</span>(!alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #2 */</span>
<span class="hljs-keyword">if</span>(!alcCall(alcCaptureStart, &amp;device))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #3 */</span>
<span class="hljs-keyword">const</span> ALchar* sz;
<span class="hljs-keyword">if</span>(!alCall(alGetString, sz, param))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #4 */</span>
<span class="hljs-keyword">const</span> ALCchar* sz;
<span class="hljs-keyword">if</span>(!alcCall(alcGetString, sz, &amp;device, param))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela peut vous sembler √©trange, mais c'est plus pratique pour moi. </font><font style="vertical-align: inherit;">Bien s√ªr, vous pouvez choisir une structure diff√©rente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©chargez les fichiers .wav</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez soit les t√©l√©charger vous-m√™me, soit utiliser la biblioth√®que. </font><font style="vertical-align: inherit;">Voici une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impl√©mentation open-source de chargement de fichiers .wav</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je suis fou, donc je le fais moi-m√™me:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> <span class="hljs-title">convert_to_int</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* buffer, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> len)</span>
</span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> a = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::endian::native == <span class="hljs-built_in">std</span>::endian::little)
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">memcpy</span>(&amp;a, buffer, len);
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; len; ++i)
            <span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">char</span>*&gt;(&amp;a)[<span class="hljs-number">3</span> - i] = buffer[i];
    <span class="hljs-keyword">return</span> a;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">load_wav_file_header</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::ifstream&amp; file,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; channels,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span>&amp; sampleRate,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; bitsPerSample,
                          ALsizei&amp; size)</span>
</span>{
    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">4</span>];
    <span class="hljs-keyword">if</span>(!file.is_open())
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">// the RIFF</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read RIFF"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"RIFF"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (header doesn't begin with RIFF)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the size of the file</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read size of file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the WAVE</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read WAVE"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"WAVE"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (header doesn't contain WAVE)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// "fmt/0"</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read fmt/0"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// this is always 16, the size of the fmt data chunk</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read the 16"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// PCM should be 1?</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read PCM"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the number of channels</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read number of channels"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    channels = convert_to_int(buffer, <span class="hljs-number">2</span>);<font></font>
<font></font>
    <span class="hljs-comment">// sample rate</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read sample rate"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    sampleRate = convert_to_int(buffer, <span class="hljs-number">4</span>);<font></font>
<font></font>
    <span class="hljs-comment">// (sampleRate * bitsPerSample * channels) / 8</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read (sampleRate * bitsPerSample * channels) / 8"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// ?? dafaq</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read dafaq"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// bitsPerSample</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read bits per sample"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    bitsPerSample = convert_to_int(buffer, <span class="hljs-number">2</span>);<font></font>
<font></font>
    <span class="hljs-comment">// data chunk header "data"</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read data chunk header"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"data"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (doesn't have 'data' tag)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// size of data</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read data size"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    size = convert_to_int(buffer, <span class="hljs-number">4</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* cannot be at the end of file */</span>
    <span class="hljs-keyword">if</span>(file.eof())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: reached EOF on the file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(file.fail())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: fail state set on the file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">load_wav</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; channels,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span>&amp; sampleRate,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; bitsPerSample,
               ALsizei&amp; size)</span>
</span>{
    <span class="hljs-function"><span class="hljs-built_in">std</span>::ifstream <span class="hljs-title">in</span><span class="hljs-params">(filename, <span class="hljs-built_in">std</span>::ios::binary)</span></span>;
    <span class="hljs-keyword">if</span>(!in.is_open())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not open \""</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(!load_wav_file_header(in, channels, sampleRate, bitsPerSample, size))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav header of \""</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">char</span>* data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[size];<font></font>
<font></font>
    in.read(data, size);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> data;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne vais pas expliquer le code, car ce n'est pas enti√®rement dans le sujet de notre article; </font><font style="vertical-align: inherit;">mais c'est tr√®s √©vident si vous le lisez en parall√®le avec la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cification du fichier WAV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialisation et destruction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons d'abord initialiser OpenAL, puis, comme tout bon programmeur, le terminer lorsque nous avons fini de travailler avec. </font><font style="vertical-align: inherit;">Il est utilis√© lors de l'initialisation </font></font><code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(notez que ce </font></font><code>ALC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas le cas</font></font></i> <code>AL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), qui repr√©sente essentiellement quelque chose sur votre ordinateur pour jouer de la musique de fond et l'utilise </font></font><code>ALCcontext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similaire au choix d'une carte graphique. </font><font style="vertical-align: inherit;">sur lequel votre jeu OpenGL sera rendu. </font></font><code>ALCcontext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similaire au contexte de rendu que vous souhaitez cr√©er (unique au syst√®me d'exploitation) pour OpenGL.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alcdevice</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un p√©riph√©rique OpenAL est ce par quoi le son est √©mis, que ce soit une carte son ou une puce, mais th√©oriquement, cela peut √™tre beaucoup de choses diff√©rentes. Semblable √† la fa√ßon dont la sortie standard </font></font><code>iostream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut √™tre une imprimante plut√¥t qu'un √©cran, un p√©riph√©rique peut √™tre un fichier ou m√™me un flux de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, pour la programmation de jeux, ce sera un p√©riph√©rique audio, et g√©n√©ralement nous voulons que ce soit un p√©riph√©rique de sortie audio standard dans le syst√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour obtenir une liste des appareils disponibles dans le syst√®me, vous pouvez les demander avec cette fonction:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">get_available_devices</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;&amp; devicesVec, ALCdevice* device)</span>
</span>{
    <span class="hljs-keyword">const</span> ALCchar* devices;
    <span class="hljs-keyword">if</span>(!alcCall(alcGetString, devices, device, <span class="hljs-literal">nullptr</span>, ALC_DEVICE_SPECIFIER))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ptr = devices;<font></font>
<font></font>
    devicesVec.clear();<font></font>
<font></font>
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        devicesVec.push_back(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(ptr));<font></font>
        ptr += devicesVec.back().size() + <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">while</span>(*(ptr + <span class="hljs-number">1</span>) != <span class="hljs-string">'\0'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est en fait juste un wrapper autour d'un wrapper autour d'un appel </font></font><code>alcGetString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La valeur de retour est un pointeur vers une liste de cha√Ænes s√©par√©es par une valeur </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et se terminant par deux valeurs </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ici, le wrapper le transforme simplement en un vecteur qui nous convient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, nous n'avons pas besoin de faire √ßa! Dans le cas g√©n√©ral, comme je le soup√ßonne, la plupart des jeux peuvent simplement √©mettre du son vers l'appareil par d√©faut, quel qu'il soit. Je vois rarement les options pour changer le p√©riph√©rique audio √† travers lequel vous souhaitez √©mettre du son. Par cons√©quent, pour initialiser le p√©riph√©rique OpenAL, nous utilisons un appel </font></font><code>alcOpenDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cet appel est l√©g√®rement diff√©rent de tout le reste, car il ne sp√©cifie pas l'√©tat d'erreur qui peut √™tre obtenu via </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous l'appelons donc comme une fonction normale:</font></font><br>
<br>
<pre><code class="cpp hljs">ALCdevice* openALDevice = alcOpenDevice(<span class="hljs-literal">nullptr</span>);
<span class="hljs-keyword">if</span>(!openALDevice)<font></font>
{<font></font>
    <span class="hljs-comment">/* fail */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez r√©pertori√© les p√©riph√©riques comme indiqu√© ci-dessus et que vous souhaitez que l'utilisateur en s√©lectionne un, vous devez transf√©rer son nom √† la </font></font><code>alcOpenDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Envoi de </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commandes </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ouvrir l'appareil par d√©faut</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La valeur de retour est soit le p√©riph√©rique correspondant, soit en </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cas d'erreur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon que vous avez termin√© l'√©num√©ration ou non, une erreur peut arr√™ter le programme sur les pistes. Aucun p√©riph√©rique = Aucun OpenAL; pas OpenAL = pas de son; pas de son = pas de jeu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La derni√®re chose que nous faisons lors de la fermeture d'un programme est de le terminer correctement.</font></font><br>
<br>
<pre><code class="cpp hljs">ALCboolean closed;
<span class="hljs-keyword">if</span>(!alcCall(alcCloseDevice, closed, openALDevice, openALDevice))<font></font>
{<font></font>
    <span class="hljs-comment">/* do we care? */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce stade, si l'ach√®vement n'√©tait pas possible, cela n'est plus important pour nous. Avant de fermer l'appareil, nous devons fermer tous les contextes cr√©√©s, cependant, selon mon exp√©rience, cet appel compl√®te √©galement le contexte. Mais nous le ferons bien. Si vous terminez tout avant de passer un appel </font></font><code>alcCloseDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il ne devrait pas y avoir d'erreurs et si, pour une raison quelconque, elles se sont produites, vous ne pouvez rien y faire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous avez peut-√™tre remarqu√© que les appels provenant de l' </font></font><code>alcCall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envoi de deux copies de l'appareil. Cela s'est produit en raison du fonctionnement de la fonction de mod√®le - un est n√©cessaire pour la v√©rification des erreurs et le second est utilis√© comme param√®tre de fonction.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Th√©oriquement, je peux am√©liorer la fonction de mod√®le afin qu'elle passe le premier param√®tre pour la v√©rification des erreurs et l'envoie toujours √† la fonction; </font><font style="vertical-align: inherit;">mais je suis paresseux pour le faire. </font><font style="vertical-align: inherit;">Je vais laisser cela comme vos devoirs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre ALCcontext</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxi√®me partie de l'initialisation est le contexte. </font><font style="vertical-align: inherit;">Comme pr√©c√©demment, il est similaire au contexte de rendu d'OpenGL. </font><font style="vertical-align: inherit;">Il peut y avoir plusieurs contextes dans un programme et nous pouvons basculer entre eux, mais nous n'en aurons pas besoin. </font><font style="vertical-align: inherit;">Chaque contexte a son propre </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©couteur</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><font style="vertical-align: inherit;">ses propres </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sources</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et ils ne peuvent pas √™tre transmis entre les contextes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est peut-√™tre utile dans les logiciels de traitement du son. </font><font style="vertical-align: inherit;">Cependant, pour les jeux dans 99,9% des cas, un seul contexte suffit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La cr√©ation d'un nouveau contexte est tr√®s simple:</font></font><br>
<br>
<pre><code class="cpp hljs">ALCcontext* openALContext;
<span class="hljs-keyword">if</span>(!alcCall(alcCreateContext, openALContext, openALDevice, openALDevice, <span class="hljs-literal">nullptr</span>) || !openALContext)<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not create audio context"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">/* probably exit program */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons communiquer pour ce que </font></font><code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous voulons cr√©er un contexte; </font><font style="vertical-align: inherit;">nous pouvons √©galement transmettre une liste facultative de cl√©s z√©ro et de valeurs </font></font><code>ALCint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui sont des attributs avec lesquels le contexte doit √™tre cr√©√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honn√™tement, je ne sais m√™me pas dans quelle situation le passage d'attribut est utile. </font><font style="vertical-align: inherit;">Votre jeu fonctionnera sur un ordinateur ordinaire avec les fonctionnalit√©s sonores habituelles. </font><font style="vertical-align: inherit;">Les attributs ont des valeurs par d√©faut, selon l'ordinateur, ce n'est donc pas particuli√®rement important. </font><font style="vertical-align: inherit;">Mais au cas o√π vous en auriez encore besoin:</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nom d'attribut</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La description</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ALC_FREQUENCY</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fr√©quence de mixage vers le tampon de sortie, mesur√©e en Hz</font></font></td>
</tr>
<tr>
<td><code>ALC_REFRESH</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intervalles de mise √† jour, mesur√©s en Hz</font></font></td>
</tr>
<tr>
<td><code>ALC_SYNC</code></td>
<td><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indiquer s'il doit s'agir d'un contexte synchrone ou asynchrone</font></font></td>
</tr>
<tr>
<td><code>ALC_MONO_SOURCES</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une valeur qui vous indique le nombre de sources que vous utiliserez et qui n√©cessitent la capacit√© de traiter des donn√©es audio monophoniques. </font><font style="vertical-align: inherit;">Il ne limite pas le montant maximum, il vous permet simplement d'√™tre plus efficace lorsque vous le savez √† l'avance.</font></font></td>
</tr>
<tr>
<td><code>ALC_STEREO_SOURCES</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√™me chose, mais pour les donn√©es st√©r√©o.</font></font></td>
</tr>
</tbody>
</table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous obtenez des erreurs, cela est probablement d√ª au fait que les attributs souhait√©s sont impossibles ou que vous ne pouvez pas cr√©er un autre contexte pour le p√©riph√©rique pris en charge; </font><font style="vertical-align: inherit;">cela entra√Ænera une erreur </font></font><code>ALC_INVALID_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si vous passez devant un appareil invalide, vous obtiendrez une erreur </font></font><code>ALC_INVALID_DEVICE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais, bien s√ªr, nous v√©rifions d√©j√† cette erreur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©er un contexte ne suffit pas. </font><font style="vertical-align: inherit;">Nous devons encore l'actualiser - il ressemble √† un contexte de rendu Windows OpenGL, non? </font><font style="vertical-align: inherit;">C'est le m√™me.</font></font><br>
<br>
<pre><code class="cpp hljs">ALCboolean contextMadeCurrent = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, openALContext)<font></font>
   || contextMadeCurrent != ALC_TRUE)<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not make audio context current"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">/* probably exit or give up on having sound */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est n√©cessaire d'actualiser le contexte pour toute op√©ration ult√©rieure avec le contexte (ou avec les sources et les √©couteurs qu'il contient). </font><font style="vertical-align: inherit;">L'op√©ration retournera </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la seule valeur d'erreur possible transmise </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est celle </font></font><code>ALC_INVALID_CONTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est claire d'apr√®s le nom. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finir avec le contexte, c.-√†-d. </font><font style="vertical-align: inherit;">√† la sortie du programme, il faut que le contexte ne soit plus d'actualit√©, puis le d√©truire.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, <span class="hljs-literal">nullptr</span>))<font></font>
{<font></font>
    <span class="hljs-comment">/* what can you do? */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span>(!alcCall(alcDestroyContext, openALDevice, openALContext))<font></font>
{<font></font>
    <span class="hljs-comment">/* not much you can do */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La seule erreur possible de </font></font><code>alcDestroyContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est la m√™me que celle de </font></font><code>alcMakeContextCurrent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>ALC_INVALID_CONTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">si vous faites tout correctement, alors vous ne l'obtiendrez pas, mais si vous le faites, alors rien ne peut √™tre fait √† ce sujet.</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi v√©rifier les erreurs avec lesquelles rien ne peut √™tre fait? </font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parce que je veux que les messages les concernant apparaissent au moins dans le flux d'erreurs, ce qui pour nous. </font></font><code>alcCall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supposons qu'il ne nous donne jamais d'erreurs, mais il sera utile de savoir qu'une telle erreur se produit sur l'ordinateur de quelqu'un d'autre. </font><font style="vertical-align: inherit;">Gr√¢ce √† cela, nous pouvons √©tudier le probl√®me, et √©ventuellement </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signaler un bug aux d√©veloppeurs OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jouez notre premier son</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, assez de tout cela, jouons le son. </font><font style="vertical-align: inherit;">Pour commencer, nous avons √©videmment besoin d'un fichier son. </font><font style="vertical-align: inherit;">Par exemple, celui-ci, d'un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeu que je finirai jamais</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://indiegamedev.net/wp-content/uploads/2020/02/iamtheprotectorofthissystem.wav</font></font></a></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis le protecteur de ce syst√®me!</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alors, ouvrez l'IDE et utilisez le code suivant. N'oubliez pas de brancher OpenAL Soft et d'ajouter le code de t√©l√©chargement de fichier et le code de v√©rification d'erreur ci-dessus.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
    ALCdevice* openALDevice = alcOpenDevice(<span class="hljs-literal">nullptr</span>);
    <span class="hljs-keyword">if</span>(!openALDevice)
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
<font></font>
    ALCcontext* openALContext;<font></font>
    <span class="hljs-keyword">if</span>(!alcCall(alcCreateContext, openALContext, openALDevice, openALDevice, <span class="hljs-literal">nullptr</span>) || !openALContext)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not create audio context"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    ALCboolean contextMadeCurrent = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, openALContext)<font></font>
       || contextMadeCurrent != ALC_TRUE)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not make audio context current"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> channels;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> sampleRate;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> bitsPerSample;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">char</span>&gt; soundData;
    <span class="hljs-keyword">if</span>(!load_wav(<span class="hljs-string">"iamtheprotectorofthissystem.wav"</span>, channels, sampleRate, bitsPerSample, soundData))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    ALuint buffer;<font></font>
    alCall(alGenBuffers, <span class="hljs-number">1</span>, &amp;buffer);<font></font>
<font></font>
    ALenum format;<font></font>
    <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
        format = AL_FORMAT_MONO8;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
        format = AL_FORMAT_MONO16;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
        format = AL_FORMAT_STEREO8;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
        format = AL_FORMAT_STEREO16;<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>
            &lt;&lt; <span class="hljs-string">"ERROR: unrecognised wave format: "</span>
            &lt;&lt; channels &lt;&lt; <span class="hljs-string">" channels, "</span>
            &lt;&lt; bitsPerSample &lt;&lt; <span class="hljs-string">" bps"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    alCall(alBufferData, buffer, format, soundData.data(), soundData.size(), sampleRate);<font></font>
    soundData.clear(); <span class="hljs-comment">// erase the sound in RAM</span><font></font>
<font></font>
    ALuint source;<font></font>
    alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
    alCall(alSourcef, source, AL_PITCH, <span class="hljs-number">1</span>);<font></font>
    alCall(alSourcef, source, AL_GAIN, <span class="hljs-number">1.0f</span>);<font></font>
    alCall(alSource3f, source, AL_POSITION, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
    alCall(alSource3f, source, AL_VELOCITY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
    alCall(alSourcei, source, AL_LOOPING, AL_FALSE);<font></font>
    alCall(alSourcei, source, AL_BUFFER, buffer);<font></font>
<font></font>
    alCall(alSourcePlay, source);<font></font>
<font></font>
    ALint state = AL_PLAYING;<font></font>
<font></font>
    <span class="hljs-keyword">while</span>(state == AL_PLAYING)<font></font>
    {<font></font>
        alCall(alGetSourcei, source, AL_SOURCE_STATE, &amp;state);<font></font>
    }<font></font>
<font></font>
    alCall(alDeleteSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
    alCall(alDeleteBuffers, <span class="hljs-number">1</span>, &amp;buffer);<font></font>
<font></font>
    alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, <span class="hljs-literal">nullptr</span>);<font></font>
    alcCall(alcDestroyContext, openALDevice, openALContext);<font></font>
<font></font>
    ALCboolean closed;<font></font>
    alcCall(alcCloseDevice, closed, openALDevice, openALDevice);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compilation! </font><font style="vertical-align: inherit;">Nous composons! </font><font style="vertical-align: inherit;">Lancement! </font></font><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis le pr√©-protecteur de ce syst√®me</font></font></strong></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si vous n'entendez pas le son, v√©rifiez √† nouveau tout. </font><font style="vertical-align: inherit;">Si quelque chose est √©crit dans la fen√™tre de la console, cela devrait √™tre la sortie standard du flux d'erreur, et c'est important. </font><font style="vertical-align: inherit;">Nos fonctions de rapport d'erreurs devraient nous indiquer la ligne de code source qui a g√©n√©r√© l'erreur. </font><font style="vertical-align: inherit;">Si vous trouvez une </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
erreur, lisez le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">programmeur</font></a><font style="vertical-align: inherit;"> et la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour comprendre les conditions dans lesquelles cette erreur peut √™tre g√©n√©r√©e par une fonction. </font><font style="vertical-align: inherit;">Cela vous aidera √† le comprendre. </font><font style="vertical-align: inherit;">Si cela ne r√©ussit pas, laissez un commentaire sous l'article d'origine et j'essaierai de vous aider.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©charger les donn√©es RIFF WAVE</font></font></h3><br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> channels;
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> sampleRate;
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> bitsPerSample;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">char</span>&gt; soundData;
<span class="hljs-keyword">if</span>(!load_wav(<span class="hljs-string">"iamtheprotectorofthissystem.wav"</span>, channels, sampleRate, bitsPerSample, soundData))<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit du code de d√©marrage Wave. </font><font style="vertical-align: inherit;">L'important est que nous recevions des donn√©es, soit sous forme de pointeur, soit collect√©es dans un vecteur: le nombre de canaux, la fr√©quence d'√©chantillonnage et le nombre de bits par √©chantillon.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G√©n√©ration de tampon</font></font></h3><br>
<pre><code class="cpp hljs">ALuint buffer;<font></font>
alCall(alGenBuffers, <span class="hljs-number">1</span>, &amp;buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela vous semble probablement familier si vous avez d√©j√† g√©n√©r√© des tampons de donn√©es de texture dans OpenGL. En substance, nous g√©n√©rons un tampon et faisons comme s'il n'existait que sur la carte son. En fait, il sera tr√®s probablement stock√© dans la RAM ordinaire, mais la sp√©cification OpenAL r√©sume toutes ces op√©rations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la valeur </font></font><code>ALuint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handle vers</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notre tampon. N'oubliez pas que le </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tampon</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est essentiellement des donn√©es sonores dans la m√©moire de la carte son. Nous n'avons plus </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acc√®s directement</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† ces donn√©es, car nous les avons prises du programme (de la RAM ordinaire) et les avons d√©plac√©es vers une carte son / puce, etc. OpenGL fonctionne de mani√®re similaire, en d√©pla√ßant les donn√©es de texture de la RAM vers la VRAM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descripteur</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g√©n√®re </font></font><code>alGenBuffers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il a quelques valeurs d'erreur possibles, dont la plus importante est </font></font><code>AL_OUT_OF_MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui signifie que nous ne pouvons plus ajouter de donn√©es audio √† la carte son. </font><font style="vertical-align: inherit;">Vous n'obtiendrez pas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erreur si, par exemple, vous utilisez un seul tampon, mais vous devez en tenir compte si vous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr√©ez un moteur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©terminer le format des donn√©es audio</font></font></h3><br>
<pre><code class="cpp hljs">ALenum format;<font></font>
<font></font>
<span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
    format = AL_FORMAT_MONO8;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
    format = AL_FORMAT_MONO16;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
    format = AL_FORMAT_STEREO8;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
    format = AL_FORMAT_STEREO16;<font></font>
<span class="hljs-keyword">else</span><font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>
        &lt;&lt; <span class="hljs-string">"ERROR: unrecognised wave format: "</span>
        &lt;&lt; channels &lt;&lt; <span class="hljs-string">" channels, "</span>
        &lt;&lt; bitsPerSample &lt;&lt; <span class="hljs-string">" bps"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les donn√©es sonores fonctionnent comme ceci: il y a plusieurs </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canaux</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et il y a une taille de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit par √©chantillon</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les donn√©es se composent de nombreux </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©chantillons</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour d√©terminer le nombre d' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©chantillons</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les donn√©es audio, nous proc√©dons comme suit:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int_fast32_t</span> numberOfSamples = dataSize / (numberOfChannels * (bitsPerSample / <span class="hljs-number">8</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui peut √™tre facilement converti en calcul de la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dur√©e des</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> donn√©es audio:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> duration = numberOfSamples / sampleRate;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais alors que nous n'avons pas besoin de savoir ni </font></font><code>numberOfSamples</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ni </font></font><code>duration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cependant, il est important de savoir comment toutes ces informations sont utilis√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revenons √† </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- nous devons indiquer √† OpenAL le format des donn√©es audio. Cela semble √©vident, non? Semblable √† la fa√ßon dont nous remplissons le tampon de texture OpenGL, en disant que les donn√©es sont dans une s√©quence BGRA et sont compos√©es de valeurs 8 bits, nous devons faire de m√™me dans OpenAL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour dire √† OpenAL comment interpr√©ter les donn√©es point√©es par le pointeur que nous passerons plus tard, nous devons d√©finir le format des donn√©es. Sous le </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il est cens√© √™tre compris par OpenAL. Il n'y a que quatre significations possibles. Il existe deux valeurs possibles pour le nombre de canaux: une pour mono, deux pour st√©r√©o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du nombre de canaux, nous avons le nombre de bits par √©chantillon. </font><font style="vertical-align: inherit;">Il est √©gal √† ou </font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou </font></font><code>16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et est essentiellement de qualit√© sonore. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, en utilisant les valeurs des canaux et des bits par √©chantillon, dont la fonction de charge d'onde nous a inform√©s, nous pouvons d√©terminer celui √† </font></font><code>ALenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliser pour le futur param√®tre </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplissage de tampon</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alBufferData, buffer, format, soundData.data(), soundData.size(), sampleRate);<font></font>
soundData.clear(); <span class="hljs-comment">// erase the sound in RAM</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cela, tout devrait √™tre simple. </font><font style="vertical-align: inherit;">Nous chargeons dans le tampon OpenAL, vers lequel pointe le </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descripteur</font></font></em> <code>buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">les donn√©es point√©es par ptr </font></font><code>soundData.data()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la taille du </font></font><code>size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cifi√© </font></font><code>sampleRate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous informerons √©galement OpenAL du format de ces donn√©es via le param√®tre </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au final, nous supprimons simplement les donn√©es re√ßues par le chargeur de vagues. </font><font style="vertical-align: inherit;">Pourquoi? </font><font style="vertical-align: inherit;">Parce que nous les avons d√©j√† copi√©s sur la carte son. </font><font style="vertical-align: inherit;">Nous n'avons pas besoin de les stocker √† deux endroits et de d√©penser de pr√©cieuses ressources. </font><font style="vertical-align: inherit;">Si la carte son perd des donn√©es, nous la t√©l√©chargerons simplement √† nouveau √† partir du disque et nous n'aurons pas besoin de la copier sur le processeur ou sur quelqu'un d'autre.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©glage de la source</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rappelons qu'OpenAL est essentiellement un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auditeur</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui √©coute les sons √©mis par une ou plusieurs </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sources</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Eh bien, il est maintenant temps de cr√©er une source sonore.</font></font><br>
<br>
<pre><code class="cpp hljs">ALuint source;<font></font>
alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
alCall(alSourcef, source, AL_PITCH, <span class="hljs-number">1</span>);<font></font>
alCall(alSourcef, source, AL_GAIN, <span class="hljs-number">1.0f</span>);<font></font>
alCall(alSource3f, source, AL_POSITION, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
alCall(alSource3f, source, AL_VELOCITY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
alCall(alSourcei, source, AL_LOOPING, AL_FALSE);<font></font>
alCall(alSourcei, source, AL_BUFFER, buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honn√™tement, il n'est pas n√©cessaire de d√©finir certains de ces param√®tres, car les valeurs par d√©faut nous conviennent parfaitement. Mais cela nous montre certains aspects avec lesquels vous pouvez exp√©rimenter et voir ce qu'ils font (vous pouvez m√™me agir habilement et les changer au fil du temps). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'abord, nous g√©n√©rons la source - rappelez-vous, ceci est encore une fois une </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poign√©e</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers quelque chose dans l'API OpenAL. Nous r√©glons la hauteur (ton) pour qu'elle ne change pas, le gain (volume) est √©gal √† la valeur d'origine des donn√©es audio, la position et la vitesse sont r√©initialis√©es; nous </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne bouclons pas le</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son, sinon notre programme ne se terminera jamais et indiquera le buffer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas que diff√©rentes sources peuvent utiliser le m√™me tampon. </font><font style="vertical-align: inherit;">Par exemple, les ennemis tirant sur un joueur √† diff√©rents endroits peuvent jouer le m√™me son de tir, nous n'avons donc pas besoin de nombreuses copies des donn√©es sonores, mais seulement de quelques endroits dans l'espace 3D √† partir duquel le son est produit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jouer son</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alSourcePlay, source);<font></font>
<font></font>
ALint state = AL_PLAYING;<font></font>
<font></font>
<span class="hljs-keyword">while</span>(state == AL_PLAYING)<font></font>
{<font></font>
    alCall(alGetSourcei, source, AL_SOURCE_STATE, &amp;state);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons d'abord commencer √† lire la source. </font><font style="vertical-align: inherit;">Appelez simplement </font></font><code>alSourcePlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous cr√©ons une valeur pour stocker l'√©tat actuel de la </font></font><code>AL_SOURCE_STATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source et le </font><font style="vertical-align: inherit;">mettons √† </font><font style="vertical-align: inherit;">jour √† l'infini. </font><font style="vertical-align: inherit;">Quand il n'est plus √©gal, </font></font><code>AL_PLAYING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons continuer. </font><font style="vertical-align: inherit;">Vous pouvez modifier l'√©tat √† la </font></font><code>AL_STOPPED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fin de l'√©mission du son √† partir du tampon (ou lorsqu'une erreur se produit). </font><font style="vertical-align: inherit;">Si vous d√©finissez la valeur de bouclage </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le son sera jou√© ind√©finiment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous pouvons changer le tampon source et jouer un autre son. </font><font style="vertical-align: inherit;">Ou rejouez le m√™me son, etc. </font><font style="vertical-align: inherit;">R√©glez simplement le tampon, utilisez </font></font><code>alSourcePlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-le et peut-√™tre </font></font><code>alSourceStop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, si n√©cessaire. </font><font style="vertical-align: inherit;">Dans les articles suivants, nous examinerons cela plus en d√©tail.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nettoyage</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alDeleteSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
alCall(alDeleteBuffers, <span class="hljs-number">1</span>, &amp;buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous lisons simplement les donn√©es audio une fois et que nous sortons, nous supprimerons la source et le tampon pr√©c√©demment cr√©√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le reste du code est compr√©hensible sans explication.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O√π aller ensuite?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connaissant tout ce qui est d√©crit dans cet article, vous pouvez d√©j√† cr√©er un petit jeu! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essayez de cr√©er Pong</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un autre jeu classique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pour eux plus n'est pas n√©cessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais rappelles-toi! </font><font style="vertical-align: inherit;">Ces tampons ne conviennent qu'aux sons courts, tr√®s probablement pendant quelques secondes. </font><font style="vertical-align: inherit;">Si vous avez besoin de musique ou de voix, vous devrez diffuser du son sur OpenAL. </font><font style="vertical-align: inherit;">Nous en parlerons dans l'une des parties suivantes d'une s√©rie de tutoriels.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488730/index.html">Nouvelles normes russes pour l'Internet des objets, la fabrication intelligente et la ville intelligente</a></li>
<li><a href="../fr488732/index.html">M. Simon, talentueux: comment des capacit√©s uniques et l'impression 3D peuvent changer le processus de production</a></li>
<li><a href="../fr488736/index.html">Le travail √† distance gagne du terrain</a></li>
<li><a href="../fr488740/index.html">Guide des balises HTML personnalis√©es pour Google Tag Manager par Simo Ahava</a></li>
<li><a href="../fr488742/index.html">Voir l'architecture? Et je ne vois pas, mais elle est</a></li>
<li><a href="../fr488748/index.html">Cr√©ez une application Todo √† l'aide de Django. Partie 1</a></li>
<li><a href="../fr488750/index.html">Promenade des dinosaures: deux grands ordinateurs du XXe si√®cle</a></li>
<li><a href="../fr488752/index.html">Golang + Phaser3 = MMORPG - Nous jetons les bases de la g√©n√©ration sans fin du monde</a></li>
<li><a href="../fr488754/index.html">Tout √† la fois: v√©rification automatique de la taille du lot</a></li>
<li><a href="../fr488756/index.html">Comment travailler avec l'API Google Sheets (Google Sheets API v4) dans R en utilisant le nouveau package googlesheets4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>