<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆕 👨🏾‍⚕️ 🕵🏻 Guide pour travailler avec OpenAL en C ++. Partie 1: jouer du son 👩🏻‍🍳 🐤 👨‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Votre jeu a besoin de son! Vous avez probablement déjà utilisé OpenGL pour dessiner à l'écran. Vous avez compris son API, et vous vous êtes donc tourn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Guide pour travailler avec OpenAL en C ++. Partie 1: jouer du son</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488744/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre jeu a besoin de son! </font><font style="vertical-align: inherit;">Vous avez probablement déjà utilisé OpenGL pour dessiner à l'écran. </font><font style="vertical-align: inherit;">Vous avez compris son API, et vous vous êtes donc tourné vers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parce que le nom semble familier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, la bonne nouvelle est qu'OpenAL possède également une API très familière. </font><font style="vertical-align: inherit;">Il a été initialement conçu pour simuler l'API de spécification OpenGL. </font><font style="vertical-align: inherit;">C'est pourquoi je l'ai choisi parmi les nombreux systèmes de sonorisation pour les jeux; </font><font style="vertical-align: inherit;">en outre, il est multiplateforme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je parlerai en détail du code nécessaire pour utiliser OpenAL dans un jeu écrit en C ++. </font><font style="vertical-align: inherit;">Nous discuterons des sons, de la musique et du positionnement sonore dans l'espace 3D avec des exemples de code.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Histoire d'OpenAL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'essaierai d'être bref. Comme mentionné ci-dessus, il a été intentionnellement conçu comme une imitation de l'API OpenGL, et il y a une raison à cela. Il s'agit d'une API pratique qui est connue de beaucoup, et si les graphiques sont un côté du moteur de jeu, alors le son devrait être différent. Initialement, OpenAL était censé être open-source, mais quelque chose s'est passé ... Les </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gens ne sont pas aussi intéressés par le son que par les graphiques, donc Creative a finalement fait d'OpenAL sa propriété, et l' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implémentation de référence est</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> désormais propriétaire et non gratuite. Mais! </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La spécification</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OpenAL est toujours une norme «ouverte», c'est-à-dire qu'elle est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publiée</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De temps en temps, les spécifications sont modifiées, mais pas beaucoup. Le son ne change pas aussi vite que les graphismes, car il n'y a pas de besoin particulier pour cela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La spécification ouverte a permis à d'autres personnes de créer une implémentation open source de la spécification. Une telle implémentation est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et franchement, cela n'a aucun sens d'en chercher d'autres. C'est l'implémentation que j'utiliserai, et je vous recommande de l'utiliser également.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elle est multiplateforme. </font><font style="vertical-align: inherit;">Il est implémenté assez curieusement - en fait, à l'intérieur de la bibliothèque utilise d'autres API sonores présentes dans votre système. </font><font style="vertical-align: inherit;">Sous Windows, il utilise </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectSound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sous Unix, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Grâce à cela, elle a pu devenir multiplateforme; </font><font style="vertical-align: inherit;">en substance, c'est un grand nom pour l'API wrapper. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez vous inquiéter de la vitesse de cette API. </font><font style="vertical-align: inherit;">Mais ne t'inquiète pas. </font><font style="vertical-align: inherit;">C'est le même son et il ne crée pas une charge importante, il ne nécessite donc pas les grandes optimisations requises par l'API graphique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais assez d'histoire, passons à la technologie.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De quoi avez-vous besoin pour écrire du code dans OpenAL?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez créer OpenAL Soft dans la chaîne d'outils de votre choix. Il s'agit d'un processus très simple que vous pouvez suivre conformément aux instructions </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la section Installation source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Je n'ai jamais eu de problème avec cela, mais si vous avez des difficultés, écrivez un commentaire sous l'article d'origine ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">écrivez à la liste de diffusion OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous aurez besoin de quelques fichiers audio et d'un moyen de les télécharger. Le chargement de données audio dans des tampons et des détails subtils de divers formats audio n'entrent pas dans le cadre de cet article, mais vous pouvez en savoir plus sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">téléchargement et le streaming de fichiers Ogg / Vorbis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le téléchargement de fichiers WAV est très simple, il existe déjà des centaines d'articles sur Internet à ce sujet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tâche de trouver des fichiers audio que vous devez décider vous-même. </font><font style="vertical-align: inherit;">Il existe de nombreux bruits et explosions sur Internet que vous pouvez télécharger. </font><font style="vertical-align: inherit;">Si vous avez une rumeur, vous pouvez essayer d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">écrire votre propre musique chiptune</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traduction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur Habré]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gardez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">également à portée de main le Guide du programmeur d'OpenALSoft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette documentation est bien meilleur pdf avec spécialisation "officielle". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, c'est tout. </font><font style="vertical-align: inherit;">Nous supposerons que vous savez déjà comment écrire du code, utilisez l'IDE et la chaîne d'outils.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Présentation de l'API OpenAL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dit plusieurs fois, c'est similaire à l'API OpenGL. La similitude réside dans le fait qu'elle est basée sur des états et que vous interagissez avec des descripteurs / identifiants, et non directement avec les objets eux-mêmes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des différences entre les conventions d'API dans OpenGL et OpenAL, mais elles ne sont pas significatives. Dans OpenGL, vous devez effectuer des appels OS spéciaux pour générer un contexte de rendu. Ces défis sont différents pour différents systèmes d'exploitation et </font><font style="vertical-align: inherit;">ne font pas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraiment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partie de la spécification OpenGL. Dans OpenAL, tout est différent - les fonctions de création de contexte font partie de la spécification et sont les mêmes quel que soit le système d'exploitation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous interagissez avec l'API, il existe trois principaux types d'objets avec lesquels vous interagissez. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les auditeurs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(«Listeners») est l'emplacement des «oreilles» situées dans l'espace 3D (il n'y a toujours qu'un seul auditeur). </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les sources</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> («sources») sont des «haut-parleurs» qui émettent du son, là encore dans l'espace 3D. </font><font style="vertical-align: inherit;">L'auditeur et les sources peuvent être déplacés dans l'espace et en fonction de cela, ce que vous entendez à travers les haut-parleurs dans le jeu change. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les derniers objets sont des </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tampons</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ils stockent des échantillons de sons que les sources joueront pour les auditeurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe également des </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le jeu utilise pour changer la façon dont l'audio est traité via OpenAL.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme mentionné ci-dessus, ces objets sont des sources de sons. </font><font style="vertical-align: inherit;">Ils peuvent être réglés en position et en direction, et ils sont associés à un tampon de lecture de données audio.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auditeur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le seul ensemble d '"oreilles" du jeu. </font><font style="vertical-align: inherit;">Ce que l'auditeur entend est reproduit par les haut-parleurs de l'ordinateur. </font><font style="vertical-align: inherit;">Il a également un poste.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampons</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans OpenGL, leur équivalent est Texture2D. </font><font style="vertical-align: inherit;">Il s'agit essentiellement des données audio que la source reproduit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Types de données</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour pouvoir prendre en charge le code multiplateforme, OpenAL effectue une certaine séquence d'actions et définit certains types de données. </font><font style="vertical-align: inherit;">En fait, il suit OpenGL si précisément que nous pouvons même convertir directement les types OpenAL en types OpenGL. </font><font style="vertical-align: inherit;">Le tableau ci-dessous les répertorie ainsi que leurs équivalents.</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type ouvert</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type openalc</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type opengl</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ Typedef</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La description</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ALboolean</code></td>
<td><code>ALCboolean</code></td>
<td><code>GLboolean</code></td>
<td><code>std::int8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur booléenne 8 bits</font></font></td>
</tr>
<tr>
<td><code>ALbyte</code></td>
<td><code>ALCbyte</code></td>
<td><code>GLbyte</code></td>
<td><code>std::int8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur entière sur 8 bits du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code supplémentaire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec un signe</font></font></td>
</tr>
<tr>
<td><code>ALubyte</code></td>
<td><code>ALCubyte</code></td>
<td><code>GLubyte</code></td>
<td><code>std::uint8_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur entière non signée 8 bits</font></font></td>
</tr>
<tr>
<td><code>ALchar</code></td>
<td><code>ALCchar</code></td>
<td><code>GLchar</code></td>
<td><code>char</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">symbole</font></font></td>
</tr>
<tr>
<td><code>ALshort</code></td>
<td><code>ALCshort</code></td>
<td><code>GLshort</code></td>
<td><code>std::int16_t</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeur entière signée 16 bits</font></font></td>
</tr>
<tr>
<td><code>ALushort</code></td>
<td><code>ALCushort</code></td>
<td><code>GLushort</code></td>
<td><code>std::uint16_t</code></td>
<td>16-    </td>
</tr>
<tr>
<td><code>ALint</code></td>
<td><code>ALCint</code></td>
<td><code>GLint</code></td>
<td><code>std::int32_t</code></td>
<td>32-      </td>
</tr>
<tr>
<td><code>ALuint</code></td>
<td><code>ALCuint</code></td>
<td><code>GLuint</code></td>
<td><code>std::uint32_t</code></td>
<td>32-    </td>
</tr>
<tr>
<td><code>ALsizei</code></td>
<td><code>ALCsizei</code></td>
<td><code>GLsizei</code></td>
<td><code>std::int32_t</code></td>
<td> 32-   </td>
</tr>
<tr>
<td><code>ALenum</code></td>
<td><code>ALCenum</code></td>
<td><code>GLenum</code></td>
<td><code>std::uint32_t</code></td>
<td> 32- </td>
</tr>
<tr>
<td><code>ALfloat</code></td>
<td><code>ALCfloat</code></td>
<td><code>GLfloat</code></td>
<td><code>float</code></td>
<td>32-     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IEEE 754</a></td>
</tr>
<tr>
<td><code>ALdouble</code></td>
<td><code>ALCdouble</code></td>
<td><code>GLdouble</code></td>
<td><code>double</code></td>
<td>64-     IEEE 754</td>
</tr>
<tr>
<td><code>ALvoid</code></td>
<td><code>ALCvoid</code></td>
<td><code>GLvoid</code></td>
<td><code>void</code></td>
<td> </td>
</tr>
</tbody>
</table></div><br>
<h2>  OpenAL</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un article sur la façon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de simplifier la reconnaissance des erreurs OpenAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais par souci d'exhaustivité, je vais le répéter ici. Il existe deux </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">types</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d'appels OpenAL API: réguliers et contextuels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les appels de contexte commençant par </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont similaires aux appels OpenGL win32 pour obtenir le contexte de rendu ou leurs homologues sous Linux. Le son est une chose assez simple pour que tous les systèmes d'exploitation aient les mêmes appels. Les appels ordinaires commencent par </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour obtenir des erreurs dans les appels contextuels, nous appelons </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; dans le cas d'appels réguliers, nous appelons </font></font><code>alGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ils renvoient une valeur </font></font><code>ALCenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou une valeur </font></font><code>ALenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui répertorie simplement les erreurs possibles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant considérer un seul cas, mais dans tout le reste, ils sont presque les mêmes. </font><font style="vertical-align: inherit;">Relevons les défis habituels </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tout d'abord, créez une macro de préprocesseur pour faire le travail ennuyeux de transmission des détails:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> alCall(function, ...) alCallImpl(__FILE__, __LINE__, function, __VA_ARGS__)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Théoriquement, votre compilateur peut ne pas prendre </font></font><code>__FILE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en </font><font style="vertical-align: inherit;">charge non </font><font style="vertical-align: inherit;">plus </font></font><code>__LINE__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais, pour être honnête, je serais surpris si cela se révélait être le cas. </font></font><code>__VA_ARGS__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique un nombre variable d'arguments pouvant être transmis à cette macro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous implémentons une fonction qui reçoit manuellement la dernière erreur signalée et affiche une valeur claire dans le flux d'erreurs standard.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check_al_errors</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line)</span>
</span>{<font></font>
    ALenum error = alGetError();<font></font>
    <span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"***ERROR*** ("</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; line &lt;&lt; <span class="hljs-string">")\n"</span> ;
        <span class="hljs-keyword">switch</span>(error)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> AL_INVALID_NAME:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_NAME: a bad name (ID) was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_ENUM:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_ENUM: an invalid enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_VALUE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_VALUE: an invalid value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_INVALID_OPERATION:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_INVALID_OPERATION: the requested operation is not valid"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> AL_OUT_OF_MEMORY:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"AL_OUT_OF_MEMORY: the requested operation resulted in OpenAL running out of memory"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"UNKNOWN AL ERROR: "</span> &lt;&lt; error;<font></font>
        }<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas beaucoup d'erreurs possibles. </font><font style="vertical-align: inherit;">Les explications que j'ai écrites dans le code sont les seules informations que vous recevrez sur ces erreurs, mais la spécification explique pourquoi une fonction particulière peut renvoyer une erreur spécifique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous implémentons deux fonctions de modèle différentes qui encapsuleront tous nos appels OpenGL.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                alFunction function, 
                Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;!<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;
</span>{
    <span class="hljs-keyword">auto</span> ret = function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);<font></font>
    check_al_errors(filename,line);<font></font>
    <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                 alcFunction function, 
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y en a deux, car le premier est utilisé pour les fonctions OpenAL qui retournent </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le second est utilisé lorsque la fonction renvoie une valeur non vide. </font><font style="vertical-align: inherit;">Si vous n'êtes pas très familier avec les modèles de métaprogrammation en C ++, jetez un œil aux parties du code c </font></font><code>std::enable_if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils déterminent lesquelles de ces fonctions de modèle sont implémentées par le compilateur pour chaque appel de fonction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant la même chose pour les appels </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> alcCall(function, device, ...) alcCallImpl(__FILE__, __LINE__, function, device, __VA_ARGS__)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check_alc_errors</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, ALCdevice* device)</span>
</span>{<font></font>
    ALCenum error = alcGetError(device);<font></font>
    <span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"***ERROR*** ("</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; line &lt;&lt; <span class="hljs-string">")\n"</span> ;
        <span class="hljs-keyword">switch</span>(error)<font></font>
        {<font></font>
        <span class="hljs-keyword">case</span> ALC_INVALID_VALUE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_VALUE: an invalid value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_DEVICE:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_DEVICE: a bad device was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_CONTEXT:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_CONTEXT: a bad context was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_INVALID_ENUM:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_INVALID_ENUM: an unknown enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> ALC_OUT_OF_MEMORY:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ALC_OUT_OF_MEMORY: an unknown enum value was passed to an OpenAL function"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"UNKNOWN ALC ERROR: "</span> &lt;&lt; error;<font></font>
        }<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, 
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line, 
                 alcFunction function, 
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> alcFunction, <span class="hljs-keyword">typename</span> ReturnType, <span class="hljs-keyword">typename</span>... Params&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">alcCallImpl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename,
                 <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint_fast32_t</span> line,
                 alcFunction function,
                 ReturnType&amp; returnValue,
                 ALCdevice* device, 
                 Params... params)</span>
-&gt;<span class="hljs-keyword">typename</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">enable_if_t</span>&lt;!<span class="hljs-built_in">std</span>::is_same_v&lt;<span class="hljs-keyword">void</span>,<span class="hljs-title">decltype</span><span class="hljs-params">(function(params...))</span>&gt;,<span class="hljs-keyword">bool</span>&gt;
</span>{<font></font>
    returnValue = function(<span class="hljs-built_in">std</span>::forward&lt;Params&gt;(params)...);
    <span class="hljs-keyword">return</span> check_alc_errors(filename,line,device);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus grand changement est l'inclusion </font></font><code>device</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que tous les appels utilisent </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ainsi que l'utilisation correspondante des erreurs de style </font></font><code>ALCenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>ALC_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils ont l'air très similaires, et pendant très longtemps de petits changements de </font></font><code>al</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à </font></font><code>alc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gravement endommagé mon code et ma compréhension, j'ai donc continué à lire juste en haut </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">En règle générale, un appel OpenAL en C ++ ressemble à l'une des options suivantes:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* example #1 */</span>
alGenSources(<span class="hljs-number">1</span>, &amp;source);<font></font>
ALenum error = alGetError();<font></font>
<span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #2 */</span><font></font>
alcCaptureStart(&amp;device);<font></font>
ALCenum error = alcGetError();<font></font>
<span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #3 */</span>
<span class="hljs-keyword">const</span> ALchar* sz = alGetString(param);<font></font>
ALenum error = alGetError();<font></font>
<span class="hljs-keyword">if</span>(error != AL_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #4 */</span>
<span class="hljs-keyword">const</span> ALCchar* sz = alcGetString(&amp;device, param);<font></font>
ALCenum error = alcGetError();<font></font>
<span class="hljs-keyword">if</span>(error != ALC_NO_ERROR)<font></font>
{<font></font>
    <span class="hljs-comment">/* handle different possibilities */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais maintenant, nous pouvons le faire comme ceci:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* example #1 */</span>
<span class="hljs-keyword">if</span>(!alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #2 */</span>
<span class="hljs-keyword">if</span>(!alcCall(alcCaptureStart, &amp;device))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #3 */</span>
<span class="hljs-keyword">const</span> ALchar* sz;
<span class="hljs-keyword">if</span>(!alCall(alGetString, sz, param))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* example #4 */</span>
<span class="hljs-keyword">const</span> ALCchar* sz;
<span class="hljs-keyword">if</span>(!alcCall(alcGetString, sz, &amp;device, param))<font></font>
{<font></font>
    <span class="hljs-comment">/* error occurred */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela peut vous sembler étrange, mais c'est plus pratique pour moi. </font><font style="vertical-align: inherit;">Bien sûr, vous pouvez choisir une structure différente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez les fichiers .wav</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez soit les télécharger vous-même, soit utiliser la bibliothèque. </font><font style="vertical-align: inherit;">Voici une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implémentation open-source de chargement de fichiers .wav</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je suis fou, donc je le fais moi-même:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> <span class="hljs-title">convert_to_int</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* buffer, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> len)</span>
</span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> a = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::endian::native == <span class="hljs-built_in">std</span>::endian::little)
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">memcpy</span>(&amp;a, buffer, len);
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; len; ++i)
            <span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">char</span>*&gt;(&amp;a)[<span class="hljs-number">3</span> - i] = buffer[i];
    <span class="hljs-keyword">return</span> a;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">load_wav_file_header</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::ifstream&amp; file,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; channels,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span>&amp; sampleRate,
                          <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; bitsPerSample,
                          ALsizei&amp; size)</span>
</span>{
    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">4</span>];
    <span class="hljs-keyword">if</span>(!file.is_open())
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">// the RIFF</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read RIFF"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"RIFF"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (header doesn't begin with RIFF)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the size of the file</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read size of file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the WAVE</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read WAVE"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"WAVE"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (header doesn't contain WAVE)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// "fmt/0"</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read fmt/0"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// this is always 16, the size of the fmt data chunk</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read the 16"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// PCM should be 1?</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read PCM"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// the number of channels</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read number of channels"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    channels = convert_to_int(buffer, <span class="hljs-number">2</span>);<font></font>
<font></font>
    <span class="hljs-comment">// sample rate</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read sample rate"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    sampleRate = convert_to_int(buffer, <span class="hljs-number">4</span>);<font></font>
<font></font>
    <span class="hljs-comment">// (sampleRate * bitsPerSample * channels) / 8</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read (sampleRate * bitsPerSample * channels) / 8"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// ?? dafaq</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read dafaq"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// bitsPerSample</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">2</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read bits per sample"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    bitsPerSample = convert_to_int(buffer, <span class="hljs-number">2</span>);<font></font>
<font></font>
    <span class="hljs-comment">// data chunk header "data"</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read data chunk header"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">"data"</span>, <span class="hljs-number">4</span>) != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: file is not a valid WAVE file (doesn't have 'data' tag)"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// size of data</span>
    <span class="hljs-keyword">if</span>(!file.read(buffer, <span class="hljs-number">4</span>))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: could not read data size"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    size = convert_to_int(buffer, <span class="hljs-number">4</span>);<font></font>
<font></font>
    <span class="hljs-comment">/* cannot be at the end of file */</span>
    <span class="hljs-keyword">if</span>(file.eof())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: reached EOF on the file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(file.fail())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: fail state set on the file"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">load_wav</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; filename,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; channels,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span>&amp; sampleRate,
               <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span>&amp; bitsPerSample,
               ALsizei&amp; size)</span>
</span>{
    <span class="hljs-function"><span class="hljs-built_in">std</span>::ifstream <span class="hljs-title">in</span><span class="hljs-params">(filename, <span class="hljs-built_in">std</span>::ios::binary)</span></span>;
    <span class="hljs-keyword">if</span>(!in.is_open())<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not open \""</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(!load_wav_file_header(in, channels, sampleRate, bitsPerSample, size))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav header of \""</span> &lt;&lt; filename &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">char</span>* data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[size];<font></font>
<font></font>
    in.read(data, size);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> data;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne vais pas expliquer le code, car ce n'est pas entièrement dans le sujet de notre article; </font><font style="vertical-align: inherit;">mais c'est très évident si vous le lisez en parallèle avec la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spécification du fichier WAV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialisation et destruction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons d'abord initialiser OpenAL, puis, comme tout bon programmeur, le terminer lorsque nous avons fini de travailler avec. </font><font style="vertical-align: inherit;">Il est utilisé lors de l'initialisation </font></font><code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(notez que ce </font></font><code>ALC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas le cas</font></font></i> <code>AL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), qui représente essentiellement quelque chose sur votre ordinateur pour jouer de la musique de fond et l'utilise </font></font><code>ALCcontext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similaire au choix d'une carte graphique. </font><font style="vertical-align: inherit;">sur lequel votre jeu OpenGL sera rendu. </font></font><code>ALCcontext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similaire au contexte de rendu que vous souhaitez créer (unique au système d'exploitation) pour OpenGL.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alcdevice</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un périphérique OpenAL est ce par quoi le son est émis, que ce soit une carte son ou une puce, mais théoriquement, cela peut être beaucoup de choses différentes. Semblable à la façon dont la sortie standard </font></font><code>iostream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut être une imprimante plutôt qu'un écran, un périphérique peut être un fichier ou même un flux de données. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, pour la programmation de jeux, ce sera un périphérique audio, et généralement nous voulons que ce soit un périphérique de sortie audio standard dans le système. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour obtenir une liste des appareils disponibles dans le système, vous pouvez les demander avec cette fonction:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">get_available_devices</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;&amp; devicesVec, ALCdevice* device)</span>
</span>{
    <span class="hljs-keyword">const</span> ALCchar* devices;
    <span class="hljs-keyword">if</span>(!alcCall(alcGetString, devices, device, <span class="hljs-literal">nullptr</span>, ALC_DEVICE_SPECIFIER))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ptr = devices;<font></font>
<font></font>
    devicesVec.clear();<font></font>
<font></font>
    <span class="hljs-keyword">do</span><font></font>
    {<font></font>
        devicesVec.push_back(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(ptr));<font></font>
        ptr += devicesVec.back().size() + <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">while</span>(*(ptr + <span class="hljs-number">1</span>) != <span class="hljs-string">'\0'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est en fait juste un wrapper autour d'un wrapper autour d'un appel </font></font><code>alcGetString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La valeur de retour est un pointeur vers une liste de chaînes séparées par une valeur </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et se terminant par deux valeurs </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ici, le wrapper le transforme simplement en un vecteur qui nous convient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, nous n'avons pas besoin de faire ça! Dans le cas général, comme je le soupçonne, la plupart des jeux peuvent simplement émettre du son vers l'appareil par défaut, quel qu'il soit. Je vois rarement les options pour changer le périphérique audio à travers lequel vous souhaitez émettre du son. Par conséquent, pour initialiser le périphérique OpenAL, nous utilisons un appel </font></font><code>alcOpenDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cet appel est légèrement différent de tout le reste, car il ne spécifie pas l'état d'erreur qui peut être obtenu via </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous l'appelons donc comme une fonction normale:</font></font><br>
<br>
<pre><code class="cpp hljs">ALCdevice* openALDevice = alcOpenDevice(<span class="hljs-literal">nullptr</span>);
<span class="hljs-keyword">if</span>(!openALDevice)<font></font>
{<font></font>
    <span class="hljs-comment">/* fail */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez répertorié les périphériques comme indiqué ci-dessus et que vous souhaitez que l'utilisateur en sélectionne un, vous devez transférer son nom à la </font></font><code>alcOpenDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Envoi de </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commandes </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ouvrir l'appareil par défaut</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La valeur de retour est soit le périphérique correspondant, soit en </font></font><code>nullptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cas d'erreur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon que vous avez terminé l'énumération ou non, une erreur peut arrêter le programme sur les pistes. Aucun périphérique = Aucun OpenAL; pas OpenAL = pas de son; pas de son = pas de jeu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La dernière chose que nous faisons lors de la fermeture d'un programme est de le terminer correctement.</font></font><br>
<br>
<pre><code class="cpp hljs">ALCboolean closed;
<span class="hljs-keyword">if</span>(!alcCall(alcCloseDevice, closed, openALDevice, openALDevice))<font></font>
{<font></font>
    <span class="hljs-comment">/* do we care? */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce stade, si l'achèvement n'était pas possible, cela n'est plus important pour nous. Avant de fermer l'appareil, nous devons fermer tous les contextes créés, cependant, selon mon expérience, cet appel complète également le contexte. Mais nous le ferons bien. Si vous terminez tout avant de passer un appel </font></font><code>alcCloseDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il ne devrait pas y avoir d'erreurs et si, pour une raison quelconque, elles se sont produites, vous ne pouvez rien y faire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous avez peut-être remarqué que les appels provenant de l' </font></font><code>alcCall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envoi de deux copies de l'appareil. Cela s'est produit en raison du fonctionnement de la fonction de modèle - un est nécessaire pour la vérification des erreurs et le second est utilisé comme paramètre de fonction.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Théoriquement, je peux améliorer la fonction de modèle afin qu'elle passe le premier paramètre pour la vérification des erreurs et l'envoie toujours à la fonction; </font><font style="vertical-align: inherit;">mais je suis paresseux pour le faire. </font><font style="vertical-align: inherit;">Je vais laisser cela comme vos devoirs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre ALCcontext</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxième partie de l'initialisation est le contexte. </font><font style="vertical-align: inherit;">Comme précédemment, il est similaire au contexte de rendu d'OpenGL. </font><font style="vertical-align: inherit;">Il peut y avoir plusieurs contextes dans un programme et nous pouvons basculer entre eux, mais nous n'en aurons pas besoin. </font><font style="vertical-align: inherit;">Chaque contexte a son propre </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">écouteur</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><font style="vertical-align: inherit;">ses propres </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sources</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et ils ne peuvent pas être transmis entre les contextes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est peut-être utile dans les logiciels de traitement du son. </font><font style="vertical-align: inherit;">Cependant, pour les jeux dans 99,9% des cas, un seul contexte suffit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La création d'un nouveau contexte est très simple:</font></font><br>
<br>
<pre><code class="cpp hljs">ALCcontext* openALContext;
<span class="hljs-keyword">if</span>(!alcCall(alcCreateContext, openALContext, openALDevice, openALDevice, <span class="hljs-literal">nullptr</span>) || !openALContext)<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not create audio context"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">/* probably exit program */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons communiquer pour ce que </font></font><code>ALCdevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous voulons créer un contexte; </font><font style="vertical-align: inherit;">nous pouvons également transmettre une liste facultative de clés zéro et de valeurs </font></font><code>ALCint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui sont des attributs avec lesquels le contexte doit être créé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honnêtement, je ne sais même pas dans quelle situation le passage d'attribut est utile. </font><font style="vertical-align: inherit;">Votre jeu fonctionnera sur un ordinateur ordinaire avec les fonctionnalités sonores habituelles. </font><font style="vertical-align: inherit;">Les attributs ont des valeurs par défaut, selon l'ordinateur, ce n'est donc pas particulièrement important. </font><font style="vertical-align: inherit;">Mais au cas où vous en auriez encore besoin:</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nom d'attribut</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La description</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ALC_FREQUENCY</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fréquence de mixage vers le tampon de sortie, mesurée en Hz</font></font></td>
</tr>
<tr>
<td><code>ALC_REFRESH</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intervalles de mise à jour, mesurés en Hz</font></font></td>
</tr>
<tr>
<td><code>ALC_SYNC</code></td>
<td><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indiquer s'il doit s'agir d'un contexte synchrone ou asynchrone</font></font></td>
</tr>
<tr>
<td><code>ALC_MONO_SOURCES</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une valeur qui vous indique le nombre de sources que vous utiliserez et qui nécessitent la capacité de traiter des données audio monophoniques. </font><font style="vertical-align: inherit;">Il ne limite pas le montant maximum, il vous permet simplement d'être plus efficace lorsque vous le savez à l'avance.</font></font></td>
</tr>
<tr>
<td><code>ALC_STEREO_SOURCES</code></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La même chose, mais pour les données stéréo.</font></font></td>
</tr>
</tbody>
</table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous obtenez des erreurs, cela est probablement dû au fait que les attributs souhaités sont impossibles ou que vous ne pouvez pas créer un autre contexte pour le périphérique pris en charge; </font><font style="vertical-align: inherit;">cela entraînera une erreur </font></font><code>ALC_INVALID_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si vous passez devant un appareil invalide, vous obtiendrez une erreur </font></font><code>ALC_INVALID_DEVICE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais, bien sûr, nous vérifions déjà cette erreur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créer un contexte ne suffit pas. </font><font style="vertical-align: inherit;">Nous devons encore l'actualiser - il ressemble à un contexte de rendu Windows OpenGL, non? </font><font style="vertical-align: inherit;">C'est le même.</font></font><br>
<br>
<pre><code class="cpp hljs">ALCboolean contextMadeCurrent = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, openALContext)<font></font>
   || contextMadeCurrent != ALC_TRUE)<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not make audio context current"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">/* probably exit or give up on having sound */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est nécessaire d'actualiser le contexte pour toute opération ultérieure avec le contexte (ou avec les sources et les écouteurs qu'il contient). </font><font style="vertical-align: inherit;">L'opération retournera </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la seule valeur d'erreur possible transmise </font></font><code>alcGetError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est celle </font></font><code>ALC_INVALID_CONTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est claire d'après le nom. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finir avec le contexte, c.-à-d. </font><font style="vertical-align: inherit;">à la sortie du programme, il faut que le contexte ne soit plus d'actualité, puis le détruire.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, <span class="hljs-literal">nullptr</span>))<font></font>
{<font></font>
    <span class="hljs-comment">/* what can you do? */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span>(!alcCall(alcDestroyContext, openALDevice, openALContext))<font></font>
{<font></font>
    <span class="hljs-comment">/* not much you can do */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La seule erreur possible de </font></font><code>alcDestroyContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est la même que celle de </font></font><code>alcMakeContextCurrent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>ALC_INVALID_CONTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">si vous faites tout correctement, alors vous ne l'obtiendrez pas, mais si vous le faites, alors rien ne peut être fait à ce sujet.</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi vérifier les erreurs avec lesquelles rien ne peut être fait? </font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parce que je veux que les messages les concernant apparaissent au moins dans le flux d'erreurs, ce qui pour nous. </font></font><code>alcCall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supposons qu'il ne nous donne jamais d'erreurs, mais il sera utile de savoir qu'une telle erreur se produit sur l'ordinateur de quelqu'un d'autre. </font><font style="vertical-align: inherit;">Grâce à cela, nous pouvons étudier le problème, et éventuellement </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signaler un bug aux développeurs OpenAL Soft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jouez notre premier son</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, assez de tout cela, jouons le son. </font><font style="vertical-align: inherit;">Pour commencer, nous avons évidemment besoin d'un fichier son. </font><font style="vertical-align: inherit;">Par exemple, celui-ci, d'un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeu que je finirai jamais</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://indiegamedev.net/wp-content/uploads/2020/02/iamtheprotectorofthissystem.wav</font></font></a></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis le protecteur de ce système!</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alors, ouvrez l'IDE et utilisez le code suivant. N'oubliez pas de brancher OpenAL Soft et d'ajouter le code de téléchargement de fichier et le code de vérification d'erreur ci-dessus.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
    ALCdevice* openALDevice = alcOpenDevice(<span class="hljs-literal">nullptr</span>);
    <span class="hljs-keyword">if</span>(!openALDevice)
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
<font></font>
    ALCcontext* openALContext;<font></font>
    <span class="hljs-keyword">if</span>(!alcCall(alcCreateContext, openALContext, openALDevice, openALDevice, <span class="hljs-literal">nullptr</span>) || !openALContext)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not create audio context"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    ALCboolean contextMadeCurrent = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span>(!alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, openALContext)<font></font>
       || contextMadeCurrent != ALC_TRUE)<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not make audio context current"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> channels;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> sampleRate;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> bitsPerSample;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">char</span>&gt; soundData;
    <span class="hljs-keyword">if</span>(!load_wav(<span class="hljs-string">"iamtheprotectorofthissystem.wav"</span>, channels, sampleRate, bitsPerSample, soundData))<font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    ALuint buffer;<font></font>
    alCall(alGenBuffers, <span class="hljs-number">1</span>, &amp;buffer);<font></font>
<font></font>
    ALenum format;<font></font>
    <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
        format = AL_FORMAT_MONO8;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
        format = AL_FORMAT_MONO16;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
        format = AL_FORMAT_STEREO8;<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
        format = AL_FORMAT_STEREO16;<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>
            &lt;&lt; <span class="hljs-string">"ERROR: unrecognised wave format: "</span>
            &lt;&lt; channels &lt;&lt; <span class="hljs-string">" channels, "</span>
            &lt;&lt; bitsPerSample &lt;&lt; <span class="hljs-string">" bps"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    alCall(alBufferData, buffer, format, soundData.data(), soundData.size(), sampleRate);<font></font>
    soundData.clear(); <span class="hljs-comment">// erase the sound in RAM</span><font></font>
<font></font>
    ALuint source;<font></font>
    alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
    alCall(alSourcef, source, AL_PITCH, <span class="hljs-number">1</span>);<font></font>
    alCall(alSourcef, source, AL_GAIN, <span class="hljs-number">1.0f</span>);<font></font>
    alCall(alSource3f, source, AL_POSITION, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
    alCall(alSource3f, source, AL_VELOCITY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
    alCall(alSourcei, source, AL_LOOPING, AL_FALSE);<font></font>
    alCall(alSourcei, source, AL_BUFFER, buffer);<font></font>
<font></font>
    alCall(alSourcePlay, source);<font></font>
<font></font>
    ALint state = AL_PLAYING;<font></font>
<font></font>
    <span class="hljs-keyword">while</span>(state == AL_PLAYING)<font></font>
    {<font></font>
        alCall(alGetSourcei, source, AL_SOURCE_STATE, &amp;state);<font></font>
    }<font></font>
<font></font>
    alCall(alDeleteSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
    alCall(alDeleteBuffers, <span class="hljs-number">1</span>, &amp;buffer);<font></font>
<font></font>
    alcCall(alcMakeContextCurrent, contextMadeCurrent, openALDevice, <span class="hljs-literal">nullptr</span>);<font></font>
    alcCall(alcDestroyContext, openALDevice, openALContext);<font></font>
<font></font>
    ALCboolean closed;<font></font>
    alcCall(alcCloseDevice, closed, openALDevice, openALDevice);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compilation! </font><font style="vertical-align: inherit;">Nous composons! </font><font style="vertical-align: inherit;">Lancement! </font></font><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis le pré-protecteur de ce système</font></font></strong></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si vous n'entendez pas le son, vérifiez à nouveau tout. </font><font style="vertical-align: inherit;">Si quelque chose est écrit dans la fenêtre de la console, cela devrait être la sortie standard du flux d'erreur, et c'est important. </font><font style="vertical-align: inherit;">Nos fonctions de rapport d'erreurs devraient nous indiquer la ligne de code source qui a généré l'erreur. </font><font style="vertical-align: inherit;">Si vous trouvez une </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
erreur, lisez le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">programmeur</font></a><font style="vertical-align: inherit;"> et la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spécification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour comprendre les conditions dans lesquelles cette erreur peut être générée par une fonction. </font><font style="vertical-align: inherit;">Cela vous aidera à le comprendre. </font><font style="vertical-align: inherit;">Si cela ne réussit pas, laissez un commentaire sous l'article d'origine et j'essaierai de vous aider.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Télécharger les données RIFF WAVE</font></font></h3><br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> channels;
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> sampleRate;
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">uint8_t</span> bitsPerSample;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">char</span>&gt; soundData;
<span class="hljs-keyword">if</span>(!load_wav(<span class="hljs-string">"iamtheprotectorofthissystem.wav"</span>, channels, sampleRate, bitsPerSample, soundData))<font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"ERROR: Could not load wav"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit du code de démarrage Wave. </font><font style="vertical-align: inherit;">L'important est que nous recevions des données, soit sous forme de pointeur, soit collectées dans un vecteur: le nombre de canaux, la fréquence d'échantillonnage et le nombre de bits par échantillon.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Génération de tampon</font></font></h3><br>
<pre><code class="cpp hljs">ALuint buffer;<font></font>
alCall(alGenBuffers, <span class="hljs-number">1</span>, &amp;buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela vous semble probablement familier si vous avez déjà généré des tampons de données de texture dans OpenGL. En substance, nous générons un tampon et faisons comme s'il n'existait que sur la carte son. En fait, il sera très probablement stocké dans la RAM ordinaire, mais la spécification OpenAL résume toutes ces opérations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la valeur </font></font><code>ALuint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handle vers</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notre tampon. N'oubliez pas que le </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tampon</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est essentiellement des données sonores dans la mémoire de la carte son. Nous n'avons plus </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accès directement</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à ces données, car nous les avons prises du programme (de la RAM ordinaire) et les avons déplacées vers une carte son / puce, etc. OpenGL fonctionne de manière similaire, en déplaçant les données de texture de la RAM vers la VRAM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descripteur</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">génère </font></font><code>alGenBuffers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il a quelques valeurs d'erreur possibles, dont la plus importante est </font></font><code>AL_OUT_OF_MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui signifie que nous ne pouvons plus ajouter de données audio à la carte son. </font><font style="vertical-align: inherit;">Vous n'obtiendrez pas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erreur si, par exemple, vous utilisez un seul tampon, mais vous devez en tenir compte si vous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">créez un moteur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Déterminer le format des données audio</font></font></h3><br>
<pre><code class="cpp hljs">ALenum format;<font></font>
<font></font>
<span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
    format = AL_FORMAT_MONO8;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">1</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
    format = AL_FORMAT_MONO16;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">8</span>)<font></font>
    format = AL_FORMAT_STEREO8;<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(channels == <span class="hljs-number">2</span> &amp;&amp; bitsPerSample == <span class="hljs-number">16</span>)<font></font>
    format = AL_FORMAT_STEREO16;<font></font>
<span class="hljs-keyword">else</span><font></font>
{<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>
        &lt;&lt; <span class="hljs-string">"ERROR: unrecognised wave format: "</span>
        &lt;&lt; channels &lt;&lt; <span class="hljs-string">" channels, "</span>
        &lt;&lt; bitsPerSample &lt;&lt; <span class="hljs-string">" bps"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les données sonores fonctionnent comme ceci: il y a plusieurs </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canaux</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et il y a une taille de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit par échantillon</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les données se composent de nombreux </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">échantillons</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour déterminer le nombre d' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">échantillons</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les données audio, nous procédons comme suit:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int_fast32_t</span> numberOfSamples = dataSize / (numberOfChannels * (bitsPerSample / <span class="hljs-number">8</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui peut être facilement converti en calcul de la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">durée des</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> données audio:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> duration = numberOfSamples / sampleRate;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais alors que nous n'avons pas besoin de savoir ni </font></font><code>numberOfSamples</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ni </font></font><code>duration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cependant, il est important de savoir comment toutes ces informations sont utilisées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revenons à </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- nous devons indiquer à OpenAL le format des données audio. Cela semble évident, non? Semblable à la façon dont nous remplissons le tampon de texture OpenGL, en disant que les données sont dans une séquence BGRA et sont composées de valeurs 8 bits, nous devons faire de même dans OpenAL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour dire à OpenAL comment interpréter les données pointées par le pointeur que nous passerons plus tard, nous devons définir le format des données. Sous le </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il est censé être compris par OpenAL. Il n'y a que quatre significations possibles. Il existe deux valeurs possibles pour le nombre de canaux: une pour mono, deux pour stéréo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du nombre de canaux, nous avons le nombre de bits par échantillon. </font><font style="vertical-align: inherit;">Il est égal à ou </font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou </font></font><code>16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et est essentiellement de qualité sonore. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, en utilisant les valeurs des canaux et des bits par échantillon, dont la fonction de charge d'onde nous a informés, nous pouvons déterminer celui à </font></font><code>ALenum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliser pour le futur paramètre </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplissage de tampon</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alBufferData, buffer, format, soundData.data(), soundData.size(), sampleRate);<font></font>
soundData.clear(); <span class="hljs-comment">// erase the sound in RAM</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cela, tout devrait être simple. </font><font style="vertical-align: inherit;">Nous chargeons dans le tampon OpenAL, vers lequel pointe le </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descripteur</font></font></em> <code>buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">les données pointées par ptr </font></font><code>soundData.data()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la taille du </font></font><code>size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spécifié </font></font><code>sampleRate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous informerons également OpenAL du format de ces données via le paramètre </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au final, nous supprimons simplement les données reçues par le chargeur de vagues. </font><font style="vertical-align: inherit;">Pourquoi? </font><font style="vertical-align: inherit;">Parce que nous les avons déjà copiés sur la carte son. </font><font style="vertical-align: inherit;">Nous n'avons pas besoin de les stocker à deux endroits et de dépenser de précieuses ressources. </font><font style="vertical-align: inherit;">Si la carte son perd des données, nous la téléchargerons simplement à nouveau à partir du disque et nous n'aurons pas besoin de la copier sur le processeur ou sur quelqu'un d'autre.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réglage de la source</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rappelons qu'OpenAL est essentiellement un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auditeur</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui écoute les sons émis par une ou plusieurs </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sources</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Eh bien, il est maintenant temps de créer une source sonore.</font></font><br>
<br>
<pre><code class="cpp hljs">ALuint source;<font></font>
alCall(alGenSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
alCall(alSourcef, source, AL_PITCH, <span class="hljs-number">1</span>);<font></font>
alCall(alSourcef, source, AL_GAIN, <span class="hljs-number">1.0f</span>);<font></font>
alCall(alSource3f, source, AL_POSITION, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
alCall(alSource3f, source, AL_VELOCITY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
alCall(alSourcei, source, AL_LOOPING, AL_FALSE);<font></font>
alCall(alSourcei, source, AL_BUFFER, buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honnêtement, il n'est pas nécessaire de définir certains de ces paramètres, car les valeurs par défaut nous conviennent parfaitement. Mais cela nous montre certains aspects avec lesquels vous pouvez expérimenter et voir ce qu'ils font (vous pouvez même agir habilement et les changer au fil du temps). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'abord, nous générons la source - rappelez-vous, ceci est encore une fois une </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poignée</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers quelque chose dans l'API OpenAL. Nous réglons la hauteur (ton) pour qu'elle ne change pas, le gain (volume) est égal à la valeur d'origine des données audio, la position et la vitesse sont réinitialisées; nous </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne bouclons pas le</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son, sinon notre programme ne se terminera jamais et indiquera le buffer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas que différentes sources peuvent utiliser le même tampon. </font><font style="vertical-align: inherit;">Par exemple, les ennemis tirant sur un joueur à différents endroits peuvent jouer le même son de tir, nous n'avons donc pas besoin de nombreuses copies des données sonores, mais seulement de quelques endroits dans l'espace 3D à partir duquel le son est produit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jouer son</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alSourcePlay, source);<font></font>
<font></font>
ALint state = AL_PLAYING;<font></font>
<font></font>
<span class="hljs-keyword">while</span>(state == AL_PLAYING)<font></font>
{<font></font>
    alCall(alGetSourcei, source, AL_SOURCE_STATE, &amp;state);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons d'abord commencer à lire la source. </font><font style="vertical-align: inherit;">Appelez simplement </font></font><code>alSourcePlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous créons une valeur pour stocker l'état actuel de la </font></font><code>AL_SOURCE_STATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source et le </font><font style="vertical-align: inherit;">mettons à </font><font style="vertical-align: inherit;">jour à l'infini. </font><font style="vertical-align: inherit;">Quand il n'est plus égal, </font></font><code>AL_PLAYING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons continuer. </font><font style="vertical-align: inherit;">Vous pouvez modifier l'état à la </font></font><code>AL_STOPPED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fin de l'émission du son à partir du tampon (ou lorsqu'une erreur se produit). </font><font style="vertical-align: inherit;">Si vous définissez la valeur de bouclage </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le son sera joué indéfiniment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous pouvons changer le tampon source et jouer un autre son. </font><font style="vertical-align: inherit;">Ou rejouez le même son, etc. </font><font style="vertical-align: inherit;">Réglez simplement le tampon, utilisez </font></font><code>alSourcePlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-le et peut-être </font></font><code>alSourceStop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, si nécessaire. </font><font style="vertical-align: inherit;">Dans les articles suivants, nous examinerons cela plus en détail.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nettoyage</font></font></h3><br>
<pre><code class="cpp hljs">alCall(alDeleteSources, <span class="hljs-number">1</span>, &amp;source);<font></font>
alCall(alDeleteBuffers, <span class="hljs-number">1</span>, &amp;buffer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous lisons simplement les données audio une fois et que nous sortons, nous supprimerons la source et le tampon précédemment créés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le reste du code est compréhensible sans explication.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Où aller ensuite?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connaissant tout ce qui est décrit dans cet article, vous pouvez déjà créer un petit jeu! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essayez de créer Pong</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un autre jeu classique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pour eux plus n'est pas nécessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais rappelles-toi! </font><font style="vertical-align: inherit;">Ces tampons ne conviennent qu'aux sons courts, très probablement pendant quelques secondes. </font><font style="vertical-align: inherit;">Si vous avez besoin de musique ou de voix, vous devrez diffuser du son sur OpenAL. </font><font style="vertical-align: inherit;">Nous en parlerons dans l'une des parties suivantes d'une série de tutoriels.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488730/index.html">Nouvelles normes russes pour l'Internet des objets, la fabrication intelligente et la ville intelligente</a></li>
<li><a href="../fr488732/index.html">M. Simon, talentueux: comment des capacités uniques et l'impression 3D peuvent changer le processus de production</a></li>
<li><a href="../fr488736/index.html">Le travail à distance gagne du terrain</a></li>
<li><a href="../fr488740/index.html">Guide des balises HTML personnalisées pour Google Tag Manager par Simo Ahava</a></li>
<li><a href="../fr488742/index.html">Voir l'architecture? Et je ne vois pas, mais elle est</a></li>
<li><a href="../fr488748/index.html">Créez une application Todo à l'aide de Django. Partie 1</a></li>
<li><a href="../fr488750/index.html">Promenade des dinosaures: deux grands ordinateurs du XXe siècle</a></li>
<li><a href="../fr488752/index.html">Golang + Phaser3 = MMORPG - Nous jetons les bases de la génération sans fin du monde</a></li>
<li><a href="../fr488754/index.html">Tout à la fois: vérification automatique de la taille du lot</a></li>
<li><a href="../fr488756/index.html">Comment travailler avec l'API Google Sheets (Google Sheets API v4) dans R en utilisant le nouveau package googlesheets4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>