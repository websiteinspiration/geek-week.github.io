<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òùÔ∏è üë∑ ü§≤üèø Meilleures pratiques Kubernetes. Test de viabilit√© de Kubernetes avec tests de pr√©paration et de vivacit√© üõ†Ô∏è ‚≠êÔ∏è ‚úíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meilleures pratiques Kubernetes. Cr√©ation de petits conteneurs 
 Kubernetes Best Practices. Organisation Kubernetes avec un espace de noms
 
 
 
 Les ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Meilleures pratiques Kubernetes. Test de viabilit√© de Kubernetes avec tests de pr√©paration et de vivacit√©</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/502430/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meilleures pratiques Kubernetes. Cr√©ation de petits conteneurs </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes Best Practices. Organisation Kubernetes avec un espace de noms</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/2l/kw/qe/2lkwqe-zu3jhaxqfmla1cj65koq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les syst√®mes distribu√©s peuvent √™tre difficiles √† g√©rer car ils comportent de nombreux √©l√©ments mobiles modifiables et tous doivent fonctionner correctement pour garantir la fonctionnalit√© du syst√®me. Si l'un des √©l√©ments tombe en panne, le syst√®me doit le d√©tecter, le contourner et le r√©parer, et tout cela doit √™tre fait automatiquement. Dans cette s√©rie de bonnes pratiques Kubernetes, nous apprendrons comment configurer les tests de disponibilit√© et de r√©activit√© pour tester la viabilit√© d'un cluster Kubernetes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Health Check Health Check est un moyen simple de faire savoir au syst√®me si votre instance d'application est en cours d'ex√©cution ou non. Si une instance de votre application ne fonctionne pas, les autres services ne doivent pas y acc√©der ni lui envoyer de demandes. Au lieu de cela, la demande doit √™tre envoy√©e √† une autre instance de l'application qui est d√©j√† en cours d'ex√©cution ou qui d√©marrera plus tard. En outre, le syst√®me doit r√©tablir la fonctionnalit√© perdue de votre application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par d√©faut, Kubernetes commencera √† envoyer du trafic vers le pod lorsque tous les conteneurs √† l'int√©rieur des foyers sont en cours d'ex√©cution et rechargera les conteneurs lorsqu'ils tomberont en panne. Pour commencer, ce comportement par d√©faut du syst√®me peut √™tre assez bon, mais vous pouvez augmenter la fiabilit√© de votre d√©ploiement de produit √† l'aide de contr√¥les d'int√©grit√© personnalis√©s.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/ug/fr/_w/ugfr_wdknpt2o0folyontpio334.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, Kubernetes vous permet de le faire tout simplement, il n'y a donc aucune excuse pour ignorer de tels contr√¥les. Kubernetes propose deux types de tests de bilan de sant√©, et il est important de comprendre les diff√©rences dans chaque application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le test de disponibilit√© op√©rationnelle est con√ßu pour indiquer √† Kubernetes que votre application est pr√™te √† traiter le trafic. Avant d'autoriser le service √† envoyer du trafic vers le module, Kubernetes doit v√©rifier que le contr√¥le de disponibilit√© a r√©ussi. Si le test de pr√©paration √©choue, Kubernetes cessera d'envoyer du trafic vers le pod jusqu'√† ce que le test r√©ussisse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le test de viabilit√© de Liveness indique √† Kubernetes si votre application est vivante ou morte. Dans le premier cas, Kubernetes le laissera tranquille, dans le second, il retirera la cosse morte et la remplacera par une nouvelle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginons un sc√©nario dans lequel votre application a besoin d'une minute pour se ¬´r√©chauffer¬ª et s'ex√©cuter. Votre service ne commencera √† fonctionner que lorsque l'application sera compl√®tement charg√©e et d√©marr√©e, bien que le workflow ait d√©j√† commenc√©. Et vous aurez √©galement des probl√®mes si vous souhaitez augmenter l'√©chelle de ce d√©ploiement √† plusieurs copies, car ces copies ne doivent pas recevoir de trafic tant qu'elles ne sont pas compl√®tement pr√™tes. Cependant, par d√©faut, Kubernetes commencera √† envoyer du trafic imm√©diatement apr√®s le d√©but des processus √† l'int√©rieur du conteneur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'utilisation du test de disponibilit√© op√©rationnelle, Kubernetes attendra que l'application soit compl√®tement lanc√©e et ce n'est qu'apr√®s cela que le service pourra envoyer du trafic vers une nouvelle copie.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/ol/wj/3golwjtf8e-peabrur40nlxmy08.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginons un autre sc√©nario dans lequel une application se bloque pendant longtemps, arr√™tant les demandes de service. √âtant donn√© que le processus continue de s'ex√©cuter, Kubernetes consid√©rera par d√©faut que tout est en ordre et continuera d'envoyer des demandes au pod non fonctionnel. Mais lors de l'utilisation de Liveness, Kubernetes d√©tectera que l'application ne sert plus les demandes et red√©marrera par d√©faut un module non fonctionnel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-b/9z/-b/-b9z-bhznyyzrlsz9eh51nrkmmy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consid√©rez comment tester l'√©tat de pr√©paration et la vitalit√©. Il existe trois m√©thodes de test - HTTP, ommand et TCP. Vous pouvez utiliser n'importe lequel d'entre eux pour la v√©rification. La m√©thode de test utilisateur la plus courante est une sonde HTTP.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√™me si votre application n'est pas un serveur HTTP, vous pouvez toujours cr√©er un serveur HTTP l√©ger dans votre application pour interagir avec le test Liveness. Apr√®s cela, Kubernetes commencera √† envoyer un ping au pod, et si la r√©ponse HTTP est dans la plage de 200 ou 300 ms, cela signifiera que le pod est "sain". Sinon, le module sera marqu√© comme ¬´malsain¬ª. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vo/uy/pq/vouypq-yjyxuldceusrnb7njndw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les tests utilisant Command, Kubernetes ex√©cute la commande √† l'int√©rieur de votre conteneur. Si la commande retourne avec un code de sortie nul, le conteneur sera marqu√© comme sain, sinon, lorsque le num√©ro d'√©tat de sortie est compris entre 1 et 255, le conteneur sera marqu√© comme ¬´malade¬ª. Cette m√©thode de test est utile si vous ne pouvez pas ou ne voulez pas d√©marrer le serveur HTTP, mais vous pouvez ex√©cuter une commande qui v√©rifiera la sant√© de votre application.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/68/e6/ki/68e6kiogqoollyhciz0zdvdrp0s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dernier m√©canisme de v√©rification est le test TCP. Kubernetes essaiera d'√©tablir une connexion TCP sur le port sp√©cifi√©. Si cela peut √™tre fait, le conteneur est consid√©r√© comme sain, sinon, il n'est pas viable. Cette m√©thode peut √™tre utile si vous utilisez un script dans lequel les tests avec une requ√™te HTTP ou l'ex√©cution d'une commande ne fonctionnent pas tr√®s bien. Par exemple, les principaux services de v√©rification avec TCP seront gRPC ou FTP.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/or/mt/wpormt0xbafznizmg8ybwgfiay8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tests peuvent √™tre configur√©s de plusieurs mani√®res avec diff√©rents param√®tres. Vous pouvez sp√©cifier la fr√©quence √† laquelle ils doivent √™tre ex√©cut√©s, quels sont les seuils de r√©ussite et d'√©chec, et combien de temps attendre les r√©ponses. Consultez la documentation du test de disponibilit√© et de vivacit√© pour plus d'informations. Cependant, il y a un point tr√®s important dans la configuration du test Liveness - le r√©glage initial du d√©lai de test initialDelaySeconds. Comme je l'ai mentionn√©, l'√©chec de ce test red√©marrera le module. Par cons√©quent, vous devez vous assurer que le test ne d√©marre pas tant que l'application n'est pas pr√™te √† √™tre utilis√©e, sinon elle commencera √† se d√©placer. Je recommande d'utiliser le temps de d√©marrage P99 ou le temps de d√©marrage moyen de l'application √† partir du tampon. N'oubliez pas de r√©gler cette valeur commeque l'heure de lancement de votre application devient plus rapide ou plus lente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des experts confirmeront que le bilan de sant√© est un contr√¥le obligatoire pour tout syst√®me distribu√©, et Kubernetes ne fait pas exception. </font><font style="vertical-align: inherit;">L'utilisation du contr√¥le de ¬´sant√©¬ª des services garantit la fiabilit√© et la disponibilit√© de Kubernetes et ne fait aucun travail pour les utilisateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A suivre tr√®s prochainement ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mxEvAPQRwhw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicit√© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des mat√©riaux plus int√©ressants? Soutenez-nous en passant une commande ou en recommandant √† vos amis, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS pour les d√©veloppeurs √† partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entr√©e de gamme que nous avons invent√© pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la v√©rit√© sur VPS (KVM) E5-2697 v3 (6 c≈ìurs) 10 Go DDR4 480 Go SSD 1 Gbit / s √† partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donn√©es Equinix Tier IV √† Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV √† partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - √† partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©ation d'un b√¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502418/index.html">Moniteur d'images 3D</a></li>
<li><a href="../fr502420/index.html">D√©couvertes CSS int√©ressantes dans la conception de Twitter</a></li>
<li><a href="../fr502422/index.html">R√©duction de 60% de la taille de l'application React Native en quelques √©tapes simples</a></li>
<li><a href="../fr502424/index.html">Arr√™tez d'importer des packages JavaScript entiers</a></li>
<li><a href="../fr502428/index.html">Syntactic Goodies Julia</a></li>
<li><a href="../fr502432/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 415 (11-17 mai 2020)</a></li>
<li><a href="../fr502436/index.html">CI TeamCity - Automatisation des processus de construction de tests Android et UI</a></li>
<li><a href="../fr502438/index.html">Mat√©riel Python. Cartes personnalis√©es avec effets OpenGL</a></li>
<li><a href="../fr502440/index.html">Cr√©ation d'applications avec Mediapipe</a></li>
<li><a href="../fr502442/index.html">PHP Digest n ¬∞ 180 (4-18 mai 2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>