<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☝️ 👷 🤲🏿 Meilleures pratiques Kubernetes. Test de viabilité de Kubernetes avec tests de préparation et de vivacité 🛠️ ⭐️ ✒️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meilleures pratiques Kubernetes. Création de petits conteneurs 
 Kubernetes Best Practices. Organisation Kubernetes avec un espace de noms
 
 
 
 Les ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Meilleures pratiques Kubernetes. Test de viabilité de Kubernetes avec tests de préparation et de vivacité</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/502430/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meilleures pratiques Kubernetes. Création de petits conteneurs </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes Best Practices. Organisation Kubernetes avec un espace de noms</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/2l/kw/qe/2lkwqe-zu3jhaxqfmla1cj65koq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les systèmes distribués peuvent être difficiles à gérer car ils comportent de nombreux éléments mobiles modifiables et tous doivent fonctionner correctement pour garantir la fonctionnalité du système. Si l'un des éléments tombe en panne, le système doit le détecter, le contourner et le réparer, et tout cela doit être fait automatiquement. Dans cette série de bonnes pratiques Kubernetes, nous apprendrons comment configurer les tests de disponibilité et de réactivité pour tester la viabilité d'un cluster Kubernetes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Health Check Health Check est un moyen simple de faire savoir au système si votre instance d'application est en cours d'exécution ou non. Si une instance de votre application ne fonctionne pas, les autres services ne doivent pas y accéder ni lui envoyer de demandes. Au lieu de cela, la demande doit être envoyée à une autre instance de l'application qui est déjà en cours d'exécution ou qui démarrera plus tard. En outre, le système doit rétablir la fonctionnalité perdue de votre application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par défaut, Kubernetes commencera à envoyer du trafic vers le pod lorsque tous les conteneurs à l'intérieur des foyers sont en cours d'exécution et rechargera les conteneurs lorsqu'ils tomberont en panne. Pour commencer, ce comportement par défaut du système peut être assez bon, mais vous pouvez augmenter la fiabilité de votre déploiement de produit à l'aide de contrôles d'intégrité personnalisés.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/ug/fr/_w/ugfr_wdknpt2o0folyontpio334.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, Kubernetes vous permet de le faire tout simplement, il n'y a donc aucune excuse pour ignorer de tels contrôles. Kubernetes propose deux types de tests de bilan de santé, et il est important de comprendre les différences dans chaque application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le test de disponibilité opérationnelle est conçu pour indiquer à Kubernetes que votre application est prête à traiter le trafic. Avant d'autoriser le service à envoyer du trafic vers le module, Kubernetes doit vérifier que le contrôle de disponibilité a réussi. Si le test de préparation échoue, Kubernetes cessera d'envoyer du trafic vers le pod jusqu'à ce que le test réussisse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le test de viabilité de Liveness indique à Kubernetes si votre application est vivante ou morte. Dans le premier cas, Kubernetes le laissera tranquille, dans le second, il retirera la cosse morte et la remplacera par une nouvelle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginons un scénario dans lequel votre application a besoin d'une minute pour se «réchauffer» et s'exécuter. Votre service ne commencera à fonctionner que lorsque l'application sera complètement chargée et démarrée, bien que le workflow ait déjà commencé. Et vous aurez également des problèmes si vous souhaitez augmenter l'échelle de ce déploiement à plusieurs copies, car ces copies ne doivent pas recevoir de trafic tant qu'elles ne sont pas complètement prêtes. Cependant, par défaut, Kubernetes commencera à envoyer du trafic immédiatement après le début des processus à l'intérieur du conteneur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'utilisation du test de disponibilité opérationnelle, Kubernetes attendra que l'application soit complètement lancée et ce n'est qu'après cela que le service pourra envoyer du trafic vers une nouvelle copie.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/ol/wj/3golwjtf8e-peabrur40nlxmy08.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginons un autre scénario dans lequel une application se bloque pendant longtemps, arrêtant les demandes de service. Étant donné que le processus continue de s'exécuter, Kubernetes considérera par défaut que tout est en ordre et continuera d'envoyer des demandes au pod non fonctionnel. Mais lors de l'utilisation de Liveness, Kubernetes détectera que l'application ne sert plus les demandes et redémarrera par défaut un module non fonctionnel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-b/9z/-b/-b9z-bhznyyzrlsz9eh51nrkmmy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez comment tester l'état de préparation et la vitalité. Il existe trois méthodes de test - HTTP, ommand et TCP. Vous pouvez utiliser n'importe lequel d'entre eux pour la vérification. La méthode de test utilisateur la plus courante est une sonde HTTP.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même si votre application n'est pas un serveur HTTP, vous pouvez toujours créer un serveur HTTP léger dans votre application pour interagir avec le test Liveness. Après cela, Kubernetes commencera à envoyer un ping au pod, et si la réponse HTTP est dans la plage de 200 ou 300 ms, cela signifiera que le pod est "sain". Sinon, le module sera marqué comme «malsain». </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vo/uy/pq/vouypq-yjyxuldceusrnb7njndw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les tests utilisant Command, Kubernetes exécute la commande à l'intérieur de votre conteneur. Si la commande retourne avec un code de sortie nul, le conteneur sera marqué comme sain, sinon, lorsque le numéro d'état de sortie est compris entre 1 et 255, le conteneur sera marqué comme «malade». Cette méthode de test est utile si vous ne pouvez pas ou ne voulez pas démarrer le serveur HTTP, mais vous pouvez exécuter une commande qui vérifiera la santé de votre application.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/68/e6/ki/68e6kiogqoollyhciz0zdvdrp0s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dernier mécanisme de vérification est le test TCP. Kubernetes essaiera d'établir une connexion TCP sur le port spécifié. Si cela peut être fait, le conteneur est considéré comme sain, sinon, il n'est pas viable. Cette méthode peut être utile si vous utilisez un script dans lequel les tests avec une requête HTTP ou l'exécution d'une commande ne fonctionnent pas très bien. Par exemple, les principaux services de vérification avec TCP seront gRPC ou FTP.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/or/mt/wpormt0xbafznizmg8ybwgfiay8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tests peuvent être configurés de plusieurs manières avec différents paramètres. Vous pouvez spécifier la fréquence à laquelle ils doivent être exécutés, quels sont les seuils de réussite et d'échec, et combien de temps attendre les réponses. Consultez la documentation du test de disponibilité et de vivacité pour plus d'informations. Cependant, il y a un point très important dans la configuration du test Liveness - le réglage initial du délai de test initialDelaySeconds. Comme je l'ai mentionné, l'échec de ce test redémarrera le module. Par conséquent, vous devez vous assurer que le test ne démarre pas tant que l'application n'est pas prête à être utilisée, sinon elle commencera à se déplacer. Je recommande d'utiliser le temps de démarrage P99 ou le temps de démarrage moyen de l'application à partir du tampon. N'oubliez pas de régler cette valeur commeque l'heure de lancement de votre application devient plus rapide ou plus lente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart des experts confirmeront que le bilan de santé est un contrôle obligatoire pour tout système distribué, et Kubernetes ne fait pas exception. </font><font style="vertical-align: inherit;">L'utilisation du contrôle de «santé» des services garantit la fiabilité et la disponibilité de Kubernetes et ne fait aucun travail pour les utilisateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A suivre très prochainement ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mxEvAPQRwhw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicité :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des matériaux plus intéressants? Soutenez-nous en passant une commande ou en recommandant à vos amis, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS pour les développeurs à partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entrée de gamme que nous avons inventé pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la vérité sur VPS (KVM) E5-2697 v3 (6 cœurs) 10 Go DDR4 480 Go SSD 1 Gbit / s à partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'à 24 cœurs et jusqu'à 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de données Equinix Tier IV à Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV à partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - à partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> création d'un bâtiment d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 coûtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502418/index.html">Moniteur d'images 3D</a></li>
<li><a href="../fr502420/index.html">Découvertes CSS intéressantes dans la conception de Twitter</a></li>
<li><a href="../fr502422/index.html">Réduction de 60% de la taille de l'application React Native en quelques étapes simples</a></li>
<li><a href="../fr502424/index.html">Arrêtez d'importer des packages JavaScript entiers</a></li>
<li><a href="../fr502428/index.html">Syntactic Goodies Julia</a></li>
<li><a href="../fr502432/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 415 (11-17 mai 2020)</a></li>
<li><a href="../fr502436/index.html">CI TeamCity - Automatisation des processus de construction de tests Android et UI</a></li>
<li><a href="../fr502438/index.html">Matériel Python. Cartes personnalisées avec effets OpenGL</a></li>
<li><a href="../fr502440/index.html">Création d'applications avec Mediapipe</a></li>
<li><a href="../fr502442/index.html">PHP Digest n ° 180 (4-18 mai 2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>