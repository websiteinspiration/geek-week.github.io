<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏽 ☝🏼 🛰️ Concurrence et efficacité: Python vs FSM 🤹🏼 💥 🕞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="J'avoue, mais je ne connais pas Python. Tout simplement parce que je ne l'utilise pas. Néanmoins, en reprenant son développement, ainsi qu'en essayant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Concurrence et efficacité: Python vs FSM</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506604/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'avoue, mais je ne connais pas Python. Tout simplement parce que je ne l'utilise pas. Néanmoins, en reprenant son développement, ainsi qu'en essayant de déchiffrer l'abréviation mystérieuse GIL, je suis allé à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> décrivant les «phénomènes magiques inexplicables» d'une version parallèle d'une fonction dépendante du CPU en Python. Il y avait un désir de revérifier ce test et de le comparer avec l'implémentation équivalente sous la forme d'un modèle de machine à états (machine à états finis ou FSM pour faire court) dans l'environnement de programmation de composants visuels (automatique) - VKP (a). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De </font><b><font style="vertical-align: inherit;">toute</font></b><font style="vertical-align: inherit;"> évidence,</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le programme dépend dans une certaine mesure du processeur. D'un autre côté, si ce n'est pas seulement l'assembleur, alors en testant dans l'un ou l'autre langage de haut niveau, nous étudierons plus probablement la couche logicielle cachée par celui-ci. Par conséquent, en considérant Python, il serait plus correct de parler de la dépendance CPU de son interprète. On peut même affirmer qu'un programme Python aura une vitesse en fonction de la version de l'interpréteur, et aura pour lui un «mysticisme» caractéristique.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le même temps, il existe des situations où il peut n'y avoir presque aucune dépendance à l'égard du processeur (nous le verrons). </font><font style="vertical-align: inherit;">Nous parlons de langages dont le modèle de calcul est différent de l'architecture de processeur typique. </font><font style="vertical-align: inherit;">Le modèle de calcul de Python lui correspond, et le modèle d'automate de calculs, qui sera discuté plus loin, a une architecture différente et cela déterminera les spécificités de ses tests. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle sera la vitesse et si le mystique aura lieu sera révélé lors du test du «code automate»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code Python emprunté à l'article, dans les versions série et parallèle, est affiché dans les listes 1 et 2. Dans notre cas, il est complété par des lignes fixant le temps de travail, et le test séquentiel est enfermé dans un «wrapper» qui vous permet de définir le nombre de répétitions (une conséquence de ma connaissance de décorateurs en Python). </font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 1. Test CPU séquentiel en Python</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">import</span> time

def <span class="hljs-title">count</span><span class="hljs-params">(n)</span>:
  st_time </span>= time.time()
  <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<font></font>
    n -= <span class="hljs-number">1</span><font></font>
  t = time.time() - st_time<font></font>
  print(<span class="hljs-string">"speed CPU------%s---"</span> % t)
  <span class="hljs-keyword">return</span> t<font></font>
<font></font>
def TestTime(fn, n):<font></font>
  def wrapper(*args):<font></font>
    tsum=<span class="hljs-number">0</span><font></font>
    st = time.time()<font></font>
    i=<span class="hljs-number">1</span>
    <span class="hljs-keyword">while</span> (i&lt;=n):<font></font>
      t = fn(*args)<font></font>
      tsum +=t<font></font>
      i +=<span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> tsum
  <span class="hljs-keyword">return</span> wrapper<font></font>
<font></font>
test1 = TestTime(count, <span class="hljs-number">2</span>)<font></font>
tt = test1(<span class="hljs-number">100000000</span>)<font></font>
print(<span class="hljs-string">"Total ---%s seconds ---"</span> % tt)
</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 2. Test CPU parallèle</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword">import</span> time
from threading <span class="hljs-keyword">import</span> Thread
def <span class="hljs-title">count</span><span class="hljs-params">(n)</span>:
  start_time </span>= time.time()
  <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<font></font>
    n -= <span class="hljs-number">1</span>
  print(<span class="hljs-string">"speed CPU-%s seconds ---"</span> % (time.time() - start_time))<font></font>
<font></font>
k = <span class="hljs-number">2</span>
<span class="hljs-keyword">while</span> k &gt; <span class="hljs-number">0</span>:<font></font>
  print(<span class="hljs-string">"k=%d "</span> % k)<font></font>
  t1 = Thread(target=count,args=(<span class="hljs-number">100000000</span>,)); t1.start()<font></font>
  t2 = Thread(target=count,args=(<span class="hljs-number">100000000</span>,)); t2.start()<font></font>
  t1.join();<font></font>
  t2.join();<font></font>
  k -= <span class="hljs-number">1</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les figures 1 et 2 montrent les résultats de test obtenus pour deux cycles de test consécutifs (Python 3.8.3 64 bits) pour le processeur Intel® Core (TM) i5-2400S à 2,5 GHz, 6,0 Go de RAM. </font><font style="vertical-align: inherit;">Les résultats sont les suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test séquentiel - 14,221 s</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test parallèle - 13,995 s</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'article sur GIL (ci-après dénommé l'article d'origine), il s'agissait respectivement de 24,6 secondes et 45,5 secondes. </font><font style="vertical-align: inherit;">Le moment du test parallèle est à noter. </font><font style="vertical-align: inherit;">Comparé aux résultats de l'article d'origine, cela démontre que les choses ont progressé, ne serait-ce que du point de vue de la mise en œuvre du parallélisme par l'interprète (bien que ce ne soit qu'une hypothèse). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/mk/w6/uomkw6xfskl2xmcvhqzzuqo1yrk.jpeg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 1. </font><font style="vertical-align: inherit;">Runtime de test séquentiel Python </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/w6/il/dw/w6ildwbdjwthschinfwkvvh66vc.jpeg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig.2. </font><font style="vertical-align: inherit;">Runtime de test parallèle Python</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que la version parallèle est presque deux fois plus lente que la version séquentielle similaire. De plus, si nous créons trois flux, le résultat ralentira proportionnellement (voir Fig. 3). De cela, nous pouvons conclure qu'une augmentation du nombre de threads conduit à une augmentation multiple du temps de fonctionnement. Si vous ne vous mettez pas sous le capot, alors au niveau actuel de compréhension de Python, cela peut ressembler à du mysticisme. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/lw/rm/r7lwrmuef38balputxp2u0vuguc.jpeg" alt="image"> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig.3. Test CPU sur trois threads en Python</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Avant de procéder à la création de code automate et de tester dans l'environnement VKP (a), nous considérons l'implémentation d'automates en dehors de celui-ci. Un modèle sous la forme d'un graphique d'un automate équivalent à l'algorithme de l'article d'origine est montré sur la Fig. 4. Parmi la variété d'options possibles (voir, par exemple, l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) considèrent les plus typiques et les plus connues - sous le format de la technologie dite SWITCH (pour plus de détails, voir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site Web de l'ITMO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous comparerons le programme Python avec l'implémentation C ++. </font><font style="vertical-align: inherit;">Le code C ++ correspondant au graphe avec son code de lancement (voir la fonction principale) est montré dans le listing 3. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8l/io/zk/8liozkw_9cogioozutoi3xsadoq.jpeg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 4. </font><font style="vertical-align: inherit;">Modèle automatisé de fonction dépendante du CPU</font></font></i><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 3. Implémentation d'un test C ++</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FsmCount</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
    FsmCount(<span class="hljs-keyword">int</span> n) { nCount = n; nState = <span class="hljs-number">0</span>; };
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ExecOneStep</span><span class="hljs-params">()</span></span>;
    <span class="hljs-keyword">int</span> nState;
<span class="hljs-keyword">protected</span>:
    <span class="hljs-keyword">int</span> nCount;
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">x1</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y1</span><span class="hljs-params">()</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"FsmCount.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FsmCount::x1</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> nCount &gt; <span class="hljs-number">0</span>; }
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FsmCount::y1</span><span class="hljs-params">()</span> </span>{ nCount--; }
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FsmCount::ExecOneStep</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">switch</span> (nState) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
        <span class="hljs-keyword">if</span> (x1())<font></font>
            y1();<font></font>
        <span class="hljs-keyword">else</span> nState = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QCoreApplication&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QTime&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"FsmCount.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-function">QCoreApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv)</span></span>;<font></font>
<font></font>
    QTime time;<font></font>
    FsmCount *pFsmCount{<span class="hljs-literal">nullptr</span>};<font></font>
<font></font>
    pFsmCount = <span class="hljs-keyword">new</span> FsmCount(<span class="hljs-number">100000000</span>);<font></font>
    time.start();<font></font>
    <span class="hljs-keyword">while</span> (!pFsmCount-&gt;nState)<font></font>
        pFsmCount-&gt;ExecOneStep();<font></font>
    <span class="hljs-keyword">double</span> dTime = QString::number(time.elapsed()).toDouble();
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%f"</span>, dTime);
    <span class="hljs-keyword">if</span> (pFsmCount) <span class="hljs-keyword">delete</span> pFsmCount;<font></font>
<font></font>
    <span class="hljs-keyword">return</span> a.exec();<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le temps d'exécution du test sur la base matérielle mentionnée est de 250 ms. </font><font style="vertical-align: inherit;">C'est 55 fois plus rapide que le code Python. </font><font style="vertical-align: inherit;">Une comparaison a été faite avec un cas de test parallèle pour deux fils (voir Fig. 2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais la vitesse peut être encore augmentée si la fonction est calculée sans aller au-delà de l'action / méthode y1 (voir Listing 4). </font><font style="vertical-align: inherit;">En conséquence, la vitesse de test a diminué à moins de 1 ms (c'est difficile à dire plus précisément, car le test donne une valeur égale à zéro). </font><font style="vertical-align: inherit;">Si même cette valeur est prise comme base, alors la vitesse est plus de 14000 (!) Fois plus élevée qu'en Python. </font><font style="vertical-align: inherit;">Il devient clair pourquoi C ++ est préféré lors de la conception des mêmes systèmes en temps réel.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4. Variante de méthode rapide pour la classe FsmCount</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FsmCount::y1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">while</span> (nCount&gt;<span class="hljs-number">0</span>)<font></font>
        nCount--;<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre prochain objectif est de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comparer Python avec l'environnement CPSU (a)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le test automatique, comme ci-dessus, doit correspondre au modèle de la Fig. </font><font style="vertical-align: inherit;">4. Son code affiche le Listing 5.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 5. Programme de test CPU automatisé</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"lfsaappl.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QTime&gt;</span></span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FCount</span> :</span>
    <span class="hljs-keyword">public</span> LFsaAppl<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">LFsaAppl* <span class="hljs-title">Create</span><span class="hljs-params">(CVarFSA *pCVF)</span> </span>{ Q_UNUSED(pCVF)<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FCount(nameFsa); }
    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">FCreationOfLinksForVariables</span><span class="hljs-params">()</span></span>;<font></font>
    FCount(<span class="hljs-built_in">string</span> strNam);<font></font>
    CVar *pVarCount;<font></font>
    CVar *pVarExtVarCount{<span class="hljs-literal">nullptr</span>};<font></font>
    CVar *pVarStrNameExtVarCount;<font></font>
    CVar *pVarWorkingHours;<font></font>
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">x1</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">x12</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y1</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y2</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y3</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y12</span><span class="hljs-params">()</span></span>;<font></font>
    QTime time;<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stdafx.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"FCount.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">static</span> LArc TBL_Count[] = {<font></font>
    LArc(<span class="hljs-string">"st"</span>,	<span class="hljs-string">"st"</span>,<span class="hljs-string">"^x12"</span>,<span class="hljs-string">"y12"</span>),<font></font>
    LArc(<span class="hljs-string">"st"</span>,	<span class="hljs-string">"s1"</span>,<span class="hljs-string">"x12"</span>, <span class="hljs-string">"y2"</span>),<font></font>
    LArc(<span class="hljs-string">"s1"</span>,	<span class="hljs-string">"s1"</span>,<span class="hljs-string">"x1"</span>,  <span class="hljs-string">"y1"</span>),<font></font>
    LArc(<span class="hljs-string">"s1"</span>,	<span class="hljs-string">"st"</span>,<span class="hljs-string">"^x1"</span>, <span class="hljs-string">"y3"</span>),<font></font>
    LArc()<font></font>
};<font></font>
<font></font>
FCount::FCount(<span class="hljs-built_in">string</span> strNam):<font></font>
    LFsaAppl(TBL_Count, strNam)<font></font>
{ }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">FCount::FCreationOfLinksForVariables</span><span class="hljs-params">()</span> </span>{<font></font>
    pVarCount = CreateLocVar(<span class="hljs-string">"n"</span>, CLocVar::vtInteger, <span class="hljs-string">"local counter"</span>);<font></font>
    pVarStrNameExtVarCount = CreateLocVar(<span class="hljs-string">"strNameExtVarCount"</span>, CLocVar::vtString, <span class="hljs-string">"external counter name"</span>);;
    <span class="hljs-built_in">string</span> str = pVarStrNameExtVarCount-&gt;strGetDataSrc();
    <span class="hljs-keyword">if</span> (str != <span class="hljs-string">""</span>) { pVarExtVarCount = pTAppCore-&gt;GetAddressVar(pVarStrNameExtVarCount-&gt;strGetDataSrc().c_str(), <span class="hljs-keyword">this</span>); }<font></font>
    pVarWorkingHours  = CreateLocVar(<span class="hljs-string">"strWorkingHours"</span>, CLocVar::vtString, <span class="hljs-string">"working hours"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FCount::x1</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> pVarCount-&gt;GetDataSrc() &gt; <span class="hljs-number">0</span>; }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FCount::x12</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> pVarExtVarCount != <span class="hljs-literal">nullptr</span>; }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FCount::y1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">int</span> n = <span class="hljs-keyword">int</span>(pVarCount-&gt;GetDataSrc());<font></font>
    pVarCount-&gt;SetDataSrc(<span class="hljs-keyword">this</span>, --n);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FCount::y2</span><span class="hljs-params">()</span> </span>{<font></font>
    time.start();<font></font>
    pVarCount-&gt;SetDataSrc(<span class="hljs-keyword">this</span>, pVarExtVarCount-&gt;GetDataSrc());<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FCount::y3</span><span class="hljs-params">()</span> </span>{<font></font>
    pVarWorkingHours-&gt;SetDataSrc(<span class="hljs-literal">nullptr</span>, QString::number(time.elapsed()).toStdString(), <span class="hljs-literal">nullptr</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FCount::y12</span><span class="hljs-params">()</span> </span>{ FInit(); }
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le temps d'exécution du test est de l'ordre de 5,35 s avec un nombre de cycles de 100 000. écrit en </font><font style="vertical-align: inherit;">C ++ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapide</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il s'exécute plus de 2600 fois (!?) plus lentement que le test parallèle en Python. Un tel résultat ne peut que bouleverser :( Mais nous notons que la durée de l'horloge discrète est de 0,0535 ms. Par exemple, le cycle PLC standard du type OVEN-100 est de 1 ms, et donc, du point de vue des systèmes de contrôle en temps réel, le résultat est assez décent. temps, à première vue, le résultat n'est pas en faveur de l'AP, car le code est volumineux, et la vitesse provoque une certaine alarme (par exemple, pour des tâches purement informatiques).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de C ++ comme langage de conception du VKP (a) facilite la résolution du problème de vitesse qui s'est posé. Le listing 6 montre le code d'un automate utilisant des threads système standard basés sur la classe QThread de la bibliothèque Qt. En conséquence, le temps est tombé à 70-80 ms même lorsque les cycles ont augmenté à 100000000. Ainsi, le test utilisant le flux est déjà 200 fois plus rapide qu'en Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que le résultat obtenu est une version plus lente du test, synchronisée avec l'environnement du CPSU (a). Si vous commentez une ligne (Listing 6):</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span> (bIfExecuteStep) { bIfExecuteStep = <span class="hljs-literal">false</span>; }, </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
alors le temps «s'effondrera» à 1 ms ou moins. </font><font style="vertical-align: inherit;">En conséquence, la vitesse par rapport à Python sera déjà plus de 14 000 fois plus élevée. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque 1.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'indicateur bIfExecuteStep est géré par l'environnement VKP (a). </font><font style="vertical-align: inherit;">Il est fixé par lui au début de la mesure discrète actuelle. </font><font style="vertical-align: inherit;">Introduit pour la synchronisation avec le temps discret de l'espace automate du processus. </font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'augmenter la vitesse, nous avons créé une combinaison d'un automate et d'un flux, où ce dernier implémente la fonctionnalité souhaitée, et l'automate l'enveloppe. </font><font style="vertical-align: inherit;">Il s'est avéré être un objet assez spécifique, mais nous avons également résolu le problème de l'augmentation de la vitesse de travail, que nous avons décidé en conséquence.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 6. Test CPU basé sur les threads</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"lfsaappl.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QThread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QTime&gt;</span></span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QCount</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThCount</span> :</span> <span class="hljs-keyword">public</span> QThread<font></font>
{<font></font>
    Q_OBJECT<font></font>
<span class="hljs-keyword">public</span>:<font></font>
    ThCount(QCount *p, QObject *parent);<font></font>
<span class="hljs-keyword">protected</span>:
    <span class="hljs-keyword">bool</span> bIfRun{<span class="hljs-literal">false</span>};
    <span class="hljs-keyword">bool</span> bIfStop{<span class="hljs-literal">false</span>};
    <span class="hljs-keyword">bool</span> bIfExecuteStep{<span class="hljs-literal">false</span>};<font></font>
    QCount *pQCount;<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>;
<span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QCount</span>;</span><font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QCount</span> :</span>
    <span class="hljs-keyword">public</span> LFsaAppl<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ExecuteThreadStep</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">WaitForThreadToFinish</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">LFsaAppl* <span class="hljs-title">Create</span><span class="hljs-params">(CVarFSA *pCVF)</span> </span>{ Q_UNUSED(pCVF)<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QCount(nameFsa); }
    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">FCreationOfLinksForVariables</span><span class="hljs-params">()</span></span>;<font></font>
    QCount(<span class="hljs-built_in">string</span> strNam);
    <span class="hljs-keyword">virtual</span> ~QCount(<span class="hljs-keyword">void</span>);<font></font>
    ThCount  *pThCount{<span class="hljs-literal">nullptr</span>};<font></font>
    CVar *pVarCount;<font></font>
    CVar *pVarExtVarCount;<font></font>
    CVar *pVarStrNameExtVarCount;<font></font>
    CVar *pVarWorkingHours;<font></font>
<font></font>
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">x1</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">x12</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y1</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y2</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y12</span><span class="hljs-params">()</span></span>;<font></font>
    QTime time;<font></font>
<font></font>
<span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThCount</span>;</span><font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stdafx.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"QCount.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QTimer&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">static</span> LArc TBL_Count[] = {<font></font>
    LArc(<span class="hljs-string">"st"</span>,		<span class="hljs-string">"st"</span>,<span class="hljs-string">"^x12"</span>,<span class="hljs-string">"y12"</span>),			<span class="hljs-comment">//</span>
    LArc(<span class="hljs-string">"st"</span>,		<span class="hljs-string">"s2"</span>,<span class="hljs-string">"x12"</span>,	<span class="hljs-string">"y1"</span>),			<span class="hljs-comment">//</span>
    LArc(<span class="hljs-string">"s2"</span>,		<span class="hljs-string">"s3"</span>,<span class="hljs-string">"^x1"</span>,	<span class="hljs-string">"y2"</span>),			<span class="hljs-comment">//</span>
    LArc(<span class="hljs-string">"s3"</span>,		<span class="hljs-string">"s2"</span>,<span class="hljs-string">"^x1"</span>,	<span class="hljs-string">"--"</span>),			<span class="hljs-comment">//</span><font></font>
    LArc()<font></font>
};<font></font>
<font></font>
QCount::QCount(<span class="hljs-built_in">string</span> strNam):<font></font>
    LFsaAppl(TBL_Count, strNam, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>)<font></font>
{ }<font></font>
<font></font>
QCount::~QCount(<span class="hljs-keyword">void</span>) { }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">QCount::FCreationOfLinksForVariables</span><span class="hljs-params">()</span> </span>{<font></font>
    pVarCount = CreateLocVar(<span class="hljs-string">"n"</span>, CLocVar::vtInteger, <span class="hljs-string">"local counter"</span>);<font></font>
    pVarExtVarCount = <span class="hljs-literal">nullptr</span>;<font></font>
    pVarStrNameExtVarCount = CreateLocVar(<span class="hljs-string">"strNameExtVarCount"</span>, CLocVar::vtString, <span class="hljs-string">"external counter name"</span>);;
    <span class="hljs-built_in">string</span> str = pVarStrNameExtVarCount-&gt;strGetDataSrc();
    <span class="hljs-keyword">if</span> (str != <span class="hljs-string">""</span>) { pVarExtVarCount = pTAppCore-&gt;GetAddressVar(pVarStrNameExtVarCount-&gt;strGetDataSrc().c_str(), <span class="hljs-keyword">this</span>); }<font></font>
    pVarWorkingHours  = CreateLocVar(<span class="hljs-string">"strWorkingHours"</span>, CLocVar::vtString, <span class="hljs-string">"working hours"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">QCount::ExecuteThreadStep</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">if</span> (pThCount) pThCount-&gt;bIfExecuteStep = <span class="hljs-literal">true</span>; }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">QCount::WaitForThreadToFinish</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (pThCount) {
        <span class="hljs-comment">//  </span>
        pThCount-&gt;bIfRun = <span class="hljs-literal">false</span>;<font></font>
        pThCount-&gt;quit();<font></font>
        pThCount-&gt;wait(<span class="hljs-number">500</span>);<font></font>
        pThCount-&gt;<span class="hljs-built_in">terminate</span>();<font></font>
    }<font></font>
    <span class="hljs-keyword">delete</span> pThCount;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">QCount::x1</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> pVarCount-&gt;GetDataSrc() &gt; <span class="hljs-number">0</span>; }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">QCount::x12</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> pVarExtVarCount != <span class="hljs-literal">nullptr</span>; }
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">QCount::y1</span><span class="hljs-params">()</span> </span>{<font></font>
    pThCount    = <span class="hljs-keyword">new</span> ThCount(<span class="hljs-keyword">this</span>, pTAppCore-&gt;pMainFrame);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">QCount::y2</span><span class="hljs-params">()</span> </span>{ pVarCount-&gt;SetDataSrc(<span class="hljs-keyword">this</span>, pVarExtVarCount-&gt;GetDataSrc()); }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">QCount::y12</span><span class="hljs-params">()</span> </span>{ FInit(); }
<span class="hljs-comment">//                         </span><font></font>
ThCount::ThCount(QCount *p, QObject *parent) :<font></font>
    QThread(parent)<font></font>
{<font></font>
    pQCount = p;<font></font>
    bIfRun = <span class="hljs-literal">true</span>;      <span class="hljs-comment">//   / </span>
    start(QThread::IdlePriority);            <span class="hljs-comment">//  </span><font></font>
}<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ThCount::run</span><span class="hljs-params">()</span>
</span>{<font></font>
    bIfStop = <span class="hljs-literal">false</span>;       <span class="hljs-comment">//    </span>
    pQCount-&gt;pVarWorkingHours-&gt;SetDataSrc(<span class="hljs-literal">nullptr</span>, <span class="hljs-string">""</span>, <span class="hljs-literal">nullptr</span>);<font></font>
    pQCount-&gt;pVarCount-&gt;SetDataSrc(pQCount, pQCount-&gt;pVarExtVarCount-&gt;GetDataSrc());<font></font>
    pQCount-&gt;pVarCount-&gt;UpdateVariable();<font></font>
    <span class="hljs-keyword">while</span>(bIfRun)  {
        <span class="hljs-keyword">if</span> (pQCount-&gt;pVarCount-&gt;GetDataSrc() &gt; <span class="hljs-number">0</span>) {<font></font>
            bIfExecuteStep = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">int</span> n = pQCount-&gt;pVarCount-&gt;GetDataSrc();
            <span class="hljs-keyword">if</span> (n&gt;<span class="hljs-number">0</span>) {<font></font>
                pQCount-&gt;time.start();<font></font>
            }<font></font>
            pQCount-&gt;time.start();<font></font>
            <span class="hljs-keyword">while</span> (n&gt;<span class="hljs-number">0</span>) {<font></font>
                n--;<font></font>
                <span class="hljs-keyword">while</span> (bIfExecuteStep) { bIfExecuteStep = <span class="hljs-literal">false</span>; }<font></font>
            }<font></font>
            <span class="hljs-built_in">string</span> str = QString::number(pQCount-&gt;time.elapsed()).toStdString();<font></font>
            pQCount-&gt;pVarWorkingHours-&gt;SetDataSrc(<span class="hljs-literal">nullptr</span>, QString::number(pQCount-&gt;time.elapsed()).toStdString(), <span class="hljs-literal">nullptr</span>);<font></font>
            pQCount-&gt;pVarCount-&gt;SetDataSrc(pQCount, <span class="hljs-number">0.0</span>);
            <span class="hljs-keyword">while</span> (n&lt;=<span class="hljs-number">0</span>) {<font></font>
                n = <span class="hljs-keyword">int</span>(pQCount-&gt;pVarCount-&gt;GetDataSrc());<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    bIfStop = <span class="hljs-literal">true</span>;        <span class="hljs-comment">//    </span><font></font>
} <font></font>
</code></pre><br>
</div>
                    </div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envisagez un autre test, en faisant attention au temps d'exécution des threads.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Puisqu'ils sont absolument identiques, puis lancés simultanément, ils doivent simultanément terminer le travail. Si pour Python cela n'est vrai que dans une certaine erreur (voir Fig. 5), alors pour les processus dans le CPSU (a) le temps coïncide complètement (voir Fig. 6). Notez que l'objet chronomètre créé en plus, qui détermine le temps d'exécution du test en dehors de celui-ci, affiche pratiquement le même temps que le temps mesuré par le ou les tests eux-mêmes (voir Listing 4). </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque 2. Un</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «chronomètre» est un processus automatique qui démarre le compte à rebours lorsque le processus contrôlé tombe dans l'état «s1» et fixe l'heure à laquelle il passe dans l'état «st»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (voir le tableau de transition des automates dans le Listing 4).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ye/m9/9j/yem99jhhwbjomjniiquk588avdq.jpeg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig.5. Temps d'exécution du test en Python </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/gj/vv/la/gjvvlahvngzhh_agxuwgesij9l0.jpeg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 6. Le temps d'exécution des tests dans l'environnement VKP (a) Les</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
automates, en comparaison avec d'autres modèles, ont un temps discret. La valeur de l'horloge discrète peut être fixée pour les machines synchrones ou flottante - pour asynchrone (classification selon Glushkov V.M.). </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le prochain test consistera à vérifier l'environnement du CPSU (a) pour le synchronisme</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la capacité de maintenir une mesure constante du temps discret. Rappelons que le fonctionnement synchrone des machines automatiques est particulièrement demandé dans la conception des systèmes de contrôle automatique (voir détails [1]). Dans le même temps, ce mode sert </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'exemple de l'indépendance réelle du modèle de calcul par rapport à la vitesse du processeur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le temps d'exécution du test avec un cycle d'horloge discret (dans la théorie du contrôle automatique (TAU) appelé intervalle de quantification) d'une durée de 1 ms et le nombre de cycles 100000 doit être de 100 secondes. </font><font style="vertical-align: inherit;">Les résultats obtenus lors des tests sont présentés sur la Fig. </font><font style="vertical-align: inherit;">7. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/jk/po/bkjkpof2u2aemojgtv4at2jpvuq.jpeg" alt="image"><br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 7. </font><font style="vertical-align: inherit;">Test en mode synchrone (1 ms)</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nous avons en fait terminé le test principal et maintenant nous pouvons discuter de la quantité de code, car en regardant le Listing 3, les critiques ne manqueront pas de le signaler. </font><font style="vertical-align: inherit;">Mais ils oublieront encore une fois ce qui a été dit. </font><font style="vertical-align: inherit;">Le code comprend un shell organisant l'interaction avec l'environnement du CPSU (a). </font><font style="vertical-align: inherit;">Quel type d'automate prendra si vous l'excluez est expliqué dans le Listing 7, qui est du code pur pour une </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction d'automate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 7. Nettoyer le code du distributeur automatique</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"lfsaappl.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">extern</span> LArc TBL_CountMini[];
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FCountMini</span> :</span>
    <span class="hljs-keyword">public</span> LFsaAppl<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:<font></font>
    FCountMini(<span class="hljs-built_in">string</span> strNam): LFsaAppl(TBL_CountMini, strNam) {};
    <span class="hljs-keyword">int</span> nCount;
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">x1</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y1</span><span class="hljs-params">()</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stdafx.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"fcountmini.h"</span></span><font></font>
<font></font>
LArc TBL_CountMini[] = {<font></font>
    LArc(<span class="hljs-string">"1"</span>,	<span class="hljs-string">"1"</span>,<span class="hljs-string">"x1"</span>,	<span class="hljs-string">"y1"</span>),<font></font>
    LArc(<span class="hljs-string">"1"</span>,	<span class="hljs-string">"00"</span>,<span class="hljs-string">"^x1"</span>,	<span class="hljs-string">"--"</span>),<font></font>
    LArc()<font></font>
};<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FCountMini::x1</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> nCount &gt; <span class="hljs-number">0</span>; }
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FCountMini::y1</span><span class="hljs-params">()</span> </span>{ --nCount; }
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré, n'est-ce pas, beaucoup plus simple, bien que le temps de fonctionnement soit resté le même. </font><font style="vertical-align: inherit;">Mais, comme nous l'avons déjà découvert, le temps d'une fonction enfermée dans un flux est littéralement de quelques microsecondes. </font><font style="vertical-align: inherit;">Une action similaire a déjà été envisagée (voir Listing 4). </font><font style="vertical-align: inherit;">Avec lui, le temps de test sera calculé, comme précédemment, en microsecondes (voir Fig. 8). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, de nombreux problèmes de programmes automatisés peuvent être résolus si vous imaginez comment gérer leur efficacité. </font><font style="vertical-align: inherit;">Les fonctionnalités C ++ dans ce sens sont pratiquement illimitées. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/9e/dd/jc9eddl6kh2-ycdztw6ukgrgcl4.jpeg" alt="image"> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig.8. </font><font style="vertical-align: inherit;">Résultats du test de l'action de y1 (Listing 6). </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reste à considérer le «wrapper automatique» pour la fonction du Listing 7. Le Listing 8 le démontre: le code est volumineux, mais, encore une fois, générique, qui exécute des fonctions standards pour l'environnement.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 8. Wrapper pour la fonction automate du Listing 5</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"lfsaappl.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;QTime&gt;</span></span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FCountMini</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FCount</span> :</span>
    <span class="hljs-keyword">public</span> LFsaAppl<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">LFsaAppl* <span class="hljs-title">Create</span><span class="hljs-params">(CVarFSA *pCVF)</span> </span>{ Q_UNUSED(pCVF)<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FCount(nameFsa); }
    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">FCreationOfLinksForVariables</span><span class="hljs-params">()</span></span>;<font></font>
    FCount(<span class="hljs-built_in">string</span> strNam);
    <span class="hljs-keyword">virtual</span> ~FCount(<span class="hljs-keyword">void</span>);<font></font>
    CVar *pVarCount;<font></font>
    CVar *pVarExtVarCount{<span class="hljs-literal">nullptr</span>};<font></font>
    CVar *pVarStrNameExtVarCount;<font></font>
    CVar *pVarWorkingHours;<font></font>
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">x1</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">x12</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-keyword">void</span> <span class="hljs-title">y3</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y4</span><span class="hljs-params">()</span></span>; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">y12</span><span class="hljs-params">()</span></span>;<font></font>
    QTime time;<font></font>
    FCountMini *pCountMini{<span class="hljs-literal">nullptr</span>};<font></font>
};<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stdafx.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"FCount.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"fcountmini.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">static</span> LArc TBL_Count[] = {<font></font>
    LArc(<span class="hljs-string">"st"</span>,	<span class="hljs-string">"s1"</span>,<span class="hljs-string">"--"</span>,<span class="hljs-string">"y4"</span>),<font></font>
    LArc(<span class="hljs-string">"s1"</span>,	<span class="hljs-string">"st"</span>,<span class="hljs-string">"--"</span>,<span class="hljs-string">"y3"</span>),<font></font>
    LArc()<font></font>
};<font></font>
<font></font>
FCount::FCount(<span class="hljs-built_in">string</span> strNam):<font></font>
    LFsaAppl(TBL_Count, strNam)<font></font>
{ }<font></font>
<font></font>
FCount::~FCount(<span class="hljs-keyword">void</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (pCountMini) <span class="hljs-keyword">delete</span> pCountMini;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">FCount::FCreationOfLinksForVariables</span><span class="hljs-params">()</span> </span>{<font></font>
    pVarCount = CreateLocVar(<span class="hljs-string">"n"</span>, CLocVar::vtInteger, <span class="hljs-string">"local counter"</span>);<font></font>
    pVarStrNameExtVarCount = CreateLocVar(<span class="hljs-string">"strNameExtVarCount"</span>, CLocVar::vtString, <span class="hljs-string">"external counter name"</span>);;
    <span class="hljs-built_in">string</span> str = pVarStrNameExtVarCount-&gt;strGetDataSrc();
    <span class="hljs-keyword">if</span> (str != <span class="hljs-string">""</span>) { pVarExtVarCount = pTAppCore-&gt;GetAddressVar(pVarStrNameExtVarCount-&gt;strGetDataSrc().c_str(), <span class="hljs-keyword">this</span>); }<font></font>
    pVarWorkingHours  = CreateLocVar(<span class="hljs-string">"strWorkingHours"</span>, CLocVar::vtString, <span class="hljs-string">"working hours"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FCount::x1</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> pVarCount-&gt;GetDataSrc() &gt; <span class="hljs-number">0</span>; }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FCount::x12</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> pVarExtVarCount != <span class="hljs-literal">nullptr</span>; }<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FCount::y3</span><span class="hljs-params">()</span> </span>{<font></font>
    pVarWorkingHours-&gt;SetDataSrc(<span class="hljs-literal">nullptr</span>, QString::number(time.elapsed()).toStdString(), <span class="hljs-literal">nullptr</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FCount::y4</span><span class="hljs-params">()</span> </span>{<font></font>
    time.start();<font></font>
    <span class="hljs-keyword">if</span> (pCountMini) <span class="hljs-keyword">delete</span> pCountMini;<font></font>
        pCountMini = <span class="hljs-keyword">new</span> FCountMini(<span class="hljs-string">"CountMini"</span>);<font></font>
<font></font>
    pCountMini-&gt;nCount = pVarExtVarCount-&gt;GetDataSrc();<font></font>
    pCountMini-&gt;FCall(<span class="hljs-keyword">this</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FCount::y12</span><span class="hljs-params">()</span> </span>{ FInit(); }
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous pouvons résumer. Dans le cas général, les machines du CPSU (a) fonctionnent presque 2 600 fois plus lentement que les processus en Python. Telle est en effet l'évaluation de l '«interprète automatique» de l'environnement VKP (a). D'une part, des réserves colossales de croissance s'y cachent et, d'autre part, du point de vue de la réactivité du milieu, même un tel taux suffit. Mais, rappelez-vous, l'utilisation de threads nous permet de faire face à ce problème maintenant et vice versa, sur cette base pour être plus rapide que Phython plus de 200 fois. En plus des threads, il existe une «solution automatique» encore plus simple et théoriquement plus précise - appeler une fonction de problème dans une ou plusieurs actions (similaire à «diviser une opération ou un processus en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">morceaux</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » voir l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Dans tous les cas, avec C ++, la situation dans l'AP du point de vue des performances du programme ne semble pas désespérée, et dans une certaine situation (conception, par exemple, de systèmes en temps réel), elle est même avantageuse. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et enfin, un peu sur ce qui va au-delà du simple test.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> J'ai été accroché par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Je suis d'accord que "assez pour avoir peur de belles décisions subjectives dans le code". Avec un amendement important - je suis pour l'objectivité. Le code d'un programme automate peut sembler lourd (ce qui est assez réparable), pas très beau (c'est très subjectif), et peut même ne pas être organisé en vitesse (ici, comme nous l'avons vu, il y a plus d'une solution dans AP), mais la compréhension de son essence révèle quelque chose de caché de l'extérieur vue de la beauté. De plus, la beauté objective.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quel est le critère d'objectivité ici? Théorie. Dans notre cas, la théorie des automates. Sa mise en œuvre, peu importe à quoi elle ressemble, par définition, ne peut pas être laide;) Et vice versa, si la mise en œuvre ne la correspond pas, alors peu importe à quel point elle a l'air avantageuse, elle n'a généralement aucune perspective du point de vue de la théorie. C'est pourquoi, quelle que soit la ferveur dans laquelle vous propagez la technologie SWITCH, quelle que soit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la louange de l'UniMod</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais s'ils ne répondent pas aux exigences de la théorie des automates, déformant sa beauté, nous rencontrons involontairement et objectivement la situation dans laquelle «l'automate n'est pas différent de beaucoup». Et de telles "pagaille" et "danse avec un tambourin" ne peuvent pas rectifier cette situation. Mais, si vous suivez la théorie, cela n'est pas nécessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tirant des flèches critiques en direction de mitrailleuses, moi, comme celui "moche du bain", je n'ai pu m'empêcher de rappeler les coroutines;)</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je voudrais aussi les tester, mais en même temps évaluer leur beauté</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car est-ce vraiment la beauté de "dessins" comme ceux montrés sur la fig. 9 ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voir aussi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), qui implémentent, si je ne me trompe pas, deux opérateurs parallèles (?) A = ab et b = a + b, peuvent provoquer au moins des accès d'admiration minimes? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_1/lj/2t/_1lj2tagueuf7u2itoqbltdrvnu.jpeg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig.9. Un exemple de corutine.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Peut-être que ce code est même efficace, mais pour quelqu'un, il est sans aucun doute beau, mais c'est autre chose. Je ne suis pas ici sur le désir maniaque de décrire le parallélisme avec des schémas de pensée cohérente. Bien que cela soit simple, ennuyeux, car </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la pensée doit être changée</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Je suis complètement différent. Existe-t-il une théorie de la coroutine indépendante du langage de programmation qui nous permettrait de surmonter simplement et clairement les «gribouillis» du langage (voir à nouveau la figure 9) et de donner une réponse non ambiguë à la question posée? En ce qui concerne la coroutine, je ne connais pas une telle théorie, bien que, pour être honnête, je l'ai recherchée;) Pour les automates finis, c'est une théorie des automates dans laquelle un automate est toujours un automate sous n'importe quelle forme (graphique, tableau, matrice, etc.) sans lien avec langage / langages de programmation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tirant sur la «chaîne de test» apparemment la plus simple, nous avons abordé un enchevêtrement de ... problèmes parallèles. C'est peut-être vrai qu'ils l'ont juste un peu gonflé. Et ils ont commencé, si quelqu'un ne l'a pas oublié, avec une fonction élémentaire dépendante du CPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qui aurait pensé à quoi cela donnerait ... :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Littérature</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Miroshnik IV </font><font style="vertical-align: inherit;">Théorie du contrôle automatique. </font><font style="vertical-align: inherit;">Systèmes linéaires. </font><font style="vertical-align: inherit;">- Saint-Pétersbourg: Peter, 2005 .-- 336 p.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr506588/index.html">Qu'est-ce qu'un algorithme! (partie 2)</a></li>
<li><a href="../fr506590/index.html">Conférence DEVOXX UK. Choisissez un framework: Docker Swarm, Kubernetes ou Mesos. Partie 2</a></li>
<li><a href="../fr506594/index.html">Redis Best Practices, Partie 3</a></li>
<li><a href="../fr506598/index.html">Microsoft: Rust является 'лучшим шансом' в отрасли программирования безопасных систем</a></li>
<li><a href="../fr506600/index.html">Le contrat de développement du site en termes de gestion de projet (théorie + échantillon)</a></li>
<li><a href="../fr506606/index.html">Création d'un clicker PIXI.js</a></li>
<li><a href="../fr506610/index.html">WAL-G: Sauvegardes et restauration de bases de données PostgreSQL</a></li>
<li><a href="../fr506612/index.html">Comment augmenter l'exhaustivité de cours en ligne massifs</a></li>
<li><a href="../fr506620/index.html">Pensée créative: qu'est-ce que c'est, comment mesurer et augmenter votre potentiel</a></li>
<li><a href="../fr506624/index.html">FOSS News n ° 20 - revue des nouvelles gratuites et open source du 8 au 14 juin 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>