<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíñ üìä üõÉ Hunting techniques and tactics of attackers using Prefetch files üí™ üï¥üèø üññüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Trace files, or Prefetch files, have appeared on Windows since XP. Since then, they have helped digital forensics and computer incident response speci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hunting techniques and tactics of attackers using Prefetch files</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/487516/"><img src="https://habrastorage.org/webt/qz/fo/tx/qzfotx-ph1-q-7z411gspmuocm8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trace files, or Prefetch files, have appeared on Windows since XP. Since then, they have helped digital forensics and computer incident response specialists find traces of software launches, including malware. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oleg Skulkin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">leading specialist in computer forensics at Group-IB, </font><b><font style="vertical-align: inherit;">talks</font></b><font style="vertical-align: inherit;"> about what you can find with Prefetch files and how to do it.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prefetch files are stored in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% SystemRoot% \ Prefetch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directory </font><font style="vertical-align: inherit;">and are used to speed up the process of launching programs. If we look at any of these files, we will see that its name consists of two parts: the name of the executable file and the checksum from the path to it, consisting of eight characters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prefetch files contain a lot of information useful from the forensic point of view: the name of the executable file, the number of starts, lists of files and directories with which the executable file interacted, and, of course, timestamps. Typically, forensics use the creation date of a particular Prefetch file to determine the date the program first starts. In addition, these files store the date of its last launch, and starting with version 26 (Windows 8.1), the timestamps of the last seven launches.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's take one of the Prefetch files, extract the data from it using Eric Zimmerman's PECmd and look at each part. </font><font style="vertical-align: inherit;">For demonstration, I will extract the data from the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CCLEANER64.EXE-DE05DBE1.pf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, let's start from above. </font><font style="vertical-align: inherit;">Of course, we have timestamps for creating, modifying, and accessing the file:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/u1/gh/uj/u1ghujj7plvhk5wwcrlwrvkxol4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They are followed by the name of the executable file, the checksum of the path to it, the size of the executable file, as well as the version of the Prefetch file:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/99/b1/af/99b1afl_ahgisejuyetwy5u8oha.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we are dealing with Windows 10, then we will see the number of launches, the date and time of the last launch, and seven more timestamps indicating the previous launch dates:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_n/n6/lq/_nn6lqn99py-wbkorga_2k6xr2e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They are followed by information about the volume, including its serial number and creation date:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/f7/ur/zof7urr3spmk8fowq19tlm1dtms.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And last but not least, a list of directories and files the executable interacted with: </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sj/ut/uc/sjutucejd0bdtl7lqj4jyxvn3bu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the directories and files that the executable interacted with are just what I want to focus on today. It is this data that allows specialists in digital forensics, responding to computer incidents or the proactive search for threats to establish not only the fact of the execution of a file, but, in some cases, to reconstruct specific tactics and techniques of attackers. Today, attackers quite often use tools for permanently deleting data, for example, SDelete, so the ability to recover at least traces of the use of certain tactics and techniques is simply necessary for any modern defender - a computer forensic specialist, incident response specialist, ThreatHunter expert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's start with the Initial Access tactics (TA0001) and the most popular technique - Spearphishing Attachment (T1193). Some cybercriminal groups are very creative about choosing such attachments. For example, the Silence group used CHM (Microsoft Compiled HTML Help) files for this. Thus, we have yet another technique - Compiled HTML File (T1223). Such files are launched using </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hh.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , therefore, if we extract the data from its Prefetch file, we will find out which file the victim opened:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rz/u-/qs/rzu-qs_1gqkqozlylsktzgbixeq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We continue to work with real-life examples and move on to the next Execution tactics (TA0002) and the CSMTP technique (T1191). </font><font style="vertical-align: inherit;">Microsoft Connection Manager Profile Installer (CMSTP.exe) can be used by attackers to run malicious scripts. </font><font style="vertical-align: inherit;">A good example is the Cobalt band. </font><font style="vertical-align: inherit;">If we extract the data from the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmstp.exe prefetch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">, we can again find out what exactly was started:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_a/d6/w6/_ad6w6l4kie1jzvqlghmofdjkmy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another popular technique is Regsvr32 (T1117). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regsvr32.exe is</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> also often used by attackers to launch. </font><font style="vertical-align: inherit;">Here is another example from the Cobalt group: if we extract the data from the Prefetch file </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regsvr32.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then again we will see what was launched:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9e/z5/qi/9ez5qisulx1rhfpgpph2lqsg2io.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following tactics are Persistence (TA0003) and Privilege Escalation (TA0004), as well as Application Shimming (T1138) as a technique. This technique was used by Carbanak / FIN7 to secure the system. Usually working with databases with information about program compatibility (.sdb) used </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sdbinst.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Therefore, the prefetch file of this executable file can help us find out the names of such databases and their location:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ps/40/rj/ps40rjgtsih7brdssonnfi05ug0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see in the illustration, we have not only the name of the file used for installation, but also the name of the installed database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's take a look at one of the most common examples of network travel (TA0008), PsExec, which uses administrative shared resources (T1077). A service named PSEXECSVC (of course, any other name can be used if the attackers used the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-r</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> option </font><font style="vertical-align: inherit;">) will be created on the target system, therefore, if we extract the data from the Prefetch file, we will see that it was launched:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fb/x6/oq/fbx6oqbuwsqjx4n7rlwxepbokg0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will finish, perhaps, with what I started with - deleting files (T1107). </font><font style="vertical-align: inherit;">As I noted, many attackers use SDelete to permanently delete files at different stages of the attack life cycle. </font><font style="vertical-align: inherit;">If we take a look at the data from the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sdelete.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prefetch file </font><font style="vertical-align: inherit;">, we will see what exactly was deleted:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_s/7r/ow/_s7rowf7rwit15k0or2byyp0gkk.jpeg"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, this is not an exhaustive list of techniques that can be found during the analysis of Prefetch files, but this should be enough to understand that such files can not only find traces of the launch, but also reconstruct specific tactics and techniques of the attackers.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487504/index.html">By the Day of Russian Science, the best achievements of domestic scientists of 2019 are named</a></li>
<li><a href="../en487508/index.html">Measuring distance to objects using RealSense D435</a></li>
<li><a href="../en487510/index.html">Radioactive products. Gamma spectrometer. Part 1</a></li>
<li><a href="../en487512/index.html">How to implement ignore blocked users in Telegram groups?</a></li>
<li><a href="../en487514/index.html">Qrator Labs Annual Network Security and Availability Report</a></li>
<li><a href="../en487518/index.html">Radioactive products. Gamma spectrometer. Part 2</a></li>
<li><a href="../en487522/index.html">We make the terminal fly (part 1)</a></li>
<li><a href="../en487524/index.html">Why does a hardware startup hackathon need</a></li>
<li><a href="../en487528/index.html">–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–∏ –∏ –ø–æ–ª–∏—Ç–∏–∫–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–∏—Å–∞—Ö –•–∞–±—Ä–∞</a></li>
<li><a href="../en487534/index.html">etcd 3.4.3: storage reliability and security research</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>