<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶á üññüèæ üññüèæ ‡§Ö‡§Ç‡§∏‡§ø‡§¨‡§≤ ‡§ï‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡•à‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç, ‡§è‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§™‡§∞‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•ã ‡§∞‡§ø‡§´‡§≤‡•á‡§ï‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ï‡•â‡§á‡§≤ ‡§∏‡•á ‡§â‡§°‡§º‡§æ‡§® ‡§® ‡§≠‡§∞‡•á‡§Ç üïπÔ∏è ‚õ™Ô∏è üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‡§Ø‡§π DevOps-40 2020-03-18 ‡§™‡§∞ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§≤‡§ø‡§™‡§ø ‡§π‡•à :
 

‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§¶‡•ç‡§ß ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ï‡§∞, ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡•ã‡§° ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§¨‡§® ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§†‡•ã‡§∞ ‡§µ‡§æ‡§∏‡•ç...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>‡§Ö‡§Ç‡§∏‡§ø‡§¨‡§≤ ‡§ï‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡•à‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç, ‡§è‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§™‡§∞‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•ã ‡§∞‡§ø‡§´‡§≤‡•á‡§ï‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ï‡•â‡§á‡§≤ ‡§∏‡•á ‡§â‡§°‡§º‡§æ‡§® ‡§® ‡§≠‡§∞‡•á‡§Ç</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500058/"><p><img src="https://habrastorage.org/webt/bk/vw/ds/bkvwdsdsfvgvjf_ein3uddyocbm.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§Ø‡§π </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">DevOps-40 2020-03-18</font></a><font style="vertical-align: inherit;"> ‡§™‡§∞ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§≤‡§ø‡§™‡§ø ‡§π‡•à </font><font style="vertical-align: inherit;">:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§¶‡•ç‡§ß ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ï‡§∞, ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡•ã‡§° ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§¨‡§® ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø </font><font style="vertical-align: inherit;">‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§†‡•ã‡§∞ ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï‡§§‡§æ ‡§∏‡•á ‡§Ö‡§≤‡§ó ‡§π‡•ã‡§®‡•á ‡§≤‡§ó‡§§‡•á ‡§π‡•à‡§Ç‡•§ </font><font style="vertical-align: inherit;">‡§Ø‡§π ‡§® ‡§§‡•ã ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§π‡•à ‡§î‡§∞ ‡§® ‡§π‡•Ä ‡§¨‡•Å‡§∞‡§æ ‡§π‡•à, ‡§Ø‡§π ‡§è‡§ï ‡§ê‡§∏‡§æ ‡§§‡§∞‡•ç‡§ï ‡§π‡•à ‡§ú‡§ø‡§∏‡§ï‡•á ‡§∏‡§æ‡§• ‡§¨‡§π‡§∏ ‡§ï‡§∞‡§®‡§æ ‡§Æ‡•Å‡§∂‡•ç‡§ï‡§ø‡§≤ ‡§π‡•à ‡§î‡§∞ ‡§á‡§∏‡•á ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡§æ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à‡•§ </font><font style="vertical-align: inherit;">‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡§æ ‡§è‡§ï ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§∞‡§ø‡§´‡•à‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§π‡•à‡•§ </font><font style="vertical-align: inherit;">‡§ï‡•ã‡§° ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§á‡§®‡•ç‡§´‡•ç‡§∞‡§æ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ï‡•ç‡§ö‡§∞ ‡§ï‡•ã ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§¨‡§®‡§æ‡§®‡§æ‡•§ </font><font style="vertical-align: inherit;">‡§è‡§ï ‡§∏‡§æ‡§≤ ‡§Æ‡•á‡§Ç ‡§ï‡§π‡§æ‡§®‡•Ä ‡§ï‡•ã ‡§ï‡•à‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è ‡§î‡§∞ ‡§ï‡•ã‡§Ø‡§≤‡•ã‡§Ç ‚Äã‚Äã‡§ï‡•ã ‡§® ‡§â‡§°‡§º‡§æ‡§è‡§Ç, ‡§á‡§∏‡§ï‡•Ä ‡§ï‡§π‡§æ‡§®‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§</font></font></p><a name="habracut"></a><br>
<h2 id="zarozhdenie-legacy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§¶ ‡§≤‡§ø‡§ó‡•á‡§∏‡•Ä ‡§ì‡§∞‡§ø‡§ú‡§ø‡§®</font></font></h2><br>
<h3 id="den--1-nulevoy-pacient"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§¶‡§ø‡§® 1: ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§∞‡•ã‡§ó‡•Ä</font></font></h3><br>
<p><img src="https://habrastorage.org/webt/jm/mn/9q/jmmn9qcfnbprr8maq3k2zpp27ww.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§è‡§ï ‡§∏‡§∂‡§∞‡•ç‡§§ ‡§™‡§∞‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ ‡§•‡•Ä‡•§ </font><font style="vertical-align: inherit;">‡§á‡§∏‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§¶‡•á‡§µ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§¶‡§≤ ‡§î‡§∞ ‡§ë‡§™‡•ç‡§∏ ‡§á‡§Ç‡§ú‡•Ä‡§®‡§ø‡§Ø‡§∞ ‡§•‡•á‡•§ </font><font style="vertical-align: inherit;">‡§â‡§®‡•ç‡§π‡•ã‡§Ç‡§®‡•á ‡§è‡§ï ‡§π‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§π‡§≤ ‡§ï‡§ø‡§Ø‡§æ: ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§ï‡•ã ‡§ï‡•à‡§∏‡•á ‡§§‡•à‡§®‡§æ‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è ‡§î‡§∞ ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡•ã ‡§ï‡•à‡§∏‡•á ‡§ö‡§≤‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§è‡•§ </font><font style="vertical-align: inherit;">‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ø‡§π ‡§•‡•Ä ‡§ï‡§ø ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§ü‡•Ä‡§Æ ‡§®‡•á ‡§á‡§∏ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§π‡§≤ ‡§ï‡§ø‡§Ø‡§æ‡•§ </font><font style="vertical-align: inherit;">‡§¶‡•á‡§µ ‡§î‡§∞ ‡§ë‡§™‡•ç‡§∏ ‡§ü‡•Ä‡§Æ‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§∏‡§ø‡§Ç‡§ï‡•ç‡§∞‡§®‡§æ‡§á‡§ú‡§º ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§á‡§∏ ‡§™‡§∞‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ ‡§®‡•á ‡§Ö‡§Ç‡§∏‡§ø‡§¨‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§≤‡§ø‡§Ø‡§æ‡•§</font></font></p><br>
<h3 id="den--89-zarozhdenie-legacy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§¶‡§ø‡§® ‡§®‡§Ç‡§¨‡§∞ 89: ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§ï‡§æ ‡§ú‡§®‡•ç‡§Æ</font></font></h3><br>
<p><img src="https://habrastorage.org/webt/p1/gg/sr/p1ggsrxayo0fachydvmwhqtloek.png"></p><br>
<p>   ,     ,   legacy.   ?</p><br>
<ul>
<li>    ,    ‚Äî  .</li>
<li>          .</li>
<li>  Ansible / Python / Bash / Terraform!     !</li>
<li> Full Stack Overflow Developer    stackoverflow,     ,      .</li>
</ul><br>
<p>      ,    ,    ,   ,    ,     , ,    ,     .</p><br>
<pre><code class="plaintext hljs">- hosts: localhost<font></font>
  tasks:<font></font>
    - shell: echo -n Z &gt;&gt; a.txt &amp;&amp; cat a.txt<font></font>
      register: output<font></font>
      delay: 1<font></font>
      retries: 5<font></font>
      until: not output.stdout.find("ZZZ")</code></pre><br>
<h3 id="den--109-osoznanie-problemy"> ‚Ññ 109:  </h3><br>
<p><img src="https://habrastorage.org/webt/52/-m/km/52-mkm0nvoywmsugy7gscnstjh0.png"></p><br>
<p>     IaC       /  /  ,        .     ,    .</p><br>
<h2 id="refaktoring-iac"> IaC</h2><br>
<h3 id="den--139-a-vam-tochno-nuzhen-refaktoring"> ‚Ññ 139:     ?</h3><br>
<p><img src="https://habrastorage.org/webt/ih/ty/rh/ihtyrh6qo2oufdjxheiflkp1erg.png"></p><br>
<p>          :</p><br>
<ol>
<li>   ?</li>
<li>    ?</li>
<li>  ?</li>
</ol><br>
<p>       ,            . ..  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  ,  200 000   </a>),            .</p><br>
<h3 id="den--149-podgotovka-refaktoringa"> ‚Ññ 149:  </h3><br>
<p><img src="https://habrastorage.org/webt/ml/58/cc/ml58ccbdsrcynuz6be0o76uw4tm.png"></p><br>
<p>e   .    .   ,        .   - ,    confluence,      " ?"  " ?"     .       <em>  </em>:      / .       ,    ,        - .</p><br>
<p><img src="https://habrastorage.org/webt/pn/98/jt/pn98jtnydc1wupw_jvifjjc9mpc.png"></p><br>
<p>,             .   ,   ,   :         ,  ,       .</p><br>
<h4 id="popytki-testirovaniya-ansible">  Ansible</h4><br>
<p>       Ansible  ,        ,      .</p><br>
<h5 id="den---997-sds-provision"> ‚Ññ -997: SDS provision</h5><br>
<p><img src="https://habrastorage.org/webt/wb/sx/vi/wbsxviuyfwt5ngzmn92n6wpcs6a.png"></p><br>
<p>   Ansible      SDS (Software Defined Storage).      <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">        </a>,   ,            60-90    ,   .   e2e , ..    ,    .      .          .</p><br>
<h5 id="den---701-ansible-i-test-kitchen"> ‚Ññ -701: Ansible  test kitchen</h5><br>
<p><img src="https://habrastorage.org/webt/kj/la/wd/kjlawd4ptlxrpsoa9bhechz57jc.png"></p><br>
<p>   Ansible    ,   test kitchen / kitchen-ci  inspec.     Ruby (     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  YML    ansible?</a>)    40   10 .         .</p><br>
<p><img src="https://habrastorage.org/webt/jj/7i/ln/jj7ilnbd5gav6wmc9ls3qapduwq.png"></p><br>
<p>   ,    - .       13    2      ,      70 ,    2  .  XP (extreme programming)     ..     70 .      </p><br>
<h5 id="den---601-ansible-i-molecule"> ‚Ññ -601: Ansible  molecule</h5><br>
<p><img src="https://habrastorage.org/webt/_n/23/w3/_n23w3y7acelkugzgtt0hoqxmdc.png"></p><br>
<p>    testkitchen,       docker   . ,     20-25   7 .</p><br>
<p><img src="https://habrastorage.org/webt/u5/tb/n8/u5tbn8xgqjzbnvtlqjpdsa17mmc.png"></p><br>
<p>     17   45      28   2 jenkins slave.</p><br>
<h3 id="den--167-dobavlyaem-na-proekt-testy-ansible"> ‚Ññ 167:     Ansible</h3><br>
<p><img src="https://habrastorage.org/webt/di/zi/cz/diziczzal8qnxt6azdlyhptniho.png"></p><br>
<p>   ,     .    ,                .          ,    .</p><br>
<p><img src="https://habrastorage.org/webt/rp/hs/tb/rphstbmcna7nbyocuotat9hbwv0.png"></p><br>
<p>        ,    ,     ,     jira,    google docs     .    ,    ,     . ,  - ,        ,   .</p><br>
<p> :</p><br>
<ul>
<li>Eat.</li>
<li>Sleep.</li>
<li>Code.</li>
<li>IaC test.</li>
<li>Repeat</li>
</ul><br>
<p>       .</p><br>
<p><img src="https://habrastorage.org/webt/wf/h8/tg/wfh8tgcdwlkb60nb-kfsyqjrxgy.png"></p><br>
<p>      ,            . </p><br>
<h3 id="den--181-green-build-master"> ‚Ññ 181: Green Build Master</h3><br>
<p><img src="https://habrastorage.org/webt/lw/ow/xi/lwowxis0izoohgthm9db7nheih4.png"></p><br>
<p>      Green Build Master.     ,          jenkins.   ,      :</p><br>
<ul>
<li>  .</li>
<li>  -     ,     .</li>
</ul><br>
<h3 id="den--193-ot-lintovki-k-unit-testam"> ‚Ññ 193:    unit </h3><br>
<p><img src="https://habrastorage.org/webt/eq/v-/0b/eqv-0bs92a557nhsifvggktxmps.png"></p><br>
<p>           ‚Äî     ,    .     ,   .</p><br>
<h3 id="den--211-ot-unit-k-integration-testam"> ‚Ññ 211:  unit  integration </h3><br>
<p><img src="https://habrastorage.org/webt/2c/xt/8a/2cxt8avymduqf-k8seavlobvvqa.png"></p><br>
<p> unit       ,      . ..      ,   ,    .</p><br>
<p><img src="https://habrastorage.org/webt/rh/_h/0w/rh_h0wompfe15rx5arn9afnna2w.png"></p><br>
<p> jenkins    ,      / ,          .</p><br>
<h4 id="jenkins--docker--ansible--tests">Jenkins + Docker + Ansible = Tests</h4><br>
<p><img src="https://habrastorage.org/webt/e6/3d/0s/e63d0sm28xvpn-hlhze5bo4c8jo.png"></p><br>
<ol>
<li>Checkout&nbsp;repo&nbsp;and generate build stages.</li>
<li>Run lint playbook stages in parallel.</li>
<li>Run lint role stages in parallel.</li>
<li>Run&nbsp;syntax check role stages in parallel.</li>
<li>Run&nbsp;test role stages in parallel.<br>
<ol>
<li>Lint role.</li>
<li>Check dependency on other roles.</li>
<li>Check syntax.</li>
<li>Create docker instance</li>
<li>Run molecule/default/playbook.yml.</li>
<li>Check&nbsp;idempotency.</li>
</ol></li>
<li>Run integration tests</li>
<li>Finish</li>
</ol><br>
<h3 id="den--271-bus-factor"> ‚Ññ 271: Bus Factor</h3><br>
<p><img src="https://habrastorage.org/webt/cj/tb/wg/cjtbwgo4xb1j7umm75vvpjph8wk.png"></p><br>
<p>        - .      e.           code review          .   ,      ,  , ..          .</p><br>
<p><img src="https://habrastorage.org/webt/mr/9n/f3/mr9nf3at9k4h1ishpfypwehqlqo.png"></p><br>
<p>    .   ,       ,  .   jenkins + bitbucket + jira.</p><br>
<p>     , -,      ,     :</p><br>
<pre><code class="plaintext hljs">- get_url:<font></font>
    url: "{{ actk_certs }}/{{ item.1 }}"<font></font>
    dest: "{{ actk_src_tmp }}/"<font></font>
    username: "{{ actk_mvn_user }}"<font></font>
    password: "{{ actk_mvn_pass }}"<font></font>
  with_subelements:<font></font>
    - "{{ actk_cert_list }}"<font></font>
    - "{{ actk_certs }}"<font></font>
  delegate_to: localhost<font></font>
<font></font>
- copy:<font></font>
    src: "{{ actk_src_tmp }}/{{ item.1 }}"<font></font>
    dest: "{{ actk_dst_tmp }}"<font></font>
  with_subelements:<font></font>
    - "{{ actk_cert_list }}"<font></font>
    - "{{ actk_certs }}"</code></pre><br>
<p>  ,   .</p><br>
<pre><code class="plaintext hljs">get_url:<font></font>
    url: "{{ actk_certs }}/{{ actk_item }}"<font></font>
    dest: "{{ actk_src_tmp }}/{{ actk_item }}"<font></font>
    username: "{{ actk_mvn_user }}"<font></font>
    password: "{{ actk_mvn_pass }}"<font></font>
  loop_control:<font></font>
    loop_var: actk_item<font></font>
  with_items: "{{ actk_cert_list }}"<font></font>
  delegate_to: localhost<font></font>
<font></font>
- copy:<font></font>
    src: "{{ actk_src_tmp }}/{{ actk_item }}"<font></font>
    dest: "{{ actk_dst_tmp }}"<font></font>
  loop_control:<font></font>
    loop_var: actk_item<font></font>
  with_items: "{{ actk_cert_list }}"</code></pre><br>
<h3 id="den--311-uskoryaem-testy"> ‚Ññ 311:  </h3><br>
<p><img src="https://habrastorage.org/webt/an/sq/6h/ansq6hsvm8jzb23p9fb6aowij1y.png"></p><br>
<p>    ,        .         "   ,   ".              docker,   .    testinfra  ansible verifier    -  .</p><br>
<p><img src="https://habrastorage.org/webt/hl/y5/ix/hly5ixtdz684mku874jgc2hb8su.png"></p><br>
<p>     :</p><br>
<ol>
<li>  docker.</li>
<li>  ,     .</li>
<li> - .</li>
<li>  .</li>
<li>  <strong></strong>   .</li>
</ol><br>
<p><img src="https://habrastorage.org/webt/0t/re/rf/0trerfuwmb5rigsb7ueykjyrbvg.png"></p><br>
<p>  Pipeline  jenkins  </p><br>
<ol>
<li>Generate build stages.</li>
<li>Lint all in parallel.</li>
<li>Run&nbsp;test role stages in parallel.</li>
<li>Finish.</li>
</ol><br>
<h2 id="lessons-learned">Lessons learned</h2><br>
<h3 id="avoid-global-variables">Avoid global variables</h3><br>
<p>Ansible   ,   workaround   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">private_role_vars</a>,    . </p><br>
<p> .     <code>role_a</code>  <code>role_b</code></p><br>
<pre><code class="plaintext hljs"># cat role_a/defaults/main.yml<font></font>
---<font></font>
msg: a<font></font>
<font></font>
# cat role_a/tasks/main.yml<font></font>
---<font></font>
- debug:<font></font>
    msg: role_a={{ msg }}</code></pre><br>
<pre><code class="plaintext hljs"># cat role_b/defaults/main.yml<font></font>
---<font></font>
msg: b<font></font>
<font></font>
# cat role_b/tasks/main.yml<font></font>
---<font></font>
- set_fact:<font></font>
    msg: b<font></font>
- debug:<font></font>
    msg: role_b={{ msg }}</code></pre><br>
<pre><code class="plaintext hljs">- hosts: localhost<font></font>
  vars:<font></font>
    msg: hello<font></font>
  roles:<font></font>
    - role: role_a<font></font>
    - role: role_b<font></font>
  tasks:<font></font>
    - debug:<font></font>
        msg: play={{msg}}</code></pre><br>
<p><img src="https://habrastorage.org/webt/yo/6j/mn/yo6jmnxymfxjseigrda7hcjkysk.png"></p><br>
<p> ,           ,    .      Ansible     ,   - ,          .</p><br>
<p><strong>BAD</strong>:   .</p><br>
<pre><code class="plaintext hljs"># cat roles/some_role/tasks/main.yml<font></font>
---<font></font>
debug:<font></font>
  var: java_home</code></pre><br>
<p><strong>GOOD</strong>:  <code>defaults</code>        .</p><br>
<pre><code class="plaintext hljs"># cat roles/some_role/defaults/main.yml<font></font>
---<font></font>
r__java_home:<font></font>
 "{{ java_home | default('/path') }}"<font></font>
<font></font>
# cat roles/some_role/tasks/main.yml<font></font>
---<font></font>
debug:<font></font>
  var: r__java_home<font></font>
</code></pre><br>
<h3 id="prefix-role-variables">Prefix role variables</h3><br>
<p><strong>BAD</strong>:   .</p><br>
<pre><code class="plaintext hljs"># cat roles/some_role/defaults/main.yml<font></font>
---<font></font>
db_port: 5432</code></pre><br>
<p><strong>GOOD</strong>:          ,    inventory     .</p><br>
<pre><code class="plaintext hljs"># cat roles/some_role/defaults/main.yml<font></font>
---<font></font>
some_role__db_port: 5432</code></pre><br>
<h3 id="use-loop-control-variable">Use loop control variable</h3><br>
<p><strong>BAD</strong>:      <code>item</code>,   /  -        </p><br>
<pre><code class="plaintext hljs">---<font></font>
- hosts: localhost<font></font>
  tasks:<font></font>
    - debug:<font></font>
        msg: "{{ item }}"<font></font>
      loop:<font></font>
        - item1<font></font>
        - item2<font></font>
</code></pre><br>
<p><strong>GOOD</strong>:      <code>loop_var</code>.</p><br>
<pre><code class="plaintext hljs">---<font></font>
- hosts: localhost<font></font>
  tasks:<font></font>
    - debug:<font></font>
        msg: "{{ item_name }}"<font></font>
      loop:<font></font>
        - item1<font></font>
        - item2<font></font>
      loop_control:<font></font>
        loop_var: item_name<font></font>
</code></pre><br>
<h3 id="check-input-variables">Check input variables</h3><br>
<p>    ,           , ,     </p><br>
<p><strong>GOOD</strong>:  .</p><br>
<pre><code class="plaintext hljs">- name: "Verify that required string variables are defined"<font></font>
  assert:<font></font>
    that: ahs_var is defined and ahs_var | length &gt; 0 and ahs_var != None<font></font>
    fail_msg: "{{ ahs_var }} needs to be set for the role to work "<font></font>
    success_msg: "Required variables {{ ahs_var }} is defined"<font></font>
  loop_control:<font></font>
    loop_var: ahs_var<font></font>
  with_items:<font></font>
    - ahs_item1<font></font>
    - ahs_item2<font></font>
    - ahs_item3</code></pre><br>
<h3 id="avoid-hashes-dictionaries-use-flat-structure">Avoid hashes dictionaries, use flat structure</h3><br>
<p>   hash/dictionary    ,         ,      hash/dictionary,    .</p><br>
<p><strong>BAD</strong>:  hash/dictionary.</p><br>
<pre><code class="plaintext hljs">---<font></font>
user:<font></font>
  name: admin<font></font>
  group: admin</code></pre><br>
<p><strong>GOOD</strong>:    .</p><br>
<pre><code class="plaintext hljs">---<font></font>
user_name: admin<font></font>
user_group: "{{ user_name }}"</code></pre><br>
<h3 id="create-idempotent-playbooks--roles">Create idempotent playbooks &amp; roles</h3><br>
<p>     , ..  configuration drift    -.     molecule,     .</p><br>
<h3 id="avoid-using-command-shell-modules">Avoid using command shell modules</h3><br>
<p> shell      ,  ,    Ansible.</p><br>
<h3 id="test-your-roles-via-molecule">Test your roles via molecule</h3><br>
<p>Molecule    ,    .</p><br>
<h4 id="molecule-multiple-instances">Molecule Multiple instances</h4><br>
<p> <code>molecule.yml</code>   <code>platforms</code>      .</p><br>
<pre><code class="plaintext hljs">---<font></font>
    driver:<font></font>
      name: docker<font></font>
    platforms:<font></font>
      - name: postgresql-instance<font></font>
        hostname: postgresql-instance<font></font>
        image: registry.example.com/postgres10:latest<font></font>
        pre_build_image: true<font></font>
        override_command: false<font></font>
        network_mode: host<font></font>
      - name: app-instance<font></font>
        hostname: app-instance<font></font>
        pre_build_image: true<font></font>
        image: registry.example.com/docker_centos_ansible_tests<font></font>
        network_mode: host</code></pre><br>
<p>  ,    <code>converge.yml</code> :</p><br>
<pre><code class="plaintext hljs">---<font></font>
- name: Converge all<font></font>
  hosts: all<font></font>
  vars:<font></font>
    ansible_user: root<font></font>
  roles:<font></font>
    - role: some_role<font></font>
<font></font>
- name: Converge db<font></font>
  hosts: db-instance<font></font>
  roles:<font></font>
    - role: some_db_role<font></font>
<font></font>
- name: Converge app<font></font>
  hosts: app-instance<font></font>
  roles:<font></font>
    - role: some_app_role</code></pre><br>
<h4 id="ansible-verifier">Ansible verifier</h4><br>
<p> molecule    ansible   ,     ,       3 .      testinfra/inspec,   ,      :</p><br>
<pre><code class="plaintext hljs">---<font></font>
- name: Verify<font></font>
  hosts: all<font></font>
  tasks:<font></font>
    - name: copy config<font></font>
      copy:<font></font>
        src: expected_standalone.conf<font></font>
        dest: /root/wildfly/bin/standalone.conf<font></font>
        mode: "0644"<font></font>
        owner: root<font></font>
        group: root<font></font>
      register: config_copy_result<font></font>
<font></font>
    - name: Certify that standalone.conf changed<font></font>
      assert:<font></font>
        that: not config_copy_result.changed</code></pre><br>
<p>  ,      smoke test:</p><br>
<pre><code class="plaintext hljs">---<font></font>
  - name: Verify<font></font>
    hosts: solr<font></font>
    tasks:<font></font>
      - command: /blah/solr/bin/solr start -s /solr_home -p 8983 -force<font></font>
      - uri:<font></font>
          url: http://127.0.0.1:8983/solr<font></font>
          method: GET<font></font>
          status_code: 200<font></font>
        register: uri_result<font></font>
        until: uri_result is not failed<font></font>
        retries: 12<font></font>
        delay: 10<font></font>
      - name: Post documents to solr<font></font>
        command: /blah/solr/bin/post -c master /exampledocs/books.csv</code></pre><br>
<h3 id="put-complex-logic-into-modules--plugins">Put complex logic into modules &amp; plugins</h3><br>
<p>Ansible   ,      ,  , shell ,     .           ,   ,        .</p><br>
<h3 id="summarize-tips--tricks">Summarize Tips &amp; Tricks</h3><br>
<ol>
<li>Avoid global variables.</li>
<li>Prefix role variables.</li>
<li>Use loop control variable.</li>
<li>Check input variables.</li>
<li>Avoid hashes dictionaries, use flat structure.</li>
<li>Create idempotent playbooks &amp; roles.</li>
<li>Avoid using command shell modules.</li>
<li>Test your roles via molecule.</li>
<li>Put complex logic into modules &amp; plugins.</li>
</ol><br>
<h2 id="zaklyuchenie"></h2><br>
<p><img src="https://habrastorage.org/webt/ih/ty/rh/ihtyrh6qo2oufdjxheiflkp1erg.png"></p><br>
<p>        ,     IaC.     ,   .</p><br>
<h2 id="links">Links</h2><br>
<ul>
<li>Slides <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">How to test Ansible and don't go nuts</a></li>
<li>Video <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">How to test Ansible and don't go nuts</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  ,  200 000   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Ansible:   120 VM c Coreos  Centos  18 </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">        </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">       YML    ansible?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">A list of awesome IaC testing articles, speeches &amp; links</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">English version</a></li>
</ul><br>
<p><strong>UPD1 2020.05.01 20:30</strong> ‚Äî       <code>callback_whitelist = profile_tasks</code>       .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">  ansible</a>.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">mitogen</a><br>
<strong>UPD2 2020.05.03 16:34</strong> ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">English version</a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi500044/index.html">‡§∏‡§ø‡§Æ‡•ç‡§´‡§®‡•Ä 5 ‡§¨‡§Ç‡§°‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡•ã‡§° ‡§ï‡§æ ‡§™‡•Å‡§®: ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç? ‡§≠‡§æ‡§ó 6. ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£</a></li>
<li><a href="../hi500046/index.html">JetBrains ‡§∞‡§æ‡§á‡§°‡§∞ - ‡§Ö‡§¨ ‡§Ö‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§á‡§Ç‡§ú‡§® ‡§ï‡•á ‡§≤‡§ø‡§è</a></li>
<li><a href="../hi500048/index.html">‡§∏‡§æ‡§Ç‡§ñ‡•ç‡§Ø‡§ø‡§ï‡•Ä‡§Ø ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ú‡•ã ‡§Ü‡§™ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç</a></li>
<li><a href="../hi500052/index.html">‡§ú‡§∞‡•ç‡§Æ‡§®‡•Ä ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ï ‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§®‡•å‡§ï‡§∞‡•Ä ‡§ï‡•Ä ‡§ñ‡•ã‡§ú‡•§ ‡§≠‡§æ‡§ó ‡•ß/‡•´ ‡§ï‡•ç‡§Ø‡•ã‡§Ç ‡§ú‡§∞‡•ç‡§Æ‡§®‡•Ä ‡§®‡•å‡§ï‡§∞‡•Ä ‡§ï‡•Ä ‡§§‡§≤‡§æ‡§∂ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•Ä‡§ú‡§º‡§æ</a></li>
<li><a href="../hi500054/index.html">‡§è‡§ï ‡§î‡§∞ ‡§¨‡§æ‡§á‡§ï: HTTP ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø</a></li>
<li><a href="../hi500060/index.html">‡§ï‡•à‡§∏‡•á ‡§™‡•ç‡§∞‡•å‡§¶‡•ç‡§Ø‡•ã‡§ó‡§ø‡§ï‡•Ä ‡§ï‡§Ç‡§™‡§®‡§ø‡§Ø‡§æ‡§Ç ‡§°‡•â‡§ï‡•ç‡§ü‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§π‡§æ‡§Æ‡§æ‡§∞‡•Ä ‡§∏‡•á ‡§≤‡§°‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡§Ç</a></li>
<li><a href="../hi500064/index.html">‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç ‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•â‡§® ‡§î‡§∞ ‡§µ‡•á‡§¨‡§ø‡§ï‡•ç‡§∏ ‡§ï‡•à‡§∏‡•á ‡§¨‡§®‡§æ‡§Ø‡•á</a></li>
<li><a href="../hi500066/index.html">‡§µ‡§æ‡§à-‡§´‡§æ‡§à 6 ‡§™‡•á‡§∂ ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§Ü‡§∞‡•ç‡§ü‡§ø‡§´‡§ø‡§∂‡§ø‡§Ø‡§≤ ‡§á‡§Ç‡§ü‡•á‡§≤‡§ø‡§ú‡•á‡§Ç‡§∏ ‡§ï‡•ç‡§Ø‡•ã‡§Ç?</a></li>
<li><a href="../hi500072/index.html">‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§´‡•ç‡§∞‡§Ç‡§ü ‡§è‡§Ç‡§° ‡§Ü‡§∞‡•ç‡§ï‡§ø‡§ü‡•á‡§ï‡•ç‡§ö‡§∞</a></li>
<li><a href="../hi500074/index.html">‡§Ü‡§™‡§®‡•á ‡§è‡§ï ‡§ì‡§™‡§® ‡§∏‡•ã‡§∞‡•ç‡§∏ ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ï‡•á ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§®‡•á ‡§ï‡§æ ‡§´‡•à‡§∏‡§≤‡§æ ‡§ï‡§ø‡§Ø‡§æ‡•§ ‡§ï‡§ø‡§∏ ‡§ö‡•Ä‡§ú ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡§∞‡•á‡§Ç?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>