<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“¶ ğŸ‘¾ ğŸ§“ Relogin dan HTTP Basic Auth ğŸ‘¨â€ğŸ­ ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘©ğŸ½ ğŸ›Œ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pengembang web telah lama menyadari masalah masuk dan masuk ke situs yang dilindungi oleh Otorisasi Dasar HTTP. Meskipun ada metode otentikasi lain ya...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Relogin dan HTTP Basic Auth</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488388/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengembang web telah lama menyadari masalah masuk dan masuk ke situs yang dilindungi oleh Otorisasi Dasar HTTP. </font><font style="vertical-align: inherit;">Meskipun ada metode otentikasi lain yang tidak menderita masalah ini, Otorisasi Dasar masih sering merupakan pilihan terbaik. </font><font style="vertical-align: inherit;">Jaringan memiliki cukup bahan yang menggambarkan berbagai solusi umum dan khusus. </font><font style="vertical-align: inherit;">Tetapi semuanya, yang saya temukan, sayangnya, hanya menggambarkan beberapa solusi parsial yang bekerja di satu browser dan tidak berfungsi di browser lain. </font><font style="vertical-align: inherit;">Di bawah kucing saya memberikan hasil akhir umum dari penelitian saya tentang masalah ini</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan segera membuat reservasi bahwa saya bukan pengembang front-end, dan saya tidak masuk ke berbagai "merek" dan versi browser. </font><font style="vertical-align: inherit;">Hanya arus utama dengan versi yang relevan pada saat penulisan. </font><font style="vertical-align: inherit;">Untuk sebagian besar tugas web ini sudah cukup. </font><font style="vertical-align: inherit;">Bagi para pengembang yang membutuhkan dukungan untuk seluruh "kebun binatang" peramban, artikel ini bisa menjadi titik awal yang baik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inti masalahnya adalah bahwa standar Otorisasi Dasar HTTP tidak menyediakan kemungkinan razlogin. </font><font style="vertical-align: inherit;">Umumnya. </font><font style="vertical-align: inherit;">Ketika Anda pergi ke halaman yang dilindungi oleh Otorisasi Dasar, browser itu sendiri menampilkan Anda sendiri jendela dengan permintaan untuk login / kata sandi dan, dengan login yang berhasil, menyimpannya di suatu tempat di kedalamannya. </font><font style="vertical-align: inherit;">Kemudian, semua permintaan berikutnya ke halaman lain yang dilindungi dari situs ini akan secara otomatis menggunakan nilai-nilai ini di header Otorisasi:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otorisasi: Basic bm9uZTpub25l</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di mana bm9uZTpub25l adalah tautan login / kata sandi yang dikodekan base64: tidak ada (nama pengguna dan kata sandi Anda mungkin berbeda) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk masuk, Anda hanya perlu mengatur ulang nama pengguna / kata sandi lama di kedalaman browser dan di dalamnya tempat untuk merekam yang baru. </font><font style="vertical-align: inherit;">Di sinilah kejutan menunggu kita. </font><font style="vertical-align: inherit;">Karena tidak ada standar yang mengatur tindakan ini, setiap browser melakukan ini berdasarkan pemahamannya sendiri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih buruk lagi, karena jendela permintaan login / kata sandi adalah jendela perambannya sendiri, yang sudah merespons hanya tajuk halaman HTTP, jendela ini muncul sebelum pemrosesan badan laman apa pun. </font><font style="vertical-align: inherit;">Artinya, untuk mengeksekusi beberapa javascript ketika menerima respons server dengan status 401 tidak berfungsi. </font><font style="vertical-align: inherit;">Sebelum pengguna jendela ini akan muncul berulang kali dengan permintaan login / kata sandi berulang.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faktanya, poin ini sangat penting, karena untuk hampir semua browser, satu-satunya cara untuk keluar adalah dengan mengirim permintaan ke server dengan login / kata sandi yang salah, menerima respons server dengan status 401 dan kemudian mereset cache login / kata sandi browser. </font><font style="vertical-align: inherit;">Tetapi jika pada saat yang sama peramban tidak memungkinkan Anda untuk memproses respons 401 dan melanjutkan proses login sudah untuk pengguna baru, mengambil kendali bahkan pada tahap membaca header HTTP dan melemparkan bentuk otorisasi yang Anda masukkan tidak akan bekerja di wajah Anda, maka ini sudah menjadi masalah. </font><font style="vertical-align: inherit;">Tidak masalah jika ini adalah permintaan normal dengan referensi atau XMLHttpRequest atau ambil. </font><font style="vertical-align: inherit;">Browser masih mengambil kendali pada tahap penguraian header. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begituâ€¦</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data awal:</font></font></h4><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada halaman logout.html terpisah di mana semua logika terletak di skrip javascript, yang sebagian diberikan dalam proses presentasi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL yang ditentukan - alamat halaman untuk dialihkan setelah login berhasil</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Url401 ditentukan - alamat halaman yang selalu mengembalikan kesalahan HTTP 401 (tidak diotorisasi)</font></font></li>
</ol><br>
<pre><code class="javascript hljs"><span class="hljs-comment">// file logout.html</span>
<span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> URL(<span class="hljs-string">"http://mysite.com/"</span>);
<span class="hljs-keyword">const</span> url401 = <span class="hljs-keyword">new</span> URL(<span class="hljs-string">"http://mysite.com/401"</span>);
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Produk kami tidak memerlukan dukungan untuk browser ini, jadi solusi yang saya belum diuji secara pribadi. </font><font style="vertical-align: inherit;">Namun demikian, menurut Google, ada solusi untuk itu, dan itu mungkin yang paling sederhana dan paling elegan dari semuanya. </font><font style="vertical-align: inherit;">Selain itu, saya belum pernah bertemu informasi apa pun bahwa solusi untuk peramban Microsoft ini kehilangan relevansinya:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.execCommand(<span class="hljs-string">"ClearAuthenticationCache"</span>)) {
    <span class="hljs-built_in">window</span>.location.assign(url);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di IE, ada metode ClearAuthenticationCache yang membuang "usus yang sangat dalam." </font><font style="vertical-align: inherit;">Sederhana dan elegan. </font><font style="vertical-align: inherit;">Dan tidak ada menari dengan halaman tambahan 401. Saya tidak tahu apakah metode ini bekerja di Edge. </font><font style="vertical-align: inherit;">Mungkin iya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Construk document.execCommand mengembalikan true jika metode ada dan "bekerja". </font><font style="vertical-align: inherit;">Kemudian window.location.assign (url) mengarahkan ulang pengguna untuk memasukkan nama pengguna dan kata sandi baru</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox (72.0.1)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam konteks tugas kami, ini adalah peramban yang paling bermasalah. </font><font style="vertical-align: inherit;">Baginya, solusi lengkap masih belum ada. </font><font style="vertical-align: inherit;">Selama 15-20 tahun, permintaan untuk masalah yang ditunjukkan telah tergantung pada pelacak bug tim pengembangnya. </font><font style="vertical-align: inherit;">Tapi "semuanya masih ada di sana." </font><font style="vertical-align: inherit;">Maksimum yang bisa dicapai adalah kurva razlogin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Input: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Firefox tidak mereset cache kata sandi setelah menerima respons 401 melalui XMLHttpRequest atau mengambil permintaan. </font><font style="vertical-align: inherit;">Hanya melalui permintaan reguler dengan login / kata sandi di URL itu sendiri. </font><font style="vertical-align: inherit;">Yaitu, kira-kira seperti itu</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // tidak ada: none@mysite.com/</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kode:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/firefox|iceweasel|fxios/i</span>.test(<span class="hljs-built_in">window</span>.navigator.userAgent)) {<font></font>
    url.username = <span class="hljs-string">'none'</span>;<font></font>
    url.password = <span class="hljs-string">'none'</span>;
    <span class="hljs-built_in">window</span>.location.assign(url);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu pengguna menerima formulir input login / kata sandi, di mana apa pun yang Anda masukkan, itu akan muncul lagi dan lagi. </font><font style="vertical-align: inherit;">Faktanya adalah bahwa nilai yang dimasukkan tidak akan menimpa nilai login / kata sandi yang ditentukan dalam URL. </font><font style="vertical-align: inherit;">Artinya, alih-alih nilai yang dimasukkan, banyak tidak ada: tidak ada yang akan pergi ke server setiap kali. </font><font style="vertical-align: inherit;">Dan untuk masuk dengan nama yang berbeda, pengguna harus mengklik batal, pergi ke halaman awal (http: //mysite.com/) dan masukkan login / kata sandi baru di sana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bengkok? </font><font style="vertical-align: inherit;">Namun sayang, tidak ada solusi lain</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Chrome (79.0.3945.88)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk Chrome, metode ambil berfungsi dengan baik. </font><font style="vertical-align: inherit;">Tetapi XMLHttpRequest tidak berfungsi (((Cache tidak diatur ulang, dan logging tidak terjadi. Selain itu, saya mencoba mengatur login / kata sandi sebagai parameter untuk metode terbuka dan pengaturan header).</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/chrome/i</span>.test(<span class="hljs-built_in">window</span>.navigator.userAgent)) {<font></font>
    fetch(url401, {<font></font>
      <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">'Basic '</span> + btoa(<span class="hljs-string">'none:none'</span>),
        <span class="hljs-string">'X-Requested-With'</span>: <span class="hljs-string">'XMLHttpRequest'</span><font></font>
      }<font></font>
    }).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-built_in">window</span>.location.assign(url);<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-built_in">console</span>.error(err));<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membuat permintaan pengambilan ke halaman 401 dengan nama pengguna / kata sandi yang jelas salah, kami mendapatkan respons 401 dari server, browser mem-flush cache-nya. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PENTING! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server TIDAK boleh mengembalikan header </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWW-Authenticate</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jika tidak, browser akan mengambil kendali, dan pengalihan dari halaman 401 tidak akan pernah terjadi. </font><font style="vertical-align: inherit;">Secara konvensi, server tidak boleh mengembalikan header ini jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-Requested-With: XMLHttpRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ditentukan dalam permintaan </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Oleh karena itu, tajuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-Diminta-Dengan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> telah ditambahkan ke permintaan </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari (12)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk Safari, situasinya justru sebaliknya: XMLHttpRequest berfungsi, tetapi pengambilan tidak berfungsi</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();<font></font>
    xhr.open(<span class="hljs-string">"GET"</span>, url401, <span class="hljs-literal">true</span>, <span class="hljs-string">'none'</span>, <span class="hljs-string">'none'</span>);<font></font>
    xhr.setRequestHeader(<span class="hljs-string">'X-Requested-With'</span>, <span class="hljs-string">'XMLHttpRequest'</span>);<font></font>
    xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
      <span class="hljs-built_in">console</span>.error(err);<font></font>
    };<font></font>
    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-built_in">window</span>.location.assign(url);<font></font>
    };<font></font>
    xhr.send()<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tindakannya sama seperti di Chrome, hanya melalui XMLHttpRequest </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harus bekerja untuk versi Safari 6+. </font><font style="vertical-align: inherit;">Versi sebelumnya memiliki bug sendiri. </font><font style="vertical-align: inherit;">Secara khusus, misalnya, dalam versi dari 5.1, dengan setiap pengalihan, browser secara paksa meminta kembali otorisasi, itulah sebabnya otorisasi dengan pengalihan ke halaman akhir pada prinsipnya tidak bekerja. </font><font style="vertical-align: inherit;">Dan dalam versi sebelum 5.0, logging tidak berfungsi.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488376/index.html">Ketika prinsip "ke neraka dengan segalanya, ambil dan lakukan itu!" tidak bekerja: catatan penunda</a></li>
<li><a href="../id488378/index.html">Secara singkat tentang penamaan di JS</a></li>
<li><a href="../id488380/index.html">Awal termudah dalam STM melalui "satu tempat"</a></li>
<li><a href="../id488382/index.html">Saya menambahkan penundaan 3-25 detik ke situs yang saya kunjungi</a></li>
<li><a href="../id488386/index.html">Kasus untuk menerapkan alat analisis anomali jaringan: serangan melalui plug-in browser</a></li>
<li><a href="../id488390/index.html">Cara membuat teman bot Telegram dengan OpenId Connect</a></li>
<li><a href="../id488392/index.html">Gambar yang siap produksi untuk k8s</a></li>
<li><a href="../id488404/index.html">Game yang layak ditunggu di tahun 2020</a></li>
<li><a href="../id488406/index.html">IPv6 - Anda salah melakukannya</a></li>
<li><a href="../id488408/index.html">STM32 Ethernet-RS485 IoT Gateway</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>