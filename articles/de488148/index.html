<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœï¸ ğŸ¬ ğŸ‘©ğŸ¿ HighLoad ++, Mikhail Raichenko (ManyChat): Fast ohne Magie oder wie einfach es ist, Terabit-Videostreams zu verbreiten ğŸ˜› ğŸ§ ğŸ¥¡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die nÃ¤chste HighLoad ++ - Konferenz findet am 6. und 7. April 2020 in St. Petersburg statt. Details und Tickets hier . HighLoad ++ Moskau 2018. Halle ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Raichenko (ManyChat): Fast ohne Magie oder wie einfach es ist, Terabit-Videostreams zu verbreiten</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/488148/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die nÃ¤chste HighLoad ++ - Konferenz findet am 6. und 7. April 2020 in St. Petersburg statt. </font><font style="vertical-align: inherit;">Details und Tickets </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">HighLoad ++ Moskau 2018. Halle â€Delhi + Kalkuttaâ€œ. </font><font style="vertical-align: inherit;">8. November, 14 Uhr </font><font style="vertical-align: inherit;">Abstracts und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrÃ¤sentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/ji/ba/ymjiba---vkcs5ibbqbk9kcz8ny.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich arbeite im VKontakte-Team und entwickle ein VideoÃ¼bertragungssystem. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dem Bericht werde ich die Merkmale der Entwicklung des Backends, die Entwicklung unseres Systems und die technischen LÃ¶sungen, zu denen wir gekommen sind, erlÃ¤utern:â€¨</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie wir das Video-Backend gemacht haben und wie der Evolutionsprozess ist;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Auswirkungen geschÃ¤ftlicher und betrieblicher Anforderungen auf die Architektur;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Warten" und "Versuchen Sie es erneut" schlagen fehl.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie die einfachsten Aufgaben durch die Anzahl der Benutzer kompliziert werden;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie man die Latenz ohne UDP reduziert;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir fÃ¼hren 2 Mal am Tag Stresstests durch oder was Clover uns dabei geholfen hat.</font></font></li>
</ul><a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Raichenko (im Folgenden - MR):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ein kleiner Ausflug. </font><font style="vertical-align: inherit;">Ich erzÃ¤hle Ihnen von den Leuten, die uns streamen, vom Live (Live), von den Plattformen, auf denen wir den Videostream erhalten und die wir vertreiben. </font><font style="vertical-align: inherit;">Am Ende werde ich Ã¼ber die aktuelle Architektur von Live sprechen, Ã¼ber ihre EinschrÃ¤nkungen und FÃ¤higkeiten sowie darÃ¼ber, wie die aktuelle Architektur einen Effekt wie "Clover" Ã¼berstanden hat.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/bm/lt/_hbmlt0c2ek74zfr89jdff3wtsw.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ãœber Live-Ãœbertragungen. </font><font style="vertical-align: inherit;">BerichtsÃ¼bersicht</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZunÃ¤chst werde ich ein wenig Ã¼ber die Live-Ãœbertragungen und Streamer selbst sprechen und uns Videoinhalte senden, die wir anderen Zuschauern zeigen.</font></font></li>
<li>         .    ?     ,     , , ,   -  - , - , .   ,        :   ,  â€“ .</li>
<li>    . ,      .     .     ,      ,     .</li>
<li>  ,     ,   .   ,         .  ,   ,   ,  , ,   2014-2015 .     ,      .</li>
<li>       .  ,                    .</li>
<li>,    .          ,    . ,    .</li>
<li>    ,    .      .</li>
<li>  ,    ,      Â«Â»,    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/lz/mm/jw/lzmmjwth6qvdlryupzhegpftal0.jpeg"><br>
<br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Rundfunkdienste sehen </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dt/2r/va/dt2rvaddozkmjrcp-1ojlaixmr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ungefÃ¤hr </font><font style="vertical-align: inherit;">so aus: </font><font style="vertical-align: inherit;">Wir haben einen Streamer, er sendet einen RTMP-Stream an uns und wir zeigen das Publikum - nichts Ãœberraschendes, nichts ÃœbernatÃ¼rliches. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ee/fx/kq/eefxkq8vknyi57vz-y-_ekw5pd0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Woher kommt der Videostream? Eine wichtige Verkehrsquelle fÃ¼r uns ist unsere mobile Anwendung VKlife. Was ist gut an ihm? Darin kÃ¶nnen wir vollstÃ¤ndig steuern, wie wir das Video codieren. Wir kÃ¶nnen auf Client-Seite viele Optimierungen vornehmen, um sie spÃ¤ter mit minimalen VerzÃ¶gerungen unseren Zuschauern zu zeigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den Minuspunkten: Mobile Anwendungen arbeiten Ã¼ber Netzwerken. Es kann sich um 3G handeln ... In jedem Fall handelt es sich fast immer um Mobilfunknetze, die einige VerzÃ¶gerungen verursachen. Sie mÃ¼ssen die Daten auf der Anwendungsseite zusÃ¤tzlich puffern, damit der Stream so reibungslos wie mÃ¶glich ausgefÃ¼hrt wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite Quelle sind Streamer mit OBS, Wirecast oder solche, die von anderen Desktopanwendungen streamen. </font><font style="vertical-align: inherit;">Dies ist ein ziemlich groÃŸes Publikum. </font><font style="vertical-align: inherit;">Manchmal sind dies Seminare, manchmal - Spiel-Streams (es gibt besonders viele davon aus solchen Anwendungen). </font><font style="vertical-align: inherit;">Positiv zu vermerken ist, dass es nur wenige solcher Anwendungen gibt. Wir kÃ¶nnen unseren Streamern gute Tuning-Empfehlungen geben. </font><font style="vertical-align: inherit;">Aber gleichzeitig gibt es viele Einstellungen und senden nicht ganz den Stream, den wir wollen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die dritte Kategorie ist der RTMP-Stream von Medienservern. </font><font style="vertical-align: inherit;">Dies kÃ¶nnen sehr kleine Medienserver sein, dh ein Heimformat: Eine Person Ã¼bertrÃ¤gt einen Blick auf die StraÃŸe oder etwas anderes. </font><font style="vertical-align: inherit;">Oder ganz ernsthafte Sendungen unserer Partner: Es kann alles geben, es gibt nicht sehr viele solcher Streams, aber im Grunde sind sie fÃ¼r uns sehr wichtig.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wer passt auf?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auch dies ist eine mobile Anwendung - hier ist alles klar. Das grÃ¶ÃŸte Problem ist die Netzwerklatenz. Von den Profis: Wir kÃ¶nnen den Player anpassen - es ist praktisch fÃ¼r uns, gut, aber nicht Ã¼berall stellt sich heraus, dass es 100% ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webplayer bei vk.com. Auch hier ist alles einfach - es ist ein normaler Web-Player, den Sie Ã¶ffnen kÃ¶nnen, um ihn anzusehen. Ein ausreichend groÃŸes Publikum bei vk.com, viele Zuschauer in den Sendungen. Einige Sendungen hÃ¤ngen in unserem Abschnitt â€Videoâ€œ - es kÃ¶nnen Zehntausende (manchmal ohne PR) sein, insbesondere wenn es sich um interessante Inhalte handelt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dementsprechend sind die KanÃ¤le groÃŸ genug fÃ¼r Zuschauer, die auf einem Web-Player sitzen. Daher gibt es viel Verkehr, auch fÃ¼r eine Sendung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der dritte ist der VKontakte-Webplayer auf einer Website eines Drittanbieters. </font><font style="vertical-align: inherit;">Sie kÃ¶nnen mit dem Streaming von allem beginnen, was Sie mÃ¶chten, und einen VKontakte-Webplayer an Ihre Website hÃ¤ngen. </font><font style="vertical-align: inherit;">Sie kÃ¶nnen unser Partner werden, wenn Sie interessante Inhalte haben: Sie kÃ¶nnen sie selbst aufhÃ¤ngen, Sie kÃ¶nnen bei uns hÃ¤ngen - wie Sie mÃ¶chten. </font><font style="vertical-align: inherit;">Sie kÃ¶nnen Ihre Sendungen auf diese Weise organisieren, und alles wird funktionieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vergleich mit Videoanrufen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Videoanrufen wird eine gewisse Bildverzerrung vergeben. Videoanrufe sind einfacher: Wir kÃ¶nnen das Bild erheblich verschlechtern, mÃ¼ssen aber gleichzeitig eine sehr gute Latenz aufrechterhalten. Mit einer langen VerzÃ¶gerung wird es absolut unmÃ¶glich sein, den Dienst zu nutzen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Sendungen in diesem Sinne ist es ein wenig umgekehrt: Wir mÃ¼ssen eine hohe BildqualitÃ¤t beibehalten, kÃ¶nnen aber gleichzeitig die Latenz aufgrund vieler Faktoren erhÃ¶hen. Zum Beispiel puffert der Player den Fluss auf die eine oder andere Weise (es kann eine Sekunde sein, zwei, um beispielsweise die Verschlechterung des Netzwerks zu Ã¼berstehen), daher benÃ¶tigt er in den meisten FÃ¤llen keine zweiten MillisekundenverzÃ¶gerungen. Sie kÃ¶nnen danach streben, aber Essen ist keine Voraussetzung.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j0/7o/o6/j07oo6ceqiizh_lzdgjsgvgfwtq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei gewÃ¶hnlichen Videos ist die Situation genau umgekehrt. </font><font style="vertical-align: inherit;">Wir brauchen sehr gute QualitÃ¤t. </font><font style="vertical-align: inherit;">Gleichzeitig ist es wÃ¼nschenswert, die VideogrÃ¶ÃŸe, das VerhÃ¤ltnis von Bitrate und QualitÃ¤t zu minimieren, um mit minimalem Durchfluss die beste LÃ¶sung zu erzielen. </font><font style="vertical-align: inherit;">Von den Profis: Wir sind nicht zeitlich begrenzt: Zum Zeitpunkt des Herunterladens des Videos haben wir genug Zeit, um das Video zu optimieren, zu sehen, wie es am besten komprimiert wird, etwas zu tun, es bei Bedarf in die Caches zu ziehen - im Allgemeinen ist alles genug OK. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/r-/cc/jfr-cco9dozhxgqqnuw57opkqjk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Leben ist die Situation wieder umgekehrt: Wir haben sehr wenig Zeit fÃ¼r die Transcodierung. </font><font style="vertical-align: inherit;">Gleichzeitig gibt es nur wenige MÃ¶glichkeiten, aber es gibt keine Erwartungen fÃ¼r die Sendung. </font><font style="vertical-align: inherit;">Das Publikum wird uns vergeben, wenn wir UnterstÃ¼tzung haben oder die QualitÃ¤t nicht sehr gut ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sehr erste Version</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wird durchaus erwartet: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/gt/bw/3fgtbwzvl3uf680sfzsf8kjette.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich ist es etwas anders: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/9r/zu/vu9rzujgkidpvrb66qzgbvapljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Streamer - Medienserver - Cache-Level - Viewer". </font><font style="vertical-align: inherit;">Im Prinzip kÃ¶nnen Sie mit dieser Version sehr stark skalieren. </font><font style="vertical-align: inherit;">Ich wÃ¼rde sagen, dass es bereits Zehntausenden von Zuschauern standhalten sollte. </font><font style="vertical-align: inherit;">Es hat andere Nachteile ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie sich beispielsweise diese Schaltung ansehen (vorherige Folie), kÃ¶nnen Sie feststellen, dass sie nicht fehlertolerant ist. </font><font style="vertical-align: inherit;">Wir mÃ¼ssen mit dem Medienserver raten, um das Publikum gut auszugleichen. </font><font style="vertical-align: inherit;">Wir kÃ¶nnen nicht viele Caches auf jedem Server hÃ¤ngen - es ist einfach teuer. </font><font style="vertical-align: inherit;">Daher haben wir nachgesehen und festgestellt, dass es einfach und klar ist, dass es einige MÃ¶glichkeiten zur Skalierung gibt, aber offensichtlich fehlt etwas ... Und wir haben begonnen, Anforderungen zu formulieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastrukturanforderungen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist wichtig?</font></font><br>
<br>
<ul>
<li> .     , ,    .            (       ).       (,  ).</li>
<li>.     : -,    (,    )      ; -,     â€“      ,    ,       .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lieferung in die Regionen. </font><font style="vertical-align: inherit;">Auch ein wichtiger Punkt! </font><font style="vertical-align: inherit;">Es ist dumm, den gesamten Videoinhalt von Petersburg oder Moskau nach Nowosibirsk, Jekaterinburg oder sogar von St. Petersburg nach Moskau zu ziehen. </font><font style="vertical-align: inherit;">Dies ist nicht sehr gut, da die NetzwerkverzÃ¶gerung lang sein wird - es wird VerzÃ¶gerungen geben, alles wird verzÃ¶gert, und dies ist nicht gut. </font><font style="vertical-align: inherit;">Daher muss unsere Infrastruktur berÃ¼cksichtigen, dass wir Inhalte an die Regionen liefern.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bequeme Bedienung und Ãœberwachung. </font><font style="vertical-align: inherit;">Eine wichtige Eigenschaft. </font><font style="vertical-align: inherit;">Da das System groÃŸ ist und viele Betrachter vorhanden sind, ist es wichtig, bei Problemen rechtzeitig Warnungen an Administratoren zu senden, einschlieÃŸlich der Ãœberwachung von Produkt- und technischen Metriken.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/km/n1/e_/kmn1e_0ii74m9xilh_5rsic9l5a.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie sieht die Broadcast-Infrastruktur jetzt aus?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis kamen wir zu einer ziemlich einfachen, aber effektiven Infrastruktur ...</font></font><br>
<br>
<ul>
<li> â€“ ,       ( ,  ).   RTMP-,    .        ,  .</li>
<li> ,      ,     ,  ,   .       .  ,   ,   ,   â€“ : , -,  (. .       ); -,     .</li>
<li>      .     â€“    ,   .        ,    ,    .      ,         (    ,  ).</li>
<li>         ,         (edge-).     ,  .    !</li>
<li>   â€“  edge-,      ,   .   :      ,   â€“    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/2e/cu/qp/2ecuqpdeldwtxd6qjyi-x4q0_ke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interessant? </font><font style="vertical-align: inherit;">Balancieren! </font><font style="vertical-align: inherit;">In diesem Schema wÃ¤hlen wir Balancing und versuchen, Zuschauer, die denselben Stream sehen, an jeden Edgeserver zu senden. </font><font style="vertical-align: inherit;">Die Cache-LokalitÃ¤t ist hier sehr wichtig, da es viele Edgeserver geben kann. </font><font style="vertical-align: inherit;">und wenn wir nicht sowohl die temporÃ¤re als auch die LokalitÃ¤t des Caches aus der Sicht des Streams beobachten, werden wir die innere Schicht Ã¼berladen. </font><font style="vertical-align: inherit;">Das wÃ¼rde uns auch nicht gefallen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher gleichen wir uns folgendermaÃŸen aus: Wir wÃ¤hlen einen bestimmten Edgeserver fÃ¼r die Region aus, an die wir Viewer senden, und senden, bis wir verstehen, dass eine gewisse FÃ¼llung aufgetreten ist und an einen anderen Server gesendet werden sollte. </font><font style="vertical-align: inherit;">Die Schaltung ist einfach und arbeitet sehr zuverlÃ¤ssig. </font><font style="vertical-align: inherit;">NatÃ¼rlich wÃ¤hlen Sie fÃ¼r verschiedene Streams eine andere Sequenz von Edgeservern (die Reihenfolge, in der wir Zuschauer aussenden). </font><font style="vertical-align: inherit;">Dementsprechend funktioniert das Auswuchten ganz einfach.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir geben dem Client auch einen Link zu einem verfÃ¼gbaren Edgeserver. </font><font style="vertical-align: inherit;">Dies geschieht, damit wir bei einem Ausfall des Edgeservers den Viewer auf einen anderen umleiten kÃ¶nnen. </font><font style="vertical-align: inherit;">Das heiÃŸt, wenn der Zuschauer die Sendung sieht, erhÃ¤lt er alle paar Sekunden eine Verbindung zum gewÃ¼nschten Server. </font><font style="vertical-align: inherit;">Wenn er versteht, dass die Verbindung unterschiedlich sein muss, wechselt er (der Player wechselt) und sieht sich die Sendung weiterhin von einem anderen Server an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere wichtige Rolle von Edgeservern ist der Schutz von Inhalten. </font><font style="vertical-align: inherit;">Der gesamte Inhaltsschutz findet im Wesentlichen dort statt. </font><font style="vertical-align: inherit;">DafÃ¼r haben wir ein eigenes Nginx-Modul. </font><font style="vertical-align: inherit;">Es ist etwas Ã¤hnlich wie Security Link.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skalieren und Auswuchten</font></font></h3><br>
<ul>
<li>   . ,        :     ,       .          edge-,        .     .     .    â€¦   ,     â€“    ,  --    â€“ ,  â€“ , , ,   â€“  !   â€“        .</li>
<li>      .  ,  ,         ,    ,       :     .       (   )    ,    â€“   ,   . ,    ,     ,      edge-.</li>
<li>   ,   ,       ,     .</li>
</ul><br>
<img src="https://habrastorage.org/webt/19/nj/i8/19nji8vwkh_kjrrsm9d698hf5ji.jpeg"><br>
<br>
<h3>   ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eines der Hauptprotokolle war RTMP (nicht nur zur Eingabe, sondern auch zur Verteilung von Inhalten). Der Hauptvorteil ist die geringe Latenz. Es kann eine halbe Sekunde, eine Sekunde, zwei Sekunden sein. TatsÃ¤chlich enden die Vorteile dort ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u7/fv/al/u7fvaloyunlxmyavp5rjemer4sw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Streaming-Protokoll ist schwer zu Ã¼berwachen - es ist in gewissem Sinne geschlossen, obwohl es eine Spezifikation gibt. Der Flash Player funktioniert nicht mehr (tatsÃ¤chlich ist es â€schon allesâ€œ). BenÃ¶tigen Sie UnterstÃ¼tzung auf CDN-Ebene? Sie benÃ¶tigen spezielle Nginx-Module oder Ihre eigene Software, um den Stream normal zu Ã¼bertragen. Es gibt auch einige Schwierigkeiten mit mobilen Clients. StandardmÃ¤ÃŸig wird es in mobilen Clients nur sehr schlecht unterstÃ¼tzt - spezielle Verbesserungen sind erforderlich, und all dies ist sehr schwierig.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das zweite Protokoll, das wir verwendet haben, ist HLS. </font><font style="vertical-align: inherit;">Es sieht ganz einfach aus: Es ist eine Textdatei, die sogenannte Indexdatei. </font><font style="vertical-align: inherit;">Es enthÃ¤lt Links zu Indexdateien mit unterschiedlichen Berechtigungen, und die Dateien selbst enthalten Links zu Mediensegmenten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w-/hl/vf/w-hlvfylbcsu1n6ksqlv7uy5e5a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie ist er gut </font><font style="vertical-align: inherit;">Es ist sehr einfach, obwohl es ein bisschen alt ist. </font><font style="vertical-align: inherit;">Sie kÃ¶nnen CDN verwenden, dh Sie benÃ¶tigen nur nginx, um das HLS-Protokoll zu verteilen. </font><font style="vertical-align: inherit;">Es ist in Bezug auf die Ãœberwachung verstÃ¤ndlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sind seine Vorteile:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einfache Bedienung - nginx als Proxyserver;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist einfach, Metriken zu Ã¼berwachen und zu erfassen (es reicht aus, dass Sie ungefÃ¤hr das Ã¼berwachen, was Sie auf Ihrer Website Ã¼berwachen).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt ist dieses Protokoll das wichtigste fÃ¼r die Bereitstellung von Inhalten.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Signifikantes Minus:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hohe Latenz.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/fa/ko/2_/fako2_ysvwvhaguijmddcna20eu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die HLS-Latenz ist tatsÃ¤chlich im Protokoll selbst verschachtelt. </font><font style="vertical-align: inherit;">Da eine lange Pufferzeit erforderlich ist, muss der Player mindestens warten, wenn ein Block geladen ist. In guter Weise muss er jedoch warten, bis zwei BlÃ¶cke (zwei Mediensegmente) geladen sind. Andernfalls wird der Client im Falle einer VerzÃ¶gerung vom Player geladen, was sich nicht sehr gut auswirkt Benutzererfahrung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Punkt, der eine VerzÃ¶gerung bei HLS verursacht, ist das Caching. </font><font style="vertical-align: inherit;">Die Wiedergabeliste wird auf der inneren Ebene und auf den Edgeservern zwischengespeichert. </font><font style="vertical-align: inherit;">Selbst wenn wir relativ gesehen eine Sekunde oder eine halbe Sekunde zwischenspeichern, ist dies ungefÃ¤hr plus 2-3 Sekunden VerzÃ¶gerung. </font><font style="vertical-align: inherit;">Insgesamt stellt sich heraus, dass es 12 bis 18 Sekunden sind - das ist nicht sehr angenehm, offensichtlich ist es besser.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLS verbessern</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit diesen Gedanken begannen wir, HLS zu verbessern. Wir haben es auf ziemlich einfache Weise verbessert: Geben wir das letzte, noch nicht aufgezeichnete Mediensegment der Wiedergabeliste etwas frÃ¼her an. Das heiÃŸt, sobald wir mit dem Schreiben des letzten Mediensegments begonnen haben, geben wir es sofort in der Wiedergabeliste bekannt. Was passiert gerade? .. Die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pufferzeit in den Spielern wird reduziert. Der Spieler glaubt, dass er bereits alles heruntergeladen hat, und beginnt ruhig mit dem Herunterladen der gewÃ¼nschten Segmente. Auf diese Weise â€betrÃ¼genâ€œ wir den Spieler ein wenig, aber wenn wir den â€Stahlâ€œ (Lasten im Spieler) gut Ã¼berwachen, macht uns das keine Angst - wir kÃ¶nnen aufhÃ¶ren, das Segment im Voraus zu geben, und alles wird wieder normal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Punkt: Wir gewinnen insgesamt ca. 5-8 Sekunden. Woher kommen sie? Diese Segmentzeit betrÃ¤gt 2 bis 4 Sekunden pro Segment plus der Zeit zum Zwischenspeichern der Wiedergabeliste (dies sind weitere 2-3 Sekunden). DarÃ¼ber hinaus nimmt unsere VerzÃ¶gerung erheblich ab. Die VerzÃ¶gerung wird von 12-15 Sekunden auf 5-7 Sekunden reduziert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist sonst noch gut an diesem Ansatz? Es ist tatsÃ¤chlich kostenlos! Wir mÃ¼ssen nur prÃ¼fen, ob die Spieler mit diesem Ansatz kompatibel sind. Diejenigen, die nicht kompatibel sind, senden wir an die alten URLs und kompatible Player an die neuen URLs. Wir mÃ¼ssen keine alten Clients aktualisieren, die dies unterstÃ¼tzen, was ebenfalls wichtig ist. Wir mÃ¼ssen die Player in mobilen Clients nicht Ã¤ndern oder freigeben. Wir mÃ¼ssen keinen Web-Player entwickeln. Es sieht gut genug aus!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0f/gm/tt/0fgmttjysv2w8rg8bmzdgzcdtz4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den Minuspunkten - die Notwendigkeit, den eingehenden Videostream zu steuern. </font><font style="vertical-align: inherit;">Im Fall eines mobilen Clients kÃ¶nnen wir dies ganz einfach tun (wenn der Stream von einem mobilen Client stammt) oder ohne Fehler transkodieren, da der Player wissen muss, wie lange es fÃ¼r ein Mediensegment dauert. </font><font style="vertical-align: inherit;">Und da wir es ankÃ¼ndigen, bevor es tatsÃ¤chlich aufgenommen wird, mÃ¼ssen wir wissen, wie viel Zeit es dauern wird, wenn wir es aufnehmen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QualitÃ¤tsmetriken</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somit haben wir HLS verbessert. </font><font style="vertical-align: inherit;">Jetzt mÃ¶chte ich sagen, wie wir Ã¼berwachen und welche QualitÃ¤tsmetriken wir aufnehmen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3h/_y/iz/3h_yizx3clxbb18dzi-urr-oylq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine der wichtigsten QualitÃ¤tsmetriken ist die Startzeit. </font><font style="vertical-align: inherit;">Im Idealfall scrollen Sie vor der Ãœbertragung durch den mobilen Client, drÃ¼cken die Taste und es wird sofort gestartet. </font><font style="vertical-align: inherit;">Es wÃ¤re ideal, wenn es vor dem DrÃ¼cken der Taste startet, aber leider nur, wenn Sie drÃ¼cken.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Punkt ist die SignalverzÃ¶gerung. Wir glauben, dass ein paar Sekunden sehr gut sind, 10 Sekunden ertrÃ¤glich sind, 20-30 Sekunden sehr schlecht sind. Warum ist es wichtig? FÃ¼r Konzerte und einige Ã¶ffentliche Veranstaltungen ist dies beispielsweise eine absolut unwichtige Metrik. Es gibt kein Feedback. Wir zeigen nur den Stream - es ist besser, nicht zu verzÃ¶gern als eine leichte VerzÃ¶gerung. Und fÃ¼r einen Stream, in dem eine Art Konferenz stattfindet oder eine Person etwas erzÃ¤hlt und ihm Fragen stellt, wird dies wichtig, da sie in den Kommentaren viele Fragen stellt und ich mÃ¶chte, dass das Publikum so frÃ¼h wie mÃ¶glich Feedback erhÃ¤lt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere wichtige Metrik sind Pufferung und VerzÃ¶gerungen. </font><font style="vertical-align: inherit;">TatsÃ¤chlich ist diese Metrik nicht nur aus Sicht des Kunden und der QualitÃ¤t wichtig, sondern auch aus der Sicht, wie stark wir die Bereitstellung von HLS â€streckenâ€œ kÃ¶nnen und wie viel wir Daten von unseren Servern komprimieren kÃ¶nnen. </font><font style="vertical-align: inherit;">Daher Ã¼berwachen wir sowohl die durchschnittliche Pufferzeit in den Spielern als auch den â€Stahlâ€œ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Wahl der QualitÃ¤t bei den Spielern ist verstÃ¤ndlich: Unerwartete Ã„nderungen sind immer Ã¤rgerlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dementsprechend ist dies auch eine wichtige Metrik.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ãœberwachung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben viele Ãœberwachungsmetriken, aber hier habe ich die Metriken ausgewÃ¤hlt, die immer funktionieren, wenn etwas schief geht:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ir/wy/me/irwymelifaedclj13razr83a85i.jpeg"><br>
<br>
<ul>
<li>-,    .   -   ,    .  ,  â€“ ,              ( ,  â€“  ).</li>
<li> /     .  , ,  ,      ,        ,    .     .</li>
<li>  edge-.  ,       ,     edge-       .</li>
</ul><br>
<br>
<h3>  Â«Â»,       ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt erzÃ¤hle ich Ihnen, wie wir mit einer Anwendung wie "Player" umgegangen sind, als wir unsere Infrastruktur zum Senden eines Videostreams mit Fragen und Antworten verwendet haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clover ist ein Online-Quiz. Der Gastgeber sagt etwas, fragt: Fragen fallen heraus - Sie antworten. 12 Fragen, 10 Minuten des Spiels, am Ende - eine Art Preis. Was ist so kompliziert? Das ist Wachstum! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rechts ist dieses Diagramm: Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/i8/_e/hwi8_er_sdcw_gxczrgk3z41en0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peak [im Diagramm] ist die Belastung der Server in Bezug auf die API zum Zeitpunkt des Starts von â€Cloverâ€œ. Der Rest der Zeit ist der Ã¼bliche Sendungsstrom. Dies kann nicht mit der Anzahl der Zuschauer gleichgesetzt werden. Vielleicht ist dies die Anzahl der Anfragen und die Last.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist schwer: In 5 Minuten kamen eine Million Zuschauer auf dem Gipfel zu uns. </font><font style="vertical-align: inherit;">Sie beginnen, die Sendung anzusehen, sich zu registrieren, eine Aktion auszufÃ¼hren, ein Video anzufordern ... Es scheint ein sehr einfaches Spiel zu sein, aber dies geschieht in sehr kurzer Zeit (alle Aktionen, einschlieÃŸlich des letzten Spiels) - dies ergibt eine ziemlich hohe Belastung.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor welchen Fragen und Herausforderungen standen wir?</font></font></h3><br>
<img src="https://habrastorage.org/webt/pd/ci/xh/pdcixhln_tmsracssi9qfy5ra5y.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnelles Wachstum. </font><font style="vertical-align: inherit;">Manchmal waren es + 50% pro Woche. </font><font style="vertical-align: inherit;">Wenn Sie zum Beispiel am Mittwoch 200.000 Menschen haben, dann kÃ¶nnten es am Samstag oder Sonntag bereits 300 gewesen sein. Das ist viel! </font><font style="vertical-align: inherit;">Es treten Probleme auf, die zuvor nicht sichtbar waren.</font></font></li>
<li>    2   .       .      ,  .       ,  , ,          ,         ,    .<br>
 12         . ,    ,     ,    , ,    -      ,     ,  â€¦</li>
<li>      ,       .     , ,  200-300 ,         400-500.</li>
<li>- ,    ,   ,           3-5 .   ?    Â«Â»,    ,    ,         ,     .<br>
<br>
       (   3   ,   ),          ,       3-5 .    ?  â€“  ,  â€“     exponential backoff,        .<br>
<br>
  exponential on backoff:  â€“ ,       2 ,   4,  8.             backend-.</li>
</ul><br>
<h3>    Â«Â»?</h3><br>
<img src="https://habrastorage.org/webt/-h/c_/gn/-hc_gnjjd-m7ujstbxa9edwnoms.jpeg"><br>
<ul>
<li>-,         .      ,    â€“   .</li>
<li>   Â« Â».  ,     ,    ,      ,     Â«Â».      ,   , -,    ,  -,     .</li>
<li> ,         â€“   ,     Â«Â»    .      Â«Â».     ,  ,   ,    â€¦     â€“ . 10% Â«Â» â€“ , 10% Â«Â»  100  â€“  .</li>
<li> Â«Â»   ,     ,    Â«Â»      .       â€“     -  .    100    â€“  ,  1    15  â€“   .</li>
<li>   .  Â«Â»   , , ,  .   ,      ,     .</li>
<li>   .                   ,    .         ,   latency,    .</li>
<li>   .    â€“     ,       .</li>
<li>  Â«Â»       1           . ,  ,   .      .    ,     ,     .      .</li>
</ul><br>
<h3>  ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Architektur passt perfekt zu uns und ich kann sie nur empfehlen. HLS bleibt bei uns das Hauptprotokoll fÃ¼r mindestens die Website und mindestens das Sicherungsprotokoll fÃ¼r alles andere. Vielleicht wechseln wir zu MPEG-DASH. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verlassenes RTMP. Trotz der Tatsache, dass es eine geringere VerzÃ¶gerung gibt, haben wir beschlossen, das HLS zu optimieren. Ziehen Sie mÃ¶glicherweise andere Lieferfahrzeuge in Betracht, einschlieÃŸlich DASH als Alternative. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qz/ut/oq/qzutoqnu3adqhxx0rivblxx9izq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden das eingehende Gleichgewicht verbessern. Wir mÃ¶chten auch ein nahtloses Failover fÃ¼r den eingehenden Ausgleich durchfÃ¼hren, damit bei Problemen auf einem der Medienserver fÃ¼r den Client die Umschaltung vollstÃ¤ndig unsichtbar ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht entwickeln wir Liefersysteme vom Edgeserver zum Client. HÃ¶chstwahrscheinlich wird es eine Art UDP sein. Welches - wir denken jetzt und befinden uns in der Forschungsphase.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich ist das alles. </font><font style="vertical-align: inherit;">Danke an alle!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frage des Publikums (im Folgenden - A): - Vielen Dank fÃ¼r den Bericht! </font><font style="vertical-align: inherit;">Nur der Sprecher von Odnoklassniki sprach und er sagte, dass sie den Streamer, den Encoder, den Encoder neu schreiben mÃ¼ssten ... Verwenden Sie solche LÃ¶sungen oder die StandardlÃ¶sungen auf dem Markt (wie Harmonic usw.)? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1_/mt/qb/1_mtqbmuiapdtajkn5at3emzwtm.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Jetzt haben wir LÃ¶sungen von Drittanbietern. </font><font style="vertical-align: inherit;">Von den von uns verwendeten Open-Source-LÃ¶sungen hatten wir (lange Zeit) nginx, das RTMP-Modul. </font><font style="vertical-align: inherit;">Einerseits hat er uns gefallen, weil er ganz einfach gearbeitet hat. </font><font style="vertical-align: inherit;">Wir haben sehr lange gekÃ¤mpft, damit er stabil arbeitet. </font><font style="vertical-align: inherit;">Jetzt wechselt er von Nginx-RTMP zu seiner eigenen LÃ¶sung. </font><font style="vertical-align: inherit;">Wir denken jetzt mit einem Transcoder. </font><font style="vertical-align: inherit;">Der EmpfÃ¤nger, nÃ¤mlich der empfangende Teil, wurde ebenfalls von Nginx-RTMP in seine LÃ¶sung umgeschrieben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UND:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ich wollte eine Frage zum Schneiden von RTMP auf HLS stellen, aber so wie ich es verstehe, haben Sie bereits geantwortet ... Sagen Sie mir, sind Ihre LÃ¶sungen Open Source? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir erwÃ¤gen, es in Open Source zu verÃ¶ffentlichen. Wir mÃ¶chten es lieber verÃ¶ffentlichen, aber die Frage ist der Zeitpunkt der VerÃ¶ffentlichung in Open Source. Stellen Sie einfach die Quelle ins Internet - das reicht nicht aus. Sie mÃ¼ssen Ã¼berlegen, einige Beispiele fÃ¼r die Bereitstellung erstellen. Und zu welchem â€‹â€‹Zweck fragst du? MÃ¶chte benutzen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Weil ich auch auf Nginx-RTMP gestoÃŸen bin! Es wird, gelinde gesagt, sehr lange nicht unterstÃ¼tzt. Der Autor beantwortet nicht einmal bestimmte Fragen ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wenn Sie mÃ¶chten, kÃ¶nnen Sie an die Mail schreiben. FÃ¼r den Eigenbedarf geben? Wir kÃ¶nnen uns einigen. Wir haben wirklich vor, es zu Ã¶ffnen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UND:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Sie sagten auch, dass Sie von HLS zu DASH wechseln kÃ¶nnen. HLS passt nicht? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dies ist eine Frage darÃ¼ber, was wir kÃ¶nnen oder vielleicht nicht. Es hÃ¤ngt stark davon ab, worauf wir bei der Erforschung alternativer Ãœbermittlungsmethoden (d. H. UDP) eingehen werden. Wenn wir etwas â€vÃ¶lligâ€œ Gutes finden, werden wir HLS wahrscheinlich nicht berÃ¼hren. Wenn es scheint, dass MPEG-DASH komfortabler ist, verschieben wir es mÃ¶glicherweise. Es scheint nicht sehr schwierig zu sein, aber wir sind uns nicht sicher, ob es notwendig ist oder nicht. Die Synchronisation zwischen Streams, zwischen QualitÃ¤ten und anderen Dingen ist dort deutlich besser. Es gibt Pluspunkte. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In Bezug auf Warnungen. Sie haben darÃ¼ber gesprochen, dass wenn Streams nicht mehr gestreamt werden, dies sofort eine Warnung ist. Und Sie haben nichts UnabhÃ¤ngiges von Ihnen gefangen: Der Anbieter ist gefallen, Megafon ist gefallen, und die Leute haben aufgehÃ¶rt zu streamen? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Sagen wir einfach, dass etwas, das von uns unabhÃ¤ngig ist, im Grunde alle Arten von Feiertagen ist und so weiter. Ja das taten sie. Ja, das haben sie. Die Administratoren schauten - heute sind die Feiertage, der Rest der Merkmale ist in Ordnung - sie beruhigten sich. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und Ã¼ber Skalierung. Auf welcher Ebene skaliert es? Ich habe zum Beispiel nach einem Stream vom Telefon gefragt - erhalte ich sofort einen bestimmten Link mit dem richtigen Ascheserver? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ein Link wird sofort hergestellt und wechselt Sie bei Bedarf (wenn auf einem bestimmten Server Probleme auftreten). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xz/tn/rq/xztnrqvvbr73gu61lqgpvdt5c-e.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wer wechselt? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mobile Player oder Web Player. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Er wird den Stream neu starten oder was? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ein neuer Link wird zu ihm kommen, wo er live streamen soll. Er wird dorthin gehen und den Strom erneut fragen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UND:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Auf welcher Ebene haben Sie Caches? Und Wiedergabelisten und Chunks oder nur das? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und Playlists, Chunks! Es wird ein wenig anders zwischengespeichert, sowohl in Bezug auf die Zeit als auch in Bezug auf die RÃ¼ckkehr der Zeit, aber wir zwischenspeichern beide. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In Bezug auf die Schaffung von Ascheservern? Hatten Sie eine solche Situation, dass Sie 2 Millionen Zuschauer in einer Sendung sehen, keine Zeit fÃ¼r etwas haben und schnell einen Ascheserver abholen? Oder erhÃ¶hen Sie alles im Voraus mit einer Marge? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Herr:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Vielleicht war das nicht. Erstens ist der Bestand immer klein oder groÃŸ - es spielt keine Rolle. Zweitens kommt es nicht vor, dass eine Sendung plÃ¶tzlich sehr beliebt wird. Wir kÃ¶nnen die Anzahl der Zuschauer gut vorhersagen. GrundsÃ¤tzlich mÃ¼ssen wir uns anstrengen, um viele Menschen zu haben. Dementsprechend kÃ¶nnen wir die Anzahl der Zuschauer der Sendung anpassen, je nachdem, welche Anstrengungen unternommen werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sie sagten, dass Sie instrumentelle VerzÃ¶gerungen seitens des Spielers messen. Wie? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sehr einfach. In Chunks (in den Mediensegmenten) haben wir einen Zeitstempel im Namen des Mediensegments - im Player geben wir ihn einfach zurÃ¼ck. Wenn er Ã¼berhaupt nicht explizit ist, kehrt er zurÃ¼ck. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich erinnere mich, dass ich versucht habe, Peering auf WebRTC auszufÃ¼hren. Warum abgelehnt? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Herr:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Ich kann diese Frage nicht fÃ¼r dich beantworten - es ist ohne mich passiert." Ich kann nicht sagen, warum ich es versucht habe und ich kann nicht sagen, warum ich es abgelehnt habe. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In Bezug auf den EmpfÃ¤nger und den Medienserver. So wie ich es verstehe, hatten Sie frÃ¼her Nginx-RTMP, jetzt haben Sie sowohl dort als auch dort selbst erstellte LÃ¶sungen. TatsÃ¤chlich ist dies ein Medienserver, der andere Medienserver als Proxy verwendet, und diese befinden sich bereits im Cache und am Rand. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Also nicht wirklich. Dies ist eine selbst erstellte LÃ¶sung, die sich jedoch sowohl in Bezug auf einen Medienserver als auch in Bezug auf einen EmpfÃ¤nger unterscheidet. Nginx-RTMP - es war eine Art Harvester, der beides konnte. Unsere InnenrÃ¤ume des EmpfÃ¤ngers und des Medienservers sind sehr unterschiedlich - sowohl nach Code als auch durchgehend. Das einzige, was sie verbindet, ist die RTMP-Verarbeitung. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - BezÃ¼glich des Ausgleichs zwischen den Kanten. Wie kommt es dazu?</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir messen den Verkehr und senden ihn an den gewÃ¼nschten Server. Ich habe die Frage nicht ein wenig verstanden ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich erklÃ¤re: Der Benutzer fordert eine Wiedergabeliste Ã¼ber den Player an. - Er gibt die relativen Pfade zu Manifesten und Chunks oder absoluten Pfaden zurÃ¼ck, z. B. nach IP oder Domain? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die Pfade sind relativ. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das heiÃŸt, es gibt keinen Ausgleich, wenn ein Stream von einem Benutzer angezeigt wird? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es passiert. Tricky genug. Wir kÃ¶nnen die 301. Umleitung verwenden, wenn wir den Server Ã¼berlasten. Wenn wir sehen, dass dort alles vÃ¶llig schlecht ist, kÃ¶nnen wir es fÃ¼r Segmente an einen anderen Server senden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aber es sollte in die Logik des Spielers eingebunden werden? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Herr:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Nein, nur dieser Teil sollte nicht vernÃ¤ht werden. 301. Weiterleitung! Der Spieler sollte einfach in der Lage sein, den 301. Link zu verlassen. Wir kÃ¶nnen es zum Zeitpunkt der Ãœberlastung von der Serverseite an einen anderen Server senden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das heiÃŸt, er fragt den Server und der Server gibt es ihm? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja. Dies ist nicht sehr gut, daher wird die Logik des Spielers verwendet, um Links auf den Fall eines Ausfalls eines der Server zu retweeten - dies ist bereits in der Logik des Spielers enthalten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und Sie haben nicht versucht, nicht relativ, sondern absolut zu arbeiten: Wenn Sie den Spieler auffordern, etwas zu zaubern, finden Sie heraus, wo Ressourcen vorhanden sind und wo nicht, und geben Sie bereits Wiedergabelisten mit einem bestimmten Server an? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Herr:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Eigentlich sieht es nach einer funktionierenden LÃ¶sung aus. </font><font style="vertical-align: inherit;">Wenn Sie dann gekommen wÃ¤ren, hÃ¤tten wir beide gewogen! </font><font style="vertical-align: inherit;">Die aktuelle LÃ¶sung funktioniert aber auch, sodass ich nicht wirklich von einer zur anderen springen mÃ¶chte, obwohl dies mÃ¶glicherweise auch wie eine funktionierende LÃ¶sung aussieht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sag mir, ist das irgendwie freundlich zu Multicast? </font><font style="vertical-align: inherit;">HLS, so wie ich es verstehe, absolut nichts ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In der aktuellen Implementierung haben wir wahrscheinlich nichts im System mit dem Multicast in Live. </font><font style="vertical-align: inherit;">Das Multicast-Konzept wird dort nicht berÃ¼cksichtigt. </font><font style="vertical-align: inherit;">Vielleicht gibt es irgendwo in den Tiefen der Admin-Magie etwas im Netzwerk, aber es ist vor allen verborgen und niemand weiÃŸ ...</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/va/s2/qrvas2mhyryhgck9t6n8ffc1pai.jpeg"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bA-Y_BfTZZY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Werbung :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank fÃ¼r Ihren Aufenthalt bei uns. GefÃ¤llt dir unser Artikel? MÃ¶chten Sie weitere interessante Materialien sehen? UnterstÃ¼tzen Sie uns, indem Sie eine Bestellung </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">aufgeben</font></a><font style="vertical-align: inherit;"> oder Ihren Freunden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud-basiertes VPS fÃ¼r Entwickler ab 4,99 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> empfehlen </font><font style="vertical-align: inherit;">, ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einzigartiges Analogon von Einstiegsservern, das von uns fÃ¼r Sie erfunden wurde: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ganze Wahrheit Ã¼ber VPS (KVM) E5-2697 v3 (6 Kerne) 10 GB DDR4 480 GB SSD 1 Gbit / s ab 19 $ oder wie teilt man den Server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verfÃ¼gbar). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2-mal gÃ¼nstiger im Equinix Tier IV-Rechenzentrum in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nur wir haben </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2,6 GHz 14C 64 GB DDR4 4 x 960 GB SSD 1 Gbit / s 100 TV von 199 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in den Niederlanden!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2,2 GHz 6C 128 GB DDR3 2x960 GB SSD 1 Gbit / s 100 TB - ab 99 US-Dollar! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wie Sie eine Infrastruktur aufbauen </font><font style="vertical-align: inherit;">Klasse C mit Dell R730xd E5-2650 v4-Servern fÃ¼r 9.000 Euro fÃ¼r einen Cent?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488136/index.html">Wie hat der Atlas-Roboter gelernt, akrobatische Stunts zu machen, die fÃ¼r einen normalen Menschen unertrÃ¤glich sind?</a></li>
<li><a href="../de488138/index.html">Kleine KapazitÃ¤tsmessungen (analoger kapazitiver Sensor)</a></li>
<li><a href="../de488140/index.html">Wie man das Leben mit Hilfe des Pareto-Gesetzes vereinfacht</a></li>
<li><a href="../de488142/index.html">Nachdenklich Avalonia</a></li>
<li><a href="../de488146/index.html">[Diskussion]: Sind IT-Ingenieure, sind IT-Ingenieure?</a></li>
<li><a href="../de488150/index.html">AntiquitÃ¤ten: ThinkPad X200 und Closed Source</a></li>
<li><a href="../de488152/index.html">Ein Prototyp eines Multiplayer-Spiels fÃ¼r 15 Uhr?</a></li>
<li><a href="../de488154/index.html">Wir schlÃ¼pfen in die Rolle des BÃ¼roleiters. Grundlegende Versorgungsalgorithmen</a></li>
<li><a href="../de488160/index.html">Windows Server 2019 vs. VMware-Snapshots mit Ruhezustand: eine elegante LÃ¶sung fÃ¼r das Problem</a></li>
<li><a href="../de488162/index.html">Je hÃ¶her die Bewertung, desto mehr Geld und umgekehrt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>