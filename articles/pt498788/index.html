<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèº üë©üèº‚Äçüé® üëØ Aprendendo um Mini Motor de Passo üïß üîã üèöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os motores de passo s√£o amplamente utilizados na ind√∫stria moderna e em produtos caseiros. Eles s√£o usados ‚Äã‚Äãonde √© necess√°rio garantir a precis√£o do ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Aprendendo um Mini Motor de Passo</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498788/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os motores de passo s√£o amplamente utilizados na ind√∫stria moderna e em produtos caseiros. Eles s√£o usados ‚Äã‚Äãonde √© necess√°rio garantir a precis√£o do posicionamento dos componentes mec√¢nicos, sem recorrer a feedback e medi√ß√µes precisas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje eu quero falar sobre um tipo especial de motores de passo - motores de passo em miniatura, que s√£o usados ‚Äã‚Äãna constru√ß√£o de sistemas √≥pticos. Vamos dar uma olhada em seu dispositivo e em como controlar esses motores min√∫sculos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/sz/_x/zhsz_xl6lm4btv11g953x7e2kwa.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um motor de passo √© um motor el√©trico sem escova (sem escova) com v√°rios enrolamentos (fases) localizados no estator e √≠m√£s (geralmente permanentes) no rotor. Aplicando tens√£o nos enrolamentos do estator, podemos fixar a posi√ß√£o do rotor e, aplicando tens√£o nos enrolamentos, podemos obter sucessivamente o movimento do rotor de uma posi√ß√£o para outra (etapa), e essa etapa tem um valor angular fixo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o vamos nos debru√ßar sobre a considera√ß√£o de cada tipo de motor de passo. Muito foi escrito sobre isso na rede e bem, por exemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quero falar sobre um tipo especial de motores de passo - motores de passo em miniatura, que s√£o usados ‚Äã‚Äãna constru√ß√£o de sistemas √≥pticos. </font><font style="vertical-align: inherit;">Essas crian√ßas est√£o dispon√≠veis para venda. </font><font style="vertical-align: inherit;">Mas na rede, especialmente em l√≠ngua russa, h√° muito pouca informa√ß√£o sobre esses motores. </font><font style="vertical-align: inherit;">Portanto, quando eu precisava us√°-los em meu projeto, tive que procurar informa√ß√µes e realizar algumas experi√™ncias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compartilharei os resultados de minhas pesquisas e experi√™ncias neste artigo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consideraremos o gerenciamento desses pequenos motores, a saber:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlador L293D + microcontrolador ATtiny44;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Driver TMC2208 + microcontrolador ATtiny44;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">microcontrolador ATtiny44 (sem driver).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, apenas o √∫ltimo ponto pode causar perguntas aqui. </font><font style="vertical-align: inherit;">Acredite, tamb√©m fiquei surpreso quando me deparei com um videoclipe ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui est√°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), onde o cara apenas pega e conecta diretamente o motor de passo aos pinos do microcontrolador! </font><font style="vertical-align: inherit;">Mas vamos falar sobre tudo em ordem.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conhecido</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, d√™ uma olhada na apar√™ncia do nosso her√≥i: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s9/6n/lu/s96nlurhh1cpirq8g8zrtv1t_t0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ele √© realmente muito pequeno! De acordo com o livro inteligente Petrenko S.F. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Motores piezoel√©tricos em instrumenta√ß√£o", motores eletromagn√©ticos menores, em princ√≠pio, √© imposs√≠vel criar ... isto √©, √© poss√≠vel, mas com uma diminui√ß√£o no di√¢metro do fio do qual os enrolamentos s√£o feitos, mais e mais energia √© dissipada como calor no ambiente, o que leva a uma diminui√ß√£o na efici√™ncia do motor e torna seu uso √© irracional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not√°vel, pode-se notar que seu eixo √© muito curto e possui uma ranhura especial para a instala√ß√£o da engrenagem ou alavanca. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dois enrolamentos s√£o claramente vis√≠veis, que s√£o cobertos com isolamento de cores diferentes. Portanto, nosso motor provavelmente pertence √† classe dos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motores de passo bipolares</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver como funciona: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/ds/2w/5vds2wkt6kjahi0m55emzq5ipmc.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acho que nosso conhecimento desses motores n√£o estar√° completo se n√£o percebermos o que est√° dentro dele. √â sempre interessante olhar dentro do mecanismo! N√£o √© assim?</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Na verdade, n√£o vimos nada incomum. O rotor √© magnetizado. N√£o h√° rolamentos em lugar algum, tudo est√° nas buchas. O cubo traseiro √© pressionado na carca√ßa do motor. A frente n√£o √© fixa por nada. Curiosamente, o corpo do motor foi montado por solda a ponto. Ent√£o a capa da frente teve que ser cortada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora nos voltamos para a quest√£o da conex√£o e suas caracter√≠sticas el√©tricas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certifique-se de que ele seja bipolar tocando os enrolamentos. Realmente bipolar, como na foto acima. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A resist√™ncia do enrolamento √© de cerca de 26 ohms</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , embora o vendedor tenha indicado 14 ohms.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A descri√ß√£o diz que a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tens√£o de alimenta√ß√£o √© de 5V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Embora todos saibamos que para um motor de passo, a corrente que seus enrolamentos consumir√£o √© importante. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos tentando nos conectar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experi√™ncia n¬∫ 1. </font><font style="vertical-align: inherit;">L293D + ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como sabemos, para controlar um motor de passo bipolar, √© necess√°rio n√£o apenas aplicar tens√£o aos dois enrolamentos na sequ√™ncia desejada, mas tamb√©m alterar a dire√ß√£o da corrente nesses enrolamentos e faz√™-lo independentemente um do outro. Para isso, cada enrolamento precisa de sua pr√≥pria ponte H. Para n√£o cerc√°-lo dos transistores, um chip L293D pronto foi usado. Outra das suas vantagens - o chip possui pinos especiais Enable1 e Enable2, que ativam e desativam cada ponte. Eles podem ser usados ‚Äã‚Äãpara fornecer um sinal PWM, portanto, √© poss√≠vel controlar a tens√£o de alimenta√ß√£o de cada ponte. Por que isso pode ser necess√°rio, veremos mais adiante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, o L293D pode alternar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tens√µes de at√© 36V e produzir at√© 1,2A por canal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que deve ser suficiente para alimentar os enrolamentos do nosso motor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, o diagrama: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ap/eu/sm/apeusmkkhcddqmhrdrmvwkpjbsk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As entradas de controle L293D s√£o conectadas √†s sa√≠das OC0A e OC0B, o que nos permitir√° enviar um sinal PWM para elas no futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iremos piscar o controlador atrav√©s do programador em circuito (n√£o mostrado no diagrama). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a apar√™ncia do circuito montado em uma placa de </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gx/87/jg/gx87jgsrgeuethu-dotn-_a-fsc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ensaio </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">E √© assim que nosso </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/so/xw/xrsoxwzgqmg1q80dx9dwecpcg68.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
piloto de </font><font style="vertical-align: inherit;">teste est√° localizado: </font><font style="vertical-align: inherit;">Agora voc√™ pode come√ßar a experimentar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calculamos a corrente que fluir√° atrav√©s dos enrolamentos do motor quando eles estiverem conectados a uma tens√£o de 5V: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I = U / R = 5V / 26Ohm = 190mA </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muito pequeno. Gostaria de saber quanto tempo ele pode aguentar uma corrente t√£o grande e n√£o superaquecer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inclu√≠mos um amper√≠metro e um volt√≠metro no circuito de um dos enrolamentos e medimos os valores correspondentes quando a energia √© fornecida a esse enrolamento atrav√©s do driver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando a tens√£o cai no enrolamento de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,56V, o amper√≠metro mostra uma corrente de 150mA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e √© claramente vis√≠vel como a magnitude da corrente come√ßa a cair durante o aquecimento dos enrolamentos. Note-se que n√£o √© t√£o quente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de se certificar de que a tens√£o de 5V do motor n√£o √© perigosa, tente torcer-os em dire√ß√µes diferentes. E agora, algumas palavras, falaremos sobre os modos de opera√ß√£o do motor de passo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isto √© muito bem dito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o repetiremos, mas lembre-se de que um motor de passo pode operar em tr√™s modos:</font></font><br>
<br>
<ul>
<li>           ,   ,       . </li>
<li>          ,  ,      ,     .</li>
<li>        ,     ,      ,   (   )    . ,  ,          ( , ,   ).   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar implementar os dois primeiros modos no chip L293D e, no modo micro-passo, deixaremos um driver especial do segundo experimento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo fonte do programa √© o seguinte:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo fonte WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     L293DD</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1 PB2 // OC0A (EN1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2 PA7 // OC0B (EN2)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1_value OCR0A</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2_value OCR0B</span><font></font>
<font></font>
<span class="hljs-comment">//       L293D</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN1 PA0 //  PORTA</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN2 PA1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN3 PB1 //  PORTB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN4 PB0</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4)));<font></font>
	<font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2)); <span class="hljs-comment">//   </span><font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1); <span class="hljs-comment">//    </span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2)));<font></font>
	<font></font>
	PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4))); <font></font>
	 <font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
  <font></font>
	<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2))); <font></font>
	<font></font>
	PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
    <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);  <font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1);<font></font>
  <font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2));<span class="hljs-comment">//2</span><font></font>
	<font></font>
	PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1);<font></font>
  <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<span class="hljs-comment">//3</span><font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
	<font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
  <font></font>
	<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<span class="hljs-comment">//4</span><font></font>
  <font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
    <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">stepper_OFF</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
	<span class="hljs-comment">//    ,       ,    </span><font></font>
	<font></font>
	PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2)));<font></font>
	<font></font>
	PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4)));<font></font>
	<font></font>
}<font></font>
<font></font>
unsigned <span class="hljs-keyword">char</span> step_counter = <span class="hljs-number">0</span>; <font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">L293D_step</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay, unsigned <span class="hljs-keyword">char</span> phase</span>)</span> { <span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//  ,      </span><font></font>
<font></font>
        <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//           </span><font></font>
	<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
				<span class="hljs-keyword">if</span>(step_counter&lt;<span class="hljs-number">3</span>) { step_counter++; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">0</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
				<span class="hljs-keyword">if</span>(step_counter&gt;<span class="hljs-number">0</span>) { step_counter--; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">3</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-keyword">switch</span>(phase) { <span class="hljs-comment">//     </span><font></font>
		<font></font>
		    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
			<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
    delay_millisecond(step_delay); <span class="hljs-comment">//       </span><font></font>
	<font></font>
	step_quantity--; <font></font>
	<font></font>
	} <font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PWM_init</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;PWM_1);<font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;PWM_2);<font></font>
<font></font>
    TCCR0A = (<span class="hljs-number">1</span>&lt;&lt;WGM01)|(<span class="hljs-number">1</span>&lt;&lt;WGM00)|(<span class="hljs-number">1</span>&lt;&lt;COM0A1)|(<span class="hljs-number">0</span>&lt;&lt;COM0A0)|(<span class="hljs-number">1</span>&lt;&lt;COM0B1)|(<span class="hljs-number">0</span>&lt;&lt;COM0B0); <span class="hljs-comment">//  FAST PWM,   </span><font></font>
	<font></font>
    TCCR0B = (<span class="hljs-number">0</span>&lt;&lt;WGM02)|(<span class="hljs-number">0</span>&lt;&lt;CS02)|(<span class="hljs-number">0</span>&lt;&lt;CS01)|(<span class="hljs-number">1</span>&lt;&lt;CS00); <span class="hljs-comment">//   8</span><font></font>
	<font></font>
    OCR0A = <span class="hljs-number">255</span>; <span class="hljs-comment">//    (0-255)</span><font></font>
<font></font>
    OCR0B = <span class="hljs-number">255</span>;<font></font>
<font></font>
} <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
	<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
	<font></font>
    PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
    delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <font></font>
	   <font></font>
	LED_ON;<font></font>
		<font></font>
        L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>); <span class="hljs-comment">//step( ,  F/B,   , / )</span><font></font>
		<font></font>
	<span class="hljs-comment">//stepper_OFF();</span><font></font>
		<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	LED_OFF;<font></font>
		<font></font>
	L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<font></font>
		<font></font>
	<span class="hljs-comment">//stepper_OFF();</span><font></font>
		<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		  <font></font>
    } <font></font>
<font></font>
} </code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo passo completo. </font><font style="vertical-align: inherit;">Fase √∫nica</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/_U7lQKinBe8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mecanismo d√° 16 passos por rota√ß√£o. </font><font style="vertical-align: inherit;">Al√©m disso, os passos para as duas fases n√£o t√™m o mesmo valor angular. </font><font style="vertical-align: inherit;">N√£o sei com o que est√° conectado. </font><font style="vertical-align: inherit;">Talvez o design do motor seja esse? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos a frequ√™ncia m√°xima de etapas que ele pode fornecer nesse modo sem perd√™-las. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O atraso m√≠nimo entre as etapas √© de 2 ms, o que significa 500 etapas / segundo. </font><font style="vertical-align: inherit;">Nada mal, s√£o 31 rpm = 1850 rpm.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo passo completo. </font><font style="vertical-align: inherit;">Duas fases</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/AGNc-i35tkI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que, neste caso, as etapas s√£o mais suaves, t√™m o mesmo tamanho (em qualquer caso, mais do que no caso anterior). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturalmente, neste caso, dois enrolamentos s√£o energizados simultaneamente e a transfer√™ncia de calor aumenta. </font><font style="vertical-align: inherit;">Depois de alguns segundos, o motor esquenta bastante, ent√£o parei o experimento. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que com a frequ√™ncia m√°xima de etapas? </font><font style="vertical-align: inherit;">500 etapas / segundo; </font><font style="vertical-align: inherit;">31 rpm = 1875 rpm. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se dizer que, para um motor de passo, √© bastante √°gil. </font><font style="vertical-align: inherit;">Isto √© devido ao pequeno n√∫mero de p√≥los magn√©ticos no rotor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s continuamos ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experi√™ncia n√∫mero 2. </font><font style="vertical-align: inherit;">TMC2208 + ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TMC2208 √© o nome de um chip de driver para controle de motores de passo bipolares, tamb√©m chamado de m√≥dulo, produzido para instala√ß√£o em impressoras 3D caseiras (e n√£o apenas) e com layout de pinos unificado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muito e lucidamente disse sobre este m√≥dulo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muito foi escrito na Internet sobre como instal√°-lo na sua impressora 3D, mas estamos interessados ‚Äã‚Äãem como conectar o m√≥dulo ao microcontrolador, ent√£o vamos entender. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As caracter√≠sticas do chip s√£o impressionantes (apenas pessoas impression√°veis):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tens√£o de alimenta√ß√£o da parte l√≥gica: 3-5V;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tens√£o de alimenta√ß√£o do motor 5.5-36V;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corrente de pico 2A;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajuste da corrente m√°xima do motor;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suporte √† interface UART para gerenciar e configurar registros internos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desligamento autom√°tico;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suporte para o modo de micro etapas do controle do motor at√© 1/16 de uma etapa.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/hy/4x/fg/hy4xfgf0clqt-j9hxilghfje85u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â muito simples de gerenciar, de fato, voc√™ precisa de apenas dois pinos do microcontrolador. </font><font style="vertical-align: inherit;">Um est√° conectado ao DIR - indicamos a dire√ß√£o de rota√ß√£o do motor, o outro est√° conectado ao STEP - quando um pulso √© aplicado, o microcircuito realiza as manipula√ß√µes necess√°rias com correntes e tens√µes nos enrolamentos do motor e d√° um passo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O diagrama de conex√£o ficar√° assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p6/7m/s1/p67ms10_2wbu6fdbxjmkcz7y5f8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, usei o pino EN para desligar o motor e por um longo tempo para n√£o manter os enrolamentos energizados.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo fonte WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     TMC2208</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR PB2</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN PA6</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP PA7</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN_OFF PORTA |=(1&lt;&lt;EN)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN_ON PORTA &amp;=(~(1&lt;&lt;EN))</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR_FOR PORTB |=(1&lt;&lt;DIR)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR_BACK PORTB &amp;=(~(1&lt;&lt;DIR))</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP_ON PORTA |=(1&lt;&lt;STP)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP_OFF PORTA &amp;=(~(1&lt;&lt;STP))</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TMS2208_STEP</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay</span>)</span> {<font></font>
<font></font>
    <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//  </span><font></font>
	<font></font>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:<font></font>
			DIR_FOR;	<font></font>
		<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:<font></font>
			DIR_BACK;	<font></font>
		<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
	}<font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//      </span><font></font>
	<font></font>
		STP_ON; <span class="hljs-comment">//   </span><font></font>
		<font></font>
		delay_microsecond(<span class="hljs-number">100</span>); <span class="hljs-comment">//   100</span><font></font>
		<font></font>
		STP_OFF;<font></font>
		<font></font>
		delay_millisecond(step_delay);<span class="hljs-comment">//   </span><font></font>
	<font></font>
	    step_quantity--;<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
<font></font>
        DDRB |=(<span class="hljs-number">1</span>&lt;&lt;DIR);<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;EN);<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;STP);<font></font>
	<font></font>
	PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <font></font>
	   <font></font>
	   LED_ON;<font></font>
	   <font></font>
	   EN_ON;<font></font>
	<font></font>
	   TMS2208_STEP(<span class="hljs-number">32</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">10</span>); <span class="hljs-comment">// TMS2208_STEP ( ,  F/B,   )</span><font></font>
	   <font></font>
	   delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	   <font></font>
	   LED_OFF;<font></font>
	   <font></font>
	   TMS2208_STEP(<span class="hljs-number">32</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">10</span>);<font></font>
	   <font></font>
	   delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	   <font></font>
	} <font></font>
<font></font>
}  </code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de iniciar tudo, voc√™ precisa pr√©-configurar o m√≥dulo. Primeiro, defina o modo microstep desejado. Em segundo lugar, defina a corrente m√°xima desejada do motor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com um microstep, tudo √© simples. Os pinos MS1 e MS2 s√£o respons√°veis ‚Äã‚Äãpor isso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/vf/ba/mrvfbaqfm3rvb_fkop2w28ybtiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observo que o microcircuito n√£o altera a tens√£o passo a passo, mas o faz "suavemente", mas como o microcircuito √© digital, a sa√≠da n√£o √© um sinal suave, mas um sinal com um pequeno passo, de acordo com a documenta√ß√£o, divide cada passo em 256 micro etapas. Isso foi feito para aumentar a suavidade da marcha, reduzir o ru√≠do do motor e, em teoria, n√£o deve permitir que a estrutura na qual est√° parafusado entre em resson√¢ncia. Em resumo, tudo para tornar a impressora 3D mais silenciosa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para definir a corrente do motor, √© necess√°rio medir a tens√£o no contato Vref, indicado na figura. O valor da tens√£o pode ser alterado usando um potenci√¥metro instalado ao lado do contato. A tens√£o no contato ser√° proporcional √† corrente do motor e a depend√™ncia ter√° a seguinte forma: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vref = I * 1,44; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosso </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motor precisa de cerca de 150mA, porque Vref = 0,216V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Instalamos ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entende-se que um aumento na corrente fornece o microcircuito aumentando a tens√£o no enrolamento. Portanto, voc√™ precisa garantir que essa tens√£o seja suficiente. Mas, acredito, 5V deve ser suficiente para esse pequeno motor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testaremos a opera√ß√£o do motor com v√°rios modos de micro passo e veremos o que acontece (a pausa entre micro passos √© de 10 ms):</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/smws8Omm5Gk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode notar que os movimentos do motor se tornaram mais suaves (em compara√ß√£o com o experimento anterior), no entanto, as 16 etapas caracter√≠sticas ainda s√£o observadas com muita clareza. </font><font style="vertical-align: inherit;">Bem ... aparentemente essa √© uma caracter√≠stica dos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">motores</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><b><font style="vertical-align: inherit;">passo com um rotor de √≠m√£ permanente</font></b><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m deve ser observado que o motor neste modo aquece quase tanto quanto no modo de passo completo com duas fases. </font><font style="vertical-align: inherit;">√â compreens√≠vel, os enrolamentos s√£o constantemente energizados, o calor est√° sendo gerado continuamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acredito que, para tais motores, o uso de um driver desse tipo e, na verdade, modos de micro passo, n√£o √© muito recomend√°vel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experi√™ncia n√∫mero 3. </font><font style="vertical-align: inherit;">Driver ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos retornar brevemente ao primeiro experimento e lembrar que as entradas EN1 e EN2 do chip do driver est√£o conectadas aos pinos OC0A e OC0B do microcontrolador. Isso significa que podemos enviar para l√° um sinal PWM gerado usando o temporizador TIMER0 e, assim, alterar a tens√£o aplicada aos enrolamentos do motor e regular a corrente que fluir√° atrav√©s deles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com a folha de dados do microcontrolador ATtiny44, a corrente m√°xima que um pino pode fornecer √© de apenas 40mA. Al√©m disso, n√£o √© indicado para que tipo de corrente (pulsante ou constante) essa caracter√≠stica. Est√° a√≠ e √© assim ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devo dizer que estou familiarizado com os microcontroladores ATMEL h√° mais de 7 anos. E nunca tive o desejo de verificar esta linha na folha de dados.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7g/-s/b3/7g-sb3h1t3qbhccp7kyvd0knqge.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez o fabricante seja apenas seguro e, de fato, possa distribuir mais, ou talvez seja realmente o m√°ximo que pode fornecer um pino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos descobrir. Mas primeiro voc√™ precisa descobrir em qual corrente m√≠nima o motor geralmente consegue girar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando o circuito do primeiro experimento, ajustamos o valor da corrente atrav√©s dos enrolamentos igual a 40 mA. Come√ßamos no modo de etapa completa com duas fases (pois o torque ser√° maior): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Excelente! </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A 40mA, o mecanismo iniciou com sucesso!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tamb√©m foi detectado o valor m√≠nimo da corrente de enrolamento necess√°ria para a opera√ß√£o est√°vel do motor, e √© igual a 30mA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, o torque ser√° muito menor, mas o fato de termos conseguido dar partida no motor com um consumo de energia t√£o pequeno √© importante para n√≥s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O diagrama de conex√£o do motor de passo ao microcontrolador ser√° o seguinte: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8z/no/s8/8znos8hnrnwto939rm8yap_znpw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como cada pino do microcontrolador funciona como uma meia ponte (ele pode alternar a sa√≠da do microcircuito para Vcc ou GND), para controlar o motor de passo bipolar, precisamos de 4 pinos do microcontrolador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo do programa:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo fonte WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     L293DD</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1 PB2 // OC0A (EN1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2 PA7 // OC0B (EN2)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1_value OCR0A</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2_value OCR0B</span><font></font>
<font></font>
<span class="hljs-comment">//       L293D</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN1 PA0 //  PORTA</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN2 PA1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN3 PB1 //  PORTB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN4 PB0</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//        </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">// DL - driver less</span><font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4)); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3)); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4)); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3)); <font></font>
    <font></font>
}<font></font>
<font></font>
unsigned <span class="hljs-keyword">char</span> step_counter = <span class="hljs-number">0</span>; <font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">L293D_step</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay, unsigned <span class="hljs-keyword">char</span> phase</span>)</span> { <span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//  ,      </span><font></font>
<font></font>
        <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//           </span><font></font>
	<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
				<span class="hljs-keyword">if</span>(step_counter&lt;<span class="hljs-number">3</span>) { step_counter++; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">0</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
				<span class="hljs-keyword">if</span>(step_counter&gt;<span class="hljs-number">0</span>) { step_counter--; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">3</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-keyword">switch</span>(phase) { <span class="hljs-comment">//     </span><font></font>
		<font></font>
		    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
			<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
    delay_millisecond(step_delay); <span class="hljs-comment">//       </span><font></font>
	<font></font>
	step_quantity--; <font></font>
	<font></font>
	} <font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PWM_init</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;PWM_1); <font></font>
	<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;PWM_2);<font></font>
<font></font>
    TCCR0A = (<span class="hljs-number">1</span>&lt;&lt;WGM01)|(<span class="hljs-number">1</span>&lt;&lt;WGM00)|(<span class="hljs-number">1</span>&lt;&lt;COM0A1)|(<span class="hljs-number">0</span>&lt;&lt;COM0A0)|(<span class="hljs-number">1</span>&lt;&lt;COM0B1)|(<span class="hljs-number">0</span>&lt;&lt;COM0B0); <span class="hljs-comment">//  FAST PWM,   </span><font></font>
	<font></font>
    TCCR0B = (<span class="hljs-number">0</span>&lt;&lt;WGM02)|(<span class="hljs-number">0</span>&lt;&lt;CS02)|(<span class="hljs-number">0</span>&lt;&lt;CS01)|(<span class="hljs-number">1</span>&lt;&lt;CS00); <span class="hljs-comment">//   8</span><font></font>
	<font></font>
    OCR0A = <span class="hljs-number">160</span>; <font></font>
	<font></font>
    OCR0B = <span class="hljs-number">160</span>;<font></font>
<font></font>
} <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//  </span><font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
	<font></font>
	DDRA |=(<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
	<font></font>
	DDRB |=(<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
	<font></font>
	PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <span class="hljs-comment">//  </span><font></font>
<font></font>
	    LED_ON;<font></font>
		<font></font>
	    L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>); <span class="hljs-comment">//step( ,  F/B,   , / )</span><font></font>
		<font></font>
            delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	    LED_OFF;<font></font>
		<font></font>
	    L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<font></font>
		<font></font>
	    delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	<font></font>
	   <font></font>
	} <font></font>
<font></font>
} </code></pre><br>
</div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me explicar um pouco como esse programa funciona. Este √© um c√≥digo modificado da primeira experi√™ncia. Como eu disse acima, um TIMER0 de 8 bits ser√° usado para gerar um sinal PWM nas sa√≠das OC0A e OC0B. O timer est√° definido no modo FastPWM com um pr√©-calibrador de 8 (a frequ√™ncia do sinal a 8 MHz do rel√≥gio do microcontrolador √© de 3906 Hz). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para alterar a polaridade dos sinais nos enrolamentos, o pino do microcontrolador √© alternado de Vcc para GND, alterando o bit correspondente no registro PORTx e alterando o ciclo de trabalho PWM, escrevendo valores nos registros OCR0A e OCR0B (os valores foram selecionados experimentalmente). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E entao:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yvaAGt1vhxs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um curso de circuito realizado no primeiro ano do instituto sugere que o mult√≠metro mostre o valor eficaz da tens√£o e corrente no motor. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O motor de passo gira dos pinos do microcontrolador sem drivers! </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas aqui n√£o vamos al√©m das capacidades do microcontrolador, pelo menos, de acordo com o que est√° escrito na documenta√ß√£o. </font><font style="vertical-align: inherit;">Nesse modo, o microcontrolador e o motor podem funcionar por um longo tempo. </font><font style="vertical-align: inherit;">De fato, o experimento durou 20 minutos. </font><font style="vertical-align: inherit;">Durante esse per√≠odo, n√£o houve etapas de pulo, reinicializa√ß√£o do controlador ou superaquecimento (nem o motor nem o controlador).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ponha de lado todas as precau√ß√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Removemos o PWM do experimento e controlaremos diretamente os pinos do microcontrolador usando os registradores PORTx. </font><font style="vertical-align: inherit;">Vamos ver o que acontece com o microcontrolador depois disso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funciona ... com uma corrente m√°xima de 51mA ... Bem ... inesperadamente, parece que essa √© a corrente m√°xima que pode fornecer um pino do microcontrolador? </font><font style="vertical-align: inherit;">Se eu estiver errado, me corrija. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De qualquer forma, o v√≠deo do YouTube n√£o foi enganado. </font><font style="vertical-align: inherit;">Na verdade, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode controlar este motor sem nenhum driver</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">achados</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estudamos detalhadamente motores passo a passo bipolares em miniatura, seu design e como control√°-los, para uso em nossas pr√≥prias aplica√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. O motor de passo bipolar em miniatura com um rotor de √≠m√£ permanente √© realmente miniatura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suas principais caracter√≠sticas:</font></font><br>
<br>
<ul>
<li>   ,  ,    ( , ,  16);</li>
<li>    (   ),     1875 /;</li>
<li>     (    );</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. O motor de passo em miniatura pode ser controlado por qualquer driver adequado para trabalhar com motores de passo bipolares; voc√™ s√≥ precisa selecionar os par√¢metros da corrente de enrolamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. O uso de um driver TMC2208 especializado √© um problema controverso, pois o modo microstep n√£o √© suportado pelo pr√≥prio mecanismo, embora as transi√ß√µes entre as etapas sejam realizadas de maneira mais suave. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. √â poss√≠vel conectar um motor de passo diretamente √†s portas do microcontrolador. </font><font style="vertical-align: inherit;">Mas isso √© apenas dentro da estrutura do experimento, uma vez que o torque, neste caso, √© muito insignificante, e mesmo uma pequena corrente n√£o permite que sejam tomadas medidas em alta velocidade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da pr√≥xima vez, vou explicar por que precisamos de pequenos motores de passo.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498762/index.html">As falsifica√ß√µes s√£o tolas ou graves?</a></li>
<li><a href="../pt498766/index.html">Melhores com√©dias de TI. Os 3 principais programas de TV</a></li>
<li><a href="../pt498768/index.html">Uso de um detector de fuma√ßa em ve√≠culos</a></li>
<li><a href="../pt498770/index.html">Como trabalhei para a equipe Agile da Microsoft em 1998, quando o termo Agile estava apenas tentando criar</a></li>
<li><a href="../pt498782/index.html">Experimentadores de Batalha - Ci√™ncia da Areia e do Pau - Inocula√ß√£o do Pensamento Cient√≠fico na Mente P√∫blica</a></li>
<li><a href="../pt498796/index.html">Pol√≠tica de seguran√ßa de conte√∫do no Magento 2</a></li>
<li><a href="../pt498798/index.html">Continue aprendendo e aprendendo com o JetBrains</a></li>
<li><a href="../pt498800/index.html">Como eu ensinei meu computador a jogar Dobble com OpenCV e Deep Learning</a></li>
<li><a href="../pt498808/index.html">Vim com suporte YAML para Kubernetes</a></li>
<li><a href="../pt498814/index.html">Voc√™ falhou em uma pergunta te√≥rica sobre a Seguridade Social e ela acabou com voc√™. Isto √© normal? // Estamos condenados # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>