<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖕🏽 👩‍🌾 🛰️ 何十億ものテキストベクトルのインデックス作成 🥅 👨 👩‍❤️‍👨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="情報を抽出するとき、そのようなテキストの断片を見つけるというタスクがしばしば発生します。検索のコンテキストでは、ユーザー（たとえば、ユーザーが検索エンジンに入力したテキスト）またはシステム自体によってクエリを生成できます。多くの場合、受信したクエリを既にインデックス付けされたクエリと照合する必要があ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>何十億ものテキストベクトルのインデックス作成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/479692/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/id/dd/fg/idddfg6zku7xq-zv9f0m8xemyiy.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
情報を抽出するとき、その</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よう</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なテキストの断片を</font><font style="vertical-align: inherit;">見つけるというタスクがしばしば発生し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">検索のコンテキストでは、ユーザー（たとえば、ユーザーが検索エンジンに入力したテキスト）またはシステム自体によってクエリを生成できます。</font><font style="vertical-align: inherit;">多くの場合、受信したクエリを既にインデックス付けされたクエリと照合する必要があります。</font><font style="vertical-align: inherit;">この記事では、サーバーインフラストラクチャに大金を費やすことなく、何十億ものリクエストに関連してこの問題を解決するシステムを構築する方法を見ていきます。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、問題を正式に定義します。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固定されたクエリのセットを考える </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、着信リクエスト</font></font><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.509ex" viewBox="0 -809.3 791.5 1080.4" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">Q</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と整数</font></font><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.884ex" viewBox="0 -540.2 460.5 811.3" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">q</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのようなクエリのサブセットを見つける必要がある</font></font><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.009ex" viewBox="0 -755.5 521.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">k</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ように、各クエリ</font></font><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>R</mi><mo>=</mo><mrow><mo>{</mo><mrow><mi>q</mi><mn>0</mn><mo>,</mo><mi>q</mi><mn>1</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>q</mi><mi>k</mi></mrow><mo>}</mo></mrow><mo>&amp;#x2282;</mo><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="25.073ex" height="2.634ex" viewBox="0 -809.3 10795.1 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-3D" x="1037" y="0"></use><g transform="translate(2093,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-7B" x="0" y="0"></use><g transform="translate(500,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-30" x="460" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="961" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="1406" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-31" x="1866" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="2367" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2E" x="2812" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2E" x="3257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2E" x="3702" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="4147" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="4593" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6B" x="5053" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-7D" x="6075" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2282" x="8947" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-51" x="10003" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mo>=</mo><mrow><mo>{</mo><mrow><mi>q</mi><mn>0</mn><mo>,</mo><mi>q</mi><mn>1</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>q</mi><mi>k</mi></mrow><mo>}</mo></mrow><mo>⊂</mo><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">R=\left \{ q0,q1,...,qk \right \}\subset Q</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より多くの類似していました</font></font><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>q</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub><mo>&amp;#x2208;</mo><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.441ex" height="2.384ex" viewBox="0 -755.5 2773.4 1026.6" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="631" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2208" x="1068" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-52" x="2013" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>q</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub><mo>∈</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">q_{i}\in R</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のどの要求よりも</font></font><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.884ex" viewBox="0 -540.2 460.5 811.3" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">q</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>&amp;#x2216;</mo><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.443ex" height="2.509ex" viewBox="0 -809.3 2773.9 1080.4" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-51" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJAMS-2216" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-52" x="2014" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo>∖</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">Q∖R</script><font style="vertical-align: inherit;"></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、そのような一連のクエリでは </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.509ex" viewBox="0 -809.3 791.5 1080.4" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">Q</script><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">{tesla cybertruck, beginner bicycle gear, eggplant dishes, tesla new car, how expensive is cybertruck, vegetarian food, shimano 105 vs ultegra, building a carbon bike, zucchini recipes}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この結果が期待できます。</font></font><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>3</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.472ex" height="2.009ex" viewBox="0 -755.5 2356.1 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-3D" x="799" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-33" x="1855" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mo>=</mo><mn>3</mn></math></span></span><script type="math/tex" id="MathJax-Element-9">k=3</script><font style="vertical-align: inherit;"></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入力リクエスト </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.884ex" viewBox="0 -540.2 460.5 811.3" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">q</script><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同様のクエリ </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.764ex" height="2.009ex" viewBox="0 -755.5 759.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-52" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-11">R</script><br>
</th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスラピックアップ</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{テスラサイバートラック、テスラの新車、サイバートラックの値段}</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高のバイク2019</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{シマノ105対ウルテグラ、カーボンバイクの方が優れている、自転車のギアリング}</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">野菜料理</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{茄子料理、ズッキーニのレシピ、ベジタリアン料理}</font></font><br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まだ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">類似性の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基準を定義していないことに注意してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このコンテキストでは、これはほとんどすべてのことを意味しますが、通常はキーワードまたはベクトルに基づいた何らかの形の類似性になります。</font><font style="vertical-align: inherit;">キーワードベースの類似性を使用して、十分な一般的な単語が含まれている場合、類似する2つのクエリを見つけることができます。</font><font style="vertical-align: inherit;">たとえば、「ミュンヘンでレストランを開く」と「ミュンヘンで最高のレストラン」というクエリは、「レストラン」と「ミュンヘン」という単語が含まれているため、似ています。</font><font style="vertical-align: inherit;">また、「ミュンヘンで最高のレストラン」と「ミュンヘンでどこを食べるか」というクエリは、一般的な単語が1つしかないため、類似性が低くなっています。</font><font style="vertical-align: inherit;">ただし、ミュンヘンでレストランを探している人は、2番目の要求のペアが同様であることが判明した場合に適しています。</font><font style="vertical-align: inherit;">これで、ベクトルに基づく比較を支援します。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単語のベクトル表現</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単語のベクトル表現は、自然言語処理でテキストまたは単語をベクトルに変換するために使用される機械学習手法です。タスクをベクトル空間に移動すると、ベクトルの数学演算を使用して距離を合計および計算できます。類似した単語間のリンクを確立するには、従来のベクトルクラスタリングの方法を使用できます。</font><font style="vertical-align: inherit;">元の単語空間</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">での</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの操作</font><i><font style="vertical-align: inherit;">の意味は</font></i><font style="vertical-align: inherit;">明らかではないかもしれませんが、利点は、さまざまな数学ツールにアクセスできるようになったことです。ワードベクターとそのアプリケーションの詳細に興味がある場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">word2vec</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GloVeをお</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読み</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単語からベクトルを生成する方法があります。今度はそれらをテキストベクトル（ドキュメントまたは式のベクトル）に収集します。</font><font style="vertical-align: inherit;">これを行う最も簡単な方法は、テキスト内のすべての単語のベクトルを追加（または平均化）することです。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/692/bc5/b0c/692bc5b0ccbbe7a89392528365645708.png"><br>
<i><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図1：クエリベクトル </font></font></sup></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、2つのテキスト（またはクエリ）をベクトル空間で表現し、ベクトル間の距離を計算することで、それらの類似性を判断できます。</font><font style="vertical-align: inherit;">通常、これには角距離が使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、単語のベクトル表現により、異なるタイプのテキストマッチングが可能になり、キーワードベースのマッチングが補完されます。</font><font style="vertical-align: inherit;">以前は不可能だったように、要求の意味の類似性（たとえば、「ミュンヘンの最高のレストラン」や「ミュンヘンで食べる場所」）を探ることができます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">近似最近傍検索</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、元のクエリ照合問題を改善できます。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエリベクトルの固定セットが与えられた場合 </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、入力ベクトル</font></font><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.509ex" viewBox="0 -809.3 791.5 1080.4" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">Q</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と整数</font></font><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.884ex" viewBox="0 -540.2 460.5 811.3" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">q</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのようなベクトルのサブセットを見つける必要があります</font></font><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.009ex" viewBox="0 -755.5 521.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">k</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からなるように角距離</font></font><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>R</mi><mo>=</mo><mrow><mo>{</mo><mrow><mi>q</mi><mn>0</mn><mo>,</mo><mi>q</mi><mn>1</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>q</mi><mi>k</mi></mrow><mo>}</mo></mrow><mo>&amp;#x2282;</mo><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="25.073ex" height="2.634ex" viewBox="0 -809.3 10795.1 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-3D" x="1037" y="0"></use><g transform="translate(2093,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-7B" x="0" y="0"></use><g transform="translate(500,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-30" x="460" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="961" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="1406" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-31" x="1866" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="2367" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2E" x="2812" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2E" x="3257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2E" x="3702" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="4147" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="4593" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6B" x="5053" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-7D" x="6075" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2282" x="8947" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-51" x="10003" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mo>=</mo><mrow><mo>{</mo><mrow><mi>q</mi><mn>0</mn><mo>,</mo><mi>q</mi><mn>1</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>q</mi><mi>k</mi></mrow><mo>}</mo></mrow><mo>⊂</mo><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-15">R=\left \{ q0,q1,...,qk \right \}\subset Q</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各ベクトルへの</font><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-76"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77"><font style="vertical-align: inherit;"> q</font></span></span></span></font><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.884ex" viewBox="0 -540.2 460.5 811.3" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">q</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意の他のベクター内への距離よりも短かったです</font></font><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>q</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub><mo>&amp;#x2208;</mo><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.441ex" height="2.384ex" viewBox="0 -755.5 2773.4 1026.6" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-71" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="631" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2208" x="1068" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-52" x="2013" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>q</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub><mo>∈</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-17">q_{i}\in R</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>&amp;#x2216;</mo><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.443ex" height="2.509ex" viewBox="0 -809.3 2773.9 1080.4" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-51" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJAMS-2216" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-52" x="2014" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo>∖</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">Q∖R</script><font style="vertical-align: inherit;"></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、最近傍を見つけるタスクと呼ばれます。</font><font style="vertical-align: inherit;">低次元空間での迅速な解法に</font><font style="vertical-align: inherit;">は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くのアルゴリズム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。しかし、単語のベクトル表現を扱う場合、通常、高次元のベクトル（100〜1000次元）を操作します。そして、ここで言及された方法はもはや機能しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
高次元空間で最近傍をすばやく特定する適切な方法はありません。したがって、近似結果を使用できるようにすることで問題を単純化します。常に</font><font style="vertical-align: inherit;">最も近いベクトルを</font><font style="vertical-align: inherit;">返すので</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なく</font><font style="vertical-align: inherit;">、最も近い、または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある程度</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">近い近傍</font><font style="vertical-align: inherit;">のみを使用して満足し</font><font style="vertical-align: inherit;">ます。これは、最近傍タスクの近似検索と呼ばれ、活発な研究の領域です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層的な小さな世界</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
階層型ナビ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能小世界グラフ（</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">HNSW</font></a><font style="vertical-align: inherit;">）は、最近傍を近似的に検索するための最速アルゴリズムの1つです。</font><font style="vertical-align: inherit;">HNSWの検索インデックスは、各レベルが近接グラフであるマルチレベル構造です。</font><font style="vertical-align: inherit;">各グラフノードは、クエリベクトルの1つに対応します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/42e/55e/4b7/42e55e4b72cd088b45e5aff56159f7fb.png"><br>
<sup><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図2：マルチレベル近接グラフ。</font></font></i></sup><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HNSWで最近傍を見つけるには、ズームイン方法を使用します。</font><font style="vertical-align: inherit;">最上位レベルの入力ノードから始まり、最下部の極小値に達するまで、各レベルで貪欲なグラフ走査を再帰的に実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アルゴリズムと検索手法の詳細は、科学論文に詳しく説明されています。</font><font style="vertical-align: inherit;">最近傍の各検索サイクルは、ベクトル間の距離を計算しながらグラフのノードをトラバースすることで構成されることに注意してください。</font><font style="vertical-align: inherit;">この方法を使用して大規模なインデックスを作成するには、以下の手順を見ていきます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数十億のクエリのインデックス作成の難しさ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
40億の200次元クエリベクトルにインデックスを付ける必要があるとします。各次元は4バイトの浮動小数点数で表されます（40億はタスクを興味深いものにするのに十分ですが、ノードIDを通常の4バイトの数値で保存できます）。 。大まかな計算では、ベクターのサイズだけで約3 TBになることがわかります。既存のライブラリのほとんどはRAM容量を使用して最近傍を近似的に検索するため、少なくともベクトルをRAMにプッシュするために非常に大きなサーバーが必要になります。これは、ほとんどのメソッドに必要な追加の検索インデックスを考慮していないことに注意してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの検索エンジン開発の全歴史の中で、この問題を解決するためにいくつかの異なるアプローチを使用してきました。</font><font style="vertical-align: inherit;">それらのいくつかを考えてみましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データのサブセット</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を完全に解決することができなかった最初で最も単純なアプローチは、インデックス内のベクトルの数を制限することでした。</font><font style="vertical-align: inherit;">データの1/10を使用して、メモリの10％を必要とするインデックスを作成しました。</font><font style="vertical-align: inherit;">ただし、クエリの数が減ったため、検索の質が低下しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">量子化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではすべてのデータを使用しましたが、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">量子化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用</font><font style="vertical-align: inherit;">してそれらを削減しました</font><font style="vertical-align: inherit;">（たとえば、製品の量子化などのさまざまな量子化手法を使用しましたが、この量のデータで目的の品質を達成できませんでした）。</font><font style="vertical-align: inherit;">いくつかのエラーを四捨五入することにより、元のベクトルのすべての4バイトの数値を、量子化されたシングルバイトバージョンに置き換えることができました。</font><font style="vertical-align: inherit;">ベクトルのRAMの量が75％減少しました。</font><font style="vertical-align: inherit;">ただし、750 GBのメモリ（インデックス自体のサイズは含まない）が必要であり、これは依然として非常に大きなサーバーです。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Granneでのメモリ問題の解決</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明したアプローチには利点がありましたが、多くのリソースを必要とし、検索品質が低下しました。けれども</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリがある</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1ミリ秒未満で応答することが、私達はより低いハードウェア要件と引き換えにスピードを犠牲にできました。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Granne</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（グラフベースの近似最近傍）は、このようなクエリを検索するためにCliqzによって開発および使用されたHNSWライブラリです。オープンソースコードがありますが、ライブラリはまだ活発に開発されています。改善されたバージョンが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">crates.io</font></a><font style="vertical-align: inherit;">で公開され</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2020年に </font><font style="vertical-align: inherit;">Rustで書かれたPythonインサートは、競争力を利用して何十億ものベクターを処理するように設計されています。</font><font style="vertical-align: inherit;">クエリベクトルの観点から見ると、Granneには、他のライブラリと比較して必要なメモリが大幅に少ない特別なモードがあることが興味深いです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クエリベクトルのコンパクトな表現</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリベクトルのサイズを小さくすると、多くの利点が得られます。これを行うには、戻ってベクトルを作成することを検討しましょう。クエリは単語で構成され、クエリベクトルは単語ベクトルの合計であるため、クエリベクトルの格納と必要に応じた計算を明示的に拒否できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリを単語セットの形式で保存し、ルックアップテーブルを使用して対応するベクトルを見つけることができます。ただし、各クエリをクエリ内の単語ベクトルに対応する整数IDのリストとして保存することで、リダイレクトを回避します。たとえば、「ミュンヘンのベストレストラン」というクエリを次のように保存します。</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><mo>,</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></msub></mrow><mo>,</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>o</mi><mi>f</mi></mrow></msub></mrow><mo>,</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>m</mi><mi>u</mi><mi>n</mi><mi>i</mi><mi>c</mi><mi>h</mi></mrow></msub></mrow><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.541ex" height="2.759ex" viewBox="0 -809.3 11427.2 1188" role="img" focusable="false" style="vertical-align: -0.88ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-65" x="429" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-73" x="896" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-74" x="1365" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="1945" y="0"></use><g transform="translate(2390,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-65" x="451" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-73" x="918" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-74" x="1387" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-61" x="1749" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-75" x="2278" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-72" x="2851" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-61" x="3302" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6E" x="3832" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-74" x="4432" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="6225" y="0"></use><g transform="translate(6670,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-66" x="485" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2C" x="7848" y="0"></use><g transform="translate(8294,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-75" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6E" x="1450" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="2051" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-63" x="2397" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-68" x="2830" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-5D" x="11148" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></msub></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>o</mi><mi>f</mi></mrow></msub></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>u</mi><mi>n</mi><mi>i</mi><mi>c</mi><mi>h</mi></mrow></msub></mrow><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-19">[{i_{best}}, {i_{restaurant}}, {i_{of}}, {i_{munich}}]</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は単語ベクトルの「最高」のIDです。1600万未満の単語ベクトル（これより多いと単語ごとに1バイトのコストがかかります）があるとすると、3バイトを使用してすべてのIDを表すことができます。言葉。つまり、800バイト（または量子化されたベクトルの場合は200バイト）を格納する代わりに、この要求に対して12バイトのみを格納します（これは完全に真ではありません。要求は異なる数の単語で構成されるため、リストオフセットを単語インデックスに格納する必要もあります。これには、リクエストごとに5バイトが必要です）。</font></font><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.871ex" height="2.259ex" viewBox="0 -755.5 1666.7 972.7" role="img" focusable="false" style="vertical-align: -0.505ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-65" x="429" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-73" x="896" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-74" x="1365" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow></math></span></span><script type="math/tex" id="MathJax-Element-20">{i_{best}}</script><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ベクトルという単語については、すべて必要です。</font><font style="vertical-align: inherit;">ただし、単語の数は、これらの単語を組み合わせて作成できるクエリの数よりもはるかに少なくなります。</font><font style="vertical-align: inherit;">つまり、単語のサイズはそれほど重要ではありません。</font><font style="vertical-align: inherit;">ワードベクトルを4バイトの浮動小数点バージョンとして単純な配列に格納する場合</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、100万ワードごとに1 GB未満が必要です。</font><font style="vertical-align: inherit;">このボリュームは、RAMに簡単に収めることができます。</font><font style="vertical-align: inherit;">クエリベクトルは次のようになります。</font></font><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>v</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.128ex" height="1.509ex" viewBox="0 -540.2 485.5 649.8" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-76" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-21">v</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
クエリ送信の最終的なサイズは、クエリ内の単語の総数によって異なります。 40億クエリの場合、これは約80 GBです（単語ベクトルを含む）。つまり、元の単語ベクトルと比較して、サイズは97％減少し、量子化ベクトルと比較して-90％減少しました。</font></font><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow></mrow></msub></mrow><mo>+</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></msub></mrow></mrow></msub></mrow><mo>+</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>o</mi><mi>f</mi></mrow></msub></mrow></mrow></msub></mrow><mo>+</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>m</mi><mi>u</mi><mi>n</mi><mi>i</mi><mi>c</mi><mi>h</mi></mrow></msub></mrow></mrow></msub></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.62ex" height="2.509ex" viewBox="0 -647.8 12752.9 1080.4" role="img" focusable="false" style="vertical-align: -1.005ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-76" x="0" y="0"></use><g transform="translate(485,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(244,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-65" x="429" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-73" x="896" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-74" x="1365" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2B" x="1986" y="0"></use><g transform="translate(2986,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-76" x="0" y="0"></use><g transform="translate(485,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(244,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-65" x="451" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-73" x="918" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-74" x="1387" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-61" x="1749" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-75" x="2278" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-72" x="2851" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-61" x="3302" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6E" x="3831" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-74" x="4432" y="0"></use></g></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2B" x="6506" y="0"></use><g transform="translate(7507,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-76" x="0" y="0"></use><g transform="translate(485,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(244,-110)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-66" x="485" y="0"></use></g></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMAIN-2B" x="9148" y="0"></use><g transform="translate(10148,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-76" x="0" y="0"></use><g transform="translate(485,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="0" y="0"></use><g transform="translate(244,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-75" x="878" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-6E" x="1451" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-69" x="2051" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-63" x="2397" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;usg=ALkJrhgAHxTadhEWI1DWyfUs9crIvcY_RA#MJMATHI-68" x="2830" y="0"></use></g></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow></mrow></msub></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></msub></mrow></mrow></msub></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>o</mi><mi>f</mi></mrow></msub></mrow></mrow></msub></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>u</mi><mi>n</mi><mi>i</mi><mi>c</mi><mi>h</mi></mrow></msub></mrow></mrow></msub></mrow></math></span></span><script type="math/tex" id="MathJax-Element-22">{v_{{i_{best}}}} + {v_{{i_{restaurant}}}} + {v_{{i_{of}}}} + {v_{{i_{munich}}}}</script><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして他の何か。</font><font style="vertical-align: inherit;">1回の検索では、グラフの約200〜300のノードにアクセスする必要があります。</font><font style="vertical-align: inherit;">各ノードには20〜30のネイバーがあります。</font><font style="vertical-align: inherit;">したがって、インデックス内の入力クエリベクトルから4000〜9000ベクトルまでの距離を計算する必要があります。</font><font style="vertical-align: inherit;">さらに、ベクターを生成する必要があります。</font><font style="vertical-align: inherit;">クエリベクターをその場で作成するのにどのくらい時間がかかりますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
かなり新しいプロセッサを使用すると、この問題は数ミリ秒で解決できることがわかります。</font><font style="vertical-align: inherit;">以前は1ミリ秒で実行されていたリクエストが、約5ミリ秒で実行されるようになりました。</font><font style="vertical-align: inherit;">しかし、その後、ベクターのメモリ量を90％削減しました。</font><font style="vertical-align: inherit;">私たちはそのような妥協を喜んで受け入れました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベクトルとインデックスをメモリに表示</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記で、ベクターのメモリー量を削減する問題を解決しました。しかし、この問題を解決した後、インデックス構造自体が制限要因になりました。次に、サイズを小さくする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Granneでは、グラフ構造は隣接リストの形式でコンパクトに格納され、各ノードのネイバーの数は可変です。つまり、メタデータでメモリが無駄になることはほとんどありません。インデックス構造のサイズは、設計パラメーターとグラフプロパティに大きく依存します。それでも、インデックスのサイズを把握するには、合計サイズが約240 GBの40億のベクトルのインデックスを作成できると言えます。これは、大規模なサーバーでのメモリ内の使用には許容できるかもしれませんが、より適切に実行できます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e73/daa/0de/e73daa0dea90e3e84afe9aaec7bd6a8e.jpg"><br>
<sup><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図3：RAMとSSDの2つの異なるレイアウト。</font></font></i></sup><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Granneの重要な特性は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、メモリ内の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インデックスとクエリベクトル</font><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">表示する</font></a><font style="vertical-align: inherit;">機能</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これにより、遅延してインデックスをロードし、複数のプロセス間でメモリを共有できます。</font><font style="vertical-align: inherit;">インデックスファイルとクエリファイルは、メモリ内で個別の表示ファイルに分割され、RAM内とSSD上の異なるレイアウトで使用できます。</font><font style="vertical-align: inherit;">遅延の要件が少し低い場合は、SSDにインデックスを配置し、RAMに要求すると、過度のメモリ消費なしに許容可能な速度を維持します。</font><font style="vertical-align: inherit;">記事の最後で、この妥協案がどのように見えるかを見ていきます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データの局所性の向上</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在の構成では、インデックスがSSD上にある場合、リクエストごとにディスクから最大200〜300回の読み取りが必要です。 HNSWノードが互いにあまり離れていないインデックスに配置されるようにベクトルが非常に近い要素を配置することにより、データの局所性を高めることができます。単一の読み取り操作（通常は4 KBから抽出）には、グラフをトラバースするために必要な他のノードが含まれる可能性が高いため、データの局所性によりパフォーマンスが向上します。これにより、1回の検索あたりのデータ取得数が減少します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/1f8/1d2/2f4/1f81d22f418256c704bb12b7514e68a1.jpg"><br>
<sup><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図4：データの局所性により、情報の取得が減少します。</font></font></i></sup><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要素の並べ替えは検索結果に影響を与えないことに注意してください。これは、検索を高速化する方法です。</font><font style="vertical-align: inherit;">つまり、順序は任意ですが、すべてのオプションが検索を高速化するわけではありません。</font><font style="vertical-align: inherit;">最適な順序を見つけるのは非常に困難です。</font><font style="vertical-align: inherit;">ただし、正常に使用したヒューリスティックは</font><font style="vertical-align: inherit;">、各クエリの</font><font style="vertical-align: inherit;">最も</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要な</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単語で</font><font style="vertical-align: inherit;">クエリを並べ替えることです</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
比較的少ないメモリ消費でそのようなクエリを検索するために、Granneを使用してクエリベクトルで数十億ドルのインデックスを作成および維持します。</font><font style="vertical-align: inherit;">次の表は、さまざまな方法の要件を示しています。</font><font style="vertical-align: inherit;">検索中の遅延の絶対値は、許容できる応答と見なされるものに大きく依存するため、懐疑的にしてください。</font><font style="vertical-align: inherit;">ただし、この情報はメソッドの相対的なパフォーマンスを説明しています。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期値</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">量子化</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Granne（RAMのみ）</font></font><br>
</th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Granne（RAM + SSD）</font></font><br>
</th>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記憶</font></font></b><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3000 + 240 GB</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">750 + 240 GB</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80 + 240 GB</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80〜150 GB *</font></font><br>
</td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSD</font></font></b><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">240 GB</font></font><br>
</td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレイ</font></font></b><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1ミリ秒</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1ミリ秒</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5ミリ秒</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10〜50 ms</font></font><br>
</td>
</tr>
</tbody></table></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*必要な量よりも大きいメモリインデックスを割り当てると、一部のノード（頻繁にアクセスされる）がキャッシュされ、検索の遅延が減少しました。</font><font style="vertical-align: inherit;">これには内部キャッシュは使用されず、内部OSツール（Linuxカーネル）のみが使用されました。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事で言及されている最適化のいくつかは、分解不可能なベクトルで最近傍を見つけるという一般的な問題を解決するために適用できないことに注意してください。</font><font style="vertical-align: inherit;">ただし、要素がより少ない部分から生成できるすべての状況に適用できます（単語やクエリの場合のように）。</font><font style="vertical-align: inherit;">それ以外の場合は、ソースベクトルでGranneを引き続き使用できます。他のライブラリと同様に、より多くのメモリを必要とします。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja479682/index.html">Sysdigコンテナー使用レポート2019：新しいKubernetesとセキュリティの詳細</a></li>
<li><a href="../ja479684/index.html">SEOの低頻度キーを収集する方法：4つの重要な方法</a></li>
<li><a href="../ja479686/index.html">2020年以降のITアウトソーシングの主な傾向</a></li>
<li><a href="../ja479688/index.html">В каких странах и городах разработчики зарабатывают больше, если учесть налоги и стоимость жизни?</a></li>
<li><a href="../ja479690/index.html">ZorkとZ-Machine：開発者がどのようにゲームをメインフレームから8ビットのホームコンピューターに転送したか</a></li>
<li><a href="../ja479696/index.html">テーブルの変更、またはそれを行わない方法に関する一言</a></li>
<li><a href="../ja479700/index.html">CIMON-2：（un）Doomsday、またはIBM Watsonが雲の上に登った方法</a></li>
<li><a href="../ja479702/index.html">トースター、マイサークル、フリーランシムがHabrの一員に</a></li>
<li><a href="../ja479704/index.html">EA Origin Windowsクライアントでの権限昇格（CVE-2019-19247およびCVE-2019-19248）</a></li>
<li><a href="../ja479708/index.html">Habr + Competitionのブランド変更に関する非公式の投稿</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>