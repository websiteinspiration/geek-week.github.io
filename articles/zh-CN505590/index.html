<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜ ğŸ‘©ğŸ»â€ğŸ« ğŸ¨ GPUè®¡ç®—ä»å­—é¢ä¸Šå¸®åŠ©æˆ‘çš„å·¥ä½œã€‚Pythonç¤ºä¾‹ ğŸ’™ ğŸ‘©ğŸ¼â€ğŸ¨ ğŸ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼
 
 ä»Šå¤©ï¼Œæˆ‘ä»¬è®¨è®ºæœ€ç›¸å…³çš„ä¸»é¢˜-ç”¨äºGPUçš„Pythonã€‚ä½œè€…è€ƒè™‘äº†ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹åœ¨å…¶æ€ªå¼‚æ€§ä¸Šæ˜¯å¾®ä¸è¶³é“çš„ï¼Œå¹¶åœ¨è§£å†³æ–¹æ¡ˆä¸­åˆ—å‡ºäº†å¤§é‡ç¤ºä¾‹ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†æ¼”ç¤ºã€‚äº«å—é˜…è¯»ï¼
 
 
 
 æˆ‘ä»¬éƒ½æ²¡æœ‰äººä»¥ä¸€ç§æˆ–å¦ä¸€ç§å½¢å¼ç»•è¿‡æœ€è¿‘å…³äºGPUè®¡ç®—çš„ç‚’ä½œã€‚åœ¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œæˆ‘å°†è§£é‡Šï¼šæˆ‘ä¸æ˜¯GPUä¸“å®¶ã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>GPUè®¡ç®—ä»å­—é¢ä¸Šå¸®åŠ©æˆ‘çš„å·¥ä½œã€‚Pythonç¤ºä¾‹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/505590/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆHaï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»Šå¤©ï¼Œæˆ‘ä»¬è®¨è®ºæœ€ç›¸å…³çš„ä¸»é¢˜-ç”¨äºGPUçš„Pythonã€‚</font><font style="vertical-align: inherit;">ä½œè€…è€ƒè™‘äº†ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹åœ¨å…¶æ€ªå¼‚æ€§ä¸Šæ˜¯å¾®ä¸è¶³é“çš„ï¼Œå¹¶åœ¨è§£å†³æ–¹æ¡ˆä¸­åˆ—å‡ºäº†å¤§é‡ç¤ºä¾‹ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†æ¼”ç¤ºã€‚</font><font style="vertical-align: inherit;">äº«å—é˜…è¯»ï¼</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xb/mv/xr/xbmvxrrximpm1_fchk6fsi9v5fg.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬éƒ½æ²¡æœ‰äººä»¥ä¸€ç§æˆ–å¦ä¸€ç§å½¢å¼ç»•è¿‡æœ€è¿‘å…³äºGPUè®¡ç®—çš„ç‚’ä½œã€‚åœ¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œæˆ‘å°†è§£é‡Šï¼šæˆ‘ä¸æ˜¯GPUä¸“å®¶ã€‚æˆ‘åœ¨GPUä¸–ç•Œä¸­çš„æ—…ç¨‹æ‰åˆšåˆšå¼€å§‹ã€‚ä½†æ˜¯ä»Šå¤©ï¼Œè¿™é¡¹æŠ€æœ¯å·²ç»è¾¾åˆ°äº†å¦‚æ­¤å¼ºå¤§çš„æ°´å¹³ï¼Œå€ŸåŠ©å®ƒï¼Œæ‚¨å¯ä»¥è§£å†³å¾ˆå¤šé—®é¢˜ã€‚æˆ‘è¢«åˆ†é…äº†ä¸€é¡¹å·¥ä½œä»»åŠ¡ï¼Œæœºå™¨èŠ±äº†æ•°å°æ—¶ï¼Œè€Œä¸”çœ‹ä¸åˆ°è¿›åº¦ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æˆ‘æ‹¿èµ·GPUï¼Œé—®é¢˜å°±åœ¨å‡ ç§’é’Ÿå†…å¼€å§‹è§£å†³ã€‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§çº¦èŠ±äº†2å¤©æ—¶é—´å®Œæˆäº†è¿™é¡¹ä»»åŠ¡ï¼Œæˆ‘ä»…ç”¨20ç§’å°±å¯ä»¥è§£å†³</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä»¥ä¸‹å„èŠ‚ä¸­ï¼Œæˆ‘å°†è¯¦ç»†æè¿°æ­¤ä»»åŠ¡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å°†è®¨è®ºå¦‚ä½•ä»¥åŠä½•æ—¶ä½¿ç”¨GPUè§£å†³ä»»ä½•æ­¤ç±»é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä»”ç»†é˜…è¯»-ç›¸ä¿¡æˆ‘ï¼Œæ‚¨ä¸ä¼šåæ‚”ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶ä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œç„¶åç†Ÿæ‚‰GPUï¼Œæœ€åä½¿ç”¨GPUè§£å†³æ­¤é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†ä½¿ç”¨Python </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Numba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº“</font><font style="vertical-align: inherit;">å’Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nvidia Volta V100 16GB GPU GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.ä»»åŠ¡çš„è¯¦ç»†è¯´æ˜</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨é›¶å”®é¢†åŸŸï¼Œæ‚¨é€šå¸¸å¿…é¡»å¯»æ‰¾ç›¸ä¼¼æˆ–æœ€æ¥è¿‘çš„ç‰©ä½“ã€‚</font><font style="vertical-align: inherit;">ç»™æˆ‘ä¸€ä¸ªèŒä½åˆ—è¡¨ï¼Œæ¯ä¸ªèŒä½ç”¨kä¸ªæ½œåœ¨å±æ€§è¡¨ç¤ºã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘è¢«æŒ‡ç¤ºæ‰¾åˆ°ä¸åˆ—è¡¨ä¸­æ¯ä¸ªä½ç½®æœ€ç›¸ä¼¼çš„å‰3ä¸ªä½ç½®ã€‚</font><font style="vertical-align: inherit;">é€‰æ‹©æ­¤é—®é¢˜çš„ç›¸ä¼¼æ€§åº¦é‡æ˜¯ä½™å¼¦ç›¸ä¼¼æ€§ã€‚</font><font style="vertical-align: inherit;">è¿™å°±æ˜¯æˆ‘çš„æ•°æ®ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s1/02/if/s102ifuqgnhoe_pv81htzopsye4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…·æœ‰64ä¸ªæ½œåœ¨ç‰¹å¾çš„æ•°æ®é¡¹åˆ—è¡¨</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»»åŠ¡å¤æ‚åº¦</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ—å‡ºäº†å¤§çº¦10ä¸ªèŒä½ã€‚</font><font style="vertical-align: inherit;">æœç´¢æ¯ä¸ªä½ç½®çš„3ä¸ªæœ€ç›¸ä¼¼çš„ä½ç½®å°†éœ€è¦æ£€æŸ¥åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚</font><font style="vertical-align: inherit;">å®ƒå°†å¾—å‡ºn * kä¸ªè¿ç®—ï¼Œå…¶ä¸­næ˜¯ä½ç½®æ•°ï¼Œkæ˜¯æ¯ä¸ªä½ç½®çš„å±æ€§ã€‚</font><font style="vertical-align: inherit;">æœ‰å¿…è¦ä»åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…¶ä½™ä½ç½®è·å–è¯¥ä½ç½®çš„æ ‡é‡ç§¯ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">top_3_similar_items</span>(<span class="hljs-params">X,mindex</span>):</span> <span class="hljs-comment"># X   ,    -3 ,       'mindex'</span>
    SMALL = <span class="hljs-number">-9999.0</span> <span class="hljs-comment">#   ,         ( )</span>
    first_best_val = SMALL <span class="hljs-comment">#         </span>
    first_best_index = <span class="hljs-number">-1</span> <span class="hljs-comment">#       </span>
    second_best_val = SMALL <span class="hljs-comment">#        </span>
    second_best_index = <span class="hljs-number">-1</span> <span class="hljs-comment">#       </span>
    third_best_val = SMALL <span class="hljs-comment">#        </span>
    third_best_index = <span class="hljs-number">-1</span> <span class="hljs-comment">#       </span>
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(n): <span class="hljs-comment">#  n-  </span>
            <span class="hljs-keyword">if</span>(mindex==j):
                <span class="hljs-keyword">continue</span>
            tmp = np.dot(X[mindex],X[j])/(np.sqrt(np.sum(np.square(X[mindex]))) * np.sqrt(np.sum(np.square(X[j])))) <span class="hljs-comment">#   </span>
            <span class="hljs-keyword">if</span>(tmp&gt;=first_best_val):<font></font>
                third_best_val = second_best_val<font></font>
                third_best_index = second_best_index<font></font>
                second_best_val = first_best_val<font></font>
                second_best_index = first_best_index<font></font>
                first_best_val = tmp<font></font>
                first_best_index = j<font></font>
            <span class="hljs-keyword">elif</span>(tmp&gt;=second_best_val):<font></font>
                third_best_val = second_best_val<font></font>
                third_best_index = second_best_index<font></font>
                second_best_val = tmp<font></font>
                second_best_index = j<font></font>
            <span class="hljs-keyword">elif</span>(tmp&gt;third_best_val):<font></font>
                third_best_val = tmp<font></font>
                third_best_index = j<font></font>
    <span class="hljs-keyword">return</span> first_best_val,first_best_index,second_best_val,second_best_index,third_best_val,third_best_index <span class="hljs-comment">#   </span></code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºæŸ¥æ‰¾ä¸</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ç°åœ¨</font><i><font style="vertical-align: inherit;">å°½å¯èƒ½ç›¸ä¼¼çš„ä¸‰ä¸ªä½ç½®çš„ä»£ç </font></i><font style="vertical-align: inherit;">ï¼Œå½“æ‚¨æ‰¾åˆ°åˆ—è¡¨ä¸­æ‰€æœ‰ä½ç½®çš„å‰ä¸‰ä¸ªç›¸ä¼¼ä½ç½®æ—¶ï¼Œå¤æ‚åº¦ä¹˜ä»¥å¦ä¸€ä¸ªnã€‚</font><font style="vertical-align: inherit;">æœ€ç»ˆå¤æ‚åº¦ä¸ºOï¼ˆn * n * kï¼‰= Oï¼ˆnÂ²kï¼‰ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">top_3_similar_all_items</span>(<span class="hljs-params">X</span>):</span> <span class="hljs-comment"># X   ,      3     </span>
    SMALL = <span class="hljs-number">-9999.99</span> <span class="hljs-comment">#   ,         ( )</span>
    first_best_index = np.zeros(n,dtype=int) <span class="hljs-comment">#        </span>
    first_best_val = np.zeros(n,dtype=float) <span class="hljs-comment">#       </span>
    second_best_index = np.zeros(n,dtype=int) <span class="hljs-comment">#        </span>
    second_best_val = np.zeros(n,dtype=float) <span class="hljs-comment">#       </span>
    third_best_index = np.zeros(n,dtype=int) <span class="hljs-comment">#        </span>
    third_best_val = np.zeros(n,dtype=float) <span class="hljs-comment">#       </span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n):
        <span class="hljs-comment"># Initialisation</span><font></font>
        first_best_val[i] = SMALL<font></font>
        first_best_index[i] = <span class="hljs-number">-1</span><font></font>
        second_best_val[i] = SMALL<font></font>
        second_best_index[i] = <span class="hljs-number">-1</span><font></font>
        third_best_val[i] = SMALL<font></font>
        third_best_index[i] = <span class="hljs-number">-1</span>
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(n):
            <span class="hljs-keyword">if</span>(i==j):
                <span class="hljs-keyword">continue</span>
            tmp = np.dot(X[i],X[j])/(np.sqrt(np.sum(np.square(X[i]))) * np.sqrt(np.sum(np.square(X[j])))) <span class="hljs-comment">#   </span>
            <span class="hljs-keyword">if</span>(tmp&gt;=first_best_val[i]):<font></font>
                third_best_val[i] = second_best_val[i]<font></font>
                third_best_index[i] = second_best_index[i]<font></font>
                second_best_val[i] = first_best_val[i]<font></font>
                second_best_index[i] = first_best_index[i]<font></font>
                first_best_val[i] = tmp<font></font>
                first_best_index[i] = j<font></font>
            <span class="hljs-keyword">elif</span>(tmp&gt;=second_best_val[i]):<font></font>
                third_best_val[i] = second_best_val[i]<font></font>
                third_best_index[i] = second_best_index[i]<font></font>
                second_best_val[i] = tmp<font></font>
                second_best_index[i] = j<font></font>
            <span class="hljs-keyword">elif</span>(tmp&gt;third_best_val[i]):<font></font>
                third_best_val[i] = tmp<font></font>
                third_best_index[i] = j<font></font>
    <span class="hljs-keyword">return</span> first_best_val,first_best_index,second_best_val,second_best_index,third_best_val,third_best_index <span class="hljs-comment">#   </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨äºåœ¨â€œ </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ‹è¯•è¿è¡Œå’Œæ—¶é—´è¯„ä¼°â€</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ—è¡¨ä¸­ä¸ºæ¯ä¸ªä½ç½®æ‰¾åˆ°ä¸‰ä¸ªæœ€ç›¸ä¼¼ä½ç½®</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çš„ä»£ç æˆ‘è¿è¡Œäº†è¯¥ä»£ç ï¼Œè¯•å›¾ä»åŒ…å«n =10Â³ä¸ªä½ç½®ï¼ˆå…¶ä¸­k = 64ï¼‰çš„å­é›†ä¸­æ‰¾åˆ°ä¸‰ä¸ªæœ€ç›¸ä¼¼çš„ä½ç½®ã€‚ç”¨Pythonå®Œæˆæ­¤ä»»åŠ¡å¤§çº¦éœ€è¦17ä¸ªæ—¶é—´ç§’ï¼Œå¹³å‡é€Ÿåº¦ä¸ºæ¯ç§’3.7 *10â¶æ“ä½œã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨Numpyæ“ä½œå’Œæ•°ç»„å·²å¯¹ä»£ç è¿›è¡Œäº†å¾ˆå¥½çš„ä¼˜åŒ–ã€‚</font><font style="vertical-align: inherit;">æˆ‘æ³¨æ„åˆ°æ‰€æœ‰è¿™äº›æ“ä½œéƒ½æ˜¯åœ¨CPUä¸Šé¡ºåºæ‰§è¡Œçš„ã€‚</font></font><br>
<br>
<pre><code class="python hljs">%time first_best_val,first_best_index,second_best_val,second_best_index,third_best_val,third_best_index = top_3_similar_all_items(X)</code></pre><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿è¡Œn =10Â³ä¸ªä½ç½®</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/z7/fr/p9/z7frp96r6jga71hy_eh5kqc6soo.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ç»“è®ºï¼š</font><i><font style="vertical-align: inherit;">n =10Â³ä¸ªä½ç½®</font></i><font style="vertical-align: inherit;">æ‰€èŠ±è´¹çš„æ—¶é—´</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œæˆ‘å°†æµ‹è¯•å­é›†å¢åŠ åˆ°n = 10 ^ä¸ªä½ç½®ã€‚ç”±äºå¤æ‚åº¦ä¸ºOï¼ˆnÂ²kï¼‰ï¼Œæ‰§è¡Œæ—¶é—´å¢åŠ äº†100å€ï¼ˆå› ä¸ºnå¢åŠ äº†10å€ï¼‰ã€‚å®Œæˆä»£ç èŠ±è´¹äº†1700ç§’= 28.33åˆ†é’Ÿã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1t/hz/we/1thzweestkdve12ggxihgenaisu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“è®ºï¼šå¤„ç†n = 10ä¸ªå¤´å¯¸æ‰€éœ€çš„æ—¶é—´</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¾—å‡ºæœ€é‡è¦çš„ä¸€ä¸ªï¼šä¼°è®¡å¤„ç†10ä¸ªå¤´å¯¸çš„å®Œæ•´åˆ—è¡¨æ‰€éœ€çš„æ—¶é—´ã€‚è®¡æ•°åï¼Œæˆ‘ä»¬å‘ç°æ—¶é—´å¤æ‚åº¦å†æ¬¡å¢åŠ äº†100å€ï¼Œå› ä¸ºè¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆnÂ²kï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¼°è®¡æ—¶é—´= 1700 * 100ç§’= 2834åˆ†é’Ÿ= 47.2å°æ—¶ã€œ2å¤©ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å“¦ï¼Œæˆ‘çš„ä¸Šå¸ï¼å¤ªé•¿ï¼ï¼ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯èƒ½å·²ç»æ„è¯†åˆ°ï¼Œæˆ‘å®é™…ä¸Šå·²ç»åˆ©ç”¨GPUçš„åŠŸèƒ½éå¸¸å¿«åœ°å®Œæˆäº†æ‰€æœ‰æ“ä½œã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œä½¿ç”¨GPUæ‰€èŠ±è´¹çš„æ—¶é—´ç®€ç›´ä»¤äººéœ‡æƒŠã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†æŠŠè¿™äº›æ•°å­—ç•™ç»™é›¶é£Ÿï¼Œä½†ç°åœ¨ï¼Œæˆ‘å»ºè®®æ‚¨ç†Ÿæ‚‰GPUçš„ä¸–ç•Œã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. CPUå’ŒGPUçš„æ¯”è¾ƒ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬è´¨ä¸Šï¼Œä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰æ˜¯ä»»ä½•è®¡ç®—è®¾å¤‡çš„å¤§è„‘ï¼šå®ƒæ‰§è¡Œç¨‹åºä¸­ç¼–å†™çš„æŒ‡ä»¤ï¼Œæ‰§è¡Œæ§åˆ¶ï¼Œé€»è¾‘è¿ç®—ä»¥åŠè¾“å…¥/è¾“å‡ºè¿ç®—ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çš„ç¡®ï¼Œç°ä»£CPUä»ç„¶æ²¡æœ‰å¾ˆå¤šå†…æ ¸ï¼Œå¹¶ä¸”CPUçš„åŸºæœ¬ç»“æ„å’Œç”¨é€”-å¤æ‚è®¡ç®—çš„å¤„ç†-æœ¬è´¨ä¸Šå¹¶æ²¡æœ‰æ”¹å˜ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼ŒCPUæœ€é€‚åˆè§£å†³æ¶‰åŠè§£ææˆ–è§£é‡Šä»£ç ä¸­åŒ…å«çš„å¤æ‚é€»è¾‘çš„é—®é¢˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åè¿‡æ¥ï¼Œå›¾å½¢å¤„ç†å™¨ï¼ˆGPUï¼‰å…·æœ‰è¾ƒå°çš„é€»è¾‘å†…æ ¸ï¼Œä½†æ˜¯é€»è¾‘å†…æ ¸å´è¦å¤§å¾—å¤šï¼ˆæˆ‘ä»¬æ­£åœ¨è°ˆè®ºç®—æœ¯é€»è¾‘è®¾å¤‡ï¼ˆALUï¼‰ï¼Œæ§åˆ¶å…ƒç´ å’Œé«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨ï¼‰ï¼Œè¿™äº›é€»è¾‘å†…æ ¸æ˜¯ä¸ºæ•´ä½“å¹¶è¡Œå¤„ç†è€Œè®¾è®¡çš„ç›¸åŒä¸”ç›¸å¯¹ç®€å•çš„æ“ä½œã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dv/rj/_r/dvrj_rfbqkiabwugkvilkoka3oo.png"><br>
 <blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPUæ¯”å…¸å‹çš„CPUå…·æœ‰æ›´å¤šçš„ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALUï¼‰ï¼Œå› æ­¤å¢å¼ºäº†å¹¶è¡Œå¤„ç†ç®€å•æ“ä½œçš„èƒ½åŠ›</font></font></blockquote><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›¾ï¼šæ¯”è¾ƒCPUå’ŒGPUã€œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›¾åƒæº</font></font></a></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.ä½•æ—¶ä½¿ç”¨GPUè®¡ç®— </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPUæ›´é€‚åˆå¤æ‚çš„çº¿æ€§ä»»åŠ¡ã€‚å°½ç®¡CPUå†…æ ¸åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†GPUä»ä½¿æ‚¨å¯ä»¥æ›´é«˜æ•ˆï¼Œæ›´å¿«é€Ÿåœ°å¤„ç†ä¸AIï¼Œæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ æœ‰å…³çš„ä»»åŠ¡ã€‚ GPUé€šè¿‡å¹¶è¡ŒåŒ–ç±»ä¼¼æ“ä½œæ¥å¤„ç†å·¥ä½œè´Ÿè½½ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»GPUçš„è§’åº¦è¿›è¡Œæ“ä½œçš„æƒ³æ³•ï¼šä»¥åœ¨æ–‡æ¡£ä¸­æŸ¥æ‰¾å•è¯çš„æ“ä½œä¸ºä¾‹ã€‚å¯ä»¥ä¾æ¬¡å®Œæˆï¼Œå¯ä»¥å¹¶è¡Œï¼ˆå³ï¼Œé€è¡Œï¼‰æˆ–æœç´¢ç‰¹å®šå•è¯ï¼Œä¸€ä¸€åˆ—å‡ºæ–‡æ¡£ä¸­çš„æ‰€æœ‰å•è¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»CPUçš„è§’åº¦æ¥çœ‹ï¼Œè¿ç®—çš„æƒ³æ³•-æœ‰è¿™æ ·çš„è¿ç®—ï¼Œä¾‹å¦‚æ–æ³¢é‚£å¥‘æ•°åˆ—çš„è®¡ç®—ï¼Œæ— æ³•å¹¶è¡ŒåŒ–ã€‚æ¯•ç«Ÿï¼Œåªæœ‰åœ¨è®¡ç®—äº†å‰ä¸¤ä¸ªåæ‰èƒ½æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ•°å­—ã€‚è¿™ç§æ“ä½œæœ€é€‚åˆCPUã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»§è€Œï¼Œä½¿ç”¨çŸ©é˜µå®¹æ˜“åœ°æ‰§è¡Œè¯¸å¦‚çŸ©é˜µåŠ æ³•å’Œä¹˜æ³•çš„è¿ç®—ï¼Œè¿™æ˜¯å› ä¸ºçŸ©é˜µå•å…ƒä¸­çš„è¿™äº›è¿ç®—ä¸­çš„å¤§å¤šæ•°æ˜¯å½¼æ­¤ç‹¬ç«‹çš„ï¼Œæœ¬è´¨ä¸Šæ˜¯ç›¸ä¼¼çš„ï¼Œå› æ­¤å¯ä»¥å¹¶è¡ŒåŒ–ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.ç®€è¦ä»‹ç»CUDA</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CUDAæ˜¯Nvidiaåˆ›å»ºçš„å¹¶è¡Œè®¡ç®—å¹³å°å’ŒAPIæ¨¡å‹ã€‚ä½¿ç”¨æ­¤APIï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ”¯æŒCUDAå›¾å½¢çš„å¤„ç†å™¨è¿›è¡Œå¹¿æ³›çš„è®¡ç®—ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºGPGPUï¼ˆGPUä¸Šçš„éä¸“ä¸šè®¡ç®—ï¼‰ã€‚è¿™é‡Œå¯¹å®ƒä»¬è¿›è¡Œäº†</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´è¯¦ç»†çš„æè¿°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUMBA</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Numbaæ˜¯ä¸€ä¸ªå…è´¹çš„JITç¼–è¯‘å™¨ï¼Œå¯ä½¿ç”¨LLVMå°†Pythonå’ŒNumPyçš„å­é›†è½¬æ¢ä¸ºå¿«é€Ÿçš„æœºå™¨ä»£ç ï¼Œè¿™æ˜¯ä½¿ç”¨Pythonä¸­çš„llvmliteè½¯ä»¶åŒ…å®Œæˆçš„ã€‚è¯¥è½¯ä»¶åŒ…æä¾›äº†è®¸å¤šç”¨äºå¹¶è¡ŒåŒ–CPUå’ŒGPUçš„Pythonä»£ç çš„é€‰é¡¹ï¼Œè€Œä»£ç æœ¬èº«ä¸­çš„æ›´æ”¹å¾ˆå°‘é€šå¸¸å°±è¶³å¤Ÿäº†ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹æ›´å¤š</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨å¤„ç†å™¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nvidia Volta V100 16GB GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä½¿ç”¨äº†Numbaåº“ã€‚</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å»ºç­‘ç»†èŠ‚ã€œæµï¼Œå—å’Œç½‘æ ¼</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
CUDAä½¿ç”¨æµï¼Œå—å’Œç½‘æ ¼ç­‰æŠ½è±¡ç»„ç»‡å¹¶è¡Œè®¡ç®—ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šCUDAæµæ˜¯åˆ†é…ç»™CUDAæ ¸å¿ƒçš„/å½“å‰çš„æŒ‡ä»¤é“¾ï¼ˆå®é™…ä¸Šï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®¡é“ï¼‰ã€‚åŠ¨æ€è¿è¡Œæ—¶ï¼ŒåŒä¸€CUDAå†…æ ¸ä¸Šæœ€å¤šå¯ä»¥å­˜åœ¨32ä¸ªçº¿ç¨‹ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥ç®¡é“çš„æ‰€æœ‰é“¾æ¥éƒ½å·²å¡«å……ï¼‰ã€‚è¿™æ˜¯å…·æœ‰ç»™å®šç´¢å¼•çš„å†…æ ¸æ‰§è¡Œã€‚æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨å…¶ç´¢å¼•æ¥è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä»¥ä½¿æ•´ä¸ªå¯ç”¨çº¿ç¨‹é›†ä¸€èµ·å¤„ç†æ•´ä¸ªæ•°æ®é›†ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹ç»„ã€‚å…³äºå—å†…çº¿ç¨‹çš„æ‰§è¡Œï¼Œå¯ä»¥è¯´ä¸å¤šï¼šå®ƒä»¬å¯ä»¥é¡ºåºæ‰§è¡Œæˆ–å¹¶è¡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¸æ‰§è¡Œä»»ä½•ç‰¹å®šé¡ºåºã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨</font></font><code>_syncthreads()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼ºåˆ¶çº¿ç¨‹åœ¨å†…æ ¸ä¸­çš„æŸä¸ªç‚¹åœæ­¢å¹¶ç­‰å¾…ç›´åˆ°åŒä¸€å—ä¸­çš„æ‰€æœ‰å…¶ä»–çº¿ç¨‹ä¹Ÿåˆ°è¾¾åŒä¸€ç‚¹</font><font style="vertical-align: inherit;">çš„å‡½æ•°æ¥åè°ƒçº¿ç¨‹</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘æ ¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè¿™æ˜¯ä¸€ç»„å—ã€‚å—ä¹‹é—´æ²¡æœ‰åŒæ­¥ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fu/q_/rm/fuq_rmemxkfpo8o9wkx4es362s8.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CUDAï¼šçº¿ç¨‹ï¼Œå—ï¼Œç½‘æ ¼ã€œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æº</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ä½†æ˜¯çº¿ç¨‹ï¼Œå—å’Œç½‘æ ¼åˆ°åº•åœ¨å“ªé‡Œæ‰§è¡Œï¼Ÿä»¥Nvidiaçš„G80 GPUæ¶æ„ä¸ºä¾‹ï¼Œè®¡ç®—ç»“æœæ˜¾ç„¶åˆ†å¸ƒå¦‚ä¸‹ï¼š</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘æ ¼â†’GPUï¼šæ•´ä¸ªç½‘æ ¼ç”±å•ä¸ªGPUå¤„ç†å™¨å¤„ç†ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å—â†’MPï¼šGPUå¤„ç†å™¨è¢«ç»„ç»‡ä¸ºå¤šå¤„ç†å™¨çš„é›†åˆï¼Œå…¶ä¸­æ¯ä¸ªå¤šå¤„ç†å™¨è´Ÿè´£å¤„ç†ç½‘æ ¼ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå—ã€‚</font><font style="vertical-align: inherit;">ä¸€ä¸ªå—æ°¸è¿œä¸ä¼šåœ¨å¤šä¸ªMPä¹‹é—´åˆ†é…ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æµâ†’PPï¼šæ¯ä¸ªMPè¿›ä¸€æ­¥ç»†åˆ†ä¸ºæµå¤„ç†å™¨ï¼ˆPPï¼‰ï¼Œæ¯ä¸ªPPå¤„ç†ä¸€ä¸ªå—ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»è¿™ç¯‡</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ºè‰²çš„æ–‡ç« ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€Ÿäº†ä¸€äº›èµ„æ–™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘å»ºè®®æ‚¨ä»”ç»†é˜…è¯»ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œç”¨äºä½¿ç”¨GPUåœ¨Pythonä¸­æ·»åŠ æ•°ç»„</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­£å¦‚æˆ‘åˆšå¼€å§‹æ‰€è¯´çš„é‚£æ ·ï¼Œæœ¬æ–‡çš„å®è´¨æ˜¯å¸®åŠ©å¹¿å¤§è¯»è€…äº†è§£GPUçš„åŠŸèƒ½ï¼Œå¹¶è·å¾—å¦‚ä½•ä½¿ç”¨GPUè§£å†³æ—¥å¸¸ä»»åŠ¡çš„ç›´è§‚äº†è§£ã€‚åœ¨å¼€å§‹ä¸ºGPUç¼–å†™ä»£ç ä¹‹å‰ï¼Œæ‚¨å¯èƒ½éœ€è¦åšä¸€äº›åˆæ­¥çš„ç ”ç©¶ã€‚ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬ä»¥æ·»åŠ æ•°ç»„çš„ç¨‹åºä¸ºä¾‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ•°ç»„ï¼Œå¤§å°ä¸ºâ€œ nâ€çš„â€œ aâ€å’Œâ€œ bâ€ã€‚æˆ‘ä»¬è¦ç”Ÿæˆä¸€ä¸ªæ•°ç»„â€œ câ€ï¼Œä½¿å¾—æ•°ç»„cçš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æ•°ç»„â€œ aâ€å’Œâ€œ bâ€ä¸­å…·æœ‰ç›¸åŒç´¢å¼•çš„å…ƒç´ ä¹‹å’Œã€‚ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œæˆ‘ä»¬å°†ä¸ä½¿ç”¨é¡ºåºè®¡ç®—ï¼Œè€Œæ˜¯ä½¿ç”¨GPUè¿›è¡Œå¹¶è¡Œè®¡ç®—ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†å¯åŠ¨nä¸ªçº¿ç¨‹/æ ¸å¿ƒã€‚æ¯ä¸ªç‰¹å®šçº¿ç¨‹çš„å·¥ä½œç´¢å¼•å¯ä»¥ä»ä»¥ä¸‹å…¬å¼å¾—å‡ºï¼š</font></font><br>
<br>
<code>index = cuda.blockIdx.x * cuda.blockDim.x + cuda.threadIdx.x</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºäºŒç»´çŸ©é˜µï¼Œè¯¥ç´¢å¼•åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«è¡¨ç¤ºè¡Œå’Œåˆ—ï¼Œå¯ä»¥æ˜¾ç¤ºå¦‚ä¸‹ï¼š</font><font style="vertical-align: inherit;">
æˆ‘ä»¬è¿˜å¿…é¡»ç¡®å®šæ¯ä¸ªå—çš„çº¿ç¨‹æ•°ï¼Œä¾‹å¦‚tpbå’Œã€‚æ¯æ ¼å—æ•°ï¼Œä¾‹å¦‚bpgã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡†ç¼–å·ã€‚</font><font style="vertical-align: inherit;">
é‡è¦çš„æ˜¯è¦åœ¨æ­¤å¤„æ³¨æ„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šå½“å¿…é¡»åœ¨GPUä¸Šæ‰§è¡Œä»»ä½•è®¡ç®—æ—¶ï¼Œå¿…é¡»å°†ç›¸åº”çš„æ•°æ®ä¼ è¾“åˆ°GPUçš„å…¨å±€å†…å­˜ï¼Œç„¶åå¯ä»¥å°†è®¡ç®—ç»“æœä¼ è¾“å›ä¸»æœºã€‚è¿™äº›æ“ä½œæ˜¯ä½¿ç”¨</font><font style="vertical-align: inherit;">Python Numbaåº“ä¸­æä¾›</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">å’Œ</font><font style="vertical-align: inherit;">å‡½æ•°æ‰§è¡Œçš„</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<code>row = cuda.blockIdx.x * cuda.blockDim.x + cuda.threadIdx.x<br>
col = cuda.blockIdx.x * cuda.blockDim.x + cuda.threadIdx.x</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>cuda.to_device()</code><font style="vertical-align: inherit;"></font><code>copy_to_host()</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹æ˜¯é’ˆå¯¹CPUå’ŒGPUçš„æ­¤è§£å†³æ–¹æ¡ˆçš„å®ç°ã€‚</font><font style="vertical-align: inherit;">è¯·å‚é˜…ä¸¤ä¸ªæ¸…å•ä»¥äº†è§£åŒºåˆ«ã€‚</font></font><br>
<br>
<pre><code class="python hljs">c = np.zeroes(n)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n):<font></font>
    c[i] = a[i] + b[i]<font></font>
<span class="hljs-keyword">return</span> c</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPUçš„é¡ºåºå®ç°ã€‚</font></font></i><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> cuda <span class="hljs-comment">#  Nvidia    GPU </span>
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <font></font>
<font></font>
<span class="hljs-meta">@cuda.jit('void(float32[:], float32[:], float32[:])') #  Cuda </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cuda_addition</span>(<span class="hljs-params">a,b,c</span>):</span>
    <span class="hljs-string">"""     ."""</span>
    i = cuda.blockIdx.x * cuda.blockDim.x + cuda.threadIdx.x <span class="hljs-comment">#     </span>
    <span class="hljs-keyword">if</span> i &gt; c.size:
        <span class="hljs-keyword">return</span>
    c[i] = a[i]+b[i] <span class="hljs-comment">#Perform the addition</span><font></font>
 <font></font>
<span class="hljs-comment">#   </span><font></font>
device = cuda.get_current_device()<font></font>
<font></font>
<span class="hljs-comment">#     </span>
d_a = cuda.to_device(a)  <span class="hljs-comment">#      GPU</span>
d_b = cuda.to_device(b)  <span class="hljs-comment">#      GPU</span><font></font>
d_c = cuda.device_array_like(a)<font></font>
<font></font>
tpb = device.WARP_SIZE       <span class="hljs-comment">#blocksize     ,   = 32</span>
bpg = int(np.ceil((n)/tpb))  <span class="hljs-comment">#   </span><font></font>
<font></font>
cuda_addition[bpg, tpb](d_a, d_b, d_c) <span class="hljs-comment">#  </span><font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
c = d_c.copy_to_host()<font></font>
print(c)<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPUçš„å¹¶è¡Œå®ç° </font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.ä½¿ç”¨GPUä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªä½ç½®æ‰¾åˆ°3ä¸ªæœ€ç›¸ä¼¼çš„ä½ç½®</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ·±å…¥ç ”ç©¶ç†è®ºå’Œå®è·µä¹‹åï¼Œæˆ‘ä»¬è¿”å›åˆ°åŸå§‹ä»»åŠ¡ï¼šä½¿ç”¨GPUè®¡ç®—ä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªä½ç½®æ‰¾åˆ°å‰3ä¸ªç›¸ä¼¼ä½ç½®ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸»è¦æ€æƒ³æ˜¯æˆ‘ä»¬æœ‰nä¸ªä½ç½®ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†å¼€å§‹nä¸ªçº¿ç¨‹ã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªçº¿ç¨‹å°†ä¸å…¶ä»–çº¿ç¨‹å¹¶è¡Œä¸”ç‹¬ç«‹åœ°å·¥ä½œï¼Œä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªä½ç½®è®¡ç®—3ä¸ªæœ€ç›¸ä¼¼çš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªèŒä½å°†è´Ÿè´£ä¸€ä¸ªçº¿ç¨‹ã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> cuda <span class="hljs-comment"># Nvidia's GPU Library</span>
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np 
<span class="hljs-keyword">import</span> math <span class="hljs-comment">#  , ,   , Numpy    GPU</span>
<span class="hljs-keyword">import</span> random<font></font>
<font></font>
<span class="hljs-comment">#                   </span>
<span class="hljs-meta">@cuda.jit('void(float32[:,:],float32[:],int32[:],float32[:],int32[:],float32[:],int32[:])') # CUDA Just-in-time Compiler</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cuda_dist</span>(<span class="hljs-params">X,first_best_val,first_best_index,second_best_val,second_best_index,third_best_val,third_best_index</span>):</span>
    <span class="hljs-string">"""     ."""</span>
    <span class="hljs-comment">#    </span><font></font>
    row = cuda.blockIdx.x * cuda.blockDim.x + cuda.threadIdx.x;<font></font>
    <span class="hljs-keyword">if</span> ((row &gt;= n)): <span class="hljs-comment">#      </span>
        <span class="hljs-keyword">return</span>
    first_best_val[row] = SMALL <span class="hljs-comment">#       </span>
    first_best_index[row] = <span class="hljs-number">-1</span> <span class="hljs-comment">#        </span>
    second_best_val[row] = SMALL <span class="hljs-comment">#       </span>
    second_best_index[row] = <span class="hljs-number">-1</span> <span class="hljs-comment">#        </span>
    third_best_val[row] = SMALL <span class="hljs-comment">#       </span>
    third_best_index[row] = <span class="hljs-number">-1</span> <span class="hljs-comment">#        </span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n):
        <span class="hljs-keyword">if</span>(i==row): <span class="hljs-comment">#   </span>
            <span class="hljs-keyword">continue</span>
        <span class="hljs-comment">#     ,        numpy   GPU</span>
        tmp = <span class="hljs-number">0.0</span>
        magnitude1 = <span class="hljs-number">0.0</span>
        magnitude2 = <span class="hljs-number">0.0</span>
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(k):<font></font>
            tmp += X[row,j] * X[i,j]<font></font>
            magnitude1 += (X[row,j]* X[row,j])<font></font>
            magnitude2 += (X[i,j]* X[i,j])<font></font>
        tmp /= (math.sqrt(magnitude1)*math.sqrt(magnitude2)) <span class="hljs-comment">#    Dot_product(a,b) = a.b/(|a|*|b|)</span>
        <span class="hljs-keyword">if</span>(tmp&gt;=first_best_val[row]):<font></font>
            third_best_val[row] = second_best_val[row]<font></font>
            third_best_index[row] = second_best_index[row]<font></font>
            second_best_val[row] = first_best_val[row]<font></font>
            second_best_index[row] = first_best_index[row]<font></font>
            first_best_val[row] = tmp<font></font>
            first_best_index[row] = i<font></font>
        <span class="hljs-keyword">elif</span>(tmp&gt;=second_best_val[row]):<font></font>
            third_best_val[row] = second_best_val[row]<font></font>
            third_best_index[row] = second_best_index[row]<font></font>
            second_best_val[row] = tmp<font></font>
            second_best_index[row] = i<font></font>
        <span class="hljs-keyword">elif</span>(tmp&gt;third_best_val[row]):<font></font>
            third_best_val[row] = tmp<font></font>
            third_best_index[row] = i<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
device = cuda.get_current_device()<font></font>
<font></font>
d_x = cuda.to_device(X)<font></font>
d_first_val = cuda.device_array_like(first_val)<font></font>
d_first_index = cuda.device_array_like(first_index)<font></font>
d_second_val = cuda.device_array_like(second_val)<font></font>
d_second_index = cuda.device_array_like(second_index)<font></font>
d_third_val = cuda.device_array_like(third_val)<font></font>
d_third_index = cuda.device_array_like(third_index)<font></font>
<font></font>
<font></font>
tpb = device.WARP_SIZE       <span class="hljs-comment"># blocksize     </span>
bpg = int(np.ceil((n)/tpb))  <span class="hljs-comment">#   </span><font></font>
<font></font>
%time cuda_dist[bpg,tpb](d_x,d_first_val,d_first_index,d_second_val,d_second_index,d_third_val,d_third_index) <span class="hljs-comment">#  </span><font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
first_val = d_first_val.copy_to_host()<font></font>
<span class="hljs-keyword">print</span> (first_val[:<span class="hljs-number">10</span>]) <span class="hljs-comment">#  10 </span>
<span class="hljs-comment">#      </span><font></font>
first_index = d_first_index.copy_to_host()<font></font>
<span class="hljs-keyword">print</span> (first_index[:<span class="hljs-number">10</span>]) <span class="hljs-comment">#  10 </span>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPUã€œä»£ç çš„å®ç°ï¼Œç”¨äºæ‰¾åˆ°ä¸ç»™å®š</font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—¶é—´</font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">æœ€ç›¸ä¼¼çš„3ä¸ªä½ç½®</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
GPUä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªä½ç½®æŸ¥æ‰¾å‰3ä¸ªç›¸ä¼¼ä½ç½®æ‰€èŠ±è´¹çš„æ€»æ—¶é—´ä¸º481 msï¼ˆ0.5ç§’ï¼‰ã€‚</font><font style="vertical-align: inherit;">å°†æ•°æ®ä»è®¾å¤‡å¤åˆ¶åˆ°ä¸»æœºä»¥åŠä»ä¸»æœºå¤åˆ¶åˆ°è®¾å¤‡åˆèŠ±è´¹äº†20ç§’ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.ç»“è®º</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ä»»åŠ¡åœ¨CPUä¸Šçš„è§£å†³æ–¹æ¡ˆå¤§çº¦éœ€è¦2å¤©ï¼Œè€Œåœ¨GPUä¸Šçš„è§£å†³æ–¹æ¡ˆåˆ™åœ¨20.5ç§’å†…è§£å†³äº†ã€‚</font><font style="vertical-align: inherit;">ä»…ç”±äºä»»åŠ¡çš„æ€§è´¨ï¼Œæ‰æœ‰å¯èƒ½è¿™æ ·åšã€‚</font><font style="vertical-align: inherit;">æœç´¢â€œ Aâ€çš„3ä¸ªæœ€ç›¸ä¼¼ä½ç½®ä¸ä¾èµ–äºæœç´¢â€œ Bâ€çš„3ä¸ªæœ€ç›¸ä¼¼ä½ç½®ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åˆ©ç”¨äº†è¿™ä¸€äº‹å®ï¼Œå¹¶åº”ç”¨äº†GPUæä¾›çš„å¹¶è¡Œæ€§æ¥åŠ å¿«å¤„ç†é€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">è¯¥ç¤ºä¾‹è¿˜è¯´æ˜äº†å€ŸåŠ©åŠŸèƒ½å¼ºå¤§çš„GPUæœ€æ–¹ä¾¿åœ°è§£å†³äº†å“ªäº›ç±»å‹çš„ä»»åŠ¡ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.è‡´è°¢</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™é¡¹ç ”ç©¶æ˜¯åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Walmart Labs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MLPï¼ˆæœºå™¨å­¦ä¹ å¹³å°ï¼‰ä¸Šè¿›è¡Œçš„</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ„Ÿè°¢Ayush Kumarå¸®åŠ©ç®€åŒ–å·¥ä½œæµç¨‹ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN505558/index.html">Amazon DeepLensæ·±åº¦å­¦ä¹ ç›¸æœºã€‚è§£åŒ…ï¼Œè¿æ¥å’Œéƒ¨ç½²é¡¹ç›®</a></li>
<li><a href="../zh-CN505560/index.html">CSä¸­å¿ƒçš„äº§å“ç®¡ç†è®¡åˆ’çš„ç¬¬äºŒç»„ï¼šå­¦ç”Ÿæ€ä¹ˆè¯´</a></li>
<li><a href="../zh-CN505568/index.html">åœ¨Delphiä¸Šä½¿ç”¨ç®¡é“å’Œå…¶ä»–å°ä¸œè¥¿ä¼ è¾“æ–‡ä»¶</a></li>
<li><a href="../zh-CN505574/index.html">é€šè¿‡ç«äº‰æ€§ç¥ç»ç½‘ç»œåŠ å¼ºå­¦ä¹ </a></li>
<li><a href="../zh-CN505580/index.html">ä½¿ç”¨ç”µå­è¡¨æ ¼å’Œè®¡ç®—è½¯ä»¶è¿›è¡ŒNewsvendorå»ºæ¨¡</a></li>
<li><a href="../zh-CN505592/index.html">ä½¿ç”¨Androidä¸ºBK0010ç¼–ç¨‹</a></li>
<li><a href="../zh-CN505594/index.html">å¦‚ä½•å°†ç½‘ç«™è®¿é—®è€…è½¬å˜ä¸ºå®¢æˆ·ï¼šåˆ›å»ºæ½œåœ¨å®¢æˆ·è¡¨å•çš„æŒ‡å—</a></li>
<li><a href="../zh-CN505604/index.html">æˆç˜¾æ¼æ´</a></li>
<li><a href="../zh-CN505608/index.html">Vuex-ç”¨æ–°æ–¹æ³•è§£å†³æ—§äº‰è®®</a></li>
<li><a href="../zh-CN505612/index.html">MK-61ï¼šå†å²è®°å½•ï¼Œä»¿çœŸï¼Œè®¾å¤‡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>