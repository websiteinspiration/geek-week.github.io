<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌁 📆 👡 Raspberry Pi-Leistung: Fügen Sie ZRAM hinzu und ändern Sie die Kernelparameter 💪🏿 👂🏾 🤴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor ein paar Wochen habe ich eine Rezension von Pinebook Pro veröffentlicht . Da Raspberry Pi 4 ebenfalls auf ARM basiert, sind einige der im vorherig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi-Leistung: Fügen Sie ZRAM hinzu und ändern Sie die Kernelparameter</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504468/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor ein paar Wochen habe ich eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rezension von Pinebook Pro veröffentlicht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Da Raspberry Pi 4 ebenfalls auf ARM basiert, sind einige der im vorherigen Artikel erwähnten Optimierungen gut dafür geeignet. </font><font style="vertical-align: inherit;">Ich möchte diese Tricks teilen und herausfinden, ob Sie die gleichen Leistungsverbesserungen haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem </font><font style="vertical-align: inherit;">ich </font><font style="vertical-align: inherit;">Raspberry Pi in meinem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heimserverraum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> installiert </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">hatte,</font></a><font style="vertical-align: inherit;"> bemerkte ich, dass es in Zeiten von RAM-Mangel sehr nicht mehr reagierte und sogar hängen blieb. </font><font style="vertical-align: inherit;">Um dieses Problem zu lösen, habe ich ZRAM hinzugefügt und einige Änderungen an den Kernel-Parametern vorgenommen.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZRAM-Aktivierung auf Raspberry Pi</font></font></h1><br>
<img src="https://habrastorage.org/getpro/habr/post_images/032/270/fb0/032270fb0277cc21b3946def04336dfa.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZRAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erstellt einen Blockspeicher im RAM mit dem Namen / dev / zram0 (oder 1, 2, 3 usw.). </font><font style="vertical-align: inherit;">Die dort aufgezeichneten Seiten werden komprimiert und gespeichert. </font><font style="vertical-align: inherit;">Dies ermöglicht eine sehr schnelle E / A und macht aufgrund der Komprimierung auch Speicher frei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Raspberry Pi 4 verfügt über 1, 2, 4 oder 8 GB RAM. </font><font style="vertical-align: inherit;">Ich werde das 1-GB-Modell verwenden, also passen Sie die Anweisungen abhängig von Ihrem Modell an. </font><font style="vertical-align: inherit;">Mit 1 GB ZRAM wird die Standard-Auslagerungsdatei (langsam!) Weniger häufig verwendet. </font><font style="vertical-align: inherit;">Ich habe ein solches </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zram-Swap-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript </font><font style="vertical-align: inherit;">für die Installation und automatische Konfiguration verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anweisungen finden Sie im Repository unter dem obigen Link. </font><font style="vertical-align: inherit;">Installation:</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/foundObjects/zram-swap.git
<span class="hljs-built_in">cd</span> zram-swap &amp;&amp; sudo ./install.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die Konfiguration bearbeiten möchten:</font></font><br>
<br>
<pre><code class="bash hljs">vi /etc/default/zram-swap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus können Sie ZRAM durch Installation aktivieren </font></font><code>zram-tools</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie diese Methode verwenden, müssen Sie die Konfiguration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der Datei </font><b><font style="vertical-align: inherit;">bearbeiten</font></b></font><code>/etc/default/zramswap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ca. 1 GB ZRAM installieren:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install zram-tools</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Installation können Sie die ZRAM-Speicherstatistik mit dem folgenden Befehl anzeigen:</font></font><br>
<br>
<pre><code class="bash hljs">sudo cat /proc/swaps<font></font>
Filename				Type		Size	Used	Priority<font></font>
/var/swap                               file		102396	0	-2<font></font>
/dev/zram0                              partition	1185368	265472	5<font></font>
pi@raspberrypi:~ $</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinzufügen von Kernelparametern zur besseren Verwendung von ZRAM</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Korrigieren Sie nun das Verhalten des Systems, wenn der Raspberry Pi im letzten Moment auf Swap umschaltet, was häufig zu Einfrierungen führt. </font><font style="vertical-align: inherit;">Fügen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie der</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><b><font style="vertical-align: inherit;">/etc/sysctl.conf</font></b><font style="vertical-align: inherit;"> einige Zeilen </font><b><font style="vertical-align: inherit;">hinzu</font></b><font style="vertical-align: inherit;"> und </font><b><font style="vertical-align: inherit;">starten Sie</font></b><font style="vertical-align: inherit;"> den </font><b><font style="vertical-align: inherit;">Computer</font></b><font style="vertical-align: inherit;"> neu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Zeilen 1) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verzögern die unvermeidliche Erschöpfung des Speichers</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , erhöhen den Druck auf den Kernel-Cache und 2) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bereiten sich früher</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf die </font><b><font style="vertical-align: inherit;">Erschöpfung des Speichers vor</font></b><font style="vertical-align: inherit;"> und </font><font style="vertical-align: inherit;">initiieren im Voraus einen Austausch. </font><font style="vertical-align: inherit;">Aber es wird ein viel effizienterer Austausch von komprimiertem Speicher durch ZRAM sein! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sind die Zeilen, die am Ende der Datei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/sysctl.conf hinzugefügt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> werden müssen </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">vm.vfs_cache_pressure=500<font></font>
vm.swappiness=100<font></font>
vm.dirty_background_ratio=1<font></font>
vm.dirty_ratio=50</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann starten wir das System neu oder aktivieren die Änderungen mit dem folgenden Befehl:</font></font><br>
<br>
<pre><code class="bash hljs">sudo sysctl --system</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vm.vfs_cache_pressure = 500</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erhöht den Druck auf den Cache, wodurch die Tendenz des Kernels erhöht wird, den zum Zwischenspeichern von Verzeichnisobjekten und Indizes verwendeten Speicher zurückzugewinnen. Sie benötigen über einen längeren Zeitraum weniger Speicher. Ein starker Produktivitätsrückgang wird durch frühere Swaps zunichte gemacht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vm.swappiness = 100</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erhöht den Parameter, wie aggressiv der Kernel Speicherseiten austauscht, da wir zuerst ZRAM verwenden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vm.dirty_background_ratio = 1 &amp; vm.dirty_ratio = 50</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hintergrundprozesse beginnen sofort nach Erreichen des Grenzwerts von 1% mit der Aufzeichnung, aber das System erzwingt keine synchronen E / A, bis das Dirty_Ratio von 50% erreicht ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese vier Zeilen (bei Verwendung mit ZRAM) tragen zur Verbesserung der Leistung bei, wenn Ihnen </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zwangsläufig</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der Arbeitsspeicher ausgeht und Sie wie bei Swap auf Swap </font><font style="vertical-align: inherit;">umsteigen </font><font style="vertical-align: inherit;">. Wenn Sie diese Tatsache kennen und die Speicherkomprimierung im ZRAM berücksichtigen, ist es dreimal besser, diesen Austausch im Voraus zu starten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Druck auf den Cache hilft, weil wir dem Kernel tatsächlich sagen: "Hey, hör zu, ich habe keinen zusätzlichen Speicher für den Cache. Bitte entferne ihn so schnell wie möglich und behalte nur die am häufigsten verwendeten / wichtigen Daten."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selbst bei reduziertem Caching startet der Kernel einen opportunistischen Swap viel früher, wenn im Laufe der Zeit der größte Teil des installierten Speichers belegt ist, sodass der Prozessor (Komprimierung) und die Swap-E / A nicht bis zum letzten ziehen und alle Ressourcen gleichzeitig nutzen, wenn es zu spät ist. </font><font style="vertical-align: inherit;">ZRAM verwendet ein wenig CPU für die Komprimierung, aber auf den meisten Systemen mit wenig Speicher wirkt sich dies viel weniger auf die Leistung aus als ein Swap ohne ZRAM.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abschließend</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns das Ergebnis noch einmal an:</font></font><br>
<br>
<pre><code class="plaintext hljs">pi@raspberrypi:~ $ free -h<font></font>
total used free shared buff/cache available<font></font>
Mem: 926Mi 471Mi 68Mi 168Mi 385Mi 232Mi<font></font>
Swap: 1.2Gi 258Mi 999Mi<font></font>
<font></font>
pi@raspberrypi:~ $ sudo cat /proc/swaps <font></font>
Filename Type Size Used Priority<font></font>
/var/swap file 102396 0 -2<font></font>
/dev/zram0 partition 1185368 264448 5</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
264448 in ZRAM ist fast ein Gigabyte unkomprimierter Daten. </font><font style="vertical-align: inherit;">Alles ging an ZRAM und nichts kam in die viel langsamere Auslagerungsdatei. </font><font style="vertical-align: inherit;">Probieren Sie diese Einstellungen selbst aus, sie funktionieren bei allen Raspberry Pi-Modellen. </font><font style="vertical-align: inherit;">Mein ungeeignetes Gefriersystem hat sich in ein funktionsfähiges und stabiles System verwandelt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hoffe, dass ich diesen Artikel in naher Zukunft mit einigen Ergebnissen von Systemtests vor und nach der Installation von ZRAM fortsetzen und aktualisieren kann. </font><font style="vertical-align: inherit;">Jetzt habe ich einfach keine Zeit dafür. </font><font style="vertical-align: inherit;">In der Zwischenzeit können Sie gerne Ihre eigenen Tests durchführen und uns dies in den Kommentaren mitteilen. </font><font style="vertical-align: inherit;">Der Raspberry Pi 4 ist nur ein Biest mit solchen Einstellungen. </font><font style="vertical-align: inherit;">Geniesse es!</font></font><br>
<br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zu diesem Thema:</font></font></b><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux-Leistung: Warum müssen Sie fast immer den Swap-Speicherplatz vergrößern</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (2017) </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">?</font></a></font><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux-Leistung: Erhöhen Sie fast immer den Swap-Speicherplatz. </font><font style="vertical-align: inherit;">Teil 2: ZRAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (2020)</font></font></li>
</ul></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de504454/index.html">Beste GitHub-Repositories für Webentwickler</a></li>
<li><a href="../de504456/index.html">Isolieren Sie Entwicklungsumgebungen mit LXD-Containern</a></li>
<li><a href="../de504458/index.html">Installation von OpenCV-Python in einer virtuellen Umgebung für Superkessel</a></li>
<li><a href="../de504460/index.html">Über David Ogilvys Ogilvy-Werbebuch</a></li>
<li><a href="../de504464/index.html">Wie wir auf den TableAdapter gekommen sind und die Arbeit mit UITableView vereinfacht haben</a></li>
<li><a href="../de504472/index.html">Meine besten kostenlosen Entwicklertools</a></li>
<li><a href="../de504480/index.html">Wie finde ich einen Vermarkter, mit dem es sich lohnt, zusammenzuarbeiten?</a></li>
<li><a href="../de504482/index.html">Fragen Sie uns: DIT beantwortet Fragen</a></li>
<li><a href="../de504484/index.html">IPSec Allmächtig</a></li>
<li><a href="../de504486/index.html">Prozess: Erstellen von Vue 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>