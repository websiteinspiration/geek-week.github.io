<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦃 🌊 ✡️ ﻿PVS-Studioがクラウドに移行-Travis CIで分析を開始 😭 🦎 😫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="現在、クラウドCIシステムは非常に人気のあるサービスです。この記事では、PVS-Studioで利用可能な既存のツールを使用して、Travis CIサービスを例にソースコード分析をクラウドCIプラットフォームに統合する方法について説明します。
 
 
 
 サードパーティのクラウドを見て、独自のクラウ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>﻿PVS-Studioがクラウドに移行-Travis CIで分析を開始</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/458072/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在、クラウドCIシステムは非常に人気のあるサービスです。</font><font style="vertical-align: inherit;">この記事では、PVS-Studioで利用可能な既存のツールを使用して、Travis CIサービスを例にソースコード分析をクラウドCIプラットフォームに統合する方法について説明します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/252/191/ee125219104f0ff7d27f8c9dfc2db8bf.png" alt="写真1"></div><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サードパーティのクラウドを見て、独自のクラウドを作成しないのはなぜですか？理由はいくつかありますが、主な理由は、SaaSはかなり高価で難しい手順であることです。実際、PVS-Studio分析をサードパーティのクラウドプラットフォーム（CircleCI、Travis CI、GitLabなどのオープンプラットフォーム、または1つの特定の企業でのみ使用される特別なエンタープライズソリューション）に直接統合することは、かなり単純で簡単な作業です。つまり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioはすでに「クラウド内」で利用可能である</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と言え</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。完全に異なる問題は、このような作業を24時間年中無休で行うための組織とインフラストラクチャの提供です。これは完全に異なるタスクであり、PVS-Studioは、分析を実行するために独自のクラウドプラットフォームを直接提供する計画はありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用するソフトウェアに関する情報</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、GitHubをストレージとして使用するソフトウェアを構築およびテストするためのサービスです。</font><font style="vertical-align: inherit;">Travis CIでは、サービスを使用するためにプログラムコードを変更する必要はありません。すべての設定</font><font style="vertical-align: inherit;">は、リポジトリのルートにある</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.travis.yml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルで行われ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioを使用した検証用のテストプロジェクトとして、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LXC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux Containers）</font><font style="vertical-align: inherit;">を取り上げ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これは、単一のノードでLinuxオペレーティングシステムの複数のインスタンスを実行するためのオペレーティングシステムレベルの仮想化システムです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトは小規模ですが、実証するには十分です。</font><font style="vertical-align: inherit;">clocコマンドの出力：</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">言語</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブランク</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コメント</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">124</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11937</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6758</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50836</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C / C ++ヘッダー</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">65</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1117年</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3676</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3774</font></font><br>
</td>
</tr>
</tbody></table></div><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> LXC開発者はすでにTravis CIを使用しているため、設定ファイルをベースとして、目的に合わせて編集します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタマイズ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travis CIの</font><font style="vertical-align: inherit;">使用を</font><font style="vertical-align: inherit;">開始するに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、リンクをクリック</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、GitHubアカウントを使用して認証します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ba/8fc/c5a/1ba8fcc5a0caf41da255093cf4feaa8e.png" alt="写真17"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開いたウィンドウで、Travis CIを承認する必要があります。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/aec/13d/2d7aec13dec45022c952ff0498a6acae.png" alt="写真16"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
承認後、ウェルカムページ「初めてですか？</font><font style="vertical-align: inherit;">さあ、始めましょう！」</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開始するために次に行う必要があることを簡単に説明します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリをアクティブ化します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリに.travis.ymlファイルを追加します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のビルドを実行します。</font></font></li>
</ul><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29c/17f/c83/29c17fc830db9fad9d6d9dcb7fa047d7.png" alt="画像18"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのポイントを実行し始めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リポジトリをTravis CIに追加するに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、リンクから</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロファイル設定に移動し、</font><font style="vertical-align: inherit;">[アクティブ化]ボタンをクリックします。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab8/1f7/75e/ab81f775edc51c92b3238bf30b40527d.png" alt="写真19"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クリックするとウィンドウが開き、Travis CIアプリケーションにアクセスを許可するリポジトリを選択できます。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリへのアクセスを提供するには、アカウントにリポジトリへの管理者権限が必要です。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e8/4fe/351/1e84fe351a57fcff37b5b70ec77e9cc5.png" alt="画像38"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目的のリポジトリを選択し、[承認とインストール]ボタンで選択を確認すると、プロファイル設定ページにリダイレクトされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーライセンスファイルの作成とレポートの送信に使用する変数をすぐに作成します。</font><font style="vertical-align: inherit;">これを行うには、設定ページ-目的のリポジトリの右側にある[設定]ボタンに移動します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d35/f44/907/d35f449074bd079c1b35140dd8336173.png" alt="画像39"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設定ウィンドウが開きます。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfe/c5f/1a8/cfec5f1a8ea19bf2c6e9e63c7af4c68c.png" alt="画像41"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設定の簡単な説明：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクション「一般」-自動実行タスクのトリガーを設定します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクション「自動キャンセル」-自動キャンセルアセンブリを構成できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクション「環境変数」-資格情報、SSHキーなどの公開情報と機密情報の両方を含む環境変数を定義できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクション「Cron Jobs」-タスクの起動スケジュールを設定します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「環境変数」セクション</font><font style="vertical-align: inherit;">では、静的アナライザーのユーザー名とライセンスキーをそれぞれ含む</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS_USERNAME</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS_KEY</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を作成し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">恒久的なPVS-Studioライセンスがない場合は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、試用ライセンスをリクエスト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8aa/731/483/8aa731483fc391273980c7de338f83be.png" alt="写真5"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レポートの送信に使用するメールボックスのユーザー名とパスワードを含む</font><font style="vertical-align: inherit;">
変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAIL_USER</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAIL_PASSWORD</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">すぐに作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37d/a42/9b4/37da429b49812239ab900e3b6fe5a90d.png" alt="写真4"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクが起動すると、Travis CIはリポジトリのルートにある.travis.ymlファイルから指示を受け取ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travis CIを使用して、仮想マシンで直接静的分析を実行するか、事前に構成されたコンテナーを使用できます。これらのアプローチの結果は互いに違いはありませんが、たとえば、ソフトウェア製品が構築およびテストされている特定の環境を備えたコンテナーが既にあり、Travis CIでこの環境を復元する必要がない場合など、事前構成されたコンテナーを使用すると便利です。 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンでアナライザーを実行するための構成を作成してみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アセンブリとテストには、Ubuntu Trustyに基づく仮想マシンを使用します。その説明は</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ここで</font></a><font style="vertical-align: inherit;">確認でき</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、プロジェクトがCで記述されていることを示し、アセンブリに使用するコンパイラをリストします。</font></font><br>
<br>
<pre><code class="cpp hljs">language: c<font></font>
compiler:<font></font>
 - gcc<font></font>
 - clang</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：複数のコンパイラを指定した場合、タスクはそれぞれに対して並列に起動されます。</font><font style="vertical-align: inherit;">詳細について</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をご覧ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビルドを開始する前に、アナライザーリポジトリを追加し、依存関係と追加パッケージをインストールする必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs">before_install:<font></font>
 - sudo add-apt-repository ppa:ubuntu-lxc/daily -y<font></font>
 - wget -q -O - https:<span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add -</span>
 - sudo wget -O /etc/apt/sources.<span class="hljs-built_in">list</span>.d/viva64.<span class="hljs-built_in">list</span>
              https:<span class="hljs-comment">//files.viva64.com/etc/viva64.list</span><font></font>
 - sudo apt-get update -qq<font></font>
 - sudo apt-get install -qq coccinelle parallel <font></font>
       libapparmor-dev libcap-dev libseccomp-dev<font></font>
       python3-dev python3-setuptools docbook2x<font></font>
       libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio<font></font>
       libio-socket-ssl-perl libnet-ssleay-perl sendemail <font></font>
       ca-certificates</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトをアセンブルする前に、環境を準備する必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs">script:<font></font>
 - ./coccinelle/run-coccinelle.sh -i<font></font>
 - git diff --<span class="hljs-built_in">exit</span>-code<font></font>
 - <span class="hljs-keyword">export</span> CFLAGS=<span class="hljs-string">"-Wall -Werror"</span>
 - <span class="hljs-keyword">export</span> LDFLAGS=<span class="hljs-string">"-pthread -lpthread"</span><font></font>
 - ./autogen.sh<font></font>
 - rm -Rf build<font></font>
 - mkdir build<font></font>
 - cd build<font></font>
 - ../configure --enable-tests --with-distro=unknown</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ライセンスを含むファイルを作成し、プロジェクト分析を実行する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のコマンドは、アナライザーのライセンスファイルを作成します。</font><font style="vertical-align: inherit;">変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ PVS_USERNAME</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ PVS_KEY</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のデータは</font><font style="vertical-align: inherit;">、プロジェクト設定から取得されます。</font></font><br>
<br>
<pre><code class="cpp hljs">- pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドは、プロジェクトアセンブリのトレースを開始します。</font></font><br>
<br>
<pre><code class="cpp hljs">- pvs-studio-analyzer trace -- make -j4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
静的解析を開始した後。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">試用版ライセンスを使用する場合は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-disableLicenseExpirationCheck</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターを指定する必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"> - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic <font></font>
   -o PVS-Studio-${CC}.<span class="hljs-built_in">log</span> 
   –-disableLicenseExpirationCheck</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のコマンドで、アナライザーの結果ファイルがHTMLレポートに変換されます。</font></font><br>
<br>
<pre><code class="cpp hljs">- plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in">log</span> 
                 -o PVS-Studio-${CC}.html</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TravisCIでは電子メール通知の形式を変更できないため、最後のステップでsendemailパッケージを使用してレポートを送信します。</font></font><br>
<br>
<pre><code class="cpp hljs">- sendemail -t mail@domain.com <font></font>
            -u <span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span> 
            -m <span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span> 
            -s smtp.gmail.com:<span class="hljs-number">587</span> <font></font>
            -xu $MAIL_USER <font></font>
            -xp $MAIL_PASSWORD <font></font>
            -o tls=yes <font></font>
            -f $MAIL_USER <font></font>
            -a PVS-Studio-${CC}.<span class="hljs-built_in">log</span> PVS-Studio-${CC}.html</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンでアナライザーを実行するための構成ファイルの全文：</font></font><br>
<br>
<pre><code class="cpp hljs">language: c<font></font>
compiler:<font></font>
 - gcc<font></font>
 - clang<font></font>
before_install:<font></font>
 - sudo add-apt-repository ppa:ubuntu-lxc/daily -y<font></font>
 - wget -q -O - https:<span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add -</span>
 - sudo wget -O /etc/apt/sources.<span class="hljs-built_in">list</span>.d/viva64.<span class="hljs-built_in">list</span>
          https:<span class="hljs-comment">//files.viva64.com/etc/viva64.list</span><font></font>
 - sudo apt-get update -qq<font></font>
 - sudo apt-get install -qq coccinelle parallel <font></font>
         libapparmor-dev libcap-dev libseccomp-dev<font></font>
         python3-dev python3-setuptools docbook2x <font></font>
         libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio<font></font>
         libio-socket-ssl-perl libnet-ssleay-perl sendemail <font></font>
         ca-certificates<font></font>
<font></font>
script:<font></font>
 - ./coccinelle/run-coccinelle.sh -i<font></font>
 - git diff --<span class="hljs-built_in">exit</span>-code<font></font>
 - <span class="hljs-keyword">export</span> CFLAGS=<span class="hljs-string">"-Wall -Werror"</span>
 - <span class="hljs-keyword">export</span> LDFLAGS=<span class="hljs-string">"-pthread -lpthread"</span><font></font>
 - ./autogen.sh<font></font>
 - rm -Rf build<font></font>
 - mkdir build<font></font>
 - cd build<font></font>
 - ../configure --enable-tests --with-distro=unknown<font></font>
 - pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic<font></font>
 - pvs-studio-analyzer trace -- make -j4<font></font>
 - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic <font></font>
     -o PVS-Studio-${CC}.<span class="hljs-built_in">log</span> <font></font>
     --disableLicenseExpirationCheck<font></font>
 - plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in">log</span> -o PVS-Studio-${CC}.html<font></font>
<font></font>
 - sendemail -t mail@domain.com <font></font>
             -u <span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span> 
             -m <span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span> 
             -s smtp.gmail.com:<span class="hljs-number">587</span> <font></font>
             -xu $MAIL_USER <font></font>
             -xp $MAIL_PASSWORD <font></font>
             -o tls=yes <font></font>
             -f $MAIL_USER <font></font>
             -a PVS-Studio-${CC}.<span class="hljs-built_in">log</span> PVS-Studio-${CC}.html </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテナーで静的アナライザーを実行するには、まず次のDockerfileを使用して静的アナライザーを作成します。</font></font><br>
<br>
<pre><code class="cpp hljs">FROM docker.io/ubuntu:trusty<font></font>
<font></font>
ENV CFLAGS=<span class="hljs-string">"-Wall -Werror"</span>
ENV LDFLAGS=<span class="hljs-string">"-pthread -lpthread"</span><font></font>
<font></font>
RUN apt-get update &amp;&amp; apt-get install -y software-properties-common wget \<font></font>
    &amp;&amp; wget -q -O - https:<span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | </span><font></font>
        sudo apt-key add - \<font></font>
    &amp;&amp; wget -O /etc/apt/sources.<span class="hljs-built_in">list</span>.d/viva64.<span class="hljs-built_in">list</span>
       https:<span class="hljs-comment">//files.viva64.com/etc/viva64.list \</span><font></font>
    &amp;&amp; apt-get update \<font></font>
    &amp;&amp; apt-get install -yqq coccinelle parallel <font></font>
       libapparmor-dev libcap-dev libseccomp-dev<font></font>
       python3-dev python3-setuptools docbook2x<font></font>
       libgnutls-dev libselinux1-dev linux-libc-dev<font></font>
       pvs-studio git libtool autotools-dev automake<font></font>
       pkg-config clang make libio-socket-ssl-perl <font></font>
       libnet-ssleay-perl sendemail ca-certificates \<font></font>
    &amp;&amp; rm -rf /var/lib/apt/lists<span class="hljs-comment">/*</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、構成ファイルは次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">before_install:<font></font>
- docker pull docker.io/oandreev/lxc<font></font>
<font></font>
env:<font></font>
 - CC=gcc<font></font>
 - CC=clang<font></font>
<font></font>
script:<font></font>
 - docker run <font></font>
    --rm <font></font>
    --cap-add SYS_PTRACE <font></font>
    -v $(pwd):/pvs <font></font>
    -w /pvs <font></font>
    docker.io/oandreev/lxc<font></font>
    /bin/bash -c <span class="hljs-string">" ./coccinelle/run-coccinelle.sh -i
                  &amp;&amp; git diff --exit-code
                  &amp;&amp; ./autogen.sh
                  &amp;&amp; mkdir build &amp;&amp; cd build
                  &amp;&amp; ../configure CC=$CC
                  &amp;&amp; pvs-studio-analyzer credentials 
                     $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic
                  &amp;&amp; pvs-studio-analyzer trace -- make -j4
                  &amp;&amp; pvs-studio-analyzer analyze -j2 
                     -l PVS-Studio.lic 
                     -o PVS-Studio-$CC.log 
                     --disableLicenseExpirationCheck
                  &amp;&amp; plog-converter -t html 
                     -o PVS-Studio-$CC.html
                     PVS-Studio-$CC.log 
                      
                  &amp;&amp; sendemail -t mail@domain.com 
             -u 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' 
             -m 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' 
             -s smtp.gmail.com:587 
             -xu $MAIL_USER -xp $MAIL_PASSWORD
             -o tls=yes -f $MAIL_USER
             -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、この場合、仮想マシン内では何も実行されておらず、プロジェクトのアセンブルとテストのためのすべてのアクションはコンテナ内で行われます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：コンテナーの開始時に</font><font style="vertical-align: inherit;">は、ptraceシステムコールを使用してトレースをコンパイルするため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-cap-add SYS_PTRACEパラメーター</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--security-opt seccomp：</font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">unconfinedパラメーターを</font></i><font style="vertical-align: inherit;">指定する必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成ファイルをリポジトリーのルートにロードし、Travis CIがプロジェクト内の変更の存在に関する通知を受け取り、自動的にアセンブリーを開始したことを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アセンブリの進行状況とアナライザーによる検証の詳細情報は、コンソールで確認できます。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/00a/846/95d/00a84695de9e00013c89760219f5292e.png" alt="写真2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストが完了すると、メールで2通の手紙が届きます。1つはgccを使用してプロジェクトをビルドするための静的分析の結果、もう1つはclangの手紙です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト結果について簡単に</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、プロジェクトは非常にクリーンで、アナライザーは重大な警告を24件、平均的な警告を46件だけ発行しました。</font><font style="vertical-align: inherit;">作業を示すために、いくつかの興味深い通知を検討してください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifの冗長条件</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V590</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ret！=（-1）&amp;&amp; ret == 1」式の検査を検討してください。</font><font style="vertical-align: inherit;">表現が過剰であるか、誤植が含まれています。</font><font style="vertical-align: inherit;">attach.c 107</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EOF -1</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> struct lxc_proc_context_info *<span class="hljs-title">lxc_proc_get_context_info</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">while</span> (getline(&amp;line, &amp;line_bufsz, proc_file) != <span class="hljs-number">-1</span>)<font></font>
  {<font></font>
    ret = <span class="hljs-built_in">sscanf</span>(line, <span class="hljs-string">"CapBnd: %llx"</span>, &amp;info-&gt;capability_mask);
    <span class="hljs-keyword">if</span> (ret != EOF &amp;&amp; ret == <span class="hljs-number">1</span>) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      found = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
場合</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RET == 1は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それは間違い-1（EOF）等しくありません。</font><font style="vertical-align: inherit;">過剰な検証、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret！= EOF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は削除できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに2つの警告が発行されました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V590「ret！=（-1）&amp;&amp; ret == 1」式の検査を検討してください。</font><font style="vertical-align: inherit;">式が過剰であるか、誤植が含まれています。</font><font style="vertical-align: inherit;">attach.c 579</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V590「ret！=（-1）&amp;&amp; ret == 1」式の検査を検討してください。</font><font style="vertical-align: inherit;">式が過剰であるか、誤植が含まれています。</font><font style="vertical-align: inherit;">attach.c 583</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上位ビットの損失</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V784</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットマスクのサイズが第1オペランドのサイズより小さいです。</font><font style="vertical-align: inherit;">これにより、上位ビットが失われます。</font><font style="vertical-align: inherit;">conf.c 1879</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mount_opt</span>
{</span>
  <span class="hljs-keyword">char</span> *name;
  <span class="hljs-keyword">int</span> clear;
  <span class="hljs-keyword">int</span> flag;<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parse_mntopt</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *opt, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> *flags,
                         <span class="hljs-keyword">char</span> **data, <span class="hljs-keyword">size_t</span> size)</span>
</span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mount_opt</span> *<span class="hljs-title">mo</span>;</span><font></font>
<font></font>
  <span class="hljs-comment">/* If opt is found in mount_opt, set or clear flags.
   * Otherwise append it to data. */</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span> (mo = &amp;mount_opt[<span class="hljs-number">0</span>]; mo-&gt;name != <span class="hljs-literal">NULL</span>; mo++)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strncmp</span>(opt, mo-&gt;name, <span class="hljs-built_in">strlen</span>(mo-&gt;name)) == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (mo-&gt;clear)<font></font>
      {<font></font>
        *flags &amp;= ~mo-&gt;flag;    <span class="hljs-comment">// &lt;=</span><font></font>
      }<font></font>
      <span class="hljs-keyword">else</span><font></font>
      {<font></font>
        *flags |= mo-&gt;flag;<font></font>
      }<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linuxでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">long</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は64ビット整数変数、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mo-&gt;フラグ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は32ビット整数変数です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mo-&gt;フラグ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をビットマスクとして</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">すると、32の上位ビットが失われます。</font><font style="vertical-align: inherit;">ビット単位の反転が実行された後のビットマスクの64ビット整数変数への暗黙的なキャスト。</font><font style="vertical-align: inherit;">このマスクの上位ビットはゼロになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例を使って説明します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> x;
<span class="hljs-keyword">unsigned</span> y;<font></font>
....<font></font>
x &amp;= ~y;</code></pre><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a3/59f/a71/1a359fa7163d8a99c8632ffc17cf7eb0.png" alt="写真3"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正しいコードは次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs">*flags &amp;= ~(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)(mo-&gt;flag);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは別の同様の警告を出しました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V784ビットマスクのサイズが第1オペランドのサイズより小さいです。</font><font style="vertical-align: inherit;">これにより、上位ビットが失われます。</font><font style="vertical-align: inherit;">conf.c 1933</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不審なサイクル</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V612</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループ内の無条件の「戻り」。</font><font style="vertical-align: inherit;">conf.c 3477</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> lxc_list_for_each(__iterator, __list) \
  for (__iterator = (__list)-&gt;next; __iterator != __list; \
          __iterator = __iterator-&gt;next)</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">verify_start_hooks</span><span class="hljs-params">(struct lxc_conf *conf)</span>
</span>{
  <span class="hljs-keyword">char</span> path[PATH_MAX];
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">lxc_list</span> *<span class="hljs-title">it</span>;</span><font></font>
<font></font>
  lxc_list_for_each (it, &amp;conf-&gt;hooks[LXCHOOK_START]) {<font></font>
    <span class="hljs-keyword">int</span> ret;
    <span class="hljs-keyword">char</span> *hookname = it-&gt;elem;<font></font>
<font></font>
    ret = <span class="hljs-built_in">snprintf</span>(path, PATH_MAX, <span class="hljs-string">"%s%s"</span>,<font></font>
             conf-&gt;rootfs.path ? conf-&gt;rootfs.mount : <span class="hljs-string">""</span>,<font></font>
             hookname);<font></font>
    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span> || ret &gt;= PATH_MAX)
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
    ret = access(path, X_OK);<font></font>
    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {<font></font>
      SYSERROR(<span class="hljs-string">"Start hook \"%s\" not found in container"</span>,<font></font>
         hookname);<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイクルが開始され、最初の反復で中断されます。</font><font style="vertical-align: inherit;">おそらくこれは意図されたものですが、このサイクルは省略できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列の境界を超える</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アレイのアンダーランが可能です。</font><font style="vertical-align: inherit;">「bytes-1」インデックスの値は-1に達する可能性があります。</font><font style="vertical-align: inherit;">network.c 2570</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">lxc_create_network_unpriv_exec</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *lxcpath,
                                          <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *lxcname,
                                          struct lxc_netdev *netdev, 
                                          <span class="hljs-keyword">pid_t</span> pid,
                                          <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hooks_version)</span>
</span>{
  <span class="hljs-keyword">int</span> bytes;
  <span class="hljs-keyword">char</span> buffer[PATH_MAX] = {<span class="hljs-number">0</span>};<font></font>
  ....<font></font>
  bytes = lxc_read_nointr(pipefd[<span class="hljs-number">0</span>], &amp;buffer, PATH_MAX);
  <span class="hljs-keyword">if</span> (bytes &lt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    SYSERROR(<span class="hljs-string">"Failed to read from pipe file descriptor"</span>);<font></font>
    close(pipefd[<span class="hljs-number">0</span>]);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    buffer[bytes - <span class="hljs-number">1</span>] = <span class="hljs-string">'\0'</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バイトはパイプからバッファに読み込まれます。</font><font style="vertical-align: inherit;">エラーが発生した場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lxc_read_nointr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">は負の値を返します。</font><font style="vertical-align: inherit;">すべてがうまくいった場合、最後の要素としてnullターミナルが書き込まれます。</font><font style="vertical-align: inherit;">ただし、0バイトが読み取られると、バッファーが境界外になり、未定義の動作が発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは別の同様の警告を出しました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V557アレイのアンダーランが可能です。</font><font style="vertical-align: inherit;">「bytes-1」インデックスの値は-1に達する可能性があります。</font><font style="vertical-align: inherit;">network.c 2725</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファオーバーフロー</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V576</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式が正しくあり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ません</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">「sscanf」関数の3番目の実引数を確認することを検討してください。</font><font style="vertical-align: inherit;">幅を指定せずに文字列指定子を使用するのは危険です。</font><font style="vertical-align: inherit;">バッファオーバーフローの可能性があります。</font><font style="vertical-align: inherit;">lxc_unshare.c 205</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">lookup_user</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *oparg, <span class="hljs-keyword">uid_t</span> *uid)</span>
</span>{
  <span class="hljs-keyword">char</span> name[PATH_MAX];<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sscanf</span>(oparg, <span class="hljs-string">"%u"</span>, uid) &lt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-comment">/* not a uid -- perhaps a username */</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sscanf</span>(oparg, <span class="hljs-string">"%s"</span>, name) &lt; <span class="hljs-number">1</span>) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-built_in">free</span>(buf);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この場合に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sscanf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">
使用</font><font style="vertical-align: inherit;">すると危険な場合があります</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。oparq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファー</font><font style="vertical-align: inherit;">の長さが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファーの長さより大きい</font><font style="vertical-align: inherit;">場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファーが形成されるときに</font><i><font style="vertical-align: inherit;">oparq</font></i><font style="vertical-align: inherit;">バッファー</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">海外に移動するため</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見てきたように、クラウドでのプロジェクトの静的コードアナライザーチェックの設定は、かなり単純なタスクです。</font><font style="vertical-align: inherit;">これを行うには、1つのファイルをリポジトリに追加し、CIシステムの設定に最小限の時間を費やすだけです。</font><font style="vertical-align: inherit;">その結果、書き込みの段階で問題のあるコードを特定でき、エラーがテストの次の段階に進むことを許可しないツールが得られます。テストの次の段階では、修正に多くの時間とリソースがかかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、クラウドプラットフォームでのPVS-Studioの使用はTravis CIに限定されません。</font><font style="vertical-align: inherit;">PVS-Studio分析は、記事で説明した方法と同様に、最小限の違いで、CircleCI、GitLabなどの他の一般的なクラウドベースのCIソリューションと統合できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">役立つリンク</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinuxおよびMacOSでのPVS-Studioの起動に関する追加情報は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio静的アナライザーがインストールされたコンテナーの作成、構成、および使用については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TravisCIドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Oleg Andreev。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio in the Clouds-Travis CIでの分析の実行</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458050/index.html">メビウス2019パイターはいかがでしたか（そして次のメビウスについて少し）</a></li>
<li><a href="../ja458052/index.html">HabrによるAMA 10。最後の*問題</a></li>
<li><a href="../ja458060/index.html">Unityエンジンでグラスシェーダーを作成する</a></li>
<li><a href="../ja458062/index.html">UserGateプラットフォームの概要</a></li>
<li><a href="../ja458070/index.html">﻿PVS-Studio for Visual Studio</a></li>
<li><a href="../ja458074/index.html">言語を選択：ORMの選択</a></li>
<li><a href="../ja458080/index.html">7月25日、モスクワ-QIWI iOS Meetup</a></li>
<li><a href="../ja458084/index.html">ミュージシャンの収入、ゲームや映画のサウンド、珍しい楽器、そして忘れられがちな古い楽器に関する50の厳選された資料</a></li>
<li><a href="../ja458088/index.html">古いコンピューターに最適なLinuxディストリビューション</a></li>
<li><a href="../ja458090/index.html">失踪したマレーシアのボーイングに実際に何が起こったのか（パート2/3）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>