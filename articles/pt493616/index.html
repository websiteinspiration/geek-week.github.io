<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∂ üêç üêÆ Imagens como caixas - o que h√° dentro? Relat√≥rio em Yandex ‚ùÑÔ∏è üéº üíÖüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fotos e v√≠deos s√£o "caixas pretas", nas quais h√° muitas coisas interessantes e incompreens√≠veis. Mas voc√™ pode olhar dentro de alguns formatos, mudar ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Imagens como caixas - o que h√° dentro? Relat√≥rio em Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/493616/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fotos e v√≠deos s√£o "caixas pretas", nas quais h√° muitas coisas interessantes e incompreens√≠veis. </font><font style="vertical-align: inherit;">Mas voc√™ pode olhar dentro de alguns formatos, mudar tudo l√° e ver o que acontece. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Polina Gurtovaya, da empresa Evil Marcianos, falou em nossa confer√™ncia </font></font><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I&nbsp; </font></font><img src="https://habrastorage.org/webt/jq/7k/7w/jq7k7wi7p_23g0_clzmrmlgri7y.jpeg" width="20"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;Frontend</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">em fevereiro. </font><font style="vertical-align: inherit;">Com a ajuda do experimento, Polina descobriu como transformar imagens simples em "imagens efetivas" com m√©tricas. </font><font style="vertical-align: inherit;">As ferramentas que podem fazer isso por n√≥s, Polina examinou mais perto do final do relat√≥rio. </font><font style="vertical-align: inherit;">O resultado foi uma grande excurs√£o ao interior e aos princ√≠pios de opera√ß√£o de v√°rios formatos: de PNG e JPEG a AV1 e ex√≥ticos.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/CMlXUS6e46w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Ol√° a todos. </font><font style="vertical-align: inherit;">Meu nome √© Polina, sou a frente da empresa "Evil Marcianos".</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez voc√™ conhe√ßa marcianos de nossas muitas fontes abertas. Eu vou falar um pouco sobre ele mais tarde. E provavelmente devo dizer que ainda estamos desenvolvendo produtos, e n√£o apenas vendo c√≥digo aberto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ck/cs/gx/ckcsgxe6gmebfvkdo2rux-lwwgy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os materiais para o relat√≥rio estar√£o dispon√≠veis para voc√™ atrav√©s de um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maravilhoso </font><font style="vertical-align: inherit;">no reposit√≥rio no GitHub. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/km/90/d2/km90d2teg2yhoqpn4y7xs9x1ryq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos falar um pouco sobre otimiza√ß√£o. Quando lidamos com eles, o problema √© que eles funcionam bem se entendermos o que estamos fazendo. Se n√£o entendermos, isso acaba mal. Infelizmente, quando se trata de otimiza√ß√£o de imagens, tudo aqui n√£o √© muito legal. Podemos n√£o otimizar as imagens e, em seguida, haver√° monstros de dois metros no produto, √© tudo triste e triste.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se otimizarmos, o que estamos fazendo? Pensamos: aqui temos uma foto, isso √© algum tipo de caixa preta misteriosa, e o programa otimizador faz algo com essa foto, algum tipo de xamanismo preto. A qualidade da otimiza√ß√£o que obtemos √© um pouco duvidosa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4g/hr/bv/4ghrbv-nnuqbug7iz0qavj4frma.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos um exemplo. Eu tenho um gato no formato PNG. Eu acho que precisamos otimiz√°-lo. O que eu estou fazendo? Crio uma vers√£o WebP e cuidadosamente coloco as duas imagens em uma tag &lt;picture&gt;. Voc√™ acha que estou bem aqui ou n√£o? Por que h√° t√£o poucas m√£os? Estou muito bem feito! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fiz tudo certo, mas a vers√£o WebP ficou dois kilobytes a mais que a original. Isso n√£o √© o que eu queria.‚Ä®</font></font><br>
<br>
<img src="https://habrastorage.org/webt/li/4r/hc/li4rhcov7blg4uquvq54dhmrrk8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra otimiza√ß√£o, tentativa n√∫mero 2. Eu tenho um pequeno recipiente na p√°gina e um gato grande e grande. Eu quero colocar um gato grande em um pequeno recipiente. O que eu estou fazendo? Estou redimensionando porque √© est√∫pido direcionar bytes pela rede se o tamanho do meu cont√™iner for pequeno. Obviamente, levo em considera√ß√£o a propor√ß√£o de pixels do dispositivo. Voc√™ acha que estou indo bem aqui ou n√£o? Terminei! E olha o que eu fiz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estou usando a biblioteca libvips. Ela √© muito legal e popular, e do meu enorme e feliz gato leve, eu tenho um gato pequeno e muito pesado. O selo aumentou 2,5 vezes (em bytes) durante o redimensionamento (em pixels). Legal, sim?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rv/81/vf/rv81vftipmbdmz3opezzn42k6yw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, para que isso n√£o aconte√ßa conosco, entendamos como otimizar nossas imagens para nossa tarefa e, em geral, para que pelo menos entendamos o que est√° acontecendo, vamos olhar para a caixa e entender o que est√° dentro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ur/8y/tn/ur8ytn4gri-ezcgsvsxsulwbc10.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos come√ßar olhando para um formato t√£o interessante como PNG. Em torno de cada site, um pequeno peengshechka est√° escondido em algum lugar. Desta vez. Portanto, eles devem ser entendidos. Segundo: PNG - formato de compacta√ß√£o sem perdas. Isso significa que garantimos uma combina√ß√£o perfeita com o original em pixels, mas, ao mesmo tempo, somos limitados por natureza, n√£o podemos comprimir menos do que quanto.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-2/sp/r0/-2spr0e9x6o0qirw1n5fg__zkkk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peengeshka se dobra em um recipiente, como qualquer formato de imagem. Uma das primeiras coisas que precisamos dizer ao programa se ele l√™ tudo √© o que est√° dentro. Se voc√™ assumir que seus decodificadores determinam imagens por extens√£o, isso n√£o √© verdade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengashka relata que √© PNG, os primeiros oito bytes em seu cont√™iner. Diz "PNG". Al√©m disso - novamente, isso √© caracter√≠stico de qualquer cont√™iner - voc√™ tem um layout de peda√ßos. Ou seja, as informa√ß√µes s√£o agrupadas em peda√ßos, elas s√£o de alguma forma organizadas. Como - define o cont√™iner. Em PNG, fica assim: voc√™ tem quatro bytes respons√°veis ‚Äã‚Äãpelo comprimento e quatro bytes respons√°veis ‚Äã‚Äãpelo tipo de peda√ßo. Que tipos - falaremos um pouco mais tarde. ‚Ä®</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o peda√ßo tiver um comprimento diferente de zero, ele ter√° uma carga √∫til. Al√©m disso, existe uma soma de verifica√ß√£o. Voc√™ est√° verificando se alguma coisa foi batida l√°. Em seguida, v√™m os seguintes blocos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tw/-1/49/tw-1499ut7u6w6fl6rhas8tyk3m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisar n√£o apenas um arquivo PNG, mas quase qualquer um √© bastante f√°cil. Veja o FileReader, esta √© uma API do navegador. Lemos o arquivo usando o FileReader. Assim que lemos, cortamos esse arquivo em peda√ßos. N√£o fornecerei aqui o c√≥digo da fun√ß√£o split to chunks, mas voc√™ pode adivinhar que existe uma combina√ß√£o complexa de if e for. ‚Ä®</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n7/bg/sb/n7bgsbtsscwv-prpt2atx7a18d4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, n√≥s cortamos, vamos ver o que acontece. Temos v√°rios tipos de peda√ßos, e eles s√£o muito, muito caracter√≠sticos de quase qualquer formato. O primeiro √© chamado IHDR. H√° v√°rios peda√ßos chamados IDATs. Esses nomes podem parecer um pouco estranhos para voc√™, mas agora vamos descobrir o que √©. Quando tudo termina, vemos o peda√ßo final.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y0/pc/b6/y0pcb6n_4f4uiuakytlvwzla3ao.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos dar uma olhada mais de perto nos peda√ßos. O IHDR √© um meta-peda√ßo, e quase todas as figuras t√™m esse meta-peda√ßo. √â chamado de forma diferente, √© organizado de forma diferente, mas √© mais prov√°vel. Sem ele, seu descompressor - algo que mostra peengeshki ou n√£o peengeshki - n√£o pode mostrar nada. O que h√° nesse peda√ßo? Novamente, o conte√∫do √© t√≠pico para a maioria dos formatos. Esta √© a altura e a largura. A altura e a largura s√£o costuradas no seu arquivo, trata-se de voc√™. Em seguida, aparecem os sinalizadores de panache t√≠picos: bitDepth, colorType e entrela√ßamento. ‚Ä®</font></font><br>
<img src="https://habrastorage.org/webt/cj/ry/k3/cjryk3bpfhzf--zu_vofzg1vdcc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de falarmos sobre o que essas bandeiras significam e por que s√£o muito, muito importantes para n√≥s, vamos ver como armazenamos pixels em pangshes. Nas peaneshs, os pixels s√£o armazenados dentro de um peda√ßo chamado IDAT. Em um bom cen√°rio, os pixels s√£o um certo n√∫mero de n√∫meros compactados em um peda√ßo, e esse peda√ßo √© compactado pelo algoritmo de compacta√ß√£o Deflate. Quem usou o algoritmo de compacta√ß√£o Deflate? Ok, quando foi a √∫ltima vez que voc√™ compactou alguma coisa? Voc√™ sabia que Deflate √© gzip? Ent√£o eu acho - muitos o usaram.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas no peengeshah, outra coisa interessante aparece, usada em um grande n√∫mero de formatos, mas provavelmente em todos. Esse dispositivo √© chamado de codifica√ß√£o preditiva. O fato √© que nossas imagens n√£o s√£o pixels aleat√≥rios. O que √© pintado em nossa pequena imagem est√° de alguma forma conectado. Existem algumas √°reas escuras, √°reas claras e assim por diante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos tentando explorar esse fato e, em vez de armazenar o valor de pixel nessas c√©lulas azuis, estamos tentando prever esses pixels com base nos anteriores. Em PNG, essas previs√µes s√£o muito simples e s√£o empacotadas no primeiro byte antes da linha com pixels. Uma previs√£o pode ser assim, por exemplo, n√£o vamos prever nada e apenas colocar tudo como est√°. Ou, por exemplo, podemos dizer o seguinte: mas vamos manter apenas a diferen√ßa entre o pixel atual e o pixel anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ tiver a mesma cor na sua linha, todos os zeros ter√£o tudo, tudo ser√° perfeitamente comprimido, isso √© muito legal.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/ut/zh/jqutzhlx2vsbyxrbpbuogts9vbq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas agora vamos falar sobre o que um pixel realmente significa. Um pixel aparece em uma peengesh como um n√∫mero de n√∫meros. Ao manipular quantos n√∫meros existem, voc√™ pode compactar com muita for√ßa o PNG - tr√™s vezes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que op√ß√µes existem? O primeiro √© True Color e alfa. Temos tr√™s canais, tr√™s cores, tr√™s n√∫meros por cor. Al√©m de um canal respons√°vel pela transpar√™ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tamanho desse numeral em bits √© bitDepth, a mesma flag que vimos no bloco IHDR. Quanto menor o seu bitDepth, menor o arquivo, mas menos cores voc√™ pode apresentar a eles. Um n√∫mero t√≠pico √© 8. Quanto custa? Na minha opini√£o, haver√° 16 milh√µes com alguma coisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, a primeira otimiza√ß√£o que voc√™ pode fazer √© jogar fora os canais alfa na sua peengesh. Este ser√° um colorType diferente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode otimizar ainda melhor e usar apenas um em vez de quatro n√∫meros. Mas o problema √© que, ent√£o, seu peengeshka deve ser preto e branco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ ainda deseja apenas um n√∫mero e deixa as cores, isso tamb√©m pode ser feito. O que est√° acontecendo aqui? Voc√™ pega todas as cores dentro do seu peengeshka e as corta em um peda√ßo separado. Chame de paleta. Ainda dentro da amostra, respons√°vel pelo pixel dentro do peda√ßo IDAT, voc√™ apenas armazena o √≠ndice dessa paleta. Se voc√™ tiver uma captura de tela sem um plano de fundo intrincado ou algum desenho, essa coisa ser√° perfeita. Ela aperta peengeshki certo uau!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra coisa importante a dizer √© o entrela√ßamento. O que √© entrela√ßamento? √â quando voc√™ envia seu peengeshka gradualmente. Voc√™ n√£o tem um peengeshka, mas v√°rias imagens. Cada imagem √© chamada de digitaliza√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gq/u5/50/gqu550y52cqmqi9k14skfsy-bg0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao mesmo tempo, dentro da paengashka, voc√™ classifica os pixels de maneira que alguns pixels sejam arrancados das fotos, uma imagem vem de lugares especiais. A pr√≥xima parte √© outra e assim por diante. Uma t√©cnica aparentemente interessante como o JPEG progressivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas parece assim. N√£o tenho certeza se voc√™ deseja que seus usu√°rios vejam isso, embora possa ser √∫til para sua tarefa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo e muito s√©rio problema do PNG entrela√ßado √© que, assim que voc√™ entrela√ßa seu peengeshka, o tamanho do seu peengeshka se torna maior. E n√£o mais t√£o fraco, em alguns kilobytes sua peengeshka de seis kilobytes crescer√° se voc√™ desligar o Entrela√ßado. Portanto, pense com cuidado, quer voc√™ queira ou n√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/p6/rq/vgp6rqgvogzln5frkfs5lmtcy4y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Falamos apenas sobre PNG, mas com isso voc√™ pode tirar conclus√µes importantes e √∫teis. Primeira conclus√£o: o tamanho do seu arquivo, voc√™ n√£o acredita, depende do que √© desenhado l√°. O quadrado preto encolhe melhor do que o gato, n√£o darei nenhuma recomenda√ß√£o aqui. Segundo, mais importante: o tamanho do seu arquivo depende muito do codificador e dos par√¢metros que voc√™ transfere.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ quiser ver como os codificadores horr√≠veis funcionam, use os do navegador. Como isso √© feito? Pegue o arquivo PNG, desenhe-o na tela, clique em Salvar como e compare o que aconteceu com o que aconteceu. Em geral, o Chrome aumentar√° o tamanho do arquivo em 2,5 vezes, o Firefox - em 1,6. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A prop√≥sito, tamb√©m depende sempre do formato, ou seja, n√£o apenas PNG deve ser usado. Vamos entender por que tudo depende do formato e de quais op√ß√µes interessantes ainda temos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dk/z9/jd/dkz9jdpv9uy9ivtiqcl-f5nyzhk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, falaremos sobre a tecnologia dos antigos, sobre JPEG. Obviamente, voc√™ n√£o pode subestimar a import√¢ncia do JPEG. Eles s√£o encontrados em toda parte. Eles s√£o t√£o legais, bons e, mais ainda, selos em JPEGs s√£o uma hist√≥ria bastante comum. Mas o JPEG √© uma coisa bastante complicada, e √© complicada devido ao fato de que o JPEG √© uma compacta√ß√£o com perdas. Al√©m disso, o JPEG √© sempre uma compacta√ß√£o com perdas. A qualidade JPEG 100% ainda comprime com a perda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como obtemos compacta√ß√£o com perdas? Muito simples. Pegamos alguma fonte, jogamos fora os dados e depois compactamos sem perda. Ou seja, mais um passo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/k7/pb/ctk7pba6jjplst_3mcqx-4r5xno.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos como fazemos perdas em nossos JPEGs. Ent√£o, voc√™ tem um gato com um tamanho de 32 por 32. Para darmos o primeiro passo com as perdas, precisamos mudar nossos canais. Geralmente falamos de imagens em termos de RGB. Mas percebemos as cores um pouco complexas. Nosso c√©rebro geralmente √© um grande problema, embora nos ajude muito a comprimir JPEG. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Percebemos muito bem o preto e o branco. Mesmo se voc√™ olhar atentamente, notar√° que os detalhes na imagem em preto e branco distinguem melhor. Acabamos de colocar essa imagem em preto e branco em um canal separado. √â chamado Y. Na verdade, a barra Y. N√£o estamos fazendo nada com ele, apenas o deixamos como est√°.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem mais dois canais respons√°veis ‚Äã‚Äãpela cor. Estes s√£o CB e CR. Com esses canais j√° podemos nos divertir um pouco. Aqui com esses canais, produzimos um procedimento interessante chamado Downsampling. Tomamos e reduzimos a resolu√ß√£o deste canal. Para JPEG, √© t√≠pico reduzir pela metade. Ou seja, voc√™ obt√©m tr√™s fotos - uma original e duas pela metade. Viva! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que faremos a seguir? N√≥s n√£o compactamos JPEG, n√£o como um arquivo inteiro. N√≥s o dividimos em blocos e comprimimos ainda mais, j√° estamos come√ßando blocos. Os blocos em JPEG t√™m tamanho de 8 por 8 e veja o que acontece com eles. Vamos ver o canal Y. CB e CR s√£o todos iguais.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gm/zo/yg/gmzoyg2byoms9jzzncnxvauwiic.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, um bloco n√£o √© uma imagem, mas n√∫meros. Precisamos fazer perdas em JPEG. Esse bloco √© 8 por 8, 64 pixels, qual jogar? O da esquerda, o da direita, o do meio? N√£o est√° claro. Mas h√° uma matem√°tica legal que nos permite resolver esse problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa matem√°tica √© chamada - agora, por favor, n√£o fique nervosa se algu√©m se lembrar do terr√≠vel passado institucional - a discreta transforma√ß√£o do cosseno. Portanto, com a ajuda dessa transforma√ß√£o discreta de cosseno, voc√™ pode converter esses n√∫meros em seu bloco para que sejam importantes e sem import√¢ncia entre eles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Importante: ap√≥s a convers√£o, n√∫meros importantes permanecem na parte superior esquerda do bloco. No canto inferior direito permanecem n√∫meros sem import√¢ncia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, voc√™ precisa fazer a sua perda de JPEG. Isso tamb√©m √© muito f√°cil de fazer. Esse truque √© chamado quantiza√ß√£o. Desculpe se voc√™ quer dormir agora, mas isso √© importante, acredite. Portanto, essa quantiza√ß√£o funciona de maneira bastante simples. Voc√™ pega seu bloco e um prato especialmente projetado. Esta placa √© determinada pelo seu programa de codificador. Os n√∫meros que apareceram no seu bloco, voc√™ divide por este termo da placa por n√∫mero e n√∫mero inteiro. O que voc√™ obt√©m como resultado? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como os n√∫meros s√£o grandes na parte inferior direita da placa, haver√° apenas zeros.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cw/ak/a4/cwaka4z7wsiu0agcr4d6say3ddc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, ao mesmo tempo, seu JPEG, seu bloco ser√° compactado perfeitamente. Voc√™ ter√° um pequeno n√∫mero de n√∫meros que desviar√° em um zig-zag t√£o intrincado, que os zeros desaparecer√£o e, gritos, nosso bloco est√° pronto para compacta√ß√£o. Depois, precisamos compact√°-lo com um algoritmo de compacta√ß√£o sem perdas. O JPEG usa a Huffman Coding, seja ela qual for. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jv/f9/lr/jvf9lrka6wigwi-l09lcfejpf6a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como √© embalado em um recipiente? Recipientes JPEG parecem um pouco idiotas, eu tenho medo deles. Porque voc√™ v√™ os dois primeiros bytes e diz que provavelmente √© JPEG. Mas at√© agora n√£o est√° claro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, voc√™ precisa procurar por dois meta chunks. Por que dois? Porque o JPEG √© um conjunto muito grande de padr√µes diferentes. O que chamamos de JPEG √©, por padr√£o, chamado JIFF. Esta √© uma extens√£o especial do padr√£o JPEG. N√£o vou continuar - em geral, existem dois meta chunks, apenas confie em mim. Esses meta-chunks cont√™m informa√ß√µes sobre a largura e a altura do seu arquivo e a vers√£o do JPEG. Imagine, o JPEG tem mais vers√µes! Al√©m disso, √© JPEG progressivo? Esta √© uma bandeira importante. Ele fala sobre como seus blocos ser√£o distribu√≠dos ainda mais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o JPEG n√£o for progressivo, o que voc√™ precisa para decodificar seus blocos? Qualidade JPEG, este mesmo prato. A placa na qual voc√™ divide seus blocos √© de qualidade. Mas o JPEG tem duas qualidades. A primeira qualidade √© respons√°vel pelo canal Y, a segunda - pelos canais CB e CR, √© isso que determina a cor. Como colocamos a qualidade em um arquivo e compactamos tudo com um algoritmo de compacta√ß√£o sem perdas, ainda precisamos de um dicion√°rio especial do Huffman Tables para expandir isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, vem seus blocos e seu JPEG acaba.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/qz/ap/hjqzaprqwxahztq8enqtwzq5cce.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, uma hist√≥ria progressiva. Tudo √© exatamente o mesmo. No come√ßo, voc√™ tem um meta-peda√ßo. Em seguida, vem a sua qualidade na forma de 64 n√∫meros, mais 64 n√∫meros. E ent√£o apenas os mesmos blocos, mas um pouco diferente com os n√∫meros distribu√≠dos. Primeira parte dos blocos, depois outra parte, outra parte e assim por diante. √Ä medida que voc√™ recebe esses blocos, o navegador faz uma aproxima√ß√£o do seu JPEG, porque, de fato, esses n√∫meros s√£o uma aproxima√ß√£o do seu arquivo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/uq/x3/qquqx3mnyg-nx0pn8a0lgmjufpa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobre o JPEG que terminamos, voc√™ pode expirar, est√° tudo bem. Vamos falar de algo interessante como o JPEG 2000. Algum de voc√™s em produ√ß√£o usa o JPEG 2000? Ok, quem j√° ouviu falar disso? E qual de voc√™s leu no Lighthouse - ‚Äúusa formatos modernos‚Äù?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, o JPEG 2000 √© um formato interessante interessante, que primeiro √© mais eficaz que o JPEG. Em segundo lugar, voc√™ n√£o vai acreditar, em alguns casos √© mais eficaz que o WebP, sobre o qual falaremos mais adiante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele sabe ser transparente, sabe como comprimir sem perdas. Apenas o formato perfeito. Mas, infelizmente, sim, ele s√≥ funciona no Safari. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale ressaltar que o JPEG 2000 √© projetado de uma maneira muito complexa e funciona em matem√°tica interessante chamada transforma√ß√£o de wavelet. Se voc√™ est√° subitamente interessado, pesquise no Google e iremos mais longe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/li/b8/qw/lib8qwt1s_r7xowxervhr6yaay0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De repente, precisamos conversar sobre o v√≠deo. Todo este relat√≥rio √© sobre otimiza√ß√£o de imagens e imagens. Mas o v√≠deo aqui √© muito importante, voc√™ ver√° o porqu√™ agora. Quando pensamos em um v√≠deo, a primeira palavra que vem √† nossa mente √© "codec". O v√≠deo precisa ser codificado de alguma forma e, para mostrar o v√≠deo, precisamos decodific√°-lo. Se decodificarmos o fluxo de v√≠deo, o que obteremos?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro de tudo, temos um conjunto de quadros. Mas n√£o pense nesses quadros como imagens no GIF. Tudo errado. Quais quadros s√£o muito dependentes do codec. Mas, no caso geral, voc√™ pode assumir que possui um quadro-chave. Voc√™ pode tirar um gato do quadro-chave - no sentido, qualquer imagem que esteja nesse quadro-chave. E existem quadros dependentes. √â imposs√≠vel tirar um gato do quadro dependente, porque o quadro dependente armazena n√£o apenas informa√ß√µes n√£o sobre a imagem, se houver, mas tamb√©m sobre como os blocos do quadro anterior ou anterior se moveram sobre isso. Portanto, voc√™ n√£o pode obter uma imagem para um quadro dependente at√© decodificar um pouco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, falaremos apenas sobre o quadro-chave e a compress√£o intra-quadro. √â assim que voc√™ comprime uma imagem dentro de um quadro-chave.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos examinar um codec abstrato no v√°cuo e compar√°-lo com o JPEG. At√© agora parece - por que fazer isso? Tudo ficar√° mais claro, confie em mim. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i9/vh/7y/i9vh7ygfkhjucwtefchjamthm3u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais uma vez repetimos a mesma coisa que fazemos com JPEG,. Voc√™ tira uma foto, a divide em canais, reduz a amostragem para os canais. A mesma hist√≥ria aqui. Ent√£o voc√™ divide esta imagem em blocos. Mas j√° existem recursos. Primeiro de tudo, o tamanho do bloco em que voc√™ est√° invadindo depende do seu codec. E esses blocos podem ser muito grandes. Para JPEG - 8 por 8. Para codecs de v√≠deo - pode ser, por exemplo, 128 por 128.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais. Se voc√™ receber alguns detalhes muito pequenos na sua imagem, voc√™ ainda pode subdividir os blocos um pouco, aproximadamente para o tamanho 4 por 4. Como voc√™ quebra os blocos, esse algoritmo de particionamento depende do codec. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o mais recente - o tamanho m√°ximo do bloco, novamente, √© espec√≠fico para o seu codec. Um codificador faz parte do codec, para ser entendido na terminologia. Aqui ainda somos semelhantes ao JPEG. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r0/la/y3/r0lay3m2i5yjdu-sx9by6lsyhpi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que n√£o parece JPEG √© codifica√ß√£o preditiva. N√≥s conversamos sobre ele em parte sobre peengeshki. A compacta√ß√£o de v√≠deo intraframe √© t√£o legal e eficaz por causa disso. O que est√° acontecendo aqui?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos tentando prever os pixels de cada bloco com base nos anteriores. Ou seja, n√£o armazenamos pixels na forma bruta, os prevemos. As op√ß√µes de previs√£o s√£o muitas. Dentro de um codec, podemos usar diferentes variantes de previs√µes. Al√©m disso, para todos os tipos de codecs intrincados dessas op√ß√µes, at√© 35, por exemplo. Como voc√™ pode fazer isso. Vamos ver um exemplo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui voc√™ tem o bloco. Voc√™ diz: eu quero prever pixels l√°. Voc√™ olha para a esquerda, olha para cima e lembra o que resta e acima. Em seguida, voc√™ pega todos os valores de pixel encontrados, calcula a m√©dia e preenche-os com um bloco e diz: Eu previ. Se voc√™ adivinhou certo, e a prop√≥sito, na pequena foto onde existem setas azuis, adivinhou certo, ent√£o voc√™ √© √≥timo, n√£o precisa fazer mais nada. Mas, se voc√™ ainda n√£o adivinhou, precisar√° salvar a diferen√ßa entre o que √© realmente e o que previu. Essa diferen√ßa comprime muito, muito melhor que o valor puro do pixel.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/mb/cg/dxmbcg7w-imsyuamimesxnxi3s0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o tudo √© exatamente igual ao JPEG. Voc√™ transformar√° o bloco resultante. Mas a peculiaridade de todos os tipos de codecs diferentes √© que voc√™ pode usar n√£o o DCT (transforma√ß√£o discreta de cosseno), mas outra coisa. O que usar depende do codec. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_k/sj/7x/_ksj7xbki-d-hjam59vm-ovudtk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, novamente as mesmas placas, mas, diferentemente do JPEG, voc√™ pode usar mais de uma placa para todo o arquivo e v√°rias placas para blocos diferentes. Imagine - voc√™ tem uma pessoa, por exemplo, contra o c√©u. Talvez, como o c√©u √© azul, voc√™ n√£o precise de uma qualidade especial l√°, voc√™ pode usar uma qualidade para o c√©u, um prato. E para uma pessoa que tem alguma textura, roupas, use uma qualidade diferente, e ela se torna legal e eficaz.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/lh/mc/axlhmcjhw3u18r0v826se8n74me.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais recente √© o que o JPEG n√£o possui e o que o JPEG est√° faltando. Este √© o uso de filtros. Quando todos n√≥s colhemos, temos esses artefatos desagrad√°veis ‚Äã‚Äãap√≥s a compacta√ß√£o. Se voc√™ j√° compactou JPEGs para baixa qualidade, deve ver como os JPEGs se desfazem simplesmente em terr√≠veis blocos de pesadelo. Em geral, para se livrar desses artefatos, os codecs de v√≠deo usam algo especial. Eles aplicam filtros e as bordas desses blocos suavizam. A tecnologia dos antigos, que nos permitia fazer o mesmo com o JPEG, era essa. Voc√™ pega seu JPEG, comprime-o com muita for√ßa e depois dobra-o assim para que nada seja percept√≠vel. Em geral, isso √© praticamente o mesmo, mas j√° foi feito no n√≠vel do codec. √ìtimo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eu/kn/oe/euknoewgg9xovgain172cbr03eu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturalmente, quando tentamos e tudo foi feito, agora precisamos compactar os blocos recebidos sem perda. Apertamos, bem feito. O algoritmo de compacta√ß√£o √© semelhante ao JPEG, mas ainda diferente. Aqui deve ser entendido que a compress√£o sem perdas √© limitada pelo limite natural. N√≥s realmente queremos nos aproximar dela, e a melhor maneira de nos aproximarmos dela √© se usarmos um algoritmo chamado codifica√ß√£o aritm√©tica. E tamb√©m existem todos os tipos de varia√ß√µes. Isso depende novamente do codificador, mas vamos supor que haja compress√£o sem perdas e aprox.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/li/9q/ej/li9qej4dyf4w1tqxuu0kdyma1pe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° muito tempo eu queria chamar esses codecs abstratos no v√°cuo por seus nomes pr√≥prios. Uma pequena excurs√£o hist√≥rica. O que aconteceu em 20 anos? Estou falando apenas sobre os codecs de v√≠deo que s√£o pelo menos de alguma forma suportados na web. O H.264 √© um codec que suporta tudo e todos. Esta √© a solu√ß√£o padr√£o para o v√≠deo inteiro. Ap√≥s um certo per√≠odo de tempo, ap√≥s alguns anos, o codec de v√≠deo VP8 aparece. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui come√ßam as guerras selvagens, holivares sobre o t√≥pico sobre quais desses codecs s√£o melhores. Pesquisei no Google por muito tempo - n√£o h√° resposta. Grandes artigos cient√≠ficos foram escritos sobre isso, mas, em m√©dia, se eu disser o mesmo agora, um tomate voar√° para mim. Mas tudo bem, eles s√£o iguais. M√©dia. Ent√£o, por que precisamos de um segundo?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo √© necess√°rio porque √© gratuito. Se voc√™ usa o H.264, √© necess√°rio transportar dinheiro MPEG em algumas circunst√¢ncias. Para o VP8, voc√™ n√£o precisa carregar dinheiro. √â bom. Ent√£o, quadro-chave VP8 - este √© WebP. De fato, por que devemos inventar um novo formato de imagem? Pegamos o quadro-chave, tentamos tanto, esprememos tudo. Chamamos tudo isso de um novo formato de fotos, e pronto!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que acontece depois? Depois de v√°rios anos, mais dois codecs de v√≠deo interessantes, do MPEG e do Google, aparecem quase simultaneamente. Do Google - VP9, ‚Äã‚Äãdo MPEG - H.265. Ao lado de H.265, h√° um novo padr√£o de imagem chamado HEIF. N√£o √© suportado por navegadores, nem um. Mas √© suportado pelos seus dispositivos Apple. O padr√£o HEIF √© incrivelmente interessante, porque √© apenas uma abstra√ß√£o dessa id√©ia. Em um cont√™iner HEIF, voc√™ pode compactar o quadro-chave de praticamente qualquer codec. Ou seja, o VP8 n√£o √© um formato moderno. Mas o HEIF √© moderno.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que acontece depois? Agora, em uma organiza√ß√£o muito grande, que inclui Mozilla e Google, um codec de v√≠deo chamado AV1 est√° sendo visto. A organiza√ß√£o √© chamada Alliance for Open Media. A qualidade do v√≠deo AV1 √© muitas vezes superior a tudo o que era antes. Ele √© livre, ele √© livre de royalties, ele √© muito legal. Temos um cont√™iner HEIF t√£o bom. Tudo o que resta para n√≥s √© colocar o quadro-chave AV1 nele. E est√° feito. O novo formato para enviar o quadro-chave AV1 para um cont√™iner HEIF √© chamado AVIF. √â isso que nos espera no futuro. Talvez um dia a usaremos nativamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas podemos us√°-lo agora. Colocamos apenas um quadro do v√≠deo na p√°gina e dizemos: voila, voc√™ tem uma foto.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/k0/cm/jqk0cmtzq6oafsae-uvllieobks.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como isso √© feito no webp? WebP √©, como eu disse, um quadro-chave VP8 empacotado em um cont√™iner chamado riff. Existe esse cabe√ßalho no cont√™iner de riff. L√°, n√£o acredite, est√° escrito que este √© WebP. Quem duvidaria disso. PNG diz que √© PNG WebP, e a√≠ est√°.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas o WebP tem um recurso interessante: o quadro-chave VP8 pode estar dentro dele, e isso √© o que geralmente √© chamado de WebP. Mas o quadro-chave VP8 pode n√£o ser. Em geral, o WebP suporta compacta√ß√£o sem perdas. O WebP lossless √© um formato completamente diferente que nada tem a ver com o VP8, a compacta√ß√£o com perdas, etc. Portanto, quando algu√©m lhe diz que o WebP √© mais eficaz do que qualquer outra coisa, a primeira pergunta a ser feita √©: WebP alguma coisa? Porque se falamos de compress√£o sem perdas, existe um corredor natural pelo qual podemos nos esfor√ßar. Essas diferen√ßas, "60% mais eficazes que ...", provavelmente n√£o s√£o sem perdas, mas WebP com perdas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certo, teoria suficiente, farto disso, vejamos algo j√°. </font><b><sup><sub><font style="vertical-align: inherit;">Clic√°vel</font></sub></sup></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/y3/5q/ut/y35qutrwbylxwzjo_dj17alkys8.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos come√ßar com isso. Tiramos uma foto tirada por uma c√¢mera profissional. Recorte um peda√ßo de 1000 por 1000 pixels. Ali√°s, parece muito legal no projetor. Come√ßamos a considerar pequenos detalhes. Ao mesmo tempo, compactamos esta pe√ßa para obter exatamente 15 kilobytes. </font><b><sup><sub><font style="vertical-align: inherit;">Clic√°vel</font></sub></sup></b><font style="vertical-align: inherit;"> 
Veja o que acontece. O JPEG caiu em blocos imediatamente. De fato, baixa qualidade, esper√°vamos isso. </font><font style="vertical-align: inherit;">
√â assim que o WebP se parece. Tamb√©m caiu em blocos, mas esses blocos n√£o s√£o t√£o claramente vis√≠veis. Ao usar o codificador WebP e control√°-lo com as m√£os, voc√™ pode controlar a for√ßa do filtro usado no WebP. E se voc√™ desapertar esse filtro com mais for√ßa, poder√° se livrar de um grande n√∫mero de artefatos de bloco. Portanto, puramente teoricamente, esses blocos tamb√©m podem ser removidos.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/9q/c_/jp/9qc_jpasvkhbwiz3zjpxhsgsgji.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui est√° o AV1. Vamos apenas admirar silenciosamente. Olha como ele √© legal. O AV1 √© suportado no Firefox, no Chrome, para que voc√™ possa usar o v√≠deo AV1 em vez de uma imagem, se desejar repentinamente. </font><b><sup><sub><font style="vertical-align: inherit;">Clic√°vel</font></sub></sup></b><font style="vertical-align: inherit;"> 
H√° um spoiler, em v√£o eu o adicionei. A situa√ß√£o em que o PNG derrota o WebP. Sim, PNG neste caso √© mais eficaz que WebP. Isso ocorre porque eu usei WebP com perdas. </font><b><sup><sub><font style="vertical-align: inherit;">Clic√°vel</font></sub></sup></b><font style="vertical-align: inherit;"> 
O que eu fiz com o peengeshka? Eu fiz o modo de cores indexadas, ou seja, cortei a paleta, na minha opini√£o, em 16 cores. √â bastante eficaz para uma imagem em preto e branco. Acabou bem, contratou muito. Para WebP com perda de qualidade, temos um tamanho maior. No entanto, para perdas, isto √© esperado, √© mais eficiente que peengeshka. Temos uma vit√≥ria.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/z5/5e/bs/z55ebsmfycy45l6beelixuwfz2k.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/cl/yu/ua/clyuuarpr6mv6byxk2x_wlya7z4.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu resumo. Pangshes embutidos muito legais podem derrotar formatos de compacta√ß√£o com perdas e n√£o derrotar WebP sem perdas. Infelizmente, infelizmente. </font><b><sup><sub><font style="vertical-align: inherit;">Clic√°vel</font></sub></sup></b><font style="vertical-align: inherit;"> 
Talvez voc√™ esteja atormentado com a pergunta: por que voc√™ est√° fazendo isso, sabemos o que √© SVG? E eu sei, mas para alguns tamanhos, PNG √© mais eficiente. Essa imagem acaba sendo mais eficaz que o SVG para tamanhos de 200 a 200. Ent√£o o SVG, √© claro, vence. </font><b><sup><sub><font style="vertical-align: inherit;">Clic√°vel</font></sub></sup></b><font style="vertical-align: inherit;"> 
Agora, vamos olhar para Mike. Este √© o Mike. Suas dimens√µes s√£o 3000 x 3000 pixels. JPEG vs WebP. Era √≥bvio aqui que o JPEG estava ganhando. Mas, neste caso, obtive cerca de seis por cento de vit√≥ria pela mesma qualidade visual. Esta √© uma caracter√≠stica da foto e como eu a preparei. Voc√™ pode ent√£o me perguntar como eu fiz isso.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/mk/br/bx/mkbrbxyyxxkfbft-22mssst0thk.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/io/5j/lq/io5jlqupl72tvqohsbyd0qqowmm.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/y2/0y/a_/y20ya_ybbu1hlmeqsp_b7ii3iv8.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clic√°vel</font></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
, mas tudo depende muito dos par√¢metros do codificador. Se voc√™ se esfor√ßar muito e desaparafusar os par√¢metros do codificador de uma maneira especial, o JPEG come√ßar√° a diminuir o tamanho do WebP para a mesma qualidade visual. Gostaria de concluir que os gatos encolhem melhor que o JPEG, mas n√£o. Este √© apenas um exemplo de como voc√™ pode desaparafus√°-lo da maneira que desejar, se desejar.</font><b><sup><sub><font style="vertical-align: inherit;"> Clic√°vel</font></sub></sup></b><font style="vertical-align: inherit;"> 
Esta √© uma qualidade muito baixa. JPEG est√° caindo em blocos. Isso √© especialmente evidente no projetor - o nariz ficou azul para o cachorro e ficou quadrado. WebP n√£o est√° t√£o doente. Tudo parece legal e bom, mas o fato √© que, para qualidades muito, muito baixas, o WebP oferece cerca de duas ou talvez tr√™s vezes o tamanho do arquivo que o JPEG. Ent√£o aqui voc√™ tamb√©m precisa pensar em qual qualidade deseja.</font><b><sup><sub><font style="vertical-align: inherit;"> Clic√°vel</font></sub></sup></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/3g/hr/06/3ghr06olqwqeom_ru2i0xvlki-u.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/9q/-f/xp/9q-fxpk1zj_xq3yjvdunqa2trrm.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© a compara√ß√£o mais honesta. Ent√£o voc√™ tem que comparar, porque H.264 e WebP s√£o semelhantes. Quem voc√™ acha que ganhou aqui? H.264. Mas, para ser sincero, o experimento n√£o foi totalmente limpo. De uma maneira boa, tanto no WebP quanto no H.264, o quadro de v√≠deo √© aproximadamente inequ√≠voco. </font><b><sup><sub><font style="vertical-align: inherit;">Clic√°vel</font></sub></sup></b><font style="vertical-align: inherit;"> 
Mas com o AV1, tudo √© absolutamente claro. Trinta por cento ganham na mesma qualidade visual. Viva! </font><b><sup><sub><font style="vertical-align: inherit;">Clic√°vel</font></sub></sup></b><font style="vertical-align: inherit;"> 
√â muito importante entender que tipo de imagem voc√™ coloca e como esse ou aquele formato responde √† qualidade da imagem. Aqui, o c√£o no formato WebP pesa 79 kilobytes em qualidade, cerca de 75%, contra 56 kilobytes em JPEG. Por que isso est√° acontecendo?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/zn/yd/1u/znyd1unstrzgknbpbc_3w_flga0.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/gg/b9/pf/ggb9pfrw4c1vcjdjeb1g8qeyeum.jpeg"></a><br>
<b><sup><sub><font style="vertical-align: inherit;"></font></sub></sup></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como nem um √∫nico codec de v√≠deo, nem um √∫nico formato pode compactar adequadamente o ru√≠do. Se a sua imagem apresentar muitas distor√ß√µes, pontos e outras coisas n√≠tidas, √© prov√°vel que voc√™ tenha problemas com a compress√£o. Se voc√™ puder tirar outra foto e remover esse ru√≠do, remova-o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, as imagens s√£o uma coisa complicada. Eles podem diminuir a velocidade da sua interface? Uma pergunta importante e boa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/ss/ux/wqssux2vgg3zjhog3chbctkuwxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resposta: provavelmente n√£o. Por que isso acontece? Porque quando a imagem √© decodificada, acontece em um fluxo separado. Mas h√° uma exce√ß√£o: se voc√™ desenhar algo na tela, lembre-se de que a decodifica√ß√£o da imagem ocorrer√° no fluxo principal e os bot√µes poder√£o n√£o ser pressionados nesse momento.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/3-/x3/yb3-x3j8yz_y4lpg9i-zwlwhbjm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ realmente deseja fazer um acordo, abra o Chrome, procure os threads de rasteriza√ß√£o correspondentes e o evento Image Decode, voc√™ o encontrar√°. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cz/hi/na/czhinaou_xikxzzjk8i_kzdvx3u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ estiver muito, muito curioso, poder√° ir para a guia Rastreio e ver com detalhes o que acontece ao decodificar uma imagem.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferramentas de otimiza√ß√£o </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais importante s√£o as ferramentas de otimiza√ß√£o. Agora sabemos aproximadamente o que queremos. Resta entender como fazemos isso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w5/o9/s1/w5o9s1vjdbzscsb_tr513umrqbu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ferramenta de otimiza√ß√£o de imagem mais importante √© o designer, por mais estranho que pare√ßa. Somente essa pessoa maravilhosa sabe qual problema voc√™ deseja resolver com ela. N√£o adicionamos imagens √†s p√°ginas para otimiz√°-las, mas para impressionar os usu√°rios. Para manter um equil√≠brio entre o grau de otimiza√ß√£o e a experi√™ncia do usu√°rio, use um designer que ajude bastante. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/da/rj/dmdarj1ouin679hqaw075cozmiw.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide A</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
segunda ferramenta √© o nosso c√≥digo aberto marciano, sobre o qual prometi falar. Essa coisa √© chamada imgproxy e resolve todos os nossos problemas em geral. Nos meus projetos eu uso apenas imgproxy, essa coisa pode fazer quase tudo o que eu quero.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ex/9a/fz/ex9afzkiiywmkkknxjrndj4svhs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como funciona? Voc√™ tem algum desejo para a foto. Voc√™ deseja uma imagem de um determinado tamanho com uma certa otimiza√ß√£o. E em algum lugar distante, voc√™ tem uma imagem de qualquer resolu√ß√£o - talvez no computador local ou talvez em algum lugar do usu√°rio ou em geral em qualquer lugar. Voc√™ s√≥ precisa criar um URL especial e pedir ao imgproxy para redimensionar sua imagem. Este √© um servi√ßo que pode estar na nuvem ou em outro lugar. Ou seja, voc√™ tinha um gato enorme, envia uma URL especial para imgproxy. Ele faz tudo o que voc√™ quer na hora.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/de/9x/up/de9xupjotbsna-qdrecbjjixlz4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se isso n√£o parecer claro, vamos ver como √© a solicita√ß√£o de imgproxy. Primeiro, voc√™ precisa dizer onde est√° localizado o imgproxy. Em segundo lugar, se voc√™ n√£o deseja ser agressivamente sugado, o URL que voc√™ est√° solicitando seria bom para assinar digitalmente. Voc√™ n√£o pode fazer isso, isso √© apenas uma medida adicional de prote√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, se voc√™ deseja redimensionar, diretamente no URL passe os par√¢metros de redimensionamento. Se voc√™ deseja otimizar - a mesma coisa. Voc√™ s√≥ precisa transferir o endere√ßo original da sua foto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iq/ij/zq/iqijzqvjy98twszsumxw5j-g_ds.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ deseja otimiza√ß√µes manuais, h√° um enorme conjunto de ferramentas. N√£o vou descrev√™-los todos agora. Os </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">materiais</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o relat√≥rio, que eu enviarei para voc√™, t√™m tudo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sm/gb/1v/smgb1vvmd2kwmpgmtivk2var9dy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° o mais legal e √∫til. </font><font style="vertical-align: inherit;">Todas essas imagens n√£o s√£o t√£o complicadas. </font><font style="vertical-align: inherit;">Eu acho que consegui transmitir isso para voc√™. </font><font style="vertical-align: inherit;">Se voc√™ estiver interessado, pegue sua linguagem de programa√ß√£o favorita - provavelmente JavaScript, embora esteja longe de ser verdade - e comece a resolver tudo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ quiser fazer isso em um navegador, por favor. </font><font style="vertical-align: inherit;">Voc√™ provavelmente precisa de uma liga√ß√£o que provavelmente est√° escrita em vantagens ou em C. Mas o que impede voc√™ de compilar tudo isso no WebAssembly? </font><font style="vertical-align: inherit;">H√° um aplicativo interessante chamado Squoosh. </font><font style="vertical-align: inherit;">Faz exatamente isso. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m pode, tente, ser√° legal. </font><font style="vertical-align: inherit;">Eu realmente gosto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado a todos pela aten√ß√£o. </font><font style="vertical-align: inherit;">Materiais para o relat√≥rio - por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">refer√™ncia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493598/index.html">Ocultar parte do n√∫mero de telefone</a></li>
<li><a href="../pt493604/index.html">Eventos digitais em Moscou de 23 a 29 de mar√ßo</a></li>
<li><a href="../pt493606/index.html">A hist√≥ria da cria√ß√£o de um servi√ßo de nuvem com sabor de cyberpunk</a></li>
<li><a href="../pt493610/index.html">Programando uma camada de v√≠deo em um Raspberry Pi usando a API DispmanX</a></li>
<li><a href="../pt493614/index.html">Detectar COVID-19 em raios-X com Keras, TensorFlow e Deep Learning</a></li>
<li><a href="../pt493618/index.html">(N√£o) √≥bvio OSINT no Twitter</a></li>
<li><a href="../pt493620/index.html">Curva log√≠stica. Quando a epidemia terminar√°?</a></li>
<li><a href="../pt493622/index.html">Gravando um Retrowave em Angular</a></li>
<li><a href="../pt493626/index.html">Selenoid - Centenas de testes de interface do usu√°rio paralelos s√£o f√°ceis e r√°pidos. Pavel Senin</a></li>
<li><a href="../pt493630/index.html">Encaminhando portas USB do Windows 10 para trabalho remoto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>