<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤙🏼 🛀🏾 🤾🏻 追加の蛍光バックライト付きワイヤレスタッチスイッチ 👩🏽‍🤝‍👨🏿 🔶 🕰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HabrのDIYまたは日曜大工のセクションのすべての読者への挨拶！今日の記事はTTP223チップのタッチスイッチについてです| データシート。スイッチはnRF52832マイクロコントローラーで機能します。データシート、プリントアンテナと外部アンテナMHF4のコネクタを備えたYJ-17103モジュール...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>追加の蛍光バックライト付きワイヤレスタッチスイッチ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457992/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HabrのDIYまたは日曜大工のセクションのすべての読者への挨拶！</font><font style="vertical-align: inherit;">今日の記事はTTP223チップのタッチスイッチについてです| </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データシート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">スイッチはnRF52832マイクロコントローラーで機能します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データシート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プリントアンテナと外部アンテナMHF4のコネクタを備えたYJ-17103モジュールが使用されました。</font><font style="vertical-align: inherit;">タッチスイッチは、CR2430またはCR2450バッテリーを搭載しています。</font><font style="vertical-align: inherit;">送信モードでの消費は8mA以下、スリープモードでは6mA以下です。</font></font><br>
<img src="https://habrastorage.org/webt/nv/3m/ll/nv3mll44dl6x7xfezcqlvf76aum.jpeg"><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前のすべてのプロジェクトと同様に、これもArduinoプロジェクトであり、プログラムはArduino IDEで作成されています。デバイスのソフトウェア実装は、Mysensorsプロトコルに基づいています。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubライブラリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MysensorsのnRF5ボードのGitHubサポート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。英語コミュニティフォーラム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-http://forum.mysensors.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ロシアコミュニティフォーラム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-http://mysensors.ru/forum/</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
（学習したい人のために- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シリアルプロトコル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーサー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> |支援したい人のための（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄稿）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）プロジェクトの開発- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タッチスイッチボードは、Diptraceプログラムで開発され、Laser Iron Technology（LUT）の方法に従って、その後の製造を考慮しています。ボードは60x60mmのサイズで開発されました（標準のガラスパネルの寸法は80x80mmです）。回路は雑誌Antennaのページに印刷され、「Len」（最大出力）の設定でボッシュのアイアンによって、両面フォイルコーティングされたグラスファイバープレート1.5mm、35 µm（別のものがないため）に転送されました。</font></font><br>
<img src="https://habrastorage.org/webt/zw/my/ol/zwmyoloe347bfubkfz7btxbzo90.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エッチングは、温水250mlあたりスプーン1.5部の割合で前もって調製された塩化第二鉄の溶液を用いて行われた。このプロセスには15分かかりました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
層間移行部とバッテリーホルダーを取り付けるための穴は、DREMEL 220ドリルスタンドに取り付けられたDREMEL 3000ミニドリルで開けました。層間移行部の穴は0.4 mmドリルで開け、バッテリーホルダーの穴は1.1 mmドリルで開けました。ボードの境界に沿ったトリミングは、DREMEL 540ノズルを備えた同じミニドリルで行いました（カッティングホイールd = 32.0mm）。トリミングは、人工呼吸器で行われました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エッチングされたボードの錫メッキは、Rose合金を水溶液で使用して行われました（300 mlの水に小さじ1杯の結晶化クエン酸）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はんだ付けプロセスには約1時間かかりました。ほとんどの時間は、層間遷移用の穴にワイヤー（錫メッキ、直径0.4 mm）をはんだ付けするために費やされました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボードはFLUX OFFエアゾールクリーナーで洗浄されました。</font></font><br>
<img src="https://habrastorage.org/webt/ki/_6/uo/ki_6uon6uucqrmidns10iydvgao.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/kl/my/ix/klmyix8dkj7peomxmtfzt5rucqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスの開発は、3次元コンピューター支援設計エディターで実行されました。ケースの寸法78.5mm X 78.5mm X 12mm。</font></font><br>
<img src="https://habrastorage.org/webt/ix/va/5k/ixva5kuvplal69-idcu7-ptynws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ケースとバッテリーカバーの完成したモデルはSTL形式で保存され、SLAプリンターで印刷できるようにこれらのモデルを準備する必要がありました（サポート、向きの追加）。この時点で、家庭用SLAプリンターの印刷領域が小さいため、小さな問題が発生しました。印刷時間に対して最適な位置にあるデバイスの本体のモデルは、印刷領域のサイズに適合しませんでした。モデルを45度に配置すると、残念な結果となり、サポートの重量はケースモデルの重量と等しくなりました。以前は後処理の事実に同意して、モデルを垂直に印刷し、前面の1つをサポートすることにしました。 50ミクロンのレイヤー設定でケースを密閉するのに5時間かかりました。さらに、非常に細かいサンドペーパーを使用して処理が行われました（番号は書きませんが、わからないので:)）。バッテリーカバーは40分間印刷されました。</font></font><br>
<img src="https://habrastorage.org/webt/pe/mg/j0/pemgj0d1ebfhby9tqfrywzggb0s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aliexpressのガラスパネルはすでに接着されたプラスチックフレームで販売されており、フレームの取り外しに問題はありませんでした。通常のドライヤーでガラスパネルの予熱を外しました。</font></font><br>
<img src="https://habrastorage.org/webt/1b/i_/4i/1bi_4iqjmns1ywbtldjxoiyxvy4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/md/3a/2c/md3a2c-6rddr2-7svvyfltyykqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LEDバックライトのディフューザーは、3M 9088-200アクリル接着剤付きの両面テープでできていました。蛍光灯照明については、中国の粘着テープと国内企業のルミノフォアのテープにカットされた粘着紙から選択するいくつかの材料がありました。国内メーカーを優先して選びましたが、私の気持ちによると、明るく長く輝きました。 3M 9088-200両面テープの上に、蛍光顔料の入った正方形の紙を貼り付けました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3M VHB 4910アクリル接着剤を使用した両面テープを使用してガラスをスイッチケースに接着し、</font></font><br>
<img src="https://habrastorage.org/webt/il/n3/no/iln3no5zweymnpoi0crulwz6nws.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カバーを1.4 M x 5 mmネジで固定しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスのコストは890ルーブルでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次はソフトウェアの部分です。問題ない。 TTP223センサーのマイクロ回路は3.3Vで安定した電力で完全に機能し、十分に放電したバッテリーから直接電力を供給された場合はあまり良くないことがわかりました。 2.5vの領域に電力が供給されているデバイスの開始時、およびMysensorsプレゼンテーションを実行しているときの追加の「ドローダウン」の後、TTP223チップ（キャリブレーションの直後）により、アクティブトリガーがあるためMCが中断されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チップに電源を供給するための回路（gpio MKを備えた電源管理TTP223）が変更され、追加のグラウンドが供給され、rgb ledライン（容量性センサーボードの反対側を通過）に、より高い抵抗の抵抗が交換されました。</font><font style="vertical-align: inherit;">また、Mysensorsフレームワークを開始してプレゼンテーションを作成した後の容量性マイクロ回路の電源投入もソフトウェアに追加されました。</font><font style="vertical-align: inherit;">TTP223チップの自動較正の遅延は、電力が供給されると2倍になります。</font><font style="vertical-align: inherit;">これらすべての変更により、この問題は完全に修正されました。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラムコードを表示する前に、Mysensorsのスケッチの基本構造を理解することをお勧めします。</font></font></b><div class="spoiler_text"><code>void before()<br>
{<br>
 //  ,       ,  before()   setup(),       Mysensors,      SPI<br>
}<br>
<br>
void setup()<br>
{<br>
 <br>
}<br>
<br>
void presentation() <br>
{ <br>
 //          <br>
 sendSketchInfo("Name of my sensor node", "1.0"); //   ,  <br>
 present(CHILD_ID, S_WHATEVER, "Description"); //   ,  <br>
}<br>
<br>
void loop()<br>
{<br>
 <br>
}<br>
</code><br>
</div></div><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タッチスイッチプログラムのテストコード：</font></font></b><div class="spoiler_text">test_sens.ino<br>
<code>/**<br>
        NRF_LPCOMP<br>
*/<br>
bool button_flag;<br>
bool sens_flag;<br>
bool send_flag;<br>
bool detection;<br>
bool nosleep;<br>
byte timer;<br>
unsigned long SLEEP_TIME = 21600000; //6 hours<br>
unsigned long oldmillis;<br>
unsigned long newmillis;<br>
unsigned long interrupt_time;<br>
unsigned long SLEEP_TIME_W;<br>
uint16_t currentBatteryPercent;<br>
uint16_t batteryVoltage = 0;<br>
uint16_t battery_vcc_min = 2400;<br>
uint16_t battery_vcc_max = 3000;<br>
<br>
#define MY_RADIO_NRF5_ESB<br>
//#define MY_PASSIVE_NODE<br>
#define MY_NODE_ID 30<br>
#define MY_PARENT_NODE_ID 0<br>
#define MY_PARENT_NODE_IS_STATIC<br>
#define MY_TRANSPORT_UPLINK_CHECK_DISABLED<br>
#define IRT_PIN 3 //(PORT0, gpio 5)<br>
#include &lt;MySensors.h&gt;<br>
// see https://www.mysensors.org/download/serial_api_20<br>
#define SENS_CHILD_ID 0<br>
#define CHILD_ID_VOLT 254<br>
MyMessage sensMsg(SENS_CHILD_ID, V_VAR1);<br>
//MyMessage voltMsg(CHILD_ID_VOLT, V_VOLTAGE);<br>
<br>
void preHwInit() {<br>
 sleep(2000);<br>
 pinMode(RED_LED, OUTPUT);<br>
 digitalWrite(RED_LED, HIGH);<br>
 pinMode(GREEN_LED, OUTPUT);<br>
 digitalWrite(GREEN_LED, HIGH);<br>
 pinMode(BLUE_LED, OUTPUT);<br>
 digitalWrite(BLUE_LED, HIGH);<br>
 pinMode(MODE_PIN, INPUT);<br>
 pinMode(SENS_PIN, INPUT);<br>
}<br>
<br>
void before()<br>
{<br>
 NRF_POWER-&gt;DCDCEN = 1;<br>
 NRF_UART0-&gt;ENABLE = 0;<br>
 sleep(1000);<br>
 digitalWrite(BLUE_LED, LOW);<br>
 sleep(150);<br>
 digitalWrite(BLUE_LED, HIGH);<br>
}<br>
<br>
void presentation() {<br>
 sendSketchInfo("EFEKTA Sens 1CH Sensor", "1.1");<br>
 present(SENS_CHILD_ID, S_CUSTOM, "SWITCH STATUS");<br>
 //present(CHILD_ID_VOLT, S_MULTIMETER, "Battery");<br>
}<br>
<br>
void setup() {<br>
 digitalWrite(BLUE_LED, LOW);<br>
 sleep(100);<br>
 digitalWrite(BLUE_LED, HIGH);<br>
 sleep(200);<br>
 digitalWrite(BLUE_LED, LOW);<br>
 sleep(100);<br>
 digitalWrite(BLUE_LED, HIGH);<br>
 lpComp();<br>
 detection = false;<br>
 SLEEP_TIME_W = SLEEP_TIME;<br>
 pinMode(31, OUTPUT);<br>
 digitalWrite(31, HIGH);<br>
 /*<br>
 while (timer &lt; 10) {<br>
 timer++;<br>
 digitalWrite(GREEN_LED, LOW);<br>
 wait(5);<br>
 digitalWrite(GREEN_LED, HIGH);<br>
 wait(500);<br>
 }<br>
 timer = 0;<br>
 */<br>
 sleep(7000);<br>
 while (timer &lt; 3) {<br>
 timer++;<br>
 digitalWrite(GREEN_LED, LOW);<br>
 sleep(15);<br>
 digitalWrite(GREEN_LED, HIGH);<br>
 sleep(85);<br>
 }<br>
 timer = 0;<br>
 sleep(1000);<br>
}<br>
<br>
void loop() {<br>
<br>
if (detection) {<br>
 if (digitalRead(MODE_PIN) == 1 &amp;&amp; button_flag == 0 &amp;&amp; digitalRead(SENS_PIN) == 0) {<br>
 //back side button detection<br>
 button_flag = 1;<br>
 nosleep = 1;<br>
 }<br>
 if (digitalRead(MODE_PIN) == 1 &amp;&amp; button_flag == 1 &amp;&amp; digitalRead(SENS_PIN) == 0) {<br>
 digitalWrite(RED_LED, LOW);<br>
 wait(10);<br>
 digitalWrite(RED_LED, HIGH);<br>
 wait(50);<br>
 }<br>
 if (digitalRead(MODE_PIN) == 0 &amp;&amp; button_flag == 1 &amp;&amp; digitalRead(SENS_PIN) == 0) {<br>
 nosleep = 0;<br>
 button_flag = 0;<br>
 digitalWrite(RED_LED, HIGH);<br>
 lpComp_reset();<br>
 }<br>
<br>
if (digitalRead(SENS_PIN) == 1 &amp;&amp; sens_flag == 0 &amp;&amp; digitalRead(MODE_PIN) == 0) {<br>
 //sens detection<br>
 sens_flag = 1;<br>
 nosleep = 1;<br>
 newmillis = millis();<br>
 interrupt_time = newmillis - oldmillis;<br>
 SLEEP_TIME_W = SLEEP_TIME_W - interrupt_time;<br>
 if (send(sensMsg.set(detection))) {<br>
 send_flag = 1;<br>
 }<br>
 }<br>
 if (digitalRead(SENS_PIN) == 1 &amp;&amp; sens_flag == 1 &amp;&amp; digitalRead(MODE_PIN) == 0) {<br>
 if (send_flag == 1) {<br>
 while (timer &lt; 10) {<br>
 timer++;<br>
 digitalWrite(GREEN_LED, LOW);<br>
 wait(20);<br>
 digitalWrite(GREEN_LED, HIGH);<br>
 wait(30);<br>
 }<br>
 timer = 0;<br>
 } else {<br>
 while (timer &lt; 10) {<br>
 timer++;<br>
 digitalWrite(RED_LED, LOW);<br>
 wait(20);<br>
 digitalWrite(RED_LED, HIGH);<br>
 wait(30);<br>
 }<br>
 timer = 0;<br>
 }<br>
 }<br>
 if (digitalRead(SENS_PIN) == 0 &amp;&amp; sens_flag == 1 &amp;&amp; digitalRead(MODE_PIN) == 0) {<br>
 sens_flag = 0;<br>
 nosleep = 0;<br>
 send_flag = 0;<br>
 digitalWrite(GREEN_LED, HIGH);<br>
 sleep(500);<br>
 lpComp_reset();<br>
 }<br>
 if (SLEEP_TIME_W &lt; 60000) {<br>
 SLEEP_TIME_W = SLEEP_TIME;<br>
 sendBatteryStatus();<br>
 }<br>
 }<br>
 else {<br>
 //if (detection == -1) {<br>
 SLEEP_TIME_W = SLEEP_TIME;<br>
 sendBatteryStatus();<br>
 }<br>
 if (nosleep == 0) {<br>
 oldmillis = millis();<br>
 sleep(SLEEP_TIME_W);<br>
 }<br>
}<br>
<br>
void sendBatteryStatus() {<br>
 wait(20);<br>
 batteryVoltage = hwCPUVoltage();<br>
 wait(2);<br>
<br>
if (batteryVoltage &gt; battery_vcc_max) {<br>
 currentBatteryPercent = 100;<br>
 }<br>
 else if (batteryVoltage &lt; battery_vcc_min) {<br>
 currentBatteryPercent = 0;<br>
 } else {<br>
 currentBatteryPercent = (100 * (batteryVoltage - battery_vcc_min)) / (battery_vcc_max - battery_vcc_min);<br>
 }<br>
<br>
sendBatteryLevel(currentBatteryPercent, 1);<br>
 wait(2000, C_INTERNAL, I_BATTERY_LEVEL);<br>
 //send(powerMsg.set(batteryVoltage), 1);<br>
 //wait(2000, 1, V_VAR1);<br>
}<br>
<br>
void lpComp() {<br>
 NRF_LPCOMP-&gt;PSEL = IRT_PIN;<br>
 NRF_LPCOMP-&gt;ANADETECT = 1;<br>
 NRF_LPCOMP-&gt;INTENSET = B0100;<br>
 NRF_LPCOMP-&gt;ENABLE = 1;<br>
 NRF_LPCOMP-&gt;TASKS_START = 1;<br>
 NVIC_SetPriority(LPCOMP_IRQn, 15);<br>
 NVIC_ClearPendingIRQ(LPCOMP_IRQn);<br>
 NVIC_EnableIRQ(LPCOMP_IRQn);<br>
}<br>
<br>
void s_lpComp() {<br>
 if ((NRF_LPCOMP-&gt;ENABLE) &amp;&amp; (NRF_LPCOMP-&gt;EVENTS_READY)) {<br>
 NRF_LPCOMP-&gt;INTENCLR = B0100;<br>
 }<br>
}<br>
<br>
void r_lpComp() {<br>
 NRF_LPCOMP-&gt;INTENSET = B0100;<br>
}<br>
<br>
#if __CORTEX_M == 0x04<br>
#define NRF5_RESET_EVENT(event) \<br>
 event = 0; \<br>
 (void)event<br>
#else<br>
#define NRF5_RESET_EVENT(event) event = 0<br>
#endif<br>
<br>
extern "C" {<br>
 void LPCOMP_IRQHandler(void) {<br>
 detection = true;<br>
 NRF5_RESET_EVENT(NRF_LPCOMP-&gt;EVENTS_UP);<br>
 NRF_LPCOMP-&gt;EVENTS_UP = 0;<br>
 MY_HW_RTC-&gt;CC[0] = (MY_HW_RTC-&gt;COUNTER + 2);<br>
 }<br>
}<br>
<br>
void lpComp_reset () {<br>
 s_lpComp();<br>
 detection = false;<br>
 NRF_LPCOMP-&gt;EVENTS_UP = 0;<br>
 r_lpComp();<br>
}<br>
</code><br>
<br>
MyBoardNRF5.cpp<br>
<code>#ifdef MYBOARDNRF5<br>
#include &lt;variant.h&gt;<br>
<br>
/*<br>
 * Pins descriptions. Attributes are ignored by arduino-nrf5 variant. <br>
 * Definition taken from Arduino Primo Core with ordered ports<br>
 */<br>
const PinDescription g_APinDescription[]=<br>
{<br>
 { NOT_A_PORT, 0, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // LFCLK<br>
 { NOT_A_PORT, 1, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // LFCLK<br>
 { PORT0, 2, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A0, PWM4, NOT_ON_TIMER},<br>
 { PORT0, 3, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A1, PWM5, NOT_ON_TIMER},<br>
 { PORT0, 4, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A2, PWM6, NOT_ON_TIMER},<br>
 { PORT0, 5, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A3, PWM7, NOT_ON_TIMER},<br>
 { PORT0, 6, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT3<br>
 { PORT0, 7, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT4<br>
 { PORT0, 8, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM10, NOT_ON_TIMER}, //USER_LED<br>
 { PORT0, 9, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // NFC1<br>
 { PORT0, 10, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // NFC2<br>
 { PORT0, 11, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // TX<br>
 { PORT0, 12, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // RX<br>
 { PORT0, 13, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // SDA<br>
 { PORT0, 14, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // SCL<br>
 { PORT0, 15, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // SDA1<br>
 { PORT0, 16, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // SCL1<br>
 { PORT0, 17, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // TP4<br>
 { PORT0, 18, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // TP5<br>
 { PORT0, 19, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT2<br>
 { PORT0, 20, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT1<br>
 { PORT0, 21, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT1<br>
 { PORT0, 22, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM9, NOT_ON_TIMER},<br>
 { PORT0, 23, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM8, NOT_ON_TIMER},<br>
 { PORT0, 24, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT<br>
 { PORT0, 25, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM11, NOT_ON_TIMER}, //RED_LED<br>
 { PORT0, 26, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM11, NOT_ON_TIMER}, //GREEN_LED<br>
 { PORT0, 27, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM11, NOT_ON_TIMER}, //BLUE_LED<br>
 { PORT0, 28, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A4, PWM3, NOT_ON_TIMER},<br>
 { PORT0, 29, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A5, PWM2, NOT_ON_TIMER},<br>
 { PORT0, 30, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A6, PWM1, NOT_ON_TIMER},<br>
 { PORT0, 31, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A7, PWM0, NOT_ON_TIMER}<br>
};<br>
<br>
// Don't remove this line<br>
#include &lt;compat_pin_mapping.h&gt;<br>
<br>
#endif<br>
</code><br>
<br>
MyBoardNRF5.h<br>
<code>#ifndef _MYBOARDNRF5_H_<br>
#define _MYBOARDNRF5_H_<br>
<br>
#ifdef __cplusplus<br>
extern "C"<br>
{<br>
#endif // __cplusplus<br>
<br>
// Number of pins defined in PinDescription array<br>
#define PINS_COUNT (32u)<br>
#define NUM_DIGITAL_PINS (32u)<br>
#define NUM_ANALOG_INPUTS (8u)<br>
#define NUM_ANALOG_OUTPUTS (8u)<br>
<br>
/* <br>
 * LEDs<br>
 * <br>
 * This is optional<br>
 * <br>
 * With My Sensors, you can use<br>
 * hwPinMode() instead of pinMode()<br>
 * hwPinMode() allows to use advanced modes like OUTPUT_H0H1 to drive LEDs.<br>
 * https://github.com/mysensors/MySensors/blob/development/drivers/NRF5/nrf5_wiring_constants.h<br>
 *<br>
 */<br>
#define PIN_LED1 (16)<br>
#define PIN_LED2 (15)<br>
#define PIN_LED3 (17)<br>
#define RED_LED (PIN_LED1)<br>
#define GREEN_LED (PIN_LED2)<br>
#define BLUE_LED (PIN_LED3)<br>
#define INTERRUPT_PIN (5)<br>
#define MODE_PIN (25)<br>
#define SENS_PIN (27)<br>
<br>
/* <br>
 * Analog ports<br>
 * <br>
 * If you change g_APinDescription, replace PIN_AIN0 with<br>
 * port numbers mapped by the g_APinDescription Array.<br>
 * You can add PIN_AIN0 to the g_APinDescription Array if<br>
 * you want provide analog ports MCU independed, you can add<br>
 * PIN_AIN0..PIN_AIN7 to your custom g_APinDescription Array<br>
 * defined in MyBoardNRF5.cpp<br>
 */<br>
static const uint8_t A0 = ADC_A0;<br>
static const uint8_t A1 = ADC_A1;<br>
static const uint8_t A2 = ADC_A2;<br>
static const uint8_t A3 = ADC_A3;<br>
static const uint8_t A4 = ADC_A4;<br>
static const uint8_t A5 = ADC_A5;<br>
static const uint8_t A6 = ADC_A6;<br>
static const uint8_t A7 = ADC_A7;<br>
<br>
/*<br>
 * Serial interfaces<br>
 * <br>
 * RX and TX are required.<br>
 * If you have no serial port, use unused pins<br>
 * CTS and RTS are optional.<br>
 */<br>
#define PIN_SERIAL_RX (11)<br>
#define PIN_SERIAL_TX (12)<br>
<br>
#ifdef __cplusplus<br>
}<br>
#endif<br>
<br>
#endif<br>
</code><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スイッチの背面には、タッチボタンと時計ボタンがあります。この時計ボタンは、サービスモード、エアスナップモード、デバイスのゼロ化に使用されます。ボタンは鉄の反跳ね返りを実装します。容量性センサーラインとショットキーダイオードを介したクロックボタンラインが接続され、アナログピンp0.05に接続されます。p0.25およびp0.27 MKピンへのラインは、容量性センサーとクロックボタンに送られ、p0ピンの割り込みをアクティブ化した後に状態を読み取ります。 05。ピンp0.05で、EVENTS_UPによるコンパレータ（NRF_LPCOMP）を介した割り込みがアクティブになります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題を解決するためのインスピレーションを得</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スイッチはMysensorsネットワークに追加され、スマートホームのコントローラーであるMagordomoによって管理されました（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトサイト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statusUpdateメソッドにスイッチを追加するためのPHPコード</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-keyword">if</span> (getGlobal(<span class="hljs-string">"MysensorsButton01.status"</span>)==<span class="hljs-number">1</span>) {
<span class="hljs-keyword">if</span> (getGlobal(<span class="hljs-string">'MysensorsRelay04.status'</span>) == <span class="hljs-number">0</span>) {<font></font>
setGlobal(<span class="hljs-string">'MysensorsRelay04.status'</span>, <span class="hljs-string">'1'</span>);<font></font>
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (getGlobal(<span class="hljs-string">'MysensorsRelay04.status'</span>) == <span class="hljs-number">1</span>) {<font></font>
setGlobal(<span class="hljs-string">'MysensorsRelay04.status'</span>, <span class="hljs-string">'0'</span>);<font></font>
} <font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオで結果を見る</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/DVpDjXjeUKg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br>
<br>
<img src="https://habrastorage.org/webt/ia/zu/2m/iazu2mhz4be1b1kzv_ncyp-lzwc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、ブーストコンバーターを使用してオプションが作成されましたが、これはTTP223容量性マイクロ回路の動作とは関係がないため、バッテリーの寿命全体にわたってタップを機能させる場合、良好で均一な照明が望まれています。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見て</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/qr/_l/qd/qr_lqddvybuh6nplnpbckv_b0mu.png"><br>
<br>
<img src="https://habrastorage.org/webt/y4/2p/yi/y42pyintvyekuu3fnftwph_u1wy.png"><br>
</div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトのgithubの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/smartboxchannel/EFEKTA_WIRELESS_TOUCH_SWITCH</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ロシア語</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コミュニティサイト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mysensors </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電報がMysensorsチャット</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 328 ATMEGAマイクロコントローラでの作業、Mysensors、ヒント、トリック、ボードをインストールして問題に迅速にソリューションを、STM32、nRFes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ Ardumsmrms @ Armsmins IDRino5腕</font></font></b></a><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの写真</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/cw/_5/jj/cw_5jjdmlm030e_c26xw8o2eg88.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/ye/qg/np/yeqgnpxygqbxsyoehne_jbcec9c.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nn/8w/8u/nn8w8uqrdgjwpjnj_2injvyokh4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/8v/8y/fy/8v8yfywuwsvrjjpz64fm_rkhqvc.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/8k/_w/b5/8k_wb50hjjkuv_nvov0fskernlm.jpeg"><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457980/index.html">ニューラルネットワークとディープラーニング、第2章：逆伝播アルゴリズムのしくみ</a></li>
<li><a href="../ja457982/index.html">海外への移動：米国とカナダの移民を支援する6つのサービス</a></li>
<li><a href="../ja457986/index.html">JetBrains 2019オープン日：レポートブロードキャスト</a></li>
<li><a href="../ja457988/index.html">チェックリスト：SCRUMコマンドを起動し、ゾンビスクラムからワクチン接種を受ける</a></li>
<li><a href="../ja457990/index.html">標的型フィッシングの被害者になってから7ワード</a></li>
<li><a href="../ja457996/index.html">上司の告白：旅行中に働く方法、ロサンゼルスの部門の半分を解雇する方法、そしてMexetnoExp Tyoma Lebedevを後援する理由</a></li>
<li><a href="../ja458002/index.html">失踪したマレーシアのボーイングで実際に何が起こったのか（パート1/3）</a></li>
<li><a href="../ja458004/index.html">ソユーズTM宇宙船交通管制システムパート2</a></li>
<li><a href="../ja458006/index.html">Githubページ上の動的サーバーレスサイト（知らない人のために、サーバーレスはサードパーティのAPIサーバーを使用します）</a></li>
<li><a href="../ja458010/index.html">とらえどころのないマルヴァリの冒険、パートII：秘密のVBAスクリプト</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>