<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî¶ üõ•Ô∏è üôçüèΩ Pitfalls of Terraform üöõ ‚òÇÔ∏è üë©‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We‚Äôll highlight several pitfalls, including those related to loops, if statements, and deployment techniques, as well as more general issues that conc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pitfalls of Terraform</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/496820/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/9d/ou/9e/9dou9eb8rwq6zzcphuthymczj4a.jpeg" alt="image"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We‚Äôll highlight several pitfalls, including those related to loops, if statements, and deployment techniques, as well as more general issues that concern Terraform as a whole:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the count and for_each parameters have limitations;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zero downtime deployment restrictions</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">even a good plan may fail;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">refactoring can have its tricks;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deferred consistency is consistent ... with deferral.</font></font></li>
</ul><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count and for_each parameters have limitations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the examples in this chapter, the count parameter and the for_each expression are actively used in loops and conditional logic. </font><font style="vertical-align: inherit;">They perform well, but they have two important limitations that you need to know about.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In count and for_each, no resource output variables can be referenced.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count and for_each cannot be used in module configuration.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count and for_each cannot reference any output variables of a resource</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine you need to deploy multiple EC2 servers and for some reason you do not want to use ASG. </font><font style="vertical-align: inherit;">Your code might be like this:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_1"</span> {<font></font>
   count             = <span class="hljs-number">3</span>
   ami                = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type = <span class="hljs-string">"t2.micro"</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will consider them in turn. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since the count parameter is assigned a static value, this code will work without problems: when you run the apply command, it will create three EC2 servers. But if you wanted to deploy one server in each availability zone (Availability Zone or AZ) within the current AWS region? You can have your code load the list of zones from the aws_availability_zones data source and then cycle through each of them and create an EC2 server in it using the count parameter and accessing the array by index:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_2"</span> {<font></font>
   count                   = length(data.aws_availability_zones.all.names)<font></font>
   availability_zone   = data.aws_availability_zones.all.names[count.index]<font></font>
   ami                     = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type       = <span class="hljs-string">"t2.micro"</span><font></font>
}<font></font>
<font></font>
data <span class="hljs-string">"aws_availability_zones"</span> <span class="hljs-string">"all"</span> {}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code will also work just fine, as the count parameter can reference data sources without any problems. </font><font style="vertical-align: inherit;">But what happens if the number of servers you need to create depends on the output of some resource? </font><font style="vertical-align: inherit;">To demonstrate this, the easiest way is to take the random_integer resource, which, as you might guess from the name, returns a random integer:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"random_integer"</span> <span class="hljs-string">"num_instances"</span> {<font></font>
  min = <span class="hljs-number">1</span>
  max = <span class="hljs-number">3</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code generates a random number from 1 to 3. Let's see what happens if we try to use the result output of this resource in the count parameter of the aws_instance resource:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_3"</span> {<font></font>
   count             = random_integer.num_instances.result<font></font>
   ami                = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type = <span class="hljs-string">"t2.micro"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you execute terraform plan for this code, you get the following error:</font></font><br>
<br>
<pre><code class="java hljs">Error: Invalid count argument<font></font>
<font></font>
   on main.tf line <span class="hljs-number">30</span>, in resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_3"</span>:
   <span class="hljs-number">30</span>: count = random_integer.num_instances.result<font></font>
<font></font>
The <span class="hljs-string">"count"</span> value depends on resource attributes that cannot be determined until apply, so Terraform cannot predict how many instances will be created. To work around <span class="hljs-keyword">this</span>, use the -target argument to first apply only the resources that the count depends on.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terraform requires that count and for_each be computed during the planning phase, before any resources are created or modified. </font><font style="vertical-align: inherit;">This means that count and for_each can refer to literals, variables, data sources, and even lists of resources (provided that their length can be determined during planning), but not to computed output variables of the resource.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count and for_each cannot be used in module configuration</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometime you may be tempted to add the count parameter to the module configuration:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">module</span> <span class="hljs-string">"count_example"</span> {<font></font>
     source = <span class="hljs-string">"../../../../modules/services/webserver-cluster"</span><font></font>
<font></font>
     count = <span class="hljs-number">3</span><font></font>
<font></font>
     cluster_name = <span class="hljs-string">"terraform-up-and-running-example"</span>
     server_port = <span class="hljs-number">8080</span>
     instance_type = <span class="hljs-string">"t2.micro"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This code attempts to use count inside the module to create three copies of the webserver-cluster resource. </font><font style="vertical-align: inherit;">Or, maybe you want to make the module connection optional depending on some Boolean condition, assigning its count parameter to 0. This code will look quite reasonable, but as a result of executing the terraform plan you will get the following error:</font></font><br>
<br>
<pre><code class="java hljs">Error: Reserved argument name in <span class="hljs-keyword">module</span> block<font></font>
<font></font>
   on main.tf line <span class="hljs-number">13</span>, in <span class="hljs-keyword">module</span> <span class="hljs-string">"count_example"</span>:
   <span class="hljs-number">13</span>: count = <span class="hljs-number">3</span><font></font>
<font></font>
The name <span class="hljs-string">"count"</span> is reserved <span class="hljs-keyword">for</span> use in a future version of Terraform.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, at the time Terraform 0.12.6 was released, the use of count or for_each in the module resource was not supported. </font><font style="vertical-align: inherit;">According to Terraform 0.12 release notes (http://bit.ly/3257bv4), HashiCorp plans to add this feature in the future, so depending on when you read this book, it may already be available. </font><font style="vertical-align: inherit;">To find out for sure, check out the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraform change log here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using the create_before_destroy block in combination with ASG is an excellent solution for organizing deployments with zero downtime, except for one nuance: autoscaling rules are not supported. Or, to be more precise, this resets the ASG size back to min_size on every deployment, which can be a problem if you used autoscaling rules to increase the number of running servers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, the webserver-cluster module contains a pair of aws_autoscaling_schedule resources, which at 9 am increase the number of servers in the cluster from two to ten. If you deploy, say, at 11 a.m., the new ASG will not boot with ten, but with only two servers, and will remain in this state until 9 a.m. the next day.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This limitation can be circumvented in several ways.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change the recurrence parameter in aws_autoscaling_schedule from 0 9 * * * (‚Äúrun at 9am‚Äù) to something like 0-59 9-17 * * * (‚Äúrun every minute from 9am to 5pm‚Äù). </font><font style="vertical-align: inherit;">If the ASG already has ten servers, re-executing this autoscale rule will not change anything, which is what we need. </font><font style="vertical-align: inherit;">But if the ASG group has been recently deployed, this rule ensures that in a minute the number of its servers reaches ten. </font><font style="vertical-align: inherit;">This is not quite an elegant approach, and large jumps from ten to two servers and back can also cause problems for users.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create a user-defined script that uses the AWS API to determine the number of active servers in the ASG, call it using an external data source (see section "External data source" on page 249), and set the desired_capacity parameter of the ASG group to the value returned by this script. </font><font style="vertical-align: inherit;">Thus, each new ASG instance will always run with the same capacity as the old Terraform code and complicates its maintenance.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, ideally, Terraform should have built-in support for deployments with zero downtime, but as of May 2019, the HashiCorp team did not plan to add this functionality ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">details are here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The correct plan may be unsuccessfully implemented.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sometimes when you execute the plan command, you get a completely correct deployment plan, but the apply command returns an error. </font><font style="vertical-align: inherit;">For example, try adding the aws_iam_user resource with the same name that you used for the IAM user that you created earlier in chapter 2:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {<font></font>
   #       IAM,<font></font>
   #      terraform <span class="hljs-keyword">import</span>
   name = <span class="hljs-string">"yevgeniy.brikman"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, if you execute the plan command, Terraform will display at first glance a very reasonable deployment plan:</font></font><br>
<br>
<pre><code class="java hljs">Terraform will perform the following actions:<font></font>
<font></font>
   # aws_iam_user.existing_user will be created<font></font>
   + resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {<font></font>
         + arn                  = (known after apply)<font></font>
         + force_destroy   = <span class="hljs-keyword">false</span><font></font>
         + id                    = (known after apply)<font></font>
         + name               = <span class="hljs-string">"yevgeniy.brikman"</span>
         + path                 = <span class="hljs-string">"/"</span><font></font>
         + unique_id         = (known after apply)<font></font>
      }<font></font>
<font></font>
Plan: <span class="hljs-number">1</span> to add, <span class="hljs-number">0</span> to change, <span class="hljs-number">0</span> to destroy.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you execute the apply command, you get the following error:</font></font><br>
<br>
<pre><code class="java hljs">Error: Error creating IAM User yevgeniy.brikman: EntityAlreadyExists:<font></font>
User with name yevgeniy.brikman already exists.<font></font>
<font></font>
   on main.tf line <span class="hljs-number">10</span>, in resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span>:
   <span class="hljs-number">10</span>: resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The problem, of course, is that an IAM user with that name already exists. And this can happen not only with IAM users, but also with almost any resource. It is possible that someone created this resource manually or using the command line, but be that as it may, matching identifiers leads to conflicts. There are many flavors to this error that often take the Terraform beginners by surprise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The key point is that the terraform plan command only considers resources that are specified in the Terraform status file. If resources are created in some other way (for example, manually, by clicking on the AWS console), they will not get into the status file and, therefore, Terraform will not take them into account when executing the plan command. As a result, the plan that is correct at first glance will be unsuccessful.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Two lessons can be learned from this.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you have already started working with Terraform, do not use anything else. </font><font style="vertical-align: inherit;">If part of your infrastructure is managed using Terraform, you can no longer modify it manually. </font><font style="vertical-align: inherit;">Otherwise, you not only run the risk of getting strange Terraform errors, but also negate many of the benefits of IaC, as the code will no longer be an accurate representation of your infrastructure.</font></font></li>
<li>     - ,   import.     Terraform    ,          terraform import.  Terraform  ,    .  import   .        .    ,      : _. ( aws_iam_user.existing_user).   ‚Äî   ,   . ,   ID  aws_iam_user    (, yevgeniy.brikman),  ID  aws_instance    EC2 ( i-190e22e5). ,   ,       .<br>
<br>
   import,    aws_iam_user,       Terraform    IAM   2 (,  yevgeniy.brikman    ):<br>
<br>
<pre><code class="plaintext hljs">$ terraform import aws_iam_user.existing_user yevgeniy.brikman</code></pre><br>
Terraform   API AWS,     IAM           aws_iam_user.existing_user    Terraform.       plan Terraform  ,   IAM  ,        .<br>
<br>
 , ,       ,      Terraform,              .       ,  Terraforming (http://terraforming.dtan4.net/),        AWS   .<br>
<br>
<h3>    </h3><br>
<i></i> ‚Äî    ,      ,     .  ,     ,     .  ‚Äî   ,    . ,     Terraform     IaC,      ,      ¬´ ¬ª  ,    .<br>
<br>
,    ‚Äî       .  IDE               .        ,     ,   Terraform      ,       .<br>
<br>
 ,   webserver-cluster    cluster_name:<br>
<br>
<pre><code class="java hljs">variable <span class="hljs-string">"cluster_name"</span> {<font></font>
   description = <span class="hljs-string">"The name to use for all the cluster resources"</span><font></font>
   type          = string<font></font>
}</code></pre><br>
,            foo.        bar.     ,    -      .<br>
<br>
  ,   webserver-cluster   cluster_name    ,   name     ALB:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                    = <span class="hljs-keyword">var</span>.cluster_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}</code></pre><br>
   name  - , Terraform          .      ALB,                    -.   ,    ,       ,      .<br>
<br>
   ,    ,    Terraform.      aws_security_group   webserver-cluster:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"instance"</span> {<font></font>
  # (...)<font></font>
}</code></pre><br>
    instance. ,            (  )  cluster_instance:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"cluster_instance"</span> {<font></font>
   # (...)<font></font>
}</code></pre><br>
   ? :   .<br>
<br>
Terraform  ID      . , iam_user     IAM  AWS,  aws_instance ‚Äî  ID  AWS EC2.     (,  instance  cluster_instance,     aws_security_group),  Terraform    ,        .    , Terraform       ,          .<br>
<br>
   ,       .<br>
<br>
<ul>
<li>   plan.      .         ,  Terraform   , ,  ,   .</li>
<li>,   .     ,  ,       .   ,     create_before_destroy.      ,   :          apply,           apply  .</li>
<li>    .     ,    (,  aws_security_group  instance  cluster_instance),          ,       Terraform.      ‚Äî     terraform state.       terraform state mv,    :<br>
<br>
<pre><code class="plaintext hljs">terraform state mv &lt;ORIGINAL_REFERENCE&gt; &lt;NEW_REFERENCE&gt;</code></pre><br>
ORIGINAL_REFERENCE ‚Äî  ,       ,  NEW_REFERENCE ‚Äî  ,     . ,    aws_security_group  instance  cluster_instance    :<br>
<br>
<pre><code class="java hljs">$ terraform state mv \<font></font>
   aws_security_group.instance \<font></font>
   aws_security_group.cluster_instance</code></pre><br>
   Terraform,  ,     aws_security_group.instance,      aws_security_group.cluster_instance.        terraform plan    , ,    .</li>
</ul><br>
<ul>
<li>   .    .    , Terraform        .      ,        ,      .    plan      create_before_destroy.</li>
</ul><br>
<h3>  ‚Ä¶  </h3><br>
API   ,   AWS,     .  ,       ,     .   ,          ;   ,         ,        API-.<br>
<br>
,  ,    API-  AWS     EC2. API  ¬´¬ª  (201 Created)  ,     .        ,     ,     AWS     ,  ,    .  ,      ,      ,    (404 Not Found).   ,      EC2      AWS,     ,    .<br>
<br>
    API         ,         .  , AWS SDK       ,   Terraform       6813 (https://github.com/hashicorp/terraform/issues/6813):<br>
<br>
<pre><code class="java hljs">$ terraform apply<font></font>
aws_subnet.<span class="hljs-keyword">private</span>-persistence<span class="hljs-number">.2</span>: InvalidSubnetID.NotFound:<font></font>
The subnet ID <span class="hljs-string">'subnet-xxxxxxx'</span> does not exist</code></pre><br>
 ,    (, )       -  ( ID    ),  Terraform    .     ( 6813)  ,        ,    Terraform     .  ,        .    terraform apply   ,         .<br>
<br>
       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">¬´Terraform:    ¬ª</a>.</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496804/index.html">Installing and Configuring Docker on Windows Subsystem Linux (WSL)</a></li>
<li><a href="../en496810/index.html">General Financial Analysis in Python (Part 3)</a></li>
<li><a href="../en496812/index.html">Zoom - banal negligence or targeted espionage?</a></li>
<li><a href="../en496816/index.html">Can you feel the candidate, is he alive?</a></li>
<li><a href="../en496818/index.html">Hundreds of thousands of routes per second per core. Yandex.Routing Experience</a></li>
<li><a href="../en496822/index.html">How startups in the United States die due to coronavirus</a></li>
<li><a href="../en496824/index.html">Your Nordic work environment</a></li>
<li><a href="../en496826/index.html">Million sprites at 120+ fps</a></li>
<li><a href="../en496828/index.html">Where to find freelance that will be fun? (Spoiler: not Upwork)</a></li>
<li><a href="../en496830/index.html">What is Emergent Communication and why you need to know</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>