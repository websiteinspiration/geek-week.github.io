<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏼‍🤝‍🧑🏼 🕺🏿 👰🏽 Combien d'instructions de processeur le compilateur utilise-t-il? 👨🏼‍🎓 🧚🏾 🐩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a un mois, j'ai essayé de compter le nombre d'instructions différentes prises en charge par les processeurs modernes et j'en ai compté 945 à Ice ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Combien d'instructions de processeur le compilateur utilise-t-il?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506832/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a un mois, j'ai </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essayé de compter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le nombre d'instructions différentes prises en charge par les processeurs modernes et </font><font style="vertical-align: inherit;">j'en ai </font><font style="vertical-align: inherit;">compté 945 à Ice Lake. Les commentateurs ont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soulevé une question intéressante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : quelle partie de toute cette diversité est réellement utilisée par les compilateurs? Par exemple, un certain Pepijn de Vos en 2016 a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculé</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> combien d'instructions différentes sont impliquées dans les binaires dans son / usr / bin, et en a compté 411 - c'est-à-dire environ un tiers de toutes les instructions x86_64 qui existaient à l'époque n'étaient utilisées dans aucun des programmes standard de son système d'exploitation. Son autre découverte curieuse est que le code pour x86_64 se compose d'instructions pour un troisième </font></font><code>mov</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. (En général, on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://web.archive.org/web/20190331191157/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sait</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que les instructions </font></font><code>mov</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suffisent à </font><font style="vertical-align: inherit;">elles seules </font><font style="vertical-align: inherit;">pour écrire n'importe quel programme.)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai décidé de développer la recherche de Vos en utilisant le compilateur LLVM / Clang comme «code de référence». </font><font style="vertical-align: inherit;">Il présente plusieurs avantages par rapport au contenu de / usr / bin d'une version sans nom d'un système d'exploitation sans nom:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est pratique de travailler avec: il s'agit d'un énorme binaire, de taille comparable à tout le contenu de / usr / bin de Linux moyen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il vous permet de comparer différents ISA: </font><font style="vertical-align: inherit;">les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> officielles de x86, ARM, SPARC, MIPS et PowerPC sont disponibles </font><font style="vertical-align: inherit;">sur </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">releases.llvm.org/download.html</font></a><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il vous permet de suivre les tendances historiques: les binaires officiels sont disponibles pour toutes les versions depuis 2003;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, dans l'étude des compilateurs, il est logique d'utiliser le compilateur comme objet expérimental :-)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais commencer par les statistiques de la version de mars de LLVM 10.0:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EST UN</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taille binaire</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taille de la section .text</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nombre total d'instructions</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nombre d'instructions différentes</font></font></th>
</tr>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AArch64</font></font></th>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;97 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">74 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13 814 975</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">195</font></font></td>
</tr>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARMv7A</font></font></th>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">101 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15,621,010</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">308</font></font></td>
</tr>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i386</font></font></th>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">106 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">88 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20 138 657</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">122</font></font></td>
</tr>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerPC64LE</font></font></th>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">108 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">89 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17 208 502</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">288</font></font></td>
</tr>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPARCv9</font></font></th>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">129 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">105 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19,993,362</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">122</font></font></td>
</tr>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86_64</font></font></th>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">107 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">87 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15 281 299</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">203</font></font></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le dernier sujet, les commentateurs ont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mentionné</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qu'ils obtenaient le code le plus compact pour SPARC. </font><font style="vertical-align: inherit;">Ici, nous voyons que le binaire pour AArch64 est un tiers plus petit en taille et en nombre total d'instructions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici la répartition en fonction du nombre d'instructions:</font></font><br>
<img src="https://habrastorage.org/webt/kh/ww/hm/khwwhmu8v3ybigswfc2qkw_h9wu.png" width="256"> <img src="https://habrastorage.org/webt/j9/sp/je/j9spjenramwfdy81yg1knir-vxa.png" width="256"> <img src="https://habrastorage.org/webt/98/x0/s1/98x0s1ug_plt-kum6z-pnequy3k.png" width="256"> <img src="https://habrastorage.org/webt/fm/uo/bu/fmuobun0f3s-ou6wq4qbsaht0yk.png" width="256"> <img src="https://habrastorage.org/webt/7v/6h/j1/7v6hj10_uzguo7gnlinmk8nqiaq.png" width="256"> <img src="https://habrastorage.org/webt/xg/xz/qu/xgxzquiy039jdtqw2u708x7be1k.png" width="256"><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De façon inattendue, le code de 11% pour SPARC consiste à </font></font><code>nop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remplir des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">emplacements de retard de branche</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour i386, parmi les instructions les plus fréquentes, nous voyons à la fois </font></font><code>int3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combler les lacunes entre les fonctions et </font></font><code>nop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisées pour aligner les boucles sur les lignes de cache. L'observation de Vos selon laquelle le code est composé d'un tiers </font></font><code>mov</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est confirmée sur les deux variantes x86; mais même sur les architectures de magasin de charge, </font></font><code>mov</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il s'avère, sinon l'instruction la plus fréquente, la seconde après la charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment l'ensemble d'instructions utilisé a-t-il changé au fil du temps? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le seul ISA pour lequel chaque version a un binaire officiel est le i386:</font></font><br>
<img src="https://habrastorage.org/webt/jm/90/tp/jm90tpkyf7o9o9asxx6lkyedpvg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ligne grise posée sur l'axe de droite est le nombre d'instructions différentes utilisées dans le compilateur. Comme nous pouvons le voir, il y a quelque temps, le compilateur était compilé beaucoup plus divers. </font></font><code>int3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'a été utilisé pour combler les lacunes qu'en 2018; utilisé précédemment de la même manière </font></font><code>nop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que pour l'alignement dans les fonctions. Ici, vous pouvez voir que l'alignement à l'intérieur des fonctions est utilisé depuis 2013; avant cela, </font></font><code>nop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il y en avait beaucoup moins. Il est également intéressant de noter que jusqu'en 2016, ils </font></font><code>mov</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">représentaient près de la moitié du compilateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les toutes premières versions de LLVM, avant l'avènement de clang, ont également été publiées avec des binaires pour SPARC. Ensuite, le soutien à SPARC a perdu de sa pertinence, et encore une fois, il n'est apparu qu'après 14 ans - avec un ordre de grandeur augmenté le nombre de </font></font><code>nop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s:</font></font><br>
<img src="https://habrastorage.org/webt/yx/cb/ax/yxcbax8rti9hvxewftfrhy3casg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Historiquement, le prochain ISA pour lequel les binaires LLVM ont été publiés était PowerPC: d'abord pour Mac OS X, puis, après une interruption de dix ans, pour RHEL. Comme vous pouvez le voir sur le graphique, la transition après cette interruption vers la version 64 bits d'ISA s'est accompagnée du remplacement de la majorité </font></font><code>lwz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par </font></font><code>ld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et en outre, du doublement de la variété des instructions: </font></font><br>
<img src="https://habrastorage.org/webt/3u/ry/is/3uryiswbi_mulnxmx-fhmd1dkeu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans les binaires pour x86_64 et ARM, la fréquence d'utilisation de différentes instructions était presque inchangée: </font></font><br>
<img src="https://habrastorage.org/webt/nw/-3/6t/nw-36tjm3kcixpao1e477xqss8o.png"><br>
<br>
<img src="https://habrastorage.org/webt/m9/6q/g_/m96qg_c_icdo7tfhkdortqzm708.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lors du comptage des instructions ARM, j'ai supprimé les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suffixes de condition</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ensemble avec eux, environ un millier d'instructions différentes ont été obtenues, mais même sans elles, ARM est loin devant les autres ISA dans la variété des instructions générées. Ainsi couche</font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur ce graphique inclut également toutes les ramifications conditionnelles. </font><font style="vertical-align: inherit;">Pour le reste de l'ISA, où seules les transitions et quelques autres instructions peuvent être conditionnelles, les suffixes de conditions n'ont pas été supprimés lors du calcul. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, l'ISA le plus récent pour lequel des binaires officiels sont publiés est AArch64. </font><font style="vertical-align: inherit;">Ce qui est intéressant ici, c'est qu'il </font></font><code>orr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a presque cessé d'être utilisé depuis l'année dernière: </font></font><br>
<img src="https://habrastorage.org/webt/p3/t5/bn/p3t5bn-h4uc-ve0khw7pancivxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerPC et AArch64 se sont avérés être les seuls ISA pour lesquels le nombre d'instructions différentes utilisées ne cesse de croître.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr506814/index.html">Chronique cool, sans tube Audio-Technica AT-LPW40WN</a></li>
<li><a href="../fr506816/index.html">Gestionnaire de périphériques Mise à jour et suivi</a></li>
<li><a href="../fr506826/index.html">Nous fabriquons nous-mêmes un spectromètre à scintillation à partir ... d'un radiomètre</a></li>
<li><a href="../fr506828/index.html">Comment rendre les images génératives naturelles avec des algorithmes mathématiques</a></li>
<li><a href="../fr506830/index.html">Web Apps: Framework pris en charge par Micro Frontend Module Federation</a></li>
<li><a href="../fr506834/index.html">"Le dernier programme." Série Web sur l'intelligence artificielle</a></li>
<li><a href="../fr506838/index.html">De la Lituanie à New York: le KGB dédié au renseignement</a></li>
<li><a href="../fr506842/index.html">RPA: processus d'enregistrement de facture robotique. Le guide le plus complet</a></li>
<li><a href="../fr506848/index.html">Pourquoi avons-nous changé pour $ SPINNED_TECHNOLOGY à $ FAMOUS_COMPANY</a></li>
<li><a href="../fr506852/index.html">Comment Signal crypto messenger résiste avec succès à l'écoute électronique par les autorités américaines</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>